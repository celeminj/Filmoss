var Aa="top",xl="bottom",bl="right",Ca="left",pb="auto",P_=[Aa,xl,bl,Ca],cp="start",a_="end",rD="clippingParents",KE="viewport",km="popper",nD="reference",NT=P_.reduce(function(n,e){return n.concat([e+"-"+cp,e+"-"+a_])},[]),JE=[].concat(P_,[pb]).reduce(function(n,e){return n.concat([e,e+"-"+cp,e+"-"+a_])},[]),sD="beforeRead",oD="read",aD="afterRead",lD="beforeMain",cD="main",uD="afterMain",hD="beforeWrite",dD="write",fD="afterWrite",pD=[sD,oD,aD,lD,cD,uD,hD,dD,fD];function hu(n){return n?(n.nodeName||"").toLowerCase():null}function wl(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function up(n){var e=wl(n).Element;return n instanceof e||n instanceof Element}function Jl(n){var e=wl(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function QE(n){if(typeof ShadowRoot>"u")return!1;var e=wl(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function fN(n){var e=n.state;Object.keys(e.elements).forEach(function(o){var u=e.styles[o]||{},d=e.attributes[o]||{},y=e.elements[o];!Jl(y)||!hu(y)||(Object.assign(y.style,u),Object.keys(d).forEach(function(v){var r=d[v];r===!1?y.removeAttribute(v):y.setAttribute(v,r===!0?"":r)}))})}function pN(n){var e=n.state,o={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,o.popper),e.styles=o,e.elements.arrow&&Object.assign(e.elements.arrow.style,o.arrow),function(){Object.keys(e.elements).forEach(function(u){var d=e.elements[u],y=e.attributes[u]||{},v=Object.keys(e.styles.hasOwnProperty(u)?e.styles[u]:o[u]),r=v.reduce(function(D,B){return D[B]="",D},{});!Jl(d)||!hu(d)||(Object.assign(d.style,r),Object.keys(y).forEach(function(D){d.removeAttribute(D)}))})}}const eS={name:"applyStyles",enabled:!0,phase:"write",fn:fN,effect:pN,requires:["computeStyles"]};function au(n){return n.split("-")[0]}var Xf=Math.max,Sx=Math.min,l_=Math.round;function VT(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function mD(){return!/^((?!chrome|android).)*safari/i.test(VT())}function c_(n,e,o){e===void 0&&(e=!1),o===void 0&&(o=!1);var u=n.getBoundingClientRect(),d=1,y=1;e&&Jl(n)&&(d=n.offsetWidth>0&&l_(u.width)/n.offsetWidth||1,y=n.offsetHeight>0&&l_(u.height)/n.offsetHeight||1);var v=up(n)?wl(n):window,r=v.visualViewport,D=!mD()&&o,B=(u.left+(D&&r?r.offsetLeft:0))/d,F=(u.top+(D&&r?r.offsetTop:0))/y,N=u.width/d,Q=u.height/y;return{width:N,height:Q,top:F,right:B+N,bottom:F+Q,left:B,x:B,y:F}}function tS(n){var e=c_(n),o=n.offsetWidth,u=n.offsetHeight;return Math.abs(e.width-o)<=1&&(o=e.width),Math.abs(e.height-u)<=1&&(u=e.height),{x:n.offsetLeft,y:n.offsetTop,width:o,height:u}}function _D(n,e){var o=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(o&&QE(o)){var u=e;do{if(u&&n.isSameNode(u))return!0;u=u.parentNode||u.host}while(u)}return!1}function eh(n){return wl(n).getComputedStyle(n)}function mN(n){return["table","td","th"].indexOf(hu(n))>=0}function Pd(n){return((up(n)?n.ownerDocument:n.document)||window.document).documentElement}function mb(n){return hu(n)==="html"?n:n.assignedSlot||n.parentNode||(QE(n)?n.host:null)||Pd(n)}function hP(n){return!Jl(n)||eh(n).position==="fixed"?null:n.offsetParent}function _N(n){var e=/firefox/i.test(VT()),o=/Trident/i.test(VT());if(o&&Jl(n)){var u=eh(n);if(u.position==="fixed")return null}var d=mb(n);for(QE(d)&&(d=d.host);Jl(d)&&["html","body"].indexOf(hu(d))<0;){var y=eh(d);if(y.transform!=="none"||y.perspective!=="none"||y.contain==="paint"||["transform","perspective"].indexOf(y.willChange)!==-1||e&&y.willChange==="filter"||e&&y.filter&&y.filter!=="none")return d;d=d.parentNode}return null}function z0(n){for(var e=wl(n),o=hP(n);o&&mN(o)&&eh(o).position==="static";)o=hP(o);return o&&(hu(o)==="html"||hu(o)==="body"&&eh(o).position==="static")?e:o||_N(n)||e}function iS(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function Vy(n,e,o){return Xf(n,Sx(e,o))}function gN(n,e,o){var u=Vy(n,e,o);return u>o?o:u}function gD(){return{top:0,right:0,bottom:0,left:0}}function yD(n){return Object.assign({},gD(),n)}function vD(n,e){return e.reduce(function(o,u){return o[u]=n,o},{})}var yN=function(e,o){return e=typeof e=="function"?e(Object.assign({},o.rects,{placement:o.placement})):e,yD(typeof e!="number"?e:vD(e,P_))};function vN(n){var e,o=n.state,u=n.name,d=n.options,y=o.elements.arrow,v=o.modifiersData.popperOffsets,r=au(o.placement),D=iS(r),B=[Ca,bl].indexOf(r)>=0,F=B?"height":"width";if(!(!y||!v)){var N=yN(d.padding,o),Q=tS(y),q=D==="y"?Aa:Ca,X=D==="y"?xl:bl,G=o.rects.reference[F]+o.rects.reference[D]-v[D]-o.rects.popper[F],ae=v[D]-o.rects.reference[D],xe=z0(y),Te=xe?D==="y"?xe.clientHeight||0:xe.clientWidth||0:0,fe=G/2-ae/2,ne=N[q],ue=Te-Q[F]-N[X],ye=Te/2-Q[F]/2+fe,le=Vy(ne,ye,ue),re=D;o.modifiersData[u]=(e={},e[re]=le,e.centerOffset=le-ye,e)}}function xN(n){var e=n.state,o=n.options,u=o.element,d=u===void 0?"[data-popper-arrow]":u;d!=null&&(typeof d=="string"&&(d=e.elements.popper.querySelector(d),!d)||_D(e.elements.popper,d)&&(e.elements.arrow=d))}const xD={name:"arrow",enabled:!0,phase:"main",fn:vN,effect:xN,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function u_(n){return n.split("-")[1]}var bN={top:"auto",right:"auto",bottom:"auto",left:"auto"};function wN(n,e){var o=n.x,u=n.y,d=e.devicePixelRatio||1;return{x:l_(o*d)/d||0,y:l_(u*d)/d||0}}function dP(n){var e,o=n.popper,u=n.popperRect,d=n.placement,y=n.variation,v=n.offsets,r=n.position,D=n.gpuAcceleration,B=n.adaptive,F=n.roundOffsets,N=n.isFixed,Q=v.x,q=Q===void 0?0:Q,X=v.y,G=X===void 0?0:X,ae=typeof F=="function"?F({x:q,y:G}):{x:q,y:G};q=ae.x,G=ae.y;var xe=v.hasOwnProperty("x"),Te=v.hasOwnProperty("y"),fe=Ca,ne=Aa,ue=window;if(B){var ye=z0(o),le="clientHeight",re="clientWidth";if(ye===wl(o)&&(ye=Pd(o),eh(ye).position!=="static"&&r==="absolute"&&(le="scrollHeight",re="scrollWidth")),ye=ye,d===Aa||(d===Ca||d===bl)&&y===a_){ne=xl;var oe=N&&ye===ue&&ue.visualViewport?ue.visualViewport.height:ye[le];G-=oe-u.height,G*=D?1:-1}if(d===Ca||(d===Aa||d===xl)&&y===a_){fe=bl;var se=N&&ye===ue&&ue.visualViewport?ue.visualViewport.width:ye[re];q-=se-u.width,q*=D?1:-1}}var Ae=Object.assign({position:r},B&&bN),De=F===!0?wN({x:q,y:G},wl(o)):{x:q,y:G};if(q=De.x,G=De.y,D){var Ge;return Object.assign({},Ae,(Ge={},Ge[ne]=Te?"0":"",Ge[fe]=xe?"0":"",Ge.transform=(ue.devicePixelRatio||1)<=1?"translate("+q+"px, "+G+"px)":"translate3d("+q+"px, "+G+"px, 0)",Ge))}return Object.assign({},Ae,(e={},e[ne]=Te?G+"px":"",e[fe]=xe?q+"px":"",e.transform="",e))}function TN(n){var e=n.state,o=n.options,u=o.gpuAcceleration,d=u===void 0?!0:u,y=o.adaptive,v=y===void 0?!0:y,r=o.roundOffsets,D=r===void 0?!0:r,B={placement:au(e.placement),variation:u_(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:d,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,dP(Object.assign({},B,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:v,roundOffsets:D})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,dP(Object.assign({},B,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:D})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const rS={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:TN,data:{}};var vv={passive:!0};function EN(n){var e=n.state,o=n.instance,u=n.options,d=u.scroll,y=d===void 0?!0:d,v=u.resize,r=v===void 0?!0:v,D=wl(e.elements.popper),B=[].concat(e.scrollParents.reference,e.scrollParents.popper);return y&&B.forEach(function(F){F.addEventListener("scroll",o.update,vv)}),r&&D.addEventListener("resize",o.update,vv),function(){y&&B.forEach(function(F){F.removeEventListener("scroll",o.update,vv)}),r&&D.removeEventListener("resize",o.update,vv)}}const nS={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:EN,data:{}};var SN={left:"right",right:"left",bottom:"top",top:"bottom"};function Qv(n){return n.replace(/left|right|bottom|top/g,function(e){return SN[e]})}var AN={start:"end",end:"start"};function fP(n){return n.replace(/start|end/g,function(e){return AN[e]})}function sS(n){var e=wl(n),o=e.pageXOffset,u=e.pageYOffset;return{scrollLeft:o,scrollTop:u}}function oS(n){return c_(Pd(n)).left+sS(n).scrollLeft}function CN(n,e){var o=wl(n),u=Pd(n),d=o.visualViewport,y=u.clientWidth,v=u.clientHeight,r=0,D=0;if(d){y=d.width,v=d.height;var B=mD();(B||!B&&e==="fixed")&&(r=d.offsetLeft,D=d.offsetTop)}return{width:y,height:v,x:r+oS(n),y:D}}function MN(n){var e,o=Pd(n),u=sS(n),d=(e=n.ownerDocument)==null?void 0:e.body,y=Xf(o.scrollWidth,o.clientWidth,d?d.scrollWidth:0,d?d.clientWidth:0),v=Xf(o.scrollHeight,o.clientHeight,d?d.scrollHeight:0,d?d.clientHeight:0),r=-u.scrollLeft+oS(n),D=-u.scrollTop;return eh(d||o).direction==="rtl"&&(r+=Xf(o.clientWidth,d?d.clientWidth:0)-y),{width:y,height:v,x:r,y:D}}function aS(n){var e=eh(n),o=e.overflow,u=e.overflowX,d=e.overflowY;return/auto|scroll|overlay|hidden/.test(o+d+u)}function bD(n){return["html","body","#document"].indexOf(hu(n))>=0?n.ownerDocument.body:Jl(n)&&aS(n)?n:bD(mb(n))}function Uy(n,e){var o;e===void 0&&(e=[]);var u=bD(n),d=u===((o=n.ownerDocument)==null?void 0:o.body),y=wl(u),v=d?[y].concat(y.visualViewport||[],aS(u)?u:[]):u,r=e.concat(v);return d?r:r.concat(Uy(mb(v)))}function UT(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function IN(n,e){var o=c_(n,!1,e==="fixed");return o.top=o.top+n.clientTop,o.left=o.left+n.clientLeft,o.bottom=o.top+n.clientHeight,o.right=o.left+n.clientWidth,o.width=n.clientWidth,o.height=n.clientHeight,o.x=o.left,o.y=o.top,o}function pP(n,e,o){return e===KE?UT(CN(n,o)):up(e)?IN(e,o):UT(MN(Pd(n)))}function PN(n){var e=Uy(mb(n)),o=["absolute","fixed"].indexOf(eh(n).position)>=0,u=o&&Jl(n)?z0(n):n;return up(u)?e.filter(function(d){return up(d)&&_D(d,u)&&hu(d)!=="body"}):[]}function RN(n,e,o,u){var d=e==="clippingParents"?PN(n):[].concat(e),y=[].concat(d,[o]),v=y[0],r=y.reduce(function(D,B){var F=pP(n,B,u);return D.top=Xf(F.top,D.top),D.right=Sx(F.right,D.right),D.bottom=Sx(F.bottom,D.bottom),D.left=Xf(F.left,D.left),D},pP(n,v,u));return r.width=r.right-r.left,r.height=r.bottom-r.top,r.x=r.left,r.y=r.top,r}function wD(n){var e=n.reference,o=n.element,u=n.placement,d=u?au(u):null,y=u?u_(u):null,v=e.x+e.width/2-o.width/2,r=e.y+e.height/2-o.height/2,D;switch(d){case Aa:D={x:v,y:e.y-o.height};break;case xl:D={x:v,y:e.y+e.height};break;case bl:D={x:e.x+e.width,y:r};break;case Ca:D={x:e.x-o.width,y:r};break;default:D={x:e.x,y:e.y}}var B=d?iS(d):null;if(B!=null){var F=B==="y"?"height":"width";switch(y){case cp:D[B]=D[B]-(e[F]/2-o[F]/2);break;case a_:D[B]=D[B]+(e[F]/2-o[F]/2);break}}return D}function h_(n,e){e===void 0&&(e={});var o=e,u=o.placement,d=u===void 0?n.placement:u,y=o.strategy,v=y===void 0?n.strategy:y,r=o.boundary,D=r===void 0?rD:r,B=o.rootBoundary,F=B===void 0?KE:B,N=o.elementContext,Q=N===void 0?km:N,q=o.altBoundary,X=q===void 0?!1:q,G=o.padding,ae=G===void 0?0:G,xe=yD(typeof ae!="number"?ae:vD(ae,P_)),Te=Q===km?nD:km,fe=n.rects.popper,ne=n.elements[X?Te:Q],ue=RN(up(ne)?ne:ne.contextElement||Pd(n.elements.popper),D,F,v),ye=c_(n.elements.reference),le=wD({reference:ye,element:fe,strategy:"absolute",placement:d}),re=UT(Object.assign({},fe,le)),oe=Q===km?re:ye,se={top:ue.top-oe.top+xe.top,bottom:oe.bottom-ue.bottom+xe.bottom,left:ue.left-oe.left+xe.left,right:oe.right-ue.right+xe.right},Ae=n.modifiersData.offset;if(Q===km&&Ae){var De=Ae[d];Object.keys(se).forEach(function(Ge){var yt=[bl,xl].indexOf(Ge)>=0?1:-1,ct=[Aa,xl].indexOf(Ge)>=0?"y":"x";se[Ge]+=De[ct]*yt})}return se}function DN(n,e){e===void 0&&(e={});var o=e,u=o.placement,d=o.boundary,y=o.rootBoundary,v=o.padding,r=o.flipVariations,D=o.allowedAutoPlacements,B=D===void 0?JE:D,F=u_(u),N=F?r?NT:NT.filter(function(X){return u_(X)===F}):P_,Q=N.filter(function(X){return B.indexOf(X)>=0});Q.length===0&&(Q=N);var q=Q.reduce(function(X,G){return X[G]=h_(n,{placement:G,boundary:d,rootBoundary:y,padding:v})[au(G)],X},{});return Object.keys(q).sort(function(X,G){return q[X]-q[G]})}function ON(n){if(au(n)===pb)return[];var e=Qv(n);return[fP(n),e,fP(e)]}function LN(n){var e=n.state,o=n.options,u=n.name;if(!e.modifiersData[u]._skip){for(var d=o.mainAxis,y=d===void 0?!0:d,v=o.altAxis,r=v===void 0?!0:v,D=o.fallbackPlacements,B=o.padding,F=o.boundary,N=o.rootBoundary,Q=o.altBoundary,q=o.flipVariations,X=q===void 0?!0:q,G=o.allowedAutoPlacements,ae=e.options.placement,xe=au(ae),Te=xe===ae,fe=D||(Te||!X?[Qv(ae)]:ON(ae)),ne=[ae].concat(fe).reduce(function(Hi,Ci){return Hi.concat(au(Ci)===pb?DN(e,{placement:Ci,boundary:F,rootBoundary:N,padding:B,flipVariations:X,allowedAutoPlacements:G}):Ci)},[]),ue=e.rects.reference,ye=e.rects.popper,le=new Map,re=!0,oe=ne[0],se=0;se<ne.length;se++){var Ae=ne[se],De=au(Ae),Ge=u_(Ae)===cp,yt=[Aa,xl].indexOf(De)>=0,ct=yt?"width":"height",mt=h_(e,{placement:Ae,boundary:F,rootBoundary:N,altBoundary:Q,padding:B}),et=yt?Ge?bl:Ca:Ge?xl:Aa;ue[ct]>ye[ct]&&(et=Qv(et));var Qe=Qv(et),vt=[];if(y&&vt.push(mt[De]<=0),r&&vt.push(mt[et]<=0,mt[Qe]<=0),vt.every(function(Hi){return Hi})){oe=Ae,re=!1;break}le.set(Ae,vt)}if(re)for(var st=X?3:1,Zt=function(Ci){var Ii=ne.find(function(Ui){var xi=le.get(Ui);if(xi)return xi.slice(0,Ci).every(function(Yi){return Yi})});if(Ii)return oe=Ii,"break"},ui=st;ui>0;ui--){var ni=Zt(ui);if(ni==="break")break}e.placement!==oe&&(e.modifiersData[u]._skip=!0,e.placement=oe,e.reset=!0)}}const TD={name:"flip",enabled:!0,phase:"main",fn:LN,requiresIfExists:["offset"],data:{_skip:!1}};function mP(n,e,o){return o===void 0&&(o={x:0,y:0}),{top:n.top-e.height-o.y,right:n.right-e.width+o.x,bottom:n.bottom-e.height+o.y,left:n.left-e.width-o.x}}function _P(n){return[Aa,bl,xl,Ca].some(function(e){return n[e]>=0})}function kN(n){var e=n.state,o=n.name,u=e.rects.reference,d=e.rects.popper,y=e.modifiersData.preventOverflow,v=h_(e,{elementContext:"reference"}),r=h_(e,{altBoundary:!0}),D=mP(v,u),B=mP(r,d,y),F=_P(D),N=_P(B);e.modifiersData[o]={referenceClippingOffsets:D,popperEscapeOffsets:B,isReferenceHidden:F,hasPopperEscaped:N},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":F,"data-popper-escaped":N})}const ED={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:kN};function zN(n,e,o){var u=au(n),d=[Ca,Aa].indexOf(u)>=0?-1:1,y=typeof o=="function"?o(Object.assign({},e,{placement:n})):o,v=y[0],r=y[1];return v=v||0,r=(r||0)*d,[Ca,bl].indexOf(u)>=0?{x:r,y:v}:{x:v,y:r}}function FN(n){var e=n.state,o=n.options,u=n.name,d=o.offset,y=d===void 0?[0,0]:d,v=JE.reduce(function(F,N){return F[N]=zN(N,e.rects,y),F},{}),r=v[e.placement],D=r.x,B=r.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=D,e.modifiersData.popperOffsets.y+=B),e.modifiersData[u]=v}const SD={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:FN};function BN(n){var e=n.state,o=n.name;e.modifiersData[o]=wD({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const lS={name:"popperOffsets",enabled:!0,phase:"read",fn:BN,data:{}};function NN(n){return n==="x"?"y":"x"}function VN(n){var e=n.state,o=n.options,u=n.name,d=o.mainAxis,y=d===void 0?!0:d,v=o.altAxis,r=v===void 0?!1:v,D=o.boundary,B=o.rootBoundary,F=o.altBoundary,N=o.padding,Q=o.tether,q=Q===void 0?!0:Q,X=o.tetherOffset,G=X===void 0?0:X,ae=h_(e,{boundary:D,rootBoundary:B,padding:N,altBoundary:F}),xe=au(e.placement),Te=u_(e.placement),fe=!Te,ne=iS(xe),ue=NN(ne),ye=e.modifiersData.popperOffsets,le=e.rects.reference,re=e.rects.popper,oe=typeof G=="function"?G(Object.assign({},e.rects,{placement:e.placement})):G,se=typeof oe=="number"?{mainAxis:oe,altAxis:oe}:Object.assign({mainAxis:0,altAxis:0},oe),Ae=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,De={x:0,y:0};if(ye){if(y){var Ge,yt=ne==="y"?Aa:Ca,ct=ne==="y"?xl:bl,mt=ne==="y"?"height":"width",et=ye[ne],Qe=et+ae[yt],vt=et-ae[ct],st=q?-re[mt]/2:0,Zt=Te===cp?le[mt]:re[mt],ui=Te===cp?-re[mt]:-le[mt],ni=e.elements.arrow,Hi=q&&ni?tS(ni):{width:0,height:0},Ci=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:gD(),Ii=Ci[yt],Ui=Ci[ct],xi=Vy(0,le[mt],Hi[mt]),Yi=fe?le[mt]/2-st-xi-Ii-se.mainAxis:Zt-xi-Ii-se.mainAxis,H=fe?-le[mt]/2+st+xi+Ui+se.mainAxis:ui+xi+Ui+se.mainAxis,be=e.elements.arrow&&z0(e.elements.arrow),Be=be?ne==="y"?be.clientTop||0:be.clientLeft||0:0,Ee=(Ge=Ae==null?void 0:Ae[ne])!=null?Ge:0,ve=et+Yi-Ee-Be,Ie=et+H-Ee,Tt=Vy(q?Sx(Qe,ve):Qe,et,q?Xf(vt,Ie):vt);ye[ne]=Tt,De[ne]=Tt-et}if(r){var qe,Et=ne==="x"?Aa:Ca,It=ne==="x"?xl:bl,$t=ye[ue],Kt=ue==="y"?"height":"width",ti=$t+ae[Et],Li=$t-ae[It],Ut=[Aa,Ca].indexOf(xe)!==-1,yi=(qe=Ae==null?void 0:Ae[ue])!=null?qe:0,zi=Ut?ti:$t-le[Kt]-re[Kt]-yi+se.altAxis,Ni=Ut?$t+le[Kt]+re[Kt]-yi-se.altAxis:Li,Ki=q&&Ut?gN(zi,$t,Ni):Vy(q?zi:ti,$t,q?Ni:Li);ye[ue]=Ki,De[ue]=Ki-$t}e.modifiersData[u]=De}}const AD={name:"preventOverflow",enabled:!0,phase:"main",fn:VN,requiresIfExists:["offset"]};function UN(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function jN(n){return n===wl(n)||!Jl(n)?sS(n):UN(n)}function $N(n){var e=n.getBoundingClientRect(),o=l_(e.width)/n.offsetWidth||1,u=l_(e.height)/n.offsetHeight||1;return o!==1||u!==1}function qN(n,e,o){o===void 0&&(o=!1);var u=Jl(e),d=Jl(e)&&$N(e),y=Pd(e),v=c_(n,d,o),r={scrollLeft:0,scrollTop:0},D={x:0,y:0};return(u||!u&&!o)&&((hu(e)!=="body"||aS(y))&&(r=jN(e)),Jl(e)?(D=c_(e,!0),D.x+=e.clientLeft,D.y+=e.clientTop):y&&(D.x=oS(y))),{x:v.left+r.scrollLeft-D.x,y:v.top+r.scrollTop-D.y,width:v.width,height:v.height}}function HN(n){var e=new Map,o=new Set,u=[];n.forEach(function(y){e.set(y.name,y)});function d(y){o.add(y.name);var v=[].concat(y.requires||[],y.requiresIfExists||[]);v.forEach(function(r){if(!o.has(r)){var D=e.get(r);D&&d(D)}}),u.push(y)}return n.forEach(function(y){o.has(y.name)||d(y)}),u}function GN(n){var e=HN(n);return pD.reduce(function(o,u){return o.concat(e.filter(function(d){return d.phase===u}))},[])}function WN(n){var e;return function(){return e||(e=new Promise(function(o){Promise.resolve().then(function(){e=void 0,o(n())})})),e}}function ZN(n){var e=n.reduce(function(o,u){var d=o[u.name];return o[u.name]=d?Object.assign({},d,u,{options:Object.assign({},d.options,u.options),data:Object.assign({},d.data,u.data)}):u,o},{});return Object.keys(e).map(function(o){return e[o]})}var gP={placement:"bottom",modifiers:[],strategy:"absolute"};function yP(){for(var n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return!e.some(function(u){return!(u&&typeof u.getBoundingClientRect=="function")})}function _b(n){n===void 0&&(n={});var e=n,o=e.defaultModifiers,u=o===void 0?[]:o,d=e.defaultOptions,y=d===void 0?gP:d;return function(r,D,B){B===void 0&&(B=y);var F={placement:"bottom",orderedModifiers:[],options:Object.assign({},gP,y),modifiersData:{},elements:{reference:r,popper:D},attributes:{},styles:{}},N=[],Q=!1,q={state:F,setOptions:function(xe){var Te=typeof xe=="function"?xe(F.options):xe;G(),F.options=Object.assign({},y,F.options,Te),F.scrollParents={reference:up(r)?Uy(r):r.contextElement?Uy(r.contextElement):[],popper:Uy(D)};var fe=GN(ZN([].concat(u,F.options.modifiers)));return F.orderedModifiers=fe.filter(function(ne){return ne.enabled}),X(),q.update()},forceUpdate:function(){if(!Q){var xe=F.elements,Te=xe.reference,fe=xe.popper;if(yP(Te,fe)){F.rects={reference:qN(Te,z0(fe),F.options.strategy==="fixed"),popper:tS(fe)},F.reset=!1,F.placement=F.options.placement,F.orderedModifiers.forEach(function(se){return F.modifiersData[se.name]=Object.assign({},se.data)});for(var ne=0;ne<F.orderedModifiers.length;ne++){if(F.reset===!0){F.reset=!1,ne=-1;continue}var ue=F.orderedModifiers[ne],ye=ue.fn,le=ue.options,re=le===void 0?{}:le,oe=ue.name;typeof ye=="function"&&(F=ye({state:F,options:re,name:oe,instance:q})||F)}}}},update:WN(function(){return new Promise(function(ae){q.forceUpdate(),ae(F)})}),destroy:function(){G(),Q=!0}};if(!yP(r,D))return q;q.setOptions(B).then(function(ae){!Q&&B.onFirstUpdate&&B.onFirstUpdate(ae)});function X(){F.orderedModifiers.forEach(function(ae){var xe=ae.name,Te=ae.options,fe=Te===void 0?{}:Te,ne=ae.effect;if(typeof ne=="function"){var ue=ne({state:F,name:xe,instance:q,options:fe}),ye=function(){};N.push(ue||ye)}})}function G(){N.forEach(function(ae){return ae()}),N=[]}return q}}var YN=_b(),XN=[nS,lS,rS,eS],KN=_b({defaultModifiers:XN}),JN=[nS,lS,rS,eS,SD,TD,AD,xD,ED],cS=_b({defaultModifiers:JN});const CD=Object.freeze(Object.defineProperty({__proto__:null,afterMain:uD,afterRead:aD,afterWrite:fD,applyStyles:eS,arrow:xD,auto:pb,basePlacements:P_,beforeMain:lD,beforeRead:sD,beforeWrite:hD,bottom:xl,clippingParents:rD,computeStyles:rS,createPopper:cS,createPopperBase:YN,createPopperLite:KN,detectOverflow:h_,end:a_,eventListeners:nS,flip:TD,hide:ED,left:Ca,main:cD,modifierPhases:pD,offset:SD,placements:JE,popper:km,popperGenerator:_b,popperOffsets:lS,preventOverflow:AD,read:oD,reference:nD,right:bl,start:cp,top:Aa,variationPlacements:NT,viewport:KE,write:dD},Symbol.toStringTag,{value:"Module"}));/*!
  * Bootstrap v5.3.3 (https://getbootstrap.com/)
  * Copyright 2011-2024 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */const Zh=new Map,q2={set(n,e,o){Zh.has(n)||Zh.set(n,new Map);const u=Zh.get(n);if(!u.has(e)&&u.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(u.keys())[0]}.`);return}u.set(e,o)},get(n,e){return Zh.has(n)&&Zh.get(n).get(e)||null},remove(n,e){if(!Zh.has(n))return;const o=Zh.get(n);o.delete(e),o.size===0&&Zh.delete(n)}},QN=1e6,e6=1e3,jT="transitionend",MD=n=>(n&&window.CSS&&window.CSS.escape&&(n=n.replace(/#([^\s"#']+)/g,(e,o)=>`#${CSS.escape(o)}`)),n),t6=n=>n==null?`${n}`:Object.prototype.toString.call(n).match(/\s([a-z]+)/i)[1].toLowerCase(),i6=n=>{do n+=Math.floor(Math.random()*QN);while(document.getElementById(n));return n},r6=n=>{if(!n)return 0;let{transitionDuration:e,transitionDelay:o}=window.getComputedStyle(n);const u=Number.parseFloat(e),d=Number.parseFloat(o);return!u&&!d?0:(e=e.split(",")[0],o=o.split(",")[0],(Number.parseFloat(e)+Number.parseFloat(o))*e6)},ID=n=>{n.dispatchEvent(new Event(jT))},Xu=n=>!n||typeof n!="object"?!1:(typeof n.jquery<"u"&&(n=n[0]),typeof n.nodeType<"u"),vd=n=>Xu(n)?n.jquery?n[0]:n:typeof n=="string"&&n.length>0?document.querySelector(MD(n)):null,R_=n=>{if(!Xu(n)||n.getClientRects().length===0)return!1;const e=getComputedStyle(n).getPropertyValue("visibility")==="visible",o=n.closest("details:not([open])");if(!o)return e;if(o!==n){const u=n.closest("summary");if(u&&u.parentNode!==o||u===null)return!1}return e},xd=n=>!n||n.nodeType!==Node.ELEMENT_NODE||n.classList.contains("disabled")?!0:typeof n.disabled<"u"?n.disabled:n.hasAttribute("disabled")&&n.getAttribute("disabled")!=="false",PD=n=>{if(!document.documentElement.attachShadow)return null;if(typeof n.getRootNode=="function"){const e=n.getRootNode();return e instanceof ShadowRoot?e:null}return n instanceof ShadowRoot?n:n.parentNode?PD(n.parentNode):null},Ax=()=>{},F0=n=>{n.offsetHeight},RD=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,H2=[],n6=n=>{document.readyState==="loading"?(H2.length||document.addEventListener("DOMContentLoaded",()=>{for(const e of H2)e()}),H2.push(n)):n()},tc=()=>document.documentElement.dir==="rtl",nc=n=>{n6(()=>{const e=RD();if(e){const o=n.NAME,u=e.fn[o];e.fn[o]=n.jQueryInterface,e.fn[o].Constructor=n,e.fn[o].noConflict=()=>(e.fn[o]=u,n.jQueryInterface)}})},Na=(n,e=[],o=n)=>typeof n=="function"?n(...e):o,DD=(n,e,o=!0)=>{if(!o){Na(n);return}const u=5,d=r6(e)+u;let y=!1;const v=({target:r})=>{r===e&&(y=!0,e.removeEventListener(jT,v),Na(n))};e.addEventListener(jT,v),setTimeout(()=>{y||ID(e)},d)},uS=(n,e,o,u)=>{const d=n.length;let y=n.indexOf(e);return y===-1?!o&&u?n[d-1]:n[0]:(y+=o?1:-1,u&&(y=(y+d)%d),n[Math.max(0,Math.min(y,d-1))])},s6=/[^.]*(?=\..*)\.|.*/,o6=/\..*/,a6=/::\d+$/,G2={};let vP=1;const OD={mouseenter:"mouseover",mouseleave:"mouseout"},l6=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function LD(n,e){return e&&`${e}::${vP++}`||n.uidEvent||vP++}function kD(n){const e=LD(n);return n.uidEvent=e,G2[e]=G2[e]||{},G2[e]}function c6(n,e){return function o(u){return hS(u,{delegateTarget:n}),o.oneOff&&vi.off(n,u.type,e),e.apply(n,[u])}}function u6(n,e,o){return function u(d){const y=n.querySelectorAll(e);for(let{target:v}=d;v&&v!==this;v=v.parentNode)for(const r of y)if(r===v)return hS(d,{delegateTarget:v}),u.oneOff&&vi.off(n,d.type,e,o),o.apply(v,[d])}}function zD(n,e,o=null){return Object.values(n).find(u=>u.callable===e&&u.delegationSelector===o)}function FD(n,e,o){const u=typeof e=="string",d=u?o:e||o;let y=BD(n);return l6.has(y)||(y=n),[u,d,y]}function xP(n,e,o,u,d){if(typeof e!="string"||!n)return;let[y,v,r]=FD(e,o,u);e in OD&&(v=(X=>function(G){if(!G.relatedTarget||G.relatedTarget!==G.delegateTarget&&!G.delegateTarget.contains(G.relatedTarget))return X.call(this,G)})(v));const D=kD(n),B=D[r]||(D[r]={}),F=zD(B,v,y?o:null);if(F){F.oneOff=F.oneOff&&d;return}const N=LD(v,e.replace(s6,"")),Q=y?u6(n,o,v):c6(n,v);Q.delegationSelector=y?o:null,Q.callable=v,Q.oneOff=d,Q.uidEvent=N,B[N]=Q,n.addEventListener(r,Q,y)}function $T(n,e,o,u,d){const y=zD(e[o],u,d);y&&(n.removeEventListener(o,y,!!d),delete e[o][y.uidEvent])}function h6(n,e,o,u){const d=e[o]||{};for(const[y,v]of Object.entries(d))y.includes(u)&&$T(n,e,o,v.callable,v.delegationSelector)}function BD(n){return n=n.replace(o6,""),OD[n]||n}const vi={on(n,e,o,u){xP(n,e,o,u,!1)},one(n,e,o,u){xP(n,e,o,u,!0)},off(n,e,o,u){if(typeof e!="string"||!n)return;const[d,y,v]=FD(e,o,u),r=v!==e,D=kD(n),B=D[v]||{},F=e.startsWith(".");if(typeof y<"u"){if(!Object.keys(B).length)return;$T(n,D,v,y,d?o:null);return}if(F)for(const N of Object.keys(D))h6(n,D,N,e.slice(1));for(const[N,Q]of Object.entries(B)){const q=N.replace(a6,"");(!r||e.includes(q))&&$T(n,D,v,Q.callable,Q.delegationSelector)}},trigger(n,e,o){if(typeof e!="string"||!n)return null;const u=RD(),d=BD(e),y=e!==d;let v=null,r=!0,D=!0,B=!1;y&&u&&(v=u.Event(e,o),u(n).trigger(v),r=!v.isPropagationStopped(),D=!v.isImmediatePropagationStopped(),B=v.isDefaultPrevented());const F=hS(new Event(e,{bubbles:r,cancelable:!0}),o);return B&&F.preventDefault(),D&&n.dispatchEvent(F),F.defaultPrevented&&v&&v.preventDefault(),F}};function hS(n,e={}){for(const[o,u]of Object.entries(e))try{n[o]=u}catch{Object.defineProperty(n,o,{configurable:!0,get(){return u}})}return n}function bP(n){if(n==="true")return!0;if(n==="false")return!1;if(n===Number(n).toString())return Number(n);if(n===""||n==="null")return null;if(typeof n!="string")return n;try{return JSON.parse(decodeURIComponent(n))}catch{return n}}function W2(n){return n.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}const Ku={setDataAttribute(n,e,o){n.setAttribute(`data-bs-${W2(e)}`,o)},removeDataAttribute(n,e){n.removeAttribute(`data-bs-${W2(e)}`)},getDataAttributes(n){if(!n)return{};const e={},o=Object.keys(n.dataset).filter(u=>u.startsWith("bs")&&!u.startsWith("bsConfig"));for(const u of o){let d=u.replace(/^bs/,"");d=d.charAt(0).toLowerCase()+d.slice(1,d.length),e[d]=bP(n.dataset[u])}return e},getDataAttribute(n,e){return bP(n.getAttribute(`data-bs-${W2(e)}`))}};class B0{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(e){return e=this._mergeConfigObj(e),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}_configAfterMerge(e){return e}_mergeConfigObj(e,o){const u=Xu(o)?Ku.getDataAttribute(o,"config"):{};return{...this.constructor.Default,...typeof u=="object"?u:{},...Xu(o)?Ku.getDataAttributes(o):{},...typeof e=="object"?e:{}}}_typeCheckConfig(e,o=this.constructor.DefaultType){for(const[u,d]of Object.entries(o)){const y=e[u],v=Xu(y)?"element":t6(y);if(!new RegExp(d).test(v))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${u}" provided type "${v}" but expected type "${d}".`)}}}const d6="5.3.3";class Ic extends B0{constructor(e,o){super(),e=vd(e),e&&(this._element=e,this._config=this._getConfig(o),q2.set(this._element,this.constructor.DATA_KEY,this))}dispose(){q2.remove(this._element,this.constructor.DATA_KEY),vi.off(this._element,this.constructor.EVENT_KEY);for(const e of Object.getOwnPropertyNames(this))this[e]=null}_queueCallback(e,o,u=!0){DD(e,o,u)}_getConfig(e){return e=this._mergeConfigObj(e,this._element),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}static getInstance(e){return q2.get(vd(e),this.DATA_KEY)}static getOrCreateInstance(e,o={}){return this.getInstance(e)||new this(e,typeof o=="object"?o:null)}static get VERSION(){return d6}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(e){return`${e}${this.EVENT_KEY}`}}const Z2=n=>{let e=n.getAttribute("data-bs-target");if(!e||e==="#"){let o=n.getAttribute("href");if(!o||!o.includes("#")&&!o.startsWith("."))return null;o.includes("#")&&!o.startsWith("#")&&(o=`#${o.split("#")[1]}`),e=o&&o!=="#"?o.trim():null}return e?e.split(",").map(o=>MD(o)).join(","):null},Ir={find(n,e=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(e,n))},findOne(n,e=document.documentElement){return Element.prototype.querySelector.call(e,n)},children(n,e){return[].concat(...n.children).filter(o=>o.matches(e))},parents(n,e){const o=[];let u=n.parentNode.closest(e);for(;u;)o.push(u),u=u.parentNode.closest(e);return o},prev(n,e){let o=n.previousElementSibling;for(;o;){if(o.matches(e))return[o];o=o.previousElementSibling}return[]},next(n,e){let o=n.nextElementSibling;for(;o;){if(o.matches(e))return[o];o=o.nextElementSibling}return[]},focusableChildren(n){const e=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(o=>`${o}:not([tabindex^="-"])`).join(",");return this.find(e,n).filter(o=>!xd(o)&&R_(o))},getSelectorFromElement(n){const e=Z2(n);return e&&Ir.findOne(e)?e:null},getElementFromSelector(n){const e=Z2(n);return e?Ir.findOne(e):null},getMultipleElementsFromSelector(n){const e=Z2(n);return e?Ir.find(e):[]}},gb=(n,e="hide")=>{const o=`click.dismiss${n.EVENT_KEY}`,u=n.NAME;vi.on(document,o,`[data-bs-dismiss="${u}"]`,function(d){if(["A","AREA"].includes(this.tagName)&&d.preventDefault(),xd(this))return;const y=Ir.getElementFromSelector(this)||this.closest(`.${u}`);n.getOrCreateInstance(y)[e]()})},f6="alert",p6="bs.alert",ND=`.${p6}`,m6=`close${ND}`,_6=`closed${ND}`,g6="fade",y6="show";class yb extends Ic{static get NAME(){return f6}close(){if(vi.trigger(this._element,m6).defaultPrevented)return;this._element.classList.remove(y6);const o=this._element.classList.contains(g6);this._queueCallback(()=>this._destroyElement(),this._element,o)}_destroyElement(){this._element.remove(),vi.trigger(this._element,_6),this.dispose()}static jQueryInterface(e){return this.each(function(){const o=yb.getOrCreateInstance(this);if(typeof e=="string"){if(o[e]===void 0||e.startsWith("_")||e==="constructor")throw new TypeError(`No method named "${e}"`);o[e](this)}})}}gb(yb,"close");nc(yb);const v6="button",x6="bs.button",b6=`.${x6}`,w6=".data-api",T6="active",wP='[data-bs-toggle="button"]',E6=`click${b6}${w6}`;class vb extends Ic{static get NAME(){return v6}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle(T6))}static jQueryInterface(e){return this.each(function(){const o=vb.getOrCreateInstance(this);e==="toggle"&&o[e]()})}}vi.on(document,E6,wP,n=>{n.preventDefault();const e=n.target.closest(wP);vb.getOrCreateInstance(e).toggle()});nc(vb);const S6="swipe",D_=".bs.swipe",A6=`touchstart${D_}`,C6=`touchmove${D_}`,M6=`touchend${D_}`,I6=`pointerdown${D_}`,P6=`pointerup${D_}`,R6="touch",D6="pen",O6="pointer-event",L6=40,k6={endCallback:null,leftCallback:null,rightCallback:null},z6={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class Cx extends B0{constructor(e,o){super(),this._element=e,!(!e||!Cx.isSupported())&&(this._config=this._getConfig(o),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return k6}static get DefaultType(){return z6}static get NAME(){return S6}dispose(){vi.off(this._element,D_)}_start(e){if(!this._supportPointerEvents){this._deltaX=e.touches[0].clientX;return}this._eventIsPointerPenTouch(e)&&(this._deltaX=e.clientX)}_end(e){this._eventIsPointerPenTouch(e)&&(this._deltaX=e.clientX-this._deltaX),this._handleSwipe(),Na(this._config.endCallback)}_move(e){this._deltaX=e.touches&&e.touches.length>1?0:e.touches[0].clientX-this._deltaX}_handleSwipe(){const e=Math.abs(this._deltaX);if(e<=L6)return;const o=e/this._deltaX;this._deltaX=0,o&&Na(o>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(vi.on(this._element,I6,e=>this._start(e)),vi.on(this._element,P6,e=>this._end(e)),this._element.classList.add(O6)):(vi.on(this._element,A6,e=>this._start(e)),vi.on(this._element,C6,e=>this._move(e)),vi.on(this._element,M6,e=>this._end(e)))}_eventIsPointerPenTouch(e){return this._supportPointerEvents&&(e.pointerType===D6||e.pointerType===R6)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const F6="carousel",B6="bs.carousel",Rd=`.${B6}`,VD=".data-api",N6="ArrowLeft",V6="ArrowRight",U6=500,xy="next",Cm="prev",zm="left",ex="right",j6=`slide${Rd}`,Y2=`slid${Rd}`,$6=`keydown${Rd}`,q6=`mouseenter${Rd}`,H6=`mouseleave${Rd}`,G6=`dragstart${Rd}`,W6=`load${Rd}${VD}`,Z6=`click${Rd}${VD}`,UD="carousel",xv="active",Y6="slide",X6="carousel-item-end",K6="carousel-item-start",J6="carousel-item-next",Q6="carousel-item-prev",jD=".active",$D=".carousel-item",eV=jD+$D,tV=".carousel-item img",iV=".carousel-indicators",rV="[data-bs-slide], [data-bs-slide-to]",nV='[data-bs-ride="carousel"]',sV={[N6]:ex,[V6]:zm},oV={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},aV={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class N0 extends Ic{constructor(e,o){super(e,o),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=Ir.findOne(iV,this._element),this._addEventListeners(),this._config.ride===UD&&this.cycle()}static get Default(){return oV}static get DefaultType(){return aV}static get NAME(){return F6}next(){this._slide(xy)}nextWhenVisible(){!document.hidden&&R_(this._element)&&this.next()}prev(){this._slide(Cm)}pause(){this._isSliding&&ID(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){if(this._config.ride){if(this._isSliding){vi.one(this._element,Y2,()=>this.cycle());return}this.cycle()}}to(e){const o=this._getItems();if(e>o.length-1||e<0)return;if(this._isSliding){vi.one(this._element,Y2,()=>this.to(e));return}const u=this._getItemIndex(this._getActive());if(u===e)return;const d=e>u?xy:Cm;this._slide(d,o[e])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(e){return e.defaultInterval=e.interval,e}_addEventListeners(){this._config.keyboard&&vi.on(this._element,$6,e=>this._keydown(e)),this._config.pause==="hover"&&(vi.on(this._element,q6,()=>this.pause()),vi.on(this._element,H6,()=>this._maybeEnableCycle())),this._config.touch&&Cx.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const u of Ir.find(tV,this._element))vi.on(u,G6,d=>d.preventDefault());const o={leftCallback:()=>this._slide(this._directionToOrder(zm)),rightCallback:()=>this._slide(this._directionToOrder(ex)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),U6+this._config.interval))}};this._swipeHelper=new Cx(this._element,o)}_keydown(e){if(/input|textarea/i.test(e.target.tagName))return;const o=sV[e.key];o&&(e.preventDefault(),this._slide(this._directionToOrder(o)))}_getItemIndex(e){return this._getItems().indexOf(e)}_setActiveIndicatorElement(e){if(!this._indicatorsElement)return;const o=Ir.findOne(jD,this._indicatorsElement);o.classList.remove(xv),o.removeAttribute("aria-current");const u=Ir.findOne(`[data-bs-slide-to="${e}"]`,this._indicatorsElement);u&&(u.classList.add(xv),u.setAttribute("aria-current","true"))}_updateInterval(){const e=this._activeElement||this._getActive();if(!e)return;const o=Number.parseInt(e.getAttribute("data-bs-interval"),10);this._config.interval=o||this._config.defaultInterval}_slide(e,o=null){if(this._isSliding)return;const u=this._getActive(),d=e===xy,y=o||uS(this._getItems(),u,d,this._config.wrap);if(y===u)return;const v=this._getItemIndex(y),r=q=>vi.trigger(this._element,q,{relatedTarget:y,direction:this._orderToDirection(e),from:this._getItemIndex(u),to:v});if(r(j6).defaultPrevented||!u||!y)return;const B=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(v),this._activeElement=y;const F=d?K6:X6,N=d?J6:Q6;y.classList.add(N),F0(y),u.classList.add(F),y.classList.add(F);const Q=()=>{y.classList.remove(F,N),y.classList.add(xv),u.classList.remove(xv,N,F),this._isSliding=!1,r(Y2)};this._queueCallback(Q,u,this._isAnimated()),B&&this.cycle()}_isAnimated(){return this._element.classList.contains(Y6)}_getActive(){return Ir.findOne(eV,this._element)}_getItems(){return Ir.find($D,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(e){return tc()?e===zm?Cm:xy:e===zm?xy:Cm}_orderToDirection(e){return tc()?e===Cm?zm:ex:e===Cm?ex:zm}static jQueryInterface(e){return this.each(function(){const o=N0.getOrCreateInstance(this,e);if(typeof e=="number"){o.to(e);return}if(typeof e=="string"){if(o[e]===void 0||e.startsWith("_")||e==="constructor")throw new TypeError(`No method named "${e}"`);o[e]()}})}}vi.on(document,Z6,rV,function(n){const e=Ir.getElementFromSelector(this);if(!e||!e.classList.contains(UD))return;n.preventDefault();const o=N0.getOrCreateInstance(e),u=this.getAttribute("data-bs-slide-to");if(u){o.to(u),o._maybeEnableCycle();return}if(Ku.getDataAttribute(this,"slide")==="next"){o.next(),o._maybeEnableCycle();return}o.prev(),o._maybeEnableCycle()});vi.on(window,W6,()=>{const n=Ir.find(nV);for(const e of n)N0.getOrCreateInstance(e)});nc(N0);const lV="collapse",cV="bs.collapse",V0=`.${cV}`,uV=".data-api",hV=`show${V0}`,dV=`shown${V0}`,fV=`hide${V0}`,pV=`hidden${V0}`,mV=`click${V0}${uV}`,X2="show",jm="collapse",bv="collapsing",_V="collapsed",gV=`:scope .${jm} .${jm}`,yV="collapse-horizontal",vV="width",xV="height",bV=".collapse.show, .collapse.collapsing",qT='[data-bs-toggle="collapse"]',wV={parent:null,toggle:!0},TV={parent:"(null|element)",toggle:"boolean"};class c0 extends Ic{constructor(e,o){super(e,o),this._isTransitioning=!1,this._triggerArray=[];const u=Ir.find(qT);for(const d of u){const y=Ir.getSelectorFromElement(d),v=Ir.find(y).filter(r=>r===this._element);y!==null&&v.length&&this._triggerArray.push(d)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return wV}static get DefaultType(){return TV}static get NAME(){return lV}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let e=[];if(this._config.parent&&(e=this._getFirstLevelChildren(bV).filter(r=>r!==this._element).map(r=>c0.getOrCreateInstance(r,{toggle:!1}))),e.length&&e[0]._isTransitioning||vi.trigger(this._element,hV).defaultPrevented)return;for(const r of e)r.hide();const u=this._getDimension();this._element.classList.remove(jm),this._element.classList.add(bv),this._element.style[u]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const d=()=>{this._isTransitioning=!1,this._element.classList.remove(bv),this._element.classList.add(jm,X2),this._element.style[u]="",vi.trigger(this._element,dV)},v=`scroll${u[0].toUpperCase()+u.slice(1)}`;this._queueCallback(d,this._element,!0),this._element.style[u]=`${this._element[v]}px`}hide(){if(this._isTransitioning||!this._isShown()||vi.trigger(this._element,fV).defaultPrevented)return;const o=this._getDimension();this._element.style[o]=`${this._element.getBoundingClientRect()[o]}px`,F0(this._element),this._element.classList.add(bv),this._element.classList.remove(jm,X2);for(const d of this._triggerArray){const y=Ir.getElementFromSelector(d);y&&!this._isShown(y)&&this._addAriaAndCollapsedClass([d],!1)}this._isTransitioning=!0;const u=()=>{this._isTransitioning=!1,this._element.classList.remove(bv),this._element.classList.add(jm),vi.trigger(this._element,pV)};this._element.style[o]="",this._queueCallback(u,this._element,!0)}_isShown(e=this._element){return e.classList.contains(X2)}_configAfterMerge(e){return e.toggle=!!e.toggle,e.parent=vd(e.parent),e}_getDimension(){return this._element.classList.contains(yV)?vV:xV}_initializeChildren(){if(!this._config.parent)return;const e=this._getFirstLevelChildren(qT);for(const o of e){const u=Ir.getElementFromSelector(o);u&&this._addAriaAndCollapsedClass([o],this._isShown(u))}}_getFirstLevelChildren(e){const o=Ir.find(gV,this._config.parent);return Ir.find(e,this._config.parent).filter(u=>!o.includes(u))}_addAriaAndCollapsedClass(e,o){if(e.length)for(const u of e)u.classList.toggle(_V,!o),u.setAttribute("aria-expanded",o)}static jQueryInterface(e){const o={};return typeof e=="string"&&/show|hide/.test(e)&&(o.toggle=!1),this.each(function(){const u=c0.getOrCreateInstance(this,o);if(typeof e=="string"){if(typeof u[e]>"u")throw new TypeError(`No method named "${e}"`);u[e]()}})}}vi.on(document,mV,qT,function(n){(n.target.tagName==="A"||n.delegateTarget&&n.delegateTarget.tagName==="A")&&n.preventDefault();for(const e of Ir.getMultipleElementsFromSelector(this))c0.getOrCreateInstance(e,{toggle:!1}).toggle()});nc(c0);const TP="dropdown",EV="bs.dropdown",xp=`.${EV}`,dS=".data-api",SV="Escape",EP="Tab",AV="ArrowUp",SP="ArrowDown",CV=2,MV=`hide${xp}`,IV=`hidden${xp}`,PV=`show${xp}`,RV=`shown${xp}`,qD=`click${xp}${dS}`,HD=`keydown${xp}${dS}`,DV=`keyup${xp}${dS}`,Fm="show",OV="dropup",LV="dropend",kV="dropstart",zV="dropup-center",FV="dropdown-center",$f='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',BV=`${$f}.${Fm}`,tx=".dropdown-menu",NV=".navbar",VV=".navbar-nav",UV=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",jV=tc()?"top-end":"top-start",$V=tc()?"top-start":"top-end",qV=tc()?"bottom-end":"bottom-start",HV=tc()?"bottom-start":"bottom-end",GV=tc()?"left-start":"right-start",WV=tc()?"right-start":"left-start",ZV="top",YV="bottom",XV={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},KV={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class lu extends Ic{constructor(e,o){super(e,o),this._popper=null,this._parent=this._element.parentNode,this._menu=Ir.next(this._element,tx)[0]||Ir.prev(this._element,tx)[0]||Ir.findOne(tx,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return XV}static get DefaultType(){return KV}static get NAME(){return TP}toggle(){return this._isShown()?this.hide():this.show()}show(){if(xd(this._element)||this._isShown())return;const e={relatedTarget:this._element};if(!vi.trigger(this._element,PV,e).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(VV))for(const u of[].concat(...document.body.children))vi.on(u,"mouseover",Ax);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Fm),this._element.classList.add(Fm),vi.trigger(this._element,RV,e)}}hide(){if(xd(this._element)||!this._isShown())return;const e={relatedTarget:this._element};this._completeHide(e)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(e){if(!vi.trigger(this._element,MV,e).defaultPrevented){if("ontouchstart"in document.documentElement)for(const u of[].concat(...document.body.children))vi.off(u,"mouseover",Ax);this._popper&&this._popper.destroy(),this._menu.classList.remove(Fm),this._element.classList.remove(Fm),this._element.setAttribute("aria-expanded","false"),Ku.removeDataAttribute(this._menu,"popper"),vi.trigger(this._element,IV,e)}}_getConfig(e){if(e=super._getConfig(e),typeof e.reference=="object"&&!Xu(e.reference)&&typeof e.reference.getBoundingClientRect!="function")throw new TypeError(`${TP.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return e}_createPopper(){if(typeof CD>"u")throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let e=this._element;this._config.reference==="parent"?e=this._parent:Xu(this._config.reference)?e=vd(this._config.reference):typeof this._config.reference=="object"&&(e=this._config.reference);const o=this._getPopperConfig();this._popper=cS(e,this._menu,o)}_isShown(){return this._menu.classList.contains(Fm)}_getPlacement(){const e=this._parent;if(e.classList.contains(LV))return GV;if(e.classList.contains(kV))return WV;if(e.classList.contains(zV))return ZV;if(e.classList.contains(FV))return YV;const o=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return e.classList.contains(OV)?o?$V:jV:o?HV:qV}_detectNavbar(){return this._element.closest(NV)!==null}_getOffset(){const{offset:e}=this._config;return typeof e=="string"?e.split(",").map(o=>Number.parseInt(o,10)):typeof e=="function"?o=>e(o,this._element):e}_getPopperConfig(){const e={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(Ku.setDataAttribute(this._menu,"popper","static"),e.modifiers=[{name:"applyStyles",enabled:!1}]),{...e,...Na(this._config.popperConfig,[e])}}_selectMenuItem({key:e,target:o}){const u=Ir.find(UV,this._menu).filter(d=>R_(d));u.length&&uS(u,o,e===SP,!u.includes(o)).focus()}static jQueryInterface(e){return this.each(function(){const o=lu.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof o[e]>"u")throw new TypeError(`No method named "${e}"`);o[e]()}})}static clearMenus(e){if(e.button===CV||e.type==="keyup"&&e.key!==EP)return;const o=Ir.find(BV);for(const u of o){const d=lu.getInstance(u);if(!d||d._config.autoClose===!1)continue;const y=e.composedPath(),v=y.includes(d._menu);if(y.includes(d._element)||d._config.autoClose==="inside"&&!v||d._config.autoClose==="outside"&&v||d._menu.contains(e.target)&&(e.type==="keyup"&&e.key===EP||/input|select|option|textarea|form/i.test(e.target.tagName)))continue;const r={relatedTarget:d._element};e.type==="click"&&(r.clickEvent=e),d._completeHide(r)}}static dataApiKeydownHandler(e){const o=/input|textarea/i.test(e.target.tagName),u=e.key===SV,d=[AV,SP].includes(e.key);if(!d&&!u||o&&!u)return;e.preventDefault();const y=this.matches($f)?this:Ir.prev(this,$f)[0]||Ir.next(this,$f)[0]||Ir.findOne($f,e.delegateTarget.parentNode),v=lu.getOrCreateInstance(y);if(d){e.stopPropagation(),v.show(),v._selectMenuItem(e);return}v._isShown()&&(e.stopPropagation(),v.hide(),y.focus())}}vi.on(document,HD,$f,lu.dataApiKeydownHandler);vi.on(document,HD,tx,lu.dataApiKeydownHandler);vi.on(document,qD,lu.clearMenus);vi.on(document,DV,lu.clearMenus);vi.on(document,qD,$f,function(n){n.preventDefault(),lu.getOrCreateInstance(this).toggle()});nc(lu);const GD="backdrop",JV="fade",AP="show",CP=`mousedown.bs.${GD}`,QV={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},eU={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class WD extends B0{constructor(e){super(),this._config=this._getConfig(e),this._isAppended=!1,this._element=null}static get Default(){return QV}static get DefaultType(){return eU}static get NAME(){return GD}show(e){if(!this._config.isVisible){Na(e);return}this._append();const o=this._getElement();this._config.isAnimated&&F0(o),o.classList.add(AP),this._emulateAnimation(()=>{Na(e)})}hide(e){if(!this._config.isVisible){Na(e);return}this._getElement().classList.remove(AP),this._emulateAnimation(()=>{this.dispose(),Na(e)})}dispose(){this._isAppended&&(vi.off(this._element,CP),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const e=document.createElement("div");e.className=this._config.className,this._config.isAnimated&&e.classList.add(JV),this._element=e}return this._element}_configAfterMerge(e){return e.rootElement=vd(e.rootElement),e}_append(){if(this._isAppended)return;const e=this._getElement();this._config.rootElement.append(e),vi.on(e,CP,()=>{Na(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(e){DD(e,this._getElement(),this._config.isAnimated)}}const tU="focustrap",iU="bs.focustrap",Mx=`.${iU}`,rU=`focusin${Mx}`,nU=`keydown.tab${Mx}`,sU="Tab",oU="forward",MP="backward",aU={autofocus:!0,trapElement:null},lU={autofocus:"boolean",trapElement:"element"};class ZD extends B0{constructor(e){super(),this._config=this._getConfig(e),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return aU}static get DefaultType(){return lU}static get NAME(){return tU}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),vi.off(document,Mx),vi.on(document,rU,e=>this._handleFocusin(e)),vi.on(document,nU,e=>this._handleKeydown(e)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,vi.off(document,Mx))}_handleFocusin(e){const{trapElement:o}=this._config;if(e.target===document||e.target===o||o.contains(e.target))return;const u=Ir.focusableChildren(o);u.length===0?o.focus():this._lastTabNavDirection===MP?u[u.length-1].focus():u[0].focus()}_handleKeydown(e){e.key===sU&&(this._lastTabNavDirection=e.shiftKey?MP:oU)}}const IP=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",PP=".sticky-top",wv="padding-right",RP="margin-right";class HT{constructor(){this._element=document.body}getWidth(){const e=document.documentElement.clientWidth;return Math.abs(window.innerWidth-e)}hide(){const e=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,wv,o=>o+e),this._setElementAttributes(IP,wv,o=>o+e),this._setElementAttributes(PP,RP,o=>o-e)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,wv),this._resetElementAttributes(IP,wv),this._resetElementAttributes(PP,RP)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(e,o,u){const d=this.getWidth(),y=v=>{if(v!==this._element&&window.innerWidth>v.clientWidth+d)return;this._saveInitialAttribute(v,o);const r=window.getComputedStyle(v).getPropertyValue(o);v.style.setProperty(o,`${u(Number.parseFloat(r))}px`)};this._applyManipulationCallback(e,y)}_saveInitialAttribute(e,o){const u=e.style.getPropertyValue(o);u&&Ku.setDataAttribute(e,o,u)}_resetElementAttributes(e,o){const u=d=>{const y=Ku.getDataAttribute(d,o);if(y===null){d.style.removeProperty(o);return}Ku.removeDataAttribute(d,o),d.style.setProperty(o,y)};this._applyManipulationCallback(e,u)}_applyManipulationCallback(e,o){if(Xu(e)){o(e);return}for(const u of Ir.find(e,this._element))o(u)}}const cU="modal",uU="bs.modal",ic=`.${uU}`,hU=".data-api",dU="Escape",fU=`hide${ic}`,pU=`hidePrevented${ic}`,YD=`hidden${ic}`,XD=`show${ic}`,mU=`shown${ic}`,_U=`resize${ic}`,gU=`click.dismiss${ic}`,yU=`mousedown.dismiss${ic}`,vU=`keydown.dismiss${ic}`,xU=`click${ic}${hU}`,DP="modal-open",bU="fade",OP="show",K2="modal-static",wU=".modal.show",TU=".modal-dialog",EU=".modal-body",SU='[data-bs-toggle="modal"]',AU={backdrop:!0,focus:!0,keyboard:!0},CU={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class ds extends Ic{constructor(e,o){super(e,o),this._dialog=Ir.findOne(TU,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new HT,this._addEventListeners()}static get Default(){return AU}static get DefaultType(){return CU}static get NAME(){return cU}toggle(e){return this._isShown?this.hide():this.show(e)}show(e){this._isShown||this._isTransitioning||vi.trigger(this._element,XD,{relatedTarget:e}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(DP),this._adjustDialog(),this._backdrop.show(()=>this._showElement(e)))}hide(){!this._isShown||this._isTransitioning||vi.trigger(this._element,fU).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(OP),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated()))}dispose(){vi.off(window,ic),vi.off(this._dialog,ic),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new WD({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new ZD({trapElement:this._element})}_showElement(e){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const o=Ir.findOne(EU,this._dialog);o&&(o.scrollTop=0),F0(this._element),this._element.classList.add(OP);const u=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,vi.trigger(this._element,mU,{relatedTarget:e})};this._queueCallback(u,this._dialog,this._isAnimated())}_addEventListeners(){vi.on(this._element,vU,e=>{if(e.key===dU){if(this._config.keyboard){this.hide();return}this._triggerBackdropTransition()}}),vi.on(window,_U,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),vi.on(this._element,yU,e=>{vi.one(this._element,gU,o=>{if(!(this._element!==e.target||this._element!==o.target)){if(this._config.backdrop==="static"){this._triggerBackdropTransition();return}this._config.backdrop&&this.hide()}})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(DP),this._resetAdjustments(),this._scrollBar.reset(),vi.trigger(this._element,YD)})}_isAnimated(){return this._element.classList.contains(bU)}_triggerBackdropTransition(){if(vi.trigger(this._element,pU).defaultPrevented)return;const o=this._element.scrollHeight>document.documentElement.clientHeight,u=this._element.style.overflowY;u==="hidden"||this._element.classList.contains(K2)||(o||(this._element.style.overflowY="hidden"),this._element.classList.add(K2),this._queueCallback(()=>{this._element.classList.remove(K2),this._queueCallback(()=>{this._element.style.overflowY=u},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const e=this._element.scrollHeight>document.documentElement.clientHeight,o=this._scrollBar.getWidth(),u=o>0;if(u&&!e){const d=tc()?"paddingLeft":"paddingRight";this._element.style[d]=`${o}px`}if(!u&&e){const d=tc()?"paddingRight":"paddingLeft";this._element.style[d]=`${o}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(e,o){return this.each(function(){const u=ds.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof u[e]>"u")throw new TypeError(`No method named "${e}"`);u[e](o)}})}}vi.on(document,xU,SU,function(n){const e=Ir.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&n.preventDefault(),vi.one(e,XD,d=>{d.defaultPrevented||vi.one(e,YD,()=>{R_(this)&&this.focus()})});const o=Ir.findOne(wU);o&&ds.getInstance(o).hide(),ds.getOrCreateInstance(e).toggle(this)});gb(ds);nc(ds);const MU="offcanvas",IU="bs.offcanvas",oh=`.${IU}`,KD=".data-api",PU=`load${oh}${KD}`,RU="Escape",LP="show",kP="showing",zP="hiding",DU="offcanvas-backdrop",JD=".offcanvas.show",OU=`show${oh}`,LU=`shown${oh}`,kU=`hide${oh}`,FP=`hidePrevented${oh}`,QD=`hidden${oh}`,zU=`resize${oh}`,FU=`click${oh}${KD}`,BU=`keydown.dismiss${oh}`,NU='[data-bs-toggle="offcanvas"]',VU={backdrop:!0,keyboard:!0,scroll:!1},UU={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class bd extends Ic{constructor(e,o){super(e,o),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return VU}static get DefaultType(){return UU}static get NAME(){return MU}toggle(e){return this._isShown?this.hide():this.show(e)}show(e){if(this._isShown||vi.trigger(this._element,OU,{relatedTarget:e}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||new HT().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(kP);const u=()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add(LP),this._element.classList.remove(kP),vi.trigger(this._element,LU,{relatedTarget:e})};this._queueCallback(u,this._element,!0)}hide(){if(!this._isShown||vi.trigger(this._element,kU).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(zP),this._backdrop.hide();const o=()=>{this._element.classList.remove(LP,zP),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new HT().reset(),vi.trigger(this._element,QD)};this._queueCallback(o,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const e=()=>{if(this._config.backdrop==="static"){vi.trigger(this._element,FP);return}this.hide()},o=!!this._config.backdrop;return new WD({className:DU,isVisible:o,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:o?e:null})}_initializeFocusTrap(){return new ZD({trapElement:this._element})}_addEventListeners(){vi.on(this._element,BU,e=>{if(e.key===RU){if(this._config.keyboard){this.hide();return}vi.trigger(this._element,FP)}})}static jQueryInterface(e){return this.each(function(){const o=bd.getOrCreateInstance(this,e);if(typeof e=="string"){if(o[e]===void 0||e.startsWith("_")||e==="constructor")throw new TypeError(`No method named "${e}"`);o[e](this)}})}}vi.on(document,FU,NU,function(n){const e=Ir.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&n.preventDefault(),xd(this))return;vi.one(e,QD,()=>{R_(this)&&this.focus()});const o=Ir.findOne(JD);o&&o!==e&&bd.getInstance(o).hide(),bd.getOrCreateInstance(e).toggle(this)});vi.on(window,PU,()=>{for(const n of Ir.find(JD))bd.getOrCreateInstance(n).show()});vi.on(window,zU,()=>{for(const n of Ir.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(n).position!=="fixed"&&bd.getOrCreateInstance(n).hide()});gb(bd);nc(bd);const jU=/^aria-[\w-]*$/i,eO={"*":["class","dir","id","lang","role",jU],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},$U=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),qU=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,HU=(n,e)=>{const o=n.nodeName.toLowerCase();return e.includes(o)?$U.has(o)?!!qU.test(n.nodeValue):!0:e.filter(u=>u instanceof RegExp).some(u=>u.test(o))};function GU(n,e,o){if(!n.length)return n;if(o&&typeof o=="function")return o(n);const d=new window.DOMParser().parseFromString(n,"text/html"),y=[].concat(...d.body.querySelectorAll("*"));for(const v of y){const r=v.nodeName.toLowerCase();if(!Object.keys(e).includes(r)){v.remove();continue}const D=[].concat(...v.attributes),B=[].concat(e["*"]||[],e[r]||[]);for(const F of D)HU(F,B)||v.removeAttribute(F.nodeName)}return d.body.innerHTML}const WU="TemplateFactory",ZU={allowList:eO,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},YU={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},XU={entry:"(string|element|function|null)",selector:"(string|element)"};class KU extends B0{constructor(e){super(),this._config=this._getConfig(e)}static get Default(){return ZU}static get DefaultType(){return YU}static get NAME(){return WU}getContent(){return Object.values(this._config.content).map(e=>this._resolvePossibleFunction(e)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(e){return this._checkContent(e),this._config.content={...this._config.content,...e},this}toHtml(){const e=document.createElement("div");e.innerHTML=this._maybeSanitize(this._config.template);for(const[d,y]of Object.entries(this._config.content))this._setContent(e,y,d);const o=e.children[0],u=this._resolvePossibleFunction(this._config.extraClass);return u&&o.classList.add(...u.split(" ")),o}_typeCheckConfig(e){super._typeCheckConfig(e),this._checkContent(e.content)}_checkContent(e){for(const[o,u]of Object.entries(e))super._typeCheckConfig({selector:o,entry:u},XU)}_setContent(e,o,u){const d=Ir.findOne(u,e);if(d){if(o=this._resolvePossibleFunction(o),!o){d.remove();return}if(Xu(o)){this._putElementInTemplate(vd(o),d);return}if(this._config.html){d.innerHTML=this._maybeSanitize(o);return}d.textContent=o}}_maybeSanitize(e){return this._config.sanitize?GU(e,this._config.allowList,this._config.sanitizeFn):e}_resolvePossibleFunction(e){return Na(e,[this])}_putElementInTemplate(e,o){if(this._config.html){o.innerHTML="",o.append(e);return}o.textContent=e.textContent}}const JU="tooltip",QU=new Set(["sanitize","allowList","sanitizeFn"]),J2="fade",e8="modal",Tv="show",t8=".tooltip-inner",BP=`.${e8}`,NP="hide.bs.modal",by="hover",Q2="focus",i8="click",r8="manual",n8="hide",s8="hidden",o8="show",a8="shown",l8="inserted",c8="click",u8="focusin",h8="focusout",d8="mouseenter",f8="mouseleave",p8={AUTO:"auto",TOP:"top",RIGHT:tc()?"left":"right",BOTTOM:"bottom",LEFT:tc()?"right":"left"},m8={allowList:eO,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},_8={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class O_ extends Ic{constructor(e,o){if(typeof CD>"u")throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(e,o),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return m8}static get DefaultType(){return _8}static get NAME(){return JU}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(this._isEnabled){if(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()){this._leave();return}this._enter()}}dispose(){clearTimeout(this._timeout),vi.off(this._element.closest(BP),NP,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!(this._isWithContent()&&this._isEnabled))return;const e=vi.trigger(this._element,this.constructor.eventName(o8)),u=(PD(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(e.defaultPrevented||!u)return;this._disposePopper();const d=this._getTipElement();this._element.setAttribute("aria-describedby",d.getAttribute("id"));const{container:y}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(y.append(d),vi.trigger(this._element,this.constructor.eventName(l8))),this._popper=this._createPopper(d),d.classList.add(Tv),"ontouchstart"in document.documentElement)for(const r of[].concat(...document.body.children))vi.on(r,"mouseover",Ax);const v=()=>{vi.trigger(this._element,this.constructor.eventName(a8)),this._isHovered===!1&&this._leave(),this._isHovered=!1};this._queueCallback(v,this.tip,this._isAnimated())}hide(){if(!this._isShown()||vi.trigger(this._element,this.constructor.eventName(n8)).defaultPrevented)return;if(this._getTipElement().classList.remove(Tv),"ontouchstart"in document.documentElement)for(const d of[].concat(...document.body.children))vi.off(d,"mouseover",Ax);this._activeTrigger[i8]=!1,this._activeTrigger[Q2]=!1,this._activeTrigger[by]=!1,this._isHovered=null;const u=()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),vi.trigger(this._element,this.constructor.eventName(s8)))};this._queueCallback(u,this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(e){const o=this._getTemplateFactory(e).toHtml();if(!o)return null;o.classList.remove(J2,Tv),o.classList.add(`bs-${this.constructor.NAME}-auto`);const u=i6(this.constructor.NAME).toString();return o.setAttribute("id",u),this._isAnimated()&&o.classList.add(J2),o}setContent(e){this._newContent=e,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(e){return this._templateFactory?this._templateFactory.changeContent(e):this._templateFactory=new KU({...this._config,content:e,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[t8]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(e){return this.constructor.getOrCreateInstance(e.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(J2)}_isShown(){return this.tip&&this.tip.classList.contains(Tv)}_createPopper(e){const o=Na(this._config.placement,[this,e,this._element]),u=p8[o.toUpperCase()];return cS(this._element,e,this._getPopperConfig(u))}_getOffset(){const{offset:e}=this._config;return typeof e=="string"?e.split(",").map(o=>Number.parseInt(o,10)):typeof e=="function"?o=>e(o,this._element):e}_resolvePossibleFunction(e){return Na(e,[this._element])}_getPopperConfig(e){const o={placement:e,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:u=>{this._getTipElement().setAttribute("data-popper-placement",u.state.placement)}}]};return{...o,...Na(this._config.popperConfig,[o])}}_setListeners(){const e=this._config.trigger.split(" ");for(const o of e)if(o==="click")vi.on(this._element,this.constructor.eventName(c8),this._config.selector,u=>{this._initializeOnDelegatedTarget(u).toggle()});else if(o!==r8){const u=o===by?this.constructor.eventName(d8):this.constructor.eventName(u8),d=o===by?this.constructor.eventName(f8):this.constructor.eventName(h8);vi.on(this._element,u,this._config.selector,y=>{const v=this._initializeOnDelegatedTarget(y);v._activeTrigger[y.type==="focusin"?Q2:by]=!0,v._enter()}),vi.on(this._element,d,this._config.selector,y=>{const v=this._initializeOnDelegatedTarget(y);v._activeTrigger[y.type==="focusout"?Q2:by]=v._element.contains(y.relatedTarget),v._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},vi.on(this._element.closest(BP),NP,this._hideModalHandler)}_fixTitle(){const e=this._element.getAttribute("title");e&&(!this._element.getAttribute("aria-label")&&!this._element.textContent.trim()&&this._element.setAttribute("aria-label",e),this._element.setAttribute("data-bs-original-title",e),this._element.removeAttribute("title"))}_enter(){if(this._isShown()||this._isHovered){this._isHovered=!0;return}this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show)}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(e,o){clearTimeout(this._timeout),this._timeout=setTimeout(e,o)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(e){const o=Ku.getDataAttributes(this._element);for(const u of Object.keys(o))QU.has(u)&&delete o[u];return e={...o,...typeof e=="object"&&e?e:{}},e=this._mergeConfigObj(e),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}_configAfterMerge(e){return e.container=e.container===!1?document.body:vd(e.container),typeof e.delay=="number"&&(e.delay={show:e.delay,hide:e.delay}),typeof e.title=="number"&&(e.title=e.title.toString()),typeof e.content=="number"&&(e.content=e.content.toString()),e}_getDelegateConfig(){const e={};for(const[o,u]of Object.entries(this._config))this.constructor.Default[o]!==u&&(e[o]=u);return e.selector=!1,e.trigger="manual",e}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(e){return this.each(function(){const o=O_.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof o[e]>"u")throw new TypeError(`No method named "${e}"`);o[e]()}})}}nc(O_);const g8="popover",y8=".popover-header",v8=".popover-body",x8={...O_.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},b8={...O_.DefaultType,content:"(null|string|element|function)"};class fS extends O_{static get Default(){return x8}static get DefaultType(){return b8}static get NAME(){return g8}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[y8]:this._getTitle(),[v8]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(e){return this.each(function(){const o=fS.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof o[e]>"u")throw new TypeError(`No method named "${e}"`);o[e]()}})}}nc(fS);const w8="scrollspy",T8="bs.scrollspy",pS=`.${T8}`,E8=".data-api",S8=`activate${pS}`,VP=`click${pS}`,A8=`load${pS}${E8}`,C8="dropdown-item",Mm="active",M8='[data-bs-spy="scroll"]',eT="[href]",I8=".nav, .list-group",UP=".nav-link",P8=".nav-item",R8=".list-group-item",D8=`${UP}, ${P8} > ${UP}, ${R8}`,O8=".dropdown",L8=".dropdown-toggle",k8={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},z8={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class xb extends Ic{constructor(e,o){super(e,o),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return k8}static get DefaultType(){return z8}static get NAME(){return w8}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const e of this._observableSections.values())this._observer.observe(e)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(e){return e.target=vd(e.target)||document.body,e.rootMargin=e.offset?`${e.offset}px 0px -30%`:e.rootMargin,typeof e.threshold=="string"&&(e.threshold=e.threshold.split(",").map(o=>Number.parseFloat(o))),e}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(vi.off(this._config.target,VP),vi.on(this._config.target,VP,eT,e=>{const o=this._observableSections.get(e.target.hash);if(o){e.preventDefault();const u=this._rootElement||window,d=o.offsetTop-this._element.offsetTop;if(u.scrollTo){u.scrollTo({top:d,behavior:"smooth"});return}u.scrollTop=d}}))}_getNewObserver(){const e={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(o=>this._observerCallback(o),e)}_observerCallback(e){const o=v=>this._targetLinks.get(`#${v.target.id}`),u=v=>{this._previousScrollData.visibleEntryTop=v.target.offsetTop,this._process(o(v))},d=(this._rootElement||document.documentElement).scrollTop,y=d>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=d;for(const v of e){if(!v.isIntersecting){this._activeTarget=null,this._clearActiveClass(o(v));continue}const r=v.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(y&&r){if(u(v),!d)return;continue}!y&&!r&&u(v)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const e=Ir.find(eT,this._config.target);for(const o of e){if(!o.hash||xd(o))continue;const u=Ir.findOne(decodeURI(o.hash),this._element);R_(u)&&(this._targetLinks.set(decodeURI(o.hash),o),this._observableSections.set(o.hash,u))}}_process(e){this._activeTarget!==e&&(this._clearActiveClass(this._config.target),this._activeTarget=e,e.classList.add(Mm),this._activateParents(e),vi.trigger(this._element,S8,{relatedTarget:e}))}_activateParents(e){if(e.classList.contains(C8)){Ir.findOne(L8,e.closest(O8)).classList.add(Mm);return}for(const o of Ir.parents(e,I8))for(const u of Ir.prev(o,D8))u.classList.add(Mm)}_clearActiveClass(e){e.classList.remove(Mm);const o=Ir.find(`${eT}.${Mm}`,e);for(const u of o)u.classList.remove(Mm)}static jQueryInterface(e){return this.each(function(){const o=xb.getOrCreateInstance(this,e);if(typeof e=="string"){if(o[e]===void 0||e.startsWith("_")||e==="constructor")throw new TypeError(`No method named "${e}"`);o[e]()}})}}vi.on(window,A8,()=>{for(const n of Ir.find(M8))xb.getOrCreateInstance(n)});nc(xb);const F8="tab",B8="bs.tab",bp=`.${B8}`,N8=`hide${bp}`,V8=`hidden${bp}`,U8=`show${bp}`,j8=`shown${bp}`,$8=`click${bp}`,q8=`keydown${bp}`,H8=`load${bp}`,G8="ArrowLeft",jP="ArrowRight",W8="ArrowUp",$P="ArrowDown",tT="Home",qP="End",qf="active",HP="fade",iT="show",Z8="dropdown",tO=".dropdown-toggle",Y8=".dropdown-menu",rT=`:not(${tO})`,X8='.list-group, .nav, [role="tablist"]',K8=".nav-item, .list-group-item",J8=`.nav-link${rT}, .list-group-item${rT}, [role="tab"]${rT}`,iO='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',nT=`${J8}, ${iO}`,Q8=`.${qf}[data-bs-toggle="tab"], .${qf}[data-bs-toggle="pill"], .${qf}[data-bs-toggle="list"]`;class d_ extends Ic{constructor(e){super(e),this._parent=this._element.closest(X8),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),vi.on(this._element,q8,o=>this._keydown(o)))}static get NAME(){return F8}show(){const e=this._element;if(this._elemIsActive(e))return;const o=this._getActiveElem(),u=o?vi.trigger(o,N8,{relatedTarget:e}):null;vi.trigger(e,U8,{relatedTarget:o}).defaultPrevented||u&&u.defaultPrevented||(this._deactivate(o,e),this._activate(e,o))}_activate(e,o){if(!e)return;e.classList.add(qf),this._activate(Ir.getElementFromSelector(e));const u=()=>{if(e.getAttribute("role")!=="tab"){e.classList.add(iT);return}e.removeAttribute("tabindex"),e.setAttribute("aria-selected",!0),this._toggleDropDown(e,!0),vi.trigger(e,j8,{relatedTarget:o})};this._queueCallback(u,e,e.classList.contains(HP))}_deactivate(e,o){if(!e)return;e.classList.remove(qf),e.blur(),this._deactivate(Ir.getElementFromSelector(e));const u=()=>{if(e.getAttribute("role")!=="tab"){e.classList.remove(iT);return}e.setAttribute("aria-selected",!1),e.setAttribute("tabindex","-1"),this._toggleDropDown(e,!1),vi.trigger(e,V8,{relatedTarget:o})};this._queueCallback(u,e,e.classList.contains(HP))}_keydown(e){if(![G8,jP,W8,$P,tT,qP].includes(e.key))return;e.stopPropagation(),e.preventDefault();const o=this._getChildren().filter(d=>!xd(d));let u;if([tT,qP].includes(e.key))u=o[e.key===tT?0:o.length-1];else{const d=[jP,$P].includes(e.key);u=uS(o,e.target,d,!0)}u&&(u.focus({preventScroll:!0}),d_.getOrCreateInstance(u).show())}_getChildren(){return Ir.find(nT,this._parent)}_getActiveElem(){return this._getChildren().find(e=>this._elemIsActive(e))||null}_setInitialAttributes(e,o){this._setAttributeIfNotExists(e,"role","tablist");for(const u of o)this._setInitialAttributesOnChild(u)}_setInitialAttributesOnChild(e){e=this._getInnerElement(e);const o=this._elemIsActive(e),u=this._getOuterElement(e);e.setAttribute("aria-selected",o),u!==e&&this._setAttributeIfNotExists(u,"role","presentation"),o||e.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(e,"role","tab"),this._setInitialAttributesOnTargetPanel(e)}_setInitialAttributesOnTargetPanel(e){const o=Ir.getElementFromSelector(e);o&&(this._setAttributeIfNotExists(o,"role","tabpanel"),e.id&&this._setAttributeIfNotExists(o,"aria-labelledby",`${e.id}`))}_toggleDropDown(e,o){const u=this._getOuterElement(e);if(!u.classList.contains(Z8))return;const d=(y,v)=>{const r=Ir.findOne(y,u);r&&r.classList.toggle(v,o)};d(tO,qf),d(Y8,iT),u.setAttribute("aria-expanded",o)}_setAttributeIfNotExists(e,o,u){e.hasAttribute(o)||e.setAttribute(o,u)}_elemIsActive(e){return e.classList.contains(qf)}_getInnerElement(e){return e.matches(nT)?e:Ir.findOne(nT,e)}_getOuterElement(e){return e.closest(K8)||e}static jQueryInterface(e){return this.each(function(){const o=d_.getOrCreateInstance(this);if(typeof e=="string"){if(o[e]===void 0||e.startsWith("_")||e==="constructor")throw new TypeError(`No method named "${e}"`);o[e]()}})}}vi.on(document,$8,iO,function(n){["A","AREA"].includes(this.tagName)&&n.preventDefault(),!xd(this)&&d_.getOrCreateInstance(this).show()});vi.on(window,H8,()=>{for(const n of Ir.find(Q8))d_.getOrCreateInstance(n)});nc(d_);const ej="toast",tj="bs.toast",Dd=`.${tj}`,ij=`mouseover${Dd}`,rj=`mouseout${Dd}`,nj=`focusin${Dd}`,sj=`focusout${Dd}`,oj=`hide${Dd}`,aj=`hidden${Dd}`,lj=`show${Dd}`,cj=`shown${Dd}`,uj="fade",GP="hide",Ev="show",Sv="showing",hj={animation:"boolean",autohide:"boolean",delay:"number"},dj={animation:!0,autohide:!0,delay:5e3};class bb extends Ic{constructor(e,o){super(e,o),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return dj}static get DefaultType(){return hj}static get NAME(){return ej}show(){if(vi.trigger(this._element,lj).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add(uj);const o=()=>{this._element.classList.remove(Sv),vi.trigger(this._element,cj),this._maybeScheduleHide()};this._element.classList.remove(GP),F0(this._element),this._element.classList.add(Ev,Sv),this._queueCallback(o,this._element,this._config.animation)}hide(){if(!this.isShown()||vi.trigger(this._element,oj).defaultPrevented)return;const o=()=>{this._element.classList.add(GP),this._element.classList.remove(Sv,Ev),vi.trigger(this._element,aj)};this._element.classList.add(Sv),this._queueCallback(o,this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(Ev),super.dispose()}isShown(){return this._element.classList.contains(Ev)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(e,o){switch(e.type){case"mouseover":case"mouseout":{this._hasMouseInteraction=o;break}case"focusin":case"focusout":{this._hasKeyboardInteraction=o;break}}if(o){this._clearTimeout();return}const u=e.relatedTarget;this._element===u||this._element.contains(u)||this._maybeScheduleHide()}_setListeners(){vi.on(this._element,ij,e=>this._onInteraction(e,!0)),vi.on(this._element,rj,e=>this._onInteraction(e,!1)),vi.on(this._element,nj,e=>this._onInteraction(e,!0)),vi.on(this._element,sj,e=>this._onInteraction(e,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(e){return this.each(function(){const o=bb.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof o[e]>"u")throw new TypeError(`No method named "${e}"`);o[e](this)}})}}gb(bb);nc(bb);function rO(n,e){return function(){return n.apply(e,arguments)}}const{toString:fj}=Object.prototype,{getPrototypeOf:mS}=Object,wb=(n=>e=>{const o=fj.call(e);return n[o]||(n[o]=o.slice(8,-1).toLowerCase())})(Object.create(null)),Pc=n=>(n=n.toLowerCase(),e=>wb(e)===n),Tb=n=>e=>typeof e===n,{isArray:L_}=Array,u0=Tb("undefined");function pj(n){return n!==null&&!u0(n)&&n.constructor!==null&&!u0(n.constructor)&&gl(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const nO=Pc("ArrayBuffer");function mj(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&nO(n.buffer),e}const _j=Tb("string"),gl=Tb("function"),sO=Tb("number"),Eb=n=>n!==null&&typeof n=="object",gj=n=>n===!0||n===!1,ix=n=>{if(wb(n)!=="object")return!1;const e=mS(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},yj=Pc("Date"),vj=Pc("File"),xj=Pc("Blob"),bj=Pc("FileList"),wj=n=>Eb(n)&&gl(n.pipe),Tj=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||gl(n.append)&&((e=wb(n))==="formdata"||e==="object"&&gl(n.toString)&&n.toString()==="[object FormData]"))},Ej=Pc("URLSearchParams"),[Sj,Aj,Cj,Mj]=["ReadableStream","Request","Response","Headers"].map(Pc),Ij=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function U0(n,e,{allOwnKeys:o=!1}={}){if(n===null||typeof n>"u")return;let u,d;if(typeof n!="object"&&(n=[n]),L_(n))for(u=0,d=n.length;u<d;u++)e.call(null,n[u],u,n);else{const y=o?Object.getOwnPropertyNames(n):Object.keys(n),v=y.length;let r;for(u=0;u<v;u++)r=y[u],e.call(null,n[r],r,n)}}function oO(n,e){e=e.toLowerCase();const o=Object.keys(n);let u=o.length,d;for(;u-- >0;)if(d=o[u],e===d.toLowerCase())return d;return null}const Hf=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),aO=n=>!u0(n)&&n!==Hf;function GT(){const{caseless:n}=aO(this)&&this||{},e={},o=(u,d)=>{const y=n&&oO(e,d)||d;ix(e[y])&&ix(u)?e[y]=GT(e[y],u):ix(u)?e[y]=GT({},u):L_(u)?e[y]=u.slice():e[y]=u};for(let u=0,d=arguments.length;u<d;u++)arguments[u]&&U0(arguments[u],o);return e}const Pj=(n,e,o,{allOwnKeys:u}={})=>(U0(e,(d,y)=>{o&&gl(d)?n[y]=rO(d,o):n[y]=d},{allOwnKeys:u}),n),Rj=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),Dj=(n,e,o,u)=>{n.prototype=Object.create(e.prototype,u),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),o&&Object.assign(n.prototype,o)},Oj=(n,e,o,u)=>{let d,y,v;const r={};if(e=e||{},n==null)return e;do{for(d=Object.getOwnPropertyNames(n),y=d.length;y-- >0;)v=d[y],(!u||u(v,n,e))&&!r[v]&&(e[v]=n[v],r[v]=!0);n=o!==!1&&mS(n)}while(n&&(!o||o(n,e))&&n!==Object.prototype);return e},Lj=(n,e,o)=>{n=String(n),(o===void 0||o>n.length)&&(o=n.length),o-=e.length;const u=n.indexOf(e,o);return u!==-1&&u===o},kj=n=>{if(!n)return null;if(L_(n))return n;let e=n.length;if(!sO(e))return null;const o=new Array(e);for(;e-- >0;)o[e]=n[e];return o},zj=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&mS(Uint8Array)),Fj=(n,e)=>{const u=(n&&n[Symbol.iterator]).call(n);let d;for(;(d=u.next())&&!d.done;){const y=d.value;e.call(n,y[0],y[1])}},Bj=(n,e)=>{let o;const u=[];for(;(o=n.exec(e))!==null;)u.push(o);return u},Nj=Pc("HTMLFormElement"),Vj=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(o,u,d){return u.toUpperCase()+d}),WP=(({hasOwnProperty:n})=>(e,o)=>n.call(e,o))(Object.prototype),Uj=Pc("RegExp"),lO=(n,e)=>{const o=Object.getOwnPropertyDescriptors(n),u={};U0(o,(d,y)=>{let v;(v=e(d,y,n))!==!1&&(u[y]=v||d)}),Object.defineProperties(n,u)},jj=n=>{lO(n,(e,o)=>{if(gl(n)&&["arguments","caller","callee"].indexOf(o)!==-1)return!1;const u=n[o];if(gl(u)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+o+"'")})}})},$j=(n,e)=>{const o={},u=d=>{d.forEach(y=>{o[y]=!0})};return L_(n)?u(n):u(String(n).split(e)),o},qj=()=>{},Hj=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function Gj(n){return!!(n&&gl(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const Wj=n=>{const e=new Array(10),o=(u,d)=>{if(Eb(u)){if(e.indexOf(u)>=0)return;if(!("toJSON"in u)){e[d]=u;const y=L_(u)?[]:{};return U0(u,(v,r)=>{const D=o(v,d+1);!u0(D)&&(y[r]=D)}),e[d]=void 0,y}}return u};return o(n,0)},Zj=Pc("AsyncFunction"),Yj=n=>n&&(Eb(n)||gl(n))&&gl(n.then)&&gl(n.catch),cO=((n,e)=>n?setImmediate:e?((o,u)=>(Hf.addEventListener("message",({source:d,data:y})=>{d===Hf&&y===o&&u.length&&u.shift()()},!1),d=>{u.push(d),Hf.postMessage(o,"*")}))(`axios@${Math.random()}`,[]):o=>setTimeout(o))(typeof setImmediate=="function",gl(Hf.postMessage)),Xj=typeof queueMicrotask<"u"?queueMicrotask.bind(Hf):typeof process<"u"&&process.nextTick||cO,ei={isArray:L_,isArrayBuffer:nO,isBuffer:pj,isFormData:Tj,isArrayBufferView:mj,isString:_j,isNumber:sO,isBoolean:gj,isObject:Eb,isPlainObject:ix,isReadableStream:Sj,isRequest:Aj,isResponse:Cj,isHeaders:Mj,isUndefined:u0,isDate:yj,isFile:vj,isBlob:xj,isRegExp:Uj,isFunction:gl,isStream:wj,isURLSearchParams:Ej,isTypedArray:zj,isFileList:bj,forEach:U0,merge:GT,extend:Pj,trim:Ij,stripBOM:Rj,inherits:Dj,toFlatObject:Oj,kindOf:wb,kindOfTest:Pc,endsWith:Lj,toArray:kj,forEachEntry:Fj,matchAll:Bj,isHTMLForm:Nj,hasOwnProperty:WP,hasOwnProp:WP,reduceDescriptors:lO,freezeMethods:jj,toObjectSet:$j,toCamelCase:Vj,noop:qj,toFiniteNumber:Hj,findKey:oO,global:Hf,isContextDefined:aO,isSpecCompliantForm:Gj,toJSONObject:Wj,isAsyncFn:Zj,isThenable:Yj,setImmediate:cO,asap:Xj};function Jr(n,e,o,u,d){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),o&&(this.config=o),u&&(this.request=u),d&&(this.response=d,this.status=d.status?d.status:null)}ei.inherits(Jr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ei.toJSONObject(this.config),code:this.code,status:this.status}}});const uO=Jr.prototype,hO={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{hO[n]={value:n}});Object.defineProperties(Jr,hO);Object.defineProperty(uO,"isAxiosError",{value:!0});Jr.from=(n,e,o,u,d,y)=>{const v=Object.create(uO);return ei.toFlatObject(n,v,function(D){return D!==Error.prototype},r=>r!=="isAxiosError"),Jr.call(v,n.message,e,o,u,d),v.cause=n,v.name=n.name,y&&Object.assign(v,y),v};const Kj=null;function WT(n){return ei.isPlainObject(n)||ei.isArray(n)}function dO(n){return ei.endsWith(n,"[]")?n.slice(0,-2):n}function ZP(n,e,o){return n?n.concat(e).map(function(d,y){return d=dO(d),!o&&y?"["+d+"]":d}).join(o?".":""):e}function Jj(n){return ei.isArray(n)&&!n.some(WT)}const Qj=ei.toFlatObject(ei,{},null,function(e){return/^is[A-Z]/.test(e)});function Sb(n,e,o){if(!ei.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,o=ei.toFlatObject(o,{metaTokens:!0,dots:!1,indexes:!1},!1,function(G,ae){return!ei.isUndefined(ae[G])});const u=o.metaTokens,d=o.visitor||F,y=o.dots,v=o.indexes,D=(o.Blob||typeof Blob<"u"&&Blob)&&ei.isSpecCompliantForm(e);if(!ei.isFunction(d))throw new TypeError("visitor must be a function");function B(X){if(X===null)return"";if(ei.isDate(X))return X.toISOString();if(!D&&ei.isBlob(X))throw new Jr("Blob is not supported. Use a Buffer instead.");return ei.isArrayBuffer(X)||ei.isTypedArray(X)?D&&typeof Blob=="function"?new Blob([X]):Buffer.from(X):X}function F(X,G,ae){let xe=X;if(X&&!ae&&typeof X=="object"){if(ei.endsWith(G,"{}"))G=u?G:G.slice(0,-2),X=JSON.stringify(X);else if(ei.isArray(X)&&Jj(X)||(ei.isFileList(X)||ei.endsWith(G,"[]"))&&(xe=ei.toArray(X)))return G=dO(G),xe.forEach(function(fe,ne){!(ei.isUndefined(fe)||fe===null)&&e.append(v===!0?ZP([G],ne,y):v===null?G:G+"[]",B(fe))}),!1}return WT(X)?!0:(e.append(ZP(ae,G,y),B(X)),!1)}const N=[],Q=Object.assign(Qj,{defaultVisitor:F,convertValue:B,isVisitable:WT});function q(X,G){if(!ei.isUndefined(X)){if(N.indexOf(X)!==-1)throw Error("Circular reference detected in "+G.join("."));N.push(X),ei.forEach(X,function(xe,Te){(!(ei.isUndefined(xe)||xe===null)&&d.call(e,xe,ei.isString(Te)?Te.trim():Te,G,Q))===!0&&q(xe,G?G.concat(Te):[Te])}),N.pop()}}if(!ei.isObject(n))throw new TypeError("data must be an object");return q(n),e}function YP(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(u){return e[u]})}function _S(n,e){this._pairs=[],n&&Sb(n,this,e)}const fO=_S.prototype;fO.append=function(e,o){this._pairs.push([e,o])};fO.toString=function(e){const o=e?function(u){return e.call(this,u,YP)}:YP;return this._pairs.map(function(d){return o(d[0])+"="+o(d[1])},"").join("&")};function e$(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function pO(n,e,o){if(!e)return n;const u=o&&o.encode||e$;ei.isFunction(o)&&(o={serialize:o});const d=o&&o.serialize;let y;if(d?y=d(e,o):y=ei.isURLSearchParams(e)?e.toString():new _S(e,o).toString(u),y){const v=n.indexOf("#");v!==-1&&(n=n.slice(0,v)),n+=(n.indexOf("?")===-1?"?":"&")+y}return n}class t${constructor(){this.handlers=[]}use(e,o,u){return this.handlers.push({fulfilled:e,rejected:o,synchronous:u?u.synchronous:!1,runWhen:u?u.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ei.forEach(this.handlers,function(u){u!==null&&e(u)})}}const XP=t$,mO={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},i$=typeof URLSearchParams<"u"?URLSearchParams:_S,r$=typeof FormData<"u"?FormData:null,n$=typeof Blob<"u"?Blob:null,s$={isBrowser:!0,classes:{URLSearchParams:i$,FormData:r$,Blob:n$},protocols:["http","https","file","blob","url","data"]},gS=typeof window<"u"&&typeof document<"u",ZT=typeof navigator=="object"&&navigator||void 0,o$=gS&&(!ZT||["ReactNative","NativeScript","NS"].indexOf(ZT.product)<0),a$=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),l$=gS&&window.location.href||"http://localhost",c$=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:gS,hasStandardBrowserEnv:o$,hasStandardBrowserWebWorkerEnv:a$,navigator:ZT,origin:l$},Symbol.toStringTag,{value:"Module"})),Ko={...c$,...s$};function u$(n,e){return Sb(n,new Ko.classes.URLSearchParams,Object.assign({visitor:function(o,u,d,y){return Ko.isNode&&ei.isBuffer(o)?(this.append(u,o.toString("base64")),!1):y.defaultVisitor.apply(this,arguments)}},e))}function h$(n){return ei.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function d$(n){const e={},o=Object.keys(n);let u;const d=o.length;let y;for(u=0;u<d;u++)y=o[u],e[y]=n[y];return e}function _O(n){function e(o,u,d,y){let v=o[y++];if(v==="__proto__")return!0;const r=Number.isFinite(+v),D=y>=o.length;return v=!v&&ei.isArray(d)?d.length:v,D?(ei.hasOwnProp(d,v)?d[v]=[d[v],u]:d[v]=u,!r):((!d[v]||!ei.isObject(d[v]))&&(d[v]=[]),e(o,u,d[v],y)&&ei.isArray(d[v])&&(d[v]=d$(d[v])),!r)}if(ei.isFormData(n)&&ei.isFunction(n.entries)){const o={};return ei.forEachEntry(n,(u,d)=>{e(h$(u),d,o,0)}),o}return null}function f$(n,e,o){if(ei.isString(n))try{return(e||JSON.parse)(n),ei.trim(n)}catch(u){if(u.name!=="SyntaxError")throw u}return(o||JSON.stringify)(n)}const yS={transitional:mO,adapter:["xhr","http","fetch"],transformRequest:[function(e,o){const u=o.getContentType()||"",d=u.indexOf("application/json")>-1,y=ei.isObject(e);if(y&&ei.isHTMLForm(e)&&(e=new FormData(e)),ei.isFormData(e))return d?JSON.stringify(_O(e)):e;if(ei.isArrayBuffer(e)||ei.isBuffer(e)||ei.isStream(e)||ei.isFile(e)||ei.isBlob(e)||ei.isReadableStream(e))return e;if(ei.isArrayBufferView(e))return e.buffer;if(ei.isURLSearchParams(e))return o.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let r;if(y){if(u.indexOf("application/x-www-form-urlencoded")>-1)return u$(e,this.formSerializer).toString();if((r=ei.isFileList(e))||u.indexOf("multipart/form-data")>-1){const D=this.env&&this.env.FormData;return Sb(r?{"files[]":e}:e,D&&new D,this.formSerializer)}}return y||d?(o.setContentType("application/json",!1),f$(e)):e}],transformResponse:[function(e){const o=this.transitional||yS.transitional,u=o&&o.forcedJSONParsing,d=this.responseType==="json";if(ei.isResponse(e)||ei.isReadableStream(e))return e;if(e&&ei.isString(e)&&(u&&!this.responseType||d)){const v=!(o&&o.silentJSONParsing)&&d;try{return JSON.parse(e)}catch(r){if(v)throw r.name==="SyntaxError"?Jr.from(r,Jr.ERR_BAD_RESPONSE,this,null,this.response):r}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ko.classes.FormData,Blob:Ko.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ei.forEach(["delete","get","head","post","put","patch"],n=>{yS.headers[n]={}});const vS=yS,p$=ei.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),m$=n=>{const e={};let o,u,d;return n&&n.split(`
`).forEach(function(v){d=v.indexOf(":"),o=v.substring(0,d).trim().toLowerCase(),u=v.substring(d+1).trim(),!(!o||e[o]&&p$[o])&&(o==="set-cookie"?e[o]?e[o].push(u):e[o]=[u]:e[o]=e[o]?e[o]+", "+u:u)}),e},KP=Symbol("internals");function wy(n){return n&&String(n).trim().toLowerCase()}function rx(n){return n===!1||n==null?n:ei.isArray(n)?n.map(rx):String(n)}function _$(n){const e=Object.create(null),o=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let u;for(;u=o.exec(n);)e[u[1]]=u[2];return e}const g$=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function sT(n,e,o,u,d){if(ei.isFunction(u))return u.call(this,e,o);if(d&&(e=o),!!ei.isString(e)){if(ei.isString(u))return e.indexOf(u)!==-1;if(ei.isRegExp(u))return u.test(e)}}function y$(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,o,u)=>o.toUpperCase()+u)}function v$(n,e){const o=ei.toCamelCase(" "+e);["get","set","has"].forEach(u=>{Object.defineProperty(n,u+o,{value:function(d,y,v){return this[u].call(this,e,d,y,v)},configurable:!0})})}class Ab{constructor(e){e&&this.set(e)}set(e,o,u){const d=this;function y(r,D,B){const F=wy(D);if(!F)throw new Error("header name must be a non-empty string");const N=ei.findKey(d,F);(!N||d[N]===void 0||B===!0||B===void 0&&d[N]!==!1)&&(d[N||D]=rx(r))}const v=(r,D)=>ei.forEach(r,(B,F)=>y(B,F,D));if(ei.isPlainObject(e)||e instanceof this.constructor)v(e,o);else if(ei.isString(e)&&(e=e.trim())&&!g$(e))v(m$(e),o);else if(ei.isHeaders(e))for(const[r,D]of e.entries())y(D,r,u);else e!=null&&y(o,e,u);return this}get(e,o){if(e=wy(e),e){const u=ei.findKey(this,e);if(u){const d=this[u];if(!o)return d;if(o===!0)return _$(d);if(ei.isFunction(o))return o.call(this,d,u);if(ei.isRegExp(o))return o.exec(d);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,o){if(e=wy(e),e){const u=ei.findKey(this,e);return!!(u&&this[u]!==void 0&&(!o||sT(this,this[u],u,o)))}return!1}delete(e,o){const u=this;let d=!1;function y(v){if(v=wy(v),v){const r=ei.findKey(u,v);r&&(!o||sT(u,u[r],r,o))&&(delete u[r],d=!0)}}return ei.isArray(e)?e.forEach(y):y(e),d}clear(e){const o=Object.keys(this);let u=o.length,d=!1;for(;u--;){const y=o[u];(!e||sT(this,this[y],y,e,!0))&&(delete this[y],d=!0)}return d}normalize(e){const o=this,u={};return ei.forEach(this,(d,y)=>{const v=ei.findKey(u,y);if(v){o[v]=rx(d),delete o[y];return}const r=e?y$(y):String(y).trim();r!==y&&delete o[y],o[r]=rx(d),u[r]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const o=Object.create(null);return ei.forEach(this,(u,d)=>{u!=null&&u!==!1&&(o[d]=e&&ei.isArray(u)?u.join(", "):u)}),o}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,o])=>e+": "+o).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...o){const u=new this(e);return o.forEach(d=>u.set(d)),u}static accessor(e){const u=(this[KP]=this[KP]={accessors:{}}).accessors,d=this.prototype;function y(v){const r=wy(v);u[r]||(v$(d,v),u[r]=!0)}return ei.isArray(e)?e.forEach(y):y(e),this}}Ab.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ei.reduceDescriptors(Ab.prototype,({value:n},e)=>{let o=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(u){this[o]=u}}});ei.freezeMethods(Ab);const Ac=Ab;function oT(n,e){const o=this||vS,u=e||o,d=Ac.from(u.headers);let y=u.data;return ei.forEach(n,function(r){y=r.call(o,y,d.normalize(),e?e.status:void 0)}),d.normalize(),y}function gO(n){return!!(n&&n.__CANCEL__)}function k_(n,e,o){Jr.call(this,n??"canceled",Jr.ERR_CANCELED,e,o),this.name="CanceledError"}ei.inherits(k_,Jr,{__CANCEL__:!0});function yO(n,e,o){const u=o.config.validateStatus;!o.status||!u||u(o.status)?n(o):e(new Jr("Request failed with status code "+o.status,[Jr.ERR_BAD_REQUEST,Jr.ERR_BAD_RESPONSE][Math.floor(o.status/100)-4],o.config,o.request,o))}function x$(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function b$(n,e){n=n||10;const o=new Array(n),u=new Array(n);let d=0,y=0,v;return e=e!==void 0?e:1e3,function(D){const B=Date.now(),F=u[y];v||(v=B),o[d]=D,u[d]=B;let N=y,Q=0;for(;N!==d;)Q+=o[N++],N=N%n;if(d=(d+1)%n,d===y&&(y=(y+1)%n),B-v<e)return;const q=F&&B-F;return q?Math.round(Q*1e3/q):void 0}}function w$(n,e){let o=0,u=1e3/e,d,y;const v=(B,F=Date.now())=>{o=F,d=null,y&&(clearTimeout(y),y=null),n.apply(null,B)};return[(...B)=>{const F=Date.now(),N=F-o;N>=u?v(B,F):(d=B,y||(y=setTimeout(()=>{y=null,v(d)},u-N)))},()=>d&&v(d)]}const Ix=(n,e,o=3)=>{let u=0;const d=b$(50,250);return w$(y=>{const v=y.loaded,r=y.lengthComputable?y.total:void 0,D=v-u,B=d(D),F=v<=r;u=v;const N={loaded:v,total:r,progress:r?v/r:void 0,bytes:D,rate:B||void 0,estimated:B&&r&&F?(r-v)/B:void 0,event:y,lengthComputable:r!=null,[e?"download":"upload"]:!0};n(N)},o)},JP=(n,e)=>{const o=n!=null;return[u=>e[0]({lengthComputable:o,total:n,loaded:u}),e[1]]},QP=n=>(...e)=>ei.asap(()=>n(...e)),T$=Ko.hasStandardBrowserEnv?((n,e)=>o=>(o=new URL(o,Ko.origin),n.protocol===o.protocol&&n.host===o.host&&(e||n.port===o.port)))(new URL(Ko.origin),Ko.navigator&&/(msie|trident)/i.test(Ko.navigator.userAgent)):()=>!0,E$=Ko.hasStandardBrowserEnv?{write(n,e,o,u,d,y){const v=[n+"="+encodeURIComponent(e)];ei.isNumber(o)&&v.push("expires="+new Date(o).toGMTString()),ei.isString(u)&&v.push("path="+u),ei.isString(d)&&v.push("domain="+d),y===!0&&v.push("secure"),document.cookie=v.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function S$(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function A$(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function vO(n,e,o){let u=!S$(e);return n&&u||o==!1?A$(n,e):e}const e3=n=>n instanceof Ac?{...n}:n;function hp(n,e){e=e||{};const o={};function u(B,F,N,Q){return ei.isPlainObject(B)&&ei.isPlainObject(F)?ei.merge.call({caseless:Q},B,F):ei.isPlainObject(F)?ei.merge({},F):ei.isArray(F)?F.slice():F}function d(B,F,N,Q){if(ei.isUndefined(F)){if(!ei.isUndefined(B))return u(void 0,B,N,Q)}else return u(B,F,N,Q)}function y(B,F){if(!ei.isUndefined(F))return u(void 0,F)}function v(B,F){if(ei.isUndefined(F)){if(!ei.isUndefined(B))return u(void 0,B)}else return u(void 0,F)}function r(B,F,N){if(N in e)return u(B,F);if(N in n)return u(void 0,B)}const D={url:y,method:y,data:y,baseURL:v,transformRequest:v,transformResponse:v,paramsSerializer:v,timeout:v,timeoutMessage:v,withCredentials:v,withXSRFToken:v,adapter:v,responseType:v,xsrfCookieName:v,xsrfHeaderName:v,onUploadProgress:v,onDownloadProgress:v,decompress:v,maxContentLength:v,maxBodyLength:v,beforeRedirect:v,transport:v,httpAgent:v,httpsAgent:v,cancelToken:v,socketPath:v,responseEncoding:v,validateStatus:r,headers:(B,F,N)=>d(e3(B),e3(F),N,!0)};return ei.forEach(Object.keys(Object.assign({},n,e)),function(F){const N=D[F]||d,Q=N(n[F],e[F],F);ei.isUndefined(Q)&&N!==r||(o[F]=Q)}),o}const xO=n=>{const e=hp({},n);let{data:o,withXSRFToken:u,xsrfHeaderName:d,xsrfCookieName:y,headers:v,auth:r}=e;e.headers=v=Ac.from(v),e.url=pO(vO(e.baseURL,e.url),n.params,n.paramsSerializer),r&&v.set("Authorization","Basic "+btoa((r.username||"")+":"+(r.password?unescape(encodeURIComponent(r.password)):"")));let D;if(ei.isFormData(o)){if(Ko.hasStandardBrowserEnv||Ko.hasStandardBrowserWebWorkerEnv)v.setContentType(void 0);else if((D=v.getContentType())!==!1){const[B,...F]=D?D.split(";").map(N=>N.trim()).filter(Boolean):[];v.setContentType([B||"multipart/form-data",...F].join("; "))}}if(Ko.hasStandardBrowserEnv&&(u&&ei.isFunction(u)&&(u=u(e)),u||u!==!1&&T$(e.url))){const B=d&&y&&E$.read(y);B&&v.set(d,B)}return e},C$=typeof XMLHttpRequest<"u",M$=C$&&function(n){return new Promise(function(o,u){const d=xO(n);let y=d.data;const v=Ac.from(d.headers).normalize();let{responseType:r,onUploadProgress:D,onDownloadProgress:B}=d,F,N,Q,q,X;function G(){q&&q(),X&&X(),d.cancelToken&&d.cancelToken.unsubscribe(F),d.signal&&d.signal.removeEventListener("abort",F)}let ae=new XMLHttpRequest;ae.open(d.method.toUpperCase(),d.url,!0),ae.timeout=d.timeout;function xe(){if(!ae)return;const fe=Ac.from("getAllResponseHeaders"in ae&&ae.getAllResponseHeaders()),ue={data:!r||r==="text"||r==="json"?ae.responseText:ae.response,status:ae.status,statusText:ae.statusText,headers:fe,config:n,request:ae};yO(function(le){o(le),G()},function(le){u(le),G()},ue),ae=null}"onloadend"in ae?ae.onloadend=xe:ae.onreadystatechange=function(){!ae||ae.readyState!==4||ae.status===0&&!(ae.responseURL&&ae.responseURL.indexOf("file:")===0)||setTimeout(xe)},ae.onabort=function(){ae&&(u(new Jr("Request aborted",Jr.ECONNABORTED,n,ae)),ae=null)},ae.onerror=function(){u(new Jr("Network Error",Jr.ERR_NETWORK,n,ae)),ae=null},ae.ontimeout=function(){let ne=d.timeout?"timeout of "+d.timeout+"ms exceeded":"timeout exceeded";const ue=d.transitional||mO;d.timeoutErrorMessage&&(ne=d.timeoutErrorMessage),u(new Jr(ne,ue.clarifyTimeoutError?Jr.ETIMEDOUT:Jr.ECONNABORTED,n,ae)),ae=null},y===void 0&&v.setContentType(null),"setRequestHeader"in ae&&ei.forEach(v.toJSON(),function(ne,ue){ae.setRequestHeader(ue,ne)}),ei.isUndefined(d.withCredentials)||(ae.withCredentials=!!d.withCredentials),r&&r!=="json"&&(ae.responseType=d.responseType),B&&([Q,X]=Ix(B,!0),ae.addEventListener("progress",Q)),D&&ae.upload&&([N,q]=Ix(D),ae.upload.addEventListener("progress",N),ae.upload.addEventListener("loadend",q)),(d.cancelToken||d.signal)&&(F=fe=>{ae&&(u(!fe||fe.type?new k_(null,n,ae):fe),ae.abort(),ae=null)},d.cancelToken&&d.cancelToken.subscribe(F),d.signal&&(d.signal.aborted?F():d.signal.addEventListener("abort",F)));const Te=x$(d.url);if(Te&&Ko.protocols.indexOf(Te)===-1){u(new Jr("Unsupported protocol "+Te+":",Jr.ERR_BAD_REQUEST,n));return}ae.send(y||null)})},I$=(n,e)=>{const{length:o}=n=n?n.filter(Boolean):[];if(e||o){let u=new AbortController,d;const y=function(B){if(!d){d=!0,r();const F=B instanceof Error?B:this.reason;u.abort(F instanceof Jr?F:new k_(F instanceof Error?F.message:F))}};let v=e&&setTimeout(()=>{v=null,y(new Jr(`timeout ${e} of ms exceeded`,Jr.ETIMEDOUT))},e);const r=()=>{n&&(v&&clearTimeout(v),v=null,n.forEach(B=>{B.unsubscribe?B.unsubscribe(y):B.removeEventListener("abort",y)}),n=null)};n.forEach(B=>B.addEventListener("abort",y));const{signal:D}=u;return D.unsubscribe=()=>ei.asap(r),D}},P$=I$,R$=function*(n,e){let o=n.byteLength;if(!e||o<e){yield n;return}let u=0,d;for(;u<o;)d=u+e,yield n.slice(u,d),u=d},D$=async function*(n,e){for await(const o of O$(n))yield*R$(o,e)},O$=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:o,value:u}=await e.read();if(o)break;yield u}}finally{await e.cancel()}},t3=(n,e,o,u)=>{const d=D$(n,e);let y=0,v,r=D=>{v||(v=!0,u&&u(D))};return new ReadableStream({async pull(D){try{const{done:B,value:F}=await d.next();if(B){r(),D.close();return}let N=F.byteLength;if(o){let Q=y+=N;o(Q)}D.enqueue(new Uint8Array(F))}catch(B){throw r(B),B}},cancel(D){return r(D),d.return()}},{highWaterMark:2})},Cb=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",bO=Cb&&typeof ReadableStream=="function",L$=Cb&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),wO=(n,...e)=>{try{return!!n(...e)}catch{return!1}},k$=bO&&wO(()=>{let n=!1;const e=new Request(Ko.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),i3=64*1024,YT=bO&&wO(()=>ei.isReadableStream(new Response("").body)),Px={stream:YT&&(n=>n.body)};Cb&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Px[e]&&(Px[e]=ei.isFunction(n[e])?o=>o[e]():(o,u)=>{throw new Jr(`Response type '${e}' is not supported`,Jr.ERR_NOT_SUPPORT,u)})})})(new Response);const z$=async n=>{if(n==null)return 0;if(ei.isBlob(n))return n.size;if(ei.isSpecCompliantForm(n))return(await new Request(Ko.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(ei.isArrayBufferView(n)||ei.isArrayBuffer(n))return n.byteLength;if(ei.isURLSearchParams(n)&&(n=n+""),ei.isString(n))return(await L$(n)).byteLength},F$=async(n,e)=>{const o=ei.toFiniteNumber(n.getContentLength());return o??z$(e)},B$=Cb&&(async n=>{let{url:e,method:o,data:u,signal:d,cancelToken:y,timeout:v,onDownloadProgress:r,onUploadProgress:D,responseType:B,headers:F,withCredentials:N="same-origin",fetchOptions:Q}=xO(n);B=B?(B+"").toLowerCase():"text";let q=P$([d,y&&y.toAbortSignal()],v),X;const G=q&&q.unsubscribe&&(()=>{q.unsubscribe()});let ae;try{if(D&&k$&&o!=="get"&&o!=="head"&&(ae=await F$(F,u))!==0){let ue=new Request(e,{method:"POST",body:u,duplex:"half"}),ye;if(ei.isFormData(u)&&(ye=ue.headers.get("content-type"))&&F.setContentType(ye),ue.body){const[le,re]=JP(ae,Ix(QP(D)));u=t3(ue.body,i3,le,re)}}ei.isString(N)||(N=N?"include":"omit");const xe="credentials"in Request.prototype;X=new Request(e,{...Q,signal:q,method:o.toUpperCase(),headers:F.normalize().toJSON(),body:u,duplex:"half",credentials:xe?N:void 0});let Te=await fetch(X);const fe=YT&&(B==="stream"||B==="response");if(YT&&(r||fe&&G)){const ue={};["status","statusText","headers"].forEach(oe=>{ue[oe]=Te[oe]});const ye=ei.toFiniteNumber(Te.headers.get("content-length")),[le,re]=r&&JP(ye,Ix(QP(r),!0))||[];Te=new Response(t3(Te.body,i3,le,()=>{re&&re(),G&&G()}),ue)}B=B||"text";let ne=await Px[ei.findKey(Px,B)||"text"](Te,n);return!fe&&G&&G(),await new Promise((ue,ye)=>{yO(ue,ye,{data:ne,headers:Ac.from(Te.headers),status:Te.status,statusText:Te.statusText,config:n,request:X})})}catch(xe){throw G&&G(),xe&&xe.name==="TypeError"&&/fetch/i.test(xe.message)?Object.assign(new Jr("Network Error",Jr.ERR_NETWORK,n,X),{cause:xe.cause||xe}):Jr.from(xe,xe&&xe.code,n,X)}}),XT={http:Kj,xhr:M$,fetch:B$};ei.forEach(XT,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const r3=n=>`- ${n}`,N$=n=>ei.isFunction(n)||n===null||n===!1,TO={getAdapter:n=>{n=ei.isArray(n)?n:[n];const{length:e}=n;let o,u;const d={};for(let y=0;y<e;y++){o=n[y];let v;if(u=o,!N$(o)&&(u=XT[(v=String(o)).toLowerCase()],u===void 0))throw new Jr(`Unknown adapter '${v}'`);if(u)break;d[v||"#"+y]=u}if(!u){const y=Object.entries(d).map(([r,D])=>`adapter ${r} `+(D===!1?"is not supported by the environment":"is not available in the build"));let v=e?y.length>1?`since :
`+y.map(r3).join(`
`):" "+r3(y[0]):"as no adapter specified";throw new Jr("There is no suitable adapter to dispatch the request "+v,"ERR_NOT_SUPPORT")}return u},adapters:XT};function aT(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new k_(null,n)}function n3(n){return aT(n),n.headers=Ac.from(n.headers),n.data=oT.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),TO.getAdapter(n.adapter||vS.adapter)(n).then(function(u){return aT(n),u.data=oT.call(n,n.transformResponse,u),u.headers=Ac.from(u.headers),u},function(u){return gO(u)||(aT(n),u&&u.response&&(u.response.data=oT.call(n,n.transformResponse,u.response),u.response.headers=Ac.from(u.response.headers))),Promise.reject(u)})}const EO="1.8.2",Mb={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{Mb[n]=function(u){return typeof u===n||"a"+(e<1?"n ":" ")+n}});const s3={};Mb.transitional=function(e,o,u){function d(y,v){return"[Axios v"+EO+"] Transitional option '"+y+"'"+v+(u?". "+u:"")}return(y,v,r)=>{if(e===!1)throw new Jr(d(v," has been removed"+(o?" in "+o:"")),Jr.ERR_DEPRECATED);return o&&!s3[v]&&(s3[v]=!0,console.warn(d(v," has been deprecated since v"+o+" and will be removed in the near future"))),e?e(y,v,r):!0}};Mb.spelling=function(e){return(o,u)=>(console.warn(`${u} is likely a misspelling of ${e}`),!0)};function V$(n,e,o){if(typeof n!="object")throw new Jr("options must be an object",Jr.ERR_BAD_OPTION_VALUE);const u=Object.keys(n);let d=u.length;for(;d-- >0;){const y=u[d],v=e[y];if(v){const r=n[y],D=r===void 0||v(r,y,n);if(D!==!0)throw new Jr("option "+y+" must be "+D,Jr.ERR_BAD_OPTION_VALUE);continue}if(o!==!0)throw new Jr("Unknown option "+y,Jr.ERR_BAD_OPTION)}}const nx={assertOptions:V$,validators:Mb},Kc=nx.validators;class Rx{constructor(e){this.defaults=e,this.interceptors={request:new XP,response:new XP}}async request(e,o){try{return await this._request(e,o)}catch(u){if(u instanceof Error){let d={};Error.captureStackTrace?Error.captureStackTrace(d):d=new Error;const y=d.stack?d.stack.replace(/^.+\n/,""):"";try{u.stack?y&&!String(u.stack).endsWith(y.replace(/^.+\n.+\n/,""))&&(u.stack+=`
`+y):u.stack=y}catch{}}throw u}}_request(e,o){typeof e=="string"?(o=o||{},o.url=e):o=e||{},o=hp(this.defaults,o);const{transitional:u,paramsSerializer:d,headers:y}=o;u!==void 0&&nx.assertOptions(u,{silentJSONParsing:Kc.transitional(Kc.boolean),forcedJSONParsing:Kc.transitional(Kc.boolean),clarifyTimeoutError:Kc.transitional(Kc.boolean)},!1),d!=null&&(ei.isFunction(d)?o.paramsSerializer={serialize:d}:nx.assertOptions(d,{encode:Kc.function,serialize:Kc.function},!0)),o.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?o.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:o.allowAbsoluteUrls=!0),nx.assertOptions(o,{baseUrl:Kc.spelling("baseURL"),withXsrfToken:Kc.spelling("withXSRFToken")},!0),o.method=(o.method||this.defaults.method||"get").toLowerCase();let v=y&&ei.merge(y.common,y[o.method]);y&&ei.forEach(["delete","get","head","post","put","patch","common"],X=>{delete y[X]}),o.headers=Ac.concat(v,y);const r=[];let D=!0;this.interceptors.request.forEach(function(G){typeof G.runWhen=="function"&&G.runWhen(o)===!1||(D=D&&G.synchronous,r.unshift(G.fulfilled,G.rejected))});const B=[];this.interceptors.response.forEach(function(G){B.push(G.fulfilled,G.rejected)});let F,N=0,Q;if(!D){const X=[n3.bind(this),void 0];for(X.unshift.apply(X,r),X.push.apply(X,B),Q=X.length,F=Promise.resolve(o);N<Q;)F=F.then(X[N++],X[N++]);return F}Q=r.length;let q=o;for(N=0;N<Q;){const X=r[N++],G=r[N++];try{q=X(q)}catch(ae){G.call(this,ae);break}}try{F=n3.call(this,q)}catch(X){return Promise.reject(X)}for(N=0,Q=B.length;N<Q;)F=F.then(B[N++],B[N++]);return F}getUri(e){e=hp(this.defaults,e);const o=vO(e.baseURL,e.url,e.allowAbsoluteUrls);return pO(o,e.params,e.paramsSerializer)}}ei.forEach(["delete","get","head","options"],function(e){Rx.prototype[e]=function(o,u){return this.request(hp(u||{},{method:e,url:o,data:(u||{}).data}))}});ei.forEach(["post","put","patch"],function(e){function o(u){return function(y,v,r){return this.request(hp(r||{},{method:e,headers:u?{"Content-Type":"multipart/form-data"}:{},url:y,data:v}))}}Rx.prototype[e]=o(),Rx.prototype[e+"Form"]=o(!0)});const sx=Rx;class xS{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let o;this.promise=new Promise(function(y){o=y});const u=this;this.promise.then(d=>{if(!u._listeners)return;let y=u._listeners.length;for(;y-- >0;)u._listeners[y](d);u._listeners=null}),this.promise.then=d=>{let y;const v=new Promise(r=>{u.subscribe(r),y=r}).then(d);return v.cancel=function(){u.unsubscribe(y)},v},e(function(y,v,r){u.reason||(u.reason=new k_(y,v,r),o(u.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const o=this._listeners.indexOf(e);o!==-1&&this._listeners.splice(o,1)}toAbortSignal(){const e=new AbortController,o=u=>{e.abort(u)};return this.subscribe(o),e.signal.unsubscribe=()=>this.unsubscribe(o),e.signal}static source(){let e;return{token:new xS(function(d){e=d}),cancel:e}}}const U$=xS;function j$(n){return function(o){return n.apply(null,o)}}function $$(n){return ei.isObject(n)&&n.isAxiosError===!0}const KT={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(KT).forEach(([n,e])=>{KT[e]=n});const q$=KT;function SO(n){const e=new sx(n),o=rO(sx.prototype.request,e);return ei.extend(o,sx.prototype,e,{allOwnKeys:!0}),ei.extend(o,e,null,{allOwnKeys:!0}),o.create=function(d){return SO(hp(n,d))},o}const lo=SO(vS);lo.Axios=sx;lo.CanceledError=k_;lo.CancelToken=U$;lo.isCancel=gO;lo.VERSION=EO;lo.toFormData=Sb;lo.AxiosError=Jr;lo.Cancel=lo.CanceledError;lo.all=function(e){return Promise.all(e)};lo.spread=j$;lo.isAxiosError=$$;lo.mergeConfig=hp;lo.AxiosHeaders=Ac;lo.formToJSON=n=>_O(ei.isHTMLForm(n)?new FormData(n):n);lo.getAdapter=TO.getAdapter;lo.HttpStatusCode=q$;lo.default=lo;const bs=lo;window.axios=bs;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";window.axios.defaults.baseURL="/public/api/";function ju(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function AO(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}/*!
 * GSAP 3.12.7
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var yl={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},f_={duration:.5,overwrite:!1,delay:0},bS,zo,Ms,Yl=1e8,us=1/Yl,JT=Math.PI*2,H$=JT/4,G$=0,CO=Math.sqrt,W$=Math.cos,Z$=Math.sin,Po=function(e){return typeof e=="string"},qs=function(e){return typeof e=="function"},th=function(e){return typeof e=="number"},wS=function(e){return typeof e>"u"},du=function(e){return typeof e=="object"},$a=function(e){return e!==!1},TS=function(){return typeof window<"u"},Av=function(e){return qs(e)||Po(e)},MO=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},ta=Array.isArray,QT=/(?:-?\.?\d|\.)+/gi,IO=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,$m=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,lT=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,PO=/[+-]=-?[.\d]+/,RO=/[^,'"\[\]\s]+/gi,Y$=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,Fs,tu,eE,ES,Tl={},Dx={},DO,OO=function(e){return(Dx=p_(e,Tl))&&Wa},SS=function(e,o){return console.warn("Invalid property",e,"set to",o,"Missing plugin? gsap.registerPlugin()")},h0=function(e,o){return!o&&console.warn(e)},LO=function(e,o){return e&&(Tl[e]=o)&&Dx&&(Dx[e]=o)||Tl},d0=function(){return 0},X$={suppressEvents:!0,isStart:!0,kill:!1},ox={suppressEvents:!0,kill:!1},K$={suppressEvents:!0},AS={},hd=[],tE={},kO,hl={},cT={},o3=30,ax=[],CS="",MS=function(e){var o=e[0],u,d;if(du(o)||qs(o)||(e=[e]),!(u=(o._gsap||{}).harness)){for(d=ax.length;d--&&!ax[d].targetTest(o););u=ax[d]}for(d=e.length;d--;)e[d]&&(e[d]._gsap||(e[d]._gsap=new sL(e[d],u)))||e.splice(d,1);return e},Kf=function(e){return e._gsap||MS(Xl(e))[0]._gsap},zO=function(e,o,u){return(u=e[o])&&qs(u)?e[o]():wS(u)&&e.getAttribute&&e.getAttribute(o)||u},qa=function(e,o){return(e=e.split(",")).forEach(o)||e},Qs=function(e){return Math.round(e*1e5)/1e5||0},oo=function(e){return Math.round(e*1e7)/1e7||0},Wm=function(e,o){var u=o.charAt(0),d=parseFloat(o.substr(2));return e=parseFloat(e),u==="+"?e+d:u==="-"?e-d:u==="*"?e*d:e/d},J$=function(e,o){for(var u=o.length,d=0;e.indexOf(o[d])<0&&++d<u;);return d<u},Ox=function(){var e=hd.length,o=hd.slice(0),u,d;for(tE={},hd.length=0,u=0;u<e;u++)d=o[u],d&&d._lazy&&(d.render(d._lazy[0],d._lazy[1],!0)._lazy=0)},FO=function(e,o,u,d){hd.length&&!zo&&Ox(),e.render(o,u,d||zo&&o<0&&(e._initted||e._startAt)),hd.length&&!zo&&Ox()},BO=function(e){var o=parseFloat(e);return(o||o===0)&&(e+"").match(RO).length<2?o:Po(e)?e.trim():e},NO=function(e){return e},El=function(e,o){for(var u in o)u in e||(e[u]=o[u]);return e},Q$=function(e){return function(o,u){for(var d in u)d in o||d==="duration"&&e||d==="ease"||(o[d]=u[d])}},p_=function(e,o){for(var u in o)e[u]=o[u];return e},a3=function n(e,o){for(var u in o)u!=="__proto__"&&u!=="constructor"&&u!=="prototype"&&(e[u]=du(o[u])?n(e[u]||(e[u]={}),o[u]):o[u]);return e},Lx=function(e,o){var u={},d;for(d in e)d in o||(u[d]=e[d]);return u},jy=function(e){var o=e.parent||Fs,u=e.keyframes?Q$(ta(e.keyframes)):El;if($a(e.inherit))for(;o;)u(e,o.vars.defaults),o=o.parent||o._dp;return e},e7=function(e,o){for(var u=e.length,d=u===o.length;d&&u--&&e[u]===o[u];);return u<0},VO=function(e,o,u,d,y){u===void 0&&(u="_first"),d===void 0&&(d="_last");var v=e[d],r;if(y)for(r=o[y];v&&v[y]>r;)v=v._prev;return v?(o._next=v._next,v._next=o):(o._next=e[u],e[u]=o),o._next?o._next._prev=o:e[d]=o,o._prev=v,o.parent=o._dp=e,o},Ib=function(e,o,u,d){u===void 0&&(u="_first"),d===void 0&&(d="_last");var y=o._prev,v=o._next;y?y._next=v:e[u]===o&&(e[u]=v),v?v._prev=y:e[d]===o&&(e[d]=y),o._next=o._prev=o.parent=null},wd=function(e,o){e.parent&&(!o||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},Jf=function(e,o){if(e&&(!o||o._end>e._dur||o._start<0))for(var u=e;u;)u._dirty=1,u=u.parent;return e},t7=function(e){for(var o=e.parent;o&&o.parent;)o._dirty=1,o.totalDuration(),o=o.parent;return e},iE=function(e,o,u,d){return e._startAt&&(zo?e._startAt.revert(ox):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(o,!0,d))},i7=function n(e){return!e||e._ts&&n(e.parent)},l3=function(e){return e._repeat?m_(e._tTime,e=e.duration()+e._rDelay)*e:0},m_=function(e,o){var u=Math.floor(e=oo(e/o));return e&&u===e?u-1:u},kx=function(e,o){return(e-o._start)*o._ts+(o._ts>=0?0:o._dirty?o.totalDuration():o._tDur)},Pb=function(e){return e._end=oo(e._start+(e._tDur/Math.abs(e._ts||e._rts||us)||0))},Rb=function(e,o){var u=e._dp;return u&&u.smoothChildTiming&&e._ts&&(e._start=oo(u._time-(e._ts>0?o/e._ts:((e._dirty?e.totalDuration():e._tDur)-o)/-e._ts)),Pb(e),u._dirty||Jf(u,e)),e},UO=function(e,o){var u;if((o._time||!o._dur&&o._initted||o._start<e._time&&(o._dur||!o.add))&&(u=kx(e.rawTime(),o),(!o._dur||j0(0,o.totalDuration(),u)-o._tTime>us)&&o.render(u,!0)),Jf(e,o)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(u=e;u._dp;)u.rawTime()>=0&&u.totalTime(u._tTime),u=u._dp;e._zTime=-us}},nu=function(e,o,u,d){return o.parent&&wd(o),o._start=oo((th(u)?u:u||e!==Fs?Hl(e,u,o):e._time)+o._delay),o._end=oo(o._start+(o.totalDuration()/Math.abs(o.timeScale())||0)),VO(e,o,"_first","_last",e._sort?"_start":0),rE(o)||(e._recent=o),d||UO(e,o),e._ts<0&&Rb(e,e._tTime),e},jO=function(e,o){return(Tl.ScrollTrigger||SS("scrollTrigger",o))&&Tl.ScrollTrigger.create(o,e)},$O=function(e,o,u,d,y){if(PS(e,o,y),!e._initted)return 1;if(!u&&e._pt&&!zo&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&kO!==fl.frame)return hd.push(e),e._lazy=[y,d],1},r7=function n(e){var o=e.parent;return o&&o._ts&&o._initted&&!o._lock&&(o.rawTime()<0||n(o))},rE=function(e){var o=e.data;return o==="isFromStart"||o==="isStart"},n7=function(e,o,u,d){var y=e.ratio,v=o<0||!o&&(!e._start&&r7(e)&&!(!e._initted&&rE(e))||(e._ts<0||e._dp._ts<0)&&!rE(e))?0:1,r=e._rDelay,D=0,B,F,N;if(r&&e._repeat&&(D=j0(0,e._tDur,o),F=m_(D,r),e._yoyo&&F&1&&(v=1-v),F!==m_(e._tTime,r)&&(y=1-v,e.vars.repeatRefresh&&e._initted&&e.invalidate())),v!==y||zo||d||e._zTime===us||!o&&e._zTime){if(!e._initted&&$O(e,o,d,u,D))return;for(N=e._zTime,e._zTime=o||(u?us:0),u||(u=o&&!N),e.ratio=v,e._from&&(v=1-v),e._time=0,e._tTime=D,B=e._pt;B;)B.r(v,B.d),B=B._next;o<0&&iE(e,o,u,!0),e._onUpdate&&!u&&ml(e,"onUpdate"),D&&e._repeat&&!u&&e.parent&&ml(e,"onRepeat"),(o>=e._tDur||o<0)&&e.ratio===v&&(v&&wd(e,1),!u&&!zo&&(ml(e,v?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=o)},s7=function(e,o,u){var d;if(u>o)for(d=e._first;d&&d._start<=u;){if(d.data==="isPause"&&d._start>o)return d;d=d._next}else for(d=e._last;d&&d._start>=u;){if(d.data==="isPause"&&d._start<o)return d;d=d._prev}},__=function(e,o,u,d){var y=e._repeat,v=oo(o)||0,r=e._tTime/e._tDur;return r&&!d&&(e._time*=v/e._dur),e._dur=v,e._tDur=y?y<0?1e10:oo(v*(y+1)+e._rDelay*y):v,r>0&&!d&&Rb(e,e._tTime=e._tDur*r),e.parent&&Pb(e),u||Jf(e.parent,e),e},c3=function(e){return e instanceof Ea?Jf(e):__(e,e._dur)},o7={_start:0,endTime:d0,totalDuration:d0},Hl=function n(e,o,u){var d=e.labels,y=e._recent||o7,v=e.duration()>=Yl?y.endTime(!1):e._dur,r,D,B;return Po(o)&&(isNaN(o)||o in d)?(D=o.charAt(0),B=o.substr(-1)==="%",r=o.indexOf("="),D==="<"||D===">"?(r>=0&&(o=o.replace(/=/,"")),(D==="<"?y._start:y.endTime(y._repeat>=0))+(parseFloat(o.substr(1))||0)*(B?(r<0?y:u).totalDuration()/100:1)):r<0?(o in d||(d[o]=v),d[o]):(D=parseFloat(o.charAt(r-1)+o.substr(r+1)),B&&u&&(D=D/100*(ta(u)?u[0]:u).totalDuration()),r>1?n(e,o.substr(0,r-1),u)+D:v+D)):o==null?v:+o},$y=function(e,o,u){var d=th(o[1]),y=(d?2:1)+(e<2?0:1),v=o[y],r,D;if(d&&(v.duration=o[1]),v.parent=u,e){for(r=v,D=u;D&&!("immediateRender"in r);)r=D.vars.defaults||{},D=$a(D.vars.inherit)&&D.parent;v.immediateRender=$a(r.immediateRender),e<2?v.runBackwards=1:v.startAt=o[y-1]}return new so(o[0],v,o[y+1])},Od=function(e,o){return e||e===0?o(e):o},j0=function(e,o,u){return u<e?e:u>o?o:u},Jo=function(e,o){return!Po(e)||!(o=Y$.exec(e))?"":o[1]},a7=function(e,o,u){return Od(u,function(d){return j0(e,o,d)})},nE=[].slice,qO=function(e,o){return e&&du(e)&&"length"in e&&(!o&&!e.length||e.length-1 in e&&du(e[0]))&&!e.nodeType&&e!==tu},l7=function(e,o,u){return u===void 0&&(u=[]),e.forEach(function(d){var y;return Po(d)&&!o||qO(d,1)?(y=u).push.apply(y,Xl(d)):u.push(d)})||u},Xl=function(e,o,u){return Ms&&!o&&Ms.selector?Ms.selector(e):Po(e)&&!u&&(eE||!g_())?nE.call((o||ES).querySelectorAll(e),0):ta(e)?l7(e,u):qO(e)?nE.call(e,0):e?[e]:[]},sE=function(e){return e=Xl(e)[0]||h0("Invalid scope")||{},function(o){var u=e.current||e.nativeElement||e;return Xl(o,u.querySelectorAll?u:u===e?h0("Invalid scope")||ES.createElement("div"):e)}},HO=function(e){return e.sort(function(){return .5-Math.random()})},GO=function(e){if(qs(e))return e;var o=du(e)?e:{each:e},u=Qf(o.ease),d=o.from||0,y=parseFloat(o.base)||0,v={},r=d>0&&d<1,D=isNaN(d)||r,B=o.axis,F=d,N=d;return Po(d)?F=N={center:.5,edges:.5,end:1}[d]||0:!r&&D&&(F=d[0],N=d[1]),function(Q,q,X){var G=(X||o).length,ae=v[G],xe,Te,fe,ne,ue,ye,le,re,oe;if(!ae){if(oe=o.grid==="auto"?0:(o.grid||[1,Yl])[1],!oe){for(le=-Yl;le<(le=X[oe++].getBoundingClientRect().left)&&oe<G;);oe<G&&oe--}for(ae=v[G]=[],xe=D?Math.min(oe,G)*F-.5:d%oe,Te=oe===Yl?0:D?G*N/oe-.5:d/oe|0,le=0,re=Yl,ye=0;ye<G;ye++)fe=ye%oe-xe,ne=Te-(ye/oe|0),ae[ye]=ue=B?Math.abs(B==="y"?ne:fe):CO(fe*fe+ne*ne),ue>le&&(le=ue),ue<re&&(re=ue);d==="random"&&HO(ae),ae.max=le-re,ae.min=re,ae.v=G=(parseFloat(o.amount)||parseFloat(o.each)*(oe>G?G-1:B?B==="y"?G/oe:oe:Math.max(oe,G/oe))||0)*(d==="edges"?-1:1),ae.b=G<0?y-G:y,ae.u=Jo(o.amount||o.each)||0,u=u&&G<0?iL(u):u}return G=(ae[Q]-ae.min)/ae.max||0,oo(ae.b+(u?u(G):G)*ae.v)+ae.u}},oE=function(e){var o=Math.pow(10,((e+"").split(".")[1]||"").length);return function(u){var d=oo(Math.round(parseFloat(u)/e)*e*o);return(d-d%1)/o+(th(u)?0:Jo(u))}},WO=function(e,o){var u=ta(e),d,y;return!u&&du(e)&&(d=u=e.radius||Yl,e.values?(e=Xl(e.values),(y=!th(e[0]))&&(d*=d)):e=oE(e.increment)),Od(o,u?qs(e)?function(v){return y=e(v),Math.abs(y-v)<=d?y:v}:function(v){for(var r=parseFloat(y?v.x:v),D=parseFloat(y?v.y:0),B=Yl,F=0,N=e.length,Q,q;N--;)y?(Q=e[N].x-r,q=e[N].y-D,Q=Q*Q+q*q):Q=Math.abs(e[N]-r),Q<B&&(B=Q,F=N);return F=!d||B<=d?e[F]:v,y||F===v||th(v)?F:F+Jo(v)}:oE(e))},ZO=function(e,o,u,d){return Od(ta(e)?!o:u===!0?!!(u=0):!d,function(){return ta(e)?e[~~(Math.random()*e.length)]:(u=u||1e-5)&&(d=u<1?Math.pow(10,(u+"").length-2):1)&&Math.floor(Math.round((e-u/2+Math.random()*(o-e+u*.99))/u)*u*d)/d})},c7=function(){for(var e=arguments.length,o=new Array(e),u=0;u<e;u++)o[u]=arguments[u];return function(d){return o.reduce(function(y,v){return v(y)},d)}},u7=function(e,o){return function(u){return e(parseFloat(u))+(o||Jo(u))}},h7=function(e,o,u){return XO(e,o,0,1,u)},YO=function(e,o,u){return Od(u,function(d){return e[~~o(d)]})},d7=function n(e,o,u){var d=o-e;return ta(e)?YO(e,n(0,e.length),o):Od(u,function(y){return(d+(y-e)%d)%d+e})},f7=function n(e,o,u){var d=o-e,y=d*2;return ta(e)?YO(e,n(0,e.length-1),o):Od(u,function(v){return v=(y+(v-e)%y)%y||0,e+(v>d?y-v:v)})},f0=function(e){for(var o=0,u="",d,y,v,r;~(d=e.indexOf("random(",o));)v=e.indexOf(")",d),r=e.charAt(d+7)==="[",y=e.substr(d+7,v-d-7).match(r?RO:QT),u+=e.substr(o,d-o)+ZO(r?y:+y[0],r?0:+y[1],+y[2]||1e-5),o=v+1;return u+e.substr(o,e.length-o)},XO=function(e,o,u,d,y){var v=o-e,r=d-u;return Od(y,function(D){return u+((D-e)/v*r||0)})},p7=function n(e,o,u,d){var y=isNaN(e+o)?0:function(q){return(1-q)*e+q*o};if(!y){var v=Po(e),r={},D,B,F,N,Q;if(u===!0&&(d=1)&&(u=null),v)e={p:e},o={p:o};else if(ta(e)&&!ta(o)){for(F=[],N=e.length,Q=N-2,B=1;B<N;B++)F.push(n(e[B-1],e[B]));N--,y=function(X){X*=N;var G=Math.min(Q,~~X);return F[G](X-G)},u=o}else d||(e=p_(ta(e)?[]:{},e));if(!F){for(D in o)IS.call(r,e,D,"get",o[D]);y=function(X){return OS(X,r)||(v?e.p:e)}}}return Od(u,y)},u3=function(e,o,u){var d=e.labels,y=Yl,v,r,D;for(v in d)r=d[v]-o,r<0==!!u&&r&&y>(r=Math.abs(r))&&(D=v,y=r);return D},ml=function(e,o,u){var d=e.vars,y=d[o],v=Ms,r=e._ctx,D,B,F;if(y)return D=d[o+"Params"],B=d.callbackScope||e,u&&hd.length&&Ox(),r&&(Ms=r),F=D?y.apply(B,D):y.call(B),Ms=v,F},Iy=function(e){return wd(e),e.scrollTrigger&&e.scrollTrigger.kill(!!zo),e.progress()<1&&ml(e,"onInterrupt"),e},qm,KO=[],JO=function(e){if(e)if(e=!e.name&&e.default||e,TS()||e.headless){var o=e.name,u=qs(e),d=o&&!u&&e.init?function(){this._props=[]}:e,y={init:d0,render:OS,add:IS,kill:P7,modifier:I7,rawVars:0},v={targetTest:0,get:0,getSetter:DS,aliases:{},register:0};if(g_(),e!==d){if(hl[o])return;El(d,El(Lx(e,y),v)),p_(d.prototype,p_(y,Lx(e,v))),hl[d.prop=o]=d,e.targetTest&&(ax.push(d),AS[o]=1),o=(o==="css"?"CSS":o.charAt(0).toUpperCase()+o.substr(1))+"Plugin"}LO(o,d),e.register&&e.register(Wa,d,Ha)}else KO.push(e)},cs=255,Py={aqua:[0,cs,cs],lime:[0,cs,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,cs],navy:[0,0,128],white:[cs,cs,cs],olive:[128,128,0],yellow:[cs,cs,0],orange:[cs,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[cs,0,0],pink:[cs,192,203],cyan:[0,cs,cs],transparent:[cs,cs,cs,0]},uT=function(e,o,u){return e+=e<0?1:e>1?-1:0,(e*6<1?o+(u-o)*e*6:e<.5?u:e*3<2?o+(u-o)*(2/3-e)*6:o)*cs+.5|0},QO=function(e,o,u){var d=e?th(e)?[e>>16,e>>8&cs,e&cs]:0:Py.black,y,v,r,D,B,F,N,Q,q,X;if(!d){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),Py[e])d=Py[e];else if(e.charAt(0)==="#"){if(e.length<6&&(y=e.charAt(1),v=e.charAt(2),r=e.charAt(3),e="#"+y+y+v+v+r+r+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return d=parseInt(e.substr(1,6),16),[d>>16,d>>8&cs,d&cs,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),d=[e>>16,e>>8&cs,e&cs]}else if(e.substr(0,3)==="hsl"){if(d=X=e.match(QT),!o)D=+d[0]%360/360,B=+d[1]/100,F=+d[2]/100,v=F<=.5?F*(B+1):F+B-F*B,y=F*2-v,d.length>3&&(d[3]*=1),d[0]=uT(D+1/3,y,v),d[1]=uT(D,y,v),d[2]=uT(D-1/3,y,v);else if(~e.indexOf("="))return d=e.match(IO),u&&d.length<4&&(d[3]=1),d}else d=e.match(QT)||Py.transparent;d=d.map(Number)}return o&&!X&&(y=d[0]/cs,v=d[1]/cs,r=d[2]/cs,N=Math.max(y,v,r),Q=Math.min(y,v,r),F=(N+Q)/2,N===Q?D=B=0:(q=N-Q,B=F>.5?q/(2-N-Q):q/(N+Q),D=N===y?(v-r)/q+(v<r?6:0):N===v?(r-y)/q+2:(y-v)/q+4,D*=60),d[0]=~~(D+.5),d[1]=~~(B*100+.5),d[2]=~~(F*100+.5)),u&&d.length<4&&(d[3]=1),d},eL=function(e){var o=[],u=[],d=-1;return e.split(dd).forEach(function(y){var v=y.match($m)||[];o.push.apply(o,v),u.push(d+=v.length+1)}),o.c=u,o},h3=function(e,o,u){var d="",y=(e+d).match(dd),v=o?"hsla(":"rgba(",r=0,D,B,F,N;if(!y)return e;if(y=y.map(function(Q){return(Q=QO(Q,o,1))&&v+(o?Q[0]+","+Q[1]+"%,"+Q[2]+"%,"+Q[3]:Q.join(","))+")"}),u&&(F=eL(e),D=u.c,D.join(d)!==F.c.join(d)))for(B=e.replace(dd,"1").split($m),N=B.length-1;r<N;r++)d+=B[r]+(~D.indexOf(r)?y.shift()||v+"0,0,0,0)":(F.length?F:y.length?y:u).shift());if(!B)for(B=e.split(dd),N=B.length-1;r<N;r++)d+=B[r]+y[r];return d+B[N]},dd=function(){var n="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in Py)n+="|"+e+"\\b";return new RegExp(n+")","gi")}(),m7=/hsl[a]?\(/,tL=function(e){var o=e.join(" "),u;if(dd.lastIndex=0,dd.test(o))return u=m7.test(o),e[1]=h3(e[1],u),e[0]=h3(e[0],u,eL(e[1])),!0},p0,fl=function(){var n=Date.now,e=500,o=33,u=n(),d=u,y=1e3/240,v=y,r=[],D,B,F,N,Q,q,X=function G(ae){var xe=n()-d,Te=ae===!0,fe,ne,ue,ye;if((xe>e||xe<0)&&(u+=xe-o),d+=xe,ue=d-u,fe=ue-v,(fe>0||Te)&&(ye=++N.frame,Q=ue-N.time*1e3,N.time=ue=ue/1e3,v+=fe+(fe>=y?4:y-fe),ne=1),Te||(D=B(G)),ne)for(q=0;q<r.length;q++)r[q](ue,Q,ye,ae)};return N={time:0,frame:0,tick:function(){X(!0)},deltaRatio:function(ae){return Q/(1e3/(ae||60))},wake:function(){DO&&(!eE&&TS()&&(tu=eE=window,ES=tu.document||{},Tl.gsap=Wa,(tu.gsapVersions||(tu.gsapVersions=[])).push(Wa.version),OO(Dx||tu.GreenSockGlobals||!tu.gsap&&tu||{}),KO.forEach(JO)),F=typeof requestAnimationFrame<"u"&&requestAnimationFrame,D&&N.sleep(),B=F||function(ae){return setTimeout(ae,v-N.time*1e3+1|0)},p0=1,X(2))},sleep:function(){(F?cancelAnimationFrame:clearTimeout)(D),p0=0,B=d0},lagSmoothing:function(ae,xe){e=ae||1/0,o=Math.min(xe||33,e)},fps:function(ae){y=1e3/(ae||240),v=N.time*1e3+y},add:function(ae,xe,Te){var fe=xe?function(ne,ue,ye,le){ae(ne,ue,ye,le),N.remove(fe)}:ae;return N.remove(ae),r[Te?"unshift":"push"](fe),g_(),fe},remove:function(ae,xe){~(xe=r.indexOf(ae))&&r.splice(xe,1)&&q>=xe&&q--},_listeners:r},N}(),g_=function(){return!p0&&fl.wake()},Sn={},_7=/^[\d.\-M][\d.\-,\s]/,g7=/["']/g,y7=function(e){for(var o={},u=e.substr(1,e.length-3).split(":"),d=u[0],y=1,v=u.length,r,D,B;y<v;y++)D=u[y],r=y!==v-1?D.lastIndexOf(","):D.length,B=D.substr(0,r),o[d]=isNaN(B)?B.replace(g7,"").trim():+B,d=D.substr(r+1).trim();return o},v7=function(e){var o=e.indexOf("(")+1,u=e.indexOf(")"),d=e.indexOf("(",o);return e.substring(o,~d&&d<u?e.indexOf(")",u+1):u)},x7=function(e){var o=(e+"").split("("),u=Sn[o[0]];return u&&o.length>1&&u.config?u.config.apply(null,~e.indexOf("{")?[y7(o[1])]:v7(e).split(",").map(BO)):Sn._CE&&_7.test(e)?Sn._CE("",e):u},iL=function(e){return function(o){return 1-e(1-o)}},rL=function n(e,o){for(var u=e._first,d;u;)u instanceof Ea?n(u,o):u.vars.yoyoEase&&(!u._yoyo||!u._repeat)&&u._yoyo!==o&&(u.timeline?n(u.timeline,o):(d=u._ease,u._ease=u._yEase,u._yEase=d,u._yoyo=o)),u=u._next},Qf=function(e,o){return e&&(qs(e)?e:Sn[e]||x7(e))||o},wp=function(e,o,u,d){u===void 0&&(u=function(D){return 1-o(1-D)}),d===void 0&&(d=function(D){return D<.5?o(D*2)/2:1-o((1-D)*2)/2});var y={easeIn:o,easeOut:u,easeInOut:d},v;return qa(e,function(r){Sn[r]=Tl[r]=y,Sn[v=r.toLowerCase()]=u;for(var D in y)Sn[v+(D==="easeIn"?".in":D==="easeOut"?".out":".inOut")]=Sn[r+"."+D]=y[D]}),y},nL=function(e){return function(o){return o<.5?(1-e(1-o*2))/2:.5+e((o-.5)*2)/2}},hT=function n(e,o,u){var d=o>=1?o:1,y=(u||(e?.3:.45))/(o<1?o:1),v=y/JT*(Math.asin(1/d)||0),r=function(F){return F===1?1:d*Math.pow(2,-10*F)*Z$((F-v)*y)+1},D=e==="out"?r:e==="in"?function(B){return 1-r(1-B)}:nL(r);return y=JT/y,D.config=function(B,F){return n(e,B,F)},D},dT=function n(e,o){o===void 0&&(o=1.70158);var u=function(v){return v?--v*v*((o+1)*v+o)+1:0},d=e==="out"?u:e==="in"?function(y){return 1-u(1-y)}:nL(u);return d.config=function(y){return n(e,y)},d};qa("Linear,Quad,Cubic,Quart,Quint,Strong",function(n,e){var o=e<5?e+1:e;wp(n+",Power"+(o-1),e?function(u){return Math.pow(u,o)}:function(u){return u},function(u){return 1-Math.pow(1-u,o)},function(u){return u<.5?Math.pow(u*2,o)/2:1-Math.pow((1-u)*2,o)/2})});Sn.Linear.easeNone=Sn.none=Sn.Linear.easeIn;wp("Elastic",hT("in"),hT("out"),hT());(function(n,e){var o=1/e,u=2*o,d=2.5*o,y=function(r){return r<o?n*r*r:r<u?n*Math.pow(r-1.5/e,2)+.75:r<d?n*(r-=2.25/e)*r+.9375:n*Math.pow(r-2.625/e,2)+.984375};wp("Bounce",function(v){return 1-y(1-v)},y)})(7.5625,2.75);wp("Expo",function(n){return Math.pow(2,10*(n-1))*n+n*n*n*n*n*n*(1-n)});wp("Circ",function(n){return-(CO(1-n*n)-1)});wp("Sine",function(n){return n===1?1:-W$(n*H$)+1});wp("Back",dT("in"),dT("out"),dT());Sn.SteppedEase=Sn.steps=Tl.SteppedEase={config:function(e,o){e===void 0&&(e=1);var u=1/e,d=e+(o?0:1),y=o?1:0,v=1-us;return function(r){return((d*j0(0,v,r)|0)+y)*u}}};f_.ease=Sn["quad.out"];qa("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(n){return CS+=n+","+n+"Params,"});var sL=function(e,o){this.id=G$++,e._gsap=this,this.target=e,this.harness=o,this.get=o?o.get:zO,this.set=o?o.getSetter:DS},m0=function(){function n(o){this.vars=o,this._delay=+o.delay||0,(this._repeat=o.repeat===1/0?-2:o.repeat||0)&&(this._rDelay=o.repeatDelay||0,this._yoyo=!!o.yoyo||!!o.yoyoEase),this._ts=1,__(this,+o.duration,1,1),this.data=o.data,Ms&&(this._ctx=Ms,Ms.data.push(this)),p0||fl.wake()}var e=n.prototype;return e.delay=function(u){return u||u===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+u-this._delay),this._delay=u,this):this._delay},e.duration=function(u){return arguments.length?this.totalDuration(this._repeat>0?u+(u+this._rDelay)*this._repeat:u):this.totalDuration()&&this._dur},e.totalDuration=function(u){return arguments.length?(this._dirty=0,__(this,this._repeat<0?u:(u-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(u,d){if(g_(),!arguments.length)return this._tTime;var y=this._dp;if(y&&y.smoothChildTiming&&this._ts){for(Rb(this,u),!y._dp||y.parent||UO(y,this);y&&y.parent;)y.parent._time!==y._start+(y._ts>=0?y._tTime/y._ts:(y.totalDuration()-y._tTime)/-y._ts)&&y.totalTime(y._tTime,!0),y=y.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&u<this._tDur||this._ts<0&&u>0||!this._tDur&&!u)&&nu(this._dp,this,this._start-this._delay)}return(this._tTime!==u||!this._dur&&!d||this._initted&&Math.abs(this._zTime)===us||!u&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=u),FO(this,u,d)),this},e.time=function(u,d){return arguments.length?this.totalTime(Math.min(this.totalDuration(),u+l3(this))%(this._dur+this._rDelay)||(u?this._dur:0),d):this._time},e.totalProgress=function(u,d){return arguments.length?this.totalTime(this.totalDuration()*u,d):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},e.progress=function(u,d){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-u:u)+l3(this),d):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(u,d){var y=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(u-1)*y,d):this._repeat?m_(this._tTime,y)+1:1},e.timeScale=function(u,d){if(!arguments.length)return this._rts===-us?0:this._rts;if(this._rts===u)return this;var y=this.parent&&this._ts?kx(this.parent._time,this):this._tTime;return this._rts=+u||0,this._ts=this._ps||u===-us?0:this._rts,this.totalTime(j0(-Math.abs(this._delay),this._tDur,y),d!==!1),Pb(this),t7(this)},e.paused=function(u){return arguments.length?(this._ps!==u&&(this._ps=u,u?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(g_(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==us&&(this._tTime-=us)))),this):this._ps},e.startTime=function(u){if(arguments.length){this._start=u;var d=this.parent||this._dp;return d&&(d._sort||!this.parent)&&nu(d,this,u-this._delay),this}return this._start},e.endTime=function(u){return this._start+($a(u)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(u){var d=this.parent||this._dp;return d?u&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?kx(d.rawTime(u),this):this._tTime:this._tTime},e.revert=function(u){u===void 0&&(u=K$);var d=zo;return zo=u,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(u),this.totalTime(-.01,u.suppressEvents)),this.data!=="nested"&&u.kill!==!1&&this.kill(),zo=d,this},e.globalTime=function(u){for(var d=this,y=arguments.length?u:d.rawTime();d;)y=d._start+y/(Math.abs(d._ts)||1),d=d._dp;return!this.parent&&this._sat?this._sat.globalTime(u):y},e.repeat=function(u){return arguments.length?(this._repeat=u===1/0?-2:u,c3(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(u){if(arguments.length){var d=this._time;return this._rDelay=u,c3(this),d?this.time(d):this}return this._rDelay},e.yoyo=function(u){return arguments.length?(this._yoyo=u,this):this._yoyo},e.seek=function(u,d){return this.totalTime(Hl(this,u),$a(d))},e.restart=function(u,d){return this.play().totalTime(u?-this._delay:0,$a(d)),this._dur||(this._zTime=-us),this},e.play=function(u,d){return u!=null&&this.seek(u,d),this.reversed(!1).paused(!1)},e.reverse=function(u,d){return u!=null&&this.seek(u||this.totalDuration(),d),this.reversed(!0).paused(!1)},e.pause=function(u,d){return u!=null&&this.seek(u,d),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(u){return arguments.length?(!!u!==this.reversed()&&this.timeScale(-this._rts||(u?-us:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-us,this},e.isActive=function(){var u=this.parent||this._dp,d=this._start,y;return!!(!u||this._ts&&this._initted&&u.isActive()&&(y=u.rawTime(!0))>=d&&y<this.endTime(!0)-us)},e.eventCallback=function(u,d,y){var v=this.vars;return arguments.length>1?(d?(v[u]=d,y&&(v[u+"Params"]=y),u==="onUpdate"&&(this._onUpdate=d)):delete v[u],this):v[u]},e.then=function(u){var d=this;return new Promise(function(y){var v=qs(u)?u:NO,r=function(){var B=d.then;d.then=null,qs(v)&&(v=v(d))&&(v.then||v===d)&&(d.then=B),y(v),d.then=B};d._initted&&d.totalProgress()===1&&d._ts>=0||!d._tTime&&d._ts<0?r():d._prom=r})},e.kill=function(){Iy(this)},n}();El(m0.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-us,_prom:0,_ps:!1,_rts:1});var Ea=function(n){AO(e,n);function e(u,d){var y;return u===void 0&&(u={}),y=n.call(this,u)||this,y.labels={},y.smoothChildTiming=!!u.smoothChildTiming,y.autoRemoveChildren=!!u.autoRemoveChildren,y._sort=$a(u.sortChildren),Fs&&nu(u.parent||Fs,ju(y),d),u.reversed&&y.reverse(),u.paused&&y.paused(!0),u.scrollTrigger&&jO(ju(y),u.scrollTrigger),y}var o=e.prototype;return o.to=function(d,y,v){return $y(0,arguments,this),this},o.from=function(d,y,v){return $y(1,arguments,this),this},o.fromTo=function(d,y,v,r){return $y(2,arguments,this),this},o.set=function(d,y,v){return y.duration=0,y.parent=this,jy(y).repeatDelay||(y.repeat=0),y.immediateRender=!!y.immediateRender,new so(d,y,Hl(this,v),1),this},o.call=function(d,y,v){return nu(this,so.delayedCall(0,d,y),v)},o.staggerTo=function(d,y,v,r,D,B,F){return v.duration=y,v.stagger=v.stagger||r,v.onComplete=B,v.onCompleteParams=F,v.parent=this,new so(d,v,Hl(this,D)),this},o.staggerFrom=function(d,y,v,r,D,B,F){return v.runBackwards=1,jy(v).immediateRender=$a(v.immediateRender),this.staggerTo(d,y,v,r,D,B,F)},o.staggerFromTo=function(d,y,v,r,D,B,F,N){return r.startAt=v,jy(r).immediateRender=$a(r.immediateRender),this.staggerTo(d,y,r,D,B,F,N)},o.render=function(d,y,v){var r=this._time,D=this._dirty?this.totalDuration():this._tDur,B=this._dur,F=d<=0?0:oo(d),N=this._zTime<0!=d<0&&(this._initted||!B),Q,q,X,G,ae,xe,Te,fe,ne,ue,ye,le;if(this!==Fs&&F>D&&d>=0&&(F=D),F!==this._tTime||v||N){if(r!==this._time&&B&&(F+=this._time-r,d+=this._time-r),Q=F,ne=this._start,fe=this._ts,xe=!fe,N&&(B||(r=this._zTime),(d||!y)&&(this._zTime=d)),this._repeat){if(ye=this._yoyo,ae=B+this._rDelay,this._repeat<-1&&d<0)return this.totalTime(ae*100+d,y,v);if(Q=oo(F%ae),F===D?(G=this._repeat,Q=B):(ue=oo(F/ae),G=~~ue,G&&G===ue&&(Q=B,G--),Q>B&&(Q=B)),ue=m_(this._tTime,ae),!r&&this._tTime&&ue!==G&&this._tTime-ue*ae-this._dur<=0&&(ue=G),ye&&G&1&&(Q=B-Q,le=1),G!==ue&&!this._lock){var re=ye&&ue&1,oe=re===(ye&&G&1);if(G<ue&&(re=!re),r=re?0:F%B?B:F,this._lock=1,this.render(r||(le?0:oo(G*ae)),y,!B)._lock=0,this._tTime=F,!y&&this.parent&&ml(this,"onRepeat"),this.vars.repeatRefresh&&!le&&(this.invalidate()._lock=1),r&&r!==this._time||xe!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(B=this._dur,D=this._tDur,oe&&(this._lock=2,r=re?B:-1e-4,this.render(r,!0),this.vars.repeatRefresh&&!le&&this.invalidate()),this._lock=0,!this._ts&&!xe)return this;rL(this,le)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(Te=s7(this,oo(r),oo(Q)),Te&&(F-=Q-(Q=Te._start))),this._tTime=F,this._time=Q,this._act=!fe,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=d,r=0),!r&&Q&&!y&&!G&&(ml(this,"onStart"),this._tTime!==F))return this;if(Q>=r&&d>=0)for(q=this._first;q;){if(X=q._next,(q._act||Q>=q._start)&&q._ts&&Te!==q){if(q.parent!==this)return this.render(d,y,v);if(q.render(q._ts>0?(Q-q._start)*q._ts:(q._dirty?q.totalDuration():q._tDur)+(Q-q._start)*q._ts,y,v),Q!==this._time||!this._ts&&!xe){Te=0,X&&(F+=this._zTime=-us);break}}q=X}else{q=this._last;for(var se=d<0?d:Q;q;){if(X=q._prev,(q._act||se<=q._end)&&q._ts&&Te!==q){if(q.parent!==this)return this.render(d,y,v);if(q.render(q._ts>0?(se-q._start)*q._ts:(q._dirty?q.totalDuration():q._tDur)+(se-q._start)*q._ts,y,v||zo&&(q._initted||q._startAt)),Q!==this._time||!this._ts&&!xe){Te=0,X&&(F+=this._zTime=se?-us:us);break}}q=X}}if(Te&&!y&&(this.pause(),Te.render(Q>=r?0:-us)._zTime=Q>=r?1:-1,this._ts))return this._start=ne,Pb(this),this.render(d,y,v);this._onUpdate&&!y&&ml(this,"onUpdate",!0),(F===D&&this._tTime>=this.totalDuration()||!F&&r)&&(ne===this._start||Math.abs(fe)!==Math.abs(this._ts))&&(this._lock||((d||!B)&&(F===D&&this._ts>0||!F&&this._ts<0)&&wd(this,1),!y&&!(d<0&&!r)&&(F||r||!D)&&(ml(this,F===D&&d>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(F<D&&this.timeScale()>0)&&this._prom())))}return this},o.add=function(d,y){var v=this;if(th(y)||(y=Hl(this,y,d)),!(d instanceof m0)){if(ta(d))return d.forEach(function(r){return v.add(r,y)}),this;if(Po(d))return this.addLabel(d,y);if(qs(d))d=so.delayedCall(0,d);else return this}return this!==d?nu(this,d,y):this},o.getChildren=function(d,y,v,r){d===void 0&&(d=!0),y===void 0&&(y=!0),v===void 0&&(v=!0),r===void 0&&(r=-Yl);for(var D=[],B=this._first;B;)B._start>=r&&(B instanceof so?y&&D.push(B):(v&&D.push(B),d&&D.push.apply(D,B.getChildren(!0,y,v)))),B=B._next;return D},o.getById=function(d){for(var y=this.getChildren(1,1,1),v=y.length;v--;)if(y[v].vars.id===d)return y[v]},o.remove=function(d){return Po(d)?this.removeLabel(d):qs(d)?this.killTweensOf(d):(d.parent===this&&Ib(this,d),d===this._recent&&(this._recent=this._last),Jf(this))},o.totalTime=function(d,y){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=oo(fl.time-(this._ts>0?d/this._ts:(this.totalDuration()-d)/-this._ts))),n.prototype.totalTime.call(this,d,y),this._forcing=0,this):this._tTime},o.addLabel=function(d,y){return this.labels[d]=Hl(this,y),this},o.removeLabel=function(d){return delete this.labels[d],this},o.addPause=function(d,y,v){var r=so.delayedCall(0,y||d0,v);return r.data="isPause",this._hasPause=1,nu(this,r,Hl(this,d))},o.removePause=function(d){var y=this._first;for(d=Hl(this,d);y;)y._start===d&&y.data==="isPause"&&wd(y),y=y._next},o.killTweensOf=function(d,y,v){for(var r=this.getTweensOf(d,v),D=r.length;D--;)od!==r[D]&&r[D].kill(d,y);return this},o.getTweensOf=function(d,y){for(var v=[],r=Xl(d),D=this._first,B=th(y),F;D;)D instanceof so?J$(D._targets,r)&&(B?(!od||D._initted&&D._ts)&&D.globalTime(0)<=y&&D.globalTime(D.totalDuration())>y:!y||D.isActive())&&v.push(D):(F=D.getTweensOf(r,y)).length&&v.push.apply(v,F),D=D._next;return v},o.tweenTo=function(d,y){y=y||{};var v=this,r=Hl(v,d),D=y,B=D.startAt,F=D.onStart,N=D.onStartParams,Q=D.immediateRender,q,X=so.to(v,El({ease:y.ease||"none",lazy:!1,immediateRender:!1,time:r,overwrite:"auto",duration:y.duration||Math.abs((r-(B&&"time"in B?B.time:v._time))/v.timeScale())||us,onStart:function(){if(v.pause(),!q){var ae=y.duration||Math.abs((r-(B&&"time"in B?B.time:v._time))/v.timeScale());X._dur!==ae&&__(X,ae,0,1).render(X._time,!0,!0),q=1}F&&F.apply(X,N||[])}},y));return Q?X.render(0):X},o.tweenFromTo=function(d,y,v){return this.tweenTo(y,El({startAt:{time:Hl(this,d)}},v))},o.recent=function(){return this._recent},o.nextLabel=function(d){return d===void 0&&(d=this._time),u3(this,Hl(this,d))},o.previousLabel=function(d){return d===void 0&&(d=this._time),u3(this,Hl(this,d),1)},o.currentLabel=function(d){return arguments.length?this.seek(d,!0):this.previousLabel(this._time+us)},o.shiftChildren=function(d,y,v){v===void 0&&(v=0);for(var r=this._first,D=this.labels,B;r;)r._start>=v&&(r._start+=d,r._end+=d),r=r._next;if(y)for(B in D)D[B]>=v&&(D[B]+=d);return Jf(this)},o.invalidate=function(d){var y=this._first;for(this._lock=0;y;)y.invalidate(d),y=y._next;return n.prototype.invalidate.call(this,d)},o.clear=function(d){d===void 0&&(d=!0);for(var y=this._first,v;y;)v=y._next,this.remove(y),y=v;return this._dp&&(this._time=this._tTime=this._pTime=0),d&&(this.labels={}),Jf(this)},o.totalDuration=function(d){var y=0,v=this,r=v._last,D=Yl,B,F,N;if(arguments.length)return v.timeScale((v._repeat<0?v.duration():v.totalDuration())/(v.reversed()?-d:d));if(v._dirty){for(N=v.parent;r;)B=r._prev,r._dirty&&r.totalDuration(),F=r._start,F>D&&v._sort&&r._ts&&!v._lock?(v._lock=1,nu(v,r,F-r._delay,1)._lock=0):D=F,F<0&&r._ts&&(y-=F,(!N&&!v._dp||N&&N.smoothChildTiming)&&(v._start+=F/v._ts,v._time-=F,v._tTime-=F),v.shiftChildren(-F,!1,-1/0),D=0),r._end>y&&r._ts&&(y=r._end),r=B;__(v,v===Fs&&v._time>y?v._time:y,1,1),v._dirty=0}return v._tDur},e.updateRoot=function(d){if(Fs._ts&&(FO(Fs,kx(d,Fs)),kO=fl.frame),fl.frame>=o3){o3+=yl.autoSleep||120;var y=Fs._first;if((!y||!y._ts)&&yl.autoSleep&&fl._listeners.length<2){for(;y&&!y._ts;)y=y._next;y||fl.sleep()}}},e}(m0);El(Ea.prototype,{_lock:0,_hasPause:0,_forcing:0});var b7=function(e,o,u,d,y,v,r){var D=new Ha(this._pt,e,o,0,1,hL,null,y),B=0,F=0,N,Q,q,X,G,ae,xe,Te;for(D.b=u,D.e=d,u+="",d+="",(xe=~d.indexOf("random("))&&(d=f0(d)),v&&(Te=[u,d],v(Te,e,o),u=Te[0],d=Te[1]),Q=u.match(lT)||[];N=lT.exec(d);)X=N[0],G=d.substring(B,N.index),q?q=(q+1)%5:G.substr(-5)==="rgba("&&(q=1),X!==Q[F++]&&(ae=parseFloat(Q[F-1])||0,D._pt={_next:D._pt,p:G||F===1?G:",",s:ae,c:X.charAt(1)==="="?Wm(ae,X)-ae:parseFloat(X)-ae,m:q&&q<4?Math.round:0},B=lT.lastIndex);return D.c=B<d.length?d.substring(B,d.length):"",D.fp=r,(PO.test(d)||xe)&&(D.e=0),this._pt=D,D},IS=function(e,o,u,d,y,v,r,D,B,F){qs(d)&&(d=d(y||0,e,v));var N=e[o],Q=u!=="get"?u:qs(N)?B?e[o.indexOf("set")||!qs(e["get"+o.substr(3)])?o:"get"+o.substr(3)](B):e[o]():N,q=qs(N)?B?A7:cL:RS,X;if(Po(d)&&(~d.indexOf("random(")&&(d=f0(d)),d.charAt(1)==="="&&(X=Wm(Q,d)+(Jo(Q)||0),(X||X===0)&&(d=X))),!F||Q!==d||aE)return!isNaN(Q*d)&&d!==""?(X=new Ha(this._pt,e,o,+Q||0,d-(Q||0),typeof N=="boolean"?M7:uL,0,q),B&&(X.fp=B),r&&X.modifier(r,this,e),this._pt=X):(!N&&!(o in e)&&SS(o,d),b7.call(this,e,o,Q,d,q,D||yl.stringFilter,B))},w7=function(e,o,u,d,y){if(qs(e)&&(e=qy(e,y,o,u,d)),!du(e)||e.style&&e.nodeType||ta(e)||MO(e))return Po(e)?qy(e,y,o,u,d):e;var v={},r;for(r in e)v[r]=qy(e[r],y,o,u,d);return v},oL=function(e,o,u,d,y,v){var r,D,B,F;if(hl[e]&&(r=new hl[e]).init(y,r.rawVars?o[e]:w7(o[e],d,y,v,u),u,d,v)!==!1&&(u._pt=D=new Ha(u._pt,y,e,0,1,r.render,r,0,r.priority),u!==qm))for(B=u._ptLookup[u._targets.indexOf(y)],F=r._props.length;F--;)B[r._props[F]]=D;return r},od,aE,PS=function n(e,o,u){var d=e.vars,y=d.ease,v=d.startAt,r=d.immediateRender,D=d.lazy,B=d.onUpdate,F=d.runBackwards,N=d.yoyoEase,Q=d.keyframes,q=d.autoRevert,X=e._dur,G=e._startAt,ae=e._targets,xe=e.parent,Te=xe&&xe.data==="nested"?xe.vars.targets:ae,fe=e._overwrite==="auto"&&!bS,ne=e.timeline,ue,ye,le,re,oe,se,Ae,De,Ge,yt,ct,mt,et;if(ne&&(!Q||!y)&&(y="none"),e._ease=Qf(y,f_.ease),e._yEase=N?iL(Qf(N===!0?y:N,f_.ease)):0,N&&e._yoyo&&!e._repeat&&(N=e._yEase,e._yEase=e._ease,e._ease=N),e._from=!ne&&!!d.runBackwards,!ne||Q&&!d.stagger){if(De=ae[0]?Kf(ae[0]).harness:0,mt=De&&d[De.prop],ue=Lx(d,AS),G&&(G._zTime<0&&G.progress(1),o<0&&F&&r&&!q?G.render(-1,!0):G.revert(F&&X?ox:X$),G._lazy=0),v){if(wd(e._startAt=so.set(ae,El({data:"isStart",overwrite:!1,parent:xe,immediateRender:!0,lazy:!G&&$a(D),startAt:null,delay:0,onUpdate:B&&function(){return ml(e,"onUpdate")},stagger:0},v))),e._startAt._dp=0,e._startAt._sat=e,o<0&&(zo||!r&&!q)&&e._startAt.revert(ox),r&&X&&o<=0&&u<=0){o&&(e._zTime=o);return}}else if(F&&X&&!G){if(o&&(r=!1),le=El({overwrite:!1,data:"isFromStart",lazy:r&&!G&&$a(D),immediateRender:r,stagger:0,parent:xe},ue),mt&&(le[De.prop]=mt),wd(e._startAt=so.set(ae,le)),e._startAt._dp=0,e._startAt._sat=e,o<0&&(zo?e._startAt.revert(ox):e._startAt.render(-1,!0)),e._zTime=o,!r)n(e._startAt,us,us);else if(!o)return}for(e._pt=e._ptCache=0,D=X&&$a(D)||D&&!X,ye=0;ye<ae.length;ye++){if(oe=ae[ye],Ae=oe._gsap||MS(ae)[ye]._gsap,e._ptLookup[ye]=yt={},tE[Ae.id]&&hd.length&&Ox(),ct=Te===ae?ye:Te.indexOf(oe),De&&(Ge=new De).init(oe,mt||ue,e,ct,Te)!==!1&&(e._pt=re=new Ha(e._pt,oe,Ge.name,0,1,Ge.render,Ge,0,Ge.priority),Ge._props.forEach(function(Qe){yt[Qe]=re}),Ge.priority&&(se=1)),!De||mt)for(le in ue)hl[le]&&(Ge=oL(le,ue,e,ct,oe,Te))?Ge.priority&&(se=1):yt[le]=re=IS.call(e,oe,le,"get",ue[le],ct,Te,0,d.stringFilter);e._op&&e._op[ye]&&e.kill(oe,e._op[ye]),fe&&e._pt&&(od=e,Fs.killTweensOf(oe,yt,e.globalTime(o)),et=!e.parent,od=0),e._pt&&D&&(tE[Ae.id]=1)}se&&dL(e),e._onInit&&e._onInit(e)}e._onUpdate=B,e._initted=(!e._op||e._pt)&&!et,Q&&o<=0&&ne.render(Yl,!0,!0)},T7=function(e,o,u,d,y,v,r,D){var B=(e._pt&&e._ptCache||(e._ptCache={}))[o],F,N,Q,q;if(!B)for(B=e._ptCache[o]=[],Q=e._ptLookup,q=e._targets.length;q--;){if(F=Q[q][o],F&&F.d&&F.d._pt)for(F=F.d._pt;F&&F.p!==o&&F.fp!==o;)F=F._next;if(!F)return aE=1,e.vars[o]="+=0",PS(e,r),aE=0,D?h0(o+" not eligible for reset"):1;B.push(F)}for(q=B.length;q--;)N=B[q],F=N._pt||N,F.s=(d||d===0)&&!y?d:F.s+(d||0)+v*F.c,F.c=u-F.s,N.e&&(N.e=Qs(u)+Jo(N.e)),N.b&&(N.b=F.s+Jo(N.b))},E7=function(e,o){var u=e[0]?Kf(e[0]).harness:0,d=u&&u.aliases,y,v,r,D;if(!d)return o;y=p_({},o);for(v in d)if(v in y)for(D=d[v].split(","),r=D.length;r--;)y[D[r]]=y[v];return y},S7=function(e,o,u,d){var y=o.ease||d||"power1.inOut",v,r;if(ta(o))r=u[e]||(u[e]=[]),o.forEach(function(D,B){return r.push({t:B/(o.length-1)*100,v:D,e:y})});else for(v in o)r=u[v]||(u[v]=[]),v==="ease"||r.push({t:parseFloat(e),v:o[v],e:y})},qy=function(e,o,u,d,y){return qs(e)?e.call(o,u,d,y):Po(e)&&~e.indexOf("random(")?f0(e):e},aL=CS+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",lL={};qa(aL+",id,stagger,delay,duration,paused,scrollTrigger",function(n){return lL[n]=1});var so=function(n){AO(e,n);function e(u,d,y,v){var r;typeof d=="number"&&(y.duration=d,d=y,y=null),r=n.call(this,v?d:jy(d))||this;var D=r.vars,B=D.duration,F=D.delay,N=D.immediateRender,Q=D.stagger,q=D.overwrite,X=D.keyframes,G=D.defaults,ae=D.scrollTrigger,xe=D.yoyoEase,Te=d.parent||Fs,fe=(ta(u)||MO(u)?th(u[0]):"length"in d)?[u]:Xl(u),ne,ue,ye,le,re,oe,se,Ae;if(r._targets=fe.length?MS(fe):h0("GSAP target "+u+" not found. https://gsap.com",!yl.nullTargetWarn)||[],r._ptLookup=[],r._overwrite=q,X||Q||Av(B)||Av(F)){if(d=r.vars,ne=r.timeline=new Ea({data:"nested",defaults:G||{},targets:Te&&Te.data==="nested"?Te.vars.targets:fe}),ne.kill(),ne.parent=ne._dp=ju(r),ne._start=0,Q||Av(B)||Av(F)){if(le=fe.length,se=Q&&GO(Q),du(Q))for(re in Q)~aL.indexOf(re)&&(Ae||(Ae={}),Ae[re]=Q[re]);for(ue=0;ue<le;ue++)ye=Lx(d,lL),ye.stagger=0,xe&&(ye.yoyoEase=xe),Ae&&p_(ye,Ae),oe=fe[ue],ye.duration=+qy(B,ju(r),ue,oe,fe),ye.delay=(+qy(F,ju(r),ue,oe,fe)||0)-r._delay,!Q&&le===1&&ye.delay&&(r._delay=F=ye.delay,r._start+=F,ye.delay=0),ne.to(oe,ye,se?se(ue,oe,fe):0),ne._ease=Sn.none;ne.duration()?B=F=0:r.timeline=0}else if(X){jy(El(ne.vars.defaults,{ease:"none"})),ne._ease=Qf(X.ease||d.ease||"none");var De=0,Ge,yt,ct;if(ta(X))X.forEach(function(mt){return ne.to(fe,mt,">")}),ne.duration();else{ye={};for(re in X)re==="ease"||re==="easeEach"||S7(re,X[re],ye,X.easeEach);for(re in ye)for(Ge=ye[re].sort(function(mt,et){return mt.t-et.t}),De=0,ue=0;ue<Ge.length;ue++)yt=Ge[ue],ct={ease:yt.e,duration:(yt.t-(ue?Ge[ue-1].t:0))/100*B},ct[re]=yt.v,ne.to(fe,ct,De),De+=ct.duration;ne.duration()<B&&ne.to({},{duration:B-ne.duration()})}}B||r.duration(B=ne.duration())}else r.timeline=0;return q===!0&&!bS&&(od=ju(r),Fs.killTweensOf(fe),od=0),nu(Te,ju(r),y),d.reversed&&r.reverse(),d.paused&&r.paused(!0),(N||!B&&!X&&r._start===oo(Te._time)&&$a(N)&&i7(ju(r))&&Te.data!=="nested")&&(r._tTime=-us,r.render(Math.max(0,-F)||0)),ae&&jO(ju(r),ae),r}var o=e.prototype;return o.render=function(d,y,v){var r=this._time,D=this._tDur,B=this._dur,F=d<0,N=d>D-us&&!F?D:d<us?0:d,Q,q,X,G,ae,xe,Te,fe,ne;if(!B)n7(this,d,y,v);else if(N!==this._tTime||!d||v||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==F||this._lazy){if(Q=N,fe=this.timeline,this._repeat){if(G=B+this._rDelay,this._repeat<-1&&F)return this.totalTime(G*100+d,y,v);if(Q=oo(N%G),N===D?(X=this._repeat,Q=B):(ae=oo(N/G),X=~~ae,X&&X===ae?(Q=B,X--):Q>B&&(Q=B)),xe=this._yoyo&&X&1,xe&&(ne=this._yEase,Q=B-Q),ae=m_(this._tTime,G),Q===r&&!v&&this._initted&&X===ae)return this._tTime=N,this;X!==ae&&(fe&&this._yEase&&rL(fe,xe),this.vars.repeatRefresh&&!xe&&!this._lock&&Q!==G&&this._initted&&(this._lock=v=1,this.render(oo(G*X),!0).invalidate()._lock=0))}if(!this._initted){if($O(this,F?d:Q,v,y,N))return this._tTime=0,this;if(r!==this._time&&!(v&&this.vars.repeatRefresh&&X!==ae))return this;if(B!==this._dur)return this.render(d,y,v)}if(this._tTime=N,this._time=Q,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=Te=(ne||this._ease)(Q/B),this._from&&(this.ratio=Te=1-Te),Q&&!r&&!y&&!X&&(ml(this,"onStart"),this._tTime!==N))return this;for(q=this._pt;q;)q.r(Te,q.d),q=q._next;fe&&fe.render(d<0?d:fe._dur*fe._ease(Q/this._dur),y,v)||this._startAt&&(this._zTime=d),this._onUpdate&&!y&&(F&&iE(this,d,y,v),ml(this,"onUpdate")),this._repeat&&X!==ae&&this.vars.onRepeat&&!y&&this.parent&&ml(this,"onRepeat"),(N===this._tDur||!N)&&this._tTime===N&&(F&&!this._onUpdate&&iE(this,d,!0,!0),(d||!B)&&(N===this._tDur&&this._ts>0||!N&&this._ts<0)&&wd(this,1),!y&&!(F&&!r)&&(N||r||xe)&&(ml(this,N===D?"onComplete":"onReverseComplete",!0),this._prom&&!(N<D&&this.timeScale()>0)&&this._prom()))}return this},o.targets=function(){return this._targets},o.invalidate=function(d){return(!d||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(d),n.prototype.invalidate.call(this,d)},o.resetTo=function(d,y,v,r,D){p0||fl.wake(),this._ts||this.play();var B=Math.min(this._dur,(this._dp._time-this._start)*this._ts),F;return this._initted||PS(this,B),F=this._ease(B/this._dur),T7(this,d,y,v,r,F,B,D)?this.resetTo(d,y,v,r,1):(Rb(this,0),this.parent||VO(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},o.kill=function(d,y){if(y===void 0&&(y="all"),!d&&(!y||y==="all"))return this._lazy=this._pt=0,this.parent?Iy(this):this.scrollTrigger&&this.scrollTrigger.kill(!!zo),this;if(this.timeline){var v=this.timeline.totalDuration();return this.timeline.killTweensOf(d,y,od&&od.vars.overwrite!==!0)._first||Iy(this),this.parent&&v!==this.timeline.totalDuration()&&__(this,this._dur*this.timeline._tDur/v,0,1),this}var r=this._targets,D=d?Xl(d):r,B=this._ptLookup,F=this._pt,N,Q,q,X,G,ae,xe;if((!y||y==="all")&&e7(r,D))return y==="all"&&(this._pt=0),Iy(this);for(N=this._op=this._op||[],y!=="all"&&(Po(y)&&(G={},qa(y,function(Te){return G[Te]=1}),y=G),y=E7(r,y)),xe=r.length;xe--;)if(~D.indexOf(r[xe])){Q=B[xe],y==="all"?(N[xe]=y,X=Q,q={}):(q=N[xe]=N[xe]||{},X=y);for(G in X)ae=Q&&Q[G],ae&&((!("kill"in ae.d)||ae.d.kill(G)===!0)&&Ib(this,ae,"_pt"),delete Q[G]),q!=="all"&&(q[G]=1)}return this._initted&&!this._pt&&F&&Iy(this),this},e.to=function(d,y){return new e(d,y,arguments[2])},e.from=function(d,y){return $y(1,arguments)},e.delayedCall=function(d,y,v,r){return new e(y,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:d,onComplete:y,onReverseComplete:y,onCompleteParams:v,onReverseCompleteParams:v,callbackScope:r})},e.fromTo=function(d,y,v){return $y(2,arguments)},e.set=function(d,y){return y.duration=0,y.repeatDelay||(y.repeat=0),new e(d,y)},e.killTweensOf=function(d,y,v){return Fs.killTweensOf(d,y,v)},e}(m0);El(so.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});qa("staggerTo,staggerFrom,staggerFromTo",function(n){so[n]=function(){var e=new Ea,o=nE.call(arguments,0);return o.splice(n==="staggerFromTo"?5:4,0,0),e[n].apply(e,o)}});var RS=function(e,o,u){return e[o]=u},cL=function(e,o,u){return e[o](u)},A7=function(e,o,u,d){return e[o](d.fp,u)},C7=function(e,o,u){return e.setAttribute(o,u)},DS=function(e,o){return qs(e[o])?cL:wS(e[o])&&e.setAttribute?C7:RS},uL=function(e,o){return o.set(o.t,o.p,Math.round((o.s+o.c*e)*1e6)/1e6,o)},M7=function(e,o){return o.set(o.t,o.p,!!(o.s+o.c*e),o)},hL=function(e,o){var u=o._pt,d="";if(!e&&o.b)d=o.b;else if(e===1&&o.e)d=o.e;else{for(;u;)d=u.p+(u.m?u.m(u.s+u.c*e):Math.round((u.s+u.c*e)*1e4)/1e4)+d,u=u._next;d+=o.c}o.set(o.t,o.p,d,o)},OS=function(e,o){for(var u=o._pt;u;)u.r(e,u.d),u=u._next},I7=function(e,o,u,d){for(var y=this._pt,v;y;)v=y._next,y.p===d&&y.modifier(e,o,u),y=v},P7=function(e){for(var o=this._pt,u,d;o;)d=o._next,o.p===e&&!o.op||o.op===e?Ib(this,o,"_pt"):o.dep||(u=1),o=d;return!u},R7=function(e,o,u,d){d.mSet(e,o,d.m.call(d.tween,u,d.mt),d)},dL=function(e){for(var o=e._pt,u,d,y,v;o;){for(u=o._next,d=y;d&&d.pr>o.pr;)d=d._next;(o._prev=d?d._prev:v)?o._prev._next=o:y=o,(o._next=d)?d._prev=o:v=o,o=u}e._pt=y},Ha=function(){function n(o,u,d,y,v,r,D,B,F){this.t=u,this.s=y,this.c=v,this.p=d,this.r=r||uL,this.d=D||this,this.set=B||RS,this.pr=F||0,this._next=o,o&&(o._prev=this)}var e=n.prototype;return e.modifier=function(u,d,y){this.mSet=this.mSet||this.set,this.set=R7,this.m=u,this.mt=y,this.tween=d},n}();qa(CS+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(n){return AS[n]=1});Tl.TweenMax=Tl.TweenLite=so;Tl.TimelineLite=Tl.TimelineMax=Ea;Fs=new Ea({sortChildren:!1,defaults:f_,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});yl.stringFilter=tL;var ep=[],lx={},D7=[],d3=0,O7=0,fT=function(e){return(lx[e]||D7).map(function(o){return o()})},lE=function(){var e=Date.now(),o=[];e-d3>2&&(fT("matchMediaInit"),ep.forEach(function(u){var d=u.queries,y=u.conditions,v,r,D,B;for(r in d)v=tu.matchMedia(d[r]).matches,v&&(D=1),v!==y[r]&&(y[r]=v,B=1);B&&(u.revert(),D&&o.push(u))}),fT("matchMediaRevert"),o.forEach(function(u){return u.onMatch(u,function(d){return u.add(null,d)})}),d3=e,fT("matchMedia"))},fL=function(){function n(o,u){this.selector=u&&sE(u),this.data=[],this._r=[],this.isReverted=!1,this.id=O7++,o&&this.add(o)}var e=n.prototype;return e.add=function(u,d,y){qs(u)&&(y=d,d=u,u=qs);var v=this,r=function(){var B=Ms,F=v.selector,N;return B&&B!==v&&B.data.push(v),y&&(v.selector=sE(y)),Ms=v,N=d.apply(v,arguments),qs(N)&&v._r.push(N),Ms=B,v.selector=F,v.isReverted=!1,N};return v.last=r,u===qs?r(v,function(D){return v.add(null,D)}):u?v[u]=r:r},e.ignore=function(u){var d=Ms;Ms=null,u(this),Ms=d},e.getTweens=function(){var u=[];return this.data.forEach(function(d){return d instanceof n?u.push.apply(u,d.getTweens()):d instanceof so&&!(d.parent&&d.parent.data==="nested")&&u.push(d)}),u},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(u,d){var y=this;if(u?function(){for(var r=y.getTweens(),D=y.data.length,B;D--;)B=y.data[D],B.data==="isFlip"&&(B.revert(),B.getChildren(!0,!0,!1).forEach(function(F){return r.splice(r.indexOf(F),1)}));for(r.map(function(F){return{g:F._dur||F._delay||F._sat&&!F._sat.vars.immediateRender?F.globalTime(0):-1/0,t:F}}).sort(function(F,N){return N.g-F.g||-1/0}).forEach(function(F){return F.t.revert(u)}),D=y.data.length;D--;)B=y.data[D],B instanceof Ea?B.data!=="nested"&&(B.scrollTrigger&&B.scrollTrigger.revert(),B.kill()):!(B instanceof so)&&B.revert&&B.revert(u);y._r.forEach(function(F){return F(u,y)}),y.isReverted=!0}():this.data.forEach(function(r){return r.kill&&r.kill()}),this.clear(),d)for(var v=ep.length;v--;)ep[v].id===this.id&&ep.splice(v,1)},e.revert=function(u){this.kill(u||{})},n}(),L7=function(){function n(o){this.contexts=[],this.scope=o,Ms&&Ms.data.push(this)}var e=n.prototype;return e.add=function(u,d,y){du(u)||(u={matches:u});var v=new fL(0,y||this.scope),r=v.conditions={},D,B,F;Ms&&!v.selector&&(v.selector=Ms.selector),this.contexts.push(v),d=v.add("onMatch",d),v.queries=u;for(B in u)B==="all"?F=1:(D=tu.matchMedia(u[B]),D&&(ep.indexOf(v)<0&&ep.push(v),(r[B]=D.matches)&&(F=1),D.addListener?D.addListener(lE):D.addEventListener("change",lE)));return F&&d(v,function(N){return v.add(null,N)}),this},e.revert=function(u){this.kill(u||{})},e.kill=function(u){this.contexts.forEach(function(d){return d.kill(u,!0)})},n}(),zx={registerPlugin:function(){for(var e=arguments.length,o=new Array(e),u=0;u<e;u++)o[u]=arguments[u];o.forEach(function(d){return JO(d)})},timeline:function(e){return new Ea(e)},getTweensOf:function(e,o){return Fs.getTweensOf(e,o)},getProperty:function(e,o,u,d){Po(e)&&(e=Xl(e)[0]);var y=Kf(e||{}).get,v=u?NO:BO;return u==="native"&&(u=""),e&&(o?v((hl[o]&&hl[o].get||y)(e,o,u,d)):function(r,D,B){return v((hl[r]&&hl[r].get||y)(e,r,D,B))})},quickSetter:function(e,o,u){if(e=Xl(e),e.length>1){var d=e.map(function(F){return Wa.quickSetter(F,o,u)}),y=d.length;return function(F){for(var N=y;N--;)d[N](F)}}e=e[0]||{};var v=hl[o],r=Kf(e),D=r.harness&&(r.harness.aliases||{})[o]||o,B=v?function(F){var N=new v;qm._pt=0,N.init(e,u?F+u:F,qm,0,[e]),N.render(1,N),qm._pt&&OS(1,qm)}:r.set(e,D);return v?B:function(F){return B(e,D,u?F+u:F,r,1)}},quickTo:function(e,o,u){var d,y=Wa.to(e,El((d={},d[o]="+=0.1",d.paused=!0,d.stagger=0,d),u||{})),v=function(D,B,F){return y.resetTo(o,D,B,F)};return v.tween=y,v},isTweening:function(e){return Fs.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Qf(e.ease,f_.ease)),a3(f_,e||{})},config:function(e){return a3(yl,e||{})},registerEffect:function(e){var o=e.name,u=e.effect,d=e.plugins,y=e.defaults,v=e.extendTimeline;(d||"").split(",").forEach(function(r){return r&&!hl[r]&&!Tl[r]&&h0(o+" effect requires "+r+" plugin.")}),cT[o]=function(r,D,B){return u(Xl(r),El(D||{},y),B)},v&&(Ea.prototype[o]=function(r,D,B){return this.add(cT[o](r,du(D)?D:(B=D)&&{},this),B)})},registerEase:function(e,o){Sn[e]=Qf(o)},parseEase:function(e,o){return arguments.length?Qf(e,o):Sn},getById:function(e){return Fs.getById(e)},exportRoot:function(e,o){e===void 0&&(e={});var u=new Ea(e),d,y;for(u.smoothChildTiming=$a(e.smoothChildTiming),Fs.remove(u),u._dp=0,u._time=u._tTime=Fs._time,d=Fs._first;d;)y=d._next,(o||!(!d._dur&&d instanceof so&&d.vars.onComplete===d._targets[0]))&&nu(u,d,d._start-d._delay),d=y;return nu(Fs,u,0),u},context:function(e,o){return e?new fL(e,o):Ms},matchMedia:function(e){return new L7(e)},matchMediaRefresh:function(){return ep.forEach(function(e){var o=e.conditions,u,d;for(d in o)o[d]&&(o[d]=!1,u=1);u&&e.revert()})||lE()},addEventListener:function(e,o){var u=lx[e]||(lx[e]=[]);~u.indexOf(o)||u.push(o)},removeEventListener:function(e,o){var u=lx[e],d=u&&u.indexOf(o);d>=0&&u.splice(d,1)},utils:{wrap:d7,wrapYoyo:f7,distribute:GO,random:ZO,snap:WO,normalize:h7,getUnit:Jo,clamp:a7,splitColor:QO,toArray:Xl,selector:sE,mapRange:XO,pipe:c7,unitize:u7,interpolate:p7,shuffle:HO},install:OO,effects:cT,ticker:fl,updateRoot:Ea.updateRoot,plugins:hl,globalTimeline:Fs,core:{PropTween:Ha,globals:LO,Tween:so,Timeline:Ea,Animation:m0,getCache:Kf,_removeLinkedListItem:Ib,reverting:function(){return zo},context:function(e){return e&&Ms&&(Ms.data.push(e),e._ctx=Ms),Ms},suppressOverwrites:function(e){return bS=e}}};qa("to,from,fromTo,delayedCall,set,killTweensOf",function(n){return zx[n]=so[n]});fl.add(Ea.updateRoot);qm=zx.to({},{duration:0});var k7=function(e,o){for(var u=e._pt;u&&u.p!==o&&u.op!==o&&u.fp!==o;)u=u._next;return u},z7=function(e,o){var u=e._targets,d,y,v;for(d in o)for(y=u.length;y--;)v=e._ptLookup[y][d],v&&(v=v.d)&&(v._pt&&(v=k7(v,d)),v&&v.modifier&&v.modifier(o[d],e,u[y],d))},pT=function(e,o){return{name:e,rawVars:1,init:function(d,y,v){v._onInit=function(r){var D,B;if(Po(y)&&(D={},qa(y,function(F){return D[F]=1}),y=D),o){D={};for(B in y)D[B]=o(y[B]);y=D}z7(r,y)}}}},Wa=zx.registerPlugin({name:"attr",init:function(e,o,u,d,y){var v,r,D;this.tween=u;for(v in o)D=e.getAttribute(v)||"",r=this.add(e,"setAttribute",(D||0)+"",o[v],d,y,0,0,v),r.op=v,r.b=D,this._props.push(v)},render:function(e,o){for(var u=o._pt;u;)zo?u.set(u.t,u.p,u.b,u):u.r(e,u.d),u=u._next}},{name:"endArray",init:function(e,o){for(var u=o.length;u--;)this.add(e,u,e[u]||0,o[u],0,0,0,0,0,1)}},pT("roundProps",oE),pT("modifiers"),pT("snap",WO))||zx;so.version=Ea.version=Wa.version="3.12.7";DO=1;TS()&&g_();Sn.Power0;Sn.Power1;Sn.Power2;Sn.Power3;Sn.Power4;Sn.Linear;Sn.Quad;Sn.Cubic;Sn.Quart;Sn.Quint;Sn.Strong;Sn.Elastic;Sn.Back;Sn.SteppedEase;Sn.Bounce;Sn.Sine;Sn.Expo;Sn.Circ;/*!
 * CSSPlugin 3.12.7
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var f3,ad,Zm,LS,Gf,p3,kS,F7=function(){return typeof window<"u"},ih={},Nf=180/Math.PI,Ym=Math.PI/180,Im=Math.atan2,m3=1e8,zS=/([A-Z])/g,B7=/(left|right|width|margin|padding|x)/i,N7=/[\s,\(]\S/,su={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},cE=function(e,o){return o.set(o.t,o.p,Math.round((o.s+o.c*e)*1e4)/1e4+o.u,o)},V7=function(e,o){return o.set(o.t,o.p,e===1?o.e:Math.round((o.s+o.c*e)*1e4)/1e4+o.u,o)},U7=function(e,o){return o.set(o.t,o.p,e?Math.round((o.s+o.c*e)*1e4)/1e4+o.u:o.b,o)},j7=function(e,o){var u=o.s+o.c*e;o.set(o.t,o.p,~~(u+(u<0?-.5:.5))+o.u,o)},pL=function(e,o){return o.set(o.t,o.p,e?o.e:o.b,o)},mL=function(e,o){return o.set(o.t,o.p,e!==1?o.b:o.e,o)},$7=function(e,o,u){return e.style[o]=u},q7=function(e,o,u){return e.style.setProperty(o,u)},H7=function(e,o,u){return e._gsap[o]=u},G7=function(e,o,u){return e._gsap.scaleX=e._gsap.scaleY=u},W7=function(e,o,u,d,y){var v=e._gsap;v.scaleX=v.scaleY=u,v.renderTransform(y,v)},Z7=function(e,o,u,d,y){var v=e._gsap;v[o]=u,v.renderTransform(y,v)},Ns="transform",Ga=Ns+"Origin",Y7=function n(e,o){var u=this,d=this.target,y=d.style,v=d._gsap;if(e in ih&&y){if(this.tfm=this.tfm||{},e!=="transform")e=su[e]||e,~e.indexOf(",")?e.split(",").forEach(function(r){return u.tfm[r]=qu(d,r)}):this.tfm[e]=v.x?v[e]:qu(d,e),e===Ga&&(this.tfm.zOrigin=v.zOrigin);else return su.transform.split(",").forEach(function(r){return n.call(u,r,o)});if(this.props.indexOf(Ns)>=0)return;v.svg&&(this.svgo=d.getAttribute("data-svg-origin"),this.props.push(Ga,o,"")),e=Ns}(y||o)&&this.props.push(e,o,y[e])},_L=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},X7=function(){var e=this.props,o=this.target,u=o.style,d=o._gsap,y,v;for(y=0;y<e.length;y+=3)e[y+1]?e[y+1]===2?o[e[y]](e[y+2]):o[e[y]]=e[y+2]:e[y+2]?u[e[y]]=e[y+2]:u.removeProperty(e[y].substr(0,2)==="--"?e[y]:e[y].replace(zS,"-$1").toLowerCase());if(this.tfm){for(v in this.tfm)d[v]=this.tfm[v];d.svg&&(d.renderTransform(),o.setAttribute("data-svg-origin",this.svgo||"")),y=kS(),(!y||!y.isStart)&&!u[Ns]&&(_L(u),d.zOrigin&&u[Ga]&&(u[Ga]+=" "+d.zOrigin+"px",d.zOrigin=0,d.renderTransform()),d.uncache=1)}},gL=function(e,o){var u={target:e,props:[],revert:X7,save:Y7};return e._gsap||Wa.core.getCache(e),o&&e.style&&e.nodeType&&o.split(",").forEach(function(d){return u.save(d)}),u},yL,uE=function(e,o){var u=ad.createElementNS?ad.createElementNS((o||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):ad.createElement(e);return u&&u.style?u:ad.createElement(e)},cu=function n(e,o,u){var d=getComputedStyle(e);return d[o]||d.getPropertyValue(o.replace(zS,"-$1").toLowerCase())||d.getPropertyValue(o)||!u&&n(e,y_(o)||o,1)||""},_3="O,Moz,ms,Ms,Webkit".split(","),y_=function(e,o,u){var d=o||Gf,y=d.style,v=5;if(e in y&&!u)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);v--&&!(_3[v]+e in y););return v<0?null:(v===3?"ms":v>=0?_3[v]:"")+e},hE=function(){F7()&&window.document&&(f3=window,ad=f3.document,Zm=ad.documentElement,Gf=uE("div")||{style:{}},uE("div"),Ns=y_(Ns),Ga=Ns+"Origin",Gf.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",yL=!!y_("perspective"),kS=Wa.core.reverting,LS=1)},g3=function(e){var o=e.ownerSVGElement,u=uE("svg",o&&o.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),d=e.cloneNode(!0),y;d.style.display="block",u.appendChild(d),Zm.appendChild(u);try{y=d.getBBox()}catch{}return u.removeChild(d),Zm.removeChild(u),y},y3=function(e,o){for(var u=o.length;u--;)if(e.hasAttribute(o[u]))return e.getAttribute(o[u])},vL=function(e){var o,u;try{o=e.getBBox()}catch{o=g3(e),u=1}return o&&(o.width||o.height)||u||(o=g3(e)),o&&!o.width&&!o.x&&!o.y?{x:+y3(e,["x","cx","x1"])||0,y:+y3(e,["y","cy","y1"])||0,width:0,height:0}:o},xL=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&vL(e))},dp=function(e,o){if(o){var u=e.style,d;o in ih&&o!==Ga&&(o=Ns),u.removeProperty?(d=o.substr(0,2),(d==="ms"||o.substr(0,6)==="webkit")&&(o="-"+o),u.removeProperty(d==="--"?o:o.replace(zS,"-$1").toLowerCase())):u.removeAttribute(o)}},ld=function(e,o,u,d,y,v){var r=new Ha(e._pt,o,u,0,1,v?mL:pL);return e._pt=r,r.b=d,r.e=y,e._props.push(u),r},v3={deg:1,rad:1,turn:1},K7={grid:1,flex:1},Td=function n(e,o,u,d){var y=parseFloat(u)||0,v=(u+"").trim().substr((y+"").length)||"px",r=Gf.style,D=B7.test(o),B=e.tagName.toLowerCase()==="svg",F=(B?"client":"offset")+(D?"Width":"Height"),N=100,Q=d==="px",q=d==="%",X,G,ae,xe;if(d===v||!y||v3[d]||v3[v])return y;if(v!=="px"&&!Q&&(y=n(e,o,u,"px")),xe=e.getCTM&&xL(e),(q||v==="%")&&(ih[o]||~o.indexOf("adius")))return X=xe?e.getBBox()[D?"width":"height"]:e[F],Qs(q?y/X*N:y/100*X);if(r[D?"width":"height"]=N+(Q?v:d),G=d!=="rem"&&~o.indexOf("adius")||d==="em"&&e.appendChild&&!B?e:e.parentNode,xe&&(G=(e.ownerSVGElement||{}).parentNode),(!G||G===ad||!G.appendChild)&&(G=ad.body),ae=G._gsap,ae&&q&&ae.width&&D&&ae.time===fl.time&&!ae.uncache)return Qs(y/ae.width*N);if(q&&(o==="height"||o==="width")){var Te=e.style[o];e.style[o]=N+d,X=e[F],Te?e.style[o]=Te:dp(e,o)}else(q||v==="%")&&!K7[cu(G,"display")]&&(r.position=cu(e,"position")),G===e&&(r.position="static"),G.appendChild(Gf),X=Gf[F],G.removeChild(Gf),r.position="absolute";return D&&q&&(ae=Kf(G),ae.time=fl.time,ae.width=G[F]),Qs(Q?X*y/N:X&&y?N/X*y:0)},qu=function(e,o,u,d){var y;return LS||hE(),o in su&&o!=="transform"&&(o=su[o],~o.indexOf(",")&&(o=o.split(",")[0])),ih[o]&&o!=="transform"?(y=g0(e,d),y=o!=="transformOrigin"?y[o]:y.svg?y.origin:Bx(cu(e,Ga))+" "+y.zOrigin+"px"):(y=e.style[o],(!y||y==="auto"||d||~(y+"").indexOf("calc("))&&(y=Fx[o]&&Fx[o](e,o,u)||cu(e,o)||zO(e,o)||(o==="opacity"?1:0))),u&&!~(y+"").trim().indexOf(" ")?Td(e,o,y,u)+u:y},J7=function(e,o,u,d){if(!u||u==="none"){var y=y_(o,e,1),v=y&&cu(e,y,1);v&&v!==u?(o=y,u=v):o==="borderColor"&&(u=cu(e,"borderTopColor"))}var r=new Ha(this._pt,e.style,o,0,1,hL),D=0,B=0,F,N,Q,q,X,G,ae,xe,Te,fe,ne,ue;if(r.b=u,r.e=d,u+="",d+="",d==="auto"&&(G=e.style[o],e.style[o]=d,d=cu(e,o)||d,G?e.style[o]=G:dp(e,o)),F=[u,d],tL(F),u=F[0],d=F[1],Q=u.match($m)||[],ue=d.match($m)||[],ue.length){for(;N=$m.exec(d);)ae=N[0],Te=d.substring(D,N.index),X?X=(X+1)%5:(Te.substr(-5)==="rgba("||Te.substr(-5)==="hsla(")&&(X=1),ae!==(G=Q[B++]||"")&&(q=parseFloat(G)||0,ne=G.substr((q+"").length),ae.charAt(1)==="="&&(ae=Wm(q,ae)+ne),xe=parseFloat(ae),fe=ae.substr((xe+"").length),D=$m.lastIndex-fe.length,fe||(fe=fe||yl.units[o]||ne,D===d.length&&(d+=fe,r.e+=fe)),ne!==fe&&(q=Td(e,o,G,fe)||0),r._pt={_next:r._pt,p:Te||B===1?Te:",",s:q,c:xe-q,m:X&&X<4||o==="zIndex"?Math.round:0});r.c=D<d.length?d.substring(D,d.length):""}else r.r=o==="display"&&d==="none"?mL:pL;return PO.test(d)&&(r.e=0),this._pt=r,r},x3={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Q7=function(e){var o=e.split(" "),u=o[0],d=o[1]||"50%";return(u==="top"||u==="bottom"||d==="left"||d==="right")&&(e=u,u=d,d=e),o[0]=x3[u]||u,o[1]=x3[d]||d,o.join(" ")},eq=function(e,o){if(o.tween&&o.tween._time===o.tween._dur){var u=o.t,d=u.style,y=o.u,v=u._gsap,r,D,B;if(y==="all"||y===!0)d.cssText="",D=1;else for(y=y.split(","),B=y.length;--B>-1;)r=y[B],ih[r]&&(D=1,r=r==="transformOrigin"?Ga:Ns),dp(u,r);D&&(dp(u,Ns),v&&(v.svg&&u.removeAttribute("transform"),d.scale=d.rotate=d.translate="none",g0(u,1),v.uncache=1,_L(d)))}},Fx={clearProps:function(e,o,u,d,y){if(y.data!=="isFromStart"){var v=e._pt=new Ha(e._pt,o,u,0,0,eq);return v.u=d,v.pr=-10,v.tween=y,e._props.push(u),1}}},_0=[1,0,0,1,0,0],bL={},wL=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},b3=function(e){var o=cu(e,Ns);return wL(o)?_0:o.substr(7).match(IO).map(Qs)},FS=function(e,o){var u=e._gsap||Kf(e),d=e.style,y=b3(e),v,r,D,B;return u.svg&&e.getAttribute("transform")?(D=e.transform.baseVal.consolidate().matrix,y=[D.a,D.b,D.c,D.d,D.e,D.f],y.join(",")==="1,0,0,1,0,0"?_0:y):(y===_0&&!e.offsetParent&&e!==Zm&&!u.svg&&(D=d.display,d.display="block",v=e.parentNode,(!v||!e.offsetParent&&!e.getBoundingClientRect().width)&&(B=1,r=e.nextElementSibling,Zm.appendChild(e)),y=b3(e),D?d.display=D:dp(e,"display"),B&&(r?v.insertBefore(e,r):v?v.appendChild(e):Zm.removeChild(e))),o&&y.length>6?[y[0],y[1],y[4],y[5],y[12],y[13]]:y)},dE=function(e,o,u,d,y,v){var r=e._gsap,D=y||FS(e,!0),B=r.xOrigin||0,F=r.yOrigin||0,N=r.xOffset||0,Q=r.yOffset||0,q=D[0],X=D[1],G=D[2],ae=D[3],xe=D[4],Te=D[5],fe=o.split(" "),ne=parseFloat(fe[0])||0,ue=parseFloat(fe[1])||0,ye,le,re,oe;u?D!==_0&&(le=q*ae-X*G)&&(re=ne*(ae/le)+ue*(-G/le)+(G*Te-ae*xe)/le,oe=ne*(-X/le)+ue*(q/le)-(q*Te-X*xe)/le,ne=re,ue=oe):(ye=vL(e),ne=ye.x+(~fe[0].indexOf("%")?ne/100*ye.width:ne),ue=ye.y+(~(fe[1]||fe[0]).indexOf("%")?ue/100*ye.height:ue)),d||d!==!1&&r.smooth?(xe=ne-B,Te=ue-F,r.xOffset=N+(xe*q+Te*G)-xe,r.yOffset=Q+(xe*X+Te*ae)-Te):r.xOffset=r.yOffset=0,r.xOrigin=ne,r.yOrigin=ue,r.smooth=!!d,r.origin=o,r.originIsAbsolute=!!u,e.style[Ga]="0px 0px",v&&(ld(v,r,"xOrigin",B,ne),ld(v,r,"yOrigin",F,ue),ld(v,r,"xOffset",N,r.xOffset),ld(v,r,"yOffset",Q,r.yOffset)),e.setAttribute("data-svg-origin",ne+" "+ue)},g0=function(e,o){var u=e._gsap||new sL(e);if("x"in u&&!o&&!u.uncache)return u;var d=e.style,y=u.scaleX<0,v="px",r="deg",D=getComputedStyle(e),B=cu(e,Ga)||"0",F,N,Q,q,X,G,ae,xe,Te,fe,ne,ue,ye,le,re,oe,se,Ae,De,Ge,yt,ct,mt,et,Qe,vt,st,Zt,ui,ni,Hi,Ci;return F=N=Q=G=ae=xe=Te=fe=ne=0,q=X=1,u.svg=!!(e.getCTM&&xL(e)),D.translate&&((D.translate!=="none"||D.scale!=="none"||D.rotate!=="none")&&(d[Ns]=(D.translate!=="none"?"translate3d("+(D.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(D.rotate!=="none"?"rotate("+D.rotate+") ":"")+(D.scale!=="none"?"scale("+D.scale.split(" ").join(",")+") ":"")+(D[Ns]!=="none"?D[Ns]:"")),d.scale=d.rotate=d.translate="none"),le=FS(e,u.svg),u.svg&&(u.uncache?(Qe=e.getBBox(),B=u.xOrigin-Qe.x+"px "+(u.yOrigin-Qe.y)+"px",et=""):et=!o&&e.getAttribute("data-svg-origin"),dE(e,et||B,!!et||u.originIsAbsolute,u.smooth!==!1,le)),ue=u.xOrigin||0,ye=u.yOrigin||0,le!==_0&&(Ae=le[0],De=le[1],Ge=le[2],yt=le[3],F=ct=le[4],N=mt=le[5],le.length===6?(q=Math.sqrt(Ae*Ae+De*De),X=Math.sqrt(yt*yt+Ge*Ge),G=Ae||De?Im(De,Ae)*Nf:0,Te=Ge||yt?Im(Ge,yt)*Nf+G:0,Te&&(X*=Math.abs(Math.cos(Te*Ym))),u.svg&&(F-=ue-(ue*Ae+ye*Ge),N-=ye-(ue*De+ye*yt))):(Ci=le[6],ni=le[7],st=le[8],Zt=le[9],ui=le[10],Hi=le[11],F=le[12],N=le[13],Q=le[14],re=Im(Ci,ui),ae=re*Nf,re&&(oe=Math.cos(-re),se=Math.sin(-re),et=ct*oe+st*se,Qe=mt*oe+Zt*se,vt=Ci*oe+ui*se,st=ct*-se+st*oe,Zt=mt*-se+Zt*oe,ui=Ci*-se+ui*oe,Hi=ni*-se+Hi*oe,ct=et,mt=Qe,Ci=vt),re=Im(-Ge,ui),xe=re*Nf,re&&(oe=Math.cos(-re),se=Math.sin(-re),et=Ae*oe-st*se,Qe=De*oe-Zt*se,vt=Ge*oe-ui*se,Hi=yt*se+Hi*oe,Ae=et,De=Qe,Ge=vt),re=Im(De,Ae),G=re*Nf,re&&(oe=Math.cos(re),se=Math.sin(re),et=Ae*oe+De*se,Qe=ct*oe+mt*se,De=De*oe-Ae*se,mt=mt*oe-ct*se,Ae=et,ct=Qe),ae&&Math.abs(ae)+Math.abs(G)>359.9&&(ae=G=0,xe=180-xe),q=Qs(Math.sqrt(Ae*Ae+De*De+Ge*Ge)),X=Qs(Math.sqrt(mt*mt+Ci*Ci)),re=Im(ct,mt),Te=Math.abs(re)>2e-4?re*Nf:0,ne=Hi?1/(Hi<0?-Hi:Hi):0),u.svg&&(et=e.getAttribute("transform"),u.forceCSS=e.setAttribute("transform","")||!wL(cu(e,Ns)),et&&e.setAttribute("transform",et))),Math.abs(Te)>90&&Math.abs(Te)<270&&(y?(q*=-1,Te+=G<=0?180:-180,G+=G<=0?180:-180):(X*=-1,Te+=Te<=0?180:-180)),o=o||u.uncache,u.x=F-((u.xPercent=F&&(!o&&u.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-F)?-50:0)))?e.offsetWidth*u.xPercent/100:0)+v,u.y=N-((u.yPercent=N&&(!o&&u.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-N)?-50:0)))?e.offsetHeight*u.yPercent/100:0)+v,u.z=Q+v,u.scaleX=Qs(q),u.scaleY=Qs(X),u.rotation=Qs(G)+r,u.rotationX=Qs(ae)+r,u.rotationY=Qs(xe)+r,u.skewX=Te+r,u.skewY=fe+r,u.transformPerspective=ne+v,(u.zOrigin=parseFloat(B.split(" ")[2])||!o&&u.zOrigin||0)&&(d[Ga]=Bx(B)),u.xOffset=u.yOffset=0,u.force3D=yl.force3D,u.renderTransform=u.svg?iq:yL?TL:tq,u.uncache=0,u},Bx=function(e){return(e=e.split(" "))[0]+" "+e[1]},mT=function(e,o,u){var d=Jo(o);return Qs(parseFloat(o)+parseFloat(Td(e,"x",u+"px",d)))+d},tq=function(e,o){o.z="0px",o.rotationY=o.rotationX="0deg",o.force3D=0,TL(e,o)},kf="0deg",Ty="0px",zf=") ",TL=function(e,o){var u=o||this,d=u.xPercent,y=u.yPercent,v=u.x,r=u.y,D=u.z,B=u.rotation,F=u.rotationY,N=u.rotationX,Q=u.skewX,q=u.skewY,X=u.scaleX,G=u.scaleY,ae=u.transformPerspective,xe=u.force3D,Te=u.target,fe=u.zOrigin,ne="",ue=xe==="auto"&&e&&e!==1||xe===!0;if(fe&&(N!==kf||F!==kf)){var ye=parseFloat(F)*Ym,le=Math.sin(ye),re=Math.cos(ye),oe;ye=parseFloat(N)*Ym,oe=Math.cos(ye),v=mT(Te,v,le*oe*-fe),r=mT(Te,r,-Math.sin(ye)*-fe),D=mT(Te,D,re*oe*-fe+fe)}ae!==Ty&&(ne+="perspective("+ae+zf),(d||y)&&(ne+="translate("+d+"%, "+y+"%) "),(ue||v!==Ty||r!==Ty||D!==Ty)&&(ne+=D!==Ty||ue?"translate3d("+v+", "+r+", "+D+") ":"translate("+v+", "+r+zf),B!==kf&&(ne+="rotate("+B+zf),F!==kf&&(ne+="rotateY("+F+zf),N!==kf&&(ne+="rotateX("+N+zf),(Q!==kf||q!==kf)&&(ne+="skew("+Q+", "+q+zf),(X!==1||G!==1)&&(ne+="scale("+X+", "+G+zf),Te.style[Ns]=ne||"translate(0, 0)"},iq=function(e,o){var u=o||this,d=u.xPercent,y=u.yPercent,v=u.x,r=u.y,D=u.rotation,B=u.skewX,F=u.skewY,N=u.scaleX,Q=u.scaleY,q=u.target,X=u.xOrigin,G=u.yOrigin,ae=u.xOffset,xe=u.yOffset,Te=u.forceCSS,fe=parseFloat(v),ne=parseFloat(r),ue,ye,le,re,oe;D=parseFloat(D),B=parseFloat(B),F=parseFloat(F),F&&(F=parseFloat(F),B+=F,D+=F),D||B?(D*=Ym,B*=Ym,ue=Math.cos(D)*N,ye=Math.sin(D)*N,le=Math.sin(D-B)*-Q,re=Math.cos(D-B)*Q,B&&(F*=Ym,oe=Math.tan(B-F),oe=Math.sqrt(1+oe*oe),le*=oe,re*=oe,F&&(oe=Math.tan(F),oe=Math.sqrt(1+oe*oe),ue*=oe,ye*=oe)),ue=Qs(ue),ye=Qs(ye),le=Qs(le),re=Qs(re)):(ue=N,re=Q,ye=le=0),(fe&&!~(v+"").indexOf("px")||ne&&!~(r+"").indexOf("px"))&&(fe=Td(q,"x",v,"px"),ne=Td(q,"y",r,"px")),(X||G||ae||xe)&&(fe=Qs(fe+X-(X*ue+G*le)+ae),ne=Qs(ne+G-(X*ye+G*re)+xe)),(d||y)&&(oe=q.getBBox(),fe=Qs(fe+d/100*oe.width),ne=Qs(ne+y/100*oe.height)),oe="matrix("+ue+","+ye+","+le+","+re+","+fe+","+ne+")",q.setAttribute("transform",oe),Te&&(q.style[Ns]=oe)},rq=function(e,o,u,d,y){var v=360,r=Po(y),D=parseFloat(y)*(r&&~y.indexOf("rad")?Nf:1),B=D-d,F=d+B+"deg",N,Q;return r&&(N=y.split("_")[1],N==="short"&&(B%=v,B!==B%(v/2)&&(B+=B<0?v:-v)),N==="cw"&&B<0?B=(B+v*m3)%v-~~(B/v)*v:N==="ccw"&&B>0&&(B=(B-v*m3)%v-~~(B/v)*v)),e._pt=Q=new Ha(e._pt,o,u,d,B,V7),Q.e=F,Q.u="deg",e._props.push(u),Q},w3=function(e,o){for(var u in o)e[u]=o[u];return e},nq=function(e,o,u){var d=w3({},u._gsap),y="perspective,force3D,transformOrigin,svgOrigin",v=u.style,r,D,B,F,N,Q,q,X;d.svg?(B=u.getAttribute("transform"),u.setAttribute("transform",""),v[Ns]=o,r=g0(u,1),dp(u,Ns),u.setAttribute("transform",B)):(B=getComputedStyle(u)[Ns],v[Ns]=o,r=g0(u,1),v[Ns]=B);for(D in ih)B=d[D],F=r[D],B!==F&&y.indexOf(D)<0&&(q=Jo(B),X=Jo(F),N=q!==X?Td(u,D,B,X):parseFloat(B),Q=parseFloat(F),e._pt=new Ha(e._pt,r,D,N,Q-N,cE),e._pt.u=X||0,e._props.push(D));w3(r,d)};qa("padding,margin,Width,Radius",function(n,e){var o="Top",u="Right",d="Bottom",y="Left",v=(e<3?[o,u,d,y]:[o+y,o+u,d+u,d+y]).map(function(r){return e<2?n+r:"border"+r+n});Fx[e>1?"border"+n:n]=function(r,D,B,F,N){var Q,q;if(arguments.length<4)return Q=v.map(function(X){return qu(r,X,B)}),q=Q.join(" "),q.split(Q[0]).length===5?Q[0]:q;Q=(F+"").split(" "),q={},v.forEach(function(X,G){return q[X]=Q[G]=Q[G]||Q[(G-1)/2|0]}),r.init(D,q,N)}});var EL={name:"css",register:hE,targetTest:function(e){return e.style&&e.nodeType},init:function(e,o,u,d,y){var v=this._props,r=e.style,D=u.vars.startAt,B,F,N,Q,q,X,G,ae,xe,Te,fe,ne,ue,ye,le,re;LS||hE(),this.styles=this.styles||gL(e),re=this.styles.props,this.tween=u;for(G in o)if(G!=="autoRound"&&(F=o[G],!(hl[G]&&oL(G,o,u,d,e,y)))){if(q=typeof F,X=Fx[G],q==="function"&&(F=F.call(u,d,e,y),q=typeof F),q==="string"&&~F.indexOf("random(")&&(F=f0(F)),X)X(this,e,G,F,u)&&(le=1);else if(G.substr(0,2)==="--")B=(getComputedStyle(e).getPropertyValue(G)+"").trim(),F+="",dd.lastIndex=0,dd.test(B)||(ae=Jo(B),xe=Jo(F)),xe?ae!==xe&&(B=Td(e,G,B,xe)+xe):ae&&(F+=ae),this.add(r,"setProperty",B,F,d,y,0,0,G),v.push(G),re.push(G,0,r[G]);else if(q!=="undefined"){if(D&&G in D?(B=typeof D[G]=="function"?D[G].call(u,d,e,y):D[G],Po(B)&&~B.indexOf("random(")&&(B=f0(B)),Jo(B+"")||B==="auto"||(B+=yl.units[G]||Jo(qu(e,G))||""),(B+"").charAt(1)==="="&&(B=qu(e,G))):B=qu(e,G),Q=parseFloat(B),Te=q==="string"&&F.charAt(1)==="="&&F.substr(0,2),Te&&(F=F.substr(2)),N=parseFloat(F),G in su&&(G==="autoAlpha"&&(Q===1&&qu(e,"visibility")==="hidden"&&N&&(Q=0),re.push("visibility",0,r.visibility),ld(this,r,"visibility",Q?"inherit":"hidden",N?"inherit":"hidden",!N)),G!=="scale"&&G!=="transform"&&(G=su[G],~G.indexOf(",")&&(G=G.split(",")[0]))),fe=G in ih,fe){if(this.styles.save(G),ne||(ue=e._gsap,ue.renderTransform&&!o.parseTransform||g0(e,o.parseTransform),ye=o.smoothOrigin!==!1&&ue.smooth,ne=this._pt=new Ha(this._pt,r,Ns,0,1,ue.renderTransform,ue,0,-1),ne.dep=1),G==="scale")this._pt=new Ha(this._pt,ue,"scaleY",ue.scaleY,(Te?Wm(ue.scaleY,Te+N):N)-ue.scaleY||0,cE),this._pt.u=0,v.push("scaleY",G),G+="X";else if(G==="transformOrigin"){re.push(Ga,0,r[Ga]),F=Q7(F),ue.svg?dE(e,F,0,ye,0,this):(xe=parseFloat(F.split(" ")[2])||0,xe!==ue.zOrigin&&ld(this,ue,"zOrigin",ue.zOrigin,xe),ld(this,r,G,Bx(B),Bx(F)));continue}else if(G==="svgOrigin"){dE(e,F,1,ye,0,this);continue}else if(G in bL){rq(this,ue,G,Q,Te?Wm(Q,Te+F):F);continue}else if(G==="smoothOrigin"){ld(this,ue,"smooth",ue.smooth,F);continue}else if(G==="force3D"){ue[G]=F;continue}else if(G==="transform"){nq(this,F,e);continue}}else G in r||(G=y_(G)||G);if(fe||(N||N===0)&&(Q||Q===0)&&!N7.test(F)&&G in r)ae=(B+"").substr((Q+"").length),N||(N=0),xe=Jo(F)||(G in yl.units?yl.units[G]:ae),ae!==xe&&(Q=Td(e,G,B,xe)),this._pt=new Ha(this._pt,fe?ue:r,G,Q,(Te?Wm(Q,Te+N):N)-Q,!fe&&(xe==="px"||G==="zIndex")&&o.autoRound!==!1?j7:cE),this._pt.u=xe||0,ae!==xe&&xe!=="%"&&(this._pt.b=B,this._pt.r=U7);else if(G in r)J7.call(this,e,G,B,Te?Te+F:F);else if(G in e)this.add(e,G,B||e[G],Te?Te+F:F,d,y);else if(G!=="parseTransform"){SS(G,F);continue}fe||(G in r?re.push(G,0,r[G]):typeof e[G]=="function"?re.push(G,2,e[G]()):re.push(G,1,B||e[G])),v.push(G)}}le&&dL(this)},render:function(e,o){if(o.tween._time||!kS())for(var u=o._pt;u;)u.r(e,u.d),u=u._next;else o.styles.revert()},get:qu,aliases:su,getSetter:function(e,o,u){var d=su[o];return d&&d.indexOf(",")<0&&(o=d),o in ih&&o!==Ga&&(e._gsap.x||qu(e,"x"))?u&&p3===u?o==="scale"?G7:H7:(p3=u||{})&&(o==="scale"?W7:Z7):e.style&&!wS(e.style[o])?$7:~o.indexOf("-")?q7:DS(e,o)},core:{_removeProperty:dp,_getMatrix:FS}};Wa.utils.checkPrefix=y_;Wa.core.getStyleSaver=gL;(function(n,e,o,u){var d=qa(n+","+e+","+o,function(y){ih[y]=1});qa(e,function(y){yl.units[y]="deg",bL[y]=1}),su[d[13]]=n+","+e,qa(u,function(y){var v=y.split(":");su[v[1]]=d[v[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");qa("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(n){yl.units[n]="px"});Wa.registerPlugin(EL);var Vu=Wa.registerPlugin(EL)||Wa;Vu.core.Tween;/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Al(n){const e=Object.create(null);for(const o of n.split(","))e[o]=1;return o=>o in e}const yn={},Xm=[],Io=()=>{},Ry=()=>!1,Tp=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),BS=n=>n.startsWith("onUpdate:"),vn=Object.assign,NS=(n,e)=>{const o=n.indexOf(e);o>-1&&n.splice(o,1)},sq=Object.prototype.hasOwnProperty,Un=(n,e)=>sq.call(n,e),Xi=Array.isArray,Km=n=>z_(n)==="[object Map]",Ep=n=>z_(n)==="[object Set]",T3=n=>z_(n)==="[object Date]",oq=n=>z_(n)==="[object RegExp]",Lr=n=>typeof n=="function",Gr=n=>typeof n=="string",Za=n=>typeof n=="symbol",Qn=n=>n!==null&&typeof n=="object",VS=n=>(Qn(n)||Lr(n))&&Lr(n.then)&&Lr(n.catch),SL=Object.prototype.toString,z_=n=>SL.call(n),aq=n=>z_(n).slice(8,-1),Db=n=>z_(n)==="[object Object]",US=n=>Gr(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,fd=Al(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),lq=Al("bind,cloak,else-if,else,for,html,if,model,on,once,pre,show,slot,text,memo"),Ob=n=>{const e=Object.create(null);return o=>e[o]||(e[o]=n(o))},cq=/-(\w)/g,ws=Ob(n=>n.replace(cq,(e,o)=>o?o.toUpperCase():"")),uq=/\B([A-Z])/g,Va=Ob(n=>n.replace(uq,"-$1").toLowerCase()),Sp=Ob(n=>n.charAt(0).toUpperCase()+n.slice(1)),Jm=Ob(n=>n?`on${Sp(n)}`:""),wa=(n,e)=>!Object.is(n,e),Qm=(n,...e)=>{for(let o=0;o<n.length;o++)n[o](...e)},AL=(n,e,o,u=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:u,value:o})},Nx=n=>{const e=parseFloat(n);return isNaN(e)?n:e},Vx=n=>{const e=Gr(n)?Number(n):NaN;return isNaN(e)?n:e};let E3;const Lb=()=>E3||(E3=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function hq(n,e){return n+JSON.stringify(e,(o,u)=>typeof u=="function"?u.toString():u)}const dq="Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt,console,Error,Symbol",fq=Al(dq);function Ps(n){if(Xi(n)){const e={};for(let o=0;o<n.length;o++){const u=n[o],d=Gr(u)?CL(u):Ps(u);if(d)for(const y in d)e[y]=d[y]}return e}else if(Gr(n)||Qn(n))return n}const pq=/;(?![^(]*\))/g,mq=/:([^]+)/,_q=/\/\*[^]*?\*\//g;function CL(n){const e={};return n.replace(_q,"").split(pq).forEach(o=>{if(o){const u=o.split(mq);u.length>1&&(e[u[0].trim()]=u[1].trim())}}),e}function rh(n){let e="";if(Gr(n))e=n;else if(Xi(n))for(let o=0;o<n.length;o++){const u=rh(n[o]);u&&(e+=u+" ")}else if(Qn(n))for(const o in n)n[o]&&(e+=o+" ");return e.trim()}function gq(n){if(!n)return null;let{class:e,style:o}=n;return e&&!Gr(e)&&(n.class=rh(e)),o&&(n.style=Ps(o)),n}const yq="html,body,base,head,link,meta,style,title,address,article,aside,footer,header,hgroup,h1,h2,h3,h4,h5,h6,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,summary,template,blockquote,iframe,tfoot",vq="svg,animate,animateMotion,animateTransform,circle,clipPath,color-profile,defs,desc,discard,ellipse,feBlend,feColorMatrix,feComponentTransfer,feComposite,feConvolveMatrix,feDiffuseLighting,feDisplacementMap,feDistantLight,feDropShadow,feFlood,feFuncA,feFuncB,feFuncG,feFuncR,feGaussianBlur,feImage,feMerge,feMergeNode,feMorphology,feOffset,fePointLight,feSpecularLighting,feSpotLight,feTile,feTurbulence,filter,foreignObject,g,hatch,hatchpath,image,line,linearGradient,marker,mask,mesh,meshgradient,meshpatch,meshrow,metadata,mpath,path,pattern,polygon,polyline,radialGradient,rect,set,solidcolor,stop,switch,symbol,text,textPath,title,tspan,unknown,use,view",xq="annotation,annotation-xml,maction,maligngroup,malignmark,math,menclose,merror,mfenced,mfrac,mfraction,mglyph,mi,mlabeledtr,mlongdiv,mmultiscripts,mn,mo,mover,mpadded,mphantom,mprescripts,mroot,mrow,ms,mscarries,mscarry,msgroup,msline,mspace,msqrt,msrow,mstack,mstyle,msub,msubsup,msup,mtable,mtd,mtext,mtr,munder,munderover,none,semantics",bq="area,base,br,col,embed,hr,img,input,link,meta,param,source,track,wbr",wq=Al(yq),Tq=Al(vq),Eq=Al(xq),Sq=Al(bq),Aq="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Cq=Al(Aq);function ML(n){return!!n||n===""}function Mq(n,e){if(n.length!==e.length)return!1;let o=!0;for(let u=0;o&&u<n.length;u++)o=Ed(n[u],e[u]);return o}function Ed(n,e){if(n===e)return!0;let o=T3(n),u=T3(e);if(o||u)return o&&u?n.getTime()===e.getTime():!1;if(o=Za(n),u=Za(e),o||u)return n===e;if(o=Xi(n),u=Xi(e),o||u)return o&&u?Mq(n,e):!1;if(o=Qn(n),u=Qn(e),o||u){if(!o||!u)return!1;const d=Object.keys(n).length,y=Object.keys(e).length;if(d!==y)return!1;for(const v in n){const r=n.hasOwnProperty(v),D=e.hasOwnProperty(v);if(r&&!D||!r&&D||!Ed(n[v],e[v]))return!1}}return String(n)===String(e)}function kb(n,e){return n.findIndex(o=>Ed(o,e))}const IL=n=>!!(n&&n.__v_isRef===!0),oi=n=>Gr(n)?n:n==null?"":Xi(n)||Qn(n)&&(n.toString===SL||!Lr(n.toString))?IL(n)?oi(n.value):JSON.stringify(n,PL,2):String(n),PL=(n,e)=>IL(e)?PL(n,e.value):Km(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((o,[u,d],y)=>(o[_T(u,y)+" =>"]=d,o),{})}:Ep(e)?{[`Set(${e.size})`]:[...e.values()].map(o=>_T(o))}:Za(e)?_T(e):Qn(e)&&!Xi(e)&&!Db(e)?String(e):e,_T=(n,e="")=>{var o;return Za(n)?`Symbol(${(o=n.description)!=null?o:e})`:n};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let va;class jS{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=va,!e&&va&&(this.index=(va.scopes||(va.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,o;if(this.scopes)for(e=0,o=this.scopes.length;e<o;e++)this.scopes[e].pause();for(e=0,o=this.effects.length;e<o;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,o;if(this.scopes)for(e=0,o=this.scopes.length;e<o;e++)this.scopes[e].resume();for(e=0,o=this.effects.length;e<o;e++)this.effects[e].resume()}}run(e){if(this._active){const o=va;try{return va=this,e()}finally{va=o}}}on(){va=this}off(){va=this.parent}stop(e){if(this._active){this._active=!1;let o,u;for(o=0,u=this.effects.length;o<u;o++)this.effects[o].stop();for(this.effects.length=0,o=0,u=this.cleanups.length;o<u;o++)this.cleanups[o]();if(this.cleanups.length=0,this.scopes){for(o=0,u=this.scopes.length;o<u;o++)this.scopes[o].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const d=this.parent.scopes.pop();d&&d!==this&&(this.parent.scopes[this.index]=d,d.index=this.index)}this.parent=void 0}}}function Iq(n){return new jS(n)}function RL(){return va}function Pq(n,e=!1){va&&va.cleanups.push(n)}let ms;const gT=new WeakSet;class y0{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,va&&va.active&&va.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,gT.has(this)&&(gT.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||OL(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,S3(this),LL(this);const e=ms,o=Cc;ms=this,Cc=!0;try{return this.fn()}finally{kL(this),ms=e,Cc=o,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)HS(e);this.deps=this.depsTail=void 0,S3(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?gT.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){fE(this)&&this.run()}get dirty(){return fE(this)}}let DL=0,Hy,Gy;function OL(n,e=!1){if(n.flags|=8,e){n.next=Gy,Gy=n;return}n.next=Hy,Hy=n}function $S(){DL++}function qS(){if(--DL>0)return;if(Gy){let e=Gy;for(Gy=void 0;e;){const o=e.next;e.next=void 0,e.flags&=-9,e=o}}let n;for(;Hy;){let e=Hy;for(Hy=void 0;e;){const o=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(u){n||(n=u)}e=o}}if(n)throw n}function LL(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function kL(n){let e,o=n.depsTail,u=o;for(;u;){const d=u.prevDep;u.version===-1?(u===o&&(o=d),HS(u),Rq(u)):e=u,u.dep.activeLink=u.prevActiveLink,u.prevActiveLink=void 0,u=d}n.deps=e,n.depsTail=o}function fE(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(zL(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function zL(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===v0))return;n.globalVersion=v0;const e=n.dep;if(n.flags|=2,e.version>0&&!n.isSSR&&n.deps&&!fE(n)){n.flags&=-3;return}const o=ms,u=Cc;ms=n,Cc=!0;try{LL(n);const d=n.fn(n._value);(e.version===0||wa(d,n._value))&&(n._value=d,e.version++)}catch(d){throw e.version++,d}finally{ms=o,Cc=u,kL(n),n.flags&=-3}}function HS(n,e=!1){const{dep:o,prevSub:u,nextSub:d}=n;if(u&&(u.nextSub=d,n.prevSub=void 0),d&&(d.prevSub=u,n.nextSub=void 0),o.subs===n&&(o.subs=u,!u&&o.computed)){o.computed.flags&=-5;for(let y=o.computed.deps;y;y=y.nextDep)HS(y,!0)}!e&&!--o.sc&&o.map&&o.map.delete(o.key)}function Rq(n){const{prevDep:e,nextDep:o}=n;e&&(e.nextDep=o,n.prevDep=void 0),o&&(o.prevDep=e,n.nextDep=void 0)}function Dq(n,e){n.effect instanceof y0&&(n=n.effect.fn);const o=new y0(n);e&&vn(o,e);try{o.run()}catch(d){throw o.stop(),d}const u=o.run.bind(o);return u.effect=o,u}function Oq(n){n.effect.stop()}let Cc=!0;const FL=[];function Ld(){FL.push(Cc),Cc=!1}function kd(){const n=FL.pop();Cc=n===void 0?!0:n}function S3(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const o=ms;ms=void 0;try{e()}finally{ms=o}}}let v0=0;class Lq{constructor(e,o){this.sub=e,this.dep=o,this.version=o.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class zb{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(e){if(!ms||!Cc||ms===this.computed)return;let o=this.activeLink;if(o===void 0||o.sub!==ms)o=this.activeLink=new Lq(ms,this),ms.deps?(o.prevDep=ms.depsTail,ms.depsTail.nextDep=o,ms.depsTail=o):ms.deps=ms.depsTail=o,BL(o);else if(o.version===-1&&(o.version=this.version,o.nextDep)){const u=o.nextDep;u.prevDep=o.prevDep,o.prevDep&&(o.prevDep.nextDep=u),o.prevDep=ms.depsTail,o.nextDep=void 0,ms.depsTail.nextDep=o,ms.depsTail=o,ms.deps===o&&(ms.deps=u)}return o}trigger(e){this.version++,v0++,this.notify(e)}notify(e){$S();try{for(let o=this.subs;o;o=o.prevSub)o.sub.notify()&&o.sub.dep.notify()}finally{qS()}}}function BL(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let u=e.deps;u;u=u.nextDep)BL(u)}const o=n.dep.subs;o!==n&&(n.prevSub=o,o&&(o.nextSub=n)),n.dep.subs=n}}const Ux=new WeakMap,tp=Symbol(""),pE=Symbol(""),x0=Symbol("");function Yo(n,e,o){if(Cc&&ms){let u=Ux.get(n);u||Ux.set(n,u=new Map);let d=u.get(o);d||(u.set(o,d=new zb),d.map=u,d.key=o),d.track()}}function Hu(n,e,o,u,d,y){const v=Ux.get(n);if(!v){v0++;return}const r=D=>{D&&D.trigger()};if($S(),e==="clear")v.forEach(r);else{const D=Xi(n),B=D&&US(o);if(D&&o==="length"){const F=Number(u);v.forEach((N,Q)=>{(Q==="length"||Q===x0||!Za(Q)&&Q>=F)&&r(N)})}else switch((o!==void 0||v.has(void 0))&&r(v.get(o)),B&&r(v.get(x0)),e){case"add":D?B&&r(v.get("length")):(r(v.get(tp)),Km(n)&&r(v.get(pE)));break;case"delete":D||(r(v.get(tp)),Km(n)&&r(v.get(pE)));break;case"set":Km(n)&&r(v.get(tp));break}}qS()}function kq(n,e){const o=Ux.get(n);return o&&o.get(e)}function Pm(n){const e=Pn(n);return e===n?e:(Yo(e,"iterate",x0),vl(n)?e:e.map(Xo))}function Fb(n){return Yo(n=Pn(n),"iterate",x0),n}const zq={__proto__:null,[Symbol.iterator](){return yT(this,Symbol.iterator,Xo)},concat(...n){return Pm(this).concat(...n.map(e=>Xi(e)?Pm(e):e))},entries(){return yT(this,"entries",n=>(n[1]=Xo(n[1]),n))},every(n,e){return Bu(this,"every",n,e,void 0,arguments)},filter(n,e){return Bu(this,"filter",n,e,o=>o.map(Xo),arguments)},find(n,e){return Bu(this,"find",n,e,Xo,arguments)},findIndex(n,e){return Bu(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return Bu(this,"findLast",n,e,Xo,arguments)},findLastIndex(n,e){return Bu(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return Bu(this,"forEach",n,e,void 0,arguments)},includes(...n){return vT(this,"includes",n)},indexOf(...n){return vT(this,"indexOf",n)},join(n){return Pm(this).join(n)},lastIndexOf(...n){return vT(this,"lastIndexOf",n)},map(n,e){return Bu(this,"map",n,e,void 0,arguments)},pop(){return Ey(this,"pop")},push(...n){return Ey(this,"push",n)},reduce(n,...e){return A3(this,"reduce",n,e)},reduceRight(n,...e){return A3(this,"reduceRight",n,e)},shift(){return Ey(this,"shift")},some(n,e){return Bu(this,"some",n,e,void 0,arguments)},splice(...n){return Ey(this,"splice",n)},toReversed(){return Pm(this).toReversed()},toSorted(n){return Pm(this).toSorted(n)},toSpliced(...n){return Pm(this).toSpliced(...n)},unshift(...n){return Ey(this,"unshift",n)},values(){return yT(this,"values",Xo)}};function yT(n,e,o){const u=Fb(n),d=u[e]();return u!==n&&!vl(n)&&(d._next=d.next,d.next=()=>{const y=d._next();return y.value&&(y.value=o(y.value)),y}),d}const Fq=Array.prototype;function Bu(n,e,o,u,d,y){const v=Fb(n),r=v!==n&&!vl(n),D=v[e];if(D!==Fq[e]){const N=D.apply(n,y);return r?Xo(N):N}let B=o;v!==n&&(r?B=function(N,Q){return o.call(this,Xo(N),Q,n)}:o.length>2&&(B=function(N,Q){return o.call(this,N,Q,n)}));const F=D.call(v,B,u);return r&&d?d(F):F}function A3(n,e,o,u){const d=Fb(n);let y=o;return d!==n&&(vl(n)?o.length>3&&(y=function(v,r,D){return o.call(this,v,r,D,n)}):y=function(v,r,D){return o.call(this,v,Xo(r),D,n)}),d[e](y,...u)}function vT(n,e,o){const u=Pn(n);Yo(u,"iterate",x0);const d=u[e](...o);return(d===-1||d===!1)&&Ub(o[0])?(o[0]=Pn(o[0]),u[e](...o)):d}function Ey(n,e,o=[]){Ld(),$S();const u=Pn(n)[e].apply(n,o);return qS(),kd(),u}const Bq=Al("__proto__,__v_isRef,__isVue"),NL=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(Za));function Nq(n){Za(n)||(n=String(n));const e=Pn(this);return Yo(e,"has",n),e.hasOwnProperty(n)}class VL{constructor(e=!1,o=!1){this._isReadonly=e,this._isShallow=o}get(e,o,u){if(o==="__v_skip")return e.__v_skip;const d=this._isReadonly,y=this._isShallow;if(o==="__v_isReactive")return!d;if(o==="__v_isReadonly")return d;if(o==="__v_isShallow")return y;if(o==="__v_raw")return u===(d?y?GL:HL:y?qL:$L).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(u)?e:void 0;const v=Xi(e);if(!d){let D;if(v&&(D=zq[o]))return D;if(o==="hasOwnProperty")return Nq}const r=Reflect.get(e,o,To(e)?e:u);return(Za(o)?NL.has(o):Bq(o))||(d||Yo(e,"get",o),y)?r:To(r)?v&&US(o)?r:r.value:Qn(r)?d?GS(r):Nb(r):r}}class UL extends VL{constructor(e=!1){super(!1,e)}set(e,o,u,d){let y=e[o];if(!this._isShallow){const D=Sd(y);if(!vl(u)&&!Sd(u)&&(y=Pn(y),u=Pn(u)),!Xi(e)&&To(y)&&!To(u))return D?!1:(y.value=u,!0)}const v=Xi(e)&&US(o)?Number(o)<e.length:Un(e,o),r=Reflect.set(e,o,u,To(e)?e:d);return e===Pn(d)&&(v?wa(u,y)&&Hu(e,"set",o,u):Hu(e,"add",o,u)),r}deleteProperty(e,o){const u=Un(e,o);e[o];const d=Reflect.deleteProperty(e,o);return d&&u&&Hu(e,"delete",o,void 0),d}has(e,o){const u=Reflect.has(e,o);return(!Za(o)||!NL.has(o))&&Yo(e,"has",o),u}ownKeys(e){return Yo(e,"iterate",Xi(e)?"length":tp),Reflect.ownKeys(e)}}class jL extends VL{constructor(e=!1){super(!0,e)}set(e,o){return!0}deleteProperty(e,o){return!0}}const Vq=new UL,Uq=new jL,jq=new UL(!0),$q=new jL(!0),mE=n=>n,Cv=n=>Reflect.getPrototypeOf(n);function qq(n,e,o){return function(...u){const d=this.__v_raw,y=Pn(d),v=Km(y),r=n==="entries"||n===Symbol.iterator&&v,D=n==="keys"&&v,B=d[n](...u),F=o?mE:e?_E:Xo;return!e&&Yo(y,"iterate",D?pE:tp),{next(){const{value:N,done:Q}=B.next();return Q?{value:N,done:Q}:{value:r?[F(N[0]),F(N[1])]:F(N),done:Q}},[Symbol.iterator](){return this}}}}function Mv(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function Hq(n,e){const o={get(d){const y=this.__v_raw,v=Pn(y),r=Pn(d);n||(wa(d,r)&&Yo(v,"get",d),Yo(v,"get",r));const{has:D}=Cv(v),B=e?mE:n?_E:Xo;if(D.call(v,d))return B(y.get(d));if(D.call(v,r))return B(y.get(r));y!==v&&y.get(d)},get size(){const d=this.__v_raw;return!n&&Yo(Pn(d),"iterate",tp),Reflect.get(d,"size",d)},has(d){const y=this.__v_raw,v=Pn(y),r=Pn(d);return n||(wa(d,r)&&Yo(v,"has",d),Yo(v,"has",r)),d===r?y.has(d):y.has(d)||y.has(r)},forEach(d,y){const v=this,r=v.__v_raw,D=Pn(r),B=e?mE:n?_E:Xo;return!n&&Yo(D,"iterate",tp),r.forEach((F,N)=>d.call(y,B(F),B(N),v))}};return vn(o,n?{add:Mv("add"),set:Mv("set"),delete:Mv("delete"),clear:Mv("clear")}:{add(d){!e&&!vl(d)&&!Sd(d)&&(d=Pn(d));const y=Pn(this);return Cv(y).has.call(y,d)||(y.add(d),Hu(y,"add",d,d)),this},set(d,y){!e&&!vl(y)&&!Sd(y)&&(y=Pn(y));const v=Pn(this),{has:r,get:D}=Cv(v);let B=r.call(v,d);B||(d=Pn(d),B=r.call(v,d));const F=D.call(v,d);return v.set(d,y),B?wa(y,F)&&Hu(v,"set",d,y):Hu(v,"add",d,y),this},delete(d){const y=Pn(this),{has:v,get:r}=Cv(y);let D=v.call(y,d);D||(d=Pn(d),D=v.call(y,d)),r&&r.call(y,d);const B=y.delete(d);return D&&Hu(y,"delete",d,void 0),B},clear(){const d=Pn(this),y=d.size!==0,v=d.clear();return y&&Hu(d,"clear",void 0,void 0),v}}),["keys","values","entries",Symbol.iterator].forEach(d=>{o[d]=qq(d,n,e)}),o}function Bb(n,e){const o=Hq(n,e);return(u,d,y)=>d==="__v_isReactive"?!n:d==="__v_isReadonly"?n:d==="__v_raw"?u:Reflect.get(Un(o,d)&&d in u?o:u,d,y)}const Gq={get:Bb(!1,!1)},Wq={get:Bb(!1,!0)},Zq={get:Bb(!0,!1)},Yq={get:Bb(!0,!0)},$L=new WeakMap,qL=new WeakMap,HL=new WeakMap,GL=new WeakMap;function Xq(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Kq(n){return n.__v_skip||!Object.isExtensible(n)?0:Xq(aq(n))}function Nb(n){return Sd(n)?n:Vb(n,!1,Vq,Gq,$L)}function WL(n){return Vb(n,!1,jq,Wq,qL)}function GS(n){return Vb(n,!0,Uq,Zq,HL)}function Jq(n){return Vb(n,!0,$q,Yq,GL)}function Vb(n,e,o,u,d){if(!Qn(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const y=d.get(n);if(y)return y;const v=Kq(n);if(v===0)return n;const r=new Proxy(n,v===2?u:o);return d.set(n,r),r}function pd(n){return Sd(n)?pd(n.__v_raw):!!(n&&n.__v_isReactive)}function Sd(n){return!!(n&&n.__v_isReadonly)}function vl(n){return!!(n&&n.__v_isShallow)}function Ub(n){return n?!!n.__v_raw:!1}function Pn(n){const e=n&&n.__v_raw;return e?Pn(e):n}function ZL(n){return!Un(n,"__v_skip")&&Object.isExtensible(n)&&AL(n,"__v_skip",!0),n}const Xo=n=>Qn(n)?Nb(n):n,_E=n=>Qn(n)?GS(n):n;function To(n){return n?n.__v_isRef===!0:!1}function Bs(n){return XL(n,!1)}function YL(n){return XL(n,!0)}function XL(n,e){return To(n)?n:new Qq(n,e)}class Qq{constructor(e,o){this.dep=new zb,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=o?e:Pn(e),this._value=o?e:Xo(e),this.__v_isShallow=o}get value(){return this.dep.track(),this._value}set value(e){const o=this._rawValue,u=this.__v_isShallow||vl(e)||Sd(e);e=u?e:Pn(e),wa(e,o)&&(this._rawValue=e,this._value=u?e:Xo(e),this.dep.trigger())}}function eH(n){n.dep&&n.dep.trigger()}function jb(n){return To(n)?n.value:n}function tH(n){return Lr(n)?n():jb(n)}const iH={get:(n,e,o)=>e==="__v_raw"?n:jb(Reflect.get(n,e,o)),set:(n,e,o,u)=>{const d=n[e];return To(d)&&!To(o)?(d.value=o,!0):Reflect.set(n,e,o,u)}};function WS(n){return pd(n)?n:new Proxy(n,iH)}class rH{constructor(e){this.__v_isRef=!0,this._value=void 0;const o=this.dep=new zb,{get:u,set:d}=e(o.track.bind(o),o.trigger.bind(o));this._get=u,this._set=d}get value(){return this._value=this._get()}set value(e){this._set(e)}}function KL(n){return new rH(n)}function nH(n){const e=Xi(n)?new Array(n.length):{};for(const o in n)e[o]=JL(n,o);return e}class sH{constructor(e,o,u){this._object=e,this._key=o,this._defaultValue=u,this.__v_isRef=!0,this._value=void 0}get value(){const e=this._object[this._key];return this._value=e===void 0?this._defaultValue:e}set value(e){this._object[this._key]=e}get dep(){return kq(Pn(this._object),this._key)}}class oH{constructor(e){this._getter=e,this.__v_isRef=!0,this.__v_isReadonly=!0,this._value=void 0}get value(){return this._value=this._getter()}}function aH(n,e,o){return To(n)?n:Lr(n)?new oH(n):Qn(n)&&arguments.length>1?JL(n,e,o):Bs(n)}function JL(n,e,o){const u=n[e];return To(u)?u:new sH(n,e,o)}class lH{constructor(e,o,u){this.fn=e,this.setter=o,this._value=void 0,this.dep=new zb(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=v0-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!o,this.isSSR=u}notify(){if(this.flags|=16,!(this.flags&8)&&ms!==this)return OL(this,!0),!0}get value(){const e=this.dep.track();return zL(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function cH(n,e,o=!1){let u,d;return Lr(n)?u=n:(u=n.get,d=n.set),new lH(u,d,o)}const uH={GET:"get",HAS:"has",ITERATE:"iterate"},hH={SET:"set",ADD:"add",DELETE:"delete",CLEAR:"clear"},Iv={},jx=new WeakMap;let Qh;function dH(){return Qh}function QL(n,e=!1,o=Qh){if(o){let u=jx.get(o);u||jx.set(o,u=[]),u.push(n)}}function fH(n,e,o=yn){const{immediate:u,deep:d,once:y,scheduler:v,augmentJob:r,call:D}=o,B=ne=>d?ne:vl(ne)||d===!1||d===0?Gu(ne,1):Gu(ne);let F,N,Q,q,X=!1,G=!1;if(To(n)?(N=()=>n.value,X=vl(n)):pd(n)?(N=()=>B(n),X=!0):Xi(n)?(G=!0,X=n.some(ne=>pd(ne)||vl(ne)),N=()=>n.map(ne=>{if(To(ne))return ne.value;if(pd(ne))return B(ne);if(Lr(ne))return D?D(ne,2):ne()})):Lr(n)?e?N=D?()=>D(n,2):n:N=()=>{if(Q){Ld();try{Q()}finally{kd()}}const ne=Qh;Qh=F;try{return D?D(n,3,[q]):n(q)}finally{Qh=ne}}:N=Io,e&&d){const ne=N,ue=d===!0?1/0:d;N=()=>Gu(ne(),ue)}const ae=RL(),xe=()=>{F.stop(),ae&&ae.active&&NS(ae.effects,F)};if(y&&e){const ne=e;e=(...ue)=>{ne(...ue),xe()}}let Te=G?new Array(n.length).fill(Iv):Iv;const fe=ne=>{if(!(!(F.flags&1)||!F.dirty&&!ne))if(e){const ue=F.run();if(d||X||(G?ue.some((ye,le)=>wa(ye,Te[le])):wa(ue,Te))){Q&&Q();const ye=Qh;Qh=F;try{const le=[ue,Te===Iv?void 0:G&&Te[0]===Iv?[]:Te,q];D?D(e,3,le):e(...le),Te=ue}finally{Qh=ye}}}else F.run()};return r&&r(fe),F=new y0(N),F.scheduler=v?()=>v(fe,!1):fe,q=ne=>QL(ne,!1,F),Q=F.onStop=()=>{const ne=jx.get(F);if(ne){if(D)D(ne,4);else for(const ue of ne)ue();jx.delete(F)}},e?u?fe(!0):Te=F.run():v?v(fe.bind(null,!0),!0):F.run(),xe.pause=F.pause.bind(F),xe.resume=F.resume.bind(F),xe.stop=xe,xe}function Gu(n,e=1/0,o){if(e<=0||!Qn(n)||n.__v_skip||(o=o||new Set,o.has(n)))return n;if(o.add(n),e--,To(n))Gu(n.value,e,o);else if(Xi(n))for(let u=0;u<n.length;u++)Gu(n[u],e,o);else if(Ep(n)||Km(n))n.forEach(u=>{Gu(u,e,o)});else if(Db(n)){for(const u in n)Gu(n[u],e,o);for(const u of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,u)&&Gu(n[u],e,o)}return n}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const ek=[];function pH(n){ek.push(n)}function mH(){ek.pop()}function _H(n,e){}const gH={SETUP_FUNCTION:0,0:"SETUP_FUNCTION",RENDER_FUNCTION:1,1:"RENDER_FUNCTION",NATIVE_EVENT_HANDLER:5,5:"NATIVE_EVENT_HANDLER",COMPONENT_EVENT_HANDLER:6,6:"COMPONENT_EVENT_HANDLER",VNODE_HOOK:7,7:"VNODE_HOOK",DIRECTIVE_HOOK:8,8:"DIRECTIVE_HOOK",TRANSITION_HOOK:9,9:"TRANSITION_HOOK",APP_ERROR_HANDLER:10,10:"APP_ERROR_HANDLER",APP_WARN_HANDLER:11,11:"APP_WARN_HANDLER",FUNCTION_REF:12,12:"FUNCTION_REF",ASYNC_COMPONENT_LOADER:13,13:"ASYNC_COMPONENT_LOADER",SCHEDULER:14,14:"SCHEDULER",COMPONENT_UPDATE:15,15:"COMPONENT_UPDATE",APP_UNMOUNT_CLEANUP:16,16:"APP_UNMOUNT_CLEANUP"},yH={sp:"serverPrefetch hook",bc:"beforeCreate hook",c:"created hook",bm:"beforeMount hook",m:"mounted hook",bu:"beforeUpdate hook",u:"updated",bum:"beforeUnmount hook",um:"unmounted hook",a:"activated hook",da:"deactivated hook",ec:"errorCaptured hook",rtc:"renderTracked hook",rtg:"renderTriggered hook",0:"setup function",1:"render function",2:"watcher getter",3:"watcher callback",4:"watcher cleanup function",5:"native event handler",6:"component event handler",7:"vnode hook",8:"directive hook",9:"transition hook",10:"app errorHandler",11:"app warnHandler",12:"ref function",13:"async component loader",14:"scheduler flush",15:"component update",16:"app unmount cleanup function"};function F_(n,e,o,u){try{return u?n(...u):n()}catch(d){Ap(d,e,o)}}function rc(n,e,o,u){if(Lr(n)){const d=F_(n,e,o,u);return d&&VS(d)&&d.catch(y=>{Ap(y,e,o)}),d}if(Xi(n)){const d=[];for(let y=0;y<n.length;y++)d.push(rc(n[y],e,o,u));return d}}function Ap(n,e,o,u=!0){const d=e?e.vnode:null,{errorHandler:y,throwUnhandledErrorInProduction:v}=e&&e.appContext.config||yn;if(e){let r=e.parent;const D=e.proxy,B=`https://vuejs.org/error-reference/#runtime-${o}`;for(;r;){const F=r.ec;if(F){for(let N=0;N<F.length;N++)if(F[N](n,D,B)===!1)return}r=r.parent}if(y){Ld(),F_(y,null,10,[n,D,B]),kd();return}}vH(n,o,d,u,v)}function vH(n,e,o,u=!0,d=!1){if(d)throw n;console.error(n)}const Ta=[];let eu=-1;const e_=[];let ed=null,Bm=0;const tk=Promise.resolve();let $x=null;function $b(n){const e=$x||tk;return n?e.then(this?n.bind(this):n):e}function xH(n){let e=eu+1,o=Ta.length;for(;e<o;){const u=e+o>>>1,d=Ta[u],y=w0(d);y<n||y===n&&d.flags&2?e=u+1:o=u}return e}function ZS(n){if(!(n.flags&1)){const e=w0(n),o=Ta[Ta.length-1];!o||!(n.flags&2)&&e>=w0(o)?Ta.push(n):Ta.splice(xH(e),0,n),n.flags|=1,ik()}}function ik(){$x||($x=tk.then(rk))}function b0(n){Xi(n)?e_.push(...n):ed&&n.id===-1?ed.splice(Bm+1,0,n):n.flags&1||(e_.push(n),n.flags|=1),ik()}function C3(n,e,o=eu+1){for(;o<Ta.length;o++){const u=Ta[o];if(u&&u.flags&2){if(n&&u.id!==n.uid)continue;Ta.splice(o,1),o--,u.flags&4&&(u.flags&=-2),u(),u.flags&4||(u.flags&=-2)}}}function qx(n){if(e_.length){const e=[...new Set(e_)].sort((o,u)=>w0(o)-w0(u));if(e_.length=0,ed){ed.push(...e);return}for(ed=e,Bm=0;Bm<ed.length;Bm++){const o=ed[Bm];o.flags&4&&(o.flags&=-2),o.flags&8||o(),o.flags&=-2}ed=null,Bm=0}}const w0=n=>n.id==null?n.flags&2?-1:1/0:n.id;function rk(n){const e=Io;try{for(eu=0;eu<Ta.length;eu++){const o=Ta[eu];o&&!(o.flags&8)&&(o.flags&4&&(o.flags&=-2),F_(o,o.i,o.i?15:14),o.flags&4||(o.flags&=-2))}}finally{for(;eu<Ta.length;eu++){const o=Ta[eu];o&&(o.flags&=-2)}eu=-1,Ta.length=0,qx(),$x=null,(Ta.length||e_.length)&&rk()}}let Nm,Pv=[];function nk(n,e){var o,u;Nm=n,Nm?(Nm.enabled=!0,Pv.forEach(({event:d,args:y})=>Nm.emit(d,...y)),Pv=[]):typeof window<"u"&&window.HTMLElement&&!((u=(o=window.navigator)==null?void 0:o.userAgent)!=null&&u.includes("jsdom"))?((e.__VUE_DEVTOOLS_HOOK_REPLAY__=e.__VUE_DEVTOOLS_HOOK_REPLAY__||[]).push(y=>{nk(y,e)}),setTimeout(()=>{Nm||(e.__VUE_DEVTOOLS_HOOK_REPLAY__=null,Pv=[])},3e3)):Pv=[]}let wo=null,qb=null;function T0(n){const e=wo;return wo=n,qb=n&&n.type.__scopeId||null,e}function bH(n){qb=n}function wH(){qb=null}const TH=n=>YS;function YS(n,e=wo,o){if(!e||n._n)return n;const u=(...d)=>{u._d&&EE(-1);const y=T0(e);let v;try{v=n(...d)}finally{T0(y),u._d&&EE(1)}return v};return u._n=!0,u._c=!0,u._d=!0,u}function tn(n,e){if(wo===null)return n;const o=W0(wo),u=n.dirs||(n.dirs=[]);for(let d=0;d<e.length;d++){let[y,v,r,D=yn]=e[d];y&&(Lr(y)&&(y={mounted:y,updated:y}),y.deep&&Gu(v),u.push({dir:y,instance:o,value:v,oldValue:void 0,arg:r,modifiers:D}))}return n}function iu(n,e,o,u){const d=n.dirs,y=e&&e.dirs;for(let v=0;v<d.length;v++){const r=d[v];y&&(r.oldValue=y[v].value);let D=r.dir[u];D&&(Ld(),rc(D,o,8,[n.el,r,n,e]),kd())}}const sk=Symbol("_vte"),ok=n=>n.__isTeleport,Wy=n=>n&&(n.disabled||n.disabled===""),M3=n=>n&&(n.defer||n.defer===""),I3=n=>typeof SVGElement<"u"&&n instanceof SVGElement,P3=n=>typeof MathMLElement=="function"&&n instanceof MathMLElement,gE=(n,e)=>{const o=n&&n.to;return Gr(o)?e?e(o):null:o},ak={name:"Teleport",__isTeleport:!0,process(n,e,o,u,d,y,v,r,D,B){const{mc:F,pc:N,pbc:Q,o:{insert:q,querySelector:X,createText:G,createComment:ae}}=B,xe=Wy(e.props);let{shapeFlag:Te,children:fe,dynamicChildren:ne}=e;if(n==null){const ue=e.el=G(""),ye=e.anchor=G("");q(ue,o,u),q(ye,o,u);const le=(oe,se)=>{Te&16&&(d&&d.isCE&&(d.ce._teleportTarget=oe),F(fe,oe,se,d,y,v,r,D))},re=()=>{const oe=e.target=gE(e.props,X),se=lk(oe,e,G,q);oe&&(v!=="svg"&&I3(oe)?v="svg":v!=="mathml"&&P3(oe)&&(v="mathml"),xe||(le(oe,se),cx(e,!1)))};xe&&(le(o,ye),cx(e,!0)),M3(e.props)?yo(()=>{re(),e.el.__isMounted=!0},y):re()}else{if(M3(e.props)&&!n.el.__isMounted){yo(()=>{ak.process(n,e,o,u,d,y,v,r,D,B),delete n.el.__isMounted},y);return}e.el=n.el,e.targetStart=n.targetStart;const ue=e.anchor=n.anchor,ye=e.target=n.target,le=e.targetAnchor=n.targetAnchor,re=Wy(n.props),oe=re?o:ye,se=re?ue:le;if(v==="svg"||I3(ye)?v="svg":(v==="mathml"||P3(ye))&&(v="mathml"),ne?(Q(n.dynamicChildren,ne,oe,d,y,v,r),oA(n,e,!0)):D||N(n,e,oe,se,d,y,v,r,!1),xe)re?e.props&&n.props&&e.props.to!==n.props.to&&(e.props.to=n.props.to):Rv(e,o,ue,B,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const Ae=e.target=gE(e.props,X);Ae&&Rv(e,Ae,null,B,0)}else re&&Rv(e,ye,le,B,1);cx(e,xe)}},remove(n,e,o,{um:u,o:{remove:d}},y){const{shapeFlag:v,children:r,anchor:D,targetStart:B,targetAnchor:F,target:N,props:Q}=n;if(N&&(d(B),d(F)),y&&d(D),v&16){const q=y||!Wy(Q);for(let X=0;X<r.length;X++){const G=r[X];u(G,e,o,q,!!G.dynamicChildren)}}},move:Rv,hydrate:EH};function Rv(n,e,o,{o:{insert:u},m:d},y=2){y===0&&u(n.targetAnchor,e,o);const{el:v,anchor:r,shapeFlag:D,children:B,props:F}=n,N=y===2;if(N&&u(v,e,o),(!N||Wy(F))&&D&16)for(let Q=0;Q<B.length;Q++)d(B[Q],e,o,2);N&&u(r,e,o)}function EH(n,e,o,u,d,y,{o:{nextSibling:v,parentNode:r,querySelector:D,insert:B,createText:F}},N){const Q=e.target=gE(e.props,D);if(Q){const q=Wy(e.props),X=Q._lpa||Q.firstChild;if(e.shapeFlag&16)if(q)e.anchor=N(v(n),e,r(n),o,u,d,y),e.targetStart=X,e.targetAnchor=X&&v(X);else{e.anchor=v(n);let G=X;for(;G;){if(G&&G.nodeType===8){if(G.data==="teleport start anchor")e.targetStart=G;else if(G.data==="teleport anchor"){e.targetAnchor=G,Q._lpa=e.targetAnchor&&v(e.targetAnchor);break}}G=v(G)}e.targetAnchor||lk(Q,e,F,B),N(X&&v(X),e,Q,o,u,d,y)}cx(e,q)}return e.anchor&&v(e.anchor)}const SH=ak;function cx(n,e){const o=n.ctx;if(o&&o.ut){let u,d;for(e?(u=n.el,d=n.anchor):(u=n.targetStart,d=n.targetAnchor);u&&u!==d;)u.nodeType===1&&u.setAttribute("data-v-owner",o.uid),u=u.nextSibling;o.ut()}}function lk(n,e,o,u){const d=e.targetStart=o(""),y=e.targetAnchor=o("");return d[sk]=y,n&&(u(d,n),u(y,n)),y}const td=Symbol("_leaveCb"),Dv=Symbol("_enterCb");function XS(){const n={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Sl(()=>{n.isMounted=!0}),q0(()=>{n.isUnmounting=!0}),n}const ql=[Function,Array],KS={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:ql,onEnter:ql,onAfterEnter:ql,onEnterCancelled:ql,onBeforeLeave:ql,onLeave:ql,onAfterLeave:ql,onLeaveCancelled:ql,onBeforeAppear:ql,onAppear:ql,onAfterAppear:ql,onAppearCancelled:ql},ck=n=>{const e=n.subTree;return e.component?ck(e.component):e},AH={name:"BaseTransition",props:KS,setup(n,{slots:e}){const o=sc(),u=XS();return()=>{const d=e.default&&Hb(e.default(),!0);if(!d||!d.length)return;const y=uk(d),v=Pn(n),{mode:r}=v;if(u.isLeaving)return xT(y);const D=R3(y);if(!D)return xT(y);let B=v_(D,v,u,o,N=>B=N);D.type!==ao&&nh(D,B);let F=o.subTree&&R3(o.subTree);if(F&&F.type!==ao&&!Sc(D,F)&&ck(o).type!==ao){let N=v_(F,v,u,o);if(nh(F,N),r==="out-in"&&D.type!==ao)return u.isLeaving=!0,N.afterLeave=()=>{u.isLeaving=!1,o.job.flags&8||o.update(),delete N.afterLeave,F=void 0},xT(y);r==="in-out"&&D.type!==ao?N.delayLeave=(Q,q,X)=>{const G=dk(u,F);G[String(F.key)]=F,Q[td]=()=>{q(),Q[td]=void 0,delete B.delayedLeave,F=void 0},B.delayedLeave=()=>{X(),delete B.delayedLeave,F=void 0}}:F=void 0}else F&&(F=void 0);return y}}};function uk(n){let e=n[0];if(n.length>1){for(const o of n)if(o.type!==ao){e=o;break}}return e}const hk=AH;function dk(n,e){const{leavingVNodes:o}=n;let u=o.get(e.type);return u||(u=Object.create(null),o.set(e.type,u)),u}function v_(n,e,o,u,d){const{appear:y,mode:v,persisted:r=!1,onBeforeEnter:D,onEnter:B,onAfterEnter:F,onEnterCancelled:N,onBeforeLeave:Q,onLeave:q,onAfterLeave:X,onLeaveCancelled:G,onBeforeAppear:ae,onAppear:xe,onAfterAppear:Te,onAppearCancelled:fe}=e,ne=String(n.key),ue=dk(o,n),ye=(oe,se)=>{oe&&rc(oe,u,9,se)},le=(oe,se)=>{const Ae=se[1];ye(oe,se),Xi(oe)?oe.every(De=>De.length<=1)&&Ae():oe.length<=1&&Ae()},re={mode:v,persisted:r,beforeEnter(oe){let se=D;if(!o.isMounted)if(y)se=ae||D;else return;oe[td]&&oe[td](!0);const Ae=ue[ne];Ae&&Sc(n,Ae)&&Ae.el[td]&&Ae.el[td](),ye(se,[oe])},enter(oe){let se=B,Ae=F,De=N;if(!o.isMounted)if(y)se=xe||B,Ae=Te||F,De=fe||N;else return;let Ge=!1;const yt=oe[Dv]=ct=>{Ge||(Ge=!0,ct?ye(De,[oe]):ye(Ae,[oe]),re.delayedLeave&&re.delayedLeave(),oe[Dv]=void 0)};se?le(se,[oe,yt]):yt()},leave(oe,se){const Ae=String(n.key);if(oe[Dv]&&oe[Dv](!0),o.isUnmounting)return se();ye(Q,[oe]);let De=!1;const Ge=oe[td]=yt=>{De||(De=!0,se(),yt?ye(G,[oe]):ye(X,[oe]),oe[td]=void 0,ue[Ae]===n&&delete ue[Ae])};ue[Ae]=n,q?le(q,[oe,Ge]):Ge()},clone(oe){const se=v_(oe,e,o,u,d);return d&&d(se),se}};return re}function xT(n){if($0(n))return n=fu(n),n.children=null,n}function R3(n){if(!$0(n))return ok(n.type)&&n.children?uk(n.children):n;const{shapeFlag:e,children:o}=n;if(o){if(e&16)return o[0];if(e&32&&Lr(o.default))return o.default()}}function nh(n,e){n.shapeFlag&6&&n.component?(n.transition=e,nh(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}function Hb(n,e=!1,o){let u=[],d=0;for(let y=0;y<n.length;y++){let v=n[y];const r=o==null?v.key:String(o)+String(v.key!=null?v.key:y);v.type===ur?(v.patchFlag&128&&d++,u=u.concat(Hb(v.children,e,r))):(e||v.type!==ao)&&u.push(r!=null?fu(v,{key:r}):v)}if(d>1)for(let y=0;y<u.length;y++)u[y].patchFlag=-2;return u}/*! #__NO_SIDE_EFFECTS__ */function Gb(n,e){return Lr(n)?(()=>vn({name:n.name},e,{setup:n}))():n}function CH(){const n=sc();return n?(n.appContext.config.idPrefix||"v")+"-"+n.ids[0]+n.ids[1]++:""}function JS(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function MH(n){const e=sc(),o=YL(null);if(e){const d=e.refs===yn?e.refs={}:e.refs;Object.defineProperty(d,n,{enumerable:!0,get:()=>o.value,set:y=>o.value=y})}return o}function E0(n,e,o,u,d=!1){if(Xi(n)){n.forEach((X,G)=>E0(X,e&&(Xi(e)?e[G]:e),o,u,d));return}if(md(u)&&!d){u.shapeFlag&512&&u.type.__asyncResolved&&u.component.subTree.component&&E0(n,e,o,u.component.subTree);return}const y=u.shapeFlag&4?W0(u.component):u.el,v=d?null:y,{i:r,r:D}=n,B=e&&e.r,F=r.refs===yn?r.refs={}:r.refs,N=r.setupState,Q=Pn(N),q=N===yn?()=>!1:X=>Un(Q,X);if(B!=null&&B!==D&&(Gr(B)?(F[B]=null,q(B)&&(N[B]=null)):To(B)&&(B.value=null)),Lr(D))F_(D,r,12,[v,F]);else{const X=Gr(D),G=To(D);if(X||G){const ae=()=>{if(n.f){const xe=X?q(D)?N[D]:F[D]:D.value;d?Xi(xe)&&NS(xe,y):Xi(xe)?xe.includes(y)||xe.push(y):X?(F[D]=[y],q(D)&&(N[D]=F[D])):(D.value=[y],n.k&&(F[n.k]=D.value))}else X?(F[D]=v,q(D)&&(N[D]=v)):G&&(D.value=v,n.k&&(F[n.k]=v))};v?(ae.id=-1,yo(ae,o)):ae()}}}let D3=!1;const Rm=()=>{D3||(console.error("Hydration completed but contains mismatches."),D3=!0)},IH=n=>n.namespaceURI.includes("svg")&&n.tagName!=="foreignObject",PH=n=>n.namespaceURI.includes("MathML"),Ov=n=>{if(n.nodeType===1){if(IH(n))return"svg";if(PH(n))return"mathml"}},Hm=n=>n.nodeType===8;function RH(n){const{mt:e,p:o,o:{patchProp:u,createText:d,nextSibling:y,parentNode:v,remove:r,insert:D,createComment:B}}=n,F=(fe,ne)=>{if(!ne.hasChildNodes()){o(null,fe,ne),qx(),ne._vnode=fe;return}N(ne.firstChild,fe,null,null,null),qx(),ne._vnode=fe},N=(fe,ne,ue,ye,le,re=!1)=>{re=re||!!ne.dynamicChildren;const oe=Hm(fe)&&fe.data==="[",se=()=>G(fe,ne,ue,ye,le,oe),{type:Ae,ref:De,shapeFlag:Ge,patchFlag:yt}=ne;let ct=fe.nodeType;ne.el=fe,yt===-2&&(re=!1,ne.dynamicChildren=null);let mt=null;switch(Ae){case _d:ct!==3?ne.children===""?(D(ne.el=d(""),v(fe),fe),mt=fe):mt=se():(fe.data!==ne.children&&(Rm(),fe.data=ne.children),mt=y(fe));break;case ao:Te(fe)?(mt=y(fe),xe(ne.el=fe.content.firstChild,fe,ue)):ct!==8||oe?mt=se():mt=y(fe);break;case rp:if(oe&&(fe=y(fe),ct=fe.nodeType),ct===1||ct===3){mt=fe;const et=!ne.children.length;for(let Qe=0;Qe<ne.staticCount;Qe++)et&&(ne.children+=mt.nodeType===1?mt.outerHTML:mt.data),Qe===ne.staticCount-1&&(ne.anchor=mt),mt=y(mt);return oe?y(mt):mt}else se();break;case ur:oe?mt=X(fe,ne,ue,ye,le,re):mt=se();break;default:if(Ge&1)(ct!==1||ne.type.toLowerCase()!==fe.tagName.toLowerCase())&&!Te(fe)?mt=se():mt=Q(fe,ne,ue,ye,le,re);else if(Ge&6){ne.slotScopeIds=le;const et=v(fe);if(oe?mt=ae(fe):Hm(fe)&&fe.data==="teleport start"?mt=ae(fe,fe.data,"teleport end"):mt=y(fe),e(ne,et,null,ue,ye,Ov(et),re),md(ne)&&!ne.type.__asyncResolved){let Qe;oe?(Qe=hs(ur),Qe.anchor=mt?mt.previousSibling:et.lastChild):Qe=fe.nodeType===3?Eo(""):hs("div"),Qe.el=fe,ne.component.subTree=Qe}}else Ge&64?ct!==8?mt=se():mt=ne.type.hydrate(fe,ne,ue,ye,le,re,n,q):Ge&128&&(mt=ne.type.hydrate(fe,ne,ue,ye,Ov(v(fe)),le,re,n,N))}return De!=null&&E0(De,null,ye,ne),mt},Q=(fe,ne,ue,ye,le,re)=>{re=re||!!ne.dynamicChildren;const{type:oe,props:se,patchFlag:Ae,shapeFlag:De,dirs:Ge,transition:yt}=ne,ct=oe==="input"||oe==="option";if(ct||Ae!==-1){Ge&&iu(ne,null,ue,"created");let mt=!1;if(Te(fe)){mt=Nk(null,yt)&&ue&&ue.vnode.props&&ue.vnode.props.appear;const Qe=fe.content.firstChild;mt&&yt.beforeEnter(Qe),xe(Qe,fe,ue),ne.el=fe=Qe}if(De&16&&!(se&&(se.innerHTML||se.textContent))){let Qe=q(fe.firstChild,ne,fe,ue,ye,le,re);for(;Qe;){Lv(fe,1)||Rm();const vt=Qe;Qe=Qe.nextSibling,r(vt)}}else if(De&8){let Qe=ne.children;Qe[0]===`
`&&(fe.tagName==="PRE"||fe.tagName==="TEXTAREA")&&(Qe=Qe.slice(1)),fe.textContent!==Qe&&(Lv(fe,0)||Rm(),fe.textContent=ne.children)}if(se){if(ct||!re||Ae&48){const Qe=fe.tagName.includes("-");for(const vt in se)(ct&&(vt.endsWith("value")||vt==="indeterminate")||Tp(vt)&&!fd(vt)||vt[0]==="."||Qe)&&u(fe,vt,null,se[vt],void 0,ue)}else if(se.onClick)u(fe,"onClick",null,se.onClick,void 0,ue);else if(Ae&4&&pd(se.style))for(const Qe in se.style)se.style[Qe]}let et;(et=se&&se.onVnodeBeforeMount)&&za(et,ue,ne),Ge&&iu(ne,null,ue,"beforeMount"),((et=se&&se.onVnodeMounted)||Ge||mt)&&Zk(()=>{et&&za(et,ue,ne),mt&&yt.enter(fe),Ge&&iu(ne,null,ue,"mounted")},ye)}return fe.nextSibling},q=(fe,ne,ue,ye,le,re,oe)=>{oe=oe||!!ne.dynamicChildren;const se=ne.children,Ae=se.length;for(let De=0;De<Ae;De++){const Ge=oe?se[De]:se[De]=Ba(se[De]),yt=Ge.type===_d;fe?(yt&&!oe&&De+1<Ae&&Ba(se[De+1]).type===_d&&(D(d(fe.data.slice(Ge.children.length)),ue,y(fe)),fe.data=Ge.children),fe=N(fe,Ge,ye,le,re,oe)):yt&&!Ge.children?D(Ge.el=d(""),ue):(Lv(ue,1)||Rm(),o(null,Ge,ue,null,ye,le,Ov(ue),re))}return fe},X=(fe,ne,ue,ye,le,re)=>{const{slotScopeIds:oe}=ne;oe&&(le=le?le.concat(oe):oe);const se=v(fe),Ae=q(y(fe),ne,se,ue,ye,le,re);return Ae&&Hm(Ae)&&Ae.data==="]"?y(ne.anchor=Ae):(Rm(),D(ne.anchor=B("]"),se,Ae),Ae)},G=(fe,ne,ue,ye,le,re)=>{if(Lv(fe.parentElement,1)||Rm(),ne.el=null,re){const Ae=ae(fe);for(;;){const De=y(fe);if(De&&De!==Ae)r(De);else break}}const oe=y(fe),se=v(fe);return r(fe),o(null,ne,se,oe,ue,ye,Ov(se),le),ue&&(ue.vnode.el=ne.el,Xb(ue,ne.el)),oe},ae=(fe,ne="[",ue="]")=>{let ye=0;for(;fe;)if(fe=y(fe),fe&&Hm(fe)&&(fe.data===ne&&ye++,fe.data===ue)){if(ye===0)return y(fe);ye--}return fe},xe=(fe,ne,ue)=>{const ye=ne.parentNode;ye&&ye.replaceChild(fe,ne);let le=ue;for(;le;)le.vnode.el===ne&&(le.vnode.el=le.subTree.el=fe),le=le.parent},Te=fe=>fe.nodeType===1&&fe.tagName==="TEMPLATE";return[F,N]}const O3="data-allow-mismatch",DH={0:"text",1:"children",2:"class",3:"style",4:"attribute"};function Lv(n,e){if(e===0||e===1)for(;n&&!n.hasAttribute(O3);)n=n.parentElement;const o=n&&n.getAttribute(O3);if(o==null)return!1;if(o==="")return!0;{const u=o.split(",");return e===0&&u.includes("children")?!0:o.split(",").includes(DH[e])}}const OH=Lb().requestIdleCallback||(n=>setTimeout(n,1)),LH=Lb().cancelIdleCallback||(n=>clearTimeout(n)),kH=(n=1e4)=>e=>{const o=OH(e,{timeout:n});return()=>LH(o)};function zH(n){const{top:e,left:o,bottom:u,right:d}=n.getBoundingClientRect(),{innerHeight:y,innerWidth:v}=window;return(e>0&&e<y||u>0&&u<y)&&(o>0&&o<v||d>0&&d<v)}const FH=n=>(e,o)=>{const u=new IntersectionObserver(d=>{for(const y of d)if(y.isIntersecting){u.disconnect(),e();break}},n);return o(d=>{if(d instanceof Element){if(zH(d))return e(),u.disconnect(),!1;u.observe(d)}}),()=>u.disconnect()},BH=n=>e=>{if(n){const o=matchMedia(n);if(o.matches)e();else return o.addEventListener("change",e,{once:!0}),()=>o.removeEventListener("change",e)}},NH=(n=[])=>(e,o)=>{Gr(n)&&(n=[n]);let u=!1;const d=v=>{u||(u=!0,y(),e(),v.target.dispatchEvent(new v.constructor(v.type,v)))},y=()=>{o(v=>{for(const r of n)v.removeEventListener(r,d)})};return o(v=>{for(const r of n)v.addEventListener(r,d,{once:!0})}),y};function VH(n,e){if(Hm(n)&&n.data==="["){let o=1,u=n.nextSibling;for(;u;){if(u.nodeType===1){if(e(u)===!1)break}else if(Hm(u))if(u.data==="]"){if(--o===0)break}else u.data==="["&&o++;u=u.nextSibling}}else e(n)}const md=n=>!!n.type.__asyncLoader;/*! #__NO_SIDE_EFFECTS__ */function UH(n){Lr(n)&&(n={loader:n});const{loader:e,loadingComponent:o,errorComponent:u,delay:d=200,hydrate:y,timeout:v,suspensible:r=!0,onError:D}=n;let B=null,F,N=0;const Q=()=>(N++,B=null,q()),q=()=>{let X;return B||(X=B=e().catch(G=>{if(G=G instanceof Error?G:new Error(String(G)),D)return new Promise((ae,xe)=>{D(G,()=>ae(Q()),()=>xe(G),N+1)});throw G}).then(G=>X!==B&&B?B:(G&&(G.__esModule||G[Symbol.toStringTag]==="Module")&&(G=G.default),F=G,G)))};return Gb({name:"AsyncComponentWrapper",__asyncLoader:q,__asyncHydrate(X,G,ae){const xe=y?()=>{const Te=y(ae,fe=>VH(X,fe));Te&&(G.bum||(G.bum=[])).push(Te)}:ae;F?xe():q().then(()=>!G.isUnmounted&&xe())},get __asyncResolved(){return F},setup(){const X=bo;if(JS(X),F)return()=>bT(F,X);const G=fe=>{B=null,Ap(fe,X,13,!u)};if(r&&X.suspense||b_)return q().then(fe=>()=>bT(fe,X)).catch(fe=>(G(fe),()=>u?hs(u,{error:fe}):null));const ae=Bs(!1),xe=Bs(),Te=Bs(!!d);return d&&setTimeout(()=>{Te.value=!1},d),v!=null&&setTimeout(()=>{if(!ae.value&&!xe.value){const fe=new Error(`Async component timed out after ${v}ms.`);G(fe),xe.value=fe}},v),q().then(()=>{ae.value=!0,X.parent&&$0(X.parent.vnode)&&X.parent.update()}).catch(fe=>{G(fe),xe.value=fe}),()=>{if(ae.value&&F)return bT(F,X);if(xe.value&&u)return hs(u,{error:xe.value});if(o&&!Te.value)return hs(o)}}})}function bT(n,e){const{ref:o,props:u,children:d,ce:y}=e.vnode,v=hs(n,u,d);return v.ref=o,v.ce=y,delete e.vnode.ce,v}const $0=n=>n.type.__isKeepAlive,jH={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(n,{slots:e}){const o=sc(),u=o.ctx;if(!u.renderer)return()=>{const Te=e.default&&e.default();return Te&&Te.length===1?Te[0]:Te};const d=new Map,y=new Set;let v=null;const r=o.suspense,{renderer:{p:D,m:B,um:F,o:{createElement:N}}}=u,Q=N("div");u.activate=(Te,fe,ne,ue,ye)=>{const le=Te.component;B(Te,fe,ne,0,r),D(le.vnode,Te,fe,ne,le,r,ue,Te.slotScopeIds,ye),yo(()=>{le.isDeactivated=!1,le.a&&Qm(le.a);const re=Te.props&&Te.props.onVnodeMounted;re&&za(re,le.parent,Te)},r)},u.deactivate=Te=>{const fe=Te.component;Gx(fe.m),Gx(fe.a),B(Te,Q,null,1,r),yo(()=>{fe.da&&Qm(fe.da);const ne=Te.props&&Te.props.onVnodeUnmounted;ne&&za(ne,fe.parent,Te),fe.isDeactivated=!0},r)};function q(Te){wT(Te),F(Te,o,r,!0)}function X(Te){d.forEach((fe,ne)=>{const ue=IE(fe.type);ue&&!Te(ue)&&G(ne)})}function G(Te){const fe=d.get(Te);fe&&(!v||!Sc(fe,v))?q(fe):v&&wT(v),d.delete(Te),y.delete(Te)}Ua(()=>[n.include,n.exclude],([Te,fe])=>{Te&&X(ne=>Dy(Te,ne)),fe&&X(ne=>!Dy(fe,ne))},{flush:"post",deep:!0});let ae=null;const xe=()=>{ae!=null&&(Wx(o.subTree.type)?yo(()=>{d.set(ae,kv(o.subTree))},o.subTree.suspense):d.set(ae,kv(o.subTree)))};return Sl(xe),Zb(xe),q0(()=>{d.forEach(Te=>{const{subTree:fe,suspense:ne}=o,ue=kv(fe);if(Te.type===ue.type&&Te.key===ue.key){wT(ue);const ye=ue.component.da;ye&&yo(ye,ne);return}q(Te)})}),()=>{if(ae=null,!e.default)return v=null;const Te=e.default(),fe=Te[0];if(Te.length>1)return v=null,Te;if(!sh(fe)||!(fe.shapeFlag&4)&&!(fe.shapeFlag&128))return v=null,fe;let ne=kv(fe);if(ne.type===ao)return v=null,ne;const ue=ne.type,ye=IE(md(ne)?ne.type.__asyncResolved||{}:ue),{include:le,exclude:re,max:oe}=n;if(le&&(!ye||!Dy(le,ye))||re&&ye&&Dy(re,ye))return ne.shapeFlag&=-257,v=ne,fe;const se=ne.key==null?ue:ne.key,Ae=d.get(se);return ne.el&&(ne=fu(ne),fe.shapeFlag&128&&(fe.ssContent=ne)),ae=se,Ae?(ne.el=Ae.el,ne.component=Ae.component,ne.transition&&nh(ne,ne.transition),ne.shapeFlag|=512,y.delete(se),y.add(se)):(y.add(se),oe&&y.size>parseInt(oe,10)&&G(y.values().next().value)),ne.shapeFlag|=256,v=ne,Wx(fe.type)?fe:ne}}},$H=jH;function Dy(n,e){return Xi(n)?n.some(o=>Dy(o,e)):Gr(n)?n.split(",").includes(e):oq(n)?(n.lastIndex=0,n.test(e)):!1}function fk(n,e){mk(n,"a",e)}function pk(n,e){mk(n,"da",e)}function mk(n,e,o=bo){const u=n.__wdc||(n.__wdc=()=>{let d=o;for(;d;){if(d.isDeactivated)return;d=d.parent}return n()});if(Wb(e,u,o),o){let d=o.parent;for(;d&&d.parent;)$0(d.parent.vnode)&&qH(u,e,o,d),d=d.parent}}function qH(n,e,o,u){const d=Wb(e,n,u,!0);H0(()=>{NS(u[e],d)},o)}function wT(n){n.shapeFlag&=-257,n.shapeFlag&=-513}function kv(n){return n.shapeFlag&128?n.ssContent:n}function Wb(n,e,o=bo,u=!1){if(o){const d=o[n]||(o[n]=[]),y=e.__weh||(e.__weh=(...v)=>{Ld();const r=pp(o),D=rc(e,o,n,v);return r(),kd(),D});return u?d.unshift(y):d.push(y),y}}const ah=n=>(e,o=bo)=>{(!b_||n==="sp")&&Wb(n,(...u)=>e(...u),o)},_k=ah("bm"),Sl=ah("m"),QS=ah("bu"),Zb=ah("u"),q0=ah("bum"),H0=ah("um"),gk=ah("sp"),yk=ah("rtg"),vk=ah("rtc");function xk(n,e=bo){Wb("ec",n,e)}const eA="components",HH="directives";function tA(n,e){return iA(eA,n,!0,e)||n}const bk=Symbol.for("v-ndc");function GH(n){return Gr(n)?iA(eA,n,!1)||n:n||bk}function WH(n){return iA(HH,n)}function iA(n,e,o=!0,u=!1){const d=wo||bo;if(d){const y=d.type;if(n===eA){const r=IE(y,!1);if(r&&(r===e||r===ws(e)||r===Sp(ws(e))))return y}const v=L3(d[n]||y[n],e)||L3(d.appContext[n],e);return!v&&u?y:v}}function L3(n,e){return n&&(n[e]||n[ws(e)]||n[Sp(ws(e))])}function _n(n,e,o,u){let d;const y=o&&o[u],v=Xi(n);if(v||Gr(n)){const r=v&&pd(n);let D=!1;r&&(D=!vl(n),n=Fb(n)),d=new Array(n.length);for(let B=0,F=n.length;B<F;B++)d[B]=e(D?Xo(n[B]):n[B],B,void 0,y&&y[B])}else if(typeof n=="number"){d=new Array(n);for(let r=0;r<n;r++)d[r]=e(r+1,r,void 0,y&&y[r])}else if(Qn(n))if(n[Symbol.iterator])d=Array.from(n,(r,D)=>e(r,D,void 0,y&&y[D]));else{const r=Object.keys(n);d=new Array(r.length);for(let D=0,B=r.length;D<B;D++){const F=r[D];d[D]=e(n[F],F,D,y&&y[D])}}else d=[];return o&&(o[u]=d),d}function ZH(n,e){for(let o=0;o<e.length;o++){const u=e[o];if(Xi(u))for(let d=0;d<u.length;d++)n[u[d].name]=u[d].fn;else u&&(n[u.name]=u.key?(...d)=>{const y=u.fn(...d);return y&&(y.key=u.key),y}:u.fn)}return n}function wk(n,e,o={},u,d){if(wo.ce||wo.parent&&md(wo.parent)&&wo.parent.ce)return e!=="default"&&(o.name=e),zt(),C0(ur,null,[hs("slot",o,u&&u())],64);let y=n[e];y&&y._c&&(y._d=!1),zt();const v=y&&rA(y(o)),r=o.key||v&&v.key,D=C0(ur,{key:(r&&!Za(r)?r:`_${e}`)+(!v&&u?"_fb":"")},v||(u?u():[]),v&&n._===1?64:-2);return!d&&D.scopeId&&(D.slotScopeIds=[D.scopeId+"-s"]),y&&y._c&&(y._d=!0),D}function rA(n){return n.some(e=>sh(e)?!(e.type===ao||e.type===ur&&!rA(e.children)):!0)?n:null}function YH(n,e){const o={};for(const u in n)o[e&&/[A-Z]/.test(u)?`on:${u}`:Jm(u)]=n[u];return o}const yE=n=>n?t5(n)?W0(n):yE(n.parent):null,Zy=vn(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>yE(n.parent),$root:n=>yE(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>nA(n),$forceUpdate:n=>n.f||(n.f=()=>{ZS(n.update)}),$nextTick:n=>n.n||(n.n=$b.bind(n.proxy)),$watch:n=>CG.bind(n)}),TT=(n,e)=>n!==yn&&!n.__isScriptSetup&&Un(n,e),vE={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:o,setupState:u,data:d,props:y,accessCache:v,type:r,appContext:D}=n;let B;if(e[0]!=="$"){const q=v[e];if(q!==void 0)switch(q){case 1:return u[e];case 2:return d[e];case 4:return o[e];case 3:return y[e]}else{if(TT(u,e))return v[e]=1,u[e];if(d!==yn&&Un(d,e))return v[e]=2,d[e];if((B=n.propsOptions[0])&&Un(B,e))return v[e]=3,y[e];if(o!==yn&&Un(o,e))return v[e]=4,o[e];xE&&(v[e]=0)}}const F=Zy[e];let N,Q;if(F)return e==="$attrs"&&Yo(n.attrs,"get",""),F(n);if((N=r.__cssModules)&&(N=N[e]))return N;if(o!==yn&&Un(o,e))return v[e]=4,o[e];if(Q=D.config.globalProperties,Un(Q,e))return Q[e]},set({_:n},e,o){const{data:u,setupState:d,ctx:y}=n;return TT(d,e)?(d[e]=o,!0):u!==yn&&Un(u,e)?(u[e]=o,!0):Un(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(y[e]=o,!0)},has({_:{data:n,setupState:e,accessCache:o,ctx:u,appContext:d,propsOptions:y}},v){let r;return!!o[v]||n!==yn&&Un(n,v)||TT(e,v)||(r=y[0])&&Un(r,v)||Un(u,v)||Un(Zy,v)||Un(d.config.globalProperties,v)},defineProperty(n,e,o){return o.get!=null?n._.accessCache[e]=0:Un(o,"value")&&this.set(n,e,o.value,null),Reflect.defineProperty(n,e,o)}},XH=vn({},vE,{get(n,e){if(e!==Symbol.unscopables)return vE.get(n,e,n)},has(n,e){return e[0]!=="_"&&!fq(e)}});function KH(){return null}function JH(){return null}function QH(n){}function eG(n){}function tG(){return null}function iG(){}function rG(n,e){return null}function nG(){return Tk().slots}function sG(){return Tk().attrs}function Tk(){const n=sc();return n.setupContext||(n.setupContext=s5(n))}function S0(n){return Xi(n)?n.reduce((e,o)=>(e[o]=null,e),{}):n}function oG(n,e){const o=S0(n);for(const u in e){if(u.startsWith("__skip"))continue;let d=o[u];d?Xi(d)||Lr(d)?d=o[u]={type:d,default:e[u]}:d.default=e[u]:d===null&&(d=o[u]={default:e[u]}),d&&e[`__skip_${u}`]&&(d.skipFactory=!0)}return o}function aG(n,e){return!n||!e?n||e:Xi(n)&&Xi(e)?n.concat(e):vn({},S0(n),S0(e))}function lG(n,e){const o={};for(const u in n)e.includes(u)||Object.defineProperty(o,u,{enumerable:!0,get:()=>n[u]});return o}function cG(n){const e=sc();let o=n();return AE(),VS(o)&&(o=o.catch(u=>{throw pp(e),u})),[o,()=>pp(e)]}let xE=!0;function uG(n){const e=nA(n),o=n.proxy,u=n.ctx;xE=!1,e.beforeCreate&&k3(e.beforeCreate,n,"bc");const{data:d,computed:y,methods:v,watch:r,provide:D,inject:B,created:F,beforeMount:N,mounted:Q,beforeUpdate:q,updated:X,activated:G,deactivated:ae,beforeDestroy:xe,beforeUnmount:Te,destroyed:fe,unmounted:ne,render:ue,renderTracked:ye,renderTriggered:le,errorCaptured:re,serverPrefetch:oe,expose:se,inheritAttrs:Ae,components:De,directives:Ge,filters:yt}=e;if(B&&hG(B,u,null),v)for(const et in v){const Qe=v[et];Lr(Qe)&&(u[et]=Qe.bind(o))}if(d){const et=d.call(o,o);Qn(et)&&(n.data=Nb(et))}if(xE=!0,y)for(const et in y){const Qe=y[et],vt=Lr(Qe)?Qe.bind(o,o):Lr(Qe.get)?Qe.get.bind(o,o):Io,st=!Lr(Qe)&&Lr(Qe.set)?Qe.set.bind(o):Io,Zt=Ky({get:vt,set:st});Object.defineProperty(u,et,{enumerable:!0,configurable:!0,get:()=>Zt.value,set:ui=>Zt.value=ui})}if(r)for(const et in r)Ek(r[et],u,o,et);if(D){const et=Lr(D)?D.call(o):D;Reflect.ownKeys(et).forEach(Qe=>{Ak(Qe,et[Qe])})}F&&k3(F,n,"c");function mt(et,Qe){Xi(Qe)?Qe.forEach(vt=>et(vt.bind(o))):Qe&&et(Qe.bind(o))}if(mt(_k,N),mt(Sl,Q),mt(QS,q),mt(Zb,X),mt(fk,G),mt(pk,ae),mt(xk,re),mt(vk,ye),mt(yk,le),mt(q0,Te),mt(H0,ne),mt(gk,oe),Xi(se))if(se.length){const et=n.exposed||(n.exposed={});se.forEach(Qe=>{Object.defineProperty(et,Qe,{get:()=>o[Qe],set:vt=>o[Qe]=vt})})}else n.exposed||(n.exposed={});ue&&n.render===Io&&(n.render=ue),Ae!=null&&(n.inheritAttrs=Ae),De&&(n.components=De),Ge&&(n.directives=Ge),oe&&JS(n)}function hG(n,e,o=Io){Xi(n)&&(n=bE(n));for(const u in n){const d=n[u];let y;Qn(d)?"default"in d?y=Yy(d.from||u,d.default,!0):y=Yy(d.from||u):y=Yy(d),To(y)?Object.defineProperty(e,u,{enumerable:!0,configurable:!0,get:()=>y.value,set:v=>y.value=v}):e[u]=y}}function k3(n,e,o){rc(Xi(n)?n.map(u=>u.bind(e.proxy)):n.bind(e.proxy),e,o)}function Ek(n,e,o,u){let d=u.includes(".")?qk(o,u):()=>o[u];if(Gr(n)){const y=e[n];Lr(y)&&Ua(d,y)}else if(Lr(n))Ua(d,n.bind(o));else if(Qn(n))if(Xi(n))n.forEach(y=>Ek(y,e,o,u));else{const y=Lr(n.handler)?n.handler.bind(o):e[n.handler];Lr(y)&&Ua(d,y,n)}}function nA(n){const e=n.type,{mixins:o,extends:u}=e,{mixins:d,optionsCache:y,config:{optionMergeStrategies:v}}=n.appContext,r=y.get(e);let D;return r?D=r:!d.length&&!o&&!u?D=e:(D={},d.length&&d.forEach(B=>Hx(D,B,v,!0)),Hx(D,e,v)),Qn(e)&&y.set(e,D),D}function Hx(n,e,o,u=!1){const{mixins:d,extends:y}=e;y&&Hx(n,y,o,!0),d&&d.forEach(v=>Hx(n,v,o,!0));for(const v in e)if(!(u&&v==="expose")){const r=dG[v]||o&&o[v];n[v]=r?r(n[v],e[v]):e[v]}return n}const dG={data:z3,props:F3,emits:F3,methods:Oy,computed:Oy,beforeCreate:_a,created:_a,beforeMount:_a,mounted:_a,beforeUpdate:_a,updated:_a,beforeDestroy:_a,beforeUnmount:_a,destroyed:_a,unmounted:_a,activated:_a,deactivated:_a,errorCaptured:_a,serverPrefetch:_a,components:Oy,directives:Oy,watch:pG,provide:z3,inject:fG};function z3(n,e){return e?n?function(){return vn(Lr(n)?n.call(this,this):n,Lr(e)?e.call(this,this):e)}:e:n}function fG(n,e){return Oy(bE(n),bE(e))}function bE(n){if(Xi(n)){const e={};for(let o=0;o<n.length;o++)e[n[o]]=n[o];return e}return n}function _a(n,e){return n?[...new Set([].concat(n,e))]:e}function Oy(n,e){return n?vn(Object.create(null),n,e):e}function F3(n,e){return n?Xi(n)&&Xi(e)?[...new Set([...n,...e])]:vn(Object.create(null),S0(n),S0(e??{})):e}function pG(n,e){if(!n)return e;if(!e)return n;const o=vn(Object.create(null),n);for(const u in e)o[u]=_a(n[u],e[u]);return o}function Sk(){return{app:null,config:{isNativeTag:Ry,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let mG=0;function _G(n,e){return function(u,d=null){Lr(u)||(u=vn({},u)),d!=null&&!Qn(d)&&(d=null);const y=Sk(),v=new WeakSet,r=[];let D=!1;const B=y.app={_uid:mG++,_component:u,_props:d,_container:null,_context:y,_instance:null,version:l5,get config(){return y.config},set config(F){},use(F,...N){return v.has(F)||(F&&Lr(F.install)?(v.add(F),F.install(B,...N)):Lr(F)&&(v.add(F),F(B,...N))),B},mixin(F){return y.mixins.includes(F)||y.mixins.push(F),B},component(F,N){return N?(y.components[F]=N,B):y.components[F]},directive(F,N){return N?(y.directives[F]=N,B):y.directives[F]},mount(F,N,Q){if(!D){const q=B._ceVNode||hs(u,d);return q.appContext=y,Q===!0?Q="svg":Q===!1&&(Q=void 0),N&&e?e(q,F):n(q,F,Q),D=!0,B._container=F,F.__vue_app__=B,W0(q.component)}},onUnmount(F){r.push(F)},unmount(){D&&(rc(r,B._instance,16),n(null,B._container),delete B._container.__vue_app__)},provide(F,N){return y.provides[F]=N,B},runWithContext(F){const N=ip;ip=B;try{return F()}finally{ip=N}}};return B}}let ip=null;function Ak(n,e){if(bo){let o=bo.provides;const u=bo.parent&&bo.parent.provides;u===o&&(o=bo.provides=Object.create(u)),o[n]=e}}function Yy(n,e,o=!1){const u=bo||wo;if(u||ip){const d=ip?ip._context.provides:u?u.parent==null?u.vnode.appContext&&u.vnode.appContext.provides:u.parent.provides:void 0;if(d&&n in d)return d[n];if(arguments.length>1)return o&&Lr(e)?e.call(u&&u.proxy):e}}function gG(){return!!(bo||wo||ip)}const Ck={},Mk=()=>Object.create(Ck),Ik=n=>Object.getPrototypeOf(n)===Ck;function yG(n,e,o,u=!1){const d={},y=Mk();n.propsDefaults=Object.create(null),Pk(n,e,d,y);for(const v in n.propsOptions[0])v in d||(d[v]=void 0);o?n.props=u?d:WL(d):n.type.props?n.props=d:n.props=y,n.attrs=y}function vG(n,e,o,u){const{props:d,attrs:y,vnode:{patchFlag:v}}=n,r=Pn(d),[D]=n.propsOptions;let B=!1;if((u||v>0)&&!(v&16)){if(v&8){const F=n.vnode.dynamicProps;for(let N=0;N<F.length;N++){let Q=F[N];if(Yb(n.emitsOptions,Q))continue;const q=e[Q];if(D)if(Un(y,Q))q!==y[Q]&&(y[Q]=q,B=!0);else{const X=ws(Q);d[X]=wE(D,r,X,q,n,!1)}else q!==y[Q]&&(y[Q]=q,B=!0)}}}else{Pk(n,e,d,y)&&(B=!0);let F;for(const N in r)(!e||!Un(e,N)&&((F=Va(N))===N||!Un(e,F)))&&(D?o&&(o[N]!==void 0||o[F]!==void 0)&&(d[N]=wE(D,r,N,void 0,n,!0)):delete d[N]);if(y!==r)for(const N in y)(!e||!Un(e,N))&&(delete y[N],B=!0)}B&&Hu(n.attrs,"set","")}function Pk(n,e,o,u){const[d,y]=n.propsOptions;let v=!1,r;if(e)for(let D in e){if(fd(D))continue;const B=e[D];let F;d&&Un(d,F=ws(D))?!y||!y.includes(F)?o[F]=B:(r||(r={}))[F]=B:Yb(n.emitsOptions,D)||(!(D in u)||B!==u[D])&&(u[D]=B,v=!0)}if(y){const D=Pn(o),B=r||yn;for(let F=0;F<y.length;F++){const N=y[F];o[N]=wE(d,D,N,B[N],n,!Un(B,N))}}return v}function wE(n,e,o,u,d,y){const v=n[o];if(v!=null){const r=Un(v,"default");if(r&&u===void 0){const D=v.default;if(v.type!==Function&&!v.skipFactory&&Lr(D)){const{propsDefaults:B}=d;if(o in B)u=B[o];else{const F=pp(d);u=B[o]=D.call(null,e),F()}}else u=D;d.ce&&d.ce._setProp(o,u)}v[0]&&(y&&!r?u=!1:v[1]&&(u===""||u===Va(o))&&(u=!0))}return u}const xG=new WeakMap;function Rk(n,e,o=!1){const u=o?xG:e.propsCache,d=u.get(n);if(d)return d;const y=n.props,v={},r=[];let D=!1;if(!Lr(n)){const F=N=>{D=!0;const[Q,q]=Rk(N,e,!0);vn(v,Q),q&&r.push(...q)};!o&&e.mixins.length&&e.mixins.forEach(F),n.extends&&F(n.extends),n.mixins&&n.mixins.forEach(F)}if(!y&&!D)return Qn(n)&&u.set(n,Xm),Xm;if(Xi(y))for(let F=0;F<y.length;F++){const N=ws(y[F]);B3(N)&&(v[N]=yn)}else if(y)for(const F in y){const N=ws(F);if(B3(N)){const Q=y[F],q=v[N]=Xi(Q)||Lr(Q)?{type:Q}:vn({},Q),X=q.type;let G=!1,ae=!0;if(Xi(X))for(let xe=0;xe<X.length;++xe){const Te=X[xe],fe=Lr(Te)&&Te.name;if(fe==="Boolean"){G=!0;break}else fe==="String"&&(ae=!1)}else G=Lr(X)&&X.name==="Boolean";q[0]=G,q[1]=ae,(G||Un(q,"default"))&&r.push(N)}}const B=[v,r];return Qn(n)&&u.set(n,B),B}function B3(n){return n[0]!=="$"&&!fd(n)}const Dk=n=>n[0]==="_"||n==="$stable",sA=n=>Xi(n)?n.map(Ba):[Ba(n)],bG=(n,e,o)=>{if(e._n)return e;const u=YS((...d)=>sA(e(...d)),o);return u._c=!1,u},Ok=(n,e,o)=>{const u=n._ctx;for(const d in n){if(Dk(d))continue;const y=n[d];if(Lr(y))e[d]=bG(d,y,u);else if(y!=null){const v=sA(y);e[d]=()=>v}}},Lk=(n,e)=>{const o=sA(e);n.slots.default=()=>o},kk=(n,e,o)=>{for(const u in e)(o||u!=="_")&&(n[u]=e[u])},wG=(n,e,o)=>{const u=n.slots=Mk();if(n.vnode.shapeFlag&32){const d=e._;d?(kk(u,e,o),o&&AL(u,"_",d,!0)):Ok(e,u)}else e&&Lk(n,e)},TG=(n,e,o)=>{const{vnode:u,slots:d}=n;let y=!0,v=yn;if(u.shapeFlag&32){const r=e._;r?o&&r===1?y=!1:kk(d,e,o):(y=!e.$stable,Ok(e,d)),v=e}else e&&(Lk(n,e),v={default:1});if(y)for(const r in d)!Dk(r)&&v[r]==null&&delete d[r]},yo=Zk;function zk(n){return Bk(n)}function Fk(n){return Bk(n,RH)}function Bk(n,e){const o=Lb();o.__VUE__=!0;const{insert:u,remove:d,patchProp:y,createElement:v,createText:r,createComment:D,setText:B,setElementText:F,parentNode:N,nextSibling:Q,setScopeId:q=Io,insertStaticContent:X}=n,G=(Ee,ve,Ie,Tt=null,qe=null,Et=null,It=void 0,$t=null,Kt=!!ve.dynamicChildren)=>{if(Ee===ve)return;Ee&&!Sc(Ee,ve)&&(Tt=Ui(Ee),ui(Ee,qe,Et,!0),Ee=null),ve.patchFlag===-2&&(Kt=!1,ve.dynamicChildren=null);const{type:ti,ref:Li,shapeFlag:Ut}=ve;switch(ti){case _d:ae(Ee,ve,Ie,Tt);break;case ao:xe(Ee,ve,Ie,Tt);break;case rp:Ee==null&&Te(ve,Ie,Tt,It);break;case ur:De(Ee,ve,Ie,Tt,qe,Et,It,$t,Kt);break;default:Ut&1?ue(Ee,ve,Ie,Tt,qe,Et,It,$t,Kt):Ut&6?Ge(Ee,ve,Ie,Tt,qe,Et,It,$t,Kt):(Ut&64||Ut&128)&&ti.process(Ee,ve,Ie,Tt,qe,Et,It,$t,Kt,H)}Li!=null&&qe&&E0(Li,Ee&&Ee.ref,Et,ve||Ee,!ve)},ae=(Ee,ve,Ie,Tt)=>{if(Ee==null)u(ve.el=r(ve.children),Ie,Tt);else{const qe=ve.el=Ee.el;ve.children!==Ee.children&&B(qe,ve.children)}},xe=(Ee,ve,Ie,Tt)=>{Ee==null?u(ve.el=D(ve.children||""),Ie,Tt):ve.el=Ee.el},Te=(Ee,ve,Ie,Tt)=>{[Ee.el,Ee.anchor]=X(Ee.children,ve,Ie,Tt,Ee.el,Ee.anchor)},fe=({el:Ee,anchor:ve},Ie,Tt)=>{let qe;for(;Ee&&Ee!==ve;)qe=Q(Ee),u(Ee,Ie,Tt),Ee=qe;u(ve,Ie,Tt)},ne=({el:Ee,anchor:ve})=>{let Ie;for(;Ee&&Ee!==ve;)Ie=Q(Ee),d(Ee),Ee=Ie;d(ve)},ue=(Ee,ve,Ie,Tt,qe,Et,It,$t,Kt)=>{ve.type==="svg"?It="svg":ve.type==="math"&&(It="mathml"),Ee==null?ye(ve,Ie,Tt,qe,Et,It,$t,Kt):oe(Ee,ve,qe,Et,It,$t,Kt)},ye=(Ee,ve,Ie,Tt,qe,Et,It,$t)=>{let Kt,ti;const{props:Li,shapeFlag:Ut,transition:yi,dirs:zi}=Ee;if(Kt=Ee.el=v(Ee.type,Et,Li&&Li.is,Li),Ut&8?F(Kt,Ee.children):Ut&16&&re(Ee.children,Kt,null,Tt,qe,ET(Ee,Et),It,$t),zi&&iu(Ee,null,Tt,"created"),le(Kt,Ee,Ee.scopeId,It,Tt),Li){for(const Ki in Li)Ki!=="value"&&!fd(Ki)&&y(Kt,Ki,null,Li[Ki],Et,Tt);"value"in Li&&y(Kt,"value",null,Li.value,Et),(ti=Li.onVnodeBeforeMount)&&za(ti,Tt,Ee)}zi&&iu(Ee,null,Tt,"beforeMount");const Ni=Nk(qe,yi);Ni&&yi.beforeEnter(Kt),u(Kt,ve,Ie),((ti=Li&&Li.onVnodeMounted)||Ni||zi)&&yo(()=>{ti&&za(ti,Tt,Ee),Ni&&yi.enter(Kt),zi&&iu(Ee,null,Tt,"mounted")},qe)},le=(Ee,ve,Ie,Tt,qe)=>{if(Ie&&q(Ee,Ie),Tt)for(let Et=0;Et<Tt.length;Et++)q(Ee,Tt[Et]);if(qe){let Et=qe.subTree;if(ve===Et||Wx(Et.type)&&(Et.ssContent===ve||Et.ssFallback===ve)){const It=qe.vnode;le(Ee,It,It.scopeId,It.slotScopeIds,qe.parent)}}},re=(Ee,ve,Ie,Tt,qe,Et,It,$t,Kt=0)=>{for(let ti=Kt;ti<Ee.length;ti++){const Li=Ee[ti]=$t?rd(Ee[ti]):Ba(Ee[ti]);G(null,Li,ve,Ie,Tt,qe,Et,It,$t)}},oe=(Ee,ve,Ie,Tt,qe,Et,It)=>{const $t=ve.el=Ee.el;let{patchFlag:Kt,dynamicChildren:ti,dirs:Li}=ve;Kt|=Ee.patchFlag&16;const Ut=Ee.props||yn,yi=ve.props||yn;let zi;if(Ie&&Ff(Ie,!1),(zi=yi.onVnodeBeforeUpdate)&&za(zi,Ie,ve,Ee),Li&&iu(ve,Ee,Ie,"beforeUpdate"),Ie&&Ff(Ie,!0),(Ut.innerHTML&&yi.innerHTML==null||Ut.textContent&&yi.textContent==null)&&F($t,""),ti?se(Ee.dynamicChildren,ti,$t,Ie,Tt,ET(ve,qe),Et):It||Qe(Ee,ve,$t,null,Ie,Tt,ET(ve,qe),Et,!1),Kt>0){if(Kt&16)Ae($t,Ut,yi,Ie,qe);else if(Kt&2&&Ut.class!==yi.class&&y($t,"class",null,yi.class,qe),Kt&4&&y($t,"style",Ut.style,yi.style,qe),Kt&8){const Ni=ve.dynamicProps;for(let Ki=0;Ki<Ni.length;Ki++){const sr=Ni[Ki],Rr=Ut[sr],Yr=yi[sr];(Yr!==Rr||sr==="value")&&y($t,sr,Rr,Yr,qe,Ie)}}Kt&1&&Ee.children!==ve.children&&F($t,ve.children)}else!It&&ti==null&&Ae($t,Ut,yi,Ie,qe);((zi=yi.onVnodeUpdated)||Li)&&yo(()=>{zi&&za(zi,Ie,ve,Ee),Li&&iu(ve,Ee,Ie,"updated")},Tt)},se=(Ee,ve,Ie,Tt,qe,Et,It)=>{for(let $t=0;$t<ve.length;$t++){const Kt=Ee[$t],ti=ve[$t],Li=Kt.el&&(Kt.type===ur||!Sc(Kt,ti)||Kt.shapeFlag&70)?N(Kt.el):Ie;G(Kt,ti,Li,null,Tt,qe,Et,It,!0)}},Ae=(Ee,ve,Ie,Tt,qe)=>{if(ve!==Ie){if(ve!==yn)for(const Et in ve)!fd(Et)&&!(Et in Ie)&&y(Ee,Et,ve[Et],null,qe,Tt);for(const Et in Ie){if(fd(Et))continue;const It=Ie[Et],$t=ve[Et];It!==$t&&Et!=="value"&&y(Ee,Et,$t,It,qe,Tt)}"value"in Ie&&y(Ee,"value",ve.value,Ie.value,qe)}},De=(Ee,ve,Ie,Tt,qe,Et,It,$t,Kt)=>{const ti=ve.el=Ee?Ee.el:r(""),Li=ve.anchor=Ee?Ee.anchor:r("");let{patchFlag:Ut,dynamicChildren:yi,slotScopeIds:zi}=ve;zi&&($t=$t?$t.concat(zi):zi),Ee==null?(u(ti,Ie,Tt),u(Li,Ie,Tt),re(ve.children||[],Ie,Li,qe,Et,It,$t,Kt)):Ut>0&&Ut&64&&yi&&Ee.dynamicChildren?(se(Ee.dynamicChildren,yi,Ie,qe,Et,It,$t),(ve.key!=null||qe&&ve===qe.subTree)&&oA(Ee,ve,!0)):Qe(Ee,ve,Ie,Li,qe,Et,It,$t,Kt)},Ge=(Ee,ve,Ie,Tt,qe,Et,It,$t,Kt)=>{ve.slotScopeIds=$t,Ee==null?ve.shapeFlag&512?qe.ctx.activate(ve,Ie,Tt,It,Kt):yt(ve,Ie,Tt,qe,Et,It,Kt):ct(Ee,ve,Kt)},yt=(Ee,ve,Ie,Tt,qe,Et,It)=>{const $t=Ee.component=e5(Ee,Tt,qe);if($0(Ee)&&($t.ctx.renderer=H),i5($t,!1,It),$t.asyncDep){if(qe&&qe.registerDep($t,mt,It),!Ee.el){const Kt=$t.subTree=hs(ao);xe(null,Kt,ve,Ie)}}else mt($t,Ee,ve,Ie,qe,Et,It)},ct=(Ee,ve,Ie)=>{const Tt=ve.component=Ee.component;if(OG(Ee,ve,Ie))if(Tt.asyncDep&&!Tt.asyncResolved){et(Tt,ve,Ie);return}else Tt.next=ve,Tt.update();else ve.el=Ee.el,Tt.vnode=ve},mt=(Ee,ve,Ie,Tt,qe,Et,It)=>{const $t=()=>{if(Ee.isMounted){let{next:Ut,bu:yi,u:zi,parent:Ni,vnode:Ki}=Ee;{const yr=Vk(Ee);if(yr){Ut&&(Ut.el=Ki.el,et(Ee,Ut,It)),yr.asyncDep.then(()=>{Ee.isUnmounted||$t()});return}}let sr=Ut,Rr;Ff(Ee,!1),Ut?(Ut.el=Ki.el,et(Ee,Ut,It)):Ut=Ki,yi&&Qm(yi),(Rr=Ut.props&&Ut.props.onVnodeBeforeUpdate)&&za(Rr,Ni,Ut,Ki),Ff(Ee,!0);const Yr=ux(Ee),kr=Ee.subTree;Ee.subTree=Yr,G(kr,Yr,N(kr.el),Ui(kr),Ee,qe,Et),Ut.el=Yr.el,sr===null&&Xb(Ee,Yr.el),zi&&yo(zi,qe),(Rr=Ut.props&&Ut.props.onVnodeUpdated)&&yo(()=>za(Rr,Ni,Ut,Ki),qe)}else{let Ut;const{el:yi,props:zi}=ve,{bm:Ni,m:Ki,parent:sr,root:Rr,type:Yr}=Ee,kr=md(ve);if(Ff(Ee,!1),Ni&&Qm(Ni),!kr&&(Ut=zi&&zi.onVnodeBeforeMount)&&za(Ut,sr,ve),Ff(Ee,!0),yi&&Be){const yr=()=>{Ee.subTree=ux(Ee),Be(yi,Ee.subTree,Ee,qe,null)};kr&&Yr.__asyncHydrate?Yr.__asyncHydrate(yi,Ee,yr):yr()}else{Rr.ce&&Rr.ce._injectChildStyle(Yr);const yr=Ee.subTree=ux(Ee);G(null,yr,Ie,Tt,Ee,qe,Et),ve.el=yr.el}if(Ki&&yo(Ki,qe),!kr&&(Ut=zi&&zi.onVnodeMounted)){const yr=ve;yo(()=>za(Ut,sr,yr),qe)}(ve.shapeFlag&256||sr&&md(sr.vnode)&&sr.vnode.shapeFlag&256)&&Ee.a&&yo(Ee.a,qe),Ee.isMounted=!0,ve=Ie=Tt=null}};Ee.scope.on();const Kt=Ee.effect=new y0($t);Ee.scope.off();const ti=Ee.update=Kt.run.bind(Kt),Li=Ee.job=Kt.runIfDirty.bind(Kt);Li.i=Ee,Li.id=Ee.uid,Kt.scheduler=()=>ZS(Li),Ff(Ee,!0),ti()},et=(Ee,ve,Ie)=>{ve.component=Ee;const Tt=Ee.vnode.props;Ee.vnode=ve,Ee.next=null,vG(Ee,ve.props,Tt,Ie),TG(Ee,ve.children,Ie),Ld(),C3(Ee),kd()},Qe=(Ee,ve,Ie,Tt,qe,Et,It,$t,Kt=!1)=>{const ti=Ee&&Ee.children,Li=Ee?Ee.shapeFlag:0,Ut=ve.children,{patchFlag:yi,shapeFlag:zi}=ve;if(yi>0){if(yi&128){st(ti,Ut,Ie,Tt,qe,Et,It,$t,Kt);return}else if(yi&256){vt(ti,Ut,Ie,Tt,qe,Et,It,$t,Kt);return}}zi&8?(Li&16&&Ii(ti,qe,Et),Ut!==ti&&F(Ie,Ut)):Li&16?zi&16?st(ti,Ut,Ie,Tt,qe,Et,It,$t,Kt):Ii(ti,qe,Et,!0):(Li&8&&F(Ie,""),zi&16&&re(Ut,Ie,Tt,qe,Et,It,$t,Kt))},vt=(Ee,ve,Ie,Tt,qe,Et,It,$t,Kt)=>{Ee=Ee||Xm,ve=ve||Xm;const ti=Ee.length,Li=ve.length,Ut=Math.min(ti,Li);let yi;for(yi=0;yi<Ut;yi++){const zi=ve[yi]=Kt?rd(ve[yi]):Ba(ve[yi]);G(Ee[yi],zi,Ie,null,qe,Et,It,$t,Kt)}ti>Li?Ii(Ee,qe,Et,!0,!1,Ut):re(ve,Ie,Tt,qe,Et,It,$t,Kt,Ut)},st=(Ee,ve,Ie,Tt,qe,Et,It,$t,Kt)=>{let ti=0;const Li=ve.length;let Ut=Ee.length-1,yi=Li-1;for(;ti<=Ut&&ti<=yi;){const zi=Ee[ti],Ni=ve[ti]=Kt?rd(ve[ti]):Ba(ve[ti]);if(Sc(zi,Ni))G(zi,Ni,Ie,null,qe,Et,It,$t,Kt);else break;ti++}for(;ti<=Ut&&ti<=yi;){const zi=Ee[Ut],Ni=ve[yi]=Kt?rd(ve[yi]):Ba(ve[yi]);if(Sc(zi,Ni))G(zi,Ni,Ie,null,qe,Et,It,$t,Kt);else break;Ut--,yi--}if(ti>Ut){if(ti<=yi){const zi=yi+1,Ni=zi<Li?ve[zi].el:Tt;for(;ti<=yi;)G(null,ve[ti]=Kt?rd(ve[ti]):Ba(ve[ti]),Ie,Ni,qe,Et,It,$t,Kt),ti++}}else if(ti>yi)for(;ti<=Ut;)ui(Ee[ti],qe,Et,!0),ti++;else{const zi=ti,Ni=ti,Ki=new Map;for(ti=Ni;ti<=yi;ti++){const Ar=ve[ti]=Kt?rd(ve[ti]):Ba(ve[ti]);Ar.key!=null&&Ki.set(Ar.key,ti)}let sr,Rr=0;const Yr=yi-Ni+1;let kr=!1,yr=0;const nn=new Array(Yr);for(ti=0;ti<Yr;ti++)nn[ti]=0;for(ti=zi;ti<=Ut;ti++){const Ar=Ee[ti];if(Rr>=Yr){ui(Ar,qe,Et,!0);continue}let Ur;if(Ar.key!=null)Ur=Ki.get(Ar.key);else for(sr=Ni;sr<=yi;sr++)if(nn[sr-Ni]===0&&Sc(Ar,ve[sr])){Ur=sr;break}Ur===void 0?ui(Ar,qe,Et,!0):(nn[Ur-Ni]=ti+1,Ur>=yr?yr=Ur:kr=!0,G(Ar,ve[Ur],Ie,null,qe,Et,It,$t,Kt),Rr++)}const Ts=kr?EG(nn):Xm;for(sr=Ts.length-1,ti=Yr-1;ti>=0;ti--){const Ar=Ni+ti,Ur=ve[Ar],Vi=Ar+1<Li?ve[Ar+1].el:Tt;nn[ti]===0?G(null,Ur,Ie,Vi,qe,Et,It,$t,Kt):kr&&(sr<0||ti!==Ts[sr]?Zt(Ur,Ie,Vi,2):sr--)}}},Zt=(Ee,ve,Ie,Tt,qe=null)=>{const{el:Et,type:It,transition:$t,children:Kt,shapeFlag:ti}=Ee;if(ti&6){Zt(Ee.component.subTree,ve,Ie,Tt);return}if(ti&128){Ee.suspense.move(ve,Ie,Tt);return}if(ti&64){It.move(Ee,ve,Ie,H);return}if(It===ur){u(Et,ve,Ie);for(let Ut=0;Ut<Kt.length;Ut++)Zt(Kt[Ut],ve,Ie,Tt);u(Ee.anchor,ve,Ie);return}if(It===rp){fe(Ee,ve,Ie);return}if(Tt!==2&&ti&1&&$t)if(Tt===0)$t.beforeEnter(Et),u(Et,ve,Ie),yo(()=>$t.enter(Et),qe);else{const{leave:Ut,delayLeave:yi,afterLeave:zi}=$t,Ni=()=>u(Et,ve,Ie),Ki=()=>{Ut(Et,()=>{Ni(),zi&&zi()})};yi?yi(Et,Ni,Ki):Ki()}else u(Et,ve,Ie)},ui=(Ee,ve,Ie,Tt=!1,qe=!1)=>{const{type:Et,props:It,ref:$t,children:Kt,dynamicChildren:ti,shapeFlag:Li,patchFlag:Ut,dirs:yi,cacheIndex:zi}=Ee;if(Ut===-2&&(qe=!1),$t!=null&&E0($t,null,Ie,Ee,!0),zi!=null&&(ve.renderCache[zi]=void 0),Li&256){ve.ctx.deactivate(Ee);return}const Ni=Li&1&&yi,Ki=!md(Ee);let sr;if(Ki&&(sr=It&&It.onVnodeBeforeUnmount)&&za(sr,ve,Ee),Li&6)Ci(Ee.component,Ie,Tt);else{if(Li&128){Ee.suspense.unmount(Ie,Tt);return}Ni&&iu(Ee,null,ve,"beforeUnmount"),Li&64?Ee.type.remove(Ee,ve,Ie,H,Tt):ti&&!ti.hasOnce&&(Et!==ur||Ut>0&&Ut&64)?Ii(ti,ve,Ie,!1,!0):(Et===ur&&Ut&384||!qe&&Li&16)&&Ii(Kt,ve,Ie),Tt&&ni(Ee)}(Ki&&(sr=It&&It.onVnodeUnmounted)||Ni)&&yo(()=>{sr&&za(sr,ve,Ee),Ni&&iu(Ee,null,ve,"unmounted")},Ie)},ni=Ee=>{const{type:ve,el:Ie,anchor:Tt,transition:qe}=Ee;if(ve===ur){Hi(Ie,Tt);return}if(ve===rp){ne(Ee);return}const Et=()=>{d(Ie),qe&&!qe.persisted&&qe.afterLeave&&qe.afterLeave()};if(Ee.shapeFlag&1&&qe&&!qe.persisted){const{leave:It,delayLeave:$t}=qe,Kt=()=>It(Ie,Et);$t?$t(Ee.el,Et,Kt):Kt()}else Et()},Hi=(Ee,ve)=>{let Ie;for(;Ee!==ve;)Ie=Q(Ee),d(Ee),Ee=Ie;d(ve)},Ci=(Ee,ve,Ie)=>{const{bum:Tt,scope:qe,job:Et,subTree:It,um:$t,m:Kt,a:ti}=Ee;Gx(Kt),Gx(ti),Tt&&Qm(Tt),qe.stop(),Et&&(Et.flags|=8,ui(It,Ee,ve,Ie)),$t&&yo($t,ve),yo(()=>{Ee.isUnmounted=!0},ve),ve&&ve.pendingBranch&&!ve.isUnmounted&&Ee.asyncDep&&!Ee.asyncResolved&&Ee.suspenseId===ve.pendingId&&(ve.deps--,ve.deps===0&&ve.resolve())},Ii=(Ee,ve,Ie,Tt=!1,qe=!1,Et=0)=>{for(let It=Et;It<Ee.length;It++)ui(Ee[It],ve,Ie,Tt,qe)},Ui=Ee=>{if(Ee.shapeFlag&6)return Ui(Ee.component.subTree);if(Ee.shapeFlag&128)return Ee.suspense.next();const ve=Q(Ee.anchor||Ee.el),Ie=ve&&ve[sk];return Ie?Q(Ie):ve};let xi=!1;const Yi=(Ee,ve,Ie)=>{Ee==null?ve._vnode&&ui(ve._vnode,null,null,!0):G(ve._vnode||null,Ee,ve,null,null,null,Ie),ve._vnode=Ee,xi||(xi=!0,C3(),qx(),xi=!1)},H={p:G,um:ui,m:Zt,r:ni,mt:yt,mc:re,pc:Qe,pbc:se,n:Ui,o:n};let be,Be;return e&&([be,Be]=e(H)),{render:Yi,hydrate:be,createApp:_G(Yi,be)}}function ET({type:n,props:e},o){return o==="svg"&&n==="foreignObject"||o==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:o}function Ff({effect:n,job:e},o){o?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function Nk(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function oA(n,e,o=!1){const u=n.children,d=e.children;if(Xi(u)&&Xi(d))for(let y=0;y<u.length;y++){const v=u[y];let r=d[y];r.shapeFlag&1&&!r.dynamicChildren&&((r.patchFlag<=0||r.patchFlag===32)&&(r=d[y]=rd(d[y]),r.el=v.el),!o&&r.patchFlag!==-2&&oA(v,r)),r.type===_d&&(r.el=v.el)}}function EG(n){const e=n.slice(),o=[0];let u,d,y,v,r;const D=n.length;for(u=0;u<D;u++){const B=n[u];if(B!==0){if(d=o[o.length-1],n[d]<B){e[u]=d,o.push(u);continue}for(y=0,v=o.length-1;y<v;)r=y+v>>1,n[o[r]]<B?y=r+1:v=r;B<n[o[y]]&&(y>0&&(e[u]=o[y-1]),o[y]=u)}}for(y=o.length,v=o[y-1];y-- >0;)o[y]=v,v=e[v];return o}function Vk(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Vk(e)}function Gx(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const Uk=Symbol.for("v-scx"),jk=()=>Yy(Uk);function SG(n,e){return G0(n,null,e)}function AG(n,e){return G0(n,null,{flush:"post"})}function $k(n,e){return G0(n,null,{flush:"sync"})}function Ua(n,e,o){return G0(n,e,o)}function G0(n,e,o=yn){const{immediate:u,deep:d,flush:y,once:v}=o,r=vn({},o),D=e&&u||!e&&y!=="post";let B;if(b_){if(y==="sync"){const q=jk();B=q.__watcherHandles||(q.__watcherHandles=[])}else if(!D){const q=()=>{};return q.stop=Io,q.resume=Io,q.pause=Io,q}}const F=bo;r.call=(q,X,G)=>rc(q,F,X,G);let N=!1;y==="post"?r.scheduler=q=>{yo(q,F&&F.suspense)}:y!=="sync"&&(N=!0,r.scheduler=(q,X)=>{X?q():ZS(q)}),r.augmentJob=q=>{e&&(q.flags|=4),N&&(q.flags|=2,F&&(q.id=F.uid,q.i=F))};const Q=fH(n,e,r);return b_&&(B?B.push(Q):D&&Q()),Q}function CG(n,e,o){const u=this.proxy,d=Gr(n)?n.includes(".")?qk(u,n):()=>u[n]:n.bind(u,u);let y;Lr(e)?y=e:(y=e.handler,o=e);const v=pp(this),r=G0(d,y.bind(u),o);return v(),r}function qk(n,e){const o=e.split(".");return()=>{let u=n;for(let d=0;d<o.length&&u;d++)u=u[o[d]];return u}}function MG(n,e,o=yn){const u=sc(),d=ws(e),y=Va(e),v=Hk(n,d),r=KL((D,B)=>{let F,N=yn,Q;return $k(()=>{const q=n[d];wa(F,q)&&(F=q,B())}),{get(){return D(),o.get?o.get(F):F},set(q){const X=o.set?o.set(q):q;if(!wa(X,F)&&!(N!==yn&&wa(q,N)))return;const G=u.vnode.props;G&&(e in G||d in G||y in G)&&(`onUpdate:${e}`in G||`onUpdate:${d}`in G||`onUpdate:${y}`in G)||(F=q,B()),u.emit(`update:${e}`,X),wa(q,X)&&wa(q,N)&&!wa(X,Q)&&B(),N=q,Q=X}}});return r[Symbol.iterator]=()=>{let D=0;return{next(){return D<2?{value:D++?v||yn:r,done:!1}:{done:!0}}}},r}const Hk=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${ws(e)}Modifiers`]||n[`${Va(e)}Modifiers`];function IG(n,e,...o){if(n.isUnmounted)return;const u=n.vnode.props||yn;let d=o;const y=e.startsWith("update:"),v=y&&Hk(u,e.slice(7));v&&(v.trim&&(d=o.map(F=>Gr(F)?F.trim():F)),v.number&&(d=o.map(Nx)));let r,D=u[r=Jm(e)]||u[r=Jm(ws(e))];!D&&y&&(D=u[r=Jm(Va(e))]),D&&rc(D,n,6,d);const B=u[r+"Once"];if(B){if(!n.emitted)n.emitted={};else if(n.emitted[r])return;n.emitted[r]=!0,rc(B,n,6,d)}}function Gk(n,e,o=!1){const u=e.emitsCache,d=u.get(n);if(d!==void 0)return d;const y=n.emits;let v={},r=!1;if(!Lr(n)){const D=B=>{const F=Gk(B,e,!0);F&&(r=!0,vn(v,F))};!o&&e.mixins.length&&e.mixins.forEach(D),n.extends&&D(n.extends),n.mixins&&n.mixins.forEach(D)}return!y&&!r?(Qn(n)&&u.set(n,null),null):(Xi(y)?y.forEach(D=>v[D]=null):vn(v,y),Qn(n)&&u.set(n,v),v)}function Yb(n,e){return!n||!Tp(e)?!1:(e=e.slice(2).replace(/Once$/,""),Un(n,e[0].toLowerCase()+e.slice(1))||Un(n,Va(e))||Un(n,e))}function ux(n){const{type:e,vnode:o,proxy:u,withProxy:d,propsOptions:[y],slots:v,attrs:r,emit:D,render:B,renderCache:F,props:N,data:Q,setupState:q,ctx:X,inheritAttrs:G}=n,ae=T0(n);let xe,Te;try{if(o.shapeFlag&4){const ne=d||u,ue=ne;xe=Ba(B.call(ue,ne,F,N,q,Q,X)),Te=r}else{const ne=e;xe=Ba(ne.length>1?ne(N,{attrs:r,slots:v,emit:D}):ne(N,null)),Te=e.props?r:RG(r)}}catch(ne){Xy.length=0,Ap(ne,n,1),xe=hs(ao)}let fe=xe;if(Te&&G!==!1){const ne=Object.keys(Te),{shapeFlag:ue}=fe;ne.length&&ue&7&&(y&&ne.some(BS)&&(Te=DG(Te,y)),fe=fu(fe,Te,!1,!0))}return o.dirs&&(fe=fu(fe,null,!1,!0),fe.dirs=fe.dirs?fe.dirs.concat(o.dirs):o.dirs),o.transition&&nh(fe,o.transition),xe=fe,T0(ae),xe}function PG(n,e=!0){let o;for(let u=0;u<n.length;u++){const d=n[u];if(sh(d)){if(d.type!==ao||d.children==="v-if"){if(o)return;o=d}}else return}return o}const RG=n=>{let e;for(const o in n)(o==="class"||o==="style"||Tp(o))&&((e||(e={}))[o]=n[o]);return e},DG=(n,e)=>{const o={};for(const u in n)(!BS(u)||!(u.slice(9)in e))&&(o[u]=n[u]);return o};function OG(n,e,o){const{props:u,children:d,component:y}=n,{props:v,children:r,patchFlag:D}=e,B=y.emitsOptions;if(e.dirs||e.transition)return!0;if(o&&D>=0){if(D&1024)return!0;if(D&16)return u?N3(u,v,B):!!v;if(D&8){const F=e.dynamicProps;for(let N=0;N<F.length;N++){const Q=F[N];if(v[Q]!==u[Q]&&!Yb(B,Q))return!0}}}else return(d||r)&&(!r||!r.$stable)?!0:u===v?!1:u?v?N3(u,v,B):!0:!!v;return!1}function N3(n,e,o){const u=Object.keys(e);if(u.length!==Object.keys(n).length)return!0;for(let d=0;d<u.length;d++){const y=u[d];if(e[y]!==n[y]&&!Yb(o,y))return!0}return!1}function Xb({vnode:n,parent:e},o){for(;e;){const u=e.subTree;if(u.suspense&&u.suspense.activeBranch===n&&(u.el=n.el),u===n)(n=e.vnode).el=o,e=e.parent;else break}}const Wx=n=>n.__isSuspense;let TE=0;const LG={name:"Suspense",__isSuspense:!0,process(n,e,o,u,d,y,v,r,D,B){if(n==null)zG(e,o,u,d,y,v,r,D,B);else{if(y&&y.deps>0&&!n.suspense.isInFallback){e.suspense=n.suspense,e.suspense.vnode=e,e.el=n.el;return}FG(n,e,o,u,d,v,r,D,B)}},hydrate:BG,normalize:NG},kG=LG;function A0(n,e){const o=n.props&&n.props[e];Lr(o)&&o()}function zG(n,e,o,u,d,y,v,r,D){const{p:B,o:{createElement:F}}=D,N=F("div"),Q=n.suspense=Wk(n,d,u,e,N,o,y,v,r,D);B(null,Q.pendingBranch=n.ssContent,N,null,u,Q,y,v),Q.deps>0?(A0(n,"onPending"),A0(n,"onFallback"),B(null,n.ssFallback,e,o,u,null,y,v),t_(Q,n.ssFallback)):Q.resolve(!1,!0)}function FG(n,e,o,u,d,y,v,r,{p:D,um:B,o:{createElement:F}}){const N=e.suspense=n.suspense;N.vnode=e,e.el=n.el;const Q=e.ssContent,q=e.ssFallback,{activeBranch:X,pendingBranch:G,isInFallback:ae,isHydrating:xe}=N;if(G)N.pendingBranch=Q,Sc(Q,G)?(D(G,Q,N.hiddenContainer,null,d,N,y,v,r),N.deps<=0?N.resolve():ae&&(xe||(D(X,q,o,u,d,null,y,v,r),t_(N,q)))):(N.pendingId=TE++,xe?(N.isHydrating=!1,N.activeBranch=G):B(G,d,N),N.deps=0,N.effects.length=0,N.hiddenContainer=F("div"),ae?(D(null,Q,N.hiddenContainer,null,d,N,y,v,r),N.deps<=0?N.resolve():(D(X,q,o,u,d,null,y,v,r),t_(N,q))):X&&Sc(Q,X)?(D(X,Q,o,u,d,N,y,v,r),N.resolve(!0)):(D(null,Q,N.hiddenContainer,null,d,N,y,v,r),N.deps<=0&&N.resolve()));else if(X&&Sc(Q,X))D(X,Q,o,u,d,N,y,v,r),t_(N,Q);else if(A0(e,"onPending"),N.pendingBranch=Q,Q.shapeFlag&512?N.pendingId=Q.component.suspenseId:N.pendingId=TE++,D(null,Q,N.hiddenContainer,null,d,N,y,v,r),N.deps<=0)N.resolve();else{const{timeout:Te,pendingId:fe}=N;Te>0?setTimeout(()=>{N.pendingId===fe&&N.fallback(q)},Te):Te===0&&N.fallback(q)}}function Wk(n,e,o,u,d,y,v,r,D,B,F=!1){const{p:N,m:Q,um:q,n:X,o:{parentNode:G,remove:ae}}=B;let xe;const Te=VG(n);Te&&e&&e.pendingBranch&&(xe=e.pendingId,e.deps++);const fe=n.props?Vx(n.props.timeout):void 0,ne=y,ue={vnode:n,parent:e,parentComponent:o,namespace:v,container:u,hiddenContainer:d,deps:0,pendingId:TE++,timeout:typeof fe=="number"?fe:-1,activeBranch:null,pendingBranch:null,isInFallback:!F,isHydrating:F,isUnmounted:!1,effects:[],resolve(ye=!1,le=!1){const{vnode:re,activeBranch:oe,pendingBranch:se,pendingId:Ae,effects:De,parentComponent:Ge,container:yt}=ue;let ct=!1;ue.isHydrating?ue.isHydrating=!1:ye||(ct=oe&&se.transition&&se.transition.mode==="out-in",ct&&(oe.transition.afterLeave=()=>{Ae===ue.pendingId&&(Q(se,yt,y===ne?X(oe):y,0),b0(De))}),oe&&(G(oe.el)===yt&&(y=X(oe)),q(oe,Ge,ue,!0)),ct||Q(se,yt,y,0)),t_(ue,se),ue.pendingBranch=null,ue.isInFallback=!1;let mt=ue.parent,et=!1;for(;mt;){if(mt.pendingBranch){mt.effects.push(...De),et=!0;break}mt=mt.parent}!et&&!ct&&b0(De),ue.effects=[],Te&&e&&e.pendingBranch&&xe===e.pendingId&&(e.deps--,e.deps===0&&!le&&e.resolve()),A0(re,"onResolve")},fallback(ye){if(!ue.pendingBranch)return;const{vnode:le,activeBranch:re,parentComponent:oe,container:se,namespace:Ae}=ue;A0(le,"onFallback");const De=X(re),Ge=()=>{ue.isInFallback&&(N(null,ye,se,De,oe,null,Ae,r,D),t_(ue,ye))},yt=ye.transition&&ye.transition.mode==="out-in";yt&&(re.transition.afterLeave=Ge),ue.isInFallback=!0,q(re,oe,null,!0),yt||Ge()},move(ye,le,re){ue.activeBranch&&Q(ue.activeBranch,ye,le,re),ue.container=ye},next(){return ue.activeBranch&&X(ue.activeBranch)},registerDep(ye,le,re){const oe=!!ue.pendingBranch;oe&&ue.deps++;const se=ye.vnode.el;ye.asyncDep.catch(Ae=>{Ap(Ae,ye,0)}).then(Ae=>{if(ye.isUnmounted||ue.isUnmounted||ue.pendingId!==ye.suspenseId)return;ye.asyncResolved=!0;const{vnode:De}=ye;CE(ye,Ae,!1),se&&(De.el=se);const Ge=!se&&ye.subTree.el;le(ye,De,G(se||ye.subTree.el),se?null:X(ye.subTree),ue,v,re),Ge&&ae(Ge),Xb(ye,De.el),oe&&--ue.deps===0&&ue.resolve()})},unmount(ye,le){ue.isUnmounted=!0,ue.activeBranch&&q(ue.activeBranch,o,ye,le),ue.pendingBranch&&q(ue.pendingBranch,o,ye,le)}};return ue}function BG(n,e,o,u,d,y,v,r,D){const B=e.suspense=Wk(e,u,o,n.parentNode,document.createElement("div"),null,d,y,v,r,!0),F=D(n,B.pendingBranch=e.ssContent,o,B,y,v);return B.deps===0&&B.resolve(!1,!0),F}function NG(n){const{shapeFlag:e,children:o}=n,u=e&32;n.ssContent=V3(u?o.default:o),n.ssFallback=u?V3(o.fallback):hs(ao)}function V3(n){let e;if(Lr(n)){const o=fp&&n._c;o&&(n._d=!1,zt()),n=n(),o&&(n._d=!0,e=ea,Yk())}return Xi(n)&&(n=PG(n)),n=Ba(n),e&&!n.dynamicChildren&&(n.dynamicChildren=e.filter(o=>o!==n)),n}function Zk(n,e){e&&e.pendingBranch?Xi(n)?e.effects.push(...n):e.effects.push(n):b0(n)}function t_(n,e){n.activeBranch=e;const{vnode:o,parentComponent:u}=n;let d=e.el;for(;!d&&e.component;)e=e.component.subTree,d=e.el;o.el=d,u&&u.subTree===o&&(u.vnode.el=d,Xb(u,d))}function VG(n){const e=n.props&&n.props.suspensible;return e!=null&&e!==!1}const ur=Symbol.for("v-fgt"),_d=Symbol.for("v-txt"),ao=Symbol.for("v-cmt"),rp=Symbol.for("v-stc"),Xy=[];let ea=null;function zt(n=!1){Xy.push(ea=n?null:[])}function Yk(){Xy.pop(),ea=Xy[Xy.length-1]||null}let fp=1;function EE(n,e=!1){fp+=n,n<0&&ea&&e&&(ea.hasOnce=!0)}function Xk(n){return n.dynamicChildren=fp>0?ea||Xm:null,Yk(),fp>0&&ea&&ea.push(n),n}function Nt(n,e,o,u,d,y){return Xk(K(n,e,o,u,d,y,!0))}function C0(n,e,o,u,d){return Xk(hs(n,e,o,u,d,!0))}function sh(n){return n?n.__v_isVNode===!0:!1}function Sc(n,e){return n.type===e.type&&n.key===e.key}function UG(n){}const Kk=({key:n})=>n??null,hx=({ref:n,ref_key:e,ref_for:o})=>(typeof n=="number"&&(n=""+n),n!=null?Gr(n)||To(n)||Lr(n)?{i:wo,r:n,k:e,f:!!o}:n:null);function K(n,e=null,o=null,u=0,d=null,y=n===ur?0:1,v=!1,r=!1){const D={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&Kk(e),ref:e&&hx(e),scopeId:qb,slotScopeIds:null,children:o,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:y,patchFlag:u,dynamicProps:d,dynamicChildren:null,appContext:null,ctx:wo};return r?(aA(D,o),y&128&&n.normalize(D)):o&&(D.shapeFlag|=Gr(o)?8:16),fp>0&&!v&&ea&&(D.patchFlag>0||y&6)&&D.patchFlag!==32&&ea.push(D),D}const hs=jG;function jG(n,e=null,o=null,u=0,d=null,y=!1){if((!n||n===bk)&&(n=ao),sh(n)){const r=fu(n,e,!0);return o&&aA(r,o),fp>0&&!y&&ea&&(r.shapeFlag&6?ea[ea.indexOf(n)]=r:ea.push(r)),r.patchFlag=-2,r}if(ZG(n)&&(n=n.__vccOpts),e){e=Jk(e);let{class:r,style:D}=e;r&&!Gr(r)&&(e.class=rh(r)),Qn(D)&&(Ub(D)&&!Xi(D)&&(D=vn({},D)),e.style=Ps(D))}const v=Gr(n)?1:Wx(n)?128:ok(n)?64:Qn(n)?4:Lr(n)?2:0;return K(n,e,o,u,d,v,y,!0)}function Jk(n){return n?Ub(n)||Ik(n)?vn({},n):n:null}function fu(n,e,o=!1,u=!1){const{props:d,ref:y,patchFlag:v,children:r,transition:D}=n,B=e?Qk(d||{},e):d,F={__v_isVNode:!0,__v_skip:!0,type:n.type,props:B,key:B&&Kk(B),ref:e&&e.ref?o&&y?Xi(y)?y.concat(hx(e)):[y,hx(e)]:hx(e):y,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:r,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==ur?v===-1?16:v|16:v,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:D,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&fu(n.ssContent),ssFallback:n.ssFallback&&fu(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return D&&u&&nh(F,D.clone(F)),F}function Eo(n=" ",e=0){return hs(_d,null,n,e)}function x_(n,e){const o=hs(rp,null,n);return o.staticCount=e,o}function Jn(n="",e=!1){return e?(zt(),C0(ao,null,n)):hs(ao,null,n)}function Ba(n){return n==null||typeof n=="boolean"?hs(ao):Xi(n)?hs(ur,null,n.slice()):sh(n)?rd(n):hs(_d,null,String(n))}function rd(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:fu(n)}function aA(n,e){let o=0;const{shapeFlag:u}=n;if(e==null)e=null;else if(Xi(e))o=16;else if(typeof e=="object")if(u&65){const d=e.default;d&&(d._c&&(d._d=!1),aA(n,d()),d._c&&(d._d=!0));return}else{o=32;const d=e._;!d&&!Ik(e)?e._ctx=wo:d===3&&wo&&(wo.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else Lr(e)?(e={default:e,_ctx:wo},o=32):(e=String(e),u&64?(o=16,e=[Eo(e)]):o=8);n.children=e,n.shapeFlag|=o}function Qk(...n){const e={};for(let o=0;o<n.length;o++){const u=n[o];for(const d in u)if(d==="class")e.class!==u.class&&(e.class=rh([e.class,u.class]));else if(d==="style")e.style=Ps([e.style,u.style]);else if(Tp(d)){const y=e[d],v=u[d];v&&y!==v&&!(Xi(y)&&y.includes(v))&&(e[d]=y?[].concat(y,v):v)}else d!==""&&(e[d]=u[d])}return e}function za(n,e,o,u=null){rc(n,e,7,[o,u])}const $G=Sk();let qG=0;function e5(n,e,o){const u=n.type,d=(e?e.appContext:n.appContext)||$G,y={uid:qG++,vnode:n,type:u,parent:e,appContext:d,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new jS(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(d.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Rk(u,d),emitsOptions:Gk(u,d),emit:null,emitted:null,propsDefaults:yn,inheritAttrs:u.inheritAttrs,ctx:yn,data:yn,props:yn,attrs:yn,slots:yn,refs:yn,setupState:yn,setupContext:null,suspense:o,suspenseId:o?o.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return y.ctx={_:y},y.root=e?e.root:y,y.emit=IG.bind(null,y),n.ce&&n.ce(y),y}let bo=null;const sc=()=>bo||wo;let Zx,SE;{const n=Lb(),e=(o,u)=>{let d;return(d=n[o])||(d=n[o]=[]),d.push(u),y=>{d.length>1?d.forEach(v=>v(y)):d[0](y)}};Zx=e("__VUE_INSTANCE_SETTERS__",o=>bo=o),SE=e("__VUE_SSR_SETTERS__",o=>b_=o)}const pp=n=>{const e=bo;return Zx(n),n.scope.on(),()=>{n.scope.off(),Zx(e)}},AE=()=>{bo&&bo.scope.off(),Zx(null)};function t5(n){return n.vnode.shapeFlag&4}let b_=!1;function i5(n,e=!1,o=!1){e&&SE(e);const{props:u,children:d}=n.vnode,y=t5(n);yG(n,u,y,e),wG(n,d,o);const v=y?HG(n,e):void 0;return e&&SE(!1),v}function HG(n,e){const o=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,vE);const{setup:u}=o;if(u){Ld();const d=n.setupContext=u.length>1?s5(n):null,y=pp(n),v=F_(u,n,0,[n.props,d]),r=VS(v);if(kd(),y(),(r||n.sp)&&!md(n)&&JS(n),r){if(v.then(AE,AE),e)return v.then(D=>{CE(n,D,e)}).catch(D=>{Ap(D,n,0)});n.asyncDep=v}else CE(n,v,e)}else n5(n,e)}function CE(n,e,o){Lr(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:Qn(e)&&(n.setupState=WS(e)),n5(n,o)}let Yx,ME;function r5(n){Yx=n,ME=e=>{e.render._rc&&(e.withProxy=new Proxy(e.ctx,XH))}}const GG=()=>!Yx;function n5(n,e,o){const u=n.type;if(!n.render){if(!e&&Yx&&!u.render){const d=u.template||nA(n).template;if(d){const{isCustomElement:y,compilerOptions:v}=n.appContext.config,{delimiters:r,compilerOptions:D}=u,B=vn(vn({isCustomElement:y,delimiters:r},v),D);u.render=Yx(d,B)}}n.render=u.render||Io,ME&&ME(n)}{const d=pp(n);Ld();try{uG(n)}finally{kd(),d()}}}const WG={get(n,e){return Yo(n,"get",""),n[e]}};function s5(n){const e=o=>{n.exposed=o||{}};return{attrs:new Proxy(n.attrs,WG),slots:n.slots,emit:n.emit,expose:e}}function W0(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(WS(ZL(n.exposed)),{get(e,o){if(o in e)return e[o];if(o in Zy)return Zy[o](n)},has(e,o){return o in e||o in Zy}})):n.proxy}function IE(n,e=!0){return Lr(n)?n.displayName||n.name:n.name||e&&n.__name}function ZG(n){return Lr(n)&&"__vccOpts"in n}const Ky=(n,e)=>cH(n,e,b_);function o5(n,e,o){const u=arguments.length;return u===2?Qn(e)&&!Xi(e)?sh(e)?hs(n,null,[e]):hs(n,e):hs(n,null,e):(u>3?o=Array.prototype.slice.call(arguments,2):u===3&&sh(o)&&(o=[o]),hs(n,e,o))}function YG(){}function XG(n,e,o,u){const d=o[u];if(d&&a5(d,n))return d;const y=e();return y.memo=n.slice(),y.cacheIndex=u,o[u]=y}function a5(n,e){const o=n.memo;if(o.length!=e.length)return!1;for(let u=0;u<o.length;u++)if(wa(o[u],e[u]))return!1;return fp>0&&ea&&ea.push(n),!0}const l5="3.5.13",KG=Io,JG=yH,QG=Nm,e9=nk,t9={createComponentInstance:e5,setupComponent:i5,renderComponentRoot:ux,setCurrentRenderingInstance:T0,isVNode:sh,normalizeVNode:Ba,getComponentPublicInstance:W0,ensureValidVNode:rA,pushWarningContext:pH,popWarningContext:mH},i9=t9,r9=null,n9=null,s9=null;/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let PE;const U3=typeof window<"u"&&window.trustedTypes;if(U3)try{PE=U3.createPolicy("vue",{createHTML:n=>n})}catch{}const c5=PE?n=>PE.createHTML(n):n=>n,o9="http://www.w3.org/2000/svg",a9="http://www.w3.org/1998/Math/MathML",$u=typeof document<"u"?document:null,j3=$u&&$u.createElement("template"),l9={insert:(n,e,o)=>{e.insertBefore(n,o||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,o,u)=>{const d=e==="svg"?$u.createElementNS(o9,n):e==="mathml"?$u.createElementNS(a9,n):o?$u.createElement(n,{is:o}):$u.createElement(n);return n==="select"&&u&&u.multiple!=null&&d.setAttribute("multiple",u.multiple),d},createText:n=>$u.createTextNode(n),createComment:n=>$u.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>$u.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,o,u,d,y){const v=o?o.previousSibling:e.lastChild;if(d&&(d===y||d.nextSibling))for(;e.insertBefore(d.cloneNode(!0),o),!(d===y||!(d=d.nextSibling)););else{j3.innerHTML=c5(u==="svg"?`<svg>${n}</svg>`:u==="mathml"?`<math>${n}</math>`:n);const r=j3.content;if(u==="svg"||u==="mathml"){const D=r.firstChild;for(;D.firstChild;)r.appendChild(D.firstChild);r.removeChild(D)}e.insertBefore(r,o)}return[v?v.nextSibling:e.firstChild,o?o.previousSibling:e.lastChild]}},Yh="transition",Sy="animation",w_=Symbol("_vtc"),u5={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},h5=vn({},KS,u5),c9=n=>(n.displayName="Transition",n.props=h5,n),u9=c9((n,{slots:e})=>o5(hk,d5(n),e)),Bf=(n,e=[])=>{Xi(n)?n.forEach(o=>o(...e)):n&&n(...e)},$3=n=>n?Xi(n)?n.some(e=>e.length>1):n.length>1:!1;function d5(n){const e={};for(const De in n)De in u5||(e[De]=n[De]);if(n.css===!1)return e;const{name:o="v",type:u,duration:d,enterFromClass:y=`${o}-enter-from`,enterActiveClass:v=`${o}-enter-active`,enterToClass:r=`${o}-enter-to`,appearFromClass:D=y,appearActiveClass:B=v,appearToClass:F=r,leaveFromClass:N=`${o}-leave-from`,leaveActiveClass:Q=`${o}-leave-active`,leaveToClass:q=`${o}-leave-to`}=n,X=h9(d),G=X&&X[0],ae=X&&X[1],{onBeforeEnter:xe,onEnter:Te,onEnterCancelled:fe,onLeave:ne,onLeaveCancelled:ue,onBeforeAppear:ye=xe,onAppear:le=Te,onAppearCancelled:re=fe}=e,oe=(De,Ge,yt,ct)=>{De._enterCancelled=ct,Kh(De,Ge?F:r),Kh(De,Ge?B:v),yt&&yt()},se=(De,Ge)=>{De._isLeaving=!1,Kh(De,N),Kh(De,q),Kh(De,Q),Ge&&Ge()},Ae=De=>(Ge,yt)=>{const ct=De?le:Te,mt=()=>oe(Ge,De,yt);Bf(ct,[Ge,mt]),q3(()=>{Kh(Ge,De?D:y),Qc(Ge,De?F:r),$3(ct)||H3(Ge,u,G,mt)})};return vn(e,{onBeforeEnter(De){Bf(xe,[De]),Qc(De,y),Qc(De,v)},onBeforeAppear(De){Bf(ye,[De]),Qc(De,D),Qc(De,B)},onEnter:Ae(!1),onAppear:Ae(!0),onLeave(De,Ge){De._isLeaving=!0;const yt=()=>se(De,Ge);Qc(De,N),De._enterCancelled?(Qc(De,Q),RE()):(RE(),Qc(De,Q)),q3(()=>{De._isLeaving&&(Kh(De,N),Qc(De,q),$3(ne)||H3(De,u,ae,yt))}),Bf(ne,[De,yt])},onEnterCancelled(De){oe(De,!1,void 0,!0),Bf(fe,[De])},onAppearCancelled(De){oe(De,!0,void 0,!0),Bf(re,[De])},onLeaveCancelled(De){se(De),Bf(ue,[De])}})}function h9(n){if(n==null)return null;if(Qn(n))return[ST(n.enter),ST(n.leave)];{const e=ST(n);return[e,e]}}function ST(n){return Vx(n)}function Qc(n,e){e.split(/\s+/).forEach(o=>o&&n.classList.add(o)),(n[w_]||(n[w_]=new Set)).add(e)}function Kh(n,e){e.split(/\s+/).forEach(u=>u&&n.classList.remove(u));const o=n[w_];o&&(o.delete(e),o.size||(n[w_]=void 0))}function q3(n){requestAnimationFrame(()=>{requestAnimationFrame(n)})}let d9=0;function H3(n,e,o,u){const d=n._endId=++d9,y=()=>{d===n._endId&&u()};if(o!=null)return setTimeout(y,o);const{type:v,timeout:r,propCount:D}=f5(n,e);if(!v)return u();const B=v+"end";let F=0;const N=()=>{n.removeEventListener(B,Q),y()},Q=q=>{q.target===n&&++F>=D&&N()};setTimeout(()=>{F<D&&N()},r+1),n.addEventListener(B,Q)}function f5(n,e){const o=window.getComputedStyle(n),u=X=>(o[X]||"").split(", "),d=u(`${Yh}Delay`),y=u(`${Yh}Duration`),v=G3(d,y),r=u(`${Sy}Delay`),D=u(`${Sy}Duration`),B=G3(r,D);let F=null,N=0,Q=0;e===Yh?v>0&&(F=Yh,N=v,Q=y.length):e===Sy?B>0&&(F=Sy,N=B,Q=D.length):(N=Math.max(v,B),F=N>0?v>B?Yh:Sy:null,Q=F?F===Yh?y.length:D.length:0);const q=F===Yh&&/\b(transform|all)(,|$)/.test(u(`${Yh}Property`).toString());return{type:F,timeout:N,propCount:Q,hasTransform:q}}function G3(n,e){for(;n.length<e.length;)n=n.concat(n);return Math.max(...e.map((o,u)=>W3(o)+W3(n[u])))}function W3(n){return n==="auto"?0:Number(n.slice(0,-1).replace(",","."))*1e3}function RE(){return document.body.offsetHeight}function f9(n,e,o){const u=n[w_];u&&(e=(e?[e,...u]:[...u]).join(" ")),e==null?n.removeAttribute("class"):o?n.setAttribute("class",e):n.className=e}const Xx=Symbol("_vod"),p5=Symbol("_vsh"),lA={beforeMount(n,{value:e},{transition:o}){n[Xx]=n.style.display==="none"?"":n.style.display,o&&e?o.beforeEnter(n):Ay(n,e)},mounted(n,{value:e},{transition:o}){o&&e&&o.enter(n)},updated(n,{value:e,oldValue:o},{transition:u}){!e!=!o&&(u?e?(u.beforeEnter(n),Ay(n,!0),u.enter(n)):u.leave(n,()=>{Ay(n,!1)}):Ay(n,e))},beforeUnmount(n,{value:e}){Ay(n,e)}};function Ay(n,e){n.style.display=e?n[Xx]:"none",n[p5]=!e}function p9(){lA.getSSRProps=({value:n})=>{if(!n)return{style:{display:"none"}}}}const m5=Symbol("");function m9(n){const e=sc();if(!e)return;const o=e.ut=(d=n(e.proxy))=>{Array.from(document.querySelectorAll(`[data-v-owner="${e.uid}"]`)).forEach(y=>Kx(y,d))},u=()=>{const d=n(e.proxy);e.ce?Kx(e.ce,d):DE(e.subTree,d),o(d)};QS(()=>{b0(u)}),Sl(()=>{Ua(u,Io,{flush:"post"});const d=new MutationObserver(u);d.observe(e.subTree.el.parentNode,{childList:!0}),H0(()=>d.disconnect())})}function DE(n,e){if(n.shapeFlag&128){const o=n.suspense;n=o.activeBranch,o.pendingBranch&&!o.isHydrating&&o.effects.push(()=>{DE(o.activeBranch,e)})}for(;n.component;)n=n.component.subTree;if(n.shapeFlag&1&&n.el)Kx(n.el,e);else if(n.type===ur)n.children.forEach(o=>DE(o,e));else if(n.type===rp){let{el:o,anchor:u}=n;for(;o&&(Kx(o,e),o!==u);)o=o.nextSibling}}function Kx(n,e){if(n.nodeType===1){const o=n.style;let u="";for(const d in e)o.setProperty(`--${d}`,e[d]),u+=`--${d}: ${e[d]};`;o[m5]=u}}const _9=/(^|;)\s*display\s*:/;function g9(n,e,o){const u=n.style,d=Gr(o);let y=!1;if(o&&!d){if(e)if(Gr(e))for(const v of e.split(";")){const r=v.slice(0,v.indexOf(":")).trim();o[r]==null&&dx(u,r,"")}else for(const v in e)o[v]==null&&dx(u,v,"");for(const v in o)v==="display"&&(y=!0),dx(u,v,o[v])}else if(d){if(e!==o){const v=u[m5];v&&(o+=";"+v),u.cssText=o,y=_9.test(o)}}else e&&n.removeAttribute("style");Xx in n&&(n[Xx]=y?u.display:"",n[p5]&&(u.display="none"))}const Z3=/\s*!important$/;function dx(n,e,o){if(Xi(o))o.forEach(u=>dx(n,e,u));else if(o==null&&(o=""),e.startsWith("--"))n.setProperty(e,o);else{const u=y9(n,e);Z3.test(o)?n.setProperty(Va(u),o.replace(Z3,""),"important"):n[u]=o}}const Y3=["Webkit","Moz","ms"],AT={};function y9(n,e){const o=AT[e];if(o)return o;let u=ws(e);if(u!=="filter"&&u in n)return AT[e]=u;u=Sp(u);for(let d=0;d<Y3.length;d++){const y=Y3[d]+u;if(y in n)return AT[e]=y}return e}const X3="http://www.w3.org/1999/xlink";function K3(n,e,o,u,d,y=Cq(e)){u&&e.startsWith("xlink:")?o==null?n.removeAttributeNS(X3,e.slice(6,e.length)):n.setAttributeNS(X3,e,o):o==null||y&&!ML(o)?n.removeAttribute(e):n.setAttribute(e,y?"":Za(o)?String(o):o)}function J3(n,e,o,u,d){if(e==="innerHTML"||e==="textContent"){o!=null&&(n[e]=e==="innerHTML"?c5(o):o);return}const y=n.tagName;if(e==="value"&&y!=="PROGRESS"&&!y.includes("-")){const r=y==="OPTION"?n.getAttribute("value")||"":n.value,D=o==null?n.type==="checkbox"?"on":"":String(o);(r!==D||!("_value"in n))&&(n.value=D),o==null&&n.removeAttribute(e),n._value=o;return}let v=!1;if(o===""||o==null){const r=typeof n[e];r==="boolean"?o=ML(o):o==null&&r==="string"?(o="",v=!0):r==="number"&&(o=0,v=!0)}try{n[e]=o}catch{}v&&n.removeAttribute(d||e)}function Wu(n,e,o,u){n.addEventListener(e,o,u)}function v9(n,e,o,u){n.removeEventListener(e,o,u)}const Q3=Symbol("_vei");function x9(n,e,o,u,d=null){const y=n[Q3]||(n[Q3]={}),v=y[e];if(u&&v)v.value=u;else{const[r,D]=b9(e);if(u){const B=y[e]=E9(u,d);Wu(n,r,B,D)}else v&&(v9(n,r,v,D),y[e]=void 0)}}const eR=/(?:Once|Passive|Capture)$/;function b9(n){let e;if(eR.test(n)){e={};let u;for(;u=n.match(eR);)n=n.slice(0,n.length-u[0].length),e[u[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):Va(n.slice(2)),e]}let CT=0;const w9=Promise.resolve(),T9=()=>CT||(w9.then(()=>CT=0),CT=Date.now());function E9(n,e){const o=u=>{if(!u._vts)u._vts=Date.now();else if(u._vts<=o.attached)return;rc(S9(u,o.value),e,5,[u])};return o.value=n,o.attached=T9(),o}function S9(n,e){if(Xi(e)){const o=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{o.call(n),n._stopped=!0},e.map(u=>d=>!d._stopped&&u&&u(d))}else return e}const tR=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,A9=(n,e,o,u,d,y)=>{const v=d==="svg";e==="class"?f9(n,u,v):e==="style"?g9(n,o,u):Tp(e)?BS(e)||x9(n,e,o,u,y):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):C9(n,e,u,v))?(J3(n,e,u),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&K3(n,e,u,v,y,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!Gr(u))?J3(n,ws(e),u,y,e):(e==="true-value"?n._trueValue=u:e==="false-value"&&(n._falseValue=u),K3(n,e,u,v))};function C9(n,e,o,u){if(u)return!!(e==="innerHTML"||e==="textContent"||e in n&&tR(e)&&Lr(o));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const d=n.tagName;if(d==="IMG"||d==="VIDEO"||d==="CANVAS"||d==="SOURCE")return!1}return tR(e)&&Gr(o)?!1:e in n}const iR={};/*! #__NO_SIDE_EFFECTS__ */function _5(n,e,o){const u=Gb(n,e);Db(u)&&vn(u,e);class d extends Kb{constructor(v){super(u,v,o)}}return d.def=u,d}/*! #__NO_SIDE_EFFECTS__ */const M9=(n,e)=>_5(n,e,M5),I9=typeof HTMLElement<"u"?HTMLElement:class{};class Kb extends I9{constructor(e,o={},u=Qx){super(),this._def=e,this._props=o,this._createApp=u,this._isVueCE=!0,this._instance=null,this._app=null,this._nonce=this._def.nonce,this._connected=!1,this._resolved=!1,this._numberProps=null,this._styleChildren=new WeakSet,this._ob=null,this.shadowRoot&&u!==Qx?this._root=this.shadowRoot:e.shadowRoot!==!1?(this.attachShadow({mode:"open"}),this._root=this.shadowRoot):this._root=this,this._def.__asyncLoader||this._resolveProps(this._def)}connectedCallback(){if(!this.isConnected)return;this.shadowRoot||this._parseSlots(),this._connected=!0;let e=this;for(;e=e&&(e.parentNode||e.host);)if(e instanceof Kb){this._parent=e;break}this._instance||(this._resolved?(this._setParent(),this._update()):e&&e._pendingResolve?this._pendingResolve=e._pendingResolve.then(()=>{this._pendingResolve=void 0,this._resolveDef()}):this._resolveDef())}_setParent(e=this._parent){e&&(this._instance.parent=e._instance,this._instance.provides=e._instance.provides)}disconnectedCallback(){this._connected=!1,$b(()=>{this._connected||(this._ob&&(this._ob.disconnect(),this._ob=null),this._app&&this._app.unmount(),this._instance&&(this._instance.ce=void 0),this._app=this._instance=null)})}_resolveDef(){if(this._pendingResolve)return;for(let u=0;u<this.attributes.length;u++)this._setAttr(this.attributes[u].name);this._ob=new MutationObserver(u=>{for(const d of u)this._setAttr(d.attributeName)}),this._ob.observe(this,{attributes:!0});const e=(u,d=!1)=>{this._resolved=!0,this._pendingResolve=void 0;const{props:y,styles:v}=u;let r;if(y&&!Xi(y))for(const D in y){const B=y[D];(B===Number||B&&B.type===Number)&&(D in this._props&&(this._props[D]=Vx(this._props[D])),(r||(r=Object.create(null)))[ws(D)]=!0)}this._numberProps=r,d&&this._resolveProps(u),this.shadowRoot&&this._applyStyles(v),this._mount(u)},o=this._def.__asyncLoader;o?this._pendingResolve=o().then(u=>e(this._def=u,!0)):e(this._def)}_mount(e){this._app=this._createApp(e),e.configureApp&&e.configureApp(this._app),this._app._ceVNode=this._createVNode(),this._app.mount(this._root);const o=this._instance&&this._instance.exposed;if(o)for(const u in o)Un(this,u)||Object.defineProperty(this,u,{get:()=>jb(o[u])})}_resolveProps(e){const{props:o}=e,u=Xi(o)?o:Object.keys(o||{});for(const d of Object.keys(this))d[0]!=="_"&&u.includes(d)&&this._setProp(d,this[d]);for(const d of u.map(ws))Object.defineProperty(this,d,{get(){return this._getProp(d)},set(y){this._setProp(d,y,!0,!0)}})}_setAttr(e){if(e.startsWith("data-v-"))return;const o=this.hasAttribute(e);let u=o?this.getAttribute(e):iR;const d=ws(e);o&&this._numberProps&&this._numberProps[d]&&(u=Vx(u)),this._setProp(d,u,!1,!0)}_getProp(e){return this._props[e]}_setProp(e,o,u=!0,d=!1){if(o!==this._props[e]&&(o===iR?delete this._props[e]:(this._props[e]=o,e==="key"&&this._app&&(this._app._ceVNode.key=o)),d&&this._instance&&this._update(),u)){const y=this._ob;y&&y.disconnect(),o===!0?this.setAttribute(Va(e),""):typeof o=="string"||typeof o=="number"?this.setAttribute(Va(e),o+""):o||this.removeAttribute(Va(e)),y&&y.observe(this,{attributes:!0})}}_update(){C5(this._createVNode(),this._root)}_createVNode(){const e={};this.shadowRoot||(e.onVnodeMounted=e.onVnodeUpdated=this._renderSlots.bind(this));const o=hs(this._def,vn(e,this._props));return this._instance||(o.ce=u=>{this._instance=u,u.ce=this,u.isCE=!0;const d=(y,v)=>{this.dispatchEvent(new CustomEvent(y,Db(v[0])?vn({detail:v},v[0]):{detail:v}))};u.emit=(y,...v)=>{d(y,v),Va(y)!==y&&d(Va(y),v)},this._setParent()}),o}_applyStyles(e,o){if(!e)return;if(o){if(o===this._def||this._styleChildren.has(o))return;this._styleChildren.add(o)}const u=this._nonce;for(let d=e.length-1;d>=0;d--){const y=document.createElement("style");u&&y.setAttribute("nonce",u),y.textContent=e[d],this.shadowRoot.prepend(y)}}_parseSlots(){const e=this._slots={};let o;for(;o=this.firstChild;){const u=o.nodeType===1&&o.getAttribute("slot")||"default";(e[u]||(e[u]=[])).push(o),this.removeChild(o)}}_renderSlots(){const e=(this._teleportTarget||this).querySelectorAll("slot"),o=this._instance.type.__scopeId;for(let u=0;u<e.length;u++){const d=e[u],y=d.getAttribute("name")||"default",v=this._slots[y],r=d.parentNode;if(v)for(const D of v){if(o&&D.nodeType===1){const B=o+"-s",F=document.createTreeWalker(D,1);D.setAttribute(B,"");let N;for(;N=F.nextNode();)N.setAttribute(B,"")}r.insertBefore(D,d)}else for(;d.firstChild;)r.insertBefore(d.firstChild,d);r.removeChild(d)}}_injectChildStyle(e){this._applyStyles(e.styles,e)}_removeChildStyle(e){}}function g5(n){const e=sc(),o=e&&e.ce;return o||null}function P9(){const n=g5();return n&&n.shadowRoot}function R9(n="$style"){{const e=sc();if(!e)return yn;const o=e.type.__cssModules;if(!o)return yn;const u=o[n];return u||yn}}const y5=new WeakMap,v5=new WeakMap,Jx=Symbol("_moveCb"),rR=Symbol("_enterCb"),D9=n=>(delete n.props.mode,n),O9=D9({name:"TransitionGroup",props:vn({},h5,{tag:String,moveClass:String}),setup(n,{slots:e}){const o=sc(),u=XS();let d,y;return Zb(()=>{if(!d.length)return;const v=n.moveClass||`${n.name||"v"}-move`;if(!B9(d[0].el,o.vnode.el,v))return;d.forEach(k9),d.forEach(z9);const r=d.filter(F9);RE(),r.forEach(D=>{const B=D.el,F=B.style;Qc(B,v),F.transform=F.webkitTransform=F.transitionDuration="";const N=B[Jx]=Q=>{Q&&Q.target!==B||(!Q||/transform$/.test(Q.propertyName))&&(B.removeEventListener("transitionend",N),B[Jx]=null,Kh(B,v))};B.addEventListener("transitionend",N)})}),()=>{const v=Pn(n),r=d5(v);let D=v.tag||ur;if(d=[],y)for(let B=0;B<y.length;B++){const F=y[B];F.el&&F.el instanceof Element&&(d.push(F),nh(F,v_(F,r,u,o)),y5.set(F,F.el.getBoundingClientRect()))}y=e.default?Hb(e.default()):[];for(let B=0;B<y.length;B++){const F=y[B];F.key!=null&&nh(F,v_(F,r,u,o))}return hs(D,null,y)}}}),L9=O9;function k9(n){const e=n.el;e[Jx]&&e[Jx](),e[rR]&&e[rR]()}function z9(n){v5.set(n,n.el.getBoundingClientRect())}function F9(n){const e=y5.get(n),o=v5.get(n),u=e.left-o.left,d=e.top-o.top;if(u||d){const y=n.el.style;return y.transform=y.webkitTransform=`translate(${u}px,${d}px)`,y.transitionDuration="0s",n}}function B9(n,e,o){const u=n.cloneNode(),d=n[w_];d&&d.forEach(r=>{r.split(/\s+/).forEach(D=>D&&u.classList.remove(D))}),o.split(/\s+/).forEach(r=>r&&u.classList.add(r)),u.style.display="none";const y=e.nodeType===1?e:e.parentNode;y.appendChild(u);const{hasTransform:v}=f5(u);return y.removeChild(u),v}const Ad=n=>{const e=n.props["onUpdate:modelValue"]||!1;return Xi(e)?o=>Qm(e,o):e};function N9(n){n.target.composing=!0}function nR(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Ql=Symbol("_assign"),hn={created(n,{modifiers:{lazy:e,trim:o,number:u}},d){n[Ql]=Ad(d);const y=u||d.props&&d.props.type==="number";Wu(n,e?"change":"input",v=>{if(v.target.composing)return;let r=n.value;o&&(r=r.trim()),y&&(r=Nx(r)),n[Ql](r)}),o&&Wu(n,"change",()=>{n.value=n.value.trim()}),e||(Wu(n,"compositionstart",N9),Wu(n,"compositionend",nR),Wu(n,"change",nR))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:o,modifiers:{lazy:u,trim:d,number:y}},v){if(n[Ql]=Ad(v),n.composing)return;const r=(y||n.type==="number")&&!/^0\d/.test(n.value)?Nx(n.value):n.value,D=e??"";r!==D&&(document.activeElement===n&&n.type!=="range"&&(u&&e===o||d&&n.value.trim()===D)||(n.value=D))}},cA={deep:!0,created(n,e,o){n[Ql]=Ad(o),Wu(n,"change",()=>{const u=n._modelValue,d=T_(n),y=n.checked,v=n[Ql];if(Xi(u)){const r=kb(u,d),D=r!==-1;if(y&&!D)v(u.concat(d));else if(!y&&D){const B=[...u];B.splice(r,1),v(B)}}else if(Ep(u)){const r=new Set(u);y?r.add(d):r.delete(d),v(r)}else v(x5(n,y))})},mounted:sR,beforeUpdate(n,e,o){n[Ql]=Ad(o),sR(n,e,o)}};function sR(n,{value:e,oldValue:o},u){n._modelValue=e;let d;if(Xi(e))d=kb(e,u.props.value)>-1;else if(Ep(e))d=e.has(u.props.value);else{if(e===o)return;d=Ed(e,x5(n,!0))}n.checked!==d&&(n.checked=d)}const uA={created(n,{value:e},o){n.checked=Ed(e,o.props.value),n[Ql]=Ad(o),Wu(n,"change",()=>{n[Ql](T_(n))})},beforeUpdate(n,{value:e,oldValue:o},u){n[Ql]=Ad(u),e!==o&&(n.checked=Ed(e,u.props.value))}},mp={deep:!0,created(n,{value:e,modifiers:{number:o}},u){const d=Ep(e);Wu(n,"change",()=>{const y=Array.prototype.filter.call(n.options,v=>v.selected).map(v=>o?Nx(T_(v)):T_(v));n[Ql](n.multiple?d?new Set(y):y:y[0]),n._assigning=!0,$b(()=>{n._assigning=!1})}),n[Ql]=Ad(u)},mounted(n,{value:e}){oR(n,e)},beforeUpdate(n,e,o){n[Ql]=Ad(o)},updated(n,{value:e}){n._assigning||oR(n,e)}};function oR(n,e){const o=n.multiple,u=Xi(e);if(!(o&&!u&&!Ep(e))){for(let d=0,y=n.options.length;d<y;d++){const v=n.options[d],r=T_(v);if(o)if(u){const D=typeof r;D==="string"||D==="number"?v.selected=e.some(B=>String(B)===String(r)):v.selected=kb(e,r)>-1}else v.selected=e.has(r);else if(Ed(T_(v),e)){n.selectedIndex!==d&&(n.selectedIndex=d);return}}!o&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}function T_(n){return"_value"in n?n._value:n.value}function x5(n,e){const o=e?"_trueValue":"_falseValue";return o in n?n[o]:e}const b5={created(n,e,o){zv(n,e,o,null,"created")},mounted(n,e,o){zv(n,e,o,null,"mounted")},beforeUpdate(n,e,o,u){zv(n,e,o,u,"beforeUpdate")},updated(n,e,o,u){zv(n,e,o,u,"updated")}};function w5(n,e){switch(n){case"SELECT":return mp;case"TEXTAREA":return hn;default:switch(e){case"checkbox":return cA;case"radio":return uA;default:return hn}}}function zv(n,e,o,u,d){const v=w5(n.tagName,o.props&&o.props.type)[d];v&&v(n,e,o,u)}function V9(){hn.getSSRProps=({value:n})=>({value:n}),uA.getSSRProps=({value:n},e)=>{if(e.props&&Ed(e.props.value,n))return{checked:!0}},cA.getSSRProps=({value:n},e)=>{if(Xi(n)){if(e.props&&kb(n,e.props.value)>-1)return{checked:!0}}else if(Ep(n)){if(e.props&&n.has(e.props.value))return{checked:!0}}else if(n)return{checked:!0}},b5.getSSRProps=(n,e)=>{if(typeof e.type!="string")return;const o=w5(e.type.toUpperCase(),e.props&&e.props.type);if(o.getSSRProps)return o.getSSRProps(n,e)}}const U9=["ctrl","shift","alt","meta"],j9={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>U9.some(o=>n[`${o}Key`]&&!e.includes(o))},Jb=(n,e)=>{const o=n._withMods||(n._withMods={}),u=e.join(".");return o[u]||(o[u]=(d,...y)=>{for(let v=0;v<e.length;v++){const r=j9[e[v]];if(r&&r(d,e))return}return n(d,...y)})},$9={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},T5=(n,e)=>{const o=n._withKeys||(n._withKeys={}),u=e.join(".");return o[u]||(o[u]=d=>{if(!("key"in d))return;const y=Va(d.key);if(e.some(v=>v===y||$9[v]===y))return n(d)})},E5=vn({patchProp:A9},l9);let Jy,aR=!1;function S5(){return Jy||(Jy=zk(E5))}function A5(){return Jy=aR?Jy:Fk(E5),aR=!0,Jy}const C5=(...n)=>{S5().render(...n)},q9=(...n)=>{A5().hydrate(...n)},Qx=(...n)=>{const e=S5().createApp(...n),{mount:o}=e;return e.mount=u=>{const d=P5(u);if(!d)return;const y=e._component;!Lr(y)&&!y.render&&!y.template&&(y.template=d.innerHTML),d.nodeType===1&&(d.textContent="");const v=o(d,!1,I5(d));return d instanceof Element&&(d.removeAttribute("v-cloak"),d.setAttribute("data-v-app","")),v},e},M5=(...n)=>{const e=A5().createApp(...n),{mount:o}=e;return e.mount=u=>{const d=P5(u);if(d)return o(d,!0,I5(d))},e};function I5(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function P5(n){return Gr(n)?document.querySelector(n):n}let lR=!1;const H9=()=>{lR||(lR=!0,V9(),p9())},G9=Object.freeze(Object.defineProperty({__proto__:null,BaseTransition:hk,BaseTransitionPropsValidators:KS,Comment:ao,DeprecationTypes:s9,EffectScope:jS,ErrorCodes:gH,ErrorTypeStrings:JG,Fragment:ur,KeepAlive:$H,ReactiveEffect:y0,Static:rp,Suspense:kG,Teleport:SH,Text:_d,TrackOpTypes:uH,Transition:u9,TransitionGroup:L9,TriggerOpTypes:hH,VueElement:Kb,assertNumber:_H,callWithAsyncErrorHandling:rc,callWithErrorHandling:F_,camelize:ws,capitalize:Sp,cloneVNode:fu,compatUtils:n9,computed:Ky,createApp:Qx,createBlock:C0,createCommentVNode:Jn,createElementBlock:Nt,createElementVNode:K,createHydrationRenderer:Fk,createPropsRestProxy:lG,createRenderer:zk,createSSRApp:M5,createSlots:ZH,createStaticVNode:x_,createTextVNode:Eo,createVNode:hs,customRef:KL,defineAsyncComponent:UH,defineComponent:Gb,defineCustomElement:_5,defineEmits:JH,defineExpose:QH,defineModel:iG,defineOptions:eG,defineProps:KH,defineSSRCustomElement:M9,defineSlots:tG,devtools:QG,effect:Dq,effectScope:Iq,getCurrentInstance:sc,getCurrentScope:RL,getCurrentWatcher:dH,getTransitionRawChildren:Hb,guardReactiveProps:Jk,h:o5,handleError:Ap,hasInjectionContext:gG,hydrate:q9,hydrateOnIdle:kH,hydrateOnInteraction:NH,hydrateOnMediaQuery:BH,hydrateOnVisible:FH,initCustomFormatter:YG,initDirectivesForSSR:H9,inject:Yy,isMemoSame:a5,isProxy:Ub,isReactive:pd,isReadonly:Sd,isRef:To,isRuntimeOnly:GG,isShallow:vl,isVNode:sh,markRaw:ZL,mergeDefaults:oG,mergeModels:aG,mergeProps:Qk,nextTick:$b,normalizeClass:rh,normalizeProps:gq,normalizeStyle:Ps,onActivated:fk,onBeforeMount:_k,onBeforeUnmount:q0,onBeforeUpdate:QS,onDeactivated:pk,onErrorCaptured:xk,onMounted:Sl,onRenderTracked:vk,onRenderTriggered:yk,onScopeDispose:Pq,onServerPrefetch:gk,onUnmounted:H0,onUpdated:Zb,onWatcherCleanup:QL,openBlock:zt,popScopeId:wH,provide:Ak,proxyRefs:WS,pushScopeId:bH,queuePostFlushCb:b0,reactive:Nb,readonly:GS,ref:Bs,registerRuntimeCompiler:r5,render:C5,renderList:_n,renderSlot:wk,resolveComponent:tA,resolveDirective:WH,resolveDynamicComponent:GH,resolveFilter:r9,resolveTransitionHooks:v_,setBlockTracking:EE,setDevtoolsHook:e9,setTransitionHooks:nh,shallowReactive:WL,shallowReadonly:Jq,shallowRef:YL,ssrContextKey:Uk,ssrUtils:i9,stop:Oq,toDisplayString:oi,toHandlerKey:Jm,toHandlers:YH,toRaw:Pn,toRef:aH,toRefs:nH,toValue:tH,transformVNodeArgs:UG,triggerRef:eH,unref:jb,useAttrs:sG,useCssModule:R9,useCssVars:m9,useHost:g5,useId:CH,useModel:MG,useSSRContext:jk,useShadowRoot:P9,useSlots:nG,useTemplateRef:MH,useTransitionState:XS,vModelCheckbox:cA,vModelDynamic:b5,vModelRadio:uA,vModelSelect:mp,vModelText:hn,vShow:lA,version:l5,warn:KG,watch:Ua,watchEffect:SG,watchPostEffect:AG,watchSyncEffect:$k,withAsyncContext:cG,withCtx:YS,withDefaults:rG,withDirectives:tn,withKeys:T5,withMemo:XG,withModifiers:Jb,withScopeId:TH},Symbol.toStringTag,{value:"Module"}));/**
* @vue/compiler-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const M0=Symbol(""),Qy=Symbol(""),hA=Symbol(""),eb=Symbol(""),R5=Symbol(""),_p=Symbol(""),D5=Symbol(""),O5=Symbol(""),dA=Symbol(""),fA=Symbol(""),Z0=Symbol(""),pA=Symbol(""),L5=Symbol(""),mA=Symbol(""),_A=Symbol(""),gA=Symbol(""),yA=Symbol(""),vA=Symbol(""),xA=Symbol(""),k5=Symbol(""),z5=Symbol(""),Qb=Symbol(""),tb=Symbol(""),bA=Symbol(""),wA=Symbol(""),I0=Symbol(""),Y0=Symbol(""),TA=Symbol(""),OE=Symbol(""),W9=Symbol(""),LE=Symbol(""),ib=Symbol(""),Z9=Symbol(""),Y9=Symbol(""),EA=Symbol(""),X9=Symbol(""),K9=Symbol(""),SA=Symbol(""),F5=Symbol(""),E_={[M0]:"Fragment",[Qy]:"Teleport",[hA]:"Suspense",[eb]:"KeepAlive",[R5]:"BaseTransition",[_p]:"openBlock",[D5]:"createBlock",[O5]:"createElementBlock",[dA]:"createVNode",[fA]:"createElementVNode",[Z0]:"createCommentVNode",[pA]:"createTextVNode",[L5]:"createStaticVNode",[mA]:"resolveComponent",[_A]:"resolveDynamicComponent",[gA]:"resolveDirective",[yA]:"resolveFilter",[vA]:"withDirectives",[xA]:"renderList",[k5]:"renderSlot",[z5]:"createSlots",[Qb]:"toDisplayString",[tb]:"mergeProps",[bA]:"normalizeClass",[wA]:"normalizeStyle",[I0]:"normalizeProps",[Y0]:"guardReactiveProps",[TA]:"toHandlers",[OE]:"camelize",[W9]:"capitalize",[LE]:"toHandlerKey",[ib]:"setBlockTracking",[Z9]:"pushScopeId",[Y9]:"popScopeId",[EA]:"withCtx",[X9]:"unref",[K9]:"isRef",[SA]:"withMemo",[F5]:"isMemoSame"};function J9(n){Object.getOwnPropertySymbols(n).forEach(e=>{E_[e]=n[e]})}const Cl={start:{line:1,column:1,offset:0},end:{line:1,column:1,offset:0},source:""};function Q9(n,e=""){return{type:0,source:e,children:n,helpers:new Set,components:[],directives:[],hoists:[],imports:[],cached:[],temps:0,codegenNode:void 0,loc:Cl}}function P0(n,e,o,u,d,y,v,r=!1,D=!1,B=!1,F=Cl){return n&&(r?(n.helper(_p),n.helper(C_(n.inSSR,B))):n.helper(A_(n.inSSR,B)),v&&n.helper(vA)),{type:13,tag:e,props:o,children:u,patchFlag:d,dynamicProps:y,directives:v,isBlock:r,disableTracking:D,isComponent:B,loc:F}}function np(n,e=Cl){return{type:17,loc:e,elements:n}}function Kl(n,e=Cl){return{type:15,loc:e,properties:n}}function eo(n,e){return{type:16,loc:Cl,key:Gr(n)?Qr(n,!0):n,value:e}}function Qr(n,e=!1,o=Cl,u=0){return{type:4,loc:o,content:n,isStatic:e,constType:e?3:u}}function Mc(n,e=Cl){return{type:8,loc:e,children:n}}function xo(n,e=[],o=Cl){return{type:14,loc:o,callee:n,arguments:e}}function S_(n,e=void 0,o=!1,u=!1,d=Cl){return{type:18,params:n,returns:e,newline:o,isSlot:u,loc:d}}function kE(n,e,o,u=!0){return{type:19,test:n,consequent:e,alternate:o,newline:u,loc:Cl}}function eW(n,e,o=!1,u=!1){return{type:20,index:n,value:e,needPauseTracking:o,inVOnce:u,needArraySpread:!1,loc:Cl}}function tW(n){return{type:21,body:n,loc:Cl}}function A_(n,e){return n||e?dA:fA}function C_(n,e){return n||e?D5:O5}function AA(n,{helper:e,removeHelper:o,inSSR:u}){n.isBlock||(n.isBlock=!0,o(A_(u,n.isComponent)),e(_p),e(C_(u,n.isComponent)))}const cR=new Uint8Array([123,123]),uR=new Uint8Array([125,125]);function hR(n){return n>=97&&n<=122||n>=65&&n<=90}function cl(n){return n===32||n===10||n===9||n===12||n===13}function Xh(n){return n===47||n===62||cl(n)}function rb(n){const e=new Uint8Array(n.length);for(let o=0;o<n.length;o++)e[o]=n.charCodeAt(o);return e}const Ho={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101]),TextareaEnd:new Uint8Array([60,47,116,101,120,116,97,114,101,97])};class iW{constructor(e,o){this.stack=e,this.cbs=o,this.state=1,this.buffer="",this.sectionStart=0,this.index=0,this.entityStart=0,this.baseState=1,this.inRCDATA=!1,this.inXML=!1,this.inVPre=!1,this.newlines=[],this.mode=0,this.delimiterOpen=cR,this.delimiterClose=uR,this.delimiterIndex=-1,this.currentSequence=void 0,this.sequenceIndex=0}get inSFCRoot(){return this.mode===2&&this.stack.length===0}reset(){this.state=1,this.mode=0,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=1,this.inRCDATA=!1,this.currentSequence=void 0,this.newlines.length=0,this.delimiterOpen=cR,this.delimiterClose=uR}getPos(e){let o=1,u=e+1;for(let d=this.newlines.length-1;d>=0;d--){const y=this.newlines[d];if(e>y){o=d+2,u=e-y;break}}return{column:u,line:o,offset:e}}peek(){return this.buffer.charCodeAt(this.index+1)}stateText(e){e===60?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=5,this.sectionStart=this.index):!this.inVPre&&e===this.delimiterOpen[0]&&(this.state=2,this.delimiterIndex=0,this.stateInterpolationOpen(e))}stateInterpolationOpen(e){if(e===this.delimiterOpen[this.delimiterIndex])if(this.delimiterIndex===this.delimiterOpen.length-1){const o=this.index+1-this.delimiterOpen.length;o>this.sectionStart&&this.cbs.ontext(this.sectionStart,o),this.state=3,this.sectionStart=o}else this.delimiterIndex++;else this.inRCDATA?(this.state=32,this.stateInRCDATA(e)):(this.state=1,this.stateText(e))}stateInterpolation(e){e===this.delimiterClose[0]&&(this.state=4,this.delimiterIndex=0,this.stateInterpolationClose(e))}stateInterpolationClose(e){e===this.delimiterClose[this.delimiterIndex]?this.delimiterIndex===this.delimiterClose.length-1?(this.cbs.oninterpolation(this.sectionStart,this.index+1),this.inRCDATA?this.state=32:this.state=1,this.sectionStart=this.index+1):this.delimiterIndex++:(this.state=3,this.stateInterpolation(e))}stateSpecialStartSequence(e){const o=this.sequenceIndex===this.currentSequence.length;if(!(o?Xh(e):(e|32)===this.currentSequence[this.sequenceIndex]))this.inRCDATA=!1;else if(!o){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=6,this.stateInTagName(e)}stateInRCDATA(e){if(this.sequenceIndex===this.currentSequence.length){if(e===62||cl(e)){const o=this.index-this.currentSequence.length;if(this.sectionStart<o){const u=this.index;this.index=o,this.cbs.ontext(this.sectionStart,o),this.index=u}this.sectionStart=o+2,this.stateInClosingTagName(e),this.inRCDATA=!1;return}this.sequenceIndex=0}(e|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===Ho.TitleEnd||this.currentSequence===Ho.TextareaEnd&&!this.inSFCRoot?!this.inVPre&&e===this.delimiterOpen[0]&&(this.state=2,this.delimiterIndex=0,this.stateInterpolationOpen(e)):this.fastForwardTo(60)&&(this.sequenceIndex=1):this.sequenceIndex=+(e===60)}stateCDATASequence(e){e===Ho.Cdata[this.sequenceIndex]?++this.sequenceIndex===Ho.Cdata.length&&(this.state=28,this.currentSequence=Ho.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=23,this.stateInDeclaration(e))}fastForwardTo(e){for(;++this.index<this.buffer.length;){const o=this.buffer.charCodeAt(this.index);if(o===10&&this.newlines.push(this.index),o===e)return!0}return this.index=this.buffer.length-1,!1}stateInCommentLike(e){e===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===Ho.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index-2):this.cbs.oncomment(this.sectionStart,this.index-2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=1):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):e!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)}startSpecial(e,o){this.enterRCDATA(e,o),this.state=31}enterRCDATA(e,o){this.inRCDATA=!0,this.currentSequence=e,this.sequenceIndex=o}stateBeforeTagName(e){e===33?(this.state=22,this.sectionStart=this.index+1):e===63?(this.state=24,this.sectionStart=this.index+1):hR(e)?(this.sectionStart=this.index,this.mode===0?this.state=6:this.inSFCRoot?this.state=34:this.inXML?this.state=6:e===116?this.state=30:this.state=e===115?29:6):e===47?this.state=8:(this.state=1,this.stateText(e))}stateInTagName(e){Xh(e)&&this.handleTagName(e)}stateInSFCRootTagName(e){if(Xh(e)){const o=this.buffer.slice(this.sectionStart,this.index);o!=="template"&&this.enterRCDATA(rb("</"+o),0),this.handleTagName(e)}}handleTagName(e){this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=11,this.stateBeforeAttrName(e)}stateBeforeClosingTagName(e){cl(e)||(e===62?(this.state=1,this.sectionStart=this.index+1):(this.state=hR(e)?9:27,this.sectionStart=this.index))}stateInClosingTagName(e){(e===62||cl(e))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=10,this.stateAfterClosingTagName(e))}stateAfterClosingTagName(e){e===62&&(this.state=1,this.sectionStart=this.index+1)}stateBeforeAttrName(e){e===62?(this.cbs.onopentagend(this.index),this.inRCDATA?this.state=32:this.state=1,this.sectionStart=this.index+1):e===47?this.state=7:e===60&&this.peek()===47?(this.cbs.onopentagend(this.index),this.state=5,this.sectionStart=this.index):cl(e)||this.handleAttrStart(e)}handleAttrStart(e){e===118&&this.peek()===45?(this.state=13,this.sectionStart=this.index):e===46||e===58||e===64||e===35?(this.cbs.ondirname(this.index,this.index+1),this.state=14,this.sectionStart=this.index+1):(this.state=12,this.sectionStart=this.index)}stateInSelfClosingTag(e){e===62?(this.cbs.onselfclosingtag(this.index),this.state=1,this.sectionStart=this.index+1,this.inRCDATA=!1):cl(e)||(this.state=11,this.stateBeforeAttrName(e))}stateInAttrName(e){(e===61||Xh(e))&&(this.cbs.onattribname(this.sectionStart,this.index),this.handleAttrNameEnd(e))}stateInDirName(e){e===61||Xh(e)?(this.cbs.ondirname(this.sectionStart,this.index),this.handleAttrNameEnd(e)):e===58?(this.cbs.ondirname(this.sectionStart,this.index),this.state=14,this.sectionStart=this.index+1):e===46&&(this.cbs.ondirname(this.sectionStart,this.index),this.state=16,this.sectionStart=this.index+1)}stateInDirArg(e){e===61||Xh(e)?(this.cbs.ondirarg(this.sectionStart,this.index),this.handleAttrNameEnd(e)):e===91?this.state=15:e===46&&(this.cbs.ondirarg(this.sectionStart,this.index),this.state=16,this.sectionStart=this.index+1)}stateInDynamicDirArg(e){e===93?this.state=14:(e===61||Xh(e))&&(this.cbs.ondirarg(this.sectionStart,this.index+1),this.handleAttrNameEnd(e))}stateInDirModifier(e){e===61||Xh(e)?(this.cbs.ondirmodifier(this.sectionStart,this.index),this.handleAttrNameEnd(e)):e===46&&(this.cbs.ondirmodifier(this.sectionStart,this.index),this.sectionStart=this.index+1)}handleAttrNameEnd(e){this.sectionStart=this.index,this.state=17,this.cbs.onattribnameend(this.index),this.stateAfterAttrName(e)}stateAfterAttrName(e){e===61?this.state=18:e===47||e===62?(this.cbs.onattribend(0,this.sectionStart),this.sectionStart=-1,this.state=11,this.stateBeforeAttrName(e)):cl(e)||(this.cbs.onattribend(0,this.sectionStart),this.handleAttrStart(e))}stateBeforeAttrValue(e){e===34?(this.state=19,this.sectionStart=this.index+1):e===39?(this.state=20,this.sectionStart=this.index+1):cl(e)||(this.sectionStart=this.index,this.state=21,this.stateInAttrValueNoQuotes(e))}handleInAttrValue(e,o){(e===o||this.fastForwardTo(o))&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(o===34?3:2,this.index+1),this.state=11)}stateInAttrValueDoubleQuotes(e){this.handleInAttrValue(e,34)}stateInAttrValueSingleQuotes(e){this.handleInAttrValue(e,39)}stateInAttrValueNoQuotes(e){cl(e)||e===62?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(1,this.index),this.state=11,this.stateBeforeAttrName(e)):(e===39||e===60||e===61||e===96)&&this.cbs.onerr(18,this.index)}stateBeforeDeclaration(e){e===91?(this.state=26,this.sequenceIndex=0):this.state=e===45?25:23}stateInDeclaration(e){(e===62||this.fastForwardTo(62))&&(this.state=1,this.sectionStart=this.index+1)}stateInProcessingInstruction(e){(e===62||this.fastForwardTo(62))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=1,this.sectionStart=this.index+1)}stateBeforeComment(e){e===45?(this.state=28,this.currentSequence=Ho.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=23}stateInSpecialComment(e){(e===62||this.fastForwardTo(62))&&(this.cbs.oncomment(this.sectionStart,this.index),this.state=1,this.sectionStart=this.index+1)}stateBeforeSpecialS(e){e===Ho.ScriptEnd[3]?this.startSpecial(Ho.ScriptEnd,4):e===Ho.StyleEnd[3]?this.startSpecial(Ho.StyleEnd,4):(this.state=6,this.stateInTagName(e))}stateBeforeSpecialT(e){e===Ho.TitleEnd[3]?this.startSpecial(Ho.TitleEnd,4):e===Ho.TextareaEnd[3]?this.startSpecial(Ho.TextareaEnd,4):(this.state=6,this.stateInTagName(e))}startEntity(){}stateInEntity(){}parse(e){for(this.buffer=e;this.index<this.buffer.length;){const o=this.buffer.charCodeAt(this.index);switch(o===10&&this.newlines.push(this.index),this.state){case 1:{this.stateText(o);break}case 2:{this.stateInterpolationOpen(o);break}case 3:{this.stateInterpolation(o);break}case 4:{this.stateInterpolationClose(o);break}case 31:{this.stateSpecialStartSequence(o);break}case 32:{this.stateInRCDATA(o);break}case 26:{this.stateCDATASequence(o);break}case 19:{this.stateInAttrValueDoubleQuotes(o);break}case 12:{this.stateInAttrName(o);break}case 13:{this.stateInDirName(o);break}case 14:{this.stateInDirArg(o);break}case 15:{this.stateInDynamicDirArg(o);break}case 16:{this.stateInDirModifier(o);break}case 28:{this.stateInCommentLike(o);break}case 27:{this.stateInSpecialComment(o);break}case 11:{this.stateBeforeAttrName(o);break}case 6:{this.stateInTagName(o);break}case 34:{this.stateInSFCRootTagName(o);break}case 9:{this.stateInClosingTagName(o);break}case 5:{this.stateBeforeTagName(o);break}case 17:{this.stateAfterAttrName(o);break}case 20:{this.stateInAttrValueSingleQuotes(o);break}case 18:{this.stateBeforeAttrValue(o);break}case 8:{this.stateBeforeClosingTagName(o);break}case 10:{this.stateAfterClosingTagName(o);break}case 29:{this.stateBeforeSpecialS(o);break}case 30:{this.stateBeforeSpecialT(o);break}case 21:{this.stateInAttrValueNoQuotes(o);break}case 7:{this.stateInSelfClosingTag(o);break}case 23:{this.stateInDeclaration(o);break}case 22:{this.stateBeforeDeclaration(o);break}case 25:{this.stateBeforeComment(o);break}case 24:{this.stateInProcessingInstruction(o);break}case 33:{this.stateInEntity();break}}this.index++}this.cleanup(),this.finish()}cleanup(){this.sectionStart!==this.index&&(this.state===1||this.state===32&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===19||this.state===20||this.state===21)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))}finish(){this.handleTrailingData(),this.cbs.onend()}handleTrailingData(){const e=this.buffer.length;this.sectionStart>=e||(this.state===28?this.currentSequence===Ho.CdataEnd?this.cbs.oncdata(this.sectionStart,e):this.cbs.oncomment(this.sectionStart,e):this.state===6||this.state===11||this.state===18||this.state===17||this.state===12||this.state===13||this.state===14||this.state===15||this.state===16||this.state===20||this.state===19||this.state===21||this.state===9||this.cbs.ontext(this.sectionStart,e))}emitCodePoint(e,o){}}function dR(n,{compatConfig:e}){const o=e&&e[n];return n==="MODE"?o||3:o}function sp(n,e){const o=dR("MODE",e),u=dR(n,e);return o===3?u===!0:u!==!1}function R0(n,e,o,...u){return sp(n,e)}function CA(n){throw n}function B5(n){}function Is(n,e,o,u){const d=`https://vuejs.org/error-reference/#compiler-${n}`,y=new SyntaxError(String(d));return y.code=n,y.loc=e,y}const ja=n=>n.type===4&&n.isStatic;function N5(n){switch(n){case"Teleport":case"teleport":return Qy;case"Suspense":case"suspense":return hA;case"KeepAlive":case"keep-alive":return eb;case"BaseTransition":case"base-transition":return R5}}const rW=/^\d|[^\$\w\xA0-\uFFFF]/,MA=n=>!rW.test(n),nW=/[A-Za-z_$\xA0-\uFFFF]/,sW=/[\.\?\w$\xA0-\uFFFF]/,oW=/\s+[.[]\s*|\s*[.[]\s+/g,V5=n=>n.type===4?n.content:n.loc.source,aW=n=>{const e=V5(n).trim().replace(oW,r=>r.trim());let o=0,u=[],d=0,y=0,v=null;for(let r=0;r<e.length;r++){const D=e.charAt(r);switch(o){case 0:if(D==="[")u.push(o),o=1,d++;else if(D==="(")u.push(o),o=2,y++;else if(!(r===0?nW:sW).test(D))return!1;break;case 1:D==="'"||D==='"'||D==="`"?(u.push(o),o=3,v=D):D==="["?d++:D==="]"&&(--d||(o=u.pop()));break;case 2:if(D==="'"||D==='"'||D==="`")u.push(o),o=3,v=D;else if(D==="(")y++;else if(D===")"){if(r===e.length-1)return!1;--y||(o=u.pop())}break;case 3:D===v&&(o=u.pop(),v=null);break}}return!d&&!y},U5=aW,lW=/^\s*(async\s*)?(\([^)]*?\)|[\w$_]+)\s*(:[^=]+)?=>|^\s*(async\s+)?function(?:\s+[\w$]+)?\s*\(/,cW=n=>lW.test(V5(n)),uW=cW;function Gl(n,e,o=!1){for(let u=0;u<n.props.length;u++){const d=n.props[u];if(d.type===7&&(o||d.exp)&&(Gr(e)?d.name===e:e.test(d.name)))return d}}function ew(n,e,o=!1,u=!1){for(let d=0;d<n.props.length;d++){const y=n.props[d];if(y.type===6){if(o)continue;if(y.name===e&&(y.value||u))return y}else if(y.name==="bind"&&(y.exp||u)&&Wf(y.arg,e))return y}}function Wf(n,e){return!!(n&&ja(n)&&n.content===e)}function hW(n){return n.props.some(e=>e.type===7&&e.name==="bind"&&(!e.arg||e.arg.type!==4||!e.arg.isStatic))}function MT(n){return n.type===5||n.type===2}function dW(n){return n.type===7&&n.name==="slot"}function nb(n){return n.type===1&&n.tagType===3}function sb(n){return n.type===1&&n.tagType===2}const fW=new Set([I0,Y0]);function j5(n,e=[]){if(n&&!Gr(n)&&n.type===14){const o=n.callee;if(!Gr(o)&&fW.has(o))return j5(n.arguments[0],e.concat(n))}return[n,e]}function ob(n,e,o){let u,d=n.type===13?n.props:n.arguments[2],y=[],v;if(d&&!Gr(d)&&d.type===14){const r=j5(d);d=r[0],y=r[1],v=y[y.length-1]}if(d==null||Gr(d))u=Kl([e]);else if(d.type===14){const r=d.arguments[0];!Gr(r)&&r.type===15?fR(e,r)||r.properties.unshift(e):d.callee===TA?u=xo(o.helper(tb),[Kl([e]),d]):d.arguments.unshift(Kl([e])),!u&&(u=d)}else d.type===15?(fR(e,d)||d.properties.unshift(e),u=d):(u=xo(o.helper(tb),[Kl([e]),d]),v&&v.callee===Y0&&(v=y[y.length-2]));n.type===13?v?v.arguments[0]=u:n.props=u:v?v.arguments[0]=u:n.arguments[2]=u}function fR(n,e){let o=!1;if(n.key.type===4){const u=n.key.content;o=e.properties.some(d=>d.key.type===4&&d.key.content===u)}return o}function D0(n,e){return`_${e}_${n.replace(/[^\w]/g,(o,u)=>o==="-"?"_":n.charCodeAt(u).toString())}`}function pW(n){return n.type===14&&n.callee===SA?n.arguments[1].returns:n}const mW=/([\s\S]*?)\s+(?:in|of)\s+(\S[\s\S]*)/,$5={parseMode:"base",ns:0,delimiters:["{{","}}"],getNamespace:()=>0,isVoidTag:Ry,isPreTag:Ry,isIgnoreNewlineTag:Ry,isCustomElement:Ry,onError:CA,onWarn:B5,comments:!1,prefixIdentifiers:!1};let jn=$5,O0=null,Ju="",Wo=null,In=null,ka="",Uu=-1,Vf=-1,IA=0,nd=!1,zE=null;const Cs=[],$s=new iW(Cs,{onerr:Nu,ontext(n,e){Fv(Lo(n,e),n,e)},ontextentity(n,e,o){Fv(n,e,o)},oninterpolation(n,e){if(nd)return Fv(Lo(n,e),n,e);let o=n+$s.delimiterOpen.length,u=e-$s.delimiterClose.length;for(;cl(Ju.charCodeAt(o));)o++;for(;cl(Ju.charCodeAt(u-1));)u--;let d=Lo(o,u);d.includes("&")&&(d=jn.decodeEntities(d,!1)),FE({type:5,content:px(d,!1,Js(o,u)),loc:Js(n,e)})},onopentagname(n,e){const o=Lo(n,e);Wo={type:1,tag:o,ns:jn.getNamespace(o,Cs[0],jn.ns),tagType:0,props:[],children:[],loc:Js(n-1,e),codegenNode:void 0}},onopentagend(n){mR(n)},onclosetag(n,e){const o=Lo(n,e);if(!jn.isVoidTag(o)){let u=!1;for(let d=0;d<Cs.length;d++)if(Cs[d].tag.toLowerCase()===o.toLowerCase()){u=!0,d>0&&Nu(24,Cs[0].loc.start.offset);for(let v=0;v<=d;v++){const r=Cs.shift();fx(r,e,v<d)}break}u||Nu(23,q5(n,60))}},onselfclosingtag(n){const e=Wo.tag;Wo.isSelfClosing=!0,mR(n),Cs[0]&&Cs[0].tag===e&&fx(Cs.shift(),n)},onattribname(n,e){In={type:6,name:Lo(n,e),nameLoc:Js(n,e),value:void 0,loc:Js(n)}},ondirname(n,e){const o=Lo(n,e),u=o==="."||o===":"?"bind":o==="@"?"on":o==="#"?"slot":o.slice(2);if(!nd&&u===""&&Nu(26,n),nd||u==="")In={type:6,name:o,nameLoc:Js(n,e),value:void 0,loc:Js(n)};else if(In={type:7,name:u,rawName:o,exp:void 0,arg:void 0,modifiers:o==="."?[Qr("prop")]:[],loc:Js(n)},u==="pre"){nd=$s.inVPre=!0,zE=Wo;const d=Wo.props;for(let y=0;y<d.length;y++)d[y].type===7&&(d[y]=AW(d[y]))}},ondirarg(n,e){if(n===e)return;const o=Lo(n,e);if(nd)In.name+=o,Zf(In.nameLoc,e);else{const u=o[0]!=="[";In.arg=px(u?o:o.slice(1,-1),u,Js(n,e),u?3:0)}},ondirmodifier(n,e){const o=Lo(n,e);if(nd)In.name+="."+o,Zf(In.nameLoc,e);else if(In.name==="slot"){const u=In.arg;u&&(u.content+="."+o,Zf(u.loc,e))}else{const u=Qr(o,!0,Js(n,e));In.modifiers.push(u)}},onattribdata(n,e){ka+=Lo(n,e),Uu<0&&(Uu=n),Vf=e},onattribentity(n,e,o){ka+=n,Uu<0&&(Uu=e),Vf=o},onattribnameend(n){const e=In.loc.start.offset,o=Lo(e,n);In.type===7&&(In.rawName=o),Wo.props.some(u=>(u.type===7?u.rawName:u.name)===o)&&Nu(2,e)},onattribend(n,e){if(Wo&&In){if(Zf(In.loc,e),n!==0)if(ka.includes("&")&&(ka=jn.decodeEntities(ka,!0)),In.type===6)In.name==="class"&&(ka=G5(ka).trim()),n===1&&!ka&&Nu(13,e),In.value={type:2,content:ka,loc:n===1?Js(Uu,Vf):Js(Uu-1,Vf+1)},$s.inSFCRoot&&Wo.tag==="template"&&In.name==="lang"&&ka&&ka!=="html"&&$s.enterRCDATA(rb("</template"),0);else{let o=0;In.exp=px(ka,!1,Js(Uu,Vf),0,o),In.name==="for"&&(In.forParseResult=gW(In.exp));let u=-1;In.name==="bind"&&(u=In.modifiers.findIndex(d=>d.content==="sync"))>-1&&R0("COMPILER_V_BIND_SYNC",jn,In.loc,In.rawName)&&(In.name="model",In.modifiers.splice(u,1))}(In.type!==7||In.name!=="pre")&&Wo.props.push(In)}ka="",Uu=Vf=-1},oncomment(n,e){jn.comments&&FE({type:3,content:Lo(n,e),loc:Js(n-4,e+3)})},onend(){const n=Ju.length;for(let e=0;e<Cs.length;e++)fx(Cs[e],n-1),Nu(24,Cs[e].loc.start.offset)},oncdata(n,e){Cs[0].ns!==0?Fv(Lo(n,e),n,e):Nu(1,n-9)},onprocessinginstruction(n){(Cs[0]?Cs[0].ns:jn.ns)===0&&Nu(21,n-1)}}),pR=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,_W=/^\(|\)$/g;function gW(n){const e=n.loc,o=n.content,u=o.match(mW);if(!u)return;const[,d,y]=u,v=(N,Q,q=!1)=>{const X=e.start.offset+Q,G=X+N.length;return px(N,!1,Js(X,G),0,q?1:0)},r={source:v(y.trim(),o.indexOf(y,d.length)),value:void 0,key:void 0,index:void 0,finalized:!1};let D=d.trim().replace(_W,"").trim();const B=d.indexOf(D),F=D.match(pR);if(F){D=D.replace(pR,"").trim();const N=F[1].trim();let Q;if(N&&(Q=o.indexOf(N,B+D.length),r.key=v(N,Q,!0)),F[2]){const q=F[2].trim();q&&(r.index=v(q,o.indexOf(q,r.key?Q+N.length:B+D.length),!0))}}return D&&(r.value=v(D,B,!0)),r}function Lo(n,e){return Ju.slice(n,e)}function mR(n){$s.inSFCRoot&&(Wo.innerLoc=Js(n+1,n+1)),FE(Wo);const{tag:e,ns:o}=Wo;o===0&&jn.isPreTag(e)&&IA++,jn.isVoidTag(e)?fx(Wo,n):(Cs.unshift(Wo),(o===1||o===2)&&($s.inXML=!0)),Wo=null}function Fv(n,e,o){{const y=Cs[0]&&Cs[0].tag;y!=="script"&&y!=="style"&&n.includes("&")&&(n=jn.decodeEntities(n,!1))}const u=Cs[0]||O0,d=u.children[u.children.length-1];d&&d.type===2?(d.content+=n,Zf(d.loc,o)):u.children.push({type:2,content:n,loc:Js(e,o)})}function fx(n,e,o=!1){o?Zf(n.loc,q5(e,60)):Zf(n.loc,yW(e,62)+1),$s.inSFCRoot&&(n.children.length?n.innerLoc.end=vn({},n.children[n.children.length-1].loc.end):n.innerLoc.end=vn({},n.innerLoc.start),n.innerLoc.source=Lo(n.innerLoc.start.offset,n.innerLoc.end.offset));const{tag:u,ns:d,children:y}=n;if(nd||(u==="slot"?n.tagType=2:_R(n)?n.tagType=3:xW(n)&&(n.tagType=1)),$s.inRCDATA||(n.children=H5(y)),d===0&&jn.isIgnoreNewlineTag(u)){const v=y[0];v&&v.type===2&&(v.content=v.content.replace(/^\r?\n/,""))}d===0&&jn.isPreTag(u)&&IA--,zE===n&&(nd=$s.inVPre=!1,zE=null),$s.inXML&&(Cs[0]?Cs[0].ns:jn.ns)===0&&($s.inXML=!1);{const v=n.props;if(!$s.inSFCRoot&&sp("COMPILER_NATIVE_TEMPLATE",jn)&&n.tag==="template"&&!_R(n)){const D=Cs[0]||O0,B=D.children.indexOf(n);D.children.splice(B,1,...n.children)}const r=v.find(D=>D.type===6&&D.name==="inline-template");r&&R0("COMPILER_INLINE_TEMPLATE",jn,r.loc)&&n.children.length&&(r.value={type:2,content:Lo(n.children[0].loc.start.offset,n.children[n.children.length-1].loc.end.offset),loc:r.loc})}}function yW(n,e){let o=n;for(;Ju.charCodeAt(o)!==e&&o<Ju.length-1;)o++;return o}function q5(n,e){let o=n;for(;Ju.charCodeAt(o)!==e&&o>=0;)o--;return o}const vW=new Set(["if","else","else-if","for","slot"]);function _R({tag:n,props:e}){if(n==="template"){for(let o=0;o<e.length;o++)if(e[o].type===7&&vW.has(e[o].name))return!0}return!1}function xW({tag:n,props:e}){if(jn.isCustomElement(n))return!1;if(n==="component"||bW(n.charCodeAt(0))||N5(n)||jn.isBuiltInComponent&&jn.isBuiltInComponent(n)||jn.isNativeTag&&!jn.isNativeTag(n))return!0;for(let o=0;o<e.length;o++){const u=e[o];if(u.type===6){if(u.name==="is"&&u.value){if(u.value.content.startsWith("vue:"))return!0;if(R0("COMPILER_IS_ON_ELEMENT",jn,u.loc))return!0}}else if(u.name==="bind"&&Wf(u.arg,"is")&&R0("COMPILER_IS_ON_ELEMENT",jn,u.loc))return!0}return!1}function bW(n){return n>64&&n<91}const wW=/\r\n/g;function H5(n,e){const o=jn.whitespace!=="preserve";let u=!1;for(let d=0;d<n.length;d++){const y=n[d];if(y.type===2)if(IA)y.content=y.content.replace(wW,`
`);else if(TW(y.content)){const v=n[d-1]&&n[d-1].type,r=n[d+1]&&n[d+1].type;!v||!r||o&&(v===3&&(r===3||r===1)||v===1&&(r===3||r===1&&EW(y.content)))?(u=!0,n[d]=null):y.content=" "}else o&&(y.content=G5(y.content))}return u?n.filter(Boolean):n}function TW(n){for(let e=0;e<n.length;e++)if(!cl(n.charCodeAt(e)))return!1;return!0}function EW(n){for(let e=0;e<n.length;e++){const o=n.charCodeAt(e);if(o===10||o===13)return!0}return!1}function G5(n){let e="",o=!1;for(let u=0;u<n.length;u++)cl(n.charCodeAt(u))?o||(e+=" ",o=!0):(e+=n[u],o=!1);return e}function FE(n){(Cs[0]||O0).children.push(n)}function Js(n,e){return{start:$s.getPos(n),end:e==null?e:$s.getPos(e),source:e==null?e:Lo(n,e)}}function SW(n){return Js(n.start.offset,n.end.offset)}function Zf(n,e){n.end=$s.getPos(e),n.source=Lo(n.start.offset,e)}function AW(n){const e={type:6,name:n.rawName,nameLoc:Js(n.loc.start.offset,n.loc.start.offset+n.rawName.length),value:void 0,loc:n.loc};if(n.exp){const o=n.exp.loc;o.end.offset<n.loc.end.offset&&(o.start.offset--,o.start.column--,o.end.offset++,o.end.column++),e.value={type:2,content:n.exp.content,loc:o}}return e}function px(n,e=!1,o,u=0,d=0){return Qr(n,e,o,u)}function Nu(n,e,o){jn.onError(Is(n,Js(e,e)))}function CW(){$s.reset(),Wo=null,In=null,ka="",Uu=-1,Vf=-1,Cs.length=0}function MW(n,e){if(CW(),Ju=n,jn=vn({},$5),e){let d;for(d in e)e[d]!=null&&(jn[d]=e[d])}$s.mode=jn.parseMode==="html"?1:jn.parseMode==="sfc"?2:0,$s.inXML=jn.ns===1||jn.ns===2;const o=e&&e.delimiters;o&&($s.delimiterOpen=rb(o[0]),$s.delimiterClose=rb(o[1]));const u=O0=Q9([],n);return $s.parse(Ju),u.loc=Js(0,n.length),u.children=H5(u.children),O0=null,u}function IW(n,e){mx(n,void 0,e,W5(n,n.children[0]))}function W5(n,e){const{children:o}=n;return o.length===1&&e.type===1&&!sb(e)}function mx(n,e,o,u=!1,d=!1){const{children:y}=n,v=[];for(let F=0;F<y.length;F++){const N=y[F];if(N.type===1&&N.tagType===0){const Q=u?0:_l(N,o);if(Q>0){if(Q>=2){N.codegenNode.patchFlag=-1,v.push(N);continue}}else{const q=N.codegenNode;if(q.type===13){const X=q.patchFlag;if((X===void 0||X===512||X===1)&&Y5(N,o)>=2){const G=X5(N);G&&(q.props=o.hoist(G))}q.dynamicProps&&(q.dynamicProps=o.hoist(q.dynamicProps))}}}else if(N.type===12&&(u?0:_l(N,o))>=2){v.push(N);continue}if(N.type===1){const Q=N.tagType===1;Q&&o.scopes.vSlot++,mx(N,n,o,!1,d),Q&&o.scopes.vSlot--}else if(N.type===11)mx(N,n,o,N.children.length===1,!0);else if(N.type===9)for(let Q=0;Q<N.branches.length;Q++)mx(N.branches[Q],n,o,N.branches[Q].children.length===1,d)}let r=!1;if(v.length===y.length&&n.type===1){if(n.tagType===0&&n.codegenNode&&n.codegenNode.type===13&&Xi(n.codegenNode.children))n.codegenNode.children=D(np(n.codegenNode.children)),r=!0;else if(n.tagType===1&&n.codegenNode&&n.codegenNode.type===13&&n.codegenNode.children&&!Xi(n.codegenNode.children)&&n.codegenNode.children.type===15){const F=B(n.codegenNode,"default");F&&(F.returns=D(np(F.returns)),r=!0)}else if(n.tagType===3&&e&&e.type===1&&e.tagType===1&&e.codegenNode&&e.codegenNode.type===13&&e.codegenNode.children&&!Xi(e.codegenNode.children)&&e.codegenNode.children.type===15){const F=Gl(n,"slot",!0),N=F&&F.arg&&B(e.codegenNode,F.arg);N&&(N.returns=D(np(N.returns)),r=!0)}}if(!r)for(const F of v)F.codegenNode=o.cache(F.codegenNode);function D(F){const N=o.cache(F);return d&&o.hmr&&(N.needArraySpread=!0),N}function B(F,N){if(F.children&&!Xi(F.children)&&F.children.type===15){const Q=F.children.properties.find(q=>q.key===N||q.key.content===N);return Q&&Q.value}}v.length&&o.transformHoist&&o.transformHoist(y,o,n)}function _l(n,e){const{constantCache:o}=e;switch(n.type){case 1:if(n.tagType!==0)return 0;const u=o.get(n);if(u!==void 0)return u;const d=n.codegenNode;if(d.type!==13||d.isBlock&&n.tag!=="svg"&&n.tag!=="foreignObject"&&n.tag!=="math")return 0;if(d.patchFlag===void 0){let v=3;const r=Y5(n,e);if(r===0)return o.set(n,0),0;r<v&&(v=r);for(let D=0;D<n.children.length;D++){const B=_l(n.children[D],e);if(B===0)return o.set(n,0),0;B<v&&(v=B)}if(v>1)for(let D=0;D<n.props.length;D++){const B=n.props[D];if(B.type===7&&B.name==="bind"&&B.exp){const F=_l(B.exp,e);if(F===0)return o.set(n,0),0;F<v&&(v=F)}}if(d.isBlock){for(let D=0;D<n.props.length;D++)if(n.props[D].type===7)return o.set(n,0),0;e.removeHelper(_p),e.removeHelper(C_(e.inSSR,d.isComponent)),d.isBlock=!1,e.helper(A_(e.inSSR,d.isComponent))}return o.set(n,v),v}else return o.set(n,0),0;case 2:case 3:return 3;case 9:case 11:case 10:return 0;case 5:case 12:return _l(n.content,e);case 4:return n.constType;case 8:let y=3;for(let v=0;v<n.children.length;v++){const r=n.children[v];if(Gr(r)||Za(r))continue;const D=_l(r,e);if(D===0)return 0;D<y&&(y=D)}return y;case 20:return 2;default:return 0}}const PW=new Set([bA,wA,I0,Y0]);function Z5(n,e){if(n.type===14&&!Gr(n.callee)&&PW.has(n.callee)){const o=n.arguments[0];if(o.type===4)return _l(o,e);if(o.type===14)return Z5(o,e)}return 0}function Y5(n,e){let o=3;const u=X5(n);if(u&&u.type===15){const{properties:d}=u;for(let y=0;y<d.length;y++){const{key:v,value:r}=d[y],D=_l(v,e);if(D===0)return D;D<o&&(o=D);let B;if(r.type===4?B=_l(r,e):r.type===14?B=Z5(r,e):B=0,B===0)return B;B<o&&(o=B)}}return o}function X5(n){const e=n.codegenNode;if(e.type===13)return e.props}function RW(n,{filename:e="",prefixIdentifiers:o=!1,hoistStatic:u=!1,hmr:d=!1,cacheHandlers:y=!1,nodeTransforms:v=[],directiveTransforms:r={},transformHoist:D=null,isBuiltInComponent:B=Io,isCustomElement:F=Io,expressionPlugins:N=[],scopeId:Q=null,slotted:q=!0,ssr:X=!1,inSSR:G=!1,ssrCssVars:ae="",bindingMetadata:xe=yn,inline:Te=!1,isTS:fe=!1,onError:ne=CA,onWarn:ue=B5,compatConfig:ye}){const le=e.replace(/\?.*$/,"").match(/([^/\\]+)\.\w+$/),re={filename:e,selfName:le&&Sp(ws(le[1])),prefixIdentifiers:o,hoistStatic:u,hmr:d,cacheHandlers:y,nodeTransforms:v,directiveTransforms:r,transformHoist:D,isBuiltInComponent:B,isCustomElement:F,expressionPlugins:N,scopeId:Q,slotted:q,ssr:X,inSSR:G,ssrCssVars:ae,bindingMetadata:xe,inline:Te,isTS:fe,onError:ne,onWarn:ue,compatConfig:ye,root:n,helpers:new Map,components:new Set,directives:new Set,hoists:[],imports:[],cached:[],constantCache:new WeakMap,temps:0,identifiers:Object.create(null),scopes:{vFor:0,vSlot:0,vPre:0,vOnce:0},parent:null,grandParent:null,currentNode:n,childIndex:0,inVOnce:!1,helper(oe){const se=re.helpers.get(oe)||0;return re.helpers.set(oe,se+1),oe},removeHelper(oe){const se=re.helpers.get(oe);if(se){const Ae=se-1;Ae?re.helpers.set(oe,Ae):re.helpers.delete(oe)}},helperString(oe){return`_${E_[re.helper(oe)]}`},replaceNode(oe){re.parent.children[re.childIndex]=re.currentNode=oe},removeNode(oe){const se=re.parent.children,Ae=oe?se.indexOf(oe):re.currentNode?re.childIndex:-1;!oe||oe===re.currentNode?(re.currentNode=null,re.onNodeRemoved()):re.childIndex>Ae&&(re.childIndex--,re.onNodeRemoved()),re.parent.children.splice(Ae,1)},onNodeRemoved:Io,addIdentifiers(oe){},removeIdentifiers(oe){},hoist(oe){Gr(oe)&&(oe=Qr(oe)),re.hoists.push(oe);const se=Qr(`_hoisted_${re.hoists.length}`,!1,oe.loc,2);return se.hoisted=oe,se},cache(oe,se=!1,Ae=!1){const De=eW(re.cached.length,oe,se,Ae);return re.cached.push(De),De}};return re.filters=new Set,re}function DW(n,e){const o=RW(n,e);tw(n,o),e.hoistStatic&&IW(n,o),e.ssr||OW(n,o),n.helpers=new Set([...o.helpers.keys()]),n.components=[...o.components],n.directives=[...o.directives],n.imports=o.imports,n.hoists=o.hoists,n.temps=o.temps,n.cached=o.cached,n.transformed=!0,n.filters=[...o.filters]}function OW(n,e){const{helper:o}=e,{children:u}=n;if(u.length===1){const d=u[0];if(W5(n,d)&&d.codegenNode){const y=d.codegenNode;y.type===13&&AA(y,e),n.codegenNode=y}else n.codegenNode=d}else if(u.length>1){let d=64;n.codegenNode=P0(e,o(M0),void 0,n.children,d,void 0,void 0,!0,void 0,!1)}}function LW(n,e){let o=0;const u=()=>{o--};for(;o<n.children.length;o++){const d=n.children[o];Gr(d)||(e.grandParent=e.parent,e.parent=n,e.childIndex=o,e.onNodeRemoved=u,tw(d,e))}}function tw(n,e){e.currentNode=n;const{nodeTransforms:o}=e,u=[];for(let y=0;y<o.length;y++){const v=o[y](n,e);if(v&&(Xi(v)?u.push(...v):u.push(v)),e.currentNode)n=e.currentNode;else return}switch(n.type){case 3:e.ssr||e.helper(Z0);break;case 5:e.ssr||e.helper(Qb);break;case 9:for(let y=0;y<n.branches.length;y++)tw(n.branches[y],e);break;case 10:case 11:case 1:case 0:LW(n,e);break}e.currentNode=n;let d=u.length;for(;d--;)u[d]()}function K5(n,e){const o=Gr(n)?u=>u===n:u=>n.test(u);return(u,d)=>{if(u.type===1){const{props:y}=u;if(u.tagType===3&&y.some(dW))return;const v=[];for(let r=0;r<y.length;r++){const D=y[r];if(D.type===7&&o(D.name)){y.splice(r,1),r--;const B=e(u,D,d);B&&v.push(B)}}return v}}}const iw="/*@__PURE__*/",J5=n=>`${E_[n]}: _${E_[n]}`;function kW(n,{mode:e="function",prefixIdentifiers:o=e==="module",sourceMap:u=!1,filename:d="template.vue.html",scopeId:y=null,optimizeImports:v=!1,runtimeGlobalName:r="Vue",runtimeModuleName:D="vue",ssrRuntimeModuleName:B="vue/server-renderer",ssr:F=!1,isTS:N=!1,inSSR:Q=!1}){const q={mode:e,prefixIdentifiers:o,sourceMap:u,filename:d,scopeId:y,optimizeImports:v,runtimeGlobalName:r,runtimeModuleName:D,ssrRuntimeModuleName:B,ssr:F,isTS:N,inSSR:Q,source:n.source,code:"",column:1,line:1,offset:0,indentLevel:0,pure:!1,map:void 0,helper(G){return`_${E_[G]}`},push(G,ae=-2,xe){q.code+=G},indent(){X(++q.indentLevel)},deindent(G=!1){G?--q.indentLevel:X(--q.indentLevel)},newline(){X(q.indentLevel)}};function X(G){q.push(`
`+"  ".repeat(G),0)}return q}function zW(n,e={}){const o=kW(n,e);e.onContextCreated&&e.onContextCreated(o);const{mode:u,push:d,prefixIdentifiers:y,indent:v,deindent:r,newline:D,scopeId:B,ssr:F}=o,N=Array.from(n.helpers),Q=N.length>0,q=!y&&u!=="module";FW(n,o);const G=F?"ssrRender":"render",xe=(F?["_ctx","_push","_parent","_attrs"]:["_ctx","_cache"]).join(", ");if(d(`function ${G}(${xe}) {`),v(),q&&(d("with (_ctx) {"),v(),Q&&(d(`const { ${N.map(J5).join(", ")} } = _Vue
`,-1),D())),n.components.length&&(IT(n.components,"component",o),(n.directives.length||n.temps>0)&&D()),n.directives.length&&(IT(n.directives,"directive",o),n.temps>0&&D()),n.filters&&n.filters.length&&(D(),IT(n.filters,"filter",o),D()),n.temps>0){d("let ");for(let Te=0;Te<n.temps;Te++)d(`${Te>0?", ":""}_temp${Te}`)}return(n.components.length||n.directives.length||n.temps)&&(d(`
`,0),D()),F||d("return "),n.codegenNode?ia(n.codegenNode,o):d("null"),q&&(r(),d("}")),r(),d("}"),{ast:n,code:o.code,preamble:"",map:o.map?o.map.toJSON():void 0}}function FW(n,e){const{ssr:o,prefixIdentifiers:u,push:d,newline:y,runtimeModuleName:v,runtimeGlobalName:r,ssrRuntimeModuleName:D}=e,B=r,F=Array.from(n.helpers);if(F.length>0&&(d(`const _Vue = ${B}
`,-1),n.hoists.length)){const N=[dA,fA,Z0,pA,L5].filter(Q=>F.includes(Q)).map(J5).join(", ");d(`const { ${N} } = _Vue
`,-1)}BW(n.hoists,e),y(),d("return ")}function IT(n,e,{helper:o,push:u,newline:d,isTS:y}){const v=o(e==="filter"?yA:e==="component"?mA:gA);for(let r=0;r<n.length;r++){let D=n[r];const B=D.endsWith("__self");B&&(D=D.slice(0,-6)),u(`const ${D0(D,e)} = ${v}(${JSON.stringify(D)}${B?", true":""})${y?"!":""}`),r<n.length-1&&d()}}function BW(n,e){if(!n.length)return;e.pure=!0;const{push:o,newline:u}=e;u();for(let d=0;d<n.length;d++){const y=n[d];y&&(o(`const _hoisted_${d+1} = `),ia(y,e),u())}e.pure=!1}function PA(n,e){const o=n.length>3||!1;e.push("["),o&&e.indent(),X0(n,e,o),o&&e.deindent(),e.push("]")}function X0(n,e,o=!1,u=!0){const{push:d,newline:y}=e;for(let v=0;v<n.length;v++){const r=n[v];Gr(r)?d(r,-3):Xi(r)?PA(r,e):ia(r,e),v<n.length-1&&(o?(u&&d(","),y()):u&&d(", "))}}function ia(n,e){if(Gr(n)){e.push(n,-3);return}if(Za(n)){e.push(e.helper(n));return}switch(n.type){case 1:case 9:case 11:ia(n.codegenNode,e);break;case 2:NW(n,e);break;case 4:Q5(n,e);break;case 5:VW(n,e);break;case 12:ia(n.codegenNode,e);break;case 8:ez(n,e);break;case 3:jW(n,e);break;case 13:$W(n,e);break;case 14:HW(n,e);break;case 15:GW(n,e);break;case 17:WW(n,e);break;case 18:ZW(n,e);break;case 19:YW(n,e);break;case 20:XW(n,e);break;case 21:X0(n.body,e,!0,!1);break}}function NW(n,e){e.push(JSON.stringify(n.content),-3,n)}function Q5(n,e){const{content:o,isStatic:u}=n;e.push(u?JSON.stringify(o):o,-3,n)}function VW(n,e){const{push:o,helper:u,pure:d}=e;d&&o(iw),o(`${u(Qb)}(`),ia(n.content,e),o(")")}function ez(n,e){for(let o=0;o<n.children.length;o++){const u=n.children[o];Gr(u)?e.push(u,-3):ia(u,e)}}function UW(n,e){const{push:o}=e;if(n.type===8)o("["),ez(n,e),o("]");else if(n.isStatic){const u=MA(n.content)?n.content:JSON.stringify(n.content);o(u,-2,n)}else o(`[${n.content}]`,-3,n)}function jW(n,e){const{push:o,helper:u,pure:d}=e;d&&o(iw),o(`${u(Z0)}(${JSON.stringify(n.content)})`,-3,n)}function $W(n,e){const{push:o,helper:u,pure:d}=e,{tag:y,props:v,children:r,patchFlag:D,dynamicProps:B,directives:F,isBlock:N,disableTracking:Q,isComponent:q}=n;let X;D&&(X=String(D)),F&&o(u(vA)+"("),N&&o(`(${u(_p)}(${Q?"true":""}), `),d&&o(iw);const G=N?C_(e.inSSR,q):A_(e.inSSR,q);o(u(G)+"(",-2,n),X0(qW([y,v,r,X,B]),e),o(")"),N&&o(")"),F&&(o(", "),ia(F,e),o(")"))}function qW(n){let e=n.length;for(;e--&&n[e]==null;);return n.slice(0,e+1).map(o=>o||"null")}function HW(n,e){const{push:o,helper:u,pure:d}=e,y=Gr(n.callee)?n.callee:u(n.callee);d&&o(iw),o(y+"(",-2,n),X0(n.arguments,e),o(")")}function GW(n,e){const{push:o,indent:u,deindent:d,newline:y}=e,{properties:v}=n;if(!v.length){o("{}",-2,n);return}const r=v.length>1||!1;o(r?"{":"{ "),r&&u();for(let D=0;D<v.length;D++){const{key:B,value:F}=v[D];UW(B,e),o(": "),ia(F,e),D<v.length-1&&(o(","),y())}r&&d(),o(r?"}":" }")}function WW(n,e){PA(n.elements,e)}function ZW(n,e){const{push:o,indent:u,deindent:d}=e,{params:y,returns:v,body:r,newline:D,isSlot:B}=n;B&&o(`_${E_[EA]}(`),o("(",-2,n),Xi(y)?X0(y,e):y&&ia(y,e),o(") => "),(D||r)&&(o("{"),u()),v?(D&&o("return "),Xi(v)?PA(v,e):ia(v,e)):r&&ia(r,e),(D||r)&&(d(),o("}")),B&&(n.isNonScopedSlot&&o(", undefined, true"),o(")"))}function YW(n,e){const{test:o,consequent:u,alternate:d,newline:y}=n,{push:v,indent:r,deindent:D,newline:B}=e;if(o.type===4){const N=!MA(o.content);N&&v("("),Q5(o,e),N&&v(")")}else v("("),ia(o,e),v(")");y&&r(),e.indentLevel++,y||v(" "),v("? "),ia(u,e),e.indentLevel--,y&&B(),y||v(" "),v(": ");const F=d.type===19;F||e.indentLevel++,ia(d,e),F||e.indentLevel--,y&&D(!0)}function XW(n,e){const{push:o,helper:u,indent:d,deindent:y,newline:v}=e,{needPauseTracking:r,needArraySpread:D}=n;D&&o("[...("),o(`_cache[${n.index}] || (`),r&&(d(),o(`${u(ib)}(-1`),n.inVOnce&&o(", true"),o("),"),v(),o("(")),o(`_cache[${n.index}] = `),ia(n.value,e),r&&(o(`).cacheIndex = ${n.index},`),v(),o(`${u(ib)}(1),`),v(),o(`_cache[${n.index}]`),y()),o(")"),D&&o(")]")}new RegExp("\\b"+"arguments,await,break,case,catch,class,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,let,new,return,super,switch,throw,try,var,void,while,with,yield".split(",").join("\\b|\\b")+"\\b");const KW=K5(/^(if|else|else-if)$/,(n,e,o)=>JW(n,e,o,(u,d,y)=>{const v=o.parent.children;let r=v.indexOf(u),D=0;for(;r-->=0;){const B=v[r];B&&B.type===9&&(D+=B.branches.length)}return()=>{if(y)u.codegenNode=yR(d,D,o);else{const B=QW(u.codegenNode);B.alternate=yR(d,D+u.branches.length-1,o)}}}));function JW(n,e,o,u){if(e.name!=="else"&&(!e.exp||!e.exp.content.trim())){const d=e.exp?e.exp.loc:n.loc;o.onError(Is(28,e.loc)),e.exp=Qr("true",!1,d)}if(e.name==="if"){const d=gR(n,e),y={type:9,loc:SW(n.loc),branches:[d]};if(o.replaceNode(y),u)return u(y,d,!0)}else{const d=o.parent.children;let y=d.indexOf(n);for(;y-->=-1;){const v=d[y];if(v&&v.type===3){o.removeNode(v);continue}if(v&&v.type===2&&!v.content.trim().length){o.removeNode(v);continue}if(v&&v.type===9){e.name==="else-if"&&v.branches[v.branches.length-1].condition===void 0&&o.onError(Is(30,n.loc)),o.removeNode();const r=gR(n,e);v.branches.push(r);const D=u&&u(v,r,!1);tw(r,o),D&&D(),o.currentNode=null}else o.onError(Is(30,n.loc));break}}}function gR(n,e){const o=n.tagType===3;return{type:10,loc:n.loc,condition:e.name==="else"?void 0:e.exp,children:o&&!Gl(n,"for")?n.children:[n],userKey:ew(n,"key"),isTemplateIf:o}}function yR(n,e,o){return n.condition?kE(n.condition,vR(n,e,o),xo(o.helper(Z0),['""',"true"])):vR(n,e,o)}function vR(n,e,o){const{helper:u}=o,d=eo("key",Qr(`${e}`,!1,Cl,2)),{children:y}=n,v=y[0];if(y.length!==1||v.type!==1)if(y.length===1&&v.type===11){const D=v.codegenNode;return ob(D,d,o),D}else{let D=64;return P0(o,u(M0),Kl([d]),y,D,void 0,void 0,!0,!1,!1,n.loc)}else{const D=v.codegenNode,B=pW(D);return B.type===13&&AA(B,o),ob(B,d,o),D}}function QW(n){for(;;)if(n.type===19)if(n.alternate.type===19)n=n.alternate;else return n;else n.type===20&&(n=n.value)}const eZ=(n,e,o)=>{const{modifiers:u,loc:d}=n,y=n.arg;let{exp:v}=n;if(v&&v.type===4&&!v.content.trim()&&(v=void 0),!v){if(y.type!==4||!y.isStatic)return o.onError(Is(52,y.loc)),{props:[eo(y,Qr("",!0,d))]};tz(n),v=n.exp}return y.type!==4?(y.children.unshift("("),y.children.push(') || ""')):y.isStatic||(y.content=`${y.content} || ""`),u.some(r=>r.content==="camel")&&(y.type===4?y.isStatic?y.content=ws(y.content):y.content=`${o.helperString(OE)}(${y.content})`:(y.children.unshift(`${o.helperString(OE)}(`),y.children.push(")"))),o.inSSR||(u.some(r=>r.content==="prop")&&xR(y,"."),u.some(r=>r.content==="attr")&&xR(y,"^")),{props:[eo(y,v)]}},tz=(n,e)=>{const o=n.arg,u=ws(o.content);n.exp=Qr(u,!1,o.loc)},xR=(n,e)=>{n.type===4?n.isStatic?n.content=e+n.content:n.content=`\`${e}\${${n.content}}\``:(n.children.unshift(`'${e}' + (`),n.children.push(")"))},tZ=K5("for",(n,e,o)=>{const{helper:u,removeHelper:d}=o;return iZ(n,e,o,y=>{const v=xo(u(xA),[y.source]),r=nb(n),D=Gl(n,"memo"),B=ew(n,"key",!1,!0);B&&B.type===7&&!B.exp&&tz(B);let N=B&&(B.type===6?B.value?Qr(B.value.content,!0):void 0:B.exp);const Q=B&&N?eo("key",N):null,q=y.source.type===4&&y.source.constType>0,X=q?64:B?128:256;return y.codegenNode=P0(o,u(M0),void 0,v,X,void 0,void 0,!0,!q,!1,n.loc),()=>{let G;const{children:ae}=y,xe=ae.length!==1||ae[0].type!==1,Te=sb(n)?n:r&&n.children.length===1&&sb(n.children[0])?n.children[0]:null;if(Te?(G=Te.codegenNode,r&&Q&&ob(G,Q,o)):xe?G=P0(o,u(M0),Q?Kl([Q]):void 0,n.children,64,void 0,void 0,!0,void 0,!1):(G=ae[0].codegenNode,r&&Q&&ob(G,Q,o),G.isBlock!==!q&&(G.isBlock?(d(_p),d(C_(o.inSSR,G.isComponent))):d(A_(o.inSSR,G.isComponent))),G.isBlock=!q,G.isBlock?(u(_p),u(C_(o.inSSR,G.isComponent))):u(A_(o.inSSR,G.isComponent))),D){const fe=S_(BE(y.parseResult,[Qr("_cached")]));fe.body=tW([Mc(["const _memo = (",D.exp,")"]),Mc(["if (_cached",...N?[" && _cached.key === ",N]:[],` && ${o.helperString(F5)}(_cached, _memo)) return _cached`]),Mc(["const _item = ",G]),Qr("_item.memo = _memo"),Qr("return _item")]),v.arguments.push(fe,Qr("_cache"),Qr(String(o.cached.length))),o.cached.push(null)}else v.arguments.push(S_(BE(y.parseResult),G,!0))}})});function iZ(n,e,o,u){if(!e.exp){o.onError(Is(31,e.loc));return}const d=e.forParseResult;if(!d){o.onError(Is(32,e.loc));return}iz(d);const{addIdentifiers:y,removeIdentifiers:v,scopes:r}=o,{source:D,value:B,key:F,index:N}=d,Q={type:11,loc:e.loc,source:D,valueAlias:B,keyAlias:F,objectIndexAlias:N,parseResult:d,children:nb(n)?n.children:[n]};o.replaceNode(Q),r.vFor++;const q=u&&u(Q);return()=>{r.vFor--,q&&q()}}function iz(n,e){n.finalized||(n.finalized=!0)}function BE({value:n,key:e,index:o},u=[]){return rZ([n,e,o,...u])}function rZ(n){let e=n.length;for(;e--&&!n[e];);return n.slice(0,e+1).map((o,u)=>o||Qr("_".repeat(u+1),!1))}const bR=Qr("undefined",!1),nZ=(n,e)=>{if(n.type===1&&(n.tagType===1||n.tagType===3)){const o=Gl(n,"slot");if(o)return o.exp,e.scopes.vSlot++,()=>{e.scopes.vSlot--}}},sZ=(n,e,o,u)=>S_(n,o,!1,!0,o.length?o[0].loc:u);function oZ(n,e,o=sZ){e.helper(EA);const{children:u,loc:d}=n,y=[],v=[];let r=e.scopes.vSlot>0||e.scopes.vFor>0;const D=Gl(n,"slot",!0);if(D){const{arg:ae,exp:xe}=D;ae&&!ja(ae)&&(r=!0),y.push(eo(ae||Qr("default",!0),o(xe,void 0,u,d)))}let B=!1,F=!1;const N=[],Q=new Set;let q=0;for(let ae=0;ae<u.length;ae++){const xe=u[ae];let Te;if(!nb(xe)||!(Te=Gl(xe,"slot",!0))){xe.type!==3&&N.push(xe);continue}if(D){e.onError(Is(37,Te.loc));break}B=!0;const{children:fe,loc:ne}=xe,{arg:ue=Qr("default",!0),exp:ye,loc:le}=Te;let re;ja(ue)?re=ue?ue.content:"default":r=!0;const oe=Gl(xe,"for"),se=o(ye,oe,fe,ne);let Ae,De;if(Ae=Gl(xe,"if"))r=!0,v.push(kE(Ae.exp,Bv(ue,se,q++),bR));else if(De=Gl(xe,/^else(-if)?$/,!0)){let Ge=ae,yt;for(;Ge--&&(yt=u[Ge],yt.type===3););if(yt&&nb(yt)&&Gl(yt,/^(else-)?if$/)){let ct=v[v.length-1];for(;ct.alternate.type===19;)ct=ct.alternate;ct.alternate=De.exp?kE(De.exp,Bv(ue,se,q++),bR):Bv(ue,se,q++)}else e.onError(Is(30,De.loc))}else if(oe){r=!0;const Ge=oe.forParseResult;Ge?(iz(Ge),v.push(xo(e.helper(xA),[Ge.source,S_(BE(Ge),Bv(ue,se),!0)]))):e.onError(Is(32,oe.loc))}else{if(re){if(Q.has(re)){e.onError(Is(38,le));continue}Q.add(re),re==="default"&&(F=!0)}y.push(eo(ue,se))}}if(!D){const ae=(xe,Te)=>{const fe=o(xe,void 0,Te,d);return e.compatConfig&&(fe.isNonScopedSlot=!0),eo("default",fe)};B?N.length&&N.some(xe=>rz(xe))&&(F?e.onError(Is(39,N[0].loc)):y.push(ae(void 0,N))):y.push(ae(void 0,u))}const X=r?2:_x(n.children)?3:1;let G=Kl(y.concat(eo("_",Qr(X+"",!1))),d);return v.length&&(G=xo(e.helper(z5),[G,np(v)])),{slots:G,hasDynamicSlots:r}}function Bv(n,e,o){const u=[eo("name",n),eo("fn",e)];return o!=null&&u.push(eo("key",Qr(String(o),!0))),Kl(u)}function _x(n){for(let e=0;e<n.length;e++){const o=n[e];switch(o.type){case 1:if(o.tagType===2||_x(o.children))return!0;break;case 9:if(_x(o.branches))return!0;break;case 10:case 11:if(_x(o.children))return!0;break}}return!1}function rz(n){return n.type!==2&&n.type!==12?!0:n.type===2?!!n.content.trim():rz(n.content)}const nz=new WeakMap,aZ=(n,e)=>function(){if(n=e.currentNode,!(n.type===1&&(n.tagType===0||n.tagType===1)))return;const{tag:u,props:d}=n,y=n.tagType===1;let v=y?lZ(n,e):`"${u}"`;const r=Qn(v)&&v.callee===_A;let D,B,F=0,N,Q,q,X=r||v===Qy||v===hA||!y&&(u==="svg"||u==="foreignObject"||u==="math");if(d.length>0){const G=sz(n,e,void 0,y,r);D=G.props,F=G.patchFlag,Q=G.dynamicPropNames;const ae=G.directives;q=ae&&ae.length?np(ae.map(xe=>uZ(xe,e))):void 0,G.shouldUseBlock&&(X=!0)}if(n.children.length>0)if(v===eb&&(X=!0,F|=1024),y&&v!==Qy&&v!==eb){const{slots:ae,hasDynamicSlots:xe}=oZ(n,e);B=ae,xe&&(F|=1024)}else if(n.children.length===1&&v!==Qy){const ae=n.children[0],xe=ae.type,Te=xe===5||xe===8;Te&&_l(ae,e)===0&&(F|=1),Te||xe===2?B=ae:B=n.children}else B=n.children;Q&&Q.length&&(N=hZ(Q)),n.codegenNode=P0(e,v,D,B,F===0?void 0:F,N,q,!!X,!1,y,n.loc)};function lZ(n,e,o=!1){let{tag:u}=n;const d=NE(u),y=ew(n,"is",!1,!0);if(y)if(d||sp("COMPILER_IS_ON_ELEMENT",e)){let r;if(y.type===6?r=y.value&&Qr(y.value.content,!0):(r=y.exp,r||(r=Qr("is",!1,y.arg.loc))),r)return xo(e.helper(_A),[r])}else y.type===6&&y.value.content.startsWith("vue:")&&(u=y.value.content.slice(4));const v=N5(u)||e.isBuiltInComponent(u);return v?(o||e.helper(v),v):(e.helper(mA),e.components.add(u),D0(u,"component"))}function sz(n,e,o=n.props,u,d,y=!1){const{tag:v,loc:r,children:D}=n;let B=[];const F=[],N=[],Q=D.length>0;let q=!1,X=0,G=!1,ae=!1,xe=!1,Te=!1,fe=!1,ne=!1;const ue=[],ye=se=>{B.length&&(F.push(Kl(wR(B),r)),B=[]),se&&F.push(se)},le=()=>{e.scopes.vFor>0&&B.push(eo(Qr("ref_for",!0),Qr("true")))},re=({key:se,value:Ae})=>{if(ja(se)){const De=se.content,Ge=Tp(De);if(Ge&&(!u||d)&&De.toLowerCase()!=="onclick"&&De!=="onUpdate:modelValue"&&!fd(De)&&(Te=!0),Ge&&fd(De)&&(ne=!0),Ge&&Ae.type===14&&(Ae=Ae.arguments[0]),Ae.type===20||(Ae.type===4||Ae.type===8)&&_l(Ae,e)>0)return;De==="ref"?G=!0:De==="class"?ae=!0:De==="style"?xe=!0:De!=="key"&&!ue.includes(De)&&ue.push(De),u&&(De==="class"||De==="style")&&!ue.includes(De)&&ue.push(De)}else fe=!0};for(let se=0;se<o.length;se++){const Ae=o[se];if(Ae.type===6){const{loc:De,name:Ge,nameLoc:yt,value:ct}=Ae;let mt=!0;if(Ge==="ref"&&(G=!0,le()),Ge==="is"&&(NE(v)||ct&&ct.content.startsWith("vue:")||sp("COMPILER_IS_ON_ELEMENT",e)))continue;B.push(eo(Qr(Ge,!0,yt),Qr(ct?ct.content:"",mt,ct?ct.loc:De)))}else{const{name:De,arg:Ge,exp:yt,loc:ct,modifiers:mt}=Ae,et=De==="bind",Qe=De==="on";if(De==="slot"){u||e.onError(Is(40,ct));continue}if(De==="once"||De==="memo"||De==="is"||et&&Wf(Ge,"is")&&(NE(v)||sp("COMPILER_IS_ON_ELEMENT",e))||Qe&&y)continue;if((et&&Wf(Ge,"key")||Qe&&Q&&Wf(Ge,"vue:before-update"))&&(q=!0),et&&Wf(Ge,"ref")&&le(),!Ge&&(et||Qe)){if(fe=!0,yt)if(et){if(le(),ye(),sp("COMPILER_V_BIND_OBJECT_ORDER",e)){F.unshift(yt);continue}F.push(yt)}else ye({type:14,loc:ct,callee:e.helper(TA),arguments:u?[yt]:[yt,"true"]});else e.onError(Is(et?34:35,ct));continue}et&&mt.some(st=>st.content==="prop")&&(X|=32);const vt=e.directiveTransforms[De];if(vt){const{props:st,needRuntime:Zt}=vt(Ae,n,e);!y&&st.forEach(re),Qe&&Ge&&!ja(Ge)?ye(Kl(st,r)):B.push(...st),Zt&&(N.push(Ae),Za(Zt)&&nz.set(Ae,Zt))}else lq(De)||(N.push(Ae),Q&&(q=!0))}}let oe;if(F.length?(ye(),F.length>1?oe=xo(e.helper(tb),F,r):oe=F[0]):B.length&&(oe=Kl(wR(B),r)),fe?X|=16:(ae&&!u&&(X|=2),xe&&!u&&(X|=4),ue.length&&(X|=8),Te&&(X|=32)),!q&&(X===0||X===32)&&(G||ne||N.length>0)&&(X|=512),!e.inSSR&&oe)switch(oe.type){case 15:let se=-1,Ae=-1,De=!1;for(let ct=0;ct<oe.properties.length;ct++){const mt=oe.properties[ct].key;ja(mt)?mt.content==="class"?se=ct:mt.content==="style"&&(Ae=ct):mt.isHandlerKey||(De=!0)}const Ge=oe.properties[se],yt=oe.properties[Ae];De?oe=xo(e.helper(I0),[oe]):(Ge&&!ja(Ge.value)&&(Ge.value=xo(e.helper(bA),[Ge.value])),yt&&(xe||yt.value.type===4&&yt.value.content.trim()[0]==="["||yt.value.type===17)&&(yt.value=xo(e.helper(wA),[yt.value])));break;case 14:break;default:oe=xo(e.helper(I0),[xo(e.helper(Y0),[oe])]);break}return{props:oe,directives:N,patchFlag:X,dynamicPropNames:ue,shouldUseBlock:q}}function wR(n){const e=new Map,o=[];for(let u=0;u<n.length;u++){const d=n[u];if(d.key.type===8||!d.key.isStatic){o.push(d);continue}const y=d.key.content,v=e.get(y);v?(y==="style"||y==="class"||Tp(y))&&cZ(v,d):(e.set(y,d),o.push(d))}return o}function cZ(n,e){n.value.type===17?n.value.elements.push(e.value):n.value=np([n.value,e.value],n.loc)}function uZ(n,e){const o=[],u=nz.get(n);u?o.push(e.helperString(u)):(e.helper(gA),e.directives.add(n.name),o.push(D0(n.name,"directive")));const{loc:d}=n;if(n.exp&&o.push(n.exp),n.arg&&(n.exp||o.push("void 0"),o.push(n.arg)),Object.keys(n.modifiers).length){n.arg||(n.exp||o.push("void 0"),o.push("void 0"));const y=Qr("true",!1,d);o.push(Kl(n.modifiers.map(v=>eo(v,y)),d))}return np(o,n.loc)}function hZ(n){let e="[";for(let o=0,u=n.length;o<u;o++)e+=JSON.stringify(n[o]),o<u-1&&(e+=", ");return e+"]"}function NE(n){return n==="component"||n==="Component"}const dZ=(n,e)=>{if(sb(n)){const{children:o,loc:u}=n,{slotName:d,slotProps:y}=fZ(n,e),v=[e.prefixIdentifiers?"_ctx.$slots":"$slots",d,"{}","undefined","true"];let r=2;y&&(v[2]=y,r=3),o.length&&(v[3]=S_([],o,!1,!1,u),r=4),e.scopeId&&!e.slotted&&(r=5),v.splice(r),n.codegenNode=xo(e.helper(k5),v,u)}};function fZ(n,e){let o='"default"',u;const d=[];for(let y=0;y<n.props.length;y++){const v=n.props[y];if(v.type===6)v.value&&(v.name==="name"?o=JSON.stringify(v.value.content):(v.name=ws(v.name),d.push(v)));else if(v.name==="bind"&&Wf(v.arg,"name")){if(v.exp)o=v.exp;else if(v.arg&&v.arg.type===4){const r=ws(v.arg.content);o=v.exp=Qr(r,!1,v.arg.loc)}}else v.name==="bind"&&v.arg&&ja(v.arg)&&(v.arg.content=ws(v.arg.content)),d.push(v)}if(d.length>0){const{props:y,directives:v}=sz(n,e,d,!1,!1);u=y,v.length&&e.onError(Is(36,v[0].loc))}return{slotName:o,slotProps:u}}const oz=(n,e,o,u)=>{const{loc:d,modifiers:y,arg:v}=n;!n.exp&&!y.length&&o.onError(Is(35,d));let r;if(v.type===4)if(v.isStatic){let N=v.content;N.startsWith("vue:")&&(N=`vnode-${N.slice(4)}`);const Q=e.tagType!==0||N.startsWith("vnode")||!/[A-Z]/.test(N)?Jm(ws(N)):`on:${N}`;r=Qr(Q,!0,v.loc)}else r=Mc([`${o.helperString(LE)}(`,v,")"]);else r=v,r.children.unshift(`${o.helperString(LE)}(`),r.children.push(")");let D=n.exp;D&&!D.content.trim()&&(D=void 0);let B=o.cacheHandlers&&!D&&!o.inVOnce;if(D){const N=U5(D),Q=!(N||uW(D)),q=D.content.includes(";");(Q||B&&N)&&(D=Mc([`${Q?"$event":"(...args)"} => ${q?"{":"("}`,D,q?"}":")"]))}let F={props:[eo(r,D||Qr("() => {}",!1,d))]};return u&&(F=u(F)),B&&(F.props[0].value=o.cache(F.props[0].value)),F.props.forEach(N=>N.key.isHandlerKey=!0),F},pZ=(n,e)=>{if(n.type===0||n.type===1||n.type===11||n.type===10)return()=>{const o=n.children;let u,d=!1;for(let y=0;y<o.length;y++){const v=o[y];if(MT(v)){d=!0;for(let r=y+1;r<o.length;r++){const D=o[r];if(MT(D))u||(u=o[y]=Mc([v],v.loc)),u.children.push(" + ",D),o.splice(r,1),r--;else{u=void 0;break}}}}if(!(!d||o.length===1&&(n.type===0||n.type===1&&n.tagType===0&&!n.props.find(y=>y.type===7&&!e.directiveTransforms[y.name])&&n.tag!=="template")))for(let y=0;y<o.length;y++){const v=o[y];if(MT(v)||v.type===8){const r=[];(v.type!==2||v.content!==" ")&&r.push(v),!e.ssr&&_l(v,e)===0&&r.push("1"),o[y]={type:12,content:v,loc:v.loc,codegenNode:xo(e.helper(pA),r)}}}}},TR=new WeakSet,mZ=(n,e)=>{if(n.type===1&&Gl(n,"once",!0))return TR.has(n)||e.inVOnce||e.inSSR?void 0:(TR.add(n),e.inVOnce=!0,e.helper(ib),()=>{e.inVOnce=!1;const o=e.currentNode;o.codegenNode&&(o.codegenNode=e.cache(o.codegenNode,!0,!0))})},az=(n,e,o)=>{const{exp:u,arg:d}=n;if(!u)return o.onError(Is(41,n.loc)),Nv();const y=u.loc.source.trim(),v=u.type===4?u.content:y,r=o.bindingMetadata[y];if(r==="props"||r==="props-aliased")return o.onError(Is(44,u.loc)),Nv();const D=!1;if(!v.trim()||!U5(u)&&!D)return o.onError(Is(42,u.loc)),Nv();const B=d||Qr("modelValue",!0),F=d?ja(d)?`onUpdate:${ws(d.content)}`:Mc(['"onUpdate:" + ',d]):"onUpdate:modelValue";let N;const Q=o.isTS?"($event: any)":"$event";N=Mc([`${Q} => ((`,u,") = $event)"]);const q=[eo(B,n.exp),eo(F,N)];if(n.modifiers.length&&e.tagType===1){const X=n.modifiers.map(ae=>ae.content).map(ae=>(MA(ae)?ae:JSON.stringify(ae))+": true").join(", "),G=d?ja(d)?`${d.content}Modifiers`:Mc([d,' + "Modifiers"']):"modelModifiers";q.push(eo(G,Qr(`{ ${X} }`,!1,n.loc,2)))}return Nv(q)};function Nv(n=[]){return{props:n}}const _Z=/[\w).+\-_$\]]/,gZ=(n,e)=>{sp("COMPILER_FILTERS",e)&&(n.type===5?ab(n.content,e):n.type===1&&n.props.forEach(o=>{o.type===7&&o.name!=="for"&&o.exp&&ab(o.exp,e)}))};function ab(n,e){if(n.type===4)ER(n,e);else for(let o=0;o<n.children.length;o++){const u=n.children[o];typeof u=="object"&&(u.type===4?ER(u,e):u.type===8?ab(n,e):u.type===5&&ab(u.content,e))}}function ER(n,e){const o=n.content;let u=!1,d=!1,y=!1,v=!1,r=0,D=0,B=0,F=0,N,Q,q,X,G=[];for(q=0;q<o.length;q++)if(Q=N,N=o.charCodeAt(q),u)N===39&&Q!==92&&(u=!1);else if(d)N===34&&Q!==92&&(d=!1);else if(y)N===96&&Q!==92&&(y=!1);else if(v)N===47&&Q!==92&&(v=!1);else if(N===124&&o.charCodeAt(q+1)!==124&&o.charCodeAt(q-1)!==124&&!r&&!D&&!B)X===void 0?(F=q+1,X=o.slice(0,q).trim()):ae();else{switch(N){case 34:d=!0;break;case 39:u=!0;break;case 96:y=!0;break;case 40:B++;break;case 41:B--;break;case 91:D++;break;case 93:D--;break;case 123:r++;break;case 125:r--;break}if(N===47){let xe=q-1,Te;for(;xe>=0&&(Te=o.charAt(xe),Te===" ");xe--);(!Te||!_Z.test(Te))&&(v=!0)}}X===void 0?X=o.slice(0,q).trim():F!==0&&ae();function ae(){G.push(o.slice(F,q).trim()),F=q+1}if(G.length){for(q=0;q<G.length;q++)X=yZ(X,G[q],e);n.content=X,n.ast=void 0}}function yZ(n,e,o){o.helper(yA);const u=e.indexOf("(");if(u<0)return o.filters.add(e),`${D0(e,"filter")}(${n})`;{const d=e.slice(0,u),y=e.slice(u+1);return o.filters.add(d),`${D0(d,"filter")}(${n}${y!==")"?","+y:y}`}}const SR=new WeakSet,vZ=(n,e)=>{if(n.type===1){const o=Gl(n,"memo");return!o||SR.has(n)?void 0:(SR.add(n),()=>{const u=n.codegenNode||e.currentNode.codegenNode;u&&u.type===13&&(n.tagType!==1&&AA(u,e),n.codegenNode=xo(e.helper(SA),[o.exp,S_(void 0,u),"_cache",String(e.cached.length)]),e.cached.push(null))})}};function xZ(n){return[[mZ,KW,vZ,tZ,gZ,dZ,aZ,nZ,pZ],{on:oz,bind:eZ,model:az}]}function bZ(n,e={}){const o=e.onError||CA,u=e.mode==="module";e.prefixIdentifiers===!0?o(Is(47)):u&&o(Is(48));const d=!1;e.cacheHandlers&&o(Is(49)),e.scopeId&&!u&&o(Is(50));const y=vn({},e,{prefixIdentifiers:d}),v=Gr(n)?MW(n,y):n,[r,D]=xZ();return DW(v,vn({},y,{nodeTransforms:[...r,...e.nodeTransforms||[]],directiveTransforms:vn({},D,e.directiveTransforms||{})})),zW(v,y)}const wZ=()=>({props:[]});/**
* @vue/compiler-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const lz=Symbol(""),cz=Symbol(""),uz=Symbol(""),hz=Symbol(""),VE=Symbol(""),dz=Symbol(""),fz=Symbol(""),pz=Symbol(""),mz=Symbol(""),_z=Symbol("");J9({[lz]:"vModelRadio",[cz]:"vModelCheckbox",[uz]:"vModelText",[hz]:"vModelSelect",[VE]:"vModelDynamic",[dz]:"withModifiers",[fz]:"withKeys",[pz]:"vShow",[mz]:"Transition",[_z]:"TransitionGroup"});let Dm;function TZ(n,e=!1){return Dm||(Dm=document.createElement("div")),e?(Dm.innerHTML=`<div foo="${n.replace(/"/g,"&quot;")}">`,Dm.children[0].getAttribute("foo")):(Dm.innerHTML=n,Dm.textContent)}const EZ={parseMode:"html",isVoidTag:Sq,isNativeTag:n=>wq(n)||Tq(n)||Eq(n),isPreTag:n=>n==="pre",isIgnoreNewlineTag:n=>n==="pre"||n==="textarea",decodeEntities:TZ,isBuiltInComponent:n=>{if(n==="Transition"||n==="transition")return mz;if(n==="TransitionGroup"||n==="transition-group")return _z},getNamespace(n,e,o){let u=e?e.ns:o;if(e&&u===2)if(e.tag==="annotation-xml"){if(n==="svg")return 1;e.props.some(d=>d.type===6&&d.name==="encoding"&&d.value!=null&&(d.value.content==="text/html"||d.value.content==="application/xhtml+xml"))&&(u=0)}else/^m(?:[ions]|text)$/.test(e.tag)&&n!=="mglyph"&&n!=="malignmark"&&(u=0);else e&&u===1&&(e.tag==="foreignObject"||e.tag==="desc"||e.tag==="title")&&(u=0);if(u===0){if(n==="svg")return 1;if(n==="math")return 2}return u}},SZ=n=>{n.type===1&&n.props.forEach((e,o)=>{e.type===6&&e.name==="style"&&e.value&&(n.props[o]={type:7,name:"bind",arg:Qr("style",!0,e.loc),exp:AZ(e.value.content,e.loc),modifiers:[],loc:e.loc})})},AZ=(n,e)=>{const o=CL(n);return Qr(JSON.stringify(o),!1,e,3)};function gd(n,e){return Is(n,e)}const CZ=(n,e,o)=>{const{exp:u,loc:d}=n;return u||o.onError(gd(53,d)),e.children.length&&(o.onError(gd(54,d)),e.children.length=0),{props:[eo(Qr("innerHTML",!0,d),u||Qr("",!0))]}},MZ=(n,e,o)=>{const{exp:u,loc:d}=n;return u||o.onError(gd(55,d)),e.children.length&&(o.onError(gd(56,d)),e.children.length=0),{props:[eo(Qr("textContent",!0),u?_l(u,o)>0?u:xo(o.helperString(Qb),[u],d):Qr("",!0))]}},IZ=(n,e,o)=>{const u=az(n,e,o);if(!u.props.length||e.tagType===1)return u;n.arg&&o.onError(gd(58,n.arg.loc));const{tag:d}=e,y=o.isCustomElement(d);if(d==="input"||d==="textarea"||d==="select"||y){let v=uz,r=!1;if(d==="input"||y){const D=ew(e,"type");if(D){if(D.type===7)v=VE;else if(D.value)switch(D.value.content){case"radio":v=lz;break;case"checkbox":v=cz;break;case"file":r=!0,o.onError(gd(59,n.loc));break}}else hW(e)&&(v=VE)}else d==="select"&&(v=hz);r||(u.needRuntime=o.helper(v))}else o.onError(gd(57,n.loc));return u.props=u.props.filter(v=>!(v.key.type===4&&v.key.content==="modelValue")),u},PZ=Al("passive,once,capture"),RZ=Al("stop,prevent,self,ctrl,shift,alt,meta,exact,middle"),DZ=Al("left,right"),gz=Al("onkeyup,onkeydown,onkeypress"),OZ=(n,e,o,u)=>{const d=[],y=[],v=[];for(let r=0;r<e.length;r++){const D=e[r].content;D==="native"&&R0("COMPILER_V_ON_NATIVE",o)||PZ(D)?v.push(D):DZ(D)?ja(n)?gz(n.content.toLowerCase())?d.push(D):y.push(D):(d.push(D),y.push(D)):RZ(D)?y.push(D):d.push(D)}return{keyModifiers:d,nonKeyModifiers:y,eventOptionModifiers:v}},AR=(n,e)=>ja(n)&&n.content.toLowerCase()==="onclick"?Qr(e,!0):n.type!==4?Mc(["(",n,`) === "onClick" ? "${e}" : (`,n,")"]):n,LZ=(n,e,o)=>oz(n,e,o,u=>{const{modifiers:d}=n;if(!d.length)return u;let{key:y,value:v}=u.props[0];const{keyModifiers:r,nonKeyModifiers:D,eventOptionModifiers:B}=OZ(y,d,o,n.loc);if(D.includes("right")&&(y=AR(y,"onContextmenu")),D.includes("middle")&&(y=AR(y,"onMouseup")),D.length&&(v=xo(o.helper(dz),[v,JSON.stringify(D)])),r.length&&(!ja(y)||gz(y.content.toLowerCase()))&&(v=xo(o.helper(fz),[v,JSON.stringify(r)])),B.length){const F=B.map(Sp).join("");y=ja(y)?Qr(`${y.content}${F}`,!0):Mc(["(",y,`) + "${F}"`])}return{props:[eo(y,v)]}}),kZ=(n,e,o)=>{const{exp:u,loc:d}=n;return u||o.onError(gd(61,d)),{props:[],needRuntime:o.helper(pz)}},zZ=(n,e)=>{n.type===1&&n.tagType===0&&(n.tag==="script"||n.tag==="style")&&e.removeNode()},FZ=[SZ],BZ={cloak:wZ,html:CZ,text:MZ,model:IZ,on:LZ,show:kZ};function NZ(n,e={}){return bZ(n,vn({},EZ,e,{nodeTransforms:[zZ,...FZ,...e.nodeTransforms||[]],directiveTransforms:vn({},BZ,e.directiveTransforms||{}),transformHoist:null}))}/**
* vue v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const CR=Object.create(null);function VZ(n,e){if(!Gr(n))if(n.nodeType)n=n.innerHTML;else return Io;const o=hq(n,e),u=CR[o];if(u)return u;if(n[0]==="#"){const r=document.querySelector(n);n=r?r.innerHTML:""}const d=vn({hoistStatic:!0,onError:void 0,onWarn:Io},e);!d.isCustomElement&&typeof customElements<"u"&&(d.isCustomElement=r=>!!customElements.get(r));const{code:y}=NZ(n,d),v=new Function("Vue",y)(G9);return v._rc=!0,CR[o]=v}r5(VZ);const Wn=(n,e)=>{const o=n.__vccOpts||n;for(const[u,d]of e)o[u]=d;return o},UZ={data(){return{peliculas_nuevas:[],evento_peliculas:[],peliculas_filtradas:[],diaSeleccionado:"",horarios:["10:00","11:00","12:00","15:00","18:00","20:00"]}},created(){const n=this;bs.get("pelicula_nueva").then(e=>{n.peliculas_nuevas=e.data}).catch(e=>{console.log(e)}),bs.get("evento_pelicula").then(e=>{n.evento_peliculas=e.data}).catch(e=>{console.log(e)})},computed:{eventoDelDia(){return!this.diaSeleccionado||this.evento_peliculas.length===0||!this.evento_peliculas[0].eventos?"":this.evento_peliculas[0].eventos[this.diaSeleccionado.toLowerCase()]||"No hay eventos para este día."},horaActual(){return new Date().getHours()}},methods:{getWeekDays(n){const e=new Date(n),o=new Date(e);o.setDate(e.getDate()-e.getDay()+1);const u=[];for(let d=0;d<7;d++){const y=new Date(o);y.setDate(o.getDate()+d),u.push(y.toLocaleDateString("es-ES",{weekday:"long"}).toUpperCase())}return u},seleccionarDia(n){this.diaSeleccionado=n},esHorarioDisponible(n){const e=parseInt(n.split(":")[0]),o=["domingo","lunes","martes","miércoles","jueves","viernes","sábado"].indexOf(this.diaSeleccionado.toLowerCase()),u=new Date;u.setDate(u.getDate()+(o-u.getDay()));const d=new Date().getHours();return u.toLocaleDateString()===new Date().toLocaleDateString()?e>=d:!0},redirigirATicket(n){this.esHorarioDisponible(n)&&this.$router.push({name:"ticket",params:{hora:n}})}}},jZ={class:"pelicula-contenedor"},$Z={class:"cartelera-dia"},qZ={class:"paginas-nav"},HZ=["onClick"],GZ={key:0,class:"detalle-dia"},WZ={class:"dia-grande"},ZZ={class:"cartelera-fluid"},YZ={class:"film-title"},XZ={id:"hora-film"},KZ=["href"];function JZ(n,e,o,u,d,y){return zt(),Nt("div",jZ,[(zt(!0),Nt(ur,null,_n(d.evento_peliculas,v=>(zt(),Nt("div",{class:"container-fluid",key:v.id},[K("div",$Z,[K("strong",null,oi(v.titulo_evento),1)]),K("ul",qZ,[(zt(!0),Nt(ur,null,_n(y.getWeekDays(v.fecha_inicio),r=>(zt(),Nt("li",{key:r},[K("button",{class:rh(["dia-semana",{activo:r===d.diaSeleccionado}]),onClick:D=>y.seleccionarDia(r)},[K("strong",null,oi(r),1)],10,HZ)]))),128))]),d.diaSeleccionado?(zt(),Nt("div",GZ,[K("h2",WZ,[K("strong",null,oi(d.diaSeleccionado),1)]),K("p",null,oi(y.eventoDelDia),1)])):Jn("",!0),K("div",ZZ,[(zt(!0),Nt(ur,null,_n(v.evento_pelicula_nueva,r=>(zt(),Nt("div",{class:"cartelera-film",key:r.id,style:Ps({background:`linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(${r.image})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[K("div",YZ,oi(r.titulo),1),K("ul",null,[K("li",null,oi(r.duracion+" Min"),1),K("li",null,oi("+"+r.restriccion_edad),1),K("li",null,oi(r.calificacion+"/10"),1)]),K("p",null,oi(r.descripcion),1),K("div",XZ,[(zt(!0),Nt(ur,null,_n(d.horarios,D=>(zt(),Nt("a",{key:D,href:y.esHorarioDisponible(D,v.fecha_inicio)?`ticket/${r.id}/${D}`:"#",class:rh({disabled:!y.esHorarioDisponible(D,v.fecha_inicio)})},oi(D),11,KZ))),128))])],4))),128))])]))),128))])}const QZ=Wn(UZ,[["render",JZ]]),eY="/build/assets/pulp-e46ef312.mp4";function MR(n,e){for(var o=0;o<e.length;o++){var u=e[o];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(n,u.key,u)}}function tY(n,e,o){return e&&MR(n.prototype,e),o&&MR(n,o),n}/*!
 * Observer 3.12.7
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var ko,gx,pl,cd,ud,i_,yz,Uf,e0,vz,Yu,Ec,xz,bz=function(){return ko||typeof window<"u"&&(ko=window.gsap)&&ko.registerPlugin&&ko},wz=1,Gm=[],un=[],uu=[],t0=Date.now,UE=function(e,o){return o},iY=function(){var e=e0.core,o=e.bridge||{},u=e._scrollers,d=e._proxies;u.push.apply(u,un),d.push.apply(d,uu),un=u,uu=d,UE=function(v,r){return o[v](r)}},yd=function(e,o){return~uu.indexOf(e)&&uu[uu.indexOf(e)+1][o]},i0=function(e){return!!~vz.indexOf(e)},ga=function(e,o,u,d,y){return e.addEventListener(o,u,{passive:d!==!1,capture:!!y})},ma=function(e,o,u,d){return e.removeEventListener(o,u,!!d)},Vv="scrollLeft",Uv="scrollTop",jE=function(){return Yu&&Yu.isPressed||un.cache++},lb=function(e,o){var u=function d(y){if(y||y===0){wz&&(pl.history.scrollRestoration="manual");var v=Yu&&Yu.isPressed;y=d.v=Math.round(y)||(Yu&&Yu.iOS?1:0),e(y),d.cacheID=un.cache,v&&UE("ss",y)}else(o||un.cache!==d.cacheID||UE("ref"))&&(d.cacheID=un.cache,d.v=e());return d.v+d.offset};return u.offset=0,e&&u},Sa={s:Vv,p:"left",p2:"Left",os:"right",os2:"Right",d:"width",d2:"Width",a:"x",sc:lb(function(n){return arguments.length?pl.scrollTo(n,vo.sc()):pl.pageXOffset||cd[Vv]||ud[Vv]||i_[Vv]||0})},vo={s:Uv,p:"top",p2:"Top",os:"bottom",os2:"Bottom",d:"height",d2:"Height",a:"y",op:Sa,sc:lb(function(n){return arguments.length?pl.scrollTo(Sa.sc(),n):pl.pageYOffset||cd[Uv]||ud[Uv]||i_[Uv]||0})},Fa=function(e,o){return(o&&o._ctx&&o._ctx.selector||ko.utils.toArray)(e)[0]||(typeof e=="string"&&ko.config().nullTargetWarn!==!1?console.warn("Element not found:",e):null)},Cd=function(e,o){var u=o.s,d=o.sc;i0(e)&&(e=cd.scrollingElement||ud);var y=un.indexOf(e),v=d===vo.sc?1:2;!~y&&(y=un.push(e)-1),un[y+v]||ga(e,"scroll",jE);var r=un[y+v],D=r||(un[y+v]=lb(yd(e,u),!0)||(i0(e)?d:lb(function(B){return arguments.length?e[u]=B:e[u]})));return D.target=e,r||(D.smooth=ko.getProperty(e,"scrollBehavior")==="smooth"),D},$E=function(e,o,u){var d=e,y=e,v=t0(),r=v,D=o||50,B=Math.max(500,D*3),F=function(X,G){var ae=t0();G||ae-v>D?(y=d,d=X,r=v,v=ae):u?d+=X:d=y+(X-y)/(ae-r)*(v-r)},N=function(){y=d=u?0:d,r=v=0},Q=function(X){var G=r,ae=y,xe=t0();return(X||X===0)&&X!==d&&F(X),v===r||xe-r>B?0:(d+(u?ae:-ae))/((u?xe:v)-G)*1e3};return{update:F,reset:N,getVelocity:Q}},Cy=function(e,o){return o&&!e._gsapAllow&&e.preventDefault(),e.changedTouches?e.changedTouches[0]:e},IR=function(e){var o=Math.max.apply(Math,e),u=Math.min.apply(Math,e);return Math.abs(o)>=Math.abs(u)?o:u},Tz=function(){e0=ko.core.globals().ScrollTrigger,e0&&e0.core&&iY()},Ez=function(e){return ko=e||bz(),!gx&&ko&&typeof document<"u"&&document.body&&(pl=window,cd=document,ud=cd.documentElement,i_=cd.body,vz=[pl,cd,ud,i_],ko.utils.clamp,xz=ko.core.context||function(){},Uf="onpointerenter"in i_?"pointer":"mouse",yz=to.isTouch=pl.matchMedia&&pl.matchMedia("(hover: none), (pointer: coarse)").matches?1:"ontouchstart"in pl||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?2:0,Ec=to.eventTypes=("ontouchstart"in ud?"touchstart,touchmove,touchcancel,touchend":"onpointerdown"in ud?"pointerdown,pointermove,pointercancel,pointerup":"mousedown,mousemove,mouseup,mouseup").split(","),setTimeout(function(){return wz=0},500),Tz(),gx=1),gx};Sa.op=vo;un.cache=0;var to=function(){function n(o){this.init(o)}var e=n.prototype;return e.init=function(u){gx||Ez(ko)||console.warn("Please gsap.registerPlugin(Observer)"),e0||Tz();var d=u.tolerance,y=u.dragMinimum,v=u.type,r=u.target,D=u.lineHeight,B=u.debounce,F=u.preventDefault,N=u.onStop,Q=u.onStopDelay,q=u.ignore,X=u.wheelSpeed,G=u.event,ae=u.onDragStart,xe=u.onDragEnd,Te=u.onDrag,fe=u.onPress,ne=u.onRelease,ue=u.onRight,ye=u.onLeft,le=u.onUp,re=u.onDown,oe=u.onChangeX,se=u.onChangeY,Ae=u.onChange,De=u.onToggleX,Ge=u.onToggleY,yt=u.onHover,ct=u.onHoverEnd,mt=u.onMove,et=u.ignoreCheck,Qe=u.isNormalizer,vt=u.onGestureStart,st=u.onGestureEnd,Zt=u.onWheel,ui=u.onEnable,ni=u.onDisable,Hi=u.onClick,Ci=u.scrollSpeed,Ii=u.capture,Ui=u.allowClicks,xi=u.lockAxis,Yi=u.onLockAxis;this.target=r=Fa(r)||ud,this.vars=u,q&&(q=ko.utils.toArray(q)),d=d||1e-9,y=y||0,X=X||1,Ci=Ci||1,v=v||"wheel,touch,pointer",B=B!==!1,D||(D=parseFloat(pl.getComputedStyle(i_).lineHeight)||22);var H,be,Be,Ee,ve,Ie,Tt,qe=this,Et=0,It=0,$t=u.passive||!F&&u.passive!==!1,Kt=Cd(r,Sa),ti=Cd(r,vo),Li=Kt(),Ut=ti(),yi=~v.indexOf("touch")&&!~v.indexOf("pointer")&&Ec[0]==="pointerdown",zi=i0(r),Ni=r.ownerDocument||cd,Ki=[0,0,0],sr=[0,0,0],Rr=0,Yr=function(){return Rr=t0()},kr=function(or,lr){return(qe.event=or)&&q&&~q.indexOf(or.target)||lr&&yi&&or.pointerType!=="touch"||et&&et(or,lr)},yr=function(){qe._vx.reset(),qe._vy.reset(),be.pause(),N&&N(qe)},nn=function(){var or=qe.deltaX=IR(Ki),lr=qe.deltaY=IR(sr),Pi=Math.abs(or)>=d,br=Math.abs(lr)>=d;Ae&&(Pi||br)&&Ae(qe,or,lr,Ki,sr),Pi&&(ue&&qe.deltaX>0&&ue(qe),ye&&qe.deltaX<0&&ye(qe),oe&&oe(qe),De&&qe.deltaX<0!=Et<0&&De(qe),Et=qe.deltaX,Ki[0]=Ki[1]=Ki[2]=0),br&&(re&&qe.deltaY>0&&re(qe),le&&qe.deltaY<0&&le(qe),se&&se(qe),Ge&&qe.deltaY<0!=It<0&&Ge(qe),It=qe.deltaY,sr[0]=sr[1]=sr[2]=0),(Ee||Be)&&(mt&&mt(qe),Be&&(ae&&Be===1&&ae(qe),Te&&Te(qe),Be=0),Ee=!1),Ie&&!(Ie=!1)&&Yi&&Yi(qe),ve&&(Zt(qe),ve=!1),H=0},Ts=function(or,lr,Pi){Ki[Pi]+=or,sr[Pi]+=lr,qe._vx.update(or),qe._vy.update(lr),B?H||(H=requestAnimationFrame(nn)):nn()},Ar=function(or,lr){xi&&!Tt&&(qe.axis=Tt=Math.abs(or)>Math.abs(lr)?"x":"y",Ie=!0),Tt!=="y"&&(Ki[2]+=or,qe._vx.update(or,!0)),Tt!=="x"&&(sr[2]+=lr,qe._vy.update(lr,!0)),B?H||(H=requestAnimationFrame(nn)):nn()},Ur=function(or){if(!kr(or,1)){or=Cy(or,F);var lr=or.clientX,Pi=or.clientY,br=lr-qe.x,ir=Pi-qe.y,Ji=qe.isDragging;qe.x=lr,qe.y=Pi,(Ji||(br||ir)&&(Math.abs(qe.startX-lr)>=y||Math.abs(qe.startY-Pi)>=y))&&(Be=Ji?2:1,Ji||(qe.isDragging=!0),Ar(br,ir))}},Vi=qe.onPress=function(vr){kr(vr,1)||vr&&vr.button||(qe.axis=Tt=null,be.pause(),qe.isPressed=!0,vr=Cy(vr),Et=It=0,qe.startX=qe.x=vr.clientX,qe.startY=qe.y=vr.clientY,qe._vx.reset(),qe._vy.reset(),ga(Qe?r:Ni,Ec[1],Ur,$t,!0),qe.deltaX=qe.deltaY=0,fe&&fe(qe))},Zi=qe.onRelease=function(vr){if(!kr(vr,1)){ma(Qe?r:Ni,Ec[1],Ur,!0);var or=!isNaN(qe.y-qe.startY),lr=qe.isDragging,Pi=lr&&(Math.abs(qe.x-qe.startX)>3||Math.abs(qe.y-qe.startY)>3),br=Cy(vr);!Pi&&or&&(qe._vx.reset(),qe._vy.reset(),F&&Ui&&ko.delayedCall(.08,function(){if(t0()-Rr>300&&!vr.defaultPrevented){if(vr.target.click)vr.target.click();else if(Ni.createEvent){var ir=Ni.createEvent("MouseEvents");ir.initMouseEvent("click",!0,!0,pl,1,br.screenX,br.screenY,br.clientX,br.clientY,!1,!1,!1,!1,0,null),vr.target.dispatchEvent(ir)}}})),qe.isDragging=qe.isGesturing=qe.isPressed=!1,N&&lr&&!Qe&&be.restart(!0),Be&&nn(),xe&&lr&&xe(qe),ne&&ne(qe,Pi)}},Rn=function(or){return or.touches&&or.touches.length>1&&(qe.isGesturing=!0)&&vt(or,qe.isDragging)},tr=function(){return(qe.isGesturing=!1)||st(qe)},Yn=function(or){if(!kr(or)){var lr=Kt(),Pi=ti();Ts((lr-Li)*Ci,(Pi-Ut)*Ci,1),Li=lr,Ut=Pi,N&&be.restart(!0)}},xn=function(or){if(!kr(or)){or=Cy(or,F),Zt&&(ve=!0);var lr=(or.deltaMode===1?D:or.deltaMode===2?pl.innerHeight:1)*X;Ts(or.deltaX*lr,or.deltaY*lr,0),N&&!Qe&&be.restart(!0)}},$n=function(or){if(!kr(or)){var lr=or.clientX,Pi=or.clientY,br=lr-qe.x,ir=Pi-qe.y;qe.x=lr,qe.y=Pi,Ee=!0,N&&be.restart(!0),(br||ir)&&Ar(br,ir)}},Dn=function(or){qe.event=or,yt(qe)},Hs=function(or){qe.event=or,ct(qe)},Rs=function(or){return kr(or)||Cy(or,F)&&Hi(qe)};be=qe._dc=ko.delayedCall(Q||.25,yr).pause(),qe.deltaX=qe.deltaY=0,qe._vx=$E(0,50,!0),qe._vy=$E(0,50,!0),qe.scrollX=Kt,qe.scrollY=ti,qe.isDragging=qe.isGesturing=qe.isPressed=!1,xz(this),qe.enable=function(vr){return qe.isEnabled||(ga(zi?Ni:r,"scroll",jE),v.indexOf("scroll")>=0&&ga(zi?Ni:r,"scroll",Yn,$t,Ii),v.indexOf("wheel")>=0&&ga(r,"wheel",xn,$t,Ii),(v.indexOf("touch")>=0&&yz||v.indexOf("pointer")>=0)&&(ga(r,Ec[0],Vi,$t,Ii),ga(Ni,Ec[2],Zi),ga(Ni,Ec[3],Zi),Ui&&ga(r,"click",Yr,!0,!0),Hi&&ga(r,"click",Rs),vt&&ga(Ni,"gesturestart",Rn),st&&ga(Ni,"gestureend",tr),yt&&ga(r,Uf+"enter",Dn),ct&&ga(r,Uf+"leave",Hs),mt&&ga(r,Uf+"move",$n)),qe.isEnabled=!0,qe.isDragging=qe.isGesturing=qe.isPressed=Ee=Be=!1,qe._vx.reset(),qe._vy.reset(),Li=Kt(),Ut=ti(),vr&&vr.type&&Vi(vr),ui&&ui(qe)),qe},qe.disable=function(){qe.isEnabled&&(Gm.filter(function(vr){return vr!==qe&&i0(vr.target)}).length||ma(zi?Ni:r,"scroll",jE),qe.isPressed&&(qe._vx.reset(),qe._vy.reset(),ma(Qe?r:Ni,Ec[1],Ur,!0)),ma(zi?Ni:r,"scroll",Yn,Ii),ma(r,"wheel",xn,Ii),ma(r,Ec[0],Vi,Ii),ma(Ni,Ec[2],Zi),ma(Ni,Ec[3],Zi),ma(r,"click",Yr,!0),ma(r,"click",Rs),ma(Ni,"gesturestart",Rn),ma(Ni,"gestureend",tr),ma(r,Uf+"enter",Dn),ma(r,Uf+"leave",Hs),ma(r,Uf+"move",$n),qe.isEnabled=qe.isPressed=qe.isDragging=!1,ni&&ni(qe))},qe.kill=qe.revert=function(){qe.disable();var vr=Gm.indexOf(qe);vr>=0&&Gm.splice(vr,1),Yu===qe&&(Yu=0)},Gm.push(qe),Qe&&i0(r)&&(Yu=qe),qe.enable(G)},tY(n,[{key:"velocityX",get:function(){return this._vx.getVelocity()}},{key:"velocityY",get:function(){return this._vy.getVelocity()}}]),n}();to.version="3.12.7";to.create=function(n){return new to(n)};to.register=Ez;to.getAll=function(){return Gm.slice()};to.getById=function(n){return Gm.filter(function(e){return e.vars.id===n})[0]};bz()&&ko.registerPlugin(to);/*!
 * ScrollTrigger 3.12.7
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var cr,Vm,cn,ps,dl,Gn,RA,cb,L0,r0,Ly,jv,Go,rw,qE,xa,PR,RR,Um,Sz,PT,Az,ya,HE,Cz,Mz,Jh,GE,DA,r_,OA,ub,WE,RT,$v=1,Zo=Date.now,DT=Zo(),ec=0,ky=0,DR=function(e,o,u){var d=ul(e)&&(e.substr(0,6)==="clamp("||e.indexOf("max")>-1);return u["_"+o+"Clamp"]=d,d?e.substr(6,e.length-7):e},OR=function(e,o){return o&&(!ul(e)||e.substr(0,6)!=="clamp(")?"clamp("+e+")":e},rY=function n(){return ky&&requestAnimationFrame(n)},LR=function(){return rw=1},kR=function(){return rw=0},ru=function(e){return e},zy=function(e){return Math.round(e*1e5)/1e5||0},Iz=function(){return typeof window<"u"},Pz=function(){return cr||Iz()&&(cr=window.gsap)&&cr.registerPlugin&&cr},gp=function(e){return!!~RA.indexOf(e)},Rz=function(e){return(e==="Height"?OA:cn["inner"+e])||dl["client"+e]||Gn["client"+e]},Dz=function(e){return yd(e,"getBoundingClientRect")||(gp(e)?function(){return wx.width=cn.innerWidth,wx.height=OA,wx}:function(){return Zu(e)})},nY=function(e,o,u){var d=u.d,y=u.d2,v=u.a;return(v=yd(e,"getBoundingClientRect"))?function(){return v()[d]}:function(){return(o?Rz(y):e["client"+y])||0}},sY=function(e,o){return!o||~uu.indexOf(e)?Dz(e):function(){return wx}},ou=function(e,o){var u=o.s,d=o.d2,y=o.d,v=o.a;return Math.max(0,(u="scroll"+d)&&(v=yd(e,u))?v()-Dz(e)()[y]:gp(e)?(dl[u]||Gn[u])-Rz(d):e[u]-e["offset"+d])},qv=function(e,o){for(var u=0;u<Um.length;u+=3)(!o||~o.indexOf(Um[u+1]))&&e(Um[u],Um[u+1],Um[u+2])},ul=function(e){return typeof e=="string"},Qo=function(e){return typeof e=="function"},Fy=function(e){return typeof e=="number"},jf=function(e){return typeof e=="object"},My=function(e,o,u){return e&&e.progress(o?0:1)&&u&&e.pause()},OT=function(e,o){if(e.enabled){var u=e._ctx?e._ctx.add(function(){return o(e)}):o(e);u&&u.totalTime&&(e.callbackAnimation=u)}},Om=Math.abs,Oz="left",Lz="top",LA="right",kA="bottom",op="width",ap="height",n0="Right",s0="Left",o0="Top",a0="Bottom",no="padding",Wl="margin",M_="Width",zA="Height",go="px",Zl=function(e){return cn.getComputedStyle(e)},oY=function(e){var o=Zl(e).position;e.style.position=o==="absolute"||o==="fixed"?o:"relative"},zR=function(e,o){for(var u in o)u in e||(e[u]=o[u]);return e},Zu=function(e,o){var u=o&&Zl(e)[qE]!=="matrix(1, 0, 0, 1, 0, 0)"&&cr.to(e,{x:0,y:0,xPercent:0,yPercent:0,rotation:0,rotationX:0,rotationY:0,scale:1,skewX:0,skewY:0}).progress(1),d=e.getBoundingClientRect();return u&&u.progress(0).kill(),d},hb=function(e,o){var u=o.d2;return e["offset"+u]||e["client"+u]||0},kz=function(e){var o=[],u=e.labels,d=e.duration(),y;for(y in u)o.push(u[y]/d);return o},aY=function(e){return function(o){return cr.utils.snap(kz(e),o)}},FA=function(e){var o=cr.utils.snap(e),u=Array.isArray(e)&&e.slice(0).sort(function(d,y){return d-y});return u?function(d,y,v){v===void 0&&(v=.001);var r;if(!y)return o(d);if(y>0){for(d-=v,r=0;r<u.length;r++)if(u[r]>=d)return u[r];return u[r-1]}else for(r=u.length,d+=v;r--;)if(u[r]<=d)return u[r];return u[0]}:function(d,y,v){v===void 0&&(v=.001);var r=o(d);return!y||Math.abs(r-d)<v||r-d<0==y<0?r:o(y<0?d-e:d+e)}},lY=function(e){return function(o,u){return FA(kz(e))(o,u.direction)}},Hv=function(e,o,u,d){return u.split(",").forEach(function(y){return e(o,y,d)})},Mo=function(e,o,u,d,y){return e.addEventListener(o,u,{passive:!d,capture:!!y})},Co=function(e,o,u,d){return e.removeEventListener(o,u,!!d)},Gv=function(e,o,u){u=u&&u.wheelHandler,u&&(e(o,"wheel",u),e(o,"touchmove",u))},FR={startColor:"green",endColor:"red",indent:0,fontSize:"16px",fontWeight:"normal"},Wv={toggleActions:"play",anticipatePin:0},db={top:0,left:0,center:.5,bottom:1,right:1},yx=function(e,o){if(ul(e)){var u=e.indexOf("="),d=~u?+(e.charAt(u-1)+1)*parseFloat(e.substr(u+1)):0;~u&&(e.indexOf("%")>u&&(d*=o/100),e=e.substr(0,u-1)),e=d+(e in db?db[e]*o:~e.indexOf("%")?parseFloat(e)*o/100:parseFloat(e)||0)}return e},Zv=function(e,o,u,d,y,v,r,D){var B=y.startColor,F=y.endColor,N=y.fontSize,Q=y.indent,q=y.fontWeight,X=ps.createElement("div"),G=gp(u)||yd(u,"pinType")==="fixed",ae=e.indexOf("scroller")!==-1,xe=G?Gn:u,Te=e.indexOf("start")!==-1,fe=Te?B:F,ne="border-color:"+fe+";font-size:"+N+";color:"+fe+";font-weight:"+q+";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";return ne+="position:"+((ae||D)&&G?"fixed;":"absolute;"),(ae||D||!G)&&(ne+=(d===vo?LA:kA)+":"+(v+parseFloat(Q))+"px;"),r&&(ne+="box-sizing:border-box;text-align:left;width:"+r.offsetWidth+"px;"),X._isStart=Te,X.setAttribute("class","gsap-marker-"+e+(o?" marker-"+o:"")),X.style.cssText=ne,X.innerText=o||o===0?e+"-"+o:e,xe.children[0]?xe.insertBefore(X,xe.children[0]):xe.appendChild(X),X._offset=X["offset"+d.op.d2],vx(X,0,d,Te),X},vx=function(e,o,u,d){var y={display:"block"},v=u[d?"os2":"p2"],r=u[d?"p2":"os2"];e._isFlipped=d,y[u.a+"Percent"]=d?-100:0,y[u.a]=d?"1px":0,y["border"+v+M_]=1,y["border"+r+M_]=0,y[u.p]=o+"px",cr.set(e,y)},an=[],ZE={},k0,BR=function(){return Zo()-ec>34&&(k0||(k0=requestAnimationFrame(Qu)))},Lm=function(){(!ya||!ya.isPressed||ya.startX>Gn.clientWidth)&&(un.cache++,ya?k0||(k0=requestAnimationFrame(Qu)):Qu(),ec||vp("scrollStart"),ec=Zo())},LT=function(){Mz=cn.innerWidth,Cz=cn.innerHeight},By=function(e){un.cache++,(e===!0||!Go&&!Az&&!ps.fullscreenElement&&!ps.webkitFullscreenElement&&(!HE||Mz!==cn.innerWidth||Math.abs(cn.innerHeight-Cz)>cn.innerHeight*.25))&&cb.restart(!0)},yp={},cY=[],zz=function n(){return Co(dn,"scrollEnd",n)||Yf(!0)},vp=function(e){return yp[e]&&yp[e].map(function(o){return o()})||cY},ll=[],Fz=function(e){for(var o=0;o<ll.length;o+=5)(!e||ll[o+4]&&ll[o+4].query===e)&&(ll[o].style.cssText=ll[o+1],ll[o].getBBox&&ll[o].setAttribute("transform",ll[o+2]||""),ll[o+3].uncache=1)},BA=function(e,o){var u;for(xa=0;xa<an.length;xa++)u=an[xa],u&&(!o||u._ctx===o)&&(e?u.kill(1):u.revert(!0,!0));ub=!0,o&&Fz(o),o||vp("revert")},Bz=function(e,o){un.cache++,(o||!ba)&&un.forEach(function(u){return Qo(u)&&u.cacheID++&&(u.rec=0)}),ul(e)&&(cn.history.scrollRestoration=DA=e)},ba,lp=0,NR,uY=function(){if(NR!==lp){var e=NR=lp;requestAnimationFrame(function(){return e===lp&&Yf(!0)})}},Nz=function(){Gn.appendChild(r_),OA=!ya&&r_.offsetHeight||cn.innerHeight,Gn.removeChild(r_)},VR=function(e){return L0(".gsap-marker-start, .gsap-marker-end, .gsap-marker-scroller-start, .gsap-marker-scroller-end").forEach(function(o){return o.style.display=e?"none":"block"})},Yf=function(e,o){if(dl=ps.documentElement,Gn=ps.body,RA=[cn,ps,dl,Gn],ec&&!e&&!ub){Mo(dn,"scrollEnd",zz);return}Nz(),ba=dn.isRefreshing=!0,un.forEach(function(d){return Qo(d)&&++d.cacheID&&(d.rec=d())});var u=vp("refreshInit");Sz&&dn.sort(),o||BA(),un.forEach(function(d){Qo(d)&&(d.smooth&&(d.target.style.scrollBehavior="auto"),d(0))}),an.slice(0).forEach(function(d){return d.refresh()}),ub=!1,an.forEach(function(d){if(d._subPinOffset&&d.pin){var y=d.vars.horizontal?"offsetWidth":"offsetHeight",v=d.pin[y];d.revert(!0,1),d.adjustPinSpacing(d.pin[y]-v),d.refresh()}}),WE=1,VR(!0),an.forEach(function(d){var y=ou(d.scroller,d._dir),v=d.vars.end==="max"||d._endClamp&&d.end>y,r=d._startClamp&&d.start>=y;(v||r)&&d.setPositions(r?y-1:d.start,v?Math.max(r?y:d.start+1,y):d.end,!0)}),VR(!1),WE=0,u.forEach(function(d){return d&&d.render&&d.render(-1)}),un.forEach(function(d){Qo(d)&&(d.smooth&&requestAnimationFrame(function(){return d.target.style.scrollBehavior="smooth"}),d.rec&&d(d.rec))}),Bz(DA,1),cb.pause(),lp++,ba=2,Qu(2),an.forEach(function(d){return Qo(d.vars.onRefresh)&&d.vars.onRefresh(d)}),ba=dn.isRefreshing=!1,vp("refresh")},YE=0,xx=1,l0,Qu=function(e){if(e===2||!ba&&!ub){dn.isUpdating=!0,l0&&l0.update(0);var o=an.length,u=Zo(),d=u-DT>=50,y=o&&an[0].scroll();if(xx=YE>y?-1:1,ba||(YE=y),d&&(ec&&!rw&&u-ec>200&&(ec=0,vp("scrollEnd")),Ly=DT,DT=u),xx<0){for(xa=o;xa-- >0;)an[xa]&&an[xa].update(0,d);xx=1}else for(xa=0;xa<o;xa++)an[xa]&&an[xa].update(0,d);dn.isUpdating=!1}k0=0},XE=[Oz,Lz,kA,LA,Wl+a0,Wl+n0,Wl+o0,Wl+s0,"display","flexShrink","float","zIndex","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","gridArea","justifySelf","alignSelf","placeSelf","order"],bx=XE.concat([op,ap,"boxSizing","max"+M_,"max"+zA,"position",Wl,no,no+o0,no+n0,no+a0,no+s0]),hY=function(e,o,u){n_(u);var d=e._gsap;if(d.spacerIsNative)n_(d.spacerState);else if(e._gsap.swappedIn){var y=o.parentNode;y&&(y.insertBefore(e,o),y.removeChild(o))}e._gsap.swappedIn=!1},kT=function(e,o,u,d){if(!e._gsap.swappedIn){for(var y=XE.length,v=o.style,r=e.style,D;y--;)D=XE[y],v[D]=u[D];v.position=u.position==="absolute"?"absolute":"relative",u.display==="inline"&&(v.display="inline-block"),r[kA]=r[LA]="auto",v.flexBasis=u.flexBasis||"auto",v.overflow="visible",v.boxSizing="border-box",v[op]=hb(e,Sa)+go,v[ap]=hb(e,vo)+go,v[no]=r[Wl]=r[Lz]=r[Oz]="0",n_(d),r[op]=r["max"+M_]=u[op],r[ap]=r["max"+zA]=u[ap],r[no]=u[no],e.parentNode!==o&&(e.parentNode.insertBefore(o,e),o.appendChild(e)),e._gsap.swappedIn=!0}},dY=/([A-Z])/g,n_=function(e){if(e){var o=e.t.style,u=e.length,d=0,y,v;for((e.t._gsap||cr.core.getCache(e.t)).uncache=1;d<u;d+=2)v=e[d+1],y=e[d],v?o[y]=v:o[y]&&o.removeProperty(y.replace(dY,"-$1").toLowerCase())}},Yv=function(e){for(var o=bx.length,u=e.style,d=[],y=0;y<o;y++)d.push(bx[y],u[bx[y]]);return d.t=e,d},fY=function(e,o,u){for(var d=[],y=e.length,v=u?8:0,r;v<y;v+=2)r=e[v],d.push(r,r in o?o[r]:e[v+1]);return d.t=e.t,d},wx={left:0,top:0},UR=function(e,o,u,d,y,v,r,D,B,F,N,Q,q,X){Qo(e)&&(e=e(D)),ul(e)&&e.substr(0,3)==="max"&&(e=Q+(e.charAt(4)==="="?yx("0"+e.substr(3),u):0));var G=q?q.time():0,ae,xe,Te;if(q&&q.seek(0),isNaN(e)||(e=+e),Fy(e))q&&(e=cr.utils.mapRange(q.scrollTrigger.start,q.scrollTrigger.end,0,Q,e)),r&&vx(r,u,d,!0);else{Qo(o)&&(o=o(D));var fe=(e||"0").split(" "),ne,ue,ye,le;Te=Fa(o,D)||Gn,ne=Zu(Te)||{},(!ne||!ne.left&&!ne.top)&&Zl(Te).display==="none"&&(le=Te.style.display,Te.style.display="block",ne=Zu(Te),le?Te.style.display=le:Te.style.removeProperty("display")),ue=yx(fe[0],ne[d.d]),ye=yx(fe[1]||"0",u),e=ne[d.p]-B[d.p]-F+ue+y-ye,r&&vx(r,ye,d,u-ye<20||r._isStart&&ye>20),u-=u-ye}if(X&&(D[X]=e||-.001,e<0&&(e=0)),v){var re=e+u,oe=v._isStart;ae="scroll"+d.d2,vx(v,re,d,oe&&re>20||!oe&&(N?Math.max(Gn[ae],dl[ae]):v.parentNode[ae])<=re+1),N&&(B=Zu(r),N&&(v.style[d.op.p]=B[d.op.p]-d.op.m-v._offset+go))}return q&&Te&&(ae=Zu(Te),q.seek(Q),xe=Zu(Te),q._caScrollDist=ae[d.p]-xe[d.p],e=e/q._caScrollDist*Q),q&&q.seek(G),q?e:Math.round(e)},pY=/(webkit|moz|length|cssText|inset)/i,jR=function(e,o,u,d){if(e.parentNode!==o){var y=e.style,v,r;if(o===Gn){e._stOrig=y.cssText,r=Zl(e);for(v in r)!+v&&!pY.test(v)&&r[v]&&typeof y[v]=="string"&&v!=="0"&&(y[v]=r[v]);y.top=u,y.left=d}else y.cssText=e._stOrig;cr.core.getCache(e).uncache=1,o.appendChild(e)}},Vz=function(e,o,u){var d=o,y=d;return function(v){var r=Math.round(e());return r!==d&&r!==y&&Math.abs(r-d)>3&&Math.abs(r-y)>3&&(v=r,u&&u()),y=d,d=Math.round(v),d}},Xv=function(e,o,u){var d={};d[o.p]="+="+u,cr.set(e,d)},$R=function(e,o){var u=Cd(e,o),d="_scroll"+o.p2,y=function v(r,D,B,F,N){var Q=v.tween,q=D.onComplete,X={};B=B||u();var G=Vz(u,B,function(){Q.kill(),v.tween=0});return N=F&&N||0,F=F||r-B,Q&&Q.kill(),D[d]=r,D.inherit=!1,D.modifiers=X,X[d]=function(){return G(B+F*Q.ratio+N*Q.ratio*Q.ratio)},D.onUpdate=function(){un.cache++,v.tween&&Qu()},D.onComplete=function(){v.tween=0,q&&q.call(Q)},Q=v.tween=cr.to(e,D),Q};return e[d]=u,u.wheelHandler=function(){return y.tween&&y.tween.kill()&&(y.tween=0)},Mo(e,"wheel",u.wheelHandler),dn.isTouch&&Mo(e,"touchmove",u.wheelHandler),y},dn=function(){function n(o,u){Vm||n.register(cr)||console.warn("Please gsap.registerPlugin(ScrollTrigger)"),GE(this),this.init(o,u)}var e=n.prototype;return e.init=function(u,d){if(this.progress=this.start=0,this.vars&&this.kill(!0,!0),!ky){this.update=this.refresh=this.kill=ru;return}u=zR(ul(u)||Fy(u)||u.nodeType?{trigger:u}:u,Wv);var y=u,v=y.onUpdate,r=y.toggleClass,D=y.id,B=y.onToggle,F=y.onRefresh,N=y.scrub,Q=y.trigger,q=y.pin,X=y.pinSpacing,G=y.invalidateOnRefresh,ae=y.anticipatePin,xe=y.onScrubComplete,Te=y.onSnapComplete,fe=y.once,ne=y.snap,ue=y.pinReparent,ye=y.pinSpacer,le=y.containerAnimation,re=y.fastScrollEnd,oe=y.preventOverlaps,se=u.horizontal||u.containerAnimation&&u.horizontal!==!1?Sa:vo,Ae=!N&&N!==0,De=Fa(u.scroller||cn),Ge=cr.core.getCache(De),yt=gp(De),ct=("pinType"in u?u.pinType:yd(De,"pinType")||yt&&"fixed")==="fixed",mt=[u.onEnter,u.onLeave,u.onEnterBack,u.onLeaveBack],et=Ae&&u.toggleActions.split(" "),Qe="markers"in u?u.markers:Wv.markers,vt=yt?0:parseFloat(Zl(De)["border"+se.p2+M_])||0,st=this,Zt=u.onRefreshInit&&function(){return u.onRefreshInit(st)},ui=nY(De,yt,se),ni=sY(De,yt),Hi=0,Ci=0,Ii=0,Ui=Cd(De,se),xi,Yi,H,be,Be,Ee,ve,Ie,Tt,qe,Et,It,$t,Kt,ti,Li,Ut,yi,zi,Ni,Ki,sr,Rr,Yr,kr,yr,nn,Ts,Ar,Ur,Vi,Zi,Rn,tr,Yn,xn,$n,Dn,Hs;if(st._startClamp=st._endClamp=!1,st._dir=se,ae*=45,st.scroller=De,st.scroll=le?le.time.bind(le):Ui,be=Ui(),st.vars=u,d=d||u.animation,"refreshPriority"in u&&(Sz=1,u.refreshPriority===-9999&&(l0=st)),Ge.tweenScroll=Ge.tweenScroll||{top:$R(De,vo),left:$R(De,Sa)},st.tweenTo=xi=Ge.tweenScroll[se.p],st.scrubDuration=function(Pi){Rn=Fy(Pi)&&Pi,Rn?Zi?Zi.duration(Pi):Zi=cr.to(d,{ease:"expo",totalProgress:"+=0",inherit:!1,duration:Rn,paused:!0,onComplete:function(){return xe&&xe(st)}}):(Zi&&Zi.progress(1).kill(),Zi=0)},d&&(d.vars.lazy=!1,d._initted&&!st.isReverted||d.vars.immediateRender!==!1&&u.immediateRender!==!1&&d.duration()&&d.render(0,!0,!0),st.animation=d.pause(),d.scrollTrigger=st,st.scrubDuration(N),Ur=0,D||(D=d.vars.id)),ne&&((!jf(ne)||ne.push)&&(ne={snapTo:ne}),"scrollBehavior"in Gn.style&&cr.set(yt?[Gn,dl]:De,{scrollBehavior:"auto"}),un.forEach(function(Pi){return Qo(Pi)&&Pi.target===(yt?ps.scrollingElement||dl:De)&&(Pi.smooth=!1)}),H=Qo(ne.snapTo)?ne.snapTo:ne.snapTo==="labels"?aY(d):ne.snapTo==="labelsDirectional"?lY(d):ne.directional!==!1?function(Pi,br){return FA(ne.snapTo)(Pi,Zo()-Ci<500?0:br.direction)}:cr.utils.snap(ne.snapTo),tr=ne.duration||{min:.1,max:2},tr=jf(tr)?r0(tr.min,tr.max):r0(tr,tr),Yn=cr.delayedCall(ne.delay||Rn/2||.1,function(){var Pi=Ui(),br=Zo()-Ci<500,ir=xi.tween;if((br||Math.abs(st.getVelocity())<10)&&!ir&&!rw&&Hi!==Pi){var Ji=(Pi-Ee)/Kt,gn=d&&!Ae?d.totalProgress():Ji,ot=br?0:(gn-Vi)/(Zo()-Ly)*1e3||0,ee=cr.utils.clamp(-Ji,1-Ji,Om(ot/2)*ot/.185),de=Ji+(ne.inertia===!1?0:ee),we,ze,Le=ne,Ze=Le.onStart,rt=Le.onInterrupt,We=Le.onComplete;if(we=H(de,st),Fy(we)||(we=de),ze=Math.max(0,Math.round(Ee+we*Kt)),Pi<=ve&&Pi>=Ee&&ze!==Pi){if(ir&&!ir._initted&&ir.data<=Om(ze-Pi))return;ne.inertia===!1&&(ee=we-Ji),xi(ze,{duration:tr(Om(Math.max(Om(de-gn),Om(we-gn))*.185/ot/.05||0)),ease:ne.ease||"power3",data:Om(ze-Pi),onInterrupt:function(){return Yn.restart(!0)&&rt&&rt(st)},onComplete:function(){st.update(),Hi=Ui(),d&&!Ae&&(Zi?Zi.resetTo("totalProgress",we,d._tTime/d._tDur):d.progress(we)),Ur=Vi=d&&!Ae?d.totalProgress():st.progress,Te&&Te(st),We&&We(st)}},Pi,ee*Kt,ze-Pi-ee*Kt),Ze&&Ze(st,xi.tween)}}else st.isActive&&Hi!==Pi&&Yn.restart(!0)}).pause()),D&&(ZE[D]=st),Q=st.trigger=Fa(Q||q!==!0&&q),Hs=Q&&Q._gsap&&Q._gsap.stRevert,Hs&&(Hs=Hs(st)),q=q===!0?Q:Fa(q),ul(r)&&(r={targets:Q,className:r}),q&&(X===!1||X===Wl||(X=!X&&q.parentNode&&q.parentNode.style&&Zl(q.parentNode).display==="flex"?!1:no),st.pin=q,Yi=cr.core.getCache(q),Yi.spacer?ti=Yi.pinState:(ye&&(ye=Fa(ye),ye&&!ye.nodeType&&(ye=ye.current||ye.nativeElement),Yi.spacerIsNative=!!ye,ye&&(Yi.spacerState=Yv(ye))),Yi.spacer=yi=ye||ps.createElement("div"),yi.classList.add("pin-spacer"),D&&yi.classList.add("pin-spacer-"+D),Yi.pinState=ti=Yv(q)),u.force3D!==!1&&cr.set(q,{force3D:!0}),st.spacer=yi=Yi.spacer,Ar=Zl(q),Yr=Ar[X+se.os2],Ni=cr.getProperty(q),Ki=cr.quickSetter(q,se.a,go),kT(q,yi,Ar),Ut=Yv(q)),Qe){It=jf(Qe)?zR(Qe,FR):FR,qe=Zv("scroller-start",D,De,se,It,0),Et=Zv("scroller-end",D,De,se,It,0,qe),zi=qe["offset"+se.op.d2];var Rs=Fa(yd(De,"content")||De);Ie=this.markerStart=Zv("start",D,Rs,se,It,zi,0,le),Tt=this.markerEnd=Zv("end",D,Rs,se,It,zi,0,le),le&&(Dn=cr.quickSetter([Ie,Tt],se.a,go)),!ct&&!(uu.length&&yd(De,"fixedMarkers")===!0)&&(oY(yt?Gn:De),cr.set([qe,Et],{force3D:!0}),yr=cr.quickSetter(qe,se.a,go),Ts=cr.quickSetter(Et,se.a,go))}if(le){var vr=le.vars.onUpdate,or=le.vars.onUpdateParams;le.eventCallback("onUpdate",function(){st.update(0,0,1),vr&&vr.apply(le,or||[])})}if(st.previous=function(){return an[an.indexOf(st)-1]},st.next=function(){return an[an.indexOf(st)+1]},st.revert=function(Pi,br){if(!br)return st.kill(!0);var ir=Pi!==!1||!st.enabled,Ji=Go;ir!==st.isReverted&&(ir&&(xn=Math.max(Ui(),st.scroll.rec||0),Ii=st.progress,$n=d&&d.progress()),Ie&&[Ie,Tt,qe,Et].forEach(function(gn){return gn.style.display=ir?"none":"block"}),ir&&(Go=st,st.update(ir)),q&&(!ue||!st.isActive)&&(ir?hY(q,yi,ti):kT(q,yi,Zl(q),kr)),ir||st.update(ir),Go=Ji,st.isReverted=ir)},st.refresh=function(Pi,br,ir,Ji){if(!((Go||!st.enabled)&&!br)){if(q&&Pi&&ec){Mo(n,"scrollEnd",zz);return}!ba&&Zt&&Zt(st),Go=st,xi.tween&&!ir&&(xi.tween.kill(),xi.tween=0),Zi&&Zi.pause(),G&&d&&d.revert({kill:!1}).invalidate(),st.isReverted||st.revert(!0,!0),st._subPinOffset=!1;var gn=ui(),ot=ni(),ee=le?le.duration():ou(De,se),de=Kt<=.01,we=0,ze=Ji||0,Le=jf(ir)?ir.end:u.end,Ze=u.endTrigger||Q,rt=jf(ir)?ir.start:u.start||(u.start===0||!Q?0:q?"0 0":"0 100%"),We=st.pinnedContainer=u.pinnedContainer&&Fa(u.pinnedContainer,st),pt=Q&&Math.max(0,an.indexOf(st))||0,lt=pt,dt,St,qt,Ht,li,pi,bi,Mi,dr,fr,Gi,_r,wr;for(Qe&&jf(ir)&&(_r=cr.getProperty(qe,se.p),wr=cr.getProperty(Et,se.p));lt-- >0;)pi=an[lt],pi.end||pi.refresh(0,1)||(Go=st),bi=pi.pin,bi&&(bi===Q||bi===q||bi===We)&&!pi.isReverted&&(fr||(fr=[]),fr.unshift(pi),pi.revert(!0,!0)),pi!==an[lt]&&(pt--,lt--);for(Qo(rt)&&(rt=rt(st)),rt=DR(rt,"start",st),Ee=UR(rt,Q,gn,se,Ui(),Ie,qe,st,ot,vt,ct,ee,le,st._startClamp&&"_startClamp")||(q?-.001:0),Qo(Le)&&(Le=Le(st)),ul(Le)&&!Le.indexOf("+=")&&(~Le.indexOf(" ")?Le=(ul(rt)?rt.split(" ")[0]:"")+Le:(we=yx(Le.substr(2),gn),Le=ul(rt)?rt:(le?cr.utils.mapRange(0,le.duration(),le.scrollTrigger.start,le.scrollTrigger.end,Ee):Ee)+we,Ze=Q)),Le=DR(Le,"end",st),ve=Math.max(Ee,UR(Le||(Ze?"100% 0":ee),Ze,gn,se,Ui()+we,Tt,Et,st,ot,vt,ct,ee,le,st._endClamp&&"_endClamp"))||-.001,we=0,lt=pt;lt--;)pi=an[lt],bi=pi.pin,bi&&pi.start-pi._pinPush<=Ee&&!le&&pi.end>0&&(dt=pi.end-(st._startClamp?Math.max(0,pi.start):pi.start),(bi===Q&&pi.start-pi._pinPush<Ee||bi===We)&&isNaN(rt)&&(we+=dt*(1-pi.progress)),bi===q&&(ze+=dt));if(Ee+=we,ve+=we,st._startClamp&&(st._startClamp+=we),st._endClamp&&!ba&&(st._endClamp=ve||-.001,ve=Math.min(ve,ou(De,se))),Kt=ve-Ee||(Ee-=.01)&&.001,de&&(Ii=cr.utils.clamp(0,1,cr.utils.normalize(Ee,ve,xn))),st._pinPush=ze,Ie&&we&&(dt={},dt[se.a]="+="+we,We&&(dt[se.p]="-="+Ui()),cr.set([Ie,Tt],dt)),q&&!(WE&&st.end>=ou(De,se)))dt=Zl(q),Ht=se===vo,qt=Ui(),sr=parseFloat(Ni(se.a))+ze,!ee&&ve>1&&(Gi=(yt?ps.scrollingElement||dl:De).style,Gi={style:Gi,value:Gi["overflow"+se.a.toUpperCase()]},yt&&Zl(Gn)["overflow"+se.a.toUpperCase()]!=="scroll"&&(Gi.style["overflow"+se.a.toUpperCase()]="scroll")),kT(q,yi,dt),Ut=Yv(q),St=Zu(q,!0),Mi=ct&&Cd(De,Ht?Sa:vo)(),X?(kr=[X+se.os2,Kt+ze+go],kr.t=yi,lt=X===no?hb(q,se)+Kt+ze:0,lt&&(kr.push(se.d,lt+go),yi.style.flexBasis!=="auto"&&(yi.style.flexBasis=lt+go)),n_(kr),We&&an.forEach(function(ki){ki.pin===We&&ki.vars.pinSpacing!==!1&&(ki._subPinOffset=!0)}),ct&&Ui(xn)):(lt=hb(q,se),lt&&yi.style.flexBasis!=="auto"&&(yi.style.flexBasis=lt+go)),ct&&(li={top:St.top+(Ht?qt-Ee:Mi)+go,left:St.left+(Ht?Mi:qt-Ee)+go,boxSizing:"border-box",position:"fixed"},li[op]=li["max"+M_]=Math.ceil(St.width)+go,li[ap]=li["max"+zA]=Math.ceil(St.height)+go,li[Wl]=li[Wl+o0]=li[Wl+n0]=li[Wl+a0]=li[Wl+s0]="0",li[no]=dt[no],li[no+o0]=dt[no+o0],li[no+n0]=dt[no+n0],li[no+a0]=dt[no+a0],li[no+s0]=dt[no+s0],Li=fY(ti,li,ue),ba&&Ui(0)),d?(dr=d._initted,PT(1),d.render(d.duration(),!0,!0),Rr=Ni(se.a)-sr+Kt+ze,nn=Math.abs(Kt-Rr)>1,ct&&nn&&Li.splice(Li.length-2,2),d.render(0,!0,!0),dr||d.invalidate(!0),d.parent||d.totalTime(d.totalTime()),PT(0)):Rr=Kt,Gi&&(Gi.value?Gi.style["overflow"+se.a.toUpperCase()]=Gi.value:Gi.style.removeProperty("overflow-"+se.a));else if(Q&&Ui()&&!le)for(St=Q.parentNode;St&&St!==Gn;)St._pinOffset&&(Ee-=St._pinOffset,ve-=St._pinOffset),St=St.parentNode;fr&&fr.forEach(function(ki){return ki.revert(!1,!0)}),st.start=Ee,st.end=ve,be=Be=ba?xn:Ui(),!le&&!ba&&(be<xn&&Ui(xn),st.scroll.rec=0),st.revert(!1,!0),Ci=Zo(),Yn&&(Hi=-1,Yn.restart(!0)),Go=0,d&&Ae&&(d._initted||$n)&&d.progress()!==$n&&d.progress($n||0,!0).render(d.time(),!0,!0),(de||Ii!==st.progress||le||G||d&&!d._initted)&&(d&&!Ae&&d.totalProgress(le&&Ee<-.001&&!Ii?cr.utils.normalize(Ee,ve,0):Ii,!0),st.progress=de||(be-Ee)/Kt===Ii?0:Ii),q&&X&&(yi._pinOffset=Math.round(st.progress*Rr)),Zi&&Zi.invalidate(),isNaN(_r)||(_r-=cr.getProperty(qe,se.p),wr-=cr.getProperty(Et,se.p),Xv(qe,se,_r),Xv(Ie,se,_r-(Ji||0)),Xv(Et,se,wr),Xv(Tt,se,wr-(Ji||0))),de&&!ba&&st.update(),F&&!ba&&!$t&&($t=!0,F(st),$t=!1)}},st.getVelocity=function(){return(Ui()-Be)/(Zo()-Ly)*1e3||0},st.endAnimation=function(){My(st.callbackAnimation),d&&(Zi?Zi.progress(1):d.paused()?Ae||My(d,st.direction<0,1):My(d,d.reversed()))},st.labelToScroll=function(Pi){return d&&d.labels&&(Ee||st.refresh()||Ee)+d.labels[Pi]/d.duration()*Kt||0},st.getTrailing=function(Pi){var br=an.indexOf(st),ir=st.direction>0?an.slice(0,br).reverse():an.slice(br+1);return(ul(Pi)?ir.filter(function(Ji){return Ji.vars.preventOverlaps===Pi}):ir).filter(function(Ji){return st.direction>0?Ji.end<=Ee:Ji.start>=ve})},st.update=function(Pi,br,ir){if(!(le&&!ir&&!Pi)){var Ji=ba===!0?xn:st.scroll(),gn=Pi?0:(Ji-Ee)/Kt,ot=gn<0?0:gn>1?1:gn||0,ee=st.progress,de,we,ze,Le,Ze,rt,We,pt;if(br&&(Be=be,be=le?Ui():Ji,ne&&(Vi=Ur,Ur=d&&!Ae?d.totalProgress():ot)),ae&&q&&!Go&&!$v&&ec&&(!ot&&Ee<Ji+(Ji-Be)/(Zo()-Ly)*ae?ot=1e-4:ot===1&&ve>Ji+(Ji-Be)/(Zo()-Ly)*ae&&(ot=.9999)),ot!==ee&&st.enabled){if(de=st.isActive=!!ot&&ot<1,we=!!ee&&ee<1,rt=de!==we,Ze=rt||!!ot!=!!ee,st.direction=ot>ee?1:-1,st.progress=ot,Ze&&!Go&&(ze=ot&&!ee?0:ot===1?1:ee===1?2:3,Ae&&(Le=!rt&&et[ze+1]!=="none"&&et[ze+1]||et[ze],pt=d&&(Le==="complete"||Le==="reset"||Le in d))),oe&&(rt||pt)&&(pt||N||!d)&&(Qo(oe)?oe(st):st.getTrailing(oe).forEach(function(qt){return qt.endAnimation()})),Ae||(Zi&&!Go&&!$v?(Zi._dp._time-Zi._start!==Zi._time&&Zi.render(Zi._dp._time-Zi._start),Zi.resetTo?Zi.resetTo("totalProgress",ot,d._tTime/d._tDur):(Zi.vars.totalProgress=ot,Zi.invalidate().restart())):d&&d.totalProgress(ot,!!(Go&&(Ci||Pi)))),q){if(Pi&&X&&(yi.style[X+se.os2]=Yr),!ct)Ki(zy(sr+Rr*ot));else if(Ze){if(We=!Pi&&ot>ee&&ve+1>Ji&&Ji+1>=ou(De,se),ue)if(!Pi&&(de||We)){var lt=Zu(q,!0),dt=Ji-Ee;jR(q,Gn,lt.top+(se===vo?dt:0)+go,lt.left+(se===vo?0:dt)+go)}else jR(q,yi);n_(de||We?Li:Ut),nn&&ot<1&&de||Ki(sr+(ot===1&&!We?Rr:0))}}ne&&!xi.tween&&!Go&&!$v&&Yn.restart(!0),r&&(rt||fe&&ot&&(ot<1||!RT))&&L0(r.targets).forEach(function(qt){return qt.classList[de||fe?"add":"remove"](r.className)}),v&&!Ae&&!Pi&&v(st),Ze&&!Go?(Ae&&(pt&&(Le==="complete"?d.pause().totalProgress(1):Le==="reset"?d.restart(!0).pause():Le==="restart"?d.restart(!0):d[Le]()),v&&v(st)),(rt||!RT)&&(B&&rt&&OT(st,B),mt[ze]&&OT(st,mt[ze]),fe&&(ot===1?st.kill(!1,1):mt[ze]=0),rt||(ze=ot===1?1:3,mt[ze]&&OT(st,mt[ze]))),re&&!de&&Math.abs(st.getVelocity())>(Fy(re)?re:2500)&&(My(st.callbackAnimation),Zi?Zi.progress(1):My(d,Le==="reverse"?1:!ot,1))):Ae&&v&&!Go&&v(st)}if(Ts){var St=le?Ji/le.duration()*(le._caScrollDist||0):Ji;yr(St+(qe._isFlipped?1:0)),Ts(St)}Dn&&Dn(-Ji/le.duration()*(le._caScrollDist||0))}},st.enable=function(Pi,br){st.enabled||(st.enabled=!0,Mo(De,"resize",By),yt||Mo(De,"scroll",Lm),Zt&&Mo(n,"refreshInit",Zt),Pi!==!1&&(st.progress=Ii=0,be=Be=Hi=Ui()),br!==!1&&st.refresh())},st.getTween=function(Pi){return Pi&&xi?xi.tween:Zi},st.setPositions=function(Pi,br,ir,Ji){if(le){var gn=le.scrollTrigger,ot=le.duration(),ee=gn.end-gn.start;Pi=gn.start+ee*Pi/ot,br=gn.start+ee*br/ot}st.refresh(!1,!1,{start:OR(Pi,ir&&!!st._startClamp),end:OR(br,ir&&!!st._endClamp)},Ji),st.update()},st.adjustPinSpacing=function(Pi){if(kr&&Pi){var br=kr.indexOf(se.d)+1;kr[br]=parseFloat(kr[br])+Pi+go,kr[1]=parseFloat(kr[1])+Pi+go,n_(kr)}},st.disable=function(Pi,br){if(st.enabled&&(Pi!==!1&&st.revert(!0,!0),st.enabled=st.isActive=!1,br||Zi&&Zi.pause(),xn=0,Yi&&(Yi.uncache=1),Zt&&Co(n,"refreshInit",Zt),Yn&&(Yn.pause(),xi.tween&&xi.tween.kill()&&(xi.tween=0)),!yt)){for(var ir=an.length;ir--;)if(an[ir].scroller===De&&an[ir]!==st)return;Co(De,"resize",By),yt||Co(De,"scroll",Lm)}},st.kill=function(Pi,br){st.disable(Pi,br),Zi&&!br&&Zi.kill(),D&&delete ZE[D];var ir=an.indexOf(st);ir>=0&&an.splice(ir,1),ir===xa&&xx>0&&xa--,ir=0,an.forEach(function(Ji){return Ji.scroller===st.scroller&&(ir=1)}),ir||ba||(st.scroll.rec=0),d&&(d.scrollTrigger=null,Pi&&d.revert({kill:!1}),br||d.kill()),Ie&&[Ie,Tt,qe,Et].forEach(function(Ji){return Ji.parentNode&&Ji.parentNode.removeChild(Ji)}),l0===st&&(l0=0),q&&(Yi&&(Yi.uncache=1),ir=0,an.forEach(function(Ji){return Ji.pin===q&&ir++}),ir||(Yi.spacer=0)),u.onKill&&u.onKill(st)},an.push(st),st.enable(!1,!1),Hs&&Hs(st),d&&d.add&&!Kt){var lr=st.update;st.update=function(){st.update=lr,un.cache++,Ee||ve||st.refresh()},cr.delayedCall(.01,st.update),Kt=.01,Ee=ve=0}else st.refresh();q&&uY()},n.register=function(u){return Vm||(cr=u||Pz(),Iz()&&window.document&&n.enable(),Vm=ky),Vm},n.defaults=function(u){if(u)for(var d in u)Wv[d]=u[d];return Wv},n.disable=function(u,d){ky=0,an.forEach(function(v){return v[d?"kill":"disable"](u)}),Co(cn,"wheel",Lm),Co(ps,"scroll",Lm),clearInterval(jv),Co(ps,"touchcancel",ru),Co(Gn,"touchstart",ru),Hv(Co,ps,"pointerdown,touchstart,mousedown",LR),Hv(Co,ps,"pointerup,touchend,mouseup",kR),cb.kill(),qv(Co);for(var y=0;y<un.length;y+=3)Gv(Co,un[y],un[y+1]),Gv(Co,un[y],un[y+2])},n.enable=function(){if(cn=window,ps=document,dl=ps.documentElement,Gn=ps.body,cr&&(L0=cr.utils.toArray,r0=cr.utils.clamp,GE=cr.core.context||ru,PT=cr.core.suppressOverwrites||ru,DA=cn.history.scrollRestoration||"auto",YE=cn.pageYOffset||0,cr.core.globals("ScrollTrigger",n),Gn)){ky=1,r_=document.createElement("div"),r_.style.height="100vh",r_.style.position="absolute",Nz(),rY(),to.register(cr),n.isTouch=to.isTouch,Jh=to.isTouch&&/(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent),HE=to.isTouch===1,Mo(cn,"wheel",Lm),RA=[cn,ps,dl,Gn],cr.matchMedia?(n.matchMedia=function(B){var F=cr.matchMedia(),N;for(N in B)F.add(N,B[N]);return F},cr.addEventListener("matchMediaInit",function(){return BA()}),cr.addEventListener("matchMediaRevert",function(){return Fz()}),cr.addEventListener("matchMedia",function(){Yf(0,1),vp("matchMedia")}),cr.matchMedia().add("(orientation: portrait)",function(){return LT(),LT})):console.warn("Requires GSAP 3.11.0 or later"),LT(),Mo(ps,"scroll",Lm);var u=Gn.hasAttribute("style"),d=Gn.style,y=d.borderTopStyle,v=cr.core.Animation.prototype,r,D;for(v.revert||Object.defineProperty(v,"revert",{value:function(){return this.time(-.01,!0)}}),d.borderTopStyle="solid",r=Zu(Gn),vo.m=Math.round(r.top+vo.sc())||0,Sa.m=Math.round(r.left+Sa.sc())||0,y?d.borderTopStyle=y:d.removeProperty("border-top-style"),u||(Gn.setAttribute("style",""),Gn.removeAttribute("style")),jv=setInterval(BR,250),cr.delayedCall(.5,function(){return $v=0}),Mo(ps,"touchcancel",ru),Mo(Gn,"touchstart",ru),Hv(Mo,ps,"pointerdown,touchstart,mousedown",LR),Hv(Mo,ps,"pointerup,touchend,mouseup",kR),qE=cr.utils.checkPrefix("transform"),bx.push(qE),Vm=Zo(),cb=cr.delayedCall(.2,Yf).pause(),Um=[ps,"visibilitychange",function(){var B=cn.innerWidth,F=cn.innerHeight;ps.hidden?(PR=B,RR=F):(PR!==B||RR!==F)&&By()},ps,"DOMContentLoaded",Yf,cn,"load",Yf,cn,"resize",By],qv(Mo),an.forEach(function(B){return B.enable(0,1)}),D=0;D<un.length;D+=3)Gv(Co,un[D],un[D+1]),Gv(Co,un[D],un[D+2])}},n.config=function(u){"limitCallbacks"in u&&(RT=!!u.limitCallbacks);var d=u.syncInterval;d&&clearInterval(jv)||(jv=d)&&setInterval(BR,d),"ignoreMobileResize"in u&&(HE=n.isTouch===1&&u.ignoreMobileResize),"autoRefreshEvents"in u&&(qv(Co)||qv(Mo,u.autoRefreshEvents||"none"),Az=(u.autoRefreshEvents+"").indexOf("resize")===-1)},n.scrollerProxy=function(u,d){var y=Fa(u),v=un.indexOf(y),r=gp(y);~v&&un.splice(v,r?6:2),d&&(r?uu.unshift(cn,d,Gn,d,dl,d):uu.unshift(y,d))},n.clearMatchMedia=function(u){an.forEach(function(d){return d._ctx&&d._ctx.query===u&&d._ctx.kill(!0,!0)})},n.isInViewport=function(u,d,y){var v=(ul(u)?Fa(u):u).getBoundingClientRect(),r=v[y?op:ap]*d||0;return y?v.right-r>0&&v.left+r<cn.innerWidth:v.bottom-r>0&&v.top+r<cn.innerHeight},n.positionInViewport=function(u,d,y){ul(u)&&(u=Fa(u));var v=u.getBoundingClientRect(),r=v[y?op:ap],D=d==null?r/2:d in db?db[d]*r:~d.indexOf("%")?parseFloat(d)*r/100:parseFloat(d)||0;return y?(v.left+D)/cn.innerWidth:(v.top+D)/cn.innerHeight},n.killAll=function(u){if(an.slice(0).forEach(function(y){return y.vars.id!=="ScrollSmoother"&&y.kill()}),u!==!0){var d=yp.killAll||[];yp={},d.forEach(function(y){return y()})}},n}();dn.version="3.12.7";dn.saveStyles=function(n){return n?L0(n).forEach(function(e){if(e&&e.style){var o=ll.indexOf(e);o>=0&&ll.splice(o,5),ll.push(e,e.style.cssText,e.getBBox&&e.getAttribute("transform"),cr.core.getCache(e),GE())}}):ll};dn.revert=function(n,e){return BA(!n,e)};dn.create=function(n,e){return new dn(n,e)};dn.refresh=function(n){return n?By(!0):(Vm||dn.register())&&Yf(!0)};dn.update=function(n){return++un.cache&&Qu(n===!0?2:0)};dn.clearScrollMemory=Bz;dn.maxScroll=function(n,e){return ou(n,e?Sa:vo)};dn.getScrollFunc=function(n,e){return Cd(Fa(n),e?Sa:vo)};dn.getById=function(n){return ZE[n]};dn.getAll=function(){return an.filter(function(n){return n.vars.id!=="ScrollSmoother"})};dn.isScrolling=function(){return!!ec};dn.snapDirectional=FA;dn.addEventListener=function(n,e){var o=yp[n]||(yp[n]=[]);~o.indexOf(e)||o.push(e)};dn.removeEventListener=function(n,e){var o=yp[n],u=o&&o.indexOf(e);u>=0&&o.splice(u,1)};dn.batch=function(n,e){var o=[],u={},d=e.interval||.016,y=e.batchMax||1e9,v=function(B,F){var N=[],Q=[],q=cr.delayedCall(d,function(){F(N,Q),N=[],Q=[]}).pause();return function(X){N.length||q.restart(!0),N.push(X.trigger),Q.push(X),y<=N.length&&q.progress(1)}},r;for(r in e)u[r]=r.substr(0,2)==="on"&&Qo(e[r])&&r!=="onRefreshInit"?v(r,e[r]):e[r];return Qo(y)&&(y=y(),Mo(dn,"refresh",function(){return y=e.batchMax()})),L0(n).forEach(function(D){var B={};for(r in u)B[r]=u[r];B.trigger=D,o.push(dn.create(B))}),o};var qR=function(e,o,u,d){return o>d?e(d):o<0&&e(0),u>d?(d-o)/(u-o):u<0?o/(o-u):1},zT=function n(e,o){o===!0?e.style.removeProperty("touch-action"):e.style.touchAction=o===!0?"auto":o?"pan-"+o+(to.isTouch?" pinch-zoom":""):"none",e===dl&&n(Gn,o)},Kv={auto:1,scroll:1},mY=function(e){var o=e.event,u=e.target,d=e.axis,y=(o.changedTouches?o.changedTouches[0]:o).target,v=y._gsap||cr.core.getCache(y),r=Zo(),D;if(!v._isScrollT||r-v._isScrollT>2e3){for(;y&&y!==Gn&&(y.scrollHeight<=y.clientHeight&&y.scrollWidth<=y.clientWidth||!(Kv[(D=Zl(y)).overflowY]||Kv[D.overflowX]));)y=y.parentNode;v._isScroll=y&&y!==u&&!gp(y)&&(Kv[(D=Zl(y)).overflowY]||Kv[D.overflowX]),v._isScrollT=r}(v._isScroll||d==="x")&&(o.stopPropagation(),o._gsapAllow=!0)},Uz=function(e,o,u,d){return to.create({target:e,capture:!0,debounce:!1,lockAxis:!0,type:o,onWheel:d=d&&mY,onPress:d,onDrag:d,onScroll:d,onEnable:function(){return u&&Mo(ps,to.eventTypes[0],GR,!1,!0)},onDisable:function(){return Co(ps,to.eventTypes[0],GR,!0)}})},_Y=/(input|label|select|textarea)/i,HR,GR=function(e){var o=_Y.test(e.target.tagName);(o||HR)&&(e._gsapAllow=!0,HR=o)},gY=function(e){jf(e)||(e={}),e.preventDefault=e.isNormalizer=e.allowClicks=!0,e.type||(e.type="wheel,touch"),e.debounce=!!e.debounce,e.id=e.id||"normalizer";var o=e,u=o.normalizeScrollX,d=o.momentum,y=o.allowNestedScroll,v=o.onRelease,r,D,B=Fa(e.target)||dl,F=cr.core.globals().ScrollSmoother,N=F&&F.get(),Q=Jh&&(e.content&&Fa(e.content)||N&&e.content!==!1&&!N.smooth()&&N.content()),q=Cd(B,vo),X=Cd(B,Sa),G=1,ae=(to.isTouch&&cn.visualViewport?cn.visualViewport.scale*cn.visualViewport.width:cn.outerWidth)/cn.innerWidth,xe=0,Te=Qo(d)?function(){return d(r)}:function(){return d||2.8},fe,ne,ue=Uz(B,e.type,!0,y),ye=function(){return ne=!1},le=ru,re=ru,oe=function(){D=ou(B,vo),re=r0(Jh?1:0,D),u&&(le=r0(0,ou(B,Sa))),fe=lp},se=function(){Q._gsap.y=zy(parseFloat(Q._gsap.y)+q.offset)+"px",Q.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+parseFloat(Q._gsap.y)+", 0, 1)",q.offset=q.cacheID=0},Ae=function(){if(ne){requestAnimationFrame(ye);var Qe=zy(r.deltaY/2),vt=re(q.v-Qe);if(Q&&vt!==q.v+q.offset){q.offset=vt-q.v;var st=zy((parseFloat(Q&&Q._gsap.y)||0)-q.offset);Q.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+st+", 0, 1)",Q._gsap.y=st+"px",q.cacheID=un.cache,Qu()}return!0}q.offset&&se(),ne=!0},De,Ge,yt,ct,mt=function(){oe(),De.isActive()&&De.vars.scrollY>D&&(q()>D?De.progress(1)&&q(D):De.resetTo("scrollY",D))};return Q&&cr.set(Q,{y:"+=0"}),e.ignoreCheck=function(et){return Jh&&et.type==="touchmove"&&Ae()||G>1.05&&et.type!=="touchstart"||r.isGesturing||et.touches&&et.touches.length>1},e.onPress=function(){ne=!1;var et=G;G=zy((cn.visualViewport&&cn.visualViewport.scale||1)/ae),De.pause(),et!==G&&zT(B,G>1.01?!0:u?!1:"x"),Ge=X(),yt=q(),oe(),fe=lp},e.onRelease=e.onGestureStart=function(et,Qe){if(q.offset&&se(),!Qe)ct.restart(!0);else{un.cache++;var vt=Te(),st,Zt;u&&(st=X(),Zt=st+vt*.05*-et.velocityX/.227,vt*=qR(X,st,Zt,ou(B,Sa)),De.vars.scrollX=le(Zt)),st=q(),Zt=st+vt*.05*-et.velocityY/.227,vt*=qR(q,st,Zt,ou(B,vo)),De.vars.scrollY=re(Zt),De.invalidate().duration(vt).play(.01),(Jh&&De.vars.scrollY>=D||st>=D-1)&&cr.to({},{onUpdate:mt,duration:vt})}v&&v(et)},e.onWheel=function(){De._ts&&De.pause(),Zo()-xe>1e3&&(fe=0,xe=Zo())},e.onChange=function(et,Qe,vt,st,Zt){if(lp!==fe&&oe(),Qe&&u&&X(le(st[2]===Qe?Ge+(et.startX-et.x):X()+Qe-st[1])),vt){q.offset&&se();var ui=Zt[2]===vt,ni=ui?yt+et.startY-et.y:q()+vt-Zt[1],Hi=re(ni);ui&&ni!==Hi&&(yt+=Hi-ni),q(Hi)}(vt||Qe)&&Qu()},e.onEnable=function(){zT(B,u?!1:"x"),dn.addEventListener("refresh",mt),Mo(cn,"resize",mt),q.smooth&&(q.target.style.scrollBehavior="auto",q.smooth=X.smooth=!1),ue.enable()},e.onDisable=function(){zT(B,!0),Co(cn,"resize",mt),dn.removeEventListener("refresh",mt),ue.kill()},e.lockAxis=e.lockAxis!==!1,r=new to(e),r.iOS=Jh,Jh&&!q()&&q(1),Jh&&cr.ticker.add(ru),ct=r._dc,De=cr.to(r,{ease:"power4",paused:!0,inherit:!1,scrollX:u?"+=0.1":"+=0",scrollY:"+=0.1",modifiers:{scrollY:Vz(q,q(),function(){return De.pause()})},onUpdate:Qu,onComplete:ct.vars.onComplete}),r};dn.sort=function(n){if(Qo(n))return an.sort(n);var e=cn.pageYOffset||0;return dn.getAll().forEach(function(o){return o._sortY=o.trigger?e+o.trigger.getBoundingClientRect().top:o.start+cn.innerHeight}),an.sort(n||function(o,u){return(o.vars.refreshPriority||0)*-1e6+(o.vars.containerAnimation?1e6:o._sortY)-((u.vars.containerAnimation?1e6:u._sortY)+(u.vars.refreshPriority||0)*-1e6)})};dn.observe=function(n){return new to(n)};dn.normalizeScroll=function(n){if(typeof n>"u")return ya;if(n===!0&&ya)return ya.enable();if(n===!1){ya&&ya.kill(),ya=n;return}var e=n instanceof to?n:gY(n);return ya&&ya.target===e.target&&ya.kill(),gp(e.target)&&(ya=e),e};dn.core={_getVelocityProp:$E,_inputObserver:Uz,_scrollers:un,_proxies:uu,bridge:{ss:function(){ec||vp("scrollStart"),ec=Zo()},ref:function(){return Go}}};Pz()&&cr.registerPlugin(dn);const yY={data(){return{peliculas:[],moviesChart:null}},mounted(){this.getPeliculas()},methods:{getPeliculas(){bs.get("pelicula").then(n=>{this.peliculas=n.data,this.renderChart()}).catch(n=>{console.log(n)})},renderChart(){const n=document.getElementById("moviesChart");if(!n)return;const o=this.peliculas.map(v=>new Date(v.fecha_estreno).getFullYear()).reduce((v,r)=>(v[r]=(v[r]||0)+1,v),{}),u=Object.keys(o).sort(),d=u.map(v=>o[v]);this.moviesChart&&this.moviesChart.destroy();const y=["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF","#FF9F40","#8B8B8B","#00D084","#FF5E3A","#A4C400","#D80073","#E3C800"];this.moviesChart=new Chart(n,{type:"polarArea",data:{labels:u,datasets:[{label:"Películas estrenadas",data:d,backgroundColor:y.slice(0,u.length),borderWidth:1}]},options:{responsive:!0,plugins:{legend:{position:"right"},tooltip:{callbacks:{label:v=>`${v.label}: ${v.raw} película(s)`}}}}})}},beforeUnmount(){this.moviesChart&&this.moviesChart.destroy()}},vY={class:"chart-container"};function xY(n,e,o,u,d,y){return zt(),Nt("div",vY,e[0]||(e[0]=[K("h2",null,"PELÍCULAS ESTRENADAS POR AÑO",-1),K("canvas",{id:"moviesChart"},null,-1)]))}const bY=Wn(yY,[["render",xY],["__scopeId","data-v-3b3274d4"]]);const wY={class:"contenedor-home"},TY={id:"app"},EY={class:"image-scroll-gallery"},SY=["src","alt"],AY={__name:"Scroll",setup(n){Vu.registerPlugin(dn);const e=[{src:"https://www.ecartelera.com/carteles/fondos/5900/5964-n2.jpg",alt:"Película de acción"},{src:"https://ep01.epimg.net/verne/imagenes/2019/01/13/articulo/1547386341_975143_1547458878_noticia_normal.jpg",alt:"Película de acción"},{src:"  https://pics.filmaffinity.com/Apocalypse_Now-297470015-large.jpg",alt:"Película de acción"}];return Sl(()=>{Vu.to(".filmo-marquee span",{x:"-50%",duration:30,repeat:-1,ease:"none"}),Vu.to(".filmo-marquee-reverse span",{x:"50%",duration:30,repeat:-1,ease:"none"}),nextTick(()=>{revealElements.value.forEach(o=>{const u=o.querySelector("img"),d=Vu.timeline({scrollTrigger:{trigger:o,toggleActions:"restart none none reset"}});d.set(o,{autoAlpha:1}),d.from(o,{xPercent:-100,duration:1.5,ease:"power2.out"}),d.from(u,{xPercent:100,scale:1.3,duration:1.5,delay:-1.5,ease:"power2.out"},0)})}),Vu.utils.toArray(".scroll-image").forEach((o,u)=>{Vu.from(o,{scrollTrigger:{trigger:o,start:"top 80%",toggleActions:"play none none none"},y:100,opacity:0,duration:1,delay:u*.2,ease:"power2.out"})})}),q0(()=>{dn.getAll().forEach(o=>o.kill()),Vu.killTweensOf(".filmo-marquee span"),Vu.killTweensOf(".filmo-marquee-reverse span")}),(o,u)=>(zt(),Nt("div",wY,[u[0]||(u[0]=x_('<div class="video-filmo-container" data-v-684c9138><video autoplay muted loop class="video-filmo-bg" data-v-684c9138><source src="'+eY+'" type="video/mp4" data-v-684c9138></video><div class="video-filmo-overlay" data-v-684c9138></div></div><div class="filmo-marquee-container" data-v-684c9138><div class="filmo-marquee" data-v-684c9138><span data-v-684c9138>FILMOFILMOFILMOFILMOFILMO</span><span data-v-684c9138>FILMOFILMOFILMOFILMOFILMOFILMO</span></div><div class="filmo-marquee filmo-marquee-reverse" data-v-684c9138><span data-v-684c9138>FILMOFILMOFILMOFILMOFILMOFILMO</span><span data-v-684c9138>FILMOFILMOFILMOFILMOFILMOFILMO</span></div></div><div class="presenta-text" style="margin-top:30rem;" data-v-684c9138><h1 class="cartelera-inicio" data-v-684c9138>PRESENTA</h1></div><hr class="barra-blanca" data-v-684c9138><div class="descripcion-container" data-v-684c9138><div class="descripcionFilmo" data-v-684c9138><div class="text-line" data-v-684c9138><span class="filmo" data-v-684c9138>Filmo</span> es una plataforma diseñada para los amantes del cine, donde podrás disfrutar de una extensa variedad de películas, series y dibujos de todos los géneros. </div><div class="text-line" data-v-684c9138> Filmo te ofrece una experiencia única para explorar y descubrir nuevos contenidos. </div><div class="text-line" data-v-684c9138> Facilita tu acceso a todo lo que el mundo del cine tiene para ofrecer. </div></div></div>',5)),K("div",TY,[hs(bY)]),K("div",EY,[(zt(),Nt(ur,null,_n(e,(d,y)=>K("div",{class:"scroll-image",key:y},[K("img",{src:d.src,alt:d.alt,class:"gallery-img"},null,8,SY)])),64))]),u[1]||(u[1]=x_('<div class="presenta-text" data-v-684c9138><h1 class="cartelera-inicio" data-v-684c9138><strong data-v-684c9138>CARTELERA</strong></h1><hr class="barra-blanca" data-v-684c9138><div data-v-684c9138><a class="btnInicio" href="cartelera" data-v-684c9138><strong data-v-684c9138>VER MÁS</strong></a></div></div><img src="https://i.postimg.cc/1RgXJd7G/abeibqt571p91-1.png" alt="" class="imagen-inicio" data-v-684c9138>',2))]))}},CY=Wn(AY,[["__scopeId","data-v-684c9138"]]);const MY={data(){return{usuarios:[],roles:[],myModal:{},usuario:{},messageError:"",isError:!1,insert:!1}},created(){this.selectUsuario(),this.getRoles()},methods:{showForm(){this.insert=!0,this.isError=!1,this.myModal=new ds("#usuarioModal"),this.myModal.show(),this.usuario={}},getRoles(){const n=this;axios.get("rol").then(e=>{n.roles=e.data}).catch(e=>{console.log(e)})},updateUsuarios(){const n=this;axios.put("usuario/"+n.usuario.id,n.usuario).then(e=>{n.selectUsuario(),n.myModal.hide()}).catch(e=>{this.isError=!0,n.messageError=e.response.data.message})},insertUsuarios(){const n=this;axios.post("usuario/",n.usuario).then(e=>{n.selectUsuario(),n.myModal.hide()}).catch(e=>{this.isError=!0,n.messageError=e.response.data.message})},selectUsuario(){const n=this;axios.get("usuario").then(e=>{n.usuarios=e.data}).catch(e=>{console.log(e)})},editUsuario(n){this.insert=!1,this.usuario=n,this.myModal=new ds("#usuarioModal"),this.myModal.show()},eliminarUsuario(n){this.isError=!1,this.usuario=n,this.myModal=new ds("#deleteModal"),this.myModal.show()},deleteUsuario(n){const e=this;axios.delete("usuario/"+n).then(o=>{e.selectUsuario(),e.myModal.hide()}).catch(o=>{this.isError=!0,e.messageError=o.response.data.message})}},mounted(){}},IY={class:"tabla-usuarios"},PY={class:"table"},RY={scope:"row"},DY=["onClick"],OY=["onClick"],LY={class:"modal",tabindex:"-1",id:"deleteModal"},kY={class:"modal-dialog",role:"document"},zY={class:"modal-content"},FY={class:"modal-body"},BY={key:0,class:"alert alert-danger"},NY={class:"modal-footer"},VY={class:"modal",tabindex:"-1",id:"usuarioModal"},UY={class:"modal-dialog",role:"document"},jY={class:"modal-content"},$Y={class:"modal-header"},qY={key:0,class:"modal-title"},HY={key:1,class:"modal-title"},GY={class:"modal-body"},WY={"data-mdb-input-init":"",class:"form-outline mb-4"},ZY={"data-mdb-input-init":"",class:"form-outline mb-4"},YY={class:"mb-3"},XY={class:"mb-3"},KY=["value"],JY={key:0,class:"alert alert-danger"},QY={class:"modal-footer"};function eX(n,e,o,u,d,y){return zt(),Nt(ur,null,[K("div",null,[K("button",{onClick:e[0]||(e[0]=v=>y.showForm()),class:"anadirBoton"},e[9]||(e[9]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-plus-square",viewBox:"0 0 16 16"},[K("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),K("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"})],-1),K("strong",null," AÑADIR USUARIO",-1)]))]),K("div",IY,[K("table",PY,[e[12]||(e[12]=K("thead",null,[K("tr",null,[K("th",{scope:"col"},"ID"),K("th",{scope:"col"},"Nombre"),K("th",{scope:"col"},"Fecha de nacimiento"),K("th",{scope:"col"},"Correo"),K("th",{scope:"col"},"Contraseña"),K("th",{scope:"col"},"Rol"),K("th",{scope:"col"},"Acciones")])],-1)),K("tbody",null,[(zt(!0),Nt(ur,null,_n(d.usuarios,v=>(zt(),Nt("tr",{key:v.id},[K("th",RY,oi(v.id),1),K("td",null,oi(v.nombre),1),K("td",null,oi(v.fecha_nacimiento),1),K("td",null,oi(v.correo),1),K("td",null,oi(v.contrasenya),1),K("td",null,oi(v.rol.tipo_rol),1),K("th",null,[K("button",{onClick:r=>y.editUsuario(v),class:"editarBoton"},e[10]||(e[10]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-pencil-square"},[K("path",{d:"M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"}),K("path",{"fill-rule":"evenodd",d:"M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"})],-1)]),8,DY)]),K("th",null,[K("button",{onClick:r=>y.eliminarUsuario(v),style:{border:"none",background:"none",cursor:"pointer",color:"rgb(255, 0, 0)"}},e[11]||(e[11]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[K("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"}),K("path",{d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"})],-1)]),8,OY)])]))),128))])])]),K("div",LY,[K("div",kY,[K("div",zY,[e[16]||(e[16]=K("div",{class:"modal-header"},[K("h5",{class:"modal-title"},"Borrar usuario"),K("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"})],-1)),K("div",FY,[K("p",null,[e[13]||(e[13]=Eo("¿ Seguro que quieres borrar a ")),K("strong",null,oi(d.usuario.nombre),1),e[14]||(e[14]=Eo(" ?"))]),d.isError?(zt(),Nt("p",BY,oi(d.messageError),1)):Jn("",!0)]),K("div",NY,[K("button",{type:"button",class:"btn btn-primary",onClick:e[1]||(e[1]=v=>y.deleteUsuario(d.usuario.id))},"Borrar"),e[15]||(e[15]=K("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Cancelar",-1))])])])]),K("div",VY,[K("div",UY,[K("div",jY,[K("div",$Y,[d.insert?(zt(),Nt("h5",qY,"Crear usuario")):(zt(),Nt("h5",HY,"Modificar usuario"))]),K("div",GY,[K("form",null,[K("div",WY,[e[17]||(e[17]=K("label",{for:"formNombre",class:"form-label"},"Nombre de usuario",-1)),tn(K("input",{type:"text",name:"nombre",class:"form-control",id:"formNombre",required:"",placeholder:"Introducir nombre","onUpdate:modelValue":e[2]||(e[2]=v=>d.usuario.nombre=v)},null,512),[[hn,d.usuario.nombre]])]),K("div",ZY,[e[18]||(e[18]=K("label",{for:"formInputFecha",class:"form-label"},"Fecha de nacimiento",-1)),tn(K("input",{type:"date",name:"fecha_nacimiento",class:"form-control",id:"formInputFecha",required:"","onUpdate:modelValue":e[3]||(e[3]=v=>d.usuario.fecha_nacimiento=v)},null,512),[[hn,d.usuario.fecha_nacimiento]])]),K("div",YY,[e[19]||(e[19]=K("label",{for:"exampleInputEmail1",class:"form-label"},"Dirección de correo electrónico",-1)),tn(K("input",{type:"email",name:"correo",class:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",required:"",placeholder:"Introducir correo electronico","onUpdate:modelValue":e[4]||(e[4]=v=>d.usuario.correo=v)},null,512),[[hn,d.usuario.correo]])]),K("div",XY,[e[20]||(e[20]=K("label",{for:"exampleInputPassword1",class:"form-label"},"Contraseña",-1)),tn(K("input",{type:"password",name:"contrasenya",class:"form-control",id:"exampleInputPassword1",required:"",placeholder:"Introducir contraseña","onUpdate:modelValue":e[5]||(e[5]=v=>d.usuario.contrasenya=v)},null,512),[[hn,d.usuario.contrasenya]])]),tn(K("select",{"onUpdate:modelValue":e[6]||(e[6]=v=>d.usuario.rol_id=v),class:"form-select"},[(zt(!0),Nt(ur,null,_n(d.roles,v=>(zt(),Nt("option",{key:v.id,value:v.id},oi(v.tipo_rol),9,KY))),128))],512),[[mp,d.usuario.rol_id]])]),d.isError?(zt(),Nt("p",JY,oi(d.messageError),1)):Jn("",!0)]),K("div",QY,[d.insert?(zt(),Nt("button",{key:0,type:"button",class:"btn btn-secondary",onClick:e[7]||(e[7]=v=>y.insertUsuarios())},"Crear")):(zt(),Nt("button",{key:1,type:"button",class:"btn btn-secondary",onClick:e[8]||(e[8]=v=>y.updateUsuarios())},"Editar")),e[21]||(e[21]=K("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal"},"Cerrar",-1))])])])])],64)}const tX=Wn(MY,[["render",eX]]);const iX={data(){return{pelicula_nuevas:[],myModal:{},pelicula_nueva:{},actores:[],messageError:"",isError:!1,insert:!1}},created(){this.selectPeliculaNueva(),this.selectActores()},methods:{showForm(){this.insert=!0,this.myModal=new ds("#peliculaNuevaModal"),this.myModal.show(),this.pelicula_nueva={}},selectActores(){const n=this;axios.get("actor").then(e=>{n.actores=e.data}).catch(e=>{console.log(e)})},updatePeliculaNueva(){const n=this;axios.put("pelicula_nueva/"+n.pelicula_nueva.id,n.pelicula_nueva).then(e=>{n.selectPeliculaNueva(),n.myModal.hide()}).catch(e=>{this.isError=!0,n.messageError=e.response.data.message})},insertPeliculaNueva(){const n=this;axios.post("pelicula_nueva",n.pelicula_nueva).then(e=>{n.selectPeliculaNueva(),n.myModal.hide()}).catch(e=>{this.isError=!0,n.messageError=e.response.data.message})},selectPeliculaNueva(){const n=this;axios.get("pelicula_nueva").then(e=>{n.pelicula_nuevas=e.data}).catch(e=>{console.log(e)})},editPeliculaNueva(n){this.insert=!1,this.pelicula_nueva=n,this.myModal=new ds("#peliculaNuevaModal"),this.myModal.show()},eliminarPeliculaNueva(n){this.isError=!1,this.pelicula_nueva=n,this.myModal=new ds("#deleteModal"),this.myModal.show()},deleteUsuario(n){const e=this;axios.delete("pelicula_nueva/"+n).then(o=>{e.selectPeliculaNueva(),e.myModal.hide()}).catch(o=>{this.isError=!0,e.messageError=o.response.data.message})}},mounted(){}},rX={class:"tabla-peliculas-nuevas"},nX={class:"tables-peliculaNueva"},sX={scope:"row"},oX={key:0},aX=["onClick"],lX=["onClick"],cX={class:"modal",tabindex:"-1",id:"deleteModal"},uX={class:"modal-dialog",role:"document"},hX={class:"modal-content"},dX={class:"modal-body"},fX={key:0,class:"alert alert-danger"},pX={class:"modal-footer"},mX={class:"modal",tabindex:"-1",id:"peliculaNuevaModal"},_X={class:"modal-dialog",role:"document"},gX={class:"modal-content"},yX={class:"modal-header"},vX={key:0,class:"modal-title"},xX={key:1,class:"modal-title"},bX={class:"modal-body"},wX={"data-mdb-input-init":"",class:"form-outline mb-4"},TX={"data-mdb-input-init":"",class:"form-outline mb-4"},EX={class:"mb-3"},SX={class:"mb-3"},AX={class:"mb-3"},CX={class:"mb-3"},MX={class:"mb-3"},IX={class:"mb-3"},PX={class:"mb-3"},RX={class:"mb-3"},DX=["value"],OX={key:0,class:"alert alert-danger"},LX={class:"modal-footer"};function kX(n,e,o,u,d,y){return zt(),Nt(ur,null,[K("div",null,[K("button",{onClick:e[0]||(e[0]=v=>y.showForm()),class:"anadirBoton"},e[14]||(e[14]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-plus-square",viewBox:"0 0 16 16"},[K("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),K("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"})],-1),K("strong",null," AÑADIR PELICULA NUEVA",-1)]))]),K("div",rX,[K("table",nX,[e[17]||(e[17]=K("thead",null,[K("tr",null,[K("th",{scope:"col"},"ID"),K("th",{scope:"col"},"Titulo"),K("th",{scope:"col"},"Imagen"),K("th",{scope:"col"},"Descripcion"),K("th",{scope:"col"},"Duracion"),K("th",{scope:"col"},"Restriccion de edad"),K("th",{scope:"col"},"Calificacion"),K("th",{scope:"col"},"Idioma"),K("th",{scope:"col"},"Fecha de estreno"),K("th",{scope:"col"},"Link de la pelicula"),K("th",{scope:"col"},"Actores"),K("th",{scope:"col"},"Accion")])],-1)),K("tbody",null,[(zt(!0),Nt(ur,null,_n(d.pelicula_nuevas,v=>(zt(),Nt("tr",{key:v.id},[K("th",sX,oi(v.id),1),K("td",null,oi(v.titulo),1),K("td",null,oi(v.image),1),K("td",null,oi(v.descripcion),1),K("td",null,oi(v.duracion),1),K("td",null,oi(v.restriccion_edad),1),K("td",null,oi(v.calificacion),1),K("td",null,oi(v.idioma),1),K("td",null,oi(v.fecha_estreno),1),K("td",null,oi(v.pelicula_src),1),v.actores?(zt(),Nt("span",oX,[(zt(!0),Nt(ur,null,_n(v.actores,r=>(zt(),Nt("span",{key:r.id},oi(r.nombre),1))),128))])):Jn("",!0),K("th",null,[K("button",{onClick:r=>y.editPeliculaNueva(v),class:"editarBoton"},e[15]||(e[15]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-pencil-square"},[K("path",{d:"M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"}),K("path",{"fill-rule":"evenodd",d:"M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"})],-1)]),8,aX)]),K("th",null,[K("button",{onClick:r=>y.eliminarPeliculaNueva(v),style:{border:"none",background:"none",cursor:"pointer",color:"rgb(255, 0, 0)"}},e[16]||(e[16]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[K("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"}),K("path",{d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"})],-1)]),8,lX)])]))),128))])])]),K("div",cX,[K("div",uX,[K("div",hX,[e[21]||(e[21]=K("div",{class:"modal-header"},[K("h5",{class:"modal-title"},"Borrar pelicula nueva"),K("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"})],-1)),K("div",dX,[K("p",null,[e[18]||(e[18]=Eo("¿ Seguro que quieres borrar a ")),K("strong",null,oi(d.pelicula_nueva.titulo),1),e[19]||(e[19]=Eo(" ?"))]),d.isError?(zt(),Nt("p",fX,oi(d.messageError),1)):Jn("",!0)]),K("div",pX,[K("button",{type:"button",class:"btn btn-primary",onClick:e[1]||(e[1]=v=>y.deleteUsuario(d.pelicula_nueva.id))},"Borrar"),e[20]||(e[20]=K("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Cancelar",-1))])])])]),K("div",mX,[K("div",_X,[K("div",gX,[K("div",yX,[d.insert?(zt(),Nt("h5",vX,"Crear Pelicula nueva")):(zt(),Nt("h5",xX,"Modificar Pelicula"))]),K("div",bX,[K("form",null,[K("div",wX,[e[22]||(e[22]=K("label",{for:"formNombre",class:"form-label"},"Titulo de la pelicula",-1)),tn(K("input",{type:"text",name:"titulo",class:"form-control",id:"formNombre",required:"",placeholder:"Introducir nombre","onUpdate:modelValue":e[2]||(e[2]=v=>d.pelicula_nueva.titulo=v)},null,512),[[hn,d.pelicula_nueva.titulo]])]),K("div",TX,[e[23]||(e[23]=K("label",{for:"formInputFecha",class:"form-label"},"URL imagen",-1)),tn(K("input",{type:"text",name:"image",class:"form-control",id:"formInputFecha",required:"","onUpdate:modelValue":e[3]||(e[3]=v=>d.pelicula_nueva.image=v)},null,512),[[hn,d.pelicula_nueva.image]])]),K("div",EX,[e[24]||(e[24]=K("label",{for:"exampleInputEmail1",class:"form-label"},"Descripcion",-1)),tn(K("input",{type:"text",name:"descripcion",class:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",required:"",placeholder:"Introducir correo electronico","onUpdate:modelValue":e[4]||(e[4]=v=>d.pelicula_nueva.descripcion=v)},null,512),[[hn,d.pelicula_nueva.descripcion]])]),K("div",SX,[e[25]||(e[25]=K("label",{for:"exampleInputEmail1",class:"form-label"},"Duracion",-1)),tn(K("input",{type:"number",name:"duracion",class:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",required:"",placeholder:"Introducir correo electronico","onUpdate:modelValue":e[5]||(e[5]=v=>d.pelicula_nueva.duracion=v)},null,512),[[hn,d.pelicula_nueva.duracion]])]),K("div",AX,[e[26]||(e[26]=K("label",{for:"exampleInputEmail1",class:"form-label"},"Restriccion de edad",-1)),tn(K("input",{type:"text",name:"restriccion_edad",class:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",required:"",placeholder:"Introducir correo electronico","onUpdate:modelValue":e[6]||(e[6]=v=>d.pelicula_nueva.restriccion_edad=v)},null,512),[[hn,d.pelicula_nueva.restriccion_edad]])]),K("div",CX,[e[27]||(e[27]=K("label",{for:"exampleInputEmail1",class:"form-label"},"Calificacion",-1)),tn(K("input",{type:"text",name:"calificacion",class:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",required:"",placeholder:"Introducir correo electronico","onUpdate:modelValue":e[7]||(e[7]=v=>d.pelicula_nueva.calificacion=v)},null,512),[[hn,d.pelicula_nueva.calificacion]])]),K("div",MX,[e[28]||(e[28]=K("label",{for:"exampleInputEmail1",class:"form-label"},"Idioma",-1)),tn(K("input",{type:"text",name:"idioma",class:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",required:"",placeholder:"Introducir correo electronico","onUpdate:modelValue":e[8]||(e[8]=v=>d.pelicula_nueva.idioma=v)},null,512),[[hn,d.pelicula_nueva.idioma]])]),K("div",IX,[e[29]||(e[29]=K("label",{for:"exampleInputEmail1",class:"form-label"},"Fecha de estreno",-1)),tn(K("input",{type:"date",name:"fecha_estreno",class:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",required:"",placeholder:"Introducir correo electronico","onUpdate:modelValue":e[9]||(e[9]=v=>d.pelicula_nueva.fecha_estreno=v)},null,512),[[hn,d.pelicula_nueva.fecha_estreno]])]),K("div",PX,[e[30]||(e[30]=K("label",{for:"exampleInputEmail1",class:"form-label"},"URL de la pelicula",-1)),tn(K("input",{type:"text",name:"pelicula_src",class:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",required:"",placeholder:"Introducir correo electronico","onUpdate:modelValue":e[10]||(e[10]=v=>d.pelicula_nueva.pelicula_src=v)},null,512),[[hn,d.pelicula_nueva.pelicula_src]])]),K("div",RX,[e[31]||(e[31]=K("label",{for:"actores",class:"form-label"},"Seleccionar Actores",-1)),tn(K("select",{"onUpdate:modelValue":e[11]||(e[11]=v=>d.pelicula_nueva.actores=v),class:"form-control",id:"actores",multiple:""},[(zt(!0),Nt(ur,null,_n(d.actores,v=>(zt(),Nt("option",{key:v.id,value:v.id},oi(v.nombre),9,DX))),128))],512),[[mp,d.pelicula_nueva.actores]])])]),d.isError?(zt(),Nt("p",OX,oi(d.messageError),1)):Jn("",!0)]),K("div",LX,[d.insert?(zt(),Nt("button",{key:0,type:"button",class:"btn btn-secondary",onClick:e[12]||(e[12]=v=>y.insertPeliculaNueva())},"Crear")):(zt(),Nt("button",{key:1,type:"button",class:"btn btn-secondary",onClick:e[13]||(e[13]=v=>y.updatePeliculaNueva())},"Editar")),e[32]||(e[32]=K("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal"},"Cerrar",-1))])])])])],64)}const zX=Wn(iX,[["render",kX]]);const FX={data(){return{evento_peliculas:[],peliculas_nuevas:[],myModal:{},evento_pelicula:{},messageError:"",isError:!1,insert:!1}},created(){this.selectEvento(),this.selectPelicula_nueva()},methods:{showForm(){this.insert=!0,this.isError=!1,this.myModal=new ds("#eventoModal"),this.myModal.show(),this.evento_pelicula={}},selectPelicula_nueva(){const n=this;axios.get("pelicula_nueva").then(e=>{n.peliculas_nuevas=e.data}).catch(e=>{console.log(e)})},updateUsuarios(){const n=this;axios.put("evento_pelicula/"+n.evento_pelicula.id,n.evento_pelicula).then(e=>{n.selectEvento(),n.myModal.hide()}).catch(e=>{this.isError=!0,n.messageError=e.response.data.message})},insertUsuarios(){const n=this;axios.post("evento_pelicula",n.evento_pelicula).then(e=>{n.selectEvento(),n.myModal.hide()}).catch(e=>{this.isError=!0,n.messageError=e.response.data.message})},selectEvento(){const n=this;axios.get("evento_pelicula").then(e=>{n.evento_peliculas=e.data}).catch(e=>{console.log(e)})},editEvento(n){this.insert=!1,this.evento_pelicula=n,this.myModal=new ds("#eventoModal"),this.myModal.show()},eliminarUsuario(n){this.isError=!1,this.evento_pelicula=n,this.myModal=new ds("#deleteEventoModal"),this.myModal.show()},deleteUsuario(n){const e=this;axios.delete("evento_pelicula/"+n).then(o=>{e.selectEvento(),e.myModal.hide()}).catch(o=>{this.isError=!0,e.messageError=o.response.data.message})}},mounted(){}},BX={class:"tabla-usuarios"},NX={class:"table"},VX={scope:"row"},UX={key:0},jX=["onClick"],$X=["onClick"],qX={class:"modal",tabindex:"-1",id:"deleteEventoModal"},HX={class:"modal-dialog",role:"document"},GX={class:"modal-content"},WX={class:"modal-body"},ZX={key:0,class:"alert alert-danger"},YX={class:"modal-footer"},XX={class:"modal",tabindex:"-1",id:"eventoModal"},KX={class:"modal-dialog",role:"document"},JX={class:"modal-content"},QX={class:"modal-header"},eK={key:0,class:"modal-title"},tK={key:1,class:"modal-title"},iK={class:"modal-body"},rK={"data-mdb-input-init":"",class:"form-outline mb-4"},nK={"data-mdb-input-init":"",class:"form-outline mb-4"},sK={class:"mb-3"},oK={class:"mb-3"},aK=["value"],lK={key:0,class:"alert alert-danger"},cK={class:"modal-footer"};function uK(n,e,o,u,d,y){return zt(),Nt(ur,null,[K("div",null,[K("button",{onClick:e[0]||(e[0]=v=>y.showForm()),class:"anadirBoton"},e[8]||(e[8]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-plus-square",viewBox:"0 0 16 16"},[K("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),K("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"})],-1),K("strong",null,"AÑADIR EVENTOS",-1)]))]),K("div",BX,[K("table",NX,[e[11]||(e[11]=K("thead",null,[K("tr",null,[K("th",{scope:"col"},"ID"),K("th",{scope:"col"},"Titulo Evento"),K("th",{scope:"col"},"Fecha inicio"),K("th",{scope:"col"},"Fecha final"),K("th",{scope:"col"},"Pelicula añadidas")])],-1)),K("tbody",null,[(zt(!0),Nt(ur,null,_n(d.evento_peliculas,v=>(zt(),Nt("tr",{key:v.id},[K("th",VX,oi(v.id),1),K("td",null,oi(v.titulo_evento),1),K("td",null,oi(v.fecha_inicio),1),K("td",null,oi(v.fecha_final),1),v.evento_pelicula_nueva?(zt(),Nt("span",UX,[(zt(!0),Nt(ur,null,_n(v.evento_pelicula_nueva,r=>(zt(),Nt("span",{key:r.id},oi(r.titulo),1))),128))])):Jn("",!0),K("th",null,[K("button",{onClick:r=>y.editEvento(v),class:"editarBoton"},e[9]||(e[9]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-pencil-square"},[K("path",{d:"M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"}),K("path",{"fill-rule":"evenodd",d:"M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"})],-1)]),8,jX)]),K("th",null,[K("button",{onClick:r=>y.eliminarUsuario(v),style:{border:"none",background:"none",cursor:"pointer",color:"rgb(255, 0, 0)"}},e[10]||(e[10]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[K("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"}),K("path",{d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"})],-1)]),8,$X)])]))),128))])])]),K("div",qX,[K("div",HX,[K("div",GX,[e[15]||(e[15]=K("div",{class:"modal-header"},[K("h5",{class:"modal-title"},"Borrar evento"),K("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"})],-1)),K("div",WX,[K("p",null,[e[12]||(e[12]=Eo("¿ Seguro que quieres borrar a ")),K("strong",null,oi(d.evento_pelicula.titulo_evento),1),e[13]||(e[13]=Eo(" ?"))]),d.isError?(zt(),Nt("p",ZX,oi(d.messageError),1)):Jn("",!0)]),K("div",YX,[K("button",{type:"button",class:"btn btn-primary",onClick:e[1]||(e[1]=v=>y.deleteUsuario(d.evento_pelicula.id))},"Borrar"),e[14]||(e[14]=K("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Cancelar",-1))])])])]),K("div",XX,[K("div",KX,[K("div",JX,[K("div",QX,[d.insert?(zt(),Nt("h5",eK,"Crear Evento")):(zt(),Nt("h5",tK,"Modificar Evento"))]),K("div",iK,[K("form",null,[K("div",rK,[e[16]||(e[16]=K("label",{for:"formNombre",class:"form-label"},"Nombre de evento",-1)),tn(K("input",{type:"text",name:"titulo_evento",class:"form-control",id:"formNombre",required:"",placeholder:"Introducir titulo","onUpdate:modelValue":e[2]||(e[2]=v=>d.evento_pelicula.titulo_evento=v)},null,512),[[hn,d.evento_pelicula.titulo_evento]])]),K("div",nK,[e[17]||(e[17]=K("label",{for:"formInputFecha",class:"form-label"},"Fecha de inicio",-1)),tn(K("input",{type:"date",name:"fecha_inicio",class:"form-control",id:"formInputFecha",required:"","onUpdate:modelValue":e[3]||(e[3]=v=>d.evento_pelicula.fecha_inicio=v)},null,512),[[hn,d.evento_pelicula.fecha_inicio]])]),K("div",sK,[e[18]||(e[18]=K("label",{for:"exampleInputEvento",class:"form-label"},"Fecha final",-1)),tn(K("input",{type:"date",name:"fecha_final",class:"form-control",id:"exampleInputEvento","aria-describedby":"eventoHelp",required:"",placeholder:"Introducir fecha final","onUpdate:modelValue":e[4]||(e[4]=v=>d.evento_pelicula.fecha_final=v)},null,512),[[hn,d.evento_pelicula.fecha_final]])]),K("div",oK,[e[19]||(e[19]=K("label",{for:"pelis",class:"form-label"},"Seleccionar Peliculas",-1)),tn(K("select",{"onUpdate:modelValue":e[5]||(e[5]=v=>d.evento_pelicula.evento_pelicula_nueva=v),class:"form-control",id:"pelis",multiple:""},[(zt(!0),Nt(ur,null,_n(d.peliculas_nuevas,v=>(zt(),Nt("option",{key:v.id,value:v.id},oi(v.titulo),9,aK))),128))],512),[[mp,d.evento_pelicula.evento_pelicula_nueva]])])]),d.isError?(zt(),Nt("p",lK,oi(d.messageError),1)):Jn("",!0)]),K("div",cK,[d.insert?(zt(),Nt("button",{key:0,type:"button",class:"btn btn-secondary",onClick:e[6]||(e[6]=v=>y.insertUsuarios())},"Añadir")):(zt(),Nt("button",{key:1,type:"button",class:"btn btn-secondary",onClick:e[7]||(e[7]=v=>y.updateUsuarios())},"Editar")),e[20]||(e[20]=K("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal"},"Cerrar",-1))])])])])],64)}const hK=Wn(FX,[["render",uK]]);const dK={data(){return{peliculas:[],myModal:{},actores:[],categorias:[],pelicula:{},messageError:"",isError:!1,insert:!1}},created(){this.selectPelicula(),this.selectActores(),this.selectCategorias()},methods:{showForm(){this.insert=!0,this.myModal=new ds("#peliculaModal"),this.myModal.show(),this.pelicula={}},selectActores(){const n=this;axios.get("actor").then(e=>{n.actores=e.data}).catch(e=>{console.log(e)})},selectCategorias(){const n=this;axios.get("categoria").then(e=>{n.categorias=e.data}).catch(e=>{console.log(e)})},updatePeliculas(){const n=this;axios.put("pelicula/"+n.pelicula.id,n.pelicula).then(e=>{n.selectPelicula(),n.myModal.hide()}).catch(e=>{this.isError=!0,n.messageError=e.response.data.message})},insertPeliculas(){const n=this;axios.post("pelicula",n.pelicula).then(e=>{n.selectPelicula(),n.myModal.hide()}).catch(e=>{this.isError=!0,n.messageError=e.response.data.message})},selectPelicula(){const n=this;axios.get("pelicula").then(e=>{n.peliculas=e.data}).catch(e=>{console.log(e)})},editPelicula(n){this.insert=!1,this.pelicula=n,this.myModal=new ds("#peliculaModal"),this.myModal.show()},eliminarPelicula(n){this.isError=!1,this.pelicula=n,this.myModal=new ds("#deleteModal"),this.myModal.show()},deletePelicula(n){const e=this;axios.delete("pelicula/"+n).then(o=>{e.selectPelicula(),e.myModal.hide()}).catch(o=>{this.isError=!0,e.messageError=o.response.data.message})}},mounted(){}},fK={class:"tabla-peliculas"},pK={class:"tables"},mK={scope:"row"},_K={key:0},gK={key:1},yK=["onClick"],vK=["onClick"],xK={class:"modal",tabindex:"-1",id:"deleteModal"},bK={class:"modal-dialog",role:"document"},wK={class:"modal-content"},TK={class:"modal-body"},EK={key:0,class:"alert alert-danger"},SK={class:"modal-footer"},AK={class:"modal",tabindex:"-1",id:"peliculaModal"},CK={class:"modal-dialog",role:"document"},MK={class:"modal-content"},IK={class:"modal-header"},PK={key:0,class:"modal-title"},RK={key:1,class:"modal-title"},DK={class:"modal-body"},OK={"data-mdb-input-init":"",class:"form-outline mb-4"},LK={"data-mdb-input-init":"",class:"form-outline mb-4"},kK={class:"mb-3"},zK={class:"mb-3"},FK={class:"mb-3"},BK={class:"mb-3"},NK={class:"mb-3"},VK={class:"mb-3"},UK={class:"mb-3"},jK={class:"mb-3"},$K=["value"],qK={class:"mb-3"},HK=["value"],GK={key:0,class:"alert alert-danger"},WK={class:"modal-footer"};function ZK(n,e,o,u,d,y){return zt(),Nt(ur,null,[K("div",null,[K("button",{onClick:e[0]||(e[0]=v=>y.showForm()),class:"anadirBoton"},e[15]||(e[15]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-plus-square",viewBox:"0 0 16 16"},[K("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),K("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"})],-1),K("strong",null," AÑADIR PELICULA",-1)]))]),K("div",fK,[K("table",pK,[e[18]||(e[18]=K("thead",null,[K("tr",null,[K("th",{scope:"col"},"ID"),K("th",{scope:"col"},"Titulo"),K("th",{scope:"col"},"Imagen"),K("th",{scope:"col"},"Descripcion"),K("th",{scope:"col"},"Duracion"),K("th",{scope:"col"},"Restriccion de edad"),K("th",{scope:"col"},"Calificacion"),K("th",{scope:"col"},"Idioma"),K("th",{scope:"col"},"Fecha de estreno"),K("th",{scope:"col"},"Link de la pelicula"),K("th",null,"Actores"),K("th",null,"Categorias"),K("th",{scope:"col"},"Acciones")])],-1)),K("tbody",null,[(zt(!0),Nt(ur,null,_n(d.peliculas,v=>(zt(),Nt("tr",{key:v.id},[K("th",mK,oi(v.id),1),K("td",null,oi(v.titulo),1),K("td",null,oi(v.image),1),K("td",null,oi(v.descripcion),1),K("td",null,oi(v.duracion),1),K("td",null,oi(v.restriccion_edad),1),K("td",null,oi(v.calificacion),1),K("td",null,oi(v.idioma),1),K("td",null,oi(v.fecha_estreno),1),K("td",null,oi(v.pelicula_src),1),v.actores?(zt(),Nt("span",_K,[(zt(!0),Nt(ur,null,_n(v.actores,r=>(zt(),Nt("span",{key:r.id},oi(r.nombre),1))),128))])):Jn("",!0),v.categoria_pelicula?(zt(),Nt("span",gK,[(zt(!0),Nt(ur,null,_n(v.categoria_pelicula,r=>(zt(),Nt("span",{key:r.id},oi(r.categoria),1))),128))])):Jn("",!0),K("th",null,[K("button",{onClick:r=>y.editPelicula(v),class:"editarBoton"},e[16]||(e[16]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-pencil-square"},[K("path",{d:"M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"}),K("path",{"fill-rule":"evenodd",d:"M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"})],-1)]),8,yK)]),K("th",null,[K("button",{onClick:r=>y.eliminarPelicula(v),style:{border:"none",background:"none",cursor:"pointer",color:"rgb(255, 0, 0)"}},e[17]||(e[17]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[K("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"}),K("path",{d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"})],-1)]),8,vK)])]))),128))])])]),K("div",xK,[K("div",bK,[K("div",wK,[e[22]||(e[22]=K("div",{class:"modal-header"},[K("h5",{class:"modal-title"},"Borrar pelicula nueva"),K("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"})],-1)),K("div",TK,[K("p",null,[e[19]||(e[19]=Eo("¿ Seguro que quieres borrar a ")),K("strong",null,oi(d.pelicula.titulo),1),e[20]||(e[20]=Eo(" ?"))]),d.isError?(zt(),Nt("p",EK,oi(d.messageError),1)):Jn("",!0)]),K("div",SK,[K("button",{type:"button",class:"btn btn-primary",onClick:e[1]||(e[1]=v=>y.deletePelicula(d.pelicula.id))},"Borrar"),e[21]||(e[21]=K("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Cancelar",-1))])])])]),K("div",AK,[K("div",CK,[K("div",MK,[K("div",IK,[d.insert?(zt(),Nt("h5",PK,"Crear Pelicula nueva")):(zt(),Nt("h5",RK,"Modificar Pelicula"))]),K("div",DK,[K("form",null,[K("div",OK,[e[23]||(e[23]=K("label",{for:"formNombre",class:"form-label"},"Titulo de la pelicula",-1)),tn(K("input",{type:"text",name:"titulo",class:"form-control",id:"formNombre",required:"",placeholder:"Introducir titulo","onUpdate:modelValue":e[2]||(e[2]=v=>d.pelicula.titulo=v)},null,512),[[hn,d.pelicula.titulo]])]),K("div",LK,[e[24]||(e[24]=K("label",{for:"formInputFecha",class:"form-label"},"URL imagen",-1)),tn(K("input",{type:"text",name:"image",class:"form-control",id:"formInputFecha",required:"","onUpdate:modelValue":e[3]||(e[3]=v=>d.pelicula.image=v)},null,512),[[hn,d.pelicula.image]])]),K("div",kK,[e[25]||(e[25]=K("label",{for:"exampleInputEmail1",class:"form-label"},"Descripcion",-1)),tn(K("input",{type:"text",name:"descripcion",class:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",required:"",placeholder:"Descripcion","onUpdate:modelValue":e[4]||(e[4]=v=>d.pelicula.descripcion=v)},null,512),[[hn,d.pelicula.descripcion]])]),K("div",zK,[e[26]||(e[26]=K("label",{for:"exampleInputEmail1",class:"form-label"},"Duracion",-1)),tn(K("input",{type:"number",name:"duracion",class:"form-control",id:"exampleInputEmail1",required:"",placeholder:"Duracion","onUpdate:modelValue":e[5]||(e[5]=v=>d.pelicula.duracion=v)},null,512),[[hn,d.pelicula.duracion]])]),K("div",FK,[e[27]||(e[27]=K("label",{for:"exampleInputEmail1",class:"form-label"},"Restriccion de edad",-1)),tn(K("input",{type:"text",name:"restriccion_edad",class:"form-control",id:"exampleInputEmail1",required:"",placeholder:"Restriccion de edad","onUpdate:modelValue":e[6]||(e[6]=v=>d.pelicula.restriccion_edad=v)},null,512),[[hn,d.pelicula.restriccion_edad]])]),K("div",BK,[e[28]||(e[28]=K("label",{for:"exampleInputEmail1",class:"form-label"},"Calificacion",-1)),tn(K("input",{type:"text",name:"calificacion",class:"form-control",id:"exampleInputEmail1",required:"",placeholder:"Calificacion","onUpdate:modelValue":e[7]||(e[7]=v=>d.pelicula.calificacion=v)},null,512),[[hn,d.pelicula.calificacion]])]),K("div",NK,[e[29]||(e[29]=K("label",{for:"exampleInputEmail1",class:"form-label"},"Idioma",-1)),tn(K("input",{type:"text",name:"idioma",class:"form-control",id:"exampleInputEmail1",required:"",placeholder:"Idioma","onUpdate:modelValue":e[8]||(e[8]=v=>d.pelicula.idioma=v)},null,512),[[hn,d.pelicula.idioma]])]),K("div",VK,[e[30]||(e[30]=K("label",{for:"exampleInputEmail1",class:"form-label"},"Fecha de estreno",-1)),tn(K("input",{type:"date",name:"fecha_estreno",class:"form-control",id:"exampleInputEmail1",required:"",placeholder:"Fecha de estreno","onUpdate:modelValue":e[9]||(e[9]=v=>d.pelicula.fecha_estreno=v)},null,512),[[hn,d.pelicula.fecha_estreno]])]),K("div",UK,[e[31]||(e[31]=K("label",{for:"exampleInputEmail1",class:"form-label"},"URL de la pelicula",-1)),tn(K("input",{type:"text",name:"pelicula_src",class:"form-control",id:"exampleInputEmail1",required:"",placeholder:"URL de la pelicula","onUpdate:modelValue":e[10]||(e[10]=v=>d.pelicula.pelicula_src=v)},null,512),[[hn,d.pelicula.pelicula_src]])]),K("div",jK,[e[32]||(e[32]=K("label",{for:"actores",class:"form-label"},"Seleccionar Actores",-1)),tn(K("select",{"onUpdate:modelValue":e[11]||(e[11]=v=>d.pelicula.actores=v),class:"form-control",id:"actores",multiple:""},[(zt(!0),Nt(ur,null,_n(d.actores,v=>(zt(),Nt("option",{key:v.id,value:v.id},oi(v.nombre),9,$K))),128))],512),[[mp,d.pelicula.actores]])]),K("div",qK,[e[33]||(e[33]=K("label",{for:"inCategorias",class:"inputCategoria"},"Seleccionar categorias",-1)),tn(K("select",{"onUpdate:modelValue":e[12]||(e[12]=v=>d.pelicula.categorias=v),class:"form-control",id:"inCategorias",multiple:""},[(zt(!0),Nt(ur,null,_n(d.categorias,v=>(zt(),Nt("option",{key:v.id,value:v.id},oi(v.categoria),9,HK))),128))],512),[[mp,d.pelicula.categorias]])])]),d.isError?(zt(),Nt("p",GK,oi(d.messageError),1)):Jn("",!0)]),K("div",WK,[d.insert?(zt(),Nt("button",{key:0,type:"button",class:"btn btn-secondary",onClick:e[13]||(e[13]=v=>y.insertPeliculas())},"Crear")):(zt(),Nt("button",{key:1,type:"button",class:"btn btn-secondary",onClick:e[14]||(e[14]=v=>y.updatePeliculas())},"Editar")),e[34]||(e[34]=K("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal"},"Cerrar",-1))])])])])],64)}const YK=Wn(dK,[["render",ZK],["__scopeId","data-v-f1ea740d"]]);var jz=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $z(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var qz={exports:{}};(function(n,e){(function(o,u){n.exports=u()})(jz,function(){var o,u,d;function y(r,D){if(!o)o=D;else if(!u)u=D;else{var B="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+o+")(sharedChunk); ("+u+")(sharedChunk); self.onerror = null;",F={};o(F),d=D(F),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(d.workerUrl=window.URL.createObjectURL(new Blob([B],{type:"text/javascript"})))}}y(["exports"],function(r){function D(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var B,F={},N={};function Q(){if(B)return N;B=1,Object.defineProperty(N,"__esModule",{value:!0}),N.setMatrixArrayType=function(m){N.ARRAY_TYPE=t=m},N.toRadian=function(m){return m*c},N.equals=function(m,h){return Math.abs(m-h)<=l*Math.max(1,Math.abs(m),Math.abs(h))},N.RANDOM=N.ARRAY_TYPE=N.EPSILON=void 0;var l=1e-6;N.EPSILON=l;var t=typeof Float32Array<"u"?Float32Array:Array;N.ARRAY_TYPE=t;var s=Math.random;N.RANDOM=s;var c=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var m=0,h=arguments.length;h--;)m+=arguments[h]*arguments[h];return Math.sqrt(m)}),N}var q,X={};function G(){if(q)return X;function l(h){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},l(h)}q=1,Object.defineProperty(X,"__esModule",{value:!0}),X.create=function(){var h=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h},X.clone=function(h){var _=new t.ARRAY_TYPE(4);return _[0]=h[0],_[1]=h[1],_[2]=h[2],_[3]=h[3],_},X.copy=function(h,_){return h[0]=_[0],h[1]=_[1],h[2]=_[2],h[3]=_[3],h},X.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h},X.fromValues=function(h,_,w,S){var P=new t.ARRAY_TYPE(4);return P[0]=h,P[1]=_,P[2]=w,P[3]=S,P},X.set=function(h,_,w,S,P){return h[0]=_,h[1]=w,h[2]=S,h[3]=P,h},X.transpose=function(h,_){if(h===_){var w=_[1];h[1]=_[2],h[2]=w}else h[0]=_[0],h[1]=_[2],h[2]=_[1],h[3]=_[3];return h},X.invert=function(h,_){var w=_[0],S=_[1],P=_[2],x=_[3],A=w*x-P*S;return A?(h[0]=x*(A=1/A),h[1]=-S*A,h[2]=-P*A,h[3]=w*A,h):null},X.adjoint=function(h,_){var w=_[0];return h[0]=_[3],h[1]=-_[1],h[2]=-_[2],h[3]=w,h},X.determinant=function(h){return h[0]*h[3]-h[2]*h[1]},X.multiply=c,X.rotate=function(h,_,w){var S=_[0],P=_[1],x=_[2],A=_[3],I=Math.sin(w),E=Math.cos(w);return h[0]=S*E+x*I,h[1]=P*E+A*I,h[2]=S*-I+x*E,h[3]=P*-I+A*E,h},X.scale=function(h,_,w){var S=_[1],P=_[2],x=_[3],A=w[0],I=w[1];return h[0]=_[0]*A,h[1]=S*A,h[2]=P*I,h[3]=x*I,h},X.fromRotation=function(h,_){var w=Math.sin(_),S=Math.cos(_);return h[0]=S,h[1]=w,h[2]=-w,h[3]=S,h},X.fromScaling=function(h,_){return h[0]=_[0],h[1]=0,h[2]=0,h[3]=_[1],h},X.str=function(h){return"mat2("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+")"},X.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3])},X.LDU=function(h,_,w,S){return h[2]=S[2]/S[0],w[0]=S[0],w[1]=S[1],w[3]=S[3]-h[2]*w[1],[h,_,w]},X.add=function(h,_,w){return h[0]=_[0]+w[0],h[1]=_[1]+w[1],h[2]=_[2]+w[2],h[3]=_[3]+w[3],h},X.subtract=m,X.exactEquals=function(h,_){return h[0]===_[0]&&h[1]===_[1]&&h[2]===_[2]&&h[3]===_[3]},X.equals=function(h,_){var w=h[0],S=h[1],P=h[2],x=h[3],A=_[0],I=_[1],E=_[2],C=_[3];return Math.abs(w-A)<=t.EPSILON*Math.max(1,Math.abs(w),Math.abs(A))&&Math.abs(S-I)<=t.EPSILON*Math.max(1,Math.abs(S),Math.abs(I))&&Math.abs(P-E)<=t.EPSILON*Math.max(1,Math.abs(P),Math.abs(E))&&Math.abs(x-C)<=t.EPSILON*Math.max(1,Math.abs(x),Math.abs(C))},X.multiplyScalar=function(h,_,w){return h[0]=_[0]*w,h[1]=_[1]*w,h[2]=_[2]*w,h[3]=_[3]*w,h},X.multiplyScalarAndAdd=function(h,_,w,S){return h[0]=_[0]+w[0]*S,h[1]=_[1]+w[1]*S,h[2]=_[2]+w[2]*S,h[3]=_[3]+w[3]*S,h},X.sub=X.mul=void 0;var t=function(h,_){if(h&&h.__esModule)return h;if(h===null||l(h)!=="object"&&typeof h!="function")return{default:h};var w=s(void 0);if(w&&w.has(h))return w.get(h);var S={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in h)if(x!=="default"&&Object.prototype.hasOwnProperty.call(h,x)){var A=P?Object.getOwnPropertyDescriptor(h,x):null;A&&(A.get||A.set)?Object.defineProperty(S,x,A):S[x]=h[x]}return S.default=h,w&&w.set(h,S),S}(Q());function s(h){if(typeof WeakMap!="function")return null;var _=new WeakMap,w=new WeakMap;return(s=function(S){return S?w:_})(h)}function c(h,_,w){var S=_[0],P=_[1],x=_[2],A=_[3],I=w[0],E=w[1],C=w[2],R=w[3];return h[0]=S*I+x*E,h[1]=P*I+A*E,h[2]=S*C+x*R,h[3]=P*C+A*R,h}function m(h,_,w){return h[0]=_[0]-w[0],h[1]=_[1]-w[1],h[2]=_[2]-w[2],h[3]=_[3]-w[3],h}return X.mul=c,X.sub=m,X}var ae,xe={};function Te(){if(ae)return xe;function l(h){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},l(h)}ae=1,Object.defineProperty(xe,"__esModule",{value:!0}),xe.create=function(){var h=new t.ARRAY_TYPE(6);return t.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[4]=0,h[5]=0),h[0]=1,h[3]=1,h},xe.clone=function(h){var _=new t.ARRAY_TYPE(6);return _[0]=h[0],_[1]=h[1],_[2]=h[2],_[3]=h[3],_[4]=h[4],_[5]=h[5],_},xe.copy=function(h,_){return h[0]=_[0],h[1]=_[1],h[2]=_[2],h[3]=_[3],h[4]=_[4],h[5]=_[5],h},xe.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=0,h[5]=0,h},xe.fromValues=function(h,_,w,S,P,x){var A=new t.ARRAY_TYPE(6);return A[0]=h,A[1]=_,A[2]=w,A[3]=S,A[4]=P,A[5]=x,A},xe.set=function(h,_,w,S,P,x,A){return h[0]=_,h[1]=w,h[2]=S,h[3]=P,h[4]=x,h[5]=A,h},xe.invert=function(h,_){var w=_[0],S=_[1],P=_[2],x=_[3],A=_[4],I=_[5],E=w*x-S*P;return E?(h[0]=x*(E=1/E),h[1]=-S*E,h[2]=-P*E,h[3]=w*E,h[4]=(P*I-x*A)*E,h[5]=(S*A-w*I)*E,h):null},xe.determinant=function(h){return h[0]*h[3]-h[1]*h[2]},xe.multiply=c,xe.rotate=function(h,_,w){var S=_[0],P=_[1],x=_[2],A=_[3],I=_[4],E=_[5],C=Math.sin(w),R=Math.cos(w);return h[0]=S*R+x*C,h[1]=P*R+A*C,h[2]=S*-C+x*R,h[3]=P*-C+A*R,h[4]=I,h[5]=E,h},xe.scale=function(h,_,w){var S=_[1],P=_[2],x=_[3],A=_[4],I=_[5],E=w[0],C=w[1];return h[0]=_[0]*E,h[1]=S*E,h[2]=P*C,h[3]=x*C,h[4]=A,h[5]=I,h},xe.translate=function(h,_,w){var S=_[0],P=_[1],x=_[2],A=_[3],I=_[4],E=_[5],C=w[0],R=w[1];return h[0]=S,h[1]=P,h[2]=x,h[3]=A,h[4]=S*C+x*R+I,h[5]=P*C+A*R+E,h},xe.fromRotation=function(h,_){var w=Math.sin(_),S=Math.cos(_);return h[0]=S,h[1]=w,h[2]=-w,h[3]=S,h[4]=0,h[5]=0,h},xe.fromScaling=function(h,_){return h[0]=_[0],h[1]=0,h[2]=0,h[3]=_[1],h[4]=0,h[5]=0,h},xe.fromTranslation=function(h,_){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=_[0],h[5]=_[1],h},xe.str=function(h){return"mat2d("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+")"},xe.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],1)},xe.add=function(h,_,w){return h[0]=_[0]+w[0],h[1]=_[1]+w[1],h[2]=_[2]+w[2],h[3]=_[3]+w[3],h[4]=_[4]+w[4],h[5]=_[5]+w[5],h},xe.subtract=m,xe.multiplyScalar=function(h,_,w){return h[0]=_[0]*w,h[1]=_[1]*w,h[2]=_[2]*w,h[3]=_[3]*w,h[4]=_[4]*w,h[5]=_[5]*w,h},xe.multiplyScalarAndAdd=function(h,_,w,S){return h[0]=_[0]+w[0]*S,h[1]=_[1]+w[1]*S,h[2]=_[2]+w[2]*S,h[3]=_[3]+w[3]*S,h[4]=_[4]+w[4]*S,h[5]=_[5]+w[5]*S,h},xe.exactEquals=function(h,_){return h[0]===_[0]&&h[1]===_[1]&&h[2]===_[2]&&h[3]===_[3]&&h[4]===_[4]&&h[5]===_[5]},xe.equals=function(h,_){var w=h[0],S=h[1],P=h[2],x=h[3],A=h[4],I=h[5],E=_[0],C=_[1],R=_[2],z=_[3],V=_[4],W=_[5];return Math.abs(w-E)<=t.EPSILON*Math.max(1,Math.abs(w),Math.abs(E))&&Math.abs(S-C)<=t.EPSILON*Math.max(1,Math.abs(S),Math.abs(C))&&Math.abs(P-R)<=t.EPSILON*Math.max(1,Math.abs(P),Math.abs(R))&&Math.abs(x-z)<=t.EPSILON*Math.max(1,Math.abs(x),Math.abs(z))&&Math.abs(A-V)<=t.EPSILON*Math.max(1,Math.abs(A),Math.abs(V))&&Math.abs(I-W)<=t.EPSILON*Math.max(1,Math.abs(I),Math.abs(W))},xe.sub=xe.mul=void 0;var t=function(h,_){if(h&&h.__esModule)return h;if(h===null||l(h)!=="object"&&typeof h!="function")return{default:h};var w=s(void 0);if(w&&w.has(h))return w.get(h);var S={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in h)if(x!=="default"&&Object.prototype.hasOwnProperty.call(h,x)){var A=P?Object.getOwnPropertyDescriptor(h,x):null;A&&(A.get||A.set)?Object.defineProperty(S,x,A):S[x]=h[x]}return S.default=h,w&&w.set(h,S),S}(Q());function s(h){if(typeof WeakMap!="function")return null;var _=new WeakMap,w=new WeakMap;return(s=function(S){return S?w:_})(h)}function c(h,_,w){var S=_[0],P=_[1],x=_[2],A=_[3],I=_[4],E=_[5],C=w[0],R=w[1],z=w[2],V=w[3],W=w[4],Y=w[5];return h[0]=S*C+x*R,h[1]=P*C+A*R,h[2]=S*z+x*V,h[3]=P*z+A*V,h[4]=S*W+x*Y+I,h[5]=P*W+A*Y+E,h}function m(h,_,w){return h[0]=_[0]-w[0],h[1]=_[1]-w[1],h[2]=_[2]-w[2],h[3]=_[3]-w[3],h[4]=_[4]-w[4],h[5]=_[5]-w[5],h}return xe.mul=c,xe.sub=m,xe}var fe,ne={};function ue(){if(fe)return ne;function l(h){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},l(h)}fe=1,Object.defineProperty(ne,"__esModule",{value:!0}),ne.create=function(){var h=new t.ARRAY_TYPE(9);return t.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1,h},ne.fromMat4=function(h,_){return h[0]=_[0],h[1]=_[1],h[2]=_[2],h[3]=_[4],h[4]=_[5],h[5]=_[6],h[6]=_[8],h[7]=_[9],h[8]=_[10],h},ne.clone=function(h){var _=new t.ARRAY_TYPE(9);return _[0]=h[0],_[1]=h[1],_[2]=h[2],_[3]=h[3],_[4]=h[4],_[5]=h[5],_[6]=h[6],_[7]=h[7],_[8]=h[8],_},ne.copy=function(h,_){return h[0]=_[0],h[1]=_[1],h[2]=_[2],h[3]=_[3],h[4]=_[4],h[5]=_[5],h[6]=_[6],h[7]=_[7],h[8]=_[8],h},ne.fromValues=function(h,_,w,S,P,x,A,I,E){var C=new t.ARRAY_TYPE(9);return C[0]=h,C[1]=_,C[2]=w,C[3]=S,C[4]=P,C[5]=x,C[6]=A,C[7]=I,C[8]=E,C},ne.set=function(h,_,w,S,P,x,A,I,E,C){return h[0]=_,h[1]=w,h[2]=S,h[3]=P,h[4]=x,h[5]=A,h[6]=I,h[7]=E,h[8]=C,h},ne.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},ne.transpose=function(h,_){if(h===_){var w=_[1],S=_[2],P=_[5];h[1]=_[3],h[2]=_[6],h[3]=w,h[5]=_[7],h[6]=S,h[7]=P}else h[0]=_[0],h[1]=_[3],h[2]=_[6],h[3]=_[1],h[4]=_[4],h[5]=_[7],h[6]=_[2],h[7]=_[5],h[8]=_[8];return h},ne.invert=function(h,_){var w=_[0],S=_[1],P=_[2],x=_[3],A=_[4],I=_[5],E=_[6],C=_[7],R=_[8],z=R*A-I*C,V=-R*x+I*E,W=C*x-A*E,Y=w*z+S*V+P*W;return Y?(h[0]=z*(Y=1/Y),h[1]=(-R*S+P*C)*Y,h[2]=(I*S-P*A)*Y,h[3]=V*Y,h[4]=(R*w-P*E)*Y,h[5]=(-I*w+P*x)*Y,h[6]=W*Y,h[7]=(-C*w+S*E)*Y,h[8]=(A*w-S*x)*Y,h):null},ne.adjoint=function(h,_){var w=_[0],S=_[1],P=_[2],x=_[3],A=_[4],I=_[5],E=_[6],C=_[7],R=_[8];return h[0]=A*R-I*C,h[1]=P*C-S*R,h[2]=S*I-P*A,h[3]=I*E-x*R,h[4]=w*R-P*E,h[5]=P*x-w*I,h[6]=x*C-A*E,h[7]=S*E-w*C,h[8]=w*A-S*x,h},ne.determinant=function(h){var _=h[3],w=h[4],S=h[5],P=h[6],x=h[7],A=h[8];return h[0]*(A*w-S*x)+h[1]*(-A*_+S*P)+h[2]*(x*_-w*P)},ne.multiply=c,ne.translate=function(h,_,w){var S=_[0],P=_[1],x=_[2],A=_[3],I=_[4],E=_[5],C=_[6],R=_[7],z=_[8],V=w[0],W=w[1];return h[0]=S,h[1]=P,h[2]=x,h[3]=A,h[4]=I,h[5]=E,h[6]=V*S+W*A+C,h[7]=V*P+W*I+R,h[8]=V*x+W*E+z,h},ne.rotate=function(h,_,w){var S=_[0],P=_[1],x=_[2],A=_[3],I=_[4],E=_[5],C=_[6],R=_[7],z=_[8],V=Math.sin(w),W=Math.cos(w);return h[0]=W*S+V*A,h[1]=W*P+V*I,h[2]=W*x+V*E,h[3]=W*A-V*S,h[4]=W*I-V*P,h[5]=W*E-V*x,h[6]=C,h[7]=R,h[8]=z,h},ne.scale=function(h,_,w){var S=w[0],P=w[1];return h[0]=S*_[0],h[1]=S*_[1],h[2]=S*_[2],h[3]=P*_[3],h[4]=P*_[4],h[5]=P*_[5],h[6]=_[6],h[7]=_[7],h[8]=_[8],h},ne.fromTranslation=function(h,_){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=_[0],h[7]=_[1],h[8]=1,h},ne.fromRotation=function(h,_){var w=Math.sin(_),S=Math.cos(_);return h[0]=S,h[1]=w,h[2]=0,h[3]=-w,h[4]=S,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},ne.fromScaling=function(h,_){return h[0]=_[0],h[1]=0,h[2]=0,h[3]=0,h[4]=_[1],h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},ne.fromMat2d=function(h,_){return h[0]=_[0],h[1]=_[1],h[2]=0,h[3]=_[2],h[4]=_[3],h[5]=0,h[6]=_[4],h[7]=_[5],h[8]=1,h},ne.fromQuat=function(h,_){var w=_[0],S=_[1],P=_[2],x=_[3],A=w+w,I=S+S,E=P+P,C=w*A,R=S*A,z=S*I,V=P*A,W=P*I,Y=P*E,$=x*A,J=x*I,ie=x*E;return h[0]=1-z-Y,h[3]=R-ie,h[6]=V+J,h[1]=R+ie,h[4]=1-C-Y,h[7]=W-$,h[2]=V-J,h[5]=W+$,h[8]=1-C-z,h},ne.normalFromMat4=function(h,_){var w=_[0],S=_[1],P=_[2],x=_[3],A=_[4],I=_[5],E=_[6],C=_[7],R=_[8],z=_[9],V=_[10],W=_[11],Y=_[12],$=_[13],J=_[14],ie=_[15],ge=w*I-S*A,Pe=w*E-P*A,Me=w*C-x*A,Ce=S*E-P*I,$e=S*C-x*I,Re=P*C-x*E,He=R*$-z*Y,Je=R*J-V*Y,Xe=R*ie-W*Y,tt=z*J-V*$,at=z*ie-W*$,ft=V*ie-W*J,nt=ge*ft-Pe*at+Me*tt+Ce*Xe-$e*Je+Re*He;return nt?(h[0]=(I*ft-E*at+C*tt)*(nt=1/nt),h[1]=(E*Xe-A*ft-C*Je)*nt,h[2]=(A*at-I*Xe+C*He)*nt,h[3]=(P*at-S*ft-x*tt)*nt,h[4]=(w*ft-P*Xe+x*Je)*nt,h[5]=(S*Xe-w*at-x*He)*nt,h[6]=($*Re-J*$e+ie*Ce)*nt,h[7]=(J*Me-Y*Re-ie*Pe)*nt,h[8]=(Y*$e-$*Me+ie*ge)*nt,h):null},ne.projection=function(h,_,w){return h[0]=2/_,h[1]=0,h[2]=0,h[3]=0,h[4]=-2/w,h[5]=0,h[6]=-1,h[7]=1,h[8]=1,h},ne.str=function(h){return"mat3("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+", "+h[6]+", "+h[7]+", "+h[8]+")"},ne.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],h[8])},ne.add=function(h,_,w){return h[0]=_[0]+w[0],h[1]=_[1]+w[1],h[2]=_[2]+w[2],h[3]=_[3]+w[3],h[4]=_[4]+w[4],h[5]=_[5]+w[5],h[6]=_[6]+w[6],h[7]=_[7]+w[7],h[8]=_[8]+w[8],h},ne.subtract=m,ne.multiplyScalar=function(h,_,w){return h[0]=_[0]*w,h[1]=_[1]*w,h[2]=_[2]*w,h[3]=_[3]*w,h[4]=_[4]*w,h[5]=_[5]*w,h[6]=_[6]*w,h[7]=_[7]*w,h[8]=_[8]*w,h},ne.multiplyScalarAndAdd=function(h,_,w,S){return h[0]=_[0]+w[0]*S,h[1]=_[1]+w[1]*S,h[2]=_[2]+w[2]*S,h[3]=_[3]+w[3]*S,h[4]=_[4]+w[4]*S,h[5]=_[5]+w[5]*S,h[6]=_[6]+w[6]*S,h[7]=_[7]+w[7]*S,h[8]=_[8]+w[8]*S,h},ne.exactEquals=function(h,_){return h[0]===_[0]&&h[1]===_[1]&&h[2]===_[2]&&h[3]===_[3]&&h[4]===_[4]&&h[5]===_[5]&&h[6]===_[6]&&h[7]===_[7]&&h[8]===_[8]},ne.equals=function(h,_){var w=h[0],S=h[1],P=h[2],x=h[3],A=h[4],I=h[5],E=h[6],C=h[7],R=h[8],z=_[0],V=_[1],W=_[2],Y=_[3],$=_[4],J=_[5],ie=_[6],ge=_[7],Pe=_[8];return Math.abs(w-z)<=t.EPSILON*Math.max(1,Math.abs(w),Math.abs(z))&&Math.abs(S-V)<=t.EPSILON*Math.max(1,Math.abs(S),Math.abs(V))&&Math.abs(P-W)<=t.EPSILON*Math.max(1,Math.abs(P),Math.abs(W))&&Math.abs(x-Y)<=t.EPSILON*Math.max(1,Math.abs(x),Math.abs(Y))&&Math.abs(A-$)<=t.EPSILON*Math.max(1,Math.abs(A),Math.abs($))&&Math.abs(I-J)<=t.EPSILON*Math.max(1,Math.abs(I),Math.abs(J))&&Math.abs(E-ie)<=t.EPSILON*Math.max(1,Math.abs(E),Math.abs(ie))&&Math.abs(C-ge)<=t.EPSILON*Math.max(1,Math.abs(C),Math.abs(ge))&&Math.abs(R-Pe)<=t.EPSILON*Math.max(1,Math.abs(R),Math.abs(Pe))},ne.sub=ne.mul=void 0;var t=function(h,_){if(h&&h.__esModule)return h;if(h===null||l(h)!=="object"&&typeof h!="function")return{default:h};var w=s(void 0);if(w&&w.has(h))return w.get(h);var S={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in h)if(x!=="default"&&Object.prototype.hasOwnProperty.call(h,x)){var A=P?Object.getOwnPropertyDescriptor(h,x):null;A&&(A.get||A.set)?Object.defineProperty(S,x,A):S[x]=h[x]}return S.default=h,w&&w.set(h,S),S}(Q());function s(h){if(typeof WeakMap!="function")return null;var _=new WeakMap,w=new WeakMap;return(s=function(S){return S?w:_})(h)}function c(h,_,w){var S=_[0],P=_[1],x=_[2],A=_[3],I=_[4],E=_[5],C=_[6],R=_[7],z=_[8],V=w[0],W=w[1],Y=w[2],$=w[3],J=w[4],ie=w[5],ge=w[6],Pe=w[7],Me=w[8];return h[0]=V*S+W*A+Y*C,h[1]=V*P+W*I+Y*R,h[2]=V*x+W*E+Y*z,h[3]=$*S+J*A+ie*C,h[4]=$*P+J*I+ie*R,h[5]=$*x+J*E+ie*z,h[6]=ge*S+Pe*A+Me*C,h[7]=ge*P+Pe*I+Me*R,h[8]=ge*x+Pe*E+Me*z,h}function m(h,_,w){return h[0]=_[0]-w[0],h[1]=_[1]-w[1],h[2]=_[2]-w[2],h[3]=_[3]-w[3],h[4]=_[4]-w[4],h[5]=_[5]-w[5],h[6]=_[6]-w[6],h[7]=_[7]-w[7],h[8]=_[8]-w[8],h}return ne.mul=c,ne.sub=m,ne}var ye,le={};function re(){if(ye)return le;function l(x){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},l(x)}ye=1,Object.defineProperty(le,"__esModule",{value:!0}),le.create=function(){var x=new t.ARRAY_TYPE(16);return t.ARRAY_TYPE!=Float32Array&&(x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=0,x[12]=0,x[13]=0,x[14]=0),x[0]=1,x[5]=1,x[10]=1,x[15]=1,x},le.clone=function(x){var A=new t.ARRAY_TYPE(16);return A[0]=x[0],A[1]=x[1],A[2]=x[2],A[3]=x[3],A[4]=x[4],A[5]=x[5],A[6]=x[6],A[7]=x[7],A[8]=x[8],A[9]=x[9],A[10]=x[10],A[11]=x[11],A[12]=x[12],A[13]=x[13],A[14]=x[14],A[15]=x[15],A},le.copy=function(x,A){return x[0]=A[0],x[1]=A[1],x[2]=A[2],x[3]=A[3],x[4]=A[4],x[5]=A[5],x[6]=A[6],x[7]=A[7],x[8]=A[8],x[9]=A[9],x[10]=A[10],x[11]=A[11],x[12]=A[12],x[13]=A[13],x[14]=A[14],x[15]=A[15],x},le.fromValues=function(x,A,I,E,C,R,z,V,W,Y,$,J,ie,ge,Pe,Me){var Ce=new t.ARRAY_TYPE(16);return Ce[0]=x,Ce[1]=A,Ce[2]=I,Ce[3]=E,Ce[4]=C,Ce[5]=R,Ce[6]=z,Ce[7]=V,Ce[8]=W,Ce[9]=Y,Ce[10]=$,Ce[11]=J,Ce[12]=ie,Ce[13]=ge,Ce[14]=Pe,Ce[15]=Me,Ce},le.set=function(x,A,I,E,C,R,z,V,W,Y,$,J,ie,ge,Pe,Me,Ce){return x[0]=A,x[1]=I,x[2]=E,x[3]=C,x[4]=R,x[5]=z,x[6]=V,x[7]=W,x[8]=Y,x[9]=$,x[10]=J,x[11]=ie,x[12]=ge,x[13]=Pe,x[14]=Me,x[15]=Ce,x},le.identity=c,le.transpose=function(x,A){if(x===A){var I=A[1],E=A[2],C=A[3],R=A[6],z=A[7],V=A[11];x[1]=A[4],x[2]=A[8],x[3]=A[12],x[4]=I,x[6]=A[9],x[7]=A[13],x[8]=E,x[9]=R,x[11]=A[14],x[12]=C,x[13]=z,x[14]=V}else x[0]=A[0],x[1]=A[4],x[2]=A[8],x[3]=A[12],x[4]=A[1],x[5]=A[5],x[6]=A[9],x[7]=A[13],x[8]=A[2],x[9]=A[6],x[10]=A[10],x[11]=A[14],x[12]=A[3],x[13]=A[7],x[14]=A[11],x[15]=A[15];return x},le.invert=function(x,A){var I=A[0],E=A[1],C=A[2],R=A[3],z=A[4],V=A[5],W=A[6],Y=A[7],$=A[8],J=A[9],ie=A[10],ge=A[11],Pe=A[12],Me=A[13],Ce=A[14],$e=A[15],Re=I*V-E*z,He=I*W-C*z,Je=I*Y-R*z,Xe=E*W-C*V,tt=E*Y-R*V,at=C*Y-R*W,ft=$*Me-J*Pe,nt=$*Ce-ie*Pe,Mt=$*$e-ge*Pe,Ft=J*Ce-ie*Me,Ct=J*$e-ge*Me,si=ie*$e-ge*Ce,ri=Re*si-He*Ct+Je*Ft+Xe*Mt-tt*nt+at*ft;return ri?(x[0]=(V*si-W*Ct+Y*Ft)*(ri=1/ri),x[1]=(C*Ct-E*si-R*Ft)*ri,x[2]=(Me*at-Ce*tt+$e*Xe)*ri,x[3]=(ie*tt-J*at-ge*Xe)*ri,x[4]=(W*Mt-z*si-Y*nt)*ri,x[5]=(I*si-C*Mt+R*nt)*ri,x[6]=(Ce*Je-Pe*at-$e*He)*ri,x[7]=($*at-ie*Je+ge*He)*ri,x[8]=(z*Ct-V*Mt+Y*ft)*ri,x[9]=(E*Mt-I*Ct-R*ft)*ri,x[10]=(Pe*tt-Me*Je+$e*Re)*ri,x[11]=(J*Je-$*tt-ge*Re)*ri,x[12]=(V*nt-z*Ft-W*ft)*ri,x[13]=(I*Ft-E*nt+C*ft)*ri,x[14]=(Me*He-Pe*Xe-Ce*Re)*ri,x[15]=($*Xe-J*He+ie*Re)*ri,x):null},le.adjoint=function(x,A){var I=A[0],E=A[1],C=A[2],R=A[3],z=A[4],V=A[5],W=A[6],Y=A[7],$=A[8],J=A[9],ie=A[10],ge=A[11],Pe=A[12],Me=A[13],Ce=A[14],$e=A[15];return x[0]=V*(ie*$e-ge*Ce)-J*(W*$e-Y*Ce)+Me*(W*ge-Y*ie),x[1]=-(E*(ie*$e-ge*Ce)-J*(C*$e-R*Ce)+Me*(C*ge-R*ie)),x[2]=E*(W*$e-Y*Ce)-V*(C*$e-R*Ce)+Me*(C*Y-R*W),x[3]=-(E*(W*ge-Y*ie)-V*(C*ge-R*ie)+J*(C*Y-R*W)),x[4]=-(z*(ie*$e-ge*Ce)-$*(W*$e-Y*Ce)+Pe*(W*ge-Y*ie)),x[5]=I*(ie*$e-ge*Ce)-$*(C*$e-R*Ce)+Pe*(C*ge-R*ie),x[6]=-(I*(W*$e-Y*Ce)-z*(C*$e-R*Ce)+Pe*(C*Y-R*W)),x[7]=I*(W*ge-Y*ie)-z*(C*ge-R*ie)+$*(C*Y-R*W),x[8]=z*(J*$e-ge*Me)-$*(V*$e-Y*Me)+Pe*(V*ge-Y*J),x[9]=-(I*(J*$e-ge*Me)-$*(E*$e-R*Me)+Pe*(E*ge-R*J)),x[10]=I*(V*$e-Y*Me)-z*(E*$e-R*Me)+Pe*(E*Y-R*V),x[11]=-(I*(V*ge-Y*J)-z*(E*ge-R*J)+$*(E*Y-R*V)),x[12]=-(z*(J*Ce-ie*Me)-$*(V*Ce-W*Me)+Pe*(V*ie-W*J)),x[13]=I*(J*Ce-ie*Me)-$*(E*Ce-C*Me)+Pe*(E*ie-C*J),x[14]=-(I*(V*Ce-W*Me)-z*(E*Ce-C*Me)+Pe*(E*W-C*V)),x[15]=I*(V*ie-W*J)-z*(E*ie-C*J)+$*(E*W-C*V),x},le.determinant=function(x){var A=x[0],I=x[1],E=x[2],C=x[3],R=x[4],z=x[5],V=x[6],W=x[7],Y=x[8],$=x[9],J=x[10],ie=x[11],ge=x[12],Pe=x[13],Me=x[14],Ce=x[15];return(A*z-I*R)*(J*Ce-ie*Me)-(A*V-E*R)*($*Ce-ie*Pe)+(A*W-C*R)*($*Me-J*Pe)+(I*V-E*z)*(Y*Ce-ie*ge)-(I*W-C*z)*(Y*Me-J*ge)+(E*W-C*V)*(Y*Pe-$*ge)},le.multiply=m,le.translate=function(x,A,I){var E,C,R,z,V,W,Y,$,J,ie,ge,Pe,Me=I[0],Ce=I[1],$e=I[2];return A===x?(x[12]=A[0]*Me+A[4]*Ce+A[8]*$e+A[12],x[13]=A[1]*Me+A[5]*Ce+A[9]*$e+A[13],x[14]=A[2]*Me+A[6]*Ce+A[10]*$e+A[14],x[15]=A[3]*Me+A[7]*Ce+A[11]*$e+A[15]):(C=A[1],R=A[2],z=A[3],V=A[4],W=A[5],Y=A[6],$=A[7],J=A[8],ie=A[9],ge=A[10],Pe=A[11],x[0]=E=A[0],x[1]=C,x[2]=R,x[3]=z,x[4]=V,x[5]=W,x[6]=Y,x[7]=$,x[8]=J,x[9]=ie,x[10]=ge,x[11]=Pe,x[12]=E*Me+V*Ce+J*$e+A[12],x[13]=C*Me+W*Ce+ie*$e+A[13],x[14]=R*Me+Y*Ce+ge*$e+A[14],x[15]=z*Me+$*Ce+Pe*$e+A[15]),x},le.scale=function(x,A,I){var E=I[0],C=I[1],R=I[2];return x[0]=A[0]*E,x[1]=A[1]*E,x[2]=A[2]*E,x[3]=A[3]*E,x[4]=A[4]*C,x[5]=A[5]*C,x[6]=A[6]*C,x[7]=A[7]*C,x[8]=A[8]*R,x[9]=A[9]*R,x[10]=A[10]*R,x[11]=A[11]*R,x[12]=A[12],x[13]=A[13],x[14]=A[14],x[15]=A[15],x},le.rotate=function(x,A,I,E){var C,R,z,V,W,Y,$,J,ie,ge,Pe,Me,Ce,$e,Re,He,Je,Xe,tt,at,ft,nt,Mt,Ft,Ct=E[0],si=E[1],ri=E[2],Wt=Math.hypot(Ct,si,ri);return Wt<t.EPSILON?null:(Ct*=Wt=1/Wt,si*=Wt,ri*=Wt,C=Math.sin(I),R=Math.cos(I),W=A[1],Y=A[2],$=A[3],ie=A[5],ge=A[6],Pe=A[7],Ce=A[9],$e=A[10],Re=A[11],He=Ct*Ct*(z=1-R)+R,tt=Ct*si*z-ri*C,at=si*si*z+R,ft=ri*si*z+Ct*C,nt=Ct*ri*z+si*C,Mt=si*ri*z-Ct*C,Ft=ri*ri*z+R,x[0]=(V=A[0])*He+(J=A[4])*(Je=si*Ct*z+ri*C)+(Me=A[8])*(Xe=ri*Ct*z-si*C),x[1]=W*He+ie*Je+Ce*Xe,x[2]=Y*He+ge*Je+$e*Xe,x[3]=$*He+Pe*Je+Re*Xe,x[4]=V*tt+J*at+Me*ft,x[5]=W*tt+ie*at+Ce*ft,x[6]=Y*tt+ge*at+$e*ft,x[7]=$*tt+Pe*at+Re*ft,x[8]=V*nt+J*Mt+Me*Ft,x[9]=W*nt+ie*Mt+Ce*Ft,x[10]=Y*nt+ge*Mt+$e*Ft,x[11]=$*nt+Pe*Mt+Re*Ft,A!==x&&(x[12]=A[12],x[13]=A[13],x[14]=A[14],x[15]=A[15]),x)},le.rotateX=function(x,A,I){var E=Math.sin(I),C=Math.cos(I),R=A[4],z=A[5],V=A[6],W=A[7],Y=A[8],$=A[9],J=A[10],ie=A[11];return A!==x&&(x[0]=A[0],x[1]=A[1],x[2]=A[2],x[3]=A[3],x[12]=A[12],x[13]=A[13],x[14]=A[14],x[15]=A[15]),x[4]=R*C+Y*E,x[5]=z*C+$*E,x[6]=V*C+J*E,x[7]=W*C+ie*E,x[8]=Y*C-R*E,x[9]=$*C-z*E,x[10]=J*C-V*E,x[11]=ie*C-W*E,x},le.rotateY=function(x,A,I){var E=Math.sin(I),C=Math.cos(I),R=A[0],z=A[1],V=A[2],W=A[3],Y=A[8],$=A[9],J=A[10],ie=A[11];return A!==x&&(x[4]=A[4],x[5]=A[5],x[6]=A[6],x[7]=A[7],x[12]=A[12],x[13]=A[13],x[14]=A[14],x[15]=A[15]),x[0]=R*C-Y*E,x[1]=z*C-$*E,x[2]=V*C-J*E,x[3]=W*C-ie*E,x[8]=R*E+Y*C,x[9]=z*E+$*C,x[10]=V*E+J*C,x[11]=W*E+ie*C,x},le.rotateZ=function(x,A,I){var E=Math.sin(I),C=Math.cos(I),R=A[0],z=A[1],V=A[2],W=A[3],Y=A[4],$=A[5],J=A[6],ie=A[7];return A!==x&&(x[8]=A[8],x[9]=A[9],x[10]=A[10],x[11]=A[11],x[12]=A[12],x[13]=A[13],x[14]=A[14],x[15]=A[15]),x[0]=R*C+Y*E,x[1]=z*C+$*E,x[2]=V*C+J*E,x[3]=W*C+ie*E,x[4]=Y*C-R*E,x[5]=$*C-z*E,x[6]=J*C-V*E,x[7]=ie*C-W*E,x},le.fromTranslation=function(x,A){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=A[0],x[13]=A[1],x[14]=A[2],x[15]=1,x},le.fromScaling=function(x,A){return x[0]=A[0],x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=A[1],x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=A[2],x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},le.fromRotation=function(x,A,I){var E,C,R,z=I[0],V=I[1],W=I[2],Y=Math.hypot(z,V,W);return Y<t.EPSILON?null:(z*=Y=1/Y,V*=Y,W*=Y,E=Math.sin(A),C=Math.cos(A),x[0]=z*z*(R=1-C)+C,x[1]=V*z*R+W*E,x[2]=W*z*R-V*E,x[3]=0,x[4]=z*V*R-W*E,x[5]=V*V*R+C,x[6]=W*V*R+z*E,x[7]=0,x[8]=z*W*R+V*E,x[9]=V*W*R-z*E,x[10]=W*W*R+C,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x)},le.fromXRotation=function(x,A){var I=Math.sin(A),E=Math.cos(A);return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=E,x[6]=I,x[7]=0,x[8]=0,x[9]=-I,x[10]=E,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},le.fromYRotation=function(x,A){var I=Math.sin(A),E=Math.cos(A);return x[0]=E,x[1]=0,x[2]=-I,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=I,x[9]=0,x[10]=E,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},le.fromZRotation=function(x,A){var I=Math.sin(A),E=Math.cos(A);return x[0]=E,x[1]=I,x[2]=0,x[3]=0,x[4]=-I,x[5]=E,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},le.fromRotationTranslation=h,le.fromQuat2=function(x,A){var I=new t.ARRAY_TYPE(3),E=-A[0],C=-A[1],R=-A[2],z=A[3],V=A[4],W=A[5],Y=A[6],$=A[7],J=E*E+C*C+R*R+z*z;return J>0?(I[0]=2*(V*z+$*E+W*R-Y*C)/J,I[1]=2*(W*z+$*C+Y*E-V*R)/J,I[2]=2*(Y*z+$*R+V*C-W*E)/J):(I[0]=2*(V*z+$*E+W*R-Y*C),I[1]=2*(W*z+$*C+Y*E-V*R),I[2]=2*(Y*z+$*R+V*C-W*E)),h(x,A,I),x},le.getTranslation=function(x,A){return x[0]=A[12],x[1]=A[13],x[2]=A[14],x},le.getScaling=_,le.getRotation=function(x,A){var I=new t.ARRAY_TYPE(3);_(I,A);var E=1/I[0],C=1/I[1],R=1/I[2],z=A[0]*E,V=A[1]*C,W=A[2]*R,Y=A[4]*E,$=A[5]*C,J=A[6]*R,ie=A[8]*E,ge=A[9]*C,Pe=A[10]*R,Me=z+$+Pe,Ce=0;return Me>0?(Ce=2*Math.sqrt(Me+1),x[3]=.25*Ce,x[0]=(J-ge)/Ce,x[1]=(ie-W)/Ce,x[2]=(V-Y)/Ce):z>$&&z>Pe?(Ce=2*Math.sqrt(1+z-$-Pe),x[3]=(J-ge)/Ce,x[0]=.25*Ce,x[1]=(V+Y)/Ce,x[2]=(ie+W)/Ce):$>Pe?(Ce=2*Math.sqrt(1+$-z-Pe),x[3]=(ie-W)/Ce,x[0]=(V+Y)/Ce,x[1]=.25*Ce,x[2]=(J+ge)/Ce):(Ce=2*Math.sqrt(1+Pe-z-$),x[3]=(V-Y)/Ce,x[0]=(ie+W)/Ce,x[1]=(J+ge)/Ce,x[2]=.25*Ce),x},le.fromRotationTranslationScale=function(x,A,I,E){var C=A[0],R=A[1],z=A[2],V=A[3],W=C+C,Y=R+R,$=z+z,J=C*W,ie=C*Y,ge=C*$,Pe=R*Y,Me=R*$,Ce=z*$,$e=V*W,Re=V*Y,He=V*$,Je=E[0],Xe=E[1],tt=E[2];return x[0]=(1-(Pe+Ce))*Je,x[1]=(ie+He)*Je,x[2]=(ge-Re)*Je,x[3]=0,x[4]=(ie-He)*Xe,x[5]=(1-(J+Ce))*Xe,x[6]=(Me+$e)*Xe,x[7]=0,x[8]=(ge+Re)*tt,x[9]=(Me-$e)*tt,x[10]=(1-(J+Pe))*tt,x[11]=0,x[12]=I[0],x[13]=I[1],x[14]=I[2],x[15]=1,x},le.fromRotationTranslationScaleOrigin=function(x,A,I,E,C){var R=A[0],z=A[1],V=A[2],W=A[3],Y=R+R,$=z+z,J=V+V,ie=R*Y,ge=R*$,Pe=R*J,Me=z*$,Ce=z*J,$e=V*J,Re=W*Y,He=W*$,Je=W*J,Xe=E[0],tt=E[1],at=E[2],ft=C[0],nt=C[1],Mt=C[2],Ft=(1-(Me+$e))*Xe,Ct=(ge+Je)*Xe,si=(Pe-He)*Xe,ri=(ge-Je)*tt,Wt=(1-(ie+$e))*tt,Bt=(Ce+Re)*tt,wi=(Pe+He)*at,ai=(Ce-Re)*at,fi=(1-(ie+Me))*at;return x[0]=Ft,x[1]=Ct,x[2]=si,x[3]=0,x[4]=ri,x[5]=Wt,x[6]=Bt,x[7]=0,x[8]=wi,x[9]=ai,x[10]=fi,x[11]=0,x[12]=I[0]+ft-(Ft*ft+ri*nt+wi*Mt),x[13]=I[1]+nt-(Ct*ft+Wt*nt+ai*Mt),x[14]=I[2]+Mt-(si*ft+Bt*nt+fi*Mt),x[15]=1,x},le.fromQuat=function(x,A){var I=A[0],E=A[1],C=A[2],R=A[3],z=I+I,V=E+E,W=C+C,Y=I*z,$=E*z,J=E*V,ie=C*z,ge=C*V,Pe=C*W,Me=R*z,Ce=R*V,$e=R*W;return x[0]=1-J-Pe,x[1]=$+$e,x[2]=ie-Ce,x[3]=0,x[4]=$-$e,x[5]=1-Y-Pe,x[6]=ge+Me,x[7]=0,x[8]=ie+Ce,x[9]=ge-Me,x[10]=1-Y-J,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},le.frustum=function(x,A,I,E,C,R,z){var V=1/(I-A),W=1/(C-E),Y=1/(R-z);return x[0]=2*R*V,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=2*R*W,x[6]=0,x[7]=0,x[8]=(I+A)*V,x[9]=(C+E)*W,x[10]=(z+R)*Y,x[11]=-1,x[12]=0,x[13]=0,x[14]=z*R*2*Y,x[15]=0,x},le.perspectiveNO=w,le.perspectiveZO=function(x,A,I,E,C){var R,z=1/Math.tan(A/2);return x[0]=z/I,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=z,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,C!=null&&C!==1/0?(x[10]=C*(R=1/(E-C)),x[14]=C*E*R):(x[10]=-1,x[14]=-E),x},le.perspectiveFromFieldOfView=function(x,A,I,E){var C=Math.tan(A.upDegrees*Math.PI/180),R=Math.tan(A.downDegrees*Math.PI/180),z=Math.tan(A.leftDegrees*Math.PI/180),V=Math.tan(A.rightDegrees*Math.PI/180),W=2/(z+V),Y=2/(C+R);return x[0]=W,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=Y,x[6]=0,x[7]=0,x[8]=-(z-V)*W*.5,x[9]=(C-R)*Y*.5,x[10]=E/(I-E),x[11]=-1,x[12]=0,x[13]=0,x[14]=E*I/(I-E),x[15]=0,x},le.orthoNO=S,le.orthoZO=function(x,A,I,E,C,R,z){var V=1/(A-I),W=1/(E-C),Y=1/(R-z);return x[0]=-2*V,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*W,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=Y,x[11]=0,x[12]=(A+I)*V,x[13]=(C+E)*W,x[14]=R*Y,x[15]=1,x},le.lookAt=function(x,A,I,E){var C,R,z,V,W,Y,$,J,ie,ge,Pe=A[0],Me=A[1],Ce=A[2],$e=E[0],Re=E[1],He=E[2],Je=I[0],Xe=I[1],tt=I[2];return Math.abs(Pe-Je)<t.EPSILON&&Math.abs(Me-Xe)<t.EPSILON&&Math.abs(Ce-tt)<t.EPSILON?c(x):($=Pe-Je,J=Me-Xe,ie=Ce-tt,C=Re*(ie*=ge=1/Math.hypot($,J,ie))-He*(J*=ge),R=He*($*=ge)-$e*ie,z=$e*J-Re*$,(ge=Math.hypot(C,R,z))?(C*=ge=1/ge,R*=ge,z*=ge):(C=0,R=0,z=0),V=J*z-ie*R,W=ie*C-$*z,Y=$*R-J*C,(ge=Math.hypot(V,W,Y))?(V*=ge=1/ge,W*=ge,Y*=ge):(V=0,W=0,Y=0),x[0]=C,x[1]=V,x[2]=$,x[3]=0,x[4]=R,x[5]=W,x[6]=J,x[7]=0,x[8]=z,x[9]=Y,x[10]=ie,x[11]=0,x[12]=-(C*Pe+R*Me+z*Ce),x[13]=-(V*Pe+W*Me+Y*Ce),x[14]=-($*Pe+J*Me+ie*Ce),x[15]=1,x)},le.targetTo=function(x,A,I,E){var C=A[0],R=A[1],z=A[2],V=E[0],W=E[1],Y=E[2],$=C-I[0],J=R-I[1],ie=z-I[2],ge=$*$+J*J+ie*ie;ge>0&&($*=ge=1/Math.sqrt(ge),J*=ge,ie*=ge);var Pe=W*ie-Y*J,Me=Y*$-V*ie,Ce=V*J-W*$;return(ge=Pe*Pe+Me*Me+Ce*Ce)>0&&(Pe*=ge=1/Math.sqrt(ge),Me*=ge,Ce*=ge),x[0]=Pe,x[1]=Me,x[2]=Ce,x[3]=0,x[4]=J*Ce-ie*Me,x[5]=ie*Pe-$*Ce,x[6]=$*Me-J*Pe,x[7]=0,x[8]=$,x[9]=J,x[10]=ie,x[11]=0,x[12]=C,x[13]=R,x[14]=z,x[15]=1,x},le.str=function(x){return"mat4("+x[0]+", "+x[1]+", "+x[2]+", "+x[3]+", "+x[4]+", "+x[5]+", "+x[6]+", "+x[7]+", "+x[8]+", "+x[9]+", "+x[10]+", "+x[11]+", "+x[12]+", "+x[13]+", "+x[14]+", "+x[15]+")"},le.frob=function(x){return Math.hypot(x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7],x[8],x[9],x[10],x[11],x[12],x[13],x[14],x[15])},le.add=function(x,A,I){return x[0]=A[0]+I[0],x[1]=A[1]+I[1],x[2]=A[2]+I[2],x[3]=A[3]+I[3],x[4]=A[4]+I[4],x[5]=A[5]+I[5],x[6]=A[6]+I[6],x[7]=A[7]+I[7],x[8]=A[8]+I[8],x[9]=A[9]+I[9],x[10]=A[10]+I[10],x[11]=A[11]+I[11],x[12]=A[12]+I[12],x[13]=A[13]+I[13],x[14]=A[14]+I[14],x[15]=A[15]+I[15],x},le.subtract=P,le.multiplyScalar=function(x,A,I){return x[0]=A[0]*I,x[1]=A[1]*I,x[2]=A[2]*I,x[3]=A[3]*I,x[4]=A[4]*I,x[5]=A[5]*I,x[6]=A[6]*I,x[7]=A[7]*I,x[8]=A[8]*I,x[9]=A[9]*I,x[10]=A[10]*I,x[11]=A[11]*I,x[12]=A[12]*I,x[13]=A[13]*I,x[14]=A[14]*I,x[15]=A[15]*I,x},le.multiplyScalarAndAdd=function(x,A,I,E){return x[0]=A[0]+I[0]*E,x[1]=A[1]+I[1]*E,x[2]=A[2]+I[2]*E,x[3]=A[3]+I[3]*E,x[4]=A[4]+I[4]*E,x[5]=A[5]+I[5]*E,x[6]=A[6]+I[6]*E,x[7]=A[7]+I[7]*E,x[8]=A[8]+I[8]*E,x[9]=A[9]+I[9]*E,x[10]=A[10]+I[10]*E,x[11]=A[11]+I[11]*E,x[12]=A[12]+I[12]*E,x[13]=A[13]+I[13]*E,x[14]=A[14]+I[14]*E,x[15]=A[15]+I[15]*E,x},le.exactEquals=function(x,A){return x[0]===A[0]&&x[1]===A[1]&&x[2]===A[2]&&x[3]===A[3]&&x[4]===A[4]&&x[5]===A[5]&&x[6]===A[6]&&x[7]===A[7]&&x[8]===A[8]&&x[9]===A[9]&&x[10]===A[10]&&x[11]===A[11]&&x[12]===A[12]&&x[13]===A[13]&&x[14]===A[14]&&x[15]===A[15]},le.equals=function(x,A){var I=x[0],E=x[1],C=x[2],R=x[3],z=x[4],V=x[5],W=x[6],Y=x[7],$=x[8],J=x[9],ie=x[10],ge=x[11],Pe=x[12],Me=x[13],Ce=x[14],$e=x[15],Re=A[0],He=A[1],Je=A[2],Xe=A[3],tt=A[4],at=A[5],ft=A[6],nt=A[7],Mt=A[8],Ft=A[9],Ct=A[10],si=A[11],ri=A[12],Wt=A[13],Bt=A[14],wi=A[15];return Math.abs(I-Re)<=t.EPSILON*Math.max(1,Math.abs(I),Math.abs(Re))&&Math.abs(E-He)<=t.EPSILON*Math.max(1,Math.abs(E),Math.abs(He))&&Math.abs(C-Je)<=t.EPSILON*Math.max(1,Math.abs(C),Math.abs(Je))&&Math.abs(R-Xe)<=t.EPSILON*Math.max(1,Math.abs(R),Math.abs(Xe))&&Math.abs(z-tt)<=t.EPSILON*Math.max(1,Math.abs(z),Math.abs(tt))&&Math.abs(V-at)<=t.EPSILON*Math.max(1,Math.abs(V),Math.abs(at))&&Math.abs(W-ft)<=t.EPSILON*Math.max(1,Math.abs(W),Math.abs(ft))&&Math.abs(Y-nt)<=t.EPSILON*Math.max(1,Math.abs(Y),Math.abs(nt))&&Math.abs($-Mt)<=t.EPSILON*Math.max(1,Math.abs($),Math.abs(Mt))&&Math.abs(J-Ft)<=t.EPSILON*Math.max(1,Math.abs(J),Math.abs(Ft))&&Math.abs(ie-Ct)<=t.EPSILON*Math.max(1,Math.abs(ie),Math.abs(Ct))&&Math.abs(ge-si)<=t.EPSILON*Math.max(1,Math.abs(ge),Math.abs(si))&&Math.abs(Pe-ri)<=t.EPSILON*Math.max(1,Math.abs(Pe),Math.abs(ri))&&Math.abs(Me-Wt)<=t.EPSILON*Math.max(1,Math.abs(Me),Math.abs(Wt))&&Math.abs(Ce-Bt)<=t.EPSILON*Math.max(1,Math.abs(Ce),Math.abs(Bt))&&Math.abs($e-wi)<=t.EPSILON*Math.max(1,Math.abs($e),Math.abs(wi))},le.sub=le.mul=le.ortho=le.perspective=void 0;var t=function(x,A){if(x&&x.__esModule)return x;if(x===null||l(x)!=="object"&&typeof x!="function")return{default:x};var I=s(void 0);if(I&&I.has(x))return I.get(x);var E={},C=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var R in x)if(R!=="default"&&Object.prototype.hasOwnProperty.call(x,R)){var z=C?Object.getOwnPropertyDescriptor(x,R):null;z&&(z.get||z.set)?Object.defineProperty(E,R,z):E[R]=x[R]}return E.default=x,I&&I.set(x,E),E}(Q());function s(x){if(typeof WeakMap!="function")return null;var A=new WeakMap,I=new WeakMap;return(s=function(E){return E?I:A})(x)}function c(x){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x}function m(x,A,I){var E=A[0],C=A[1],R=A[2],z=A[3],V=A[4],W=A[5],Y=A[6],$=A[7],J=A[8],ie=A[9],ge=A[10],Pe=A[11],Me=A[12],Ce=A[13],$e=A[14],Re=A[15],He=I[0],Je=I[1],Xe=I[2],tt=I[3];return x[0]=He*E+Je*V+Xe*J+tt*Me,x[1]=He*C+Je*W+Xe*ie+tt*Ce,x[2]=He*R+Je*Y+Xe*ge+tt*$e,x[3]=He*z+Je*$+Xe*Pe+tt*Re,x[4]=(He=I[4])*E+(Je=I[5])*V+(Xe=I[6])*J+(tt=I[7])*Me,x[5]=He*C+Je*W+Xe*ie+tt*Ce,x[6]=He*R+Je*Y+Xe*ge+tt*$e,x[7]=He*z+Je*$+Xe*Pe+tt*Re,x[8]=(He=I[8])*E+(Je=I[9])*V+(Xe=I[10])*J+(tt=I[11])*Me,x[9]=He*C+Je*W+Xe*ie+tt*Ce,x[10]=He*R+Je*Y+Xe*ge+tt*$e,x[11]=He*z+Je*$+Xe*Pe+tt*Re,x[12]=(He=I[12])*E+(Je=I[13])*V+(Xe=I[14])*J+(tt=I[15])*Me,x[13]=He*C+Je*W+Xe*ie+tt*Ce,x[14]=He*R+Je*Y+Xe*ge+tt*$e,x[15]=He*z+Je*$+Xe*Pe+tt*Re,x}function h(x,A,I){var E=A[0],C=A[1],R=A[2],z=A[3],V=E+E,W=C+C,Y=R+R,$=E*V,J=E*W,ie=E*Y,ge=C*W,Pe=C*Y,Me=R*Y,Ce=z*V,$e=z*W,Re=z*Y;return x[0]=1-(ge+Me),x[1]=J+Re,x[2]=ie-$e,x[3]=0,x[4]=J-Re,x[5]=1-($+Me),x[6]=Pe+Ce,x[7]=0,x[8]=ie+$e,x[9]=Pe-Ce,x[10]=1-($+ge),x[11]=0,x[12]=I[0],x[13]=I[1],x[14]=I[2],x[15]=1,x}function _(x,A){var I=A[4],E=A[5],C=A[6],R=A[8],z=A[9],V=A[10];return x[0]=Math.hypot(A[0],A[1],A[2]),x[1]=Math.hypot(I,E,C),x[2]=Math.hypot(R,z,V),x}function w(x,A,I,E,C){var R,z=1/Math.tan(A/2);return x[0]=z/I,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=z,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,C!=null&&C!==1/0?(x[10]=(C+E)*(R=1/(E-C)),x[14]=2*C*E*R):(x[10]=-1,x[14]=-2*E),x}function S(x,A,I,E,C,R,z){var V=1/(A-I),W=1/(E-C),Y=1/(R-z);return x[0]=-2*V,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*W,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=2*Y,x[11]=0,x[12]=(A+I)*V,x[13]=(C+E)*W,x[14]=(z+R)*Y,x[15]=1,x}function P(x,A,I){return x[0]=A[0]-I[0],x[1]=A[1]-I[1],x[2]=A[2]-I[2],x[3]=A[3]-I[3],x[4]=A[4]-I[4],x[5]=A[5]-I[5],x[6]=A[6]-I[6],x[7]=A[7]-I[7],x[8]=A[8]-I[8],x[9]=A[9]-I[9],x[10]=A[10]-I[10],x[11]=A[11]-I[11],x[12]=A[12]-I[12],x[13]=A[13]-I[13],x[14]=A[14]-I[14],x[15]=A[15]-I[15],x}return le.perspective=w,le.ortho=S,le.mul=m,le.sub=P,le}var oe,se={},Ae={};function De(){if(oe)return Ae;function l(C){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},l(C)}oe=1,Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.create=c,Ae.clone=function(C){var R=new t.ARRAY_TYPE(3);return R[0]=C[0],R[1]=C[1],R[2]=C[2],R},Ae.length=m,Ae.fromValues=function(C,R,z){var V=new t.ARRAY_TYPE(3);return V[0]=C,V[1]=R,V[2]=z,V},Ae.copy=function(C,R){return C[0]=R[0],C[1]=R[1],C[2]=R[2],C},Ae.set=function(C,R,z,V){return C[0]=R,C[1]=z,C[2]=V,C},Ae.add=function(C,R,z){return C[0]=R[0]+z[0],C[1]=R[1]+z[1],C[2]=R[2]+z[2],C},Ae.subtract=h,Ae.multiply=_,Ae.divide=w,Ae.ceil=function(C,R){return C[0]=Math.ceil(R[0]),C[1]=Math.ceil(R[1]),C[2]=Math.ceil(R[2]),C},Ae.floor=function(C,R){return C[0]=Math.floor(R[0]),C[1]=Math.floor(R[1]),C[2]=Math.floor(R[2]),C},Ae.min=function(C,R,z){return C[0]=Math.min(R[0],z[0]),C[1]=Math.min(R[1],z[1]),C[2]=Math.min(R[2],z[2]),C},Ae.max=function(C,R,z){return C[0]=Math.max(R[0],z[0]),C[1]=Math.max(R[1],z[1]),C[2]=Math.max(R[2],z[2]),C},Ae.round=function(C,R){return C[0]=Math.round(R[0]),C[1]=Math.round(R[1]),C[2]=Math.round(R[2]),C},Ae.scale=function(C,R,z){return C[0]=R[0]*z,C[1]=R[1]*z,C[2]=R[2]*z,C},Ae.scaleAndAdd=function(C,R,z,V){return C[0]=R[0]+z[0]*V,C[1]=R[1]+z[1]*V,C[2]=R[2]+z[2]*V,C},Ae.distance=S,Ae.squaredDistance=P,Ae.squaredLength=x,Ae.negate=function(C,R){return C[0]=-R[0],C[1]=-R[1],C[2]=-R[2],C},Ae.inverse=function(C,R){return C[0]=1/R[0],C[1]=1/R[1],C[2]=1/R[2],C},Ae.normalize=function(C,R){var z=R[0],V=R[1],W=R[2],Y=z*z+V*V+W*W;return Y>0&&(Y=1/Math.sqrt(Y)),C[0]=R[0]*Y,C[1]=R[1]*Y,C[2]=R[2]*Y,C},Ae.dot=A,Ae.cross=function(C,R,z){var V=R[0],W=R[1],Y=R[2],$=z[0],J=z[1],ie=z[2];return C[0]=W*ie-Y*J,C[1]=Y*$-V*ie,C[2]=V*J-W*$,C},Ae.lerp=function(C,R,z,V){var W=R[0],Y=R[1],$=R[2];return C[0]=W+V*(z[0]-W),C[1]=Y+V*(z[1]-Y),C[2]=$+V*(z[2]-$),C},Ae.hermite=function(C,R,z,V,W,Y){var $=Y*Y,J=$*(2*Y-3)+1,ie=$*(Y-2)+Y,ge=$*(Y-1),Pe=$*(3-2*Y);return C[0]=R[0]*J+z[0]*ie+V[0]*ge+W[0]*Pe,C[1]=R[1]*J+z[1]*ie+V[1]*ge+W[1]*Pe,C[2]=R[2]*J+z[2]*ie+V[2]*ge+W[2]*Pe,C},Ae.bezier=function(C,R,z,V,W,Y){var $=1-Y,J=$*$,ie=Y*Y,ge=J*$,Pe=3*Y*J,Me=3*ie*$,Ce=ie*Y;return C[0]=R[0]*ge+z[0]*Pe+V[0]*Me+W[0]*Ce,C[1]=R[1]*ge+z[1]*Pe+V[1]*Me+W[1]*Ce,C[2]=R[2]*ge+z[2]*Pe+V[2]*Me+W[2]*Ce,C},Ae.random=function(C,R){R=R||1;var z=2*t.RANDOM()*Math.PI,V=2*t.RANDOM()-1,W=Math.sqrt(1-V*V)*R;return C[0]=Math.cos(z)*W,C[1]=Math.sin(z)*W,C[2]=V*R,C},Ae.transformMat4=function(C,R,z){var V=R[0],W=R[1],Y=R[2],$=z[3]*V+z[7]*W+z[11]*Y+z[15];return C[0]=(z[0]*V+z[4]*W+z[8]*Y+z[12])/($=$||1),C[1]=(z[1]*V+z[5]*W+z[9]*Y+z[13])/$,C[2]=(z[2]*V+z[6]*W+z[10]*Y+z[14])/$,C},Ae.transformMat3=function(C,R,z){var V=R[0],W=R[1],Y=R[2];return C[0]=V*z[0]+W*z[3]+Y*z[6],C[1]=V*z[1]+W*z[4]+Y*z[7],C[2]=V*z[2]+W*z[5]+Y*z[8],C},Ae.transformQuat=function(C,R,z){var V=z[0],W=z[1],Y=z[2],$=R[0],J=R[1],ie=R[2],ge=W*ie-Y*J,Pe=Y*$-V*ie,Me=V*J-W*$,Ce=W*Me-Y*Pe,$e=Y*ge-V*Me,Re=V*Pe-W*ge,He=2*z[3];return Pe*=He,Me*=He,$e*=2,Re*=2,C[0]=$+(ge*=He)+(Ce*=2),C[1]=J+Pe+$e,C[2]=ie+Me+Re,C},Ae.rotateX=function(C,R,z,V){var W=[],Y=[];return W[0]=R[0]-z[0],W[1]=R[1]-z[1],W[2]=R[2]-z[2],Y[0]=W[0],Y[1]=W[1]*Math.cos(V)-W[2]*Math.sin(V),Y[2]=W[1]*Math.sin(V)+W[2]*Math.cos(V),C[0]=Y[0]+z[0],C[1]=Y[1]+z[1],C[2]=Y[2]+z[2],C},Ae.rotateY=function(C,R,z,V){var W=[],Y=[];return W[0]=R[0]-z[0],W[1]=R[1]-z[1],W[2]=R[2]-z[2],Y[0]=W[2]*Math.sin(V)+W[0]*Math.cos(V),Y[1]=W[1],Y[2]=W[2]*Math.cos(V)-W[0]*Math.sin(V),C[0]=Y[0]+z[0],C[1]=Y[1]+z[1],C[2]=Y[2]+z[2],C},Ae.rotateZ=function(C,R,z,V){var W=[],Y=[];return W[0]=R[0]-z[0],W[1]=R[1]-z[1],W[2]=R[2]-z[2],Y[0]=W[0]*Math.cos(V)-W[1]*Math.sin(V),Y[1]=W[0]*Math.sin(V)+W[1]*Math.cos(V),Y[2]=W[2],C[0]=Y[0]+z[0],C[1]=Y[1]+z[1],C[2]=Y[2]+z[2],C},Ae.angle=function(C,R){var z=C[0],V=C[1],W=C[2],Y=R[0],$=R[1],J=R[2],ie=Math.sqrt(z*z+V*V+W*W)*Math.sqrt(Y*Y+$*$+J*J),ge=ie&&A(C,R)/ie;return Math.acos(Math.min(Math.max(ge,-1),1))},Ae.zero=function(C){return C[0]=0,C[1]=0,C[2]=0,C},Ae.str=function(C){return"vec3("+C[0]+", "+C[1]+", "+C[2]+")"},Ae.exactEquals=function(C,R){return C[0]===R[0]&&C[1]===R[1]&&C[2]===R[2]},Ae.equals=function(C,R){var z=C[0],V=C[1],W=C[2],Y=R[0],$=R[1],J=R[2];return Math.abs(z-Y)<=t.EPSILON*Math.max(1,Math.abs(z),Math.abs(Y))&&Math.abs(V-$)<=t.EPSILON*Math.max(1,Math.abs(V),Math.abs($))&&Math.abs(W-J)<=t.EPSILON*Math.max(1,Math.abs(W),Math.abs(J))},Ae.forEach=Ae.sqrLen=Ae.len=Ae.sqrDist=Ae.dist=Ae.div=Ae.mul=Ae.sub=void 0;var t=function(C,R){if(C&&C.__esModule)return C;if(C===null||l(C)!=="object"&&typeof C!="function")return{default:C};var z=s(void 0);if(z&&z.has(C))return z.get(C);var V={},W=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Y in C)if(Y!=="default"&&Object.prototype.hasOwnProperty.call(C,Y)){var $=W?Object.getOwnPropertyDescriptor(C,Y):null;$&&($.get||$.set)?Object.defineProperty(V,Y,$):V[Y]=C[Y]}return V.default=C,z&&z.set(C,V),V}(Q());function s(C){if(typeof WeakMap!="function")return null;var R=new WeakMap,z=new WeakMap;return(s=function(V){return V?z:R})(C)}function c(){var C=new t.ARRAY_TYPE(3);return t.ARRAY_TYPE!=Float32Array&&(C[0]=0,C[1]=0,C[2]=0),C}function m(C){return Math.hypot(C[0],C[1],C[2])}function h(C,R,z){return C[0]=R[0]-z[0],C[1]=R[1]-z[1],C[2]=R[2]-z[2],C}function _(C,R,z){return C[0]=R[0]*z[0],C[1]=R[1]*z[1],C[2]=R[2]*z[2],C}function w(C,R,z){return C[0]=R[0]/z[0],C[1]=R[1]/z[1],C[2]=R[2]/z[2],C}function S(C,R){return Math.hypot(R[0]-C[0],R[1]-C[1],R[2]-C[2])}function P(C,R){var z=R[0]-C[0],V=R[1]-C[1],W=R[2]-C[2];return z*z+V*V+W*W}function x(C){var R=C[0],z=C[1],V=C[2];return R*R+z*z+V*V}function A(C,R){return C[0]*R[0]+C[1]*R[1]+C[2]*R[2]}Ae.sub=h,Ae.mul=_,Ae.div=w,Ae.dist=S,Ae.sqrDist=P,Ae.len=m,Ae.sqrLen=x;var I,E=(I=c(),function(C,R,z,V,W,Y){var $,J;for(R||(R=3),z||(z=0),J=V?Math.min(V*R+z,C.length):C.length,$=z;$<J;$+=R)I[0]=C[$],I[1]=C[$+1],I[2]=C[$+2],W(I,I,Y),C[$]=I[0],C[$+1]=I[1],C[$+2]=I[2];return C});return Ae.forEach=E,Ae}var Ge,yt,ct={};function mt(){if(Ge)return ct;function l(E){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},l(E)}Ge=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.create=c,ct.clone=function(E){var C=new t.ARRAY_TYPE(4);return C[0]=E[0],C[1]=E[1],C[2]=E[2],C[3]=E[3],C},ct.fromValues=function(E,C,R,z){var V=new t.ARRAY_TYPE(4);return V[0]=E,V[1]=C,V[2]=R,V[3]=z,V},ct.copy=function(E,C){return E[0]=C[0],E[1]=C[1],E[2]=C[2],E[3]=C[3],E},ct.set=function(E,C,R,z,V){return E[0]=C,E[1]=R,E[2]=z,E[3]=V,E},ct.add=function(E,C,R){return E[0]=C[0]+R[0],E[1]=C[1]+R[1],E[2]=C[2]+R[2],E[3]=C[3]+R[3],E},ct.subtract=m,ct.multiply=h,ct.divide=_,ct.ceil=function(E,C){return E[0]=Math.ceil(C[0]),E[1]=Math.ceil(C[1]),E[2]=Math.ceil(C[2]),E[3]=Math.ceil(C[3]),E},ct.floor=function(E,C){return E[0]=Math.floor(C[0]),E[1]=Math.floor(C[1]),E[2]=Math.floor(C[2]),E[3]=Math.floor(C[3]),E},ct.min=function(E,C,R){return E[0]=Math.min(C[0],R[0]),E[1]=Math.min(C[1],R[1]),E[2]=Math.min(C[2],R[2]),E[3]=Math.min(C[3],R[3]),E},ct.max=function(E,C,R){return E[0]=Math.max(C[0],R[0]),E[1]=Math.max(C[1],R[1]),E[2]=Math.max(C[2],R[2]),E[3]=Math.max(C[3],R[3]),E},ct.round=function(E,C){return E[0]=Math.round(C[0]),E[1]=Math.round(C[1]),E[2]=Math.round(C[2]),E[3]=Math.round(C[3]),E},ct.scale=function(E,C,R){return E[0]=C[0]*R,E[1]=C[1]*R,E[2]=C[2]*R,E[3]=C[3]*R,E},ct.scaleAndAdd=function(E,C,R,z){return E[0]=C[0]+R[0]*z,E[1]=C[1]+R[1]*z,E[2]=C[2]+R[2]*z,E[3]=C[3]+R[3]*z,E},ct.distance=w,ct.squaredDistance=S,ct.length=P,ct.squaredLength=x,ct.negate=function(E,C){return E[0]=-C[0],E[1]=-C[1],E[2]=-C[2],E[3]=-C[3],E},ct.inverse=function(E,C){return E[0]=1/C[0],E[1]=1/C[1],E[2]=1/C[2],E[3]=1/C[3],E},ct.normalize=function(E,C){var R=C[0],z=C[1],V=C[2],W=C[3],Y=R*R+z*z+V*V+W*W;return Y>0&&(Y=1/Math.sqrt(Y)),E[0]=R*Y,E[1]=z*Y,E[2]=V*Y,E[3]=W*Y,E},ct.dot=function(E,C){return E[0]*C[0]+E[1]*C[1]+E[2]*C[2]+E[3]*C[3]},ct.cross=function(E,C,R,z){var V=R[0]*z[1]-R[1]*z[0],W=R[0]*z[2]-R[2]*z[0],Y=R[0]*z[3]-R[3]*z[0],$=R[1]*z[2]-R[2]*z[1],J=R[1]*z[3]-R[3]*z[1],ie=R[2]*z[3]-R[3]*z[2],ge=C[0],Pe=C[1],Me=C[2],Ce=C[3];return E[0]=Pe*ie-Me*J+Ce*$,E[1]=-ge*ie+Me*Y-Ce*W,E[2]=ge*J-Pe*Y+Ce*V,E[3]=-ge*$+Pe*W-Me*V,E},ct.lerp=function(E,C,R,z){var V=C[0],W=C[1],Y=C[2],$=C[3];return E[0]=V+z*(R[0]-V),E[1]=W+z*(R[1]-W),E[2]=Y+z*(R[2]-Y),E[3]=$+z*(R[3]-$),E},ct.random=function(E,C){var R,z,V,W,Y,$;C=C||1;do Y=(R=2*t.RANDOM()-1)*R+(z=2*t.RANDOM()-1)*z;while(Y>=1);do $=(V=2*t.RANDOM()-1)*V+(W=2*t.RANDOM()-1)*W;while($>=1);var J=Math.sqrt((1-Y)/$);return E[0]=C*R,E[1]=C*z,E[2]=C*V*J,E[3]=C*W*J,E},ct.transformMat4=function(E,C,R){var z=C[0],V=C[1],W=C[2],Y=C[3];return E[0]=R[0]*z+R[4]*V+R[8]*W+R[12]*Y,E[1]=R[1]*z+R[5]*V+R[9]*W+R[13]*Y,E[2]=R[2]*z+R[6]*V+R[10]*W+R[14]*Y,E[3]=R[3]*z+R[7]*V+R[11]*W+R[15]*Y,E},ct.transformQuat=function(E,C,R){var z=C[0],V=C[1],W=C[2],Y=R[0],$=R[1],J=R[2],ie=R[3],ge=ie*z+$*W-J*V,Pe=ie*V+J*z-Y*W,Me=ie*W+Y*V-$*z,Ce=-Y*z-$*V-J*W;return E[0]=ge*ie+Ce*-Y+Pe*-J-Me*-$,E[1]=Pe*ie+Ce*-$+Me*-Y-ge*-J,E[2]=Me*ie+Ce*-J+ge*-$-Pe*-Y,E[3]=C[3],E},ct.zero=function(E){return E[0]=0,E[1]=0,E[2]=0,E[3]=0,E},ct.str=function(E){return"vec4("+E[0]+", "+E[1]+", "+E[2]+", "+E[3]+")"},ct.exactEquals=function(E,C){return E[0]===C[0]&&E[1]===C[1]&&E[2]===C[2]&&E[3]===C[3]},ct.equals=function(E,C){var R=E[0],z=E[1],V=E[2],W=E[3],Y=C[0],$=C[1],J=C[2],ie=C[3];return Math.abs(R-Y)<=t.EPSILON*Math.max(1,Math.abs(R),Math.abs(Y))&&Math.abs(z-$)<=t.EPSILON*Math.max(1,Math.abs(z),Math.abs($))&&Math.abs(V-J)<=t.EPSILON*Math.max(1,Math.abs(V),Math.abs(J))&&Math.abs(W-ie)<=t.EPSILON*Math.max(1,Math.abs(W),Math.abs(ie))},ct.forEach=ct.sqrLen=ct.len=ct.sqrDist=ct.dist=ct.div=ct.mul=ct.sub=void 0;var t=function(E,C){if(E&&E.__esModule)return E;if(E===null||l(E)!=="object"&&typeof E!="function")return{default:E};var R=s(void 0);if(R&&R.has(E))return R.get(E);var z={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var W in E)if(W!=="default"&&Object.prototype.hasOwnProperty.call(E,W)){var Y=V?Object.getOwnPropertyDescriptor(E,W):null;Y&&(Y.get||Y.set)?Object.defineProperty(z,W,Y):z[W]=E[W]}return z.default=E,R&&R.set(E,z),z}(Q());function s(E){if(typeof WeakMap!="function")return null;var C=new WeakMap,R=new WeakMap;return(s=function(z){return z?R:C})(E)}function c(){var E=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(E[0]=0,E[1]=0,E[2]=0,E[3]=0),E}function m(E,C,R){return E[0]=C[0]-R[0],E[1]=C[1]-R[1],E[2]=C[2]-R[2],E[3]=C[3]-R[3],E}function h(E,C,R){return E[0]=C[0]*R[0],E[1]=C[1]*R[1],E[2]=C[2]*R[2],E[3]=C[3]*R[3],E}function _(E,C,R){return E[0]=C[0]/R[0],E[1]=C[1]/R[1],E[2]=C[2]/R[2],E[3]=C[3]/R[3],E}function w(E,C){return Math.hypot(C[0]-E[0],C[1]-E[1],C[2]-E[2],C[3]-E[3])}function S(E,C){var R=C[0]-E[0],z=C[1]-E[1],V=C[2]-E[2],W=C[3]-E[3];return R*R+z*z+V*V+W*W}function P(E){return Math.hypot(E[0],E[1],E[2],E[3])}function x(E){var C=E[0],R=E[1],z=E[2],V=E[3];return C*C+R*R+z*z+V*V}ct.sub=m,ct.mul=h,ct.div=_,ct.dist=w,ct.sqrDist=S,ct.len=P,ct.sqrLen=x;var A,I=(A=c(),function(E,C,R,z,V,W){var Y,$;for(C||(C=4),R||(R=0),$=z?Math.min(z*C+R,E.length):E.length,Y=R;Y<$;Y+=C)A[0]=E[Y],A[1]=E[Y+1],A[2]=E[Y+2],A[3]=E[Y+3],V(A,A,W),E[Y]=A[0],E[Y+1]=A[1],E[Y+2]=A[2],E[Y+3]=A[3];return E});return ct.forEach=I,ct}function et(){if(yt)return se;function l(Re){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(He){return typeof He}:function(He){return He&&typeof Symbol=="function"&&He.constructor===Symbol&&He!==Symbol.prototype?"symbol":typeof He},l(Re)}yt=1,Object.defineProperty(se,"__esModule",{value:!0}),se.create=w,se.identity=function(Re){return Re[0]=0,Re[1]=0,Re[2]=0,Re[3]=1,Re},se.setAxisAngle=S,se.getAxisAngle=function(Re,He){var Je=2*Math.acos(He[3]),Xe=Math.sin(Je/2);return Xe>t.EPSILON?(Re[0]=He[0]/Xe,Re[1]=He[1]/Xe,Re[2]=He[2]/Xe):(Re[0]=1,Re[1]=0,Re[2]=0),Je},se.getAngle=function(Re,He){var Je=R(Re,He);return Math.acos(2*Je*Je-1)},se.multiply=P,se.rotateX=function(Re,He,Je){Je*=.5;var Xe=He[0],tt=He[1],at=He[2],ft=He[3],nt=Math.sin(Je),Mt=Math.cos(Je);return Re[0]=Xe*Mt+ft*nt,Re[1]=tt*Mt+at*nt,Re[2]=at*Mt-tt*nt,Re[3]=ft*Mt-Xe*nt,Re},se.rotateY=function(Re,He,Je){Je*=.5;var Xe=He[0],tt=He[1],at=He[2],ft=He[3],nt=Math.sin(Je),Mt=Math.cos(Je);return Re[0]=Xe*Mt-at*nt,Re[1]=tt*Mt+ft*nt,Re[2]=at*Mt+Xe*nt,Re[3]=ft*Mt-tt*nt,Re},se.rotateZ=function(Re,He,Je){Je*=.5;var Xe=He[0],tt=He[1],at=He[2],ft=He[3],nt=Math.sin(Je),Mt=Math.cos(Je);return Re[0]=Xe*Mt+tt*nt,Re[1]=tt*Mt-Xe*nt,Re[2]=at*Mt+ft*nt,Re[3]=ft*Mt-at*nt,Re},se.calculateW=function(Re,He){var Je=He[0],Xe=He[1],tt=He[2];return Re[0]=Je,Re[1]=Xe,Re[2]=tt,Re[3]=Math.sqrt(Math.abs(1-Je*Je-Xe*Xe-tt*tt)),Re},se.exp=x,se.ln=A,se.pow=function(Re,He,Je){return A(Re,He),C(Re,Re,Je),x(Re,Re),Re},se.slerp=I,se.random=function(Re){var He=t.RANDOM(),Je=t.RANDOM(),Xe=t.RANDOM(),tt=Math.sqrt(1-He),at=Math.sqrt(He);return Re[0]=tt*Math.sin(2*Math.PI*Je),Re[1]=tt*Math.cos(2*Math.PI*Je),Re[2]=at*Math.sin(2*Math.PI*Xe),Re[3]=at*Math.cos(2*Math.PI*Xe),Re},se.invert=function(Re,He){var Je=He[0],Xe=He[1],tt=He[2],at=He[3],ft=Je*Je+Xe*Xe+tt*tt+at*at,nt=ft?1/ft:0;return Re[0]=-Je*nt,Re[1]=-Xe*nt,Re[2]=-tt*nt,Re[3]=at*nt,Re},se.conjugate=function(Re,He){return Re[0]=-He[0],Re[1]=-He[1],Re[2]=-He[2],Re[3]=He[3],Re},se.fromMat3=E,se.fromEuler=function(Re,He,Je,Xe){var tt=.5*Math.PI/180;He*=tt,Je*=tt,Xe*=tt;var at=Math.sin(He),ft=Math.cos(He),nt=Math.sin(Je),Mt=Math.cos(Je),Ft=Math.sin(Xe),Ct=Math.cos(Xe);return Re[0]=at*Mt*Ct-ft*nt*Ft,Re[1]=ft*nt*Ct+at*Mt*Ft,Re[2]=ft*Mt*Ft-at*nt*Ct,Re[3]=ft*Mt*Ct+at*nt*Ft,Re},se.str=function(Re){return"quat("+Re[0]+", "+Re[1]+", "+Re[2]+", "+Re[3]+")"},se.setAxes=se.sqlerp=se.rotationTo=se.equals=se.exactEquals=se.normalize=se.sqrLen=se.squaredLength=se.len=se.length=se.lerp=se.dot=se.scale=se.mul=se.add=se.set=se.copy=se.fromValues=se.clone=void 0;var t=_(Q()),s=_(ue()),c=_(De()),m=_(mt());function h(Re){if(typeof WeakMap!="function")return null;var He=new WeakMap,Je=new WeakMap;return(h=function(Xe){return Xe?Je:He})(Re)}function _(Re,He){if(Re&&Re.__esModule)return Re;if(Re===null||l(Re)!=="object"&&typeof Re!="function")return{default:Re};var Je=h(He);if(Je&&Je.has(Re))return Je.get(Re);var Xe={},tt=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var at in Re)if(at!=="default"&&Object.prototype.hasOwnProperty.call(Re,at)){var ft=tt?Object.getOwnPropertyDescriptor(Re,at):null;ft&&(ft.get||ft.set)?Object.defineProperty(Xe,at,ft):Xe[at]=Re[at]}return Xe.default=Re,Je&&Je.set(Re,Xe),Xe}function w(){var Re=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(Re[0]=0,Re[1]=0,Re[2]=0),Re[3]=1,Re}function S(Re,He,Je){Je*=.5;var Xe=Math.sin(Je);return Re[0]=Xe*He[0],Re[1]=Xe*He[1],Re[2]=Xe*He[2],Re[3]=Math.cos(Je),Re}function P(Re,He,Je){var Xe=He[0],tt=He[1],at=He[2],ft=He[3],nt=Je[0],Mt=Je[1],Ft=Je[2],Ct=Je[3];return Re[0]=Xe*Ct+ft*nt+tt*Ft-at*Mt,Re[1]=tt*Ct+ft*Mt+at*nt-Xe*Ft,Re[2]=at*Ct+ft*Ft+Xe*Mt-tt*nt,Re[3]=ft*Ct-Xe*nt-tt*Mt-at*Ft,Re}function x(Re,He){var Je=He[0],Xe=He[1],tt=He[2],at=He[3],ft=Math.sqrt(Je*Je+Xe*Xe+tt*tt),nt=Math.exp(at),Mt=ft>0?nt*Math.sin(ft)/ft:0;return Re[0]=Je*Mt,Re[1]=Xe*Mt,Re[2]=tt*Mt,Re[3]=nt*Math.cos(ft),Re}function A(Re,He){var Je=He[0],Xe=He[1],tt=He[2],at=He[3],ft=Math.sqrt(Je*Je+Xe*Xe+tt*tt),nt=ft>0?Math.atan2(ft,at)/ft:0;return Re[0]=Je*nt,Re[1]=Xe*nt,Re[2]=tt*nt,Re[3]=.5*Math.log(Je*Je+Xe*Xe+tt*tt+at*at),Re}function I(Re,He,Je,Xe){var tt,at,ft,nt,Mt,Ft=He[0],Ct=He[1],si=He[2],ri=He[3],Wt=Je[0],Bt=Je[1],wi=Je[2],ai=Je[3];return(at=Ft*Wt+Ct*Bt+si*wi+ri*ai)<0&&(at=-at,Wt=-Wt,Bt=-Bt,wi=-wi,ai=-ai),1-at>t.EPSILON?(tt=Math.acos(at),ft=Math.sin(tt),nt=Math.sin((1-Xe)*tt)/ft,Mt=Math.sin(Xe*tt)/ft):(nt=1-Xe,Mt=Xe),Re[0]=nt*Ft+Mt*Wt,Re[1]=nt*Ct+Mt*Bt,Re[2]=nt*si+Mt*wi,Re[3]=nt*ri+Mt*ai,Re}function E(Re,He){var Je,Xe=He[0]+He[4]+He[8];if(Xe>0)Je=Math.sqrt(Xe+1),Re[3]=.5*Je,Re[0]=(He[5]-He[7])*(Je=.5/Je),Re[1]=(He[6]-He[2])*Je,Re[2]=(He[1]-He[3])*Je;else{var tt=0;He[4]>He[0]&&(tt=1),He[8]>He[3*tt+tt]&&(tt=2);var at=(tt+1)%3,ft=(tt+2)%3;Je=Math.sqrt(He[3*tt+tt]-He[3*at+at]-He[3*ft+ft]+1),Re[tt]=.5*Je,Re[3]=(He[3*at+ft]-He[3*ft+at])*(Je=.5/Je),Re[at]=(He[3*at+tt]+He[3*tt+at])*Je,Re[ft]=(He[3*ft+tt]+He[3*tt+ft])*Je}return Re}se.clone=m.clone,se.fromValues=m.fromValues,se.copy=m.copy,se.set=m.set,se.add=m.add,se.mul=P;var C=m.scale;se.scale=C;var R=m.dot;se.dot=R,se.lerp=m.lerp;var z=m.length;se.length=z,se.len=z;var V=m.squaredLength;se.squaredLength=V,se.sqrLen=V;var W=m.normalize;se.normalize=W,se.exactEquals=m.exactEquals,se.equals=m.equals;var Y,$,J,ie=(Y=c.create(),$=c.fromValues(1,0,0),J=c.fromValues(0,1,0),function(Re,He,Je){var Xe=c.dot(He,Je);return Xe<-.999999?(c.cross(Y,$,He),c.len(Y)<1e-6&&c.cross(Y,J,He),c.normalize(Y,Y),S(Re,Y,Math.PI),Re):Xe>.999999?(Re[0]=0,Re[1]=0,Re[2]=0,Re[3]=1,Re):(c.cross(Y,He,Je),Re[0]=Y[0],Re[1]=Y[1],Re[2]=Y[2],Re[3]=1+Xe,W(Re,Re))});se.rotationTo=ie;var ge,Pe,Me=(ge=w(),Pe=w(),function(Re,He,Je,Xe,tt,at){return I(ge,He,tt,at),I(Pe,Je,Xe,at),I(Re,ge,Pe,2*at*(1-at)),Re});se.sqlerp=Me;var Ce,$e=(Ce=s.create(),function(Re,He,Je,Xe){return Ce[0]=Je[0],Ce[3]=Je[1],Ce[6]=Je[2],Ce[1]=Xe[0],Ce[4]=Xe[1],Ce[7]=Xe[2],Ce[2]=-He[0],Ce[5]=-He[1],Ce[8]=-He[2],W(Re,E(Re,Ce))});return se.setAxes=$e,se}var Qe,vt={};function st(){if(Qe)return vt;function l(I){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},l(I)}Qe=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.create=function(){var I=new t.ARRAY_TYPE(8);return t.ARRAY_TYPE!=Float32Array&&(I[0]=0,I[1]=0,I[2]=0,I[4]=0,I[5]=0,I[6]=0,I[7]=0),I[3]=1,I},vt.clone=function(I){var E=new t.ARRAY_TYPE(8);return E[0]=I[0],E[1]=I[1],E[2]=I[2],E[3]=I[3],E[4]=I[4],E[5]=I[5],E[6]=I[6],E[7]=I[7],E},vt.fromValues=function(I,E,C,R,z,V,W,Y){var $=new t.ARRAY_TYPE(8);return $[0]=I,$[1]=E,$[2]=C,$[3]=R,$[4]=z,$[5]=V,$[6]=W,$[7]=Y,$},vt.fromRotationTranslationValues=function(I,E,C,R,z,V,W){var Y=new t.ARRAY_TYPE(8);Y[0]=I,Y[1]=E,Y[2]=C,Y[3]=R;var $=.5*z,J=.5*V,ie=.5*W;return Y[4]=$*R+J*C-ie*E,Y[5]=J*R+ie*I-$*C,Y[6]=ie*R+$*E-J*I,Y[7]=-$*I-J*E-ie*C,Y},vt.fromRotationTranslation=_,vt.fromTranslation=function(I,E){return I[0]=0,I[1]=0,I[2]=0,I[3]=1,I[4]=.5*E[0],I[5]=.5*E[1],I[6]=.5*E[2],I[7]=0,I},vt.fromRotation=function(I,E){return I[0]=E[0],I[1]=E[1],I[2]=E[2],I[3]=E[3],I[4]=0,I[5]=0,I[6]=0,I[7]=0,I},vt.fromMat4=function(I,E){var C=s.create();c.getRotation(C,E);var R=new t.ARRAY_TYPE(3);return c.getTranslation(R,E),_(I,C,R),I},vt.copy=w,vt.identity=function(I){return I[0]=0,I[1]=0,I[2]=0,I[3]=1,I[4]=0,I[5]=0,I[6]=0,I[7]=0,I},vt.set=function(I,E,C,R,z,V,W,Y,$){return I[0]=E,I[1]=C,I[2]=R,I[3]=z,I[4]=V,I[5]=W,I[6]=Y,I[7]=$,I},vt.getDual=function(I,E){return I[0]=E[4],I[1]=E[5],I[2]=E[6],I[3]=E[7],I},vt.setDual=function(I,E){return I[4]=E[0],I[5]=E[1],I[6]=E[2],I[7]=E[3],I},vt.getTranslation=function(I,E){var C=E[4],R=E[5],z=E[6],V=E[7],W=-E[0],Y=-E[1],$=-E[2],J=E[3];return I[0]=2*(C*J+V*W+R*$-z*Y),I[1]=2*(R*J+V*Y+z*W-C*$),I[2]=2*(z*J+V*$+C*Y-R*W),I},vt.translate=function(I,E,C){var R=E[0],z=E[1],V=E[2],W=E[3],Y=.5*C[0],$=.5*C[1],J=.5*C[2],ie=E[4],ge=E[5],Pe=E[6],Me=E[7];return I[0]=R,I[1]=z,I[2]=V,I[3]=W,I[4]=W*Y+z*J-V*$+ie,I[5]=W*$+V*Y-R*J+ge,I[6]=W*J+R*$-z*Y+Pe,I[7]=-R*Y-z*$-V*J+Me,I},vt.rotateX=function(I,E,C){var R=-E[0],z=-E[1],V=-E[2],W=E[3],Y=E[4],$=E[5],J=E[6],ie=E[7],ge=Y*W+ie*R+$*V-J*z,Pe=$*W+ie*z+J*R-Y*V,Me=J*W+ie*V+Y*z-$*R,Ce=ie*W-Y*R-$*z-J*V;return s.rotateX(I,E,C),I[4]=ge*(W=I[3])+Ce*(R=I[0])+Pe*(V=I[2])-Me*(z=I[1]),I[5]=Pe*W+Ce*z+Me*R-ge*V,I[6]=Me*W+Ce*V+ge*z-Pe*R,I[7]=Ce*W-ge*R-Pe*z-Me*V,I},vt.rotateY=function(I,E,C){var R=-E[0],z=-E[1],V=-E[2],W=E[3],Y=E[4],$=E[5],J=E[6],ie=E[7],ge=Y*W+ie*R+$*V-J*z,Pe=$*W+ie*z+J*R-Y*V,Me=J*W+ie*V+Y*z-$*R,Ce=ie*W-Y*R-$*z-J*V;return s.rotateY(I,E,C),I[4]=ge*(W=I[3])+Ce*(R=I[0])+Pe*(V=I[2])-Me*(z=I[1]),I[5]=Pe*W+Ce*z+Me*R-ge*V,I[6]=Me*W+Ce*V+ge*z-Pe*R,I[7]=Ce*W-ge*R-Pe*z-Me*V,I},vt.rotateZ=function(I,E,C){var R=-E[0],z=-E[1],V=-E[2],W=E[3],Y=E[4],$=E[5],J=E[6],ie=E[7],ge=Y*W+ie*R+$*V-J*z,Pe=$*W+ie*z+J*R-Y*V,Me=J*W+ie*V+Y*z-$*R,Ce=ie*W-Y*R-$*z-J*V;return s.rotateZ(I,E,C),I[4]=ge*(W=I[3])+Ce*(R=I[0])+Pe*(V=I[2])-Me*(z=I[1]),I[5]=Pe*W+Ce*z+Me*R-ge*V,I[6]=Me*W+Ce*V+ge*z-Pe*R,I[7]=Ce*W-ge*R-Pe*z-Me*V,I},vt.rotateByQuatAppend=function(I,E,C){var R=C[0],z=C[1],V=C[2],W=C[3],Y=E[0],$=E[1],J=E[2],ie=E[3];return I[0]=Y*W+ie*R+$*V-J*z,I[1]=$*W+ie*z+J*R-Y*V,I[2]=J*W+ie*V+Y*z-$*R,I[3]=ie*W-Y*R-$*z-J*V,I[4]=(Y=E[4])*W+(ie=E[7])*R+($=E[5])*V-(J=E[6])*z,I[5]=$*W+ie*z+J*R-Y*V,I[6]=J*W+ie*V+Y*z-$*R,I[7]=ie*W-Y*R-$*z-J*V,I},vt.rotateByQuatPrepend=function(I,E,C){var R=E[0],z=E[1],V=E[2],W=E[3],Y=C[0],$=C[1],J=C[2],ie=C[3];return I[0]=R*ie+W*Y+z*J-V*$,I[1]=z*ie+W*$+V*Y-R*J,I[2]=V*ie+W*J+R*$-z*Y,I[3]=W*ie-R*Y-z*$-V*J,I[4]=R*(ie=C[7])+W*(Y=C[4])+z*(J=C[6])-V*($=C[5]),I[5]=z*ie+W*$+V*Y-R*J,I[6]=V*ie+W*J+R*$-z*Y,I[7]=W*ie-R*Y-z*$-V*J,I},vt.rotateAroundAxis=function(I,E,C,R){if(Math.abs(R)<t.EPSILON)return w(I,E);var z=Math.hypot(C[0],C[1],C[2]);R*=.5;var V=Math.sin(R),W=V*C[0]/z,Y=V*C[1]/z,$=V*C[2]/z,J=Math.cos(R),ie=E[0],ge=E[1],Pe=E[2],Me=E[3];I[0]=ie*J+Me*W+ge*$-Pe*Y,I[1]=ge*J+Me*Y+Pe*W-ie*$,I[2]=Pe*J+Me*$+ie*Y-ge*W,I[3]=Me*J-ie*W-ge*Y-Pe*$;var Ce=E[4],$e=E[5],Re=E[6],He=E[7];return I[4]=Ce*J+He*W+$e*$-Re*Y,I[5]=$e*J+He*Y+Re*W-Ce*$,I[6]=Re*J+He*$+Ce*Y-$e*W,I[7]=He*J-Ce*W-$e*Y-Re*$,I},vt.add=function(I,E,C){return I[0]=E[0]+C[0],I[1]=E[1]+C[1],I[2]=E[2]+C[2],I[3]=E[3]+C[3],I[4]=E[4]+C[4],I[5]=E[5]+C[5],I[6]=E[6]+C[6],I[7]=E[7]+C[7],I},vt.multiply=S,vt.scale=function(I,E,C){return I[0]=E[0]*C,I[1]=E[1]*C,I[2]=E[2]*C,I[3]=E[3]*C,I[4]=E[4]*C,I[5]=E[5]*C,I[6]=E[6]*C,I[7]=E[7]*C,I},vt.lerp=function(I,E,C,R){var z=1-R;return P(E,C)<0&&(R=-R),I[0]=E[0]*z+C[0]*R,I[1]=E[1]*z+C[1]*R,I[2]=E[2]*z+C[2]*R,I[3]=E[3]*z+C[3]*R,I[4]=E[4]*z+C[4]*R,I[5]=E[5]*z+C[5]*R,I[6]=E[6]*z+C[6]*R,I[7]=E[7]*z+C[7]*R,I},vt.invert=function(I,E){var C=A(E);return I[0]=-E[0]/C,I[1]=-E[1]/C,I[2]=-E[2]/C,I[3]=E[3]/C,I[4]=-E[4]/C,I[5]=-E[5]/C,I[6]=-E[6]/C,I[7]=E[7]/C,I},vt.conjugate=function(I,E){return I[0]=-E[0],I[1]=-E[1],I[2]=-E[2],I[3]=E[3],I[4]=-E[4],I[5]=-E[5],I[6]=-E[6],I[7]=E[7],I},vt.normalize=function(I,E){var C=A(E);if(C>0){C=Math.sqrt(C);var R=E[0]/C,z=E[1]/C,V=E[2]/C,W=E[3]/C,Y=E[4],$=E[5],J=E[6],ie=E[7],ge=R*Y+z*$+V*J+W*ie;I[0]=R,I[1]=z,I[2]=V,I[3]=W,I[4]=(Y-R*ge)/C,I[5]=($-z*ge)/C,I[6]=(J-V*ge)/C,I[7]=(ie-W*ge)/C}return I},vt.str=function(I){return"quat2("+I[0]+", "+I[1]+", "+I[2]+", "+I[3]+", "+I[4]+", "+I[5]+", "+I[6]+", "+I[7]+")"},vt.exactEquals=function(I,E){return I[0]===E[0]&&I[1]===E[1]&&I[2]===E[2]&&I[3]===E[3]&&I[4]===E[4]&&I[5]===E[5]&&I[6]===E[6]&&I[7]===E[7]},vt.equals=function(I,E){var C=I[0],R=I[1],z=I[2],V=I[3],W=I[4],Y=I[5],$=I[6],J=I[7],ie=E[0],ge=E[1],Pe=E[2],Me=E[3],Ce=E[4],$e=E[5],Re=E[6],He=E[7];return Math.abs(C-ie)<=t.EPSILON*Math.max(1,Math.abs(C),Math.abs(ie))&&Math.abs(R-ge)<=t.EPSILON*Math.max(1,Math.abs(R),Math.abs(ge))&&Math.abs(z-Pe)<=t.EPSILON*Math.max(1,Math.abs(z),Math.abs(Pe))&&Math.abs(V-Me)<=t.EPSILON*Math.max(1,Math.abs(V),Math.abs(Me))&&Math.abs(W-Ce)<=t.EPSILON*Math.max(1,Math.abs(W),Math.abs(Ce))&&Math.abs(Y-$e)<=t.EPSILON*Math.max(1,Math.abs(Y),Math.abs($e))&&Math.abs($-Re)<=t.EPSILON*Math.max(1,Math.abs($),Math.abs(Re))&&Math.abs(J-He)<=t.EPSILON*Math.max(1,Math.abs(J),Math.abs(He))},vt.sqrLen=vt.squaredLength=vt.len=vt.length=vt.dot=vt.mul=vt.setReal=vt.getReal=void 0;var t=h(Q()),s=h(et()),c=h(re());function m(I){if(typeof WeakMap!="function")return null;var E=new WeakMap,C=new WeakMap;return(m=function(R){return R?C:E})(I)}function h(I,E){if(I&&I.__esModule)return I;if(I===null||l(I)!=="object"&&typeof I!="function")return{default:I};var C=m(E);if(C&&C.has(I))return C.get(I);var R={},z=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var V in I)if(V!=="default"&&Object.prototype.hasOwnProperty.call(I,V)){var W=z?Object.getOwnPropertyDescriptor(I,V):null;W&&(W.get||W.set)?Object.defineProperty(R,V,W):R[V]=I[V]}return R.default=I,C&&C.set(I,R),R}function _(I,E,C){var R=.5*C[0],z=.5*C[1],V=.5*C[2],W=E[0],Y=E[1],$=E[2],J=E[3];return I[0]=W,I[1]=Y,I[2]=$,I[3]=J,I[4]=R*J+z*$-V*Y,I[5]=z*J+V*W-R*$,I[6]=V*J+R*Y-z*W,I[7]=-R*W-z*Y-V*$,I}function w(I,E){return I[0]=E[0],I[1]=E[1],I[2]=E[2],I[3]=E[3],I[4]=E[4],I[5]=E[5],I[6]=E[6],I[7]=E[7],I}function S(I,E,C){var R=E[0],z=E[1],V=E[2],W=E[3],Y=C[4],$=C[5],J=C[6],ie=C[7],ge=E[4],Pe=E[5],Me=E[6],Ce=E[7],$e=C[0],Re=C[1],He=C[2],Je=C[3];return I[0]=R*Je+W*$e+z*He-V*Re,I[1]=z*Je+W*Re+V*$e-R*He,I[2]=V*Je+W*He+R*Re-z*$e,I[3]=W*Je-R*$e-z*Re-V*He,I[4]=R*ie+W*Y+z*J-V*$+ge*Je+Ce*$e+Pe*He-Me*Re,I[5]=z*ie+W*$+V*Y-R*J+Pe*Je+Ce*Re+Me*$e-ge*He,I[6]=V*ie+W*J+R*$-z*Y+Me*Je+Ce*He+ge*Re-Pe*$e,I[7]=W*ie-R*Y-z*$-V*J+Ce*Je-ge*$e-Pe*Re-Me*He,I}vt.getReal=s.copy,vt.setReal=s.copy,vt.mul=S;var P=s.dot;vt.dot=P;var x=s.length;vt.length=x,vt.len=x;var A=s.squaredLength;return vt.squaredLength=A,vt.sqrLen=A,vt}var Zt,ui,ni={};function Hi(){if(Zt)return ni;function l(E){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},l(E)}Zt=1,Object.defineProperty(ni,"__esModule",{value:!0}),ni.create=c,ni.clone=function(E){var C=new t.ARRAY_TYPE(2);return C[0]=E[0],C[1]=E[1],C},ni.fromValues=function(E,C){var R=new t.ARRAY_TYPE(2);return R[0]=E,R[1]=C,R},ni.copy=function(E,C){return E[0]=C[0],E[1]=C[1],E},ni.set=function(E,C,R){return E[0]=C,E[1]=R,E},ni.add=function(E,C,R){return E[0]=C[0]+R[0],E[1]=C[1]+R[1],E},ni.subtract=m,ni.multiply=h,ni.divide=_,ni.ceil=function(E,C){return E[0]=Math.ceil(C[0]),E[1]=Math.ceil(C[1]),E},ni.floor=function(E,C){return E[0]=Math.floor(C[0]),E[1]=Math.floor(C[1]),E},ni.min=function(E,C,R){return E[0]=Math.min(C[0],R[0]),E[1]=Math.min(C[1],R[1]),E},ni.max=function(E,C,R){return E[0]=Math.max(C[0],R[0]),E[1]=Math.max(C[1],R[1]),E},ni.round=function(E,C){return E[0]=Math.round(C[0]),E[1]=Math.round(C[1]),E},ni.scale=function(E,C,R){return E[0]=C[0]*R,E[1]=C[1]*R,E},ni.scaleAndAdd=function(E,C,R,z){return E[0]=C[0]+R[0]*z,E[1]=C[1]+R[1]*z,E},ni.distance=w,ni.squaredDistance=S,ni.length=P,ni.squaredLength=x,ni.negate=function(E,C){return E[0]=-C[0],E[1]=-C[1],E},ni.inverse=function(E,C){return E[0]=1/C[0],E[1]=1/C[1],E},ni.normalize=function(E,C){var R=C[0],z=C[1],V=R*R+z*z;return V>0&&(V=1/Math.sqrt(V)),E[0]=C[0]*V,E[1]=C[1]*V,E},ni.dot=function(E,C){return E[0]*C[0]+E[1]*C[1]},ni.cross=function(E,C,R){var z=C[0]*R[1]-C[1]*R[0];return E[0]=E[1]=0,E[2]=z,E},ni.lerp=function(E,C,R,z){var V=C[0],W=C[1];return E[0]=V+z*(R[0]-V),E[1]=W+z*(R[1]-W),E},ni.random=function(E,C){C=C||1;var R=2*t.RANDOM()*Math.PI;return E[0]=Math.cos(R)*C,E[1]=Math.sin(R)*C,E},ni.transformMat2=function(E,C,R){var z=C[0],V=C[1];return E[0]=R[0]*z+R[2]*V,E[1]=R[1]*z+R[3]*V,E},ni.transformMat2d=function(E,C,R){var z=C[0],V=C[1];return E[0]=R[0]*z+R[2]*V+R[4],E[1]=R[1]*z+R[3]*V+R[5],E},ni.transformMat3=function(E,C,R){var z=C[0],V=C[1];return E[0]=R[0]*z+R[3]*V+R[6],E[1]=R[1]*z+R[4]*V+R[7],E},ni.transformMat4=function(E,C,R){var z=C[0],V=C[1];return E[0]=R[0]*z+R[4]*V+R[12],E[1]=R[1]*z+R[5]*V+R[13],E},ni.rotate=function(E,C,R,z){var V=C[0]-R[0],W=C[1]-R[1],Y=Math.sin(z),$=Math.cos(z);return E[0]=V*$-W*Y+R[0],E[1]=V*Y+W*$+R[1],E},ni.angle=function(E,C){var R=E[0],z=E[1],V=C[0],W=C[1],Y=Math.sqrt(R*R+z*z)*Math.sqrt(V*V+W*W);return Math.acos(Math.min(Math.max(Y&&(R*V+z*W)/Y,-1),1))},ni.zero=function(E){return E[0]=0,E[1]=0,E},ni.str=function(E){return"vec2("+E[0]+", "+E[1]+")"},ni.exactEquals=function(E,C){return E[0]===C[0]&&E[1]===C[1]},ni.equals=function(E,C){var R=E[0],z=E[1],V=C[0],W=C[1];return Math.abs(R-V)<=t.EPSILON*Math.max(1,Math.abs(R),Math.abs(V))&&Math.abs(z-W)<=t.EPSILON*Math.max(1,Math.abs(z),Math.abs(W))},ni.forEach=ni.sqrLen=ni.sqrDist=ni.dist=ni.div=ni.mul=ni.sub=ni.len=void 0;var t=function(E,C){if(E&&E.__esModule)return E;if(E===null||l(E)!=="object"&&typeof E!="function")return{default:E};var R=s(void 0);if(R&&R.has(E))return R.get(E);var z={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var W in E)if(W!=="default"&&Object.prototype.hasOwnProperty.call(E,W)){var Y=V?Object.getOwnPropertyDescriptor(E,W):null;Y&&(Y.get||Y.set)?Object.defineProperty(z,W,Y):z[W]=E[W]}return z.default=E,R&&R.set(E,z),z}(Q());function s(E){if(typeof WeakMap!="function")return null;var C=new WeakMap,R=new WeakMap;return(s=function(z){return z?R:C})(E)}function c(){var E=new t.ARRAY_TYPE(2);return t.ARRAY_TYPE!=Float32Array&&(E[0]=0,E[1]=0),E}function m(E,C,R){return E[0]=C[0]-R[0],E[1]=C[1]-R[1],E}function h(E,C,R){return E[0]=C[0]*R[0],E[1]=C[1]*R[1],E}function _(E,C,R){return E[0]=C[0]/R[0],E[1]=C[1]/R[1],E}function w(E,C){return Math.hypot(C[0]-E[0],C[1]-E[1])}function S(E,C){var R=C[0]-E[0],z=C[1]-E[1];return R*R+z*z}function P(E){return Math.hypot(E[0],E[1])}function x(E){var C=E[0],R=E[1];return C*C+R*R}ni.len=P,ni.sub=m,ni.mul=h,ni.div=_,ni.dist=w,ni.sqrDist=S,ni.sqrLen=x;var A,I=(A=c(),function(E,C,R,z,V,W){var Y,$;for(C||(C=2),R||(R=0),$=z?Math.min(z*C+R,E.length):E.length,Y=R;Y<$;Y+=C)A[0]=E[Y],A[1]=E[Y+1],V(A,A,W),E[Y]=A[0],E[Y+1]=A[1];return E});return ni.forEach=I,ni}function Ci(){if(ui)return F;function l(E){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},l(E)}ui=1,Object.defineProperty(F,"__esModule",{value:!0}),F.vec4=F.vec3=F.vec2=F.quat2=F.quat=F.mat4=F.mat3=F.mat2d=F.mat2=F.glMatrix=void 0;var t=I(Q());F.glMatrix=t;var s=I(G());F.mat2=s;var c=I(Te());F.mat2d=c;var m=I(ue());F.mat3=m;var h=I(re());F.mat4=h;var _=I(et());F.quat=_;var w=I(st());F.quat2=w;var S=I(Hi());F.vec2=S;var P=I(De());F.vec3=P;var x=I(mt());function A(E){if(typeof WeakMap!="function")return null;var C=new WeakMap,R=new WeakMap;return(A=function(z){return z?R:C})(E)}function I(E,C){if(E&&E.__esModule)return E;if(E===null||l(E)!=="object"&&typeof E!="function")return{default:E};var R=A(C);if(R&&R.has(E))return R.get(E);var z={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var W in E)if(W!=="default"&&Object.prototype.hasOwnProperty.call(E,W)){var Y=V?Object.getOwnPropertyDescriptor(E,W):null;Y&&(Y.get||Y.set)?Object.defineProperty(z,W,Y):z[W]=E[W]}return z.default=E,R&&R.set(E,z),z}return F.vec4=x,F}var Ii,Ui,xi,Yi,H=Ci(),be=function(){if(Ui)return Ii;function l(t,s,c,m){this.cx=3*t,this.bx=3*(c-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(m-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=s,this.p2x=c,this.p2y=m}return Ui=1,Ii=l,l.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,s){if(s===void 0&&(s=1e-6),t<0)return 0;if(t>1)return 1;for(var c=t,m=0;m<8;m++){var h=this.sampleCurveX(c)-t;if(Math.abs(h)<s)return c;var _=this.sampleCurveDerivativeX(c);if(Math.abs(_)<1e-6)break;c-=h/_}var w=0,S=1;for(c=t,m=0;m<20&&(h=this.sampleCurveX(c),!(Math.abs(h-t)<s));m++)t>h?w=c:S=c,c=.5*(S-w)+w;return c},solve:function(t,s){return this.sampleCurveY(this.solveCurveX(t,s))}},Ii}(),Be=D(be);function Ee(){if(Yi)return xi;function l(t,s){this.x=t,this.y=s}return Yi=1,xi=l,l.prototype={clone:function(){return new l(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,s){return this.clone()._rotateAround(t,s)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var s=t.x-this.x,c=t.y-this.y;return s*s+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,s){return Math.atan2(this.x*s-this.y*t,this.x*t+this.y*s)},_matMult:function(t){var s=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=s,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var s=Math.cos(t),c=Math.sin(t),m=c*this.x+s*this.y;return this.x=s*this.x-c*this.y,this.y=m,this},_rotateAround:function(t,s){var c=Math.cos(t),m=Math.sin(t),h=s.y+m*(this.x-s.x)+c*(this.y-s.y);return this.x=s.x+c*(this.x-s.x)-m*(this.y-s.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},l.convert=function(t){return t instanceof l?t:Array.isArray(t)?new l(t[0],t[1]):t},xi}var ve=D(Ee());function Ie(l,t){if(Array.isArray(l)){if(!Array.isArray(t)||l.length!==t.length)return!1;for(let s=0;s<l.length;s++)if(!Ie(l[s],t[s]))return!1;return!0}if(typeof l=="object"&&l!==null&&t!==null){if(typeof t!="object"||Object.keys(l).length!==Object.keys(t).length)return!1;for(const s in l)if(!Ie(l[s],t[s]))return!1;return!0}return l===t}const Tt=Math.PI/180,qe=180/Math.PI;function Et(l){return l*Tt}function It(l){return l*qe}const $t=[[0,0],[1,0],[1,1],[0,1]];function Kt(l){if(l<=0)return 0;if(l>=1)return 1;const t=l*l,s=t*l;return 4*(l<.5?s:3*(l-t)+s-.75)}function ti(l,t,s,c){const m=new Be(l,t,s,c);return function(h){return m.solve(h)}}const Li=ti(.25,.1,.25,1);function Ut(l,t,s){return Math.min(s,Math.max(t,l))}function yi(l,t,s){return(s=Ut((s-l)/(t-l),0,1))*s*(3-2*s)}function zi(l,t,s){const c=s-t,m=((l-t)%c+c)%c+t;return m===t?s:m}function Ni(l,t,s){if(!l.length)return s(null,[]);let c=l.length;const m=new Array(l.length);let h=null;l.forEach((_,w)=>{t(_,(S,P)=>{S&&(h=S),m[w]=P,--c==0&&s(h,m)})})}function Ki(l,...t){for(const s of t)for(const c in s)l[c]=s[c];return l}let sr=1;function Rr(){return sr++}function Yr(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))}function kr(l,t){l.forEach(s=>{t[s]&&(t[s]=t[s].bind(t))})}function yr(l,t){return l.indexOf(t,l.length-t.length)!==-1}function nn(l,t,s){const c={};for(const m in l)c[m]=t.call(this,l[m],m,l);return c}function Ts(l,t,s){const c={};for(const m in l)t.call(this,l[m],m,l)&&(c[m]=l[m]);return c}function Ar(l){return Array.isArray(l)?l.map(Ar):typeof l=="object"&&l?nn(l,Ar):l}const Ur={};function Vi(l){Ur[l]||(typeof console<"u"&&console.warn(l),Ur[l]=!0)}function Zi(l,t,s){return(s.y-l.y)*(t.x-l.x)>(t.y-l.y)*(s.x-l.x)}function Rn(l){let t=0;for(let s,c,m=0,h=l.length,_=h-1;m<h;_=m++)s=l[m],c=l[_],t+=(c.x-s.x)*(s.y+c.y);return t}function tr([l,t,s]){const c=Et(t+90),m=Et(s);return{x:l*Math.cos(c)*Math.sin(m),y:l*Math.sin(c)*Math.sin(m),z:l*Math.cos(m),azimuthal:t,polar:s}}function Yn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function xn(l){const t={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,m,h)=>{const _=m||h;return t[c]=!_||_.toLowerCase(),""}),t["max-age"]){const s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t}let $n=null;function Dn(l,t){return[l[4*t],l[4*t+1],l[4*t+2],l[4*t+3]]}function Hs(l,t,s,c){for(;t<s;){const m=t+s>>1;l[m]<c?t=m+1:s=m}return t}function Rs(l,t,s,c){for(;t<s;){const m=t+s>>1;l[m]<=c?t=m+1:s=m}return t}function vr(l){return l>0?1/(1.001-l):1+l}function or(l){return l>0?1-1/(1.001-l):-l}const lr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!lr.API_URL)return null;try{const l=new URL(lr.API_URL);return l.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":l.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Pi(l){return lr.API_URL_REGEX.test(l)}function br(l){return lr.API_SPRITE_REGEX.test(l)}let ir,Ji,gn,ot,ee,de;function we(){return ir==null&&(ir=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),ir}const ze={now:()=>ot!==void 0?ot:performance.now(),setNow(l){ot=l},restoreNow(){ot=void 0},frame(l){const t=requestAnimationFrame(l);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(l,t=0){const{width:s,height:c}=l;ee||(ee=document.createElement("canvas"));const m=ee.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return(s>ee.width||c>ee.height)&&(ee.width=s,ee.height=c),m.clearRect(-t,-t,s+2*t,c+2*t),m.drawImage(l,0,0,s,c),m.getImageData(-t,-t,s+2*t,c+2*t)},resolveURL:l=>(Ji||(Ji=document.createElement("a")),Ji.href=l,Ji.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(gn==null&&(gn=window.matchMedia("(prefers-reduced-motion: reduce)")),gn.matches)},hasCanvasFingerprintNoise(){if(de!==void 0)return de;if(!we())return de=!1,!1;const l=new OffscreenCanvas(85,1),t=l.getContext("2d",{willReadFrequently:!0});let s=0;for(let m=0;m<l.width;++m)t.fillStyle=`rgba(${s++},${s++},${s++}, 255)`,t.fillRect(m,0,1,1);const c=t.getImageData(0,0,l.width,l.height);s=0;for(let m=0;m<c.data.length;++m)if(m%4!=3&&s++!==c.data[m])return de=!0,!0;return de=!1,!1}};function Le(l,t){const s=l.indexOf("?");if(s<0)return`${l}?${new URLSearchParams(t).toString()}`;const c=new URLSearchParams(l.slice(s));for(const m in t)c.set(m,t[m]);return`${l.slice(0,s)}?${c.toString()}`}function Ze(l,t={persistentParams:[]}){const s=l.indexOf("?");if(s<0)return l;const c=new URLSearchParams,m=new URLSearchParams(l.slice(s));for(const _ of t.persistentParams){const w=m.get(_);w&&c.set(_,w)}const h=c.toString();return`${l.slice(0,s)}${h.length>0?`?${h}`:""}`}const rt="mapbox-tiles";let We=500,pt=50;const lt=["language","worldview","jobid"];let dt,St;function qt(){try{return caches}catch{}}function Ht(){const l=qt();l&&dt==null&&(dt=l.open(rt))}let li=1/0;const pi={supported:!1,testSupport:function(l){!dr&&Mi&&(fr?_r(l):bi=l)}};let bi,Mi,dr=!1,fr=!1;const Gi=typeof self<"u"?self:{};function _r(l){const t=l.createTexture();l.bindTexture(l.TEXTURE_2D,t);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,Mi),l.isContextLost())return;pi.supported=!0}catch{}l.deleteTexture(t),dr=!0}Gi.document&&(Mi=Gi.document.createElement("img"),Mi.onload=function(){bi&&_r(bi),bi=null,fr=!0},Mi.onerror=function(){dr=!0,bi=null},Mi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const wr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(wr);class ki extends Error{constructor(t,s,c){s===401&&Pi(c)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=s,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Vs=Yn()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,An=function(l,t){if(!(/^file:/.test(s=l.url)||/^file:/.test(Vs())&&!/^\w+:/.test(s))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(c,m){const h=new AbortController,_=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Vs(),referrerPolicy:c.referrerPolicy,signal:h.signal});let w=!1,S=!1;const P=(x=_.url).indexOf("sku=")>0&&Pi(x);var x;c.type==="json"&&_.headers.set("Accept","application/json");const A=(E,C,R)=>{if(S)return;if(E&&E.message!=="SecurityError"&&Vi(E.toString()),C&&R)return I(C);const z=Date.now();fetch(_).then(V=>{if(V.ok){const W=P?V.clone():null;return I(V,W,z)}return m(new ki(V.statusText,V.status,c.url))}).catch(V=>{V.name!=="AbortError"&&m(new Error(`${V.message} ${c.url}`))})},I=(E,C,R)=>{(c.type==="arrayBuffer"?E.arrayBuffer():c.type==="json"?E.json():E.text()).then(z=>{S||(C&&R&&function(V,W,Y){if(Ht(),dt==null)return;const $=xn(W.headers.get("Cache-Control")||"");if($["no-store"])return;const J={status:W.status,statusText:W.statusText,headers:new Headers};W.headers.forEach((Pe,Me)=>J.headers.set(Me,Pe)),$["max-age"]&&J.headers.set("Expires",new Date(Y+1e3*$["max-age"]).toUTCString());const ie=J.headers.get("Expires");if(!ie||new Date(ie).getTime()-Y<42e4)return;let ge=Ze(V.url,{persistentParams:lt});if(W.status===206){const Pe=V.headers.get("Range");if(!Pe)return;J.status=200,ge=Le(ge,{range:Pe})}(function(Pe,Me){if(St===void 0)try{new Response(new ReadableStream),St=!0}catch{St=!1}St?Me(Pe.body):Pe.blob().then(Me)})(W,Pe=>{const Me=new Response((Ce=W.status)!==200&&Ce!==404&&[101,103,204,205,304].includes(Ce)?null:Pe,J);var Ce;Ht(),dt!=null&&dt.then($e=>$e.put(ge,Me)).catch($e=>Vi($e.message))})}(_,C,R),w=!0,m(null,z,E.headers.get("Cache-Control"),E.headers.get("Expires")))}).catch(z=>{S||m(new Error(z.message))})};return P?function(E,C){if(Ht(),dt==null)return C(null);dt.then(R=>{let z=Ze(E.url,{persistentParams:lt});const V=E.headers.get("Range");V&&(z=Le(z,{range:V})),R.match(z).then(W=>{const Y=function($){if(!$)return!1;const J=new Date($.headers.get("Expires")||0),ie=xn($.headers.get("Cache-Control")||"");return J>Date.now()&&!ie["no-cache"]}(W);R.delete(z),Y&&R.put(z,W.clone()),C(null,W,Y)}).catch(C)}).catch(C)}(_,A):A(null,null),{cancel:()=>{S=!0,w||h.abort()}}}(l,t);if(Yn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",l,t,void 0,!0)}var s;return function(c,m){const h=new XMLHttpRequest;h.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const _ in c.headers)h.setRequestHeader(_,c.headers[_]);return c.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=c.credentials==="include",h.onerror=()=>{m(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let _=h.response;if(c.type==="json")try{_=JSON.parse(h.response)}catch(w){return m(w)}m(null,_,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else m(new ki(h.statusText,h.status,c.url))},h.send(c.body),{cancel:()=>h.abort()}}(l,t)},On=function(l,t){return An(Ki(l,{type:"arrayBuffer"}),t)};function _s(l){const t=document.createElement("a");return t.href=l,t.protocol===location.protocol&&t.host===location.host}const ra="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let io,Cn;io=[],Cn=0;const Rc=function(l,t){if(pi.supported&&(l.headers||(l.headers={}),l.headers.accept="image/webp,*/*"),Cn>=lr.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:l,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return io.push(h),h}Cn++;let s=!1;const c=()=>{if(!s)for(s=!0,Cn--;io.length&&Cn<lr.MAX_PARALLEL_IMAGE_REQUESTS;){const h=io.shift(),{requestParameters:_,callback:w,cancelled:S}=h;S||(h.cancel=Rc(_,w).cancel)}},m=On(l,(h,_,w,S)=>{c(),h?t(h):_&&(self.createImageBitmap?function(P,x){const A=new Blob([new Uint8Array(P)],{type:"image/png"});createImageBitmap(A).then(I=>{x(null,I)}).catch(I=>{x(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(P,x)=>t(P,x,w,S)):function(P,x){const A=new Image;A.onload=()=>{x(null,A),URL.revokeObjectURL(A.src),A.onload=null,requestAnimationFrame(()=>{A.src=ra})},A.onerror=()=>x(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const I=new Blob([new Uint8Array(P)],{type:"image/png"});A.src=P.byteLength?URL.createObjectURL(I):ra}(_,(P,x)=>t(P,x,w,S)))});return{cancel:()=>{m.cancel(),c()}}};var Cp,Ro,zd,Gs={exports:{}},Fo={exports:{}},Bo={exports:{}},Ma=function(){if(zd)return Gs.exports;zd=1;var l=(Cp||(Cp=1,Fo.exports=function(s,c){var m,h,_,w,S,P,x,A;for(h=s.length-(m=3&s.length),_=c,S=3432918353,P=461845907,A=0;A<h;)x=255&s.charCodeAt(A)|(255&s.charCodeAt(++A))<<8|(255&s.charCodeAt(++A))<<16|(255&s.charCodeAt(++A))<<24,++A,_=27492+(65535&(w=5*(65535&(_=(_^=x=(65535&(x=(x=(65535&x)*S+(((x>>>16)*S&65535)<<16)&4294967295)<<15|x>>>17))*P+(((x>>>16)*P&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(x=0,m){case 3:x^=(255&s.charCodeAt(A+2))<<16;case 2:x^=(255&s.charCodeAt(A+1))<<8;case 1:_^=x=(65535&(x=(x=(65535&(x^=255&s.charCodeAt(A)))*S+(((x>>>16)*S&65535)<<16)&4294967295)<<15|x>>>17))*P+(((x>>>16)*P&65535)<<16)&4294967295}return _^=s.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),Fo.exports),t=(Ro||(Ro=1,Bo.exports=function(s,c){for(var m,h=s.length,_=c^h,w=0;h>=4;)m=1540483477*(65535&(m=255&s.charCodeAt(w)|(255&s.charCodeAt(++w))<<8|(255&s.charCodeAt(++w))<<16|(255&s.charCodeAt(++w))<<24))+((1540483477*(m>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),h-=4,++w;switch(h){case 3:_^=(255&s.charCodeAt(w+2))<<16;case 2:_^=(255&s.charCodeAt(w+1))<<8;case 1:_=1540483477*(65535&(_^=255&s.charCodeAt(w)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),Bo.exports);return Gs.exports=l,Gs.exports.murmur3=l,Gs.exports.murmur2=t,Gs.exports}(),Do=D(Ma);class Ia{constructor(t,...s){Ki(this,s[0]||{}),this.type=t}}class Dc extends Ia{constructor(t,s={}){super("error",Ki({error:t},s))}}function Fd(l,t,s){s[l]&&s[l].indexOf(t)!==-1||(s[l]=s[l]||[],s[l].push(t))}function Xa(l,t,s){if(s&&s[l]){const c=s[l].indexOf(t);c!==-1&&s[l].splice(c,1)}}class Ml{on(t,s){return this._listeners=this._listeners||{},Fd(t,s,this._listeners),this}off(t,s){return Xa(t,s,this._listeners),Xa(t,s,this._oneTimeListeners),this}once(t,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Fd(t,s,this._oneTimeListeners),this):new Promise(c=>this.once(t,c))}fire(t,s){const c=typeof t=="string"?new Ia(t,s):t,m=c.type;if(this.listens(m)){c.target=this;const h=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const S of h)S.call(this,c);const _=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const S of _)Xa(m,S,this._oneTimeListeners),S.call(this,c);const w=this._eventedParent;w&&(Ki(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(c))}else c instanceof Dc&&console.error(c.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}var Mp,lh={},rs=function(){if(Mp)return lh;Mp=1;var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function t(h){return(h=Math.round(h))<0?0:h>255?255:h}function s(h){return t(h[h.length-1]==="%"?parseFloat(h)/100*255:parseInt(h))}function c(h){return(_=h[h.length-1]==="%"?parseFloat(h)/100:parseFloat(h))<0?0:_>1?1:_;var _}function m(h,_,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?h+(_-h)*w*6:2*w<1?_:3*w<2?h+(_-h)*(2/3-w)*6:h}try{lh.parseCSSColor=function(h){var _,w=h.replace(/ /g,"").toLowerCase();if(w in l)return l[w].slice();if(w[0]==="#")return w.length===4?(_=parseInt(w.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:w.length===7&&(_=parseInt(w.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var S=w.indexOf("("),P=w.indexOf(")");if(S!==-1&&P+1===w.length){var x=w.substr(0,S),A=w.substr(S+1,P-(S+1)).split(","),I=1;switch(x){case"rgba":if(A.length!==4)return null;I=c(A.pop());case"rgb":return A.length!==3?null:[s(A[0]),s(A[1]),s(A[2]),I];case"hsla":if(A.length!==4)return null;I=c(A.pop());case"hsl":if(A.length!==3)return null;var E=(parseFloat(A[0])%360+360)%360/360,C=c(A[1]),R=c(A[2]),z=R<=.5?R*(C+1):R+C-R*C,V=2*R-z;return[t(255*m(V,z,E+1/3)),t(255*m(V,z,E)),t(255*m(V,z,E-1/3)),I];default:return null}}return null}}catch{}return lh}();class zr{constructor(t,s,c,m=1){this.r=t,this.g=s,this.b=c,this.a=m}static parse(t){if(!t)return;if(t instanceof zr)return t;if(typeof t!="string")return;const s=rs.parseCSSColor(t);return s?new zr(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toStringPremultipliedAlpha(){const[t,s,c,m]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(t)},${Math.round(s)},${Math.round(c)},${m})`}toString(){const[t,s,c,m]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*t)},${Math.round(255*s)},${Math.round(255*c)},${m})`}toRenderColor(t){const{r:s,g:c,b:m,a:h}=this;return new Bd(t,s,c,m,h)}clone(){return new zr(this.r,this.g,this.b,this.a)}}class Bd{constructor(t,s,c,m,h){if(t){const _=t.image.height,w=_*_;s=h===0?0:s/h*(_-1),c=h===0?0:c/h*(_-1),m=h===0?0:m/h*(_-1);const S=Math.floor(s),P=Math.floor(c),x=Math.floor(m),A=Math.ceil(s),I=Math.ceil(c),E=Math.ceil(m),C=s-S,R=c-P,z=m-x,V=t.image.data,W=4*(S+P*w+x*_),Y=4*(S+P*w+E*_),$=4*(S+I*w+x*_),J=4*(S+I*w+E*_),ie=4*(A+P*w+x*_),ge=4*(A+P*w+E*_),Pe=4*(A+I*w+x*_),Me=4*(A+I*w+E*_);if(W<0||Me>=V.length)throw new Error("out of range");this.r=Bi(Bi(Bi(V[W],V[Y],z),Bi(V[$],V[J],z),R),Bi(Bi(V[ie],V[ge],z),Bi(V[Pe],V[Me],z),R),C)/255*h,this.g=Bi(Bi(Bi(V[W+1],V[Y+1],z),Bi(V[$+1],V[J+1],z),R),Bi(Bi(V[ie+1],V[ge+1],z),Bi(V[Pe+1],V[Me+1],z),R),C)/255*h,this.b=Bi(Bi(Bi(V[W+2],V[Y+2],z),Bi(V[$+2],V[J+2],z),R),Bi(Bi(V[ie+2],V[ge+2],z),Bi(V[Pe+2],V[Me+2],z),R),C)/255*h,this.a=h}else this.r=s,this.g=c,this.b=m,this.a=h}toArray(){const{r:t,g:s,b:c,a:m}=this;return m===0?[0,0,0,0]:[255*t/m,255*s/m,255*c/m,m]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:t,g:s,b:c,a:m}=this,h=Math.min(Math.max(t/m,0),1),_=Math.min(Math.max(s/m,0),1),w=Math.min(Math.max(c/m,0),1),S=Math.min(h,_,w),P=Math.max(h,_,w),x=(S+P)/2;if(S===P)return[0,0,100*x,m];const A=P-S,I=x>.5?A/(2-P-S):A/(P+S);let E=0;return P===h?E=(_-w)/A+(_<w?6:0):P===_?E=(w-h)/A+2:P===w&&(E=(h-_)/A+4),E*=60,[Math.min(Math.max(E,0),360),Math.min(Math.max(100*I,0),100),Math.min(Math.max(100*x,0),100),m]}toArray01(){const{r:t,g:s,b:c,a:m}=this;return m===0?[0,0,0,0]:[t/m,s/m,c/m,m]}toArray01Scaled(t){const{r:s,g:c,b:m,a:h}=this;return h===0?[0,0,0]:[s/h*t,c/h*t,m/h*t]}toArray01PremultipliedAlpha(){const{r:t,g:s,b:c,a:m}=this;return[t,s,c,m]}toArray01Linear(){const{r:t,g:s,b:c,a:m}=this;return m===0?[0,0,0,0]:[Math.pow(t/m,2.2),Math.pow(s/m,2.2),Math.pow(c/m,2.2),m]}}function Bi(l,t,s){return l*(1-s)+t*s}function Pa(l,t,s){return l.map((c,m)=>Bi(c,t[m],s))}zr.black=new zr(0,0,0,1),zr.white=new zr(1,1,1,1),zr.transparent=new zr(0,0,0,0),zr.red=new zr(1,0,0,1),zr.blue=new zr(0,0,1,1);var ch=Object.freeze({__proto__:null,array:Pa,color:function(l,t,s){return new zr(Bi(l.r,t.r,s),Bi(l.g,t.g,s),Bi(l.b,t.b,s),Bi(l.a,t.a,s))},number:Bi});function uh(l,...t){for(const s of t)for(const c in s)l[c]=s[c];return l}class xr extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}class Oc{constructor(t,s=[]){this.parent=t,this.bindings={};for(const[c,m]of s)this.bindings[c]=m}concat(t){return new Oc(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const oc={kind:"null"},mi={kind:"number"},$r={kind:"string"},Dr={kind:"boolean"},Ws={kind:"color"},Ka={kind:"object"},Fr={kind:"value"},mu={kind:"collator"},na={kind:"formatted"},_u={kind:"resolvedImage"};function Es(l,t){return{kind:"array",itemType:l,N:t}}function Ln(l){if(l.kind==="array"){const t=Ln(l.itemType);return typeof l.N=="number"?`array<${t}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${t}>`}return l.kind}const Nd=[oc,mi,$r,Dr,Ws,na,Ka,Es(Fr),_u];function Zs(l,t){if(t.kind==="error")return null;if(l.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Zs(l.itemType,t.itemType))&&(typeof l.N!="number"||l.N===t.N))return null}else{if(l.kind===t.kind)return null;if(l.kind==="value"){for(const s of Nd)if(!Zs(s,t))return null}}return`Expected ${Ln(l)} but found ${Ln(t)} instead.`}function hh(l,t){return t.some(s=>s.kind===l.kind)}function Lc(l,t){return t.some(s=>s==="null"?l===null:s==="array"?Array.isArray(l):s==="object"?l&&!Array.isArray(l)&&typeof l=="object":s===typeof l)}class dh{constructor(t,s,c){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class gu{constructor(t,s,c,m,h){this.text=t.normalize?t.normalize():t,this.image=s,this.scale=c,this.fontStack=m,this.textColor=h}}class Ys{constructor(t){this.sections=t}static fromString(t){return new Ys([new gu(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.namePrimary)}static factory(t){return t instanceof Ys?t:Ys.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const s of this.sections){if(s.image){t.push(["image",s.image.namePrimary]);continue}t.push(s.text);const c={};s.fontStack&&(c["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(c["font-scale"]=s.scale),s.textColor&&(c["text-color"]=["rgba"].concat(s.textColor.toRenderColor(null).toArray())),t.push(c)}return t}}class Ra{constructor(t,s){if(this.id=t,this.options=s||{params:{}},this.options.transform){const{a:c,b:m,c:h,d:_,e:w,f:S}=this.options.transform;this.options.transform=new DOMMatrix([c,m,h,_,w,S])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}static deserializeId(t){return JSON.parse(t).id}static deserializeFromString(t){const s=JSON.parse(t),{a:c,b:m,c:h,d:_,e:w,f:S}=s.options.transform;return new DOMMatrix([c,m,h,_,w,S]),new Ra(s.id,s.options)}scaleSelf(t){return this.options.transform=this.options.transform.scale(t),this}serialize(){const t={id:this.id};this.options&&(t.options=this.options);const{a:s,b:c,c:m,d:h,e:_,f:w}=this.options.transform;return t.options.transform={a:s,b:c,c:m,d:h,e:_,f:w},JSON.stringify(t)}}class Us{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),t.optionsPrimary&&(this.optionsPrimary=t.optionsPrimary),t.optionsSecondary&&(this.optionsSecondary=t.optionsSecondary),this.available=t.available}toString(){return this.namePrimary&&this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}getPrimary(){return new Ra(this.namePrimary,{params:this.optionsPrimary&&this.optionsPrimary.params||{}})}getSerializedPrimary(){return this.getPrimary().serialize()}getSecondary(){return this.nameSecondary?new Ra(this.nameSecondary,{params:this.optionsSecondary&&this.optionsSecondary.params||{}}):null}static from(t){return typeof t=="string"?Us.build(t):t}static build(t,s,c,m){return t?new Us({namePrimary:t,nameSecondary:s,optionsPrimary:c,optionsSecondary:m,available:!1}):null}}function Vd(l,t,s,c){return typeof l=="number"&&l>=0&&l<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof s=="number"&&s>=0&&s<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[l,t,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[l,t,s,c]:[l,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ja(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof zr||l instanceof dh||l instanceof Ys||l instanceof Us)return!0;if(Array.isArray(l)){for(const t of l)if(!Ja(t))return!1;return!0}if(typeof l=="object"){for(const t in l)if(!Ja(l[t]))return!1;return!0}return!1}function kn(l){if(l===null)return oc;if(typeof l=="string")return $r;if(typeof l=="boolean")return Dr;if(typeof l=="number")return mi;if(l instanceof zr)return Ws;if(l instanceof dh)return mu;if(l instanceof Ys)return na;if(l instanceof Us)return _u;if(Array.isArray(l)){const t=l.length;let s;for(const c of l){const m=kn(c);if(s){if(s===m)continue;s=Fr;break}s=m}return Es(s||Fr,t)}return Ka}function No(l){const t=typeof l;return l===null?"":t==="string"||t==="number"||t==="boolean"?String(l):l instanceof zr?l.toStringPremultipliedAlpha():l instanceof Ys||l instanceof Us?l.toString():JSON.stringify(l)}class Ds{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(t.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ja(t[1]))return s.error("invalid value");const c=t[1];let m=kn(c);const h=s.expectedType;return m.kind!=="array"||m.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(m=h),new Ds(m,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof zr?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Ys?this.value.serialize():this.value}}class qn{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const yu={string:$r,number:mi,boolean:Dr,object:Ka};class sa{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let c,m=1;const h=t[0];if(h==="array"){let w,S;if(t.length>2){const P=t[1];if(typeof P!="string"||!(P in yu)||P==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);w=yu[P],m++}else w=Fr;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);S=t[2],m++}c=Es(w,S)}else c=yu[h];const _=[];for(;m<t.length;m++){const w=s.parse(t[m],m,Fr);if(!w)return null;_.push(w)}return new sa(c,_)}evaluate(t){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(t);if(!Zs(this.type,kn(c)))return c;if(s===this.args.length-1)throw new qn(`The expression ${JSON.stringify(this.args[s].serialize())} evaluated to ${Ln(kn(c))} but was expected to be of type ${Ln(this.type)}.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,s=[t.kind];if(t.kind==="array"){const c=t.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){s.push(c.kind);const m=t.N;(typeof m=="number"||this.args.length>1)&&s.push(m)}}return s.concat(this.args.map(c=>c.serialize()))}}class ac{constructor(t){this.type=na,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const c=t[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");const m=[];let h=!1;for(let _=1;_<=t.length-1;++_){const w=t[_];if(h&&typeof w=="object"&&!Array.isArray(w)){h=!1;let S=null;if(w["font-scale"]&&(S=s.parseObjectValue(w["font-scale"],_,"font-scale",mi),!S))return null;let P=null;if(w["text-font"]&&(P=s.parseObjectValue(w["text-font"],_,"text-font",Es($r)),!P))return null;let x=null;if(w["text-color"]&&(x=s.parseObjectValue(w["text-color"],_,"text-color",Ws),!x))return null;const A=m[m.length-1];A.scale=S,A.font=P,A.textColor=x}else{const S=s.parse(t[_],_,Fr);if(!S)return null;const P=S.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,m.push({content:S,scale:null,font:null,textColor:null})}}return new ac(m)}evaluate(t){return new Ys(this.sections.map(s=>{const c=s.content.evaluate(t);return kn(c)===_u?new gu("",c,null,null,null):new gu(No(c),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null)}))}eachChild(t){for(const s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const s of this.sections){t.push(s.content.serialize());const c={};s.scale&&(c["font-scale"]=s.scale.serialize()),s.font&&(c["text-font"]=s.font.serialize()),s.textColor&&(c["text-color"]=s.textColor.serialize()),t.push(c)}return t}}class kc{constructor(t,s,c,m){this._imageWarnHistory={},this.type=_u,this.inputPrimary=t,this.inputSecondary=s,this.inputPrimaryParams=c,this.inputSecondaryParams=m}static parse(t,s){if(t.length<2)return s.error("Expected two or more arguments.");let c=1;const m=[];function h(){if(c<t.length){const w=s.parse(t[c],c++,$r);return w?(m.push({image:w,options:void 0}),!0):(s.error(m.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function _(){if(c<t.length){if((w=t[c])===null||typeof w!="object"||Array.isArray(w))return!0;const S=t[c].params,P=s.concat(c);if(!S)return c++,!0;if(typeof S!="object"||S.constructor!==Object)return P.error('Image options "params" should be an object'),!1;const x={},A=P.concat(void 0,"params");for(const I in S){if(!I)return A.error("Image parameter name should be non-empty"),!1;const E=A.concat(void 0,I).parse(S[I],void 0,Ws,void 0,{typeAnnotation:"coerce"});if(!E)return!1;x[I]=E}return m[m.length-1].options=x,c++,!0}var w;return!0}for(let w=0;w<2;w++)if(!h()||!_())return;return new kc(m[0].image,m[1]?m[1].image:void 0,m[0].options,m[1]?m[1].options:void 0)}evaluateParams(t,s){const c={};if(s){for(const m in s)if(s[m])try{const h=s[m].evaluate(t),_=`Ignoring image parameter "${m}" with semi-transparent color ${h.toString()}`;if(h.a!==1){this._imageWarnHistory[_]||(console.warn(_),this._imageWarnHistory[_]=!0);continue}c[m]=h}catch{continue}if(Object.keys(c).length!==0)return{params:c}}}evaluate(t){const s=Us.build(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0,this.inputPrimaryParams?this.evaluateParams(t,this.inputPrimaryParams):void 0,this.inputSecondaryParams?this.evaluateParams(t,this.inputSecondaryParams):void 0);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(s.namePrimary)>-1,s.nameSecondary&&s.available&&t.availableImages&&(s.available=t.availableImages.indexOf(s.nameSecondary)>-1)),s}eachChild(t){if(t(this.inputPrimary),this.inputPrimaryParams)for(const s in this.inputPrimaryParams)this.inputPrimaryParams[s]&&t(this.inputPrimaryParams[s]);if(this.inputSecondary&&(t(this.inputSecondary),this.inputSecondaryParams))for(const s in this.inputSecondaryParams)this.inputSecondaryParams[s]&&t(this.inputSecondaryParams[s])}outputDefined(){return!1}serializeParams(t){const s={};if(t){for(const c in t)t[c]&&(s[c]=t[c].serialize());return{params:s}}}serialize(){const t=["image",this.inputPrimary.serialize()];return this.inputPrimaryParams&&t.push(this.serializeParams(this.inputPrimaryParams)),this.inputSecondary&&(t.push(this.inputSecondary.serialize()),this.inputSecondaryParams&&t.push(this.serializeParams(this.inputSecondaryParams))),t}}function oa(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}const Ud={"to-boolean":Dr,"to-color":Ws,"to-number":mi,"to-string":$r};class Qa{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const c=t[0],m=[];let h=oc;if(c==="to-array"){if(!Array.isArray(t[1]))return null;const _=t[1].length;if(s.expectedType){if(s.expectedType.kind!=="array")return s.error(`Expected ${s.expectedType.kind} but found array.`);h=Es(s.expectedType.itemType,_)}else{if(!(_>0&&Ja(t[1][0])))return null;h=Es(kn(t[1][0]),_)}for(let w=0;w<_;w++){const S=t[1][w];let P;if(oa(S)==="array")P=s.parse(S,void 0,h.itemType);else{const x=oa(S);if(x!==h.itemType.kind)return s.error(`Expected ${h.itemType.kind} but found ${x}.`);P=s.registry.literal.parse(["literal",S===void 0?null:S],s)}if(!P)return null;m.push(P)}}else{if((c==="to-boolean"||c==="to-string")&&t.length!==2)return s.error("Expected one argument.");h=Ud[c];for(let _=1;_<t.length;_++){const w=s.parse(t[_],_,Fr);if(!w)return null;m.push(w)}}return new Qa(h,m)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let s,c;for(const m of this.args){if(s=m.evaluate(t),c=null,s instanceof zr)return s;if(typeof s=="string"){const h=t.parseColor(s);if(h)return h}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Vd(s[0],s[1],s[2],s[3]),!c))return new zr(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new qn(c||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(const c of this.args){if(s=c.evaluate(t),s===null)return 0;const m=Number(s);if(!isNaN(m))return m}throw new qn(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?Ys.fromString(No(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Us.build(No(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map(s=>s.evaluate(t)):No(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new ac([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new kc(this.args[0]).serialize();const t=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(s=>{t.push(s.serialize())}),t}}const B_=["Unknown","Point","LineString","Polygon"];class jd{constructor(t,s){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=s}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?B_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:c,y:m}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*s-t[0])+this.featureDistanceData.bearing[1]*(m*s-t[1])}return 0}parseColor(t){let s=this._parseColorCache[t];return s||(s=this._parseColorCache[t]=zr.parse(t)),s}getConfig(t){return this.options?this.options.get(t):null}}class co{constructor(t,s,c,m,h){this.name=t,this.type=s,this._evaluate=c,this.args=m,this._overloadIndex=h}evaluate(t){if(!this._evaluate){const s=co.definitions[this.name];this._evaluate=Array.isArray(s)?s[2]:s.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,s){const c=t[0],m=co.definitions[c];if(!m)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(m)?m[0]:m.type,_=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,w=[];let S=null,P=-1;for(const[x,A]of _){if(Array.isArray(x)&&x.length!==t.length-1)continue;w.push(x),P++,S=new Cr(s.registry,s.path,null,s.scope,void 0,s._scope,s.options);const I=[];let E=!1;for(let C=1;C<t.length;C++){const R=t[C],z=Array.isArray(x)?x[C-1]:x.type,V=S.parse(R,1+I.length,z);if(!V){E=!0;break}I.push(V)}if(!E)if(Array.isArray(x)&&x.length!==I.length)S.error(`Expected ${x.length} arguments, but found ${I.length} instead.`);else{for(let C=0;C<I.length;C++){const R=Array.isArray(x)?x[C]:x.type,z=I[C];S.concat(C+1).checkSubtype(R,z.type)}if(S.errors.length===0)return new co(c,h,A,I,P)}}if(w.length===1)s.errors.push(...S.errors);else{const x=(w.length?w:_.map(([I])=>I)).map($d).join(" | "),A=[];for(let I=1;I<t.length;I++){const E=s.parse(t[I],1+A.length);if(!E)return null;A.push(Ln(E.type))}s.error(`Expected arguments of type ${x}, but found (${A.join(", ")}) instead.`)}return null}static register(t,s){co.definitions=s;for(const c in s)t[c]=co}}function $d(l){return Array.isArray(l)?`(${l.map(Ln).join(", ")})`:`(${Ln(l.type)}...)`}class fh{constructor(t,s,c){this.type=mu,this.locale=c,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(t.length!==2)return s.error("Expected one argument.");const c=t[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");const m=c["case-sensitive"]===void 0?s.parse(!1,1,Dr):s.parseObjectValue(c["case-sensitive"],1,"case-sensitive",Dr);if(!m)return null;const h=c["diacritic-sensitive"]===void 0?s.parse(!1,1,Dr):s.parseObjectValue(c["diacritic-sensitive"],1,"diacritic-sensitive",Dr);if(!h)return null;let _=null;return c.locale&&(_=s.parseObjectValue(c.locale,1,"locale",$r),!_)?null:new fh(m,h,_)}evaluate(t){return new dh(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function vu(l,t,s=0,c=l.length-1,m=N_){for(;c>s;){if(c-s>600){const S=c-s+1,P=t-s+1,x=Math.log(S),A=.5*Math.exp(2*x/3),I=.5*Math.sqrt(x*A*(S-A)/S)*(P-S/2<0?-1:1);vu(l,t,Math.max(s,Math.floor(t-P*A/S+I)),Math.min(c,Math.floor(t+(S-P)*A/S+I)),m)}const h=l[t];let _=s,w=c;for(xu(l,s,t),m(l[c],h)>0&&xu(l,s,c);_<w;){for(xu(l,_,w),_++,w--;m(l[_],h)<0;)_++;for(;m(l[w],h)>0;)w--}m(l[s],h)===0?xu(l,s,w):(w++,xu(l,w,c)),w<=t&&(s=w+1),t<=w&&(c=w-1)}}function xu(l,t,s){const c=l[t];l[t]=l[s],l[s]=c}function N_(l,t){return l<t?-1:l>t?1:0}function V_(l){let t=0;for(let s,c,m=0,h=l.length,_=h-1;m<h;_=m++)s=l[m],c=l[_],t+=(c.x-s.x)*(s.y+c.y);return t}function bu(l,t){l[0]=Math.min(l[0],t[0]),l[1]=Math.min(l[1],t[1]),l[2]=Math.max(l[2],t[0]),l[3]=Math.max(l[3],t[1])}function wu(l,t){return!(l[0]<=t[0]||l[2]>=t[2]||l[1]<=t[1]||l[3]>=t[3])}function qd(l,t,s){const c=l[0]-t[0],m=l[1]-t[1],h=l[0]-s[0],_=l[1]-s[1];return c*_-h*m==0&&c*h<=0&&m*_<=0}function zc(l,t,s=!1){let c=!1;for(let w=0,S=t.length;w<S;w++){const P=t[w];for(let x=0,A=P.length,I=A-1;x<A;I=x++){const E=P[I],C=P[x];if(qd(l,E,C))return s;(h=E)[1]>(m=l)[1]!=(_=C)[1]>m[1]&&m[0]<(_[0]-h[0])*(m[1]-h[1])/(_[1]-h[1])+h[0]&&(c=!c)}}var m,h,_;return c}function lc(l,t,s,c){const m=c[0]-s[0],h=c[1]-s[1],_=(l[0]-s[0])*h-m*(l[1]-s[1]),w=(t[0]-s[0])*h-m*(t[1]-s[1]);return _>0&&w<0||_<0&&w>0}function el(l,t,s,c){return(m=[c[0]-s[0],c[1]-s[1]])[0]*(h=[t[0]-l[0],t[1]-l[1]])[1]-m[1]*h[0]!=0&&!(!lc(l,t,s,c)||!lc(s,c,l,t));var m,h}const Il=8192;function U_(l,t){const s=(180+l[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,m=Math.pow(2,t.z);return[Math.round(s*m*Il),Math.round(c*m*Il)]}function Hd(l,t){for(let s=0;s<t.length;s++)if(zc(l,t[s]))return!0;return!1}function ph(l,t,s){for(const c of s)for(let m=0,h=c.length,_=h-1;m<h;_=m++)if(el(l,t,c[_],c[m]))return!0;return!1}function Ip(l,t){for(let s=0;s<l.length;++s)if(!zc(l[s],t))return!1;for(let s=0;s<l.length-1;++s)if(ph(l[s],l[s+1],t))return!1;return!0}function Pp(l,t){for(let s=0;s<t.length;s++)if(Ip(l,t[s]))return!0;return!1}function mh(l,t,s){const c=[];for(let m=0;m<l.length;m++){const h=[];for(let _=0;_<l[m].length;_++){const w=U_(l[m][_],s);bu(t,w),h.push(w)}c.push(h)}return c}function cc(l,t,s){const c=[];for(let m=0;m<l.length;m++){const h=mh(l[m],t,s);c.push(h)}return c}function gr(l,t,s,c){if(l[0]<s[0]||l[0]>s[2]){const m=.5*c;let h=l[0]-s[0]>m?-c:s[0]-l[0]>m?c:0;h===0&&(h=l[0]-s[2]>m?-c:s[2]-l[0]>m?c:0),l[0]+=h}bu(t,l)}function Ri(l,t,s,c){const m=Math.pow(2,c.z)*Il,h=[c.x*Il,c.y*Il],_=[];if(!l)return _;for(const w of l)for(const S of w){const P=[S.x+h[0],S.y+h[1]];gr(P,t,s,m),_.push(P)}return _}function _h(l,t,s,c){const m=Math.pow(2,c.z)*Il,h=[c.x*Il,c.y*Il],_=[];if(!l)return _;for(const S of l){const P=[];for(const x of S){const A=[x.x+h[0],x.y+h[1]];bu(t,A),P.push(A)}_.push(P)}if(t[2]-t[0]<=m/2){(w=t)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const S of _)for(const P of S)gr(P,t,s,m)}var w;return _}class $i{constructor(t,s){this.type=Dr,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ja(t[1])){const c=t[1];if(c.type==="FeatureCollection")for(let m=0;m<c.features.length;++m){const h=c.features[m].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new $i(c,c.features[m].geometry)}else if(c.type==="Feature"){const m=c.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new $i(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new $i(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,c){const m=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if(!_)return!1;if(c.type==="Polygon"){const w=mh(c.coordinates,h,_),S=Ri(s.geometry(),m,h,_);if(!wu(m,h))return!1;for(const P of S)if(!zc(P,w))return!1}if(c.type==="MultiPolygon"){const w=cc(c.coordinates,h,_),S=Ri(s.geometry(),m,h,_);if(!wu(m,h))return!1;for(const P of S)if(!Hd(P,w))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,c){const m=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if(!_)return!1;if(c.type==="Polygon"){const w=mh(c.coordinates,h,_),S=_h(s.geometry(),m,h,_);if(!wu(m,h))return!1;for(const P of S)if(!Ip(P,w))return!1}if(c.type==="MultiPolygon"){const w=cc(c.coordinates,h,_),S=_h(s.geometry(),m,h,_);if(!wu(m,h))return!1;for(const P of S)if(!Pp(P,w))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Fc={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},es=1/298.257223563,Fi=es*(2-es),Pl=Math.PI/180;class Rl{static fromTile(t,s,c){const m=Math.PI*(1-2*(t+.5)/Math.pow(2,s)),h=Math.atan(.5*(Math.exp(m)-Math.exp(-m)))/Pl;return new Rl(h,c)}static get units(){return Fc}constructor(t,s){if(t===void 0)throw new Error("No latitude given.");if(s&&!Fc[s])throw new Error(`Unknown unit ${s}. Use one of: ${Object.keys(Fc).join(", ")}`);const c=6378.137*Pl*(s?Fc[s]:1),m=Math.cos(t*Pl),h=1/(1-Fi*(1-m*m)),_=Math.sqrt(h);this.kx=c*_*m,this.ky=c*_*h*(1-Fi)}distance(t,s){const c=rn(t[0]-s[0])*this.kx,m=(t[1]-s[1])*this.ky;return Math.sqrt(c*c+m*m)}bearing(t,s){const c=rn(s[0]-t[0])*this.kx;return Math.atan2(c,(s[1]-t[1])*this.ky)/Pl}destination(t,s,c){const m=c*Pl;return this.offset(t,Math.sin(m)*s,Math.cos(m)*s)}offset(t,s,c){return[t[0]+s/this.kx,t[1]+c/this.ky]}lineDistance(t){let s=0;for(let c=0;c<t.length-1;c++)s+=this.distance(t[c],t[c+1]);return s}area(t){let s=0;for(let c=0;c<t.length;c++){const m=t[c];for(let h=0,_=m.length,w=_-1;h<_;w=h++)s+=rn(m[h][0]-m[w][0])*(m[h][1]+m[w][1])*(c?-1:1)}return Math.abs(s)/2*this.kx*this.ky}along(t,s){let c=0;if(s<=0)return t[0];for(let m=0;m<t.length-1;m++){const h=t[m],_=t[m+1],w=this.distance(h,_);if(c+=w,c>s)return Dl(h,_,(s-(c-w))/w)}return t[t.length-1]}pointToSegmentDistance(t,s,c){let[m,h]=s,_=rn(c[0]-m)*this.kx,w=(c[1]-h)*this.ky;if(_!==0||w!==0){const S=(rn(t[0]-m)*this.kx*_+(t[1]-h)*this.ky*w)/(_*_+w*w);S>1?(m=c[0],h=c[1]):S>0&&(m+=_/this.kx*S,h+=w/this.ky*S)}return _=rn(t[0]-m)*this.kx,w=(t[1]-h)*this.ky,Math.sqrt(_*_+w*w)}pointOnLine(t,s){let c=1/0,m=t[0][0],h=t[0][1],_=0,w=0;for(let S=0;S<t.length-1;S++){let P=t[S][0],x=t[S][1],A=rn(t[S+1][0]-P)*this.kx,I=(t[S+1][1]-x)*this.ky,E=0;A===0&&I===0||(E=(rn(s[0]-P)*this.kx*A+(s[1]-x)*this.ky*I)/(A*A+I*I),E>1?(P=t[S+1][0],x=t[S+1][1]):E>0&&(P+=A/this.kx*E,x+=I/this.ky*E)),A=rn(s[0]-P)*this.kx,I=(s[1]-x)*this.ky;const C=A*A+I*I;C<c&&(c=C,m=P,h=x,_=S,w=E)}return{point:[m,h],index:_,t:Math.max(0,Math.min(1,w))}}lineSlice(t,s,c){let m=this.pointOnLine(c,t),h=this.pointOnLine(c,s);if(m.index>h.index||m.index===h.index&&m.t>h.t){const P=m;m=h,h=P}const _=[m.point],w=m.index+1,S=h.index;!Xn(c[w],_[0])&&w<=S&&_.push(c[w]);for(let P=w+1;P<=S;P++)_.push(c[P]);return Xn(c[S],h.point)||_.push(h.point),_}lineSliceAlong(t,s,c){let m=0;const h=[];for(let _=0;_<c.length-1;_++){const w=c[_],S=c[_+1],P=this.distance(w,S);if(m+=P,m>t&&h.length===0&&h.push(Dl(w,S,(t-(m-P))/P)),m>=s)return h.push(Dl(w,S,(s-(m-P))/P)),h;m>t&&h.push(S)}return h}bufferPoint(t,s){const c=s/this.ky,m=s/this.kx;return[t[0]-m,t[1]-c,t[0]+m,t[1]+c]}bufferBBox(t,s){const c=s/this.ky,m=s/this.kx;return[t[0]-m,t[1]-c,t[2]+m,t[3]+c]}insideBBox(t,s){return rn(t[0]-s[0])>=0&&rn(t[0]-s[2])<=0&&t[1]>=s[1]&&t[1]<=s[3]}}function Xn(l,t){return l[0]===t[0]&&l[1]===t[1]}function Dl(l,t,s){const c=rn(t[0]-l[0]);return[l[0]+c*s,l[1]+(t[1]-l[1])*s]}function rn(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}class Wr{constructor(t=[],s=(c,m)=>c<m?-1:c>m?1:0){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:c}=this,m=s[t];for(;t>0;){const h=t-1>>1,_=s[h];if(c(m,_)>=0)break;s[t]=_,t=h}s[t]=m}_down(t){const{data:s,compare:c}=this,m=this.length>>1,h=s[t];for(;t<m;){let _=1+(t<<1);const w=_+1;if(w<this.length&&c(s[w],s[_])<0&&(_=w),c(s[_],h)>=0)break;s[t]=s[_],t=_}s[t]=h}}var ii=8192;function gh(l,t){return t.dist-l.dist}const Tu=100,Bc=50;function tl(l){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==l.length)return!1;for(let s=0;s<t.length;s++)if(t[s]!==l[s])return!1;return!0}function Os(l){return l[1]-l[0]+1}function il(l,t){const s=l[1]>=l[0]&&l[1]<t;return s||console.warn("Distance Expression: Index is out of range"),s}function Gd(l,t){if(l[0]>l[1])return[null,null];const s=Os(l);if(t){if(s===2)return[l,null];const c=Math.floor(s/2);return[[l[0],l[0]+c],[l[0]+c,l[1]]]}{if(s===1)return[l,null];const c=Math.floor(s/2)-1;return[[l[0],l[0]+c],[l[0]+c+1,l[1]]]}}function uc(l,t){const s=[1/0,1/0,-1/0,-1/0];if(!il(t,l.length))return s;for(let c=t[0];c<=t[1];++c)bu(s,l[c]);return s}function hc(l){const t=[1/0,1/0,-1/0,-1/0];for(let s=0;s<l.length;++s)for(let c=0;c<l[s].length;++c)bu(t,l[s][c]);return t}function dc(l,t,s){if(tl(l)||tl(t))return NaN;let c=0,m=0;return l[2]<t[0]&&(c=t[0]-l[2]),l[0]>t[2]&&(c=l[0]-t[2]),l[1]>t[3]&&(m=l[1]-t[3]),l[3]<t[1]&&(m=t[1]-l[3]),s.distance([0,0],[c,m])}function Wd(l){return 360*l-180}function j_(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Zd(l,t){const s=Math.pow(2,t.z),c=(l.y/ii+t.y)/s;return[Wd((l.x/ii+t.x)/s),j_(c)]}function $_(l,t){const s=[];for(let c=0;c<l.length;++c)s.push(Zd(l[c],t));return s}function Rp(l,t,s){const c=s.pointOnLine(t,l).point;return s.distance(l,c)}function Yd(l,t,s,c,m){const h=s.slice(c[0],c[1]+1);let _=1/0;for(let w=t[0];w<=t[1];++w)if((_=Math.min(_,Rp(l[w],h,m)))===0)return 0;return _}function Xd(l,t,s,c,m){const h=Math.min(m.pointToSegmentDistance(l,s,c),m.pointToSegmentDistance(t,s,c)),_=Math.min(m.pointToSegmentDistance(s,l,t),m.pointToSegmentDistance(c,l,t));return Math.min(h,_)}function q_(l,t,s,c,m){if(!il(t,l.length)||!il(c,s.length))return NaN;let h=1/0;for(let _=t[0];_<t[1];++_)for(let w=c[0];w<c[1];++w){if(el(l[_],l[_+1],s[w],s[w+1]))return 0;h=Math.min(h,Xd(l[_],l[_+1],s[w],s[w+1],m))}return h}function Dp(l,t,s,c,m){if(!il(t,l.length)||!il(c,s.length))return NaN;let h=1/0;for(let _=t[0];_<=t[1];++_)for(let w=c[0];w<=c[1];++w)if((h=Math.min(h,m.distance(l[_],s[w])))===0)return h;return h}function fc(l,t,s){if(zc(l,t,!0))return 0;let c=1/0;for(const m of t){const h=m.length;if(h<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(m[0]!==m[h-1]&&(c=Math.min(c,s.pointToSegmentDistance(l,m[h-1],m[0])))===0||(c=Math.min(c,Rp(l,m,s)))===0)return c}return c}function H_(l,t,s,c){if(!il(t,l.length))return NaN;for(let h=t[0];h<=t[1];++h)if(zc(l[h],s,!0))return 0;let m=1/0;for(let h=t[0];h<t[1];++h)for(const _ of s)for(let w=0,S=_.length,P=S-1;w<S;P=w++){if(el(l[h],l[h+1],_[P],_[w]))return 0;m=Math.min(m,Xd(l[h],l[h+1],_[P],_[w],c))}return m}function Op(l,t){for(const s of l)for(let c=0;c<=s.length-1;++c)if(zc(s[c],t,!0))return!0;return!1}function Kd(l,t,s,c=1/0){const m=hc(l),h=hc(t);if(c!==1/0&&dc(m,h,s)>=c)return c;if(wu(m,h)){if(Op(l,t))return 0}else if(Op(t,l))return 0;let _=c;for(const w of l)for(let S=0,P=w.length,x=P-1;S<P;x=S++)for(const A of t)for(let I=0,E=A.length,C=E-1;I<E;C=I++){if(el(w[x],w[S],A[C],A[I]))return 0;_=Math.min(_,Xd(w[x],w[S],A[C],A[I],s))}return _}function Eu(l,t,s,c,m,h,_){if(h===null||_===null)return;const w=dc(uc(c,h),uc(m,_),s);w<t&&l.push({dist:w,range1:h,range2:_})}function Lp(l,t,s,c,m=1/0){let h=Math.min(c.distance(l[0],s[0][0]),m);if(h===0)return h;const _=new Wr([{dist:0,range1:[0,l.length-1],range2:[0,0]}],gh),w=t?Bc:Tu,S=hc(s);for(;_.length;){const P=_.pop();if(P.dist>=h)continue;const x=P.range1;if(Os(x)<=w){if(!il(x,l.length))return NaN;if(t){const A=H_(l,x,s,c);if((h=Math.min(h,A))===0)return h}else for(let A=x[0];A<=x[1];++A){const I=fc(l[A],s,c);if((h=Math.min(h,I))===0)return h}}else{const A=Gd(x,t);if(A[0]!==null){const I=dc(uc(l,A[0]),S,c);I<h&&_.push({dist:I,range1:A[0],range2:[0,0]})}if(A[1]!==null){const I=dc(uc(l,A[1]),S,c);I<h&&_.push({dist:I,range1:A[1],range2:[0,0]})}}}return h}function uo(l,t,s,c,m,h=1/0){let _=Math.min(h,m.distance(l[0],s[0]));if(_===0)return _;const w=new Wr([{dist:0,range1:[0,l.length-1],range2:[0,s.length-1]}],gh),S=t?Bc:Tu,P=c?Bc:Tu;for(;w.length;){const x=w.pop();if(x.dist>=_)continue;const A=x.range1,I=x.range2;if(Os(A)<=S&&Os(I)<=P){if(!il(A,l.length)||!il(I,s.length))return NaN;if(t&&c?_=Math.min(_,q_(l,A,s,I,m)):t||c?t&&!c?_=Math.min(_,Yd(s,I,l,A,m)):!t&&c&&(_=Math.min(_,Yd(l,A,s,I,m))):_=Math.min(_,Dp(l,A,s,I,m)),_===0)return _}else{const E=Gd(A,t),C=Gd(I,c);Eu(w,_,m,l,s,E[0],C[0]),Eu(w,_,m,l,s,E[0],C[1]),Eu(w,_,m,l,s,E[1],C[0]),Eu(w,_,m,l,s,E[1],C[1])}}return _}function Su(l,t,s,c,m=1/0){let h=m;const _=uc(l,[0,l.length-1]);for(const w of s)if(!(h!==1/0&&dc(_,uc(w,[0,w.length-1]),c)>=h)&&(h=Math.min(h,uo(l,t,w,!0,c,h)),h===0))return h;return h}function he(l,t,s,c,m=1/0){let h=m;const _=uc(l,[0,l.length-1]);for(const w of s){if(h!==1/0&&dc(_,hc(w),c)>=h)continue;const S=Lp(l,t,w,c,h);if(isNaN(S))return S;if((h=Math.min(h,S))===0)return h}return h}function pe(l){return l==="Point"||l==="MultiPoint"||l==="LineString"||l==="MultiLineString"||l==="Polygon"||l==="MultiPolygon"}class Fe{constructor(t,s){this.type=mi,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(Ja(t[1])){const c=t[1];if(c.type==="FeatureCollection"){for(let m=0;m<c.features.length;++m)if(pe(c.features[m].geometry.type))return new Fe(c,c.features[m].geometry)}else if(c.type==="Feature"){if(pe(c.geometry.type))return new Fe(c,c.geometry)}else if(pe(c.type))return new Fe(c,c)}return s.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const s=t.geometry(),c=t.canonicalID();if(s!=null&&c!=null){if(t.geometryType()==="Point")return function(m,h,_){const w=[];for(const P of m)for(const x of P)w.push(Zd(x,h));const S=new Rl(w[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?uo(w,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",S):_.type==="MultiLineString"?Su(w,!1,_.coordinates,S):_.type==="Polygon"||_.type==="MultiPolygon"?he(w,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,S):null}(s,c,this.geometries);if(t.geometryType()==="LineString")return function(m,h,_){const w=[];for(const P of m){const x=[];for(const A of P)x.push(Zd(A,h));w.push(x)}const S=new Rl(w[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return Su(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",w,S);if(_.type==="MultiLineString"){let P=1/0;for(let x=0;x<_.coordinates.length;x++){const A=Su(_.coordinates[x],!0,w,S,P);if(isNaN(A))return A;if((P=Math.min(P,A))===0)return P}return P}if(_.type==="Polygon"||_.type==="MultiPolygon"){let P=1/0;for(let x=0;x<w.length;x++){const A=he(w[x],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,S,P);if(isNaN(A))return A;if((P=Math.min(P,A))===0)return P}return P}return null}(s,c,this.geometries);if(t.geometryType()==="Polygon")return function(m,h,_){const w=[];for(const P of function(x,A){const I=x.length;if(I<=1)return[x];const E=[];let C,R;for(let z=0;z<I;z++){const V=V_(x[z]);V!==0&&(x[z].area=Math.abs(V),R===void 0&&(R=V<0),R===V<0?(C&&E.push(C),C=[x[z]]):C.push(x[z]))}return C&&E.push(C),E}(m)){const x=[];for(let A=0;A<P.length;++A)x.push($_(P[A],h));w.push(x)}const S=new Rl(w[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return he(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",w,S);if(_.type==="MultiLineString"){let P=1/0;for(let x=0;x<_.coordinates.length;x++){const A=he(_.coordinates[x],!0,w,S,P);if(isNaN(A))return A;if((P=Math.min(P,A))===0)return P}return P}return _.type==="Polygon"||_.type==="MultiPolygon"?function(P,x,A){let I=1/0;for(const E of P)for(const C of x){const R=Kd(E,C,A,I);if(isNaN(R))return R;if((I=Math.min(I,R))===0)return I}return I}(_.type==="Polygon"?[_.coordinates]:_.coordinates,w,S):null}(s,c,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ke(l,t){switch(l){case"string":return No(t);case"number":return+t;case"boolean":return!!t;case"color":return zr.parse(t);case"formatted":return Ys.fromString(No(t));case"resolvedImage":return Us.build(No(t))}return t}function At(l,t,s,c){return c!==void 0&&(l=c*Math.round(l/c)),t!==void 0&&l<t&&(l=t),s!==void 0&&l>s&&(l=s),l}class Lt{constructor(t,s,c){this.type=t,this.key=s,this.scope=c}static parse(t,s){let c=s.expectedType;if(c==null&&(c=Fr),t.length<2||t.length>3)return s.error("Invalid number of arguments for 'config' expression.");const m=s.parse(t[1],1);if(!(m instanceof Ds))return s.error("Key name of 'config' expression must be a string literal.");if(t.length>=3){const h=s.parse(t[2],2);return h instanceof Ds?new Lt(c,No(m.value),No(h.value)):s.error("Scope of 'config' expression must be a string literal.")}return new Lt(c,No(m.value))}evaluate(t){const s=[this.key,this.scope,t.scope].filter(Boolean).join(""),c=t.getConfig(s);if(!c)return null;const{type:m,value:h,values:_,minValue:w,maxValue:S,stepValue:P}=c,x=c.default.evaluate(t);let A=x;if(h){const I=t.scope;t.scope=(I||"").split("").slice(1).join(""),A=h.evaluate(t),t.scope=I}return m&&(A=Ke(m,A)),A===void 0||w===void 0&&S===void 0&&P===void 0||(typeof A=="number"?A=At(A,w,S,P):Array.isArray(A)&&(A=A.map(I=>typeof I=="number"?At(I,w,S,P):I))),h!==void 0&&A!==void 0&&_&&!_.includes(A)&&(A=x,m&&(A=Ke(m,A))),(m&&m!==this.type||A!==void 0&&kn(A)!==this.type)&&(A=Ke(this.type.kind,A)),A}eachChild(){}outputDefined(){return!1}serialize(){const t=["config",this.key];return this.scope&&t.concat(this.key),t}}function jt(l){if(l instanceof co&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof $i||l instanceof Fe)return!1;let t=!0;return l.eachChild(s=>{t&&!jt(s)&&(t=!1)}),t}function Yt(l){if(l instanceof co&&l.name==="feature-state")return!1;let t=!0;return l.eachChild(s=>{t&&!Yt(s)&&(t=!1)}),t}function di(l){if(l instanceof Lt)return new Set([l.key]);let t=new Set;return l.eachChild(s=>{t=new Set([...t,...di(s)])}),t}function Ei(l,t){if(l instanceof co&&t.indexOf(l.name)>=0)return!1;let s=!0;return l.eachChild(c=>{s&&!Ei(c,t)&&(s=!1)}),s}class ji{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(t.length!==2||typeof t[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const c=t[1];return s.scope.has(c)?new ji(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Tr{constructor(t,s=[],c,m=new Oc,h=[],_,w){this.registry=t,this.path=s,this.key=s.map(S=>typeof S=="string"?`['${S}']`:`[${S}]`).join(""),this.scope=m,this.errors=h,this.expectedType=c,this._scope=_,this.options=w}parse(t,s,c,m,h={}){return s||c?this.concat(s,null,c,m)._parse(t,h):this._parse(t,h)}parseObjectValue(t,s,c,m,h,_={}){return this.concat(s,c,m,h)._parse(t,_)}_parse(t,s){function c(m,h,_){return _==="assert"?new sa(h,[m]):_==="coerce"?new Qa(h,[m]):m}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(m){let h=m.parse(t,this);if(!h)return null;if(this.expectedType){const _=this.expectedType,w=h.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||w.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(_,w))return null}else h=c(h,_,s.typeAnnotation||"coerce");else h=c(h,_,s.typeAnnotation||"assert")}if(!(h instanceof Ds)&&h.type.kind!=="resolvedImage"&&Br(h)){const _=new jd(this._scope,this.options);try{h=new Ds(h.type,h.evaluate(_))}catch(w){return this.error(w.message),null}}return h}return Qa.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,c,m){let h=typeof t=="number"?this.path.concat(t):this.path;h=typeof s=="string"?h.concat(s):h;const _=m?this.scope.concat(m):this.scope;return new Tr(this.registry,h,c||null,_,this.errors,this._scope,this.options)}error(t,...s){const c=`${this.key}${s.map(m=>`[${m}]`).join("")}`;this.errors.push(new xr(c,t))}checkSubtype(t,s){const c=Zs(t,s);return c&&this.error(c),c}}var Cr=Tr;function Br(l){if(l instanceof ji)return Br(l.boundExpression);if(l instanceof co&&l.name==="error"||l instanceof fh||l instanceof $i||l instanceof Fe||l instanceof Lt)return!1;const t=l instanceof Qa||l instanceof sa;let s=!0;return l.eachChild(c=>{s=t?s&&Br(c):s&&c instanceof Ds}),!!s&&jt(l)&&Ei(l,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function zn(l,t){const s=l.length-1;let c,m,h=0,_=s,w=0;for(;h<=_;)if(w=Math.floor((h+_)/2),c=l[w],m=l[w+1],c<=t){if(w===s||t<m)return w;h=w+1}else{if(!(c>t))throw new qn("Input is not a number.");_=w-1}return 0}class Fn{constructor(t,s,c){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(const[m,h]of c)this.labels.push(m),this.outputs.push(h)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");const c=s.parse(t[1],1,mi);if(!c)return null;const m=[];let h=null;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);for(let _=1;_<t.length;_+=2){const w=_===1?-1/0:t[_],S=t[_+1],P=_,x=_+1;if(typeof w!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(m.length&&m[m.length-1][0]>=w)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const A=s.parse(S,x,h);if(!A)return null;h=h||A.type,m.push([w,A])}return new Fn(h,c,m)}evaluate(t){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(t);const m=this.input.evaluate(t);if(m<=s[0])return c[0].evaluate(t);const h=s.length;return m>=s[h-1]?c[h-1].evaluate(t):c[zn(s,m)].evaluate(t)}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&t.push(this.labels[s]),t.push(this.outputs[s].serialize());return t}}const fn=.95047,Qi=1.08883,Ti=4/29,rr=6/29,ns=3*rr*rr,Ss=rr*rr*rr,Nc=Math.PI/180,sn=180/Math.PI;function yh(l){return l>Ss?Math.pow(l,1/3):l/ns+Ti}function vh(l){return l>rr?l*l*l:ns*(l-Ti)}function G_(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function W_(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function K0(l){const t=W_(l.r),s=W_(l.g),c=W_(l.b),m=yh((.4124564*t+.3575761*s+.1804375*c)/fn),h=yh((.2126729*t+.7151522*s+.072175*c)/1);return{l:116*h-16,a:500*(m-h),b:200*(h-yh((.0193339*t+.119192*s+.9503041*c)/Qi)),alpha:l.a}}function J0(l){let t=(l.l+16)/116,s=isNaN(l.a)?t:t+l.a/500,c=isNaN(l.b)?t:t-l.b/200;return t=1*vh(t),s=fn*vh(s),c=Qi*vh(c),new zr(G_(3.2404542*s-1.5371385*t-.4985314*c),G_(-.969266*s+1.8760108*t+.041556*c),G_(.0556434*s-.2040259*t+1.0572252*c),l.alpha)}function nw(l,t,s){const c=t-l;return l+s*(c>180||c<-180?c-360*Math.round(c/360):c)}const Jd={forward:K0,reverse:J0,interpolate:function(l,t,s){return{l:Bi(l.l,t.l,s),a:Bi(l.a,t.a,s),b:Bi(l.b,t.b,s),alpha:Bi(l.alpha,t.alpha,s)}}},Qd={forward:function(l){const{l:t,a:s,b:c}=K0(l),m=Math.atan2(c,s)*sn;return{h:m<0?m+360:m,c:Math.sqrt(s*s+c*c),l:t,alpha:l.a}},reverse:function(l){const t=l.h*Nc,s=l.c;return J0({l:l.l,a:Math.cos(t)*s,b:Math.sin(t)*s,alpha:l.alpha})},interpolate:function(l,t,s){return{h:nw(l.h,t.h,s),c:Bi(l.c,t.c,s),l:Bi(l.l,t.l,s),alpha:Bi(l.alpha,t.alpha,s)}}};var Q0=Object.freeze({__proto__:null,hcl:Qd,lab:Jd});class Vo{constructor(t,s,c,m,h,_){this.type=t,this.operator=s,this.interpolation=c,this.input=m,this.dynamicStops=h,this.labels=[],this.outputs=[];for(const[w,S]of _)this.labels.push(w),this.outputs.push(S)}static interpolationFactor(t,s,c,m){let h=0;if(t.name==="exponential")h=Z_(s,t.base,c,m);else if(t.name==="linear")h=Z_(s,1,c,m);else if(t.name==="cubic-bezier"){const _=t.controlPoints;h=new Be(_[0],_[1],_[2],_[3]).solve(Z_(s,1,c,m))}return h}static parse(t,s){let[c,m,h,..._]=t;if(!Array.isArray(m)||m.length===0)return s.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const P=m[1];if(typeof P!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:P}}else{if(m[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const P=m.slice(1);if(P.length!==4||P.some(x=>typeof x!="number"||x<0||x>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:P}}}if(t.length-1<3)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length-1>3&&(t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(h=s.parse(h,2,mi),!h)return null;const w=[];let S=null;if(c==="interpolate-hcl"||c==="interpolate-lab"?S=Ws:s.expectedType&&s.expectedType.kind!=="value"&&(S=s.expectedType),t.length-1==3){const P=s.parse(_[0],3,Fr);return P?new Vo(S,c,m,h,P,w):null}for(let P=0;P<_.length;P+=2){const x=_[P],A=_[P+1],I=P+3,E=P+4;if(typeof x!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(w.length&&w[w.length-1][0]>=x)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const C=s.parse(A,E,S);if(!C)return null;S=S||C.type,w.push([x,C])}return S.kind==="number"||S.kind==="color"||S.kind==="array"&&S.itemType.kind==="number"&&typeof S.N=="number"?new Vo(S,c,m,h,null,w):s.error(`Type ${Ln(S)} is not interpolatable.`)}evaluate(t){let s=this.labels,c=this.outputs;if(this.dynamicStops){const x=this.dynamicStops.evaluate(t);if(x.length%2!=0)throw new qn("Expected an even number of arguments.");s=[],c=[];for(let A=0;A<x.length;A+=2){const I=x[A],E=new Ds(mi,x[A+1]);if(typeof I!="number")throw new qn('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.');if(s.length&&s[s.length-1]>=I)throw new qn('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.');s.push(I),c.push(E)}if(s.length===0)throw new qn("Expected at least one input/output pair.")}if(s.length===1)return c[0].evaluate(t);const m=this.input.evaluate(t);if(m<=s[0])return c[0].evaluate(t);const h=s.length;if(m>=s[h-1])return c[h-1].evaluate(t);const _=zn(s,m),w=Vo.interpolationFactor(this.interpolation,m,s[_],s[_+1]),S=c[_].evaluate(t),P=c[_+1].evaluate(t);return this.operator==="interpolate"?ch[this.type.kind.toLowerCase()](S,P,w):this.operator==="interpolate-hcl"?Qd.reverse(Qd.interpolate(Qd.forward(S),Qd.forward(P),w)):Jd.reverse(Jd.interpolate(Jd.forward(S),Jd.forward(P),w))}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,t,this.input.serialize()];if(this.dynamicStops)s.push(this.dynamicStops.serialize());else for(let c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s}}function Z_(l,t,s,c){const m=c-s,h=l-s;return m===0?0:t===1?h/m:(Math.pow(t,h)-1)/(Math.pow(t,m)-1)}class kp{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expectected at least one argument.");let c=null;const m=s.expectedType;m&&m.kind!=="value"&&(c=m);const h=[];for(const w of t.slice(1)){const S=s.parse(w,1+h.length,c,void 0,{typeAnnotation:"omit"});if(!S)return null;c=c||S.type,h.push(S)}const _=m&&h.some(w=>Zs(m,w.type));return new kp(_?Fr:c,h)}evaluate(t){let s,c=null,m=0;for(const h of this.args){if(m++,c=h.evaluate(t),c&&c instanceof Us&&!c.available&&(s||(s=c),c=null,m===this.args.length))return s;if(c!==null)break}return c}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(s=>{t.push(s.serialize())}),t}}class zp{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const c=[];for(let h=1;h<t.length-1;h+=2){const _=t[h];if(typeof _!="string")return s.error(`Expected string, but found ${typeof _} instead.`,h);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",h);const w=s.parse(t[h+1],h+1);if(!w)return null;c.push([_,w])}const m=s.parse(t[t.length-1],t.length-1,s.expectedType,c);return m?new zp(c,m):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[s,c]of this.bindings)t.push(s,c.serialize());return t.push(this.result.serialize()),t}}class Y_{constructor(t,s,c){this.type=t,this.index=s,this.input=c}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,mi),m=s.parse(t[2],2,Es(s.expectedType||Fr));return c&&m?new Y_(m.type.itemType,c,m):null}evaluate(t){const s=this.index.evaluate(t),c=this.input.evaluate(t);if(s<0)throw new qn(`Array index out of bounds: ${s} < 0.`);if(s>c.length-1)throw new qn(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s===Math.floor(s))return c[s];const m=Math.floor(s),h=Math.ceil(s),_=c[m],w=c[h];if(typeof _!="number"||typeof w!="number")throw new qn(`Cannot interpolate between non-number values at index ${s}.`);const S=s-m;return _*(1-S)+w*S}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class X_{constructor(t,s){this.type=Dr,this.needle=t,this.haystack=s}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,Fr),m=s.parse(t[2],2,Fr);return c&&m?hh(c.type,[Dr,$r,mi,oc,Fr])?new X_(c,m):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ln(c.type)} instead`):null}evaluate(t){const s=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(c==null)return!1;if(!Lc(s,["boolean","string","number","null"]))throw new qn(`Expected first argument to be of type boolean, string, number or null, but found ${Ln(kn(s))} instead.`);if(!Lc(c,["string","array"]))throw new qn(`Expected second argument to be of type array or string, but found ${Ln(kn(c))} instead.`);return c.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Fp{constructor(t,s,c){this.type=mi,this.needle=t,this.haystack=s,this.fromIndex=c}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,Fr),m=s.parse(t[2],2,Fr);if(!c||!m)return null;if(!hh(c.type,[Dr,$r,mi,oc,Fr]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ln(c.type)} instead`);if(t.length===4){const h=s.parse(t[3],3,mi);return h?new Fp(c,m,h):null}return new Fp(c,m)}evaluate(t){const s=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!Lc(s,["boolean","string","number","null"]))throw new qn(`Expected first argument to be of type boolean, string, number or null, but found ${Ln(kn(s))} instead.`);if(!Lc(c,["string","array"]))throw new qn(`Expected second argument to be of type array or string, but found ${Ln(kn(c))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(t);return c.indexOf(s,m)}return c.indexOf(s)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class K_{constructor(t,s,c,m,h,_){this.inputType=t,this.type=s,this.input=c,this.cases=m,this.outputs=h,this.otherwise=_}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let c,m;s.expectedType&&s.expectedType.kind!=="value"&&(m=s.expectedType);const h={},_=[];for(let P=2;P<t.length-1;P+=2){let x=t[P];const A=t[P+1];Array.isArray(x)||(x=[x]);const I=s.concat(P);if(x.length===0)return I.error("Expected at least one branch label.");for(const C of x){if(typeof C!="number"&&typeof C!="string")return I.error("Branch labels must be numbers or strings.");if(typeof C=="number"&&Math.abs(C)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof C=="number"&&Math.floor(C)!==C)return I.error("Numeric branch labels must be integer values.");if(c){if(I.checkSubtype(c,kn(C)))return null}else c=kn(C);if(h[String(C)]!==void 0)return I.error("Branch labels must be unique.");h[String(C)]=_.length}const E=s.parse(A,P,m);if(!E)return null;m=m||E.type,_.push(E)}const w=s.parse(t[1],1,Fr);if(!w)return null;const S=s.parse(t[t.length-1],t.length-1,m);return S?w.type.kind!=="value"&&s.concat(1).checkSubtype(c,w.type)?null:new K_(c,m,w,h,_,S):null}evaluate(t){const s=this.input.evaluate(t);return(kn(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),c=[],m={};for(const _ of s){const w=m[this.cases[_]];w===void 0?(m[this.cases[_]]=c.length,c.push([this.cases[_],[_]])):c[w][1].push(_)}const h=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,w]of c)t.push(w.length===1?h(w[0]):w.map(h)),t.push(this.outputs[_].serialize());return t.push(this.otherwise.serialize()),t}}class J_{constructor(t,s,c){this.type=t,this.branches=s,this.otherwise=c}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);const m=[];for(let _=1;_<t.length-1;_+=2){const w=s.parse(t[_],_,Dr);if(!w)return null;const S=s.parse(t[_+1],_+1,c);if(!S)return null;m.push([w,S]),c=c||S.type}const h=s.parse(t[t.length-1],t.length-1,c);return h?new J_(c,m,h):null}evaluate(t){for(const[s,c]of this.branches)if(s.evaluate(t))return c.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[s,c]of this.branches)t(s),t(c);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(s=>{t.push(s.serialize())}),t}}class Bp{constructor(t,s,c,m){this.type=t,this.input=s,this.beginIndex=c,this.endIndex=m}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=s.parse(t[1],1,Fr),m=s.parse(t[2],2,mi);if(!c||!m)return null;if(!hh(c.type,[Es(Fr),$r,Fr]))return s.error(`Expected first argument to be of type array or string, but found ${Ln(c.type)} instead`);if(t.length===4){const h=s.parse(t[3],3,mi);return h?new Bp(c.type,c,m,h):null}return new Bp(c.type,c,m)}evaluate(t){const s=this.input.evaluate(t),c=this.beginIndex.evaluate(t);if(!Lc(s,["string","array"]))throw new qn(`Expected first argument to be of type array or string, but found ${Ln(kn(s))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(t);return s.slice(c,m)}return s.slice(c)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function e1(l,t){return l==="=="||l==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function t1(l,t,s,c){return c.compare(t,s)===0}function xh(l,t,s){const c=l!=="=="&&l!=="!=";return class Hz{constructor(h,_,w){this.type=Dr,this.lhs=h,this.rhs=_,this.collator=w,this.hasUntypedArgument=h.type.kind==="value"||_.type.kind==="value"}static parse(h,_){if(h.length!==3&&h.length!==4)return _.error("Expected two or three arguments.");const w=h[0];let S=_.parse(h[1],1,Fr);if(!S)return null;if(!e1(w,S.type))return _.concat(1).error(`"${w}" comparisons are not supported for type '${Ln(S.type)}'.`);let P=_.parse(h[2],2,Fr);if(!P)return null;if(!e1(w,P.type))return _.concat(2).error(`"${w}" comparisons are not supported for type '${Ln(P.type)}'.`);if(S.type.kind!==P.type.kind&&S.type.kind!=="value"&&P.type.kind!=="value")return _.error(`Cannot compare types '${Ln(S.type)}' and '${Ln(P.type)}'.`);c&&(S.type.kind==="value"&&P.type.kind!=="value"?S=new sa(P.type,[S]):S.type.kind!=="value"&&P.type.kind==="value"&&(P=new sa(S.type,[P])));let x=null;if(h.length===4){if(S.type.kind!=="string"&&P.type.kind!=="string"&&S.type.kind!=="value"&&P.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(x=_.parse(h[3],3,mu),!x)return null}return new Hz(S,P,x)}evaluate(h){const _=this.lhs.evaluate(h),w=this.rhs.evaluate(h);if(c&&this.hasUntypedArgument){const S=kn(_),P=kn(w);if(S.kind!==P.kind||S.kind!=="string"&&S.kind!=="number")throw new qn(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${S.kind}, ${P.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const S=kn(_),P=kn(w);if(S.kind!=="string"||P.kind!=="string")return t(h,_,w)}return this.collator?s(h,_,w,this.collator.evaluate(h)):t(h,_,w)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[l];return this.eachChild(_=>{h.push(_.serialize())}),h}}}const sw=xh("==",function(l,t,s){return t===s},t1),ow=xh("!=",function(l,t,s){return t!==s},function(l,t,s,c){return!t1(0,t,s,c)}),aw=xh("<",function(l,t,s){return t<s},function(l,t,s,c){return c.compare(t,s)<0}),lw=xh(">",function(l,t,s){return t>s},function(l,t,s,c){return c.compare(t,s)>0}),cw=xh("<=",function(l,t,s){return t<=s},function(l,t,s,c){return c.compare(t,s)<=0}),uw=xh(">=",function(l,t,s){return t>=s},function(l,t,s,c){return c.compare(t,s)>=0});class Q_{constructor(t,s,c,m,h,_){this.type=$r,this.number=t,this.locale=s,this.currency=c,this.unit=m,this.minFractionDigits=h,this.maxFractionDigits=_}static parse(t,s){if(t.length!==3)return s.error("Expected two arguments.");const c=s.parse(t[1],1,mi);if(!c)return null;const m=t[2];if(typeof m!="object"||Array.isArray(m))return s.error("NumberFormat options argument must be an object.");let h=null;if(m.locale&&(h=s.parseObjectValue(m.locale,2,"locale",$r),!h))return null;let _=null;if(m.currency&&(_=s.parseObjectValue(m.currency,2,"currency",$r),!_))return null;let w=null;if(m.unit&&(w=s.parseObjectValue(m.unit,2,"unit",$r),!w))return null;let S=null;if(m["min-fraction-digits"]&&(S=s.parseObjectValue(m["min-fraction-digits"],2,"min-fraction-digits",mi),!S))return null;let P=null;return m["max-fraction-digits"]&&(P=s.parseObjectValue(m["max-fraction-digits"],2,"max-fraction-digits",mi),!P)?null:new Q_(c,h,_,w,S,P)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class eg{constructor(t){this.type=mi,this.input=t}static parse(t,s){if(t.length!==2)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);const c=s.parse(t[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Ln(c.type)} instead.`):new eg(c):null}evaluate(t){const s=this.input.evaluate(t);if(typeof s=="string"||Array.isArray(s))return s.length;throw new qn(`Expected value to be of type string or array, but found ${Ln(kn(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(s=>{t.push(s.serialize())}),t}}function Np(l){return function(){l=1831565813+(l|=0)|0;let t=Math.imul(l^l>>>15,1|l);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const bh={"==":sw,"!=":ow,">":lw,"<":aw,">=":uw,"<=":cw,array:sa,at:Y_,boolean:sa,case:J_,coalesce:kp,collator:fh,format:ac,image:kc,in:X_,"index-of":Fp,interpolate:Vo,"interpolate-hcl":Vo,"interpolate-lab":Vo,length:eg,let:zp,literal:Ds,match:K_,number:sa,"number-format":Q_,object:sa,slice:Bp,step:Fn,string:sa,"to-boolean":Qa,"to-color":Qa,"to-number":Qa,"to-string":Qa,var:ji,within:$i,distance:Fe,config:Lt};function tg(l,[t,s,c,m]){t=t.evaluate(l),s=s.evaluate(l),c=c.evaluate(l);const h=m?m.evaluate(l):1,_=Vd(t,s,c,h);if(_)throw new qn(_);return new zr(t/255*h,s/255*h,c/255*h,h)}function i1(l,[t,s,c,m]){t=t.evaluate(l),s=s.evaluate(l),c=c.evaluate(l);const h=m?m.evaluate(l):1,_=function(P,x,A,I){return typeof P=="number"&&P>=0&&P<=360?typeof x=="number"&&x>=0&&x<=100&&typeof A=="number"&&A>=0&&A<=100?I===void 0||typeof I=="number"&&I>=0&&I<=1?null:`Invalid hsla value [${[P,x,A,I].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof I=="number"?[P,x,A,I]:[P,x,A]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof I=="number"?[P,x,A,I]:[P,x,A]).join(", ")}]: 'h' must be between 0 and 360.`}(t,s,c,h);if(_)throw new qn(_);const w=`hsla(${t}, ${s}%, ${c}%, ${h})`,S=zr.parse(w);if(!S)throw new qn(`Failed to parse HSLA color: ${w}`);return S}function r1(l,t){return l in t}function ig(l,t){const s=t[l];return s===void 0?null:s}function Vc(l){return{type:l}}function rg(l){return{result:"success",value:l}}function aa(l){return{result:"error",value:l}}function Vp(l,t){return!!l&&!!l.parameters&&l.parameters.indexOf(t)>-1}function ef(l){return l["property-type"]==="data-driven"}function n1(l){return Vp(l.expression,"measure-light")}function Up(l){return Vp(l.expression,"zoom")}function tf(l){return!!l.expression&&l.expression.interpolated}function ng(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function hw(l){return l}function sg(l,t){const s=t.type==="color",c=l.stops&&typeof l.stops[0][0]=="object",m=c||!(c||l.property!==void 0),h=l.type||(tf(t)?"exponential":"interval");if(s&&((l=uh({},l)).stops&&(l.stops=l.stops.map(P=>[P[0],zr.parse(P[1])])),l.default=zr.parse(l.default?l.default:t.default)),l.colorSpace&&l.colorSpace!=="rgb"&&!Q0[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let _,w,S;if(h==="exponential")_=s1;else if(h==="interval")_=fw;else if(h==="categorical"){_=dw,w=Object.create(null);for(const P of l.stops)w[P[0]]=P[1];S=typeof l.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);_=o1}if(c){const P={},x=[];for(let E=0;E<l.stops.length;E++){const C=l.stops[E],R=C[0].zoom;P[R]===void 0&&(P[R]={zoom:R,type:l.type,property:l.property,default:l.default,stops:[]},x.push(R)),P[R].stops.push([C[0].value,C[1]])}const A=[];for(const E of x)A.push([P[E].zoom,sg(P[E],t)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:Vo.interpolationFactor.bind(void 0,I),zoomStops:A.map(E=>E[0]),evaluate:({zoom:E},C)=>s1({stops:A,base:l.base},t,E).evaluate(E,C)}}if(m){const P=h==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:Vo.interpolationFactor.bind(void 0,P),zoomStops:l.stops.map(x=>x[0]),evaluate:({zoom:x})=>_(l,t,x,w,S)}}return{kind:"source",evaluate(P,x){const A=x&&x.properties?x.properties[l.property]:void 0;return A===void 0?wh(l.default,t.default):_(l,t,A,w,S)}}}function wh(l,t,s){return l!==void 0?l:t!==void 0?t:s!==void 0?s:void 0}function dw(l,t,s,c,m){return wh(typeof s===m?c[s]:void 0,l.default,t.default)}function fw(l,t,s){if(oa(s)!=="number")return wh(l.default,t.default);const c=l.stops.length;if(c===1||s<=l.stops[0][0])return l.stops[0][1];if(s>=l.stops[c-1][0])return l.stops[c-1][1];const m=zn(l.stops.map(h=>h[0]),s);return l.stops[m][1]}function s1(l,t,s){const c=l.base!==void 0?l.base:1;if(oa(s)!=="number")return wh(l.default,t.default);const m=l.stops.length;if(m===1||s<=l.stops[0][0])return l.stops[0][1];if(s>=l.stops[m-1][0])return l.stops[m-1][1];const h=zn(l.stops.map(x=>x[0]),s),_=function(x,A,I,E){const C=E-I,R=x-I;return C===0?0:A===1?R/C:(Math.pow(A,R)-1)/(Math.pow(A,C)-1)}(s,c,l.stops[h][0],l.stops[h+1][0]),w=l.stops[h][1],S=l.stops[h+1][1];let P=ch[t.type]||hw;if(l.colorSpace&&l.colorSpace!=="rgb"){const x=Q0[l.colorSpace];P=(A,I)=>x.reverse(x.interpolate(x.forward(A),x.forward(I),_))}return typeof w.evaluate=="function"?{evaluate(...x){const A=w.evaluate.apply(void 0,x),I=S.evaluate.apply(void 0,x);if(A!==void 0&&I!==void 0)return P(A,I,_)}}:P(w,S,_)}function o1(l,t,s){return t.type==="color"?s=zr.parse(s):t.type==="formatted"?s=Ys.fromString(s.toString()):t.type==="resolvedImage"?s=Us.build(s.toString()):oa(s)===t.type||t.type==="enum"&&t.values[s]||(s=void 0),wh(s,l.default,t.default)}co.register(bh,{error:[{kind:"error"},[$r],(l,[t])=>{throw new qn(t.evaluate(l))}],typeof:[$r,[Fr],(l,[t])=>Ln(kn(t.evaluate(l)))],"to-rgba":[Es(mi,4),[Ws],(l,[t])=>t.evaluate(l).toRenderColor(null).toArray()],"to-hsla":[Es(mi,4),[Ws],(l,[t])=>t.evaluate(l).toRenderColor(null).toHslaArray()],rgb:[Ws,[mi,mi,mi],tg],rgba:[Ws,[mi,mi,mi,mi],tg],hsl:[Ws,[mi,mi,mi],i1],hsla:[Ws,[mi,mi,mi,mi],i1],has:{type:Dr,overloads:[[[$r],(l,[t])=>r1(t.evaluate(l),l.properties())],[[$r,Ka],(l,[t,s])=>r1(t.evaluate(l),s.evaluate(l))]]},get:{type:Fr,overloads:[[[$r],(l,[t])=>ig(t.evaluate(l),l.properties())],[[$r,Ka],(l,[t,s])=>ig(t.evaluate(l),s.evaluate(l))]]},"feature-state":[Fr,[$r],(l,[t])=>ig(t.evaluate(l),l.featureState||{})],properties:[Ka,[],l=>l.properties()],"geometry-type":[$r,[],l=>l.geometryType()],id:[Fr,[],l=>l.id()],zoom:[mi,[],l=>l.globals.zoom],pitch:[mi,[],l=>l.globals.pitch||0],"distance-from-center":[mi,[],l=>l.distanceFromCenter()],"measure-light":[mi,[$r],(l,[t])=>l.measureLight(t.evaluate(l))],"heatmap-density":[mi,[],l=>l.globals.heatmapDensity||0],"line-progress":[mi,[],l=>l.globals.lineProgress||0],"raster-value":[mi,[],l=>l.globals.rasterValue||0],"raster-particle-speed":[mi,[],l=>l.globals.rasterParticleSpeed||0],"sky-radial-progress":[mi,[],l=>l.globals.skyRadialProgress||0],accumulated:[Fr,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[mi,Vc(mi),(l,t)=>{let s=0;for(const c of t)s+=c.evaluate(l);return s}],"*":[mi,Vc(mi),(l,t)=>{let s=1;for(const c of t)s*=c.evaluate(l);return s}],"-":{type:mi,overloads:[[[mi,mi],(l,[t,s])=>t.evaluate(l)-s.evaluate(l)],[[mi],(l,[t])=>-t.evaluate(l)]]},"/":[mi,[mi,mi],(l,[t,s])=>t.evaluate(l)/s.evaluate(l)],"%":[mi,[mi,mi],(l,[t,s])=>t.evaluate(l)%s.evaluate(l)],ln2:[mi,[],()=>Math.LN2],pi:[mi,[],()=>Math.PI],e:[mi,[],()=>Math.E],"^":[mi,[mi,mi],(l,[t,s])=>Math.pow(t.evaluate(l),s.evaluate(l))],sqrt:[mi,[mi],(l,[t])=>Math.sqrt(t.evaluate(l))],log10:[mi,[mi],(l,[t])=>Math.log(t.evaluate(l))/Math.LN10],ln:[mi,[mi],(l,[t])=>Math.log(t.evaluate(l))],log2:[mi,[mi],(l,[t])=>Math.log(t.evaluate(l))/Math.LN2],sin:[mi,[mi],(l,[t])=>Math.sin(t.evaluate(l))],cos:[mi,[mi],(l,[t])=>Math.cos(t.evaluate(l))],tan:[mi,[mi],(l,[t])=>Math.tan(t.evaluate(l))],asin:[mi,[mi],(l,[t])=>Math.asin(t.evaluate(l))],acos:[mi,[mi],(l,[t])=>Math.acos(t.evaluate(l))],atan:[mi,[mi],(l,[t])=>Math.atan(t.evaluate(l))],min:[mi,Vc(mi),(l,t)=>Math.min(...t.map(s=>s.evaluate(l)))],max:[mi,Vc(mi),(l,t)=>Math.max(...t.map(s=>s.evaluate(l)))],abs:[mi,[mi],(l,[t])=>Math.abs(t.evaluate(l))],round:[mi,[mi],(l,[t])=>{const s=t.evaluate(l);return s<0?-Math.round(-s):Math.round(s)}],floor:[mi,[mi],(l,[t])=>Math.floor(t.evaluate(l))],ceil:[mi,[mi],(l,[t])=>Math.ceil(t.evaluate(l))],"filter-==":[Dr,[$r,Fr],(l,[t,s])=>l.properties()[t.value]===s.value],"filter-id-==":[Dr,[Fr],(l,[t])=>l.id()===t.value],"filter-type-==":[Dr,[$r],(l,[t])=>l.geometryType()===t.value],"filter-<":[Dr,[$r,Fr],(l,[t,s])=>{const c=l.properties()[t.value],m=s.value;return typeof c==typeof m&&c<m}],"filter-id-<":[Dr,[Fr],(l,[t])=>{const s=l.id(),c=t.value;return typeof s==typeof c&&s<c}],"filter->":[Dr,[$r,Fr],(l,[t,s])=>{const c=l.properties()[t.value],m=s.value;return typeof c==typeof m&&c>m}],"filter-id->":[Dr,[Fr],(l,[t])=>{const s=l.id(),c=t.value;return typeof s==typeof c&&s>c}],"filter-<=":[Dr,[$r,Fr],(l,[t,s])=>{const c=l.properties()[t.value],m=s.value;return typeof c==typeof m&&c<=m}],"filter-id-<=":[Dr,[Fr],(l,[t])=>{const s=l.id(),c=t.value;return typeof s==typeof c&&s<=c}],"filter->=":[Dr,[$r,Fr],(l,[t,s])=>{const c=l.properties()[t.value],m=s.value;return typeof c==typeof m&&c>=m}],"filter-id->=":[Dr,[Fr],(l,[t])=>{const s=l.id(),c=t.value;return typeof s==typeof c&&s>=c}],"filter-has":[Dr,[Fr],(l,[t])=>t.value in l.properties()],"filter-has-id":[Dr,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[Dr,[Es($r)],(l,[t])=>t.value.indexOf(l.geometryType())>=0],"filter-id-in":[Dr,[Es(Fr)],(l,[t])=>t.value.indexOf(l.id())>=0],"filter-in-small":[Dr,[$r,Es(Fr)],(l,[t,s])=>s.value.indexOf(l.properties()[t.value])>=0],"filter-in-large":[Dr,[$r,Es(Fr)],(l,[t,s])=>function(c,m,h,_){for(;h<=_;){const w=h+_>>1;if(m[w]===c)return!0;m[w]>c?_=w-1:h=w+1}return!1}(l.properties()[t.value],s.value,0,s.value.length-1)],all:{type:Dr,overloads:[[[Dr,Dr],(l,[t,s])=>t.evaluate(l)&&s.evaluate(l)],[Vc(Dr),(l,t)=>{for(const s of t)if(!s.evaluate(l))return!1;return!0}]]},any:{type:Dr,overloads:[[[Dr,Dr],(l,[t,s])=>t.evaluate(l)||s.evaluate(l)],[Vc(Dr),(l,t)=>{for(const s of t)if(s.evaluate(l))return!0;return!1}]]},"!":[Dr,[Dr],(l,[t])=>!t.evaluate(l)],"is-supported-script":[Dr,[$r],(l,[t])=>{const s=l.globals&&l.globals.isSupportedScript;return!s||s(t.evaluate(l))}],upcase:[$r,[$r],(l,[t])=>t.evaluate(l).toUpperCase()],downcase:[$r,[$r],(l,[t])=>t.evaluate(l).toLowerCase()],concat:[$r,Vc(Fr),(l,t)=>t.map(s=>No(s.evaluate(l))).join("")],"resolved-locale":[$r,[mu],(l,[t])=>t.evaluate(l).resolvedLocale()],random:[mi,[mi,mi,Fr],(l,t)=>{const[s,c,m]=t.map(_=>_.evaluate(l));if(s>c||s===c)return s;let h;if(typeof m=="string")h=function(_){let w=0;if(_.length===0)return w;for(let S=0;S<_.length;S++)w=(w<<5)-w+_.charCodeAt(S),w|=0;return w}(m);else{if(typeof m!="number")throw new qn(`Invalid seed input: ${m}`);h=m}return s+Np(h)()*(c-s)}]});class jp{constructor(t,s,c,m){this.expression=t,this._warningHistory={},this._evaluator=new jd(c,m),this._defaultValue=s?function(h){return h.type==="color"&&(ng(h.default)||Array.isArray(h.default))?new zr(0,0,0,0):h.type==="color"?zr.parse(h.default)||null:h.default===void 0?null:h.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null,this.configDependencies=di(t)}evaluateWithoutErrorHandling(t,s,c,m,h,_,w,S){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=m||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=S||null,this.expression.evaluate(this._evaluator)}evaluate(t,s,c,m,h,_,w,S){this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=S||null;try{const P=this.expression.evaluate(this._evaluator);if(P==null||typeof P=="number"&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new qn(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${P.message}`)),this._defaultValue}}}function Th(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in bh}function Eh(l,t,s,c){const m=new Cr(bh,[],t?function(_){const w={color:Ws,string:$r,number:mi,enum:$r,boolean:Dr,formatted:na,resolvedImage:_u};return _.type==="array"?Es(w[_.value]||Fr,_.length):w[_.type]}(t):void 0,void 0,void 0,s,c),h=m.parse(l,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?rg(new jp(h,t,s,c)):aa(m.errors)}class $p{constructor(t,s,c,m){this.kind=t,this._styleExpression=s,this.isLightConstant=c,this.isLineProgressConstant=m,this.isStateDependent=t!=="constant"&&!Yt(s.expression),this.configDependencies=di(s.expression)}evaluateWithoutErrorHandling(t,s,c,m,h,_){return this._styleExpression.evaluateWithoutErrorHandling(t,s,c,m,h,_)}evaluate(t,s,c,m,h,_){return this._styleExpression.evaluate(t,s,c,m,h,_)}}class rf{constructor(t,s,c,m,h,_){this.kind=t,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=t!=="camera"&&!Yt(s.expression),this.isLightConstant=h,this.isLineProgressConstant=_,this.configDependencies=di(s.expression),this.interpolationType=m}evaluateWithoutErrorHandling(t,s,c,m,h,_){return this._styleExpression.evaluateWithoutErrorHandling(t,s,c,m,h,_)}evaluate(t,s,c,m,h,_){return this._styleExpression.evaluate(t,s,c,m,h,_)}interpolationFactor(t,s,c){return this.interpolationType?Vo.interpolationFactor(this.interpolationType,t,s,c):0}}function a1(l,t,s,c){if((l=Eh(l,t,s,c)).result==="error")return l;const m=l.value.expression,h=jt(m);if(!h&&!ef(t))return aa([new xr("","data expressions not supported")]);const _=Ei(m,["zoom","pitch","distance-from-center"]);if(!_&&!Up(t))return aa([new xr("","zoom expressions not supported")]);const w=Ei(m,["measure-light"]);if(!w&&!n1(t))return aa([new xr("","measure-light expression not supported")]);const S=Ei(m,["line-progress"]);if(!S&&!function(A){return Vp(A.expression,"line-progress")}(t))return aa([new xr("","line-progress expression not supported")]);const P=t.expression&&t.expression.relaxZoomRestriction,x=sf(m);return x||_||P?x instanceof xr?aa([x]):x instanceof Vo&&!tf(t)?aa([new xr("",'"interpolate" expressions cannot be used with this property')]):rg(x?new rf(h&&S?"camera":"composite",l.value,x.labels,x instanceof Vo?x.interpolation:void 0,w,S):new $p(h&&S?"constant":"source",l.value,w,S)):aa([new xr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class nf{constructor(t,s){this._parameters=t,this._specification=s,uh(this,sg(this._parameters,this._specification))}static deserialize(t){return new nf(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function sf(l){let t=null;if(l instanceof zp)t=sf(l.result);else if(l instanceof kp){for(const s of l.args)if(t=sf(s),t)break}else(l instanceof Fn||l instanceof Vo)&&l.input instanceof co&&l.input.name==="zoom"&&(t=l);return t instanceof xr||l.eachChild(s=>{const c=sf(s);c instanceof xr?t=c:t&&c&&t!==c&&(t=new xr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}var og,l1,pw=function(){if(l1)return og;l1=1,og=t;var l=3;function t(s,c,m){var h=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var _=new Int32Array(this.arrayBuffer);s=_[0],this.d=(c=_[1])+2*(m=_[2]);for(var w=0;w<this.d*this.d;w++){var S=_[l+w],P=_[l+w+1];h.push(S===P?null:_.subarray(S,P))}var x=_[l+h.length+1];this.keys=_.subarray(_[l+h.length],x),this.bboxes=_.subarray(x),this.insert=this._insertReadonly}else{this.d=c+2*m;for(var A=0;A<this.d*this.d;A++)h.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=s,this.padding=m,this.scale=c/s,this.uid=0;var I=m/c*s;this.min=-I,this.max=s+I}return t.prototype.insert=function(s,c,m,h,_){this._forEachCell(c,m,h,_,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(h),this.bboxes.push(_)},t.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},t.prototype._insertCell=function(s,c,m,h,_,w){this.cells[_].push(w)},t.prototype.query=function(s,c,m,h,_){var w=this.min,S=this.max;if(s<=w&&c<=w&&S<=m&&S<=h&&!_)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(s,c,m,h,this._queryCell,P,{},_),P},t.prototype._queryCell=function(s,c,m,h,_,w,S,P){var x=this.cells[_];if(x!==null)for(var A=this.keys,I=this.bboxes,E=0;E<x.length;E++){var C=x[E];if(S[C]===void 0){var R=4*C;(P?P(I[R+0],I[R+1],I[R+2],I[R+3]):s<=I[R+2]&&c<=I[R+3]&&m>=I[R+0]&&h>=I[R+1])?(S[C]=!0,w.push(A[C])):S[C]=!1}}},t.prototype._forEachCell=function(s,c,m,h,_,w,S,P){for(var x=this._convertToCellCoord(s),A=this._convertToCellCoord(c),I=this._convertToCellCoord(m),E=this._convertToCellCoord(h),C=x;C<=I;C++)for(var R=A;R<=E;R++){var z=this.d*R+C;if((!P||P(this._convertFromCellCoord(C),this._convertFromCellCoord(R),this._convertFromCellCoord(C+1),this._convertFromCellCoord(R+1)))&&_.call(this,s,c,m,h,z,w,S,P))return}},t.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},t.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},t.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,c=l+this.cells.length+1+1,m=0,h=0;h<this.cells.length;h++)m+=this.cells[h].length;var _=new Int32Array(c+m+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var w=c,S=0;S<s.length;S++){var P=s[S];_[l+S]=w,_.set(P,w),w+=P.length}return _[l+s.length]=w,_.set(this.keys,w),_[l+s.length+1]=w+=this.keys.length,_.set(this.bboxes,w),w+=this.bboxes.length,_.buffer},og}(),Au=D(pw);const qp={};function gi(l,t,s={}){Object.defineProperty(l,"_classRegistryKey",{value:t,writable:!1}),qp[t]={klass:l,omit:s.omit||[]}}gi(Object,"Object"),Au.serialize=function(l,t){const s=l.toArrayBuffer();return t&&t.add(s),{buffer:s}},Au.deserialize=function(l){return new Au(l.buffer)},Object.defineProperty(Au,"name",{value:"Grid"}),gi(Au,"Grid"),typeof DOMMatrix<"u"&&gi(DOMMatrix,"DOMMatrix"),gi(zr,"Color"),gi(Error,"Error"),gi(Ys,"Formatted"),gi(gu,"FormattedSection"),gi(ki,"AJAXError"),gi(Us,"ResolvedImage"),gi(nf,"StylePropertyFunction"),gi(jp,"StyleExpression",{omit:["_evaluator"]}),gi(Ra,"ImageIdWithOptions"),gi(rf,"ZoomDependentExpression"),gi($p,"ZoomConstantExpression"),gi(co,"CompoundExpression",{omit:["_evaluate"]});for(const l in bh)qp[bh[l]._classRegistryKey]||gi(bh[l],`Expression${l}`);function ag(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function lg(l){return self.ImageBitmap&&l instanceof ImageBitmap}function Uc(l,t){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp)return l;if(ag(l)||lg(l))return t&&t.add(l),l;if(ArrayBuffer.isView(l))return t&&t.add(l.buffer),l;if(l instanceof ImageData)return t&&t.add(l.data.buffer),l;if(Array.isArray(l)){const s=[];for(const c of l)s.push(Uc(c,t));return s}if(l instanceof Map){const s={$name:"Map"};for(const[c,m]of l.entries())s[c]=Uc(m);return s}if(l instanceof Set){const s={$name:"Set"};let c=0;for(const m of l.values())s[++c]=Uc(m);return s}if(typeof l=="object"){const s=l.constructor,c=s._classRegistryKey;if(!c)throw new Error(`Can't serialize object of unregistered class "${c}".`);const m=s.serialize?s.serialize(l,t):{};if(!s.serialize){for(const h in l)l.hasOwnProperty(h)&&(qp[c].omit.indexOf(h)>=0||(m[h]=Uc(l[h],t)));l instanceof Error&&(m.message=l.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(m.$name=c),m}throw new Error("can't serialize object of type "+typeof l)}function Cu(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||ag(l)||lg(l)||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(Cu);if(typeof l=="object"){const t=l.$name||"Object";if(t==="Map"){const m=new Map;for(const h of Object.keys(l))h!=="$name"&&m.set(h,Cu(l[h]));return m}if(t==="Set"){const m=new Set;for(const h of Object.keys(l))h!=="$name"&&m.add(Cu(l[h]));return m}const{klass:s}=qp[t];if(!s)throw new Error(`Can't deserialize unregistered class "${t}".`);if(s.deserialize)return s.deserialize(l);const c=Object.create(s.prototype);for(const m of Object.keys(l))m!=="$name"&&(c[m]=Cu(l[m]));return c}throw new Error("can't deserialize object of type "+typeof l)}const Si={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519,Osage:l=>l>=66736&&l<=66815,"CJK Unified Ideographs Extension B":l=>l>=131072&&l<=173791};function cg(l){for(const t of l)if(Hp(t.charCodeAt(0)))return!0;return!1}function mw(l){for(const t of l)if(!_w(t.charCodeAt(0)))return!1;return!0}function _w(l){return!(Si.Arabic(l)||Si["Arabic Supplement"](l)||Si["Arabic Extended-A"](l)||Si["Arabic Presentation Forms-A"](l)||Si["Arabic Presentation Forms-B"](l))}function Hp(l){return!(l!==746&&l!==747&&(l<4352||!(Si["Bopomofo Extended"](l)||Si.Bopomofo(l)||Si["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||Si["CJK Compatibility Ideographs"](l)||Si["CJK Compatibility"](l)||Si["CJK Radicals Supplement"](l)||Si["CJK Strokes"](l)||!(!Si["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||Si["CJK Unified Ideographs Extension A"](l)||Si["CJK Unified Ideographs"](l)||Si["Enclosed CJK Letters and Months"](l)||Si["Hangul Compatibility Jamo"](l)||Si["Hangul Jamo Extended-A"](l)||Si["Hangul Jamo Extended-B"](l)||Si["Hangul Jamo"](l)||Si["Hangul Syllables"](l)||Si.Hiragana(l)||Si["Ideographic Description Characters"](l)||Si.Kanbun(l)||Si["Kangxi Radicals"](l)||Si["Katakana Phonetic Extensions"](l)||Si.Katakana(l)&&l!==12540||!(!Si["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!Si["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||Si["Unified Canadian Aboriginal Syllabics"](l)||Si["Unified Canadian Aboriginal Syllabics Extended"](l)||Si["Vertical Forms"](l)||Si["Yijing Hexagram Symbols"](l)||Si["Yi Syllables"](l)||Si["Yi Radicals"](l))))}function ug(l){return!(Hp(l)||function(t){return!!(Si["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Si["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Si["Letterlike Symbols"](t)||Si["Number Forms"](t)||Si["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Si["Control Pictures"](t)&&t!==9251||Si["Optical Character Recognition"](t)||Si["Enclosed Alphanumerics"](t)||Si["Geometric Shapes"](t)||Si["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Si["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Si["CJK Symbols and Punctuation"](t)||Si.Katakana(t)||Si["Private Use Area"](t)||Si["CJK Compatibility Forms"](t)||Si["Small Form Variants"](t)||Si["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(l))}function hg(l){return l>=1424&&l<=2303||Si["Arabic Presentation Forms-A"](l)||Si["Arabic Presentation Forms-B"](l)}function c1(l,t){return!(!t&&hg(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||Si.Khmer(l))}function dg(l){for(const t of l)if(hg(t.charCodeAt(0)))return!0;return!1}const of="deferred",Gp="loading",fg="loaded";let Ol=null,Uo="unavailable",jc=null;const pg=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(Uo="error"),Ol&&Ol(l)};function mg(){Sh.fire(new Ia("pluginStateChange",{pluginStatus:Uo,pluginURL:jc}))}const Sh=new Ml,Wp=function(){return Uo},af=function(){if(Uo!==of||!jc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Uo=Gp,mg(),jc&&On({url:jc},l=>{l?pg(l):(Uo=fg,mg())})},la={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Uo===fg||la.applyArabicShaping!=null,isLoading:()=>Uo===Gp,setState(l){Uo=l.pluginStatus,jc=l.pluginURL},isParsed:()=>la.applyArabicShaping!=null&&la.processBidirectionalText!=null&&la.processStyledBidirectionalText!=null,getPluginURL:()=>jc};class bn{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch,this.brightness=s.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(s,c){for(const m of s)if(!c1(m.charCodeAt(0),c))return!1;return!0}(t,la.isLoaded())}}class Zp{constructor(t,s,c,m){this.property=t,this.value=s,this.expression=function(h,_,w,S){if(ng(h))return new nf(h,_);if(Th(h)||Array.isArray(h)&&h.length>0){const P=a1(h,_,w,S);if(P.result==="error")throw new Error(P.value.map(x=>`${x.key}: ${x.message}`).join(", "));return P.value}{let P=h;return typeof h=="string"&&_.type==="color"&&(P=zr.parse(h)),{kind:"constant",configDependencies:new Set,evaluate:()=>P}}}(s===void 0?t.specification.default:s,t.specification,c,m)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,s,c){return this.property.possiblyEvaluate(this,t,s,c)}}class lf{constructor(t,s,c){this.property=t,this.value=new Zp(t,void 0,s,c)}transitioned(t,s){return new _g(this.property,this.value,s,Ki({},t.transition,this.transition),t.now)}untransitioned(){return new _g(this.property,this.value,null,{},0)}}class Yp{constructor(t,s,c){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=s,this._options=c,this.configDependencies=new Set}getValue(t){return Ar(this._values[t].value.value)}setValue(t,s){this._values.hasOwnProperty(t)||(this._values[t]=new lf(this._values[t].property,this._scope,this._options)),this._values[t].value=new Zp(this._values[t].property,s===null?void 0:Ar(s),this._scope,this._options),this._values[t].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].value.expression.configDependencies]))}setTransitionOrValue(t,s){s&&(this._options=s);const c=this._properties.properties;if(t)for(const m in t){const h=t[m];if(yr(m,"-transition")){const _=m.slice(0,-11);c[_]&&this.setTransition(_,h)}else c.hasOwnProperty(m)&&this.setValue(m,h)}}getTransition(t){return Ar(this._values[t].transition)}setTransition(t,s){this._values.hasOwnProperty(t)||(this._values[t]=new lf(this._values[t].property)),this._values[t].transition=Ar(s)||void 0}serialize(){const t={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(t[s]=c);const m=this.getTransition(s);m!==void 0&&(t[`${s}-transition`]=m)}return t}transitioned(t,s){const c=new cf(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].transitioned(t,s._values[m]);return c}untransitioned(){const t=new cf(this._properties);for(const s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}}class _g{constructor(t,s,c,m,h){const _=m.delay||0,w=m.duration||0;h=h||0,this.property=t,this.value=s,this.begin=h+_,this.end=this.begin+w,t.specification.transition&&(m.delay||m.duration)&&(this.prior=c)}possiblyEvaluate(t,s,c){const m=t.now||0,h=this.value.possiblyEvaluate(t,s,c),_=this.prior;if(_){if(m>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(m<this.begin)return _.possiblyEvaluate(t,s,c);{const w=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,s,c),h,Kt(w))}}return h}}class cf{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,c){const m=new Mh(this._properties);for(const h of Object.keys(this._values))m._values[h]=this._values[h].possiblyEvaluate(t,s,c);return m}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Ah{constructor(t,s,c){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=s,this._options=c,this.configDependencies=new Set}getValue(t){return Ar(this._values[t].value)}setValue(t,s){this._values[t]=new Zp(this._values[t].property,s===null?void 0:Ar(s),this._scope,this._options),this._values[t].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].expression.configDependencies]))}serialize(){const t={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(t[s]=c)}return t}possiblyEvaluate(t,s,c){const m=new Mh(this._properties);for(const h of Object.keys(this._values))m._values[h]=this._values[h].possiblyEvaluate(t,s,c);return m}}class Ch{constructor(t,s,c){this.property=t,this.value=s,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,s,c,m){return this.property.evaluate(this.value,this.parameters,t,s,c,m)}}class Mh{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Xt{constructor(t){this.specification=t}possiblyEvaluate(t,s){return t.expression.evaluate(s)}interpolate(t,s,c){const m=ch[this.specification.type];return m?m(t,s,c):t}}class hi{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,c,m){return new Ch(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(s,null,{},c,m)}:t.expression,s)}interpolate(t,s,c){if(t.value.kind!=="constant"||s.value.kind!=="constant")return t;if(t.value.value===void 0||s.value.value===void 0)return new Ch(this,{kind:"constant",value:void 0},t.parameters);const m=ch[this.specification.type];return m?new Ch(this,{kind:"constant",value:m(t.value.value,s.value.value,c)},t.parameters):t}evaluate(t,s,c,m,h,_){return t.kind==="constant"?t.value:t.evaluate(s,c,m,h,_)}}class Ih{constructor(t){this.specification=t}possiblyEvaluate(t,s,c,m){return!!t.expression.evaluate(s,null,{},c,m)}interpolate(){return!1}}class Bn{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new bn(0,{});for(const c in t){const m=t[c];m.specification.overridable&&this.overridableProperties.push(c);const h=this.defaultPropertyValues[c]=new Zp(m,void 0),_=this.defaultTransitionablePropertyValues[c]=new lf(m);this.defaultTransitioningPropertyValues[c]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=h.possiblyEvaluate(s)}}}gi(hi,"DataDrivenProperty"),gi(Xt,"DataConstantProperty"),gi(Ih,"ColorRampProperty");var gt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function u1(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function Xp(l){if(Array.isArray(l))return l.map(Xp);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const t={};for(const s in l)t[s]=Xp(l[s]);return t}return u1(l)}function gg(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const t of l.slice(1))if(!gg(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function h1(l,t="",s=null,c="fill"){if(l==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};gg(l)||(l=Kp(l));const m=l;let h=!0;try{h=function(x){if(!Ph(x))return x;let A=Xp(x);return f1(A),A=d1(A),A}(m)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(m,null,2)}
        `)}let _=null,w=null;if(c!=="background"&&c!=="sky"&&c!=="slot"){w=gt[`filter_${c}`];const x=Eh(h,w,t,s);if(x.result==="error")throw new Error(x.value.map(A=>`${A.key}: ${A.message}`).join(", "));_=(A,I,E)=>x.value.evaluate(A,I,{},E)}let S=null,P=null;if(h!==m){const x=Eh(m,w,t,s);if(x.result==="error")throw new Error(x.value.map(A=>`${A.key}: ${A.message}`).join(", "));S=(A,I,E,C,R)=>x.value.evaluate(A,I,{},E,void 0,void 0,C,R),P=!jt(x.value.expression)}return{filter:_,dynamicFilter:S||void 0,needGeometry:p1(h),needFeature:!!P}}function d1(l){if(!Array.isArray(l))return l;const t=function(s){if(gw.has(s[0])){for(let c=1;c<s.length;c++)if(Ph(s[c]))return!0}return s}(l);return t===!0?t:t.map(s=>d1(s))}function f1(l){let t=!1;const s=[];if(l[0]==="case"){for(let c=1;c<l.length-1;c+=2)t=t||Ph(l[c]),s.push(l[c+1]);s.push(l[l.length-1])}else if(l[0]==="match"){t=t||Ph(l[1]);for(let c=2;c<l.length-1;c+=2)s.push(l[c+1]);s.push(l[l.length-1])}else if(l[0]==="step"){t=t||Ph(l[1]);for(let c=1;c<l.length-1;c+=2)s.push(l[c+1])}t&&(l.length=0,l.push("any",...s));for(let c=1;c<l.length;c++)f1(l[c])}function Ph(l){if(!Array.isArray(l))return!1;if((t=l[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let s=1;s<l.length;s++)if(Ph(l[s]))return!0;return!1}const gw=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function yw(l,t){return l<t?-1:l>t?1:0}function p1(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let t=1;t<l.length;t++)if(p1(l[t]))return!0;return!1}function Kp(l){if(!l)return!0;const t=l[0];return l.length<=1?t!=="any":t==="=="?$c(l[1],l[2],"=="):t==="!="?Mu($c(l[1],l[2],"==")):t==="<"||t===">"||t==="<="||t===">="?$c(l[1],l[2],t):t==="any"?(s=l.slice(1),["any"].concat(s.map(Kp))):t==="all"?["all"].concat(l.slice(1).map(Kp)):t==="none"?["all"].concat(l.slice(1).map(Kp).map(Mu)):t==="in"?yg(l[1],l.slice(2)):t==="!in"?Mu(yg(l[1],l.slice(2))):t==="has"?vg(l[1]):t!=="!has"||Mu(vg(l[1]));var s}function $c(l,t,s){switch(l){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,l,t]}}function yg(l,t){if(t.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",l,["literal",t.sort(yw)]]:["filter-in-small",l,["literal",t]]}}function vg(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function Mu(l){return["!",l]}const Jp="";function Ll(l,t){return t?`${l}${Jp}${t}`:l}const pc="-transition",m1=new Set(["fill","line","background","hillshade","raster"]);class js extends Ml{constructor(t,s,c,m,h){if(super(),this.id=t.id,this.fqid=Ll(this.id,c),this.type=t.type,this.scope=c,this.lut=m,this.options=h,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,t.type!=="custom"){if(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type&&t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"){this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter;const _=Eh(this.filter,gt[`filter_${t.type}`]);_.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,..._.value.configDependencies]))}if(t.slot&&(this.slot=t.slot),s.layout&&(this._unevaluatedLayout=new Ah(s.layout,this.scope,h),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),s.paint){this._transitionablePaint=new Yp(s.paint,this.scope,h);for(const _ in t.paint)this.setPaintProperty(_,t.paint[_]);for(const _ in t.layout)this.setLayoutProperty(_,t.layout[_]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Mh(s.paint)}}}onAdd(t){}onRemove(t){}isDraped(t){return!this.is3D()&&m1.has(this.type)}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s){if(this.type==="custom"&&t==="visibility")return void(this.visibility=s);const c=this._unevaluatedLayout;c._properties.properties[t]&&(c.setValue(t,s),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),t==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(t){return yr(t,pc)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,s){const c=this._transitionablePaint,m=c._properties.properties;if(yr(t,pc)){const A=t.slice(0,-11);return m[A]&&c.setTransition(A,s||void 0),!1}if(!m[t])return!1;const h=c._values[t],_=h.value.isDataDriven(),w=h.value;c.setValue(t,s),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),this._handleSpecialPaintPropertyUpdate(t);const S=c._values[t].value,P=S.isDataDriven(),x=yr(t,"pattern")||t==="line-dasharray";return P||_||x||this._handleOverridablePaintPropertyUpdate(t,w,S)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,s,c){return null}_handleOverridablePaintPropertyUpdate(t,s,c){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){return Ts({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,s)=>!(t===void 0||s==="layout"&&!Object.keys(t).length||s==="paint"&&!Object.keys(t).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const s=this.paint.get(t);if(s instanceof Ch&&ef(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}compileFilter(t){this._filterCompiled||(this._featureFilter=h1(this.filter,this.scope,t),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&(t.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(t){}queryIntersectsFeature(t,s,c,m,h,_,w,S,P){}}const vw={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class uf{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class wn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,s){return t._trim(),s&&(t.isTransferred=!0,s.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function qr(l,t=1){let s=0,c=0;return{members:l.map(m=>{const h=vw[m.type].BYTES_PER_ELEMENT,_=s=_1(s,Math.max(t,h)),w=m.components||1;return c=Math.max(c,h),s+=h*w,{name:m.name,type:m.type,components:w,offset:_}}),size:_1(s,Math.max(c,t)),alignment:t}}function _1(l,t){return Math.ceil(l/t)*t}class mc extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const m=2*t;return this.int16[m+0]=s,this.int16[m+1]=c,t}}mc.prototype.bytesPerElement=4,gi(mc,"StructArrayLayout2i4");class Rh extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c){const m=this.length;return this.resize(m+1),this.emplace(m,t,s,c)}emplace(t,s,c,m){const h=3*t;return this.int16[h+0]=s,this.int16[h+1]=c,this.int16[h+2]=m,t}}Rh.prototype.bytesPerElement=6,gi(Rh,"StructArrayLayout3i6");class _c extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,m){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,c,m)}emplace(t,s,c,m,h){const _=4*t;return this.int16[_+0]=s,this.int16[_+1]=c,this.int16[_+2]=m,this.int16[_+3]=h,t}}_c.prototype.bytesPerElement=8,gi(_c,"StructArrayLayout4i8");class Qp extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,m,h){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,c,m,h)}emplace(t,s,c,m,h,_){const w=5*t;return this.int16[w+0]=s,this.int16[w+1]=c,this.int16[w+2]=m,this.int16[w+3]=h,this.int16[w+4]=_,t}}Qp.prototype.bytesPerElement=10,gi(Qp,"StructArrayLayout5i10");class hf extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,m,h,_,w){const S=this.length;return this.resize(S+1),this.emplace(S,t,s,c,m,h,_,w)}emplace(t,s,c,m,h,_,w,S){const P=6*t,x=12*t,A=3*t;return this.int16[P+0]=s,this.int16[P+1]=c,this.uint8[x+4]=m,this.uint8[x+5]=h,this.uint8[x+6]=_,this.uint8[x+7]=w,this.float32[A+2]=S,t}}hf.prototype.bytesPerElement=12,gi(hf,"StructArrayLayout2i4ub1f12");class kl extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c){const m=this.length;return this.resize(m+1),this.emplace(m,t,s,c)}emplace(t,s,c,m){const h=3*t;return this.float32[h+0]=s,this.float32[h+1]=c,this.float32[h+2]=m,t}}kl.prototype.bytesPerElement=12,gi(kl,"StructArrayLayout3f12");class ho extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,m,h){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,c,m,h)}emplace(t,s,c,m,h,_){const w=6*t,S=3*t;return this.uint16[w+0]=s,this.uint16[w+1]=c,this.uint16[w+2]=m,this.uint16[w+3]=h,this.float32[S+2]=_,t}}ho.prototype.bytesPerElement=12,gi(ho,"StructArrayLayout4ui1f12");class em extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,m){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,c,m)}emplace(t,s,c,m,h){const _=4*t;return this.uint16[_+0]=s,this.uint16[_+1]=c,this.uint16[_+2]=m,this.uint16[_+3]=h,t}}em.prototype.bytesPerElement=8,gi(em,"StructArrayLayout4ui8");class df extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,m,h,_){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,c,m,h,_)}emplace(t,s,c,m,h,_,w){const S=6*t;return this.int16[S+0]=s,this.int16[S+1]=c,this.int16[S+2]=m,this.int16[S+3]=h,this.int16[S+4]=_,this.int16[S+5]=w,t}}df.prototype.bytesPerElement=12,gi(df,"StructArrayLayout6i12");class xg extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,m,h,_,w,S,P,x,A,I){const E=this.length;return this.resize(E+1),this.emplace(E,t,s,c,m,h,_,w,S,P,x,A,I)}emplace(t,s,c,m,h,_,w,S,P,x,A,I,E){const C=12*t;return this.int16[C+0]=s,this.int16[C+1]=c,this.int16[C+2]=m,this.int16[C+3]=h,this.uint16[C+4]=_,this.uint16[C+5]=w,this.uint16[C+6]=S,this.uint16[C+7]=P,this.int16[C+8]=x,this.int16[C+9]=A,this.int16[C+10]=I,this.int16[C+11]=E,t}}xg.prototype.bytesPerElement=24,gi(xg,"StructArrayLayout4i4ui4i24");class bg extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,m,h,_){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,c,m,h,_)}emplace(t,s,c,m,h,_,w){const S=10*t,P=5*t;return this.int16[S+0]=s,this.int16[S+1]=c,this.int16[S+2]=m,this.float32[P+2]=h,this.float32[P+3]=_,this.float32[P+4]=w,t}}bg.prototype.bytesPerElement=20,gi(bg,"StructArrayLayout3i3f20");class Iu extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,m){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,c,m)}emplace(t,s,c,m,h){const _=4*t;return this.float32[_+0]=s,this.float32[_+1]=c,this.float32[_+2]=m,this.float32[_+3]=h,t}}Iu.prototype.bytesPerElement=16,gi(Iu,"StructArrayLayout4f16");class wg extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}wg.prototype.bytesPerElement=4,gi(wg,"StructArrayLayout1ul4");class qc extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const m=2*t;return this.uint16[m+0]=s,this.uint16[m+1]=c,t}}qc.prototype.bytesPerElement=4,gi(qc,"StructArrayLayout2ui4");class Tg extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,m,h,_,w,S,P,x,A,I,E){const C=this.length;return this.resize(C+1),this.emplace(C,t,s,c,m,h,_,w,S,P,x,A,I,E)}emplace(t,s,c,m,h,_,w,S,P,x,A,I,E,C){const R=20*t,z=10*t;return this.int16[R+0]=s,this.int16[R+1]=c,this.int16[R+2]=m,this.int16[R+3]=h,this.int16[R+4]=_,this.float32[z+3]=w,this.float32[z+4]=S,this.float32[z+5]=P,this.float32[z+6]=x,this.int16[R+14]=A,this.uint32[z+8]=I,this.uint16[R+18]=E,this.uint16[R+19]=C,t}}Tg.prototype.bytesPerElement=40,gi(Tg,"StructArrayLayout5i4f1i1ul2ui40");class tm extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,m,h,_,w){const S=this.length;return this.resize(S+1),this.emplace(S,t,s,c,m,h,_,w)}emplace(t,s,c,m,h,_,w,S){const P=8*t;return this.int16[P+0]=s,this.int16[P+1]=c,this.int16[P+2]=m,this.int16[P+4]=h,this.int16[P+5]=_,this.int16[P+6]=w,this.int16[P+7]=S,t}}tm.prototype.bytesPerElement=16,gi(tm,"StructArrayLayout3i2i2i16");class Eg extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,c,m,h){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,c,m,h)}emplace(t,s,c,m,h,_){const w=4*t,S=8*t;return this.float32[w+0]=s,this.float32[w+1]=c,this.float32[w+2]=m,this.int16[S+6]=h,this.int16[S+7]=_,t}}Eg.prototype.bytesPerElement=16,gi(Eg,"StructArrayLayout2f1f2i16");class Sg extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,m,h,_){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,c,m,h,_)}emplace(t,s,c,m,h,_,w){const S=20*t,P=5*t;return this.uint8[S+0]=s,this.uint8[S+1]=c,this.float32[P+1]=m,this.float32[P+2]=h,this.float32[P+3]=_,this.float32[P+4]=w,t}}Sg.prototype.bytesPerElement=20,gi(Sg,"StructArrayLayout2ub4f20");class Xs extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c){const m=this.length;return this.resize(m+1),this.emplace(m,t,s,c)}emplace(t,s,c,m){const h=3*t;return this.uint16[h+0]=s,this.uint16[h+1]=c,this.uint16[h+2]=m,t}}Xs.prototype.bytesPerElement=6,gi(Xs,"StructArrayLayout3ui6");class Ag extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,s,c,m,h,_,w,S,P,x,A,I,E,C,R,z,V,W,Y,$,J){const ie=this.length;return this.resize(ie+1),this.emplace(ie,t,s,c,m,h,_,w,S,P,x,A,I,E,C,R,z,V,W,Y,$,J)}emplace(t,s,c,m,h,_,w,S,P,x,A,I,E,C,R,z,V,W,Y,$,J,ie){const ge=30*t,Pe=15*t,Me=60*t;return this.int16[ge+0]=s,this.int16[ge+1]=c,this.int16[ge+2]=m,this.float32[Pe+2]=h,this.float32[Pe+3]=_,this.uint16[ge+8]=w,this.uint16[ge+9]=S,this.uint32[Pe+5]=P,this.uint32[Pe+6]=x,this.uint32[Pe+7]=A,this.uint16[ge+16]=I,this.uint16[ge+17]=E,this.uint16[ge+18]=C,this.float32[Pe+10]=R,this.float32[Pe+11]=z,this.uint8[Me+48]=V,this.uint8[Me+49]=W,this.uint8[Me+50]=Y,this.uint32[Pe+13]=$,this.int16[ge+28]=J,this.uint8[Me+58]=ie,t}}Ag.prototype.bytesPerElement=60,gi(Ag,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Cg extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,s,c,m,h,_,w,S,P,x,A,I,E,C,R,z,V,W,Y,$,J,ie,ge,Pe,Me,Ce,$e,Re,He,Je,Xe,tt){const at=this.length;return this.resize(at+1),this.emplace(at,t,s,c,m,h,_,w,S,P,x,A,I,E,C,R,z,V,W,Y,$,J,ie,ge,Pe,Me,Ce,$e,Re,He,Je,Xe,tt)}emplace(t,s,c,m,h,_,w,S,P,x,A,I,E,C,R,z,V,W,Y,$,J,ie,ge,Pe,Me,Ce,$e,Re,He,Je,Xe,tt,at){const ft=20*t,nt=40*t,Mt=80*t;return this.float32[ft+0]=s,this.float32[ft+1]=c,this.int16[nt+4]=m,this.int16[nt+5]=h,this.int16[nt+6]=_,this.int16[nt+7]=w,this.int16[nt+8]=S,this.int16[nt+9]=P,this.int16[nt+10]=x,this.int16[nt+11]=A,this.int16[nt+12]=I,this.uint16[nt+13]=E,this.uint16[nt+14]=C,this.uint16[nt+15]=R,this.uint16[nt+16]=z,this.uint16[nt+17]=V,this.uint16[nt+18]=W,this.uint16[nt+19]=Y,this.uint16[nt+20]=$,this.uint16[nt+21]=J,this.uint16[nt+22]=ie,this.uint16[nt+23]=ge,this.uint16[nt+24]=Pe,this.uint16[nt+25]=Me,this.uint16[nt+26]=Ce,this.uint16[nt+27]=$e,this.uint32[ft+14]=Re,this.float32[ft+15]=He,this.float32[ft+16]=Je,this.float32[ft+17]=Xe,this.float32[ft+18]=tt,this.uint8[Mt+76]=at,t}}Cg.prototype.bytesPerElement=80,gi(Cg,"StructArrayLayout2f9i15ui1ul4f1ub80");class ff extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}ff.prototype.bytesPerElement=4,gi(ff,"StructArrayLayout1f4");class Hc extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,m,h){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,c,m,h)}emplace(t,s,c,m,h,_){const w=5*t;return this.float32[w+0]=s,this.float32[w+1]=c,this.float32[w+2]=m,this.float32[w+3]=h,this.float32[w+4]=_,t}}Hc.prototype.bytesPerElement=20,gi(Hc,"StructArrayLayout5f20");class im extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,m,h,_,w){const S=this.length;return this.resize(S+1),this.emplace(S,t,s,c,m,h,_,w)}emplace(t,s,c,m,h,_,w,S){const P=7*t;return this.float32[P+0]=s,this.float32[P+1]=c,this.float32[P+2]=m,this.float32[P+3]=h,this.float32[P+4]=_,this.float32[P+5]=w,this.float32[P+6]=S,t}}im.prototype.bytesPerElement=28,gi(im,"StructArrayLayout7f28");class zl extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,m,h,_,w,S,P,x,A){const I=this.length;return this.resize(I+1),this.emplace(I,t,s,c,m,h,_,w,S,P,x,A)}emplace(t,s,c,m,h,_,w,S,P,x,A,I){const E=11*t;return this.float32[E+0]=s,this.float32[E+1]=c,this.float32[E+2]=m,this.float32[E+3]=h,this.float32[E+4]=_,this.float32[E+5]=w,this.float32[E+6]=S,this.float32[E+7]=P,this.float32[E+8]=x,this.float32[E+9]=A,this.float32[E+10]=I,t}}zl.prototype.bytesPerElement=44,gi(zl,"StructArrayLayout11f44");class rm extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,m,h,_,w,S,P){const x=this.length;return this.resize(x+1),this.emplace(x,t,s,c,m,h,_,w,S,P)}emplace(t,s,c,m,h,_,w,S,P,x){const A=9*t;return this.float32[A+0]=s,this.float32[A+1]=c,this.float32[A+2]=m,this.float32[A+3]=h,this.float32[A+4]=_,this.float32[A+5]=w,this.float32[A+6]=S,this.float32[A+7]=P,this.float32[A+8]=x,t}}rm.prototype.bytesPerElement=36,gi(rm,"StructArrayLayout9f36");class Dh extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,s)}emplace(t,s,c){const m=2*t;return this.float32[m+0]=s,this.float32[m+1]=c,t}}Dh.prototype.bytesPerElement=8,gi(Dh,"StructArrayLayout2f8");class Mg extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,c,m){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,c,m)}emplace(t,s,c,m,h){const _=6*t;return this.uint32[3*t+0]=s,this.uint16[_+2]=c,this.uint16[_+3]=m,this.uint16[_+4]=h,t}}Mg.prototype.bytesPerElement=12,gi(Mg,"StructArrayLayout1ul3ui12");class Ig extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}Ig.prototype.bytesPerElement=2,gi(Ig,"StructArrayLayout1ui2");class pf extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,m,h,_,w,S,P,x,A,I,E,C,R,z){const V=this.length;return this.resize(V+1),this.emplace(V,t,s,c,m,h,_,w,S,P,x,A,I,E,C,R,z)}emplace(t,s,c,m,h,_,w,S,P,x,A,I,E,C,R,z,V){const W=16*t;return this.float32[W+0]=s,this.float32[W+1]=c,this.float32[W+2]=m,this.float32[W+3]=h,this.float32[W+4]=_,this.float32[W+5]=w,this.float32[W+6]=S,this.float32[W+7]=P,this.float32[W+8]=x,this.float32[W+9]=A,this.float32[W+10]=I,this.float32[W+11]=E,this.float32[W+12]=C,this.float32[W+13]=R,this.float32[W+14]=z,this.float32[W+15]=V,t}}pf.prototype.bytesPerElement=64,gi(pf,"StructArrayLayout16f64");class mf extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,c,m,h,_,w){const S=this.length;return this.resize(S+1),this.emplace(S,t,s,c,m,h,_,w)}emplace(t,s,c,m,h,_,w,S){const P=10*t,x=5*t;return this.uint16[P+0]=s,this.uint16[P+1]=c,this.uint16[P+2]=m,this.uint16[P+3]=h,this.float32[x+2]=_,this.float32[x+3]=w,this.float32[x+4]=S,t}}mf.prototype.bytesPerElement=20,gi(mf,"StructArrayLayout4ui3f20");class Pg extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.int16[1*t+0]=s,t}}Pg.prototype.bytesPerElement=2,gi(Pg,"StructArrayLayout1i2");class nm extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint8[1*t+0]=s,t}}nm.prototype.bytesPerElement=1,gi(nm,"StructArrayLayout1ub1");class g1 extends uf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}g1.prototype.size=40;class Rg extends Tg{get(t){return new g1(this,t)}}gi(Rg,"CollisionBoxArray");class _f extends uf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}_f.prototype.size=60;class y1 extends Ag{get(t){return new _f(this,t)}}gi(y1,"PlacedSymbolArray");class v1 extends uf{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}v1.prototype.size=80;class x1 extends Cg{get(t){return new v1(this,t)}}gi(x1,"SymbolInstanceArray");class b1 extends ff{getoffsetX(t){return this.float32[1*t+0]}}gi(b1,"GlyphOffsetArray");class w1 extends mc{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}gi(w1,"SymbolLineVertexArray");class gf extends uf{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}gf.prototype.size=12;class yf extends Mg{get(t){return new gf(this,t)}}gi(yf,"FeatureIndexArray");class jo extends qc{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}gi(jo,"FillExtrusionCentroidArray");class vf extends uf{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}vf.prototype.size=6;class T1 extends Rh{get(t){return new vf(this,t)}}gi(T1,"FillExtrusionWallArray");const xw=qr([{name:"a_pos",components:2,type:"Int16"}],4),bw=qr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ts{constructor(t=[]){this.segments=t}_prepareSegment(t,s,c,m){let h=this.segments[this.segments.length-1];return t>ts.MAX_VERTEX_ARRAY_LENGTH&&Vi(`Max vertices per segment is ${ts.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!h||h.vertexLength+t>ts.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==m)&&(h={vertexOffset:s,primitiveOffset:c,vertexLength:0,primitiveLength:0},m!==void 0&&(h.sortKey=m),this.segments.push(h)),h}prepareSegment(t,s,c,m){return this._prepareSegment(t,s.length,c.length,m)}get(){return this.segments}destroy(){for(const t of this.segments)for(const s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,c,m){return new ts([{vertexOffset:t,primitiveOffset:s,vertexLength:c,primitiveLength:m,vaos:{},sortKey:0}])}}function sm(l,t){return 256*(l=Ut(Math.floor(l),0,255))+Ut(Math.floor(t),0,255)}ts.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,gi(ts,"SegmentVector");const ww=qr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Dg=qr([{name:"a_dash",components:4,type:"Uint16"}]);class xf{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,s,c,m){this.ids.push(E1(t)),this.positions.push(s,c,m)}eachPosition(t,s){const c=E1(t);let m=0,h=this.ids.length-1;for(;m<h;){const _=m+h>>1;this.ids[_]>=c?h=_:m=_+1}for(;this.ids[m]===c;)s(this.positions[3*m],this.positions[3*m+1],this.positions[3*m+2]),m++}static serialize(t,s){const c=new Float64Array(t.ids),m=new Uint32Array(t.positions);return bf(c,m,0,c.length-1),s&&(s.add(c.buffer),s.add(m.buffer)),{ids:c,positions:m}}static deserialize(t){const s=new xf;let c;s.ids=t.ids,s.positions=t.positions;for(const m of s.ids)m!==c&&s.uniqueIds.push(m),c=m;return s.indexed=!0,s}}function E1(l){const t=+l;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Do(String(l))}function bf(l,t,s,c){for(;s<c;){const m=l[s+c>>1];let h=s-1,_=c+1;for(;;){do h++;while(l[h]<m);do _--;while(l[_]>m);if(h>=_)break;om(l,h,_),om(t,3*h,3*_),om(t,3*h+1,3*_+1),om(t,3*h+2,3*_+2)}_-s<c-_?(bf(l,t,s,_),s=_+1):(bf(l,t,_+1,c),c=_)}}function om(l,t,s){const c=l[t];l[t]=l[s],l[s]=c}gi(xf,"FeaturePositionMap");class Fl{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,s),this.initialized=!0),!!this.location}set(t,s,c){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class wf extends Fl{constructor(t){super(t),this.current=0}set(t,s,c){this.fetchUniformLocation(t,s)&&this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}}class ss extends Fl{constructor(t){super(t),this.current=0}set(t,s,c){this.fetchUniformLocation(t,s)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class Da extends Fl{constructor(t){super(t),this.current=[0,0]}set(t,s,c){this.fetchUniformLocation(t,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1])))}}class Oh extends Fl{constructor(t){super(t),this.current=[0,0,0]}set(t,s,c){this.fetchUniformLocation(t,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2])))}}class Tf extends Fl{constructor(t){super(t),this.current=[0,0,0,0]}set(t,s,c){this.fetchUniformLocation(t,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class S1 extends Fl{constructor(t){super(t),this.current=zr.transparent.toRenderColor(null)}set(t,s,c){this.fetchUniformLocation(t,s)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const A1=new Float32Array(16);class Ef extends Fl{constructor(t){super(t),this.current=A1}set(t,s,c){if(this.fetchUniformLocation(t,s)){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let m=1;m<16;m++)if(c[m]!==this.current[m]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}}}const Og=new Float32Array(9),Tw=new Float32Array(4);class Lg extends Fl{constructor(t){super(t),this.current=Tw}set(t,s,c){if(this.fetchUniformLocation(t,s)){for(let m=0;m<4;m++)if(c[m]!==this.current[m]){this.current=c,this.gl.uniformMatrix2fv(this.location,!1,c);break}}}}function kg(l){return[sm(255*l.r,255*l.g),sm(255*l.b,255*l.a)]}class Pu{constructor(t,s,c,m){this.value=t,this.uniformNames=s.map(h=>`u_${h}`),this.type=c,this.context=m}setUniform(t,s,c,m,h){const _=m.constantOr(this.value);s.set(t,h,_ instanceof zr?_.toRenderColor(this.ignoreLut?null:this.context.lut):_)}getBinding(t,s){return this.type==="color"?new S1(t):new ss(t)}}class Ru{constructor(t,s){this.uniformNames=s.map(c=>`u_${c}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,s,c,m,h){const _=h==="u_pattern"||h==="u_dash"?this.pattern:h==="u_pixel_ratio"?this.pixelRatio:null;_&&s.set(t,h,_)}getBinding(t,s){return s==="u_pattern"||s==="u_dash"?new Tf(t):new ss(t)}}class gc{constructor(t,s,c,m){this.expression=t,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(h=>({name:`a_${h}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(t,s,c,m,h,_,w){const S=this.paintVertexArray.length,P=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new bn(0,{brightness:_}),s,{},h,m,w):this.expression.kind==="constant"&&this.expression.value;!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate(new bn(0,{brightness:_}),s,{},h,m,w)==="none"),this.paintVertexArray.resize(t),this._setPaintValue(S,t,P,this.context)}updatePaintArray(t,s,c,m,h,_,w){const S=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:w},c,m,void 0,h):this.expression.kind==="constant"&&this.expression.value;!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate({zoom:0,brightness:w},c,m,void 0,h)==="none"),this._setPaintValue(t,s,S,this.context)}_setPaintValue(t,s,c,m){if(this.type==="color"){const h=kg(c.toRenderColor(this.ignoreLut?null:m.lut));for(let _=t;_<s;_++)this.paintVertexArray.emplace(_,h[0],h[1])}else{for(let h=t;h<s;h++)this.paintVertexArray.emplace(h,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class rl{constructor(t,s,c,m,h,_){this.expression=t,this.uniformNames=s.map(w=>`u_${w}_t`),this.type=c,this.useIntegerZoom=m,this.context=h,this.maxValue=0,this.paintVertexAttributes=s.map(w=>({name:`a_${w}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(t,s,c,m,h,_,w){const S=this.expression.evaluate(new bn(this.context.zoom,{brightness:_}),s,{},h,m,w),P=this.expression.evaluate(new bn(this.context.zoom+1,{brightness:_}),s,{},h,m,w);!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate(new bn(this.context.zoom,{brightness:_}),s,{},h,m,w)==="none");const x=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(x,t,S,P,this.context)}updatePaintArray(t,s,c,m,h,_,w){const S=this.expression.evaluate({zoom:this.context.zoom,brightness:w},c,m,void 0,h),P=this.expression.evaluate({zoom:this.context.zoom+1,brightness:w},c,m,void 0,h);!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate({zoom:this.context.zoom,brightness:w},c,m,void 0,h)==="none"),this._setPaintValue(t,s,S,P,this.context)}_setPaintValue(t,s,c,m,h){if(this.type==="color"){const _=kg(c.toRenderColor(this.ignoreLut?null:h.lut)),w=kg(c.toRenderColor(this.ignoreLut?null:h.lut));for(let S=t;S<s;S++)this.paintVertexArray.emplace(S,_[0],_[1],w[0],w[1])}else{for(let _=t;_<s;_++)this.paintVertexArray.emplace(_,c,m);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(m))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s,c,m,h){const _=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,w=Ut(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);s.set(t,h,w)}getBinding(t,s){return new ss(t)}}class Gc{constructor(t,s,c,m,h){this.expression=t,this.layerId=h,this.paintVertexAttributes=(c==="array"?Dg:ww).members;for(let _=0;_<s.length;++_);this.paintVertexArray=new m}populatePaintArray(t,s,c,m){const h=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(h,t,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(t,s,c,m,h,_,w){this._setPaintValues(t,s,c.patterns&&c.patterns[this.layerId],_)}_setPaintValues(t,s,c,m){if(!m||!c)return;const h=m[c];if(!h)return;const{tl:_,br:w,pixelRatio:S}=h;for(let P=t;P<s;P++)this.paintVertexArray.emplace(P,_[0],_[1],w[0],w[1],S)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Du{constructor(t,s,c=()=>!0){this.binders={},this._buffers=[],this.context=s;const m=[];for(const h in t.paint._values){const _=t.paint.get(h),w=t.paint.get(`${h}-use-theme`);if(h.endsWith("-use-theme")||!c(h)||!(_ instanceof Ch&&ef(_.property.specification)))continue;const S=Sw(h,t.type),P=_.value,x=_.property.specification.type,A=!!_.property.useIntegerZoom,I=h==="line-dasharray"||h.endsWith("pattern"),E=h==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant"||w&&w.value.kind!=="constant";if(P.kind!=="constant"||E)if(P.kind==="source"||E||I){const C=C1(h,x,"source");this.binders[h]=I?new Gc(P,S,x,C,t.id):new gc(P,S,x,C),m.push(`/a_${h}`)}else{const C=C1(h,x,"composite");this.binders[h]=new rl(P,S,x,A,s,C),m.push(`/z_${h}`)}else this.binders[h]=I?new Ru(P.value,S):new Pu(P.value,S,x,s),m.push(`/u_${h}`);w&&(this.binders[h].ignoreLut=w.constantOr("default")==="none",this.binders[h].lutExpression=w.value,this.binders[h].checkUseTheme=!0)}this.cacheKey=m.sort().join("")}getMaxValue(t){const s=this.binders[t];return s instanceof gc||s instanceof rl?s.maxValue:0}populatePaintArrays(t,s,c,m,h,_,w){for(const S in this.binders){const P=this.binders[S];P.context=this.context,P instanceof gc||P instanceof rl||P instanceof Gc?P.populatePaintArray(t,s,c,m,h,_,w):P.lutExpression&&P instanceof Pu&&P.lutExpression&&(P.lutExpression.kind==="composite"||P.lutExpression.kind==="source")&&(P.ignoreLut=P.lutExpression.evaluate(new bn(0,{brightness:_}),s,{},h,m,w)==="none")}}setConstantPatternPositions(t){for(const s in this.binders){const c=this.binders[s];c instanceof Ru&&c.setConstantPatternPositions(t)}}updatePaintArrays(t,s,c,m,h,_,w,S,P){let x=!1;const A=Object.keys(t),I=A.length!==0&&!S,E=I?A:s.uniqueIds;this.context.lut=h.lut;for(const C in this.binders){const R=this.binders[C];if(R.context=this.context,(R instanceof gc||R instanceof rl||R instanceof Gc)&&R.expression&&R.expression.kind&&R.expression.kind!=="constant"&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){const z=h.paint.get(C);R.expression=z.value;for(const V of E){const W=t[V.toString()];s.eachPosition(V,(Y,$,J)=>{const ie=m.feature(Y);R.updatePaintArray($,J,ie,W,_,w,P)})}if(!I)for(const V of c.uniqueIds){const W=t[V.toString()];c.eachPosition(V,(Y,$,J)=>{const ie=m.feature(Y);R.updatePaintArray($,J,ie,W,_,w,P)})}x=!0}}return x}defines(){const t=[];for(const s in this.binders){const c=this.binders[s];(c instanceof Pu||c instanceof Ru)&&t.push(...c.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return t}getBinderAttributes(){const t=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof gc||c instanceof rl||c instanceof Gc)for(let m=0;m<c.paintVertexAttributes.length;m++)t.push(c.paintVertexAttributes[m].name)}return t}getBinderUniforms(){const t=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Pu||c instanceof Ru||c instanceof rl)for(const m of c.uniformNames)t.push(m)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const s=[];for(const c in this.binders){const m=this.binders[c];if(m instanceof Pu||m instanceof Ru||m instanceof rl)for(const h of m.uniformNames)s.push({name:h,property:c,binding:m.getBinding(t,h)})}return s}setUniforms(t,s,c,m,h){for(const{name:_,property:w,binding:S}of c){if(this.binders[w].checkUseTheme&&this.binders[w]instanceof Pu){const P=m.get(`${w}-use-theme`);P.isConstant()&&(this.binders[w].ignoreLut=P.constantOr("default")==="none")}this.binders[w].setUniform(t,S,h,m.get(w),_)}}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const s=this.binders[t];(s instanceof gc||s instanceof rl||s instanceof Gc)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(t){for(const s in this.binders){const c=this.binders[s];(c instanceof gc||c instanceof rl||c instanceof Gc)&&c.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const s=this.binders[t];(s instanceof gc||s instanceof rl||s instanceof Gc)&&s.destroy()}}}class Wc{constructor(t,s,c=()=>!0){this.programConfigurations={};for(const m of t)this.programConfigurations[m.id]=new Du(m,s,c);this.needsUpload=!1,this._featureMap=new xf,this._featureMapWithoutIds=new xf,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,s,c,m,h,_,w,S){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(t,s,m,h,_,w,S);s.id!==void 0?this._featureMap.add(s.id,c,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,c,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,c,m,h,_,w){for(const S of c)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,s,S,m,h,_,w||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const Ew={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Sw(l,t){return Ew[l]||[l.replace(`${t}-`,"").replace(/-/g,"_")]}const Aw={"line-pattern":{source:ho,composite:ho},"fill-pattern":{source:ho,composite:ho},"fill-extrusion-pattern":{source:ho,composite:ho},"line-dasharray":{source:em,composite:em}},am={color:{source:Dh,composite:Iu},number:{source:ff,composite:Dh}};function C1(l,t,s){const c=Aw[l];return c&&c[s]||am[t][s]}gi(Pu,"ConstantBinder"),gi(Ru,"PatternConstantBinder"),gi(gc,"SourceExpressionBinder"),gi(Gc,"PatternCompositeBinder"),gi(rl,"CompositeExpressionBinder"),gi(Du,"ProgramConfiguration",{omit:["_buffers"]}),gi(Wc,"ProgramConfigurationSet");const So=ii/Math.PI/2,Lh=5,M1=6,I1=16383,kh=64,lm=[kh,32,16],ca=-So,ua=So;function zh(l,t,s,c=So){return s=Et(s),[l*Math.sin(s)*c,-t*c,l*Math.cos(s)*c]}function Ou(l,t,s){return zh(Math.cos(Et(l)),Math.sin(Et(l)),t,s)}const Lu=63710088e-1,zg=2*Math.PI*Lu;class Vr{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Vr(zi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const s=Math.PI/180,c=this.lat*s,m=t.lat*s,h=Math.sin(c)*Math.sin(m)+Math.cos(c)*Math.cos(m)*Math.cos((t.lng-this.lng)*s);return Lu*Math.acos(Math.min(h,1))}toBounds(t=0){const s=360*t/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new Zc({lng:this.lng-c,lat:this.lat-s},{lng:this.lng+c,lat:this.lat+s})}toEcef(t){return Ou(this.lat,this.lng,So+t*So/Lu)}static convert(t){if(t instanceof Vr)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Vr(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Vr(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Zc{constructor(t,s){if(t)if(s)this.setSouthWest(t).setNorthEast(s);else if(t.length===4){const c=t;this.setSouthWest([c[0],c[1]]).setNorthEast([c[2],c[3]])}else{const c=t;this.setSouthWest(c[0]).setNorthEast(c[1])}}setNorthEast(t){return this._ne=t instanceof Vr?new Vr(t.lng,t.lat):Vr.convert(t),this}setSouthWest(t){return this._sw=t instanceof Vr?new Vr(t.lng,t.lat):Vr.convert(t),this}extend(t){const s=this._sw,c=this._ne;let m,h;if(t instanceof Vr)m=t,h=t;else{if(!(t instanceof Zc))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Zc.convert(t)):this.extend(Vr.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(Vr.convert(t)):this;if(m=t._sw,h=t._ne,!m||!h)return this}return s||c?(s.lng=Math.min(m.lng,s.lng),s.lat=Math.min(m.lat,s.lat),c.lng=Math.max(h.lng,c.lng),c.lat=Math.max(h.lat,c.lat)):(this._sw=new Vr(m.lng,m.lat),this._ne=new Vr(h.lng,h.lat)),this}getCenter(){return new Vr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Vr(this.getWest(),this.getNorth())}getSouthEast(){return new Vr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:c}=Vr.convert(t);let m=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&m}static convert(t){if(t)return t instanceof Zc?t:new Zc(t)}}const Cw=0,Mw=25.5;function cm(l){return zg*Math.cos(l*Math.PI/180)}function Bl(l){return(180+l)/360}function nl(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function Ao(l,t){return l/cm(t)}function $o(l){return 360*l-180}function Ks(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function P1(l,t){return l*cm(Ks(t))}const is=85.051129;function Fg(l){return Math.cos(Et(Ut(l,-is,is)))}function Fh(l,t){const s=Ut(t,Cw,Mw),c=Math.pow(2,s);return Fg(l)*zg/(512*c)}function f(l){return 1/Math.cos(l*Math.PI/180)}function i(l,t=0){const s=Math.exp(Math.PI*(1-(l.y+t/ii)/(1<<l.z)*2));return 80150034*s/(s*s+1)/ii/(1<<l.z)}class a{constructor(t,s,c=0){this.x=+t,this.y=+s,this.z=+c}static fromLngLat(t,s=0){const c=Vr.convert(t);return new a(Bl(c.lng),nl(c.lat),Ao(s,c.lat))}toLngLat(){return new Vr($o(this.x),Ks(this.y))}toAltitude(){return P1(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/zg*f(Ks(this.y))}}function p(l,t,s,c,m,h,_,w,S){const P=(t+c)/2,x=(s+m)/2,A=new ve(P,x);w(A),function(I,E,C,R,z,V){const W=C-z,Y=R-V;return Math.abs((R-E)*W-(C-I)*Y)/Math.hypot(W,Y)}(A.x,A.y,h.x,h.y,_.x,_.y)>=S?(p(l,t,s,P,x,h,A,w,S),p(l,P,x,c,m,A,_,w,S)):l.push(_)}function g(l,t,s){let c=l[0],m=c.x,h=c.y;t(c);const _=[c];for(let w=1;w<l.length;w++){const S=l[w],{x:P,y:x}=S;t(S),p(_,m,h,P,x,c,S,t,s),m=P,h=x,c=S}return _}function b(l,t,s,c){if(c(t,s)){const m=t.add(s)._mult(.5);b(l,t,m,c),b(l,m,s,c)}else l.push(s)}function T(l,t){let s=l[0];const c=[s];for(let m=1;m<l.length;m++){const h=l[m];b(c,s,h,t),s=h}return c}const M=Math.pow(2,14)-1,O=-M-1;function L(l,t){const s=Math.round(l.x*t),c=Math.round(l.y*t);return l.x=Ut(s,O,M),l.y=Ut(c,O,M),(s<l.x||s>l.x+1||c<l.y||c>l.y+1)&&Vi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),l}function k(l,t,s){const c=l.loadGeometry(),m=l.extent,h=ii/m;if(t&&s&&s.projection.isReprojectedInTileSpace){const _=1<<t.z,{scale:w,x:S,y:P,projection:x}=s,A=I=>{const E=$o((t.x+I.x/m)/_),C=Ks((t.y+I.y/m)/_),R=x.project(E,C);I.x=(R.x*w-S)*m,I.y=(R.y*w-P)*m};for(let I=0;I<c.length;I++)if(l.type!==1)c[I]=g(c[I],A,1);else{const E=[];for(const C of c[I])C.x<0||C.x>=m||C.y<0||C.y>=m||(A(C),E.push(C));c[I]=E}}for(const _ of c)for(const w of _)L(w,h);return c}function U(l,t){return{type:l.type,id:l.id,properties:l.properties,geometry:t?k(l):[]}}function j(l,t,s,c,m){l.emplaceBack(2*t+(c+1)/2,2*s+(m+1)/2)}function Z(l,t,s){l.emplaceBack(t.x,t.y,t.z,s[0]*16384,s[1]*16384,s[2]*16384)}class ce{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new mc,this.indexArray=new Xs,this.segments=new ts,this.programConfigurations=new Wc(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}updateFootprints(t,s){}populate(t,s,c,m){const h=this.layers[0],_=[];let w=null;h.type==="circle"&&(w=h.layout.get("circle-sort-key"));for(const{feature:P,id:x,index:A,sourceLayerIndex:I}of t){const E=this.layers[0]._featureFilter.needGeometry,C=U(P,E);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),C,c))continue;const R=w?w.evaluate(C,{},c):void 0,z={id:x,properties:P.properties,type:P.type,sourceLayerIndex:I,index:A,geometry:E?C.geometry:k(P,c,m),patterns:{},sortKey:R};_.push(z)}w&&_.sort((P,x)=>P.sortKey-x.sortKey);let S=null;m.projection.name==="globe"&&(this.globeExtVertexArray=new df,S=m.projection);for(const P of _){const{geometry:x,index:A,sourceLayerIndex:I}=P,E=t[A].feature;this.addFeature(P,x,A,s.availableImages,c,S,s.brightness),s.featureIndex.insert(E,x,A,I,this.index)}}update(t,s,c,m,h,_,w){this.programConfigurations.updatePaintArrays(t,s,h,c,m,_,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,xw.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,bw.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,s,c,m,h,_,w){for(const S of s)for(const P of S){const x=P.x,A=P.y;if(x<0||x>=ii||A<0||A>=ii)continue;if(_){const C=_.projectTilePoint(x,A,h),R=_.upVector(h,x,A),z=this.globeExtVertexArray;Z(z,C,R),Z(z,C,R),Z(z,C,R),Z(z,C,R)}const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),E=I.vertexLength;j(this.layoutVertexArray,x,A,-1,-1),j(this.layoutVertexArray,x,A,1,-1),j(this.layoutVertexArray,x,A,1,1),j(this.layoutVertexArray,x,A,-1,1),this.indexArray.emplaceBack(E,E+1,E+2),this.indexArray.emplaceBack(E,E+2,E+3),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{},m,h,w)}}function te(l,t){for(let s=0;s<l.length;s++)if(Ne(t,l[s]))return!0;for(let s=0;s<t.length;s++)if(Ne(l,t[s]))return!0;return!!ke(l,t)}function _e(l,t,s){return!!Ne(l,t)||!!je(t,l,s)}function me(l,t){if(l.length===1)return Ue(t,l[0]);for(let s=0;s<t.length;s++){const c=t[s];for(let m=0;m<c.length;m++)if(Ne(l,c[m]))return!0}for(let s=0;s<l.length;s++)if(Ue(t,l[s]))return!0;for(let s=0;s<t.length;s++)if(ke(l,t[s]))return!0;return!1}function Se(l,t,s){if(l.length>1){if(ke(l,t))return!0;for(let c=0;c<t.length;c++)if(je(t[c],l,s))return!0}for(let c=0;c<l.length;c++)if(je(l[c],t,s))return!0;return!1}function ke(l,t){if(l.length===0||t.length===0)return!1;for(let s=0;s<l.length-1;s++){const c=l[s],m=l[s+1];for(let h=0;h<t.length-1;h++)if(Oe(c,m,t[h],t[h+1]))return!0}return!1}function Oe(l,t,s,c){return Zi(l,s,c)!==Zi(t,s,c)&&Zi(l,t,s)!==Zi(l,t,c)}function je(l,t,s){const c=s*s;if(t.length===1)return l.distSqr(t[0])<c;for(let m=1;m<t.length;m++)if(Ve(l,t[m-1],t[m])<c)return!0;return!1}function Ve(l,t,s){const c=t.distSqr(s);if(c===0)return l.distSqr(t);const m=((l.x-t.x)*(s.x-t.x)+(l.y-t.y)*(s.y-t.y))/c;return l.distSqr(m<0?t:m>1?s:s.sub(t)._mult(m)._add(t))}function Ue(l,t){let s,c,m,h=!1;for(let _=0;_<l.length;_++){s=l[_];for(let w=0,S=s.length-1;w<s.length;S=w++)c=s[w],m=s[S],c.y>t.y!=m.y>t.y&&t.x<(m.x-c.x)*(t.y-c.y)/(m.y-c.y)+c.x&&(h=!h)}return h}function Ne(l,t){let s=!1;for(let c=0,m=l.length-1;c<l.length;m=c++){const h=l[c],_=l[m];h.y>t.y!=_.y>t.y&&t.x<(_.x-h.x)*(t.y-h.y)/(_.y-h.y)+h.x&&(s=!s)}return s}function Ye(l,t,s,c,m){for(const _ of l)if(t<=_.x&&s<=_.y&&c>=_.x&&m>=_.y)return!0;const h=[new ve(t,s),new ve(t,m),new ve(c,m),new ve(c,s)];if(l.length>2){for(const _ of h)if(Ne(l,_))return!0}for(let _=0;_<l.length-1;_++)if(it(l[_],l[_+1],h))return!0;return!1}function it(l,t,s){const c=s[0],m=s[2];if(l.x<c.x&&t.x<c.x||l.x>m.x&&t.x>m.x||l.y<c.y&&t.y<c.y||l.y>m.y&&t.y>m.y)return!1;const h=Zi(l,t,s[0]);return h!==Zi(l,t,s[1])||h!==Zi(l,t,s[2])||h!==Zi(l,t,s[3])}function xt(l,t,s,c,m,h){let _=t.y-l.y,w=l.x-t.x;if(h=h||0){const S=_*_+w*w;if(S===0)return!0;const P=Math.sqrt(S);_/=P,w/=P}return!((s.x-l.x)*_+(s.y-l.y)*w-h<0||(c.x-l.x)*_+(c.y-l.y)*w-h<0||(m.x-l.x)*_+(m.y-l.y)*w-h<0)}function _t(l,t,s,c,m,h,_){return!(xt(l,t,c,m,h,_)||xt(t,s,c,m,h,_)||xt(s,l,c,m,h,_)||xt(c,m,l,t,s,_)||xt(m,h,l,t,s,_)||xt(h,c,l,t,s,_))}function Rt(l,t,s){const c=t.paint.get(l).value;return c.kind==="constant"?c.value:s.programConfigurations.get(t.id).getMaxValue(l)}function Pt(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function ht(l,t,s,c,m){if(!t[0]&&!t[1])return l;const h=ve.convert(t)._mult(m);s==="viewport"&&h._rotate(-c);const _=[];for(let w=0;w<l.length;w++)_.push(l[w].sub(h));return _}function bt(l,t,s,c){const m=ve.convert(l)._mult(c);return t==="viewport"&&m._rotate(-s),m}let Vt,ut;gi(ce,"CircleBucket",{omit:["layers"]});var Ot,wt={exports:{}},Qt=(Ot||(Ot=1,function(l,t){(function(s){function c(h,_,w){var S=m(256*h,256*(_=Math.pow(2,w)-_-1),w),P=m(256*(h+1),256*(_+1),w);return S[0]+","+S[1]+","+P[0]+","+P[1]}function m(h,_,w){var S=2*Math.PI*6378137/256/Math.pow(2,w);return[h*S-2*Math.PI*6378137/2,_*S-2*Math.PI*6378137/2]}s.getURL=function(h,_,w,S,P,x){return x=x||{},h+"?"+["bbox="+c(w,S,P),"format="+(x.format||"image/png"),"service="+(x.service||"WMS"),"version="+(x.version||"1.1.1"),"request="+(x.request||"GetMap"),"srs="+(x.srs||"EPSG:3857"),"width="+(x.width||256),"height="+(x.height||256),"layers="+_].join("&")},s.getTileBBox=c,s.getMercCoords=m,Object.defineProperty(s,"__esModule",{value:!0})})(t)}(0,wt.exports)),wt.exports);class kt{constructor(t,s,c){this.z=t,this.x=s,this.y=c,this.key=Jt(0,t,t,s,c)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,s){const c=Qt.getTileBBox(this.x,this.y,this.z),m=function(h,_,w){let S,P="";for(let x=h;x>0;x--)S=1<<x-1,P+=(_&S?1:0)+(w&S?2:0);return P}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",m).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Dt{constructor(t,s){this.wrap=t,this.canonical=s,this.key=Jt(t,s.z,s.z,s.x,s.y)}}class Gt{constructor(t,s,c,m,h){this.overscaledZ=t,this.wrap=s,this.canonical=new kt(c,+m,+h),this.key=s===0&&t===c?this.canonical.key:Jt(s,t,c,m,h)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const s=this.canonical.z-t;return t>this.canonical.z?new Gt(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Gt(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s=!0){if(this.overscaledZ===t&&s)return this.key;if(t>this.canonical.z)return Jt(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-t;return Jt(this.wrap*+s,t,t,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const s=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new Gt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=2*this.canonical.x,m=2*this.canonical.y;return[new Gt(s,this.wrap,s,c,m),new Gt(s,this.wrap,s,c+1,m),new Gt(s,this.wrap,s,c,m+1),new Gt(s,this.wrap,s,c+1,m+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Gt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Gt(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Dt(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Jt(l,t,s,c,m){const h=1<<Math.min(s,22);let _=h*(m%h)+c%h;return l&&s<22&&(_+=h*h*((l<0?-2*l-1:2*l)%(1<<2*(22-s)))),16*(32*_+s)+(t-s)}const ci=[l=>{let t=l.canonical.x-1,s=l.wrap;return t<0&&(t=(1<<l.canonical.z)-1,s--),new Gt(l.overscaledZ,s,l.canonical.z,t,l.canonical.y)},l=>{let t=l.canonical.x+1,s=l.wrap;return t===1<<l.canonical.z&&(t=0,s++),new Gt(l.overscaledZ,s,l.canonical.z,t,l.canonical.y)},l=>new Gt(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,(l.canonical.y===0?1<<l.canonical.z:l.canonical.y)-1),l=>new Gt(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y===(1<<l.canonical.z)-1?0:l.canonical.y+1)];gi(kt,"CanonicalTileID"),gi(Gt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const _i=qr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:qi}=_i,Di=qr([{name:"a_pos_3",components:3,type:"Int16"}]);var Oi=qr([{name:"a_pos",type:"Int16",components:2}]);class er{constructor(t,s){this.pos=t,this.dir=s}intersectsPlane(t,s,c){const m=H.vec3.dot(s,this.dir);if(Math.abs(m)<1e-6)return!1;const h=((t[0]-this.pos[0])*s[0]+(t[1]-this.pos[1])*s[1]+(t[2]-this.pos[2])*s[2])/m;return c[0]=this.pos[0]+this.dir[0]*h,c[1]=this.pos[1]+this.dir[1]*h,c[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(t,s,c){if(H.vec3.equals(this.pos,t)||s===0)return c[0]=c[1]=c[2]=0,!1;const[m,h,_]=this.dir,w=this.pos[0]-t[0],S=this.pos[1]-t[1],P=this.pos[2]-t[2],x=m*m+h*h+_*_,A=2*(w*m+S*h+P*_),I=A*A-4*x*(w*w+S*S+P*P-s*s);if(I<0){const E=Math.max(-A/2,0),C=w+m*E,R=S+h*E,z=P+_*E,V=Math.hypot(C,R,z);return c[0]=C*s/V,c[1]=R*s/V,c[2]=z*s/V,!1}{const E=(-A-Math.sqrt(I))/(2*x);if(E<0){const C=Math.hypot(w,S,P);return c[0]=w*s/C,c[1]=S*s/C,c[2]=P*s/C,!1}return c[0]=w+m*E,c[1]=S+h*E,c[2]=P+_*E,!0}}}class Pr{constructor(t,s,c,m,h){this.TL=t,this.TR=s,this.BR=c,this.BL=m,this.horizon=h}static fromInvProjectionMatrix(t,s,c){const m=[-1,1,1],h=[1,1,1],_=[1,-1,1],w=[-1,-1,1],S=H.vec3.transformMat4(m,m,t),P=H.vec3.transformMat4(h,h,t),x=H.vec3.transformMat4(_,_,t),A=H.vec3.transformMat4(w,w,t);return new Pr(S,P,x,A,s/c)}}function Xr(l,t,s){let c=1/0,m=-1/0;const h=[];for(const _ of l){H.vec3.sub(h,_,t);const w=H.vec3.dot(h,s);c=Math.min(c,w),m=Math.max(m,w)}return[c,m]}function Hn(l,t){let s=!0;for(let c=0;c<l.planes.length;c++){const m=l.planes[c];let h=0;for(let _=0;_<t.length;_++)h+=H.vec3.dot(m,t[_])+m[3]>=0;if(h===0)return 0;h!==t.length&&(s=!1)}return s?2:1}function Tn(l,t){for(const s of l.projections){const c=Xr(t,l.points[0],s.axis);if(s.projection[1]<c[0]||s.projection[0]>c[1])return 0}return 1}function ar(l,t){let s=0;const c=[0,0,0,0];for(let m=0;m<l.length;m++)c[0]=l[m][0],c[1]=l[m][1],c[2]=l[m][2],c[3]=1,H.vec4.dot(c,t)>=0&&s++;return s}class Nr{constructor(t,s){this.points=t||new Array(8).fill([0,0,0]),this.planes=s||new Array(6).fill([0,0,0,0]),this.bounds=Ai.fromPoints(this.points),this.projections=[],this.frustumEdges=[H.vec3.sub([],this.points[2],this.points[3]),H.vec3.sub([],this.points[0],this.points[3]),H.vec3.sub([],this.points[4],this.points[0]),H.vec3.sub([],this.points[5],this.points[1]),H.vec3.sub([],this.points[6],this.points[2]),H.vec3.sub([],this.points[7],this.points[3])];for(const c of this.frustumEdges){const m=[0,-c[2],c[1]],h=[c[2],0,-c[0]];this.projections.push({axis:m,projection:Xr(this.points,this.points[0],m)}),this.projections.push({axis:h,projection:Xr(this.points,this.points[0],h)})}}static fromInvProjectionMatrix(t,s,c,m){const h=Math.pow(2,c),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const x=H.vec4.transformMat4([],P,t),A=1/x[3]/s*h;return H.vec4.mul(x,x,[A,A,m?1/x[3]:A,A])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const x=H.vec3.sub([],_[P[0]],_[P[1]]),A=H.vec3.sub([],_[P[2]],_[P[1]]),I=H.vec3.normalize([],H.vec3.cross([],x,A)),E=-H.vec3.dot(I,_[P[1]]);return I.concat(E)}),S=[];for(let P=0;P<_.length;P++)S.push([_[P][0],_[P][1],_[P][2]]);return new Nr(S,w)}intersectsPrecise(t,s,c){for(let m=0;m<s.length;m++)if(!ar(t,s[m]))return 0;for(let m=0;m<this.planes.length;m++)if(!ar(t,this.planes[m]))return 0;for(const m of c)for(const h of this.frustumEdges){const _=H.vec3.cross([],m,h),w=H.vec3.length(_);if(w===0)continue;H.vec3.scale(_,_,1/w);const S=Xr(this.points,this.points[0],_),P=Xr(t,this.points[0],_);if(S[0]>P[1]||P[0]>S[1])return 0}return 1}containsPoint(t){for(const s of this.planes){const c=s[3];if(H.vec3.dot([s[0],s[1],s[2]],t)+c<0)return!1}return!0}}class Ai{static fromPoints(t){const s=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const m of t)H.vec3.min(s,s,m),H.vec3.max(c,c,m);return new Ai(s,c)}static fromTileIdAndHeight(t,s,c){const m=1<<t.canonical.z,h=t.canonical.x,_=t.canonical.y;return new Ai([h/m,_/m,s],[(h+1)/m,(_+1)/m,c])}static applyTransform(t,s){const c=t.getCorners();for(let m=0;m<c.length;++m)H.vec3.transformMat4(c[m],c[m],s);return Ai.fromPoints(c)}static applyTransformFast(t,s){const c=[s[12],s[13],s[14]],m=[...c];for(let h=0;h<3;h++)for(let _=0;_<3;_++){const w=s[4*_+h],S=w*t.min[_],P=w*t.max[_];c[h]+=Math.min(S,P),m[h]+=Math.max(S,P)}return new Ai(c,m)}static projectAabbCorners(t,s){const c=t.getCorners();for(let m=0;m<c.length;++m)H.vec3.transformMat4(c[m],c[m],s);return c}constructor(t,s){this.min=t,this.max=s,this.center=H.vec3.scale([],H.vec3.add([],this.min,this.max),.5)}quadrant(t){const s=[t%2==0,t<2],c=H.vec3.clone(this.min),m=H.vec3.clone(this.max);for(let h=0;h<s.length;h++)c[h]=s[h]?this.min[h]:this.center[h],m[h]=s[h]?this.center[h]:this.max[h];return m[2]=this.max[2],new Ai(c,m)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,s=this.max;return[[t[0],t[1],t[2]],[s[0],t[1],t[2]],[s[0],s[1],t[2]],[t[0],s[1],t[2]],[t[0],t[1],s[2]],[s[0],t[1],s[2]],[s[0],s[1],s[2]],[t[0],s[1],s[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?Hn(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?Hn(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,s){return s||this.intersects(t)?Tn(t,this.getCorners()):0}intersectsPreciseFlat(t,s){return s||this.intersectsFlat(t)?Tn(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let s=0;s<3;++s)if(this.min[s]>t.max[s]||t.min[s]>this.max[s])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],t.min[s]),this.max[s]=Math.max(this.max[s],t.max[s])}encapsulatePoint(t){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],t[s]),this.max[s]=Math.max(this.max[s],t[s])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}function Mr(l){return l*So/Lu}gi(Ai,"Aabb");const jr=[new Ai([ca,ca,ca],[ua,ua,ua]),new Ai([ca,ca,ca],[0,0,ua]),new Ai([0,ca,ca],[ua,0,ua]),new Ai([ca,0,ca],[0,ua,ua]),new Ai([0,0,ca],[ua,ua,ua])];function Hr(l,t,s,c=!0){const m=H.vec3.scale([],l._camera.position,l.worldSize),h=[t,s,1,1];H.vec4.transformMat4(h,h,l.pixelMatrixInverse),H.vec4.scale(h,h,1/h[3]);const _=H.vec3.sub([],h,m),w=H.vec3.normalize([],_),S=l.globeMatrix,P=[S[12],S[13],S[14]],x=H.vec3.sub([],P,m),A=H.vec3.length(x),I=H.vec3.normalize([],x),E=l.worldSize/(2*Math.PI),C=H.vec3.dot(I,w),R=Math.asin(E/A);if(R<Math.acos(C)){if(!c)return null;const $e=[],Re=[];H.vec3.scale($e,w,A/C),H.vec3.normalize(Re,H.vec3.sub(Re,$e,x)),H.vec3.normalize(w,H.vec3.add(w,x,H.vec3.scale(w,Re,Math.tan(R)*A)))}const z=[];new er(m,w).closestPointOnSphere(P,E,z);const V=H.vec3.normalize([],Dn(S,0)),W=H.vec3.normalize([],Dn(S,1)),Y=H.vec3.normalize([],Dn(S,2)),$=H.vec3.dot(V,z),J=H.vec3.dot(W,z),ie=H.vec3.dot(Y,z),ge=It(Math.asin(-J/E));let Pe=It(Math.atan2($,ie));Pe=l.center.lng+function($e,Re){const He=(Re-$e+180)%360-180;return He<-180?He+360:He}(l.center.lng,Pe);const Me=Bl(Pe),Ce=Ut(nl(ge),0,1);return new a(Me,Ce)}class Nn{constructor(t,s,c){this.a=H.vec3.sub([],t,c),this.b=H.vec3.sub([],s,c),this.center=c;const m=H.vec3.normalize([],this.a),h=H.vec3.normalize([],this.b);this.angle=Math.acos(H.vec3.dot(m,h))}}function Ls(l,t){if(l.angle===0)return null;let s;return s=l.a[t]===0?1/l.angle*.5*Math.PI:1/l.angle*Math.atan(l.b[t]/l.a[t]/Math.sin(l.angle)-1/Math.tan(l.angle)),s<0||s>1?null:function(c,m,h,_){const w=Math.sin(h);return c*(Math.sin((1-_)*h)/w)+m*(Math.sin(_*h)/w)}(l.a[t],l.b[t],l.angle,Ut(s,0,1))+l.center[t]}function gs(l){if(l.z<=1)return jr[l.z+2*l.y+l.x];const t=pn(Vn(l));return Ai.fromPoints(t)}function ys(l,t,s){return H.vec3.scale(l,l,1-s),H.vec3.scaleAndAdd(l,l,t,s)}function ha(l,t,s){for(const c of l)H.vec3.transformMat4(c,c,t),H.vec3.scale(c,c,s)}function fo(l,t,s,c){const m=t/l.worldSize,h=l.globeMatrix;if(s.z<=1){const Me=gs(s).getCorners();return ha(Me,h,m),Ai.fromPoints(Me)}const _=Vn(s,c),w=pn(_,So+Mr(l._tileCoverLift));ha(w,h,m);const S=Number.MAX_VALUE,P=[-S,-S,-S],x=[S,S,S];if(_.contains(l.center)){for(const $e of w)H.vec3.min(x,x,$e),H.vec3.max(P,P,$e);P[2]=0;const Me=l.point,Ce=[Me.x*m,Me.y*m,0];return H.vec3.min(x,x,Ce),H.vec3.max(P,P,Ce),new Ai(x,P)}if(l._tileCoverLift>0){for(const Me of w)H.vec3.min(x,x,Me),H.vec3.max(P,P,Me);return new Ai(x,P)}const A=[h[12]*m,h[13]*m,h[14]*m],I=_.getCenter(),E=Ut(l.center.lat,-is,is),C=Ut(I.lat,-is,is),R=Bl(l.center.lng),z=nl(E);let V=R-Bl(I.lng);const W=z-nl(C);V>.5?V-=1:V<-.5&&(V+=1);let Y=0;if(Math.abs(V)>Math.abs(W))Y=V>=0?1:3;else{Y=W>=0?0:2;const Me=[h[4]*m,h[5]*m,h[6]*m],Ce=-Math.sin(Et(W>=0?_.getSouth():_.getNorth()))*So;H.vec3.scaleAndAdd(A,A,Me,Ce)}const $=w[Y],J=w[(Y+1)%4],ie=new Nn($,J,A),ge=[Ls(ie,0)||$[0],Ls(ie,1)||$[1],Ls(ie,2)||$[2]],Pe=Oo(l.zoom);if(Pe>0){const Me=function({x:$e,y:Re,z:He},Je,Xe,tt,at){const ft=1/(1<<He);let nt=$e*ft,Mt=nt+ft,Ft=Re*ft,Ct=Ft+ft,si=0;const ri=(nt+Mt)/2-tt;return ri>.5?si=-1:ri<-.5&&(si=1),nt=((nt+si)*Je-(tt*=Je))*Xe+tt,Mt=((Mt+si)*Je-tt)*Xe+tt,Ft=(Ft*Je-(at*=Je))*Xe+at,Ct=(Ct*Je-at)*Xe+at,[[nt,Ct,0],[Mt,Ct,0],[Mt,Ft,0],[nt,Ft,0]]}(s,t,l._pixelsPerMercatorPixel,R,z);for(let $e=0;$e<w.length;$e++)ys(w[$e],Me[$e],Pe);const Ce=H.vec3.add([],Me[Y],Me[(Y+1)%4]);H.vec3.scale(Ce,Ce,.5),ys(ge,Ce,Pe)}for(const Me of w)H.vec3.min(x,x,Me),H.vec3.max(P,P,Me);return x[2]=Math.min($[2],J[2]),H.vec3.min(x,x,ge),H.vec3.max(P,P,ge),new Ai(x,P)}function Vn({x:l,y:t,z:s},c=!1){const m=1/(1<<s),h=new Vr($o(l*m),t===(1<<s)-1&&c?-90:Ks((t+1)*m)),_=new Vr($o((l+1)*m),t===0&&c?90:Ks(t*m));return new Zc(h,_)}function pn(l,t=So){const s=Et(l.getNorth()),c=Et(l.getSouth()),m=Math.cos(s),h=Math.cos(c),_=Math.sin(s),w=Math.sin(c),S=l.getWest(),P=l.getEast();return[zh(h,w,S,t),zh(h,w,P,t),zh(m,_,P,t),zh(m,_,S,t)]}function on(l,t,s,c){const m=1<<s.z,h=(l/ii+s.x)/m;return Ou(Ks((t/ii+s.y)/m),$o(h),c)}function Or({min:l,max:t}){return I1/Math.max(t[0]-l[0],t[1]-l[1],t[2]-l[2])}const os=new Float64Array(16);function ks(l){const t=Or(l),s=H.mat4.fromScaling(os,[t,t,t]);return H.mat4.translate(s,s,H.vec3.negate([],l.min))}function ln(l){const t=H.mat4.fromTranslation(os,l.min),s=1/Or(l);return H.mat4.scale(t,t,[s,s,s])}function po(l){const t=ii/(2*Math.PI);return l/(2*Math.PI)/t}function Oa(l,t){return ii/(512*Math.pow(2,l))*Or(gs(t))}function qo(l,t,s,c,m){const h=po(s),_=[l,t,-s/(2*Math.PI)],w=H.mat4.identity(new Float64Array(16));return H.mat4.translate(w,w,_),H.mat4.scale(w,w,[h,h,h]),H.mat4.rotateX(w,w,Et(-m)),H.mat4.rotateY(w,w,Et(-c)),w}function Oo(l){return yi(Lh,M1,l)}function Nl(l,t){const s=Ou(t.lat,t.lng),c=function(h){const _=Ou(h._center.lat,h._center.lng),w=H.vec3.fromValues(0,1,0);let S=H.vec3.cross([],w,_);const P=H.mat4.fromRotation([],-h.angle,_);S=H.vec3.transformMat4(S,S,P),H.mat4.fromRotation(P,-h._pitch,S);const x=H.vec3.normalize([],_);return H.vec3.scale(x,x,Mr(h.cameraToCenterDistance/h.pixelsPerMeter)),H.vec3.transformMat4(x,x,P),H.vec3.add([],_,x)}(l),m=H.vec3.subtract([],c,s);return H.vec3.angle(m,s)}function La(l,t){return Nl(l,t)>Math.PI/2*1.01}const da=Et(85),ku=Math.cos(da),Vl=Math.sin(da),zu=H.mat4.create(),Bh=l=>{const t=[];return l.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function um(l,t,s,c,m,h,_,w,S){if(h&&l.queryGeometry.isAboveHorizon)return!1;h&&(S*=l.pixelToTileUnitsFactor);const P=l.tileID.canonical,x=s.projection.upVectorScale(P,s.center.lat,s.worldSize).metersToTile;for(const A of t)for(const I of A){const E=I.add(w),C=m&&s.elevation?s.elevation.exaggeration()*m.getElevationAt(E.x,E.y,!0):0,R=s.projection.projectTilePoint(E.x,E.y,P);if(C>0){const Y=s.projection.upVector(P,E.x,E.y);R.x+=Y[0]*x*C,R.y+=Y[1]*x*C,R.z+=Y[2]*x*C}const z=h?E:Bg(R.x,R.y,R.z,c),V=h?l.tilespaceRays.map(Y=>w4(Y,C)):l.queryGeometry.screenGeometry,W=H.vec4.transformMat4([],[R.x,R.y,R.z,1],c);if(!_&&h?S*=W[3]/s.cameraToCenterDistance:_&&!h&&(S*=s.cameraToCenterDistance/W[3]),h){const Y=Ks((I.y/ii+P.y)/(1<<P.z));S/=s.projection.pixelsPerMeter(Y,1)/Ao(1,Y)}if(_e(V,z,S))return!0}return!1}function Bg(l,t,s,c){const m=H.vec4.transformMat4([],[l,t,s,1],c);return new ve(m[0]/m[3],m[1]/m[3])}const UA=H.vec3.fromValues(0,0,0),b4=H.vec3.fromValues(0,0,1);function w4(l,t){const s=H.vec3.create();return UA[2]=t,l.intersectsPlane(UA,b4,s),new ve(s[0],s[1])}class jA extends ce{}let $A,qA,HA,GA;function WA(l,{width:t,height:s},c,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==t*s*c)throw new RangeError("mismatched image size")}else m=new Uint8Array(t*s*c);return l.width=t,l.height=s,l.data=m,l}function ZA(l,t,s){const{width:c,height:m}=t;c===l.width&&m===l.height||(Iw(l,t,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,c),height:Math.min(l.height,m)},s,null),l.width=c,l.height=m,l.data=t.data)}function Iw(l,t,s,c,m,h,_,w){if(m.width===0||m.height===0)return t;if(m.width>l.width||m.height>l.height||s.x>l.width-m.width||s.y>l.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>t.width||m.height>t.height||c.x>t.width-m.width||c.y>t.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const S=l.data,P=t.data,x=h===4&&w;for(let A=0;A<m.height;A++){const I=((s.y+A)*l.width+s.x)*h,E=((c.y+A)*t.width+c.x)*h;if(x)for(let C=0;C<m.width;C++){const R=I+C*h+3,z=E+C*h;P[z+0]=255,P[z+1]=255,P[z+2]=255,P[z+3]=S[R]}else if(_)for(let C=0;C<m.width;C++){const R=I+C*h,z=E+C*h,V=S[R+3],W=new zr(S[R+0]/255*V,S[R+1]/255*V,S[R+2]/255*V,V).toRenderColor(_).toArray();P[z+0]=W[0],P[z+1]=W[1],P[z+2]=W[2],P[z+3]=W[3]}else for(let C=0;C<m.width*h;C++)P[E+C]=S[I+C]}return t}gi(jA,"HeatmapBucket",{omit:["layers"]});class Nh{constructor(t,s){WA(this,t,1,s)}resize(t){ZA(this,new Nh(t),1)}clone(){return new Nh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,c,m,h){Iw(t,s,c,m,h,1,null)}}class ro{constructor(t,s){WA(this,t,4,s)}resize(t){ZA(this,new ro(t),4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new ro({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,c,m,h,_,w){Iw(t,s,c,m,h,4,_,w)}}class YA{constructor(t,s){this.width=t.width,this.height=t.height,this.data=s instanceof Uint8Array?new Float32Array(s.buffer):s}}function Ng(l){const t={},s=l.resolution||256,c=l.clips?l.clips.length:1,m=l.image||new ro({width:s,height:c}),h=(_,w,S)=>{t[l.evaluationKey]=S;const P=l.expression.evaluate(t);P&&(m.data[_+w+0]=Math.floor(255*P.r/P.a),m.data[_+w+1]=Math.floor(255*P.g/P.a),m.data[_+w+2]=Math.floor(255*P.b/P.a),m.data[_+w+3]=Math.floor(255*P.a))};if(l.clips)for(let _=0,w=0;_<c;++_,w+=4*s)for(let S=0,P=0;S<s;S++,P+=4){const x=S/(s-1),{start:A,end:I}=l.clips[_];h(w,P,A*(1-x)+I*x)}else for(let _=0,w=0;_<s;_++,w+=4)h(0,w,_/(s-1));return m}gi(Nh,"AlphaImage"),gi(ro,"RGBAImage");const T4=qr([{name:"a_pos",components:2,type:"Int16"}],4),{members:E4}=T4;function Vg(l,t,s=2){const c=t&&t.length,m=c?t[0]*s:l.length;let h=XA(l,0,m,s,!0);const _=[];if(!h||h.next===h.prev)return _;let w,S,P;if(c&&(h=function(x,A,I,E){const C=[];for(let R=0,z=A.length;R<z;R++){const V=XA(x,A[R]*E,R<z-1?A[R+1]*E:x.length,E,!1);V===V.next&&(V.steiner=!0),C.push(D4(V))}C.sort(I4);for(let R=0;R<C.length;R++)I=P4(C[R],I);return I}(l,t,h,s)),l.length>80*s){w=1/0,S=1/0;let x=-1/0,A=-1/0;for(let I=s;I<m;I+=s){const E=l[I],C=l[I+1];E<w&&(w=E),C<S&&(S=C),E>x&&(x=E),C>A&&(A=C)}P=Math.max(x-w,A-S),P=P!==0?32767/P:0}return Ug(h,_,s,w,S,P,0),_}function XA(l,t,s,c,m){let h;if(m===function(_,w,S,P){let x=0;for(let A=w,I=S-P;A<S;A+=P)x+=(_[I]-_[A])*(_[A+1]+_[I+1]),I=A;return x}(l,t,s,c)>0)for(let _=t;_<s;_+=c)h=QA(_/c|0,l[_],l[_+1],h);else for(let _=s-c;_>=t;_-=c)h=QA(_/c|0,l[_],l[_+1],h);return h&&R1(h,h.next)&&($g(h),h=h.next),h}function Sf(l,t){if(!l)return l;t||(t=l);let s,c=l;do if(s=!1,c.steiner||!R1(c,c.next)&&zs(c.prev,c,c.next)!==0)c=c.next;else{if($g(c),c=t=c.prev,c===c.next)break;s=!0}while(s||c!==t);return t}function Ug(l,t,s,c,m,h,_){if(!l)return;!_&&h&&function(S,P,x,A){let I=S;do I.z===0&&(I.z=Pw(I.x,I.y,P,x,A)),I.prevZ=I.prev,I.nextZ=I.next,I=I.next;while(I!==S);I.prevZ.nextZ=null,I.prevZ=null,function(E){let C,R=1;do{let z,V=E;E=null;let W=null;for(C=0;V;){C++;let Y=V,$=0;for(let ie=0;ie<R&&($++,Y=Y.nextZ,Y);ie++);let J=R;for(;$>0||J>0&&Y;)$!==0&&(J===0||!Y||V.z<=Y.z)?(z=V,V=V.nextZ,$--):(z=Y,Y=Y.nextZ,J--),W?W.nextZ=z:E=z,z.prevZ=W,W=z;V=Y}W.nextZ=null,R*=2}while(C>1)}(I)}(l,c,m,h);let w=l;for(;l.prev!==l.next;){const S=l.prev,P=l.next;if(h?A4(l,c,m,h):S4(l))t.push(S.i,l.i,P.i),$g(l),l=P.next,w=P.next;else if((l=P)===w){_?_===1?Ug(l=C4(Sf(l),t),t,s,c,m,h,2):_===2&&M4(l,t,s,c,m,h):Ug(Sf(l),t,s,c,m,h,1);break}}}function S4(l){const t=l.prev,s=l,c=l.next;if(zs(t,s,c)>=0)return!1;const m=t.x,h=s.x,_=c.x,w=t.y,S=s.y,P=c.y,x=m<h?m<_?m:_:h<_?h:_,A=w<S?w<P?w:P:S<P?S:P,I=m>h?m>_?m:_:h>_?h:_,E=w>S?w>P?w:P:S>P?S:P;let C=c.next;for(;C!==t;){if(C.x>=x&&C.x<=I&&C.y>=A&&C.y<=E&&hm(m,w,h,S,_,P,C.x,C.y)&&zs(C.prev,C,C.next)>=0)return!1;C=C.next}return!0}function A4(l,t,s,c){const m=l.prev,h=l,_=l.next;if(zs(m,h,_)>=0)return!1;const w=m.x,S=h.x,P=_.x,x=m.y,A=h.y,I=_.y,E=w<S?w<P?w:P:S<P?S:P,C=x<A?x<I?x:I:A<I?A:I,R=w>S?w>P?w:P:S>P?S:P,z=x>A?x>I?x:I:A>I?A:I,V=Pw(E,C,t,s,c),W=Pw(R,z,t,s,c);let Y=l.prevZ,$=l.nextZ;for(;Y&&Y.z>=V&&$&&$.z<=W;){if(Y.x>=E&&Y.x<=R&&Y.y>=C&&Y.y<=z&&Y!==m&&Y!==_&&hm(w,x,S,A,P,I,Y.x,Y.y)&&zs(Y.prev,Y,Y.next)>=0||(Y=Y.prevZ,$.x>=E&&$.x<=R&&$.y>=C&&$.y<=z&&$!==m&&$!==_&&hm(w,x,S,A,P,I,$.x,$.y)&&zs($.prev,$,$.next)>=0))return!1;$=$.nextZ}for(;Y&&Y.z>=V;){if(Y.x>=E&&Y.x<=R&&Y.y>=C&&Y.y<=z&&Y!==m&&Y!==_&&hm(w,x,S,A,P,I,Y.x,Y.y)&&zs(Y.prev,Y,Y.next)>=0)return!1;Y=Y.prevZ}for(;$&&$.z<=W;){if($.x>=E&&$.x<=R&&$.y>=C&&$.y<=z&&$!==m&&$!==_&&hm(w,x,S,A,P,I,$.x,$.y)&&zs($.prev,$,$.next)>=0)return!1;$=$.nextZ}return!0}function C4(l,t){let s=l;do{const c=s.prev,m=s.next.next;!R1(c,m)&&KA(c,s,s.next,m)&&jg(c,m)&&jg(m,c)&&(t.push(c.i,s.i,m.i),$g(s),$g(s.next),s=l=m),s=s.next}while(s!==l);return Sf(s)}function M4(l,t,s,c,m,h){let _=l;do{let w=_.next.next;for(;w!==_.prev;){if(_.i!==w.i&&O4(_,w)){let S=JA(_,w);return _=Sf(_,_.next),S=Sf(S,S.next),Ug(_,t,s,c,m,h,0),void Ug(S,t,s,c,m,h,0)}w=w.next}_=_.next}while(_!==l)}function I4(l,t){return l.x-t.x}function P4(l,t){const s=function(m,h){let _=h;const w=m.x,S=m.y;let P,x=-1/0;do{if(S<=_.y&&S>=_.next.y&&_.next.y!==_.y){const R=_.x+(S-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(R<=w&&R>x&&(x=R,P=_.x<_.next.x?_:_.next,R===w))return P}_=_.next}while(_!==h);if(!P)return null;const A=P,I=P.x,E=P.y;let C=1/0;_=P;do{if(w>=_.x&&_.x>=I&&w!==_.x&&hm(S<E?w:x,S,I,E,S<E?x:w,S,_.x,_.y)){const R=Math.abs(S-_.y)/(w-_.x);jg(_,m)&&(R<C||R===C&&(_.x>P.x||_.x===P.x&&R4(P,_)))&&(P=_,C=R)}_=_.next}while(_!==A);return P}(l,t);if(!s)return t;const c=JA(s,l);return Sf(c,c.next),Sf(s,s.next)}function R4(l,t){return zs(l.prev,l,t.prev)<0&&zs(t.next,l,l.next)<0}function Pw(l,t,s,c,m){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-s)*m|0)|l<<8))|l<<4))|l<<2))|l<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-c)*m|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function D4(l){let t=l,s=l;do(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next;while(t!==l);return s}function hm(l,t,s,c,m,h,_,w){return(m-_)*(t-w)>=(l-_)*(h-w)&&(l-_)*(c-w)>=(s-_)*(t-w)&&(s-_)*(h-w)>=(m-_)*(c-w)}function O4(l,t){return l.next.i!==t.i&&l.prev.i!==t.i&&!function(s,c){let m=s;do{if(m.i!==s.i&&m.next.i!==s.i&&m.i!==c.i&&m.next.i!==c.i&&KA(m,m.next,s,c))return!0;m=m.next}while(m!==s);return!1}(l,t)&&(jg(l,t)&&jg(t,l)&&function(s,c){let m=s,h=!1;const _=(s.x+c.x)/2,w=(s.y+c.y)/2;do m.y>w!=m.next.y>w&&m.next.y!==m.y&&_<(m.next.x-m.x)*(w-m.y)/(m.next.y-m.y)+m.x&&(h=!h),m=m.next;while(m!==s);return h}(l,t)&&(zs(l.prev,l,t.prev)||zs(l,t.prev,t))||R1(l,t)&&zs(l.prev,l,l.next)>0&&zs(t.prev,t,t.next)>0)}function zs(l,t,s){return(t.y-l.y)*(s.x-t.x)-(t.x-l.x)*(s.y-t.y)}function R1(l,t){return l.x===t.x&&l.y===t.y}function KA(l,t,s,c){const m=O1(zs(l,t,s)),h=O1(zs(l,t,c)),_=O1(zs(s,c,l)),w=O1(zs(s,c,t));return m!==h&&_!==w||!(m!==0||!D1(l,s,t))||!(h!==0||!D1(l,c,t))||!(_!==0||!D1(s,l,c))||!(w!==0||!D1(s,t,c))}function D1(l,t,s){return t.x<=Math.max(l.x,s.x)&&t.x>=Math.min(l.x,s.x)&&t.y<=Math.max(l.y,s.y)&&t.y>=Math.min(l.y,s.y)}function O1(l){return l>0?1:l<0?-1:0}function jg(l,t){return zs(l.prev,l,l.next)<0?zs(l,t,l.next)>=0&&zs(l,l.prev,t)>=0:zs(l,t,l.prev)<0||zs(l,l.next,t)<0}function JA(l,t){const s=Rw(l.i,l.x,l.y),c=Rw(t.i,t.x,t.y),m=l.next,h=t.prev;return l.next=t,t.prev=l,s.next=m,m.prev=s,c.next=s,s.prev=c,h.next=c,c.prev=h,c}function QA(l,t,s,c){const m=Rw(l,t,s);return c?(m.next=c.next,m.prev=c,c.next.prev=m,c.next=m):(m.prev=m,m.next=m),m}function $g(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function Rw(l,t,s){return{i:l,x:t,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function L1(l,t){const s=l.length;if(s<=1)return[l];const c=[];let m,h;for(let _=0;_<s;_++){const w=Rn(l[_]);w!==0&&(l[_].area=Math.abs(w),h===void 0&&(h=w<0),h===w<0?(m&&c.push(m),m=[l[_]]):m.push(l[_]))}if(m&&c.push(m),t>1)for(let _=0;_<c.length;_++)c[_].length<=t||(vu(c[_],t,1,c[_].length-1,L4),c[_]=c[_].slice(0,t));return c}function L4(l,t){return t.area-l.area}function eC(l,t,s=1){if(!l)return null;const c=typeof l=="string"?l:l.getPrimary().id;t[c]||(t[c]=[]);const m=Us.from(c).getPrimary().scaleSelf(s);return t[c].push(m),m.serialize()}function Dw(l,t,s,c){const m=c.patternDependencies;let h=!1;for(const _ of t){const w=_.paint.get(`${l}-pattern`);w.isConstant()||(h=!0),eC(w.constantOr(null),m,s)&&(h=!0)}return h}function Ow(l,t,s,c,m,h){const _=h.patternDependencies;for(const w of t){const S=w.paint.get(`${l}-pattern`).value;if(S.kind!=="constant"){let P=S.evaluate({zoom:c},s,{},h.availableImages);P=P&&P.name?P.name:P;const x=eC(P,_,m);x&&(s.patterns[w.id]=x)}}return s}class Lw{constructor(t){this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new mc,this.indexArray=new Xs,this.indexArray2=new qc,this.programConfigurations=new Wc(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new ts,this.segments2=new ts,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=t.projection}updateFootprints(t,s){}populate(t,s,c,m){this.hasPattern=Dw("fill",this.layers,this.pixelRatio,s);const h=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:w,id:S,index:P,sourceLayerIndex:x}of t){const A=this.layers[0]._featureFilter.needGeometry,I=U(w,A);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),I,c))continue;const E=h?h.evaluate(I,{},c,s.availableImages):void 0,C={id:S,properties:w.properties,type:w.type,sourceLayerIndex:x,index:P,geometry:A?I.geometry:k(w,c,m),patterns:{},sortKey:E};_.push(C)}h&&_.sort((w,S)=>w.sortKey-S.sortKey);for(const w of _){const{geometry:S,index:P,sourceLayerIndex:x}=w;if(this.hasPattern){const A=Ow("fill",this.layers,w,this.zoom,this.pixelRatio,s);this.patternFeatures.push(A)}else this.addFeature(w,S,P,c,{},s.availableImages,s.brightness,s.elevationFeatures);s.featureIndex.insert(t[P].feature,S,P,x,this.index)}}update(t,s,c,m,h,_,w){this.programConfigurations.updatePaintArrays(t,s,h,c,m,_,w)}addFeatures(t,s,c,m,h,_){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,s,c,m,_,t.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,E4),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,s,c,m,h,_=[],w,S){for(const P of L1(s,500)){let x=0;for(const z of P)x+=z.length;const A=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),I=A.vertexLength,E=[],C=[];for(const z of P){if(z.length===0)continue;z!==P[0]&&C.push(E.length/2);const V=this.segments2.prepareSegment(z.length,this.layoutVertexArray,this.indexArray2),W=V.vertexLength;this.layoutVertexArray.emplaceBack(z[0].x,z[0].y),this.indexArray2.emplaceBack(W+z.length-1,W),E.push(z[0].x),E.push(z[0].y);for(let Y=1;Y<z.length;Y++)this.layoutVertexArray.emplaceBack(z[Y].x,z[Y].y),this.indexArray2.emplaceBack(W+Y-1,W+Y),E.push(z[Y].x),E.push(z[Y].y);V.vertexLength+=z.length,V.primitiveLength+=z.length}const R=Vg(E,C);for(let z=0;z<R.length;z+=3)this.indexArray.emplaceBack(I+R[z],I+R[z+1],I+R[z+2]);A.vertexLength+=x,A.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,h,_,m,w)}}let tC,iC,rC,nC;gi(Lw,"FillBucket",{omit:["layers","patternFeatures"]});class kw{constructor(t,s,c,m){if(this.triangleCount=s.length/3,this.min=new ve(0,0),this.max=new ve(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0)return;const[h,_]=[t[0].clone(),t[0].clone()];for(let A=1;A<t.length;++A){const I=t[A];h.x=Math.min(h.x,I.x),h.y=Math.min(h.y,I.y),_.x=Math.max(_.x,I.x),_.y=Math.max(_.y,I.y)}if(m){const A=Math.ceil(Math.max(_.x-h.x,_.y-h.y)/m);c=Math.max(c,A)}if(c===0)return;this.min=h,this.max=_;const w=this.max.sub(this.min);w.x=Math.max(w.x,1),w.y=Math.max(w.y,1);const S=Math.max(w.x,w.y)/c;this.cellsX=Math.max(1,Math.ceil(w.x/S)),this.cellsY=Math.max(1,Math.ceil(w.y/S)),this.xScale=1/S,this.yScale=1/S;const P=[];for(let A=0;A<this.triangleCount;A++){const I=t[s[3*A+0]].sub(this.min),E=t[s[3*A+1]].sub(this.min),C=t[s[3*A+2]].sub(this.min),R=Yc(Math.floor(Math.min(I.x,E.x,C.x)),this.xScale,this.cellsX),z=Yc(Math.floor(Math.max(I.x,E.x,C.x)),this.xScale,this.cellsX),V=Yc(Math.floor(Math.min(I.y,E.y,C.y)),this.yScale,this.cellsY),W=Yc(Math.floor(Math.max(I.y,E.y,C.y)),this.yScale,this.cellsY),Y=new ve(0,0),$=new ve(0,0),J=new ve(0,0),ie=new ve(0,0);for(let ge=V;ge<=W;++ge){Y.y=$.y=ge*S,J.y=ie.y=(ge+1)*S;for(let Pe=R;Pe<=z;++Pe)Y.x=J.x=Pe*S,$.x=ie.x=(Pe+1)*S,(_t(I,E,C,Y,$,ie)||_t(I,E,C,Y,ie,J))&&P.push({cellIdx:ge*this.cellsX+Pe,triIdx:A})}}if(P.length===0)return;P.sort((A,I)=>A.cellIdx-I.cellIdx||A.triIdx-I.triIdx);let x=0;for(;x<P.length;){const A=P[x].cellIdx,I={start:this.payload.length,len:0};for(;x<P.length&&P[x].cellIdx===A;)++I.len,this.payload.push(P[x++].triIdx);this.cells[A]=I}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(t,s){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>t.x||t.y>this.max.y||this.min.y>t.y)return;const c=Yc(t.x-this.min.x,this.xScale,this.cellsX),m=Yc(t.y-this.min.y,this.yScale,this.cellsY),h=this.cells[m*this.cellsX+c];if(h){this._lazyInitLookup();for(let _=0;_<h.len;_++){const w=this.payload[h.start+_],S=Math.floor(w/8),P=1<<w%8;if(!(this.lookup[S]&P)&&(this.lookup[S]|=P,s.push(w),s.length===this.triangleCount))return}}}query(t,s,c){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>s.x||t.y>this.max.y||this.min.y>s.y)return;this._lazyInitLookup();const m=Yc(t.x-this.min.x,this.xScale,this.cellsX),h=Yc(s.x-this.min.x,this.xScale,this.cellsX),_=Yc(t.y-this.min.y,this.yScale,this.cellsY),w=Yc(s.y-this.min.y,this.yScale,this.cellsY);for(let S=_;S<=w;S++)for(let P=m;P<=h;P++){const x=this.cells[S*this.cellsX+P];if(x)for(let A=0;A<x.len;A++){const I=this.payload[x.start+A],E=Math.floor(I/8),C=1<<I%8;if(!(this.lookup[E]&C)&&(this.lookup[E]|=C,c.push(I),c.length===this.triangleCount))return}}}}function Yc(l,t,s){return Math.max(0,Math.min(s-1,Math.floor(l*t)))}gi(kw,"TriangleGridIndex");class sC{constructor(t){this.zoom=t.zoom,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.footprints=[]}updateFootprints(t,s){for(const c of this.footprints)s.push({footprint:c,id:t})}populate(t,s,c,m){const h=[];for(const{feature:_,id:w,index:S,sourceLayerIndex:P}of t){const x=this.layers[0]._featureFilter.needGeometry,A=U(_,x);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),A,c))continue;const I={id:w,properties:_.properties,type:_.type,sourceLayerIndex:P,index:S,geometry:x?A.geometry:k(_,c,m),patterns:{}};h.push(I)}for(const _ of h){const{geometry:w,index:S,sourceLayerIndex:P}=_;this.addFeature(_,w,S,c,{},s.availableImages,s.brightness),s.featureIndex.insert(t[S].feature,w,S,P,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(t){}update(t,s,c,m,h,_,w){}destroy(){}addFeature(t,s,c,m,h,_=[],w){for(const S of L1(s,2)){const P=[],x=[],A=[],I=new ve(1/0,1/0),E=new ve(-1/0,-1/0);for(const z of S)if(z.length!==0){z!==S[0]&&A.push(x.length/2);for(let V=0;V<z.length;V++)x.push(z[V].x),x.push(z[V].y),P.push(z[V]),I.x=Math.min(I.x,z[V].x),I.y=Math.min(I.y,z[V].y),E.x=Math.max(E.x,z[V].x),E.y=Math.max(E.y,z[V].y)}const C=Vg(x,A),R=new kw(P,C,8,256);this.footprints.push({vertices:P,indices:C,grid:R,min:I,max:E})}}}gi(sC,"ClipBucket",{omit:["layers"]});const k4=qr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),z4=qr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),F4=qr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),B4=qr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),N4=qr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),V4=qr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:U4}=k4;var zw,oC,Fw,aC,Bw,lC,cC,k1={};function uC(){if(oC)return zw;oC=1;var l=Ee();function t(m,h,_,w,S){this.properties={},this.extent=_,this.type=0,this._pbf=m,this._geometry=-1,this._keys=w,this._values=S,m.readFields(s,this,h)}function s(m,h,_){m==1?h.id=_.readVarint():m==2?function(w,S){for(var P=w.readVarint()+w.pos;w.pos<P;){var x=S._keys[w.readVarint()],A=S._values[w.readVarint()];S.properties[x]=A}}(_,h):m==3?h.type=_.readVarint():m==4&&(h._geometry=_.pos)}function c(m){for(var h,_,w=0,S=0,P=m.length,x=P-1;S<P;x=S++)w+=((_=m[x]).x-(h=m[S]).x)*(h.y+_.y);return w}return zw=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var m=this._pbf;m.pos=this._geometry;for(var h,_=m.readVarint()+m.pos,w=1,S=0,P=0,x=0,A=[];m.pos<_;){if(S<=0){var I=m.readVarint();w=7&I,S=I>>3}if(S--,w===1||w===2)P+=m.readSVarint(),x+=m.readSVarint(),w===1&&(h&&A.push(h),h=[]),h.push(new l(P,x));else{if(w!==7)throw new Error("unknown command "+w);h&&h.push(h[0].clone())}}return h&&A.push(h),A},t.prototype.bbox=function(){var m=this._pbf;m.pos=this._geometry;for(var h=m.readVarint()+m.pos,_=1,w=0,S=0,P=0,x=1/0,A=-1/0,I=1/0,E=-1/0;m.pos<h;){if(w<=0){var C=m.readVarint();_=7&C,w=C>>3}if(w--,_===1||_===2)(S+=m.readSVarint())<x&&(x=S),S>A&&(A=S),(P+=m.readSVarint())<I&&(I=P),P>E&&(E=P);else if(_!==7)throw new Error("unknown command "+_)}return[x,I,A,E]},t.prototype.toGeoJSON=function(m,h,_){var w,S,P=this.extent*Math.pow(2,_),x=this.extent*m,A=this.extent*h,I=this.loadGeometry(),E=t.types[this.type];function C(V){for(var W=0;W<V.length;W++){var Y=V[W];V[W]=[360*(Y.x+x)/P-180,360/Math.PI*Math.atan(Math.exp((180-360*(Y.y+A)/P)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(w=0;w<I.length;w++)R[w]=I[w][0];C(I=R);break;case 2:for(w=0;w<I.length;w++)C(I[w]);break;case 3:for(I=function(V){var W=V.length;if(W<=1)return[V];for(var Y,$,J=[],ie=0;ie<W;ie++){var ge=c(V[ie]);ge!==0&&($===void 0&&($=ge<0),$===ge<0?(Y&&J.push(Y),Y=[V[ie]]):Y.push(V[ie]))}return Y&&J.push(Y),J}(I),w=0;w<I.length;w++)for(S=0;S<I[w].length;S++)C(I[w][S])}I.length===1?I=I[0]:E="Multi"+E;var z={type:"Feature",geometry:{type:E,coordinates:I},properties:this.properties};return"id"in this&&(z.id=this.id),z},zw}function hC(){if(aC)return Fw;aC=1;var l=uC();function t(c,m){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(s,this,m),this.length=this._features.length}function s(c,m,h){c===15?m.version=h.readVarint():c===1?m.name=h.readString():c===5?m.extent=h.readVarint():c===2?m._features.push(h.pos):c===3?m._keys.push(h.readString()):c===4&&m._values.push(function(_){for(var w=null,S=_.readVarint()+_.pos;_.pos<S;){var P=_.readVarint()>>3;w=P===1?_.readString():P===2?_.readFloat():P===3?_.readDouble():P===4?_.readVarint64():P===5?_.readVarint():P===6?_.readSVarint():P===7?_.readBoolean():null}return w}(h))}return Fw=t,t.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var m=this._pbf.readVarint()+this._pbf.pos;return new l(this._pbf,m,this.extent,this._keys,this._values)},Fw}function dC(){return cC||(cC=1,k1.VectorTile=function(){if(lC)return Bw;lC=1;var l=hC();function t(s,c,m){if(s===3){var h=new l(m,m.readVarint()+m.pos);h.length&&(c[h.name]=h)}}return Bw=function(s,c){this.layers=s.readFields(t,{},c)},Bw}(),k1.VectorTileFeature=uC(),k1.VectorTileLayer=hC()),k1}var dm=dC();class Af extends ve{constructor(t,s,c){super(t,s),this.z=c}}class fC extends Af{constructor(t,s,c,m){super(t,s,c),this.w=m}}function z1(l,t,s,c){const m=[],h=c===0?(_,w,S,P,x,A)=>{_.push(new ve(A,S+(A-w)/(P-w)*(x-S)))}:(_,w,S,P,x,A)=>{_.push(new ve(w+(A-S)/(x-S)*(P-w),A))};for(const _ of l){const w=[];for(const S of _){if(S.length<=2)continue;const P=[];for(let I=0;I<S.length-1;I++){const E=S[I].x,C=S[I].y,R=S[I+1].x,z=S[I+1].y,V=c===0?E:C,W=c===0?R:z;V<t?W>t&&h(P,E,C,R,z,t):V>s?W<s&&h(P,E,C,R,z,s):P.push(S[I]),W<t&&V>=t&&h(P,E,C,R,z,t),W>s&&V<=s&&h(P,E,C,R,z,s)}let x=S[S.length-1];const A=c===0?x.x:x.y;A>=t&&A<=s&&P.push(x),P.length&&(x=P[P.length-1],P[0].x===x.x&&P[0].y===x.y||P.push(P[0]),w.push(P))}w.length&&m.push(w)}return m}function pC(l,t,s,c){const m=s==="x"?"y":"x",h=(c-l[s])/(t[s]-l[s]);l[m]=l[m]+(t[m]-l[m])*h,l[s]=c,l.hasOwnProperty("z")&&(l.z=Bi(l.z,t.z,h)),l.hasOwnProperty("w")&&(l.w=Bi(l.w,t.w,h))}function mC(l,t,s,c){const m=s,h=c;for(const _ of["x","y"]){let w=l,S=t;w[_]>=S[_]&&(w=t,S=l),w[_]<m&&S[_]>m&&pC(w,S,_,m),w[_]<h&&S[_]>h&&pC(S,w,_,h)}}const F1=Number.MAX_SAFE_INTEGER;function _C(l,t,s,c){return l.order<t||l.order===F1||!(l.clipMask&s)||function(m,h){return h.length!==0&&h.find(_=>_===m)===void 0}(c,l.clipScope)}function B1(l,t){return l.x-t.x||l.y-t.y}function gC(l,t){return B1(l.min,t.min)===0&&B1(l.max,t.max)===0}function Nw(l,t){return!(l.min.x>t.max.x||l.max.x<t.min.x||l.min.y>t.max.y||l.max.y<t.min.y)}function Vw(l,t){if(l.length!==t.length)return!1;for(let s=0;s<l.length;s++)if(l[s].sourceId!==t[s].sourceId||!gC(l[s],t[s])||l[s].order!==t[s].order||l[s].clipMask!==t[s].clipMask||!Ie(l[s].clipScope,t[s].clipScope))return!1;return!0}function yC(l,t,s){const c=1/ii,m=1/(1<<s.canonical.z),h=(t.x*c+s.canonical.x)*m+s.wrap,_=(t.y*c+s.canonical.y)*m;return{min:new ve((l.x*c+s.canonical.x)*m+s.wrap,(l.y*c+s.canonical.y)*m),max:new ve(h,_)}}function j4(l,t,s){const c=1<<s.canonical.z,m=((t.x-s.wrap)*c-s.canonical.x)*ii,h=(t.y*c-s.canonical.y)*ii;return{min:new ve(((l.x-s.wrap)*c-s.canonical.x)*ii,(l.y*c-s.canonical.y)*ii),max:new ve(m,h)}}function vC(l,t,s,c,m,h,_){const w=l.indices,S=l.vertices,P=[];for(let x=c;x<c+m;x+=3){const A=t[s[x+0]+h],I=t[s[x+1]+h],E=t[s[x+2]+h],C=Math.min(A.x,I.x,E.x),R=Math.max(A.x,I.x,E.x),z=Math.min(A.y,I.y,E.y),V=Math.max(A.y,I.y,E.y);P.length=0,l.grid.query(new ve(C,z),new ve(R,V),P);for(let W=0;W<P.length;W++){const Y=P[W];if(_t(S[w[3*Y+0]],S[w[3*Y+1]],S[w[3*Y+2]],A,I,E,_))return!0}}return!1}function xC(l,t,s,c){if(!l||!s)return!1;let m=l.vertices;if(!t.canonical.equals(c.canonical)||t.wrap!==c.wrap){if(s.vertices.length<l.vertices.length)return xC(s,c,l,t);const h=t.canonical,_=c.canonical,w=Math.pow(2,_.z-h.z);m=l.vertices.map(S=>new ve((S.x+h.x*ii)*w-_.x*ii,(S.y+h.y*ii)*w-_.y*ii))}return vC(s,m,l.indices,0,l.indices.length,0,0)}function bC(l,t,s,c){const m=Math.pow(2,c.z-s.z);return new ve((l+s.x*ii)*m-c.x*ii,(t+s.y*ii)*m-c.y*ii)}function wC(l,t){const s=[];t.grid.queryPoint(l,s);const c=t.indices,m=t.vertices;for(let h=0;h<s.length;h++){const _=s[h];if(Ne([m[c[3*_+0]],m[c[3*_+1]],m[c[3*_+2]]],l))return!0}return!1}const Uw=[new ve(0,0),new ve(ii,0),new ve(ii,ii),new ve(0,ii)];function TC(l,t){const s=[];let c=[];if(!t||l.length<2)return[l];if(l.length===2)return it(l[0],l[1],Uw)?[l]:[];for(let m=0;m<l.length+2;m++){const h=l[m%l.length],_=l[(m+1)%l.length],w=it(m===0?l[l.length-1]:l[(m-1)%l.length],h,Uw),S=it(h,_,Uw),P=w||S;P&&c.push(h),P&&S||c.length>0&&(c.length>1&&s.push(c),c=[])}return c.length>1&&s.push(c),s}const jw=dm.VectorTileFeature.types,$4=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],q4=["fill-extrusion-flood-light-ground-radius"],H4=Math.pow(2,13),G4=Math.pow(2,15)-1,EC=new ve(0,1),Vh=2147483648;function qg(l,t,s,c,m,h,_,w){l.emplaceBack((t<<1)+_,(s<<1)+h,(Math.floor(c*H4)<<1)+m,Math.round(w))}function Hg(l,t,s){l.emplaceBack(t.x*ii,t.y*ii,s?1:0)}function N1(l,t,s,c,m,h){l.emplaceBack(t.x,t.y,(s.x<<1)+c,(s.y<<1)+m,h)}function Gg(l,t,s){l.emplaceBack(t.x,t.y,t.z,s[0]*16384,s[1]*16384,s[2]*16384)}class SC{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class AC{constructor(){this.centroidXY=new ve(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new ve(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ve(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new ve(this.max.x-this.min.x,this.max.y-this.min.y)}}class CC{constructor(){this.acc=new ve(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,s){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=s.x,t.min.y=t.max.y=s.y)}appendEdge(t,s,c){this.accCount++,this.acc._add(s);let m=!!this.borders;s.x<t.min.x?(t.min.x=s.x,m=!0):s.x>t.max.x&&(t.max.x=s.x,m=!0),s.y<t.min.y?(t.min.y=s.y,m=!0):s.y>t.max.y&&(t.max.y=s.y,m=!0),((s.x===0||s.x===ii)&&s.x===c.x)!=((s.y===0||s.y===ii)&&s.y===c.y)&&this.processBorderOverlap(s,c),m&&this.checkBorderIntersection(s,c)}checkBorderIntersection(t,s){s.x<0!=t.x<0&&this.addBorderIntersection(0,Bi(s.y,t.y,(0-s.x)/(t.x-s.x))),s.x>ii!=t.x>ii&&this.addBorderIntersection(1,Bi(s.y,t.y,(ii-s.x)/(t.x-s.x))),s.y<0!=t.y<0&&this.addBorderIntersection(2,Bi(s.x,t.x,(0-s.y)/(t.y-s.y))),s.y>ii!=t.y>ii&&this.addBorderIntersection(3,Bi(s.x,t.x,(ii-s.y)/(t.y-s.y)))}addBorderIntersection(t,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[t];s<c[0]&&(c[0]=s),s>c[1]&&(c[1]=s)}processBorderOverlap(t,s){if(t.x===s.x){if(t.y===s.y)return;const c=t.x===0?0:1;this.addBorderIntersection(c,s.y),this.addBorderIntersection(c,t.y)}else{const c=t.y===0?2:3;this.addBorderIntersection(c,s.x),this.addBorderIntersection(c,t.x)}}centroid(){return this.accCount===0?new ve(0,0):new ve(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,s)=>t+ +(s[0]!==Number.MAX_VALUE),0):0}}function MC(l,t){const s=l.add(t)._unit(),c=Ut(l.x*s.x+l.y*s.y,-1,1);var m,h,_;return _=Math.acos(c),Math.min(4,Math.max(-4,Math.tan(_)))/4*G4*((m=l).x*(h=t).y-m.y*h.x<0?-1:1)}const W4=[l=>l.x<0,l=>l.x>ii,l=>l.y<0,l=>l.y>ii];function Z4(l,t,s,c){const m=[4];if(c===0)return m;s._mult(c);const h=l.sub(s),_=t.sub(s),w=[l,t,h,_];for(let S=0;S<4;S++)for(const P of w)if(W4[S](P)){m.push(S);break}return m}class IC{constructor(t){this.vertexArray=new Qp,this.indexArray=new Xs,this.programConfigurations=new Wc(t.layers,{zoom:t.zoom,lut:t.lut},s=>q4.includes(s)),this._segments=new ts,this.hiddenByLandmarkVertexArray=new nm,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ts}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,s,c,m=!1){const h=t.length;if(h>2){let _=Math.max(0,this._segments.get().length-1);const w=this._segments._prepareSegment(4*h,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let S;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const P=t[0],x=t[1];S=MC(P.sub(t[h-1])._perp()._unit(),x.sub(P)._perp()._unit())}for(let P=0;P<h;P++){const x=P===h-1?0:P+1,A=t[P],I=t[x],E=t[x===h-1?0:x+1],C=I.sub(A)._perp()._unit(),R=MC(C,E.sub(I)._perp()._unit()),z=S,V=R;if($w(A,I,s)||m&&DC(A,s)&&DC(I,s)){S=R;continue}const W=w.vertexLength;N1(this.vertexArray,A,I,1,1,z),N1(this.vertexArray,A,I,1,0,z),N1(this.vertexArray,A,I,0,1,V),N1(this.vertexArray,A,I,0,0,V),w.vertexLength+=4;const Y=Z4(A,I,C,c);for(const $ of Y)this._segmentToGroundQuads[_].push({id:W,region:$}),this._segmentToRegionTriCounts[_][$]+=2,w.primitiveLength+=2;S=R}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),s=t.length;for(let c=0;c<s;c++)this._segmentToGroundQuads[c].sort((m,h)=>m.region-h.region);for(let c=0;c<s;c++){const m=this._segmentToGroundQuads[c],h=t[c],_=this._segmentToRegionTriCounts[c];_.reduce((S,P)=>S+P,0);let w=0;for(let S=0;S<=4;S++){const P=_[S];if(P!==0){let x=this.regionSegments[S];x||(x=this.regionSegments[S]=new ts);const A={vertexOffset:h.vertexOffset,primitiveOffset:h.primitiveOffset+w,vertexLength:h.vertexLength,primitiveLength:P};x.get().push(A)}w+=P}for(let S=0;S<m.length;S++){const P=m[S].id;this.indexArray.emplaceBack(P,P+1,P+3),this.indexArray.emplaceBack(P,P+3,P+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,s,c,m,h,_){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,s,c,m,h,_)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,z4.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,s,c,m,h,_,w){this.hasData()&&this.programConfigurations.updatePaintArrays(t,s,c,m,h,_,w)}updateHiddenByLandmark(t){if(!this.hasData())return;const s=t.groundVertexCount+t.groundVertexArrayOffset;if(t.groundVertexCount===0)return;const c=t.flags&Vh?1:0;for(let m=t.groundVertexArrayOffset;m<s;++m)this.hiddenByLandmarkVertexArray.emplace(m,c);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,N4.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const s=this.regionSegments[t];s&&s.destroy()}}}}class V1{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.pixelRatio=t.pixelRatio,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Xs,this.footprintVertices=new mc,this.footprintSegments=[],this.layoutVertexArray=new _c,this.centroidVertexArray=new jo,this.wallVertexArray=new T1,this.indexArray=new Xs,this.programConfigurations=new Wc(t.layers,{zoom:t.zoom,lut:t.lut},s=>$4.includes(s)),this.segments=new ts,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.groundEffect=new IC(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(t,s){}populate(t,s,c,m){this.features=[],this.hasPattern=Dw("fill-extrusion",this.layers,this.pixelRatio,s),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=i(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:h,id:_,index:w,sourceLayerIndex:S}of t){const P=this.layers[0]._featureFilter.needGeometry,x=U(h,P);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),x,c))continue;const A={id:_,sourceLayerIndex:S,index:w,geometry:P?x.geometry:k(h,c,m),properties:h.properties,type:h.type,patterns:{}},I=this.layoutVertexArray.length,E=jw[A.type]==="Polygon";if(this.hasPattern)this.features.push(Ow("fill-extrusion",this.layers,A,this.zoom,this.pixelRatio,s));else if(this.wallMode)for(const C of A.geometry)for(const R of TC(C,E))this.addFeature(A,[R],w,c,{},s.availableImages,m,s.brightness);else this.addFeature(A,A.geometry,w,c,{},s.availableImages,m,s.brightness);s.featureIndex.insert(h,A.geometry,w,S,this.index,I)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,s,c,m,h,_){for(const w of this.features){const S=jw[w.type]==="Polygon",{geometry:P}=w;if(this.wallMode)for(const x of P)for(const A of TC(x,S))this.addFeature(w,[A],w.index,s,c,m,h,_);else this.addFeature(w,P,w.index,s,c,m,h,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,s,c,m,h,_,w){this.programConfigurations.updatePaintArrays(t,s,h,c,m,_,w),this.groundEffect.update(t,s,h,c,m,_,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,U4),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.wallVertexBuffer=t.createVertexBuffer(this.wallVertexArray,B4.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,V4.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,F4.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,c,m,h,_,w,S){const P=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,x=[new ve(0,0),new ve(ii,ii)],A=w.projection,I=A.name==="globe",E=this.wallMode||jw[t.type]==="Polygon",C=new CC;C.centroidDataIndex=this.centroidData.length;const R=new AC,z=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},m)<=0,V=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},m);let W;if(R.height=V,R.vertexArrayOffset=this.layoutVertexArray.length,R.groundVertexArrayOffset=this.groundEffect.vertexArray.length,I&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new df),this.wallMode){if(I)return void Vi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(s.length!==1)return;W=function(Ce){const $e=Ce[0].x===Ce[Ce.length-1].x&&Ce[0].y===Ce[Ce.length-1].y;(function(Wt){let Bt=0;const wi=Wt.length;for(let ai=0;ai<wi;ai++)Bt+=(Wt[(ai+1)%wi].x-Wt[ai].x)*(Wt[(ai+1)%wi].y+Wt[ai].y);return Bt>=0})(Ce)||(Ce=Ce.reverse());const He={geometry:[],joinNormals:[],indices:[]},Je=[],Xe=[],tt=[];let at=Ce.length;for(;at>=2&&Ce[at-1].equals(Ce[at-2]);)at--;if(at<($e?3:2))return He;let ft,nt,Mt,Ft,Ct,si=0;for(;si<at-1&&Ce[si].equals(Ce[si+1]);)si++;$e&&(ft=Ce[at-2],Ct=Ce[si].sub(ft)._unit()._perp());for(let Wt=si;Wt<at;Wt++){if(Mt=Wt===at-1?$e?Ce[si+1]:void 0:Ce[Wt+1],Mt&&Ce[Wt].equals(Mt))continue;Ct&&(Ft=Ct),ft&&(nt=ft),ft=Ce[Wt],Ct=Mt?Mt.sub(ft)._unit()._perp():Ft,Ft=Ft||Ct;let Bt=Ft.add(Ct);Bt.x===0&&Bt.y===0||Bt._unit();const wi=Bt.x*Ct.x+Bt.y*Ct.y,ai=wi!==0?1/wi:1/0,fi=Ft.x*Ct.y-Ft.y*Ct.x>0;let Wi="miter";const hr=2;Wi==="miter"&&ai>hr&&(Wi="bevel"),Wi==="bevel"&&(ai>100&&(Wi="flipbevel"),ai<hr&&(Wi="miter"));const pr=(mr,Er,Sr,mn)=>{const en=new ve(mr.x,mr.y),nr=new ve(mr.x,mr.y);en.x+=Er.x*mn,en.y+=Er.y*mn,nr.x-=Er.x*Math.max(Sr,1),nr.y-=Er.y*Math.max(Sr,1),tt.push(Er),Je.push(en),Xe.push(nr)};if(Wi==="miter")Bt._mult(ai),pr(ft,Bt,0,0);else if(Wi==="flipbevel")Bt=Ct.mult(-1),pr(ft,Bt,0,0),pr(ft,Bt.mult(-1),0,0);else{const mr=-Math.sqrt(ai*ai-1),Er=fi?mr:0,Sr=fi?0:mr;nt&&pr(ft,Ft,Er,Sr),Mt&&pr(ft,Ct,Er,Sr)}}He.geometry=[...Je,...Xe.reverse(),Je[0]],He.joinNormals=[...tt,...tt.reverse(),tt[tt.length-1]];const ri=He.geometry.length-1;for(let Wt=0;Wt<ri/2;Wt++)if(Wt+1<ri/2){let Bt=Wt,wi=Wt+1,ai=ri-1-Wt,fi=ri-2-Wt;Bt=Bt===0?ri-1:Bt-1,wi=wi===0?ri-1:wi-1,ai=ai===0?ri-1:ai-1,fi=fi===0?ri-1:fi-1,He.indices.push(ai),He.indices.push(wi),He.indices.push(Bt),He.indices.push(ai),He.indices.push(fi),He.indices.push(wi)}return He}(s[0]),s=[W.geometry]}const Y=(Ce,$e)=>Ce<($e.length-1)/2||Ce===$e.length-1,$=this.wallMode?[s]:L1(s,500);for(let Ce=$.length-1;Ce>=0;Ce--){const $e=$[Ce];($e.length===0||(J=$e[0]).every(Re=>Re.x<=0)||J.every(Re=>Re.x>=ii)||J.every(Re=>Re.y<=0)||J.every(Re=>Re.y>=ii))&&$.splice(Ce,1)}var J;let ie;if(I)ie=zC($,x,m);else{ie=[];for(const Ce of $)ie.push({polygon:Ce,bounds:x})}const ge=E?this.edgeRadius:0,Pe=ge>0&&this.zoom<17,Me=(Ce,$e)=>{if(Ce.length===0)return!1;const Re=Ce[Ce.length-1];return $e.x===Re.x&&$e.y===Re.y};for(const{polygon:Ce,bounds:$e}of ie){let Re=0,He=0;for(const at of Ce)E&&!at[0].equals(at[at.length-1])&&at.push(at[0]),He+=E?at.length-1:at.length;const Je=this.segments.prepareSegment((E?5:4)*He,this.layoutVertexArray,this.indexArray);R.footprintSegIdx<0&&(R.footprintSegIdx=this.footprintSegments.length),R.polygonSegIdx<0&&(R.polygonSegIdx=this.polygonSegments.length);const Xe={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},tt=new SC;if(tt.vertexOffset=this.footprintVertices.length,tt.indexOffset=3*this.footprintIndices.length,tt.ringIndices=[],E){const at=[],ft=[];Re=Je.vertexLength;for(let Mt=0;Mt<Ce.length;Mt++){const Ft=Ce[Mt];Ft.length&&Mt!==0&&ft.push(at.length/2);const Ct=[];let si,ri;si=Ft[1].sub(Ft[0])._perp()._unit(),tt.ringIndices.push(Ft.length-1);for(let Wt=1;Wt<Ft.length;Wt++){const Bt=Ft[Wt],wi=Ft[Wt===Ft.length-1?1:Wt+1],ai=Bt.clone();if(ge){ri=wi.sub(Bt)._perp()._unit();const fi=si.add(ri)._unit(),Wi=ge*Math.min(4,1/(si.x*fi.x+si.y*fi.y));ai.x+=Wi*fi.x,ai.y+=Wi*fi.y,ai.x=Math.round(ai.x),ai.y=Math.round(ai.y),si=ri}if(!z||ge!==0&&!Pe||Me(Ct,ai)||Ct.push(ai),qg(this.layoutVertexArray,ai.x,ai.y,0,0,1,1,0),this.wallMode){const fi=Y(Wt,Ft);Hg(this.wallVertexArray,W.joinNormals[Wt],!fi)}Je.vertexLength++,this.footprintVertices.emplaceBack(Bt.x,Bt.y),at.push(Bt.x,Bt.y),I&&Gg(this.layoutVertexExtArray,A.projectTilePoint(ai.x,ai.y,m),A.upVector(m,ai.x,ai.y))}z&&(ge===0||Pe)&&(Ct.length!==0&&Me(Ct,Ct[0])&&Ct.pop(),this.groundEffect.addData(Ct,$e,P))}const nt=this.wallMode?W.indices:Vg(at,ft);for(let Mt=0;Mt<nt.length;Mt+=3)this.footprintIndices.emplaceBack(tt.vertexOffset+nt[Mt+0],tt.vertexOffset+nt[Mt+1],tt.vertexOffset+nt[Mt+2]),this.indexArray.emplaceBack(Re+nt[Mt],Re+nt[Mt+2],Re+nt[Mt+1]),Je.primitiveLength++;tt.indexCount+=nt.length,tt.vertexCount+=this.footprintVertices.length-tt.vertexOffset}for(let at=0;at<Ce.length;at++){const ft=Ce[at];C.startRing(R,ft[0]);let nt=ft.length>4&&OC(ft[ft.length-2],ft[0],ft[1]),Mt=ge?Y4(ft[ft.length-2],ft[0],ft[1],ge):0;const Ft=[];let Ct,si,ri;si=ft[1].sub(ft[0])._perp()._unit();let Wt=!0;for(let Bt=1,wi=0;Bt<ft.length;Bt++){let ai=ft[Bt-1],fi=ft[Bt];const Wi=ft[Bt===ft.length-1?1:Bt+1];if(C.appendEdge(R,fi,ai),$w(fi,ai,$e)){ge&&(si=Wi.sub(fi)._perp()._unit(),Wt=!Wt);continue}const hr=fi.sub(ai)._perp(),pr=hr.x/(Math.abs(hr.x)+Math.abs(hr.y)),mr=hr.y>0?1:0,Er=ai.dist(fi);if(wi+Er>32768&&(wi=0),ge){ri=Wi.sub(fi)._perp()._unit();let nr=RC(ai,fi,Wi,PC(si,ri),ge);isNaN(nr)&&(nr=0);const Zr=fi.sub(ai)._unit();ai=ai.add(Zr.mult(Mt))._round(),fi=fi.add(Zr.mult(-nr))._round(),Mt=nr,si=ri,z&&this.zoom>=17&&(Me(Ft,ai)||Ft.push(ai),Me(Ft,fi)||Ft.push(fi))}const Sr=Je.vertexLength,mn=ft.length>4&&OC(ai,fi,Wi);let en=LC(wi,nt,Wt);if(qg(this.layoutVertexArray,ai.x,ai.y,pr,mr,0,0,en),qg(this.layoutVertexArray,ai.x,ai.y,pr,mr,0,1,en),this.wallMode){const nr=Y(Bt-1,ft),Zr=W.joinNormals[Bt-1];Hg(this.wallVertexArray,Zr,nr),Hg(this.wallVertexArray,Zr,nr)}if(wi+=Er,en=LC(wi,mn,!Wt),nt=mn,qg(this.layoutVertexArray,fi.x,fi.y,pr,mr,0,0,en),qg(this.layoutVertexArray,fi.x,fi.y,pr,mr,0,1,en),this.wallMode){const nr=Y(Bt,ft),Zr=W.joinNormals[Bt];Hg(this.wallVertexArray,Zr,nr),Hg(this.wallVertexArray,Zr,nr)}if(Je.vertexLength+=4,this.indexArray.emplaceBack(Sr+0,Sr+1,Sr+2),this.indexArray.emplaceBack(Sr+1,Sr+3,Sr+2),Je.primitiveLength+=2,ge){const nr=Re+(Bt===1?ft.length-2:Bt-2),Zr=Bt===1?Re:nr+1;if(this.indexArray.emplaceBack(Sr+1,nr,Sr+3),this.indexArray.emplaceBack(nr,Zr,Sr+3),Je.primitiveLength+=2,Ct===void 0&&(Ct=Sr),!$w(Wi,ft[Bt],$e)){const Kr=Bt===ft.length-1?Ct:Je.vertexLength;this.indexArray.emplaceBack(Sr+2,Sr+3,Kr),this.indexArray.emplaceBack(Sr+3,Kr+1,Kr),this.indexArray.emplaceBack(Sr+3,Zr,Kr+1),Je.primitiveLength+=3}Wt=!Wt}if(I){const nr=this.layoutVertexExtArray,Zr=A.projectTilePoint(ai.x,ai.y,m),Kr=A.projectTilePoint(fi.x,fi.y,m),Mn=A.upVector(m,ai.x,ai.y),as=A.upVector(m,fi.x,fi.y);Gg(nr,Zr,Mn),Gg(nr,Zr,Mn),Gg(nr,Kr,as),Gg(nr,Kr,as)}}E&&(Re+=ft.length-1),z&&ge&&this.zoom>=17&&(Ft.length!==0&&Me(Ft,Ft[0])&&Ft.pop(),this.groundEffect.addData(Ft,$e,P,ge>0))}this.footprintSegments.push(tt),Xe.triangleCount=this.indexArray.length-Xe.triangleArrayOffset,this.polygonSegments.push(Xe),++R.footprintSegLen,++R.polygonSegLen}if(R.vertexCount=this.layoutVertexArray.length-R.vertexArrayOffset,R.groundVertexCount=this.groundEffect.vertexArray.length-R.groundVertexArrayOffset,R.vertexCount!==0){if(R.centroidXY=C.borders?EC:this.encodeCentroid(C,R),this.centroidData.push(R),C.borders){this.featuresOnBorder.push(C);const Ce=this.featuresOnBorder.length-1;for(let $e=0;$e<C.borders.length;$e++)C.borders[$e][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[$e].push(Ce)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,h,_,m,S),this.groundEffect.addPaintPropertiesData(t,c,h,_,m,S),this.maxHeight=Math.max(this.maxHeight,V)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((s,c)=>this.featuresOnBorder[s].borders[t][0]-this.featuresOnBorder[c].borders[t][0])}splitToSubtiles(){const t=[];for(let w=0;w<this.centroidData.length;w++){const S=this.centroidData[w],P=+(S.min.y+S.max.y>ii),x=2*P+(+(S.min.x+S.max.x>ii)^P);for(let A=0;A<S.polygonSegLen;A++){const I=S.polygonSegIdx+A;t.push({centroidIdx:w,subtile:x,polygonSegmentIdx:I,triangleSegmentIdx:this.polygonSegments[I].triangleSegIdx})}}const s=new Xs;t.sort((w,S)=>w.triangleSegmentIdx===S.triangleSegmentIdx?w.subtile-S.subtile:w.triangleSegmentIdx-S.triangleSegmentIdx);let c=0,m=0,h=0;for(const w of t){if(w.triangleSegmentIdx!==c)break;h++}const _=t.length;for(;m!==t.length;){c=t[m].triangleSegmentIdx;let w=0,S=m,P=m;for(let x=S;x<h&&t[x].subtile===w;x++)P++;for(;S!==h;){const x=t[S];w=x.subtile;const A=this.centroidData[x.centroidIdx].min.clone(),I=this.centroidData[x.centroidIdx].max.clone(),E={vertexOffset:this.segments.segments[c].vertexOffset,primitiveOffset:s.length,vertexLength:this.segments.segments[c].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let C=S;C<P;C++){const R=t[C],z=this.polygonSegments[R.polygonSegmentIdx],V=this.centroidData[R.centroidIdx].min,W=this.centroidData[R.centroidIdx].max,Y=this.indexArray.uint16;for(let $=z.triangleArrayOffset;$<z.triangleArrayOffset+z.triangleCount;$++)s.emplaceBack(Y[3*$],Y[3*$+1],Y[3*$+2]);E.primitiveLength+=z.triangleCount,A.x=Math.min(A.x,V.x),A.y=Math.min(A.y,V.y),I.x=Math.max(I.x,W.x),I.y=Math.max(I.y,W.y)}E.primitiveLength>0&&this.triangleSubSegments.push({segment:E,min:A,max:I}),S=P;for(let C=S;C<h&&t[C].subtile===t[S].subtile;C++)P++}m=h;for(let x=m;x<_&&t[x].triangleSegmentIdx===t[m].triangleSegmentIdx;x++)h++}s._trim(),this.indexArray=s}getVisibleSegments(t,s,c){const m=new ts;if(this.wallMode){for(const R of this.triangleSubSegments)m.segments.push(R.segment);return m}let h=0,_=0;const w=1<<t.canonical.z;if(s){const R=s.getMinMaxForTile(t);R&&(h=R.min,_=R.max)}_+=this.maxHeight;const S=t.toUnwrapped();let P;const x=[S.canonical.x/w+S.wrap,S.canonical.y/w],A=[(S.canonical.x+1)/w+S.wrap,(S.canonical.y+1)/w],I=(R,z,V)=>[R[0]*(1-V[0])+z[0]*V[0],R[1]*(1-V[1])+z[1]*V[1]],E=[],C=[];for(const R of this.triangleSubSegments){E[0]=R.min.x/ii,E[1]=R.min.y/ii,C[0]=R.max.x/ii,C[1]=R.max.y/ii;const z=I(x,A,E),V=I(x,A,C);if(new Ai([z[0],z[1],h],[V[0],V[1],_]).intersectsPrecise(c)===0){P&&(m.segments.push(P),P=void 0);continue}const W=R.segment;P&&P.vertexOffset!==W.vertexOffset&&(m.segments.push(P),P=void 0),P?(P.vertexLength+=W.vertexLength,P.primitiveLength+=W.primitiveLength):P={vertexOffset:W.vertexOffset,primitiveLength:W.primitiveLength,vertexLength:W.vertexLength,primitiveOffset:W.primitiveOffset,sortKey:void 0,vaos:{}}}return P&&m.segments.push(P),m}encodeCentroid(t,s){const c=t.centroid(),m=s.span(),h=Math.min(7,Math.round(m.x*this.tileToMeter/10)),_=Math.min(7,Math.round(m.y*this.tileToMeter/10));return new ve(Ut(c.x,1,ii-1)<<3|h,Ut(c.y,1,ii-1)<<3|_)}encodeBorderCentroid(t){if(!t.borders)return new ve(0,0);const s=t.borders,c=Number.MAX_VALUE;if(s[0][0]!==c||s[1][0]!==c){const m=s[0][0]!==c?0:1;return new ve(6|(s[0][0]!==c?0:65528),(s[m][0]+s[m][1])/2<<3|6)}{const m=s[2][0]!==c?2:3;return new ve((s[m][0]+s[m][1])/2<<3|6,6|(s[2][0]!==c?0:65528))}}showCentroid(t){const s=this.centroidData[t.centroidDataIndex];s.flags&=Vh,s.centroidXY.x=0,s.centroidXY.y=0,this.writeCentroidToBuffer(s)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const s=t.vertexArrayOffset,c=t.vertexCount+t.vertexArrayOffset,m=t.flags&Vh?EC:t.centroidXY,h=this.centroidVertexArray.geta_centroid_pos0(s);if(this.centroidVertexArray.geta_centroid_pos1(s)!==m.y||h!==m.x){for(let _=s;_<c;++_)this.centroidVertexArray.emplace(_,m.x,m.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,s,c){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const m=s.getReplacementRegionsForTile(t.toUnwrapped());if(Vw(this.activeReplacements,m))return;if(this.activeReplacements=m,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const h=[];for(const _ of this.activeReplacements){if(_.order<c)continue;const w=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-t.canonical.z));for(const S of this.centroidData)if(!(S.flags&Vh||_.min.x>S.max.x||S.min.x>_.max.x||_.min.y>S.max.y||S.min.y>_.max.y))for(let P=0;P<S.footprintSegLen;P++){const x=this.footprintSegments[S.footprintSegIdx+P];if(h.length=0,X4(this.footprintVertices,x.vertexOffset,x.vertexCount,_.footprintTileId.canonical,t.canonical,h),vC(_.footprint,h,this.footprintIndices.uint16,x.indexOffset,x.indexCount,-x.vertexOffset,-w)){S.flags|=Vh;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,s,c){let m=!1;for(let h=0;h<c.footprintSegLen;h++){const _=this.footprintSegments[c.footprintSegIdx+h];let w=0;for(const S of _.ringIndices){for(let P=w,x=S+w-1;P<S+w;x=P++){const A=this.footprintVertices.int16[2*(P+_.vertexOffset)+0],I=this.footprintVertices.int16[2*(P+_.vertexOffset)+1],E=this.footprintVertices.int16[2*(x+_.vertexOffset)+1];I>s!=E>s&&t<(this.footprintVertices.int16[2*(x+_.vertexOffset)+0]-A)*(s-I)/(E-I)+A&&(m=!m)}w=S}}return m}getHeightAtTileCoord(t,s){let c=Number.NEGATIVE_INFINITY,m=!0;const h=4*(t+ii)*ii+(s+ii);if(this.partLookup.hasOwnProperty(h)){const _=this.partLookup[h];return _?{height:_.height,hidden:!!(_.flags&Vh)}:void 0}for(const _ of this.centroidData)t>_.max.x||_.min.x>t||s>_.max.y||_.min.y>s||this.footprintContainsPoint(t,s,_)&&_&&_.height>c&&(c=_.height,this.partLookup[h]=_,m=!!(_.flags&Vh));if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:m};this.partLookup[h]=void 0}}function PC(l,t){const s=l.add(t)._unit();return l.x*s.x+l.y*s.y}function Y4(l,t,s,c){const m=t.sub(l)._perp()._unit(),h=s.sub(t)._perp()._unit();return RC(l,t,s,PC(m,h),c)}function RC(l,t,s,c,m){const h=Math.sqrt(1-c*c);return Math.min(l.dist(t)/3,t.dist(s)/3,m*h/c)}function $w(l,t,s){return l.x<s[0].x&&t.x<s[0].x||l.x>s[1].x&&t.x>s[1].x||l.y<s[0].y&&t.y<s[0].y||l.y>s[1].y&&t.y>s[1].y}function DC(l,t){return l.x<t[0].x||l.x>t[1].x||l.y<t[0].y||l.y>t[1].y}function OC(l,t,s){if(l.x<0||l.x>=ii||t.x<0||t.x>=ii||s.x<0||s.x>=ii)return!1;const c=s.sub(t),m=c.perp(),h=l.sub(t);return(c.x*h.x+c.y*h.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(h.x*h.x+h.y*h.y))>-.866&&m.x*h.x+m.y*h.y<0}function LC(l,t,s){const c=t?2|l:-3&l;return s?1|c:-2&c}function kC(){const l=Math.PI/32,t=Math.tan(l),s=Lu;return s*Math.sqrt(1+2*t*t)-s}function zC(l,t,s){const c=1<<s.z,m=$o(s.x/c),h=$o((s.x+1)/c),_=Ks(s.y/c),w=Ks((s.y+1)/c);return function(S,P,x,A,I=0,E){const C=[];if(!S.length||!x||!A)return C;const R=(ie,ge)=>{for(const Pe of ie)C.push({polygon:Pe,bounds:ge})},z=Math.ceil(Math.log2(x)),V=Math.ceil(Math.log2(A)),W=z-V,Y=[];for(let ie=0;ie<Math.abs(W);ie++)Y.push(W>0?0:1);for(let ie=0;ie<Math.min(z,V);ie++)Y.push(0),Y.push(1);let $=S;if($=z1($,P[0].y-I,P[1].y+I,1),$=z1($,P[0].x-I,P[1].x+I,0),!$.length)return C;const J=[];for(Y.length?J.push({polygons:$,bounds:P,depth:0}):R($,P);J.length;){const ie=J.pop(),ge=ie.depth,Pe=Y[ge],Me=ie.bounds[0],Ce=ie.bounds[1],$e=Pe===0?Me.x:Me.y,Re=Pe===0?Ce.x:Ce.y,He=E?E(Pe,$e,Re):.5*($e+Re),Je=z1(ie.polygons,$e-I,He+I,Pe),Xe=z1(ie.polygons,He-I,Re+I,Pe);if(Je.length){const tt=[Me,new ve(Pe===0?He:Ce.x,Pe===1?He:Ce.y)];Y.length>ge+1?J.push({polygons:Je,bounds:tt,depth:ge+1}):R(Je,tt)}if(Xe.length){const tt=[new ve(Pe===0?He:Me.x,Pe===1?He:Me.y),Ce];Y.length>ge+1?J.push({polygons:Xe,bounds:tt,depth:ge+1}):R(Xe,tt)}}return C}(l,t,Math.ceil((h-m)/11.25),Math.ceil((_-w)/11.25),1,(S,P,x)=>{if(S===0)return .5*(P+x);{const A=Ks((s.y+P/ii)/c);return(nl(.5*(Ks((s.y+x/ii)/c)+A))*c-s.y)*ii}})}function X4(l,t,s,c,m,h){const _=Math.pow(2,c.z-m.z);for(let w=0;w<s;w++){let S=l.int16[2*(w+t)+0],P=l.int16[2*(w+t)+1];S=(S+m.x*ii)*_-c.x*ii,P=(P+m.y*ii)*_-c.y*ii,h.push(new ve(S,P))}}let FC,BC;function Wg(l,t){return l.x*t.x+l.y*t.y}function NC(l,t){if(l.length===1){let s=0;const c=t[s++];let m;for(;!m||c.equals(m);)if(m=t[s++],!m)return 1/0;for(;s<t.length;s++){const h=t[s],_=l[0],w=m.sub(c),S=h.sub(c),P=_.sub(c),x=Wg(w,w),A=Wg(w,S),I=Wg(S,S),E=Wg(P,w),C=Wg(P,S),R=x*I-A*A,z=(I*E-A*C)/R,V=(x*C-A*E)/R,W=c.z*(1-z-V)+m.z*z+h.z*V;if(isFinite(W))return W}return 1/0}{let s=1/0;for(const c of t)s=Math.min(s,c.z);return s}}function VC(l,t,s,c,m,h,_,w){const S=_*m.getElevationAt(l,t,!0,!0),P=h[0]!==0,x=P?h[1]===0?_*(h[0]/7-450):_*function(A,I,E){const C=Math.floor(I[0]/8),R=Math.floor(I[1]/8),z=10*(I[0]-8*C),V=10*(I[1]-8*R),W=A.getElevationAt(C,R,!0,!0),Y=A.getMeterToDEM(E),$=Math.floor(.5*(z*Y-1)),J=Math.floor(.5*(V*Y-1)),ie=A.tileCoordToPixel(C,R),ge=2*$+1,Pe=2*J+1,Me=function(Xe,tt,at,ft,nt){return[Xe.getElevationAtPixel(tt,at,!0),Xe.getElevationAtPixel(tt+nt,at,!0),Xe.getElevationAtPixel(tt,at+nt,!0),Xe.getElevationAtPixel(tt+ft,at+nt,!0)]}(A,ie.x-$,ie.y-J,ge,Pe),Ce=Math.abs(Me[0]-Me[1]),$e=Math.abs(Me[2]-Me[3]),Re=Math.abs(Me[0]-Me[2])+Math.abs(Me[1]-Me[3]),He=Math.min(.25,.5*Y*(Ce+$e)/ge),Je=Math.min(.25,.5*Y*Re/Pe);return W+Math.max(He*z,Je*V)}(m,h,w):S;return{base:S+(s===0?-1:s),top:P?Math.max(x+c,S+s+2):S+c}}gi(V1,"FillExtrusionBucket",{omit:["layers","features"]}),gi(AC,"PartData"),gi(SC,"FootprintSegment"),gi(CC,"BorderCentroidData"),gi(IC,"GroundEffect");const K4=qr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),J4=qr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Q4}=K4,eF=qr([{name:"a_packed",components:3,type:"Float32"}]),{members:tF}=eF,iF=qr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:rF}=iF;class UC{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.image=new Nh({width:t,height:s}),this.positions={},this.uploaded=!1}getDash(t,s){const c=this.getKey(t,s);return this.positions[c]}trim(){const t=this.width,s=this.height=Yr(this.nextRow);this.image.resize({width:t,height:s})}getKey(t,s){return t.join(",")+s}getDashRanges(t,s,c){const m=[];let h=t.length%2==1?-t[t.length-1]*c:0,_=t[0]*c,w=!0;m.push({left:h,right:_,isDash:w,zeroLength:t[0]===0});let S=t[0];for(let P=1;P<t.length;P++){w=!w;const x=t[P];h=S*c,S+=x,_=S*c,m.push({left:h,right:_,isDash:w,zeroLength:x===0})}return m}addRoundDash(t,s,c){const m=s/2;for(let h=-c;h<=c;h++){const _=this.width*(this.nextRow+c+h);let w=0,S=t[w];for(let P=0;P<this.width;P++){P/S.right>1&&(S=t[++w]);const x=Math.abs(P-S.left),A=Math.abs(P-S.right),I=Math.min(x,A);let E;const C=h/c*(m+1);if(S.isDash){const R=m-Math.abs(C);E=Math.sqrt(I*I+R*R)}else E=m-Math.sqrt(I*I+C*C);this.image.data[_+P]=Math.max(0,Math.min(255,E+128))}}}addRegularDash(t,s){for(let S=t.length-1;S>=0;--S){const P=t[S],x=t[S+1];P.zeroLength?t.splice(S,1):x&&x.isDash===P.isDash&&(x.left=P.left,t.splice(S,1))}const c=t[0],m=t[t.length-1];c.isDash===m.isDash&&(c.left=m.left-this.width,m.right=c.right+this.width);const h=this.width*this.nextRow;let _=0,w=t[_];for(let S=0;S<this.width;S++){S/w.right>1&&(w=t[++_]);const P=Math.abs(S-w.left),x=Math.abs(S-w.right),A=Math.min(P,x);this.image.data[h+S]=Math.max(0,Math.min(255,(w.isDash?A:-A)+s+128))}}addDash(t,s){const c=this.getKey(t,s);if(this.positions[c])return this.positions[c];const m=s==="round",h=m?7:0,_=2*h+1;if(this.nextRow+_>this.height)return Vi("LineAtlas out of space"),null;t.length===0&&t.push(1);let w=0;for(let x=0;x<t.length;x++)t[x]<0&&(Vi("Negative value is found in line dasharray, replacing values with 0"),t[x]=0),w+=t[x];if(w!==0){const x=this.width/w,A=this.getDashRanges(t,this.width,x);m?this.addRoundDash(A,x,h):this.addRegularDash(A,s==="square"?.5*x:0)}const S=this.nextRow+h;this.nextRow+=_;const P={tl:[S,h],br:[w,0]};return this.positions[c]=P,P}}gi(UC,"LineAtlas");const nF=dm.VectorTileFeature.types,sF=Math.cos(Math.PI/180*37.5),oF=Math.cos(Math.PI/180*5);class qw{constructor(t){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=t.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=t.overscaling,this.pixelRatio=t.pixelRatio,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new hf,this.layoutVertexArray2=new kl,this.patternVertexArray=new kl,this.indexArray=new Xs,this.programConfigurations=new Wc(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new ts,this.maxLineLength=0,this.zOffsetVertexArray=new kl,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.tessellationStep=t.tessellationStep?t.tessellationStep:ii/64}updateFootprints(t,s){}populate(t,s,c,m){this.hasPattern=Dw("line",this.layers,this.pixelRatio,s);const h=this.layers[0].layout.get("line-sort-key");this.tileToMeter=i(c);const _=this.layers[0].layout.get("line-z-offset"),w=_.isConstant()&&!_.constantOr(0),S=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=S==="sea"||S==="ground"||!w&&S==="none",this.hasZOffset&&S==="none"&&Vi(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const P=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&P!==void 0;const x=[];for(const{feature:C,id:R,index:z,sourceLayerIndex:V}of t){const W=this.layers[0]._featureFilter.needGeometry,Y=U(C,W);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),Y,c))continue;const $=h?h.evaluate(Y,{},c):void 0,J={id:R,properties:C.properties,type:C.type,sourceLayerIndex:V,index:z,geometry:W?Y.geometry:k(C,c,m),patterns:{},sortKey:$};x.push(J)}h&&x.sort((C,R)=>C.sortKey-R.sortKey);const{lineAtlas:A,featureIndex:I}=s,E=this.addConstantDashes(A);for(const C of x){const{geometry:R,index:z,sourceLayerIndex:V}=C;if(E&&this.addFeatureDashes(C,A),this.hasPattern){const W=Ow("line",this.layers,C,this.zoom,this.pixelRatio,s);this.patternFeatures.push(W)}else this.addFeature(C,R,z,c,A.positions,s.availableImages,s.brightness);I.insert(t[z].feature,R,z,V,this.index)}}addConstantDashes(t){let s=!1;for(const c of this.layers){const m=c.paint.get("line-dasharray").value,h=c.layout.get("line-cap").value;if(m.kind!=="constant"||h.kind!=="constant")s=!0;else{const _=h.value,w=m.value;if(!w)continue;t.addDash(w,_)}}return s}addFeatureDashes(t,s){const c=this.zoom;for(const m of this.layers){const h=m.paint.get("line-dasharray").value,_=m.layout.get("line-cap").value;if(h.kind==="constant"&&_.kind==="constant")continue;let w,S;if(h.kind==="constant"){if(w=h.value,!w)continue}else w=h.evaluate({zoom:c},t);S=_.kind==="constant"?_.value:_.evaluate({zoom:c},t),s.addDash(w,S),t.patterns[m.id]=s.getKey(w,S)}}update(t,s,c,m,h,_,w){this.programConfigurations.updatePaintArrays(t,s,h,c,m,_,w)}addFeatures(t,s,c,m,h,_){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,s,c,m,_)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,tF)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=t.createVertexBuffer(this.patternVertexArray,rF)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,J4.members,!0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Q4),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,s,c,m,h,_,w){const S=this.layers[0].layout,P=S.get("line-join").evaluate(t,{}),x=S.get("line-cap").evaluate(t,{}),A=S.get("line-miter-limit"),I=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(t),this.lineFeature=t,this.zOffsetValue=S.get("line-z-offset").value;const E=this.layers[0].paint.get("line-width").value;E.kind!=="constant"&&E.isLineProgressConstant===!1&&(this.variableWidthValue=E);for(const C of s)this.addLine(C,t,m,P,x,A,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,h,_,m,w)}addLine(t,s,c,m,h,_,w){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const S=m==="none";if(this.patternJoinNone=this.hasPattern&&S,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Y=0;Y<t.length-1;Y++)this.totalDistance+=t[Y].dist(t[Y+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const P=nF[s.type]==="Polygon";let x=t.length;for(;x>=2&&t[x-1].equals(t[x-2]);)x--;let A=0;for(;A<x-1&&t[A].equals(t[A+1]);)A++;if(x<(P?3:2))return;m==="bevel"&&(_=1.05);const I=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let E,C,R,z,V,W;this.e1=this.e2=-1,P&&(E=t[x-2],V=t[A].sub(E)._unit()._perp());for(let Y=A;Y<x;Y++){if(R=Y===x-1?P?t[A+1]:void 0:t[Y+1],R&&t[Y].equals(R))continue;V&&(z=V),E&&(C=E),E=t[Y],W=this.evaluateLineProgressFeatures(C?C.dist(E):0),V=R?R.sub(E)._unit()._perp():z,z=z||V;const $=C&&R;let J=$?m:P||S?"butt":h;const ie=z.x*V.x+z.y*V.y;if(S){const Je=function(Xe){if(Xe.patternJoinNone){const tt=Xe.segmentPoints.length/2,at=Xe.lineSoFar-Xe.segmentStart;for(let ft=0;ft<tt;++ft){const nt=Xe.segmentPoints[2*ft+1],Mt=Math.round(Xe.segmentPoints[2*ft])+.5+.25*nt;Xe.patternVertexArray.emplaceBack(Mt,at,Xe.segmentStart),Xe.patternVertexArray.emplaceBack(Mt,at,Xe.segmentStart)}Xe.segmentPoints.length=0}Xe.e1=Xe.e2=-1};if($&&ie<oF){this.updateDistance(C,E),this.addCurrentVertex(E,z,1,1,I,W),Je(this),this.addCurrentVertex(E,V,-1,-1,I,W);continue}if(C){if(!R){this.updateDistance(C,E),this.addCurrentVertex(E,z,1,1,I,W),Je(this);continue}J="miter"}}let ge=z.add(V);ge.x===0&&ge.y===0||ge._unit();const Pe=ge.x*V.x+ge.y*V.y,Me=Pe!==0?1/Pe:1/0,Ce=2*Math.sqrt(2-2*Pe),$e=Pe<sF&&C&&R,Re=z.x*V.y-z.y*V.x>0,He=this.overscaling<=16?15*ii/(512*this.overscaling):0;if($&&J==="round"){if(Me<w)J="miter";else if(Me<=2){const Je=Hw(E,-10,ii+10);J=this.hasZOffset&&(Je||this.hasCrossSlope)?"miter":"fakeround"}}if(J==="miter"&&Me>_&&(J="bevel"),J==="bevel"&&(Me>2&&(J="flipbevel"),Me<_&&(J="miter")),C&&!(J==="miter"&&$e)&&this.updateDistance(C,E),J==="miter")if($e){const Je=E.dist(C);if(Je>2*He){const tt=E.sub(E.sub(C)._mult(He/Je)._round());this.updateDistance(C,tt),this.addCurrentVertex(tt,z,0,0,I,W),C=tt}this.updateDistance(C,E),ge._mult(Me),this.addCurrentVertex(E,ge,0,0,I,W);const Xe=E.dist(R);if(Xe>2*He){const tt=E.add(R.sub(E)._mult(He/Xe)._round());this.updateDistance(E,tt),this.addCurrentVertex(tt,V,0,0,I,W),E=tt}}else ge._mult(Me),this.addCurrentVertex(E,ge,0,0,I,W);else if(J==="flipbevel"){if(Me>100)ge=V.mult(-1);else{const Je=Me*z.add(V).mag()/z.sub(V).mag();ge._perp()._mult(Je*(Re?-1:1))}this.addCurrentVertex(E,ge,0,0,I,W),this.addCurrentVertex(E,ge.mult(-1),0,0,I,W)}else if(J==="bevel"||J==="fakeround"){W!=null&&C&&this.addCurrentVertex(E,z,-1,-1,I,W);const Je=E.dist(C)<=2*He&&J!=="bevel",Xe=ge.mult(Re?1:-1);Xe._mult(Me);const tt=V.mult(Re?-1:1),at=z.mult(Re?-1:1),ft=this.evaluateLineProgressFeatures(this.distance);if(W==null&&(this.addHalfVertex(E,Xe.x,Xe.y,!1,!Re,0,I,ft),Je||this.addHalfVertex(E,Xe.x+2*at.x,Xe.y+2*at.y,!1,Re,0,I,ft)),J==="fakeround"){const nt=Math.round(180*Ce/Math.PI/20);this.addHalfVertex(E,at.x,at.y,!1,Re,0,I,ft);for(let Mt=0;Mt<nt;Mt++){let Ft=Mt/nt;if(Ft!==.5){const si=Ft-.5;Ft+=Ft*si*(Ft-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*si*si+(.848013+ie*(.215638*ie-1.06021)))}const Ct=tt.sub(at)._mult(Ft)._add(at)._unit();this.addHalfVertex(E,Ct.x,Ct.y,!1,Re,0,I,ft)}this.addHalfVertex(E,tt.x,tt.y,!1,Re,0,I,ft)}Je||W!=null||this.addHalfVertex(E,Xe.x+2*tt.x,Xe.y+2*tt.y,!1,Re,0,I,ft),W!=null&&R&&this.addCurrentVertex(E,V,1,1,I,W)}else J==="butt"?this.addCurrentVertex(E,ge,0,0,I,W):J==="square"?(C||this.addCurrentVertex(E,ge,-1,-1,I,W),this.addCurrentVertex(E,ge,0,0,I,W),C&&this.addCurrentVertex(E,ge,1,1,I,W)):J==="round"&&(C&&(this.addCurrentVertex(E,z,0,0,I,W),this.addCurrentVertex(E,z,1,1,I,W,!0)),R&&(this.addCurrentVertex(E,V,-1,-1,I,W,!0),this.addCurrentVertex(E,V,0,0,I,W)))}}addVerticesTo(t,s,c,m,h,_,w,S,P,x){const A=(s.w-t.w)/this.tessellationStep|0;let I=0;const E=this.scaledDistance;if(A>1){this.lineSoFar=t.w;const R=(s.x-t.x)/A,z=(s.y-t.y)/A,V=(s.z-t.z)/A,W=(s.w-t.w)/A;for(let Y=1;Y<A;++Y){t.x+=R,t.y+=z,t.z+=V,this.lineSoFar+=W,I+=W;const $=this.evaluateLineProgressFeatures(this.prevDistance+I);this.scaledDistance=(this.prevDistance+I)/this.totalDistance,this.addHalfVertex(t,c,m,x,!1,w,P,$),this.addHalfVertex(t,h,_,x,!0,-S,P,$)}}this.lineSoFar=s.w,this.scaledDistance=E;const C=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(s,c,m,x,!1,w,P,C),this.addHalfVertex(s,h,_,x,!0,-S,P,C)}evaluateLineProgressFeatures(t){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+t)/this.totalFeatureLength):Vi(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let s=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(s=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:s}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:s}:{zOffset:0,variableWidth:s}}addCurrentVertex(t,s,c,m,h,_,w=!1){const S=s.x+s.y*c,P=s.y-s.x*c,x=s.y*m-s.x,A=-s.y-s.x*m;if(_!=null){const I=this.hasZOffset,E=-10,C=ii+10,R=_.zOffset,z=new fC(t.x,t.y,R,this.lineSoFar),V=!!I&&Hw(t,E,C),W=this.lineSoFar,Y=this.distance;if(this.currentVertex)if(V){const $=this.currentVertexIsOutside,J=this.currentVertex,ie=new fC(t.x,t.y,R,this.lineSoFar);if(mC(J,ie,E,C),!Hw(ie,E,C)){if($){this.e1=this.e2=-1,this.distance-=J.dist(z),this.lineSoFar=J.w;const ge=this.evaluateLineProgressFeatures(J.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(J,S,P,w,!1,c,h,ge),this.addHalfVertex(J,x,A,w,!0,-m,h,ge),this.prevDistance=this.distance}this.distance=this.prevDistance+J.dist(ie),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(J,ie,S,P,x,A,c,m,h,w),this.distance=Y,this.scaledDistance=this.distance/this.totalDistance}}else{const $=this.currentVertex;if(this.currentVertexIsOutside){mC($,z,E,C),this.e1=this.e2=-1,this.distance-=$.dist(z),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=$.w;const J=this.evaluateLineProgressFeatures($.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex($,S,P,w,!1,c,h,J),this.addHalfVertex($,x,A,w,!0,-m,h,J),this.prevDistance=this.distance,this.distance=Y,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo($,z,S,P,x,A,c,m,h,w)}else V||(this.addHalfVertex(t,S,P,w,!1,c,h,_),this.addHalfVertex(t,x,A,w,!0,-m,h,_));this.currentVertex=z,this.currentVertexIsOutside=V,this.lineSoFar=W}else this.addHalfVertex(t,S,P,w,!1,c,h,_),this.addHalfVertex(t,x,A,w,!0,-m,h,_)}addHalfVertex({x:t,y:s},c,m,h,_,w,S,P){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,w)),this.layoutVertexArray.emplaceBack((t<<1)+(h?1:0),(s<<1)+(_?1:0),Math.round(63*c)+128,Math.round(63*m)+128,1+(w===0?0:w<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const A=Bi(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,A)}const x=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),S.primitiveLength++),_?this.e2=x:this.e1=x,P!=null&&this.zOffsetVertexArray.emplaceBack(P.zOffset,P.variableWidth,P.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(t,s){this.prevDistance=this.distance,this.distance+=t.dist(s),this.updateScaledDistance()}}function Hw(l,t,s){return l.x<t||l.x>s||l.y<t||l.y>s}let jC,$C;function qC(l,t,s){return t*(ii/(l.tileSize*Math.pow(2,s-l.tileID.overscaledZ)))}gi(qw,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const HC=(l,t,s)=>(1-s)*l+s*t;function GC(l,t){return 1/qC(l,1,t.tileZoom)}function WC(l,t,s,c){return l.translatePosMatrix(c||t.tileID.projMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const ZC=l=>{const t=[];YC(l)&&t.push("RENDER_LINE_DASH"),l.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const s=l.paint.get("line-trim-offset");s[0]===0&&s[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),l.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER");const c=l.layout.get("line-join").constantOr("miter")==="none",m=!!l.paint.get("line-pattern").constantOr(1);return c&&m&&t.push("LINE_JOIN_NONE"),t};function YC(l){const t=l.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}let Gw;const XC=()=>Gw||(Gw={layout:jC||(jC=new Bn({"line-cap":new hi(gt.layout_line["line-cap"]),"line-join":new hi(gt.layout_line["line-join"]),"line-miter-limit":new Xt(gt.layout_line["line-miter-limit"]),"line-round-limit":new Xt(gt.layout_line["line-round-limit"]),"line-sort-key":new hi(gt.layout_line["line-sort-key"]),"line-z-offset":new hi(gt.layout_line["line-z-offset"]),"line-elevation-reference":new Xt(gt.layout_line["line-elevation-reference"]),"line-cross-slope":new Xt(gt.layout_line["line-cross-slope"]),visibility:new Xt(gt.layout_line.visibility),"line-width-unit":new Xt(gt.layout_line["line-width-unit"])})),paint:$C||($C=new Bn({"line-opacity":new hi(gt.paint_line["line-opacity"]),"line-color":new hi(gt.paint_line["line-color"]),"line-translate":new Xt(gt.paint_line["line-translate"]),"line-translate-anchor":new Xt(gt.paint_line["line-translate-anchor"]),"line-width":new hi(gt.paint_line["line-width"]),"line-gap-width":new hi(gt.paint_line["line-gap-width"]),"line-offset":new hi(gt.paint_line["line-offset"]),"line-blur":new hi(gt.paint_line["line-blur"]),"line-dasharray":new hi(gt.paint_line["line-dasharray"]),"line-pattern":new hi(gt.paint_line["line-pattern"]),"line-gradient":new Ih(gt.paint_line["line-gradient"]),"line-trim-offset":new Xt(gt.paint_line["line-trim-offset"]),"line-trim-fade-range":new Xt(gt.paint_line["line-trim-fade-range"]),"line-trim-color":new Xt(gt.paint_line["line-trim-color"]),"line-emissive-strength":new Xt(gt.paint_line["line-emissive-strength"]),"line-border-width":new hi(gt.paint_line["line-border-width"]),"line-border-color":new hi(gt.paint_line["line-border-color"]),"line-occlusion-opacity":new Xt(gt.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"})}))},Gw);class aF extends hi{possiblyEvaluate(t,s){return s=new bn(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,transition:s.transition}),super.possiblyEvaluate(t,s)}evaluate(t,s,c,m){return s=Ki({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(t,s,c,m)}}let Zg;function KC(l,t){return t>0?t+2*l:l}const lF=qr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),cF=qr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),uF=qr([{name:"a_projected_pos",components:4,type:"Float32"}],4);qr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const hF=qr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),dF=qr([{name:"a_texb",components:2,type:"Uint16"}]),fF=qr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),pF=qr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);qr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const JC=qr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),mF=qr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);qr([{name:"triangle",components:3,type:"Uint16"}]),qr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),qr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),qr([{type:"Float32",name:"offsetX"}]),qr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var mo=24;const yc=128;function Ww(l,t,s,c,m){if(l.kind==="camera")return l.maxSize;if(l.kind==="composite"){const h=t.possiblyEvaluate(new bn(l.maxZoom),s).evaluate(m,{},s),_=t.possiblyEvaluate(new bn(l.minZoom),s).evaluate(m,{},s);return Math.max(h,_)}return t.possiblyEvaluate(new bn(c)).evaluate(m,{},s)}function Zw(l,t){const{expression:s}=t;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new bn(l+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:m}=s;let h=0;for(;h<c.length&&c[h]<=l;)h++;h=Math.max(0,h-1);let _=h;for(;_<c.length&&c[_]<l+1;)_++;_=Math.min(c.length-1,_);const w=c[h],S=c[_];return s.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:S,interpolationType:m}:{kind:"camera",minZoom:w,maxZoom:S,minSize:s.evaluate(new bn(w)),maxSize:s.evaluate(new bn(S)),interpolationType:m}}}function U1(l,{uSize:t,uSizeT:s},{lowerSize:c,upperSize:m}){return l.kind==="source"?c/yc:l.kind==="composite"?Bi(c/yc,m/yc,s):t}function fm(l,t,s=1){let c=0,m=0;if(l.kind==="constant")m=l.layoutSize*s;else if(l.kind!=="source"){const{interpolationType:h,minZoom:_,maxZoom:w}=l,S=h?Ut(Vo.interpolationFactor(h,t,_,w),0,1):0;l.kind==="camera"?m=Bi(l.minSize,l.maxSize,S)*s:c=S*s}return{uSizeT:c,uSize:m}}var _F=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:yc,evaluateSizeForFeature:U1,evaluateSizeForZoom:fm,getRasterizedIconSize:Ww,getSizeData:Zw});function gF(l,t,s){return l.sections.forEach(c=>{c.text=function(m,h,_){const w=h.layout.get("text-transform").evaluate(_,{});return w==="uppercase"?m=m.toLocaleUpperCase():w==="lowercase"&&(m=m.toLocaleLowerCase()),la.applyArabicShaping&&(m=la.applyArabicShaping(m)),m}(c.text,t,s)}),l}const Yg={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function yF(l){return l==="︶"||l==="﹈"||l==="︸"||l==="﹄"||l==="﹂"||l==="︾"||l==="︼"||l==="︺"||l==="︘"||l==="﹀"||l==="︐"||l==="︓"||l==="︔"||l==="｀"||l==="￣"||l==="︑"||l==="︒"}function vF(l){return l==="︵"||l==="﹇"||l==="︷"||l==="﹃"||l==="﹁"||l==="︽"||l==="︻"||l==="︹"||l==="︗"||l==="︿"}var QC,Yw,eM,Xw={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function xF(){return QC||(QC=1,Xw.read=function(l,t,s,c,m){var h,_,w=8*m-c-1,S=(1<<w)-1,P=S>>1,x=-7,A=s?m-1:0,I=s?-1:1,E=l[t+A];for(A+=I,h=E&(1<<-x)-1,E>>=-x,x+=w;x>0;h=256*h+l[t+A],A+=I,x-=8);for(_=h&(1<<-x)-1,h>>=-x,x+=c;x>0;_=256*_+l[t+A],A+=I,x-=8);if(h===0)h=1-P;else{if(h===S)return _?NaN:1/0*(E?-1:1);_+=Math.pow(2,c),h-=P}return(E?-1:1)*_*Math.pow(2,h-c)},Xw.write=function(l,t,s,c,m,h){var _,w,S,P=8*h-m-1,x=(1<<P)-1,A=x>>1,I=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,E=c?0:h-1,C=c?1:-1,R=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(w=isNaN(t)?1:0,_=x):(_=Math.floor(Math.log(t)/Math.LN2),t*(S=Math.pow(2,-_))<1&&(_--,S*=2),(t+=_+A>=1?I/S:I*Math.pow(2,1-A))*S>=2&&(_++,S/=2),_+A>=x?(w=0,_=x):_+A>=1?(w=(t*S-1)*Math.pow(2,m),_+=A):(w=t*Math.pow(2,A-1)*Math.pow(2,m),_=0));m>=8;l[s+E]=255&w,E+=C,w/=256,m-=8);for(_=_<<m|w,P+=m;P>0;l[s+E]=255&_,E+=C,_/=256,P-=8);l[s+E-C]|=128*R}),Xw}function tM(){if(eM)return Yw;eM=1,Yw=t;var l=xF();function t($){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView($)?$:new Uint8Array($||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var s=4294967296,c=1/s,m=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function h($){return $.type===t.Bytes?$.readVarint()+$.pos:$.pos+1}function _($,J,ie){return ie?4294967296*J+($>>>0):4294967296*(J>>>0)+($>>>0)}function w($,J,ie){var ge=J<=16383?1:J<=2097151?2:J<=268435455?3:Math.floor(Math.log(J)/(7*Math.LN2));ie.realloc(ge);for(var Pe=ie.pos-1;Pe>=$;Pe--)ie.buf[Pe+ge]=ie.buf[Pe]}function S($,J){for(var ie=0;ie<$.length;ie++)J.writeVarint($[ie])}function P($,J){for(var ie=0;ie<$.length;ie++)J.writeSVarint($[ie])}function x($,J){for(var ie=0;ie<$.length;ie++)J.writeFloat($[ie])}function A($,J){for(var ie=0;ie<$.length;ie++)J.writeDouble($[ie])}function I($,J){for(var ie=0;ie<$.length;ie++)J.writeBoolean($[ie])}function E($,J){for(var ie=0;ie<$.length;ie++)J.writeFixed32($[ie])}function C($,J){for(var ie=0;ie<$.length;ie++)J.writeSFixed32($[ie])}function R($,J){for(var ie=0;ie<$.length;ie++)J.writeFixed64($[ie])}function z($,J){for(var ie=0;ie<$.length;ie++)J.writeSFixed64($[ie])}function V($,J){return($[J]|$[J+1]<<8|$[J+2]<<16)+16777216*$[J+3]}function W($,J,ie){$[ie]=J,$[ie+1]=J>>>8,$[ie+2]=J>>>16,$[ie+3]=J>>>24}function Y($,J){return($[J]|$[J+1]<<8|$[J+2]<<16)+($[J+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function($,J,ie){for(ie=ie||this.length;this.pos<ie;){var ge=this.readVarint(),Pe=ge>>3,Me=this.pos;this.type=7&ge,$(Pe,J,this),this.pos===Me&&this.skip(ge)}return J},readMessage:function($,J){return this.readFields($,J,this.readVarint()+this.pos)},readFixed32:function(){var $=V(this.buf,this.pos);return this.pos+=4,$},readSFixed32:function(){var $=Y(this.buf,this.pos);return this.pos+=4,$},readFixed64:function(){var $=V(this.buf,this.pos)+V(this.buf,this.pos+4)*s;return this.pos+=8,$},readSFixed64:function(){var $=V(this.buf,this.pos)+Y(this.buf,this.pos+4)*s;return this.pos+=8,$},readFloat:function(){var $=l.read(this.buf,this.pos,!0,23,4);return this.pos+=4,$},readDouble:function(){var $=l.read(this.buf,this.pos,!0,52,8);return this.pos+=8,$},readVarint:function($){var J,ie,ge=this.buf;return J=127&(ie=ge[this.pos++]),ie<128?J:(J|=(127&(ie=ge[this.pos++]))<<7,ie<128?J:(J|=(127&(ie=ge[this.pos++]))<<14,ie<128?J:(J|=(127&(ie=ge[this.pos++]))<<21,ie<128?J:function(Pe,Me,Ce){var $e,Re,He=Ce.buf;if($e=(112&(Re=He[Ce.pos++]))>>4,Re<128||($e|=(127&(Re=He[Ce.pos++]))<<3,Re<128)||($e|=(127&(Re=He[Ce.pos++]))<<10,Re<128)||($e|=(127&(Re=He[Ce.pos++]))<<17,Re<128)||($e|=(127&(Re=He[Ce.pos++]))<<24,Re<128)||($e|=(1&(Re=He[Ce.pos++]))<<31,Re<128))return _(Pe,$e,Me);throw new Error("Expected varint not more than 10 bytes")}(J|=(15&(ie=ge[this.pos]))<<28,$,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var $=this.readVarint();return $%2==1?($+1)/-2:$/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var $=this.readVarint()+this.pos,J=this.pos;return this.pos=$,$-J>=12&&m?function(ie,ge,Pe){return m.decode(ie.subarray(ge,Pe))}(this.buf,J,$):function(ie,ge,Pe){for(var Me="",Ce=ge;Ce<Pe;){var $e,Re,He,Je=ie[Ce],Xe=null,tt=Je>239?4:Je>223?3:Je>191?2:1;if(Ce+tt>Pe)break;tt===1?Je<128&&(Xe=Je):tt===2?(192&($e=ie[Ce+1]))==128&&(Xe=(31&Je)<<6|63&$e)<=127&&(Xe=null):tt===3?(Re=ie[Ce+2],(192&($e=ie[Ce+1]))==128&&(192&Re)==128&&((Xe=(15&Je)<<12|(63&$e)<<6|63&Re)<=2047||Xe>=55296&&Xe<=57343)&&(Xe=null)):tt===4&&(Re=ie[Ce+2],He=ie[Ce+3],(192&($e=ie[Ce+1]))==128&&(192&Re)==128&&(192&He)==128&&((Xe=(15&Je)<<18|(63&$e)<<12|(63&Re)<<6|63&He)<=65535||Xe>=1114112)&&(Xe=null)),Xe===null?(Xe=65533,tt=1):Xe>65535&&(Xe-=65536,Me+=String.fromCharCode(Xe>>>10&1023|55296),Xe=56320|1023&Xe),Me+=String.fromCharCode(Xe),Ce+=tt}return Me}(this.buf,J,$)},readBytes:function(){var $=this.readVarint()+this.pos,J=this.buf.subarray(this.pos,$);return this.pos=$,J},readPackedVarint:function($,J){if(this.type!==t.Bytes)return $.push(this.readVarint(J));var ie=h(this);for($=$||[];this.pos<ie;)$.push(this.readVarint(J));return $},readPackedSVarint:function($){if(this.type!==t.Bytes)return $.push(this.readSVarint());var J=h(this);for($=$||[];this.pos<J;)$.push(this.readSVarint());return $},readPackedBoolean:function($){if(this.type!==t.Bytes)return $.push(this.readBoolean());var J=h(this);for($=$||[];this.pos<J;)$.push(this.readBoolean());return $},readPackedFloat:function($){if(this.type!==t.Bytes)return $.push(this.readFloat());var J=h(this);for($=$||[];this.pos<J;)$.push(this.readFloat());return $},readPackedDouble:function($){if(this.type!==t.Bytes)return $.push(this.readDouble());var J=h(this);for($=$||[];this.pos<J;)$.push(this.readDouble());return $},readPackedFixed32:function($){if(this.type!==t.Bytes)return $.push(this.readFixed32());var J=h(this);for($=$||[];this.pos<J;)$.push(this.readFixed32());return $},readPackedSFixed32:function($){if(this.type!==t.Bytes)return $.push(this.readSFixed32());var J=h(this);for($=$||[];this.pos<J;)$.push(this.readSFixed32());return $},readPackedFixed64:function($){if(this.type!==t.Bytes)return $.push(this.readFixed64());var J=h(this);for($=$||[];this.pos<J;)$.push(this.readFixed64());return $},readPackedSFixed64:function($){if(this.type!==t.Bytes)return $.push(this.readSFixed64());var J=h(this);for($=$||[];this.pos<J;)$.push(this.readSFixed64());return $},skip:function($){var J=7&$;if(J===t.Varint)for(;this.buf[this.pos++]>127;);else if(J===t.Bytes)this.pos=this.readVarint()+this.pos;else if(J===t.Fixed32)this.pos+=4;else{if(J!==t.Fixed64)throw new Error("Unimplemented type: "+J);this.pos+=8}},writeTag:function($,J){this.writeVarint($<<3|J)},realloc:function($){for(var J=this.length||16;J<this.pos+$;)J*=2;if(J!==this.length){var ie=new Uint8Array(J);ie.set(this.buf),this.buf=ie,this.length=J}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function($){this.realloc(4),W(this.buf,$,this.pos),this.pos+=4},writeSFixed32:function($){this.realloc(4),W(this.buf,$,this.pos),this.pos+=4},writeFixed64:function($){this.realloc(8),W(this.buf,-1&$,this.pos),W(this.buf,Math.floor($*c),this.pos+4),this.pos+=8},writeSFixed64:function($){this.realloc(8),W(this.buf,-1&$,this.pos),W(this.buf,Math.floor($*c),this.pos+4),this.pos+=8},writeVarint:function($){($=+$||0)>268435455||$<0?function(J,ie){var ge,Pe;if(J>=0?(ge=J%4294967296|0,Pe=J/4294967296|0):(Pe=~(-J/4294967296),4294967295^(ge=~(-J%4294967296))?ge=ge+1|0:(ge=0,Pe=Pe+1|0)),J>=18446744073709552e3||J<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ie.realloc(10),function(Me,Ce,$e){$e.buf[$e.pos++]=127&Me|128,Me>>>=7,$e.buf[$e.pos++]=127&Me|128,Me>>>=7,$e.buf[$e.pos++]=127&Me|128,Me>>>=7,$e.buf[$e.pos++]=127&Me|128,$e.buf[$e.pos]=127&(Me>>>=7)}(ge,0,ie),function(Me,Ce){var $e=(7&Me)<<4;Ce.buf[Ce.pos++]|=$e|((Me>>>=3)?128:0),Me&&(Ce.buf[Ce.pos++]=127&Me|((Me>>>=7)?128:0),Me&&(Ce.buf[Ce.pos++]=127&Me|((Me>>>=7)?128:0),Me&&(Ce.buf[Ce.pos++]=127&Me|((Me>>>=7)?128:0),Me&&(Ce.buf[Ce.pos++]=127&Me|((Me>>>=7)?128:0),Me&&(Ce.buf[Ce.pos++]=127&Me)))))}(Pe,ie)}($,this):(this.realloc(4),this.buf[this.pos++]=127&$|($>127?128:0),$<=127||(this.buf[this.pos++]=127&($>>>=7)|($>127?128:0),$<=127||(this.buf[this.pos++]=127&($>>>=7)|($>127?128:0),$<=127||(this.buf[this.pos++]=$>>>7&127))))},writeSVarint:function($){this.writeVarint($<0?2*-$-1:2*$)},writeBoolean:function($){this.writeVarint(!!$)},writeString:function($){$=String($),this.realloc(4*$.length),this.pos++;var J=this.pos;this.pos=function(ge,Pe,Me){for(var Ce,$e,Re=0;Re<Pe.length;Re++){if((Ce=Pe.charCodeAt(Re))>55295&&Ce<57344){if(!$e){Ce>56319||Re+1===Pe.length?(ge[Me++]=239,ge[Me++]=191,ge[Me++]=189):$e=Ce;continue}if(Ce<56320){ge[Me++]=239,ge[Me++]=191,ge[Me++]=189,$e=Ce;continue}Ce=$e-55296<<10|Ce-56320|65536,$e=null}else $e&&(ge[Me++]=239,ge[Me++]=191,ge[Me++]=189,$e=null);Ce<128?ge[Me++]=Ce:(Ce<2048?ge[Me++]=Ce>>6|192:(Ce<65536?ge[Me++]=Ce>>12|224:(ge[Me++]=Ce>>18|240,ge[Me++]=Ce>>12&63|128),ge[Me++]=Ce>>6&63|128),ge[Me++]=63&Ce|128)}return Me}(this.buf,$,this.pos);var ie=this.pos-J;ie>=128&&w(J,ie,this),this.pos=J-1,this.writeVarint(ie),this.pos+=ie},writeFloat:function($){this.realloc(4),l.write(this.buf,$,this.pos,!0,23,4),this.pos+=4},writeDouble:function($){this.realloc(8),l.write(this.buf,$,this.pos,!0,52,8),this.pos+=8},writeBytes:function($){var J=$.length;this.writeVarint(J),this.realloc(J);for(var ie=0;ie<J;ie++)this.buf[this.pos++]=$[ie]},writeRawMessage:function($,J){this.pos++;var ie=this.pos;$(J,this);var ge=this.pos-ie;ge>=128&&w(ie,ge,this),this.pos=ie-1,this.writeVarint(ge),this.pos+=ge},writeMessage:function($,J,ie){this.writeTag($,t.Bytes),this.writeRawMessage(J,ie)},writePackedVarint:function($,J){J.length&&this.writeMessage($,S,J)},writePackedSVarint:function($,J){J.length&&this.writeMessage($,P,J)},writePackedBoolean:function($,J){J.length&&this.writeMessage($,I,J)},writePackedFloat:function($,J){J.length&&this.writeMessage($,x,J)},writePackedDouble:function($,J){J.length&&this.writeMessage($,A,J)},writePackedFixed32:function($,J){J.length&&this.writeMessage($,E,J)},writePackedSFixed32:function($,J){J.length&&this.writeMessage($,C,J)},writePackedFixed64:function($,J){J.length&&this.writeMessage($,R,J)},writePackedSFixed64:function($,J){J.length&&this.writeMessage($,z,J)},writeBytesField:function($,J){this.writeTag($,t.Bytes),this.writeBytes(J)},writeFixed32Field:function($,J){this.writeTag($,t.Fixed32),this.writeFixed32(J)},writeSFixed32Field:function($,J){this.writeTag($,t.Fixed32),this.writeSFixed32(J)},writeFixed64Field:function($,J){this.writeTag($,t.Fixed64),this.writeFixed64(J)},writeSFixed64Field:function($,J){this.writeTag($,t.Fixed64),this.writeSFixed64(J)},writeVarintField:function($,J){this.writeTag($,t.Varint),this.writeVarint(J)},writeSVarintField:function($,J){this.writeTag($,t.Varint),this.writeSVarint(J)},writeStringField:function($,J){this.writeTag($,t.Bytes),this.writeString(J)},writeFloatField:function($,J){this.writeTag($,t.Fixed32),this.writeFloat(J)},writeDoubleField:function($,J){this.writeTag($,t.Fixed64),this.writeDouble(J)},writeBooleanField:function($,J){this.writeVarintField($,!!J)}},Yw}var j1=D(tM());const Kw=3;function bF(l,t,s){t.glyphs=[],l===1&&s.readMessage(wF,t)}function wF(l,t,s){if(l===3){const{id:c,bitmap:m,width:h,height:_,left:w,top:S,advance:P}=s.readMessage(TF,{});t.glyphs.push({id:c,bitmap:new Nh({width:h+2*Kw,height:_+2*Kw},m),metrics:{width:h,height:_,left:w,top:S,advance:P}})}else l===4?t.ascender=s.readSVarint():l===5&&(t.descender=s.readSVarint())}function TF(l,t,s){l===1?t.id=s.readVarint():l===2?t.bitmap=s.readBytes():l===3?t.width=s.readVarint():l===4?t.height=s.readVarint():l===5?t.left=s.readSVarint():l===6?t.top=s.readSVarint():l===7&&(t.advance=s.readVarint())}const iM=Kw,sl={horizontal:1,vertical:2,horizontalOnly:3};class Xg{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(t,s){const c=new Xg;return c.scale=t||1,c.fontStack=s,c}static forImage(t){const s=new Xg;return s.image=t,s}}class pm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s){const c=new pm;for(let m=0;m<t.sections.length;m++){const h=t.sections[m];h.image?c.addImageSection(h):c.addTextSection(h,s)}return c}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(s,c){let m="";for(let h=0;h<s.length;h++){const _=s.charCodeAt(h+1)||null,w=s.charCodeAt(h-1)||null;m+=!c&&(_&&ug(_)&&!Yg[s[h+1]]||w&&ug(w)&&!Yg[s[h-1]])||!Yg[s[h]]?s[h]:Yg[s[h]]}return m}(this.text,t)}trim(){let t=0;for(let c=0;c<this.text.length&&$1[this.text.charCodeAt(c)];c++)t++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=t&&$1[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){const c=new pm;return c.text=this.text.substring(t,s),c.sectionIndex=this.sectionIndex.slice(t,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}addTextSection(t,s){this.text+=t.text,this.sections.push(Xg.forText(t.scale,t.fontStack||s));const c=this.sections.length-1;for(let m=0;m<t.text.length;++m)this.sectionIndex.push(c)}addImageSection(t){const s=t.image&&t.image.namePrimary?t.image.getPrimary():null;if(!s)return void Vi("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCodePoint(c),this.sections.push(Xg.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Vi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Jw(l,t,s,c,m,h,_,w,S,P,x,A,I,E,C){const R=pm.fromFeature(l,m);A===sl.vertical&&R.verticalizePunctuation(I);let z=[];const V=function(ie,ge,Pe,Me,Ce,$e){if(!ie)return[];const Re=[],He=function(at,ft,nt,Mt,Ft,Ct){let si=0;for(let ri=0;ri<at.length();ri++){const Wt=at.getSection(ri);si+=rM(at.getCodePoint(ri),Wt,Mt,Ft,ft,Ct)}return si/Math.max(1,Math.ceil(si/nt))}(ie,ge,Pe,Me,Ce,$e),Je=ie.text.indexOf("​")>=0;let Xe=0;for(let at=0;at<ie.length();at++){const ft=ie.getSection(at),nt=ie.getCodePoint(at);if($1[nt]||(Xe+=rM(nt,ft,Me,Ce,ge,$e)),at<ie.length()-1){const Mt=!((tt=nt)<11904||!(Si["Bopomofo Extended"](tt)||Si.Bopomofo(tt)||Si["CJK Compatibility Forms"](tt)||Si["CJK Compatibility Ideographs"](tt)||Si["CJK Compatibility"](tt)||Si["CJK Radicals Supplement"](tt)||Si["CJK Strokes"](tt)||Si["CJK Symbols and Punctuation"](tt)||Si["CJK Unified Ideographs Extension A"](tt)||Si["CJK Unified Ideographs"](tt)||Si["Enclosed CJK Letters and Months"](tt)||Si["Halfwidth and Fullwidth Forms"](tt)||Si.Hiragana(tt)||Si["Ideographic Description Characters"](tt)||Si["Kangxi Radicals"](tt)||Si["Katakana Phonetic Extensions"](tt)||Si.Katakana(tt)||Si["Vertical Forms"](tt)||Si["Yi Radicals"](tt)||Si["Yi Syllables"](tt)));(EF[nt]||Mt||ft.image)&&Re.push(sM(at+1,Xe,He,Re,SF(nt,ie.getCodePoint(at+1),Mt&&Je),!1))}}var tt;return oM(sM(ie.length(),Xe,He,Re,0,!0))}(R,P,h,t,c,E),{processBidirectionalText:W,processStyledBidirectionalText:Y}=la;if(W&&R.sections.length===1){const ie=W(R.toString(),V);for(const ge of ie){const Pe=new pm;Pe.text=ge,Pe.sections=R.sections;for(let Me=0;Me<ge.length;Me++)Pe.sectionIndex.push(0);z.push(Pe)}}else if(Y){const ie=Y(R.text,R.sectionIndex,V);for(const ge of ie){const Pe=new pm;Pe.text=ge[0],Pe.sectionIndex=ge[1],Pe.sections=R.sections,z.push(Pe)}}else z=function(ie,ge){const Pe=[],Me=ie.text;let Ce=0;for(const $e of ge)Pe.push(ie.substring(Ce,$e)),Ce=$e;return Ce<Me.length&&Pe.push(ie.substring(Ce,Me.length)),Pe}(R,V);const $=[],J={positionedLines:$,text:R.toString(),top:x[1],bottom:x[1],left:x[0],right:x[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ie,ge,Pe,Me,Ce,$e,Re,He,Je,Xe,tt,at){let ft=0,nt=0,Mt=0;const Ft=He==="right"?1:He==="left"?0:.5;let Ct=!1;for(const ai of Ce){const fi=ai.getSections();for(const Wi of fi){if(Wi.image)continue;const hr=ge[Wi.fontStack];if(hr&&(Ct=hr.ascender!==void 0&&hr.descender!==void 0,!Ct))break}if(!Ct)break}let si=0;for(const ai of Ce){ai.trim();const fi=ai.getMaxScale(),Wi=(fi-1)*mo,hr={positionedGlyphs:[],lineOffset:0};ie.positionedLines[si]=hr;const pr=hr.positionedGlyphs;let mr=0;if(!ai.length()){nt+=$e,++si;continue}let Er=0,Sr=0;for(let en=0;en<ai.length();en++){const nr=ai.getSection(en),Zr=ai.getSectionIndex(en),Kr=ai.getCodePoint(en);let Mn=nr.scale,as=null,xs=null,ls=null,Kn=mo,fs=0;const As=!(Je===sl.horizontal||!tt&&!Hp(Kr)||tt&&($1[Kr]||(ri=Kr,Si.Arabic(ri)||Si["Arabic Supplement"](ri)||Si["Arabic Extended-A"](ri)||Si["Arabic Presentation Forms-A"](ri)||Si["Arabic Presentation Forms-B"](ri))));if(nr.image){const _o=Me[nr.image.serialize()];if(!_o)continue;ls=nr.image.id,ie.iconsInText=ie.iconsInText||!0,xs=_o.paddedRect;const En=_o.displaySize;Mn=Mn*mo/at,as={width:En[0],height:En[1],left:0,top:-iM,advance:As?En[1]:En[0],localGlyph:!1},fs=Ct?-as.height*Mn:fi*mo-17-En[1]*Mn,Kn=as.advance;const fa=(As?En[0]:En[1])*Mn-mo*fi;fa>0&&fa>mr&&(mr=fa)}else{const _o=Pe[nr.fontStack];if(!_o)continue;_o[Kr]&&(xs=_o[Kr]);const En=ge[nr.fontStack];if(!En)continue;const fa=En.glyphs[Kr];if(!fa)continue;if(as=fa.metrics,Kn=Kr!==8203?mo:0,Ct){const Tc=En.ascender!==void 0?Math.abs(En.ascender):0,jl=En.descender!==void 0?Math.abs(En.descender):0,$l=(Tc+jl)*Mn;Er<$l&&(Er=$l,Sr=(Tc-jl)/2*Mn),fs=-Tc*Mn}else fs=(fi-Mn)*mo-17}As?(ie.verticalizable=!0,pr.push({glyph:Kr,imageName:ls,x:ft,y:nt+fs,vertical:As,scale:Mn,localGlyph:as.localGlyph,fontStack:nr.fontStack,sectionIndex:Zr,metrics:as,rect:xs}),ft+=Kn*Mn+Xe):(pr.push({glyph:Kr,imageName:ls,x:ft,y:nt+fs,vertical:As,scale:Mn,localGlyph:as.localGlyph,fontStack:nr.fontStack,sectionIndex:Zr,metrics:as,rect:xs}),ft+=as.advance*Mn+Xe)}pr.length!==0&&(Mt=Math.max(ft-Xe,Mt),Ct?aM(pr,Ft,mr,Sr,$e*fi/2):aM(pr,Ft,mr,0,$e/2)),ft=0;const mn=$e*fi+mr;hr.lineOffset=Math.max(mr,Wi),nt+=mn,++si}var ri;const Wt=nt,{horizontalAlign:Bt,verticalAlign:wi}=Qw(Re);(function(ai,fi,Wi,hr,pr,mr){const Er=(fi-Wi)*pr,Sr=-mr*hr;for(const mn of ai)for(const en of mn.positionedGlyphs)en.x+=Er,en.y+=Sr})(ie.positionedLines,Ft,Bt,wi,Mt,Wt),ie.top+=-wi*Wt,ie.bottom=ie.top+Wt,ie.left+=-Bt*Mt,ie.right=ie.left+Mt,ie.hasBaseline=Ct}(J,t,s,c,z,_,w,S,A,P,I,C),!function(ie){for(const ge of ie)if(ge.positionedGlyphs.length!==0)return!1;return!0}($)&&J}const $1={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},EF={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function rM(l,t,s,c,m,h){if(t.image){const _=c[t.image.serialize()];return _?_.displaySize[0]*t.scale*mo/h+m:0}{const _=s[t.fontStack],w=_&&_.glyphs[l];return w?w.metrics.advance*t.scale+m:0}}function nM(l,t,s,c){const m=Math.pow(l-t,2);return c?l<t?m/2:2*m:m+Math.abs(s)*s}function SF(l,t,s){let c=0;return l===10&&(c-=1e4),s&&(c+=150),l!==40&&l!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function sM(l,t,s,c,m,h){let _=null,w=nM(t,s,m,h);for(const S of c){const P=nM(t-S.x,s,m,h)+S.badness;P<=w&&(_=S,w=P)}return{index:l,x:t,priorBreak:_,badness:w}}function oM(l){return l?oM(l.priorBreak).concat(l.index):[]}function Qw(l){let t=.5,s=.5;switch(l){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function aM(l,t,s,c,m){if(!(t||s||c||m))return;const h=l.length-1,_=l[h],w=(_.x+_.metrics.advance*_.scale)*t;for(let S=0;S<=h;S++)l[S].x-=w,l[S].y+=s+c+m}function AF(l,t,s,c){const{horizontalAlign:m,verticalAlign:h}=Qw(c),_=s[0]-l.displaySize[0]*m,w=s[1]-l.displaySize[1]*h;return{imagePrimary:l,imageSecondary:t,top:w,bottom:w+l.displaySize[1],left:_,right:_+l.displaySize[0]}}function lM(l,t,s,c,m,h){const _=l.imagePrimary;let w;if(_.content){const z=_.content,V=_.pixelRatio||1;w=[z[0]/V,z[1]/V,_.displaySize[0]-z[2]/V,_.displaySize[1]-z[3]/V]}const S=t.left*h,P=t.right*h;let x,A,I,E;s==="width"||s==="both"?(E=m[0]+S-c[3],A=m[0]+P+c[1]):(E=m[0]+(S+P-_.displaySize[0])/2,A=E+_.displaySize[0]);const C=t.top*h,R=t.bottom*h;return s==="height"||s==="both"?(x=m[1]+C-c[0],I=m[1]+R+c[2]):(x=m[1]+(C+R-_.displaySize[1])/2,I=x+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:x,right:A,bottom:I,left:E,collisionPadding:w}}class Fu extends ve{constructor(t,s,c,m,h){super(t,s),this.angle=m,this.z=c,h!==void 0&&(this.segment=h)}clone(){return new Fu(this.x,this.y,this.z,this.angle,this.segment)}}function cM(l,t,s,c,m){if(t.segment===void 0)return!0;let h=t,_=t.segment+1,w=0;for(;w>-s/2;){if(_--,_<0)return!1;w-=l[_].dist(h),h=l[_]}w+=l[_].dist(l[_+1]),_++;const S=[];let P=0;for(;w<s/2;){const x=l[_],A=l[_+1];if(!A)return!1;let I=l[_-1].angleTo(x)-x.angleTo(A);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:w,angleDelta:I}),P+=I;w-S[0].distance>c;)P-=S.shift().angleDelta;if(P>m)return!1;_++,w+=x.dist(A)}return!0}function uM(l){let t=0;for(let s=0;s<l.length-1;s++)t+=l[s].dist(l[s+1]);return t}function hM(l,t,s){return l?.6*t*s:0}function dM(l,t){return Math.max(l?l.right-l.left:0,t?t.right-t.left:0)}function CF(l,t,s,c,m,h){const _=hM(s,m,h),w=dM(s,c)*h;let S=0;const P=uM(l)/2;for(let x=0;x<l.length-1;x++){const A=l[x],I=l[x+1],E=A.dist(I);if(S+E>P){const C=(P-S)/E,R=Bi(A.x,I.x,C),z=Bi(A.y,I.y,C),V=new Fu(R,z,0,I.angleTo(A),x);return!_||cM(l,V,w,_,t)?V:void 0}S+=E}}function MF(l,t,s,c,m,h,_,w,S){const P=hM(c,h,_),x=dM(c,m),A=x*_,I=l[0].x===0||l[0].x===S||l[0].y===0||l[0].y===S;return t-A<t/4&&(t=A+t/4),fM(l,I?t/2*w%t:(x/2+2*h)*_*w%t,t,P,s,A,I,!1,S)}function fM(l,t,s,c,m,h,_,w,S){const P=h/2,x=uM(l);let A=0,I=t-s,E=[];for(let C=0;C<l.length-1;C++){const R=l[C],z=l[C+1],V=R.dist(z),W=z.angleTo(R);for(;I+s<A+V;){I+=s;const Y=(I-A)/V,$=Bi(R.x,z.x,Y),J=Bi(R.y,z.y,Y);if($>=0&&$<S&&J>=0&&J<S&&I-P>=0&&I+P<=x){const ie=new Fu($,J,0,W,C);c&&!cM(l,ie,h,c,m)||E.push(ie)}}A+=V}return w||E.length||_||(E=fM(l,A/2,s,c,m,h,_,!0,S)),E}function pM(l,t,s,c,m){const h=[];for(let _=0;_<l.length;_++){const w=l[_];let S;for(let P=0;P<w.length-1;P++){let x=w[P],A=w[P+1];x.x<t&&A.x<t||(x.x<t?x=new ve(t,x.y+(t-x.x)/(A.x-x.x)*(A.y-x.y))._round():A.x<t&&(A=new ve(t,x.y+(t-x.x)/(A.x-x.x)*(A.y-x.y))._round()),x.y<s&&A.y<s||(x.y<s?x=new ve(x.x+(s-x.y)/(A.y-x.y)*(A.x-x.x),s)._round():A.y<s&&(A=new ve(x.x+(s-x.y)/(A.y-x.y)*(A.x-x.x),s)._round()),x.x>=c&&A.x>=c||(x.x>=c?x=new ve(c,x.y+(c-x.x)/(A.x-x.x)*(A.y-x.y))._round():A.x>=c&&(A=new ve(c,x.y+(c-x.x)/(A.x-x.x)*(A.y-x.y))._round()),x.y>=m&&A.y>=m||(x.y>=m?x=new ve(x.x+(m-x.y)/(A.y-x.y)*(A.x-x.x),m)._round():A.y>=m&&(A=new ve(x.x+(m-x.y)/(A.y-x.y)*(A.x-x.x),m)._round()),S&&x.equals(S[S.length-1])||(S=[x],h.push(S)),S.push(A)))))}}return h}function mM(l){let t=0,s=0;for(const _ of l)t+=_.w*_.h,s=Math.max(s,_.w);l.sort((_,w)=>w.h-_.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let m=0,h=0;for(const _ of l)for(let w=c.length-1;w>=0;w--){const S=c[w];if(!(_.w>S.w||_.h>S.h)){if(_.x=S.x,_.y=S.y,h=Math.max(h,_.y+_.h),m=Math.max(m,_.x+_.w),_.w===S.w&&_.h===S.h){const P=c.pop();w<c.length&&(c[w]=P)}else _.h===S.h?(S.x+=_.w,S.w-=_.w):_.w===S.w?(S.y+=_.h,S.h-=_.h):(c.push({x:S.x+_.w,y:S.y,w:S.w-_.w,h:_.h}),S.y+=_.h,S.h-=_.h);break}}return{w:m,h,fill:t/(m*h)||0}}gi(Fu,"Anchor");const Kg=1;class Jg{static getImagePositionScale(t,s,c){return s&&t&&t.options&&t.options.transform?{x:t.options.transform.a,y:t.options.transform.d}:{x:c,y:c}}constructor(t,{pixelRatio:s,version:c,stretchX:m,stretchY:h,content:_,sdf:w,usvg:S},P,x){this.paddedRect=t,this.pixelRatio=s,this.stretchX=m,this.stretchY=h,this.content=_,this.version=c,this.padding=P,this.sdf=w,this.scale=Jg.getImagePositionScale(x,S,s)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}class _M{constructor(t,s,c){const m={},h={};this.haveRenderCallbacks=[];const _=[];this.addImages(t,m,Kg,_),this.addImages(s,h,2,_);const{w,h:S}=mM(_),P=new ro({width:w||1,height:S||1});for(const x in t){const A=t[x],I=m[x].paddedRect;ro.copy(A.data,P,{x:0,y:0},{x:I.x+Kg,y:I.y+Kg},A.data,c,A.sdf)}for(const x in s){const A=s[x],I=h[x].paddedRect;let E=h[x].padding;const C=I.x+E,R=I.y+E,z=A.data.width,V=A.data.height;E=E>1?E-1:E,ro.copy(A.data,P,{x:0,y:0},{x:C,y:R},A.data,c),ro.copy(A.data,P,{x:0,y:V-E},{x:C,y:R-E},{width:z,height:E},c),ro.copy(A.data,P,{x:0,y:0},{x:C,y:R+V},{width:z,height:E},c),ro.copy(A.data,P,{x:z-E,y:0},{x:C-E,y:R},{width:E,height:V},c),ro.copy(A.data,P,{x:0,y:0},{x:C+z,y:R},{width:E,height:V},c),ro.copy(A.data,P,{x:z-E,y:V-E},{x:C-E,y:R-E},{width:E,height:E},c),ro.copy(A.data,P,{x:0,y:V-E},{x:C+z,y:R-E},{width:E,height:E},c),ro.copy(A.data,P,{x:0,y:0},{x:C+z,y:R+V},{width:E,height:E},c),ro.copy(A.data,P,{x:z-E,y:0},{x:C-E,y:R+V},{width:E,height:E},c)}this.lut=c,this.image=P,this.iconPositions=m,this.patternPositions=h}addImages(t,s,c,m){for(const h in t){const _=t[h],w={x:0,y:0,w:_.data.width+2*c,h:_.data.height+2*c};m.push(w);const S=Ra.deserializeFromString(h);s[h]=new Jg(w,_,c,S),_.hasRenderCallback&&this.haveRenderCallbacks.push(S.id)}}patchUpdatedImages(t,s,c){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(m=>t.hasImage(m,c)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,c);for(const m in t.getUpdatedImages(c)){for(const h of Object.keys(this.iconPositions))Ra.deserializeId(h)===m&&this.patchUpdatedImage(this.iconPositions[h],t.getImage(m,c),s);for(const h of Object.keys(this.patternPositions))Ra.deserializeId(h)===m&&this.patchUpdatedImage(this.patternPositions[h],t.getImage(m,c),s)}}patchUpdatedImage(t,s,c){if(!t||!s||t.version===s.version)return;t.version=s.version;const[m,h]=t.tl,_=t.sdf;if(this.lut||_){const w={width:s.data.width,height:s.data.height},S=new ro(w);ro.copy(s.data,S,{x:0,y:0},{x:0,y:0},w,this.lut,_),c.update(S,{position:{x:m,y:h}})}else c.update(s.data,{position:{x:m,y:h}})}}gi(Jg,"ImagePosition"),gi(_M,"ImageAtlas");const Qg=1e20;function gM(l,t,s,c,m,h,_,w,S){for(let P=t;P<t+c;P++)yM(l,s*h+P,h,m,_,w,S);for(let P=s;P<s+m;P++)yM(l,P*h+t,1,c,_,w,S)}function yM(l,t,s,c,m,h,_){h[0]=0,_[0]=-Qg,_[1]=Qg,m[0]=l[t];for(let w=1,S=0,P=0;w<c;w++){m[w]=l[t+w*s];const x=w*w;do{const A=h[S];P=(m[w]-m[A]+x-A*A)/(w-A)/2}while(P<=_[S]&&--S>-1);S++,h[S]=w,_[S]=P,_[S+1]=Qg}for(let w=0,S=0;w<c;w++){for(;_[S+1]<w;)S++;const P=h[S],x=w-P;l[t+w*s]=m[P]+x*x}}const vc=2,e2={none:0,ideographs:1,all:2};class mm{constructor(t,s,c){this.requestManager=t,this.localGlyphMode=s,this.localFontFamily=c,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,s){this.urls[s]=t}getGlyphs(t,s,c){const m=[],h=this.urls[s]||lr.GLYPHS_URL;for(const _ in t)for(const w of t[_])m.push({stack:_,id:w});Ni(m,({stack:_,id:w},S)=>{let P=this.entries[_];P||(P=this.entries[_]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=P.glyphs[w];if(x!==void 0)return void S(null,{stack:_,id:w,glyph:x});if(x=this._tinySDF(P,_,w),x)return P.glyphs[w]=x,void S(null,{stack:_,id:w,glyph:x});const A=Math.floor(w/256);if(256*A>65535)return Vi("glyphs > 65535 not supported"),void S(null,{stack:_,id:w,glyph:x});if(P.ranges[A])return void S(null,{stack:_,id:w,glyph:x});let I=P.requests[A];I||(I=P.requests[A]=[],mm.loadGlyphRange(_,A,h,this.requestManager,(E,C)=>{if(C){P.ascender=C.ascender,P.descender=C.descender;for(const R in C.glyphs)this._doesCharSupportLocalGlyph(+R)||(P.glyphs[+R]=C.glyphs[+R]);P.ranges[A]=!0}for(const R of I)R(E,C);delete P.requests[A]})),I.push((E,C)=>{E?S(E):C&&S(null,{stack:_,id:w,glyph:C.glyphs[w]||null})})},(_,w)=>{if(_)c(_);else if(w){const S={};for(const{stack:P,id:x,glyph:A}of w)S[P]===void 0&&(S[P]={}),S[P].glyphs===void 0&&(S[P].glyphs={}),S[P].glyphs[x]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},S[P].ascender=this.entries[P].ascender,S[P].descender=this.entries[P].descender;c(null,S)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==e2.none&&(this.localGlyphMode===e2.all?!!this.localFontFamily:!!this.localFontFamily&&(Si["CJK Unified Ideographs"](t)||Si["Hangul Syllables"](t)||Si.Hiragana(t)||Si.Katakana(t)||Si["CJK Symbols and Punctuation"](t)||Si["CJK Unified Ideographs Extension A"](t)||Si["CJK Unified Ideographs Extension B"](t)||Si.Osage(t)))}_tinySDF(t,s,c){const m=this.localFontFamily;if(!m||!this._doesCharSupportLocalGlyph(c))return;let h=t.tinySDF;if(!h){let R="400";/bold/i.test(s)?R="900":/medium/i.test(s)?R="500":/light/i.test(s)&&(R="200"),h=t.tinySDF=new mm.TinySDF({fontFamily:m,fontWeight:R,fontSize:24*vc,buffer:3*vc,radius:8*vc}),h.fontWeight=R}if(this.localGlyphs[h.fontWeight][c])return this.localGlyphs[h.fontWeight][c];const _=String.fromCodePoint(c),{data:w,width:S,height:P,glyphWidth:x,glyphHeight:A,glyphLeft:I,glyphTop:E,glyphAdvance:C}=h.draw(_);return this.localGlyphs[h.fontWeight][c]={id:c,bitmap:new Nh({width:S,height:P},w),metrics:{width:x/vc,height:A/vc,left:I/vc,top:E/vc-27,advance:C/vc,localGlyph:!0}}}}mm.loadGlyphRange=function(l,t,s,c,m){const h=256*t,_=h+255,w=c.transformRequest(c.normalizeGlyphsURL(s).replace("{fontstack}",l).replace("{range}",`${h}-${_}`),wr.Glyphs);On(w,(S,P)=>{if(S)m(S);else if(P){const x={},A=function(I){return new j1(I).readFields(bF,{})}(P);for(const I of A.glyphs)x[I.id]=I;m(null,{glyphs:x,ascender:A.ascender,descender:A.descender})}})},mm.TinySDF=class{constructor({fontSize:l=24,buffer:t=3,radius:s=8,cutoff:c=.25,fontFamily:m="sans-serif",fontWeight:h="normal",fontStyle:_="normal"}={}){this.buffer=t,this.cutoff=c,this.radius=s;const w=this.size=l+4*t,S=this._createCanvas(w),P=this.ctx=S.getContext("2d",{willReadFrequently:!0});P.font=`${_} ${h} ${l}px ${m}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(l){const t=document.createElement("canvas");return t.width=t.height=l,t}draw(l){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:m,actualBoundingBoxRight:h}=this.ctx.measureText(l),_=Math.ceil(s),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-m))),S=Math.min(this.size-this.buffer,_+Math.ceil(c)),P=w+2*this.buffer,x=S+2*this.buffer,A=Math.max(P*x,0),I=new Uint8ClampedArray(A),E={data:I,width:P,height:x,glyphWidth:w,glyphHeight:S,glyphTop:_,glyphLeft:0,glyphAdvance:t};if(w===0||S===0)return E;const{ctx:C,buffer:R,gridInner:z,gridOuter:V}=this;C.clearRect(R,R,w,S),C.fillText(l,R,R+_);const W=C.getImageData(R,R,w,S);V.fill(Qg,0,A),z.fill(0,0,A);for(let Y=0;Y<S;Y++)for(let $=0;$<w;$++){const J=W.data[4*(Y*w+$)+3]/255;if(J===0)continue;const ie=(Y+R)*P+$+R;if(J===1)V[ie]=0,z[ie]=Qg;else{const ge=.5-J;V[ie]=ge>0?ge*ge:0,z[ie]=ge<0?ge*ge:0}}gM(V,0,0,P,x,P,this.f,this.v,this.z),gM(z,R,R,w,S,P,this.f,this.v,this.z);for(let Y=0;Y<A;Y++){const $=Math.sqrt(V[Y])-Math.sqrt(z[Y]);I[Y]=Math.round(255-255*($/this.radius+this.cutoff))}return E}};const Uh=Kg;function vM(l,t){return l+t[1]-t[0]}function xM(l,t,s,c,m=1){const h=[],_=l.imagePrimary,w=_.pixelRatio,S=_.paddedRect.w-2*Uh,P=_.paddedRect.h-2*Uh,x=(l.right-l.left)*m,A=(l.bottom-l.top)*m,I=_.stretchX||[[0,S]],E=_.stretchY||[[0,P]],C=I.reduce(vM,0),R=E.reduce(vM,0),z=S-C,V=P-R;let W=0,Y=C,$=0,J=R,ie=0,ge=z,Pe=0,Me=V;if(_.content&&c){const $e=_.content;W=q1(I,0,$e[0]),$=q1(E,0,$e[1]),Y=q1(I,$e[0],$e[2]),J=q1(E,$e[1],$e[3]),ie=$e[0]-W,Pe=$e[1]-$,ge=$e[2]-$e[0]-Y,Me=$e[3]-$e[1]-J}const Ce=($e,Re,He,Je)=>{const Xe=H1($e.stretch-W,Y,x,l.left*m),tt=G1($e.fixed-ie,ge,$e.stretch,C),at=H1(Re.stretch-$,J,A,l.top*m),ft=G1(Re.fixed-Pe,Me,Re.stretch,R),nt=H1(He.stretch-W,Y,x,l.left*m),Mt=G1(He.fixed-ie,ge,He.stretch,C),Ft=H1(Je.stretch-$,J,A,l.top*m),Ct=G1(Je.fixed-Pe,Me,Je.stretch,R),si=new ve(Xe,at),ri=new ve(nt,at),Wt=new ve(nt,Ft),Bt=new ve(Xe,Ft),wi=new ve(tt/w,ft/w),ai=new ve(Mt/w,Ct/w),fi=t*Math.PI/180;if(fi){const Sr=Math.sin(fi),mn=Math.cos(fi),en=[mn,-Sr,Sr,mn];si._matMult(en),ri._matMult(en),Bt._matMult(en),Wt._matMult(en)}const Wi=$e.stretch+$e.fixed,hr=He.stretch+He.fixed,pr=Re.stretch+Re.fixed,mr=Je.stretch+Je.fixed,Er=l.imageSecondary;return{tl:si,tr:ri,bl:Bt,br:Wt,texPrimary:{x:_.paddedRect.x+Uh+Wi,y:_.paddedRect.y+Uh+pr,w:hr-Wi,h:mr-pr},texSecondary:Er?{x:Er.paddedRect.x+Uh+Wi,y:Er.paddedRect.y+Uh+pr,w:hr-Wi,h:mr-pr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:wi,pixelOffsetBR:ai,minFontScaleX:ge/w/x,minFontScaleY:Me/w/A,isSDF:s}};if(c&&(_.stretchX||_.stretchY)){const $e=bM(I,z,C),Re=bM(E,V,R);for(let He=0;He<$e.length-1;He++){const Je=$e[He],Xe=$e[He+1];for(let tt=0;tt<Re.length-1;tt++)h.push(Ce(Je,Re[tt],Xe,Re[tt+1]))}}else h.push(Ce({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:P+1}));return h}function q1(l,t,s){let c=0;for(const m of l)c+=Math.max(t,Math.min(s,m[1]))-Math.max(t,Math.min(s,m[0]));return c}function bM(l,t,s){const c=[{fixed:-Uh,stretch:0}];for(const[m,h]of l){const _=c[c.length-1];c.push({fixed:m-_.stretch,stretch:_.stretch}),c.push({fixed:m-_.stretch,stretch:_.stretch+(h-m)})}return c.push({fixed:t+Uh,stretch:s}),c}function H1(l,t,s,c){return l/t*s+c}function G1(l,t,s,c){return l-t*s/c}function IF(l,t,s,c){const m=t+l.positionedLines[c].lineOffset;return c===0?s+m/2:s+(m+(t+l.positionedLines[c-1].lineOffset))/2}function PF(l,t=1,s=!1){let c=1/0,m=1/0,h=-1/0,_=-1/0;const w=l[0];for(let E=0;E<w.length;E++){const C=w[E];(!E||C.x<c)&&(c=C.x),(!E||C.y<m)&&(m=C.y),(!E||C.x>h)&&(h=C.x),(!E||C.y>_)&&(_=C.y)}const S=Math.min(h-c,_-m);let P=S/2;const x=new Wr([],RF);if(S===0)return new ve(c,m);for(let E=c;E<h;E+=S)for(let C=m;C<_;C+=S)x.push(new _m(E+P,C+P,P,l));let A=function(E){let C=0,R=0,z=0;const V=E[0];for(let W=0,Y=V.length,$=Y-1;W<Y;$=W++){const J=V[W],ie=V[$],ge=J.x*ie.y-ie.x*J.y;R+=(J.x+ie.x)*ge,z+=(J.y+ie.y)*ge,C+=3*ge}return new _m(R/C,z/C,0,E)}(l),I=x.length;for(;x.length;){const E=x.pop();(E.d>A.d||!A.d)&&(A=E,s&&console.log("found best %d after %d probes",Math.round(1e4*E.d)/1e4,I)),E.max-A.d<=t||(P=E.h/2,x.push(new _m(E.p.x-P,E.p.y-P,P,l)),x.push(new _m(E.p.x+P,E.p.y-P,P,l)),x.push(new _m(E.p.x-P,E.p.y+P,P,l)),x.push(new _m(E.p.x+P,E.p.y+P,P,l)),I+=4)}return s&&(console.log(`num probes: ${I}`),console.log(`best distance: ${A.d}`)),A.p}function RF(l,t){return t.max-l.max}class _m{constructor(t,s,c,m){this.p=new ve(t,s),this.h=c,this.d=function(h,_){let w=!1,S=1/0;for(let P=0;P<_.length;P++){const x=_[P];for(let A=0,I=x.length,E=I-1;A<I;E=A++){const C=x[A],R=x[E];C.y>h.y!=R.y>h.y&&h.x<(R.x-C.x)*(h.y-C.y)/(R.y-C.y)+C.x&&(w=!w),S=Math.min(S,Ve(h,C,R))}}return(w?1:-1)*Math.sqrt(S)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}}const t2=Number.POSITIVE_INFINITY,DF=Math.sqrt(2);function wM(l,[t,s]){let c=0,m=0;if(s===t2){t<0&&(t=0);const h=t/DF;switch(l){case"top-right":case"top-left":m=h-7;break;case"bottom-right":case"bottom-left":m=7-h;break;case"bottom":m=7-t;break;case"top":m=t-7}switch(l){case"top-right":case"bottom-right":c=-h;break;case"top-left":case"bottom-left":c=h;break;case"left":c=t;break;case"right":c=-t}}else{switch(t=Math.abs(t),s=Math.abs(s),l){case"top-right":case"top-left":case"top":m=s-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-s}switch(l){case"top-right":case"bottom-right":case"right":c=-t;break;case"top-left":case"bottom-left":case"left":c=t}}return[c,m]}function i2(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function OF(l,t,s,c,m,h,_,w,S,P,x,A,I,E,C){let R=h.textMaxSize.evaluate(t,{},A);R===void 0?R=_*h.textScaleFactor:R*=h.textScaleFactor;const z=l.layers[0].layout,V=z.get("icon-offset").evaluate(t,{},A),W=EM(s.horizontal)||s.vertical,Y=I.name==="globe",$=mo,J=_*h.textScaleFactor/$,ie=l.tilePixelRatio*R/$,ge=(Xe=l.overscaling,l.zoom>18&&Xe>2&&(Xe>>=1),Math.max(ii/(512*Xe),1)*z.get("symbol-spacing")),Pe=z.get("text-padding")*l.tilePixelRatio,Me=z.get("icon-padding")*l.tilePixelRatio,Ce=Et(z.get("text-max-angle")),$e=z.get("text-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Re=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",He=z.get("symbol-placement"),Je=ge/2;var Xe;const tt=z.get("icon-text-fit").evaluate(t,{},A),at=z.get("icon-text-fit-padding").evaluate(t,{},A),ft=tt!=="none";let nt;l.hasAnyIconTextFit===!1&&ft&&(l.hasAnyIconTextFit=!0),c&&ft&&(l.allowVerticalPlacement&&s.vertical&&(nt=lM(c,s.vertical,tt,at,V,J)),W&&(c=lM(c,W,tt,at,V,J)));const Mt=(Ft,Ct,si)=>{if(Ct.x<0||Ct.x>=ii||Ct.y<0||Ct.y>=ii)return;let ri=null;if(Y){const{x:Wt,y:Bt,z:wi}=I.projectTilePoint(Ct.x,Ct.y,si);ri={anchor:new Fu(Wt,Bt,wi,0,void 0),up:I.upVector(si,Ct.x,Ct.y)}}(function(Wt,Bt,wi,ai,fi,Wi,hr,pr,mr,Er,Sr,mn,en,nr,Zr,Kr,Mn,as,xs,ls,Kn,fs,As,_o,En,fa,Tc){const jl=Wt.addToLineVertexArray(Bt,ai);let $l,Rf,Gh,Df,yy,nP,sP,oP=0,aP=0,lP=0,cP=0,F2=-1,B2=-1;const Xc={};let uP=Do("");const Of=wi?wi.anchor:Bt,N2=mr.layout.get("icon-text-fit").evaluate(Kn,{},En)!=="none";let V2=0,U2=0;if(mr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[V2,U2]=mr.layout.get("text-offset").evaluate(Kn,{},En).map(al=>al*mo):(V2=mr.layout.get("text-radial-offset").evaluate(Kn,{},En)*mo,U2=t2),Wt.allowVerticalPlacement&&fi.vertical){const al=fi.vertical;if(Zr)nP=r2(al),pr&&(sP=r2(pr));else{const pa=mr.layout.get("text-rotate").evaluate(Kn,{},En)+90;Gh=W1(Er,Of,Bt,Sr,mn,en,al,nr,pa,Kr),pr&&(Df=W1(Er,Of,Bt,Sr,mn,en,pr,as,pa))}}if(Wi){const al=Wt.iconSizeData,pa=mr.layout.get("icon-rotate").evaluate(Kn,{},En),vy=xM(Wi,pa,As,N2,fs.iconScaleFactor),$2=pr?xM(pr,pa,As,N2,fs.iconScaleFactor):void 0;Rf=W1(Er,Of,Bt,Sr,mn,en,Wi,as,pa,null),oP=4*vy.length;let Lf=null;al.kind==="source"?(Lf=[yc*mr.layout.get("icon-size").evaluate(Kn,{},En)*fs.iconScaleFactor],Lf[0]>jh&&Vi(`${Wt.layerIds[0]}: Value for "icon-size" is >= ${ey}. Reduce your "icon-size".`)):al.kind==="composite"&&(Lf=[yc*fs.compositeIconSizes[0].evaluate(Kn,{},En)*fs.iconScaleFactor,yc*fs.compositeIconSizes[1].evaluate(Kn,{},En)*fs.iconScaleFactor],(Lf[0]>jh||Lf[1]>jh)&&Vi(`${Wt.layerIds[0]}: Value for "icon-size" is >= ${ey}. Reduce your "icon-size".`)),Wt.addSymbols(Wt.icon,vy,Lf,ls,xs,Kn,!1,wi,Bt,jl.lineStartIndex,jl.lineLength,-1,_o,En,fa,Tc),F2=Wt.icon.placedSymbolArray.length-1,$2&&(aP=4*$2.length,Wt.addSymbols(Wt.icon,$2,Lf,ls,xs,Kn,sl.vertical,wi,Bt,jl.lineStartIndex,jl.lineLength,-1,_o,En,fa,Tc),B2=Wt.icon.placedSymbolArray.length-1)}for(const al in fi.horizontal){const pa=fi.horizontal[al];$l||(uP=Do(pa.text),Zr?yy=r2(pa):$l=W1(Er,Of,Bt,Sr,mn,en,pa,nr,mr.layout.get("text-rotate").evaluate(Kn,{},En),Kr));const vy=pa.positionedLines.length===1;if(lP+=TM(Wt,wi,Bt,pa,hr,mr,Zr,Kn,Kr,jl,fi.vertical?sl.horizontal:sl.horizontalOnly,vy?Object.keys(fi.horizontal):[al],Xc,F2,fs,_o,En,fa),vy)break}fi.vertical&&(cP+=TM(Wt,wi,Bt,fi.vertical,hr,mr,Zr,Kn,Kr,jl,sl.vertical,["vertical"],Xc,B2,fs,_o,En,fa));let Wh=-1;const j2=(al,pa)=>al?Math.max(al,pa):pa;Wh=j2(yy,Wh),Wh=j2(nP,Wh),Wh=j2(sP,Wh);const dN=Wh>-1?1:0;Wt.glyphOffsetArray.length>=65535&&Vi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Kn.sortKey!==void 0&&Wt.addToSortKeyRanges(Wt.symbolInstances.length,Kn.sortKey),Wt.symbolInstances.emplaceBack(Bt.x,Bt.y,Of.x,Of.y,Of.z,Xc.right>=0?Xc.right:-1,Xc.center>=0?Xc.center:-1,Xc.left>=0?Xc.left:-1,Xc.vertical>=0?Xc.vertical:-1,F2,B2,uP,$l!==void 0?$l:Wt.collisionBoxArray.length,$l!==void 0?$l+1:Wt.collisionBoxArray.length,Gh!==void 0?Gh:Wt.collisionBoxArray.length,Gh!==void 0?Gh+1:Wt.collisionBoxArray.length,Rf!==void 0?Rf:Wt.collisionBoxArray.length,Rf!==void 0?Rf+1:Wt.collisionBoxArray.length,Df||Wt.collisionBoxArray.length,Df?Df+1:Wt.collisionBoxArray.length,Sr,lP,cP,oP,aP,dN,0,V2,U2,Wh,0,N2?1:0)})(l,Ct,ri,Ft,s,c,m,nt,l.layers[0],l.collisionBoxArray,t.index,t.sourceLayerIndex,l.index,Pe,$e,S,0,Me,Re,V,t,h,P,x,A,E,C)};if(He==="line")for(const Ft of pM(t.geometry,0,0,ii,ii)){const Ct=MF(Ft,ge,Ce,s.vertical||W,c,$,ie,l.overscaling,ii);for(const si of Ct)W&&LF(l,W.text,Je,si)||Mt(Ft,si,A)}else if(He==="line-center"){for(const Ft of t.geometry)if(Ft.length>1){const Ct=CF(Ft,Ce,s.vertical||W,c,$,ie);Ct&&Mt(Ft,Ct,A)}}else if(t.type==="Polygon")for(const Ft of L1(t.geometry,0)){const Ct=PF(Ft,16);Mt(Ft[0],new Fu(Ct.x,Ct.y,0,0,void 0),A)}else if(t.type==="LineString")for(const Ft of t.geometry)Mt(Ft,new Fu(Ft[0].x,Ft[0].y,0,0,void 0),A);else if(t.type==="Point")for(const Ft of t.geometry)for(const Ct of Ft)Mt([Ct],new Fu(Ct.x,Ct.y,0,0,void 0),A)}const ey=255,jh=ey*yc;function TM(l,t,s,c,m,h,_,w,S,P,x,A,I,E,C,R,z,V){const W=function(J,ie,ge,Pe,Me,Ce,$e,Re){const He=[];if(ie.positionedLines.length===0)return He;const Je=Pe.layout.get("text-rotate").evaluate(Ce,{})*Math.PI/180,Xe=function(Mt){const Ft=Mt[0],Ct=Mt[1],si=Ft*Ct;return si>0?[Ft,-Ct]:si<0?[-Ft,Ct]:Ft===0?[Ct,Ft]:[Ct,-Ft]}(ge);let tt=Math.abs(ie.top-ie.bottom);for(const Mt of ie.positionedLines)tt-=Mt.lineOffset;const at=ie.positionedLines.length,ft=tt/at;let nt=ie.top-ge[1];for(let Mt=0;Mt<at;++Mt){const Ft=ie.positionedLines[Mt];nt=IF(ie,ft,nt,Mt);for(const Ct of Ft.positionedGlyphs){if(!Ct.rect)continue;const si=Ct.rect||{};let ri=iM+1,Wt=!0,Bt=1,wi=0;if(Ct.imageName){const ls=$e[Us.build(Ct.imageName).getSerializedPrimary()];if(!ls)continue;if(ls.sdf){Vi("SDF images are not supported in formatted text and will be ignored.");continue}Wt=!1,Bt=ls.pixelRatio,ri=Kg/Bt}const ai=(Me||Re)&&Ct.vertical,fi=Ct.metrics.advance*Ct.scale/2,Wi=Ct.metrics,hr=Ct.rect;if(hr===null)continue;Re&&ie.verticalizable&&(wi=Ct.imageName?fi-Ct.metrics.width*Ct.scale/2:0);const pr=Me?[Ct.x+fi,Ct.y]:[0,0];let mr=[0,0],Er=[0,0],Sr=!1;Me||(ai?(Er=[Ct.x+fi+Xe[0],Ct.y+Xe[1]-wi],Sr=!0):mr=[Ct.x+fi+ge[0],Ct.y+ge[1]-wi]);const mn=hr.w*Ct.scale/(Bt*(Ct.localGlyph?vc:1)),en=hr.h*Ct.scale/(Bt*(Ct.localGlyph?vc:1));let nr,Zr,Kr,Mn;if(ai){const ls=Ct.y-nt,Kn=new ve(-fi,fi-ls),fs=-Math.PI/2,As=new ve(...Er);nr=new ve(-fi+mr[0],mr[1]),nr._rotateAround(fs,Kn)._add(As),nr.x+=-ls+fi,nr.y-=(Wi.left-ri)*Ct.scale;const _o=Ct.imageName?Wi.advance*Ct.scale:mo*Ct.scale,En=String.fromCodePoint(Ct.glyph);yF(En)?nr.x+=(1-ri)*Ct.scale:vF(En)?nr.x+=_o-Wi.height*Ct.scale+(-ri-1)*Ct.scale:nr.x+=Ct.imageName||Wi.width+2*ri===hr.w&&Wi.height+2*ri===hr.h?(_o-en)/2:(_o-(Wi.height+2*ri)*Ct.scale)/2,Zr=new ve(nr.x,nr.y-mn),Kr=new ve(nr.x+en,nr.y),Mn=new ve(nr.x+en,nr.y-mn)}else{const ls=(Wi.left-ri)*Ct.scale-fi+mr[0],Kn=(-Wi.top-ri)*Ct.scale+mr[1],fs=ls+mn,As=Kn+en;nr=new ve(ls,Kn),Zr=new ve(fs,Kn),Kr=new ve(ls,As),Mn=new ve(fs,As)}if(Je){let ls;ls=Me?new ve(0,0):Sr?new ve(Xe[0],Xe[1]):new ve(ge[0],ge[1]),nr._rotateAround(Je,ls),Zr._rotateAround(Je,ls),Kr._rotateAround(Je,ls),Mn._rotateAround(Je,ls)}const as=new ve(0,0),xs=new ve(0,0);He.push({tl:nr,tr:Zr,bl:Kr,br:Mn,texPrimary:si,texSecondary:void 0,writingMode:ie.writingMode,glyphOffset:pr,sectionIndex:Ct.sectionIndex,isSDF:Wt,pixelOffsetTL:as,pixelOffsetBR:xs,minFontScaleX:0,minFontScaleY:0})}}return He}(0,c,S,h,_,w,m,l.allowVerticalPlacement),Y=l.textSizeData;let $=null;Y.kind==="source"?($=[yc*h.layout.get("text-size").evaluate(w,{},z)*C.textScaleFactor],$[0]>jh&&Vi(`${l.layerIds[0]}: Value for "text-size" is >= ${ey}. Reduce your "text-size".`)):Y.kind==="composite"&&($=[yc*C.compositeTextSizes[0].evaluate(w,{},z)*C.textScaleFactor,yc*C.compositeTextSizes[1].evaluate(w,{},z)*C.textScaleFactor],($[0]>jh||$[1]>jh)&&Vi(`${l.layerIds[0]}: Value for "text-size" is >= ${ey}. Reduce your "text-size".`)),l.addSymbols(l.text,W,$,S,_,w,x,t,s,P.lineStartIndex,P.lineLength,E,R,z,V,!1);for(const J of A)I[J]=l.text.placedSymbolArray.length-1;return 4*W.length}function EM(l){for(const t in l)return l[t];return null}function W1(l,t,s,c,m,h,_,w,S,P){let x=_.top,A=_.bottom,I=_.left,E=_.right;const C=_.collisionPadding;if(C&&(I-=C[0],x-=C[1],E+=C[2],A+=C[3]),S){const R=new ve(I,x),z=new ve(E,x),V=new ve(I,A),W=new ve(E,A),Y=Et(S);let $=new ve(0,0);P&&($=new ve(P[0],P[1])),R._rotateAround(Y,$),z._rotateAround(Y,$),V._rotateAround(Y,$),W._rotateAround(Y,$),I=Math.min(R.x,z.x,V.x,W.x),E=Math.max(R.x,z.x,V.x,W.x),x=Math.min(R.y,z.y,V.y,W.y),A=Math.max(R.y,z.y,V.y,W.y)}return l.emplaceBack(t.x,t.y,t.z,s.x,s.y,I,x,E,A,w,c,m,h),l.length-1}function r2(l){l.collisionPadding&&(l.top-=l.collisionPadding[1],l.bottom+=l.collisionPadding[3]);const t=l.bottom-l.top;return t>0?Math.max(10,t):null}function LF(l,t,s,c){const m=l.compareText;if(t in m){const h=m[t];for(let _=h.length-1;_>=0;_--)if(c.dist(h[_])<s)return!0}else m[t]=[];return m[t].push(c),!1}function SM(l,t){const s=l.fovAboveCenter,c=l.elevation?l.elevation.getMinElevationBelowMSL()*t:0,m=(l._camera.position[2]*l.worldSize-c)/Math.cos(l._pitch),h=Math.sin(s)*m/Math.sin(Math.max(Math.PI/2-l._pitch-s,.01));let _=Math.sin(l._pitch)*h+m;const w=m*(1/l._horizonShift);if(!l.elevation||l.elevation.exaggeration()===0){let S=Math.max(l.zoom-17,0);l.isOrthographic&&(S/=10),_*=1+S}return Math.min(1.01*_,w)}function ty(l,t){if(!t.isReprojectedInTileSpace)return{scale:1<<l.z,x:l.x,y:l.y,x2:l.x+1,y2:l.y+1,projection:t};const s=Math.pow(2,-l.z),c=l.x*s,m=(l.x+1)*s,h=l.y*s,_=(l.y+1)*s,w=$o(c),S=$o(m),P=Ks(h),x=Ks(_),A=t.project(w,P),I=t.project(S,P),E=t.project(S,x),C=t.project(w,x);let R=Math.min(A.x,I.x,E.x,C.x),z=Math.min(A.y,I.y,E.y,C.y),V=Math.max(A.x,I.x,E.x,C.x),W=Math.max(A.y,I.y,E.y,C.y);const Y=s/16;function $(ie,ge,Pe,Me,Ce,$e){const Re=(Pe+Ce)/2,He=(Me+$e)/2,Je=t.project($o(Re),Ks(He)),Xe=Math.max(0,R-Je.x,z-Je.y,Je.x-V,Je.y-W);R=Math.min(R,Je.x),V=Math.max(V,Je.x),z=Math.min(z,Je.y),W=Math.max(W,Je.y),Xe>Y&&($(ie,Je,Pe,Me,Re,He),$(Je,ge,Re,He,Ce,$e))}$(A,I,c,h,m,h),$(I,E,m,h,m,_),$(E,C,m,_,c,_),$(C,A,c,_,c,h),R-=Y,z-=Y,V+=Y,W+=Y;const J=1/Math.max(V-R,W-z);return{scale:J,x:R*J,y:z*J,x2:V*J,y2:W*J,projection:t}}function AM(l,{x:t,y:s},c=0){return new ve(((t-c)*l.scale-l.x)*ii,(s*l.scale-l.y)*ii)}const kF=H.mat4.identity(new Float32Array(16));class $h{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,s){return{x:0,y:0,z:0}}unproject(t,s){return new Vr(0,0)}projectTilePoint(t,s,c){return{x:t,y:s,z:0}}locationPoint(t,s,c=!0){return t._coordinatePoint(t.locationCoordinate(s),c)}pixelsPerMeter(t,s){return Ao(1,t)*s}pixelSpaceConversion(t,s,c){return 1}farthestPixelDistance(t){return SM(t,t.pixelsPerMeter)}pointCoordinate(t,s,c,m){const h=t.horizonLineFromTop(!1),_=new ve(s,Math.max(h,c));return t.rayIntersectionCoordinate(t.pointRayIntersection(_,m))}pointCoordinate3D(t,s,c){const m=new ve(s,c);if(t.elevation)return t.elevation.pointCoordinate(m);{const h=this.pointCoordinate(t,m.x,m.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(t,s){if(t.elevation&&t.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(t,s.x,s.y);const c=t.horizonLineFromTop();return s.y<c}createInversionMatrix(t,s){return kF}createTileMatrix(t,s,c){let m,h,_;const w=c.canonical,S=H.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const P=ty(w,this);m=1,h=P.x+c.wrap*P.scale,_=P.y,H.mat4.scale(S,S,[m/P.scale,m/P.scale,t.pixelsPerMeter/s])}else m=s/t.zoomScale(w.z),h=(w.x+Math.pow(2,w.z)*c.wrap)*m,_=w.y*m;return H.mat4.translate(S,S,[h,_,0]),H.mat4.scale(S,S,[m/ii,m/ii,1]),S}upVector(t,s,c){return[0,0,1]}upVectorScale(t,s,c){return{metersToTile:1}}}class zF extends $h{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[s,c]=this.parallels=t.parallels||[29.5,45.5],m=Math.sin(Et(s));this.n=(m+Math.sin(Et(c)))/2,this.c=1+m*(2*this.n-m),this.r0=Math.sqrt(this.c)/this.n}project(t,s){const{n:c,c:m,r0:h}=this,_=Et(t-this.center[0]),w=Et(s),S=Math.sqrt(m-2*c*Math.sin(w))/c;return{x:S*Math.sin(_*c),y:S*Math.cos(_*c)-h,z:0}}unproject(t,s){const{n:c,c:m,r0:h}=this,_=h+s;let w=Math.atan2(t,Math.abs(_))*Math.sign(_);_*c<0&&(w-=Math.PI*Math.sign(t)*Math.sign(_));const S=Et(this.center[0])*c;w=zi(w,-Math.PI-S,Math.PI-S);const P=Ut(It(w/c)+this.center[0],-180,180),x=Math.asin(Ut((m-(t*t+_*_)*c*c)/(2*c),-1,1)),A=Ut(It(x),-is,is);return new Vr(P,A)}}const iy=1.340264,ry=-.081106,ny=893e-6,sy=.003796,Z1=Math.sqrt(3)/2;class FF extends $h{project(t,s){s=s/180*Math.PI,t=t/180*Math.PI;const c=Math.asin(Z1*Math.sin(s)),m=c*c,h=m*m*m;return{x:.5*(t*Math.cos(c)/(Z1*(iy+3*ry*m+h*(7*ny+9*sy*m)))/Math.PI+.5),y:1-.5*(c*(iy+ry*m+h*(ny+sy*m))/Math.PI+1),z:0}}unproject(t,s){t=(2*t-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,m=c*c,h=m*m*m;for(let x,A,I,E=0;E<12&&(A=c*(iy+ry*m+h*(ny+sy*m))-s,I=iy+3*ry*m+h*(7*ny+9*sy*m),x=A/I,c=Ut(c-x,-Math.PI/3,Math.PI/3),m=c*c,h=m*m*m,!(Math.abs(x)<1e-12));++E);const _=Z1*t*(iy+3*ry*m+h*(7*ny+9*sy*m))/Math.cos(c),w=Math.asin(Math.sin(c)/Z1),S=Ut(180*_/Math.PI,-180,180),P=Ut(180*w/Math.PI,-is,is);return new Vr(S,P)}}class BF extends $h{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,s){return{x:.5+t/360,y:.5-s/360,z:0}}unproject(t,s){const c=360*(t-.5),m=Ut(360*(.5-s),-is,is);return new Vr(c,m)}}const gm=Math.PI/2;function Y1(l){return Math.tan((gm+l)/2)}class NF extends $h{constructor(t){super(t),this.center=t.center||[0,30];const[s,c]=this.parallels=t.parallels||[30,30];let m=Et(s),h=Et(c);this.southernCenter=m+h<0,this.southernCenter&&(m=-m,h=-h);const _=Math.cos(m),w=Y1(m);this.n=m===h?Math.sin(m):Math.log(_/Math.cos(h))/Math.log(Y1(h)/w),this.f=_*Math.pow(Y1(m),this.n)/this.n}project(t,s){s=Et(s),this.southernCenter&&(s=-s),t=Et(t-this.center[0]);const c=1e-6,{n:m,f:h}=this;h>0?s<-gm+c&&(s=-gm+c):s>gm-c&&(s=gm-c);const _=h/Math.pow(Y1(s),m);let w=_*Math.sin(m*t),S=h-_*Math.cos(m*t);return w=.5*(w/Math.PI+.5),S=.5*(S/Math.PI+.5),{x:w,y:this.southernCenter?S:1-S,z:0}}unproject(t,s){t=(2*t-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;const{n:c,f:m}=this,h=m-s,_=Math.sign(h),w=Math.sign(c)*Math.sqrt(t*t+h*h);let S=Math.atan2(t,Math.abs(h))*_;h*c<0&&(S-=Math.PI*Math.sign(t)*_);const P=Ut(It(S/c)+this.center[0],-180,180),x=Ut(It(2*Math.atan(Math.pow(m/w,1/c))-gm),-is,is);return new Vr(P,this.southernCenter?-x:x)}}class CM extends $h{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,s){return{x:Bl(t),y:nl(s),z:0}}unproject(t,s){const c=$o(t),m=Ks(s);return new Vr(c,m)}}const MM=Et(is);class VF extends $h{project(t,s){const c=(s=Et(s))*s,m=c*c;return{x:.5*((t=Et(t))*(.8707-.131979*c+m*(m*(.003971*c-.001529*m)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+c*(.015085+m*(.028874*c-.044475-.005916*m)))/Math.PI+1),z:0}}unproject(t,s){t=(2*t-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,m=25,h=0,_=c*c;do{_=c*c;const P=_*_;h=(c*(1.007226+_*(.015085+P*(.028874*_-.044475-.005916*P)))-s)/(1.007226+_*(.045255+P*(.259866*_-.311325-.005916*11*P))),c=Ut(c-h,-MM,MM)}while(Math.abs(h)>1e-6&&--m>0);_=c*c;const w=Ut(It(t/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),S=It(c);return new Vr(w,S)}}const IM=Et(is);class UF extends $h{project(t,s){s=Et(s),t=Et(t);const c=Math.cos(s),m=2/Math.PI,h=Math.acos(c*Math.cos(t/2)),_=Math.sin(h)/h,w=.5*(t*m+2*c*Math.sin(t/2)/_)||0,S=.5*(s+Math.sin(s)/_)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(S/Math.PI+1),z:0}}unproject(t,s){let c=t=(2*t-.5)*Math.PI,m=s=(2*(1-s)-1)*Math.PI,h=25;const _=1e-6;let w=0,S=0;do{const P=Math.cos(m),x=Math.sin(m),A=2*x*P,I=x*x,E=P*P,C=Math.cos(c/2),R=Math.sin(c/2),z=2*C*R,V=R*R,W=1-E*C*C,Y=W?1/W:0,$=W?Math.acos(P*C)*Math.sqrt(1/W):0,J=.5*(2*$*P*R+2*c/Math.PI)-t,ie=.5*($*x+m)-s,ge=.5*Y*(E*V+$*P*C*I)+1/Math.PI,Pe=Y*(z*A/4-$*x*R),Me=.125*Y*(A*R-$*x*E*z),Ce=.5*Y*(I*C+$*V*P)+.5,$e=Pe*Me-Ce*ge;w=(ie*Pe-J*Ce)/$e,S=(J*Me-ie*ge)/$e,c=Ut(c-w,-Math.PI,Math.PI),m=Ut(m-S,-IM,IM)}while((Math.abs(w)>_||Math.abs(S)>_)&&--h>0);return new Vr(It(c),It(m))}}class PM extends $h{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Et(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,s){const{scale:c,cosPhi:m}=this;return{x:Et(t)*m*c+.5,y:-Math.sin(Et(s))/m*c+.5,z:0}}unproject(t,s){const{scale:c,cosPhi:m}=this,h=-(s-.5)/c,_=Ut(It((t-.5)/c)/m,-180,180),w=Math.asin(Ut(h*m,-1,1)),S=Ut(It(w),-is,is);return new Vr(_,S)}}class jF extends CM{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,s,c){const m=on(t,s,c),h=ks(gs(c));return H.vec3.transformMat4(m,m,h),{x:m[0],y:m[1],z:m[2]}}locationPoint(t,s){const c=Ou(s.lat,s.lng),m=H.vec3.normalize([],c),h=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(s),t._centerAltitude):t._centerAltitude,_=Ao(1,0)*ii*h;H.vec3.scaleAndAdd(c,c,m,_);const w=H.mat4.identity(new Float64Array(16));return H.mat4.multiply(w,t.pixelMatrix,t.globeMatrix),H.vec3.transformMat4(c,c,w),new ve(c[0],c[1])}pixelsPerMeter(t,s){return Ao(1,0)*s}pixelSpaceConversion(t,s,c){const m=Ao(1,t)*s,h=Bi(Ao(1,45)*s,m,c);return this.pixelsPerMeter(t,s)/h}createTileMatrix(t,s,c){const m=ln(gs(c.canonical));return H.mat4.multiply(new Float64Array(16),t.globeMatrix,m)}createInversionMatrix(t,s){const{center:c}=t,m=ks(gs(s));return H.mat4.rotateY(m,m,Et(c.lng)),H.mat4.rotateX(m,m,Et(c.lat)),H.mat4.scale(m,m,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(m)}pointCoordinate(t,s,c,m){return Hr(t,s,c,!0)||new a(0,0)}pointCoordinate3D(t,s,c){const m=this.pointCoordinate(t,s,c,0);return[m.x,m.y,m.z]}isPointAboveHorizon(t,s){return!Hr(t,s.x,s.y,!1)}farthestPixelDistance(t){const s=function(m,h){const _=m.cameraToCenterDistance,w=m._centerAltitude*h,S=m._camera,P=m._camera.forward(),x=H.vec3.add([],H.vec3.scale([],P,-_),[0,0,w]),A=m.worldSize/(2*Math.PI),I=[0,0,-A],E=m.width/m.height,C=Math.tan(m.fovAboveCenter),R=H.vec3.scale([],S.up(),C),z=H.vec3.scale([],S.right(),C*E),V=H.vec3.normalize([],H.vec3.add([],H.vec3.add([],P,R),z)),W=[];let Y;if(new er(x,V).closestPointOnSphere(I,A,W)){const $=H.vec3.add([],W,I),J=H.vec3.sub([],$,x);Y=Math.cos(m.fovAboveCenter)*H.vec3.length(J)}else{const $=H.vec3.sub([],x,I),J=H.vec3.sub([],I,x);H.vec3.normalize(J,J);const ie=H.vec3.length($)-A;Y=Math.sqrt(ie*(ie+2*A));const ge=Math.acos(Y/(A+ie))-Math.acos(H.vec3.dot(P,J));Y*=Math.cos(ge)}return 1.01*Y}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),c=Oo(t.zoom);if(c>0){const m=SM(t,Ao(1,t.center.lat)*t.worldSize),h=t.worldSize/(2*Math.PI),_=Math.max(t.width,t.height)/t.worldSize*Math.PI;return Bi(s,m+h*(1-Math.cos(_)),Math.pow(c,10))}return s}upVector(t,s,c){return on(s,c,t,1)}upVectorScale(t){return{metersToTile:Mr(Or(gs(t)))}}}function RM(l){const t=l.parallels,s=!!t&&Math.abs(t[0]+t[1])<.01;switch(l.name){case"mercator":return new CM(l);case"equirectangular":return new BF(l);case"naturalEarth":return new VF(l);case"equalEarth":return new FF(l);case"winkelTripel":return new UF(l);case"albers":return s?new PM(l):new zF(l);case"lambertConformalConic":return s?new PM(l):new NF(l);case"globe":return new jF(l)}throw new Error(`Invalid projection name: ${l.name}`)}const $F=dm.VectorTileFeature.types,qF=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function X1(l,t,s,c,m,h,_,w,S,P,x,A,I){const E=w?Math.min(jh,Math.round(w[0])):0,C=w?Math.min(jh,Math.round(w[1])):0;l.emplaceBack(t,s,Math.round(32*c),Math.round(32*m),h,_,(E<<1)+(S?1:0),C,16*P,16*x,256*A,256*I)}function K1(l,t,s){l.emplaceBack(t,s)}function J1(l,t,s,c,m,h,_){l.emplaceBack(t,s,c,m,h,_)}function Q1(l,t,s,c,m){l.emplaceBack(t,s,c,m),l.emplaceBack(t,s,c,m),l.emplaceBack(t,s,c,m),l.emplaceBack(t,s,c,m)}function HF(l){for(const t of l.sections)if(dg(t.text))return!0;return!1}class n2{constructor(t){this.layoutVertexArray=new xg,this.indexArray=new Xs,this.programConfigurations=t,this.segments=new ts,this.dynamicLayoutVertexArray=new Iu,this.opacityVertexArray=new wg,this.placedSymbolArray=new y1,this.iconTransitioningVertexArray=new qc,this.globeExtVertexArray=new bg,this.zOffsetVertexArray=new ff}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(t,s,c,m,h){this.isEmpty()||(c&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,lF.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,uF.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,qF,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,dF.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,cF.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||h)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,hF.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||m)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}gi(n2,"SymbolBuffers");class s2{constructor(t,s,c){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new c,this.segments=new ts,this.collisionVertexArray=new Sg,this.collisionVertexArrayExt=new Iu}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,fF.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,pF.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}gi(s2,"CollisionBuffers");class ev{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.lut=t.lut,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(_=>_.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=H.mat4.identity([]),this.placementViewportMatrix=H.mat4.identity([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Zw(this.zoom,s["text-size"]),this.iconSizeData=Zw(this.zoom,s["icon-size"]);const c=this.layers[0].layout,m=c.get("symbol-sort-key"),h=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(_=>sl[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=c.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new n2(new Wc(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("text")||t.startsWith("symbol"))),this.icon=new n2(new Wc(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("icon")||t.startsWith("symbol"))),this.glyphOffsetArray=new b1,this.lineVertexArray=new w1,this.symbolInstances=new x1}calculateGlyphDependencies(t,s,c,m,h){for(const _ of t){const w=_.codePointAt(0);if(w===void 0)break;if(s[w]=!0,m&&h&&w<=65535){const S=Yg[_];S&&(s[S.charCodeAt(0)]=!0)}}}updateFootprints(t,s){}updateReplacement(t,s){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const c=s.getReplacementRegionsForTile(t.toUnwrapped(),!0);return!Vw(this.activeReplacements,c)&&(this.activeReplacements=c,!0)}populate(t,s,c,m){const h=this.layers[0],_=h.layout,w=this.projection.name==="globe",S=_.get("text-font"),P=_.get("text-field"),x=_.get("icon-image"),[A,I]=_.get("icon-size-scale-range"),E=Ut(s.scaleFactor||1,A,I),C=(P.value.kind!=="constant"||P.value.value instanceof Ys&&!P.value.value.isEmpty()||P.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),R=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,z=_.get("symbol-sort-key");if(this.features=[],!C&&!R)return;const V=s.iconDependencies,W=s.glyphDependencies,Y=s.availableImages,$=new bn(this.zoom);for(const{feature:J,id:ie,index:ge,sourceLayerIndex:Pe}of t){const Me=h._featureFilter.needGeometry,Ce=U(J,Me);if(!h._featureFilter.filter($,Ce,c))continue;if(Me||(Ce.geometry=k(J,c,m)),w&&J.type!==1&&c.z<=5){const Xe=Ce.geometry,tt=.98078528056,at=(ft,nt)=>{const Mt=on(ft.x,ft.y,c,1),Ft=on(nt.x,nt.y,c,1);return H.vec3.dot(Mt,Ft)<tt};for(let ft=0;ft<Xe.length;ft++)Xe[ft]=T(Xe[ft],at)}let $e,Re;if(C){const Xe=h.getValueAndResolveTokens("text-field",Ce,c,Y),tt=Ys.factory(Xe);HF(tt)&&(this.hasRTLText=!0),(!this.hasRTLText||Wp()==="unavailable"||this.hasRTLText&&la.isParsed())&&($e=gF(tt,h,Ce))}if(R){const Xe=h.getValueAndResolveTokens("icon-image",Ce,c,Y);Re=Xe instanceof Us?Xe:Us.build(Xe)}if(!$e&&!Re)continue;const He=this.sortFeaturesByKey?z.evaluate(Ce,{},c):void 0,Je={id:ie,text:$e,icon:Re,index:ge,sourceLayerIndex:Pe,geometry:Ce.geometry,properties:J.properties,type:$F[J.type],sortKey:He};if(this.features.push(Je),Re){const Xe=Ww(this.iconSizeData,this.layers[0]._unevaluatedLayout._values["icon-size"],c,this.zoom,Je)*E*this.pixelRatio,tt=Re.getPrimary().scaleSelf(Xe);if(V[tt.id]=V[tt.id]||[],V[tt.id].push(tt),Re.nameSecondary){const at=Re.getSecondary().scaleSelf(Xe);V[at.id]=V[at.id]||[],V[at.id].push(at)}}if($e){const Xe=S.evaluate(Ce,{},c).join(","),tt=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(sl.vertical)>=0;for(const at of $e.sections)if(at.image){const ft=at.image.getPrimary().scaleSelf(this.pixelRatio);V[ft.id]=V[ft.id]||[],V[ft.id].push(ft)}else{const ft=cg($e.toString()),nt=at.fontStack||Xe,Mt=W[nt]=W[nt]||{};this.calculateGlyphDependencies(at.text,Mt,tt,this.allowVerticalPlacement,ft)}}}_.get("symbol-placement")==="line"&&(this.features=function(J){const ie={},ge={},Pe=[];let Me=0;function Ce(Je){Pe.push(J[Je]),Me++}function $e(Je,Xe,tt){const at=ge[Je];return delete ge[Je],ge[Xe]=at,Pe[at].geometry[0].pop(),Pe[at].geometry[0]=Pe[at].geometry[0].concat(tt[0]),at}function Re(Je,Xe,tt){const at=ie[Xe];return delete ie[Xe],ie[Je]=at,Pe[at].geometry[0].shift(),Pe[at].geometry[0]=tt[0].concat(Pe[at].geometry[0]),at}function He(Je,Xe,tt){const at=tt?Xe[0][Xe[0].length-1]:Xe[0][0];return`${Je}:${at.x}:${at.y}`}for(let Je=0;Je<J.length;Je++){const Xe=J[Je],tt=Xe.geometry,at=Xe.text?Xe.text.toString():null;if(!at){Ce(Je);continue}const ft=He(at,tt),nt=He(at,tt,!0);if(ft in ge&&nt in ie&&ge[ft]!==ie[nt]){const Mt=Re(ft,nt,tt),Ft=$e(ft,nt,Pe[Mt].geometry);delete ie[ft],delete ge[nt],ge[He(at,Pe[Ft].geometry,!0)]=Ft,Pe[Mt].geometry=null}else ft in ge?$e(ft,nt,tt):nt in ie?Re(ft,nt,tt):(Ce(Je),ie[ft]=Me-1,ge[nt]=Me-1)}return Pe.filter(Je=>Je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,ie)=>J.sortKey-ie.sortKey)}update(t,s,c,m,h,_,w){this.text.programConfigurations.updatePaintArrays(t,s,h,c,m,_,w),this.icon.programConfigurations.updatePaintArrays(t,s,h,c,m,_,w)}updateZOffset(){const t=(h,_,w)=>{c+=_,c>h.length&&h.resize(c);for(let S=-_;S<0;S++)h.emplace(S+c,w)},s=(h,_,w)=>{m+=_,m>h.length&&h.resize(m);for(let S=-_;S<0;S++)h.emplace(S+m,w)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let c=0,m=0;for(let h=0;h<this.symbolInstances.length;h++){const _=this.symbolInstances.get(h),{numHorizontalGlyphVertices:w,numVerticalGlyphVertices:S,numIconVertices:P}=_,x=_.zOffset,A=P>0;if((w>0||S>0)&&(t(this.text.zOffsetVertexArray,w,x),t(this.text.zOffsetVertexArray,S,x)),A){const{placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:E}=_;I>=0&&s(this.icon.zOffsetVertexArray,P,x),E>=0&&s(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,x)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=RM(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){const c=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:m,y:h}of s)this.lineVertexArray.emplaceBack(m,h);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(t,s,c,m,h,_,w,S,P,x,A,I,E,C,R,z){const V=t.indexArray,W=t.layoutVertexArray,Y=t.globeExtVertexArray,$=t.segments.prepareSegment(4*s.length,W,V,this.canOverlap?_.sortKey:void 0),J=this.glyphOffsetArray.length,ie=$.vertexLength,ge=this.allowVerticalPlacement&&w===sl.vertical?Math.PI/2:0,Pe=_.text&&_.text.sections;for(let Ce=0;Ce<s.length;Ce++){const{tl:$e,tr:Re,bl:He,br:Je,texPrimary:Xe,texSecondary:tt,pixelOffsetTL:at,pixelOffsetBR:ft,minFontScaleX:nt,minFontScaleY:Mt,glyphOffset:Ft,isSDF:Ct,sectionIndex:si}=s[Ce],ri=$.vertexLength,Wt=Ft[1];if(X1(W,P.x,P.y,$e.x,Wt+$e.y,Xe.x,Xe.y,c,Ct,at.x,at.y,nt,Mt),X1(W,P.x,P.y,Re.x,Wt+Re.y,Xe.x+Xe.w,Xe.y,c,Ct,ft.x,at.y,nt,Mt),X1(W,P.x,P.y,He.x,Wt+He.y,Xe.x,Xe.y+Xe.h,c,Ct,at.x,ft.y,nt,Mt),X1(W,P.x,P.y,Je.x,Wt+Je.y,Xe.x+Xe.w,Xe.y+Xe.h,c,Ct,ft.x,ft.y,nt,Mt),S){const{x:Bt,y:wi,z:ai}=S.anchor,[fi,Wi,hr]=S.up;J1(Y,Bt,wi,ai,fi,Wi,hr),J1(Y,Bt,wi,ai,fi,Wi,hr),J1(Y,Bt,wi,ai,fi,Wi,hr),J1(Y,Bt,wi,ai,fi,Wi,hr),Q1(t.dynamicLayoutVertexArray,Bt,wi,ai,ge)}else Q1(t.dynamicLayoutVertexArray,P.x,P.y,P.z,ge);if(z){const Bt=tt||Xe;K1(t.iconTransitioningVertexArray,Bt.x,Bt.y),K1(t.iconTransitioningVertexArray,Bt.x+Bt.w,Bt.y),K1(t.iconTransitioningVertexArray,Bt.x,Bt.y+Bt.h),K1(t.iconTransitioningVertexArray,Bt.x+Bt.w,Bt.y+Bt.h)}V.emplaceBack(ri,ri+1,ri+2),V.emplaceBack(ri+1,ri+2,ri+3),$.vertexLength+=4,$.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ft[0]),Ce!==s.length-1&&si===s[Ce+1].sectionIndex||t.programConfigurations.populatePaintArrays(W.length,_,_.index,{},E,C,R,Pe&&Pe[si])}const Me=S?S.anchor:P;t.placedSymbolArray.emplaceBack(Me.x,Me.y,Me.z,P.x,P.y,J,this.glyphOffsetArray.length-J,ie,x,A,P.segment,c?c[0]:0,c?c[1]:0,m[0],m[1],w,0,!1,0,I,0)}_commitLayoutVertex(t,s,c,m,h,_,w){t.emplaceBack(s,c,m,h,_,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(t,s,c,m,h,_,w){const S=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),P=S.vertexLength,x=w.tileAnchorX,A=w.tileAnchorY;for(let E=0;E<4;E++)c.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(c.collisionVertexArrayExt,s,t.padding,w.zOffset),this._commitLayoutVertex(c.layoutVertexArray,m,h,_,x,A,new ve(t.x1,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,m,h,_,x,A,new ve(t.x2,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,m,h,_,x,A,new ve(t.x2,t.y2)),this._commitLayoutVertex(c.layoutVertexArray,m,h,_,x,A,new ve(t.x1,t.y2)),S.vertexLength+=4;const I=c.indexArray;I.emplaceBack(P,P+1),I.emplaceBack(P+1,P+2),I.emplaceBack(P+2,P+3),I.emplaceBack(P+3,P),S.primitiveLength+=4}_addTextDebugCollisionBoxes(t,s,c,m,h,_){for(let w=m;w<h;w++){const S=c.get(w),P=this.getSymbolInstanceTextSize(t,_,s,w);this._addCollisionDebugVertices(S,P,this.textCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(t,s,c,m,h,_){for(let w=m;w<h;w++){const S=c.get(w),P=this.getSymbolInstanceIconSize(t,s,_.placedIconSymbolIndex);this._addCollisionDebugVertices(S,P,this.iconCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,_)}}generateCollisionDebugBuffers(t,s,c){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new s2(tm,JC.members,qc),this.iconCollisionBox=new s2(tm,JC.members,qc);const m=fm(this.iconSizeData,t),h=fm(this.textSizeData,t,c);for(let _=0;_<this.symbolInstances.length;_++){const w=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(h,t,s,w.textBoxStartIndex,w.textBoxEndIndex,w),this._addTextDebugCollisionBoxes(h,t,s,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._addIconDebugCollisionBoxes(m,t,s,w.iconBoxStartIndex,w.iconBoxEndIndex,w),this._addIconDebugCollisionBoxes(m,t,s,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w)}}getSymbolInstanceTextSize(t,s,c,m){const h=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:m),_=U1(this.textSizeData,t,h)/mo;return this.tilePixelRatio*_}getSymbolInstanceIconSize(t,s,c){const m=this.icon.placedSymbolArray.get(c),h=U1(this.iconSizeData,t,m);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(t,s,c,m){t.emplaceBack(s,-c,-c,m),t.emplaceBack(s,c,-c,m),t.emplaceBack(s,c,c,m),t.emplaceBack(s,-c,c,m)}_updateTextDebugCollisionBoxes(t,s,c,m,h,_,w){for(let S=m;S<h;S++){const P=c.get(S),x=this.getSymbolInstanceTextSize(t,_,s,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,x,P.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(t,s,c,m,h,_,w){for(let S=m;S<h;S++){const P=c.get(S),x=this.getSymbolInstanceIconSize(t,s,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,P.padding,_.zOffset)}}updateCollisionDebugBuffers(t,s,c,m){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=fm(this.iconSizeData,t,m),_=fm(this.textSizeData,t,c);for(let w=0;w<this.symbolInstances.length;w++){const S=this.symbolInstances.get(w);this._updateTextDebugCollisionBoxes(_,t,s,S.textBoxStartIndex,S.textBoxEndIndex,S,c),this._updateTextDebugCollisionBoxes(_,t,s,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S,c),this._updateIconDebugCollisionBoxes(h,t,s,S.iconBoxStartIndex,S.iconBoxEndIndex,S,m),this._updateIconDebugCollisionBoxes(h,t,s,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,s,c,m,h,_,w,S,P){const x={};if(s<c){const{x1:A,y1:I,x2:E,y2:C,padding:R,projectedAnchorX:z,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:Y,tileAnchorY:$,featureIndex:J}=t.get(s);x.textBox={x1:A,y1:I,x2:E,y2:C,padding:R,projectedAnchorX:z,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:Y,tileAnchorY:$},x.textFeatureIndex=J}if(m<h){const{x1:A,y1:I,x2:E,y2:C,padding:R,projectedAnchorX:z,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:Y,tileAnchorY:$,featureIndex:J}=t.get(m);x.verticalTextBox={x1:A,y1:I,x2:E,y2:C,padding:R,projectedAnchorX:z,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:Y,tileAnchorY:$},x.verticalTextFeatureIndex=J}if(_<w){const{x1:A,y1:I,x2:E,y2:C,padding:R,projectedAnchorX:z,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:Y,tileAnchorY:$,featureIndex:J}=t.get(_);x.iconBox={x1:A,y1:I,x2:E,y2:C,padding:R,projectedAnchorX:z,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:Y,tileAnchorY:$},x.iconFeatureIndex=J}if(S<P){const{x1:A,y1:I,x2:E,y2:C,padding:R,projectedAnchorX:z,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:Y,tileAnchorY:$,featureIndex:J}=t.get(S);x.verticalIconBox={x1:A,y1:I,x2:E,y2:C,padding:R,projectedAnchorX:z,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:Y,tileAnchorY:$},x.verticalIconFeatureIndex=J}return x}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,s){const c=t.placedSymbolArray.get(s),m=c.vertexStartIndex+4*c.numGlyphs;for(let h=c.vertexStartIndex;h<m;h+=4)t.indexArray.emplaceBack(h,h+1,h+2),t.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(t),c=Math.cos(t),m=[],h=[],_=[];for(let w=0;w<this.symbolInstances.length;++w){_.push(w);const S=this.symbolInstances.get(w);m.push(0|Math.round(s*S.tileAnchorX+c*S.tileAnchorY)),h.push(S.featureIndex)}return _.sort((w,S)=>m[w]-m[S]||h[S]-h[w]),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,s)=>this.symbolInstances.get(s).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:h,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:P}=c;m>=0&&this.addIndicesForPlacedSymbol(this.text,m),h>=0&&h!==m&&this.addIndicesForPlacedSymbol(this.text,h),_>=0&&_!==h&&_!==m&&this.addIndicesForPlacedSymbol(this.text,_),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let DM,OM,o2;gi(ev,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ev.addDynamicAttributes=Q1;class LM{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:oc,this.defaultValue=t}evaluate(t){if(t.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}gi(LM,"FormatSectionOverride",{omit:["defaultValue"]});const a2=()=>o2||(o2={layout:DM||(DM=new Bn({"symbol-placement":new Xt(gt.layout_symbol["symbol-placement"]),"symbol-spacing":new Xt(gt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Xt(gt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new hi(gt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Xt(gt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Xt(gt.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Xt(gt.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Xt(gt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Xt(gt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Xt(gt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Xt(gt.layout_symbol["icon-rotation-alignment"]),"icon-size":new hi(gt.layout_symbol["icon-size"]),"icon-size-scale-range":new Xt(gt.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new hi(gt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new hi(gt.layout_symbol["icon-text-fit-padding"]),"icon-image":new hi(gt.layout_symbol["icon-image"]),"icon-rotate":new hi(gt.layout_symbol["icon-rotate"]),"icon-padding":new Xt(gt.layout_symbol["icon-padding"]),"icon-keep-upright":new Xt(gt.layout_symbol["icon-keep-upright"]),"icon-offset":new hi(gt.layout_symbol["icon-offset"]),"icon-anchor":new hi(gt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Xt(gt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Xt(gt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Xt(gt.layout_symbol["text-rotation-alignment"]),"text-field":new hi(gt.layout_symbol["text-field"]),"text-font":new hi(gt.layout_symbol["text-font"]),"text-size":new hi(gt.layout_symbol["text-size"]),"text-size-scale-range":new Xt(gt.layout_symbol["text-size-scale-range"]),"text-max-width":new hi(gt.layout_symbol["text-max-width"]),"text-line-height":new hi(gt.layout_symbol["text-line-height"]),"text-letter-spacing":new hi(gt.layout_symbol["text-letter-spacing"]),"text-justify":new hi(gt.layout_symbol["text-justify"]),"text-radial-offset":new hi(gt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Xt(gt.layout_symbol["text-variable-anchor"]),"text-anchor":new hi(gt.layout_symbol["text-anchor"]),"text-max-angle":new Xt(gt.layout_symbol["text-max-angle"]),"text-writing-mode":new Xt(gt.layout_symbol["text-writing-mode"]),"text-rotate":new hi(gt.layout_symbol["text-rotate"]),"text-padding":new Xt(gt.layout_symbol["text-padding"]),"text-keep-upright":new Xt(gt.layout_symbol["text-keep-upright"]),"text-transform":new hi(gt.layout_symbol["text-transform"]),"text-offset":new hi(gt.layout_symbol["text-offset"]),"text-allow-overlap":new Xt(gt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Xt(gt.layout_symbol["text-ignore-placement"]),"text-optional":new Xt(gt.layout_symbol["text-optional"]),visibility:new Xt(gt.layout_symbol.visibility)})),paint:OM||(OM=new Bn({"icon-opacity":new hi(gt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new hi(gt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new hi(gt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new hi(gt.paint_symbol["text-emissive-strength"]),"icon-color":new hi(gt.paint_symbol["icon-color"]),"icon-halo-color":new hi(gt.paint_symbol["icon-halo-color"]),"icon-halo-width":new hi(gt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new hi(gt.paint_symbol["icon-halo-blur"]),"icon-translate":new Xt(gt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Xt(gt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new hi(gt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new hi(gt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new hi(gt.paint_symbol["text-occlusion-opacity"]),"text-color":new hi(gt.paint_symbol["text-color"],{runtimeType:Ws,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new hi(gt.paint_symbol["text-halo-color"]),"text-halo-width":new hi(gt.paint_symbol["text-halo-width"]),"text-halo-blur":new hi(gt.paint_symbol["text-halo-blur"]),"text-translate":new Xt(gt.paint_symbol["text-translate"]),"text-translate-anchor":new Xt(gt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Xt(gt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Xt(gt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Xt(gt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Xt(gt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new hi(gt.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"})}))},o2);class tv extends js{constructor(t,s,c,m){super(t,a2(),s,c,m),this._colorAdjustmentMatrix=H.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=t.paint!==void 0&&("icon-occlusion-opacity"in t.paint||"text-occlusion-opacity"in t.paint)}recalculate(t,s){super.recalculate(t,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const m=[];for(const h of c)m.indexOf(h)<0&&m.push(h);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(t,s,c,m){return this._saturation===t&&this._contrast===s&&this._brightnessMin===c&&this._brightnessMax===m||(this._colorAdjustmentMatrix=function(h,_,w,S){h=or(h),_=vr(_);const P=H.mat4.create(),x=h/3,A=1-2*x,I=[A,x,x,0,x,A,x,0,x,x,A,0,0,0,0,1],E=.5-.5*_,C=S-w;return H.mat4.multiply(P,[C,0,0,0,0,C,0,0,0,0,C,0,w,w,w,1],[_,0,0,0,0,_,0,0,0,0,_,0,E,E,E,1]),H.mat4.multiply(P,P,I),P}(t,s,c,m),this._saturation=t,this._contrast=s,this._brightnessMin=c,this._brightnessMax=m),this._colorAdjustmentMatrix}getValueAndResolveTokens(t,s,c,m){const h=this.layout.get(t).evaluate(s,{},c,m),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||Th(_.value)||!h?h:function(w,S){return S.replace(/{([^{}]+)}/g,(P,x)=>x in w?String(w[x]):"")}(s.properties,h)}createBucket(t){return new ev(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of a2().paint.overridableProperties){if(!tv.hasPaintOverride(this.layout,t))continue;const s=this.paint.get(t),c=new LM(s),m=new jp(c,s.property.specification,this.scope,this.options);let h=null;h=s.value.kind==="constant"||s.value.kind==="source"?new $p("source",m):new rf("composite",m,s.value.zoomStops,s.value._interpolationType),this.paint._values[t]=new Ch(s.property,h,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&tv.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){const c=t.get("text-field"),m=a2().paint.properties[s];let h=!1;const _=w=>{for(const S of w)if(m.overrides&&m.overrides.hasOverride(S))return void(h=!0)};if(c.value.kind==="constant"&&c.value.value instanceof Ys)_(c.value.value.sections);else if(c.value.kind==="source"){const w=P=>{h||(P instanceof Ds&&kn(P.value)===na?_(P.value.sections):P instanceof ac?_(P.sections):P.eachChild(w))},S=c.value;S._styleExpression&&w(S._styleExpression.expression)}return h}getProgramIds(){return["symbol"]}getDefaultProgramParams(t,s,c){return{config:new Du(this,{zoom:s,lut:c}),overrideFog:!1}}}let kM,zM,FM,BM;var l2=qr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function c2(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function u2(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class h2{constructor(t,s,c,m){this.context=t,this.format=c,this.useMipmap=m&&m.useMipmap,this.texture=t.gl.createTexture(),this.update(s,{premultiply:m&&m.premultiply})}update(t,s){const c=t&&t instanceof HTMLVideoElement&&t.width===0?t.videoWidth:t.width,m=t&&t instanceof HTMLVideoElement&&t.height===0?t.videoHeight:t.height,{context:h}=this,{gl:_}=h,{x:w,y:S}=s&&s.position?s.position:{x:0,y:0},P=w+c,x=S+m;!this.size||this.size[0]===P&&this.size[1]===x||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!s||s.premultiply!==!1));const A=t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap;if(!this.size&&P>0&&x>0){const I=this.useMipmap?Math.floor(Math.log2(Math.max(P,x)))+1:1;_.texStorage2D(_.TEXTURE_2D,I,this.format,P,x),this.size=[P,x]}if(this.size)if(A)_.texSubImage2D(_.TEXTURE_2D,0,w,S,c2(this.format),u2(this.format),t);else{const I=t.data;I&&_.texSubImage2D(_.TEXTURE_2D,0,w,S,c,m,c2(this.format),u2(this.format),I)}this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(t,s,c=!1){const{context:m}=this,{gl:h}=m;h.bindTexture(h.TEXTURE_2D,this.texture),t!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap&&!c?t===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),s!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,s),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,s),this.wrapS=s)}bindExtraParam(t,s,c,m){const{context:h}=this,{gl:_}=h;_.bindTexture(_.TEXTURE_2D,this.texture),s!==this.magFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,s),this.magFilter=s),t!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,this.useMipmap?t===_.NEAREST?_.NEAREST_MIPMAP_NEAREST:_.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),c!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,c),this.wrapS=c),m!==this.wrapT&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,m),this.wrapT=m)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class iv{constructor(t,s){this.context=t,this.texture=s}bind(t,s){const{context:c}=this,{gl:m}=c;m.bindTexture(m.TEXTURE_2D,this.texture),t!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,t),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,t),this.minFilter=t),s!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,s),this.wrapS=s)}}function rv(l,t,s,c,m,h,_,w){const S=[l,t,1,s,c,1,m,h,1],P=[_,w,1],x=H.mat3.adjoint([],S),[A,I,E]=H.vec3.transformMat3(P,P,x);return H.mat3.multiply(S,S,[A,0,0,0,I,0,0,0,E])}function NM(l,t,s,c,m,h,_,w){const S=function(P,x,A,I,E,C,R,z){const V=rv(0,0,1,0,1,1,0,1),W=rv(P,x,A,I,E,C,R,z),Y=H.mat3.adjoint([],V);return H.mat3.multiply(W,W,Y)}(l,t,s,c,m,h,_,w);return[S[2]/S[8]/ii,S[5]/S[8]/ii]}function nv(l){return[l[0],Math.min(Math.max(l[1],-is),is)]}class VM extends Ml{constructor(t,s,c,m){super(),this.id=t,this.dispatcher=c,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(m),this.options=s,this._dirty=!1}load(t,s){if(this._loaded=s||!1,this.fire(new Ia("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=Rc(this.map._requestManager.transformRequest(this.url,wr.Image),(c,m)=>{this._imageRequest=null,this._loaded=!0,c?this.fire(new Dc(c)):m&&(this.image=m instanceof HTMLImageElement?ze.getImageData(m):m,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new iv(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ia("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(t){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof iv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let s=t[0][1],c=t[0][1];for(const h of t)h[1]>c&&(c=h[1]),h[1]<s&&(s=h[1]);const m=(c+s)/2;if(m>is?this.onNorthPole=!0:m<-is&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const h=t.map(a.fromLngLat);this.tileID=function(_){let w=1/0,S=1/0,P=-1/0,x=-1/0;for(const R of _)w=Math.min(w,R.x),S=Math.min(S,R.y),P=Math.max(P,R.x),x=Math.max(x,R.y);const A=Math.max(P-w,x-S),I=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),E=Math.pow(2,I);let C=Math.floor((w+P)/2*E);return C>1&&(C-=1),new kt(I,C,Math.floor((S+x)/2*E))}(h),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ia("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const V in this.tiles){const W=this.tiles[V];W.state!=="loaded"&&(W.state="loaded",W.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const s=ty(new kt(0,0,0),this.map.transform.projection),c=[s.projection.project(this.coordinates[0][0],this.coordinates[0][1]),s.projection.project(this.coordinates[1][0],this.coordinates[1][1]),s.projection.project(this.coordinates[2][0],this.coordinates[2][1]),s.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(V){const W=V[1].x-V[0].x,Y=V[1].y-V[0].y,$=V[2].x-V[1].x,J=V[2].y-V[1].y,ie=V[3].x-V[2].x,ge=V[3].y-V[2].y,Pe=V[0].x-V[3].x,Me=V[0].y-V[3].y,Ce=W*J-$*Y,$e=$*ge-ie*J,Re=ie*Me-Pe*ge,He=Pe*Y-W*Me;return Ce>0&&$e>0&&Re>0&&He>0||Ce<0&&$e<0&&Re<0&&He<0}(c))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const m=ty(this.tileID,this.map.transform.projection),[h,_,w,S]=this.coordinates.map(V=>{const W=m.projection.project(V[0],V[1]);return AM(m,W)._round()});this.perspectiveTransform=NM(h.x,h.y,_.x,_.y,w.x,w.y,S.x,S.y);const P=this._boundsArray=new _c;P.emplaceBack(h.x,h.y,0,0),P.emplaceBack(_.x,_.y,ii,0),P.emplaceBack(S.x,S.y,0,ii),P.emplaceBack(w.x,w.y,ii,ii),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(P,l2.members),this.boundsSegments=ts.simpleSegment(0,0,4,2);const x=[],A=[nv((I=this.coordinates)[0]),nv(I[1]),nv(I[2]),nv(I[3])];var I;const[E,C,R,z]=function(V){let W=V[0][0],Y=W,$=V[0][1],J=$;for(let ie=1;ie<V.length;ie++)V[ie][0]<W?W=V[ie][0]:V[ie][0]>Y&&(Y=V[ie][0]),V[ie][1]<$?$=V[ie][1]:V[ie][1]>J&&(J=V[ie][1]);return[W,$,Y-W,J-$]}(A);{const V=new _c,[W,Y,$,J]=function(at){let ft=at[0].x,nt=ft,Mt=at[0].y,Ft=Mt;for(let Ct=1;Ct<at.length;Ct++)at[Ct].x<ft?ft=at[Ct].x:at[Ct].x>nt&&(nt=at[Ct].x),at[Ct].y<Mt?Mt=at[Ct].y:at[Ct].y>Ft&&(Ft=at[Ct].y);return[ft,Mt,nt-ft,Ft-Mt]}(c),ie=at=>[(at.x-W)/$,(at.y-Y)/J],[ge,Pe,Me,Ce]=c.map(ie),$e=function(at,ft,nt,Mt,Ft,Ct,si,ri){const Wt=rv(0,0,1,0,1,1,0,1),Bt=rv(at,ft,nt,Mt,Ft,Ct,si,ri),wi=H.mat3.adjoint([],Bt);return H.mat3.multiply(Wt,Wt,wi)}(ge[0],ge[1],Pe[0],Pe[1],Me[0],Me[1],Ce[0],Ce[1]);this.elevatedGlobePerspectiveTransform=NM(ge[0],ge[1],Pe[0],Pe[1],Me[0],Me[1],Ce[0],Ce[1]);const Re=(at,ft)=>{x.push(at.lng);const nt=Math.round((at.lng-E)/R*ii),Mt=Math.round((at.lat-C)/z*ii),Ft=ie(ft),Ct=H.vec3.transformMat3([],[Ft[0],Ft[1],1],$e),si=Math.round(Ct[0]/Ct[2]*ii),ri=Math.round(Ct[1]/Ct[2]*ii);V.emplaceBack(nt,Mt,si,ri)},He=c[3].x-c[0].x,Je=c[3].y-c[0].y,Xe=c[2].x-c[1].x,tt=c[2].y-c[1].y;for(let at=0;at<65;at++){const ft=at/64,nt=[c[0].x+ft*He,c[0].y+ft*Je],Mt=[c[1].x+ft*Xe,c[1].y+ft*tt],Ft=Mt[0]-nt[0],Ct=Mt[1]-nt[1];for(let si=0;si<65;si++){const ri=si/64,Wt={x:nt[0]+Ft*ri,y:nt[1]+Ct*ri,z:0};Re(s.projection.unproject(Wt.x,Wt.y),Wt)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(V,l2.members)}{this.maxLongitudeTriangleSize=0;let V=[],W=new Xs;const Y=($,J,ie)=>{W.emplaceBack($,J,ie);const ge=x[$],Pe=x[J],Me=x[ie],Ce=Math.min(Math.min(ge,Pe),Me),$e=Math.max(Math.max(ge,Pe),Me)-Ce;$e>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=$e),V.push(Ce+$e/2)};for(let $=0;$<64;$++)for(let J=0;J<64;J++){const ie=65*$+J,ge=ie+1,Pe=ie+65,Me=Pe+1;Y(ie,Pe,ge),Y(ge,Pe,Me)}[V,W]=function($,J){const ie=Array.from({length:$.length},(Me,Ce)=>Ce);ie.sort((Me,Ce)=>$[Me]-$[Ce]);const ge=[],Pe=new Xs;for(let Me=0;Me<ie.length;Me++){const Ce=ie[Me];ge.push($[Ce]);const $e=3*Ce,Re=$e+1;Pe.emplaceBack(J.uint16[$e],J.uint16[Re],J.uint16[Re+1])}return[ge,Pe]}(V,W),this.elevatedGlobeTrianglesCenterLongitudes=V,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(W)}this.elevatedGlobeSegments=ts.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,R/ii,0,z/ii,0,0,C,E,0])}prepare(){const t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;const s=this.map.painter.context,c=s.gl;!this._dirty||this.texture instanceof iv||(this.texture?this.texture.update(this.image):(this.texture=new h2(s,this.image,c.RGBA8),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(s)}loadTile(t,s){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},s(null)):(t.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){const s=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!s)return null;const c=this.elevatedGlobeTrianglesCenterLongitudes;let m=(h=t+180)+360*Math.round((c[0]-h)/360);var h;const _=new ts,w=(A,I)=>{_.segments.push({vertexOffset:0,primitiveOffset:A,vertexLength:s.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},S=.51*this.maxLongitudeTriangleSize;if(Math.abs(c[0]-m)<=S){const A=Rs(c,0,c.length,m+S);return A===c.length||w(A,Hs(c,A+1,c.length,m+360-S)-A),_}m<c[0]&&(m+=360);const P=Hs(c,0,c.length,m-S);if(P===c.length)return w(0,c.length),_;w(0,P-0);const x=Rs(c,P+1,c.length,m+S);return x!==c.length&&w(x,c.length-x),_}}const GF=(Math.pow(256,2)-1)/16907520;class UM extends js{constructor(t,s,c,m){super(t,{layout:FM||(FM=new Bn({visibility:new Xt(gt.layout_raster.visibility)})),paint:BM||(BM=new Bn({"raster-opacity":new Xt(gt.paint_raster["raster-opacity"]),"raster-color":new Ih(gt.paint_raster["raster-color"]),"raster-color-mix":new Xt(gt.paint_raster["raster-color-mix"]),"raster-color-range":new Xt(gt.paint_raster["raster-color-range"]),"raster-hue-rotate":new Xt(gt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Xt(gt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Xt(gt.paint_raster["raster-brightness-max"]),"raster-saturation":new Xt(gt.paint_raster["raster-saturation"]),"raster-contrast":new Xt(gt.paint_raster["raster-contrast"]),"raster-resampling":new Xt(gt.paint_raster["raster-resampling"]),"raster-fade-duration":new Xt(gt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Xt(gt.paint_raster["raster-emissive-strength"]),"raster-array-band":new Xt(gt.paint_raster["raster-array-band"]),"raster-elevation":new Xt(gt.paint_raster["raster-elevation"]),"raster-color-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"})}))},s,c,m),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(t){return!(t&&t._source instanceof VM&&(t._source.onNorthPole||t._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(t){if(!this.hasColorMap()||!this._curRampRange)return;const s=this._transitionablePaint._values["raster-color"].value.expression,[c,m]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(c)&&isNaN(m)||c===this._curRampRange[0]&&m===this._curRampRange[1]||(this.colorRamp=Ng({expression:s,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:c,end:m}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[c,m])}}let jM,$M,qM,HM,GM;class WM extends js{constructor(t,s,c,m){super(t,{layout:jM||(jM=new Bn({visibility:new Xt(gt["layout_raster-particle"].visibility)})),paint:$M||($M=new Bn({"raster-particle-array-band":new Xt(gt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Xt(gt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Ih(gt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Xt(gt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Xt(gt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Xt(gt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Xt(gt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Xt(gt["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"})}))},s,c,m),this._updateColorRamp(),this.lastInvalidatedAt=ze.now()}onRemove(t){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){t!=="raster-particle-color"&&t!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),t==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-particle-color"].value.expression,s=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Ng({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:s}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ze.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class WF extends js{constructor(t,s){super(t,{},s,null),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}function d2(l,t,s){const c=[0,0,1],m=H.quat.identity([]);return H.quat.rotateY(m,m,s?-Et(l)+Math.PI:Et(l)),H.quat.rotateX(m,m,-Et(t)),H.vec3.transformQuat(c,c,m),H.vec3.normalize(c,c)}function ZM(l,t){const s=sv(l.projection,l.zoom,l.width,l.height),c=function(h,_,w,S,P){const x=new Vr(w.lng-180*qh,w.lat),A=new Vr(w.lng+180*qh,w.lat),I=h.project(x.lng,x.lat),E=h.project(A.lng,A.lat),C=-Math.atan2(E.y-I.y,E.x-I.x),R=a.fromLngLat(w);R.y=Ut(R.y,-1+qh,1-qh);const z=R.toLngLat(),V=h.project(z.lng,z.lat),W=a.fromLngLat(z);W.x+=qh;const Y=W.toLngLat(),$=h.project(Y.lng,Y.lat),J=XM($.x-V.x,$.y-V.y,C),ie=a.fromLngLat(z);ie.y+=qh;const ge=ie.toLngLat(),Pe=h.project(ge.lng,ge.lat),Me=XM(Pe.x-V.x,Pe.y-V.y,C),Ce=Math.abs(J.x)/Math.abs(Me.y),$e=H.mat4.identity([]);H.mat4.rotateZ($e,$e,-C*(1-(P?0:S)));const Re=H.mat4.identity([]);return H.mat4.scale(Re,Re,[1,1-(1-Ce)*S,1]),Re[4]=-Me.x/Me.y*S,H.mat4.rotateZ(Re,Re,C),H.mat4.multiply(Re,$e,Re),Re}(l.projection,0,l.center,s,t),m=YM(l);return H.mat4.scale(c,c,[m,m,1]),c}function YM(l){const t=l.projection,s=sv(l.projection,l.zoom,l.width,l.height),c=f2(t,l.center),m=f2(t,Vr.convert(t.center));return Math.pow(2,c*s+(1-s)*m)}function sv(l,t,s,c,m=1/0){const h=l.range;if(!h)return 0;const _=Math.min(m,Math.max(s,c)),w=Math.log(_/1024)/Math.LN2;return yi(h[0]+w,h[1]+w,t)}const qh=1/4e4;function f2(l,t){const s=Ut(t.lat,-is,is),c=new Vr(t.lng-180*qh,s),m=new Vr(t.lng+180*qh,s),h=l.project(c.lng,s),_=l.project(m.lng,s),w=a.fromLngLat(c),S=a.fromLngLat(m),P=_.x-h.x,x=_.y-h.y,A=S.x-w.x,I=S.y-w.y,E=Math.sqrt((A*A+I*I)/(P*P+x*x));return Math.log(E)/Math.LN2}function XM(l,t,s){const c=Math.cos(s),m=Math.sin(s);return{x:l*c-t*m,y:l*m+t*c}}function KM(l,t,s){H.mat4.identity(l),H.mat4.rotateZ(l,l,Et(t[2])),H.mat4.rotateX(l,l,Et(t[0])),H.mat4.rotateY(l,l,Et(t[1])),H.mat4.scale(l,l,s),H.mat4.multiply(l,l,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function ov(l,t,s,c,m,h,_,w){const S=[s[0]-t[0],s[1]-t[1],0],P=[c[0]-t[0],c[1]-t[1],0];if(H.vec3.length(S)<1e-12||H.vec3.length(P)<1e-12)return H.quat.identity(l);const x=H.vec3.cross([],S,P);H.vec3.normalize(x,x),H.vec3.subtract(P,c,t),S[2]=(h-m)*w,P[2]=(_-m)*w;const A=S;return H.vec3.cross(A,S,P),H.vec3.normalize(A,A),H.quat.rotationTo(l,x,A)}function p2(l,t,s=!1){const c=Oo(t.zoom),m=function(h,_,w){const S=_.worldSize,P=[h[12],h[13],h[14]],x=Ks(P[1]/S),A=$o(P[0]/S),I=H.mat4.identity([]),E=Ao(1,x)*S,C=Ao(1,0)*S*Fh(x,_.zoom),R=1/po(S);let z=C*R;if(w){const $=sv(_.projection,_.zoom,_.width,_.height,1024);z=R*_.projection.pixelSpaceConversion(_.center.lat,S,$)}const V=Ou(x,A);H.vec3.add(V,V,H.vec3.scale([],H.vec3.normalize([],V),E*z*P[2]));const W=function($){const J=[$[0],$[1],$[2]];let ie=[0,1,0];const ge=H.vec3.cross([],ie,J);return H.vec3.cross(ie,J,ge),H.vec3.squaredLength(ie)===0&&(ie=[0,1,0],H.vec3.cross(ge,J,ie)),H.vec3.normalize(ge,ge),H.vec3.normalize(ie,ie),H.vec3.normalize(J,J),[ge[0],ge[1],ge[2],0,ie[0],ie[1],ie[2],0,J[0],J[1],J[2],0,$[0],$[1],$[2],1]}(V);H.mat4.scale(I,I,[z,z,z*E]),H.mat4.translate(I,I,[-P[0],-P[1],-P[2]]);const Y=H.mat4.multiply([],_.globeMatrix,W);return H.mat4.multiply(Y,Y,I),H.mat4.multiply(Y,Y,h),Y}(l,t,s);if(c>0){const h=function(_,w){const S=w.worldSize,P=Ao(1,0)*S*Fh(w.center.lat,w.zoom)/po(S),x=Ao(1,w.center.lat)*S,A=H.mat4.identity([]);return H.mat4.rotateY(A,A,Et(w.center.lng)),H.mat4.rotateX(A,A,Et(w.center.lat)),H.mat4.translate(A,A,[0,0,So]),H.mat4.scale(A,A,[P,P,P*x]),H.mat4.translate(A,A,[w.point.x-.5*S,w.point.y-.5*S,0]),H.mat4.multiply(A,A,_),H.mat4.multiply(A,w.globeMatrix,A)}(l,t);return function(_,w,S){const P=(C,R,z)=>{const V=H.vec3.length(C),W=H.vec3.length(R),Y=ys(C,R,z);return H.vec3.scale(Y,Y,1/H.vec3.length(Y)*Bi(V,W,z))},x=P([_[0],_[1],_[2]],[w[0],w[1],w[2]],S),A=P([_[4],_[5],_[6]],[w[4],w[5],w[6]],S),I=P([_[8],_[9],_[10]],[w[8],w[9],w[10]],S),E=ys([_[12],_[13],_[14]],[w[12],w[13],w[14]],S);return[x[0],x[1],x[2],0,A[0],A[1],A[2],0,I[0],I[1],I[2],0,E[0],E[1],E[2],1]}(m,h,c)}return m}function JM(l,t,s,c){const m=Ai.projectAabbCorners(c,s);let h=Number.MAX_VALUE,_=-1;for(let P=0;P<m.length;++P){const x=m[P];x[0]=(.5*x[0]+.5)*t.width,x[1]=(.5-.5*x[1])*t.height,x[2]<h&&(_=P,h=x[2])}const w=P=>new ve(m[P][0],m[P][1]);let S;switch(_){case 0:case 6:S=[w(1),w(5),w(4),w(7),w(3),w(2),w(1)];break;case 1:case 7:S=[w(0),w(4),w(5),w(6),w(2),w(3),w(0)];break;case 3:case 5:S=[w(1),w(0),w(4),w(7),w(6),w(2),w(1)];break;default:S=[w(1),w(5),w(6),w(7),w(3),w(0),w(1)]}if(te(l,S))return h}const ZF=qr([{name:"a_pos_3f",components:3,type:"Float32"}]),YF=qr([{name:"a_color_3f",components:3,type:"Float32"}]),XF=qr([{name:"a_color_4f",components:4,type:"Float32"}]),KF=qr([{name:"a_uv_2f",components:2,type:"Float32"}]),JF=qr([{name:"a_normal_3f",components:3,type:"Float32"}]),QF=qr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),eB=qr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),QM={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class av{constructor(t,s,c,m){this.message=(t?`${t}: `:"")+c,m&&(this.identifier=m),s!=null&&s.__line__&&(this.line=s.__line__)}}function eI(l,t){const s=l.indexOf("://")===-1;try{return new URL(l,s&&t?"http://example.com":void 0),!0}catch{return!1}}class tI{constructor(t,s){this.feature=t,this.instancedDataOffset=s,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class iI{constructor(){this.instancedDataArray=new pf,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class m2{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(t,s){}populate(t,s,c,m){this.tileToMeter=i(c);const h=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:_,id:w,index:S,sourceLayerIndex:P}of t){const x=w??(_.properties&&_.properties.hasOwnProperty("id")?_.properties.id:void 0),A=U(_,h);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),A,c))continue;const I={id:x,sourceLayerIndex:P,index:S,geometry:h?A.geometry:k(_,c,m),properties:_.properties,type:_.type,patterns:{}},E=this.addFeature(I,I.geometry,A);E&&s.featureIndex.insert(_,I.geometry,S,P,this.index,this.instancesPerModel[E].instancedDataArray.length,ii/32)}this.lookup=null}update(t,s,c,m){for(const h in this.instancesPerModel){const _=this.instancesPerModel[h];for(const w in t)_.idToFeaturesIndex.hasOwnProperty(w)&&(this.evaluate(_.features[_.idToFeaturesIndex[w]],t[w],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const s in this.instancesPerModel){const c=this.instancesPerModel[s];for(const m of c.features){const h=this.layers[0],_=m.feature,w=this.canonical,S=h.paint.get("model-rotation").evaluate(_,{},w),P=h.paint.get("model-scale").evaluate(_,{},w),x=h.paint.get("model-translation").evaluate(_,{},w);H.vec3.exactEquals(m.rotation,S)&&H.vec3.exactEquals(m.scale,P)&&H.vec3.exactEquals(m.translation,x)||(this.evaluate(m,m.featureStates,c,!0),t=!0)}}return t}updateReplacement(t,s,c,m){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const h=s.getReplacementRegionsForTile(t.toUnwrapped(),!0);if(Vw(this.activeReplacements,h))return!1;this.activeReplacements=h;let _=!1;for(const w in this.instancesPerModel){const S=this.instancesPerModel[w],P=S.instancedDataArray;for(const x of S.features){const A=x.instancedDataOffset,I=x.instancedDataCount;for(let E=0;E<I;E++){const C=16*(E+A);let R=P.float32[C+0];const z=R>ii;R=z?R-ii:R;const V=Math.floor(R),W=P.float32[C+1];let Y=!1;for(const $ of this.activeReplacements)if(!_C($,c,QM.Model,m)&&!($.min.x>V||V>$.max.x||$.min.y>W||W>$.max.y)&&(Y=wC(bC(V,W,t.canonical,$.footprintTileId.canonical),$.footprint),Y))break;P.float32[C]=Y?R+ii:R,_=_||Y!==z}}}return _}isEmpty(){for(const t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const s in this.instancesPerModel){const c=this.instancesPerModel[s];c.instancedDataArray.length<0||c.instancedDataArray.length===0||(c.instancedDataBuffer?c.instancedDataBuffer.updateData(c.instancedDataArray):c.instancedDataBuffer=t.createVertexBuffer(c.instancedDataArray,QF.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const s in this.instancesPerModel){const c=this.instancesPerModel[s];c.instancedDataArray.length!==0&&c.instancedDataBuffer&&c.instancedDataBuffer.destroy()}const t=this.layers[0].modelManager;if(t&&this.modelUris)for(const s of this.modelUris)t.removeModel(s,"")}addFeature(t,s,c){const m=this.layers[0],h=m.layout.get("model-id").evaluate(c,{},this.canonical);if(!h)return Vi(`modelId is not evaluated for layer ${m.id} and it is not going to get rendered.`),h;eI(h,!1)&&(this.modelUris.includes(h)||this.modelUris.push(h)),this.instancesPerModel[h]||(this.instancesPerModel[h]=new iI);const _=this.instancesPerModel[h],w=_.instancedDataArray,S=new tI(c,w.length);for(const P of s)for(const x of P){if(x.x<0||x.x>=ii||x.y<0||x.y>=ii)continue;const A=(this.lookupDim-1)/ii,I=this.lookupDim*(x.y*A|0)+x.x*A|0;if(this.lookup){if(this.lookup[I]!==0)continue;this.lookup[I]=1}this.instanceCount++;const E=w.length;w.resize(E+1),_.instancesEvaluatedElevation.push(0),w.float32[16*E]=x.x,w.float32[16*E+1]=x.y}return S.instancedDataCount=_.instancedDataArray.length-S.instancedDataOffset,S.instancedDataCount>0&&(t.id&&(_.idToFeaturesIndex[t.id]=_.features.length),_.features.push(S),this.evaluate(S,{},_,!1)),h}getModelUris(){return this.modelUris}evaluate(t,s,c,m){const h=this.layers[0],_=t.feature,w=this.canonical,S=t.rotation=h.paint.get("model-rotation").evaluate(_,s,w),P=t.scale=h.paint.get("model-scale").evaluate(_,s,w),x=t.translation=h.paint.get("model-translation").evaluate(_,s,w),A=h.paint.get("model-color").evaluate(_,s,w);A.a=h.paint.get("model-color-mix-intensity").evaluate(_,s,w);const I=[];this.maxVerticalOffset<x[2]&&(this.maxVerticalOffset=x[2]),this.maxScale=Math.max(Math.max(this.maxScale,P[0]),Math.max(P[1],P[2])),KM(I,S,P);const E=Math.round(100*A.a)+A.b/1.05;for(let C=0;C<t.instancedDataCount;++C){const R=t.instancedDataOffset+C,z=16*R,V=c.instancedDataArray.float32;let W=0;m&&(W=V[z+6]-c.instancesEvaluatedElevation[R]);const Y=0|V[z+1];V[z]=(0|V[z])+A.r/1.05,V[z+1]=Y+A.g/1.05,V[z+2]=E,V[z+3]=1/(w.z>10?this.tileToMeter:i(w,Y)),V[z+4]=x[0],V[z+5]=x[1],V[z+6]=x[2]+W,V[z+7]=I[0],V[z+8]=I[1],V[z+9]=I[2],V[z+10]=I[4],V[z+11]=I[5],V[z+12]=I[6],V[z+13]=I[8],V[z+14]=I[9],V[z+15]=I[10],c.instancesEvaluatedElevation[R]=x[2]}}}let rI,nI;gi(m2,"ModelBucket",{omit:["layers"]}),gi(iI,"PerModelAttributes"),gi(tI,"ModelFeature");const Cf=64,ym={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function sI(l,t,s,c,m,h,_,w,S,P=!1){const x=s.zoom,A=s.project(c),I=Fh(c.lat,x),E=1/I;H.mat4.identity(l),H.mat4.translate(l,l,[A.x+_[0]*E,A.y+_[1]*E,_[2]]);let C=1,R=1;const z=s.worldSize;if(P){if(s.projection.name==="mercator"){let $=0;s.elevation&&($=s.elevation.getAtPointOrZero(new a(A.x/z,A.y/z),0));const J=H.vec4.transformMat4([],[A.x,A.y,$,1],s.projMatrix)[3]/s.cameraToCenterDistance;C=J,R=J*Fh(s.center.lat,x)}else if(s.projection.name==="globe"){const $=p2(l,s),J=H.mat4.multiply([],s.projMatrix,$),ie=[0,0,0,1];H.vec4.transformMat4(ie,ie,J);const ge=ie[3]/s.cameraToCenterDistance,Pe=Oo(x),Me=s.projection.pixelsPerMeter(c.lat,z)*Fh(c.lat,x),Ce=s.projection.pixelsPerMeter(s.center.lat,z)*Fh(s.center.lat,x);C=ge/Bi(Me,Fg(s.center.lat),Pe),R=ge*I/Me,C*=Ce,R*=Ce}}else C=E;H.mat4.scale(l,l,[C,C,R]);const V=[...l],W=t.orientation,Y=[];if(KM(Y,[W[0]+m[0],W[1]+m[1],W[2]+m[2]],h),H.mat4.multiply(l,V,Y),w&&s.elevation){let $=0;const J=[];if(S&&s.elevation){$=function(Pe,Me,Ce,$e,Re){const He=Me.elevation;if(!He)return 0;const Je=Ai.projectAabbCorners(Ce,$e),Xe=Ao(1,Re.lat)*Me.worldSize,tt=function(wi,ai){const fi=[0,0,1],Wi=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const hr of Wi){const pr=wi[hr.corners[0]],mr=wi[hr.corners[1]],Er=wi[hr.corners[2]],Sr=[mr[0]-pr[0],mr[1]-pr[1],ai*(mr[2]-pr[2])],mn=H.vec3.cross(Sr,Sr,[Er[0]-pr[0],Er[1]-pr[1],ai*(Er[2]-pr[2])]);H.vec3.normalize(mn,mn),hr.dotProductWithUp=H.vec3.dot(mn,fi)}return Wi.sort((hr,pr)=>hr.dotProductWithUp-pr.dotProductWithUp),Wi[0].corners}(Je,Xe),at=Je[tt[0]],ft=Je[tt[1]],nt=Je[tt[2]],Mt=Je[tt[3]],Ft=He.getAtPointOrZero(new a(at[0]/Me.worldSize,at[1]/Me.worldSize),0),Ct=He.getAtPointOrZero(new a(ft[0]/Me.worldSize,ft[1]/Me.worldSize),0),si=He.getAtPointOrZero(new a(nt[0]/Me.worldSize,nt[1]/Me.worldSize),0),ri=He.getAtPointOrZero(new a(Mt[0]/Me.worldSize,Mt[1]/Me.worldSize),0),Wt=(Ft+ri)/2,Bt=(Ct+si)/2;return Wt>Bt?Ct<si?ov(Pe,ft,Mt,at,Ct,ri,Ft,Xe):ov(Pe,nt,at,Mt,si,Ft,ri,Xe):Ft<ri?ov(Pe,at,ft,nt,Ft,Ct,si,Xe):ov(Pe,Mt,nt,ft,ri,si,Ct,Xe),Math.max(Wt,Bt)}(J,s,t.aabb,l,c);const ie=H.mat4.fromQuat([],J),ge=H.mat4.multiply([],ie,Y);H.mat4.multiply(l,V,ge)}else $=s.elevation.getAtPointOrZero(new a(A.x/z,A.y/z),0);$!==0&&(l[14]+=$)}}function oy(l,t,s=!1){l.uploaded||(l.gfxTexture=new h2(t,l.image,s?t.gl.R8:t.gl.RGBA8,{useMipmap:l.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),l.uploaded=!0,l.image=null)}function tB(l,t,s){l.indexBuffer=t.createIndexBuffer(l.indexArray,!1,!0),l.vertexBuffer=t.createVertexBuffer(l.vertexArray,ZF.members,!1,!0),l.normalArray&&(l.normalBuffer=t.createVertexBuffer(l.normalArray,JF.members,!1,!0)),l.texcoordArray&&(l.texcoordBuffer=t.createVertexBuffer(l.texcoordArray,KF.members,!1,!0)),l.colorArray&&(l.colorBuffer=t.createVertexBuffer(l.colorArray,(l.colorArray.bytesPerElement===12?YF:XF).members,!1,!0)),l.featureArray&&(l.pbrBuffer=t.createVertexBuffer(l.featureArray,eB.members,!0)),l.segments=ts.simpleSegment(0,0,l.vertexArray.length,l.indexArray.length);const c=l.material;c.pbrMetallicRoughness.baseColorTexture&&oy(c.pbrMetallicRoughness.baseColorTexture,t),c.pbrMetallicRoughness.metallicRoughnessTexture&&oy(c.pbrMetallicRoughness.metallicRoughnessTexture,t),c.normalTexture&&oy(c.normalTexture,t),c.occlusionTexture&&oy(c.occlusionTexture,t,s),c.emissionTexture&&oy(c.emissionTexture,t)}function _2(l,t,s){if(l.meshes)for(const c of l.meshes)tB(c,t,s);if(l.children)for(const c of l.children)_2(c,t,s)}function lv(l){if(l.meshes)for(const t of l.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(l.children)for(const t of l.children)lv(t)}function g2(l){if(l.meshes)for(const s of l.meshes)s.vertexBuffer&&(s.vertexBuffer.destroy(),s.indexBuffer.destroy(),s.normalBuffer&&s.normalBuffer.destroy(),s.texcoordBuffer&&s.texcoordBuffer.destroy(),s.colorBuffer&&s.colorBuffer.destroy(),s.pbrBuffer&&s.pbrBuffer.destroy(),s.segments.destroy(),s.material&&((t=s.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(l.children)for(const s of l.children)g2(s)}class vm{constructor(t,s,c){this._demTile=t,this._dem=this._demTile.dem,this._scale=s,this._offset=c}static create(t,s,c){const m=c||t.findDEMTileFor(s);if(!m||!m.dem)return;const h=m.dem,_=m.tileID,w=1<<s.canonical.z-_.canonical.z;return new vm(m,h.dim/ii/w,[(s.canonical.x/w-_.canonical.x)*h.dim,(s.canonical.y/w-_.canonical.y)*h.dim])}tileCoordToPixel(t,s){const c=s*this._scale+this._offset[1],m=Math.floor(t*this._scale+this._offset[0]),h=Math.floor(c);return new ve(m,h)}getElevationAt(t,s,c,m){const h=t*this._scale+this._offset[0],_=s*this._scale+this._offset[1],w=Math.floor(h),S=Math.floor(_),P=this._dem;return m=!!m,c?Bi(Bi(P.get(w,S,m),P.get(w,S+1,m),_-S),Bi(P.get(w+1,S,m),P.get(w+1,S+1,m),_-S),h-w):P.get(w,S,m)}getElevationAtPixel(t,s,c){return this._dem.get(t,s,!!c)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*Ao(1,t)*this._dem.stride}}const y2=new Float32Array(262144),Mf=new Uint8Array(262144);function oI(l){let t=0;if(l.meshes)for(const s of l.meshes)t=Math.max(t,s.aabb.max[2]);if(l.children)for(const s of l.children)t=Math.max(t,oI(s));return t}function aI(l,t,s){if(l.meshes)for(const c of l.meshes){if(c.aabb.min[0]===1/0)continue;const m=Ai.applyTransform(c.aabb,l.matrix);s.insert(t,m.min[0],m.min[1],m.max[0],m.max[1])}if(l.children)for(const c of l.children)aI(c,t,s)}const lI=["","wall","door","roof","window","lamp","logo"];class cI{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:t.id,geometry:[],properties:{height:oI(t)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Ai([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0;const s=new Ai([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const c of this.node.meshes)this.node.lightMeshIndex!==t&&(c.transformedAabb=Ai.applyTransformFast(c.aabb,this.node.matrix),s.encapsulate(c.transformedAabb)),t++;this.aabb=s}return this.aabb}}class cv{constructor(t,s,c,m,h,_,w){this.id=c,this.layers=t,this.layerIds=this.layers.map(S=>S.fqid),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.modelTraits|=ym.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,m&&(this.modelTraits|=ym.HasMapboxMeshFeatures),h&&(this.modelTraits|=ym.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=_,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const S of s)this.nodesInfo.push(new cI(S)),aI(S,w.featureIndexArray.length,w.grid),w.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,w.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(t,s){for(const c of this.getNodesInfo()){const m=c.node;m.footprint&&s.push({footprint:m.footprint,id:t})}}update(t){const s=Object.keys(t).length!==0;if(s&&!this.stateDependentLayers.length)return;const c=s?this.stateDependentLayers:this.layers;if(!Ie(t,this.states))for(const m of c)this.evaluate(m,t);this.states=structuredClone(t)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const s=this.getNodesInfo();for(const c of s){const m=c.node;this.uploaded?this.updatePbrBuffer(m):_2(m,t,!0)}for(const c of s)lv(c.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let s=!1;if(!t.meshes)return s;for(const c of t.meshes)c.pbrBuffer&&(c.pbrBuffer.updateData(c.featureArray),s=!0);return s}needsReEvaluation(t,s,c){const m=t.transform.projectionOptions,h=t.style.getBrightness(),_=this.brightness!==h;if(!this.uploaded||this.dirty||m.name!==this.projection.name||ay(c.paint.get("model-color").value,_)||ay(c.paint.get("model-color-mix-intensity").value,_)||ay(c.paint.get("model-roughness").value,_)||ay(c.paint.get("model-emissive-strength").value,_)||ay(c.paint.get("model-height-based-emissive-strength-multiplier").value,_)){this.projection=m,this.brightness=h;const w=this.getNodesInfo();for(const S of w)S.state=null;return!0}return!1}evaluateScale(t,s){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const c=this.getNodesInfo(),m=this.id.canonical;for(const h of c){const _=h.feature;h.evaluatedScale=s.paint.get("model-scale").evaluate(_,{},m)}}evaluate(t,s){const c=this.getNodesInfo();for(const m of c){if(!m.node.meshes)continue;const h=m.feature,_=s&&s[h.id];if(Ie(_,m.state))continue;m.state=structuredClone(_);const w=m.node.meshes&&m.node.meshes[0].featureData,S=m.evaluatedColor[2],P=m.evaluatedRMEA[2],x=this.id.canonical;if(m.hasTranslucentParts=!1,w){for(let A=0;A<lI.length;A++){const I=lI[A];I.length&&(h.properties.part=I);const E=t.paint.get("model-color").evaluate(h,_,x).toRenderColor(null),C=t.paint.get("model-color-mix-intensity").evaluate(h,_,x);m.evaluatedColor[A]=[E.r,E.g,E.b,C],m.evaluatedRMEA[A][0]=t.paint.get("model-roughness").evaluate(h,_,x),m.evaluatedRMEA[A][2]=t.paint.get("model-emissive-strength").evaluate(h,_,x),m.evaluatedRMEA[A][3]=E.a,m.emissionHeightBasedParams[A]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(h,_,x),!m.hasTranslucentParts&&E.a<1&&(m.hasTranslucentParts=!0)}delete h.properties.part,rB(m,S!==m.evaluatedColor[2]||P!==m.evaluatedRMEA[2],this.modelTraits)}else m.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(h,_,x);m.evaluatedScale=t.paint.get("model-scale").evaluate(h,_,x),this.updatePbrBuffer(m.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,s,c,m){const h=t.findDEMTileFor(c);if(h&&(h.tileID.canonical!==this.terrainTile||s!==this.terrainExaggeration)){if(h.dem&&h.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=h.tileID.overscaledZ;const _=vm.create(t,c,h);if(!_)return;this.modelTraits&ym.HasMapboxMeshFeatures&&this.updateDEM(t,_,c,m);for(const w of this.getNodesInfo()){const S=w.node;if(!S.footprint||!S.footprint.vertices||!S.footprint.vertices.length)continue;const P=S.footprint.vertices;let x=_.getElevationAt(P[0].x,P[0].y,!0,!0);for(let A=1;A<P.length;A++)x=Math.min(x,_.getElevationAt(P[A].x,P[A].y,!0,!0));S.elevation=x}}this.terrainTile=h.tileID.canonical,this.terrainExaggeration=s}}updateDEM(t,s,c,m){let h=s._dem._modifiedForSources[m];if(h===void 0&&(s._dem._modifiedForSources[m]=[],h=s._dem._modifiedForSources[m]),h.includes(c.canonical))return;const _=s._dem.dim;h.push(c.canonical);let w=!1;for(const S of this.getNodesInfo()){const P=S.node;if(!P.footprint||!P.footprint.grid)continue;const x=P.footprint.grid,A=s.tileCoordToPixel(x.min.x,x.min.y),I=s.tileCoordToPixel(x.max.x,x.max.y),E=Math.min(Math.min(_-I.y,A.x),Math.min(A.y,_-I.x));if(E<0)continue;const C=Ut(E,2,5);let R=Math.max(0,A.x-C),z=Math.max(0,A.y-C),V=Math.min(I.x+C,_-1),W=Math.min(I.y+C,_-1);for(let ie=z;ie<=W;++ie)for(let ge=R;ge<=V;++ge)Mf[ie*_+ge]=255;let Y=0,$=0;for(let ie=0;ie<x.cellsY;++ie)for(let ge=0;ge<x.cellsX;++ge){if(!x.cells[ie*x.cellsX+ge])continue;const Pe=s.tileCoordToPixel(x.min.x+ge/x.xScale,x.min.y+ie/x.yScale),Me=s.tileCoordToPixel(x.min.x+(ge+1)/x.xScale,x.min.y+(ie+1)/x.yScale);for(let Ce=Pe.y;Ce<=Math.min(Me.y+1,_-1);++Ce)for(let $e=Pe.x;$e<=Math.min(Me.x+1,_-1);++$e)Mf[Ce*_+$e]===255&&(Mf[Ce*_+$e]=0,Y+=s.getElevationAtPixel($e,Ce),$++)}const J=Y/$;R=Math.max(1,A.x-C),z=Math.max(1,A.y-C),V=Math.min(I.x+C,_-2),W=Math.min(I.y+C,_-2),w=!0;for(let ie=z;ie<=W;++ie)for(let ge=R;ge<=V;++ge)Mf[ie*_+ge]===0&&(y2[ie*_+ge]=s._dem.set(ge,ie,J));for(let ie=1;ie<C;++ie){R=Math.max(1,A.x-ie),z=Math.max(1,A.y-ie),V=Math.min(I.x+ie,_-2),W=Math.min(I.y+ie,_-2);for(let ge=z;ge<=W;++ge)for(let Pe=R;Pe<=V;++Pe){const Me=ge*_+Pe;if(Mf[Me]===255){let Ce=0,$e=0,Re=-1,He=-1;for(let Je=-1;Je<=1;++Je)for(let Xe=-1;Xe<=1;++Xe){const tt=(ge+Je)*_+Pe+Xe;if(Mf[tt]>=ie)continue;const at=y2[tt],ft=Math.abs(at);ft>$e&&(Ce=at,$e=ft,Re=Xe,He=Je)}if($e>.1){const Je=1-(ie+.5*Math.abs(Re*He))/C;let Xe=s._dem.get(Pe,ge)+Ce*Je;const tt=s._dem.get(Pe+Re,ge+He),at=s._dem.get(Pe-Re,ge-He,!0);(Xe-tt)*(Xe-at)>0&&(Xe=(tt+at)/2),y2[Me]=s._dem.set(Pe,ge,Xe),Mf[Me]=ie}}}}}w&&(s._demTile.needsDEMTextureUpload=!0,s._dem._timestamp=ze.now())}getNodesInfo(){return this.nodesInfo}destroy(){const t=this.getNodesInfo();for(const s of t)lv(s.node),g2(s.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,s){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const c=s.getReplacementRegionsForTile(t.toUnwrapped()),m=this.getNodesInfo();for(let h=0;h<this.nodesInfo.length;h++){const _=m[h].node;m[h].hiddenByReplacement=!!_.footprint&&!c.find(w=>w.footprint===_.footprint)}}getHeightAtTileCoord(t,s){const c=this.getNodesInfo(),m=[],h=[0,0,0],_=H.mat4.identity([]);for(let w=0;w<this.nodesInfo.length;w++){const S=c[w],P=S.node.meshes[0],x=P.transformedAabb;if(t<x.min[0]||s<x.min[1]||t>x.max[0]||s>x.max[1])continue;if(S.node.hidden===!0)return{height:1/0,maxHeight:S.feature.properties.height,hidden:!1,verticalScale:S.evaluatedScale[2]};H.mat4.invert(_,S.node.matrix),h[0]=t,h[1]=s,H.vec3.transformMat4(h,h,_);const A=(h[0]-P.aabb.min[0])/(P.aabb.max[0]-P.aabb.min[0])*Cf|0,I=Math.min(63,(h[1]-P.aabb.min[1])/(P.aabb.max[1]-P.aabb.min[1])*Cf|0)*Cf+Math.min(63,A),E=P.heightmap[I];if(!(E<0&&S.node.footprint))return S.hiddenByReplacement?void 0:{height:E,maxHeight:S.feature.properties.height,hidden:!1,verticalScale:S.evaluatedScale[2]};if(S.node.footprint.grid.query(new ve(t,s),new ve(t,s),m),m.length>0)return{height:void 0,maxHeight:S.feature.properties.height,hidden:S.hiddenByReplacement,verticalScale:S.evaluatedScale[2]}}}}function ay(l,t){return!l.isLightConstant&&t}function iB(l,t,s,c,m,h,_,w){let S=(61440&t|(61440&t)>>4)>>8,P=(3840&t|(3840&t)>>4)>>4,x=240&t|(240&t)>>4;s[3]>0&&(S=Bi(S,255*s[0],s[3]),P=Bi(P,255*s[1],s[3]),x=Bi(x,255*s[2],s[3]));const A=S<<8|P,I=x<<8|Math.floor(255*c[3]),E=function(ie){const ge=Ut(ie,0,2);return Math.min(Math.round(.5*ge*255),255)}(c[2])<<8|15*c[0]<<4|15*c[1],C=Ut(m[0],0,1),R=Ut(m[1],0,1),z=Ut(m[2],0,1),V=Ut(m[3],0,1);let W,Y,$,J;if(C!==R&&_!==h&&R!==C){const ie=_-h;Y=1/(ie*(R-C)),$=-(h+ie*C)/(ie*(R-C));const ge=Ut(m[4],-1,1);J=Math.pow(10,ge),W=255*z<<8|255*V}else W=65535,Y=0,$=1,J=1;if(l.emplaceBack(A,I,E,W,Y,$,J),w){const ie=w.length;w.clear();for(let ge=0;ge<ie;ge++)w.emplaceBack(A,I,E,W,Y,$,J)}}function rB(l,t,s){const c=l.node;let m=0;const h=s&ym.HasMeshoptCompression;for(const _ of c.meshes){if(c.lights&&c.lightMeshIndex===m||!_.featureData)continue;_.featureArray=new mf,_.featureArray.reserve(_.featureData.length);let w=t;for(const S of _.featureData){const P=h?65535&S:S>>16&65535,x=h?S>>16&65535:65535&S,A=(15&x)<8?15&x:0,I=l.evaluatedRMEA[A],E=l.evaluatedColor[A],C=l.emissionHeightBasedParams[A];let R;if(w&&A===2&&c.lights&&(R=new mf,R.resize(10*c.lights.length)),iB(_.featureArray,P,E,I,C,_.aabb.min[2],_.aabb.max[2],R),R&&w){w=!1;const z=c.meshes[c.lightMeshIndex];z.featureArray=R,z.featureArray._trim()}}_.featureArray._trim(),m++}}function uI(l,t,s,c){const m=1<<l.z;t.lat=Ks((c/ii+l.y)/m),t.lng=$o((s/ii+l.x)/m)}gi(cv,"Tiled3dModelBucket",{omit:["layers"]}),gi(cI,"Tiled3dModelFeature");const nB={circle:class extends js{constructor(l,t,s,c){super(l,{layout:Vt||(Vt=new Bn({"circle-sort-key":new hi(gt.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Xt(gt.layout_circle["circle-elevation-reference"]),visibility:new Xt(gt.layout_circle.visibility)})),paint:ut||(ut=new Bn({"circle-radius":new hi(gt.paint_circle["circle-radius"]),"circle-color":new hi(gt.paint_circle["circle-color"]),"circle-blur":new hi(gt.paint_circle["circle-blur"]),"circle-opacity":new hi(gt.paint_circle["circle-opacity"]),"circle-translate":new Xt(gt.paint_circle["circle-translate"]),"circle-translate-anchor":new Xt(gt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Xt(gt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Xt(gt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new hi(gt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new hi(gt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new hi(gt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Xt(gt.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"})}))},t,s,c)}createBucket(l){return new ce(l)}queryRadius(l){const t=l;return Rt("circle-radius",this,t)+Rt("circle-stroke-width",this,t)+Pt(this.paint.get("circle-translate"))}queryIntersectsFeature(l,t,s,c,m,h,_,w){const S=bt(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,l.pixelToTileUnitsFactor),P=this.paint.get("circle-radius").evaluate(t,s)+this.paint.get("circle-stroke-width").evaluate(t,s);return um(l,c,h,_,w,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",S,P)}getProgramIds(){return["circle"]}getDefaultProgramParams(l,t,s){const c=Bh(this);return{config:new Du(this,{zoom:t,lut:s}),defines:c,overrideFog:!1}}},heatmap:class extends js{createBucket(l){return new jA(l)}constructor(l,t,s,c){super(l,{layout:$A||($A=new Bn({visibility:new Xt(gt.layout_heatmap.visibility)})),paint:qA||(qA=new Bn({"heatmap-radius":new hi(gt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new hi(gt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Xt(gt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ih(gt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Xt(gt.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"})}))},t,s,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ng({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(l){return Rt("heatmap-radius",this,l)}queryIntersectsFeature(l,t,s,c,m,h,_,w){const S=this.paint.get("heatmap-radius").evaluate(t,s);return um(l,c,h,_,w,!0,!0,new ve(0,0),S)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(l,t,s){return l==="heatmap"?{config:new Du(this,{zoom:t,lut:s}),overrideFog:!1}:{}}},hillshade:class extends js{constructor(l,t,s,c){super(l,{layout:HA||(HA=new Bn({visibility:new Xt(gt.layout_hillshade.visibility)})),paint:GA||(GA=new Bn({"hillshade-illumination-direction":new Xt(gt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Xt(gt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Xt(gt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Xt(gt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Xt(gt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Xt(gt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Xt(gt.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"})}))},t,s,c)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(l,t,s){return{overrideFog:!1}}},fill:class extends js{constructor(l,t,s,c){super(l,{layout:tC||(tC=new Bn({"fill-sort-key":new hi(gt.layout_fill["fill-sort-key"]),visibility:new Xt(gt.layout_fill.visibility),"fill-elevation-reference":new Xt(gt.layout_fill["fill-elevation-reference"])})),paint:iC||(iC=new Bn({"fill-antialias":new Xt(gt.paint_fill["fill-antialias"]),"fill-opacity":new hi(gt.paint_fill["fill-opacity"]),"fill-color":new hi(gt.paint_fill["fill-color"]),"fill-outline-color":new hi(gt.paint_fill["fill-outline-color"]),"fill-translate":new Xt(gt.paint_fill["fill-translate"]),"fill-translate-anchor":new Xt(gt.paint_fill["fill-translate-anchor"]),"fill-pattern":new hi(gt.paint_fill["fill-pattern"]),"fill-emissive-strength":new Xt(gt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new hi(gt.paint_fill["fill-z-offset"]),"fill-color-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"})}))},t,s,c)}getProgramIds(){const l=this.paint.get("fill-pattern"),t=l&&l.constantOr(1),s=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getDefaultProgramParams(l,t,s){return{config:new Du(this,{zoom:t,lut:s}),overrideFog:!1}}recalculate(l,t){super.recalculate(l,t);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new Lw(l)}queryRadius(){return Pt(this.paint.get("fill-translate"))}queryIntersectsFeature(l,t,s,c,m,h){return!l.queryGeometry.isAboveHorizon&&me(ht(l.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,l.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends js{constructor(l,t,s,c){super(l,{layout:FC||(FC=new Bn({visibility:new Xt(gt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Xt(gt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:BC||(BC=new Bn({"fill-extrusion-opacity":new Xt(gt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new hi(gt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Xt(gt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Xt(gt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new hi(gt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new hi(gt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new hi(gt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Xt(gt["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Xt(gt["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Xt(gt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Xt(gt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Xt(gt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Xt(gt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Xt(gt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Xt(gt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Xt(gt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Xt(gt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new hi(gt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new hi(gt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Xt(gt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Xt(gt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Xt(gt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Xt(gt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new hi(gt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new hi(gt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Xt(gt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"})}))},t,s,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new V1(l)}queryRadius(){return Pt(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(l,t,s,c,m,h,_,w,S){const P=bt(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,l.pixelToTileUnitsFactor),x=this.paint.get("fill-extrusion-height").evaluate(t,s),A=this.paint.get("fill-extrusion-base").evaluate(t,s),I=[0,0],E=w&&h.elevation,C=h.elevation?h.elevation.exaggeration():1,R=l.tile.getBucket(this);if(E&&R instanceof V1){const $=R.centroidVertexArray,J=S+1;J<$.length&&(I[0]=$.geta_centroid_pos0(J),I[1]=$.geta_centroid_pos1(J))}if(I[0]===0&&I[1]===1)return!1;h.projection.name==="globe"&&(c=zC([c],[new ve(0,0),new ve(ii,ii)],l.tileID.canonical).map($=>$.polygon).flat());const z=E?w:null,[V,W]=function($,J,ie,ge,Pe,Me,Ce,$e,Re,He,Je){return $.projection.name==="globe"?function(Xe,tt,at,ft,nt,Mt,Ft,Ct,si,ri,Wt){const Bt=[],wi=[],ai=Xe.projection.upVectorScale(Wt,Xe.center.lat,Xe.worldSize).metersToTile,fi=[0,0,0,1],Wi=[0,0,0,1],hr=(mr,Er,Sr,mn)=>{mr[0]=Er,mr[1]=Sr,mr[2]=mn,mr[3]=1},pr=kC();at>0&&(at+=pr),ft+=pr;for(const mr of tt){const Er=[],Sr=[];for(const mn of mr){const en=mn.x+nt.x,nr=mn.y+nt.y,Zr=Xe.projection.projectTilePoint(en,nr,Wt),Kr=Xe.projection.upVector(Wt,mn.x,mn.y);let Mn=at,as=ft;if(Ft){const xs=VC(en,nr,at,ft,Ft,Ct,si,ri);Mn+=xs.base,as+=xs.top}at!==0?hr(fi,Zr.x+Kr[0]*ai*Mn,Zr.y+Kr[1]*ai*Mn,Zr.z+Kr[2]*ai*Mn):hr(fi,Zr.x,Zr.y,Zr.z),hr(Wi,Zr.x+Kr[0]*ai*as,Zr.y+Kr[1]*ai*as,Zr.z+Kr[2]*ai*as),H.vec3.transformMat4(fi,fi,Mt),H.vec3.transformMat4(Wi,Wi,Mt),Er.push(new Af(fi[0],fi[1],fi[2])),Sr.push(new Af(Wi[0],Wi[1],Wi[2]))}Bt.push(Er),wi.push(Sr)}return[Bt,wi]}($,J,ie,ge,Pe,Me,Ce,$e,Re,He,Je):Ce?function(Xe,tt,at,ft,nt,Mt,Ft,Ct,si){const ri=[],Wt=[],Bt=[0,0,0,1];for(const wi of Xe){const ai=[],fi=[];for(const Wi of wi){const hr=Wi.x+ft.x,pr=Wi.y+ft.y,mr=VC(hr,pr,tt,at,Mt,Ft,Ct,si);Bt[0]=hr,Bt[1]=pr,Bt[2]=mr.base,Bt[3]=1,H.vec4.transformMat4(Bt,Bt,nt),Bt[3]=Math.max(Bt[3],1e-5);const Er=new Af(Bt[0]/Bt[3],Bt[1]/Bt[3],Bt[2]/Bt[3]);Bt[0]=hr,Bt[1]=pr,Bt[2]=mr.top,Bt[3]=1,H.vec4.transformMat4(Bt,Bt,nt),Bt[3]=Math.max(Bt[3],1e-5);const Sr=new Af(Bt[0]/Bt[3],Bt[1]/Bt[3],Bt[2]/Bt[3]);ai.push(Er),fi.push(Sr)}ri.push(ai),Wt.push(fi)}return[ri,Wt]}(J,ie,ge,Pe,Me,Ce,$e,Re,He):function(Xe,tt,at,ft,nt){const Mt=[],Ft=[],Ct=nt[8]*tt,si=nt[9]*tt,ri=nt[10]*tt,Wt=nt[11]*tt,Bt=nt[8]*at,wi=nt[9]*at,ai=nt[10]*at,fi=nt[11]*at;for(const Wi of Xe){const hr=[],pr=[];for(const mr of Wi){const Er=mr.x+ft.x,Sr=mr.y+ft.y,mn=nt[0]*Er+nt[4]*Sr+nt[12],en=nt[1]*Er+nt[5]*Sr+nt[13],nr=nt[2]*Er+nt[6]*Sr+nt[14],Zr=nt[3]*Er+nt[7]*Sr+nt[15],Kr=mn+Ct,Mn=en+si,as=nr+ri,xs=Math.max(Zr+Wt,1e-5),ls=mn+Bt,Kn=en+wi,fs=nr+ai,As=Math.max(Zr+fi,1e-5);hr.push(new Af(Kr/xs,Mn/xs,as/xs)),pr.push(new Af(ls/As,Kn/As,fs/As))}Mt.push(hr),Ft.push(pr)}return[Mt,Ft]}(J,ie,ge,Pe,Me)}(h,c,A,x,P,_,z,I,C,h.center.lat,l.tileID.canonical),Y=l.queryGeometry;return function($,J,ie){let ge=1/0;me(ie,J)&&(ge=NC(ie,J[0]));for(let Pe=0;Pe<J.length;Pe++){const Me=J[Pe],Ce=$[Pe];for(let $e=0;$e<Me.length-1;$e++){const Re=Me[$e],He=[Re,Me[$e+1],Ce[$e+1],Ce[$e],Re];te(ie,He)&&(ge=Math.min(ge,NC(ie,He)))}}return ge!==1/0&&ge}(V,W,Y.isPointQuery()?Y.screenBounds:Y.screenGeometry)}},line:class extends js{constructor(l,t,s,c){const m=XC();super(l,m,t,s,c),m.layout&&(this.layout=new Mh(m.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Fn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(l,t){super.recalculate(l,t),this.paint._values["line-floorwidth"]=(()=>{if(Zg)return Zg;const s=XC();return Zg=new aF(s.paint.properties["line-width"].specification),Zg.useIntegerZoom=!0,Zg})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new qw(l)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(l,t,s){const c=ZC(this);return{config:new Du(this,{zoom:t,lut:s}),defines:c,overrideFog:!1}}queryRadius(l){const t=l,s=KC(Rt("line-width",this,t),Rt("line-gap-width",this,t)),c=Rt("line-offset",this,t);return s/2+Math.abs(c)+Pt(this.paint.get("line-translate"))}queryIntersectsFeature(l,t,s,c,m,h){if(l.queryGeometry.isAboveHorizon)return!1;const _=ht(l.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,l.pixelToTileUnitsFactor),w=l.pixelToTileUnitsFactor/2*KC(this.paint.get("line-width").evaluate(t,s),this.paint.get("line-gap-width").evaluate(t,s)),S=this.paint.get("line-offset").evaluate(t,s);return S&&(c=function(P,x){const A=[],I=new ve(0,0);for(let E=0;E<P.length;E++){const C=P[E],R=[];for(let z=0;z<C.length;z++){const V=C[z],W=C[z+1],Y=z===0?I:V.sub(C[z-1])._unit()._perp(),$=z===C.length-1?I:W.sub(V)._unit()._perp(),J=Y._add($)._unit();J._mult(1/(J.x*$.x+J.y*$.y)),R.push(J._mult(x)._add(V))}A.push(R)}return A}(c,S*l.pixelToTileUnitsFactor)),function(P,x,A){for(let I=0;I<x.length;I++){const E=x[I];if(P.length>=3){for(let C=0;C<E.length;C++)if(Ne(P,E[C]))return!0}if(Se(P,E,A))return!0}return!1}(_,c,w)}isTileClipped(){return!0}isDraped(l){return!this.hasElevatedBuckets}},symbol:tv,background:class extends js{constructor(l,t,s,c){super(l,{layout:kM||(kM=new Bn({visibility:new Xt(gt.layout_background.visibility)})),paint:zM||(zM=new Bn({"background-pitch-alignment":new Xt(gt.paint_background["background-pitch-alignment"]),"background-color":new Xt(gt.paint_background["background-color"]),"background-pattern":new Xt(gt.paint_background["background-pattern"]),"background-opacity":new Xt(gt.paint_background["background-opacity"]),"background-emissive-strength":new Xt(gt.paint_background["background-emissive-strength"]),"background-color-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"})}))},t,s,c)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(l,t,s){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:UM,"raster-particle":WM,sky:class extends js{constructor(l,t,s,c){super(l,{layout:qM||(qM=new Bn({visibility:new Xt(gt.layout_sky.visibility)})),paint:HM||(HM=new Bn({"sky-type":new Xt(gt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Xt(gt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Xt(gt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Xt(gt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Xt(gt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ih(gt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Xt(gt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Xt(gt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Xt(gt.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"})}))},t,s,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="sky-gradient"?this._updateColorRamp():l!=="sky-atmosphere-sun"&&l!=="sky-atmosphere-halo-color"&&l!=="sky-atmosphere-color"&&l!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ng({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(l){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=l.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(l,t){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),m=!c,h=l.style.light,_=h.properties.get("position");return m&&h.properties.get("anchor")==="viewport"&&Vi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),m?d2(_.azimuthal,90-_.polar,t):d2(c[0],90-c[1],t)}const s=this.paint.get("sky-gradient-center");return d2(s[0],90-s[1],t)}isSky(){return!0}markSkyboxValid(l){this._skyboxInvalidated=!1,this._lightPosition=l.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const l=this.paint.get("sky-type");return l==="atmosphere"?["skyboxCapture","skybox"]:l==="gradient"?["skyboxGradient"]:null}},slot:class extends js{constructor(l,t,s,c){super(l,{paint:GM||(GM=new Bn({}))},t,null)}},model:class extends js{constructor(l,t,s,c){super(l,{layout:rI||(rI=new Bn({visibility:new Xt(gt.layout_model.visibility),"model-id":new hi(gt.layout_model["model-id"])})),paint:nI||(nI=new Bn({"model-opacity":new hi(gt.paint_model["model-opacity"]),"model-rotation":new hi(gt.paint_model["model-rotation"]),"model-scale":new hi(gt.paint_model["model-scale"]),"model-translation":new hi(gt.paint_model["model-translation"]),"model-color":new hi(gt.paint_model["model-color"]),"model-color-mix-intensity":new hi(gt.paint_model["model-color-mix-intensity"]),"model-type":new Xt(gt.paint_model["model-type"]),"model-cast-shadows":new Xt(gt.paint_model["model-cast-shadows"]),"model-receive-shadows":new Xt(gt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Xt(gt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new hi(gt.paint_model["model-emissive-strength"]),"model-roughness":new hi(gt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new hi(gt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Xt(gt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Xt(gt.paint_model["model-front-cutoff"]),"model-color-use-theme":new hi({type:"string",default:"default","property-type":"data-driven"})}))},t,s,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new m2(l)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(l){return l instanceof cv?ii-1:0}queryIntersectsFeature(l,t,s,c,m,h){if(!this.modelManager)return!1;const _=this.modelManager,w=l.tile.getBucket(this);if(!(w&&w instanceof m2))return!1;for(const S in w.instancesPerModel){const P=w.instancesPerModel[S],x=t.id!==void 0?t.id:t.properties&&t.properties.hasOwnProperty("id")?t.properties.id:void 0;if(P.idToFeaturesIndex.hasOwnProperty(x)){const A=P.features[P.idToFeaturesIndex[x]],I=_.getModel(S,this.scope);if(!I)return!1;let E=H.mat4.create();const C=new Vr(0,0),R=w.canonical;let z=Number.MAX_VALUE;for(let V=0;V<A.instancedDataCount;++V){const W=16*(A.instancedDataOffset+V),Y=P.instancedDataArray.float32,$=[Y[W+4],Y[W+5],Y[W+6]];uI(R,C,Y[W],0|Y[W+1]),sI(E,I,h,C,A.rotation,A.scale,$,!1,!1,!1),h.projection.name==="globe"&&(E=p2(E,h));const J=H.mat4.multiply([],h.projMatrix,E),ie=l.queryGeometry,ge=JM(ie.isPointQuery()?ie.screenBounds:ie.screenGeometry,h,J,I.aabb);ge!=null&&(z=Math.min(ge,z))}return z!==Number.MAX_VALUE&&z}}return!1}_handleOverridablePaintPropertyUpdate(l,t,s){return!(!this.layout||t.isDataDriven()||s.isDataDriven()||l!=="model-color"&&l!=="model-color-mix-intensity"&&l!=="model-rotation"&&l!=="model-scale"&&l!=="model-translation"&&l!=="model-emissive-strength")}_isPropertyZoomDependent(l){const t=this._transitionablePaint._values[l];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof rf}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends js{constructor(l,t,s,c){super(l,{layout:rC||(rC=new Bn({"clip-layer-types":new Xt(gt.layout_clip["clip-layer-types"]),"clip-layer-scope":new Xt(gt.layout_clip["clip-layer-scope"])})),paint:nC||(nC=new Bn({}))},t,s,c)}recalculate(l,t){super.recalculate(l,t)}createBucket(l){return new sC(l)}isTileClipped(){return!0}is3D(){return!0}}};class sB{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class oB{constructor(){this.tasks={},this.taskQueue=[],kr(["process"],this),this.invoker=new sB(this.process),this.nextId=0}add(t,s){const c=this.nextId++,m=function({type:h,isSymbolTile:_,zoom:w}){return w=w||0,h==="message"?0:h!=="maybePrepare"||_?h!=="parseTile"||_?h==="parseTile"&&_?300-w:h==="maybePrepare"&&_?400-w:500:200-w:100-w}(s);if(m===0){try{t()}finally{}return null}return this.tasks[c]={fn:t,metadata:s,priority:m,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const s=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let t=null,s=1/0;for(let m=0;m<this.taskQueue.length;m++){const h=this.tasks[this.taskQueue[m]];h.priority<s&&(s=h.priority,t=m)}if(t===null)return null;const c=this.taskQueue[t];return this.taskQueue.splice(t,1),c}remove(){this.invoker.remove()}}class hI{constructor(t,s,c){this.target=t,this.parent=s,this.mapId=c,this.callbacks={},this.cancelCallbacks={},kr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new oB}send(t,s,c,m,h=!1,_){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=_,this.callbacks[w]=c);const S=new Set;return this.target.postMessage({id:w,type:t,hasCallback:!!c,targetMapId:m,mustQueue:h,sourceMapId:this.mapId,data:Uc(s,S)},S),{cancel:()=>{c&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:m,sourceMapId:this.mapId})}}}receive(t){const s=t.data,c=s.id;if(c&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){const m=this.cancelCallbacks[c];delete this.cancelCallbacks[c],m&&m.cancel()}else if(s.mustQueue||Yn()){const m=this.callbacks[c],h=this.scheduler.add(()=>this.processTask(c,s),m&&m.metadata||{type:"message"});h&&(this.cancelCallbacks[c]=h)}else this.processTask(c,s)}processTask(t,s){if(delete this.cancelCallbacks[t],s.type==="<response>"){const c=this.callbacks[t];delete this.callbacks[t],c&&(s.error?c(Cu(s.error)):c(null,Cu(s.data)))}else{const c=new Set,m=s.hasCallback?(_,w)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:_?Uc(_):null,data:Uc(w,c)},c)}:()=>{},h=Cu(s.data);if(this.parent[s.type])this.parent[s.type](s.sourceMapId,h,m);else if(this.parent.getWorkerSource){const _=s.type.split(".");this.parent.getWorkerSource(s.sourceMapId,_[0],h.source,h.scope)[_[1]](h,m)}else m(new Error(`Could not find function ${s.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var ly={workerUrl:"",workerClass:null,workerParams:void 0};const v2="mapboxgl_preloaded_worker_pool";class If{constructor(){this.active={}}acquire(t,s=If.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<s;)this.workers.push(ly.workerClass!=null?new ly.workerClass:new self.Worker(ly.workerUrl,ly.workerParams));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[v2]}numActive(){return Object.keys(this.active).length}}If.workerCount=2;class xm{constructor(t,s,c="Worker",m=If.workerCount){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=Rr();const h=this.workerPool.acquire(this.id,m);for(let _=0;_<h.length;_++){const w=new xm.Actor(h[_],s,this.id);w.name=`${c} ${_}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,s,c){Ni(this.actors,(m,h)=>{m.send(t,s,h)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}let cy,x2;function uv(){return cy||(cy=new If),cy}xm.Actor=hI;const b2=new zr(0,0,0);var w2=(l=>(l[l.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",l[l.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",l[l.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",l))(w2||{}),hv=(l=>(l[l.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",l[l.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",l[l.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",l[l.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",l))(hv||{}),uy=(l=>(l[l.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",l[l.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",l[l.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",l[l.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",l[l.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",l))(uy||{}),dI=(l=>(l[l.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",l[l.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",l[l.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",l))(dI||{}),bm=(l=>(l[l.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",l[l.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",l[l.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",l[l.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",l[l.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",l[l.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",l))(bm||{}),fI=(l=>(l[l.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",l[l.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",l[l.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",l))(fI||{});function aB(l,t,s){l===1&&t.icons.push(function(c,m){return function(h){if(h.usvg_tree.height||(h.usvg_tree.height=h.usvg_tree.width),!h.metadata)return h;const{metadata:_}=h;if(_.content_area){const{content_area:w}=_;w.top==null&&(w.top=w.left),w.width==null&&(w.width=h.usvg_tree.width),w.height==null&&(w.height=w.width)}return _.stretch_x&&_.stretch_x.length&&pI(_,"x"),_.stretch_y&&_.stretch_y.length&&pI(_,"y"),h}(c.readFields(lB,{name:void 0},m))}(s,s.readVarint()+s.pos))}function pI(l,t){const s=[],c=l[`stretch_${t}`];let m=null;for(let h=0;h<c.length;h++)m===null?m=s.length===0?c[0]:s[s.length-1][1]+c[h]:(s.push([m,m+c[h]]),m=null);l[`stretch_${t}_areas`]=s}function lB(l,t,s){l===1?t.name=s.readString():l===2?t.metadata=function(c,m){return c.readFields(cB,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},m)}(s,s.readVarint()+s.pos):l===3&&(t.usvg_tree=function(c,m){return c.readFields(dB,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},m)}(s,s.readVarint()+s.pos),t.data="usvg_tree")}function cB(l,t,s){l===1?t.stretch_x=s.readPackedVarint():l===2?t.stretch_y=s.readPackedVarint():l===3?t.content_area=function(c,m){return c.readFields(uB,{left:0},m)}(s,s.readVarint()+s.pos):l===4&&t.variables.push(function(c,m){return c.readFields(hB,{name:void 0},m)}(s,s.readVarint()+s.pos))}function uB(l,t,s){l===1?t.left=s.readVarint():l===2?t.width=s.readVarint():l===3?t.top=s.readVarint():l===4&&(t.height=s.readVarint())}function hB(l,t,s){l===1?t.name=s.readString():l===2&&(t.rgb_color=pv(s.readVarint()),t.value="rgb_color")}function dB(l,t,s){l===1?t.width=t.height=s.readVarint():l===2?t.height=s.readVarint():l===3?t.children.push(dv(s,s.readVarint()+s.pos)):l===4?t.linear_gradients.push(function(c,m){return c.readFields(vB,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},m)}(s,s.readVarint()+s.pos)):l===5?t.radial_gradients.push(function(c,m){return c.readFields(bB,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},m)}(s,s.readVarint()+s.pos)):l===7?t.clip_paths.push(function(c,m){return c.readFields(wB,{children:[]},m)}(s,s.readVarint()+s.pos)):l===8&&t.masks.push(function(c,m){const h=c.readFields(TB,{left:0,width:20,mask_type:1,children:[]},m);return h.height==null&&(h.height=h.width),h.top==null&&(h.top=h.left),h}(s,s.readVarint()+s.pos))}function dv(l,t){return l.readFields(fB,{},t)}function fB(l,t,s){l===1?(t.group=function(c,m){return c.readFields(pB,{opacity:255,children:[]},m)}(s,s.readVarint()+s.pos),t.node="group"):l===2&&(t.path=function(c,m){return c.readFields(_B,{paint_order:1,commands:[],step:1,diffs:[],rule:1},m)}(s,s.readVarint()+s.pos),t.node="path")}function pB(l,t,s){l===1?t.transform=fv(s,s.readVarint()+s.pos):l===2?t.opacity=s.readVarint():l===5?t.clip_path_idx=s.readVarint():l===6?t.mask_idx=s.readVarint():l===7&&t.children.push(dv(s,s.readVarint()+s.pos))}function fv(l,t){return l.readFields(mB,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},t)}function mB(l,t,s){l===1?t.sx=s.readFloat():l===2?t.ky=s.readFloat():l===3?t.kx=s.readFloat():l===4?t.sy=s.readFloat():l===5?t.tx=s.readFloat():l===6&&(t.ty=s.readFloat())}function _B(l,t,s){l===1?t.fill=function(c,m){return c.readFields(gB,{rgb_color:b2,paint:"rgb_color",opacity:255},m)}(s,s.readVarint()+s.pos):l===2?t.stroke=function(c,m){return c.readFields(yB,{rgb_color:b2,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},m)}(s,s.readVarint()+s.pos):l===3?t.paint_order=s.readVarint():l===5?s.readPackedVarint(t.commands):l===6?t.step=s.readFloat():l===7?s.readPackedSVarint(t.diffs):l===8&&(t.rule=s.readVarint())}function gB(l,t,s){l===1?(t.rgb_color=pv(s.readVarint()),t.paint="rgb_color"):l===2?(t.linear_gradient_idx=s.readVarint(),t.paint="linear_gradient_idx"):l===3?(t.radial_gradient_idx=s.readVarint(),t.paint="radial_gradient_idx"):l===5&&(t.opacity=s.readVarint())}function pv(l){return new zr((l>>16&255)/255,(l>>8&255)/255,(255&l)/255,1)}function yB(l,t,s){l===1?(t.rgb_color=pv(s.readVarint()),t.paint="rgb_color"):l===2?(t.linear_gradient_idx=s.readVarint(),t.paint="linear_gradient_idx"):l===3?(t.radial_gradient_idx=s.readVarint(),t.paint="radial_gradient_idx"):l===5?s.readPackedFloat(t.dasharray):l===6?t.dashoffset=s.readFloat():l===7?t.miterlimit=s.readFloat():l===8?t.opacity=s.readVarint():l===9?t.width=s.readFloat():l===10?t.linecap=s.readVarint():l===11&&(t.linejoin=s.readVarint())}function vB(l,t,s){l===1?t.transform=fv(s,s.readVarint()+s.pos):l===2?t.spread_method=s.readVarint():l===3?t.stops.push(mI(s,s.readVarint()+s.pos)):l===4?t.x1=s.readFloat():l===5?t.y1=s.readFloat():l===6?t.x2=s.readFloat():l===7&&(t.y2=s.readFloat())}function mI(l,t){return l.readFields(xB,{offset:0,opacity:255,rgb_color:b2},t)}function xB(l,t,s){l===1?t.offset=s.readFloat():l===2?t.opacity=s.readVarint():l===3&&(t.rgb_color=pv(s.readVarint()))}function bB(l,t,s){l===1?t.transform=fv(s,s.readVarint()+s.pos):l===2?t.spread_method=s.readVarint():l===3?t.stops.push(mI(s,s.readVarint()+s.pos)):l===4?t.cx=s.readFloat():l===5?t.cy=s.readFloat():l===6?t.r=s.readFloat():l===7?t.fx=s.readFloat():l===8?t.fy=s.readFloat():l===9&&(t.fr=s.readFloat())}function wB(l,t,s){l===1?t.transform=fv(s,s.readVarint()+s.pos):l===2?t.clip_path_idx=s.readVarint():l===3&&t.children.push(dv(s,s.readVarint()+s.pos))}function TB(l,t,s){l===1?t.left=t.top=s.readFloat():l===2?t.width=t.height=s.readFloat():l===3?t.top=s.readFloat():l===4?t.height=s.readFloat():l===5?t.mask_type=s.readVarint():l===6?t.mask_idx=s.readVarint():l===7&&t.children.push(dv(s,s.readVarint()+s.pos))}class EB{static calculate(t,s){const c=new Map,m=new Map;if(Object.keys(t).length===0)return c;s.forEach(h=>{m.set(h.name,h.rgb_color||new zr(0,0,0))});for(const[h,_]of Object.entries(t))m.has(h)?c.set(m.get(h).toStringPremultipliedAlpha(),_):console.warn(`Ignoring unknown image variable "${h}"`);return c}}function wm(l,t=255,s){const c=t/255,m=l.toStringPremultipliedAlpha(),h=s.has(m)?s.get(m).clone():l.clone();return h.a=c,h.toString()}function hy(l,t){if(!we()){const s=document.createElement("canvas");return s.width=l,s.height=t,s}return new OffscreenCanvas(l,t)}function SB(l,t){const s=EB.calculate(t.params,l.metadata?l.metadata.variables:[]),c=l.usvg_tree,m=c.width,h=c.height,_=t.transform?t.transform:new DOMMatrix,w=Math.max(1,Math.round(m*_.a)),S=Math.max(1,Math.round(h*_.d)),P=new DOMMatrix([w/m,0,0,S/h,0,0]),x=hy(w,S).getContext("2d");return T2(x,P,c,c,s),x.getImageData(0,0,w,S)}function T2(l,t,s,c,m){for(const h of c.children)_I(l,t,s,h,m)}function _I(l,t,s,c,m){c.group?(l.save(),function(h,_,w,S,P){const x=S.mask_idx!=null?w.masks[S.mask_idx]:null,A=S.clip_path_idx!=null?w.clip_paths[S.clip_path_idx]:null;if(S.transform&&(_=mv(S.transform).preMultiplySelf(_)),!function(C,R,z){return C.opacity!==255||R||z}(S,A!=null,x!=null))return void T2(h,_,w,S,P);const I=hy(h.canvas.width,h.canvas.height),E=I.getContext("2d");T2(E,_,w,S,P),A&&TI(E,_,w,A),x&&EI(E,_,w,x,P),h.globalAlpha=S.opacity/255,h.drawImage(I,0,0)}(l,t,s,c.group,m),l.restore()):c.path&&(l.save(),function(h,_,w,S,P){const x=SI(S);h.setTransform(_),S.paint_order===dI.PAINT_ORDER_FILL_AND_STROKE?(gI(h,w,S,x,P),vI(h,w,S,x,P)):(vI(h,w,S,x,P),gI(h,w,S,x,P))}(l,t,s,c.path,m),l.restore())}function gI(l,t,s,c,m){const h=s.fill;if(!h)return;const _=h.opacity/255;switch(h.paint){case"rgb_color":l.fillStyle=wm(h.rgb_color,h.opacity,m);break;case"linear_gradient_idx":l.fillStyle=xI(l,t.linear_gradients[h.linear_gradient_idx],_,m);break;case"radial_gradient_idx":l.fillStyle=bI(l,t.radial_gradients[h.radial_gradient_idx],_,m)}l.fill(c,yI(s))}function yI(l){return l.rule===w2.PATH_RULE_NON_ZERO?"nonzero":l.rule===w2.PATH_RULE_EVEN_ODD?"evenodd":void 0}function vI(l,t,s,c,m){const h=s.stroke;if(!h)return;l.lineWidth=h.width,l.miterLimit=h.miterlimit,l.setLineDash(h.dasharray),l.lineDashOffset=h.dashoffset;const _=h.opacity/255;switch(h.paint){case"rgb_color":l.strokeStyle=wm(h.rgb_color,h.opacity,m);break;case"linear_gradient_idx":l.strokeStyle=xI(l,t.linear_gradients[h.linear_gradient_idx],_,m);break;case"radial_gradient_idx":l.strokeStyle=bI(l,t.radial_gradients[h.radial_gradient_idx],_,m)}switch(h.linejoin){case uy.LINE_JOIN_MITER_CLIP:case uy.LINE_JOIN_MITER:l.lineJoin="miter";break;case uy.LINE_JOIN_ROUND:l.lineJoin="round";break;case uy.LINE_JOIN_BEVEL:l.lineJoin="bevel"}switch(h.linecap){case hv.LINE_CAP_BUTT:l.lineCap="butt";break;case hv.LINE_CAP_ROUND:l.lineCap="round";break;case hv.LINE_CAP_SQUARE:l.lineCap="square"}l.stroke(c)}function xI(l,t,s,c){if(t.stops.length===1){const I=t.stops[0];return wm(I.rgb_color,I.opacity*s,c)}const m=mv(t.transform),{x1:h,y1:_,x2:w,y2:S}=t,P=m.transformPoint(new DOMPoint(h,_)),x=m.transformPoint(new DOMPoint(w,S)),A=l.createLinearGradient(P.x,P.y,x.x,x.y);for(const I of t.stops)A.addColorStop(I.offset,wm(I.rgb_color,I.opacity*s,c));return A}function bI(l,t,s,c){if(t.stops.length===1){const I=t.stops[0];return wm(I.rgb_color,I.opacity*s,c)}const m=mv(t.transform),{fx:h,fy:_,cx:w,cy:S}=t,P=m.transformPoint(new DOMPoint(h,_)),x=m.transformPoint(new DOMPoint(w,S)),A=l.createRadialGradient(P.x,P.y,0,x.x,x.y,t.r*((m.a+m.d)/2));for(const I of t.stops)A.addColorStop(I.offset,wm(I.rgb_color,I.opacity*s,c));return A}function wI(l,t,s,c){const m=c.transform?mv(c.transform).preMultiplySelf(t):t,h=hy(l.canvas.width,l.canvas.height),_=h.getContext("2d");for(const S of c.children)if(S.group)wI(_,m,s,S.group);else if(S.path){const P=S.path,x=new Path2D;x.addPath(SI(P),m),_.fill(x,yI(P))}const w=c.clip_path_idx!=null?s.clip_paths[c.clip_path_idx]:null;w&&TI(_,m,s,w),l.globalCompositeOperation="source-over",l.drawImage(h,0,0)}function TI(l,t,s,c){const m=hy(l.canvas.width,l.canvas.height);wI(m.getContext("2d"),t,s,c),l.globalCompositeOperation="destination-in",l.drawImage(m,0,0)}function EI(l,t,s,c,m){if(c.children.length===0)return;const h=c.mask_idx!=null?s.masks[c.mask_idx]:null;h&&EI(l,t,s,h,m);const _=l.canvas.width,w=l.canvas.height,S=hy(_,w),P=S.getContext("2d"),x=c.width,A=c.height,I=c.left,E=c.top,C=new Path2D,R=new Path2D;R.rect(I,E,x,A),C.addPath(R,t),P.clip(C);for(const W of c.children)_I(P,t,s,W,m);const z=P.getImageData(0,0,_,w),V=z.data;if(c.mask_type===fI.MASK_TYPE_LUMINANCE)for(let W=0;W<V.length;W+=4)V[W+3]=V[W+3]/255*(.2126*V[W]+.7152*V[W+1]+.0722*V[W+2]);P.putImageData(z,0,0),l.globalCompositeOperation="destination-in",l.drawImage(S,0,0)}function mv(l){return l?new DOMMatrix([l.sx,l.ky,l.kx,l.sy,l.tx,l.ty]):new DOMMatrix}function SI(l){const t=new Path2D,s=l.step;let c=l.diffs[0]*s,m=l.diffs[1]*s;t.moveTo(c,m);for(let h=0,_=2;h<l.commands.length;h++)switch(l.commands[h]){case bm.PATH_COMMAND_MOVE:c+=l.diffs[_++]*s,m+=l.diffs[_++]*s,t.moveTo(c,m);break;case bm.PATH_COMMAND_LINE:c+=l.diffs[_++]*s,m+=l.diffs[_++]*s,t.lineTo(c,m);break;case bm.PATH_COMMAND_QUAD:{const w=c+l.diffs[_++]*s,S=m+l.diffs[_++]*s;c=w+l.diffs[_++]*s,m=S+l.diffs[_++]*s,t.quadraticCurveTo(w,S,c,m);break}case bm.PATH_COMMAND_CUBIC:{const w=c+l.diffs[_++]*s,S=m+l.diffs[_++]*s,P=w+l.diffs[_++]*s,x=S+l.diffs[_++]*s;c=P+l.diffs[_++]*s,m=x+l.diffs[_++]*s,t.bezierCurveTo(w,S,P,x,c,m);break}case bm.PATH_COMMAND_CLOSE:t.closePath()}return t}class E2{constructor(t){this.capacity=t,this.cache=new Map}get(t){if(!this.cache.has(t))return;const s=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,s),s}put(t,s){this.cache.has(t)?this.cache.delete(t):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(t,s)}delete(t){this.cache.delete(t)}}class S2{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(t){return new ro(t,t.data)}getFromCache(t,s,c){return this.cacheMap.has(c)||this.cacheMap.set(c,new E2(150)),this.cacheMap.get(c).get(Ll(t.serialize(),s))}setInCache(t,s,c,m){this.cacheDependenciesMap.has(m)||this.cacheDependenciesMap.set(m,new Map),this.cacheMap.has(m)||this.cacheMap.set(m,new E2(150));const h=this.cacheDependenciesMap.get(m);h.get(Ll(t.id,c))||h.set(Ll(t.id,c),new Set);const _=this.cacheMap.get(m),w=t.serialize();h.get(Ll(t.id,c)).add(w),_.put(Ll(t.serialize(),c),s)}removeImagesFromCacheByIds(t,s,c=""){if(!this.cacheMap.has(c)||!this.cacheDependenciesMap.has(c))return;const m=this.cacheMap.get(c),h=this.cacheDependenciesMap.get(c);for(const _ of t)if(h.has(Ll(_,s))){for(const w of h.get(Ll(_,s)))m.delete(w);h.delete(Ll(_,s))}}rasterize(t,s,c,m,h=SB){const _=this.getFromCache(t,c,m);if(_)return _.clone();const w=h(s.icon,t.options),S=S2._getImage(w);return this.setInCache(t,S,c,m),S.clone()}}class AI{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,s){const c=this.toIdx(t,s);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(t,s){return this.leaves[this.toIdx(t,s)]}toIdx(t,s){return s*this.size+t}}function CI(l,t,s,c){let m=0,h=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(c[_])<1e-15){if(s[_]<l[_]||s[_]>t[_])return null}else{const w=1/c[_];let S=(l[_]-s[_])*w,P=(t[_]-s[_])*w;if(S>P){const x=S;S=P,P=x}if(S>m&&(m=S),P<h&&(h=P),m>h)return null}return m}function MI(l,t,s,c,m,h,_,w,S,P,x){const A=c-l,I=m-t,E=h-s,C=_-l,R=w-t,z=S-s,V=x[1]*z-x[2]*R,W=x[2]*C-x[0]*z,Y=x[0]*R-x[1]*C,$=A*V+I*W+E*Y;if(Math.abs($)<1e-15)return null;const J=1/$,ie=P[0]-l,ge=P[1]-t,Pe=P[2]-s,Me=(ie*V+ge*W+Pe*Y)*J;if(Me<0||Me>1)return null;const Ce=ge*E-Pe*I,$e=Pe*A-ie*E,Re=ie*I-ge*A,He=(x[0]*Ce+x[1]*$e+x[2]*Re)*J;return He<0||Me+He>1?null:(C*Ce+R*$e+z*Re)*J}function II(l,t,s){return(l-t)/(s-t)}function PI(l,t,s,c,m,h,_,w,S){const P=1<<s,x=h-c,A=_-m,I=(l+1)/P*x+c,E=(t+0)/P*A+m,C=(t+1)/P*A+m;w[0]=(l+0)/P*x+c,w[1]=E,S[0]=I,S[1]=C}class RI{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(h){const _=Math.ceil(Math.log2(h.dim/8)),w=[];let S=Math.ceil(Math.pow(2,_));const P=1/S,x=(E,C,R,z,V)=>{const W=z?1:0,Y=(E+1)*R-W,$=C*R,J=(C+1)*R-W;V[0]=E*R,V[1]=$,V[2]=Y,V[3]=J};let A=new AI(S);const I=[];for(let E=0;E<S*S;E++){x(E%S,Math.floor(E/S),P,!1,I);const C=Hh(I[0],I[1],h),R=Hh(I[2],I[1],h),z=Hh(I[2],I[3],h),V=Hh(I[0],I[3],h);A.minimums.push(Math.min(C,R,z,V)),A.maximums.push(Math.max(C,R,z,V)),A.leaves.push(1)}for(w.push(A),S/=2;S>=1;S/=2){const E=w[w.length-1];A=new AI(S);for(let C=0;C<S*S;C++){x(C%S,Math.floor(C/S),2,!0,I);const R=E.getElevation(I[0],I[1]),z=E.getElevation(I[2],I[1]),V=E.getElevation(I[2],I[3]),W=E.getElevation(I[0],I[3]),Y=E.isLeaf(I[0],I[1]),$=E.isLeaf(I[2],I[1]),J=E.isLeaf(I[2],I[3]),ie=E.isLeaf(I[0],I[3]),ge=Math.min(R.min,z.min,V.min,W.min),Pe=Math.max(R.max,z.max,V.max,W.max),Me=Y&&$&&J&&ie;A.maximums.push(Pe),A.minimums.push(ge),A.leaves.push(Pe-ge<=5&&Me?1:0)}w.push(A)}return w}(this.dem),c=s.length-1,m=s[c];this._addNode(m.minimums[0],m.maximums[0],m.leaves[0]),this._construct(s,0,0,c,0)}raycastRoot(t,s,c,m,h,_,w=1){return CI([t,s,-100],[c,m,this.maximums[0]*w],h,_)}raycast(t,s,c,m,h,_,w=1){if(!this.nodeCount)return null;const S=this.raycastRoot(t,s,c,m,h,_,w);if(S==null)return null;const P=[],x=[],A=[],I=[],E=[{idx:0,t:S,nodex:0,nodey:0,depth:0}];for(;E.length>0;){const{idx:C,t:R,nodex:z,nodey:V,depth:W}=E.pop();if(this.leaves[C]){PI(z,V,W,t,s,c,m,A,I);const $=1<<W,J=(z+0)/$,ie=(z+1)/$,ge=(V+0)/$,Pe=(V+1)/$,Me=Hh(J,ge,this.dem)*w,Ce=Hh(ie,ge,this.dem)*w,$e=Hh(ie,Pe,this.dem)*w,Re=Hh(J,Pe,this.dem)*w,He=MI(A[0],A[1],Me,I[0],A[1],Ce,I[0],I[1],$e,h,_),Je=MI(I[0],I[1],$e,A[0],I[1],Re,A[0],A[1],Me,h,_),Xe=Math.min(He!==null?He:Number.MAX_VALUE,Je!==null?Je:Number.MAX_VALUE);if(Xe!==Number.MAX_VALUE)return Xe;{const tt=H.vec3.scaleAndAdd([],h,_,R);if(DI(Me,Ce,Re,$e,II(tt[0],A[0],I[0]),II(tt[1],A[1],I[1]))>=tt[2])return R}continue}let Y=0;for(let $=0;$<this._siblingOffset.length;$++){PI((z<<1)+this._siblingOffset[$][0],(V<<1)+this._siblingOffset[$][1],W+1,t,s,c,m,A,I),A[2]=-100,I[2]=this.maximums[this.childOffsets[C]+$]*w;const J=CI(A,I,h,_);if(J!=null){const ie=J;P[$]=ie;let ge=!1;for(let Pe=0;Pe<Y&&!ge;Pe++)ie>=P[x[Pe]]&&(x.splice(Pe,0,$),ge=!0);ge||(x[Y]=$),Y++}}for(let $=0;$<Y;$++){const J=x[$];E.push({idx:this.childOffsets[C]+J,t:P[J],nodex:(z<<1)+this._siblingOffset[J][0],nodey:(V<<1)+this._siblingOffset[J][1],depth:W+1})}}return null}_addNode(t,s,c){return this.minimums.push(t),this.maximums.push(s),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(t,s,c,m,h){if(t[m].isLeaf(s,c)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const _=m-1,w=t[_];let S=0,P=0;for(let x=0;x<this._siblingOffset.length;x++){const A=2*s+this._siblingOffset[x][0],I=2*c+this._siblingOffset[x][1],E=w.getElevation(A,I),C=w.isLeaf(A,I),R=this._addNode(E.min,E.max,C);C&&(S|=1<<x),P||(P=R)}for(let x=0;x<this._siblingOffset.length;x++)S&1<<x||this._construct(t,2*s+this._siblingOffset[x][0],2*c+this._siblingOffset[x][1],_,P+x)}}function DI(l,t,s,c,m,h){return Bi(Bi(l,s,h),Bi(t,c,h),m)}function Hh(l,t,s){const c=s.dim,m=Ut(l*c-.5,0,c-1),h=Ut(t*c-.5,0,c-1),_=Math.floor(m),w=Math.floor(h),S=Math.min(_+1,c-1),P=Math.min(w+1,c-1);return DI(s.get(_,w),s.get(S,w),s.get(_,P),s.get(S,P),m-_,h-w)}const AB={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function CB(l,t,s){return(256*l*256+256*t+s)/10-1e4}function MB(l,t,s){return 256*l+t+s/256-32768}class _v{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,s,c,m=!1){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return void Vi(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const h=this.dim=s.height-2,_=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.floatView=new Float32Array(s.data.buffer),this.borderReady=m,this._modifiedForSources={},!m){for(let S=0;S<h;S++)_[this._idx(-1,S)]=_[this._idx(0,S)],_[this._idx(h,S)]=_[this._idx(h-1,S)],_[this._idx(S,-1)]=_[this._idx(S,0)],_[this._idx(S,h)]=_[this._idx(S,h-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(h,-1)]=_[this._idx(h-1,0)],_[this._idx(-1,h)]=_[this._idx(0,h-1)],_[this._idx(h,h)]=_[this._idx(h-1,h-1)]}const w=c==="terrarium"?MB:CB;for(let S=0;S<_.length;++S){const P=4*S;this.floatView[S]=w(this.pixels[P],this.pixels[P+1],this.pixels[P+2])}this._timestamp=ze.now()}_buildQuadTree(){this._tree=new RI(this)}get(t,s,c=!1){c&&(t=Ut(t,-1,this.dim),s=Ut(s,-1,this.dim));const m=this._idx(t,s);return this.floatView[m]}set(t,s,c){const m=this._idx(t,s),h=this.floatView[m];return this.floatView[m]=c,c-h}static getUnpackVector(t){return AB[t]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}static pack(t,s){const c=[0,0,0,0],m=_v.getUnpackVector(s);let h=Math.floor((t+m[3])/m[2]);return c[2]=h%256,h=Math.floor(h/256),c[1]=h%256,h=Math.floor(h/256),c[0]=h,c}getPixels(){return new YA({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,s,c){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let m=s*this.dim,h=s*this.dim+this.dim,_=c*this.dim,w=c*this.dim+this.dim;switch(s){case-1:m=h-1;break;case 1:h=m+1}switch(c){case-1:_=w-1;break;case 1:w=_+1}const S=-s*this.dim,P=-c*this.dim;for(let x=_;x<w;x++)for(let A=m;A<h;A++){const I=4*this._idx(A,x),E=4*this._idx(A+S,x+P);this.pixels[I+0]=t.pixels[E+0],this.pixels[I+1]=t.pixels[E+1],this.pixels[I+2]=t.pixels[E+2],this.pixels[I+3]=t.pixels[E+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function IB(l,t,s){l===1?t.headerLength=s.readFixed32():l===2?t.x=s.readVarint():l===3?t.y=s.readVarint():l===4?t.z=s.readVarint():l===5&&t.layers.push(function(c,m){return c.readFields(LB,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},m)}(s,s.readVarint()+s.pos))}function PB(l,t,s){l===1?(t.delta_filter=function(c,m){return c.readFields(RB,{blockSize:0},m)}(s,s.readVarint()+s.pos),t.filter="delta_filter"):l===2?(s.readVarint(),t.filter="zigzag_filter"):l===3?(s.readVarint(),t.filter="bitshuffle_filter"):l===4&&(s.readVarint(),t.filter="byteshuffle_filter")}function RB(l,t,s){l===1&&(t.blockSize=s.readVarint())}function DB(l,t,s){l===1?(s.readVarint(),t.codec="gzip_data"):l===2?(s.readVarint(),t.codec="jpeg_image"):l===3?(s.readVarint(),t.codec="webp_image"):l===4&&(s.readVarint(),t.codec="png_image")}function OB(l,t,s){let c=0,m=0;l===1?t.firstByte=s.readFixed64():l===2?t.lastByte=s.readFixed64():l===3?t.filters.push(function(h,_){return h.readFields(PB,{},_)}(s,s.readVarint()+s.pos)):l===4?t.codec=function(h,_){return h.readFields(DB,{},_)}(s,s.readVarint()+s.pos):l===5?m=s.readFloat():l===6?c=s.readFloat():l===7?t.bands.push(s.readString()):l===8?t.offset=s.readDouble():l===9&&(t.scale=s.readDouble()),t.offset===0&&(t.offset=m),t.scale===0&&(t.scale=c)}function LB(l,t,s){l===1?t.version=s.readVarint():l===2?t.name=s.readString():l===3?t.units=s.readString():l===4?t.tileSize=s.readVarint():l===5?t.buffer=s.readVarint():l===6?t.pixelFormat=s.readVarint():l===7&&t.dataIndex.push(function(c,m){return c.readFields(OB,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},m)}(s,s.readVarint()+s.pos))}function kB(l,t,s){if(l===2)(function(c,m,h){c.readFields(zB,h,m)})(s,s.readVarint()+s.pos,t);else if(l===3)throw new Error("Not implemented")}function zB(l,t,s){if(l===1){let c=0;const m=s.readVarint()+s.pos;for(;s.pos<m;)t[c++]=s.readVarint()}}function FB(l,t){if(t.length!==4)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let s=t[3];for(let c=2;c>=1;c--){const m=c===1?1:0,h=c===2?1:0;for(let _=0;_<t[0];_++){const w=t[1]*_;for(let S=m;S<t[1];S++){const P=t[2]*(S+w);for(let x=h;x<t[2];x++){const A=t[3]*(x+P);for(let I=0;I<t[3];I++){const E=A+I;l[E]+=l[E-s]}}}}s*=t[c]}return l}function BB(l){for(let t=0,s=l.length;t<s;t++)l[t]=l[t]>>>1^-(1&l[t]);return l}function NB(l,t){switch(t){case"uint32":return l;case"uint16":for(let s=0;s<l.length;s+=2){const c=l[s],m=l[s+1];l[s]=(240&c)>>4|(61440&c)>>8|(240&m)<<4|61440&m,l[s+1]=15&c|(3840&c)>>4|(15&m)<<8|(3840&m)<<4}return l;case"uint8":for(let s=0;s<l.length;s+=4){const c=l[s],m=l[s+1],h=l[s+2],_=l[s+3];l[s+0]=(192&c)>>6|(192&m)>>4|(192&h)>>2|192&_,l[s+1]=(48&c)>>4|(48&m)>>2|48&h|(48&_)<<2,l[s+2]=(12&c)>>2|12&m|(12&h)<<2|(12&_)<<4,l[s+3]=3&c|(3&m)<<2|(3&h)<<4|(3&_)<<6}return l;default:throw new Error(`Invalid pixel format, "${t}"`)}}gi(_v,"DEMData"),gi(RI,"DemMinMaxQuadTree",{omit:["dem"]});var ol=Uint8Array,dy=Uint16Array,VB=Int32Array,OI=new ol([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),LI=new ol([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),UB=new ol([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),kI=function(l,t){for(var s=new dy(31),c=0;c<31;++c)s[c]=t+=1<<l[c-1];var m=new VB(s[30]);for(c=1;c<30;++c)for(var h=s[c];h<s[c+1];++h)m[h]=h-s[c]<<5|c;return{b:s,r:m}},zI=kI(OI,2),FI=zI.b,jB=zI.r;FI[28]=258,jB[258]=28;for(var $B=kI(LI,0).b,BI=new dy(32768),vs=0;vs<32768;++vs){var Tm=(43690&vs)>>1|(21845&vs)<<1;BI[vs]=((65280&(Tm=(61680&(Tm=(52428&Tm)>>2|(13107&Tm)<<2))>>4|(3855&Tm)<<4))>>8|(255&Tm)<<8)>>1}var fy=function(l,t,s){for(var c=l.length,m=0,h=new dy(t);m<c;++m)l[m]&&++h[l[m]-1];var _,w=new dy(t);for(m=1;m<t;++m)w[m]=w[m-1]+h[m-1]<<1;_=new dy(1<<t);var S=15-t;for(m=0;m<c;++m)if(l[m])for(var P=m<<4|l[m],x=t-l[m],A=w[l[m]-1]++<<x,I=A|(1<<x)-1;A<=I;++A)_[BI[A]>>S]=P;return _},py=new ol(288);for(vs=0;vs<144;++vs)py[vs]=8;for(vs=144;vs<256;++vs)py[vs]=9;for(vs=256;vs<280;++vs)py[vs]=7;for(vs=280;vs<288;++vs)py[vs]=8;var NI=new ol(32);for(vs=0;vs<32;++vs)NI[vs]=5;var qB=fy(py,9),HB=fy(NI,5),A2=function(l){for(var t=l[0],s=1;s<l.length;++s)l[s]>t&&(t=l[s]);return t},xc=function(l,t,s){var c=t/8|0;return(l[c]|l[c+1]<<8)>>(7&t)&s},C2=function(l,t){var s=t/8|0;return(l[s]|l[s+1]<<8|l[s+2]<<16)>>(7&t)},GB=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],bc=function(l,t,s){var c=new Error(t||GB[l]);if(c.code=l,Error.captureStackTrace&&Error.captureStackTrace(c,bc),!s)throw c;return c},WB=new ol(0),ZB=typeof TextDecoder<"u"&&new TextDecoder;try{ZB.decode(WB,{stream:!0})}catch{}const YB={gzip_data:"gzip"};class Ul extends Error{constructor(t){super(t),this.name="MRTError"}}const XB={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},VI={uint32:1,uint16:2,uint8:4},KB={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let M2;class I2{constructor(t=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){const s=this.layers[t];if(!s)throw new Ul(`Layer '${t}' not found`);return s}getHeaderLength(t){const s=new Uint8Array(t),c=new DataView(t);if(s[0]!==13)throw new Ul("File is not a valid MRT.");return c.getUint32(1,!0)}parseHeader(t){const s=new Uint8Array(t),c=this.getHeaderLength(t);if(s.length<c)throw new Ul(`Expected header with length >= ${c} but got buffer of length ${s.length}`);const m=function(h,_){return h.readFields(IB,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new M2(s.subarray(0,c)));if(!isNaN(this.x)&&(this.x!==m.x||this.y!==m.y||this.z!==m.z))throw new Ul(`Invalid attempt to parse header ${m.z}/${m.x}/${m.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=m.x,this.y=m.y,this.z=m.z;for(const h of m.layers)this.layers[h.name]=new JB(h,{cacheSize:this._cacheSize});return this}createDecodingTask(t){const s=[],c=this.getLayer(t.layerName);for(let m of t.blockIndices){const h=c.dataIndex[m],_=h.firstByte-t.firstByte,w=h.lastByte-t.firstByte;if(c._blocksInProgress.has(m))continue;const S={layerName:c.name,firstByte:_,lastByte:w,pixelFormat:c.pixelFormat,blockIndex:m,blockShape:[h.bands.length].concat(c.bandShape),buffer:c.buffer,codec:h.codec.codec,filters:h.filters.map(P=>P.filter)};c._blocksInProgress.add(m),s.push(S)}return new UI(s,()=>{s.forEach(m=>c._blocksInProgress.delete(m.blockIndex))},(m,h)=>{if(s.forEach(_=>c._blocksInProgress.delete(_.blockIndex)),m)throw m;h.forEach(_=>{this.getLayer(_.layerName).processDecodedData(_)})})}}class JB{constructor({version:t,name:s,units:c,tileSize:m,pixelFormat:h,buffer:_,dataIndex:w},S){if(this.version=t,this.version!==1)throw new Ul(`Cannot parse raster layer encoded with MRT version ${t}`);this.name=s,this.units=c,this.tileSize=m,this.buffer=_,this.pixelFormat=XB[h],this.dataIndex=w,this.bandShape=[m+2*_,m+2*_,VI[this.pixelFormat]],this._decodedBlocks=new E2(S?S.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return VI[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:t})=>t).flat()}processDecodedData(t){const s=t.blockIndex.toString();this._decodedBlocks.get(s)||this._decodedBlocks.put(s,t.data)}getBlockForBand(t){let s=0;switch(typeof t){case"string":for(const[c,m]of this.dataIndex.entries()){for(const[h,_]of m.bands.entries())if(_===t)return{bandIndex:s+h,blockIndex:c,blockBandIndex:h};s+=m.bands.length}break;case"number":for(const[c,m]of this.dataIndex.entries()){if(t>=s&&t<s+m.bands.length)return{bandIndex:t,blockIndex:c,blockBandIndex:t-s};s+=m.bands.length}break;default:throw new Ul(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}throw new Ul(`Band not found: ${JSON.stringify(t)}`)}getDataRange(t){let s=1/0,c=-1/0;const m=[],h=new Set;for(const _ of t){const{blockIndex:w}=this.getBlockForBand(_);if(w<0)throw new Ul(`Invalid band: ${JSON.stringify(_)}`);const S=this.dataIndex[w];m.includes(w)||m.push(w),h.add(w),s=Math.min(s,S.firstByte),c=Math.max(c,S.lastByte)}if(h.size>this.cacheSize)throw new Ul(`Number of blocks to decode (${h.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:s,lastByte:c,blockIndices:m}}hasBand(t){const{blockIndex:s}=this.getBlockForBand(t);return s>=0}hasDataForBand(t){const{blockIndex:s}=this.getBlockForBand(t);return s>=0&&!!this._decodedBlocks.get(s.toString())}getBandView(t){const{blockIndex:s,blockBandIndex:c}=this.getBlockForBand(t),m=this._decodedBlocks.get(s.toString());if(!m)throw new Ul(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);const h=this.dataIndex[s],_=this.bandShape.reduce((P,x)=>P*x,1),w=c*_,S=m.subarray(w,w+_);return{data:S,bytes:new Uint8Array(S.buffer).subarray(S.byteOffset,S.byteOffset+S.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:h.offset,scale:h.scale}}}I2.setPbf=function(l){M2=l};class UI{constructor(t,s,c){this.tasks=t,this._onCancel=s,this._onComplete=c,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,s){this._finalized||(this._onComplete(t,s),this._finalized=!0)}}I2.performDecoding=function(l,t){const s=new Uint8Array(l);return Promise.all(t.tasks.map(c=>{const{layerName:m,firstByte:h,lastByte:_,pixelFormat:w,blockShape:S,blockIndex:P,filters:x,codec:A}=c,I=s.subarray(h,_+1),E=new Uint32Array(S[0]*S[1]*S[2]);let C;if(A!=="gzip_data")throw new Ul(`Unhandled codec: ${A}`);return C=function(R,z){if(!globalThis.DecompressionStream&&z==="gzip_data")return Promise.resolve((($=function(ge){ge[0]==31&&ge[1]==139&&ge[2]==8||bc(6,"invalid gzip data");var Pe=ge[3],Me=10;4&Pe&&(Me+=2+(ge[10]|ge[11]<<8));for(var Ce=(Pe>>3&1)+(Pe>>4&1);Ce>0;Ce-=!ge[Me++]);return Me+(2&Pe)}(Y=R))+8>Y.length&&bc(6,"invalid gzip data"),function(ge,Pe,Me,Ce){var $e=ge.length;if(!$e||Pe.f&&!Pe.l)return Me||new ol(0);var Re=!Me,He=Re||Pe.i!=2,Je=Pe.i;Re&&(Me=new ol(3*$e));var Xe,tt,at=function(Gh){var Df=Me.length;if(Gh>Df){var yy=new ol(Math.max(2*Df,Gh));yy.set(Me),Me=yy}},ft=Pe.f||0,nt=Pe.p||0,Mt=Pe.b||0,Ft=Pe.l,Ct=Pe.d,si=Pe.m,ri=Pe.n,Wt=8*$e;do{if(!Ft){ft=xc(ge,nt,1);var Bt=xc(ge,nt+1,3);if(nt+=3,!Bt){var wi=ge[(nr=4+((nt+7)/8|0))-4]|ge[nr-3]<<8,ai=nr+wi;if(ai>$e){Je&&bc(0);break}He&&at(Mt+wi),Me.set(ge.subarray(nr,ai),Mt),Pe.b=Mt+=wi,Pe.p=nt=8*ai,Pe.f=ft;continue}if(Bt==1)Ft=qB,Ct=HB,si=9,ri=5;else if(Bt==2){var fi=xc(ge,nt,31)+257,Wi=xc(ge,nt+10,15)+4,hr=fi+xc(ge,nt+5,31)+1;nt+=14;for(var pr=new ol(hr),mr=new ol(19),Er=0;Er<Wi;++Er)mr[UB[Er]]=xc(ge,nt+3*Er,7);nt+=3*Wi;var Sr=A2(mr),mn=(1<<Sr)-1,en=fy(mr,Sr);for(Er=0;Er<hr;){var nr,Zr=en[xc(ge,nt,mn)];if(nt+=15&Zr,(nr=Zr>>4)<16)pr[Er++]=nr;else{var Kr=0,Mn=0;for(nr==16?(Mn=3+xc(ge,nt,3),nt+=2,Kr=pr[Er-1]):nr==17?(Mn=3+xc(ge,nt,7),nt+=3):nr==18&&(Mn=11+xc(ge,nt,127),nt+=7);Mn--;)pr[Er++]=Kr}}var as=pr.subarray(0,fi),xs=pr.subarray(fi);si=A2(as),ri=A2(xs),Ft=fy(as,si),Ct=fy(xs,ri)}else bc(1);if(nt>Wt){Je&&bc(0);break}}He&&at(Mt+131072);for(var ls=(1<<si)-1,Kn=(1<<ri)-1,fs=nt;;fs=nt){var As=(Kr=Ft[C2(ge,nt)&ls])>>4;if((nt+=15&Kr)>Wt){Je&&bc(0);break}if(Kr||bc(2),As<256)Me[Mt++]=As;else{if(As==256){fs=nt,Ft=null;break}var _o=As-254;As>264&&(_o=xc(ge,nt,(1<<(Tc=OI[Er=As-257]))-1)+FI[Er],nt+=Tc);var En=Ct[C2(ge,nt)&Kn],fa=En>>4;if(En||bc(3),nt+=15&En,xs=$B[fa],fa>3){var Tc=LI[fa];xs+=C2(ge,nt)&(1<<Tc)-1,nt+=Tc}if(nt>Wt){Je&&bc(0);break}He&&at(Mt+131072);var jl=Mt+_o;if(Mt<xs){var $l=0-xs,Rf=Math.min(xs,jl);for($l+Mt<0&&bc(3);Mt<Rf;++Mt)Me[Mt]=(void 0)[$l+Mt]}for(;Mt<jl;++Mt)Me[Mt]=Me[Mt-xs]}}Pe.l=Ft,Pe.p=fs,Pe.b=Mt,Pe.f=ft,Ft&&(ft=1,Pe.m=si,Pe.d=Ct,Pe.n=ri)}while(!ft);return Mt!=Me.length&&Re?(Xe=Me,((tt=Mt)==null||tt>Xe.length)&&(tt=Xe.length),new ol(Xe.subarray(0,tt))):Me.subarray(0,Mt)}(Y.subarray($,-8),{i:2},new ol(((V=Y)[(W=V.length)-4]|V[W-3]<<8|V[W-2]<<16|V[W-1]<<24)>>>0))));var V,W,Y,$;const J=YB[z];if(!J)throw new Error(`Unhandled codec: ${z}`);const ie=new globalThis.DecompressionStream(J);return new Response(new Blob([R]).stream().pipeThrough(ie)).arrayBuffer().then(ge=>new Uint8Array(ge))}(I,A).then(R=>(function(z,V){z.readFields(kB,V)}(new M2(R),E),new KB[w](E.buffer))),C.then(R=>{for(let z=x.length-1;z>=0;z--)switch(x[z]){case"delta_filter":FB(R,S);break;case"zigzag_filter":BB(R);break;case"bitshuffle_filter":NB(R,w);break;default:throw new Ul(`Unhandled filter "${x[z]}"`)}return{layerName:m,blockIndex:P,data:R}}).catch(R=>{throw R})}))},gi(UI,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let my,P2,wc,Em,R2,Sm=null;function jI(){return Yn()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:P2||lr.DRACO_URL}function $I(){if(Yn()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Em)return Em;const l=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Em=WebAssembly.validate(l)?lr.MESHOPT_SIMD_URL:lr.MESHOPT_URL,Em}const gv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},QB={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},_y={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function qI(l,t,s){const c=s.json.bufferViews.length,m=s.buffers.length;t.bufferView=c,s.json.bufferViews[c]={buffer:m,byteLength:l.byteLength},s.buffers[m]=l}const D2="KHR_draco_mesh_compression";function eN(l,t){const s=l.extensions&&l.extensions[D2];if(!s)return;const c=new wc.Decoder,m=ZI(t,s.bufferView),h=new wc.Mesh;if(!c.DecodeArrayToMesh(m,m.byteLength,h))throw new Error("Failed to decode Draco mesh");const _=t.json.accessors[l.indices],w=gv[_.componentType],S=_.count*w.BYTES_PER_ELEMENT,P=wc._malloc(S);w===Uint16Array?c.GetTrianglesUInt16Array(h,S,P):c.GetTrianglesUInt32Array(h,S,P),qI(wc.memory.buffer.slice(P,P+S),_,t),wc._free(P);for(const x of Object.keys(s.attributes)){const A=c.GetAttributeByUniqueId(h,s.attributes[x]),I=t.json.accessors[l.attributes[x]],E=QB[I.componentType],C=I.count*_y[I.type]*gv[I.componentType].BYTES_PER_ELEMENT,R=wc._malloc(C);c.GetAttributeDataArrayForAllPoints(h,A,wc[E],C,R),qI(wc.memory.buffer.slice(R,R+C),I,t),wc._free(R)}c.destroy(),h.destroy(),delete l.extensions[D2]}const yv="EXT_meshopt_compression";function tN(l,t){if(!l.extensions||!l.extensions[yv])return;const s=l.extensions[yv],c=new Uint8Array(t.buffers[s.buffer],s.byteOffset||0,s.byteLength||0),m=new Uint8Array(s.count*s.byteStride);R2.decodeGltfBuffer(m,s.count,s.byteStride,c,s.mode,s.filter),l.buffer=t.buffers.length,l.byteOffset=0,t.buffers[l.buffer]=m.buffer,delete l.extensions[yv]}const HI=1179937895,GI=new TextDecoder("utf8");function WI(l,t){return new URL(l,t).href}function iN(l,t,s,c){return fetch(WI(l.uri,c)).then(m=>m.arrayBuffer()).then(m=>{t.buffers[s]=m})}function ZI(l,t){const s=l.json.bufferViews[t];return new Uint8Array(l.buffers[s.buffer],s.byteOffset||0,s.byteLength)}function rN(l,t,s,c){if(l.uri){const m=WI(l.uri,c);return fetch(m).then(h=>h.blob()).then(h=>createImageBitmap(h)).then(h=>{t.images[s]=h})}if(l.bufferView!==void 0){const m=ZI(t,l.bufferView),h=new Blob([m],{type:l.mimeType});return createImageBitmap(h).then(_=>{t.images[s]=_})}}function YI(l,t=0,s){const c={json:null,images:[],buffers:[]};if(new Uint32Array(l,t,1)[0]===HI){const x=new Uint32Array(l,t);let A=2;const I=(x[A++]>>2)-3,E=x[A++]>>2;if(A++,c.json=JSON.parse(GI.decode(x.subarray(A,A+E))),A+=E,A<I){const C=x[A++];A++;const R=t+(A<<2);c.buffers[0]=l.slice(R,R+C)}}else c.json=JSON.parse(GI.decode(new Uint8Array(l,t)));const{buffers:m,images:h,meshes:_,extensionsUsed:w,bufferViews:S}=c.json;let P=Promise.resolve();if(m){const x=[];for(let A=0;A<m.length;A++){const I=m[A];I.uri?x.push(iN(I,c,A,s)):c.buffers[A]||(c.buffers[A]=null)}P=Promise.all(x)}return P.then(()=>{const x=[],A=w&&w.includes(D2),I=w&&w.includes(yv);if(A&&x.push(function(){if(!wc)return my??(my=function(E){let C,R=null;function z(){C=new Uint8Array(R.buffer)}function V(){throw new Error("Unexpected Draco error.")}const W={a:{a:V,d:function(Y,$,J){return C.copyWithin(Y,$,$+J)},c:function(Y){const $=C.length,J=Math.max(Y>>>0,Math.ceil(1.2*$)),ie=Math.ceil((J-$)/65536);try{return R.grow(ie),z(),!0}catch{return!1}},b:V}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(E,W):E.then(Y=>Y.arrayBuffer()).then(Y=>WebAssembly.instantiate(Y,W))).then(Y=>{const{Rb:$,Qb:J,P:ie,T:ge,X:Pe,Ja:Me,La:Ce,Qa:$e,Va:Re,Wa:He,eb:Je,jb:Xe,f:tt,e:at,yb:ft,zb:nt,Ab:Mt,Bb:Ft,Db:Ct,Gb:si}=Y.instance.exports;R=at;const ri=(()=>{let Wt=0,Bt=0,wi=0,ai=0;return fi=>{wi&&($(ai),$(Wt),Bt+=wi,wi=Wt=0),Wt||(Bt+=128,Wt=J(Bt));const Wi=fi.length+7&-8;let hr=Wt;Wi>=Bt&&(wi=Wi,hr=ai=J(Wi));for(let pr=0;pr<fi.length;pr++)C[hr+pr]=fi[pr];return hr}})();return z(),tt(),{memory:at,_free:$,_malloc:J,Mesh:class{constructor(){this.ptr=ie()}destroy(){ge(this.ptr)}},Decoder:class{constructor(){this.ptr=Me()}destroy(){Xe(this.ptr)}DecodeArrayToMesh(Wt,Bt,wi){const ai=ri(Wt),fi=Ce(this.ptr,ai,Bt,wi.ptr);return!!Pe(fi)}GetAttributeByUniqueId(Wt,Bt){return{ptr:$e(this.ptr,Wt.ptr,Bt)}}GetTrianglesUInt16Array(Wt,Bt,wi){Re(this.ptr,Wt.ptr,Bt,wi)}GetTrianglesUInt32Array(Wt,Bt,wi){He(this.ptr,Wt.ptr,Bt,wi)}GetAttributeDataArrayForAllPoints(Wt,Bt,wi,ai,fi){Je(this.ptr,Wt.ptr,Bt.ptr,wi,ai,fi)}},DT_INT8:ft(),DT_UINT8:nt(),DT_INT16:Mt(),DT_UINT16:Ft(),DT_UINT32:Ct(),DT_FLOAT32:si()}})}(fetch(jI())),my.then(E=>{wc=E,my=void 0}))}()),I&&x.push(function(){if(R2)return;const E=function(C){let R;const z=WebAssembly.instantiateStreaming(C,{}).then(Y=>{R=Y.instance,R.exports.__wasm_call_ctors()}),V={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},W={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:z,supported:!0,decodeGltfBuffer(Y,$,J,ie,ge,Pe){(function(Me,Ce,$e,Re,He,Je,Xe){const tt=Me.exports.sbrk,at=Re+3&-4,ft=tt(at*He),nt=tt(Je.length),Mt=new Uint8Array(Me.exports.memory.buffer);Mt.set(Je,nt);const Ft=Ce(ft,Re,He,nt,Je.length);if(Ft===0&&Xe&&Xe(ft,at,He),$e.set(Mt.subarray(ft,ft+Re*He)),tt(ft-tt(0)),Ft!==0)throw new Error(`Malformed buffer data: ${Ft}`)})(R,R.exports[W[ge]],Y,$,J,ie,R.exports[V[Pe]])}}}(fetch($I()));return E.ready.then(()=>{R2=E})}()),h)for(let E=0;E<h.length;E++)x.push(rN(h[E],c,E,s));return(x.length?Promise.all(x):Promise.resolve()).then(()=>{if(A&&_)for(const{primitives:E}of _)for(const C of E)eN(C,c);if(I&&_&&S)for(const E of S)tN(E,c);return c})})}function Pf(l,t){const s=l.json.bufferViews[t.bufferView],c=gv[t.componentType];return new c(l.buffers[s.buffer],(t.byteOffset||0)+(s.byteOffset||0),t.count*(s.byteStride&&s.byteStride!==_y[t.type]*c.BYTES_PER_ELEMENT?s.byteStride/c.BYTES_PER_ELEMENT:_y[t.type]))}function O2(l,t,s,c){const m=gv[t.componentType],h=function(x){switch(x){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(m),_=l.json.bufferViews[t.bufferView],w=_.byteStride?_.byteStride/m.BYTES_PER_ELEMENT:_y[t.type],S=s.float32,P=S.length/s.capacity;for(let x=0,A=0;x<t.count*w;x+=w,A+=P)for(let I=0;I<P;I++)S[A+I]=c[x+I]*h;s._trim()}function nN(l,t,s){const c=l.indices,m=l.attributes,h={};h.indexArray=new Xs;const _=t.json.accessors[c],w=_.count/3;h.indexArray.reserve(w);const S=Pf(t,_);for(let I=0;I<w;I++)h.indexArray.emplaceBack(S[3*I],S[3*I+1],S[3*I+2]);h.indexArray._trim(),h.vertexArray=new kl;const P=t.json.accessors[m.POSITION];h.vertexArray.reserve(P.count);const x=Pf(t,P);for(let I=0;I<P.count;I++)h.vertexArray.emplaceBack(x[3*I],x[3*I+1],x[3*I+2]);if(h.vertexArray._trim(),h.aabb=new Ai(P.min,P.max),h.centroid=function(I,E){const C=[0,0,0],R=I.length;if(R>0){for(let z=0;z<R;z++){const V=3*I[z];C[0]+=E[V],C[1]+=E[V+1],C[2]+=E[V+2]}C[0]/=R,C[1]/=R,C[2]/=R}return C}(S,x),m.COLOR_0!==void 0){const I=t.json.accessors[m.COLOR_0],E=_y[I.type],C=Pf(t,I);h.colorArray=E===3?new kl:new Iu,h.colorArray.resize(I.count),O2(t,I,h.colorArray,C)}if(m.NORMAL!==void 0){h.normalArray=new kl;const I=t.json.accessors[m.NORMAL];h.normalArray.resize(I.count);const E=Pf(t,I);O2(t,I,h.normalArray,E)}if(m.TEXCOORD_0!==void 0&&s.length>0){h.texcoordArray=new Dh;const I=t.json.accessors[m.TEXCOORD_0];h.texcoordArray.resize(I.count);const E=Pf(t,I);O2(t,I,h.texcoordArray,E)}if(m._FEATURE_ID_RGBA4444!==void 0){const I=t.json.accessors[m._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(h.featureData=Pf(t,I))}m._FEATURE_RGBA4444!==void 0&&(h.featureData=new Uint32Array(Pf(t,t.json.accessors[m._FEATURE_RGBA4444]).buffer));const A=l.material;return h.material=function(I,E){const{emissiveFactor:C=[0,0,0],alphaMode:R="OPAQUE",alphaCutoff:z=.5,normalTexture:V,occlusionTexture:W,emissiveTexture:Y,doubleSided:$}=I,{baseColorFactor:J=[1,1,1,1],metallicFactor:ie=1,roughnessFactor:ge=1,baseColorTexture:Pe,metallicRoughnessTexture:Me}=I.pbrMetallicRoughness||{},Ce=W?E[W.index]:void 0;if(W&&W.extensions&&W.extensions.KHR_texture_transform&&Ce){const $e=W.extensions.KHR_texture_transform;Ce.offsetScale=[$e.offset[0],$e.offset[1],$e.scale[0],$e.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new zr(...J),metallicFactor:ie,roughnessFactor:ge,baseColorTexture:Pe?E[Pe.index]:void 0,metallicRoughnessTexture:Me?E[Me.index]:void 0},doubleSided:$,emissiveFactor:C,alphaMode:R,alphaCutoff:z,normalTexture:V?E[V.index]:void 0,occlusionTexture:Ce,emissionTexture:Y?E[Y.index]:void 0,defined:I.defined===void 0}}(A!==void 0?t.json.materials[A]:{defined:!1},s),h}function XI(l,t,s){const{matrix:c,rotation:m,translation:h,scale:_,mesh:w,extras:S,children:P}=l,x={};if(x.matrix=c||H.mat4.fromRotationTranslationScale([],m||[0,0,0,1],h||[0,0,0],_||[1,1,1]),w!==void 0){x.meshes=s[w];const A=x.anchor=[0,0];for(const I of x.meshes){const{min:E,max:C}=I.aabb;A[0]+=E[0]+C[0],A[1]+=E[1]+C[1]}A[0]=Math.floor(A[0]/x.meshes.length/2),A[1]=Math.floor(A[1]/x.meshes.length/2)}if(S&&(S.id&&(x.id=S.id),S.lights&&(x.lights=function(A){if(!A.length)return[];const I=function(V){const W=atob(V),Y=new Uint8Array(W.length);for(let $=0;$<W.length;$++)Y[$]=W.codePointAt($);return Y}(A),E=[],C=I.length/24,R=new Uint16Array(I.buffer),z=new Float32Array(I.buffer);for(let V=0;V<C;V++){const W=R[2*V*6]/30,Y=R[2*V*6+1]/30,$=R[2*V*6+10]/100,J=z[6*V+1],ie=z[6*V+2],ge=z[6*V+3],Pe=z[6*V+4],Me=ge-J,Ce=Pe-ie,$e=Math.hypot(Me,Ce);E.push({pos:[J+.5*Me,ie+.5*Ce,Y],normal:[Ce/$e,-Me/$e,0],width:$e,height:W,depth:$,points:[J,ie,ge,Pe]})}return E}(S.lights))),P){const A=[];for(const I of P)A.push(XI(t.json.nodes[I],t,s));x.children=A}return x}function sN(l){if(l.vertices.length===0||l.indices.length===0)return null;const t=new kw(l.vertices,l.indices,8,256),[s,c]=[t.min.clone(),t.max.clone()];return{vertices:l.vertices,indices:l.indices,grid:t,min:s,max:c}}function oN(l){if(!l.extras||!l.extras.ground)return null;const t=l.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;const s=t[0];if(!s||!Array.isArray(s)||s.length===0)return null;const c=[];for(const _ of s){if(!Array.isArray(_)||_.length!==2)continue;const w=_[0],S=_[1];typeof w=="number"&&typeof S=="number"&&c.push(new ve(w,S))}if(c.length<3)return null;c.length>1&&c[c.length-1].equals(c[0])&&c.pop();let m=0;for(let _=0;_<c.length;_++){const w=c[_],S=c[(_+1)%c.length],P=c[(_+2)%c.length];m+=(w.x-S.x)*(P.y-S.y)-(P.x-S.x)*(w.y-S.y)}m>0&&c.reverse();const h=Vg(c.flatMap(_=>[_.x,_.y]),[]);return h.length===0?null:{vertices:c,indices:h}}function aN(l,t){const s=[],c=[];let m=0;const h=[];for(const _ of l){m=s.length;const w=_.vertexArray.float32,S=_.indexArray.uint16;for(let P=0;P<_.vertexArray.length;P++)h[0]=w[3*P+0],h[1]=w[3*P+1],h[2]=w[3*P+2],H.vec3.transformMat4(h,h,t),s.push(new ve(h[0],h[1]));for(let P=0;P<3*_.indexArray.length;P++)c.push(S[P]+m)}if(c.length%3!=0)return null;for(let _=0;_<c.length;_+=3){const w=s[c[_+0]],S=s[c[_+1]],P=s[c[_+2]];(w.x-S.x)*(P.y-S.y)-(P.x-S.x)*(w.y-S.y)>0&&([c[_+1],c[_+2]]=[c[_+2],c[_+1]])}return{vertices:s,indices:c}}function KI(l){const t=function(S,P){const x=[],A=WebGL2RenderingContext;if(S.json.textures)for(const I of S.json.textures){const E={magFilter:A.LINEAR,minFilter:A.NEAREST,wrapS:A.REPEAT,wrapT:A.REPEAT};I.sampler!==void 0&&Object.assign(E,S.json.samplers[I.sampler]),x.push({image:P[I.source],sampler:E,uploaded:!1})}return x}(l,l.images),s=function(S,P){const x=[];for(const A of S.json.meshes){const I=[];for(const E of A.primitives)I.push(nN(E,S,P));x.push(I)}return x}(l,t),{scenes:c,scene:m,nodes:h}=l.json,_=c?c[m||0].nodes:h,w=[];for(const S of _)w.push(XI(h[S],l,s));return function(S,P,x){const A={},I=new Set;for(let E=0;E<S.length;E++){const C=x[P[E]];if(!C.extras)continue;const R=C.extras["mapbox:footprint:version"],z=C.extras["mapbox:footprint:id"];(R||z)&&I.add(E),R==="1.0.0"&&z&&(A[z]=E)}for(let E=0;E<S.length;E++){if(I.has(E))continue;const C=S[E],R=x[P[E]];if(!R.extras)continue;let z=null;C.id in A&&(z=aN(S[A[C.id]].meshes,C.matrix)),z||(z=oN(R)),z&&(C.footprint=sN(z))}if(I.size>0){const E=Array.from(I.values()).sort((C,R)=>C-R);for(let C=E.length-1;C>=0;C--)S.splice(E[C],1)}}(w,_,l.json.nodes),w}function lN(l){l.heightmap=new Float32Array(4096),l.heightmap.fill(-1);const t=l.vertexArray.float32,s=l.aabb.min[0]-1,c=l.aabb.min[1]-1,m=Cf/(l.aabb.max[0]-s+2),h=Cf/(l.aabb.max[1]-c+2);for(let _=0;_<t.length;_+=3){const w=t[_+2],S=(t[_+0]-s)*m|0,P=(t[_+1]-c)*h|0;w>l.heightmap[P*Cf+S]&&(l.heightmap[P*Cf+S]=w)}}function cN(l,t){const s={};s.indexArray=new Xs,s.indexArray.reserve(4*l.length),s.vertexArray=new kl,s.vertexArray.reserve(10*l.length),s.colorArray=new Iu,s.vertexArray.reserve(10*l.length);let c=0;for(const _ of l){const w=Math.min(10,Math.max(4,1.3*_.height))*t,S=[-_.normal[1],_.normal[0],0],P=Math.min(.29,.1*_.width/_.depth),x=_.width-2*_.depth*t*(P+.01),A=H.vec3.scaleAndAdd([],_.pos,S,x/2),I=H.vec3.scaleAndAdd([],_.pos,S,-x/2),E=[A[0],A[1],A[2]+_.height],C=[I[0],I[1],I[2]+_.height],R=H.vec3.scaleAndAdd([],_.normal,S,P);H.vec3.scale(R,R,w);const z=H.vec3.scaleAndAdd([],_.normal,S,-P);H.vec3.scale(z,z,w),H.vec3.add(R,A,R),H.vec3.add(z,I,z),A[2]+=.1,I[2]+=.1,s.vertexArray.emplaceBack(R[0],R[1],R[2]),s.vertexArray.emplaceBack(z[0],z[1],z[2]),s.vertexArray.emplaceBack(A[0],A[1],A[2]),s.vertexArray.emplaceBack(I[0],I[1],I[2]),s.vertexArray.emplaceBack(E[0],E[1],E[2]),s.vertexArray.emplaceBack(C[0],C[1],C[2]),s.vertexArray.emplaceBack(A[0],A[1],A[2]),s.vertexArray.emplaceBack(I[0],I[1],I[2]),s.vertexArray.emplaceBack(R[0],R[1],R[2]),s.vertexArray.emplaceBack(z[0],z[1],z[2]);const V=x/w/2;s.colorArray.emplaceBack(-V-P,-1,V,.8),s.colorArray.emplaceBack(V+P,-1,V,.8),s.colorArray.emplaceBack(-V,0,V,1.3),s.colorArray.emplaceBack(V,0,V,1.3),s.colorArray.emplaceBack(V+P,-.8,V,.7),s.colorArray.emplaceBack(V+P,-.8,V,.7),s.colorArray.emplaceBack(0,0,V,1.3),s.colorArray.emplaceBack(0,0,V,1.3),s.colorArray.emplaceBack(V+P,-1.2,V,.8),s.colorArray.emplaceBack(V+P,-1.2,V,.8),s.indexArray.emplaceBack(6+c,4+c,8+c),s.indexArray.emplaceBack(7+c,9+c,5+c),s.indexArray.emplaceBack(0+c,1+c,2+c),s.indexArray.emplaceBack(1+c,3+c,2+c),c+=10}const m={defined:!0,emissiveFactor:[0,0,0]},h={};return h.baseColorFactor=zr.white,m.pbrMetallicRoughness=h,s.material=m,s.aabb=new Ai([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),s}class JI{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){const c=t[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const uN=["id","tile","layer","source","sourceLayer","state"];class Am{constructor(t,s,c,m,h){this.type="Feature",this._vectorTileFeature=t,this._z=s,this._x=c,this._y=m,this.properties=t.properties,this.id=h}clone(){const t=new Am(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(t.state=Object.assign({},this.state)),this.layer&&(t.layer=Object.assign({},this.layer)),this.source&&(t.source=this.source),this.sourceLayer&&(t.sourceLayer=this.sourceLayer),t}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const s of uN)this[s]!==void 0&&(t[s]=this[s]);return t}}class QI{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Au(ii,16,0),this.featureIndexArray=new yf,this.promoteId=s,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(t,s,c,m,h,_=0,w=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,m,h,_);const P=this.grid;for(let x=0;x<s.length;x++){const A=s[x],I=[1/0,1/0,-1/0,-1/0];for(let E=0;E<A.length;E++){const C=A[E];I[0]=Math.min(I[0],C.x),I[1]=Math.min(I[1],C.y),I[2]=Math.max(I[2],C.x),I[3]=Math.max(I[3],C.y)}w!==0&&(I[0]-=w,I[1]-=w,I[2]+=w,I[3]+=w),I[0]<ii&&I[1]<ii&&I[2]>=0&&I[3]>=0&&P.insert(S,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new dm.VectorTile(new j1(this.rawTileData)).layers,this.sourceLayerCoder=new JI(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,s){const{tilespaceGeometry:c,transform:m,tileTransform:h,pixelPosMatrix:_,availableImages:w}=s;this.loadVTLayers(),this.serializedLayersCache.clear();const S=c.bufferedTilespaceBounds,P=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(E,C,R,z)=>Ye(c.bufferedTilespaceGeometry,E,C,R,z));P.sort(hN);let x=null;m.elevation&&P.length>0&&(x=vm.create(m.elevation,this.tileID));const A={};let I;for(let E=0;E<P.length;E++){const C=P[E];if(C===I)continue;I=C;const R=this.featureIndexArray.get(C);let z=null;this.is3DTile?this.loadMatchingModelFeature(A,R,t,c,m):this.loadMatchingFeature(A,R,t,w,(V,W,Y,$=0)=>(z||(z=k(V,this.tileID.canonical,h)),W.queryIntersectsFeature(c,V,Y,z,this.z,m,_,x,$)))}return A}loadMatchingFeature(t,s,c,m,h){const{featureIndex:_,bucketIndex:w,sourceLayerIndex:S,layoutVertexArrayOffset:P}=s,x=this.bucketLayerIDs[w],A=c.layers,I=Object.keys(A);if(I.length&&!function(V,W){for(let Y=0;Y<V.length;Y++)if(W.indexOf(V[Y])>=0)return!0;return!1}(I,x))return;const E=c.sourceCache,C=this.sourceLayerCoder.decode(S),R=this.vtLayers[C].feature(_),z=this.getId(R,C);for(let V=0;V<x.length;V++){const W=x[V];if(!A[W])continue;const{styleLayer:Y,targets:$}=A[W];let J={};z!==void 0&&(J=E.getFeatureState(Y.sourceLayer,z));const ie=!h||h(R,Y,J,P);if(!ie)continue;const ge=new Am(R,this.z,this.x,this.y,z);ge.tile=this.tileID.canonical,ge.state=J;let Pe=this.serializedLayersCache.get(W);Pe||(Pe=Y.serialize(),Pe.id=W,this.serializedLayersCache.set(W,Pe)),ge.source=Pe.source,ge.sourceLayer=Pe["source-layer"],ge.layer=Ki({},Pe),ge.layer.paint=eP(Pe.paint,Y.paint,R,J,m),ge.layer.layout=eP(Pe.layout,Y.layout,R,J,m);let Me=!1;for(const Ce of $){this.updateFeatureProperties(ge,Ce);const{filter:$e}=Ce;if($e){if(R.properties=ge.properties,$e.needGeometry){const Re=U(R,!0);if(!$e.filter(new bn(this.tileID.overscaledZ),Re,this.tileID.canonical))continue}else if(!$e.filter(new bn(this.tileID.overscaledZ),R))continue}Me=!0,Ce.targetId&&this.addFeatureVariant(ge,Ce)}Me&&this.appendToResult(t,W,_,ge,ie)}}loadMatchingModelFeature(t,s,c,m,h){const _=this.bucketLayerIDs[0][0],w=c.layers;if(!w[_])return;const{styleLayer:S,targets:P}=w[_];if(S.type!=="model")return;const x=m.tile,A=s.featureIndex,I=x.getBucket(S);if(!(I&&I instanceof cv))return;const E=function(Pe,Me,Ce,$e){const Re=Pe.getNodesInfo()[Me];if(Re.hiddenByReplacement||!Re.node.meshes)return;let He=Number.MAX_VALUE;const Je=Re.node,Xe=Ce.tile,tt=$e.calculatePosMatrix(Xe.tileID.toUnwrapped(),$e.worldSize),at=Re.evaluatedScale;let ft=0;$e.elevation&&Je.elevation&&(ft=Je.elevation*$e.elevation.exaggeration()),H.mat4.translate(tt,tt,[(Je.anchor?Je.anchor[0]:0)*(at[0]-1),(Je.anchor?Je.anchor[1]:0)*(at[1]-1),ft]),H.mat4.scale(tt,tt,at);const nt=Ce.queryGeometry,Mt=nt.isPointQuery()?nt.screenBounds:nt.screenGeometry,Ft=function(si){const ri=H.mat4.multiply([],tt,si.matrix);H.mat4.multiply(ri,$e.expandedFarZProjMatrix,ri);for(let Wt=0;Wt<si.meshes.length;++Wt){const Bt=si.meshes[Wt];if(Wt===si.lightMeshIndex)continue;const wi=JM(Mt,$e,ri,Bt.aabb);wi!=null&&(He=Math.min(wi,He))}if(si.children)for(const Wt of si.children)Ft(Wt)};if(Ft(Je),He===Number.MAX_VALUE)return;const Ct=new Vr(0,0);return uI(Xe.tileID.canonical,Ct,Re.node.anchor[0],Re.node.anchor[1]),{intersectionZ:He,position:Ct,feature:Re.feature}}(I,A,m,h);if(!E)return;const{z:C,x:R,y:z}=x.tileID.canonical,{feature:V,intersectionZ:W,position:Y}=E;let $={};V.id!==void 0&&($=c.sourceCache.getFeatureState(S.sourceLayer,V.id));const J=new Am({},C,R,z,V.id);J.tile=this.tileID.canonical,J.state=$,J.properties=V.properties,J.geometry={type:"Point",coordinates:[Y.lng,Y.lat]};let ie=this.serializedLayersCache.get(_);ie||(ie=S.serialize(),ie.id=_,this.serializedLayersCache.set(_,ie)),J.source=ie.source,J.sourceLayer=ie["source-layer"],J.layer=Ki({},ie);let ge=!1;for(const Pe of P){this.updateFeatureProperties(J,Pe);const{filter:Me}=Pe;if(Me){if(V.properties=J.properties,Me.needGeometry){if(!Me.filter(new bn(this.tileID.overscaledZ),V,this.tileID.canonical))continue}else if(!Me.filter(new bn(this.tileID.overscaledZ),V))continue}ge=!0,Pe.targetId&&this.addFeatureVariant(J,Pe)}ge&&this.appendToResult(t,_,A,J,W)}updateFeatureProperties(t,s,c){if(s.properties){const m={};for(const h in s.properties){const _=s.properties[h].evaluate({zoom:this.z},t._vectorTileFeature,t.state,t.tile,c);_!=null&&(m[h]=_)}t.properties=m}}addFeatureVariant(t,s,c){const m={target:s.target,namespace:s.namespace,uniqueFeatureID:s.uniqueFeatureID};s.properties&&(m.properties=t.properties),t.variants=t.variants||{},t.variants[s.targetId]=t.variants[s.targetId]||[],t.variants[s.targetId].push(m)}appendToResult(t,s,c,m,h){let _=t[s];_===void 0&&(_=t[s]=[]),_.push({featureIndex:c,feature:m,intersectionZ:h})}lookupSymbolFeatures(t,s,c,m,h){const _={};this.loadVTLayers();for(const w of t)this.loadMatchingFeature(_,{bucketIndex:s,sourceLayerIndex:c,featureIndex:w,layoutVertexArrayOffset:0},m,h);return _}loadFeature(t){const{featureIndex:s,sourceLayerIndex:c}=t;this.loadVTLayers();const m=this.sourceLayerCoder.decode(c),h=this.vtFeatures[m];if(h[s])return h[s];const _=this.vtLayers[m].feature(s);return h[s]=_,_}hasLayer(t){for(const s of this.bucketLayerIDs)for(const c of s)if(t===c)return!0;return!1}getId(t,s){let c=t.id;if(this.promoteId){const m=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[s];if(m!=null)if(Array.isArray(m)){if(!this.promoteIdExpression){const h=Eh(m);if(h.result!=="success"){const _=h.value.map(w=>`${w.key}: ${w.message}`).join(", ");return void Vi(`Failed to create expression for promoteId: ${_}`)}this.promoteIdExpression=h.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new jd),c=this.promoteIdExpression.evaluate({zoom:0},t)}else c=t.properties[m];typeof c=="boolean"&&(c=Number(c))}return c}}function eP(l,t,s,c,m){return nn(l,(h,_)=>{const w=t instanceof Mh?t.get(_):null;return w&&w.evaluate?w.evaluate(s,c,m):w})}function hN(l,t){return t-l}gi(QI,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const tP=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class L2{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,c]=new Uint8Array(t,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=c>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const h=tP[15&c];if(!h)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(t,2,1),[w]=new Uint32Array(t,4,1);return new L2(w,_,h,t)}constructor(t,s=64,c=Float64Array,m){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=c,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const h=tP.indexOf(this.ArrayType),_=2*t*this.ArrayType.BYTES_PER_ELEMENT,w=t*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-w%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${c}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+S,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+_+w+S),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+S,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=t)}add(t,s){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=t,this.coords[this._pos++]=s,c}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return k2(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,s,c,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:_,nodeSize:w}=this,S=[0,h.length-1,0],P=[];for(;S.length;){const x=S.pop()||0,A=S.pop()||0,I=S.pop()||0;if(A-I<=w){for(let z=I;z<=A;z++){const V=_[2*z],W=_[2*z+1];V>=t&&V<=c&&W>=s&&W<=m&&P.push(h[z])}continue}const E=I+A>>1,C=_[2*E],R=_[2*E+1];C>=t&&C<=c&&R>=s&&R<=m&&P.push(h[E]),(x===0?t<=C:s<=R)&&(S.push(I),S.push(E-1),S.push(1-x)),(x===0?c>=C:m>=R)&&(S.push(E+1),S.push(A),S.push(1-x))}return P}within(t,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:h,nodeSize:_}=this,w=[0,m.length-1,0],S=[],P=c*c;for(;w.length;){const x=w.pop()||0,A=w.pop()||0,I=w.pop()||0;if(A-I<=_){for(let z=I;z<=A;z++)rP(h[2*z],h[2*z+1],t,s)<=P&&S.push(m[z]);continue}const E=I+A>>1,C=h[2*E],R=h[2*E+1];rP(C,R,t,s)<=P&&S.push(m[E]),(x===0?t-c<=C:s-c<=R)&&(w.push(I),w.push(E-1),w.push(1-x)),(x===0?t+c>=C:s+c>=R)&&(w.push(E+1),w.push(A),w.push(1-x))}return S}}function k2(l,t,s,c,m,h){if(m-c<=s)return;const _=c+m>>1;iP(l,t,_,c,m,h),k2(l,t,s,c,_-1,1-h),k2(l,t,s,_+1,m,1-h)}function iP(l,t,s,c,m,h){for(;m>c;){if(m-c>600){const P=m-c+1,x=s-c+1,A=Math.log(P),I=.5*Math.exp(2*A/3),E=.5*Math.sqrt(A*I*(P-I)/P)*(x-P/2<0?-1:1);iP(l,t,s,Math.max(c,Math.floor(s-x*I/P+E)),Math.min(m,Math.floor(s+(P-x)*I/P+E)),h)}const _=t[2*s+h];let w=c,S=m;for(gy(l,t,c,s),t[2*m+h]>_&&gy(l,t,c,m);w<S;){for(gy(l,t,w,S),w++,S--;t[2*w+h]<_;)w++;for(;t[2*S+h]>_;)S--}t[2*c+h]===_?gy(l,t,c,S):(S++,gy(l,t,S,m)),S<=s&&(c=S+1),s<=S&&(m=S-1)}}function gy(l,t,s,c){z2(l,s,c),z2(t,2*s,2*c),z2(t,2*s+1,2*c+1)}function z2(l,t,s){const c=l[t];l[t]=l[s],l[s]=c}function rP(l,t,s,c){const m=l-s,h=t-c;return m*m+h*h}r.$=gg,r.A=Us,r.B=2,r.C=Jg,r.D=xm,r.E=Ml,r.F=mM,r.G=class extends av{},r.H=oa,r.I=S2,r.J=uh,r.K=u1,r.L=tf,r.M=ef,r.N=Up,r.O=Th,r.P=ve,r.Q=Xp,r.R=wr,r.S=a1,r.T=h2,r.U=Eh,r.V=av,r.W=Yt,r.X=Ei,r.Y=jt,r.Z=co,r._=rs,r.a=function(l){return lr.API_CDN_URL_REGEX.test(l)},r.a$=Am,r.a0=ng,r.a1=n1,r.a2=function(l){const t=l.value;let s=[];if(!t)return s;const c=oa(t);return c!=="string"?(s=s.concat([new av(l.key,t,`string expected, "${c}" found`)]),s):(eI(t,!0)||(s=s.concat([new av(l.key,t,`invalid url "${t}"`)])),s)},r.a3=gt,r.a4=Yp,r.a5=Bn,r.a6=Xt,r.a7=class{constructor(l){this.specification=l}possiblyEvaluate(l,t){return tr(l.expression.evaluate(t))}interpolate(l,t,s){return{x:Bi(l.x,t.x,s),y:Bi(l.y,t.y,s),z:Bi(l.z,t.z,s),azimuthal:Bi(l.azimuthal,t.azimuthal,s),polar:Bi(l.polar,t.polar,s)}}},r.a8=bn,r.a9=rf,r.aA=nl,r.aB=class{constructor(l){this.entries={},this.scheduler=l}request(l,t,s,c){const m=this.entries[l]=this.entries[l]||{callbacks:[]};if(m.result){const[h,_]=m.result;return this.scheduler?this.scheduler.add(()=>{c(h,_)},t):c(h,_),()=>{}}return m.callbacks.push(c),m.cancel||(m.cancel=s((h,_)=>{m.result=[h,_];for(const w of m.callbacks)this.scheduler?this.scheduler.add(()=>{w(h,_)},t):w(h,_);setTimeout(()=>delete this.entries[l],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(h=>h!==c),m.callbacks.length||(m.cancel(),delete this.entries[l]))}}},r.aC=Ll,r.aD=function(l,t,s){const c=JSON.stringify(l.request);return l.data&&(this.deduped.entries[c]={result:[null,l.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom},m=>{const h=On(l.request,(_,w,S,P)=>{_?m(_):w&&m(null,{vectorTile:s?void 0:new dm.VectorTile(new j1(w)),rawData:w,cacheControl:S,expires:P})});return()=>{h.cancel(),m()}},t)},r.aE=function(l){li++,li>pt&&(l.getActor().send("enforceCacheSizeLimit",We),li=0)},r.aF=function(l){return l<=1?1:Math.pow(2,Math.floor(Math.log(l)/Math.LN2))},r.aG=Gt,r.aH=UM,r.aI=WM,r.aJ=VM,r.aK=function(l,t){const s=document.createElement("video");s.muted=!0,s.onloadstart=function(){t(null,s)};for(let c=0;c<l.length;c++){const m=document.createElement("source");_s(l[c])||(s.crossOrigin="Anonymous"),m.src=l[c],s.appendChild(m)}return{cancel:()=>{}}},r.aL=iv,r.aM=function(l){return fetch(l).then(t=>t.arrayBuffer()).then(t=>YI(t,0,l))},r.aN=KI,r.aO=class{constructor(l,t,s,c){this.id=l,this.position=t!=null?new Vr(t[0],t[1]):new Vr(0,0),this.orientation=s??[0,0,0],this.nodes=c,this.uploaded=!1,this.aabb=new Ai([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(l,t){if(H.mat4.multiply(l.matrix,t,l.matrix),l.meshes)for(const s of l.meshes){const c=Ai.applyTransformFast(s.aabb,l.matrix);this.aabb.encapsulate(c)}if(l.children)for(const s of l.children)this._applyTransformations(s,l.matrix)}computeBoundsAndApplyParent(){const l=H.mat4.identity([]);for(const t of this.nodes)this._applyTransformations(t,l)}computeModelMatrix(l,t,s,c,m,h,_=!1){sI(this.matrix,this,l.transform,this.position,t,s,c,m,h,_)}upload(l){if(!this.uploaded){for(const t of this.nodes)_2(t,l);for(const t of this.nodes)lv(t);this.uploaded=!0}}destroy(){for(const l of this.nodes)g2(l)}},r.aP=kr,r.aQ=ty,r.aR=$o,r.aS=Ks,r.aT=_c,r.aU=Xs,r.aV=Rr,r.aW=Rg,r.aX=ev,r.aY=function(){la.isLoading()||la.isLoaded()||Wp()!=="deferred"||af()},r.aZ=h1,r.a_=U,r.aa=a,r.ab=H,r.ac=yi,r.ad=Mh,r.ae=Oo,r.af=Bi,r.ag=ii,r.ah=Pa,r.ai=Et,r.aj=zr,r.ak=class{constructor(l){this.specification=l}possiblyEvaluate(l,t){return function([s,c]){const m=tr([1,s,c]);return{x:m.x,y:m.y,z:m.z}}(l.expression.evaluate(t))}interpolate(l,t,s){return{x:Bi(l.x,t.x,s),y:Bi(l.y,t.y,s),z:Bi(l.z,t.z,s)}}},r.al=function(l,t,s=0,c=!0){const m=new ve(s,s),h=l.sub(m),_=t.add(m),w=[h,new ve(_.x,h.y),_,new ve(h.x,_.y)];return c&&w.push(h.clone()),w},r.am=function(l,t){const s=[];for(let c=0;c<l.length;c++){const m=zi(c-1,-1,l.length-1),h=zi(c+1,-1,l.length-1),_=l[c],w=l[h],S=l[m].sub(_).unit(),P=w.sub(_).unit(),x=P.angleWithSep(S.x,S.y),A=S.add(P).unit().mult(-1*t/Math.sin(x/2));s.push(_.add(A))}return s},r.an=AM,r.ao=Ye,r.ap=function(l,t,s=0){return H.vec3.fromValues(((t.x-s)*l.scale-l.x)*ii,(t.y*l.scale-l.y)*ii,P1(t.z,t.y))},r.aq=er,r.ar=qC,r.as=function(l){let t=1/0,s=1/0,c=-1/0,m=-1/0;for(const h of l)t=Math.min(t,h.x),s=Math.min(s,h.y),c=Math.max(c,h.x),m=Math.max(m,h.y);return{min:new ve(t,s),max:new ve(c,m)}},r.at=Bl,r.au=Ne,r.av=g,r.aw=Ut,r.ax=So,r.ay=function(l,t){const s={};for(let c=0;c<t.length;c++){const m=t[c];m in l&&(s[m]=l[m])}return s},r.az=Zc,r.b=function(l){return lr.API_FONTS_REGEX.test(l)},r.b$=sv,r.b0=xn,r.b1=qw,r.b2=Lw,r.b3=k,r.b4=mc,r.b5=Ig,r.b6=Oi,r.b7=ts,r.b8=Vg,r.b9=l2,r.bA=wC,r.bB=i2,r.bC=wM,r.bD=Qw,r.bE=L2,r.bF=zi,r.bG=Dn,r.bH=Ao,r.bI=function(l,t,s){l[4*t+0]=s[0],l[4*t+1]=s[1],l[4*t+2]=s[2],l[4*t+3]=s[3]},r.bJ=Ef,r.bK=Da,r.bL=Oh,r.bM=ss,r.bN=wf,r.bO=Vr,r.bP=RM,r.bQ=Dt,r.bR=Nr,r.bS=YM,r.bT=kt,r.bU=fo,r.bV=function(l,t,s,c,m,h,_,w,S){if(S.name==="globe")return fo(l,t,new kt(s,c,m),!1);const P=ty({z:s,x:c,y:m},S);return new Ai([(h+P.x/P.scale)*t,t*(P.y/P.scale),_],[(h+P.x2/P.scale)*t,t*(P.y2/P.scale),w])},r.bW=function(l,t,s){let c=0;for(let m=0;m<2;++m)l[m]>0&&(c+=(l[m]-0)*(l[m]-0)),t[m]<0&&(c+=(0-t[m])*(0-t[m]));return c},r.bX=is,r.bY=M1,r.bZ=function(l){const t=H.mat4.identity(new Float64Array(16));H.mat4.multiply(t,l.pixelMatrix,l.globeMatrix);const s=[0,ca,0],c=[0,ua,0];return H.vec3.transformMat4(s,s,t),H.vec3.transformMat4(c,c,t),[s[0]>0&&s[0]<=l.width&&s[1]>0&&s[1]<=l.height&&!La(l,new Vr(l.center.lat,90)),c[0]>0&&c[0]<=l.width&&c[1]>0&&c[1]<=l.height&&!La(l,new Vr(l.center.lat,-90))]},r.b_=function(l,t){const{scale:s}=l.tileTransform,c=s*ii/(l.tileSize*Math.pow(2,t.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return H.mat2.scale(new Float32Array(4),t.inverseAdjustmentMatrix,[c,c])},r.ba=function(l,t){const s=Oo(t.zoom);if(s===0)return gs(l);const c=Vn(l),m=pn(c),h=Bl(c.getWest())*t.worldSize,_=Bl(c.getEast())*t.worldSize,w=nl(c.getNorth())*t.worldSize,S=nl(c.getSouth())*t.worldSize,P=[h,w,0],x=[_,w,0],A=[h,S,0],I=[_,S,0],E=H.mat4.invert([],t.globeMatrix);return H.vec3.transformMat4(P,P,E),H.vec3.transformMat4(x,x,E),H.vec3.transformMat4(A,A,E),H.vec3.transformMat4(I,I,E),m[0]=ys(m[0],A,s),m[1]=ys(m[1],I,s),m[2]=ys(m[2],x,s),m[3]=ys(m[3],P,s),Ai.fromPoints(m)},r.bb=ks,r.bc=on,r.bd=ys,r.be=Rh,r.bf=Di,r.bg=I2,r.bh=j1,r.bi=On,r.bj=function(l){const t=[];for(const s in l)t.push(l[s]);return t},r.bk=function(l,t){const s=[];for(const c in l)c in t||s.push(c);return s},r.bl=Ni,r.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.bn=Ie,r.bo=function(l,t){const{x:s,y:c}=l.point,m=qo(s,c,l.worldSize/l._pixelsPerMercatorPixel,0,0);return H.mat4.multiply(m,m,ln(gs(t)))},r.bp=fm,r.bq=sl,r.br=U1,r.bs=function(l,t,s,c,m){const h=5*t+2;l.float32[h+0]=s,l.float32[h+1]=c,l.float32[h+2]=m},r.bt=Q1,r.bu=pM,r.bv=te,r.bw=mo,r.bx=_C,r.by=QM,r.bz=bC,r.c=br,r.c$=(l,t,s,c,m,h,_,w)=>{const S=l.transform,P=S.pitch<15?HC(.07,.7,Ut((14-S.zoom)/5,0,1)):.07,x=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:WC(l,t,s,c),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:S.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:m,u_width_scale:h,u_floor_width_scale:_,u_image:0,u_tile_units_to_pixels:GC(t,S),u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toRenderColor(x?null:s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength"),u_zbias_factor:P,u_tile_to_meter:i(t.tileID.canonical,0)}},r.c0=ZM,r.c1=function(l){const t=ZM(l,!0);return H.mat2.invert([],[t[0],t[1],t[4],t[5]])},r.c2=Pr,r.c3=function(l){const{x:t,y:s}=l.point,{lng:c,lat:m}=l._center;return qo(t,s,l.worldSize,c,m)},r.c4=It,r.c5=Jt,r.c6=Lh,r.c7=function(l){const t=Math.round((l+45+360)%360/90)%4;return $t[t]},r.c8=45,r.c9=cm,r.cA=class extends Fl{constructor(l){super(l),this.current=Og}set(l,t,s){if(this.fetchUniformLocation(l,t)){for(let c=0;c<9;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}},r.cB=Kt,r.cC=function(l,t,s){const c=Oo(s.zoom),m=l.style.map._antialias,h=l.terrain&&l.terrain.exaggeration()>0;return c===0&&!m&&!h},r.cD=function(l){const t=l.pixelsPerMeter,s=t/Ao(1,l.center.lat),c=H.mat4.identity(new Float64Array(16));return H.mat4.translate(c,c,[l.point.x,l.point.y,0]),H.mat4.scale(c,c,[s,s,t]),Float32Array.from(c)},r.cE=Vn,r.cF=function(l){const t=is-5;l=Ut(l,-t,t)/t*90;const s=Math.pow(Math.abs(Math.sin(Et(l))),3);return Math.round(s*(lm.length-1))},r.cG=function(l,t,s,c){const m=t.getNorth(),h=t.getSouth(),_=t.getWest(),w=t.getEast(),S=1<<l.z,P=w-_,x=m-h,A=P/kh,I=-x/lm[s],E=[0,A,0,I,0,0,m,_,0];if(l.z>0){const C=180/c;H.mat3.multiply(E,E,[C/P+1,0,0,0,C/x+1,0,-.5*C/A,.5*C/I,1])}return E[2]=S,E[5]=l.x,E[8]=l.y,E},r.cH=gs,r.cI=function(l,t,s){const c=H.mat4.identity(new Float64Array(16)),m=(t/(1<<l)-.5)*Math.PI*2;return H.mat4.rotateY(c,s.globeMatrix,m),Float32Array.from(c)},r.cJ=class{isDataAvailableAtPoint(l){const t=this._source();if(this.isUsingMockSource()||!t||l.y<0||l.y>1)return!1;const s=t.getSource().maxzoom,c=1<<s,m=Math.floor(l.x),h=Math.floor((l.x-m)*c),_=Math.floor(l.y*c),w=this.findDEMTileFor(new Gt(s,m,s,h,_));return!(!w||!w.dem)}getAtPointOrZero(l,t=0){return this.getAtPoint(l,t)||0}getAtPoint(l,t,s=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);const c=this._source();if(!c||l.y<0||l.y>1)return t;const m=c.getSource().maxzoom,h=1<<m,_=Math.floor(l.x),w=l.x-_,S=new Gt(m,_,m,Math.floor(w*h),Math.floor(l.y*h)),P=this.findDEMTileFor(S);if(!P||!P.dem)return t;const x=P.dem,A=1<<P.tileID.canonical.z,I=(w*A-P.tileID.canonical.x)*x.dim,E=(l.y*A-P.tileID.canonical.y)*x.dim,C=Math.floor(I),R=Math.floor(E);return(s?this.exaggeration():1)*Bi(Bi(x.get(C,R),x.get(C,R+1),E-R),Bi(x.get(C+1,R),x.get(C+1,R+1),E-R),I-C)}getAtTileOffset(l,t,s){const c=1<<l.canonical.z;return this.getAtPointOrZero(new a(l.wrap+(l.canonical.x+t/ii)/c,(l.canonical.y+s/ii)/c))}getAtTileOffsetFunc(l,t,s,c){return m=>{const h=this.getAtTileOffset(l,m.x,m.y),_=c.upVector(l.canonical,m.x,m.y),w=c.upVectorScale(l.canonical,t,s).metersToTile;return H.vec3.scale(_,_,h*w),_}}getForTilePoints(l,t,s,c){if(this.isUsingMockSource())return!1;const m=vm.create(this,l,c);return!!m&&(t.forEach(h=>{h[2]=this.exaggeration()*m.getElevationAt(h[0],h[1],s)}),!0)}getMinMaxForTile(l){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(l);if(!t||!t.dem)return null;const s=t.dem.tree,c=t.tileID,m=1<<l.canonical.z-c.canonical.z;let h=l.canonical.x/m-c.canonical.x,_=l.canonical.y/m-c.canonical.y,w=0;for(let S=0;S<l.canonical.z-c.canonical.z&&!s.leaves[w];S++){h*=2,_*=2;const P=2*Math.floor(_)+Math.floor(h);w=s.childOffsets[w]+P,h%=1,_%=1}return{min:this.exaggeration()*s.minimums[w],max:this.exaggeration()*s.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(l,t,s){throw new Error("Pure virtual method called.")}pointCoordinate(l){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(l){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const l=this.visibleDemTiles;if(l.length===0)return null;let t=!1,s=Number.MAX_VALUE,c=Number.MIN_VALUE;for(const m of l){const h=this.getMinMaxForTile(m.tileID);h&&(s=Math.min(s,h.min),c=Math.max(c,h.max),t=!0)}return t?{min:s,max:c}:null}},r.cK=YA,r.cL=Mr,r.cM=function(l,t){return[Math.pow(l[0],2.2)*t,Math.pow(l[1],2.2)*t,Math.pow(l[2],2.2)*t]},r.cN=Oa,r.cO=or,r.cP=vr,r.cQ=256,r.cR=function(l,t){const s=[0,0,0],c=ks(gs(t.canonical));return H.vec3.transformMat4(s,s,c),H.vec3.transformMat4(s,s,l),s},r.cS=l=>({u_camera_to_center_distance:new ss(l),u_extrude_scale:new Lg(l),u_device_pixel_ratio:new ss(l),u_matrix:new Ef(l),u_inv_rot_matrix:new Ef(l),u_merc_center:new Da(l),u_tile_id:new Oh(l),u_zoom_transition:new ss(l),u_up_dir:new Oh(l),u_emissive_strength:new ss(l)}),r.cT=l=>({u_matrix:new Ef(l),u_pixels_to_tile_units:new Lg(l),u_device_pixel_ratio:new ss(l),u_width_scale:new ss(l),u_floor_width_scale:new ss(l),u_units_to_pixels:new Da(l),u_dash_image:new wf(l),u_gradient_image:new wf(l),u_image_height:new ss(l),u_texsize:new Da(l),u_tile_units_to_pixels:new ss(l),u_alpha_discard_threshold:new ss(l),u_trim_offset:new Da(l),u_trim_fade_range:new Da(l),u_trim_color:new Tf(l),u_emissive_strength:new ss(l),u_zbias_factor:new ss(l),u_tile_to_meter:new ss(l)}),r.cU=l=>({u_matrix:new Ef(l),u_texsize:new Da(l),u_pixels_to_tile_units:new Lg(l),u_device_pixel_ratio:new ss(l),u_width_scale:new ss(l),u_floor_width_scale:new ss(l),u_image:new wf(l),u_units_to_pixels:new Da(l),u_tile_units_to_pixels:new ss(l),u_alpha_discard_threshold:new ss(l),u_trim_offset:new Da(l),u_trim_fade_range:new Da(l),u_trim_color:new Tf(l),u_emissive_strength:new ss(l),u_zbias_factor:new ss(l),u_tile_to_meter:new ss(l)}),r.cV=Eg,r.cW=mF,r.cX=_F,r.cY=Bh,r.cZ=(l,t,s,c,m,h)=>{const _=l.transform,w=_.projection.name==="globe";let S;if(h.paint.get("circle-pitch-alignment")==="map")if(w){const x=Oa(_.zoom,t.canonical)*_._pixelsPerMercatorPixel;S=Float32Array.from([x,0,0,x])}else S=_.calculatePixelsToTileUnitsMatrix(s);else S=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const P={u_camera_to_center_distance:l.transform.getCameraToCenterDistance(_.projection),u_matrix:l.translatePosMatrix(t.projMatrix,s,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ze.devicePixelRatio,u_extrude_scale:S,u_inv_rot_matrix:zu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:h.paint.get("circle-emissive-strength")};if(w){P.u_inv_rot_matrix=c,P.u_merc_center=m,P.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],P.u_zoom_transition=Oo(_.zoom);const x=m[0]*ii,A=m[1]*ii;P.u_up_dir=_.projection.upVector(new kt(0,0,0),x,A)}return P},r.c_=ZC,r.ca=Tf,r.cb=function(l,t,s){const c=Math.sqrt(l*l+t*t+s*s),m=c>0?Math.acos(s/c)*qe:0;let h=l!==0||t!==0?Math.atan2(-t,-l)*qe+90:0;return h<0&&(h+=360),[c,h,m]},r.cc=i,r.cd=Ai,r.ce=tr,r.cf=function(l){return[Math.pow(l[0],1/2.2),Math.pow(l[1],1/2.2),Math.pow(l[2],1/2.2)]},r.cg=function(l,t){return l.readFields(aB,{icons:[]},t)},r.ch=function(l){return l({pluginStatus:Uo,pluginURL:jc}),Sh.on("pluginStateChange",l),l},r.ci=uv,r.cj=mm,r.ck=e2,r.cl=Vs,r.cm=pg,r.cn=Ze,r.co=Do,r.cp=Ar,r.cq=function(l){const t=l.indexOf(Jp);return t>=0?l.slice(0,t):l},r.cr=function(l){return l.indexOf(Jp)>=0},r.cs=function(l){const t=l.indexOf(Jp);return t>=0?l.slice(t+1):""},r.ct=function(l){const t=[],s=l.id;return s===void 0&&t.push({message:`layers.${s}: missing required property "id"`}),l.render===void 0&&t.push({message:`layers.${s}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},r.cu=function(l,t,s,c){return l.type==="custom"?new WF(l,t):new nB[l.type](l,t,s,c)},r.cv=Ts,r.cw=class extends Am{constructor(l,t){super(l._vectorTileFeature,l._z,l._x,l._y,l.id),l.state&&(this.state=Object.assign({},l.state)),this.target=t.target,this.namespace=t.namespace,t.properties&&(this.properties=t.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=l.source,this.sourceLayer=l.sourceLayer,this.layer=l.layer)}toJSON(){const l=super.toJSON();return l.target=this.target,l.namespace=this.namespace,l}},r.cx=Sh,r.cy=An,r.cz=S1,r.d=function(l){return lr.API_TILEJSON_REGEX.test(l)},r.d$=QI,r.d0=(l,t,s,c,m,h,_,w,S)=>{const P=l.transform,x=P.calculatePixelsToTileUnitsMatrix(t),A=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none",I=P.pitch<15?HC(.07,.7,Ut((14-P.zoom)/5,0,1)):.07;return{u_matrix:WC(l,t,s,c),u_pixels_to_tile_units:x,u_device_pixel_ratio:h,u_width_scale:_,u_floor_width_scale:w,u_units_to_pixels:[1/P.pixelsToGLUnits[0],1/P.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:m,u_texsize:YC(s)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:GC(t,l.transform),u_alpha_discard_threshold:0,u_trim_offset:S,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toRenderColor(A?null:s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength"),u_zbias_factor:I,u_tile_to_meter:i(t.tileID.canonical,0)}},r.d1=Yr,r.d2=Ng,r.d3=kC,r.d4=ci,r.d5=V1,r.d6=Vh,r.d7=450,r.d8=7,r.d9=GF,r.dA=Li,r.dB=f,r.dC=Ou,r.dD=function([l,t,s]){const c=Math.hypot(l,t,s),m=Math.atan2(l,s),h=.5*Math.PI-Math.acos(-t/c);return new Vr(It(m),It(h))},r.dE=f2,r.dF=function(l){const t=l.navigator?l.navigator.userAgent:null;return!!function(s){if($n==null){const c=s.navigator?s.navigator.userAgent:null;$n=!!s.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return $n}(l)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.dG=function(l,t){We=l,pt=t},r.dH=La,r.dI=Nl,r.dJ=function(l){const t=[0,0,0],s=H.mat4.identity(new Float64Array(16));return H.mat4.multiply(s,l.pixelMatrix,l.globeMatrix),H.vec3.transformMat4(t,t,s),new ve(t[0],t[1])},r.dK=function(l,t,s=!1){if(Uo===of||Uo===Gp||Uo===fg)throw new Error("setRTLTextPlugin cannot be called multiple times.");jc=ze.resolveURL(l),Uo=of,Ol=t,mg(),s||af()},r.dL=Wp,r.dM=function(){uv().acquire(v2)},r.dN=function(){const l=cy;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(v2),cy=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.dO=If,r.dP=function(l){const t=qt();if(!t)return;const s=t.delete(rt);l&&s.catch(l).then(()=>l())},r.dQ=ly,r.dR=jI,r.dS=function(l){P2=ze.resolveURL(l),Sm||(Sm=new xm(uv(),new Ml)),Sm.broadcast("setDracoUrl",P2)},r.dT=$I,r.dU=function(l){Em=ze.resolveURL(l),Sm||(Sm=new xm(uv(),new Ml)),Sm.broadcast("setMeshoptUrl",Em)},r.dV=gi,r.dW=Nh,r.dX=vc,r.dY=dm,r.dZ=class{constructor(l,t){this.pos=l,this.dir=t}intersectsPlane(l,t,s){const c=H.vec2.dot(t,this.dir);if(Math.abs(c)<1e-6)return!1;const m=((l[0]-this.pos[0])*t[0]+(l[1]-this.pos[1])*t[1])/c;return s[0]=this.pos[0]+this.dir[0]*m,s[1]=this.pos[1]+this.dir[1]*m,!0}},r.d_=JI,r.da=qr,r.db=Pg,r.dc=256,r.dd=ln,r.de=kl,r.df=Hc,r.dg=im,r.dh=function(l,t,s,c,m){return Ut((l-t)/(s-t)*(m-c)+c,c,m)},r.di=Np,r.dj=Fh,r.dk=class{constructor(l,t,s,c){this.context=l,this.format=c,this.size=s,this.texture=l.gl.createTexture();const[m,h,_]=this.size,{gl:w}=l;w.bindTexture(w.TEXTURE_3D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),w.texImage3D(w.TEXTURE_3D,0,this.format,m,h,_,0,c2(this.format),u2(this.format),t.data)}bind(l,t){const{context:s}=this,{gl:c}=s;c.bindTexture(c.TEXTURE_3D,this.texture),l!==this.minFilter&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MAG_FILTER,l),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MIN_FILTER,l),this.minFilter=l),t!==this.wrapS&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_S,t),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_T,t),this.wrapS=t)}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}},r.dl=p2,r.dm=[1,1,1],r.dn=vm,r.dp=ym,r.dq=qc,r.dr=Dh,r.ds=Lu,r.dt=rm,r.du=zl,r.dv=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new ve(1/0,1/0),max:new ve(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(l,t=!1){const s=yC(new ve(0,0),new ve(ii,ii),l),c=[];if(t&&!Nw(s,this._globalClipBounds))return c;for(const m of this._activeRegions){if(m.hiddenByOverlap||!Nw(s,m))continue;const h=j4(m.min,m.max,l);c.push({min:h.min,max:h.max,sourceId:this._sourceIds[m.priority],footprint:m.footprint,footprintTileId:m.tileId,order:m.order,clipMask:m.clipMask,clipScope:m.clipScope})}return c}setSources(l){this._setSources(l.map(t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const s=[];for(const c of t.cache.getVisibleCoordinates()){const m=t.cache.getTile(c).buckets[t.layer];m&&m.updateFootprints(c.toUnwrapped(),s)}return s},getOrder:()=>t.order,getClipMask:()=>t.clipMask,getClipScope:()=>t.clipScope})))}_addSource(l){const t=l.getFootprints();if(t.length===0)return;const s=l.getOrder(),c=l.getClipMask(),m=l.getClipScope();for(const h of t){if(!h.footprint)continue;const _=yC(h.footprint.min,h.footprint.max,h.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:h.id,footprint:h.footprint,order:s,clipMask:c,clipScope:m})}this._sourceIds.push(l.getSourceId())}_computeReplacement(){this._activeRegions.sort((t,s)=>t.priority-s.priority||B1(t.min,s.min)||B1(t.max,s.max)||t.order-s.order||t.clipMask-s.clipMask||function(c,m){const h=(_,w)=>_+w;return c.length-m.length||c.reduce(h,"").localeCompare(m.reduce(h,""))}(t.clipScope,s.clipScope));let l=this._activeRegions.length!==this._prevRegions.length;if(!l){let t=0;for(;!l&&t!==this._activeRegions.length;){const s=this._activeRegions[t],c=this._prevRegions[t];l=s.priority!==c.priority||!gC(s,c)||s.order!==c.order||s.clipMask!==c.clipMask||!Ie(s.clipScope,c.clipScope),++t}}if(l){++this._updateTime;for(const s of this._activeRegions)s.order!==F1&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,s.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,s.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,s.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,s.max.y));const t=s=>{const c=this._activeRegions;if(s>=c.length)return s;const m=c[s].priority;for(;s<c.length&&c[s].priority===m;)++s;return s};if(this._sourceIds.length>1){let s=0,c=t(s);for(;s!==c;){let m=s;const h=s;for(;m!==c;){const _=this._activeRegions[m];_.hiddenByOverlap=!1;for(let w=0;w<h;w++){const S=this._activeRegions[w];if(!S.hiddenByOverlap&&_.order===F1&&Nw(_,S)&&(_.hiddenByOverlap=xC(_.footprint,_.tileId,S.footprint,S.tileId),_.hiddenByOverlap))break}++m}s=c,c=t(s)}}}}_setSources(l){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=l.length-1;t>=0;t--)this._addSource(l[t]);this._computeReplacement()}},r.dw=class{constructor(l){this._createGrid(l),this._createPoles(l)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const l of this._poleSegments)l.destroy();for(const l of this._gridSegments)l.withSkirts.destroy(),l.withoutSkirts.destroy()}_fillGridMeshWithLods(l,t){const s=new mc,c=new Xs,m=[],h=l+1+2,_=t[0]+1,w=t[0]+1+(1+t.length),S=(P,x,A)=>{let I=P===h-1?P-2:P===0?P:P-1;return I+=A?24575:0,[I,x]};for(let P=0;P<h;++P)s.emplaceBack(...S(P,0,!0));for(let P=0;P<_;++P)for(let x=0;x<h;++x)s.emplaceBack(...S(x,P,(x===0||x===h-1)&&!0));for(let P=0;P<t.length;++P){const x=t[P];for(let A=0;A<h;++A)s.emplaceBack(...S(A,x,!0))}for(let P=0;P<t.length;++P){const x=c.length,A=t[P]+1+2,I=new Xs;for(let R=0;R<A-1;R++){const z=R===A-2,V=z?h*(w-t.length+P-R):h;for(let W=0;W<h-1;W++){const Y=R*h+W;R===0||z||W===0||W===h-2?(I.emplaceBack(Y+1,Y,Y+V),I.emplaceBack(Y+V,Y+V+1,Y+1)):(c.emplaceBack(Y+1,Y,Y+V),c.emplaceBack(Y+V,Y+V+1,Y+1))}}const E=ts.simpleSegment(0,x,s.length,c.length-x);for(let R=0;R<I.uint16.length;R+=3)c.emplaceBack(I.uint16[R],I.uint16[R+1],I.uint16[R+2]);const C=ts.simpleSegment(0,x,s.length,c.length-x);m.push({withoutSkirts:E,withSkirts:C})}return{vertices:s,indices:c,segments:m}}_createGrid(l){const t=this._fillGridMeshWithLods(kh,lm);this._gridSegments=t.segments,this._gridBuffer=l.createVertexBuffer(t.vertices,Oi.members),this._gridIndexBuffer=l.createIndexBuffer(t.indices,!0)}_createPoles(l){const t=new Xs;for(let _=0;_<=kh;_++)t.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=l.createIndexBuffer(t,!0);const s=new Hc,c=new Hc,m=new Hc,h=new Hc;this._poleSegments=[];for(let _=0,w=0;_<Lh;_++){const S=360/(1<<_);s.emplaceBack(0,-So,0,.5,0),c.emplaceBack(0,-So,0,.5,1),m.emplaceBack(0,-So,0,.5,.5),h.emplaceBack(0,-So,0,.5,.5);for(let P=0;P<=kh;P++){let x=P/kh,A=0;const I=Bi(0,S,x),[E,C,R]=zh(ku,Vl,I,So);s.emplaceBack(E,C,R,x,A),c.emplaceBack(E,C,R,x,1-A);const z=Et(I);x=.5+.5*Math.sin(z),A=.5+.5*Math.cos(z),m.emplaceBack(E,C,R,x,A),h.emplaceBack(E,C,R,x,1-A)}this._poleSegments.push(ts.simpleSegment(w,0,66,64)),w+=66}this._poleNorthVertexBuffer=l.createVertexBuffer(s,qi,!1),this._poleSouthVertexBuffer=l.createVertexBuffer(c,qi,!1),this._texturedPoleNorthVertexBuffer=l.createVertexBuffer(m,qi,!1),this._texturedPoleSouthVertexBuffer=l.createVertexBuffer(h,qi,!1)}getGridBuffers(l,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[l].withSkirts:this._gridSegments[l].withoutSkirts]}getPoleBuffers(l,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[l]]}},r.dx=F1,r.dy=ti,r.dz=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.e=lr,r.e0=UC,r.e1=nn,r.e2=Ra,r.e3=_M,r.e4=function(l,t,s,c,m,h,_,w,S,P,x=1,A,I){l.createArrays(),l.tilePixelRatio=ii/(512*l.overscaling),l.compareText={},l.iconsNeedLinear=!1;const E=l.layers[0].layout,C=l.layers[0]._unevaluatedLayout._values,R={};R.scaleFactor=x,R.textSizeScaleRange=E.get("text-size-scale-range"),R.iconSizeScaleRange=E.get("icon-size-scale-range");const[z,V]=R.textSizeScaleRange,[W,Y]=R.iconSizeScaleRange;if(R.textScaleFactor=Ut(R.scaleFactor,z,V),R.iconScaleFactor=Ut(R.scaleFactor,W,Y),l.textSizeData.kind==="composite"){const{minZoom:ge,maxZoom:Pe}=l.textSizeData;R.compositeTextSizes=[C["text-size"].possiblyEvaluate(new bn(ge),w),C["text-size"].possiblyEvaluate(new bn(Pe),w)]}if(l.iconSizeData.kind==="composite"){const{minZoom:ge,maxZoom:Pe}=l.iconSizeData;R.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new bn(ge),w),C["icon-size"].possiblyEvaluate(new bn(Pe),w)]}R.layoutTextSize=C["text-size"].possiblyEvaluate(new bn(S+1),w),R.layoutIconSize=C["icon-size"].possiblyEvaluate(new bn(S+1),w),R.textMaxSize=C["text-size"].possiblyEvaluate(new bn(18),w);const $=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point",J=E.get("text-size");let ie=!1;for(const ge of l.features)if(ge.icon&&ge.icon.nameSecondary){ie=!0;break}for(const ge of l.features){const Pe=E.get("text-font").evaluate(ge,{},w).join(","),Me=J.evaluate(ge,{},w)*R.textScaleFactor,Ce=R.layoutTextSize.evaluate(ge,{},w)*R.textScaleFactor,$e=(R.layoutIconSize.evaluate(ge,{},w),{horizontal:{},vertical:void 0}),Re=ge.text;let He,Je=[0,0];if(Re){const at=Re.toString(),ft=E.get("text-letter-spacing").evaluate(ge,{},w)*mo,nt=E.get("text-line-height").evaluate(ge,{},w)*mo,Mt=mw(at)?ft:0,Ft=E.get("text-anchor").evaluate(ge,{},w),Ct=E.get("text-variable-anchor");if(!Ct){const wi=E.get("text-radial-offset").evaluate(ge,{},w);Je=wi?wM(Ft,[wi*mo,t2]):E.get("text-offset").evaluate(ge,{},w).map(ai=>ai*mo)}let si=$?"center":E.get("text-justify").evaluate(ge,{},w);const ri=E.get("symbol-placement")==="point",Wt=ri?E.get("text-max-width").evaluate(ge,{},w)*mo:1/0,Bt=wi=>{l.allowVerticalPlacement&&cg(at)&&($e.vertical=Jw(Re,t,s,m,Pe,Wt,nt,Ft,wi,Mt,Je,sl.vertical,!0,Ce,Me))};if(!$&&Ct){const wi=si==="auto"?Ct.map(fi=>i2(fi)):[si];let ai=!1;for(let fi=0;fi<wi.length;fi++){const Wi=wi[fi];if(!$e.horizontal[Wi])if(ai)$e.horizontal[Wi]=$e.horizontal[0];else{const hr=Jw(Re,t,s,m,Pe,Wt,nt,"center",Wi,Mt,Je,sl.horizontal,!1,Ce,Me);hr&&($e.horizontal[Wi]=hr,ai=hr.positionedLines.length===1)}}Bt("left")}else{if(si==="auto"&&(si=i2(Ft)),ri||E.get("text-writing-mode").indexOf("horizontal")>=0||!cg(at)){const wi=Jw(Re,t,s,m,Pe,Wt,nt,Ft,si,Mt,Je,sl.horizontal,!1,Ce,Me);wi&&($e.horizontal[si]=wi)}Bt(ri?"left":si)}}let Xe=!1;if(ge.icon&&ge.icon.namePrimary){const at=Ww(l.iconSizeData,C["icon-size"],w,l.zoom,ge)*R.iconScaleFactor*A,ft=ge.icon.getPrimary().scaleSelf(at).serialize(),nt=c[ft];nt&&(He=AF(m[ft],ge.icon.nameSecondary?m[ge.icon.getSecondary().scaleSelf(at).serialize()]:void 0,E.get("icon-offset").evaluate(ge,{},w),E.get("icon-anchor").evaluate(ge,{},w)),Xe=nt.sdf,l.sdfIcons===void 0?l.sdfIcons=nt.sdf:l.sdfIcons!==nt.sdf&&Vi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(nt.pixelRatio!==l.pixelRatio||E.get("icon-rotate").constantOr(1)!==0)&&(l.iconsNeedLinear=!0))}const tt=EM($e.horizontal)||$e.vertical;l.iconsInText||(l.iconsInText=!!tt&&tt.iconsInText),(tt||He)&&OF(l,ge,$e,He,c,R,Ce,0,Je,Xe,_,w,P,I,ie)}h&&l.generateCollisionDebugBuffers(S,l.collisionBoxArray,R.textScaleFactor)},r.e5=_v,r.e6=Ee,r.e7=dC,r.e8=tM,r.e9=D,r.ea=function(l){let t=0;if(new Uint32Array(l,0,1)[0]!==HI){const s=new Uint32Array(l,0,7),[,,c,m,h,_]=s;t=s.byteLength+m+h+_+h,(c!==l.byteLength||t>=l.byteLength)&&Vi("Invalid b3dm header information.")}return YI(l,t)},r.eb=function(l,t){const s=KI(l);for(const c of s){for(const m of c.meshes)lN(m);c.lights&&(c.lightMeshIndex=c.meshes.length,c.meshes.push(cN(c.lights,t)))}return s},r.ec=cv,r.ed=hI,r.ee=la,r.ef=function(l){Ht(),dt!=null&&dt.then(t=>{t.keys().then(s=>{for(let c=0;c<s.length-l;c++)t.delete(s[c])})})},r.f=function(l){return l.indexOf("mapbox:")===0},r.g=function(l,t){return An(Ki(l,{method:"GET"}),t)},r.h=Pi,r.i=function(l){return lr.API_STYLE_REGEX.test(l)&&!br(l)},r.j=function(l){return decodeURIComponent(atob(l).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))},r.k=function(l){return btoa(encodeURIComponent(l).replace(/%([0-9A-F]{2})/g,(t,s)=>String.fromCharCode(+("0x"+s))))},r.l=Ki,r.m=pi,r.n=function(l,t){return An(Ki(l,{type:"json"}),t)},r.o=Rc,r.p=function(l,t){return An(Ki(l,{method:"POST"}),t)},r.q=ze,r.r=ro,r.s=function(l){try{const t=self[l];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=we,r.u=function(){return function l(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,l)}()},r.v=function(l){return!!l&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(l)},r.w=Vi,r.x=function(){return x2||(x2=new If),x2},r.y=Dc,r.z=Ia}),y(["./shared"],function(r){function D(ot){const ee=ot?ot.url.toString():void 0;return ee?performance.getEntriesByName(ee):[]}function B(ot){if(typeof ot=="number"||typeof ot=="boolean"||typeof ot=="string"||ot==null)return JSON.stringify(ot);if(Array.isArray(ot)){let de="[";for(const we of ot)de+=`${B(we)},`;return`${de}]`}let ee="{";for(const de of Object.keys(ot).sort())ee+=`${de}:${B(ot[de])},`;return`${ee}}`}function F(ot){let ee="";for(const de of r.bm)(ot.type!=="model"||de!=="minzoom"&&de!=="maxzoom")&&(ee+=`/${B(ot[de])}`);return ee}class N{constructor(ee){this.keyCache={},this._layers={},this._layerConfigs={},ee&&this.replace(ee)}replace(ee,de){this._layerConfigs={},this._layers={},this.update(ee,[],de)}update(ee,de,we){this._options=we;for(const Le of ee)this._layerConfigs[Le.id]=Le,(this._layers[Le.id]=r.cu(Le,this.scope,null,this._options)).compileFilter(we),this.keyCache[Le.id]&&delete this.keyCache[Le.id];for(const Le of de)delete this.keyCache[Le],delete this._layerConfigs[Le],delete this._layers[Le];this.familiesBySource={};const ze=function(Le,Ze){const rt={};for(let pt=0;pt<Le.length;pt++){const lt=Le[pt];let dt=Ze&&Ze[lt.id];!dt&&(dt=F(lt),lt.type==="line"&&lt.paint)&&function qt(Ht){return typeof Ht=="string"&&Ht==="line-progress"||(Array.isArray(Ht)?Ht.some(qt):!(!Ht||typeof Ht!="object")&&Object.values(Ht).some(qt))}(lt.paint["line-width"])&&(dt+=`/${B(lt.paint["line-width"])}`),Ze&&(Ze[lt.id]=dt);let St=rt[dt];St||(St=rt[dt]=[]),St.push(lt)}const We=[];for(const pt in rt)We.push(rt[pt]);return We}(r.bj(this._layerConfigs),this.keyCache);for(const Le of ze){const Ze=Le.map(St=>this._layers[St.id]),rt=Ze[0];if(rt.visibility==="none")continue;const We=rt.source||"";let pt=this.familiesBySource[We];pt||(pt=this.familiesBySource[We]={});const lt=rt.sourceLayer||"_geojsonTileLayer";let dt=pt[lt];dt||(dt=pt[lt]=[]),dt.push(Ze)}}}const Q=1*r.dX;class q{constructor(ee){const de={},we=[];for(const rt in ee){const We=ee[rt],pt=de[rt]={};for(const lt in We.glyphs){const dt=We.glyphs[+lt];if(!dt||dt.bitmap.width===0||dt.bitmap.height===0)continue;const St=dt.metrics.localGlyph?Q:1,qt={x:0,y:0,w:dt.bitmap.width+2*St,h:dt.bitmap.height+2*St};we.push(qt),pt[lt]=qt}}const{w:ze,h:Le}=r.F(we),Ze=new r.dW({width:ze||1,height:Le||1});for(const rt in ee){const We=ee[rt];for(const pt in We.glyphs){const lt=We.glyphs[+pt];if(!lt||lt.bitmap.width===0||lt.bitmap.height===0)continue;const dt=de[rt][pt],St=lt.metrics.localGlyph?Q:1;r.dW.copy(lt.bitmap,Ze,{x:0,y:0},{x:dt.x+St,y:dt.y+St},lt.bitmap)}}this.image=Ze,this.positions=de}}r.dV(q,"GlyphAtlas");const X="3d_elevation_id",G="hd_road_elevation";class ae{constructor(){this._valid=!1}reset(ee){return this.feature=ee,this._valid=!0,this._geometry=ee.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(ee,de){return this._valid&&ee(de(this._geometry)),this}require(ee,de,we){return this.get(ee,!0,de,we)}optional(ee,de,we){return this.get(ee,!1,de,we)}success(){return this._valid}get(ee,de,we,ze){const Le=this.feature.properties.hasOwnProperty(ee)?+this.feature.properties[ee]:void 0;return this._valid&&Le!==void 0?we(ze?ze(Le):Le):de&&(this._valid=!1),this}}class xe{constructor(ee,de){this.featureFunc=ee,this.vertexFunc=de}parseFeature(ee,de,we){return this.featureFunc(ee,de,we)}parseVertex(ee,de,we){return this.vertexFunc(ee,de,we)}}const Te=new xe((ot,ee,de)=>ot.reset(ee).require(X,we=>{de.id=we}).optional("fixed_height_relative",we=>{de.constantHeight=we},ne.decodeRelativeHeight).geometry(we=>{de.bounds=we},ne.computeBounds).success(),(ot,ee,de)=>ot.reset(ee).require(X,we=>{de.id=we}).require("elevation_idx",we=>{de.idx=we}).require("extent",we=>{de.extent=we}).require("height_relative",we=>{de.height=we},ne.decodeRelativeHeight).geometry(we=>{de.position=we},ne.getPoint).success()),fe=new xe((ot,ee,de)=>ot.reset(ee).require(X,we=>{de.id=we}).optional("fixed_height",we=>{de.constantHeight=we},ne.decodeMetricHeight).geometry(we=>{de.bounds=we},ne.computeBounds).success(),(ot,ee,de)=>ot.reset(ee).require(X,we=>{de.id=we}).require("elevation_idx",we=>{de.idx=we}).require("extent",we=>{de.extent=we}).require("height",we=>{de.height=we},ne.decodeMetricHeight).geometry(we=>{de.position=we},ne.getPoint).success());class ne{static computeBounds(ee){const de=new r.P(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),we=new r.P(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const ze of ee[0])de.x>ze.x&&(de.x=ze.x),de.y>ze.y&&(de.y=ze.y),we.x<ze.x&&(we.x=ze.x),we.y<ze.y&&(we.y=ze.y);return{min:de,max:we}}static getPoint(ee){return r.ab.vec2.fromValues(ee[0][0].x,ee[0][0].y)}static decodeRelativeHeight(ee){return 1e-4*ee*5}static decodeMetricHeight(ee){return 1e-4*ee}static parse(ee){const de=[],we=[],ze=ee.length,Le=new ae;for(let rt=0;rt<ze;rt++){const We=ee.feature(rt),pt=We.properties.hasOwnProperty("version")?String(We.properties.version):void 0,lt=(Ze=pt)?Ze==="1.0.1"?fe:void 0:Te;if(lt===void 0){r.w(`Unknown elevation feature version number ${pt||"(unknown)"}`);continue}const dt=We.properties.hasOwnProperty("type")?We.properties.type:void 0;if(dt){if(r.dY.VectorTileFeature.types[We.type]==="Point"&&dt==="curve_point"){const St={};lt.parseVertex(Le,We,St)&&de.push(St)}else if(r.dY.VectorTileFeature.types[We.type]==="Polygon"&&dt==="curve_meta"){const St={};lt.parseFeature(Le,We,St)&&we.push(St)}}}var Ze;return{vertices:de,features:we}}}class ue{constructor(ee,de,we,ze,Le,Ze){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=ee,this.heightRange={min:we,max:we},this.safeArea=de,this.constantHeight=we,this.constantHeight==null&&(this.constantHeight!=null||ze.length!==0)){this.vertices=ze,this.edges=Le,this.edges=this.edges.filter(rt=>rt.a<this.vertices.length&&rt.b<this.vertices.length&&!r.ab.vec2.exactEquals(this.vertices[rt.a].position,this.vertices[rt.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const rt of this.vertices)this.vertexProps.push({dir:r.ab.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,rt.height),this.heightRange.max=Math.max(this.heightRange.max,rt.height);for(const rt of this.edges){const We=this.vertices[rt.a].position,pt=this.vertices[rt.b].position,lt=r.ab.vec2.subtract(r.ab.vec2.create(),pt,We),dt=r.ab.vec2.length(lt),St=r.ab.vec2.scale(r.ab.vec2.create(),lt,1/dt);this.edgeProps.push({vec:lt,dir:St,len:dt});const qt=this.vertexProps[rt.a].dir,Ht=this.vertexProps[rt.b].dir;r.ab.vec2.add(qt,qt,St),r.ab.vec2.add(Ht,Ht,St)}for(const rt of this.vertexProps)rt.dir[0]===0&&rt.dir[1]===0||r.ab.vec2.normalize(rt.dir,rt.dir);this.tessellate(Ze)}}pointElevation(ee){if(this.constantHeight!=null)return this.constantHeight;const de=this.getClosestEdge(ee);if(de==null)return 0;const[we,ze]=de;return(1-(Le=ze))*this.vertices[this.edges[we].a].height+Le*this.vertices[this.edges[we].b].height;var Le}getClosestEdge(ee){if(this.edges.length===0)return;let de=0,we=Number.POSITIVE_INFINITY,ze=0;const Le=r.ab.vec2.fromValues(ee.x,ee.y);for(let Ze=0;Ze<this.edges.length;Ze++){const rt=this.edges[Ze],We=this.edgeProps[Ze].dir,pt=new r.dZ(Le,this.edgeProps[Ze].dir),lt=this.vertices[rt.a].position,dt=this.vertices[rt.b].position,St=r.ab.vec2.create(),qt=r.ab.vec2.create(),Ht=pt.intersectsPlane(lt,this.vertexProps[rt.a].dir,St),li=pt.intersectsPlane(dt,this.vertexProps[rt.b].dir,qt);if(!Ht||!li)continue;const pi=r.ab.vec2.subtract(r.ab.vec2.create(),qt,St),bi=r.ab.vec2.subtract(r.ab.vec2.create(),Le,St),Mi=r.ab.vec2.dot(pi,pi),dr=Mi>0?r.ab.vec2.dot(bi,pi)/Mi:0,fr=r.aw(dr,0,1),Gi=Math.abs((dr-fr)*this.edgeProps[Ze].len),_r=r.ab.vec2.subtract(r.ab.vec2.create(),Le,lt),wr=Gi+Math.abs(r.ab.vec2.dot(_r,r.ab.vec2.fromValues(We[1],-We[0])));wr<we&&(de=Ze,we=wr,ze=fr)}return[de,ze]}tessellate(ee){for(let de=this.edges.length-1;de>=0;--de){const we=this.edges[de].a,ze=this.edges[de].b,{position:Le,height:Ze,extent:rt}=this.vertices[we],{position:We,height:pt,extent:lt}=this.vertices[ze],dt=this.vertexProps[we].dir,St=this.vertexProps[ze].dir,qt=r.ab.vec3.fromValues(Le[0]/ee,Le[1]/ee,Ze),Ht=r.ab.vec3.fromValues(We[0]/ee,We[1]/ee,pt),li=r.ab.vec3.fromValues(dt[1],-dt[0],0);r.ab.vec3.scale(li,li,rt);const pi=r.ab.vec3.fromValues(St[1],-St[0],0);if(r.ab.vec3.scale(pi,pi,lt),this.distSqLines(r.ab.vec3.fromValues(qt[0]+.5*li[0],qt[1]+.5*li[1],qt[2]+.5*li[2]),r.ab.vec3.fromValues(Ht[0]-.5*pi[0],Ht[1]-.5*pi[1],Ht[2]-.5*pi[2]),r.ab.vec3.fromValues(qt[0]-.5*li[0],qt[1]-.5*li[1],qt[2]-.5*li[2]),r.ab.vec3.fromValues(Ht[0]+.5*pi[0],Ht[1]+.5*pi[1],Ht[2]+.5*pi[2]))<=.05*.05)continue;const bi=this.vertices.length,Mi=r.ab.vec2.add(r.ab.vec2.create(),Le,We);this.vertices.push({position:r.ab.vec2.scale(Mi,Mi,.5),height:.5*(Ze+pt),extent:.5*(rt+lt)});const dr=r.ab.vec2.add(r.ab.vec2.create(),dt,St);this.vertexProps.push({dir:r.ab.vec2.normalize(dr,dr)}),this.edges.splice(de,1),this.edgeProps.splice(de,1),this.edges.push({a:we,b:bi}),this.edges.push({a:bi,b:ze});const fr=r.ab.vec2.subtract(r.ab.vec2.create(),this.vertices[bi].position,Le),Gi=r.ab.vec2.length(fr),_r={vec:fr,dir:r.ab.vec2.scale(r.ab.vec2.create(),fr,1/Gi),len:Gi};this.edgeProps.push(_r),this.edgeProps.push(_r)}}distSqLines(ee,de,we,ze){const Le=r.ab.vec3.subtract(r.ab.vec3.create(),de,ee),Ze=r.ab.vec3.subtract(r.ab.vec3.create(),ze,we),rt=r.ab.vec3.subtract(r.ab.vec3.create(),ee,we),We=r.ab.vec3.dot(Le,Le),pt=r.ab.vec3.dot(Le,Ze),lt=r.ab.vec3.dot(Le,rt),dt=r.ab.vec3.dot(Ze,Ze),St=r.ab.vec3.dot(Ze,rt),qt=We*dt-pt*pt;if(qt===0){const Mi=r.ab.vec3.dot(rt,Ze)/r.ab.vec3.dot(Ze,Ze),dr=r.ab.vec3.lerp(r.ab.vec3.create(),we,ze,Mi);return r.ab.vec3.squaredDistance(dr,ee)}const Ht=(pt*St-lt*dt)/qt,li=(We*St-pt*lt)/qt,pi=r.ab.vec3.lerp(r.ab.vec3.create(),ee,de,Ht),bi=r.ab.vec3.lerp(r.ab.vec3.create(),we,ze,li);return r.ab.vec3.squaredDistance(pi,bi)}}class ye{static parseFrom(ee,de){const we=ne.parse(ee);if(!we)return[];let{vertices:ze,features:Le}=we;const Ze=1/r.cc(de);Le.sort((lt,dt)=>lt.id-dt.id),ze.sort((lt,dt)=>lt.id-dt.id||lt.idx-dt.idx),ze=ze.filter((lt,dt,St)=>dt===St.findIndex(qt=>qt.id===lt.id&&qt.idx===lt.idx));const rt=new Array;let We=0;const pt=ze.length;for(const lt of Le){if(lt.constantHeight){rt.push(new ue(lt.id,lt.bounds,lt.constantHeight));continue}for(;We!==pt&&ze[We].id<lt.id;)We++;if(We===pt||ze[We].id!==lt.id)continue;const dt=new Array,St=new Array,qt=We;for(;We!==pt&&ze[We].id===lt.id;){const Ht=ze[We];if(dt.push({position:Ht.position,height:Ht.height,extent:Ht.extent}),We!==qt&&ze[We-1].idx===Ht.idx-1){const li=We-qt;St.push({a:li-1,b:li})}We++}rt.push(new ue(lt.id,lt.bounds,void 0,dt,St,Ze))}return rt}}r.dV(ue,"ElevationFeature");class le{constructor(ee){this.tileID=new r.aG(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.tileZoom=ee.tileZoom,this.uid=ee.uid,this.zoom=ee.zoom,this.lut=ee.lut,this.canonical=ee.tileID.canonical,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.scope=ee.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ee.showCollisionBoxes,this.collectResourceTiming=!!ee.request&&ee.request.collectResourceTiming,this.promoteId=ee.promoteId,this.isSymbolTile=ee.isSymbolTile,this.tileTransform=r.aQ(ee.tileID.canonical,ee.projection),this.projection=ee.projection,this.worldview=ee.worldview,this.localizableLayerIds=ee.localizableLayerIds,this.brightness=ee.brightness,this.extraShadowCaster=!!ee.extraShadowCaster,this.tessellationStep=ee.tessellationStep,this.scaleFactor=ee.scaleFactor}parse(ee,de,we,ze,Le){this.status="parsing",this.data=ee,this.collisionBoxArray=new r.aW;const Ze=new r.d_(Object.keys(ee.layers).sort()),rt=new r.d$(this.tileID,this.promoteId);rt.bucketLayerIDs=[];const We={},pt=new r.e0(256,256),lt={featureIndex:rt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:pt,availableImages:we,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},dt=de.familiesBySource[this.source];for(const Mi in dt){const dr=ee.layers[Mi];if(!dr)continue;let fr=!1,Gi=!1,_r=!1;for(const An of dt[Mi])An[0].type==="symbol"?fr=!0:Gi=!0,An[0].is3D()&&An[0].type!=="model"&&(_r=!0);if(this.extraShadowCaster&&!_r||this.isSymbolTile===!0&&!fr||this.isSymbolTile===!1&&!Gi)continue;dr.version===1&&r.w(`Vector tile source "${this.source}" layer "${Mi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const wr=Ze.encode(Mi),ki=[];let Vs=!1;for(let An=0,On=0;An<dr.length;An++){const _s=dr.feature(An),ra=rt.getId(_s,Mi);if(this.localizableLayerIds&&this.localizableLayerIds.has(Mi)){const io=_s.properties?_s.properties.worldview:null;if(this.worldview&&typeof io=="string")if(io==="all")_s.properties.$localized=!0;else{if(!io.split(",").includes(this.worldview))continue;_s.properties.$localized=!0,_s.properties.worldview=this.worldview}}!Vs&&_s.properties&&_s.properties.hasOwnProperty(X)&&(Vs=!0),ki.push({feature:_s,id:ra,index:On,sourceLayerIndex:wr}),On++}Vs&&ee.layers.hasOwnProperty(G)&&(lt.elevationFeatures=ye.parseFrom(ee.layers[G],this.canonical));for(const An of dt[Mi]){const On=An[0];(!this.extraShadowCaster||On.is3D()&&On.type!=="model")&&(this.isSymbolTile!==void 0&&On.type==="symbol"!==this.isSymbolTile||On.minzoom&&this.zoom<Math.floor(On.minzoom)||On.maxzoom&&this.zoom>=On.maxzoom||On.visibility!=="none"&&(re(An,this.zoom,lt.brightness,we),(We[On.id]=On.createBucket({index:rt.bucketLayerIDs.length,layers:An,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:wr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(ki,lt,this.tileID.canonical,this.tileTransform),rt.bucketLayerIDs.push(An.map(_s=>r.aC(_s.id,_s.scope)))))}}let St,qt,Ht,li;pt.trim();const pi={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},bi=()=>{if(St)return this.status="done",Le(St);if(this.extraShadowCaster)this.status="done",Le(null,{buckets:r.bj(We).filter(Mi=>!Mi.isEmpty()),featureIndex:rt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:lt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(qt&&Ht&&li){const Mi=new q(qt),dr=new r.e3(Ht,li,this.lut);for(const fr in We){const Gi=We[fr];Gi instanceof r.aX?(re(Gi.layers,this.zoom,lt.brightness,we),r.e4(Gi,qt,Mi.positions,Ht,dr.iconPositions,this.showCollisionBoxes,we,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.pixelRatio,this.brightness)):Gi.hasPattern&&(Gi instanceof r.b1||Gi instanceof r.b2||Gi instanceof r.d5)&&(re(Gi.layers,this.zoom,lt.brightness,we),Gi.addFeatures(lt,this.tileID.canonical,dr.patternPositions,we,this.tileTransform,this.brightness))}this.status="done",Le(null,{buckets:r.bj(We).filter(fr=>!fr.isEmpty()),featureIndex:rt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Mi.image,lineAtlas:pt,imageAtlas:dr,brightness:lt.brightness})}};if(!this.extraShadowCaster){const Mi=r.e1(lt.glyphDependencies,Gi=>Object.keys(Gi).map(Number));Object.keys(Mi).length?ze.send("getGlyphs",{uid:this.uid,stacks:Mi,scope:this.scope},(Gi,_r)=>{St||(St=Gi,qt=_r,bi())},void 0,!1,pi):qt={};const dr=Object.keys(lt.iconDependencies);dr.length?ze.send("getImages",{icons:dr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Gi,_r)=>{if(St)return;St=Gi;const wr={};Object.values(_r).some(ki=>ki.usvg)?this.rasterize(ze,wr,_r,lt.iconDependencies,()=>{Ht=wr,bi()}):(this.fillImageMap(wr,lt.iconDependencies,_r),Ht=wr,bi())},void 0,!1,pi):Ht={};const fr=Object.keys(lt.patternDependencies);fr.length?ze.send("getImages",{icons:fr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Gi,_r)=>{if(!St){St=Gi;const wr={};Object.values(_r).some(ki=>ki.usvg)?this.rasterize(ze,wr,_r,lt.patternDependencies,()=>{li=wr,bi()}):(this.fillImageMap(wr,lt.patternDependencies,_r),li=wr,bi())}},void 0,!1,pi):li={}}bi()}fillImageMap(ee,de,we){for(const ze in we){const Le=de[ze]||[];for(const Ze of Le)we[Ze.id].usvg||(ee[Ze.serialize()]=we[Ze.id])}}getImageTaskQueue(ee,de,we){const ze={};for(const Le in de){const Ze=we[Le]||[];for(const rt of Ze){const We=rt.serialize();de[rt.id].usvg?ze[We]||(ze[We]=rt):ee[We]=de[rt.id]}}return ze}rasterize(ee,de,we,ze,Le){const Ze=this.getImageTaskQueue(de,we,ze);this.rasterizeTask=ee.send("rasterizeImages",{scope:this.scope,imageTasks:Ze},(rt,We)=>{if(!rt)for(const pt in We){const{id:lt}=r.e2.deserializeFromString(pt);de[pt]=Object.assign({},we[lt],{data:We[pt]})}Le()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function re(ot,ee,de,we){const ze=new r.a8(ee,{brightness:de});for(const Le of ot)Le.recalculate(ze,we)}class oe extends r.E{constructor(ee,de,we,ze,Le,Ze){super(),this.actor=ee,this.layerIndex=de,this.availableImages=we,this.loadVectorData=Le||r.aD,this.loading={},this.loaded={},this.deduped=new r.aB(ee.scheduler),this.isSpriteLoaded=ze,this.scheduler=ee.scheduler,this.brightness=Ze}loadTile(ee,de){const we=ee.uid,ze=ee&&ee.request,Le=ze&&ze.collectResourceTiming,Ze=this.loading[we]=new le(ee);Ze.abort=this.loadVectorData(ee,(rt,We)=>{const pt=!this.loading[we];if(delete this.loading[we],Ze.cancelRasterize(),pt||rt||!We)return Ze.status="done",pt||(this.loaded[we]=Ze),de(rt);const lt=We.rawData,dt={};We.expires&&(dt.expires=We.expires),We.cacheControl&&(dt.cacheControl=We.cacheControl),Ze.vectorTile=We.vectorTile||new r.dY.VectorTile(new r.bh(lt));const St=()=>{Ze.parse(Ze.vectorTile,this.layerIndex,this.availableImages,this.actor,(qt,Ht)=>{if(qt||!Ht)return de(qt);const li={};if(Le){const pi=D(ze);pi.length>0&&(li.resourceTiming=JSON.parse(JSON.stringify(pi)))}de(null,r.l({rawTileData:lt.slice(0)},Ht,dt,li))})};this.isSpriteLoaded?St():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(St,{type:"parseTile",isSymbolTile:ee.isSymbolTile,zoom:ee.tileZoom}):St()}),this.loaded=this.loaded||{},this.loaded[we]=Ze})}reloadTile(ee,de){const we=this.loaded,ze=ee.uid;if(we&&we[ze]){const Le=we[ze];Le.scaleFactor=ee.scaleFactor,Le.showCollisionBoxes=ee.showCollisionBoxes,Le.projection=ee.projection,Le.brightness=ee.brightness,Le.tileTransform=r.aQ(ee.tileID.canonical,ee.projection),Le.extraShadowCaster=ee.extraShadowCaster,Le.lut=ee.lut;const Ze=(rt,We)=>{const pt=Le.reloadCallback;pt&&(delete Le.reloadCallback,Le.parse(Le.vectorTile,this.layerIndex,this.availableImages,this.actor,pt)),de(rt,We)};Le.status==="parsing"?Le.reloadCallback=Ze:Le.status==="done"&&(Le.vectorTile?Le.parse(Le.vectorTile,this.layerIndex,this.availableImages,this.actor,Ze):Ze())}else de(null,void 0)}abortTile(ee,de){const we=ee.uid,ze=this.loading[we];ze&&(ze.abort&&ze.abort(),delete this.loading[we]),de()}removeTile(ee,de){const we=this.loaded,ze=ee.uid;we&&we[ze]&&delete we[ze],de()}}class se{loadTile(ee,de){const{uid:we,encoding:ze,rawImageData:Le,padding:Ze}=ee,rt=ImageBitmap&&Le instanceof ImageBitmap?this.getImageData(Le,Ze):Le;de(null,new r.e5(we,rt,ze,Ze<1))}getImageData(ee,de){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ee.width,ee.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ee.width,this.offscreenCanvas.height=ee.height,this.offscreenCanvasContext.drawImage(ee,0,0,ee.width,ee.height);const we=this.offscreenCanvasContext.getImageData(-de,-de,ee.width+2*de,ee.height+2*de);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),we}}r.bg.setPbf(r.bh);class Ae{decodeRasterArray({task:ee,buffer:de},we){r.bg.performDecoding(de,ee).then(ze=>{we(null,ze)},ze=>{we(ze)})}}const De=r.dY.VectorTileFeature.prototype.toGeoJSON;class Ge{constructor(ee){this._feature=ee,this.extent=r.ag,this.type=ee.type,this.properties=ee.tags,"id"in ee&&!isNaN(ee.id)&&(this.id=parseInt(ee.id,10))}loadGeometry(){if(this._feature.type===1){const ee=[];for(const de of this._feature.geometry)ee.push([new r.P(de[0],de[1])]);return ee}{const ee=[];for(const de of this._feature.geometry){const we=[];for(const ze of de)we.push(new r.P(ze[0],ze[1]));ee.push(we)}return ee}}toGeoJSON(ee,de,we){return De.call(this,ee,de,we)}}class yt{constructor(ee){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.ag,this.length=ee.length,this._features=ee}feature(ee){return new Ge(this._features[ee])}}const ct=64/4096,mt=128;class et{constructor(){this.features=new Map}clear(){this.features.clear()}load(ee=[],de){for(const we of ee){const ze=we.id;if(ze==null)continue;let Le=this.features.get(ze);Le&&this.updateCache(Le,de),we.geometry?(Le=vt(we),this.updateCache(Le,de),this.features.set(ze,Le)):this.features.delete(ze),this.updateCache(Le,de)}}updateCache(ee,de){for(const{canonical:we,uid:ze}of Object.values(de)){const{z:Le,x:Ze,y:rt}=we;Qe(ee,Math.pow(2,Le),Ze,rt)&&delete de[ze]}}getTile(ee,de,we){const ze=Math.pow(2,ee),Le=[];for(const Ze of this.features.values())Qe(Ze,ze,de,we)&&Le.push(ni(Ze,ze,de,we));return{features:Le}}getFeatures(){return[...this.features.values()]}}function Qe({minX:ot,minY:ee,maxX:de,maxY:we},ze,Le,Ze){return ot<(Le+1+ct)/ze&&ee<(Ze+1+ct)/ze&&de>(Le-ct)/ze&&we>(Ze-ct)/ze}function vt(ot){const{id:ee,geometry:de,properties:we}=ot;if(!de)return;if(de.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:ze,coordinates:Le}=de,Ze={id:ee,type:1,geometry:[],tags:we,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},rt=Ze.geometry;if(ze==="Point")st(Le,rt,Ze);else if(ze==="MultiPoint")for(const We of Le)st(We,rt,Ze);else if(ze==="LineString")Ze.type=2,Zt(Le,rt,Ze);else if(ze==="MultiLineString")Ze.type=2,ui(Le,rt,Ze);else if(ze==="Polygon")Ze.type=3,ui(Le,rt,Ze,!0);else{if(ze!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ze.type=3;for(const We of Le)ui(We,rt,Ze,!0)}return Ze}function st([ot,ee],de,we){const ze=r.at(ot);let Le=r.aA(ee);Le=Le<0?0:Le>1?1:Le,de.push(ze,Le),we.minX=Math.min(we.minX,ze),we.minY=Math.min(we.minY,Le),we.maxX=Math.max(we.maxX,ze),we.maxY=Math.max(we.maxY,Le)}function Zt(ot,ee,de,we=!1,ze=!1){const Le=[];for(const Ze of ot)st(Ze,Le,de);ee.push(Le),we&&function(Ze,rt){let We=0;for(let pt=0,lt=Ze.length,dt=lt-2;pt<lt;dt=pt,pt+=2)We+=(Ze[pt]-Ze[dt])*(Ze[pt+1]+Ze[dt+1]);if(We>0===rt)for(let pt=0,lt=Ze.length;pt<lt/2;pt+=2){const dt=Ze[pt],St=Ze[pt+1];Ze[pt]=Ze[lt-2-pt],Ze[pt+1]=Ze[lt-1-pt],Ze[lt-2-pt]=dt,Ze[lt-1-pt]=St}}(Le,ze)}function ui(ot,ee,de,we=!1){for(let ze=0;ze<ot.length;ze++)Zt(ot[ze],ee,de,we,ze===0)}function ni(ot,ee,de,we){const{id:ze,type:Le,geometry:Ze,tags:rt}=ot,We=[];if(Le===1)(function(pt,lt,dt,St,qt){for(let Ht=0;Ht<pt.length;Ht+=2){const li=Math.round(r.ag*(pt[Ht+0]*lt-dt)),pi=Math.round(r.ag*(pt[Ht+1]*lt-St));qt.push([li,pi])}})(Ze,ee,de,we,We);else for(const pt of Ze)Hi(pt,ee,de,we,We);return{id:ze,type:Le,geometry:We,tags:rt}}function Hi(ot,ee,de,we,ze){const Le=-mt,Ze=r.ag+mt;let rt;for(let We=0;We<ot.length-2;We+=2){let pt=Math.round(r.ag*(ot[We+0]*ee-de)),lt=Math.round(r.ag*(ot[We+1]*ee-we)),dt=Math.round(r.ag*(ot[We+2]*ee-de)),St=Math.round(r.ag*(ot[We+3]*ee-we));const qt=dt-pt,Ht=St-lt;pt<Le&&dt<Le||(pt<Le?(lt+=Math.round(Ht*((Le-pt)/qt)),pt=Le):dt<Le&&(St=lt+Math.round(Ht*((Le-pt)/qt)),dt=Le),lt<Le&&St<Le||(lt<Le?(pt+=Math.round(qt*((Le-lt)/Ht)),lt=Le):St<Le&&(dt=pt+Math.round(qt*((Le-lt)/Ht)),St=Le),pt>=Ze&&dt>=Ze||(pt>=Ze?(lt+=Math.round(Ht*((Ze-pt)/qt)),pt=Ze):dt>=Ze&&(St=lt+Math.round(Ht*((Ze-pt)/qt)),dt=Ze),lt>=Ze&&St>=Ze||(lt>=Ze?(pt+=Math.round(qt*((Ze-lt)/Ht)),lt=Ze):St>=Ze&&(dt=pt+Math.round(qt*((Ze-lt)/Ht)),St=Ze),rt&&pt===rt[rt.length-1][0]&&lt===rt[rt.length-1][1]||(rt=[[pt,lt]],ze.push(rt)),rt.push([dt,St])))))}}var Ci,Ii,Ui,xi={exports:{}},Yi=function(){if(Ui)return xi.exports;Ui=1;var ot=r.e8(),ee=function(){if(Ii)return Ci;Ii=1;var lt=r.e6(),dt=r.e7().VectorTileFeature;function St(Ht,li){this.options=li||{},this.features=Ht,this.length=Ht.length}function qt(Ht,li){this.id=typeof Ht.id=="number"?Ht.id:void 0,this.type=Ht.type,this.rawGeometry=Ht.type===1?[Ht.geometry]:Ht.geometry,this.properties=Ht.tags,this.extent=li||4096}return Ci=St,St.prototype.feature=function(Ht){return new qt(this.features[Ht],this.options.extent)},qt.prototype.loadGeometry=function(){var Ht=this.rawGeometry;this.geometry=[];for(var li=0;li<Ht.length;li++){for(var pi=Ht[li],bi=[],Mi=0;Mi<pi.length;Mi++)bi.push(new lt(pi[Mi][0],pi[Mi][1]));this.geometry.push(bi)}return this.geometry},qt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ht=this.geometry,li=1/0,pi=-1/0,bi=1/0,Mi=-1/0,dr=0;dr<Ht.length;dr++)for(var fr=Ht[dr],Gi=0;Gi<fr.length;Gi++){var _r=fr[Gi];li=Math.min(li,_r.x),pi=Math.max(pi,_r.x),bi=Math.min(bi,_r.y),Mi=Math.max(Mi,_r.y)}return[li,bi,pi,Mi]},qt.prototype.toGeoJSON=dt.prototype.toGeoJSON,Ci}();function de(lt){var dt=new ot;return function(St,qt){for(var Ht in St.layers)qt.writeMessage(3,we,St.layers[Ht])}(lt,dt),dt.finish()}function we(lt,dt){var St;dt.writeVarintField(15,lt.version||1),dt.writeStringField(1,lt.name||""),dt.writeVarintField(5,lt.extent||4096);var qt={keys:[],values:[],keycache:{},valuecache:{}};for(St=0;St<lt.length;St++)qt.feature=lt.feature(St),dt.writeMessage(2,ze,qt);var Ht=qt.keys;for(St=0;St<Ht.length;St++)dt.writeStringField(3,Ht[St]);var li=qt.values;for(St=0;St<li.length;St++)dt.writeMessage(4,pt,li[St])}function ze(lt,dt){var St=lt.feature;St.id!==void 0&&dt.writeVarintField(1,St.id),dt.writeMessage(2,Le,lt),dt.writeVarintField(3,St.type),dt.writeMessage(4,We,St)}function Le(lt,dt){var St=lt.feature,qt=lt.keys,Ht=lt.values,li=lt.keycache,pi=lt.valuecache;for(var bi in St.properties){var Mi=St.properties[bi],dr=li[bi];if(Mi!==null){dr===void 0&&(qt.push(bi),li[bi]=dr=qt.length-1),dt.writeVarint(dr);var fr=typeof Mi;fr!=="string"&&fr!=="boolean"&&fr!=="number"&&(Mi=JSON.stringify(Mi));var Gi=fr+":"+Mi,_r=pi[Gi];_r===void 0&&(Ht.push(Mi),pi[Gi]=_r=Ht.length-1),dt.writeVarint(_r)}}}function Ze(lt,dt){return(dt<<3)+(7&lt)}function rt(lt){return lt<<1^lt>>31}function We(lt,dt){for(var St=lt.loadGeometry(),qt=lt.type,Ht=0,li=0,pi=St.length,bi=0;bi<pi;bi++){var Mi=St[bi],dr=1;qt===1&&(dr=Mi.length),dt.writeVarint(Ze(1,dr));for(var fr=qt===3?Mi.length-1:Mi.length,Gi=0;Gi<fr;Gi++){Gi===1&&qt!==1&&dt.writeVarint(Ze(2,fr-1));var _r=Mi[Gi].x-Ht,wr=Mi[Gi].y-li;dt.writeVarint(rt(_r)),dt.writeVarint(rt(wr)),Ht+=_r,li+=wr}qt===3&&dt.writeVarint(Ze(7,1))}}function pt(lt,dt){var St=typeof lt;St==="string"?dt.writeStringField(1,lt):St==="boolean"?dt.writeBooleanField(7,lt):St==="number"&&(lt%1!=0?dt.writeDoubleField(3,lt):lt<0?dt.writeSVarintField(6,lt):dt.writeVarintField(5,lt))}return xi.exports=de,xi.exports.fromVectorTileJs=de,xi.exports.fromGeojsonVt=function(lt,dt){dt=dt||{};var St={};for(var qt in lt)St[qt]=new ee(lt[qt].features,dt),St[qt].name=qt,St[qt].version=dt.version,St[qt].extent=dt.extent;return de({layers:St})},xi.exports.GeoJSONWrapper=ee,xi.exports}(),H=r.e9(Yi);const be={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ot=>ot},Be=Math.fround||(Ee=new Float32Array(1),ot=>(Ee[0]=+ot,Ee[0]));var Ee;const ve=3,Ie=5,Tt=6;class qe{constructor(ee){this.options=Object.assign(Object.create(be),ee),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ee){const{log:de,minZoom:we,maxZoom:ze}=this.options;de&&console.time("total time");const Le=`prepare ${ee.length} points`;de&&console.time(Le),this.points=ee;const Ze=[];for(let We=0;We<ee.length;We++){const pt=ee[We];if(!pt.geometry)continue;const[lt,dt]=pt.geometry.coordinates,St=Be($t(lt)),qt=Be(Kt(dt));Ze.push(St,qt,1/0,We,-1,1),this.options.reduce&&Ze.push(0)}let rt=this.trees[ze+1]=this._createTree(Ze);de&&console.timeEnd(Le);for(let We=ze;We>=we;We--){const pt=+Date.now();rt=this.trees[We]=this._createTree(this._cluster(rt,We)),de&&console.log("z%d: %d clusters in %dms",We,rt.numItems,+Date.now()-pt)}return de&&console.timeEnd("total time"),this}getClusters(ee,de){let we=((ee[0]+180)%360+360)%360-180;const ze=Math.max(-90,Math.min(90,ee[1]));let Le=ee[2]===180?180:((ee[2]+180)%360+360)%360-180;const Ze=Math.max(-90,Math.min(90,ee[3]));if(ee[2]-ee[0]>=360)we=-180,Le=180;else if(we>Le){const dt=this.getClusters([we,ze,180,Ze],de),St=this.getClusters([-180,ze,Le,Ze],de);return dt.concat(St)}const rt=this.trees[this._limitZoom(de)],We=rt.range($t(we),Kt(Ze),$t(Le),Kt(ze)),pt=rt.data,lt=[];for(const dt of We){const St=this.stride*dt;lt.push(pt[St+Ie]>1?Et(pt,St,this.clusterProps):this.points[pt[St+ve]])}return lt}getChildren(ee){const de=this._getOriginId(ee),we=this._getOriginZoom(ee),ze="No cluster with the specified id.",Le=this.trees[we];if(!Le)throw new Error(ze);const Ze=Le.data;if(de*this.stride>=Ze.length)throw new Error(ze);const rt=this.options.radius/(this.options.extent*Math.pow(2,we-1)),We=Le.within(Ze[de*this.stride],Ze[de*this.stride+1],rt),pt=[];for(const lt of We){const dt=lt*this.stride;Ze[dt+4]===ee&&pt.push(Ze[dt+Ie]>1?Et(Ze,dt,this.clusterProps):this.points[Ze[dt+ve]])}if(pt.length===0)throw new Error(ze);return pt}getLeaves(ee,de,we){const ze=[];return this._appendLeaves(ze,ee,de=de||10,we=we||0,0),ze}getTile(ee,de,we){const ze=this.trees[this._limitZoom(ee)],Le=Math.pow(2,ee),{extent:Ze,radius:rt}=this.options,We=rt/Ze,pt=(we-We)/Le,lt=(we+1+We)/Le,dt={features:[]};return this._addTileFeatures(ze.range((de-We)/Le,pt,(de+1+We)/Le,lt),ze.data,de,we,Le,dt),de===0&&this._addTileFeatures(ze.range(1-We/Le,pt,1,lt),ze.data,Le,we,Le,dt),de===Le-1&&this._addTileFeatures(ze.range(0,pt,We/Le,lt),ze.data,-1,we,Le,dt),dt.features.length?dt:null}getClusterExpansionZoom(ee){let de=this._getOriginZoom(ee)-1;for(;de<=this.options.maxZoom;){const we=this.getChildren(ee);if(de++,we.length!==1)break;ee=we[0].properties.cluster_id}return de}_appendLeaves(ee,de,we,ze,Le){const Ze=this.getChildren(de);for(const rt of Ze){const We=rt.properties;if(We&&We.cluster?Le+We.point_count<=ze?Le+=We.point_count:Le=this._appendLeaves(ee,We.cluster_id,we,ze,Le):Le<ze?Le++:ee.push(rt),ee.length===we)break}return Le}_createTree(ee){const de=new r.bE(ee.length/this.stride|0,this.options.nodeSize,Float32Array);for(let we=0;we<ee.length;we+=this.stride)de.add(ee[we],ee[we+1]);return de.finish(),de.data=ee,de}_addTileFeatures(ee,de,we,ze,Le,Ze){for(const rt of ee){const We=rt*this.stride,pt=de[We+Ie]>1;let lt,dt,St;if(pt)lt=It(de,We,this.clusterProps),dt=de[We],St=de[We+1];else{const li=this.points[de[We+ve]];lt=li.properties;const[pi,bi]=li.geometry.coordinates;dt=$t(pi),St=Kt(bi)}const qt={type:1,geometry:[[Math.round(this.options.extent*(dt*Le-we)),Math.round(this.options.extent*(St*Le-ze))]],tags:lt};let Ht;Ht=pt||this.options.generateId?de[We+ve]:this.points[de[We+ve]].id,Ht!==void 0&&(qt.id=Ht),Ze.features.push(qt)}}_limitZoom(ee){return Math.max(this.options.minZoom,Math.min(Math.floor(+ee),this.options.maxZoom+1))}_cluster(ee,de){const{radius:we,extent:ze,reduce:Le,minPoints:Ze}=this.options,rt=we/(ze*Math.pow(2,de)),We=ee.data,pt=[],lt=this.stride;for(let dt=0;dt<We.length;dt+=lt){if(We[dt+2]<=de)continue;We[dt+2]=de;const St=We[dt],qt=We[dt+1],Ht=ee.within(We[dt],We[dt+1],rt),li=We[dt+Ie];let pi=li;for(const bi of Ht){const Mi=bi*lt;We[Mi+2]>de&&(pi+=We[Mi+Ie])}if(pi>li&&pi>=Ze){let bi,Mi=St*li,dr=qt*li,fr=-1;const Gi=(dt/lt<<5)+(de+1)+this.points.length;for(const _r of Ht){const wr=_r*lt;if(We[wr+2]<=de)continue;We[wr+2]=de;const ki=We[wr+Ie];Mi+=We[wr]*ki,dr+=We[wr+1]*ki,We[wr+4]=Gi,Le&&(bi||(bi=this._map(We,dt,!0),fr=this.clusterProps.length,this.clusterProps.push(bi)),Le(bi,this._map(We,wr)))}We[dt+4]=Gi,pt.push(Mi/pi,dr/pi,1/0,Gi,-1,pi),Le&&pt.push(fr)}else{for(let bi=0;bi<lt;bi++)pt.push(We[dt+bi]);if(pi>1)for(const bi of Ht){const Mi=bi*lt;if(!(We[Mi+2]<=de)){We[Mi+2]=de;for(let dr=0;dr<lt;dr++)pt.push(We[Mi+dr])}}}}return pt}_getOriginId(ee){return ee-this.points.length>>5}_getOriginZoom(ee){return(ee-this.points.length)%32}_map(ee,de,we){if(ee[de+Ie]>1){const Ze=this.clusterProps[ee[de+Tt]];return we?Object.assign({},Ze):Ze}const ze=this.points[ee[de+ve]].properties,Le=this.options.map(ze);return we&&Le===ze?Object.assign({},Le):Le}}function Et(ot,ee,de){return{type:"Feature",id:ot[ee+ve],properties:It(ot,ee,de),geometry:{type:"Point",coordinates:[(we=ot[ee],360*(we-.5)),ti(ot[ee+1])]}};var we}function It(ot,ee,de){const we=ot[ee+Ie],ze=we>=1e4?`${Math.round(we/1e3)}k`:we>=1e3?Math.round(we/100)/10+"k":we,Le=ot[ee+Tt],Ze=Le===-1?{}:Object.assign({},de[Le]);return Object.assign(Ze,{cluster:!0,cluster_id:ot[ee+ve],point_count:we,point_count_abbreviated:ze})}function $t(ot){return ot/360+.5}function Kt(ot){const ee=Math.sin(ot*Math.PI/180),de=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return de<0?0:de>1?1:de}function ti(ot){const ee=(180-360*ot)*Math.PI/180;return 360*Math.atan(Math.exp(ee))/Math.PI-90}function Li(ot,ee,de,we){let ze=we;const Le=ee+(de-ee>>1);let Ze,rt=de-ee;const We=ot[ee],pt=ot[ee+1],lt=ot[de],dt=ot[de+1];for(let St=ee+3;St<de;St+=3){const qt=Ut(ot[St],ot[St+1],We,pt,lt,dt);if(qt>ze)Ze=St,ze=qt;else if(qt===ze){const Ht=Math.abs(St-Le);Ht<rt&&(Ze=St,rt=Ht)}}ze>we&&(Ze-ee>3&&Li(ot,ee,Ze,we),ot[Ze+2]=ze,de-Ze>3&&Li(ot,Ze,de,we))}function Ut(ot,ee,de,we,ze,Le){let Ze=ze-de,rt=Le-we;if(Ze!==0||rt!==0){const We=((ot-de)*Ze+(ee-we)*rt)/(Ze*Ze+rt*rt);We>1?(de=ze,we=Le):We>0&&(de+=Ze*We,we+=rt*We)}return Ze=ot-de,rt=ee-we,Ze*Ze+rt*rt}function yi(ot,ee,de,we){const ze={id:ot??null,type:ee,geometry:de,tags:we,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ee==="Point"||ee==="MultiPoint"||ee==="LineString")zi(ze,de);else if(ee==="Polygon")zi(ze,de[0]);else if(ee==="MultiLineString")for(const Le of de)zi(ze,Le);else if(ee==="MultiPolygon")for(const Le of de)zi(ze,Le[0]);return ze}function zi(ot,ee){for(let de=0;de<ee.length;de+=3)ot.minX=Math.min(ot.minX,ee[de]),ot.minY=Math.min(ot.minY,ee[de+1]),ot.maxX=Math.max(ot.maxX,ee[de]),ot.maxY=Math.max(ot.maxY,ee[de+1])}function Ni(ot,ee,de,we){if(!ee.geometry)return;const ze=ee.geometry.coordinates;if(ze&&ze.length===0)return;const Le=ee.geometry.type,Ze=Math.pow(de.tolerance/((1<<de.maxZoom)*de.extent),2);let rt=[],We=ee.id;if(de.promoteId?We=ee.properties[de.promoteId]:de.generateId&&(We=we||0),Le==="Point")Ki(ze,rt);else if(Le==="MultiPoint")for(const pt of ze)Ki(pt,rt);else if(Le==="LineString")sr(ze,rt,Ze,!1);else if(Le==="MultiLineString"){if(de.lineMetrics){for(const pt of ze)rt=[],sr(pt,rt,Ze,!1),ot.push(yi(We,"LineString",rt,ee.properties));return}Rr(ze,rt,Ze,!1)}else if(Le==="Polygon")Rr(ze,rt,Ze,!0);else{if(Le!=="MultiPolygon"){if(Le==="GeometryCollection"){for(const pt of ee.geometry.geometries)Ni(ot,{id:We,geometry:pt,properties:ee.properties},de,we);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const pt of ze){const lt=[];Rr(pt,lt,Ze,!0),rt.push(lt)}}ot.push(yi(We,Le,rt,ee.properties))}function Ki(ot,ee){ee.push(Yr(ot[0]),kr(ot[1]),0)}function sr(ot,ee,de,we){let ze,Le,Ze=0;for(let We=0;We<ot.length;We++){const pt=Yr(ot[We][0]),lt=kr(ot[We][1]);ee.push(pt,lt,0),We>0&&(Ze+=we?(ze*lt-pt*Le)/2:Math.sqrt(Math.pow(pt-ze,2)+Math.pow(lt-Le,2))),ze=pt,Le=lt}const rt=ee.length-3;ee[2]=1,Li(ee,0,rt,de),ee[rt+2]=1,ee.size=Math.abs(Ze),ee.start=0,ee.end=ee.size}function Rr(ot,ee,de,we){for(let ze=0;ze<ot.length;ze++){const Le=[];sr(ot[ze],Le,de,we),ee.push(Le)}}function Yr(ot){return ot/360+.5}function kr(ot){const ee=Math.sin(ot*Math.PI/180),de=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return de<0?0:de>1?1:de}function yr(ot,ee,de,we,ze,Le,Ze,rt){if(we/=ee,Le>=(de/=ee)&&Ze<we)return ot;if(Ze<de||Le>=we)return null;const We=[];for(const pt of ot){const lt=pt.geometry;let dt=pt.type;const St=ze===0?pt.minX:pt.minY,qt=ze===0?pt.maxX:pt.maxY;if(St>=de&&qt<we){We.push(pt);continue}if(qt<de||St>=we)continue;let Ht=[];if(dt==="Point"||dt==="MultiPoint")nn(lt,Ht,de,we,ze);else if(dt==="LineString")Ts(lt,Ht,de,we,ze,!1,rt.lineMetrics);else if(dt==="MultiLineString")Ur(lt,Ht,de,we,ze,!1);else if(dt==="Polygon")Ur(lt,Ht,de,we,ze,!0);else if(dt==="MultiPolygon")for(const li of lt){const pi=[];Ur(li,pi,de,we,ze,!0),pi.length&&Ht.push(pi)}if(Ht.length){if(rt.lineMetrics&&dt==="LineString"){for(const li of Ht)We.push(yi(pt.id,dt,li,pt.tags));continue}dt!=="LineString"&&dt!=="MultiLineString"||(Ht.length===1?(dt="LineString",Ht=Ht[0]):dt="MultiLineString"),dt!=="Point"&&dt!=="MultiPoint"||(dt=Ht.length===3?"Point":"MultiPoint"),We.push(yi(pt.id,dt,Ht,pt.tags))}}return We.length?We:null}function nn(ot,ee,de,we,ze){for(let Le=0;Le<ot.length;Le+=3){const Ze=ot[Le+ze];Ze>=de&&Ze<=we&&Vi(ee,ot[Le],ot[Le+1],ot[Le+2])}}function Ts(ot,ee,de,we,ze,Le,Ze){let rt=Ar(ot);const We=ze===0?Zi:Rn;let pt,lt,dt=ot.start;for(let pi=0;pi<ot.length-3;pi+=3){const bi=ot[pi],Mi=ot[pi+1],dr=ot[pi+2],fr=ot[pi+3],Gi=ot[pi+4],_r=ze===0?bi:Mi,wr=ze===0?fr:Gi;let ki=!1;Ze&&(pt=Math.sqrt(Math.pow(bi-fr,2)+Math.pow(Mi-Gi,2))),_r<de?wr>de&&(lt=We(rt,bi,Mi,fr,Gi,de),Ze&&(rt.start=dt+pt*lt)):_r>we?wr<we&&(lt=We(rt,bi,Mi,fr,Gi,we),Ze&&(rt.start=dt+pt*lt)):Vi(rt,bi,Mi,dr),wr<de&&_r>=de&&(lt=We(rt,bi,Mi,fr,Gi,de),ki=!0),wr>we&&_r<=we&&(lt=We(rt,bi,Mi,fr,Gi,we),ki=!0),!Le&&ki&&(Ze&&(rt.end=dt+pt*lt),ee.push(rt),rt=Ar(ot)),Ze&&(dt+=pt)}let St=ot.length-3;const qt=ot[St],Ht=ot[St+1],li=ze===0?qt:Ht;li>=de&&li<=we&&Vi(rt,qt,Ht,ot[St+2]),St=rt.length-3,Le&&St>=3&&(rt[St]!==rt[0]||rt[St+1]!==rt[1])&&Vi(rt,rt[0],rt[1],rt[2]),rt.length&&ee.push(rt)}function Ar(ot){const ee=[];return ee.size=ot.size,ee.start=ot.start,ee.end=ot.end,ee}function Ur(ot,ee,de,we,ze,Le){for(const Ze of ot)Ts(Ze,ee,de,we,ze,Le,!1)}function Vi(ot,ee,de,we){ot.push(ee,de,we)}function Zi(ot,ee,de,we,ze,Le){const Ze=(Le-ee)/(we-ee);return Vi(ot,Le,de+(ze-de)*Ze,1),Ze}function Rn(ot,ee,de,we,ze,Le){const Ze=(Le-de)/(ze-de);return Vi(ot,ee+(we-ee)*Ze,Le,1),Ze}function tr(ot,ee){const de=[];for(let we=0;we<ot.length;we++){const ze=ot[we],Le=ze.type;let Ze;if(Le==="Point"||Le==="MultiPoint"||Le==="LineString")Ze=Yn(ze.geometry,ee);else if(Le==="MultiLineString"||Le==="Polygon"){Ze=[];for(const rt of ze.geometry)Ze.push(Yn(rt,ee))}else if(Le==="MultiPolygon"){Ze=[];for(const rt of ze.geometry){const We=[];for(const pt of rt)We.push(Yn(pt,ee));Ze.push(We)}}de.push(yi(ze.id,Le,Ze,ze.tags))}return de}function Yn(ot,ee){const de=[];de.size=ot.size,ot.start!==void 0&&(de.start=ot.start,de.end=ot.end);for(let we=0;we<ot.length;we+=3)de.push(ot[we]+ee,ot[we+1],ot[we+2]);return de}function xn(ot,ee){if(ot.transformed)return ot;const de=1<<ot.z,we=ot.x,ze=ot.y;for(const Le of ot.features){const Ze=Le.geometry,rt=Le.type;if(Le.geometry=[],rt===1)for(let We=0;We<Ze.length;We+=2)Le.geometry.push($n(Ze[We],Ze[We+1],ee,de,we,ze));else for(let We=0;We<Ze.length;We++){const pt=[];for(let lt=0;lt<Ze[We].length;lt+=2)pt.push($n(Ze[We][lt],Ze[We][lt+1],ee,de,we,ze));Le.geometry.push(pt)}}return ot.transformed=!0,ot}function $n(ot,ee,de,we,ze,Le){return[Math.round(de*(ot*we-ze)),Math.round(de*(ee*we-Le))]}function Dn(ot,ee,de,we,ze){const Le=ee===ze.maxZoom?0:ze.tolerance/((1<<ee)*ze.extent),Ze={features:[],numPoints:0,numSimplified:0,numFeatures:ot.length,source:null,x:de,y:we,z:ee,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const rt of ot)Hs(Ze,rt,Le,ze);return Ze}function Hs(ot,ee,de,we){const ze=ee.geometry,Le=ee.type,Ze=[];if(ot.minX=Math.min(ot.minX,ee.minX),ot.minY=Math.min(ot.minY,ee.minY),ot.maxX=Math.max(ot.maxX,ee.maxX),ot.maxY=Math.max(ot.maxY,ee.maxY),Le==="Point"||Le==="MultiPoint")for(let rt=0;rt<ze.length;rt+=3)Ze.push(ze[rt],ze[rt+1]),ot.numPoints++,ot.numSimplified++;else if(Le==="LineString")Rs(Ze,ze,ot,de,!1,!1);else if(Le==="MultiLineString"||Le==="Polygon")for(let rt=0;rt<ze.length;rt++)Rs(Ze,ze[rt],ot,de,Le==="Polygon",rt===0);else if(Le==="MultiPolygon")for(let rt=0;rt<ze.length;rt++){const We=ze[rt];for(let pt=0;pt<We.length;pt++)Rs(Ze,We[pt],ot,de,!0,pt===0)}if(Ze.length){let rt=ee.tags||null;if(Le==="LineString"&&we.lineMetrics){rt={};for(const pt in ee.tags)rt[pt]=ee.tags[pt];rt.mapbox_clip_start=ze.start/ze.size,rt.mapbox_clip_end=ze.end/ze.size}const We={geometry:Ze,type:Le==="Polygon"||Le==="MultiPolygon"?3:Le==="LineString"||Le==="MultiLineString"?2:1,tags:rt};ee.id!==null&&(We.id=ee.id),ot.features.push(We)}}function Rs(ot,ee,de,we,ze,Le){const Ze=we*we;if(we>0&&ee.size<(ze?Ze:we))return void(de.numPoints+=ee.length/3);const rt=[];for(let We=0;We<ee.length;We+=3)(we===0||ee[We+2]>Ze)&&(de.numSimplified++,rt.push(ee[We],ee[We+1])),de.numPoints++;ze&&function(We,pt){let lt=0;for(let dt=0,St=We.length,qt=St-2;dt<St;qt=dt,dt+=2)lt+=(We[dt]-We[qt])*(We[dt+1]+We[qt+1]);if(lt>0===pt)for(let dt=0,St=We.length;dt<St/2;dt+=2){const qt=We[dt],Ht=We[dt+1];We[dt]=We[St-2-dt],We[dt+1]=We[St-1-dt],We[St-2-dt]=qt,We[St-1-dt]=Ht}}(rt,Le),ot.push(rt)}const vr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class or{constructor(ee,de){const we=(de=this.options=function(Le,Ze){for(const rt in Ze)Le[rt]=Ze[rt];return Le}(Object.create(vr),de)).debug;if(we&&console.time("preprocess data"),de.maxZoom<0||de.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(de.promoteId&&de.generateId)throw new Error("promoteId and generateId cannot be used together.");let ze=function(Le,Ze){const rt=[];if(Le.type==="FeatureCollection")for(let We=0;We<Le.features.length;We++)Ni(rt,Le.features[We],Ze,We);else Ni(rt,Le.type==="Feature"?Le:{geometry:Le},Ze);return rt}(ee,de);this.tiles={},this.tileCoords=[],we&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",de.indexMaxZoom,de.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ze=function(Le,Ze){const rt=Ze.buffer/Ze.extent;let We=Le;const pt=yr(Le,1,-1-rt,rt,0,-1,2,Ze),lt=yr(Le,1,1-rt,2+rt,0,-1,2,Ze);return(pt||lt)&&(We=yr(Le,1,-rt,1+rt,0,-1,2,Ze)||[],pt&&(We=tr(pt,1).concat(We)),lt&&(We=We.concat(tr(lt,-1)))),We}(ze,de),ze.length&&this.splitTile(ze,0,0,0),we&&(ze.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ee,de,we,ze,Le,Ze,rt){const We=[ee,de,we,ze],pt=this.options,lt=pt.debug;for(;We.length;){ze=We.pop(),we=We.pop(),de=We.pop(),ee=We.pop();const dt=1<<de,St=lr(de,we,ze);let qt=this.tiles[St];if(!qt&&(lt>1&&console.time("creation"),qt=this.tiles[St]=Dn(ee,de,we,ze,pt),this.tileCoords.push({z:de,x:we,y:ze}),lt)){lt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",de,we,ze,qt.numFeatures,qt.numPoints,qt.numSimplified),console.timeEnd("creation"));const ki=`z${de}`;this.stats[ki]=(this.stats[ki]||0)+1,this.total++}if(qt.source=ee,Le==null){if(de===pt.indexMaxZoom||qt.numPoints<=pt.indexMaxPoints)continue}else{if(de===pt.maxZoom||de===Le)continue;if(Le!=null){const ki=Le-de;if(we!==Ze>>ki||ze!==rt>>ki)continue}}if(qt.source=null,ee.length===0)continue;lt>1&&console.time("clipping");const Ht=.5*pt.buffer/pt.extent,li=.5-Ht,pi=.5+Ht,bi=1+Ht;let Mi=null,dr=null,fr=null,Gi=null,_r=yr(ee,dt,we-Ht,we+pi,0,qt.minX,qt.maxX,pt),wr=yr(ee,dt,we+li,we+bi,0,qt.minX,qt.maxX,pt);ee=null,_r&&(Mi=yr(_r,dt,ze-Ht,ze+pi,1,qt.minY,qt.maxY,pt),dr=yr(_r,dt,ze+li,ze+bi,1,qt.minY,qt.maxY,pt),_r=null),wr&&(fr=yr(wr,dt,ze-Ht,ze+pi,1,qt.minY,qt.maxY,pt),Gi=yr(wr,dt,ze+li,ze+bi,1,qt.minY,qt.maxY,pt),wr=null),lt>1&&console.timeEnd("clipping"),We.push(Mi||[],de+1,2*we,2*ze),We.push(dr||[],de+1,2*we,2*ze+1),We.push(fr||[],de+1,2*we+1,2*ze),We.push(Gi||[],de+1,2*we+1,2*ze+1)}}getTile(ee,de,we){ee=+ee,de=+de,we=+we;const ze=this.options,{extent:Le,debug:Ze}=ze;if(ee<0||ee>24)return null;const rt=1<<ee,We=lr(ee,de=de+rt&rt-1,we);if(this.tiles[We])return xn(this.tiles[We],Le);Ze>1&&console.log("drilling down to z%d-%d-%d",ee,de,we);let pt,lt=ee,dt=de,St=we;for(;!pt&&lt>0;)lt--,dt>>=1,St>>=1,pt=this.tiles[lr(lt,dt,St)];return pt&&pt.source?(Ze>1&&(console.log("found parent tile z%d-%d-%d",lt,dt,St),console.time("drilling down")),this.splitTile(pt.source,lt,dt,St,ee,de,we),Ze>1&&console.timeEnd("drilling down"),this.tiles[We]?xn(this.tiles[We],Le):null):null}}function lr(ot,ee,de){return 32*((1<<ot)*de+ee)+ot}function Pi(ot,ee){const de=ot.tileID.canonical;if(!this._geoJSONIndex)return void ee(null,null);const we=this._geoJSONIndex.getTile(de.z,de.x,de.y);if(!we)return void ee(null,null);const ze=new yt(we.features);let Le=H(ze);Le.byteOffset===0&&Le.byteLength===Le.buffer.byteLength||(Le=new Uint8Array(Le)),ee(null,{vectorTile:ze,rawData:Le.buffer})}class br extends oe{constructor(ee,de,we,ze,Le,Ze){super(ee,de,we,ze,Pi,Ze),Le&&(this.loadGeoJSON=Le),this._dynamicIndex=new et}loadData(ee,de){const we=ee&&ee.request,ze=we&&we.collectResourceTiming;this.loadGeoJSON(ee,(Le,Ze)=>{if(Le||!Ze)return de(Le);if(typeof Ze!="object")return de(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`));{try{if(ee.filter){const We=r.U(ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(We.result==="error")throw new Error(We.value.map(pt=>`${pt.key}: ${pt.message}`).join(", "));Ze.features=Ze.features.filter(pt=>We.value.evaluate({zoom:0},pt))}ee.dynamic?(Ze.type==="Feature"&&(Ze={type:"FeatureCollection",features:[Ze]}),ee.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ze.features,this.loaded),ee.cluster&&(Ze.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ee.cluster?new qe(function({superclusterOptions:We,clusterProperties:pt}){if(!pt||!We)return We;const lt={},dt={},St={accumulated:null,zoom:0},qt={properties:null},Ht=Object.keys(pt);for(const li of Ht){const[pi,bi]=pt[li],Mi=r.U(bi),dr=r.U(typeof pi=="string"?[pi,["accumulated"],["get",li]]:pi);lt[li]=Mi.value,dt[li]=dr.value}return We.map=li=>{qt.properties=li;const pi={};for(const bi of Ht)pi[bi]=lt[bi].evaluate(St,qt);return pi},We.reduce=(li,pi)=>{qt.properties=pi;for(const bi of Ht)St.accumulated=li[bi],li[bi]=dt[bi].evaluate(St,qt)},We}(ee)).load(Ze.features):ee.dynamic?this._dynamicIndex:function(We,pt){return new or(We,pt)}(Ze,ee.geojsonVtOptions)}catch(We){return de(We)}const rt={};if(ze){const We=D(we);We&&(rt.resourceTiming={},rt.resourceTiming[ee.source]=JSON.parse(JSON.stringify(We)))}de(null,rt)}})}reloadTile(ee,de){const we=this.loaded;return we&&we[ee.uid]?ee.partial?de(null,void 0):super.reloadTile(ee,de):this.loadTile(ee,de)}loadGeoJSON(ee,de){if(ee.request)r.n(ee.request,de);else{if(typeof ee.data!="string")return de(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`));try{return de(null,JSON.parse(ee.data))}catch{return de(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ee,de){try{de(null,this._geoJSONIndex.getClusterExpansionZoom(ee.clusterId))}catch(we){de(we)}}getClusterChildren(ee,de){try{de(null,this._geoJSONIndex.getChildren(ee.clusterId))}catch(we){de(we)}}getClusterLeaves(ee,de){try{de(null,this._geoJSONIndex.getLeaves(ee.clusterId,ee.limit,ee.offset))}catch(we){de(we)}}}class ir{constructor(ee,de){this.tileID=new r.aG(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.tileZoom=ee.tileZoom,this.uid=ee.uid,this.zoom=ee.zoom,this.canonical=ee.tileID.canonical,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ee.projection,this.brightness=de}parse(ee,de,we,ze){this.status="parsing";const Le=new r.aG(we.tileID.overscaledZ,we.tileID.wrap,we.tileID.canonical.z,we.tileID.canonical.x,we.tileID.canonical.y),Ze=[],rt=de.familiesBySource[we.source],We=new r.d$(Le,we.promoteId);return We.bucketLayerIDs=[],We.is3DTile=!0,r.ea(ee).then(pt=>{if(!pt)return ze(new Error("Could not parse tile"));const lt=r.eb(pt,1/r.cc(we.tileID.canonical)),dt=pt.json.extensionsUsed&&pt.json.extensionsUsed.includes("MAPBOX_mesh_features")||pt.json.asset.extras&&pt.json.asset.extras.MAPBOX_mesh_features,St=pt.json.extensionsUsed&&pt.json.extensionsUsed.includes("EXT_meshopt_compression"),qt=new r.a8(this.zoom,{brightness:this.brightness});for(const Ht in rt)for(const li of rt[Ht]){const pi=li[0];We.bucketLayerIDs.push(li.map(Mi=>r.aC(Mi.id,Mi.scope))),pi.recalculate(qt,[]);const bi=new r.ec(li,lt,Le,dt,St,this.brightness,We);dt||(bi.needsUpload=!0),Ze.push(bi),bi.evaluate(pi)}this.status="done",ze(null,{buckets:Ze,featureIndex:We,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(pt=>ze(new Error(pt.message)))}}class Ji{constructor(ee,de,we,ze,Le,Ze){this.actor=ee,this.layerIndex=de,this.availableImages=we,this.brightness=Ze,this.loading={},this.loaded={}}loadTile(ee,de){const we=ee.uid,ze=this.loading[we]=new ir(ee,this.brightness);r.bi(ee.request,(Le,Ze)=>{const rt=!this.loading[we];return delete this.loading[we],rt||Le?(ze.status="done",rt||(this.loaded[we]=ze),de(Le)):Ze&&Ze.byteLength!==0?void ze.parse(Ze,this.layerIndex,ee,(We,pt)=>{ze.status="done",this.loaded=this.loaded||{},this.loaded[we]=ze,We||!pt?de(We):de(null,pt)}):(ze.status="done",this.loaded[we]=ze,de())})}reloadTile(ee,de){const we=this.loaded,ze=ee.uid;if(we&&we[ze]){const Le=we[ze];Le.projection=ee.projection,Le.brightness=ee.brightness;const Ze=(rt,We)=>{Le.reloadCallback&&(delete Le.reloadCallback,this.loadTile(ee,de)),de(rt,We)};Le.status==="parsing"?Le.reloadCallback=Ze:Le.status==="done"&&this.loadTile(ee,de)}}abortTile(ee,de){const we=ee.uid;this.loading[we]&&delete this.loading[we],de()}removeTile(ee,de){const we=this.loaded,ze=ee.uid;we&&we[ze]&&delete we[ze],de()}}class gn{constructor(ee){this.self=ee,this.actor=new r.ed(ee,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new r.I,this.projections={},this.defaultProjection=r.bP({name:"mercator"}),this.workerSourceTypes={vector:oe,geojson:br,"batched-model":Ji},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(de,we)=>{if(this.workerSourceTypes[de])throw new Error(`Worker source with name "${de}" already registered.`);this.workerSourceTypes[de]=we},this.self.registerRTLTextPlugin=de=>{if(r.ee.isParsed())throw new Error("RTL text plugin already registered.");r.ee.applyArabicShaping=de.applyArabicShaping,r.ee.processBidirectionalText=de.processBidirectionalText,r.ee.processStyledBidirectionalText=de.processStyledBidirectionalText}}clearCaches(ee,de,we){delete this.layerIndexes[ee],delete this.availableImages[ee],delete this.workerSources[ee],delete this.demWorkerSources[ee],delete this.rasterArrayWorkerSource,we()}checkIfReady(ee,de,we){we()}setReferrer(ee,de){this.referrer=de}spriteLoaded(ee,{scope:de,isLoaded:we}){if(this.isSpriteLoaded[ee]||(this.isSpriteLoaded[ee]={}),this.isSpriteLoaded[ee][de]=we,this.workerSources[ee]&&this.workerSources[ee][de])for(const ze in this.workerSources[ee][de]){const Le=this.workerSources[ee][de][ze];for(const Ze in Le){const rt=Le[Ze];rt instanceof oe&&(rt.isSpriteLoaded=we,rt.fire(new r.z("isSpriteLoaded")))}}}setImages(ee,{scope:de,images:we},ze){if(this.availableImages[ee]||(this.availableImages[ee]={}),this.availableImages[ee][de]=we,this.workerSources[ee]&&this.workerSources[ee][de]){for(const Le in this.workerSources[ee][de]){const Ze=this.workerSources[ee][de][Le];for(const rt in Ze)Ze[rt].availableImages=we}ze()}else ze()}setProjection(ee,de){this.projections[ee]=r.bP(de)}setBrightness(ee,de,we){this.brightness=de,we()}setLayers(ee,de,we){this.getLayerIndex(ee,de.scope).replace(de.layers,de.options),we()}updateLayers(ee,de,we){this.getLayerIndex(ee,de.scope).update(de.layers,de.removedIds,de.options),we()}loadTile(ee,de,we){de.projection=this.projections[ee]||this.defaultProjection,this.getWorkerSource(ee,de.type,de.source,de.scope).loadTile(de,we)}loadDEMTile(ee,de,we){this.getDEMWorkerSource(ee,de.source,de.scope).loadTile(de,we)}decodeRasterArray(ee,de,we){this.getRasterArrayWorkerSource().decodeRasterArray(de,we)}reloadTile(ee,de,we){de.projection=this.projections[ee]||this.defaultProjection,this.getWorkerSource(ee,de.type,de.source,de.scope).reloadTile(de,we)}abortTile(ee,de,we){this.getWorkerSource(ee,de.type,de.source,de.scope).abortTile(de,we)}removeTile(ee,de,we){this.getWorkerSource(ee,de.type,de.source,de.scope).removeTile(de,we)}removeSource(ee,de,we){if(!(this.workerSources[ee]&&this.workerSources[ee][de.scope]&&this.workerSources[ee][de.scope][de.type]&&this.workerSources[ee][de.scope][de.type][de.source]))return;const ze=this.workerSources[ee][de.scope][de.type][de.source];delete this.workerSources[ee][de.scope][de.type][de.source],ze.removeSource!==void 0?ze.removeSource(de,we):we()}loadWorkerSource(ee,de,we){try{this.self.importScripts(de.url),we()}catch(ze){we(ze.toString())}}syncRTLPluginState(ee,de,we){try{r.ee.setState(de);const ze=r.ee.getPluginURL();if(r.ee.isLoaded()&&!r.ee.isParsed()&&ze!=null){this.self.importScripts(ze);const Le=r.ee.isParsed();we(Le?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ze}`),Le)}}catch(ze){we(ze.toString())}}setDracoUrl(ee,de){this.dracoUrl=de}getAvailableImages(ee,de){this.availableImages[ee]||(this.availableImages[ee]={});let we=this.availableImages[ee][de];return we||(we=[]),we}getLayerIndex(ee,de){this.layerIndexes[ee]||(this.layerIndexes[ee]={});let we=this.layerIndexes[ee][de];return we||(we=this.layerIndexes[ee][de]=new N,we.scope=de),we}getWorkerSource(ee,de,we,ze){return this.workerSources[ee]||(this.workerSources[ee]={}),this.workerSources[ee][ze]||(this.workerSources[ee][ze]={}),this.workerSources[ee][ze][de]||(this.workerSources[ee][ze][de]={}),this.isSpriteLoaded[ee]||(this.isSpriteLoaded[ee]={}),this.workerSources[ee][ze][de][we]||(this.workerSources[ee][ze][de][we]=new this.workerSourceTypes[de]({send:(Le,Ze,rt,We,pt,lt)=>{this.actor.send(Le,Ze,rt,ee,pt,lt)},scheduler:this.actor.scheduler},this.getLayerIndex(ee,ze),this.getAvailableImages(ee,ze),this.isSpriteLoaded[ee][ze],void 0,this.brightness)),this.workerSources[ee][ze][de][we]}rasterizeImages(ee,de,we){const{imageTasks:ze,scope:Le}=de,Ze={};for(const rt in ze){const{image:We,imageIdWithOptions:pt}=ze[rt];Ze[rt]=this.imageRasterizer.rasterize(pt,We,Le,ee)}we(void 0,Ze)}removeRasterizedImages(ee,de,we){const{imageIds:ze,scope:Le}=de;this.imageRasterizer.removeImagesFromCacheByIds(ze,Le,ee),we()}getDEMWorkerSource(ee,de,we){return this.demWorkerSources[ee]||(this.demWorkerSources[ee]={}),this.demWorkerSources[ee][we]||(this.demWorkerSources[ee][we]={}),this.demWorkerSources[ee][we][de]||(this.demWorkerSources[ee][we][de]=new se),this.demWorkerSources[ee][we][de]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Ae),this.rasterArrayWorkerSource}enforceCacheSizeLimit(ee,de){r.ef(de)}getWorkerPerformanceMetrics(ee,de,we){we(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new gn(self)),gn}),y(["./shared"],function(r){var D="3.10.0";const B={create:"create",load:"load",fullLoad:"fullLoad"},F={mark(f){performance.mark(f)},measure(f,i,a){performance.measure(f,i,a)}};function N(f){const i=f.name.split("?")[0];return r.a(i)&&i.includes("mapbox-gl.js")?"javascript":r.a(i)&&i.includes("mapbox-gl.css")?"css":r.b(i)?"fontRange":r.c(i)?"sprite":r.i(i)?"style":r.d(i)?"tilejson":"other"}var Q,q={},X=function(){if(Q)return q;function f(p){return!i(p)}function i(p){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,T,M=new Blob([""],{type:"text/javascript"}),O=URL.createObjectURL(M);try{T=new Worker(O),b=!0}catch{b=!1}return T&&T.terminate(),URL.revokeObjectURL(O),b}()?function(){var b=document.createElement("canvas");b.width=b.height=1;var T=b.getContext("2d");if(!T)return!1;var M=T.getImageData(0,0,1,1);return M&&M.width===b.width}()?(a[g=p&&p.failIfMajorPerformanceCaveat]===void 0&&(a[g]=function(b){var T,M=function(O){var L=document.createElement("canvas"),k=Object.create(f.webGLContextAttributes);return k.failIfMajorPerformanceCaveat=O,L.getContext("webgl2",k)}(b);if(!M)return!1;try{T=M.createShader(M.VERTEX_SHADER)}catch{return!1}return!(!T||M.isContextLost())&&(M.shaderSource(T,"void main() {}"),M.compileShader(T),M.getShaderParameter(T,M.COMPILE_STATUS)===!0)}(g)),a[g]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var g}Q=1,q.supported=f,q.notSupportedReason=i;var a={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},q}();function G(f,i,a){const p=document.createElement(f);return i!=null&&(p.className=i),a&&a.appendChild(p),p}function ae(f,i,a){const p=document.createElementNS("http://www.w3.org/2000/svg",f);for(const g of Object.keys(i))p.setAttributeNS(null,g,String(i[g]));return a&&a.appendChild(p),p}const xe=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Te=xe&&xe.userSelect!==void 0?"userSelect":"WebkitUserSelect";let fe;function ne(){xe&&Te&&(fe=xe[Te],xe[Te]="none")}function ue(){xe&&Te&&(xe[Te]=fe)}function ye(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",ye,!0)}function le(){window.addEventListener("click",ye,!0),window.setTimeout(()=>{window.removeEventListener("click",ye,!0)},0)}function re(f,i){const a=f.getBoundingClientRect();return Ae(f,a,i)}function oe(f,i){const a=f.getBoundingClientRect(),p=[];for(let g=0;g<i.length;g++)p.push(Ae(f,a,i[g]));return p}function se(f){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&f.button===2&&f.ctrlKey?0:f.button}function Ae(f,i,a){const p=f.offsetWidth===i.width?1:f.offsetWidth/i.width;return new r.P((a.clientX-i.left)*p,(a.clientY-i.top)*p)}const De="01",Ge="NO_ACCESS_TOKEN";class yt{constructor(i,a,p){this._transformRequestFn=i,this._customAccessToken=a,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const i=function(){let a="";for(let p=0;p<10;p++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",De,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,a){return this._transformRequestFn&&this._transformRequestFn(i,a)||{url:i}}normalizeStyleURL(i,a){if(!r.f(i))return i;const p=mt(i);return p.params.push(`sdk=js-${D}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||a)}normalizeGlyphsURL(i,a){if(!r.f(i))return i;const p=mt(i);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||a)}normalizeModelURL(i,a){if(!r.f(i))return i;const p=mt(i);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||a)}normalizeSourceURL(i,a,p,g){if(!r.f(i))return i;const b=mt(i);return b.path=`/v4/${b.authority}.json`,b.params.push("secure"),p&&b.params.push(`language=${p}`),g&&b.params.push(`worldview=${g}`),this._makeAPIURL(b,this._customAccessToken||a)}normalizeIconsetURL(i,a){const p=mt(i);return r.f(i)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||a)):et(p)}normalizeSpriteURL(i,a,p,g){const b=mt(i);return r.f(i)?(b.path=`/styles/v1${b.path}/sprite${a}${p}`,this._makeAPIURL(b,this._customAccessToken||g)):(b.path+=`${a}${p}`,et(b))}normalizeTileURL(i,a,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!r.f(i))return i;const g=mt(i);g.path=g.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${a||p&&g.authority!=="raster"&&p===512?"@2x":""}${r.m.supported?".webp":"$1"}`),g.authority==="raster"?g.path=`/${r.e.RASTER_URL_PREFIX}${g.path}`:g.authority==="rasterarrays"?g.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${g.path}`:g.authority==="3dtiles"?g.path=`/${r.e.TILES3D_URL_PREFIX}${g.path}`:(g.path=g.path.replace(/^.+\/v4\//,"/"),g.path=`/${r.e.TILE_URL_VERSION}${g.path}`);const b=this._customAccessToken||function(T){for(const M of T){const O=M.match(/^access_token=(.*)$/);if(O)return O[1]}return null}(g.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&b&&this._skuToken&&g.params.push(`sku=${this._skuToken}`),this._makeAPIURL(g,b)}canonicalizeTileURL(i,a){const p=mt(i);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return i;let g="mapbox://";p.path.match(/^\/raster\/v1\//)?g+=`raster/${p.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?g+=`rasterarrays/${p.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:g+=`tiles/${p.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let b=p.params;return a&&(b=b.filter(T=>!T.match(/^access_token=/))),b.length&&(g+=`?${b.join("&")}`),g}canonicalizeTileset(i,a){const p=!!a&&r.f(a),g=[];for(const b of i.tiles||[])r.h(b)?g.push(this.canonicalizeTileURL(b,p)):g.push(b);return g}_makeAPIURL(i,a){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",g=mt(r.e.API_URL);if(i.protocol=g.protocol,i.authority=g.authority,i.protocol==="http"){const b=i.params.indexOf("secure");b>=0&&i.params.splice(b,1)}if(g.path!=="/"&&(i.path=`${g.path}${i.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return et(i);if(a=a||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!a)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(a[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return i.params=i.params.filter(b=>b.indexOf("access_token")===-1),i.params.push(`access_token=${a||""}`),et(i)}}const ct=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function mt(f){const i=f.match(ct);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function et(f){const i=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${i}`}const Qe="mapbox.eventData";function vt(f){if(!f)return null;const i=f.split(".");if(!i||i.length!==3)return null;try{return JSON.parse(r.j(i[1]))}catch{return null}}class st{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const a=vt(r.e.ACCESS_TOKEN);let p="";return p=a&&a.u?r.k(a.u):r.e.ACCESS_TOKEN||"",i?`${Qe}.${i}:${p}`:`${Qe}:${p}`}fetchEventData(){const i=r.s("localStorage"),a=this.getStorageKey(),p=this.getStorageKey("uuid");if(i)try{const g=localStorage.getItem(a);g&&(this.eventData=JSON.parse(g));const b=localStorage.getItem(p);b&&(this.anonId=b)}catch{r.w("Unable to read from LocalStorage")}}saveEventData(){const i=r.s("localStorage"),a=this.getStorageKey(),p=this.getStorageKey("uuid"),g=this.anonId;if(i&&g)try{localStorage.setItem(p,g),Object.keys(this.eventData).length>=1&&localStorage.setItem(a,JSON.stringify(this.eventData))}catch{r.w("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,a,p,g){if(!r.e.EVENTS_URL)return;const b=mt(r.e.EVENTS_URL);b.params.push(`access_token=${g||r.e.ACCESS_TOKEN||""}`);const T={event:this.type,created:new Date(i).toISOString()},M=a?r.l(T,a):T,O={url:et(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=r.p(O,L=>{this.pendingRequest=null,p(L),this.saveEventData(),this.processRequests(g)})}queueRequest(i,a){this.queue.push(i),this.processRequests(a)}}const Zt=new class extends st{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,i){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some(a=>r.f(a)||r.h(a))&&this.queueRequest(Date.now(),i)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=vt(r.e.ACCESS_TOKEN),a=i?i.u:r.e.ACCESS_TOKEN;let p=a!==this.eventData.tokenU;r.v(this.anonId)||(this.anonId=r.u(),p=!0);const g=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),T=new Date(g),M=(g-this.eventData.lastSuccess)/864e5;p=p||M>=1||M<-1||b.getDate()!==T.getDate()}else p=!0;p?this.postEvent(g,{sdkIdentifier:"mapbox-gl-js",sdkVersion:D,skuId:De,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=g,this.eventData.tokenU=a)},f):this.processRequests()}},ui=Zt.postTurnstileEvent.bind(Zt),ni=new class extends st{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,i,a,p){this.skuToken=i,this.errorCb=p,r.e.EVENTS_URL&&(a||r.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},a):this.errorCb(new Error(Ge)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:a}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),r.v(this.anonId)||(this.anonId=r.u()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:D,skuId:De,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):i&&(this.success[i]=!0)},f))}remove(){this.errorCb=null}},Hi=ni.postMapLoadEvent.bind(ni),Ci=new class extends st{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let i=this.mapInstanceIdMap.get(f);return i||(i=r.u(),this.mapInstanceIdMap.set(f,i)),i}getEventId(f){const i=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,i+1),i}postStyleLoadEvent(f,i){const{map:a,style:p,importedStyles:g}=i;if(!r.e.EVENTS_URL||!f&&!r.e.ACCESS_TOKEN)return;const b=this.getMapInstanceId(a),T={mapInstanceId:b,eventId:this.getEventId(b),style:p};g.length&&(T.importedStyles=g),this.queueRequest({timestamp:Date.now(),payload:T},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,payload:a}=this.queue.shift();this.postEvent(i,a,()=>{},f)}},Ii=Ci.postStyleLoadEvent.bind(Ci),Ui=new class extends st{constructor(){super("gljs.performance")}postPerformanceEvent(f,i){r.e.EVENTS_URL&&(f||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,performanceData:a}=this.queue.shift(),p=function(g){const b=performance.getEntriesByType("resource"),T=performance.getEntriesByType("mark"),M=function(Z){const ce={};if(Z){for(const te in Z)if(te!=="other")for(const _e of Z[te]){const me=`${te}ResolveRangeMin`,Se=`${te}ResolveRangeMax`,ke=`${te}RequestCount`,Oe=`${te}RequestCachedCount`;ce[me]=Math.min(ce[me]||1/0,_e.startTime),ce[Se]=Math.max(ce[Se]||-1/0,_e.responseEnd);const je=Ve=>{ce[Ve]===void 0&&(ce[Ve]=0),++ce[Ve]};_e.transferSize!==void 0&&_e.transferSize===0&&je(Oe),je(ke)}}return ce}(function(Z,ce){const te={};if(Z)for(const _e of Z){const me=ce(_e);te[me]===void 0&&(te[me]=[]),te[me].push(_e)}return te}(b,N)),O=window.devicePixelRatio,L=navigator.connection||navigator.mozConnection||navigator.webkitConnection,k=L?L.effectiveType:void 0,U={counters:[],metadata:[],attributes:[]},j=(Z,ce,te)=>{te!=null&&Z.push({name:ce,value:te.toString()})};for(const Z in M)j(U.counters,Z,M[Z]);if(g.interactionRange[0]!==1/0&&g.interactionRange[1]!==-1/0&&(j(U.counters,"interactionRangeMin",g.interactionRange[0]),j(U.counters,"interactionRangeMax",g.interactionRange[1])),T)for(const Z of Object.keys(B)){const ce=B[Z],te=T.find(_e=>_e.name===ce);te&&j(U.counters,ce,te.startTime)}return j(U.counters,"visibilityHidden",g.visibilityHidden),j(U.attributes,"style",function(Z){if(Z)for(const ce of Z){const te=ce.name.split("?")[0];if(r.i(te)){const _e=te.split("/").slice(-2);if(_e.length===2)return`mapbox://styles/${_e[0]}/${_e[1]}`}}}(b)),j(U.attributes,"terrainEnabled",g.terrainEnabled?"true":"false"),j(U.attributes,"fogEnabled",g.fogEnabled?"true":"false"),j(U.attributes,"projection",g.projection),j(U.attributes,"zoom",g.zoom),j(U.metadata,"devicePixelRatio",O),j(U.metadata,"connectionEffectiveType",k),j(U.metadata,"navigatorUserAgent",navigator.userAgent),j(U.metadata,"screenWidth",window.screen.width),j(U.metadata,"screenHeight",window.screen.height),j(U.metadata,"windowWidth",window.innerWidth),j(U.metadata,"windowHeight",window.innerHeight),j(U.metadata,"mapWidth",g.width/O),j(U.metadata,"mapHeight",g.height/O),j(U.metadata,"webglRenderer",g.renderer),j(U.metadata,"webglVendor",g.vendor),j(U.metadata,"sdkVersion",D),j(U.metadata,"sdkIdentifier","mapbox-gl-js"),U}(a);for(const g of p.metadata);for(const g of p.counters);for(const g of p.attributes);this.postEvent(i,p,()=>{},f)}},xi=Ui.postPerformanceEvent.bind(Ui),Yi=new class extends st{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,i,a,p){if(!r.e.API_URL||!r.e.SESSION_PATH)return;const g=mt(r.e.API_URL+r.e.SESSION_PATH);g.params.push(`sku=${i||""}`),g.params.push(`access_token=${p||r.e.ACCESS_TOKEN||""}`);const b={url:et(g),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(b,T=>{this.pendingRequest=null,a(T),this.saveEventData(),this.processRequests(p)})}getSessionAPI(f,i,a,p){this.skuToken=i,this.errorCb=p,r.e.SESSION_PATH&&r.e.API_URL&&(a||r.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},a):this.errorCb(new Error(Ge)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:a}=this.queue.shift();i&&this.success[i]||this.getSession(a,this.skuToken,p=>{p?this.errorCb(p):i&&(this.success[i]=!0)},f)}remove(){this.errorCb=null}},H=Yi.getSessionAPI.bind(Yi),be=new Set;function Be(f,i){i?be.add(f):be.delete(f)}class Ee{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(i,a){this._updatedSourceCaches[i]=a,this.setDirty()}discardSourceCacheUpdate(i){delete this._updatedSourceCaches[i]}updateLayer(i){const a=i.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(i.id),this.setDirty()}removeLayer(i){const a=i.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][i.id]=i,this._updatedLayers[a].delete(i.id),this._updatedPaintProps.delete(i.fqid),this.setDirty()}getRemovedLayer(i){return this._removedLayers[i.scope]?this._removedLayers[i.scope][i.id]:null}discardLayerRemoval(i){this._removedLayers[i.scope]&&delete this._removedLayers[i.scope][i.id]}getLayerUpdatesByScope(){const i={};for(const a in this._updatedLayers)i[a]=i[a]||{},i[a].updatedIds=Array.from(this._updatedLayers[a].values());for(const a in this._removedLayers)i[a]=i[a]||{},i[a].removedIds=Object.keys(this._removedLayers[a]);return i}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(i){this._updatedPaintProps.add(i.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(i){this._updatedImages.add(i),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function ve(f){const{userImage:i}=f;return!!(i&&i.render&&i.render())&&(f.data.replace(new Uint8Array(i.data.buffer)),!0)}class Ie extends r.E{constructor(i){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=i,i!=="raster"&&r.t()&&(this.imageRasterizerDispatcher=new r.D(r.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.I),this._imageRasterizer}createScope(i){this.images[i]={},this.loaded[i]=!1,this.updatedImages[i]={},this.patterns[i]={},this.callbackDispatchedThisFrame[i]={},this.atlasImage[i]=new r.r({width:1,height:1})}isLoaded(){for(const i in this.loaded)if(!this.loaded[i])return!1;return!0}setLoaded(i,a){if(this.loaded[a]!==i&&(this.loaded[a]=i,i)){for(const{ids:p,callback:g}of this.requestors)this._notify(p,a,g);this.requestors=[]}}hasImage(i,a){return!!this.getImage(i,a)}getImage(i,a){return this.images[a][i]}addImage(i,a,p){this._validate(i,p)&&(this.images[a][i]=p)}_validate(i,a){let p=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new r.y(new Error(`Image "${i}" has invalid "stretchX" value`))),p=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new r.y(new Error(`Image "${i}" has invalid "stretchY" value`))),p=!1),this._validateContent(a.content,a)||(this.fire(new r.y(new Error(`Image "${i}" has invalid "content" value`))),p=!1),p}_validateStretch(i,a){if(!i)return!0;let p=0;for(const g of i){if(g[0]<p||g[1]<g[0]||a<g[1])return!1;p=g[1]}return!0}_validateContent(i,a){return i?i.length!==4||!a.usvg&&(i[0]<0||a.data.width<i[0]||i[1]<0||a.data.height<i[1]||i[2]<0||a.data.width<i[2]||i[3]<0||a.data.height<i[3])?!1:!(i[2]<i[0]||i[3]<i[1]):!0}updateImage(i,a,p){p.version=this.images[a][i].version+1,this.images[a][i]=p,this.updatedImages[a][i]=!0,this.removeFromImageRasterizerCache(i,a)}removeFromImageRasterizerCache(i,a){this.spriteFormat!=="raster"&&(r.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[i],scope:a}):this.imageRasterizer.removeImagesFromCacheByIds([i],a))}removeImage(i,a){const p=this.images[a][i];delete this.images[a][i],delete this.patterns[a][i],this.removeFromImageRasterizerCache(i,a),p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(i){return Object.keys(this.images[i])}getImages(i,a,p){let g=!0;const b=!!this.loaded[a];if(!b)for(const T of i)this.images[a][T]||(g=!1);b||g?this._notify(i,a,p):this.requestors.push({ids:i,scope:a,callback:p})}rasterizeImages({scope:i,imageTasks:a},p){const g={};for(const b in a){const T=a[b],M=this.getImage(T.id,i);M&&(g[b]={image:M,imageIdWithOptions:T})}r.t()?this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{imageTasks:g,scope:i},p):this.rasterizeImagesInMainThread({imageTasks:g,scope:i},p)}rasterizeImagesInMainThread(i,a){const{imageTasks:p,scope:g}=i,b={};for(const T in p){const{image:M,imageIdWithOptions:O}=p[T];b[T]=this.imageRasterizer.rasterize(O,M,g,"")}a(void 0,b)}getUpdatedImages(i){return this.updatedImages[i]}_notify(i,a,p){const g={};for(const b of i){this.images[a][b]||this.fire(new r.z("styleimagemissing",{id:b}));const T=this.images[a][b];T?g[b]={data:T.usvg?null:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,usvg:T.usvg,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:!!(T.userImage&&T.userImage.render)}:r.w(`Image "${b}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}p(null,g)}getPixelSize(i){const{width:a,height:p}=this.atlasImage[i];return{width:a,height:p}}getPattern(i,a,p){const g=this.patterns[a][i],b=this.getImage(i,a);if(!b)return null;if(g&&g.position.version===b.version)return g.position;if(g)g.position.version=b.version;else{b.usvg&&!b.data&&(b.data=this.imageRasterizer.rasterize(r.A.from(i).getPrimary(),b,a,""));const T={w:b.data.width+2*r.B,h:b.data.height+2*r.B,x:0,y:0},M=new r.C(T,b,r.B);this.patterns[a][i]={bin:T,position:M}}return this._updatePatternAtlas(a,p),this.patterns[a][i].position}bind(i,a){const p=i.gl;let g=this.atlasTexture[a];g?this.dirty&&(g.update(this.atlasImage[a]),this.dirty=!1):(g=new r.T(i,this.atlasImage[a],p.RGBA8),this.atlasTexture[a]=g),g.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(i,a){const p=[];for(const M in this.patterns[i])p.push(this.patterns[i][M].bin);const{w:g,h:b}=r.F(p),T=this.atlasImage[i];T.resize({width:g||1,height:b||1});for(const M in this.patterns[i]){const{bin:O,position:L}=this.patterns[i][M];let k=L.padding;const U=O.x+k,j=O.y+k,Z=this.images[i][M].data,ce=Z.width,te=Z.height;k=k>1?k-1:k,r.r.copy(Z,T,{x:0,y:0},{x:U,y:j},{width:ce,height:te},a),r.r.copy(Z,T,{x:0,y:te-k},{x:U,y:j-k},{width:ce,height:k},a),r.r.copy(Z,T,{x:0,y:0},{x:U,y:j+te},{width:ce,height:k},a),r.r.copy(Z,T,{x:ce-k,y:0},{x:U-k,y:j},{width:k,height:te},a),r.r.copy(Z,T,{x:0,y:0},{x:U+ce,y:j},{width:k,height:te},a),r.r.copy(Z,T,{x:ce-k,y:te-k},{x:U-k,y:j-k},{width:k,height:k},a),r.r.copy(Z,T,{x:0,y:te-k},{x:U+ce,y:j-k},{width:k,height:k},a),r.r.copy(Z,T,{x:0,y:0},{x:U+ce,y:j+te},{width:k,height:k},a),r.r.copy(Z,T,{x:ce-k,y:0},{x:U-k,y:j+te},{width:k,height:k},a)}this.dirty=!0}beginFrame(){for(const i in this.images)this.callbackDispatchedThisFrame[i]={}}dispatchRenderCallbacks(i,a){for(const p of i){if(this.callbackDispatchedThisFrame[a][p])continue;this.callbackDispatchedThisFrame[a][p]=!0;const g=this.images[a][p];ve(g)&&this.updateImage(p,a,g)}}}function Tt(f){const i=f.key,a=f.value,p=f.valueSpec||{},g=f.objectElementValidators||{},b=f.style,T=f.styleSpec;let M=[];const O=r.H(a);if(O!=="object")return[new r.V(i,a,`object expected, ${O} found`)];for(const L in a){const k=L.split(".")[0];let U;g[k]?U=g[k]:p[k]?U=Vi:g["*"]?U=g["*"]:p["*"]&&(U=Vi),U?M=M.concat(U({key:(i&&`${i}.`)+L,value:a[L],valueSpec:p[k]||p["*"],style:b,styleSpec:T,object:a,objectKey:L},a)):M.push(new r.G(i,a[L],`unknown property "${L}"`))}for(const L in p)g[L]||p[L].required&&p[L].default===void 0&&a[L]===void 0&&M.push(new r.V(i,a,`missing required property "${L}"`));return M}function qe(f){const i=f.value,a=f.valueSpec,p=f.style,g=f.styleSpec,b=f.key,T=f.arrayElementValidator||Vi;if(r.H(i)!=="array")return[new r.V(b,i,`array expected, ${r.H(i)} found`)];if(a.length&&i.length!==a.length)return[new r.V(b,i,`array length ${a.length} expected, length ${i.length} found`)];if(a["min-length"]&&i.length<a["min-length"])return[new r.V(b,i,`array length at least ${a["min-length"]} expected, length ${i.length} found`)];let M={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};g.$version<7&&(M.function=a.function),r.H(a.value)==="object"&&(M=a.value);let O=[];for(let L=0;L<i.length;L++)O=O.concat(T({array:i,arrayIndex:L,value:i[L],valueSpec:M,style:p,styleSpec:g,key:`${b}[${L}]`},!0));return O}function Et(f){const i=f.key,a=f.value,p=f.valueSpec;let g=r.H(a);if(g==="number"&&a!=a&&(g="NaN"),g!=="number")return[new r.V(i,a,`number expected, ${g} found`)];if("minimum"in p){let b=p.minimum;if(r.H(p.minimum)==="array"&&(b=p.minimum[f.arrayIndex]),a<b)return[new r.V(i,a,`${a} is less than the minimum value ${b}`)]}if("maximum"in p){let b=p.maximum;if(r.H(p.maximum)==="array"&&(b=p.maximum[f.arrayIndex]),a>b)return[new r.V(i,a,`${a} is greater than the maximum value ${b}`)]}return[]}function It(f){const i=f.valueSpec,a=r.K(f.value.type);let p,g,b,T={};const M=a!=="categorical"&&f.value.property===void 0,O=!M,L=r.H(f.value.stops)==="array"&&r.H(f.value.stops[0])==="array"&&r.H(f.value.stops[0][0])==="object",k=Tt({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(Z){if(a==="identity")return[new r.V(Z.key,Z.value,'identity function may not have a "stops" property')];let ce=[];const te=Z.value;return ce=ce.concat(qe({key:Z.key,value:te,valueSpec:Z.valueSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:U})),r.H(te)==="array"&&te.length===0&&ce.push(new r.V(Z.key,te,"array must have at least one stop")),ce},default:function(Z){return Vi({key:Z.key,value:Z.value,valueSpec:i,style:Z.style,styleSpec:Z.styleSpec})}}});return a==="identity"&&M&&k.push(new r.V(f.key,f.value,'missing required property "property"')),a==="identity"||f.value.stops||k.push(new r.V(f.key,f.value,'missing required property "stops"')),a==="exponential"&&f.valueSpec.expression&&!r.L(f.valueSpec)&&k.push(new r.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(O&&!r.M(f.valueSpec)?k.push(new r.V(f.key,f.value,"property functions not supported")):M&&!r.N(f.valueSpec)&&k.push(new r.V(f.key,f.value,"zoom functions not supported"))),a!=="categorical"&&!L||f.value.property!==void 0||k.push(new r.V(f.key,f.value,'"property" property is required')),k;function U(Z){let ce=[];const te=Z.value,_e=Z.key;if(r.H(te)!=="array")return[new r.V(_e,te,`array expected, ${r.H(te)} found`)];if(te.length!==2)return[new r.V(_e,te,`array length 2 expected, length ${te.length} found`)];if(L){if(r.H(te[0])!=="object")return[new r.V(_e,te,`object expected, ${r.H(te[0])} found`)];if(te[0].zoom===void 0)return[new r.V(_e,te,"object stop key must have zoom")];if(te[0].value===void 0)return[new r.V(_e,te,"object stop key must have value")];const me=r.K(te[0].zoom);if(typeof me!="number")return[new r.V(_e,te[0].zoom,"stop zoom values must be numbers")];if(b&&b>me)return[new r.V(_e,te[0].zoom,"stop zoom values must appear in ascending order")];me!==b&&(b=me,g=void 0,T={}),ce=ce.concat(Tt({key:`${_e}[0]`,value:te[0],valueSpec:{zoom:{}},style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:Et,value:j}}))}else ce=ce.concat(j({key:`${_e}[0]`,value:te[0],valueSpec:{},style:Z.style,styleSpec:Z.styleSpec},te));return r.O(r.Q(te[1]))?ce.concat([new r.V(`${_e}[1]`,te[1],"expressions are not allowed in function stops.")]):ce.concat(Vi({key:`${_e}[1]`,value:te[1],valueSpec:i,style:Z.style,styleSpec:Z.styleSpec}))}function j(Z,ce){const te=r.H(Z.value),_e=r.K(Z.value),me=Z.value!==null?Z.value:ce;if(p){if(te!==p)return[new r.V(Z.key,me,`${te} stop domain type must match previous stop domain type ${p}`)]}else p=te;if(te!=="number"&&te!=="string"&&te!=="boolean"&&typeof _e!="number"&&typeof _e!="string"&&typeof _e!="boolean")return[new r.V(Z.key,me,"stop domain value must be a number, string, or boolean")];if(te!=="number"&&a!=="categorical"){let Se=`number expected, ${te} found`;return r.M(i)&&a===void 0&&(Se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(Z.key,me,Se)]}return a!=="categorical"||te!=="number"||typeof _e=="number"&&isFinite(_e)&&Math.floor(_e)===_e?a!=="categorical"&&te==="number"&&typeof _e=="number"&&typeof g=="number"&&g!==void 0&&_e<g?[new r.V(Z.key,me,"stop domain values must appear in ascending order")]:(g=_e,a==="categorical"&&_e in T?[new r.V(Z.key,me,"stop domain values must be unique")]:(T[_e]=!0,[])):[new r.V(Z.key,me,`integer expected, found ${String(_e)}`)]}}function $t(f){const i=(f.expressionContext==="property"?r.S:r.U)(r.Q(f.value),f.valueSpec);if(i.result==="error")return i.value.map(p=>new r.V(`${f.key}${p.key}`,f.value,p.message));const a=i.value.expression||i.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!a.outputDefined())return[new r.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!r.W(a))return[new r.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return Kt(a,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!r.X(a,["zoom","feature-state"]))return[new r.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!r.Y(a))return[new r.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Kt(f,i){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const g of i.valueSpec.expression.parameters)a.delete(g);if(a.size===0)return[];const p=[];return f instanceof r.Z&&a.has(f.name)?[new r.V(i.key,i.value,`["${f.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(f.eachChild(g=>{p.push(...Kt(g,i))}),p)}function ti(f){const i=f.key,a=f.value,p=f.valueSpec,g=[];return Array.isArray(p.values)?p.values.indexOf(r.K(a))===-1&&g.push(new r.V(i,a,`expected one of [${p.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(p.values).indexOf(r.K(a))===-1&&g.push(new r.V(i,a,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(a)} found`)),g}function Li(f){return r.$(r.Q(f.value))?$t(r.J({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):Ut(f)}function Ut(f){const i=f.value,a=f.key;if(r.H(i)!=="array")return[new r.V(a,i,`array expected, ${r.H(i)} found`)];const p=f.styleSpec;let g,b=[];if(i.length<1)return[new r.V(a,i,"filter array must have at least 1 element")];switch(b=b.concat(ti({key:`${a}[0]`,value:i[0],valueSpec:p.filter_operator,style:f.style,styleSpec:f.styleSpec})),r.K(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&r.K(i[1])==="$type"&&b.push(new r.V(a,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&b.push(new r.V(a,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(g=r.H(i[1]),g!=="string"&&b.push(new r.V(`${a}[1]`,i[1],`string expected, ${g} found`)));for(let T=2;T<i.length;T++)g=r.H(i[T]),r.K(i[1])==="$type"?b=b.concat(ti({key:`${a}[${T}]`,value:i[T],valueSpec:p.geometry_type,style:f.style,styleSpec:f.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&b.push(new r.V(`${a}[${T}]`,i[T],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let T=1;T<i.length;T++)b=b.concat(Ut({key:`${a}[${T}]`,value:i[T],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":g=r.H(i[1]),i.length!==2?b.push(new r.V(a,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="string"&&b.push(new r.V(`${a}[1]`,i[1],`string expected, ${g} found`))}return b}function yi(f,i){const a=f.key,p=f.style,g=f.layer,b=f.styleSpec,T=f.value,M=f.objectKey,O=b[`${i}_${f.layerType}`];if(!O)return[];const L=M.match(/^(.*)-use-theme$/);if(i==="paint"&&L&&O[L[1]])return r.O(T)?[].concat(Vi({key:f.key,value:T,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:p,styleSpec:b,expressionContext:"property",propertyType:i,propertyKey:M})):Vi({key:a,value:T,valueSpec:{type:"string"},style:p,styleSpec:b});const k=M.match(/^(.*)-transition$/);if(i==="paint"&&k&&O[k[1]]&&O[k[1]].transition)return Vi({key:a,value:T,valueSpec:b.transition,style:p,styleSpec:b});const U=f.valueSpec||O[M];if(!U)return[new r.G(a,T,`unknown property "${M}"`)];let j;if(r.H(T)==="string"&&r.M(U)&&!U.tokens&&(j=/^{([^}]+)}$/.exec(T))){const ce=`\`{ "type": "identity", "property": ${j?JSON.stringify(j[1]):'"_"'} }\``;return[new r.V(a,T,`"${M}" does not support interpolation syntax
Use an identity property function instead: ${ce}.`)]}const Z=[];if(f.layerType==="symbol")M!=="text-field"||!p||p.glyphs||p.imports||Z.push(new r.V(a,T,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&r.a0(r.Q(T))&&r.K(T.type)==="identity"&&Z.push(new r.V(a,T,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&i==="paint"&&g&&g.layout&&g.layout.hasOwnProperty("model-id")&&r.M(U)&&(r.a1(U)||r.N(U))){const ce=r.S(r.Q(T),U),te=ce.value.expression||ce.value._styleExpression.expression;te&&!r.X(te,["measure-light"])&&(M==="model-emissive-strength"&&r.Y(te)&&r.W(te)||Z.push(new r.V(a,T,`${M} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return Z.concat(Vi({key:f.key,value:T,valueSpec:U,style:p,styleSpec:b,expressionContext:"property",propertyType:i,propertyKey:M}))}function zi(f){return yi(f,"paint")}function Ni(f){return yi(f,"layout")}function Ki(f){let i=[];const a=f.value,p=f.key,g=f.style,b=f.styleSpec;a.type||a.ref||i.push(new r.V(p,a,'either "type" or "ref" is required'));let T=r.K(a.type);const M=r.K(a.ref);if(a.id){const O=r.K(a.id);for(let L=0;L<f.arrayIndex;L++){const k=g.layers[L];r.K(k.id)===O&&i.push(new r.V(p,a.id,`duplicate layer id "${a.id}", previously used at line ${k.id.__line__}`))}}if("ref"in a){let O;["type","source","source-layer","filter","layout"].forEach(L=>{L in a&&i.push(new r.V(p,a[L],`"${L}" is prohibited for ref layers`))}),g.layers.forEach(L=>{r.K(L.id)===M&&(O=L)}),O?O.ref?i.push(new r.V(p,a.ref,"ref cannot reference another ref layer")):T=r.K(O.type):typeof M=="string"&&i.push(new r.V(p,a.ref,`ref layer "${M}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(a.source){const O=g.sources&&g.sources[a.source],L=O&&r.K(O.type);O?L==="vector"&&T==="raster"?i.push(new r.V(p,a.source,`layer "${a.id}" requires a raster source`)):L==="raster"&&T!=="raster"?i.push(new r.V(p,a.source,`layer "${a.id}" requires a vector source`)):L!=="vector"||a["source-layer"]?L==="raster-dem"&&T!=="hillshade"?i.push(new r.V(p,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="raster-array"||["raster","raster-particle"].includes(T)?T!=="line"||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||L==="geojson"&&O.lineMetrics?T==="raster-particle"&&L!=="raster-array"&&i.push(new r.V(p,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):i.push(new r.V(p,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new r.V(p,a.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new r.V(p,a,`layer "${a.id}" must specify a "source-layer"`)):i.push(new r.V(p,a.source,`source "${a.source}" not found`))}else i.push(new r.V(p,a,'missing required property "source"'));return i=i.concat(Tt({key:p,value:a,valueSpec:b.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Vi({key:`${p}.type`,value:a.type,valueSpec:b.layer.type,style:f.style,styleSpec:f.styleSpec,object:a,objectKey:"type"}),filter:O=>Li(r.J({layerType:T},O)),layout:O=>Tt({layer:a,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":L=>Ni(r.J({layerType:T},L))}}),paint:O=>Tt({layer:a,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":L=>zi(r.J({layerType:T,layer:a},L))}})}})),i}function sr(f){const i=f.value,a=f.key,p=r.H(i);return p!=="string"?[new r.V(a,i,`string expected, ${p} found`)]:[]}const Rr={promoteId:function f({key:i,value:a}){if(r.H(a)==="string")return sr({key:i,value:a});if(Array.isArray(a)){const p=[],g=r.Q(a),b=r.U(g);return b.result==="error"&&b.value.forEach(T=>{p.push(new r.V(`${i}${T.key}`,null,`${T.message}`))}),r.X(b.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||p.push(new r.V(`${i}`,null,"promoteId expression should be only feature dependent")),p}{const p=[];for(const g in a)p.push(...f({key:`${i}.${g}`,value:a[g]}));return p}}};function Yr(f){const i=f.value,a=f.key,p=f.styleSpec,g=f.style;if(!i.type)return[new r.V(a,i,'"type" is required')];const b=r.K(i.type);let T=[];switch(["vector","raster","raster-dem","raster-array"].includes(b)&&(i.url||i.tiles||T.push(new r.G(a,i,'Either "url" or "tiles" is required.'))),b){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(Tt({key:a,value:i,valueSpec:p[`source_${b.replace("-","_")}`],style:f.style,styleSpec:p,objectElementValidators:Rr})),T;case"geojson":if(T=Tt({key:a,value:i,valueSpec:p.source_geojson,style:g,styleSpec:p,objectElementValidators:Rr}),i.cluster)for(const M in i.clusterProperties){const[O,L]=i.clusterProperties[M],k=typeof O=="string"?[O,["accumulated"],["get",M]]:O;T.push(...$t({key:`${a}.${M}.map`,value:L,expressionContext:"cluster-map"})),T.push(...$t({key:`${a}.${M}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return T;case"video":return Tt({key:a,value:i,valueSpec:p.source_video,style:g,styleSpec:p});case"image":return Tt({key:a,value:i,valueSpec:p.source_image,style:g,styleSpec:p});case"canvas":return[new r.V(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ti({key:`${a}.type`,value:i.type,valueSpec:{values:kr(p)},style:g,styleSpec:p})}}function kr(f){return f.source.reduce((i,a)=>{const p=f[a];return p.type.type==="enum"&&(i=i.concat(Object.keys(p.type.values))),i},[])}function yr(f){const i=f.value,a=f.styleSpec,p=a.light,g=f.style;let b=[];const T=r.H(i);if(i===void 0)return b;if(T!=="object")return b=b.concat([new r.V("light",i,`object expected, ${T} found`)]),b;for(const M in i){const O=M.match(/^(.*)-transition$/),L=M.match(/^(.*)-use-theme$/);b=b.concat(L&&p[L[1]]?Vi({key:M,value:i[M],valueSpec:{type:"string"},style:g,styleSpec:a}):O&&p[O[1]]&&p[O[1]].transition?Vi({key:M,value:i[M],valueSpec:a.transition,style:g,styleSpec:a}):p[M]?Vi({key:M,value:i[M],valueSpec:p[M],style:g,styleSpec:a}):[new r.V(M,i[M],`unknown property "${M}"`)])}return b}function nn(f){const i=f.value;let a=[];if(!i)return a;const p=r.H(i);if(p!=="object")return a=a.concat([new r.V("light-3d",i,`object expected, ${p} found`)]),a;const g=f.styleSpec,b=g["light-3d"],T=f.key,M=f.style,O=f.style.lights;for(const U of["type","id"])if(!(U in i))return a=a.concat([new r.V("light-3d",i,`missing property ${U} on light`)]),a;if(i.type&&O)for(let U=0;U<f.arrayIndex;U++){const j=r.K(i.type),Z=O[U];r.K(Z.type)===j&&a.push(new r.V(T,i.id,`duplicate light type "${i.type}", previously defined at line ${Z.id.__line__}`))}const L=`properties_light_${i.type}`;if(!(L in g))return a=a.concat([new r.V("light-3d",i,`Invalid light type ${i.type}`)]),a;const k=g[L];for(const U in i)if(U==="properties"){const j=i[U],Z=r.H(j);if(Z!=="object")return a=a.concat([new r.V("properties",j,`object expected, ${Z} found`)]),a;for(const ce in j)a=a.concat(k[ce]?Vi({key:ce,value:j[ce],valueSpec:k[ce],style:M,styleSpec:g}):[new r.G(f.key,j[ce],`unknown property "${ce}"`)])}else{const j=U.match(/^(.*)-transition$/),Z=U.match(/^(.*)-use-theme$/);a=a.concat(Z&&b[Z[1]]?Vi({key:U,value:i[U],valueSpec:{type:"string"},style:M,styleSpec:g}):j&&b[j[1]]&&b[j[1]].transition?Vi({key:U,value:i[U],valueSpec:g.transition,style:M,styleSpec:g}):b[U]?Vi({key:U,value:i[U],valueSpec:b[U],style:M,styleSpec:g}):[new r.G(U,i[U],`unknown property "${U}"`)])}return a}function Ts(f){const i=f.value,a=f.key,p=f.style,g=f.styleSpec,b=g.terrain;let T=[];const M=r.H(i);if(i===void 0||M==="null")return T;if(M!=="object")return T=T.concat([new r.V("terrain",i,`object expected, ${M} found`)]),T;for(const O in i){const L=O.match(/^(.*)-transition$/),k=O.match(/^(.*)-use-theme$/);T=T.concat(k&&b[k[1]]?Vi({key:O,value:i[O],valueSpec:{type:"string"},style:p,styleSpec:g}):L&&b[L[1]]&&b[L[1]].transition?Vi({key:O,value:i[O],valueSpec:g.transition,style:p,styleSpec:g}):b[O]?Vi({key:O,value:i[O],valueSpec:b[O],style:p,styleSpec:g}):[new r.G(O,i[O],`unknown property "${O}"`)])}if(i.source){const O=p.sources&&p.sources[i.source],L=O&&r.K(O.type);O?L!=="raster-dem"&&T.push(new r.V(a,i.source,`terrain cannot be used with a source of type ${String(L)}, it only be used with a "raster-dem" source type`)):T.push(new r.V(a,i.source,`source "${i.source}" not found`))}else T.push(new r.V(a,i,'terrain is missing required property "source"'));return T}function Ar(f){const i=f.value,a=f.style,p=f.styleSpec,g=p.fog;let b=[];const T=r.H(i);if(i===void 0)return b;if(T!=="object")return b=b.concat([new r.V("fog",i,`object expected, ${T} found`)]),b;for(const M in i){const O=M.match(/^(.*)-transition$/),L=M.match(/^(.*)-use-theme$/);b=b.concat(L&&g[L[1]]?Vi({key:M,value:i[M],valueSpec:{type:"string"},style:a,styleSpec:p}):O&&g[O[1]]&&g[O[1]].transition?Vi({key:M,value:i[M],valueSpec:p.transition,style:a,styleSpec:p}):g[M]?Vi({key:M,value:i[M],valueSpec:g[M],style:a,styleSpec:p}):[new r.G(M,i[M],`unknown property "${M}"`)])}return b}const Ur={"*":()=>[],array:qe,boolean:function(f){const i=f.value,a=f.key,p=r.H(i);return p!=="boolean"?[new r.V(a,i,`boolean expected, ${p} found`)]:[]},number:Et,color:function(f){const i=f.key,a=f.value,p=r.H(a);return p!=="string"?[new r.V(i,a,`color expected, ${p} found`)]:r._.parseCSSColor(a)===null?[new r.V(i,a,`color expected, "${a}" found`)]:[]},enum:ti,filter:Li,function:It,layer:Ki,object:Tt,source:Yr,model:r.a2,light:yr,"light-3d":nn,terrain:Ts,fog:Ar,string:sr,formatted:function(f){return sr(f).length===0?[]:$t(f)},resolvedImage:function(f){return sr(f).length===0?[]:$t(f)},projection:function(f){const i=f.value,a=f.styleSpec,p=a.projection,g=f.style;let b=[];const T=r.H(i);if(T==="object")for(const M in i)b=b.concat(Vi({key:M,value:i[M],valueSpec:p[M],style:g,styleSpec:a}));else T!=="string"&&(b=b.concat([new r.V("projection",i,`object or string expected, ${T} found`)]));return b},import:function(f){const{value:i,styleSpec:a}=f,{data:p,...g}=i;Object.defineProperty(g,"__line__",{value:i.__line__,enumerable:!1});let b=Tt(r.J({},f,{value:g,valueSpec:a.import}));return r.K(g.id)===""&&b.push(new r.V(`${f.key}.id`,g,"import id can't be an empty string")),p&&(b=b.concat(Rn(p,a,{key:`${f.key}.data`}))),b}};function Vi(f,i=!1){const a=f.value,p=f.valueSpec,g=f.styleSpec;if(p.expression&&r.a0(r.K(a)))return It(f);if(p.expression&&r.O(r.Q(a)))return $t(f);if(p.type&&Ur[p.type]){const b=Ur[p.type](f);return i===!0&&b.length>0&&r.H(f.value)==="array"?$t(f):b}return Tt(r.J({},f,{valueSpec:p.type?g[p.type]:p}))}function Zi(f){const i=f.value,a=f.key,p=sr(f);return p.length||(i.indexOf("{fontstack}")===-1&&p.push(new r.V(a,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&p.push(new r.V(a,i,'"glyphs" url must include a "{range}" token'))),p}function Rn(f,i=r.a3,a={}){return Vi({key:a.key||"",value:f,valueSpec:i.$root,styleSpec:i,style:f,objectElementValidators:{glyphs:Zi,"*":()=>[]}})}function tr(f,i=r.a3){return Ji(Rn(f,i))}const Yn=f=>Ji(Yr(f)),xn=f=>Ji(yr(f)),$n=f=>Ji(nn(f)),Dn=f=>Ji(Ts(f)),Hs=f=>Ji(Ar(f)),Rs=f=>Ji(function(i){const a=i.value,p=i.style,g=i.styleSpec,b=g.snow;let T=[];const M=r.H(a);if(a===void 0)return T;if(M!=="object")return T=T.concat([new r.V("snow",a,`object expected, ${M} found`)]),T;for(const O in a){const L=O.match(/^(.*)-transition$/);T=T.concat(L&&b[L[1]]&&b[L[1]].transition?Vi({key:O,value:a[O],valueSpec:g.transition,style:p,styleSpec:g}):b[O]?Vi({key:O,value:a[O],valueSpec:b[O],style:p,styleSpec:g}):[new r.G(O,a[O],`unknown property "${O}"`)])}return T}(f)),vr=f=>Ji(function(i){const a=i.value,p=i.style,g=i.styleSpec,b=g.rain;let T=[];const M=r.H(a);if(a===void 0)return T;if(M!=="object")return T=T.concat([new r.V("rain",a,`object expected, ${M} found`)]),T;for(const O in a){const L=O.match(/^(.*)-transition$/);T=T.concat(L&&b[L[1]]&&b[L[1]].transition?Vi({key:O,value:a[O],valueSpec:g.transition,style:p,styleSpec:g}):b[O]?Vi({key:O,value:a[O],valueSpec:b[O],style:p,styleSpec:g}):[new r.G(O,a[O],`unknown property "${O}"`)])}return T}(f)),or=f=>Ji(Ki(f)),lr=f=>Ji(Li(f)),Pi=f=>Ji(zi(f)),br=f=>Ji(Ni(f)),ir=f=>Ji(r.a2(f));function Ji(f){return f.slice().sort((i,a)=>i.line&&a.line?i.line-a.line:0)}function gn(f,i){let a=!1;if(i&&i.length)for(const p of i)p instanceof r.G?r.w(p.message):(f.fire(new r.y(new Error(p.message))),a=!0);return a}let ot;class ee extends r.E{constructor(i,a="flat"){super(),this._transitionable=new r.a4(ot||(ot=new r.a5({anchor:new r.a6(r.a3.light.anchor),position:new r.a7(r.a3.light.position),color:new r.a6(r.a3.light.color),intensity:new r.a6(r.a3.light.intensity)}))),this.setLight(i,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,a,p={}){this._validate(xn,i,p)||(this._transitionable.setTransitionOrValue(i),this.id=a)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,a,p){return(!p||p.validate!==!1)&&gn(this,i.call(tr,r.l({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}}let de=class extends r.E{constructor(f,i,a,p){super(),this.scope=a,this._transitionable=new r.a4(new r.a5({source:new r.a6(r.a3.terrain.source),exaggeration:new r.a6(r.a3.terrain.exaggeration)}),a,p),this._transitionable.setTransitionOrValue(f,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(f,i){this._transitionable.setTransitionOrValue(f,i)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new r.a8(f)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const f=this._transitionable._values.exaggeration;if(!f)return null;const i=f.value.expression;if(!i)return null;let a=-1,p=-1,g=1;for(const b of i.zoomStops)g=i.evaluate(new r.a8(b)),g>.01?(a=b,p=-1):p=b;return g<.01&&a>0&&p>a?[a,p]:null}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof r.a9}};const we=45,ze=65,Le=.05;function Ze(f,i,a,p){const g=r.ac(we,ze,a),[b,T]=rt(f,p);let M=1-Math.min(1,Math.exp((i-b)/(T-b)*-6));return M*=M*M,M=Math.min(1,1.00747*M),M*g*f.alpha}function rt(f,i){const a=.5/Math.tan(.5*i);return[f.range[0]+a,f.range[1]+a]}function We(f,i,a,p,g){const b=r.ab.vec3.transformMat4([],[i,a,p],g.mercatorFogMatrix);return Ze(f,r.ab.vec3.length(b),g.pitch,g._fov)}function pt(f,i,a,p,g,b,T){const M=[[a,p,0],[g,p,0],[g,b,0],[a,b,0]];let O=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(const k of M){const U=r.ab.vec3.transformMat4([],k,i),j=r.ab.vec3.length(U);O=Math.min(O,j),L=Math.max(L,j)}return[Ze(f,O,T.pitch,T._fov),Ze(f,L,T.pitch,T._fov)]}class lt extends r.E{constructor(i,a,p,g){super();const b=new r.a5({range:new r.a6(r.a3.fog.range),color:new r.a6(r.a3.fog.color),"color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.a6(r.a3.fog["high-color"]),"high-color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.a6(r.a3.fog["space-color"]),"space-color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.a6(r.a3.fog["horizon-blend"]),"star-intensity":new r.a6(r.a3.fog["star-intensity"]),"vertical-range":new r.a6(r.a3.fog["vertical-range"])});this._transitionable=new r.a4(b,p,new Map(g)),this.set(i,g),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new r.ad(b),this.scope=p}get state(){const i=this._transform,a=i.projection.name==="globe",p=r.ae(i.zoom),g=this.properties.get("range"),b=[.5,3];return{range:a?[r.af(b[0],g[0],p),r.af(b[1],g[1],p)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,a,p={}){if(this._validate(Hs,i,p))return;const g=r.l({},i);for(const b of Object.keys(r.a3.fog))g[b]===void 0&&(g[b]=r.a3.fog[b].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.ac(we,ze,i))*a.a}getOpacityAtLatLng(i,a){return this._transform.projection.supportsFog?function(p,g,b){const T=r.aa.fromLngLat(g),M=b.elevation?b.elevation.getAtPointOrZero(T):0;return We(p,T.x,T.y,M,b)}(this.state,i,a):0}getOpacityForTile(i){if(!this._transform.projection.supportsFog)return[1,1];const a=this._transform.calculateFogTileMatrix(i.toUnwrapped());return pt(this.state,a,0,0,r.ag,r.ag,this._transform)}getOpacityForBounds(i,a,p,g,b){return this._transform.projection.supportsFog?pt(this.state,i,a,p,g,b,this._transform):[1,1]}getFovAdjustedRange(i){return this._transform.projection.supportsFog?rt(this.state,i):[0,1]}isVisibleOnFrustum(i){if(!this._transform.projection.supportsFog)return!1;const a=[4,5,6,7];for(const p of a){const g=i.points[p];let b;if(g[2]>=0)b=g;else{const T=i.points[p-4];b=r.ah(T,g,T[2]/(T[2]-g[2]))}if(We(this.state,b[0],b[1],0,this._transform)>=Le)return!0}return!1}updateConfig(i){this._transitionable.setTransitionOrValue(this._options,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,a,p){return(!p||p.validate!==!1)&&gn(this,i.call(tr,r.l({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}}let dt,St,qt,Ht,li=class extends r.E{constructor(f,i,a,p){super();const g=dt||(dt=new r.a5({density:new r.a6(r.a3.snow.density),intensity:new r.a6(r.a3.snow.intensity),color:new r.a6(r.a3.snow.color),opacity:new r.a6(r.a3.snow.opacity),vignette:new r.a6(r.a3.snow.vignette),"vignette-color":new r.a6(r.a3.snow["vignette-color"]),"center-thinning":new r.a6(r.a3.snow["center-thinning"]),direction:new r.a6(r.a3.snow.direction),"flake-size":new r.a6(r.a3.snow["flake-size"])}));this._transitionable=new r.a4(g,a,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ad(g),this.scope=a}get state(){const f=this.properties.get("opacity"),i=this.properties.get("color"),a=this.properties.get("direction"),p=r.ai(a[0]),g=-Math.max(r.ai(a[1]),.01),b=[Math.cos(p)*Math.cos(g),Math.sin(p)*Math.cos(g),Math.sin(g)],T=this.properties.get("vignette"),M=this.properties.get("vignette-color");return M.a=T,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.aj(i.r,i.g,i.b,i.a*f),direction:b,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:M}}get(){return this._transitionable.serialize()}set(f,i,a={}){if(this._validate(Rs,f,a))return;const p=r.l({},f);for(const g of Object.keys(r.a3.snow))p[g]===void 0&&(p[g]=r.a3.snow[g].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,i)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,i,a){return(!a||a.validate!==!1)&&gn(this,f.call(tr,r.l({value:i,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}},pi=class extends r.E{constructor(f,i,a,p){super();const g=St||(St=new r.a5({density:new r.a6(r.a3.rain.density),intensity:new r.a6(r.a3.rain.intensity),color:new r.a6(r.a3.rain.color),opacity:new r.a6(r.a3.rain.opacity),vignette:new r.a6(r.a3.rain.vignette),"vignette-color":new r.a6(r.a3.rain["vignette-color"]),"center-thinning":new r.a6(r.a3.rain["center-thinning"]),direction:new r.a6(r.a3.rain.direction),"droplet-size":new r.a6(r.a3.rain["droplet-size"]),"distortion-strength":new r.a6(r.a3.rain["distortion-strength"])}));this._transitionable=new r.a4(g,a,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ad(g),this.scope=a}get state(){const f=this.properties.get("opacity"),i=this.properties.get("color"),a=this.properties.get("direction"),p=r.ai(a[0]),g=-Math.max(r.ai(a[1]),.01),b=[Math.cos(p)*Math.cos(g),Math.sin(p)*Math.cos(g),Math.sin(g)],T=this.properties.get("vignette-color");return T.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.aj(i.r,i.g,i.b,i.a*f),direction:b,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(f,i,a={}){if(this._validate(vr,f,a))return;const p=r.l({},f);for(const g of Object.keys(r.a3.rain))p[g]===void 0&&(p[g]=r.a3.rain[g].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,i)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,i,a){return(!a||a.validate!==!1)&&gn(this,f.call(tr,r.l({value:i,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}};class bi extends r.E{constructor(i,a,p,g){super(),this.scope=p,this._options=i,this.properties=new r.ad(a),this._transitionable=new r.a4(a,p,new Map(g)),this._transitionable.setTransitionOrValue(i.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(i){this._transitionable.setTransitionOrValue(this._options.properties,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(i,a){this._options=i,this._transitionable.setTransitionOrValue(i.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Mi{constructor(i,a,p,g){this.screenBounds=i,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(i,a){let p,g;if(i instanceof r.P||typeof i[0]=="number"){const b=r.P.convert(i);p=[b],g=a.isPointAboveHorizon(b)}else{const b=r.P.convert(i[0]),T=r.P.convert(i[1]);p=[b,T],g=r.al(b,T).every(M=>a.isPointAboveHorizon(M))}return new Mi(p,a.getCameraPoint(),g,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return r.al(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const a=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],g=r.al(a,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<p.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?g[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(g[3]=this.cameraPoint)),r.am(g,i)}bufferedCameraGeometryGlobe(i){const a=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],g=r.al(a,p,i),b=this.cameraPoint.clone();switch(3*((b.y>a.y)+(b.y>p.y))+((b.x>a.x)+(b.x>p.x))){case 0:g[0]=b,g[4]=b.clone();break;case 1:g.splice(1,0,b);break;case 2:g[1]=b;break;case 3:g.splice(4,0,b);break;case 5:g.splice(2,0,b);break;case 6:g[3]=b;break;case 7:g.splice(3,0,b);break;case 8:g[2]=b}return g}containsTile(i,a,p,g=0){const b=i.queryPadding/a._pixelsPerMercatorPixel+1,T=p?this._bufferedCameraMercator(b,a):this._bufferedScreenMercator(b,a);let M=i.tileID.wrap+(T.unwrapped?g:0);const O=T.polygon.map(_e=>r.an(i.tileTransform,_e,M));if(!r.ao(O,0,0,r.ag,r.ag))return;M=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);const L=this.screenGeometryMercator.polygon.map(_e=>r.ap(i.tileTransform,_e,M)),k=L.map(_e=>new r.P(_e[0],_e[1])),U=a.getFreeCameraOptions().position||new r.aa(0,0,0),j=r.ap(i.tileTransform,U,M),Z=L.map(_e=>{const me=r.ab.vec3.sub(_e,_e,j);return r.ab.vec3.normalize(me,me),new r.aq(j,me)}),ce=r.ar(i,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:Z,bufferedTilespaceGeometry:O,bufferedTilespaceBounds:(te=r.as(O),te.min.x=r.aw(te.min.x,0,r.ag),te.min.y=r.aw(te.min.y,0,r.ag),te.max.x=r.aw(te.max.x,0,r.ag),te.max.y=r.aw(te.max.y,0,r.ag),te),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:ce};var te}_bufferedScreenMercator(i,a){const p=Gi(i);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let g;return g=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),a):{polygon:this.bufferedScreenGeometry(i).map(b=>a.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[p]=g,g}}_bufferedCameraMercator(i,a){const p=Gi(i);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let g;return g=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),a):{polygon:this.bufferedCameraGeometry(i).map(b=>a.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[p]=g,g}}_projectAndResample(i,a){const p=function(b,T){const M=r.ab.mat4.multiply([],T.pixelMatrix,T.globeMatrix),O=[0,-r.ax,0,1],L=[0,r.ax,0,1],k=[0,0,0,1];r.ab.vec4.transformMat4(O,O,M),r.ab.vec4.transformMat4(L,L,M),r.ab.vec4.transformMat4(k,k,M);const U=new r.P(O[0]/O[3],O[1]/O[3]),j=new r.P(L[0]/L[3],L[1]/L[3]),Z=r.au(b,U)&&O[3]<k[3],ce=r.au(b,j)&&L[3]<k[3];if(!Z&&!ce)return null;const te=function(Ue,Ne,Ye){for(let it=1;it<Ue.length;it++){const xt=fr(Ne.pointCoordinate3D(Ue[it-1]).x),_t=fr(Ne.pointCoordinate3D(Ue[it]).x);if(Ye<0){if(xt<_t)return{idx:it,t:-xt/(_t-1-xt)}}else if(_t<xt)return{idx:it,t:(1-xt)/(_t+1-xt)}}return null}(b,T,Z?-1:1);if(!te)return null;const{idx:_e,t:me}=te;let Se=_e>1?dr(b.slice(0,_e),T):[],ke=_e<b.length?dr(b.slice(_e),T):[];Se=Se.map(Ue=>new r.P(fr(Ue.x),Ue.y)),ke=ke.map(Ue=>new r.P(fr(Ue.x),Ue.y));const Oe=[...Se];Oe.length===0&&Oe.push(ke[ke.length-1]);const je=r.af(Oe[Oe.length-1].y,(ke.length===0?Se[0]:ke[0]).y,me);let Ve;return Ve=Z?[new r.P(0,je),new r.P(0,0),new r.P(1,0),new r.P(1,je)]:[new r.P(1,je),new r.P(1,1),new r.P(0,1),new r.P(0,je)],Oe.push(...Ve),ke.length===0?Oe.push(Se[0]):Oe.push(...ke),{polygon:Oe.map(Ue=>new r.aa(Ue.x,Ue.y)),unwrapped:!1}}(i,a);if(p)return p;const g=function(b,T){let M=!1,O=-1/0,L=0;for(let U=0;U<b.length-1;U++)b[U].x>O&&(O=b[U].x,L=U);for(let U=0;U<b.length-1;U++){const j=(L+U)%(b.length-1),Z=b[j],ce=b[j+1];Math.abs(Z.x-ce.x)>.5&&(Z.x<ce.x?(Z.x+=1,j===0&&(b[b.length-1].x+=1)):(ce.x+=1,j+1===b.length-1&&(b[0].x+=1)),M=!0)}const k=r.at(T.center.lng);return M&&k<Math.abs(k-1)&&b.forEach(U=>{U.x-=1}),{polygon:b,unwrapped:M}}(dr(i,a).map(b=>new r.P(fr(b.x),b.y)),a);return{polygon:g.polygon.map(b=>new r.aa(b.x,b.y)),unwrapped:g.unwrapped}}}function dr(f,i){return r.av(f,a=>{const p=i.pointCoordinate3D(a);a.x=p.x,a.y=p.y},1/256)}function fr(f){return f<0?1+f%1:f%1}function Gi(f){return 100*f|0}function _r(f,i,a,p,g){const b=function(M,O){if(M)return g(M);if(O){if(f.url&&O.tiles&&f.tiles&&delete f.tiles,O.variants){if(!Array.isArray(O.variants))return g(new Error("variants must be an array"));for(const k of O.variants){if(k==null||typeof k!="object"||k.constructor!==Object)return g(new Error("variant must be an object"));if(!Array.isArray(k.capabilities))return g(new Error("capabilities must be an array"));if(k.capabilities.length===1&&k.capabilities[0]==="meshopt"){O=r.l(O,k);break}}}const L=r.ay(r.l({},O,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);L.tiles=i.canonicalizeTileset(L,f.url),g(null,L)}},T=function(M,O,L){if(!M)return null;if(!O&&!L)return M;L=L||M.worldview_default;const k=Object.values(M.language||{});if(k.length===0)return null;const U=Object.values(M.worldview||{});if(U.length===0)return null;const j=k.every(ce=>ce===O),Z=U.every(ce=>ce===L);return j&&Z?M:O in(M.language_options||{})||L in(M.worldview_options||{})?null:M.language_options&&M.worldview_options?M:null}(f.data,a,p);return T?r.q.frame(()=>b(null,T)):f.url?r.n(i.transformRequest(i.normalizeSourceURL(f.url,null,a,p),r.R.Source),b):r.q.frame(()=>{const{data:M,...O}=f;b(null,O)})}class wr{constructor(i,a,p){this.bounds=r.az.convert(this.validateBounds(i)),this.minzoom=a||0,this.maxzoom=p||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const a=Math.pow(2,i.z),p=Math.floor(r.at(this.bounds.getWest())*a),g=Math.floor(r.aA(this.bounds.getNorth())*a),b=Math.ceil(r.at(this.bounds.getEast())*a),T=Math.ceil(r.aA(this.bounds.getSouth())*a);return i.x>=p&&i.x<b&&i.y>=g&&i.y<T}}class ki extends r.E{constructor(i,a,p,g){if(super(),this.id=i,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.l(this,r.ay(a,["url","scheme","tileSize","promoteId"])),this._options=r.l({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new r.aB}load(i){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=_r(this._options,this.map._requestManager,a,p,(g,b)=>{if(this._tileJSONRequest=null,this._loaded=!0,g)a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new r.y(g));else if(b){if(r.l(this,b),this.hasWorldviews=!!b.worldview_options,b.worldview_default&&(this.worldviewDefault=b.worldview_default),b.vector_layers){this.vectorLayers=b.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const T of b.vector_layers)this.vectorLayerIds.push(T.id),b.worldview&&b.worldview[T.source]&&this.localizableLayerIds.add(T.id)}b.bounds&&(this.tileBounds=new wr(b.bounds,this.minzoom,this.maxzoom)),ui(b.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}i&&i(g)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=r.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}loadTile(i,a){const p=i.tileID.canonical.url(this.tiles,this.scheme),g=this.map._requestManager.normalizeTileURL(p),b=this.map._requestManager.transformRequest(g,r.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,M=T?{image:T.image.clone()}:null,O={request:b,data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,lut:M,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&r.f(p)&&(O.worldview=this.map.getWorldview()||this.worldviewDefault,O.localizableLayerIds=this.localizableLayerIds),O.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=a:i.request=i.actor.send("reloadTile",O,L.bind(this));else if(i.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",O,L.bind(this),void 0,!0);else{const k=r.aD.call({deduped:this._deduped},O,(U,j)=>{U||!j?L.call(this,U):(O.data={cacheControl:j.cacheControl,expires:j.expires,rawData:j.rawData.slice(0)},i.actor&&i.actor.send("loadTile",O,L.bind(this),void 0,!0))},!0);i.request={cancel:k}}function L(k,U){return delete i.request,i.aborted?a(null):k&&k.status!==404?a(k):(U&&U.resourceTiming&&(i.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&i.setExpiryData(U),i.loadVectorData(U,this.map.painter),r.aE(this.dispatcher),a(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i,a){i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope}),i.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Vs extends r.E{constructor(i,a,p,g){super(),this.id=i,this.dispatcher=p,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.l({type:"raster"},a),r.l(this,r.ay(a,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._tileJSONRequest=_r(this._options,this.map._requestManager,null,null,(a,p)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new r.y(a)):p&&(r.l(this,p),p.raster_layers&&(this.rasterLayers=p.raster_layers,this.rasterLayerIds=this.rasterLayers.map(g=>g.id)),p.bounds&&(this.tileBounds=new wr(p.bounds,this.minzoom,this.maxzoom)),ui(p.tiles),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),i&&i(a)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=r.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,a){const p=r.q.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);i.request=r.o(this.map._requestManager.transformRequest(g,r.R.Tile),(b,T,M,O)=>(delete i.request,i.aborted?(i.state="unloaded",a(null)):b?(i.state="errored",a(b)):T?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:M,expires:O}),i.setTexture(T,this.map.painter),i.state="loaded",r.aE(this.dispatcher),void a(null)):a(null)))}abortTile(i,a){i.request&&(i.request.cancel(),delete i.request),a&&a()}unloadTile(i,a){i.texture&&i.texture instanceof r.T?(i.destroy(!0),i.texture&&i.texture instanceof r.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),a&&a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class An extends Vs{constructor(i,a,p,g){super(i,a,p,g),this.type="raster-array",this.maxzoom=22,this._options=r.l({type:"raster-array"},a)}triggerRepaint(i){const a=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);a&&a.enabled&&p&&a._clearRenderCacheForTile(p.id,i.tileID),this.map.triggerRepaint()}loadTile(i,a){const p=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),g=this.map._requestManager.transformRequest(p,r.R.Tile);i.requestParams=g,i.actor||(i.actor=this.dispatcher.getActor()),i.request=i.fetchHeader(void 0,(b,T,M,O)=>{if(delete i.request,i.aborted)return i.state="unloaded",a(null);if(b)return b.code===20?void 0:(i.state="errored",a(b));this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:M,expires:O}),i.state="empty",a(null)})}unloadTile(i,a){const p=i.texture;p&&p instanceof r.T?(i.destroy(!0),this.map.painter.saveTileTexture(p)):(i.destroy(),i.flushQueues(),i._isHeaderLoaded=!1,delete i._mrt,delete i.textureDescriptor),i.fbo&&(i.fbo.destroy(),delete i.fbo),delete i.request,delete i.requestParams,delete i.neighboringTiles,i.state="unloaded"}prepareTile(i,a,p){i._isHeaderLoaded&&(i.state!=="empty"&&(i.state="reloading"),i.fetchBand(a,p,(g,b)=>{if(g)return i.state="errored",this.fire(new r.y(g)),void this.triggerRepaint(i);b&&(i.setTexture(b,this.map.painter),i.state="loaded",this.triggerRepaint(i))}))}getInitialBand(i){if(!this.rasterLayers)return 0;const a=this.rasterLayers.find(({id:b})=>b===i),p=a&&a.fields,g=p&&p.bands&&p.bands;return g?g[0]:0}getTextureDescriptor(i,a,p){if(!i)return;const g=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!g)return;let b=null;a instanceof r.aH?b=a.paint.get("raster-array-band"):a instanceof r.aI&&(b=a.paint.get("raster-particle-array-band"));const T=b||this.getInitialBand(g);if(T!=null)if(i.textureDescriptor){if(!i.updateNeeded(g,T)||p)return Object.assign({},i.textureDescriptor,{texture:i.texture})}else this.prepareTile(i,g,T)}}const On={vector:ki,raster:Vs,"raster-dem":class extends Vs{constructor(f,i,a,p){super(f,i,a,p),this.type="raster-dem",this.maxzoom=22,this._options=r.l({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(f,i){const a=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(g,b){g&&(f.state="errored",i(g)),b&&(f.dem=b,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",i(null))}f.request=r.o(this.map._requestManager.transformRequest(a,r.R.Tile),(function(g,b,T,M){if(delete f.request,f.aborted)f.state="unloaded",i(null);else if(g)f.state="errored",i(g);else if(b){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:T,expires:M});const O=ImageBitmap&&b instanceof ImageBitmap&&r.t(),L=1-(b.width-r.aF(b.width))/2;L<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const k=O?b:r.q.getImageData(b,L),U={uid:f.uid,coord:f.tileID,source:this.id,scope:this.scope,rawImageData:k,encoding:this.encoding,padding:L};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",U,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const i=f.canonical,a=Math.pow(2,i.z),p=(i.x-1+a)%a,g=i.x===0?f.wrap-1:f.wrap,b=(i.x+1+a)%a,T=i.x+1===a?f.wrap+1:f.wrap,M={};return M[new r.aG(f.overscaledZ,g,i.z,p,i.y).key]={backfilled:!1},M[new r.aG(f.overscaledZ,T,i.z,b,i.y).key]={backfilled:!1},i.y>0&&(M[new r.aG(f.overscaledZ,g,i.z,p,i.y-1).key]={backfilled:!1},M[new r.aG(f.overscaledZ,f.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},M[new r.aG(f.overscaledZ,T,i.z,b,i.y-1).key]={backfilled:!1}),i.y+1<a&&(M[new r.aG(f.overscaledZ,g,i.z,p,i.y+1).key]={backfilled:!1},M[new r.aG(f.overscaledZ,f.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},M[new r.aG(f.overscaledZ,T,i.z,b,i.y+1).key]={backfilled:!1}),M}},"raster-array":An,geojson:class extends r.E{constructor(f,i,a,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(p),this._data=i.data,this._options=r.l({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.minzoom!==void 0&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const g=r.ag/this.tileSize;this.workerOptions=r.l({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*g,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*g,extent:r.ag,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:r.ag,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*g,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new r.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new r.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const i=new Map;for(const a of this._data.features)i.set(a.id,a);for(const a of f.features)i.set(a.id,a);this._data.features=[...i.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},i),this}getClusterChildren(f,i){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},i),this}getClusterLeaves(f,i,a,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:i,offset:a},p),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.z("dataloading",{dataType:"source"})),this._loaded=!1;const i=r.l({append:f},this.workerOptions);i.scope=this.scope;const a=this._data;typeof a=="string"?(i.request=this.map._requestManager.transformRequest(r.q.resolveURL(a),r.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,(p,g)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new r.y(p));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(b.resourceTiming=g.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new r.z("data",b)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const f=r.aC(this.id,this.scope);this.map.style.clearSource(f),this._updateWorkerData()}loadTile(f,i){const a=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,g=p?{image:p.image.clone()}:null,b=this._partialReload,T={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:g,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:b};f.request=this.actor.send(a,T,(M,O)=>b&&!O?(f.state="loaded",i(null)):(delete f.request,f.destroy(),f.aborted?i(null):M?i(M):(f.loadVectorData(O,this.map.painter,a==="reloadTile"),i(null))),void 0,a==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,i){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aJ{constructor(f,i,a,p){super(f,i,a,p),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const i of f.urls)this.urls.push(this.map._requestManager.transformRequest(i,r.R.Source).url);r.aK(this.urls,(i,a)=>{this._loaded=!0,i?this.fire(new r.y(i)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const i=this.video.seekable;f<i.start(0)||f>i.end(0)?this.fire(new r.y(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,i=f.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(f,this.video,i.RGBA8),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aJ,model:class extends r.E{constructor(f,i,a,p){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=i}load(){const f=[];for(const i in this._options.models){const a=this._options.models[i],p=r.aM(this.map._requestManager.transformRequest(a.uri,r.R.Model).url).then(g=>{if(!g)return;const b=r.aN(g),T=new r.aO(i,a.position,a.orientation,b);T.computeBoundsAndApplyParent(),this.models.push(T)}).catch(g=>{this.fire(new r.y(new Error(`Could not load model ${i} from ${a.uri}: ${g.message}`)))});f.push(p)}return Promise.allSettled(f).then(()=>{this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this.fire(new r.y(new Error(`Could not load models: ${i.message}`)))})}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,i){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(f,i,a,p){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=i,this.tiles=this._options.tiles,this.maxzoom=i.maxzoom||19,this.minzoom=i.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest();const f=r.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(f))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(f){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map.getWorldview();this._tileJSONRequest=_r(this._options,this.map._requestManager,i,a,(p,g)=>{this._tileJSONRequest=null,this._loaded=!0,p?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new r.y(p))):g&&(r.l(this,g),g.bounds&&(this.tileBounds=new wr(g.bounds,this.minzoom,this.maxzoom)),ui(g.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),f&&f(p)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,i){const a=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(a,r.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=i;else{if(f.buckets){const b=Object.values(f.buckets);for(const T of b)T.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",p,g.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",p,g.bind(this),void 0,!0);function g(b,T){return f.aborted?i(null):b&&b.status!==404?i(b):(this.map._refreshExpiredTiles&&T&&f.setExpiryData(T),f.loadModelData(T,this.map.painter),f.state="loaded",void i(null))}}serialize(){return r.l({},this._options)}},canvas:class extends r.aJ{constructor(f,i,a,p){super(f,i,a,p),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(b=>typeof b!="number"))||this.fire(new r.y(new r.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.y(new r.V(`sources.${f}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new r.y(new r.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new r.y(new r.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.y(new r.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof r.aL||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(i,this.canvas,i.gl.RGBA8,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends r.E{constructor(f,i,a,p){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=i,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new wr(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),r.l(this,r.ay(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.ay(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:i,y:a,z:p}=f.canonical;return this._implementation.hasTile({x:i,y:a,z:p})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,i){const{x:a,y:p,z:g}=f.tileID.canonical,b=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:a,y:p,z:g},{signal:b.signal})).then((function(T){return delete f.request,f.aborted?(f.state="unloaded",i(null)):T===void 0?(f.state="errored",i(null)):T===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",i(null)):function(M){return M instanceof ImageData||M instanceof HTMLCanvasElement||M instanceof ImageBitmap||M instanceof HTMLImageElement}(T)?(this.loadTileData(f,T),f.state="loaded",void i(null)):(f.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(T=>{T.code!==20&&(f.state="errored",i(T))}),f.request.cancel=()=>b.abort()}loadTileData(f,i){f.setTexture(i,this.map.painter)}unloadTile(f,i){if(f.texture&&f.texture instanceof r.T?(f.destroy(!0),f.texture&&f.texture instanceof r.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:a,y:p,z:g}=f.tileID.canonical;this._implementation.unloadTile({x:a,y:p,z:g})}i&&i()}abortTile(f,i){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),i&&i()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){const f=r.aC(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}}},_s=function(f,i,a,p){const g=new On[i.type](f,i,a,p);if(g.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${g.id}`);return r.aP(["load","abort","unload","serialize","prepare"],g),g};function ra(f,i,a=""){return`${a}:${i.id||""}:${i.layer.id}:${function(p){if("layerId"in p)return`layer:${p.layerId}`;{const{featuresetId:g,importId:b}=p;return`featureset:${g}${b?`:import:${b}`:""}`}}(f.target)}`}function io(f,i,a,p=""){if(f.uniqueFeatureID){const g=ra(f,i,p);if(a.has(g))return!0;a.add(g)}return!1}function Cn(f,i,a,p,g=!1){const b=i.sourceCache.transform,T=i.sourceCache.tilesIn(f,i.has3DLayers,g);T.sort(Ro);const M=[];for(const O of T){const L=O.tile.queryRenderedFeatures(i,O,a,p,b,g);Object.keys(L).length&&M.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:L})}return M.length===0?{}:function(O){const L={},k={};for(const U of O){const j=U.queryResults,Z=U.wrappedTileID,ce=k[Z]=k[Z]||{};for(const te in j){const _e=j[te],me=ce[te]=ce[te]||{},Se=L[te]=L[te]||[];for(const ke of _e)me[ke.featureIndex]||(me[ke.featureIndex]=!0,Se.push(ke))}}return L}(M)}function Rc(f,i,a,p,g){const b={},T=p.queryRenderedSymbols(f),M=[];for(const O of Object.keys(T).map(Number))M.push(g[O]);M.sort(Ro);for(const O of M){const L=O.featureIndex.lookupSymbolFeatures(T[O.bucketInstanceId],O.bucketIndex,O.sourceLayerIndex,i,a);for(const k in L){const U=b[k]=b[k]||[],j=L[k];j.sort((Z,ce)=>{const te=O.featureSortOrder;if(te){const _e=te.indexOf(Z.featureIndex);return te.indexOf(ce.featureIndex)-_e}return ce.featureIndex-Z.featureIndex});for(const Z of j)U.push(Z)}}return b}function Cp(f,i){const a=f.getRenderableIds().map(b=>f.getTileByID(b)),p=[],g={};for(let b=0;b<a.length;b++){const T=a[b],M=T.tileID.canonical.key;g[M]||(g[M]=!0,T.querySourceFeatures(p,i))}return p}function Ro(f,i){const a=f.tileID,p=i.tileID;return a.overscaledZ-p.overscaledZ||a.canonical.y-p.canonical.y||a.wrap-p.wrap||a.canonical.x-p.canonical.x}function zd(f,i){const a={};if(!i)return a;for(const p of f){const g=p.layerIds.map(b=>i.getLayer(b)).filter(Boolean);if(g.length!==0){p.layers=g,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(b=>g.filter(T=>T.id===b)[0]));for(const b of g)a[b.fqid]=p}}return a}const Gs=32,Fo=33,Bo=new Uint16Array(8184);for(let f=0;f<2046;f++){let i=f+2,a=0,p=0,g=0,b=0,T=0,M=0;for(1&i?g=b=T=Gs:a=p=M=Gs;(i>>=1)>1;){const L=a+g>>1,k=p+b>>1;1&i?(g=a,b=p,a=T,p=M):(a=g,p=b,g=T,b=M),T=L,M=k}const O=4*f;Bo[O+0]=a,Bo[O+1]=p,Bo[O+2]=g,Bo[O+3]=b}const Ma=new Uint16Array(2178),Do=new Uint8Array(1089),Ia=new Uint16Array(1089);function Dc(f){return f===0?-.03125:f===32?.03125:0}const Fd=(()=>({type:2,extent:r.ag,loadGeometry:()=>[[new r.P(0,0),new r.P(r.ag+1,0),new r.P(r.ag+1,r.ag+1),new r.P(0,r.ag+1),new r.P(0,0)]]}))();class Xa{constructor(i,a,p,g,b){this.tileID=i,this.uid=r.aV(),this.uses=0,this.tileSize=a,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,g&&g.style&&(this._lastUpdatedBrightness=g.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",g&&g.transform&&(this.projection=g.transform.projection)}registerFadeDuration(i){const a=i+this.timeAdded;a<r.q.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aQ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,a,p){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=zd(i.buckets,a.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const b=this.buckets[g];if(b instanceof r.aX){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const b=this.buckets[g];if(b instanceof r.aX&&b.hasRTLText){this.hasRTLText=!0,r.aY();break}}this.queryPadding=0;for(const g in this.buckets){const b=this.buckets[g],T=a.style.getOwnLayer(g);if(!T)continue;const M=T.queryRadius(b);this.queryPadding=Math.max(this.queryPadding,M)}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas),this._lastUpdatedBrightness=i.brightness}else this.collisionBoxArray=new r.aW}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(i,a,p){i&&(i.resourceTiming&&(this.resourceTiming=i.resourceTiming),this.buckets=Object.assign({},this.buckets,zd(i.buckets,a.style)),i.featureIndex&&(this.latestFeatureIndex=i.featureIndex))}getBucket(i){return this.buckets[i.fqid]}upload(i){for(const g in this.buckets){const b=this.buckets[g];b.uploadPending()&&b.upload(i)}const a=i.gl,p=this.imageAtlas;if(p&&!p.uploaded){const g=!!Object.keys(p.patternPositions).length;this.imageAtlasTexture=new r.T(i,p.image,a.RGBA8,{useMipmap:g}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(i,this.glyphAtlasImage,a.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(i,this.lineAtlas.image,a.R8),this.lineAtlas.uploaded=!0)}prepare(i,a,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture,p),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const g=a.style.getBrightness();(this._lastUpdatedBrightness||g)&&(this._lastUpdatedBrightness&&g&&Math.abs(this._lastUpdatedBrightness-g)<.001||(this.updateBuckets(a,this._lastUpdatedBrightness!==g),this._lastUpdatedBrightness=g))}queryRenderedFeatures(i,a,p,g,b,T){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const M=function(O,L){const k=r.ab.mat4.fromScaling([],[.5*O.width,.5*-O.height,1]);return r.ab.mat4.translate(k,k,[1,-1,0]),r.ab.mat4.multiply(k,k,O.calculateProjMatrix(L.toUnwrapped())),Float32Array.from(k)}(b,this.tileID);return this.latestFeatureIndex.query(i,{tilespaceGeometry:a,pixelPosMatrix:M,transform:g,availableImages:p,tileTransform:this.tileTransform})}querySourceFeatures(i,a){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const g=p.loadVTLayers(),b=a?a.sourceLayer:"",T=g._geojsonTileLayer||g[b];if(!T)return;const M=r.aZ(a&&a.filter),{z:O,x:L,y:k}=this.tileID.canonical,U={z:O,x:L,y:k};for(let j=0;j<T.length;j++){const Z=T.feature(j);if(M.needGeometry){const _e=r.a_(Z,!0);if(!M.filter(new r.a8(this.tileID.overscaledZ),_e,this.tileID.canonical))continue}else if(!M.filter(new r.a8(this.tileID.overscaledZ),Z))continue;const ce=p.getId(Z,b),te=new r.a$(Z,O,L,k,ce);te.tile=U,i.push(te)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const a=this.expirationTime;if(i.cacheControl){const p=r.b0(i.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const p=Date.now();let g=!1;if(this.expirationTime>p)g=!1;else if(a)if(this.expirationTime<a)g=!0;else{const b=this.expirationTime-a;b?this.expirationTime=p+Math.max(b,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(i){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&i&&this.updateBuckets(i)}updateBuckets(i,a){if(!this.latestFeatureIndex||!i.style)return;const p=this.latestFeatureIndex.loadVTLayers(),g=i.style.listImages(),b=i.style.getBrightness();for(const T in this.buckets){if(!i.style.hasLayer(T))continue;const M=this.buckets[T],O=M.layers[0],L=O.sourceLayer||"_geojsonTileLayer",k=p[L],U=i.style.getLayerSourceCache(O);let j={};U&&(j=U._state.getState(L,void 0));const Z=this.imageAtlas&&this.imageAtlas.patternPositions||{},ce=Object.keys(j).length>0&&!a;ce&&!M.stateDependentLayers.length&&!a||M.update(j,k,g,Z,ce?M.stateDependentLayers:M.layers,a,b),(M instanceof r.b1||M instanceof r.b2)&&i._terrain&&i._terrain.enabled&&U&&M.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(U.id,this.tileID);const te=i&&i.style&&i.style.getOwnLayer(T);te&&(this.queryPadding=Math.max(this.queryPadding,te.queryRadius(M)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=r.q.now()+i}setTexture(i,a){const p=a.context,g=p.gl;this.texture=this.texture||a.getTileTexture(i.width),this.texture&&this.texture instanceof r.T?this.texture.update(i):(this.texture=new r.T(p,i,g.RGBA8,{useMipmap:!0}),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE))}setDependencies(i,a){const p={};for(const g of a)p[g]=!0;this.dependencies[i]=p}hasDependency(i,a){for(const p of i){const g=this.dependencies[p];if(g){for(const b of a)if(g[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;const p=r.b3(Fd,this.tileID.canonical,this.tileTransform)[0],g=new r.b4,b=new r.b5;for(let T=0;T<p.length;T++){const{x:M,y:O}=p[T];g.emplaceBack(M,O),b.emplaceBack(T)}b.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(b),this._tileDebugBuffer=i.createVertexBuffer(g,r.b6.members),this._tileDebugSegments=r.b7.simpleSegment(0,0,g.length,b.length)}_makeTileBoundsBuffers(i,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;const p=r.b3(Fd,this.tileID.canonical,this.tileTransform)[0];let g,b;if(this.isRaster){const T=function(M,O){const L=r.aQ(M,O),k=Math.pow(2,M.z);for(let _e=0;_e<Fo;_e++)for(let me=0;me<Fo;me++){const Se=r.aR((M.x+(me+Dc(me))/Gs)/k),ke=r.aS((M.y+(_e+Dc(_e))/Gs)/k),Oe=O.project(Se,ke),je=_e*Fo+me;Ma[2*je+0]=Math.round((Oe.x*L.scale-L.x)*r.ag),Ma[2*je+1]=Math.round((Oe.y*L.scale-L.y)*r.ag)}Do.fill(0),Ia.fill(0);for(let _e=2045;_e>=0;_e--){const me=4*_e,Se=Bo[me+0],ke=Bo[me+1],Oe=Bo[me+2],je=Bo[me+3],Ve=Se+Oe>>1,Ue=ke+je>>1,Ne=Ve+Ue-ke,Ye=Ue+Se-Ve,it=ke*Fo+Se,xt=je*Fo+Oe,_t=Ue*Fo+Ve,Rt=Math.hypot((Ma[2*it+0]+Ma[2*xt+0])/2-Ma[2*_t+0],(Ma[2*it+1]+Ma[2*xt+1])/2-Ma[2*_t+1])>=16;Do[_t]=Do[_t]||(Rt?1:0),_e<1022&&(Do[_t]=Do[_t]||Do[(ke+Ye>>1)*Fo+(Se+Ne>>1)]||Do[(je+Ye>>1)*Fo+(Oe+Ne>>1)])}const U=new r.aT,j=new r.aU;let Z=0;function ce(_e,me){const Se=me*Fo+_e;return Ia[Se]===0&&(U.emplaceBack(Ma[2*Se+0],Ma[2*Se+1],_e*r.ag/Gs,me*r.ag/Gs),Ia[Se]=++Z),Ia[Se]-1}function te(_e,me,Se,ke,Oe,je){const Ve=_e+Se>>1,Ue=me+ke>>1;if(Math.abs(_e-Oe)+Math.abs(me-je)>1&&Do[Ue*Fo+Ve])te(Oe,je,_e,me,Ve,Ue),te(Se,ke,Oe,je,Ve,Ue);else{const Ne=ce(_e,me),Ye=ce(Se,ke),it=ce(Oe,je);j.emplaceBack(Ne,Ye,it)}}return te(0,0,Gs,Gs,Gs,0),te(Gs,Gs,0,0,0,Gs),{vertices:U,indices:j}}(this.tileID.canonical,a);g=T.vertices,b=T.indices}else{g=new r.aT,b=new r.aU;for(const{x:M,y:O}of p)g.emplaceBack(M,O,0,0);const T=r.b8(g.int16,void 0,4);for(let M=0;M<T.length;M+=3)b.emplaceBack(T[M],T[M+1],T[M+2])}this._tileBoundsBuffer=i.createVertexBuffer(g,r.b9.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(b),this._tileBoundsSegments=r.b7.simpleSegment(0,0,g.length,b.length)}_makeGlobeTileDebugBuffers(i,a){const p=a.projection;if(!p||p.name!=="globe"||a.freezeTileCoverage)return;const g=this.tileID.canonical,b=r.ba(g,a),T=r.bb(b),M=r.ae(a.zoom);let O;M>0&&(O=r.ab.mat4.invert(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,g,a,T,O,M),this._makeGlobeTileDebugTextBuffer(i,g,a,T,O,M)}_globePoint(i,a,p,g,b,T,M){let O=r.bc(i,a,p);if(T){const L=1<<p.z,k=r.at(g.center.lng),U=r.aA(g.center.lat),j=(p.x+.5)/L-k;let Z=0;j>.5?Z=-1:j<-.5&&(Z=1);let ce=(i/r.ag+p.x)/L+Z,te=(a/r.ag+p.y)/L;ce=(ce-k)*g._pixelsPerMercatorPixel+k,te=(te-U)*g._pixelsPerMercatorPixel+U;const _e=[ce*g.worldSize,te*g.worldSize,0];r.ab.vec3.transformMat4(_e,_e,T),O=r.bd(O,_e,M)}return r.ab.vec3.transformMat4(O,O,b)}_makeGlobeTileDebugBorderBuffer(i,a,p,g,b,T){const M=new r.b4,O=new r.b5,L=new r.be,k=(j,Z,ce,te,_e)=>{const me=(ce-j)/(_e-1),Se=(te-Z)/(_e-1),ke=M.length;for(let Oe=0;Oe<_e;Oe++){const je=j+Oe*me,Ve=Z+Oe*Se;M.emplaceBack(je,Ve);const Ue=this._globePoint(je,Ve,a,p,g,b,T);L.emplaceBack(Ue[0],Ue[1],Ue[2]),O.emplaceBack(ke+Oe)}},U=r.ag;k(0,0,U,0,16),k(U,0,U,U,16),k(U,U,0,U,16),k(0,U,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(O),this._tileDebugBuffer=i.createVertexBuffer(M,r.b6.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(L,r.bf.members),this._tileDebugSegments=r.b7.simpleSegment(0,0,M.length,O.length)}_makeGlobeTileDebugTextBuffer(i,a,p,g,b,T){const M=r.ag/4,O=new r.b4,L=new r.aU,k=new r.be,U=25;L.reserve(32),O.reserve(U),k.reserve(U);const j=(Z,ce)=>U*Z+ce;for(let Z=0;Z<U;Z++){const ce=Z*M;for(let te=0;te<U;te++){const _e=te*M;O.emplaceBack(_e,ce);const me=this._globePoint(_e,ce,a,p,g,b,T);k.emplaceBack(me[0],me[1],me[2])}}for(let Z=0;Z<4;Z++)for(let ce=0;ce<4;ce++){const te=j(Z,ce),_e=j(Z,ce+1),me=j(Z+1,ce),Se=j(Z+1,ce+1);L.emplaceBack(te,_e,me),L.emplaceBack(me,_e,Se)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(L),this._tileDebugTextBuffer=i.createVertexBuffer(O,r.b6.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(k,r.bf.members),this._tileDebugTextSegments=r.b7.simpleSegment(0,0,U,32)}destroy(i=!1){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!i&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.bg.setPbf(r.bh);class Ml extends Xa{constructor(i,a,p,g,b){super(i,a,p,g,b),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(i,a){const p=a.context,g=p.gl;this.texture=this.texture||a.getTileTexture(i.width),this.texture&&this.texture instanceof r.T?this.texture.update(i,{premultiply:!1}):this.texture=new r.T(p,i,g.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(i=16384,a){const p=this._mrt=new r.bg(30),g=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(i-1)}});return this.entireBuffer=null,this.request=r.bi(g,(b,T,M,O)=>{if(b)a(b);else try{const L=p.getHeaderLength(T);if(L>i)return void(this.request=this.fetchHeader(L,a));p.parseHeader(T),this._isHeaderLoaded=!0;let k=0;for(const U of Object.values(p.layers))k=Math.max(k,U.dataIndex[U.dataIndex.length-1].last_byte);T.byteLength>=k&&(this.entireBuffer=T),a(null,this.entireBuffer||T,M,O)}catch(L){a(L)}}),this.request}fetchBand(i,a,p){const g=this._mrt;if(!this._isHeaderLoaded||!g)return void p(new Error("Tile header is not ready"));const b=this.actor;if(!b)return void p(new Error("Can't fetch tile band without an actor"));let T;const M=(U,j)=>{T.complete(U,j),U?p(U):(this.updateTextureDescriptor(i,a),p(null,this.textureDescriptor&&this.textureDescriptor.img))},O=(U,j)=>{if(U)return p(U);const Z=b.send("decodeRasterArray",{buffer:j,task:T},M,void 0,!0);this._workQueue.push(()=>{Z&&Z.cancel(),T.cancel()})},L=g.getLayer(i);if(!L)return void p(new Error(`Unknown sourceLayer "${i}"`));if(L.hasDataForBand(a))return this.updateTextureDescriptor(i,a),void p(null,this.textureDescriptor?this.textureDescriptor.img:null);const k=L.getDataRange([a]);if(T=g.createDecodingTask(k),!T||T.tasks.length)if(this.flushQueues(),this.entireBuffer)O(null,this.entireBuffer.slice(k.firstByte,k.lastByte+1));else{const U=Object.assign({},this.requestParams,{headers:{Range:`bytes=${k.firstByte}-${k.lastByte}`}}),j=r.bi(U,O);this._fetchQueue.push(()=>{j.cancel(),T.cancel()})}else p(null)}updateNeeded(i,a){return(!this.textureDescriptor||this.textureDescriptor.band!==a||this.textureDescriptor.layer!==i)&&this.state!=="errored"}updateTextureDescriptor(i,a){if(!this._mrt)return;const p=this._mrt.getLayer(i);if(!p||!p.hasBand(a)||!p.hasDataForBand(a))return;const{bytes:g,tileSize:b,buffer:T,offset:M,scale:O}=p.getBandView(a),L=b+2*T,k={data:g,width:L,height:L},U=this.texture;U&&U instanceof r.T&&U.update(k,{premultiply:!1}),this.textureDescriptor={layer:i,band:a,img:k,buffer:T,offset:M,tileSize:b,format:p.pixelFormat,mix:[O,256*O,65536*O,16777216*O]}}}class Mp{constructor(i,a){this.max=i,this.onRemove=a,this.reset()}reset(){for(const i in this.data)for(const a of this.data[i])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(i,a,p){const g=i.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const b={value:a,timeout:void 0};if(p!==void 0&&(b.timeout=setTimeout(()=>{this.remove(i,b)},p)),this.data[g].push(b),this.order.push(g),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const a=this.data[i].shift();return a.timeout&&clearTimeout(a.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),a.value}getByKey(i){const a=this.data[i];return a?a[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,a){if(!this.has(i))return this;const p=i.wrapped().key,g=a===void 0?0:this.data[p].indexOf(a),b=this.data[p][g];return this.data[p].splice(g,1),b.timeout&&clearTimeout(b.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(i){const a=[];for(const p in this.data)for(const g of this.data[p])i(g.value)||a.push(g);for(const p of a)this.remove(p.value.tileID,p)}}class lh{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,a,p){const g=String(a);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][g]=this.stateChanges[i][g]||{},r.l(this.stateChanges[i][g],p),this.deletedStates[i]===null){this.deletedStates[i]={};for(const b in this.state[i])b!==g&&(this.deletedStates[i][b]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][g]===null){this.deletedStates[i][g]={};for(const b in this.state[i][g])p[b]||(this.deletedStates[i][g][b]=null)}else for(const b in p)this.deletedStates[i]&&this.deletedStates[i][g]&&this.deletedStates[i][g][b]===null&&delete this.deletedStates[i][g][b]}removeFeatureState(i,a,p){if(this.deletedStates[i]===null)return;const g=String(a);if(this.deletedStates[i]=this.deletedStates[i]||{},p&&a!==void 0)this.deletedStates[i][g]!==null&&(this.deletedStates[i][g]=this.deletedStates[i][g]||{},this.deletedStates[i][g][p]=null);else if(a!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][g])for(p in this.deletedStates[i][g]={},this.stateChanges[i][g])this.deletedStates[i][g][p]=null;else this.deletedStates[i][g]=null;else this.deletedStates[i]=null}getState(i,a){const p=this.state[i]||{},g=this.stateChanges[i]||{},b=this.deletedStates[i];if(b===null)return{};if(a!==void 0){const M=String(a),O=r.l({},p[M],g[M]);if(b){const L=b[a];if(L===null)return{};for(const k in L)delete O[k]}return O}const T=r.l({},p,g);if(b)for(const M in b)delete T[M];return T}initializeTileState(i,a){i.refreshFeatureState(a)}coalesceChanges(i,a){const p={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const b={};for(const T in this.stateChanges[g])this.state[g][T]||(this.state[g][T]={}),r.l(this.state[g][T],this.stateChanges[g][T]),b[T]=this.state[g][T];p[g]=b}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const b={};if(this.deletedStates[g]===null)for(const T in this.state[g])b[T]={},this.state[g][T]={};else for(const T in this.deletedStates[g]){if(this.deletedStates[g][T]===null)this.state[g][T]={};else if(this.state[g][T])for(const M of Object.keys(this.deletedStates[g][T]))delete this.state[g][T][M];b[T]=this.state[g][T]}p[g]=p[g]||{},r.l(p[g],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const g in i)i[g].refreshFeatureState(a)}}class rs extends r.E{constructor(i,a,p){super(),this.id=i,this._onlySymbols=p,a.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new Mp(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new lh,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(i){this.map=i,this._minTileCacheSize=this._minTileCacheSize===void 0&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const a=this._tiles[i];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,a){return i.isSymbolTile=this._onlySymbols,i.isExtraShadowCaster=this._shadowCasterTiles[i.tileID.key],this._source.loadTile(i,a)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i)}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i)}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const p=this._tiles[a];p.upload(i),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return r.bj(this._tiles).map(i=>i.tileID).sort(zr).map(i=>i.key)}getRenderableIds(i,a){const p=[];for(const g in this._tiles)this._isIdRenderable(+g,i,a)&&p.push(this._tiles[g]);return i?p.sort((g,b)=>{const T=g.tileID,M=b.tileID,O=new r.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),L=new r.P(M.canonical.x,M.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-M.overscaledZ||L.y-O.y||L.x-O.x}).map(g=>g.tileID.key):p.map(g=>g.tileID).sort(zr).map(g=>g.key)}hasRenderableParent(i){const a=this.findLoadedParent(i,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(i,a,p){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(a||!this._tiles[i].holdingForFade())&&(p||!this._shadowCasterTiles[i])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(+i,"reloading")}}_reloadTile(i,a){const p=this._tiles[i];p&&(p.state!=="loading"&&(p.state=a),this._loadTile(p,this._tileLoaded.bind(this,p,i,a)))}_tileLoaded(i,a,p,g){if(g)if(i.state="errored",g.status!==404)this._source.fire(new r.y(g,{tile:i}));else{if(this._source.fire(new r.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:i})),!(i.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform)}else i.timeAdded=r.q.now(),p==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(a,i),this._source.type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new r.z("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const a=this.getRenderableIds();for(let g=0;g<a.length;g++){const b=a[g];if(i.neighboringTiles&&i.neighboringTiles[b]){const T=this.getTileByID(b);p(i,T),p(T,i)}}function p(g,b){if(!g.dem||g.dem.borderReady)return;g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0;let T=b.tileID.canonical.x-g.tileID.canonical.x;const M=b.tileID.canonical.y-g.tileID.canonical.y,O=Math.pow(2,g.tileID.canonical.z),L=b.tileID.key;T===0&&M===0||Math.abs(M)>1||(Math.abs(T)>1&&(Math.abs(T+O)===1?T+=O:Math.abs(T-O)===1&&(T-=O)),b.dem&&g.dem&&(g.dem.backfillBorder(b.dem,T,M),g.neighboringTiles&&g.neighboringTiles[L]&&(g.neighboringTiles[L].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,a,p,g){for(const b in this._tiles){let T=this._tiles[b];if(g[b]||!T.hasData()||T.tileID.overscaledZ<=a||T.tileID.overscaledZ>p)continue;let M=T.tileID;for(;T&&T.tileID.overscaledZ>a+1;){const L=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[L.key],T&&T.hasData()&&(M=L)}let O=M;for(;O.overscaledZ>a;)if(O=O.scaledTo(O.overscaledZ-1),i[O.key]){g[M.key]=M;break}}}findLoadedParent(i,a){if(i.key in this._loadedParentTiles){const p=this._loadedParentTiles[i.key];return p&&p.tileID.overscaledZ>=a?p:null}for(let p=i.overscaledZ-1;p>=a;p--){const g=i.scaledTo(p),b=this._getLoadedTile(g);if(b)return b}}_getLoadedTile(i){const a=this._tiles[i.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,a){a=a||this._source.tileSize;const p=Math.ceil(i.width/a)+1,g=Math.ceil(i.height/a)+1,b=Math.floor(p*g*5),T=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(M)}handleWrapJump(i){const a=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,a){const p={};for(const g in this._tiles){const b=this._tiles[g];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+a),p[b.tileID.key]=b}this._tiles=p;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(+g,this._tiles[g])}}update(i,a,p,g){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(i,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const b=this._source.type==="batched-model";let T,M=this._source.maxzoom;const O=this.map&&this.map.painter?this.map.painter._terrain:null;if(O&&O.sourceCache===this&&O.attenuationRange()){const U=O.attenuationRange()[0],j=Math.floor(U)-Math.log2(O.getDemUpscale());M>j&&(M=j)}if(this.used||this.usedForTerrain){if(this._source.tileID)T=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(U=>new r.aG(U.canonical.z,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y));else if(this.tileCoverLift!==0){const U=i.clone();U.tileCoverLift=this.tileCoverLift,T=U.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.minzoom<=1&&i.projection.name==="globe"&&(T.push(new r.aG(1,0,1,0,0)),T.push(new r.aG(1,0,1,1,0)),T.push(new r.aG(1,0,1,0,1)),T.push(new r.aG(1,0,1,1,1)))}else if(T=i.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.hasTile){const U=this._source.hasTile.bind(this._source);T=T.filter(j=>U(j))}}else T=[];if(T.length>0&&this.castsShadows&&g&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Bd(this._source.type)){const U=i.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),j=Math.min(U,this._source.maxzoom);if(b){const Z=i.extendTileCover(T,j);for(const ce of Z)T.push(ce)}else{const Z=i.extendTileCover(T,j,g);for(const ce of Z)this._shadowCasterTiles[ce.key]=!0,T.push(ce)}}const L=this._updateRetainedTiles(T);if(Bd(this._source.type)&&T.length!==0){const U={},j={},Z=Object.keys(L);for(const te of Z){const _e=L[te],me=this._tiles[te];if(!me||me.fadeEndTime&&me.fadeEndTime<=r.q.now())continue;const Se=this.findLoadedParent(_e,Math.max(_e.overscaledZ-rs.maxOverzooming,this._source.minzoom));Se&&(this._addTile(Se.tileID),U[Se.tileID.key]=Se.tileID),j[te]=_e}const ce=T[T.length-1].overscaledZ;for(const te in this._tiles){const _e=this._tiles[te];if(L[te]||!_e.hasData())continue;let me=_e.tileID;for(;me.overscaledZ>ce;){me=me.scaledTo(me.overscaledZ-1);const Se=this._tiles[me.key];if(Se&&Se.hasData()&&j[me.key]){L[te]=_e.tileID;break}}}for(const te in U)L[te]||(this._coveredTiles[te]=!0,L[te]=U[te])}for(const U in L)this._tiles[U].clearFadeHold();const k=r.bk(this._tiles,L);for(const U of k){const j=this._tiles[U];j.hasSymbolBuckets&&!j.holdingForFade()?j.setHoldDuration(this.map._fadeDuration):j.hasSymbolBuckets&&!j.symbolFadeFinished()||this._removeTile(+U)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const a={};if(i.length===0)return a;const p={},g=i.reduce((L,k)=>Math.min(L,k.overscaledZ),1/0),b=i[0].overscaledZ,T=Math.max(b-rs.maxOverzooming,this._source.minzoom),M=Math.max(b+rs.maxUnderzooming,this._source.minzoom),O={};for(const L of i){const k=this._addTile(L);a[L.key]=L,k.hasData()||g<this._source.maxzoom&&(O[L.key]=L)}this._retainLoadedChildren(O,g,M,a);for(const L of i){let k=this._tiles[L.key];if(k.hasData())continue;if(L.canonical.z>=this._source.maxzoom){const j=L.children(this._source.maxzoom)[0],Z=this.getTile(j);if(Z&&Z.hasData()){a[j.key]=j;continue}}else{const j=L.children(this._source.maxzoom);if(a[j[0].key]&&a[j[1].key]&&a[j[2].key]&&a[j[3].key])continue}let U=k.wasRequested();for(let j=L.overscaledZ-1;j>=T;--j){const Z=L.scaledTo(j);if(p[Z.key]||(p[Z.key]=!0,k=this.getTile(Z),!k&&U&&(k=this._addTile(Z)),k&&(a[Z.key]=Z,U=k.wasRequested(),k.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const a=[];let p,g=this._tiles[i].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){p=this._loadedParentTiles[g.key];break}a.push(g.key);const b=g.scaledTo(g.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;g=b}for(const b of a)this._loadedParentTiles[b]=p}}_addTile(i){let a=this._tiles[i.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[i.key]||this._reloadTile(i.key,"reloading"),a;a=this._cache.getAndRemove(i),a&&(this._setTileReloadTimer(i.key,a),a.tileID=i,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,a)));const p=!!a;if(!p){const g=this.map?this.map.painter:null,b=this._source.tileSize*i.overscaleFactor();a=this._source.type==="raster-array"?new Ml(i,b,this.transform.tileZoom,g,this._isRaster):new Xa(i,b,this.transform.tileZoom,g,this._isRaster),this._loadTile(a,this._tileLoaded.bind(this,a,i.key,a.state))}return a?(a.uses++,this._tiles[i.key]=a,p||this._source.fire(new r.z("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(i,a){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const p=a.getExpiryTimeout();p&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},p))}_removeTile(i){const a=this._tiles[i];a&&(a.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,a,p){const g=[],b=this.transform;if(!b)return g;const T=b.projection.name==="globe",M=r.at(b.center.lng);for(const O in this._tiles){const L=this._tiles[O];if(p&&L.clearQueryDebugViz(),L.holdingForFade())continue;let k;if(T){const U=L.tileID.canonical;if(U.z===0){const j=[Math.abs(r.aw(M,...Bi(U,-1))-M),Math.abs(r.aw(M,...Bi(U,1))-M)];k=[0,2*j.indexOf(Math.min(...j))-1]}else{const j=[Math.abs(r.aw(M,...Bi(U,-1))-M),Math.abs(r.aw(M,...Bi(U,0))-M),Math.abs(r.aw(M,...Bi(U,1))-M)];k=[j.indexOf(Math.min(...j))-1]}}else k=[0];for(const U of k){const j=i.containsTile(L,b,a,U);j&&g.push(j)}}return g}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(i){return this._getRenderableCoordinates(i)}_getRenderableCoordinates(i,a){const p=this.getRenderableIds(i,a).map(b=>this._tiles[b].tileID),g=this.transform.projection.name==="globe";for(const b of p)b.projMatrix=this.transform.calculateProjMatrix(b.toUnwrapped()),b.expandedProjMatrix=g?this.transform.calculateProjMatrix(b.toUnwrapped(),!1,!0):b.projMatrix;return p}sortCoordinatesByDistance(i){const a=i.slice(),p=this.transform._camera.position,g=this.transform._camera.forward(),b={};for(const T of a){const M=1/(1<<T.canonical.z);b[T.key]=((T.canonical.x+.5)*M+T.wrap-p[0])*g[0]+((T.canonical.y+.5)*M-p[1])*g[1]-p[2]*g[2]}return a.sort((T,M)=>b[T.key]-b[M.key]),a}hasTransition(){if(this._source.hasTransition())return!0;if(Bd(this._source.type))for(const i in this._tiles){const a=this._tiles[i];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=r.q.now())return!0}return!1}setFeatureState(i,a,p){this._state.updateState(i=i||"_geojsonTileLayer",a,p)}removeFeatureState(i,a,p){this._state.removeFeatureState(i=i||"_geojsonTileLayer",a,p)}getFeatureState(i,a){return this._state.getState(i=i||"_geojsonTileLayer",a)}setDependencies(i,a,p){const g=this._tiles[i];g&&g.setDependencies(a,p)}reloadTilesForDependencies(i,a){for(const p in this._tiles)this._tiles[p].hasDependency(i,a)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(i,a))}_preloadTiles(i,a){if(!this._sourceLoaded){const O=()=>{this._sourceLoaded&&(this._source.off("data",O),this._preloadTiles(i,a))};return void this._source.on("data",O)}const p=new Map,g=Array.isArray(i)?i:[i],b=this.map.painter.terrain,T=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const O of g){const L=O.coveringTiles({tileSize:T,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const k of L)p.set(k.key,k);this.usedForTerrain&&O.updateElevation(!1)}const M=Array.from(p.values());r.bl(M,(O,L)=>{const k=new Xa(O,this._source.tileSize*O.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(k,U=>{this._source.type==="raster-dem"&&k.dem&&this._backfillDEM(k),L(U,k)})},a)}}function zr(f,i){const a=Math.abs(2*f.wrap)-+(f.wrap<0),p=Math.abs(2*i.wrap)-+(i.wrap<0);return f.overscaledZ-i.overscaledZ||p-a||i.canonical.y-f.canonical.y||i.canonical.x-f.canonical.x}function Bd(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function Bi(f,i){const a=1<<f.z;return[f.x/a+i,(f.x+1)/a+i]}rs.maxOverzooming=10,rs.maxUnderzooming=3;class Pa{constructor(i){this.style=i,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const i=!1,a=!1;for(const p in this.style._mergedLayers){const g=this.style._mergedLayers[p];if(g.type==="fill-extrusion")this.layers.push({layer:g,visible:i,visibilityChanged:a});else if(g.type==="model"){const b=this.style.getLayerSource(g);b&&b.type==="batched-model"&&this.layers.push({layer:g,visible:i,visibilityChanged:a})}}}onNewFrame(i){this.layersGotHidden=!1;for(const a of this.layers){const p=a.layer;let g=!1;p.type==="fill-extrusion"?g=!p.isHidden(i)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="model"&&(g=!p.isHidden(i)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!g&&a.visible,a.visible=g}}updateZOffset(i,a){this.currentBuildingBuckets=[];for(const g of this.layers){const b=g.layer,T=this.style.getLayerSourceCache(b);let M=1;b.type==="fill-extrusion"&&(M=g.visible?b.paint.get("fill-extrusion-vertical-scale"):0);let O=T?T.getTile(a):null;if(!O&&T&&a.canonical.z>T.getSource().minzoom){let L=a.scaledTo(Math.min(T.getSource().maxzoom,a.overscaledZ-1));for(;L.overscaledZ>=T.getSource().minzoom&&(O=T.getTile(L),!O&&L.overscaledZ!==0);)L=L.scaledTo(L.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:O?O.getBucket(b):null,tileID:O?O.tileID:a,verticalScale:M})}i.hasAnyZOffset=!1;let p=!1;for(let g=0;g<i.symbolInstances.length;g++){const b=i.symbolInstances.get(g),T=b.zOffset,M=this._getHeightAtTileOffset(a,b.tileAnchorX,b.tileAnchorY);b.zOffset=M!==Number.NEGATIVE_INFINITY?M:T,p||T===b.zOffset||(p=!0),i.hasAnyZOffset||b.zOffset===0||(i.hasAnyZOffset=!0)}p&&(i.zOffsetBuffersNeedUpload=!0,i.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(i,a,p,g){let b=a,T=p;if(i.canonical.z!==g.canonical.z){const M=g.canonical,O=1/(1<<i.canonical.z-M.z);b=(a+i.canonical.x*r.ag)*O-M.x*r.ag|0,T=(p+i.canonical.y*r.ag)*O-M.y*r.ag|0}return{tileX:b,tileY:T}}_getHeightAtTileOffset(i,a,p){let g,b;for(let T=0;T<this.layers.length;++T){if(this.layers[T].layer.type!=="fill-extrusion")continue;const{bucket:M,tileID:O,verticalScale:L}=this.currentBuildingBuckets[T];if(!M)continue;const{tileX:k,tileY:U}=this._mapCoordToOverlappingTile(i,a,p,O),j=M.getHeightAtTileCoord(k,U);j&&j.height!==void 0&&(j.hidden?g=j.height:b=Math.max(j.height*L,b||0))}if(b!==void 0)return b;for(let T=0;T<this.layers.length;++T){const M=this.layers[T];if(M.layer.type!=="model"||!M.visible)continue;const{bucket:O,tileID:L}=this.currentBuildingBuckets[T];if(!O)continue;const{tileX:k,tileY:U}=this._mapCoordToOverlappingTile(i,a,p,L),j=O.getHeightAtTileCoord(k,U);if(j&&!j.hidden)return j.height===void 0&&g!==void 0?Math.min(j.maxHeight,g)*j.verticalScale:j.height?j.height*j.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ch(f,i){const a={};for(const p in f)p!=="ref"&&(a[p]=f[p]);return r.bm.forEach(p=>{p in i&&(a[p]=i[p])}),a}function uh(f){f=f.slice();const i=Object.create(null);for(let a=0;a<f.length;a++)i[f[a].id]=f[a];for(let a=0;a<f.length;a++)"ref"in f[a]&&(f[a]=ch(f[a],i[f[a].ref]));return f}const xr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Oc(f,i,a){a.push({command:xr.addSource,args:[f,i[f]]})}function oc(f,i,a){i.push({command:xr.removeSource,args:[f]}),a[f]=!0}function mi(f,i,a,p){oc(f,a,p),Oc(f,i,a)}function $r(f,i,a){let p;for(p in f[a])if(f[a].hasOwnProperty(p)&&p!=="data"&&!r.bn(f[a][p],i[a][p]))return!1;for(p in i[a])if(i[a].hasOwnProperty(p)&&p!=="data"&&!r.bn(f[a][p],i[a][p]))return!1;return!0}function Dr(f,i,a,p,g,b){let T;for(T in i=i||{},f=f||{})f.hasOwnProperty(T)&&(r.bn(f[T],i[T])||a.push({command:b,args:[p,T,i[T],g]}));for(T in i)i.hasOwnProperty(T)&&!f.hasOwnProperty(T)&&(r.bn(f[T],i[T])||a.push({command:b,args:[p,T,i[T],g]}))}function Ws(f){return f.id}function Ka(f,i){return f[i.id]=i,f}class Fr{constructor(i,a){this.reset(i,a)}reset(i,a){this.points=i||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=r.aw(i,0,1);let a=1,p=this._distances[a];const g=i*this.paddedLength+this.padding;for(;p<g&&a<this._distances.length;)p=this._distances[++a];const b=a-1,T=this._distances[b],M=p-T,O=M>0?(g-T)/M:0;return this.points[b].mult(1-O).add(this.points[a].mult(O))}}class mu{constructor(i,a,p){const g=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(i/p),this.yCellCount=Math.ceil(a/p);for(let T=0;T<this.xCellCount*this.yCellCount;T++)g.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=a,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,a,p,g,b){this._forEachCell(a,p,g,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(a),this.bboxes.push(p),this.bboxes.push(g),this.bboxes.push(b)}insertCircle(i,a,p,g){this._forEachCell(a-g,p-g,a+g,p+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(a),this.circles.push(p),this.circles.push(g)}_insertBoxCell(i,a,p,g,b,T){this.boxCells[b].push(T)}_insertCircleCell(i,a,p,g,b,T){this.circleCells[b].push(T)}_query(i,a,p,g,b,T){if(p<0||i>this.width||g<0||a>this.height)return!b&&[];const M=[];if(i<=0&&a<=0&&this.width<=p&&this.height<=g){if(b)return!0;for(let O=0;O<this.boxKeys.length;O++)M.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(let O=0;O<this.circleKeys.length;O++){const L=this.circles[3*O],k=this.circles[3*O+1],U=this.circles[3*O+2];M.push({key:this.circleKeys[O],x1:L-U,y1:k-U,x2:L+U,y2:k+U})}return T?M.filter(T):M}return this._forEachCell(i,a,p,g,this._queryCell,M,{hitTest:b,seenUids:{box:{},circle:{}}},T),b?M.length>0:M}_queryCircle(i,a,p,g,b){const T=i-p,M=i+p,O=a-p,L=a+p;if(M<0||T>this.width||L<0||O>this.height)return!g&&[];const k=[];return this._forEachCell(T,O,M,L,this._queryCellCircle,k,{hitTest:g,circle:{x:i,y:a,radius:p},seenUids:{box:{},circle:{}}},b),g?k.length>0:k}query(i,a,p,g,b){return this._query(i,a,p,g,!1,b)}hitTest(i,a,p,g,b){return this._query(i,a,p,g,!0,b)}hitTestCircle(i,a,p,g){return this._queryCircle(i,a,p,!0,g)}_queryCell(i,a,p,g,b,T,M,O){const L=M.seenUids,k=this.boxCells[b];if(k!==null){const j=this.bboxes;for(const Z of k)if(!L.box[Z]){L.box[Z]=!0;const ce=4*Z;if(i<=j[ce+2]&&a<=j[ce+3]&&p>=j[ce+0]&&g>=j[ce+1]&&(!O||O(this.boxKeys[Z]))){if(M.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[Z],x1:j[ce],y1:j[ce+1],x2:j[ce+2],y2:j[ce+3]})}}}const U=this.circleCells[b];if(U!==null){const j=this.circles;for(const Z of U)if(!L.circle[Z]){L.circle[Z]=!0;const ce=3*Z;if(this._circleAndRectCollide(j[ce],j[ce+1],j[ce+2],i,a,p,g)&&(!O||O(this.circleKeys[Z]))){if(M.hitTest)return T.push(!0),!0;{const te=j[ce],_e=j[ce+1],me=j[ce+2];T.push({key:this.circleKeys[Z],x1:te-me,y1:_e-me,x2:te+me,y2:_e+me})}}}}}_queryCellCircle(i,a,p,g,b,T,M,O){const L=M.circle,k=M.seenUids,U=this.boxCells[b];if(U!==null){const Z=this.bboxes;for(const ce of U)if(!k.box[ce]){k.box[ce]=!0;const te=4*ce;if(this._circleAndRectCollide(L.x,L.y,L.radius,Z[te+0],Z[te+1],Z[te+2],Z[te+3])&&(!O||O(this.boxKeys[ce])))return T.push(!0),!0}}const j=this.circleCells[b];if(j!==null){const Z=this.circles;for(const ce of j)if(!k.circle[ce]){k.circle[ce]=!0;const te=3*ce;if(this._circlesCollide(Z[te],Z[te+1],Z[te+2],L.x,L.y,L.radius)&&(!O||O(this.circleKeys[ce])))return T.push(!0),!0}}}_forEachCell(i,a,p,g,b,T,M,O){const L=this._convertToXCellCoord(i),k=this._convertToYCellCoord(a),U=this._convertToXCellCoord(p),j=this._convertToYCellCoord(g);for(let Z=L;Z<=U;Z++)for(let ce=k;ce<=j;ce++)if(b.call(this,i,a,p,g,this.xCellCount*ce+Z,T,M,O))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,a,p,g,b,T){const M=g-i,O=b-a,L=p+T;return L*L>M*M+O*O}_circleAndRectCollide(i,a,p,g,b,T,M){const O=(T-g)/2,L=Math.abs(i-(g+O));if(L>O+p)return!1;const k=(M-b)/2,U=Math.abs(a-(b+k));if(U>k+p)return!1;if(L<=O||U<=k)return!0;const j=L-O,Z=U-k;return j*j+Z*Z<=p*p}}const na={unknown:0,flipRequired:1,flipNotRequired:2},_u=Math.tan(85*Math.PI/180);function Es(f,i,a,p,g,b,T){const M=r.ab.mat4.create();if(a)if(b.name==="globe"){const O=r.bo(g,i);r.ab.mat4.multiply(M,M,O)}else{const O=r.ab.mat2.invert([],T);M[0]=O[0],M[1]=O[1],M[4]=O[2],M[5]=O[3],p||r.ab.mat4.rotateZ(M,M,g.angle)}else r.ab.mat4.multiply(M,g.labelPlaneMatrix,f);return M}function Ln(f,i,a,p,g,b,T){const M=Es(f,i,a,p,g,b,T);return b.name==="globe"&&a||(M[2]=M[6]=M[10]=M[14]=0),M}function Nd(f,i,a,p,g,b,T){if(a){if(b.name==="globe"){const M=Es(f,i,a,p,g,b,T);return r.ab.mat4.invert(M,M),r.ab.mat4.multiply(M,f,M),M}{const M=r.ab.mat4.clone(f),O=r.ab.mat4.identity([]);return O[0]=T[0],O[1]=T[1],O[4]=T[2],O[5]=T[3],r.ab.mat4.multiply(M,M,O),p||r.ab.mat4.rotateZ(M,M,-g.angle),M}}return g.glCoordMatrix}function Zs(f,i,a,p){const g=[f,i,a,1];a?r.ab.vec4.transformMat4(g,g,p):No(g,g,p);const b=g[3];return g[0]/=b,g[1]/=b,g[2]/=b,g}function hh(f,i){return Math.min(.5+f/i*.5,1.5)}function Lc(f,i){const a=f[0]/f[3],p=f[1]/f[3];return a>=-i[0]&&a<=i[0]&&p>=-i[1]&&p<=i[1]}function dh(f,i,a,p,g,b,T,M,O,L){const k=a.transform,U=p?f.textSizeData:f.iconSizeData,j=r.bp(U,a.transform.zoom),Z=k.projection.name==="globe",ce=[256/a.width*2+1,256/a.height*2+1],te=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;te.clear();let _e=null;Z&&(_e=p?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const me=f.lineVertexArray,Se=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,ke=a.transform.width/a.transform.height;let Oe,je=!1;for(let Ve=0;Ve<Se.length;Ve++){const Ue=Se.get(Ve),{numGlyphs:Ne,writingMode:Ye}=Ue;if(Ye!==r.bq.vertical||je||Oe===r.bq.horizontal||(je=!0),Oe=Ye,(Ue.hidden||Ye===r.bq.vertical)&&!je){kn(Ne,te);continue}je=!1;const it=new r.P(Ue.tileAnchorX,Ue.tileAnchorY);let{x:xt,y:_t,z:Rt}=k.projection.projectTilePoint(it.x,it.y,L.canonical);if(O){const[Dt,Gt,Jt]=O(it);xt+=Dt,_t+=Gt,Rt+=Jt}const Pt=[xt,_t,Rt,1];if(r.ab.vec4.transformMat4(Pt,Pt,i),!Lc(Pt,ce)){kn(Ne,te);continue}const ht=Pt[3],bt=hh(a.transform.getCameraToCenterDistance(k.projection),ht),Vt=r.br(U,j,Ue),ut=T?Vt/bt:Vt*bt,Ot=Zs(xt,_t,Rt,g);if(Ot[3]<=0){kn(Ne,te);continue}let wt={};const Qt=T?null:O,kt=Ra(Ue,ut,!1,M,i,g,b,f.glyphOffsetArray,me,te,_e,Ot,it,wt,ke,Qt,k.projection,L,T);je=kt.useVertical,Qt&&kt.needsFlipping&&(wt={}),(kt.notEnoughRoom||je||kt.needsFlipping&&Ra(Ue,ut,!0,M,i,g,b,f.glyphOffsetArray,me,te,_e,Ot,it,wt,ke,Qt,k.projection,L,T).notEnoughRoom)&&kn(Ne,te)}p?(f.text.dynamicLayoutVertexBuffer.updateData(te),_e&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(_e)):(f.icon.dynamicLayoutVertexBuffer.updateData(te),_e&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(_e))}function gu(f,i,a,p,g,b,T,M,O,L,k,U,j,Z,ce,te){const{lineStartIndex:_e,glyphStartIndex:me,segment:Se}=M,ke=me+M.numGlyphs,Oe=_e+M.lineLength,je=i.getoffsetX(me),Ve=i.getoffsetX(ke-1),Ue=Ja(f*je,a,p,g,b,T,Se,_e,Oe,O,L,k,U,j,!0,Z,ce,te);if(!Ue)return null;const Ne=Ja(f*Ve,a,p,g,b,T,Se,_e,Oe,O,L,k,U,j,!0,Z,ce,te);return Ne?{first:Ue,last:Ne}:null}function Ys(f,i,a,p){return f===r.bq.horizontal&&Math.abs(p)>Math.abs(a)?{useVertical:!0}:f===r.bq.vertical?p>0?{needsFlipping:!0}:null:i!==na.unknown&&function(g,b){return g===0||Math.abs(b/g)>_u}(a,p)?i===na.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function Ra(f,i,a,p,g,b,T,M,O,L,k,U,j,Z,ce,te,_e,me,Se){const ke=i/24,Oe=f.lineOffsetX*ke,je=f.lineOffsetY*ke,{lineStartIndex:Ve,glyphStartIndex:Ue,numGlyphs:Ne,segment:Ye,writingMode:it,flipState:xt}=f,_t=Ve+f.lineLength,Rt=Pt=>{if(k){const[ut,Ot,wt]=Pt.up,Qt=L.length;r.bs(k,Qt+0,ut,Ot,wt),r.bs(k,Qt+1,ut,Ot,wt),r.bs(k,Qt+2,ut,Ot,wt),r.bs(k,Qt+3,ut,Ot,wt)}const[ht,bt,Vt]=Pt.point;r.bt(L,ht,bt,Vt,Pt.angle)};if(Ne>1){const Pt=gu(ke,M,Oe,je,a,U,j,f,O,b,Z,te,!1,_e,me,Se);if(!Pt)return{notEnoughRoom:!0};if(p&&!a){let[ht,bt,Vt]=Pt.first.point,[ut,Ot,wt]=Pt.last.point;[ht,bt]=Zs(ht,bt,Vt,T),[ut,Ot]=Zs(ut,Ot,wt,T);const Qt=Ys(it,xt,(ut-ht)*ce,Ot-bt);if(f.flipState=Qt&&Qt.needsFlipping?na.flipRequired:na.flipNotRequired,Qt)return Qt}Rt(Pt.first);for(let ht=Ue+1;ht<Ue+Ne-1;ht++){const bt=Ja(ke*M.getoffsetX(ht),Oe,je,a,U,j,Ye,Ve,_t,O,b,Z,te,!1,!1,_e,me,Se);if(!bt)return L.length-=4*(ht-Ue),{notEnoughRoom:!0};Rt(bt)}Rt(Pt.last)}else{if(p&&!a){const ht=Zs(j.x,j.y,0,g),bt=Ve+Ye+1,Vt=new r.P(O.getx(bt),O.gety(bt)),ut=Zs(Vt.x,Vt.y,0,g),Ot=ut[3]>0?ut:Vd(j,Vt,ht,1,g,void 0,_e,me.canonical),wt=Ys(it,xt,(Ot[0]-ht[0])*ce,Ot[1]-ht[1]);if(f.flipState=wt&&wt.needsFlipping?na.flipRequired:na.flipNotRequired,wt)return wt}const Pt=Ja(ke*M.getoffsetX(Ue),Oe,je,a,U,j,Ye,Ve,_t,O,b,Z,te,!1,!1,_e,me,Se);if(!Pt)return{notEnoughRoom:!0};Rt(Pt)}return{}}function Us(f,i,a,p,g){const{x:b,y:T,z:M}=p.projectTilePoint(f.x,f.y,i);if(!g)return Zs(b,T,M,a);const[O,L,k]=g(f);return Zs(b+O,T+L,M+k,a)}function Vd(f,i,a,p,g,b,T,M){const O=Us(f.sub(i)._unit()._add(f),M,g,T,b);return r.ab.vec3.sub(O,a,O),r.ab.vec3.normalize(O,O),r.ab.vec3.scaleAndAdd(O,a,O,p)}function Ja(f,i,a,p,g,b,T,M,O,L,k,U,j,Z,ce,te,_e,me){const Se=p?f-i:f+i;let ke=Se>0?1:-1,Oe=0;p&&(ke*=-1,Oe=Math.PI),ke<0&&(Oe+=Math.PI);let je=M+T+(ke>0?0:1)|0,Ve=g,Ue=g,Ne=0,Ye=0;const it=Math.abs(Se),xt=[],_t=[];let Rt=b,Pt=Rt;const ht=()=>Vd(Pt,Rt,Ue,it-Ne+1,k,j,te,_e.canonical);for(;Ne+Ye<=it;){if(je+=ke,je<M||je>=O)return null;if(Ue=Ve,Pt=Rt,xt.push(Ue),Z&&_t.push(Pt),Rt=new r.P(L.getx(je),L.gety(je)),Ve=U[je],!Ve){const Gt=Us(Rt,_e.canonical,k,te,j);Ve=Gt[3]>0?U[je]=Gt:ht()}Ne+=Ye,Ye=r.ab.vec3.distance(Ue,Ve)}ce&&j&&(U[je]&&(Ve=ht(),Ye=r.ab.vec3.distance(Ue,Ve)),U[je]=Ve);const bt=(it-Ne)/Ye,Vt=Rt.sub(Pt)._mult(bt)._add(Pt),ut=r.ab.vec3.sub([],Ve,Ue),Ot=r.ab.vec3.scaleAndAdd([],Ue,ut,bt);let wt=[0,0,1],Qt=ut[0],kt=ut[1];if(me&&(wt=te.upVector(_e.canonical,Vt.x,Vt.y),wt[0]!==0||wt[1]!==0||wt[2]!==1)){const Gt=[wt[2],0,-wt[0]],Jt=r.ab.vec3.cross([],wt,Gt);r.ab.vec3.normalize(Gt,Gt),r.ab.vec3.normalize(Jt,Jt),Qt=r.ab.vec3.dot(ut,Gt),kt=r.ab.vec3.dot(ut,Jt)}if(a){const Gt=r.ab.vec3.cross([],wt,ut);r.ab.vec3.normalize(Gt,Gt),r.ab.vec3.scaleAndAdd(Ot,Ot,Gt,a*ke)}const Dt=Oe+Math.atan2(kt,Qt);return xt.push(Ot),Z&&_t.push(Vt),{point:Ot,angle:Dt,path:xt,tilePath:_t,up:wt}}function kn(f,i){const a=i.length,p=a+4*f;i.resize(p),i.float32.fill(-1/0,4*a,4*p)}function No(f,i,a){const p=i[0],g=i[1];return f[0]=a[0]*p+a[4]*g+a[12],f[1]=a[1]*p+a[5]*g+a[13],f[3]=a[3]*p+a[7]*g+a[15],f}const Ds=100;class qn{constructor(i,a,p=new mu(i.width+200,i.height+200,25),g=new mu(i.width+200,i.height+200,25)){this.transform=i,this.grid=p,this.ignoredGrid=g,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Ds,this.screenBottomBoundary=i.height+Ds,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=a}placeCollisionBox(i,a,p,g,b,T,M,O){let L=p.projectedAnchorX,k=p.projectedAnchorY,U=p.projectedAnchorZ;const j=p.elevation,Z=p.tileID,ce=i.getProjection();if(j&&Z){const[Ve,Ue,Ne]=ce.upVector(Z.canonical,p.tileAnchorX,p.tileAnchorY),Ye=ce.upVectorScale(Z.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;L+=Ve*j*Ye,k+=Ue*j*Ye,U+=Ne*j*Ye}const te=this.projectAndGetPerspectiveRatio(M,L,k,U,p.tileID,ce.name==="globe"||!!j||this.transform.pitch>0,ce),_e=T*te.perspectiveRatio,me=(p.x1*a+g.x-p.padding)*_e+te.point.x,Se=(p.y1*a+g.y-p.padding)*_e+te.point.y,ke=(p.x2*a+g.x+p.padding)*_e+te.point.x,Oe=(p.y2*a+g.y+p.padding)*_e+te.point.y,je=te.perspectiveRatio<=.55||te.occluded;return!this.isInsideGrid(me,Se,ke,Oe)||!b&&this.grid.hitTest(me,Se,ke,Oe,O)||je?{box:[],offscreen:!1,occluded:te.occluded}:{box:[me,Se,ke,Oe],offscreen:this.isOffscreen(me,Se,ke,Oe),occluded:!1}}placeCollisionCircles(i,a,p,g,b,T,M,O,L,k,U,j,Z,ce,te){const _e=[],me=this.transform.elevation,Se=i.getProjection(),ke=me?me.getAtTileOffsetFunc(te,this.transform.center.lat,this.transform.worldSize,Se):null,Oe=new r.P(p.tileAnchorX,p.tileAnchorY);let{x:je,y:Ve,z:Ue}=Se.projectTilePoint(Oe.x,Oe.y,te.canonical);if(ke){const[Vt,ut,Ot]=ke(Oe);je+=Vt,Ve+=ut,Ue+=Ot}const Ne=Se.name==="globe",Ye=this.projectAndGetPerspectiveRatio(M,je,Ve,Ue,te,Ne||!!me||this.transform.pitch>0,Se),{perspectiveRatio:it}=Ye,xt=(U?T/it:T*it)/r.bw,_t=Zs(je,Ve,Ue,O),Rt=Ye.signedDistanceFromCamera>0?gu(xt,b,p.lineOffsetX*xt,p.lineOffsetY*xt,!1,_t,Oe,p,g,O,{},me&&!U?ke:null,U&&!!me,Se,te,U):null;let Pt=!1,ht=!1,bt=!0;if(Rt&&!Ye.occluded){const Vt=.5*Z*it+ce,ut=new r.P(-100,-100),Ot=new r.P(this.screenRightBoundary,this.screenBottomBoundary),wt=new Fr,{first:Qt,last:kt}=Rt,Dt=Qt.path.length;let Gt=[];for(let _i=Dt-1;_i>=1;_i--)Gt.push(Qt.path[_i]);for(let _i=1;_i<kt.path.length;_i++)Gt.push(kt.path[_i]);const Jt=2.5*Vt;L&&(Gt=Gt.map(([_i,qi,Di],Oi)=>(ke&&!Ne&&(Di=ke(Oi<Dt-1?Qt.tilePath[Dt-1-Oi]:kt.tilePath[Oi-Dt+2])[2]),Zs(_i,qi,Di,L))),Gt.some(_i=>_i[3]<=0)&&(Gt=[]));let ci=[];if(Gt.length>0){let _i=1/0,qi=-1/0,Di=1/0,Oi=-1/0;for(const er of Gt)_i=Math.min(_i,er[0]),Di=Math.min(Di,er[1]),qi=Math.max(qi,er[0]),Oi=Math.max(Oi,er[1]);qi>=ut.x&&_i<=Ot.x&&Oi>=ut.y&&Di<=Ot.y&&(ci=[Gt.map(er=>new r.P(er[0],er[1]))],(_i<ut.x||qi>Ot.x||Di<ut.y||Oi>Ot.y)&&(ci=r.bu(ci,ut.x,ut.y,Ot.x,Ot.y)))}for(const _i of ci){wt.reset(_i,.25*Vt);let qi=0;qi=wt.length<=.5*Vt?1:Math.ceil(wt.paddedLength/Jt)+1;for(let Di=0;Di<qi;Di++){const Oi=Di/Math.max(qi-1,1),er=wt.lerp(Oi),Pr=er.x+Ds,Xr=er.y+Ds;_e.push(Pr,Xr,Vt,0);const Hn=Pr-Vt,Tn=Xr-Vt,ar=Pr+Vt,Nr=Xr+Vt;if(bt=bt&&this.isOffscreen(Hn,Tn,ar,Nr),ht=ht||this.isInsideGrid(Hn,Tn,ar,Nr),!a&&this.grid.hitTestCircle(Pr,Xr,Vt,j)&&(Pt=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Pt,occluded:!1}}}}return{circles:!k&&Pt||!ht?[]:_e,offscreen:bt,collisionDetected:Pt,occluded:Ye.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let p=1/0,g=1/0,b=-1/0,T=-1/0;for(const k of i){const U=new r.P(k.x+Ds,k.y+Ds);p=Math.min(p,U.x),g=Math.min(g,U.y),b=Math.max(b,U.x),T=Math.max(T,U.y),a.push(U)}const M=this.grid.query(p,g,b,T).concat(this.ignoredGrid.query(p,g,b,T)),O={},L={};for(const k of M){const U=k.key;if(O[U.bucketInstanceId]===void 0&&(O[U.bucketInstanceId]={}),O[U.bucketInstanceId][U.featureIndex])continue;const j=[new r.P(k.x1,k.y1),new r.P(k.x2,k.y1),new r.P(k.x2,k.y2),new r.P(k.x1,k.y2)];r.bv(a,j)&&(O[U.bucketInstanceId][U.featureIndex]=!0,L[U.bucketInstanceId]===void 0&&(L[U.bucketInstanceId]=[]),L[U.bucketInstanceId].push(U.featureIndex))}return L}insertCollisionBox(i,a,p,g,b){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:g,collisionGroupID:b},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,a,p,g,b){const T=a?this.ignoredGrid:this.grid,M={bucketInstanceId:p,featureIndex:g,collisionGroupID:b};for(let O=0;O<i.length;O+=4)T.insertCircle(M,i[O],i[O+1],i[O+2])}projectAndGetPerspectiveRatio(i,a,p,g,b,T,M){const O=[a,p,g,1];let L=!1;g||this.transform.pitch>0?(r.ab.vec4.transformMat4(O,O,i),this.fogState&&b&&M.name!=="globe"&&(L=function(j,Z,ce,te,_e,me){const Se=me.calculateFogTileMatrix(_e),ke=[Z,ce,te];return r.ab.vec3.transformMat4(ke,ke,Se),Ze(j,r.ab.vec3.length(ke),me.pitch,me._fov)}(this.fogState,a,p,g,b.toUnwrapped(),this.transform)>.9)):No(O,O,i);const k=O[3];return{point:new r.P((O[0]/k+1)/2*this.transform.width+Ds,(-O[1]/k+1)/2*this.transform.height+Ds),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(M)/k*.5,1.5),signedDistanceFromCamera:k,occluded:T&&O[2]>k||L}}isOffscreen(i,a,p,g){return p<Ds||i>=this.screenRightBoundary||g<Ds||a>this.screenBottomBoundary}isInsideGrid(i,a,p,g){return p>=0&&i<this.gridRightBoundary&&g>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const i=r.ab.mat4.identity([]);return r.ab.mat4.translate(i,i,[-100,-100,0]),i}}function yu(f,i,a){const p=i.createTileMatrix(f,f.worldSize,a.toUnwrapped());return r.ab.mat4.multiply(new Float32Array(16),f.projMatrix,p)}function sa(f,i,a){if(i.projection.name===a.projection.name)return f.projMatrix;const p=a.clone();return p.setProjection(i.projection),yu(p,i.getProjection(),f)}function ac(f,i,a){return i.name===a.projection.name?f.projMatrix:yu(a,i,f)}class kc{constructor(i,a,p,g){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?a:-a))):g&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class oa{constructor(i,a,p,g,b,T=!1){this.text=new kc(i?i.text:null,a,p,b),this.icon=new kc(i?i.icon:null,a,g,b),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ud{constructor(i,a,p,g=!1){this.text=i,this.icon=a,this.skipFade=p,this.clipped=g}}class Qa{constructor(){this.invProjMatrix=r.ab.mat4.create(),this.viewportMatrix=r.ab.mat4.create(),this.circles=[]}}class B_{constructor(i,a,p,g,b){this.bucketInstanceId=i,this.featureIndex=a,this.sourceLayerIndex=p,this.bucketIndex=g,this.tileID=b}}class jd{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const a=++this.maxGroupID;this.collisionGroups[i]={ID:a,predicate:p=>p.collisionGroupID===a}}return this.collisionGroups[i]}}function co(f,i,a,p,g){const{horizontalAlign:b,verticalAlign:T}=r.bD(f),M=-(b-.5)*i,O=-(T-.5)*a,L=r.bC(f,p);return new r.P(M+L[0]*g,O+L[1]*g)}function $d(f,i,a,p,g){const b=new r.P(f,i);return a&&b._rotate(p?g:-g),b}class fh{constructor(i,a,p,g,b,T){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new qn(this.transform,b),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new jd(p),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,a,p,g,b=1){const T=p.getBucket(a),M=p.latestFeatureIndex;if(!T||!M||a.fqid!==T.layerIds[0])return;const O=T.layers[0].layout,L=T.layers[0].paint,k=p.collisionBoxArray,U=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),j=p.tileSize/r.ag,Z=p.tileID.toUnwrapped();this.transform.setProjection(T.projection);const ce=(te=p.tileID,_e=T.getProjection(),me=this.transform,_e.name===this.projection?me.calculateProjMatrix(te.toUnwrapped()):yu(me,_e,te));var te,_e,me;const Se=O.get("text-pitch-alignment")==="map",ke=O.get("text-rotation-alignment")==="map";a.compileFilter(a.options);const Oe=a.dynamicFilter(),je=a.dynamicFilterNeedsFeature(),Ve=this.transform.calculatePixelsToTileUnitsMatrix(p),Ue=Ln(ce,p.tileID.canonical,Se,ke,this.transform,T.getProjection(),Ve);let Ne=null;if(Se){const Vt=Nd(ce,p.tileID.canonical,Se,ke,this.transform,T.getProjection(),Ve);Ne=r.ab.mat4.multiply([],this.transform.labelPlaneMatrix,Vt)}let Ye=null;Oe&&p.latestFeatureIndex&&(Ye={unwrappedTileID:Z,dynamicFilter:Oe,dynamicFilterNeedsFeature:je}),this.retainedQueryData[T.bucketInstanceId]=new B_(T.bucketInstanceId,M,T.sourceLayerIndex,T.index,p.tileID);const[it,xt]=T.layers[0].layout.get("text-size-scale-range"),_t=r.aw(b,it,xt),[Rt,Pt]=O.get("icon-size-scale-range"),ht=r.aw(b,Rt,Pt),bt={bucket:T,layout:O,paint:L,posMatrix:ce,textLabelPlaneMatrix:Ue,labelToScreenMatrix:Ne,clippingData:Ye,scale:U,textPixelRatio:j,holdingForFade:p.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:r.bp(T.textSizeData,this.transform.zoom,_t),partiallyEvaluatedIconSize:r.bp(T.iconSizeData,this.transform.zoom,ht),collisionGroup:this.collisionGroups.get(T.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(g)for(const Vt of T.sortKeyRanges){const{sortKey:ut,symbolInstanceStart:Ot,symbolInstanceEnd:wt}=Vt;i.push({sortKey:ut,symbolInstanceStart:Ot,symbolInstanceEnd:wt,parameters:bt})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:bt})}attemptAnchorPlacement(i,a,p,g,b,T,M,O,L,k,U,j,Z,ce,te,_e,me,Se){const{textOffset0:ke,textOffset1:Oe,crossTileID:je}=j,Ve=[ke,Oe],Ue=co(i,p,g,Ve,b),Ne=this.collisionIndex.placeCollisionBox(ce,b,a,$d(Ue.x,Ue.y,T,M,this.transform.angle),U,O,L,k.predicate);if(_e){const Ye=ce.getSymbolInstanceIconSize(Se,this.transform.zoom,j.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ce,Ye,_e,$d(Ue.x,Ue.y,T,M,this.transform.angle),U,O,L,k.predicate).box.length===0)return}if(Ne.box.length>0){let Ye;return this.prevPlacement&&this.prevPlacement.variableOffsets[je]&&this.prevPlacement.placements[je]&&this.prevPlacement.placements[je].text&&(Ye=this.prevPlacement.variableOffsets[je].anchor),this.variableOffsets[je]={textOffset:Ve,width:p,height:g,anchor:i,textScale:b,prevAnchor:Ye},this.markUsedJustification(ce,i,j,te),ce.allowVerticalPlacement&&(this.markUsedOrientation(ce,te,j),this.placedOrientations[je]=te),{shift:Ue,placedGlyphBoxes:Ne}}}placeLayerBucketPart(i,a,p,g,b=1){const{bucket:T,layout:M,paint:O,posMatrix:L,textLabelPlaneMatrix:k,labelToScreenMatrix:U,clippingData:j,textPixelRatio:Z,holdingForFade:ce,collisionBoxArray:te,partiallyEvaluatedTextSize:_e,partiallyEvaluatedIconSize:me,collisionGroup:Se,latestFeatureIndex:ke}=i.parameters,Oe=M.get("text-optional"),je=M.get("icon-optional"),Ve=M.get("text-allow-overlap"),Ue=M.get("icon-allow-overlap"),Ne=M.get("text-rotation-alignment")==="map",Ye=M.get("text-pitch-alignment")==="map",it=M.get("symbol-z-elevate"),xt=O.get("symbol-z-offset"),_t=M.get("symbol-elevation-reference")==="sea",[Rt,Pt]=M.get("text-size-scale-range"),[ht,bt]=M.get("icon-size-scale-range"),Vt=r.aw(b,Rt,Pt),ut=r.aw(b,ht,bt);this.transform.setProjection(T.projection);let Ot=Ve&&(Ue||!T.hasIconData()||je),wt=Ue&&(Ve||!T.hasTextData()||Oe);const Qt=!xt.isConstant();!T.collisionArrays&&te&&T.deserializeCollisionBoxes(te),p&&g&&T.updateCollisionDebugBuffers(this.transform.zoom,te,Vt,ut);const kt=(Dt,Gt,Jt)=>{const{crossTileID:ci,numVerticalGlyphVertices:_i}=Dt;let qi=null;if(j&&j.dynamicFilterNeedsFeature||Qt){const pn=this.retainedQueryData[T.bucketInstanceId];qi=ke.loadFeature({featureIndex:Dt.featureIndex,bucketIndex:pn.bucketIndex,sourceLayerIndex:pn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(j&&!(0,j.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},qi,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new r.P(Dt.tileAnchorX,Dt.tileAnchorY),this.transform.calculateDistanceTileData(j.unwrappedTileID)))return this.placements[ci]=new Ud(!1,!1,!1,!0),void a.add(ci);const Di=xt.evaluate(qi,{});if(a.has(ci))return;if(ce)return void(this.placements[ci]=new Ud(!1,!1,!1));let Oi=!1,er=!1,Pr=!0,Xr=!1,Hn=!1,Tn=null,ar={box:null,offscreen:null,occluded:null},Nr={box:null,offscreen:null,occluded:null},Ai=null,Mr=null,jr=null,Hr=0,Nn=0,Ls=0;Jt.textFeatureIndex?Hr=Jt.textFeatureIndex:Dt.useRuntimeCollisionCircles&&(Hr=Dt.featureIndex),Jt.verticalTextFeatureIndex&&(Nn=Jt.verticalTextFeatureIndex);const gs=pn=>{pn.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const on=this.transform.elevation;pn.elevation=_t?Di:Di+(on?on.getAtTileOffset(pn.tileID,pn.tileAnchorX,pn.tileAnchorY):0),pn.elevation+=Dt.zOffset},ys=Jt.textBox;if(ys){gs(ys);const pn=Or=>{let os=r.bq.horizontal;if(T.allowVerticalPlacement&&!Or&&this.prevPlacement){const ks=this.prevPlacement.placedOrientations[ci];ks&&(this.placedOrientations[ci]=ks,os=ks,this.markUsedOrientation(T,os,Dt))}return os},on=(Or,os)=>{if(T.allowVerticalPlacement&&_i>0&&Jt.verticalTextBox){for(const ks of T.writingModes)if(ks===r.bq.vertical?(ar=os(),Nr=ar):ar=Or(),ar&&ar.box&&ar.box.length)break}else ar=Or()};if(M.get("text-variable-anchor")){let Or=M.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ci]){const ln=this.prevPlacement.variableOffsets[ci];Or.indexOf(ln.anchor)>0&&(Or=Or.filter(po=>po!==ln.anchor),Or.unshift(ln.anchor))}const os=(ln,po,Oa)=>{const qo=T.getSymbolInstanceTextSize(_e,Dt,this.transform.zoom,Gt),Oo=(ln.x2-ln.x1)*qo+2*ln.padding,Nl=(ln.y2-ln.y1)*qo+2*ln.padding,La=Dt.hasIconTextFit&&!Ue?po:null;La&&gs(La);let da={box:[],offscreen:!1,occluded:!1};const ku=Ve?2*Or.length:Or.length;for(let Vl=0;Vl<ku;++Vl){const zu=this.attemptAnchorPlacement(Or[Vl%Or.length],ln,Oo,Nl,qo,Ne,Ye,Z,L,Se,Vl>=Or.length,Dt,Gt,T,Oa,La,_e,me);if(zu&&(da=zu.placedGlyphBoxes,da&&da.box&&da.box.length)){Oi=!0,Tn=zu.shift;break}}return da};on(()=>os(ys,Jt.iconBox,r.bq.horizontal),()=>{const ln=Jt.verticalTextBox;return ln&&gs(ln),T.allowVerticalPlacement&&!(ar&&ar.box&&ar.box.length)&&_i>0&&ln?os(ln,Jt.verticalIconBox,r.bq.vertical):{box:null,offscreen:null,occluded:null}}),ar&&(Oi=ar.box,Pr=ar.offscreen,Xr=ar.occluded);const ks=pn(!(!ar||!ar.box));if(!Oi&&this.prevPlacement){const ln=this.prevPlacement.variableOffsets[ci];ln&&(this.variableOffsets[ci]=ln,this.markUsedJustification(T,ln.anchor,Dt,ks))}}else{const Or=(os,ks)=>{const ln=T.getSymbolInstanceTextSize(_e,Dt,this.transform.zoom,Gt,b),po=this.collisionIndex.placeCollisionBox(T,ln,os,new r.P(0,0),Ve,Z,L,Se.predicate);return po&&po.box&&po.box.length&&(this.markUsedOrientation(T,ks,Dt),this.placedOrientations[ci]=ks),po};on(()=>Or(ys,r.bq.horizontal),()=>{const os=Jt.verticalTextBox;return T.allowVerticalPlacement&&_i>0&&os?(gs(os),Or(os,r.bq.vertical)):{box:null,offscreen:null,occluded:null}}),pn(!!(ar&&ar.box&&ar.box.length))}}if(Ai=ar,Oi=Ai&&Ai.box&&Ai.box.length>0,Pr=Ai&&Ai.offscreen,Xr=Ai&&Ai.occluded,Dt.useRuntimeCollisionCircles){const pn=T.text.placedSymbolArray.get(Dt.centerJustifiedTextSymbolIndex>=0?Dt.centerJustifiedTextSymbolIndex:Dt.verticalPlacedTextSymbolIndex),on=r.br(T.textSizeData,_e,pn),Or=M.get("text-padding");Mr=this.collisionIndex.placeCollisionCircles(T,Ve,pn,T.lineVertexArray,T.glyphOffsetArray,on,L,k,U,p,Ye,Se.predicate,Dt.collisionCircleDiameter*on/r.bw,Or,this.retainedQueryData[T.bucketInstanceId].tileID),Oi=Ve||Mr.circles.length>0&&!Mr.collisionDetected,Pr=Pr&&Mr.offscreen,Xr=Mr.occluded}if(Jt.iconFeatureIndex&&(Ls=Jt.iconFeatureIndex),Jt.iconBox){const pn=on=>{gs(on);const Or=Dt.hasIconTextFit&&Tn?$d(Tn.x,Tn.y,Ne,Ye,this.transform.angle):new r.P(0,0),os=T.getSymbolInstanceIconSize(me,this.transform.zoom,Dt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,os,on,Or,Ue,Z,L,Se.predicate)};Nr&&Nr.box&&Nr.box.length&&Jt.verticalIconBox?(jr=pn(Jt.verticalIconBox),er=jr.box.length>0):(jr=pn(Jt.iconBox),er=jr.box.length>0),Pr=Pr&&jr.offscreen,Hn=jr.occluded}const ha=Oe||Dt.numHorizontalGlyphVertices===0&&_i===0,fo=je||Dt.numIconVertices===0;if(ha||fo?fo?ha||(er=er&&Oi):Oi=er&&Oi:er=Oi=er&&Oi,Oi&&Ai&&Ai.box&&this.collisionIndex.insertCollisionBox(Ai.box,M.get("text-ignore-placement"),T.bucketInstanceId,Nr&&Nr.box&&Nn?Nn:Hr,Se.ID),er&&jr&&this.collisionIndex.insertCollisionBox(jr.box,M.get("icon-ignore-placement"),T.bucketInstanceId,Ls,Se.ID),Mr&&(Oi&&this.collisionIndex.insertCollisionCircles(Mr.circles,M.get("text-ignore-placement"),T.bucketInstanceId,Hr,Se.ID),p)){const pn=T.bucketInstanceId;let on=this.collisionCircleArrays[pn];on===void 0&&(on=this.collisionCircleArrays[pn]=new Qa);for(let Or=0;Or<Mr.circles.length;Or+=4)on.circles.push(Mr.circles[Or+0]),on.circles.push(Mr.circles[Or+1]),on.circles.push(Mr.circles[Or+2]),on.circles.push(Mr.collisionDetected?1:0)}const Vn=T.projection.name!=="globe";Ot=Ot&&(Vn||!Xr),wt=wt&&(Vn||!Hn),this.placements[ci]=new Ud(Oi||Ot,er||wt,Pr||T.justReloaded),a.add(ci)};if(it&&this.buildingIndex&&(this.buildingIndex.updateZOffset(T,this.retainedQueryData[T.bucketInstanceId].tileID),T.updateZOffset()),T.sortFeaturesByY){const Dt=T.getSortedSymbolIndexes(this.transform.angle);for(let Gt=Dt.length-1;Gt>=0;--Gt){const Jt=Dt[Gt];kt(T.symbolInstances.get(Jt),Jt,T.collisionArrays[Jt])}T.hasAnyZOffset&&r.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const Dt=T.getSortedIndexesByZOffset();for(let Gt=0;Gt<Dt.length;++Gt){const Jt=Dt[Gt];kt(T.symbolInstances.get(Jt),Jt,T.collisionArrays[Jt])}}else for(let Dt=i.symbolInstanceStart;Dt<i.symbolInstanceEnd;Dt++)kt(T.symbolInstances.get(Dt),Dt,T.collisionArrays[Dt]);if(p&&T.bucketInstanceId in this.collisionCircleArrays){const Dt=this.collisionCircleArrays[T.bucketInstanceId];r.ab.mat4.invert(Dt.invProjMatrix,L),Dt.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(i,a,p,g){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:O,crossTileID:L}=p,k=r.bB(a),U=g===r.bq.vertical?O:k==="left"?b:k==="center"?T:k==="right"?M:-1;b>=0&&(i.text.placedSymbolArray.get(b).crossTileID=U>=0&&b!==U?0:L),T>=0&&(i.text.placedSymbolArray.get(T).crossTileID=U>=0&&T!==U?0:L),M>=0&&(i.text.placedSymbolArray.get(M).crossTileID=U>=0&&M!==U?0:L),O>=0&&(i.text.placedSymbolArray.get(O).crossTileID=U>=0&&O!==U?0:L)}markUsedOrientation(i,a,p){const g=a===r.bq.horizontal||a===r.bq.horizontalOnly?a:0,b=a===r.bq.vertical?a:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:O,verticalPlacedTextSymbolIndex:L}=p,k=i.text.placedSymbolArray;T>=0&&(k.get(T).placedOrientation=g),M>=0&&(k.get(M).placedOrientation=g),O>=0&&(k.get(O).placedOrientation=g),L>=0&&(k.get(L).placedOrientation=b)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let p=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const g=a?a.symbolFadeChange(i):1,b=a?a.opacities:{},T=a?a.variableOffsets:{},M=a?a.placedOrientations:{};for(const O in this.placements){const L=this.placements[O],k=b[O];k?(this.opacities[O]=new oa(k,g,L.text,L.icon,null,L.clipped),p=p||L.text!==k.text.placed||L.icon!==k.icon.placed):(this.opacities[O]=new oa(null,g,L.text,L.icon,L.skipFade,L.clipped),p=p||L.text||L.icon)}for(const O in b){const L=b[O];if(!this.opacities[O]){const k=new oa(L,g,!1,!1);k.isHidden()||(this.opacities[O]=k,p=p||L.text.placed||L.icon.placed)}}for(const O in T)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=T[O]);for(const O in M)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=M[O]);p?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:i)}updateLayerOpacities(i,a,p,g){const b=new Set;for(const T of a){const M=T.getBucket(i);M&&T.latestFeatureIndex&&i.fqid===M.layerIds[0]&&(this.updateBucketOpacities(M,b,T,T.collisionBoxArray,p,g,T.tileID,i.scope),M.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(M,T.tileID),M.updateZOffset()))}}updateBucketOpacities(i,a,p,g,b,T,M,O){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const L=i.layers[0].layout,k=i.layers[0].paint,U=!!i.layers[0].dynamicFilter(),j=new oa(null,0,!1,!1,!0),Z=L.get("text-allow-overlap"),ce=L.get("icon-allow-overlap"),te=L.get("text-variable-anchor"),_e=L.get("text-rotation-alignment")==="map",me=L.get("text-pitch-alignment")==="map",Se=k.get("symbol-z-offset"),ke=L.get("symbol-elevation-reference")==="sea",Oe=!Se.isConstant(),je=new oa(null,0,Z&&(ce||!i.hasIconData()||L.get("icon-optional")),ce&&(Z||!i.hasTextData()||L.get("text-optional")),!0);!i.collisionArrays&&g&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(g);const Ve=(Ne,Ye,it)=>{for(let xt=0;xt<Ye/4;xt++)Ne.opacityVertexArray.emplaceBack(it)};let Ue=0;T&&i.updateReplacement(M,T);for(let Ne=0;Ne<i.symbolInstances.length;Ne++){const Ye=i.symbolInstances.get(Ne),{numHorizontalGlyphVertices:it,numVerticalGlyphVertices:xt,crossTileID:_t,numIconVertices:Rt,tileAnchorX:Pt,tileAnchorY:ht}=Ye;let bt=null;const Vt=this.retainedQueryData[i.bucketInstanceId];Oe&&Ye&&Vt&&(bt=p.latestFeatureIndex.loadFeature({featureIndex:Ye.featureIndex,bucketIndex:Vt.bucketIndex,sourceLayerIndex:Vt.sourceLayerIndex,layoutVertexArrayOffset:0}));const ut=Se.evaluate(bt,{}),Ot=a.has(_t);let wt=this.opacities[_t];Ot?wt=j:wt||(wt=je,this.opacities[_t]=wt),a.add(_t);const Qt=it>0||xt>0,kt=Rt>0,Dt=this.placedOrientations[_t],Gt=Dt===r.bq.vertical,Jt=Dt===r.bq.horizontal||Dt===r.bq.horizontalOnly;!Qt&&!kt||wt.isHidden()||Ue++;let ci=!1;if((Qt||kt)&&T)for(const _i of i.activeReplacements){if(r.bx(_i,b,r.by.Symbol,O)||_i.min.x>Pt||Pt>_i.max.x||_i.min.y>ht||ht>_i.max.y)continue;const qi=r.bz(Pt,ht,M.canonical,_i.footprintTileId.canonical);if(ci=r.bA(qi,_i.footprint),ci)break}if(Qt){const _i=ci?el:lc(wt.text);Ve(i.text,it,Gt?el:_i),Ve(i.text,xt,Jt?el:_i);const qi=wt.text.isHidden(),{leftJustifiedTextSymbolIndex:Di,centerJustifiedTextSymbolIndex:Oi,rightJustifiedTextSymbolIndex:er,verticalPlacedTextSymbolIndex:Pr}=Ye,Xr=i.text.placedSymbolArray,Hn=qi||Gt?1:0;Di>=0&&(Xr.get(Di).hidden=Hn),Oi>=0&&(Xr.get(Oi).hidden=Hn),er>=0&&(Xr.get(er).hidden=Hn),Pr>=0&&(Xr.get(Pr).hidden=qi||Jt?1:0);const Tn=this.variableOffsets[_t];Tn&&this.markUsedJustification(i,Tn.anchor,Ye,Dt);const ar=this.placedOrientations[_t];ar&&(this.markUsedJustification(i,"left",Ye,ar),this.markUsedOrientation(i,ar,Ye))}if(kt){const _i=ci?el:lc(wt.icon),{placedIconSymbolIndex:qi,verticalPlacedIconSymbolIndex:Di}=Ye,Oi=i.icon.placedSymbolArray,er=wt.icon.isHidden()?1:0;qi>=0&&(Ve(i.icon,Rt,Gt?el:_i),Oi.get(qi).hidden=er),Di>=0&&(Ve(i.icon,Ye.numVerticalIconVertices,Jt?el:_i),Oi.get(Di).hidden=er)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const _i=i.collisionArrays[Ne];if(_i){let qi=new r.P(0,0),Di=!0;if(_i.textBox||_i.verticalTextBox){if(te){const er=this.variableOffsets[_t];er?(qi=co(er.anchor,er.width,er.height,er.textOffset,er.textScale),_e&&qi._rotate(me?this.transform.angle:-this.transform.angle)):Di=!1}U&&(Di=!wt.clipped),_i.textBox&&vu(i.textCollisionBox.collisionVertexArray,wt.text.placed,!Di||Gt,ut,ke,qi.x,qi.y),_i.verticalTextBox&&vu(i.textCollisionBox.collisionVertexArray,wt.text.placed,!Di||Jt,ut,ke,qi.x,qi.y)}const Oi=Di&&!!(!Jt&&_i.verticalIconBox);_i.iconBox&&vu(i.iconCollisionBox.collisionVertexArray,wt.icon.placed,Oi,ut,ke,Ye.hasIconTextFit?qi.x:0,Ye.hasIconTextFit?qi.y:0),_i.verticalIconBox&&vu(i.iconCollisionBox.collisionVertexArray,wt.icon.placed,!Oi,ut,ke,Ye.hasIconTextFit?qi.x:0,Ye.hasIconTextFit?qi.y:0)}}}if(i.fullyClipped=Ue===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const Ne=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=Ne.invProjMatrix,i.placementViewportMatrix=Ne.viewportMatrix,i.collisionCircleArray=Ne.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,a){const p=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*p>i}setStale(){this.stale=!0}}function vu(f,i,a,p,g,b,T){f.emplaceBack(i?1:0,a?1:0,b||0,T||0,p,g?1:0),f.emplaceBack(i?1:0,a?1:0,b||0,T||0,p,g?1:0),f.emplaceBack(i?1:0,a?1:0,b||0,T||0,p,g?1:0),f.emplaceBack(i?1:0,a?1:0,b||0,T||0,p,g?1:0)}const xu=Math.pow(2,25),N_=Math.pow(2,24),V_=Math.pow(2,17),bu=Math.pow(2,16),wu=Math.pow(2,9),qd=Math.pow(2,8),zc=Math.pow(2,1);function lc(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const i=f.placed?1:0,a=Math.floor(127*f.opacity);return a*xu+i*N_+a*V_+i*bu+a*wu+i*qd+a*zc+i}const el=0;class Il{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,a,p,g,b,T){const M=this._bucketParts;for(;this._currentTileIndex<i.length;)if(a.getBucketParts(M,g,i[this._currentTileIndex],this._sortAcrossTiles,T),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((O,L)=>O.sortKey-L.sortKey));this._currentPartIndex<M.length;){const O=M[this._currentPartIndex];if(a.placeLayerBucketPart(O,this._seenCrossTileIDs,p,O.symbolInstanceStart===0,T),this._currentPartIndex++,b())return!0}return!1}}class U_{constructor(i,a,p,g,b,T,M,O,L){this.placement=new fh(i,b,T,M,O,L),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(i,a,p,g,b){const T=r.q.now(),M=()=>{const O=r.q.now()-T;return!this._forceFullPlacement&&O>2};for(;this._currentPlacementIndex>=0;){const O=a[i[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(O.type==="symbol"&&(!O.minzoom||O.minzoom<=L)&&(!O.maxzoom||O.maxzoom>L)){const k=O,U=k.layout.get("symbol-z-elevate"),j=k.layout.get("symbol-sort-key").constantOr(1)!==void 0,Z=k.layout.get("symbol-z-order"),ce=Z==="viewport-y"||Z==="auto"&&!(Z!=="viewport-y"&&j),te=k.layout.get("text-allow-overlap")||k.layout.get("icon-allow-overlap")||k.layout.get("text-ignore-placement")||k.layout.get("icon-ignore-placement"),_e=ce&&te,me=this._inProgressLayer=this._inProgressLayer||new Il(k),Se=r.aC(O.source,O.scope);if(me.continuePlacement(U||_e?g[Se]:p[Se],this.placement,this._showCollisionBoxes,O,M,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Hd=512/r.ag/2;class ph{constructor(i,a,p){this.tileID=i,this.bucketInstanceId=p,this.index=new r.bE(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const g=i.canonical.x*r.ag,b=i.canonical.y*r.ag;for(let T=0;T<a.length;T++){const{key:M,crossTileID:O,tileAnchorX:L,tileAnchorY:k}=a.get(T),U=Math.floor((g+L)*Hd),j=Math.floor((b+k)*Hd);this.index.add(U,j),this.keys.push(M),this.crossTileIDs.push(O)}this.index.finish()}findMatches(i,a,p){const g=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),b=Hd/Math.pow(2,a.canonical.z-this.tileID.canonical.z),T=a.canonical.x*r.ag,M=a.canonical.y*r.ag;for(let O=0;O<i.length;O++){const L=i.get(O);if(L.crossTileID)continue;const{key:k,tileAnchorX:U,tileAnchorY:j}=L,Z=Math.floor((T+U)*b),ce=Math.floor((M+j)*b),te=this.index.range(Z-g,ce-g,Z+g,ce+g);for(const _e of te){const me=this.crossTileIDs[_e];if(this.keys[_e]===k&&!p.has(me)){p.add(me),L.crossTileID=me;break}}}}}class Ip{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Pp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const a=Math.round((i-this.lng)/360);if(a!==0)for(const p in this.indexes){const g=this.indexes[p],b={};for(const T in g){const M=g[T];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+a),b[M.tileID.key]=M}this.indexes[p]=b}this.lng=i}addBucket(i,a,p){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let b=0;b<a.symbolInstances.length;b++)a.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const g=this.usedCrossTileIDs[i.overscaledZ];for(const b in this.indexes){const T=this.indexes[b];if(Number(b)>i.overscaledZ)for(const M in T){const O=T[M];O.tileID.isChildOf(i)&&O.findMatches(a.symbolInstances,i,g)}else{const M=T[i.scaledTo(Number(b)).key];M&&M.findMatches(a.symbolInstances,i,g)}}for(let b=0;b<a.symbolInstances.length;b++){const T=a.symbolInstances.get(b);T.crossTileID||(T.crossTileID=p.generate(),g.add(T.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new ph(i,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(i,a){for(const p of a.crossTileIDs)this.usedCrossTileIDs[i].delete(p)}removeStaleBuckets(i){let a=!1;for(const p in this.indexes){const g=this.indexes[p];for(const b in g)i[g[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,g[b]),delete g[b],a=!0)}return a}}class mh{constructor(){this.layerIndexes={},this.crossTileIDs=new Ip,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,a,p,g){let b=this.layerIndexes[i.fqid];b===void 0&&(b=this.layerIndexes[i.fqid]=new Pp);let T=!1;const M={};g.name!=="globe"&&b.handleWrapJump(p);for(const O of a){const L=O.getBucket(i);L&&i.fqid===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(O.tileID,L,this.crossTileIDs)&&(T=!0),M[L.bucketInstanceId]=!0)}return b.removeStaleBuckets(M)&&(T=!0),T}pruneUnusedLayers(i){const a={};i.forEach(p=>{a[p]=!0});for(const p in this.layerIndexes)a[p]||delete this.layerIndexes[p]}}const cc=771;class gr{constructor(i,a,p,g){this.blendFunction=i,this.blendColor=a,this.mask=p,this.blendEquation=g}}gr.Replace=[1,0,1,0],gr.disabled=new gr(gr.Replace,r.aj.transparent,[!1,!1,!1,!1]),gr.unblended=new gr(gr.Replace,r.aj.transparent,[!0,!0,!0,!0]),gr.alphaBlended=new gr([1,cc,1,cc],r.aj.transparent,[!0,!0,!0,!0]),gr.alphaBlendedNonPremultiplied=new gr([770,cc,770,cc],r.aj.transparent,[!0,!0,!0,!0]),gr.multiply=new gr([774,0,774,0],r.aj.transparent,[!0,!0,!0,!0]);class Ri{constructor(i,a,p){this.func=i,this.mask=a,this.range=p}}Ri.ReadOnly=!1,Ri.ReadWrite=!0,Ri.disabled=new Ri(519,Ri.ReadOnly,[0,1]);const _h=7680;class $i{constructor(i,a,p,g,b,T){this.test=i,this.ref=a,this.mask=p,this.fail=g,this.depthFail=b,this.pass=T}}$i.disabled=new $i({func:519,mask:0},0,0,_h,_h,_h);const Fc=1029,es=2305;class Fi{constructor(i,a,p){this.enable=i,this.mode=a,this.frontFace=p}}function Pl(f,i){const a=r.bG(f,3);r.ab.mat4.fromQuat(f,i),r.bI(f,3,a)}function Rl(f,i){const a=r.ab.quat.identity([]);return r.ab.quat.rotateZ(a,a,-i),r.ab.quat.rotateX(a,a,-f),a}function Xn(f,i){const a=[f[0],f[1],0],p=[i[0],i[1],0];if(r.ab.vec3.length(a)>=1e-15){const T=r.ab.vec3.normalize([],a);r.ab.vec3.scale(p,T,r.ab.vec3.dot(p,T)),i[0]=p[0],i[1]=p[1]}const g=r.ab.vec3.cross([],i,f);if(r.ab.vec3.len(g)<1e-15)return null;const b=Math.atan2(-g[1],g[0]);return Rl(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),b)}Fi.disabled=new Fi(!1,Fc,es),Fi.backCCW=new Fi(!0,Fc,es),Fi.backCW=new Fi(!0,Fc,2304),Fi.frontCW=new Fi(!0,1028,2304),Fi.frontCCW=new Fi(!0,1028,es);class Dl{constructor(i,a){this.position=i,this.orientation=a}get position(){return this._position}set position(i){if(i){const a=i instanceof r.aa?i:new r.aa(i[0],i[1],i[2]);this._renderWorldCopies&&(a.x=r.bF(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(i,a){if(this.orientation=null,!this.position)return;const p=this.position,g=this._elevation?this._elevation.getAtPointOrZero(r.aa.fromLngLat(i)):0,b=r.aa.fromLngLat(i,g),T=[b.x-p.x,b.y-p.y,b.z-p.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Xn(T,a)}setPitchBearing(i,a){this.orientation=Rl(r.ai(i),r.ai(-a))}}class rn{constructor(i,a){this._transform=r.ab.mat4.identity([]),this.orientation=a,this.position=i}get mercatorPosition(){const i=this.position;return new r.aa(i[0],i[1],i[2])}get position(){const i=r.bG(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var a;i&&r.bI(this._transform,3,[(a=i)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||r.ab.quat.identity([]),i&&Pl(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,a){this._orientation=Rl(i,a),Pl(this._transform,this._orientation)}forward(){const i=r.bG(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=r.bG(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=r.bG(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,a){const p=new Float64Array(16);return r.ab.mat4.invert(p,this.getWorldToCamera(i,a)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(i,a,p){const g=this.position;r.ab.vec3.scale(g,g,-i);const b=new Float64Array(16);return r.ab.mat4.fromScaling(b,[p,p,p]),r.ab.mat4.translate(b,b,g),b[10]*=a,b}getWorldToCamera(i,a){const p=new Float64Array(16),g=new Float64Array(4),b=this.position;return r.ab.quat.conjugate(g,this._orientation),r.ab.vec3.scale(b,b,-i),r.ab.mat4.fromQuat(p,g),r.ab.mat4.translate(p,p,b),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=a,p[9]*=a,p[10]*=a,p[11]*=a,p}getCameraToClipPerspective(i,a,p,g){const b=new Float64Array(16);return r.ab.mat4.perspective(b,i,a,p,g),b}getCameraToClipOrthographic(i,a,p,g,b,T){const M=new Float64Array(16);return r.ab.mat4.ortho(M,i,a,p,g,b,T),M}getDistanceToElevation(i,a=!1){const p=i===0?0:r.bH(i,a?r.aS(this.position[1]):this.position[1]),g=this.forward();return(p-this.position[2])/g[2]}clone(){return new rn([...this.position],[...this.orientation])}}const Wr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class ii{constructor(i=0,a=0,p=0,g=0){if(isNaN(i)||i<0||isNaN(a)||a<0||isNaN(p)||p<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=a,this.left=p,this.right=g}interpolate(i,a,p){return a.top!=null&&i.top!=null&&(this.top=r.af(i.top,a.top,p)),a.bottom!=null&&i.bottom!=null&&(this.bottom=r.af(i.bottom,a.bottom,p)),a.left!=null&&i.left!=null&&(this.left=r.af(i.left,a.left,p)),a.right!=null&&i.right!=null&&(this.right=r.af(i.right,a.right,p)),this}getCenter(i,a){const p=r.aw((this.left+i-this.right)/2,0,i),g=r.aw((this.top+a-this.bottom)/2,0,a);return new r.P(p,g)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new ii(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const gh=(f,i,a)=>(1-a)*f+a*i,Tu=f=>f*f*f*f*f;class Bc{constructor(i,a,p,g,b,T,M){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=i||0,this._maxZoom=a||22,this._minPitch=p??0,this._maxPitch=g??60,this.setProjection(T),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new r.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ii,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new rn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const i=new Bc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(i,a=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(i||p)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return r.ay(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=r.bP(this.projectionOptions);const p=this.getProjection(),g=!r.bn(a,p);return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(i){return this._orthographicProjectionAtLowPitch!==i&&(this._orthographicProjectionAtLowPitch=i,this._calcMatrices(),!0)}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.bP({name:"mercator"});const a=i!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bF(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const a=-i*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=r.ab.mat2.create(),r.ab.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const a=r.aw(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=r.ai(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const a=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(i){this._tileCoverLift!==i&&(this._tileCoverLift=i)}_updateCameraOnTerrain(){const i=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&i===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||i===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=i||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let g=0,b=0;for(let T=0;T<a.length;T++){const M=new r.P(a[T][0]*this.width,p+a[T][1]*(this.height-p)),O=i.pointCoordinate(M);if(!O)continue;const L=1/Math.hypot(O[0]-this._camera.position[0],O[1]-this._camera.position[1]);g+=O[3]*L,b+=L}return b===0?NaN:g/b}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*a,g=this._mercatorZfromZoom(i),b=this._mercatorZfromZoom(this._maxZoom),T=Math.max(g-p,b);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let p;p=i.z<this._camera.position[2]?[a.x,a.y,a.z]:[i.x,i.y,i.z];const g=r.ab.vec3.length(r.ab.vec3.sub([],this._camera.position,p));return r.aw(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let a=!1;if(i.orientation&&!r.ab.quat.exactEquals(i.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(i.orientation)),i.position){const p=[i.position.x,i.position.y,i.position.z];r.ab.vec3.exactEquals(p,this._camera.position)||(this._setCameraPosition(p),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,a=new Dl;return a.position=new r.aa(i[0],i[1],i[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(i){if(!r.ab.quat.length(i))return!1;r.ab.quat.normalize(i,i);const a=r.ab.vec3.transformQuat([],[0,0,-1],i),p=r.ab.vec3.transformQuat([],[0,-1,0],i);if(p[2]<0)return!1;const g=Xn(a,p);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(i){const a=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;i[2]=r.aw(i[2],g/p,g/a),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,a,p){this._unmodified=!1,this._edgeInsets.interpolate(i,a,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const a=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(i){const a=[new r.bQ(0,i)];if(this.renderWorldCopies){const p=this.pointCoordinate(new r.P(0,0)),g=this.pointCoordinate(new r.P(this.width,0)),b=this.pointCoordinate(new r.P(this.width,this.height)),T=this.pointCoordinate(new r.P(0,this.height)),M=Math.floor(Math.min(p.x,g.x,b.x,T.x)),O=Math.floor(Math.max(p.x,g.x,b.x,T.x)),L=1;for(let k=M-L;k<=O+L;k++)k!==0&&a.push(new r.bQ(k,i))}return a}isLODDisabled(i){return(!i||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(i,a,p){let g=[];const b=p!==void 0,T=!b;if(T&&this.zoom<a||b&&p[0]===0&&p[1]===0)return g;const M=new Set,O=(k,U,j,Z,ce)=>{const te=r.c5(U,k,j,Z,ce);M.has(te)||(g.push(new r.aG(k,U,j,Z,ce)),M.add(te))};for(let k=0;k<i.length;k++){const U=i[k];if(T&&U.canonical.z!==a)continue;const j=U.canonical,Z=U.overscaledZ,ce=U.wrap,te=1<<j.z,_e=j.x+1<te,me=j.x>0,Se=j.y+1<te,ke=j.y>0,Oe=U.wrap-(me?0:1),je=U.wrap+(_e?0:1),Ve=me?j.x-1:te-1,Ue=_e?j.x+1:0;if(b)p[0]<0?(O(Z,je,j.z,Ue,j.y),p[1]<0&&Se&&(O(Z,ce,j.z,j.x,j.y+1),O(Z,je,j.z,Ue,j.y+1)),p[1]>0&&ke&&(O(Z,ce,j.z,j.x,j.y-1),O(Z,je,j.z,Ue,j.y-1))):p[0]>0?(O(Z,Oe,j.z,Ve,j.y),p[1]<0&&Se&&(O(Z,ce,j.z,j.x,j.y+1),O(Z,Oe,j.z,Ve,j.y+1)),p[1]>0&&ke&&(O(Z,ce,j.z,j.x,j.y-1),O(Z,Oe,j.z,Ve,j.y-1))):p[1]<0&&Se?O(Z,ce,j.z,j.x,j.y+1):ke&&O(Z,ce,j.z,j.x,j.y-1);else{const Ne=U.visibleQuadrants;1&Ne&&(O(Z,Oe,j.z,Ve,j.y),ke&&(O(Z,ce,j.z,j.x,j.y-1),O(Z,Oe,j.z,Ve,j.y-1))),2&Ne&&(O(Z,je,j.z,Ue,j.y),ke&&(O(Z,ce,j.z,j.x,j.y-1),O(Z,je,j.z,Ue,j.y-1))),4&Ne&&(O(Z,Oe,j.z,Ve,j.y),Se&&(O(Z,ce,j.z,j.x,j.y+1),O(Z,Oe,j.z,Ve,j.y+1))),8&Ne&&(O(Z,je,j.z,Ue,j.y),Se&&(O(Z,ce,j.z,j.x,j.y+1),O(Z,je,j.z,Ue,j.y+1)))}}const L=[];for(const k of g)g.some(U=>k.isChildOf(U))||L.push(k);if(g=L.filter(k=>!i.some(U=>!!(k.overscaledZ<a&&U.isChildOf(k))||k.equals(U)||k.isChildOf(U))),T){const k=1<<a,U=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),j=[k*U.x,k*U.y],Z=4,ce=Z*Z;g=g.filter(te=>{const _e=te.canonical.x+.5-j[0],me=te.canonical.y+.5-j[1];return _e*_e+me*me<ce})}return g}coveringTiles(i){let a=this.coveringZoomLevel(i);const p=a,g=this.elevation&&this.elevation.exaggeration(),b=g&&!i.isTerrainDEM,T=this.projection.name==="mercator";if(i.minzoom!==void 0&&a<i.minzoom)return[];i.maxzoom!==void 0&&a>i.maxzoom&&(a=i.maxzoom);const M=this.locationCoordinate(this.center),O=this.center.lat,L=1<<a,k=[L*M.x,L*M.y,0],U=this.projection.name==="globe",j=!U,Z=r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,j),ce=U?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),te=L*r.bH(1,this.center.lat),_e=this._camera.position[2]/r.bH(1,this.center.lat),me=[L*ce.x,L*ce.y,_e*(j?1:te)],Se=U||g,ke=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),Oe=this.isLODDisabled(!0)?a:0;let je;if(this._elevation&&i.isTerrainDEM)je=1e4*this._elevation.exaggeration();else if(this._elevation){const ut=this._elevation.getMinMaxForVisibleTiles();je=ut?ut.max:this._centerAltitude}else je=this._centerAltitude;const Ve=i.isTerrainDEM?-je:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ue=this.projection.isReprojectedInTileSpace?r.bS(this):1,Ne=ut=>{const wt=new r.aa(ut.x+25e-6,ut.y,ut.z),Qt=new r.aa(ut.x,ut.y+25e-6,ut.z),kt=ut.toLngLat(),Dt=wt.toLngLat(),Gt=Qt.toLngLat(),Jt=this.locationCoordinate(kt),ci=this.locationCoordinate(Dt),_i=this.locationCoordinate(Gt),qi=Math.hypot(ci.x-Jt.x,ci.y-Jt.y),Di=Math.hypot(_i.x-Jt.x,_i.y-Jt.y);return Math.sqrt(qi*Di)*Ue/25e-6},Ye=ut=>{const Ot=je,wt=Ve;return{aabb:r.bV(this,L,0,0,0,ut,wt,Ot,this.projection),zoom:0,x:0,y:0,minZ:wt,maxZ:Ot,wrap:ut,fullyVisible:!1}},it=[];let xt=[];const _t=a,Rt=i.reparseOverscaled?p:a,Pt=(_e-this._centerAltitude)*te,ht=ut=>{if(!this._elevation||!ut.tileID||!T)return;const Ot=this._elevation.getMinMaxForTile(ut.tileID),wt=ut.aabb;Ot?(wt.min[2]=Ot.min,wt.max[2]=Ot.max,wt.center[2]=(wt.min[2]+wt.max[2])/2):(ut.shouldSplit=Vt(ut),ut.shouldSplit||(wt.min[2]=wt.max[2]=wt.center[2]=this._centerAltitude))},bt=(ut,Ot)=>{if(.707*Ot<ut)return 1;const wt=Ot/ut;return wt/(1.4144271570014144+(Math.pow(1.1,wt-1.4144271570014144+1)-1)/(1.1-1)-1)},Vt=ut=>{if(ut.zoom<Oe)return!0;if(ut.zoom===_t)return!1;if(ut.shouldSplit!=null)return ut.shouldSplit;const Ot=ut.aabb.distanceX(me),wt=ut.aabb.distanceY(me);let Qt=Pt,kt=1;if(U){Qt=ut.aabb.distanceZ(me);const Di=Math.pow(2,ut.zoom),Oi=r.aS((ut.y+1)/Di),er=r.aS(ut.y/Di),Pr=Math.min(Math.max(O,Oi),er),Xr=r.c9(Pr)/r.c9(O);if(kt=Pr===O?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Xr/this._mercatorScaleRatio),this.zoom<=r.c6&&ut.zoom===_t-1&&Xr>=.9)return!0}else if(b&&(Qt=ut.aabb.distanceZ(me)*te),this.projection.isReprojectedInTileSpace&&p<=5){const Di=Math.pow(2,ut.zoom),Oi=Ne(new r.aa((ut.x+.5)/Di,(ut.y+.5)/Di));kt=Oi>.85?1:Oi}if(!T){const Di=Math.sqrt(Ot*Ot+wt*wt+Qt*Qt);let Oi=(1<<_t-ut.zoom)*ke*kt;return Oi*=bt(Math.max(Qt,Pt),Di),Di<Oi}let Dt=Number.MAX_VALUE,Gt=0;const Jt=ut.aabb.getCorners(),ci=[];for(const Di of Jt){r.ab.vec3.sub(ci,Di,me),U||(b?ci[2]*=te:ci[2]=Pt);const Oi=r.ab.vec3.dot(ci,this._camera.forward());Oi<Dt&&(Dt=Oi,Gt=Math.abs(ci[2]))}let _i=(1<<_t-ut.zoom)*ke*kt;if(_i*=bt(Math.max(Gt,Pt),Dt),Dt<_i)return!0;const qi=ut.aabb.closestPoint(k);return qi[0]===k[0]&&qi[1]===k[1]};if(this.renderWorldCopies)for(let ut=1;ut<=3;ut++)it.push(Ye(-ut)),it.push(Ye(ut));for(it.push(Ye(0));it.length>0;){const ut=it.pop(),Ot=ut.x,wt=ut.y;let Qt=ut.fullyVisible;const kt=()=>this.projection.name==="globe"&&(ut.y===0||ut.y===(1<<ut.zoom)-1);if(!Qt){let Dt=Se?ut.aabb.intersects(Z):ut.aabb.intersectsFlat(Z);if(Dt===0&&kt()){const Gt=new r.bT(ut.zoom,Ot,wt);Dt=r.bU(this,L,Gt,!0).intersects(Z)}if(Dt===0)continue;Qt=Dt===2}if(ut.zoom!==_t&&Vt(ut))for(let Dt=0;Dt<4;Dt++){const Gt=(Ot<<1)+Dt%2,Jt=(wt<<1)+(Dt>>1),ci={aabb:T?ut.aabb.quadrant(Dt):r.bV(this,L,ut.zoom+1,Gt,Jt,ut.wrap,ut.minZ,ut.maxZ,this.projection),zoom:ut.zoom+1,x:Gt,y:Jt,wrap:ut.wrap,fullyVisible:Qt,tileID:void 0,shouldSplit:void 0,minZ:ut.minZ,maxZ:ut.maxZ};b&&!U&&(ci.tileID=new r.aG(ut.zoom+1===_t?Rt:ut.zoom+1,ut.wrap,ut.zoom+1,Gt,Jt),ht(ci)),it.push(ci)}else{const Dt=ut.zoom===_t?Rt:ut.zoom;if(i.minzoom&&i.minzoom>Dt)continue;let Gt=0;if(!Qt){let qi=Se?ut.aabb.intersectsPrecise(Z):ut.aabb.intersectsPreciseFlat(Z);if(qi===0&&kt()){const Di=new r.bT(ut.zoom,Ot,wt);qi=r.bU(this,L,Di,!0).intersectsPrecise(Z)}if(qi===0)continue;if(i.calculateQuadrantVisibility)if(Z.containsPoint(ut.aabb.center))Gt=15;else for(let Di=0;Di<4;Di++)ut.aabb.quadrant(Di).intersects(Z)!==0&&(Gt|=1<<Di)}const Jt=k[0]-(.5+Ot+(ut.wrap<<ut.zoom))*(1<<a-ut.zoom),ci=k[1]-.5-wt,_i=ut.tileID?ut.tileID:new r.aG(Dt,ut.wrap,ut.zoom,Ot,wt);i.calculateQuadrantVisibility&&(_i.visibleQuadrants=Gt),xt.push({tileID:_i,distanceSq:Jt*Jt+ci*ci})}}if(this.fogCullDistSq){const ut=this.fogCullDistSq,Ot=this.horizonLineFromTop();xt=xt.filter(wt=>{const Qt=[0,0,0,1],kt=[r.ag,r.ag,0,1],Dt=this.calculateFogTileMatrix(wt.tileID.toUnwrapped());r.ab.vec4.transformMat4(Qt,Qt,Dt),r.ab.vec4.transformMat4(kt,kt,Dt);const Gt=r.ab.vec4.min([],Qt,kt),Jt=r.ab.vec4.max([],Qt,kt),ci=r.bW(Gt,Jt);if(ci===0)return!0;let _i=!1;const qi=this._elevation;if(qi&&ci>ut&&Ot!==0){const Di=this.calculateProjMatrix(wt.tileID.toUnwrapped());let Oi;i.isTerrainDEM||(Oi=qi.getMinMaxForTile(wt.tileID)),Oi||(Oi={min:Ve,max:je});const er=r.c7(this.rotation),Pr=[er[0]*r.ag,er[1]*r.ag,Oi.max];r.ab.vec3.transformMat4(Pr,Pr,Di),_i=(1-Pr[1])*this.height*.5<Ot}return ci<ut||_i})}return xt.sort((ut,Ot)=>ut.distanceSq-Ot.distanceSq).map(ut=>ut.tileID)}resize(i,a){this.width=i,this.height=a,this.pixelsToGLUnits=[2/i,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const a=r.aw(i.lat,-r.bX,r.bX),p=this.projection.project(i.lng,a);return new r.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,a){let p,g;const b=this.centerPoint;if(this.projection.name==="globe"){const M=this.worldSize;p=(a.x-b.x)/M,g=(a.y-b.y)/M}else{const M=this.pointCoordinate(a),O=this.pointCoordinate(b);p=M.x-O.x,g=M.y-O.y}const T=this.locationCoordinate(i);this.setLocation(new r.aa(T.x-p,T.y-g))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,a){const p=a?r.bH(a,i.lat):void 0,g=this.projection.project(i.lng,i.lat);return new r.aa(g.x,g.y,p)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,a){const p=a??this._centerAltitude,g=[i.x,i.y,0,1],b=[i.x,i.y,1,1];r.ab.vec4.transformMat4(g,g,this.pixelMatrixInverse),r.ab.vec4.transformMat4(b,b,this.pixelMatrixInverse);const T=b[3];r.ab.vec4.scale(g,g,1/g[3]),r.ab.vec4.scale(b,b,1/T);const M=g[2],O=b[2];return{p0:g,p1:b,t:M===O?0:(p-M)/(O-M)}}screenPointToMercatorRay(i){const a=[i.x,i.y,0,1],p=[i.x,i.y,1,1];return r.ab.vec4.transformMat4(a,a,this.pixelMatrixInverse),r.ab.vec4.transformMat4(p,p,this.pixelMatrixInverse),r.ab.vec4.scale(a,a,1/a[3]),r.ab.vec4.scale(p,p,1/p[3]),a[2]=r.bH(a[2],this._center.lat)*this.worldSize,p[2]=r.bH(p[2],this._center.lat)*this.worldSize,r.ab.vec4.scale(a,a,1/this.worldSize),r.ab.vec4.scale(p,p,1/this.worldSize),new r.aq([a[0],a[1],a[2]],r.ab.vec3.normalize([],r.ab.vec3.sub([],p,a)))}rayIntersectionCoordinate(i){const{p0:a,p1:p,t:g}=i,b=r.bH(a[2],this._center.lat),T=r.bH(p[2],this._center.lat);return new r.aa(r.af(a[0],p[0],g)/this.worldSize,r.af(a[1],p[1],g)/this.worldSize,r.af(b,T,g))}pointCoordinate(i,a=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,a)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let a=this.projection.pointCoordinate3D(this,i.x,i.y);if(a)return new r.aa(a[0],a[1],a[2]);let p=0,g=this.horizonLineFromTop();if(i.y>g)return this.pointCoordinate(i);const b=.02*g,T=i.clone();for(let M=0;M<10&&g-p>b;M++){T.y=r.af(p,g,.66);const O=this.projection.pointCoordinate3D(this,T.x,T.y);O?(g=T.y,a=O):p=T.y}return a?new r.aa(a[0],a[1],a[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=r.bY)return!this.isPointAboveHorizon(i);const a=this.pointCoordinate(i);return a.y>=0&&a.y<=1}_coordinatePoint(i,a){const p=a&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,g=[i.x*this.worldSize,i.y*this.worldSize,p+i.toAltitude(),1];return r.ab.vec4.transformMat4(g,g,this.pixelMatrix),g[3]>0?new r.P(g[0]/g[3],g[1]/g[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:a}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,b=this.pointLocation3D(new r.P(a,i)),T=this.pointLocation3D(new r.P(g,i)),M=this.pointLocation3D(new r.P(g,p)),O=this.pointLocation3D(new r.P(a,p));let L=Math.min(b.lng,T.lng,M.lng,O.lng),k=Math.max(b.lng,T.lng,M.lng,O.lng),U=Math.min(b.lat,T.lat,M.lat,O.lat),j=Math.max(b.lat,T.lat,M.lat,O.lat);const Z=Math.pow(2,-this.zoom)/16*270,ce=this.projection.name==="globe"?1:4,te=(_e,me,Se,ke,Oe)=>{const je=(_e+Se)/2,Ve=(me+ke)/2,Ue=new r.P(je,Ve),{lng:Ne,lat:Ye}=this.pointLocation3D(Ue),it=Math.max(0,L-Ne,U-Ye,Ne-k,Ye-j);L=Math.min(L,Ne),k=Math.max(k,Ne),U=Math.min(U,Ye),j=Math.max(j,Ye),(Oe<ce||it>Z)&&(te(_e,me,je,Ve,Oe+1),te(je,Ve,Se,ke,Oe+1))};if(te(a,i,g,i,1),te(g,i,g,p,1),te(g,p,a,p,1),te(a,p,a,i,1),this.projection.name==="globe"){const[_e,me]=r.bZ(this);_e?(j=90,k=180,L=-180):me&&(U=-90,k=180,L=-180)}return new r.az(new r.bO(L,U),new r.bO(k,j))}_getBoundsRectangular(i,a){const{top:p,left:g}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,M=new r.P(g,p),O=new r.P(T,p),L=new r.P(T,b),k=new r.P(g,b);let U=this.pointCoordinate(M,i),j=this.pointCoordinate(O,i);const Z=this.pointCoordinate(L,a),ce=this.pointCoordinate(k,a),te=(_e,me)=>(me.y-_e.y)/(me.x-_e.x);return U.y>1&&j.y>=0?U=new r.aa((1-ce.y)/te(ce,U)+ce.x,1):U.y<0&&j.y<=1&&(U=new r.aa(-ce.y/te(ce,U)+ce.x,0)),j.y>1&&U.y>=0?j=new r.aa((1-Z.y)/te(Z,j)+Z.x,1):j.y<0&&U.y<=1&&(j=new r.aa(-Z.y/te(Z,j)+Z.x,0)),new r.az().extend(this.coordinateLocation(U)).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(ce)).extend(this.coordinateLocation(Z))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=i.visibleDemTiles.reduce((p,g)=>{if(g.dem){const b=g.dem.tree;p.min=Math.min(p.min,b.minimums[0]),p.max=Math.max(p.max,b.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*i.exaggeration(),a.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-a*(1-this._horizonShift);return i?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-r.bX,this.maxLat=r.bX,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.at(this.minLng)*this.tileSize,this.worldMaxX=r.at(this.maxLng)*this.tileSize,this.worldMinY=r.aA(this.maxLat)*this.tileSize,this.worldMaxY=r.aA(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,a){return this.projection.createTileMatrix(this,a,i)}calculateDistanceTileData(i){const a=i.key,p=this._distanceTileDataCache;if(p[a])return p[a];const g=i.canonical,b=1/this.height,T=this.cameraWorldSize,M=T/this.zoomScale(g.z),O=(g.x+Math.pow(2,g.z)*i.wrap)*M,L=g.y*M,k=this.point;k.x*=T/this.worldSize,k.y*=T/this.worldSize;const U=this.angle,j=Math.sin(-U),Z=-Math.cos(-U);return p[a]={bearing:[j,Z],center:[(k.x-O)*b,(k.y-L)*b],scale:M/r.ag*b},p[a]}calculateFogTileMatrix(i){const a=i.key,p=this._fogTileMatrixCache;if(p[a])return p[a];const g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return r.ab.mat4.multiply(g,this.worldToFogMatrix,g),p[a]=new Float32Array(g),p[a]}calculateProjMatrix(i,a=!1,p=!1){const g=i.key;let b;if(b=p?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,b[g])return b[g];const T=this.calculatePosMatrix(i,this.worldSize);let M;return M=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,r.ab.mat4.multiply(T,M,T),b[g]=new Float32Array(T),b[g]}calculatePixelsToTileUnitsMatrix(i){const a=i.tileID.key,p=this._pixelsToTileUnitsCache;if(p[a])return p[a];const g=r.b_(i,this);return p[a]=g,p[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const i=1/this.worldSize,a=r.ab.mat4.fromScaling([],[i,i,i]);return r.ab.mat4.multiply(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const a=r.bH(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(a),g=this._camera.forward(),b=r.bH(1,this._center.lat);p[2]/=b,g[2]/=b,r.ab.vec3.normalize(g,g);const T=i.raycast(p,g,i.exaggeration());if(T){const M=r.ab.vec3.scaleAndAdd([],p,g,T),O=new r.aa(M[0],M[1],r.bH(M[2],r.aS(M[1]))),L=(O.z+r.ab.vec3.length([O.x-p[0],O.y-p[1],O.z-p[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=O.toAltitude(),this._center=this.coordinateLocation(O),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const a=this._elevation,p=r.bH(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(p),b=a.getAtPointOrZero(new r.aa(...g)),T=this.pixelsPerMeter/this.worldSize*b,M=this._minimumHeightOverTerrain(),O=g[2]-T;if(O<=M)if(O<0||i){const L=this.locationCoordinate(this._center,this._centerAltitude),k=[g[0],g[1],L.z-g[2]],U=r.ab.vec3.length(k);k[2]-=(M-O)/this._pixelsPerMercatorPixel;const j=r.ab.vec3.length(k);if(j===0)return;r.ab.vec3.scale(k,k,U/j*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],L.z*this._pixelsPerMercatorPixel-k[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const j=this.center;return j.lat=r.aw(j.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(j.lng=r.aw(j.lng,this.minLng,this.maxLng)),this.center=j,void(this._constraining=!1)}const a=this._unmodified,{x:p,y:g}=this.point;let b=0,T=p,M=g;const O=this.width/2,L=this.height/2,k=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(g-L<k&&(M=k+L),g+L>U&&(M=U-L),U-k<this.height&&(b=Math.max(b,this.height/(U-k)),M=(U+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const j=this.worldMinX*this.scale,Z=this.worldMaxX*this.scale,ce=this.worldSize/2-(j+Z)/2;T=(p+ce+this.worldSize)%this.worldSize-ce,T-O<j&&(T=j+O),T+O>Z&&(T=Z-O),Z-j<this.width&&(b=Math.max(b,this.width/(Z-j)),T=(Z+j)/2)}T===p&&M===g||(this.center=this.unproject(new r.P(T,M))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,a=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.bH(1,this.center.lat)/r.bH(1,r.c8));const g=r.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?p:1,T=this._camera.getWorldToCamera(this.worldSize,b);let M;const O=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(O[8]=2*-i.x/this.width,O[9]=2*i.y/this.height,this.isOrthographic){let Ye=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),it=Ye*this.aspect,xt=-it,_t=-Ye;it-=i.x,xt-=i.x,Ye+=i.y,_t+=i.y,M=this._camera.getCameraToClipOrthographic(xt,it,_t,Ye,this._nearZ,this._farZ),((Rt,Pt,ht,bt)=>{for(let Vt=0;Vt<16;Vt++)Rt[Vt]=gh(Pt[Vt],ht[Vt],bt)})(M,M,O,Tu(this.pitch>=15?1:this.pitch/15))}else M=O;const L=r.ab.mat4.mul([],O,T);let k=r.ab.mat4.mul([],M,T);if(this.projection.isReprojectedInTileSpace){const Ye=this.locationCoordinate(this.center),it=r.ab.mat4.identity([]);r.ab.mat4.translate(it,it,[Ye.x*this.worldSize,Ye.y*this.worldSize,0]),r.ab.mat4.multiply(it,it,r.c0(this)),r.ab.mat4.translate(it,it,[-Ye.x*this.worldSize,-Ye.y*this.worldSize,0]),r.ab.mat4.multiply(k,k,it),r.ab.mat4.multiply(L,L,it),this.inverseAdjustmentMatrix=r.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.ab.mat4.scale([],k,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=k,this.invProjMatrix=r.ab.mat4.invert(new Float64Array(16),this.projMatrix),a){const Ye=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ye[8]=2*-i.x/this.width,Ye[9]=2*i.y/this.height,this.expandedFarZProjMatrix=r.ab.mat4.mul([],Ye,T)}else this.expandedFarZProjMatrix=this.projMatrix;const U=r.ab.mat4.invert([],M);this.frustumCorners=r.c2.fromInvProjectionMatrix(U,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);const j=new Float32Array(16);r.ab.mat4.identity(j),r.ab.mat4.scale(j,j,[1,-1,1]),r.ab.mat4.rotateX(j,j,this._pitch),r.ab.mat4.rotateZ(j,j,this.angle);const Z=r.ab.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.ab.mat4.clone(Z);const ce=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Z[8]=2*-i.x/this.width,Z[9]=2*(i.y+ce)/this.height,this.skyboxMatrix=r.ab.mat4.multiply(j,Z,j);const te=this.point,_e=te.x,me=te.y,Se=this.width%2/2,ke=this.height%2/2,Oe=Math.cos(this.angle),je=Math.sin(this.angle),Ve=_e-Math.round(_e)+Oe*Se+je*ke,Ue=me-Math.round(me)+Oe*ke+je*Se,Ne=new Float64Array(k);if(r.ab.mat4.translate(Ne,Ne,[Ve>.5?Ve-1:Ve,Ue>.5?Ue-1:Ue,0]),this.alignedProjMatrix=Ne,k=r.ab.mat4.create(),r.ab.mat4.scale(k,k,[this.width/2,-this.height/2,1]),r.ab.mat4.translate(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=r.ab.mat4.create(),r.ab.mat4.scale(k,k,[1,-1,1]),r.ab.mat4.translate(k,k,[-1,-1,0]),r.ab.mat4.scale(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=r.ab.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,L),this._calcFogMatrices(),this._distanceTileDataCache={},k=r.ab.mat4.invert(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=k,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.c3(this);const Ye=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.ab.vec3.transformMat4(Ye,Ye,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=k;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,p=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,b=[i,i,a];r.ab.vec3.scale(b,b,g),r.ab.vec3.scale(p,p,-1),r.ab.vec3.multiply(p,p,b);const T=r.ab.mat4.create();r.ab.mat4.translate(T,T,p),r.ab.mat4.scale(T,T,b),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,a,g)}_computeCameraPosition(i){const a=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),g=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-i/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-p[0]*b,g.y/this.worldSize-p[1]*b,i/this.worldSize*this._centerAltitude-p[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],g=i[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(b=Math.min((a-p)/g,1)),this._camera.position=r.ab.vec3.scaleAndAdd([],this._camera.position,i,b),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,a=this._camera.forward(),{pitch:p,bearing:g}=this._camera.getPitchBearing(),b=r.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.ai(this._maxPitch)),M=Math.max((i[2]-b)/Math.cos(p),T),O=this._zoomFromMercatorZ(M);r.ab.vec3.scaleAndAdd(i,i,a,M),this._pitch=r.aw(p,r.ai(this.minPitch),r.ai(this.maxPitch)),this.angle=r.bF(g,-Math.PI,Math.PI),this._setZoom(r.aw(O,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.aa(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let a=0,p=r.bY,g=0,b=1/0;for(;p-a>1e-6&&p>a;){const T=a+.5*(p-a),M=this.tileSize*Math.pow(2,T),O=this.getCameraToCenterDistance(this.projection,T,M),L=this.scaleZoom(O/(i*this.tileSize)),k=Math.abs(T-L);k<b&&(b=k,g=T),T<L?a=T:p=T}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,a){const p=Math.min(i.x,a.x),g=Math.max(i.x,a.x),b=Math.min(i.y,a.y),T=Math.max(i.y,a.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const M=[new r.P(p,b),new r.P(g,T),new r.P(p,T),new r.P(g,b)],O=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const k of M){const U=this.pointRayIntersection(k);if(U.t<0)return!0;const j=this.rayIntersectionCoordinate(U);if(j.x<O||j.y<0||j.x>L||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(i,a){const p=r.ab.vec3.length(r.ab.vec3.sub([],this._camera.position,i)),g=this._zoomFromMercatorZ(p)+a;return p-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){const i=function([a,p,g],b){const T=[a,p,g,1];r.ab.vec4.transformMat4(T,T,b);const M=T[3]=Math.max(T[3],1e-6);return T[0]/=M,T[1]/=M,T[2]/=M,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,i))}}getCameraToCenterDistance(i,a=this.zoom,p=this.worldSize){const g=r.b$(i,a,this.width,this.height,1024),b=i.pixelSpaceConversion(this.center.lat,p,g);let T=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(T=gh(1,T,Tu(this.pitch>=15?1:this.pitch/15))),T}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.ab.mat4.multiply(i,i,this.globeMatrix),i}getFrustum(i){return r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,this.projection.zAxisUnit==="meters")}}const tl=(f,i)=>{if(i>0&&f.terrain&&r.w("Cutoff is currently disabled on terrain"),i<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const a=f.transform,p=Math.max(Math.abs(a._zoom-(f.minCutoffZoom-1)),1),g=a.isLODDisabled(!1)?r.ac(60,45,a.pitch):r.ac(30,15,a.pitch),b=a._farZ-a._nearZ,T=i*a.height,M=((1-(O=g))*a.cameraToCenterDistance+O*(a._farZ+T))*p;var O;return{shouldRenderCutoff:g<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(M-a._nearZ)/b,(M-T-a._nearZ)/b]}}},Os={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class il{constructor(i,a){this.aabb=i,this.lastCascade=a}}class Gd{add(i,a){const p=this.receivers[i.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],a.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],a.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],a.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],a.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],a.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],a.max[2])):this.receivers[i.key]=new il(a,null)}clear(){this.receivers={}}get(i){return this.receivers[i.key]}computeRequiredCascades(i,a,p){const g=r.cd.fromPoints(i.points);let b=0;for(const T in this.receivers){const M=this.receivers[T];if(!M||!g.intersectsAabb(M.aabb))continue;M.aabb.min=g.closestPoint(M.aabb.min),M.aabb.max=g.closestPoint(M.aabb.max);const O=M.aabb.getCorners();for(let L=0;L<p.length;L++){let k=!0;for(const U of O){const j=[U[0]*a,U[1]*a,U[2]];if(r.ab.vec3.transformMat4(j,j,p[L].matrix),j[0]<-1||j[0]>1||j[1]<-1||j[1]>1){k=!1;break}}if(M.lastCascade=L,b=Math.max(b,L),k)break}}return b+1}}class uc{constructor(i){this.painter=i,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Gd,this._depthMode=new Ri(i.context.gl.LEQUAL,Ri.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,i.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),i.tp.registerParameter(Os,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),i.tp.registerParameter(Os,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),i.tp.registerParameter(Os,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),i.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const i of this._cascades)i.texture.destroy(),i.framebuffer.destroy();this._cascades=[]}updateShadowParameters(i,a){const p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;const g=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||g<=0||(this._shadowLayerCount=p.style.order.reduce((ce,te)=>{const _e=p.style._mergedLayers[te];return ce+(_e.hasShadowPass()&&!_e.isHidden(i.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const b=p.context,T=Os.shadowMapResolution,M=Os.shadowMapResolution;if(this._cascades.length===0||Os.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ce=0;ce<Os.cascadeCount;++ce){const te=p._shadowMapDebug,_e=b.gl,me=b.createFramebuffer(T,M,te,"texture"),Se=new r.T(b,{width:T,height:M,data:null},_e.DEPTH_COMPONENT16);if(me.depthAttachment.set(Se.texture),te){const ke=new r.T(b,{width:T,height:M,data:null},_e.RGBA8);me.colorAttachment.set(ke.texture)}this._cascades.push({framebuffer:me,texture:Se,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.bR,scale:0})}}this.shadowDirection=dc(a);let O=0;if(i.elevation){const ce=i.elevation,te=[1e4,-1e4];ce.visibleDemTiles.filter(_e=>_e.dem).forEach(_e=>{const me=_e.dem.tree;te[0]=Math.min(te[0],me.minimums[0]),te[1]=Math.max(te[1],me.maximums[0])}),te[0]!==1e4&&(O=(te[1]-te[0])*ce.exaggeration())}const L=1.5*i.cameraToCenterDistance,k=3*L,U=new Float64Array(16);for(let ce=0;ce<this._cascades.length;++ce){const te=this._cascades[ce];let _e=i.height/50,me=1;Os.cascadeCount===1?me=k:ce===0?me=L:(_e=L,me=k);const[Se,ke]=j_(i,this.shadowDirection,_e,me,Os.shadowMapResolution,O);te.scale=i.scale,te.matrix=Se,te.boundingSphereRadius=ke,r.ab.mat4.invert(U,te.matrix),te.frustum=r.bR.fromInvProjectionMatrix(U,1,0,!0),te.far=me}const j=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[j].far,this._cascades[j].far],this._uniformValues.u_shadow_intensity=g,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Os.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Os.shadowMapResolution,this._uniformValues.u_shadowmap_0=Wr.ShadowMap0,this._uniformValues.u_shadowmap_1=Wr.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Z=p.transform.elevation;for(const ce of this._groundShadowTiles){let te={min:0,max:0};if(Z){const _e=Z.getMinMaxForTile(ce);_e&&(te=_e)}this.addShadowReceiver(ce.toUnwrapped(),te.min,te.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(i){this._enabled=i}drawShadowPass(i,a){if(!this.enabled)return;const p=this.painter,g=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),g.viewport.set([0,0,Os.shadowMapResolution,Os.shadowMapResolution]);for(let b=0;b<this._numCascadesToRender;++b){p.currentShadowCascade=b,g.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),g.clear({color:r.aj.white,depth:1});for(const T of i.order){const M=i._mergedLayers[T];if(!M.hasShadowPass()||M.isHidden(p.transform.zoom))continue;const O=i.getLayerSourceCache(M),L=O?a[O.id]:void 0;(M.type==="model"||L&&L.length)&&p.renderLayer(p,O,M,L)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const i=this.painter,a=i.style,p=i.context,g=a.directionalLight,b=a.ambientLight;if(!g||!b)return;const T=[],M=tl(i,i.longestCutoffRange);M.shouldRenderCutoff&&T.push("RENDER_CUTOFF"),T.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&T.push("NORMAL_OFFSET");const O=Wd(a,g,b),L=new Ri(p.gl.LEQUAL,Ri.ReadOnly,i.depthRangeFor3D);for(const k of this._groundShadowTiles){const U=k.toUnwrapped(),j=i.isTileAffectedByFog(k),Z=i.getOrCreateProgram("groundShadow",{defines:T,overrideFog:j});this.setupShadows(U,Z),i.uploadCommonUniforms(p,Z,U,null,M);const ce={u_matrix:i.transform.calculateProjMatrix(U),u_ground_shadow_factor:O};Z.draw(i,p.gl.TRIANGLES,L,$i.disabled,gr.multiply,Fi.disabled,ce,"ground_shadow",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments,{},i.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?gr.unblended:gr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(i){const a=this.painter.transform,p=a.calculatePosMatrix(i,a.worldSize);return r.ab.mat4.multiply(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(i){return r.ab.mat4.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}setupShadows(i,a,p,g=0){if(!this.enabled)return;const b=this.painter.transform,T=this.painter.context,M=T.gl,O=this._uniformValues,L=new Float64Array(16),k=b.calculatePosMatrix(i,b.worldSize);for(let U=0;U<this._cascades.length;U++)r.ab.mat4.multiply(L,this._cascades[U].matrix,k),O[U===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(L),T.activeTexture.set(M.TEXTURE0+Wr.ShadowMap0+U),this._cascades[U].texture.bind(M.NEAREST,M.CLAMP_TO_EDGE);if(this.useNormalOffset=!!p,this.useNormalOffset){const U=r.cc(i.canonical),j=2/b.tileSize*r.ag/Os.shadowMapResolution,Z=j*this._cascades[0].boundingSphereRadius,ce=j*this._cascades[this._cascades.length-1].boundingSphereRadius,te=(p==="vector-tile"?1:3)/Math.pow(2,g-i.canonical.z-(1-b.zoom+Math.floor(b.zoom)));O.u_shadow_normal_offset=[U,Z*te,ce*te],O.u_shadow_bias=[6e-5,.0012,.012]}else O.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(T,O)}setupShadowsFromMatrix(i,a,p=!1){if(!this.enabled)return;const g=this.painter.context,b=g.gl,T=this._uniformValues,M=new Float64Array(16);for(let O=0;O<Os.cascadeCount;O++)r.ab.mat4.multiply(M,this._cascades[O].matrix,i),T[O===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),g.activeTexture.set(b.TEXTURE0+Wr.ShadowMap0+O),this._cascades[O].texture.bind(b.NEAREST,b.CLAMP_TO_EDGE);if(this.useNormalOffset=p,p){const O=Os.normalOffset;T.u_shadow_normal_offset=[1,O,O],T.u_shadow_bias=[6e-5,.0012,.012]}else T.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(g,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(i,a,p,g){if(g[2]>=0)return{};const b=function(O,L,k){const U=k/(1<<O.canonical.z);return new r.cd([O.canonical.x*U+O.wrap*k,O.canonical.y*U+O.wrap*k,0],[(O.canonical.x+1)*U+O.wrap*k,(O.canonical.y+1)*U+O.wrap*k,L])}(i,a,p).getCorners(),T=a/-g[2];g[0]<0?(r.ab.vec3.add(b[0],b[0],[g[0]*T,0,0]),r.ab.vec3.add(b[3],b[3],[g[0]*T,0,0])):g[0]>0&&(r.ab.vec3.add(b[1],b[1],[g[0]*T,0,0]),r.ab.vec3.add(b[2],b[2],[g[0]*T,0,0])),g[1]<0?(r.ab.vec3.add(b[0],b[0],[0,g[1]*T,0]),r.ab.vec3.add(b[1],b[1],[0,g[1]*T,0])):g[1]>0&&(r.ab.vec3.add(b[2],b[2],[0,g[1]*T,0]),r.ab.vec3.add(b[3],b[3],[0,g[1]*T,0]));const M={};return M.vertices=b,M.planes=[hc(b[1],b[0],b[4]),hc(b[2],b[1],b[5]),hc(b[3],b[2],b[6]),hc(b[0],b[3],b[7])],M}addShadowReceiver(i,a,p){this._receivers.add(i,r.cd.fromTileIdAndHeight(i,a,p))}getMaxCascadeForTile(i){const a=this._receivers.get(i);return a&&a.lastCascade?a.lastCascade:0}}function hc(f,i,a){const p=r.ab.vec3.sub([],a,i),g=r.ab.vec3.sub([],f,i),b=r.ab.vec3.cross([],p,g),T=r.ab.vec3.length(b);return T===0?[0,0,1,0]:(r.ab.vec3.scale(b,b,1/T),[b[0],b[1],b[2],-r.ab.vec3.dot(b,i)])}function dc(f){const i=f.properties.get("direction"),a=r.cb(i.x,i.y,i.z);a[2]=r.aw(a[2],0,75);const p=r.ce([a[0],a[1],a[2]]);return r.ab.vec3.fromValues(p.x,p.y,p.z)}function Wd(f,i,a){const p=i.properties.get("color-use-theme")==="none",g=i.properties.get("color"),b=i.properties.get("intensity"),T=i.properties.get("direction"),M=[T.x,T.y,T.z],O=a.properties.get("color-use-theme")==="none",L=a.properties.get("color"),k=a.properties.get("intensity"),U=Math.max(r.ab.vec3.dot([0,0,1],M),0),j=[0,0,0];r.ab.vec3.scale(j,L.toRenderColor(O?null:f.getLut(i.scope)).toArray01Linear().slice(0,3),k);const Z=[0,0,0];return r.ab.vec3.scale(Z,g.toRenderColor(p?null:f.getLut(a.scope)).toArray01Linear().slice(0,3),U*b),r.cf([j[0]>0?j[0]/(j[0]+Z[0]):0,j[1]>0?j[1]/(j[1]+Z[1]):0,j[2]>0?j[2]/(j[2]+Z[2]):0])}function j_(f,i,a,p,g,b){const T=f.zoom,M=f.scale,O=f.worldSize,L=1/O,k=f.aspect,U=Math.sqrt(1+k*k)*Math.tan(.5*f.fovX),j=U*U,Z=p-a,ce=p+a;let te,_e;j>Z/ce?(te=p,_e=p*U):(te=.5*ce*(1+j),_e=.5*Math.sqrt(Z*Z+2*(p*p+a*a)*j+ce*ce*j*j));const me=f.projection.pixelsPerMeter(f.center.lat,O),Se=f._camera.getCameraToWorldMercator(),ke=[0,0,-te*L];r.ab.vec3.transformMat4(ke,ke,Se);let Oe=_e*L;const je=f._edgeInsets;if(!(je.left===0&&je.top===0&&je.right===0&&je.bottom===0||je.left===je.right&&je.top===je.bottom)){const Qt=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?me:1),kt=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,a,p);kt[8]=2*-f.centerOffset.x/f.width,kt[9]=2*f.centerOffset.y/f.height;const Dt=new Float64Array(16);r.ab.mat4.mul(Dt,kt,Qt);const Gt=new Float64Array(16);r.ab.mat4.invert(Gt,Dt);const Jt=r.bR.fromInvProjectionMatrix(Gt,O,T,!0);for(const ci of Jt.points){const _i=((Ve=ci)[0]/=M,Ve[1]/=M,Ve[2]=r.bH(Ve[2],f._center.lat),Ve);Oe=Math.max(Oe,r.ab.vec3.len(r.ab.vec3.subtract([],ke,_i)))}}var Ve;Oe*=g/(g-1);const Ue=Math.acos(i[2]),Ne=Math.atan2(-i[0],-i[1]),Ye=new rn;Ye.position=ke,Ye.setPitchBearing(Ue,Ne);const it=Ye.getWorldToCamera(O,me),xt=Oe*O,_t=Math.min(f._mercatorZfromZoom(17)*O*-2,-2*xt),Rt=Ye.getCameraToClipOrthographic(-xt,xt,-xt,xt,_t,(xt+b*me)/i[2]),Pt=new Float64Array(16);r.ab.mat4.multiply(Pt,Rt,it);const ht=r.ab.vec3.fromValues(Math.floor(1e6*ke[0])/1e6*O,Math.floor(1e6*ke[1])/1e6*O,0),bt=.5*g,Vt=[0,0,0];r.ab.vec3.transformMat4(Vt,ht,Pt),r.ab.vec3.scale(Vt,Vt,bt);const ut=[Math.floor(Vt[0]),Math.floor(Vt[1]),Math.floor(Vt[2])],Ot=[0,0,0];r.ab.vec3.sub(Ot,Vt,ut),r.ab.vec3.scale(Ot,Ot,-1/bt);const wt=new Float64Array(16);return r.ab.mat4.identity(wt),r.ab.mat4.translate(wt,wt,Ot),r.ab.mat4.multiply(Pt,wt,Pt),[Pt,xt]}class Zd extends r.E{constructor(i){super(),this.requestManager=i,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(i,a){return r.aM(this.requestManager.transformRequest(a,r.R.Model).url).then(p=>{if(!p)return;const g=r.aN(p),b=new r.aO(i,void 0,void 0,g);return b.computeBoundsAndApplyParent(),b}).catch(p=>{if(p&&p.status===404)return null;this.fire(new r.y(new Error(`Could not load model ${i} from ${a}: ${p.message}`)))})}load(i,a,p={keepNumReferences:!1}){this.models[a]||(this.models[a]={});const g=Object.keys(i);this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+g.length;const b=[];for(const T of g)b.push(this.loadModel(T,i[T]));Promise.allSettled(b).then(T=>{for(let M=0;M<T.length;M++){const{status:O,value:L}=T[M];if(O==="fulfilled"&&L){const k=this.models[a][g[M]];this.models[a][g[M]]={model:L,numReferences:p.keepNumReferences&&k?k.numReferences:1}}}this.numModelsLoading[a]-=g.length,this.fire(new r.z("data",{dataType:"style"}))}).catch(T=>{this.fire(new r.y(new Error(`Could not load models: ${T.message}`)))})}isLoaded(){for(const i in this.numModelsLoading)if(this.numModelsLoading[i]>0)return!1;return!0}hasModel(i,a){return!!this.getModel(i,a)}getModel(i,a){return this.models[a]||(this.models[a]={}),this.models[a][i]?this.models[a][i].model:void 0}addModel(i,a,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={}),this.hasModel(i,p)&&this.models[p][i].numReferences++,this.modelUris[p][i]=this.requestManager.normalizeModelURL(a),this.load({[i]:this.modelUris[p][i]},p)}addModels(i,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const p=this.modelUris[a];for(const g in i)this.models[a][g]={},p[g]=this.requestManager.normalizeModelURL(i[g]);this.load(p,a,{keepNumReferences:!0})}reloadModels(i){this.load(this.modelUris[i],i)}addModelsFromBucket(i,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const p={};for(const g of i)this.hasModel(g,a)?this.models[a][g].numReferences++:(this.modelUris[a][g]=this.requestManager.normalizeModelURL(g),p[g]=this.modelUris[a][g]);this.load(p,a)}removeModel(i,a){if(this.models[a]&&this.models[a][i]&&(this.models[a][i].numReferences--,this.models[a][i].numReferences===0)){const p=this.models[a][i].model;delete this.models[a][i],delete this.modelUris[a][i],p.destroy()}}listModels(i){return this.models[i]||(this.models[i]={}),Object.keys(this.models[i])}upload(i,a){this.models[a]||(this.models[a]={});for(const p in this.models[a])this.models[a][p].model&&this.models[a][p].model.upload(i.context)}}const $_=new r.a5({data:new r.a6(r.a3.colorTheme.data)}),Rp={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function Yd(f){return f=f||{},Object.assign(f,Rp)}class Xd extends r.E{constructor(i){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},r.aP(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=i,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(i=>{i.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new r.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=i.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=i.stylesheet.indoor.buildingFeaturesetId,this._scope=i.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:i=>(i.feature&&i.feature.properties.floorplan&&this.selectFloorplan(i.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(i){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(T,M){const[O,L]=T,{center:k,radius:U}=M,[j,Z]=k,ce=Math.abs(O-j);return Math.sqrt((ce>180?360-ce:ce)**2+(L-Z)**2)<=U}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new r.z("floorplangone")));const a={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},p=new r.P(this._map.transform.width/2,this._map.transform.height/2),g=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],b=this._map.queryRenderedFeatures(i?g:p,a);b.length>0&&(this._selectedFloorplan&&b[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=b[0],this._floorplanSelected(!1)))}_floorplanSelected(i){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(b){const[[T,M],[O,L]]=b,k=(O-T+360)%360,U=k>180?360-k:k;return{center:[(T+U/2+360)%360,(M+L)/2],radius:Math.sqrt(U**2+(L-M)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const a=this._floorplanStates[this._indoorData.id].selectedBuilding,p=this._floorplanStates[this._indoorData.id].selectedLevel;let g;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const b of this._indoorData.levels)b.id===this._selectedLevel.id&&(g=b.id);if(this.fire(new r.z("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:g})),a){const b=this._indoorData.buildings.find(T=>T.id===a);this._buildingSelected(b,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(p){const b=this._indoorData.levels.find(T=>T.id===p);this._updateLevels(b,i)}else i&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(i,a){a&&i&&i.extent&&this._map.fitBounds(i.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=i?i.id:void 0;const p=this._indoorData.levels.filter(g=>i.levels.includes(g.id));this.fire(new r.z("buildingselected",{buildingId:i.id,levels:p}))}_levelSelected(i){if(i==="overview")this._updateLevels(void 0,!0);else{const a=this._indoorData.levels.find(p=>p.id===i);this._updateLevels(a,!0)}this.fire(new r.z("levelselected",{levelId:i==="overview"?void 0:i}))}_updateLevels(i,a){if(!i)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(a&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function p(L){const k=L.indexOf("/floor/");if(k===-1)return L;const U=k+7,j=L.indexOf("/",U);return j===-1?L.slice(U):L.slice(U,j)}this._selectedLevel=i,this._floorplanStates[this._indoorData.id].selectedLevel=i?i.id:void 0;const g=[],b={},T={},M={},O={};for(const L of this._indoorData.levels)if(g.push(L.id),b[L.id]=L.height,T[L.id]=L.base,i){if(this.mergeFloors){const k=p(i.id),U=p(L.id);M[L.id]=U===k?"true":"false"}else M[L.id]=L.id===i.id?"true":"false";O[L.id]=L.base<i.base?"true":"false"}else O[L.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",g]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",b]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",T]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",M]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",O]),i&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!i.isUnderground),a&&i.extent)){const L=this._map.cameraForBounds(i.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),k=this._map.getZoom(),U=L.zoom?Math.abs(k-L.zoom):0;this._map.fitBounds(i.extent,U>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:k})}}selectFloorplan(i){const a={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},p=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],g=this._map.queryRenderedFeatures(p,a);if(g.length>0){for(const b of g)if(JSON.parse(b.properties["indoor-data"]).floorplanIDs.includes(i)){this._selectedFloorplan=b,this._floorplanSelected(!0);break}}}selectBuilding(i){const a=this._indoorData.buildings.find(p=>p.id===i);this._buildingSelected(a,!0)}selectLevel(i){this._levelSelected(i)}}function q_(f){if(!f.metadata||!f.metadata.content_area)return;const i=r.q.devicePixelRatio,{left:a,top:p,width:g,height:b}=f.metadata.content_area,T=a*i,M=p*i;return[T,M,T+g*i,M+b*i]}function Dp(f){if(f)return f.map(([i,a])=>[i*r.q.devicePixelRatio,a*r.q.devicePixelRatio])}const fc=(f,i)=>gn(f,i&&i.filter(a=>a.identifier!=="source.canvas")),H_=r.ay(xr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),Op=r.ay(xr,["setCenter","setZoom","setBearing","setPitch"]),Kd=new Set(["background","sky","slot","custom"]),Eu={version:8,layers:[],sources:{}},Lp={duration:300,delay:0};class uo extends r.E{constructor(i,a={}){super(),this.map=i,this.scope=a.scope||"",this.globalId=null,this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=r.l({},Lp),this._buildingIndex=new Pa(this),this.crossTileSymbolIndex=new mh,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=a.styleChanges||new Ee,this.dispatcher=a.dispatcher?a.dispatcher:new r.D(r.ci(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new Ie(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new r.cj(i._requestManager,a.localFontFamily?r.ck.all:a.localIdeographFontFamily?r.ck.ideographs:r.ck.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new Zd(i._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._config=a.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:a.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=a.initialConfig,this.dispatcher.broadcast("setReferrer",r.cl());const p=this;this._rtlTextPluginCallback=uo.registerForPluginStateChange(g=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(b,T)=>{if(r.cm(b),T&&T.every(M=>M))for(const M in p._sourceCaches){const O=p._sourceCaches[M],L=O.getSource().type;L!=="vector"&&L!=="geojson"||O.reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const b=this.getOwnSource(g.sourceId);if(b&&b.vectorLayerIds)for(const T in this._layers){const M=this._layers[T];M.source===b.id&&this._validateLayer(M)}})}load(i){return i?(typeof i=="string"?this.loadURL(i):this.loadJSON(i),this):this}_getGlobalId(i){if(!i)return null;if(typeof i=="string"){if(r.f(i))return i;const a=r.cn(i);if(!a.startsWith("http"))try{return new URL(a,location.href).toString()}catch{return a}return a}return`json://${r.co(JSON.stringify(i))}`}_diffStyle(i,a,p){this.globalId=this._getGlobalId(i);const g=(b,T)=>{try{T(null,this.setState(b,p))}catch(M){T(M,!1)}};if(typeof i=="string"){const b=this.map._requestManager.normalizeStyleURL(i),T=this.map._requestManager.transformRequest(b,r.R.Style);r.n(T,(M,O)=>{M?this.fire(new r.y(M)):O&&g(O,a)})}else typeof i=="object"&&g(i,a)}loadURL(i,a={}){this.fire(new r.z("dataloading",{dataType:"style"}));const p=typeof a.validate=="boolean"?a.validate:!r.f(i);this.globalId=this._getGlobalId(i),i=this.map._requestManager.normalizeStyleURL(i,a.accessToken),this.resolvedImports.add(i);const g=this.importsCache.get(i);if(g)return this._load(g,p);const b=this.map._requestManager.transformRequest(i,r.R.Style);this._request=r.n(b,(T,M)=>{if(this._request=null,T)this.fire(new r.y(T));else if(M)return this.importsCache.set(i,M),this._load(M,p)})}loadJSON(i,a={}){this.fire(new r.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(i),this._request=r.q.frame(()=>{this._request=null,this._load(i,a.validate!==!1)})}loadEmpty(){this.fire(new r.z("dataloading",{dataType:"style"})),this._load(Eu,!1)}_loadImports(i,a,p){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const g=[];for(const b of i){const T=this._createFragmentStyle(b),M=new Promise(k=>{T.once("style.import.load",k),T.once("error",k)}).then(()=>this.mergeAll());if(g.push(M),this.resolvedImports.has(b.url)){T.loadEmpty();continue}const O=b.data||this.importsCache.get(b.url);O?(T.loadJSON(O,{validate:a}),this._isInternalStyle(O)&&(T.globalId=null)):b.url?T.loadURL(b.url,{validate:a}):T.loadEmpty();const L={style:T,id:b.id,config:b.config};if(p){const k=this.fragments.findIndex(({id:U})=>U===p);this.fragments=this.fragments.slice(0,k).concat(L).concat(this.fragments.slice(k))}else this.fragments.push(L)}return Promise.allSettled(g)}getImportGlobalIds(i=this,a=new Set){for(const p of i.fragments)p.style.globalId&&a.add(p.style.globalId),this.getImportGlobalIds(p.style,a);return[...a.values()]}_createFragmentStyle(i){const a=this.scope?r.aC(i.id,this.scope):i.id;let p;const g=this._initialConfig&&this._initialConfig[a];(i.config||g)&&(p=r.l({},i.config,g));const b=new uo(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:i["color-theme"],configDependentLayers:this._configDependentLayers});return b.setEventedParent(this.map,{style:b}),b}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(i){return this.isRootStyle()&&(i.fragment||!!i.schema&&i.fragment!==!1)}_load(i,a){const p=i.indoor?Yd(i.schema):i.schema;if(this._isInternalStyle(i)){const T=r.l({},Eu,{imports:[{id:"basemap",data:i,url:""}]});return void this._load(T,a)}if(this.updateConfig(this._config,p),a&&fc(this,tr(i)))return;this._loaded=!0,this.stylesheet=r.cp(i);const g=()=>{for(const L in i.sources)this.addSource(L,i.sources[L],{validate:!1,isInitialLoad:!0});i.sprite?this._loadIconset(i.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(i.glyphs,this.scope);const T=uh(this.stylesheet.layers);if(this._order=T.map(L=>L.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const L=this.stylesheet.lights[0];this.light=new ee(L.properties,L.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new ee(this.stylesheet.light)),this._layers={};for(const L of T){const k=r.cu(L,this.scope,this._styleColorTheme.lut,this.options);k.configDependencies.size!==0&&this._configDependentLayers.add(k.fqid),k.setEventedParent(this,{layer:{id:k.id}}),this._layers[k.id]=k;const U=this.getOwnLayerSourceCache(k),j=!!this.directionalLight&&this.directionalLight.shadowsEnabled();U&&k.canCastShadows()&&j&&(U.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const M=this.stylesheet.terrain;M&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(M,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.z("data",{dataType:"style"}));const O=this.isRootStyle();i.imports?this._loadImports(i.imports,a).then(()=>{this._reloadImports(),this.fire(new r.z(O?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.z(O?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const b=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(b){const T=this._evaluateColorThemeData(b);this._loadColorTheme(T).then(()=>{g()}).catch(M=>{r.w(`Couldn't load color theme from the stylesheet: ${M}`),g()})}else this._styleColorTheme.lut=null,g()}isRootStyle(){return this.importDepth===0}mergeAll(){let i,a,p,g,b,T,M,O,L,k;const U={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(j=>{if(j.stylesheet){if(j.light!=null&&(i=j.light),j.stylesheet.lights)for(const Z of j.stylesheet.lights)Z.type==="ambient"&&j.ambientLight!=null&&(a=j.ambientLight),Z.type==="directional"&&j.directionalLight!=null&&(p=j.directionalLight);g=this._prioritizeTerrain(g,j.terrain,j.stylesheet.terrain),j.stylesheet.fog&&j.fog!=null&&(b=j.fog),j.stylesheet.snow&&j.snow!=null&&(T=j.snow),j.stylesheet.rain&&j.rain!=null&&(M=j.rain),j.stylesheet.camera!=null&&(k=j.stylesheet.camera),j.stylesheet.projection!=null&&(O=j.stylesheet.projection),j.stylesheet.transition!=null&&(L=j.stylesheet.transition),U[j.scope]=j._styleColorTheme}}),this.light=i,this.ambientLight=a,this.directionalLight=p,this.fog=b,this.snow=T,this.rain=M,this._styleColorThemeForScope=U,g===null?delete this.terrain:this.terrain=g,this.camera=k||{"camera-projection":"perspective"},this.projection=O||{name:"mercator"},this.transition=r.l({},Lp,L),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(i){const a=p=>{for(const g of p.fragments)a(g.style);i(p)};a(this)}_prioritizeTerrain(i,a,p){const g=i&&i.drapeRenderMode===0;return p===null?a&&a.drapeRenderMode===0?a:g?i:null:a!=null&&(!i||g||a&&a.drapeRenderMode===1)?a:i}mergeTerrain(){let i;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(a=>{i=this._prioritizeTerrain(i,a.terrain,a.stylesheet.terrain)}),i===null?delete this.terrain:this.terrain=i}mergeProjection(){let i;this.forEachFragmentStyle(a=>{a.stylesheet.projection!=null&&(i=a.stylesheet.projection)}),this.projection=i||{name:"mercator"}}mergeSources(){const i={},a={},p={};this.forEachFragmentStyle(g=>{for(const b in g._sourceCaches){const T=r.aC(b,g.scope);i[T]=g._sourceCaches[b]}for(const b in g._otherSourceCaches){const T=r.aC(b,g.scope);a[T]=g._otherSourceCaches[b]}for(const b in g._symbolSourceCaches){const T=r.aC(b,g.scope);p[T]=g._symbolSourceCaches[b]}}),this._mergedSourceCaches=i,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=p}mergeLayers(){const i={},a=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(b=>{for(const T of b._order){const M=b._layers[T];if(M.type==="slot"){const O=r.cq(T);if(i[O])continue;i[O]=[]}M.slot&&i[M.slot]?i[M.slot].push(M):a.push(M)}}),this._mergedOrder=[];const g=(b=[])=>{for(const T of b)if(T.type==="slot"){const M=r.cq(T.id);i[M]&&g(i[M]),this._mergedSlots.push(M)}else{const M=r.aC(T.id,T.scope);this._mergedOrder.push(M),p[M]=T,T.is3D()&&(this._has3DLayers=!0),T.type==="circle"&&(this._hasCircleLayers=!0),T.type==="symbol"&&(this._hasSymbolLayers=!0),T.type==="clip"&&(this._clipLayerPresent=!0)}};g(a),this._mergedOrder.sort((b,T)=>{const M=p[b],O=p[T];return M.hasInitialOcclusionOpacityProperties?O.is3D()?1:0:M.is3D()&&O.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(i){return this.stylesheet.camera=r.l({},this.stylesheet.camera,i),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(i){return i.data?function(a,p,g){const b=r.l({},p);for(const M of Object.keys(r.a3.colorTheme))b[M]===void 0&&(b[M]=r.a3.colorTheme[M].default);const T=new r.a4($_,a,new Map(g));return T.setTransitionOrValue(b,g),T.untransitioned().possiblyEvaluate(new r.a8(0))}(this.scope,i,this.options).get("data"):null}_loadColorTheme(i){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const a=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((p,g)=>{const b="data:image/png;base64,";if(!i||i.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let T=i;T.startsWith(b)||(T=b+T);const M="mapbox-reserved-lut",O=new Image;O.src=T,O.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},O.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==a)return void p();this._styleColorTheme.lutLoading=!1;const{width:L,height:k,data:U}=r.q.getImageData(O);if(k>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(L!==k*k)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(M)&&this.removeImage(M),this.addImage(M,{data:new r.r({width:L,height:k},U),pixelRatio:1,sdf:!1,usvg:!1,version:0});const j=this.imageManager.getImage(M,this.scope);j?(this._styleColorTheme.lut={image:j.data,data:i},p()):g(new Error("Missing LUT image."))}})}getLut(i){const a=this._styleColorThemeForScope[i];return a?a.lut:null}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(i){this._spriteRequest=function(a,p,g){let b,T,M;const O=r.q.devicePixelRatio>1?"@2x":"";let L=r.n(p.transformRequest(p.normalizeSpriteURL(a,O,".json"),r.R.SpriteJSON),(j,Z)=>{L=null,M||(M=j,b=Z,U())}),k=r.o(p.transformRequest(p.normalizeSpriteURL(a,O,".png"),r.R.SpriteImage),(j,Z)=>{k=null,M||(M=j,T=Z,U())});function U(){if(M)g(M);else if(b&&T){const j=r.q.getImageData(T),Z={};for(const ce in b){const{width:te,height:_e,x:me,y:Se,sdf:ke,pixelRatio:Oe,stretchX:je,stretchY:Ve,content:Ue}=b[ce],Ne=new r.r({width:te,height:_e});r.r.copy(j,Ne,{x:me,y:Se},{x:0,y:0},{width:te,height:_e},null),Z[ce]={data:Ne,pixelRatio:Oe,sdf:ke,stretchX:je,stretchY:Ve,content:Ue,usvg:!1}}g(null,Z)}}return{cancel(){L&&(L.cancel(),L=null),k&&(k.cancel(),k=null)}}}(i,this.map._requestManager,(a,p)=>{if(this._spriteRequest=null,a)this.fire(new r.y(a));else if(p)for(const g in p)this.imageManager.addImage(g,this.scope,p[g]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))})}_loadIconset(i){if(!r.f(i)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(i);const a=this.map._spriteFormat==="auto";var p,g;this._spriteRequest=(g=(b,T)=>{if(this._spriteRequest=null,b)a?this._loadSprite(i):this.fire(new r.y(b));else if(T)for(const M in T)this.imageManager.addImage(M,this.scope,T[M]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))},r.bi((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(i),r.R.Iconset),(b,T)=>{if(b)return void g(b);const M={},O=r.cg(new r.bh(T));for(const L of O.icons){const k={version:1,pixelRatio:r.q.devicePixelRatio,content:q_(L),stretchX:L.metadata?Dp(L.metadata.stretch_x_areas):void 0,stretchY:L.metadata?Dp(L.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:L};M[L.name]=k}g(null,M)}))}_validateLayer(i){const a=this.getOwnSource(i.source);if(!a)return;const p=i.sourceLayer;p&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(p)===-1)&&this.fire(new r.y(new Error(`Source layer "${p}" does not exist on source "${a.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:i}of this.fragments)if(!i.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((i,a)=>{const p=this.fragments[a];return p&&p.style&&(i.data=p.style.serialize()),i})}_serializeSources(){const i={};for(const a in this._sourceCaches){const p=this._sourceCaches[a].getSource();i[p.id]||(i[p.id]=p.serialize())}return i}_serializeLayers(i){const a=[];for(const p of i){const g=this._layers[p];g&&g.type!=="custom"&&a.push(g.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(i){return i?this.order:this._mergedOrder}isLayerDraped(i){return!!this.terrain&&i.isDraped(this.getLayerSourceCache(i))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(i){const a=this.getOwnLayer(i);if(a)return a;this.fire(new r.y(new Error(`The layer '${i}' does not exist in the map's style.`)))}_checkSource(i){const a=this.getOwnSource(i);if(a)return a;this.fire(new r.y(new Error(`The source '${i}' does not exist in the map's style.`)))}precompilePrograms(i,a){const p=this.map.painter;if(p)for(let g=i.minzoom||0;g<(i.maxzoom||25.5);g++){const b=i.getProgramIds();if(b)for(const T of b){const M=i.getDefaultProgramParams(T,a.zoom,this._styleColorTheme.lut);M&&(p.style=this,this.fog&&(p._fogVisible=!0,M.overrideFog=!0,p.getOrCreateProgram(T,M)),p._fogVisible=!1,M.overrideFog=!1,p.getOrCreateProgram(T,M),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(M.overrideRtt=!0,p.getOrCreateProgram(T,M)))}}}update(i){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i);const a=this.calculateLightsBrightness();i.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a));const p=this._changes.isDirty();let g=!1;if(this._changes.isDirty()){const T=this._changes.getLayerUpdatesByScope();for(const M in T){const{updatedIds:O,removedIds:L}=T[M];(O||L)&&(this._updateWorkerLayers(M,O,L),g=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(i),this.light&&this.light.updateTransitions(i),this.ambientLight&&this.ambientLight.updateTransitions(i),this.directionalLight&&this.directionalLight.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this.snow&&this.snow.updateTransitions(i),this.rain&&this.rain.updateTransitions(i),this._changes.reset()}const b={};for(const T in this._mergedSourceCaches){const M=this._mergedSourceCaches[T];b[T]=M.used,M.used=!1,M.tileCoverLift=0}for(const T of this._mergedOrder){const M=this._mergedLayers[T];if(M.recalculate(i,this._availableImages),!M.isHidden(i.zoom)){const O=this.getLayerSourceCache(M);O&&(O.used=!0,O.tileCoverLift=Math.max(O.tileCoverLift,M.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(M,i)}):this.precompilePrograms(M,i))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&g&&this.mergeLayers();for(const T in b){const M=this._mergedSourceCaches[T];b[T]!==M.used&&M.getSource().fire(new r.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:M.getSource().id}))}this.light&&this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.snow&&this.snow.recalculate(i),this.rain&&this.rain.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),p&&this.fire(new r.z("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=this._changes.getUpdatedImages();if(i.length){for(const a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],i);this._changes.resetUpdatedImages()}}_updateWorkerLayers(i,a,p){const g=this.getFragmentStyle(i);g&&this.dispatcher.broadcast("updateLayers",{layers:a?g._serializeLayers(a):[],scope:i,removedIds:p||[],options:g.options})}setState(i,a){if(this._checkLoaded(),fc(this,tr(i)))return!1;(i=r.cp(i)).layers=uh(i.layers);const p=function(T,M){if(!T)return[{command:xr.setStyle,args:[M]}];let O=[];try{if(!r.bn(T.version,M.version))return[{command:xr.setStyle,args:[M]}];if(r.bn(T.center,M.center)||O.push({command:xr.setCenter,args:[M.center]}),r.bn(T.zoom,M.zoom)||O.push({command:xr.setZoom,args:[M.zoom]}),r.bn(T.bearing,M.bearing)||O.push({command:xr.setBearing,args:[M.bearing]}),r.bn(T.pitch,M.pitch)||O.push({command:xr.setPitch,args:[M.pitch]}),r.bn(T.sprite,M.sprite)||O.push({command:xr.setSprite,args:[M.sprite]}),r.bn(T.glyphs,M.glyphs)||O.push({command:xr.setGlyphs,args:[M.glyphs]}),r.bn(T.imports,M.imports)||function(Z=[],ce=[],te){ce=ce||[];const _e=(Z=Z||[]).map(Ws),me=ce.map(Ws),Se=Z.reduce(Ka,{}),ke=ce.reduce(Ka,{}),Oe=_e.slice();let je,Ve,Ue,Ne;for(je=0,Ve=0;je<_e.length;je++)Ue=_e[je],ke.hasOwnProperty(Ue)?Ve++:(te.push({command:xr.removeImport,args:[Ue]}),Oe.splice(Oe.indexOf(Ue,Ve),1));for(je=0,Ve=0;je<me.length;je++)Ue=me[me.length-1-je],Oe[Oe.length-1-je]!==Ue&&(Se.hasOwnProperty(Ue)?(te.push({command:xr.removeImport,args:[Ue]}),Oe.splice(Oe.lastIndexOf(Ue,Oe.length-Ve),1)):Ve++,Ne=Oe[Oe.length-je],te.push({command:xr.addImport,args:[ke[Ue],Ne]}),Oe.splice(Oe.length-je,0,Ue));for(const Ye of ce){const it=Se[Ye.id];it&&!r.bn(it,Ye)&&te.push({command:xr.updateImport,args:[Ye.id,Ye]})}}(T.imports,M.imports,O),r.bn(T.transition,M.transition)||O.push({command:xr.setTransition,args:[M.transition]}),r.bn(T.light,M.light)||O.push({command:xr.setLight,args:[M.light]}),r.bn(T.fog,M.fog)||O.push({command:xr.setFog,args:[M.fog]}),r.bn(T.snow,M.snow)||O.push({command:xr.setSnow,args:[M.snow]}),r.bn(T.rain,M.rain)||O.push({command:xr.setRain,args:[M.rain]}),r.bn(T.projection,M.projection)||O.push({command:xr.setProjection,args:[M.projection]}),r.bn(T.lights,M.lights)||O.push({command:xr.setLights,args:[M.lights]}),r.bn(T.camera,M.camera)||O.push({command:xr.setCamera,args:[M.camera]}),!r.bn(T["color-theme"],M["color-theme"]))return[{command:xr.setStyle,args:[M]}];const L={},k=[];(function(Z,ce,te,_e){let me;for(me in ce=ce||{},Z=Z||{})Z.hasOwnProperty(me)&&(ce.hasOwnProperty(me)||oc(me,te,_e));for(me in ce){if(!ce.hasOwnProperty(me))continue;const Se=ce[me];Z.hasOwnProperty(me)?r.bn(Z[me],Se)||(Z[me].type==="geojson"&&Se.type==="geojson"&&$r(Z,ce,me)?te.push({command:xr.setGeoJSONSourceData,args:[me,Se.data]}):mi(me,ce,te,_e)):Oc(me,ce,te)}})(T.sources,M.sources,k,L);const U=[];T.layers&&T.layers.forEach(Z=>{Z.source&&L[Z.source]?O.push({command:xr.removeLayer,args:[Z.id]}):U.push(Z)});let j=T.terrain;j&&L[j.source]&&(O.push({command:xr.setTerrain,args:[void 0]}),j=void 0),O=O.concat(k),r.bn(j,M.terrain)||O.push({command:xr.setTerrain,args:[M.terrain]}),function(Z,ce,te){ce=ce||[];const _e=(Z=Z||[]).map(Ws),me=ce.map(Ws),Se=Z.reduce(Ka,{}),ke=ce.reduce(Ka,{}),Oe=_e.slice(),je=Object.create(null);let Ve,Ue,Ne,Ye,it,xt,_t;for(Ve=0,Ue=0;Ve<_e.length;Ve++)Ne=_e[Ve],ke.hasOwnProperty(Ne)?Ue++:(te.push({command:xr.removeLayer,args:[Ne]}),Oe.splice(Oe.indexOf(Ne,Ue),1));for(Ve=0,Ue=0;Ve<me.length;Ve++)Ne=me[me.length-1-Ve],Oe[Oe.length-1-Ve]!==Ne&&(Se.hasOwnProperty(Ne)?(te.push({command:xr.removeLayer,args:[Ne]}),Oe.splice(Oe.lastIndexOf(Ne,Oe.length-Ue),1)):Ue++,xt=Oe[Oe.length-Ve],te.push({command:xr.addLayer,args:[ke[Ne],xt]}),Oe.splice(Oe.length-Ve,0,Ne),je[Ne]=!0);for(Ve=0;Ve<me.length;Ve++)if(Ne=me[Ve],Ye=Se[Ne],it=ke[Ne],!je[Ne]&&!r.bn(Ye,it))if(r.bn(Ye.source,it.source)&&r.bn(Ye["source-layer"],it["source-layer"])&&r.bn(Ye.type,it.type)){for(_t in Dr(Ye.layout,it.layout,te,Ne,null,xr.setLayoutProperty),Dr(Ye.paint,it.paint,te,Ne,null,xr.setPaintProperty),r.bn(Ye.slot,it.slot)||te.push({command:xr.setSlot,args:[Ne,it.slot]}),r.bn(Ye.filter,it.filter)||te.push({command:xr.setFilter,args:[Ne,it.filter]}),r.bn(Ye.minzoom,it.minzoom)&&r.bn(Ye.maxzoom,it.maxzoom)||te.push({command:xr.setLayerZoomRange,args:[Ne,it.minzoom,it.maxzoom]}),Ye)Ye.hasOwnProperty(_t)&&_t!=="layout"&&_t!=="paint"&&_t!=="filter"&&_t!=="metadata"&&_t!=="minzoom"&&_t!=="maxzoom"&&_t!=="slot"&&(_t.indexOf("paint.")===0?Dr(Ye[_t],it[_t],te,Ne,_t.slice(6),xr.setPaintProperty):r.bn(Ye[_t],it[_t])||te.push({command:xr.setLayerProperty,args:[Ne,_t,it[_t]]}));for(_t in it)it.hasOwnProperty(_t)&&!Ye.hasOwnProperty(_t)&&_t!=="layout"&&_t!=="paint"&&_t!=="filter"&&_t!=="metadata"&&_t!=="minzoom"&&_t!=="maxzoom"&&_t!=="slot"&&(_t.indexOf("paint.")===0?Dr(Ye[_t],it[_t],te,Ne,_t.slice(6),xr.setPaintProperty):r.bn(Ye[_t],it[_t])||te.push({command:xr.setLayerProperty,args:[Ne,_t,it[_t]]}))}else te.push({command:xr.removeLayer,args:[Ne]}),xt=Oe[Oe.lastIndexOf(Ne)+1],te.push({command:xr.addLayer,args:[it,xt]})}(U,M.layers,O)}catch(L){console.warn("Unable to compute style diff:",L),O=[{command:xr.setStyle,args:[M]}]}return O}(this.serialize(),i).filter(T=>!(T.command in Op));if(p.length===0)return!1;const g=p.filter(T=>!(T.command in H_));if(g.length>0)throw new Error(`Unimplemented: ${g.map(T=>T.command).join(", ")}.`);const b=[];return p.forEach(T=>{b.push(this[T.command].apply(this,T.args))}),a&&Promise.all(b).then(a),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(i,a){return this.getImage(i)?this.fire(new r.y(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,this.scope,a),this._afterImageUpdated(i),this)}updateImage(i,a,p=!1){this.imageManager.updateImage(i,this.scope,a),p&&this._afterImageUpdated(i)}getImage(i){return this.imageManager.getImage(i,this.scope)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i,this.scope),this._afterImageUpdated(i),this):this.fire(new r.y(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(i),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.z("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(i,a,p={}){return this._checkLoaded(),this._validate(ir,`models.${i}`,a,null,p)||(this.modelManager.addModel(i,a,this.scope),this._changes.setDirty()),this}hasModel(i){return this.modelManager.hasModel(i,this.scope)}removeModel(i){return this.hasModel(i)?(this.modelManager.removeModel(i,this.scope),this):this.fire(new r.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(i,a,p={}){if(this._checkLoaded(),this.getOwnSource(i)!==void 0)throw new Error(`There is already a source with ID "${i}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(Yn,`sources.${i}`,a,null,p))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const g=_s(i,a,this.dispatcher,this);g.scope=this.scope,g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(g.id),source:g.serialize(),sourceId:g.id}));const b=T=>{const M=(T?"symbol:":"other:")+g.id,O=r.aC(M,this.scope),L=this._sourceCaches[M]=new rs(O,g,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[g.id]=L,L.onAdd(this.map)};b(!1),a.type!=="vector"&&a.type!=="geojson"||b(!0),g.onAdd&&g.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(i){this._checkLoaded();const a=this.getOwnSource(i);if(!a)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===i)return this.fire(new r.y(new Error(`Source "${i}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===i)return this.fire(new r.y(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const p=this.getOwnSourceCaches(i);for(const g of p){const b=r.cq(g.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(g.id),g.fire(new r.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles()}return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(i,a){this._checkLoaded(),this.getOwnSource(i).setData(a),this._changes.setDirty()}getOwnSource(i){const a=this.getOwnSourceCache(i);return a&&a.getSource()}getOwnSources(){const i=[];for(const a in this._otherSourceCaches){const p=this.getOwnSourceCache(a);p&&i.push(p.getSource())}return i}areTilesLoaded(){const i=this._mergedSourceCaches;for(const a in i){const p=i[a]._tiles;for(const g in p){const b=p[g];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(i){if(this._checkLoaded(),!i)return delete this.ambientLight,void delete this.directionalLight;const a=this._getTransitionParameters();for(const g of i){if(this._validate($n,"lights",g))return;switch(g.type){case"ambient":if(this.ambientLight){const b=this.ambientLight;b.set(g),b.updateTransitions(a)}else this.ambientLight=new bi(g,qt||(qt=new r.a5({color:new r.a6(r.a3.properties_light_ambient.color),"color-use-theme":new r.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a6(r.a3.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const b=this.directionalLight;b.set(g),b.updateTransitions(a)}else this.directionalLight=new bi(g,Ht||(Ht=new r.a5({direction:new r.ak(r.a3.properties_light_directional.direction),color:new r.a6(r.a3.properties_light_directional.color),"color-use-theme":new r.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a6(r.a3.properties_light_directional.intensity),"cast-shadows":new r.a6(r.a3.properties_light_directional["cast-shadows"]),"shadow-quality":new r.a6(r.a3.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.a6(r.a3.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const p=new r.a8(this.z||0,a);this.ambientLight&&this.ambientLight.recalculate(p),this.directionalLight&&this.directionalLight.recalculate(p),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const i=this.directionalLight,a=this.ambientLight;if(!i||!a)return;const p=j=>.2126*(j[0]<=.03928?j[0]/12.92:Math.pow((j[0]+.055)/1.055,2.4))+.7152*(j[1]<=.03928?j[1]/12.92:Math.pow((j[1]+.055)/1.055,2.4))+.0722*(j[2]<=.03928?j[2]/12.92:Math.pow((j[2]+.055)/1.055,2.4)),g=i.properties.get("color").toRenderColor(null).toArray01(),b=i.properties.get("intensity"),T=i.properties.get("direction"),M=1-r.cb(T.x,T.y,T.z)[2]/90,O=p(g)*b*M,L=a.properties.get("color").toRenderColor(null).toArray01(),k=a.properties.get("intensity"),U=p(L)*k;return Number(((O+U)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const i=[];return this.directionalLight&&i.push(this.directionalLight.get()),this.ambientLight&&i.push(this.ambientLight.get()),i}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(i){if(!i)return this;if(r.cr(i)){const a=r.cs(i),p=this.fragments.find(({id:b})=>b===a);if(!p)throw new Error(`Style import '${i}' not found`);const g=r.cq(i);return p.style.getFragmentStyle(g)}{const a=this.fragments.find(({id:p})=>p===i);return a?a.style:void 0}}setFeaturesetSelectors(i){if(!i)return;const a={},p=(g,b="")=>`${g}::${b}`;this._featuresetSelectors={};for(const g in i){const b=this._featuresetSelectors[g]=[];for(const T of i[g].selectors){if(T.featureNamespace){const O=this.getOwnLayer(T.layer);if(!O){r.w(`Layer is undefined for selector: ${T.layer}`);continue}const L=p(O.source,O.sourceLayer);if(L in a&&a[L]!==T.featureNamespace){r.w(`"featureNamespace ${T.featureNamespace} of featureset ${g}'s selector is not associated to the same source, skip this selector`);continue}a[L]=T.featureNamespace}let M;if(T.properties)for(const O in T.properties){const L=r.U(T.properties[O]);L.result==="success"&&(M=M||{},M[O]=L.value)}b.push({layerId:T.layer,namespace:T.featureNamespace,properties:M,uniqueFeatureID:T._uniqueFeatureID})}}}getFeaturesetDescriptors(i){const a=this.getFragmentStyle(i);if(!a||!a.stylesheet.featuresets)return[];const p=[];for(const g in a.stylesheet.featuresets)p.push({featuresetId:g,importId:a.scope?a.scope:void 0});return p}getFeaturesetLayers(i,a){const p=this.getFragmentStyle(a),g=p.stylesheet.featuresets;if(!g||!g[i])return this.fire(new r.y(new Error(`The featureset '${i}' does not exist in the map's style and cannot be queried.`))),[];const b=[];for(const T of g[i].selectors){const M=p.getOwnLayer(T.layer);M&&b.push(M)}return b}getConfigProperty(i,a){const p=this.getFragmentStyle(i);if(!p)return null;const g=r.aC(a,p.scope),b=p.options.get(g),T=b?b.value||b.default:null;return T?T.serialize():null}setConfigProperty(i,a,p){const g=this.getFragmentStyle(i);if(!g)return;const b=g.stylesheet.indoor?Yd(g.stylesheet.schema):g.stylesheet.schema;if(!b||!b[a])return;const T=r.U(p);if(T.result!=="success")return void fc(this,T.value);const M=T.value.expression,O=r.aC(a,g.scope),L=g.options.get(O);if(!L)return;let k;const{minValue:U,maxValue:j,stepValue:Z,type:ce,values:te}=b[a],_e=r.U(b[a].default);_e.result==="success"&&(k=_e.value.expression),k?(this.options.set(O,Object.assign({},L,{value:M,default:k,minValue:U,maxValue:j,stepValue:Z,type:ce,values:te})),this.updateConfigDependencies(a)):this.fire(new r.y(new Error(`No schema defined for the config option "${a}" in the "${i}" fragment.`)))}getConfig(i){const a=this.getFragmentStyle(i);if(!a)return null;const p=a.stylesheet.schema;if(!p)return null;const g={};for(const b in p){const T=r.aC(b,a.scope),M=a.options.get(T),O=M?M.value||M.default:null;g[b]=O?O.serialize():null}return g}setConfig(i,a){const p=this.getFragmentStyle(i);p&&(p.updateConfig(a,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(i){const a=this.getFragmentStyle(i);return a?a.stylesheet.schema:null}setSchema(i,a){const p=this.getFragmentStyle(i);p&&(p.stylesheet.schema=a,p.updateConfig(p._config,a),this.updateConfigDependencies())}updateConfig(i,a){if(this._config=i,i||a)if(a)for(const p in a){let g,b;const T=r.U(a[p].default);if(T.result==="success"&&(g=T.value.expression),i&&i[p]!==void 0){const j=r.U(i[p]);j.result==="success"&&(b=j.value.expression)}const{minValue:M,maxValue:O,stepValue:L,type:k,values:U}=a[p];if(g){const j=r.aC(p,this.scope);this.options.set(j,{default:g,value:b,minValue:M,maxValue:O,stepValue:L,type:k,values:U})}else this.fire(new r.y(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new r.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(i){for(const a of this._configDependentLayers){const p=this.getLayer(a);if(p){if(i&&!p.configDependencies.has(i))continue;p.possiblyEvaluateVisibility(),this._updateLayer(p)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(a=>{const p=a._styleColorTheme.colorThemeOverride?a._styleColorTheme.colorThemeOverride:a._styleColorTheme.colorTheme;if(p){const g=a._evaluateColorThemeData(p);(!a._styleColorTheme.lut&&g!==""||a._styleColorTheme.lut&&g!==a._styleColorTheme.lut.data)&&a.setColorTheme(p)}}),this._changes.setDirty()}addLayer(i,a,p={}){this._checkLoaded();const g=i.id;if(this._layers[g])return void this.fire(new r.y(new Error(`Layer with id "${g}" already exists on this map`)));let b;if(i.type==="custom"){if(fc(this,r.ct(i)))return;b=r.cu(i,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof i.source=="object"&&(this.addSource(g,i.source),i=r.cp(i),i=r.l(i,{source:g})),this._validate(or,`layers.${g}`,i,{arrayIndex:-1},p))return;b=r.cu(i,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:g}})}b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid);let T=this._order.length;if(a){const k=this._order.indexOf(a);if(k===-1)return void this.fire(new r.y(new Error(`Layer with id "${a}" does not exist on this map.`)));b.slot===this._layers[a].slot?T=k:r.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,g),this._layerOrderChanged=!0,this._layers[g]=b;const M=this.getOwnLayerSourceCache(b),O=!!this.directionalLight&&this.directionalLight.shadowsEnabled();M&&b.canCastShadows()&&O&&(M.castsShadows=!0);const L=this._changes.getRemovedLayer(b);if(L&&b.source&&M&&b.type!=="custom"){this._changes.discardLayerRemoval(b);const k=r.aC(b.source,b.scope);L.type!==b.type?this._changes.updateSourceCache(k,"clear"):(this._changes.updateSourceCache(k,"reload"),M.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(i,a){this._checkLoaded();const p=this._checkLayer(i);if(!p||i===a)return;const g=this._order.indexOf(i);this._order.splice(g,1);let b=this._order.length;if(a){const T=this._order.indexOf(a);if(T===-1)return void this.fire(new r.y(new Error(`Layer with id "${a}" does not exist on this map.`)));p.slot===this._layers[a].slot?b=T:r.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,i),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(i){this._checkLoaded();const a=this._checkLayer(i);if(!a)return;a.setEventedParent(null);const p=this._order.indexOf(i);this._order.splice(p,1),delete this._layers[i],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._changes.removeLayer(a);const g=this.getOwnLayerSourceCache(a);if(g&&g.castsShadows){let b=!1;for(const T in this._layers)if(this._layers[T].source===a.source&&this._layers[T].canCastShadows()){b=!0;break}g.castsShadows=b}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(i){return this._layers[i]}hasLayer(i){return i in this._mergedLayers}hasLayerType(i){for(const a in this._layers)if(this._layers[a].type===i)return!0;return!1}setLayerZoomRange(i,a,p){this._checkLoaded();const g=this._checkLayer(i);g&&(g.minzoom===a&&g.maxzoom===p||(a!=null&&(g.minzoom=a),p!=null&&(g.maxzoom=p),this._updateLayer(g)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(i,a){this._checkLoaded();const p=this._checkLayer(i);p&&p.slot!==a&&(p.slot=a,this._updateLayer(p))}setFilter(i,a,p={}){this._checkLoaded();const g=this._checkLayer(i);if(g&&!r.bn(g.filter,a))return a==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(lr,`layers.${g.id}.filter`,a,{layerType:g.type},p)||(g.filter=r.cp(a),this._updateLayer(g)))}getFilter(i){const a=this._checkLayer(i);if(a)return r.cp(a.filter)}setLayoutProperty(i,a,p,g={}){this._checkLoaded();const b=this._checkLayer(i);if(b&&!r.bn(b.getLayoutProperty(a),p)){if(p!=null&&(!g||g.validate!==!1)&&fc(b,br.call(tr,{key:`layers.${i}.layout.${a}`,layerType:b.type,objectKey:a,value:p,styleSpec:r.a3,style:{glyphs:!0,sprite:!0}})))return;b.setLayoutProperty(a,p),b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),this._updateLayer(b)}}getLayoutProperty(i,a){const p=this._checkLayer(i);if(p)return p.getLayoutProperty(a)}setPaintProperty(i,a,p,g={}){this._checkLoaded();const b=this._checkLayer(i);if(!b||r.bn(b.getPaintProperty(a),p)||p!=null&&(!g||g.validate!==!1)&&fc(b,Pi.call(tr,{key:`layers.${i}.paint.${a}`,layerType:b.type,objectKey:a,value:p,styleSpec:r.a3})))return;const T=b.setPaintProperty(a,p);b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),T&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(i,a){const p=this._checkLayer(i);if(p)return p.getPaintProperty(a)}setFeatureState(i,a){if(this._checkLoaded(),"target"in i){if("featuresetId"in i.target){const{featuresetId:O,importId:L}=i.target,k=this.getFragmentStyle(L),U=k.getFeaturesetLayers(O);for(const{source:j,sourceLayer:Z}of U)k.setFeatureState({id:i.id,source:j,sourceLayer:Z},a)}else if("layerId"in i.target){const{layerId:O}=i.target,L=this.getLayer(O);this.setFeatureState({id:i.id,source:L.source,sourceLayer:L.sourceLayer},a)}return}const p=i.source,g=i.sourceLayer,b=this._checkSource(p);if(!b)return;const T=b.type;if(T==="geojson"&&g)return void this.fire(new r.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!g)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided.")));const M=this.getOwnSourceCaches(p);for(const O of M)O.setFeatureState(g,i.id,a)}removeFeatureState(i,a){if(this._checkLoaded(),"target"in i){if("featuresetId"in i.target){const{featuresetId:O,importId:L}=i.target,k=this.getFragmentStyle(L),U=k.getFeaturesetLayers(O);for(const{source:j,sourceLayer:Z}of U)k.removeFeatureState({id:i.id,source:j,sourceLayer:Z},a)}else if("layerId"in i.target){const{layerId:O}=i.target,L=this.getLayer(O);this.removeFeatureState({id:i.id,source:L.source,sourceLayer:L.sourceLayer},a)}return}const p=i.source,g=this._checkSource(p);if(!g)return;const b=g.type,T=b==="vector"?i.sourceLayer:void 0;if(b==="vector"&&!T)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new r.y(new Error("A feature id is required to remove its specific state property.")));const M=this.getOwnSourceCaches(p);for(const O of M)O.removeFeatureState(T,i.id,a)}getFeatureState(i){if(this._checkLoaded(),"target"in i){let b;if("featuresetId"in i.target){const{featuresetId:T,importId:M}=i.target,O=this.getFragmentStyle(M),L=O.getFeaturesetLayers(T);for(const{source:k,sourceLayer:U}of L){const j=O.getFeatureState({id:i.id,source:k,sourceLayer:U});if(j&&!b)b=j;else if(!r.bn(b,j))return void this.fire(new r.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in i.target){const{layerId:T}=i.target,M=this.getLayer(T);b=this.getFeatureState({id:i.id,source:M.source,sourceLayer:M.sourceLayer})}return b}const a=i.source,p=i.sourceLayer,g=this._checkSource(a);if(g){if(g.type!=="vector"||p)return i.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(p,i.id);this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(i){return this.stylesheet.transition=r.l({},this.stylesheet.transition,i),this.transition=this.stylesheet.transition,this}getTransition(){return r.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const i=this.getTerrain(),a=i&&this.terrain&&this.terrain.scope===this.scope?i:this.stylesheet.terrain;return r.cv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateFilteredLayers(i){for(const a of Object.values(this._mergedLayers))i(a)&&this._updateLayer(a)}_updateLayer(i){this._changes.updateLayer(i);const a=this.getLayerSourceCache(i),p=r.aC(i.source,i.scope),g=this._changes.getUpdatedSourceCaches();i.source&&!g[p]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),a.pause()),i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const a=M=>this._mergedLayers[M].is3D(),p=this.order,g={},b=[];for(let M=p.length-1;M>=0;M--){const O=p[M];if(a(O)){g[O]=M;for(const L of i){const k=L[O];if(k)for(const U of k)b.push(U)}}}b.sort((M,O)=>O.intersectionZ-M.intersectionZ);const T=[];for(let M=p.length-1;M>=0;M--){const O=p[M];if(a(O))for(let L=b.length-1;L>=0;L--){const k=b[L].feature;if(k.layer&&g[k.layer.id]<M)break;T.push(k),b.pop()}else for(const L of i){const k=L[O];if(k)for(const U of k)T.push(U.feature)}}return T}queryRenderedFeatures(i,a,p){let g;a&&!Array.isArray(a)&&a.filter&&(this._validate(lr,"queryRenderedFeatures.filter",a.filter,null,a),g=r.aZ(a.filter));const b={},T=k=>{if(Kd.has(k.type))return;const U=this.getOwnLayerSourceCache(k),j=b[U.id]=b[U.id]||{sourceCache:U,layers:{},has3DLayers:!1};k.is3D()&&(j.has3DLayers=!0),j.layers[k.fqid]=j.layers[k.fqid]||{styleLayer:k,targets:[]},j.layers[k.fqid].targets.push({filter:g})};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new r.y(new Error("parameters.layers must be an Array."))),[];for(const k of a.layers){const U=this._layers[k];if(!U)return this.fire(new r.y(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];T(U)}}else for(const k in this._layers)T(this._layers[k]);const M=this._queryRenderedFeatures(i,b,p),O=this._flattenAndSortRenderedFeatures(M),L=[];for(const k of O)r.cs(k.layer.id)===this.scope&&L.push(k);return L}queryRenderedFeatureset(i,a,p){let g;a&&!Array.isArray(a)&&a.filter&&(this._validate(lr,"queryRenderedFeatures.filter",a.filter,null,a),g=r.aZ(a.filter));const b="mock",T=[];if(a&&a.target)T.push(Object.assign({},a,{targetId:b,filter:g}));else{const k=this.getFeaturesetDescriptors();for(const U of k)T.push({targetId:b,filter:g,target:U});for(const{style:U}of this.fragments){const j=U.getFeaturesetDescriptors();for(const Z of j)T.push({targetId:b,filter:g,target:Z})}}const M=this.queryRenderedTargets(i,T,p),O=[],L=new Set;for(const k of M)for(const U of k.variants[b])io(U,k,L)||O.push(new r.cw(k,U));return O}queryRenderedTargets(i,a,p){const g={},b=(M,O,L,k)=>{const U=g[O.id]=g[O.id]||{sourceCache:O,layers:{},has3DLayers:!1};if(U.layers[M.fqid]=U.layers[M.fqid]||{styleLayer:M,targets:[]},M.is3D()&&(U.has3DLayers=!0),!k)return L.uniqueFeatureID=!1,void U.layers[M.fqid].targets.push(L);U.layers[M.fqid].targets.push(Object.assign({},L,{namespace:k.namespace,properties:k.properties,uniqueFeatureID:k.uniqueFeatureID}))};for(const M of a)if("featuresetId"in M.target){const{featuresetId:O,importId:L}=M.target,k=this.getFragmentStyle(L);if(!k||!k._featuresetSelectors)continue;const U=k._featuresetSelectors[O];if(!U){this.fire(new r.y(new Error(`The featureset '${O}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const j of U){const Z=k.getOwnLayer(j.layerId);Z&&!Kd.has(Z.type)&&b(Z,k.getOwnLayerSourceCache(Z),M,j)}}else if("layerId"in M.target){const{layerId:O}=M.target,L=this.getLayer(O);if(!L||Kd.has(L.type))continue;b(L,this.getLayerSourceCache(L),M)}const T=this._queryRenderedFeatures(i,g,p);return this._flattenAndSortRenderedFeatures(T)}_queryRenderedFeatures(i,a,p){const g=[],b=!!this.map._showQueryGeometry,T=Mi.createFromScreenPoints(i,p);for(const M in a){const O=Cn(T,a[M],this._availableImages,p,b);Object.keys(O).length&&g.push(O)}if(this.placement)for(const M in a){if(!a[M].sourceCache._onlySymbols)continue;const O=Rc(T.screenGeometry,a[M],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(O).length&&g.push(O)}return g}querySourceFeatures(i,a){const p=a&&a.filter;p&&this._validate(lr,"querySourceFeatures.filter",p,null,a);let g=[];const b=this.getOwnSourceCaches(i);for(const T of b)g=g.concat(Cp(T,a));return g}addSourceType(i,a,p){return uo.getSourceType(i)?p(new Error(`A source type called "${i}" already exists.`)):(uo.setSourceType(i,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:a.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(i,a,p={}){this._checkLoaded();const g=this.light.getLight();let b=!1;for(const M in i)if(!r.bn(i[M],g[M])){b=!0;break}if(!b)return;const T=this._getTransitionParameters();this.light.setLight(i,a,p),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(i,a=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),a===0&&delete this.terrain,i===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=i;const g=i.source==null;if(a===1){if(this.disableElevatedTerrain)return;if(typeof p.source=="object"){const M="terrain-dem-src";this.addSource(M,p.source),p=r.cp(p),p=r.l(p,{source:M})}const b=r.l({},p),T={};if(this.terrain&&g){b.source=this.terrain.get().source;const M=this.terrain?this.getFragmentStyle(this.terrain.scope):null;M&&(T.style=M.serialize())}if(this._validate(Dn,"terrain",b,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!g||this.terrain&&a!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,a),this.fire(new r.z("data",{dataType:"style"}))}else{const b=this.terrain,T=b.get();for(const M of Object.keys(r.a3.terrain))!p.hasOwnProperty(M)&&r.a3.terrain[M].default&&(p[M]=r.a3.terrain[M].default);for(const M in i)if(!r.bn(i[M],T[M])){b.set(i,this.options),this.stylesheet.terrain=i;const O=this._getTransitionParameters({duration:0});b.updateTransitions(O),this.fire(new r.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const a=this.fog=new lt(i,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}_createSnow(i){const a=this.snow=new li(i,this.map.transform,this.scope,this.options);this.stylesheet.snow=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}_createRain(i){const a=this.rain=new pi(i,this.map.transform,this.scope,this.options);this.stylesheet.rain=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog;if(!r.bn(a.get(),i)){a.set(i,this.options),this.stylesheet.fog=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}}else this._createFog(i);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(i){if(this._checkLoaded(),!i)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const a=this.snow;if(!r.bn(a.get(),i)){a.set(i,this.options),this.stylesheet.snow=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}}else this._createSnow(i);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(i){if(this._checkLoaded(),!i)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const a=this.rain;if(!r.bn(a.get(),i)){a.set(i,this.options),this.stylesheet.rain=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}}else this._createRain(i);this._markersNeedUpdate=!0}_reloadColorTheme(){const i=()=>{for(const g in this._layers)this._layers[g].lut=this._styleColorTheme.lut;for(const g in this._sourceCaches)this._sourceCaches[g].clearTiles()},a=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!a)return this._styleColorTheme.lut=null,void i();const p=this._evaluateColorThemeData(a);this._loadColorTheme(p).then(()=>{this.fire(new r.z("colorthemeset")),i()}).catch(g=>{r.w(`Couldn't set color theme: ${g}`)})}setColorTheme(i){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=i,this._reloadColorTheme()}setImportColorTheme(i,a){const p=this.getFragmentStyle(i);p&&(p._styleColorTheme.colorThemeOverride=a,p._reloadColorTheme())}_getTransitionParameters(i){return{now:r.q.now(),transition:r.l(this.transition,i)}}updateDrapeFirstLayers(){if(!this.terrain)return;const i=[],a=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?i.push(p):a.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...a)}_createTerrain(i,a){const p=this.terrain=new de(i,a,this.scope,this.options);a===1&&(this.stylesheet.terrain=i),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const g=this._getTransitionParameters({duration:0});p.updateTransitions(g)}_force3DLayerUpdate(){for(const i in this._layers){const a=this._layers[i];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const a=this._layers[i];a.type==="symbol"&&this._updateLayer(a)}}_validate(i,a,p,g,b={}){if(b&&b.validate===!1)return!1;const T=r.l({},this.serialize());return fc(this,i.call(tr,r.l({key:a,style:T,value:p,styleSpec:r.a3},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.cx.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._mergedLayers)this._mergedLayers[i].setEventedParent(null);for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles(),this._mergedSourceCaches[i].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(i){const a=this.getSourceCaches(i);for(const p of a)p.clearTiles()}clearSources(){for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles()}reloadSource(i){const a=this.getSourceCaches(i);for(const p of a)p.resume(),p.reload()}reloadSources(){for(const i of this.getSources())i.reload&&i.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(i=>{i.modelManager.reloadModels(i.scope)})}updateSources(i){let a;this.directionalLight&&(a=dc(this.directionalLight));for(const p in this._mergedSourceCaches)this._mergedSourceCaches[p].update(i,void 0,void 0,a)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const a=this._sourceCaches[i];a.resume(),a.reload()}}_updatePlacement(i,a,p,g,b,T,M=!1){let O=!1,L=!1;const k={},U={};for(const j of this._mergedOrder){const Z=this._mergedLayers[j];if(Z.type!=="symbol")continue;const ce=r.aC(Z.source,Z.scope);let te=k[ce];if(!te){const me=this.getLayerSourceCache(Z);if(!me)continue;const Se=me.getRenderableIds(!0).map(ke=>me.getTileByID(ke));U[ce]=Se.slice(),te=k[ce]=Se.sort((ke,Oe)=>Oe.tileID.overscaledZ-ke.tileID.overscaledZ||(ke.tileID.isLessThan(Oe.tileID)?-1:1))}const _e=this.crossTileSymbolIndex.addLayer(Z,te,a.center.lng,a.projection);O=O||_e}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),M=M||this._layerOrderChanged||g===0,this._layerOrderChanged&&this.fire(new r.z("neworder")),(M||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.q.now(),a.zoom))&&(this.pauseablePlacement=new U_(a,this._mergedOrder,M,p,g,b,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,k,U,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.q.now()),L=!0),O&&this.pauseablePlacement.placement.setStale()),L||O){this._buildingIndex.onNewFrame(a.zoom);for(let j=0;j<this._mergedOrder.length;j++){const Z=this._mergedLayers[this._mergedOrder[j]];if(Z.type!=="symbol")continue;const ce=this.isLayerClipped(Z);this.placement.updateLayerOpacities(Z,k[r.aC(Z.source,Z.scope)],j,ce?T:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.q.now())}}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}addImport(i,a){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:b})=>b===i.id)!==-1)return void this.fire(new r.y(new Error(`Import with id '${i.id}' already exists in the map's style.`)));if(!a)return p.push(i),this._loadImports([i],!0);const g=p.findIndex(({id:b})=>b===a);return g===-1&&this.fire(new r.y(new Error(`Import with id "${a}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,g).concat(i).concat(p.slice(g)),this._loadImports([i],!0,a)}updateImport(i,a){this._checkLoaded();const p=this.stylesheet.imports||[],g=this.getImportIndex(i);return g===-1?this:typeof a=="string"?(this.setImportUrl(i,a),this):(a.url&&a.url!==p[g].url&&this.setImportUrl(i,a.url),r.bn(a.config,p[g].config)||this.setImportConfig(i,a.config,a.data.schema),r.bn(a.data,p[g].data)||this.setImportData(i,a.data),this)}moveImport(i,a){this._checkLoaded();let p=this.stylesheet.imports||[];const g=this.getImportIndex(i);if(g===-1)return this;const b=this.getImportIndex(a);if(b===-1)return this;const T=p[g],M=this.fragments[g];return p=p.filter(({id:O})=>O!==i),this.fragments=this.fragments.filter(({id:O})=>O!==i),this.stylesheet.imports=p.slice(0,b).concat(T).concat(p.slice(b)),this.fragments=this.fragments.slice(0,b).concat(M).concat(this.fragments.slice(b)),this.mergeLayers(),this}setImportUrl(i,a){this._checkLoaded();const p=this.stylesheet.imports||[],g=this.getImportIndex(i);if(g===-1)return this;p[g].url=a;const b=this.fragments[g];return b.style=this._createFragmentStyle(p[g]),b.style.on("style.import.load",()=>this.mergeAll()),b.style.loadURL(a),this}setImportData(i,a){this._checkLoaded();const p=this.getImportIndex(i),g=this.stylesheet.imports||[];return p===-1?this:a?(this.fragments[p].style.setState(a),this._reloadImports(),this):(delete g[p].data,this.setImportUrl(i,g[p].url))}setImportConfig(i,a,p){this._checkLoaded();const g=this.getImportIndex(i),b=this.stylesheet.imports||[];if(g===-1)return this;a?b[g].config=a:delete b[g].config;const T=this.fragments[g];p&&T.style.stylesheet&&(T.style.stylesheet.schema=p);const M=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=a,T.style.updateConfig(a,M),this.updateConfigDependencies(),this}removeImport(i){this._checkLoaded();const a=this.stylesheet.imports||[],p=this.getImportIndex(i);p!==-1&&(a.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(i){const a=(this.stylesheet.imports||[]).findIndex(p=>p.id===i);return a===-1&&this.fire(new r.y(new Error(`Import '${i}' does not exist in the map's style and cannot be updated.`))),a}getLayer(i){return this._mergedLayers[i]}getSources(){const i=[];for(const a in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[a];p&&i.push(p.getSource())}return i}getSource(i,a){const p=this.getSourceCache(i,a);return p&&p.getSource()}getLayerSource(i){const a=this.getLayerSourceCache(i);return a&&a.getSource()}getSourceCache(i,a){const p=r.aC(i,a);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(i){const a=r.aC(i.source,i.scope);return i.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(i){if(i==null)return Object.values(this._mergedSourceCaches);const a=[];return this._mergedOtherSourceCaches[i]&&a.push(this._mergedOtherSourceCaches[i]),this._mergedSymbolSourceCaches[i]&&a.push(this._mergedSymbolSourceCaches[i]),a}updateSourceCaches(){const i=this._changes.getUpdatedSourceCaches();for(const a in i){const p=i[a];p==="reload"?this.reloadSource(a):p==="clear"&&this.clearSource(a)}}updateLayers(i){const a=this._changes.getUpdatedPaintProperties();for(const p of a){const g=this.getLayer(p);g&&g.updateTransitions(i)}}getImages(i,a,p){this.imageManager.getImages(a.icons,a.scope,p),this._updateTilesForChangedImages();const g=b=>{b&&b.setDependencies(a.tileID.key,a.type,a.icons)};g(this._otherSourceCaches[a.source]),g(this._symbolSourceCaches[a.source])}rasterizeImages(i,a,p){this.imageManager.rasterizeImages(a,p)}getGlyphs(i,a,p){this.glyphManager.getGlyphs(a.stacks,a.scope,p)}getResource(i,a,p){return r.cy(a,p)}getOwnSourceCache(i){return this._otherSourceCaches[i]}getOwnLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}getOwnSourceCaches(i){const a=[];return this._otherSourceCaches[i]&&a.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&a.push(this._symbolSourceCaches[i]),a}_isSourceCacheLoaded(i){const a=this.getOwnSourceCaches(i);return a.length===0?(this.fire(new r.y(new Error(`There is no source with ID '${i}'`))),!1):a.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(i,a){if(!this._clipLayerPresent&&i.type!=="fill-extrusion")return!1;const p=i.type==="fill-extrusion"&&i.sourceLayer==="building";if(i.is3D()){if(p||a&&a.type==="batched-model"||i.type==="model")return!0}else if(i.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(i=>{i.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}uo.getSourceType=function(f){return On[f]},uo.setSourceType=function(f,i){On[f]=i},uo.registerForPluginStateChange=r.ch;var Su=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,he=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,pe=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Fe="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Ke=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,At=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Lt=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,jt=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Yt=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,di=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Ei=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const ji=[];fn(Su,ji),fn(pe,ji),fn(he,ji);const Tr={"_prelude_fog.vertex.glsl":At,"_prelude_terrain.vertex.glsl":Ke,"_prelude_shadow.vertex.glsl":di,"_prelude_fog.fragment.glsl":Lt,"_prelude_shadow.fragment.glsl":Ei,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":jt,"_prelude_raster_particle.glsl":Yt},Cr={};Qi("",Ke),Qi(Lt,At),Qi(Ei,di),Qi(jt,""),Qi(Yt,"");const Br=Qi(he,pe),zn=Su;var Fn={background:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Qi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Qi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Qi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Qi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Qi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Qi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Qi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Qi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Qi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Qi(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Qi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Qi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Qi(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Qi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Qi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Qi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Fe),skyboxGradient:Qi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Fe),skyboxCapture:Qi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Qi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Qi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Qi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Qi("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Qi("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Qi("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Qi("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function fn(f,i){const a=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of a)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const g=p.split(" ");for(const b of g)i.includes(b)||i.push(b)}}function Qi(f,i){const a=/#include\s+"([^"]+)"/g,p=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let g=i.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);g&&(g=g.map(L=>{const k=L.split(" ");return k[k.length-1]}),g=[...new Set(g)]);const b={},T=[],M=[];if(f=f.replace(a,(L,k)=>(M.push(k),"")),(i=i.replace(a,(L,k)=>(T.push(k),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let O=[...ji];fn(f,O),fn(i,O);for(const L of[...T,...M])Tr[L]||console.error(`Undefined include: ${L}`),Cr[L]||(Cr[L]=[],fn(Tr[L],Cr[L])),O=[...O,...Cr[L]];return{fragmentSource:f=f.replace(p,(L,k,U,j,Z)=>(b[Z]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
in ${U} ${j} ${Z};
#else
uniform ${U} ${j} u_${Z};
#endif
`:k==="initialize"?`
#ifdef HAS_UNIFORM_u_${Z}
    ${U} ${j} ${Z} = u_${Z};
#endif
`:k==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Z}
    in ${U} ${j} ${Z};
#endif
`:k==="initialize-attribute"?"":void 0)),vertexSource:i=i.replace(p,(L,k,U,j,Z)=>{const ce=j==="float"?"vec2":j,te=Z.match(/color/)?"color":ce;return k==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${Z}
in ${U} ${j} a_${Z};
#endif
`:b[Z]?k==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
in ${U} ${ce} a_${Z};
out ${U} ${j} ${Z};
#else
uniform ${U} ${j} u_${Z};
#endif
`:k==="initialize"?te==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = a_${Z};
#else
    ${U} ${j} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = unpack_mix_${te}(a_${Z}, u_${Z}_t);
#else
    ${U} ${j} ${Z} = u_${Z};
#endif
`:k==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Z}
    in ${U} ${j} a_${Z};
    out ${U} ${j} ${Z};
#endif
`:k==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Z}
    ${Z} = a_${Z};
#endif
`:void 0:k==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
in ${U} ${ce} a_${Z};
#else
uniform ${U} ${j} u_${Z};
#endif
`:k==="define-instanced"?te==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${Z}0;
in vec4 a_${Z}1;
in vec4 a_${Z}2;
in vec4 a_${Z}3;
#else
uniform ${U} ${j} u_${Z};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${U} ${ce} a_${Z};
#else
uniform ${U} ${j} u_${Z};
#endif
`:k==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${Z}
    ${U} ${j} ${Z} = a_${Z};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${U} ${j} ${Z} = a_${Z};
#else
    ${U} ${j} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${U} ${j} ${Z} = unpack_mix_${te}(a_${Z}, u_${Z}_t);
#else
    ${U} ${j} ${Z} = u_${Z};
#endif
`}),staticAttributes:g,usedDefines:O,vertexIncludes:T,fragmentIncludes:M}}class Ti{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,a,p,g,b,T,M,O){this.context=i;let L=this.boundPaintVertexBuffers.length!==g.length;for(let U=0;!L&&U<g.length;U++)this.boundPaintVertexBuffers[U]!==g[U]&&(L=!0);let k=this.boundDynamicVertexBuffers.length!==M.length;for(let U=0;!k&&U<M.length;U++)this.boundDynamicVertexBuffers[U]!==M[U]&&(k=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==p||L||k||this.boundIndexBuffer!==b||this.boundVertexOffset!==T)this.freshBind(a,p,g,b,T,M,O);else{i.bindVertexArrayOES.set(this.vao);for(const U of M)U&&(U.bind(),O&&U.instanceCount&&U.setVertexAttribDivisor(i.gl,a,O));b&&b.dynamicDraw&&b.bind()}}freshBind(i,a,p,g,b,T,M){const O=i.numAttributes,L=this.context,k=L.gl;this.vao&&this.destroy(),this.vao=L.gl.createVertexArray(),L.bindVertexArrayOES.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=g,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=T,a.enableAttributes(k,i),a.bind(),a.setVertexAttribPointers(k,i,b);for(const U of p)U.enableAttributes(k,i),U.bind(),U.setVertexAttribPointers(k,i,b);for(const U of T)U&&(U.enableAttributes(k,i),U.bind(),U.setVertexAttribPointers(k,i,b),M&&U.instanceCount&&U.setVertexAttribDivisor(k,i,M));g&&g.bind(),L.currentNumAttributes=O}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function rr(f,i){const a=Math.pow(2,i.canonical.z),p=i.canonical.y;return[new r.aa(0,p/a).toLngLat().lat,new r.aa(0,(p+1)/a).toLngLat().lat]}function ns(f,i,a,p,g,b,T){const M=f.context,O=M.gl,L=a.hillshadeFBO;if(!L)return;f.prepareDrawTile();const k=f.isTileAffectedByFog(i),U=f.getOrCreateProgram("hillshade",{overrideFog:k});M.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,L.colorAttachment.get());const j=((_e,me,Se,ke)=>{const Oe=Se.paint.get("hillshade-shadow-color"),je=Se.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ve=Se.paint.get("hillshade-highlight-color"),Ue=Se.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Ne=Se.paint.get("hillshade-accent-color"),Ye=Se.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",it=Se.paint.get("hillshade-emissive-strength");let xt=r.ai(Se.paint.get("hillshade-illumination-direction"));if(Se.paint.get("hillshade-illumination-anchor")==="viewport")xt-=_e.transform.angle;else if(_e.style&&_e.style.enable3dLights()&&_e.style.directionalLight){const Rt=_e.style.directionalLight.properties.get("direction"),Pt=r.cb(Rt.x,Rt.y,Rt.z);xt=r.ai(Pt[1])}const _t=!_e.options.moving;return{u_matrix:ke||_e.transform.calculateProjMatrix(me.tileID.toUnwrapped(),_t),u_image:0,u_latrange:rr(0,me.tileID),u_light:[Se.paint.get("hillshade-exaggeration"),xt],u_shadow:Oe.toRenderColor(je?null:Se.lut),u_highlight:Ve.toRenderColor(Ue?null:Se.lut),u_emissive_strength:it,u_accent:Ne.toRenderColor(Ye?null:Se.lut)}})(f,a,p,f.terrain?i.projMatrix:null);f.uploadCommonUniforms(M,U,i.toUnwrapped());const{tileBoundsBuffer:Z,tileBoundsIndexBuffer:ce,tileBoundsSegments:te}=f.getTileBoundsBuffers(a);U.draw(f,O.TRIANGLES,g,b,T,Fi.disabled,j,p.id,Z,ce,te)}function Ss(f,i,a){if(!i.needsDEMTextureUpload)return;const p=f.context,g=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||f.getTileTexture(a.stride);const b=a.getPixels();i.demTexture?i.demTexture.update(b,{premultiply:!1}):i.demTexture=new r.T(p,b,g.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function Nc(f,i,a){const p=f.context,g=p.gl;if(!i.dem)return;const b=i.dem;if(p.activeTexture.set(g.TEXTURE1),Ss(f,i,b),!i.demTexture)return;i.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE);const T=b.dim;p.activeTexture.set(g.TEXTURE0);let M=i.hillshadeFBO;if(!M){const j=new r.T(p,{width:T,height:T,data:null},g.RGBA8);j.bind(g.LINEAR,g.CLAMP_TO_EDGE),M=i.hillshadeFBO=p.createFramebuffer(T,T,!0,"renderbuffer"),M.colorAttachment.set(j.texture)}p.bindFramebuffer.set(M.framebuffer),p.viewport.set([0,0,T,T]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:L,tileBoundsSegments:k}=f.getMercatorTileBoundsBuffers(),U=[];f.linearFloatFilteringSupported()&&U.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:U}).draw(f,g.TRIANGLES,Ri.disabled,$i.disabled,gr.unblended,Fi.disabled,((j,Z)=>{const ce=Z.stride,te=r.ab.mat4.create();return r.ab.mat4.ortho(te,0,r.ag,-r.ag,0,0,1),r.ab.mat4.translate(te,te,[0,-r.ag,0]),{u_matrix:te,u_image:1,u_dimension:[ce,ce],u_zoom:j.overscaledZ}})(i.tileID,b),a.id,O,L,k),i.needsHillshadePrepare=!1}class sn{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class yh extends sn{getDefault(){return r.aj.transparent}set(i){const a=this.current;(i.r!==a.r||i.g!==a.g||i.b!==a.b||i.a!==a.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class vh extends sn{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class G_ extends sn{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class W_ extends sn{getDefault(){return[!0,!0,!0,!0]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||i[3]!==a[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class K0 extends sn{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class J0 extends sn{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class nw extends sn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const a=this.current;(i.func!==a.func||i.ref!==a.ref||i.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Jd extends sn{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Qd extends sn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=i,this.dirty=!1}}class Q0 extends sn{getDefault(){return[0,1]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Vo extends sn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=i,this.dirty=!1}}class Z_ extends sn{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class kp extends sn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.BLEND):a.disable(a.BLEND),this.current=i,this.dirty=!1}}class zp extends sn{getDefault(){const i=this.gl;return[i.ONE,i.ZERO,i.ONE,i.ZERO]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||i[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Y_ extends sn{getDefault(){return r.aj.transparent}set(i){const a=this.current;(i.r!==a.r||i.g!==a.g||i.b!==a.b||i.a!==a.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class X_ extends sn{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(i,i),this.current=i,this.dirty=!1)}}class Fp extends sn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=i,this.dirty=!1}}class K_ extends sn{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class J_ extends sn{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let Bp=class extends sn{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class e1 extends sn{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class t1 extends sn{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||i[3]!==a[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class xh extends sn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class sw extends sn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class ow extends sn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class aw extends sn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class lw extends sn{getDefault(){return null}set(i){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class cw extends sn{getDefault(){return null}set(i){this.gl&&(i!==this.current||this.dirty)&&(this.gl.bindVertexArray(i),this.current=i,this.dirty=!1)}}class uw extends sn{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class Q_ extends sn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class eg extends sn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Np extends sn{constructor(i,a){super(i),this.context=i,this.parent=a}getDefault(){return null}}class bh extends Np{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class tg extends Np{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class i1 extends Np{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class r1 extends tg{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const ig=(f,i,a)=>({u_matrix:f,u_image0:0,u_skirt_height:i,u_ground_shadow_factor:a}),Vc=(f,i,a,p,g,b,T,M,O,L,k,U,j,Z,ce,te)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:a,u_zoom_transition:g,u_merc_center:b,u_image0:0,u_frustum_tl:T,u_frustum_tr:M,u_frustum_br:O,u_frustum_bl:L,u_globe_pos:k,u_globe_radius:U,u_viewport:j,u_grid_matrix:te?Float32Array.from(te):new Float32Array(9),u_skirt_height:Z,u_far_z_cutoff:ce});function rg(f,i){return f!=null&&i!=null&&!(!f.hasData()||!i.hasData())&&f.demTexture!=null&&i.demTexture!=null&&f.tileID.key!==i.tileID.key}const aa=new class{constructor(){this.operations={}}newMorphing(f,i,a,p,g){if(f in this.operations){const b=this.operations[f];b.to.tileID.key!==a.tileID.key&&(b.queued=a)}else this.operations[f]={startTime:p,phase:0,duration:g,from:i,to:a,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const i=this.operations[f];return{from:i.from,to:i.to,phase:i.phase}}update(f){for(const i in this.operations){const a=this.operations[i];for(a.phase=(f-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,f)){delete this.operations[i];break}}}_nextOp(f,i){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=i,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Vp={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ef(f,i,a){if(i===0)return 0;const p=i<1&&a===514?.25/i:1;return 6*Math.pow(1.5,22-f)*Math.max(i,1)*p}function n1(f,i){const a=1<<f.z;return!i&&(f.x===0||f.x===a-1)||f.y===0||f.y===a-1}const Up=f=>({u_matrix:f});function tf(f,i,a,p,g){if(g>0){const b=r.q.now(),T=(b-f.timeAdded)/g,M=i?(b-i.timeAdded)/g:-1,O=a.getSource(),L=p.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),k=!i||Math.abs(i.tileID.overscaledZ-L)>Math.abs(f.tileID.overscaledZ-L),U=k&&f.refreshedUponExpiration?1:r.aw(k?T:1-M,0,1);return f.refreshedUponExpiration&&T>=1&&(f.refreshedUponExpiration=!1),i?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class ng extends rs{constructor(i){const a={type:"raster-dem",maxzoom:i.transform.maxZoom},p=new r.D(r.ci(),null),g=_s("mock-dem",a,p,i.style);super("mock-dem",g,!1),g.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,a){i.state="loaded",a(null)}}class hw extends rs{constructor(i){const a=_s("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new r.D(r.ci(),null),i.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,a,p){if(i.freezeTileCoverage)return;this.transform=i;const g=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,T)=>{if(b[T.key]="",!this._tiles[T.key]){const M=new Xa(T,this._source.tileSize*T.overscaleFactor(),i.tileZoom);M.state="loaded",this._tiles[T.key]=M}return b},{});for(const b in this._tiles)b in g||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(i){const a=this.proxyCachedFBO[i];if(a!==void 0){const p=Object.values(a);this.renderCachePool.push(...p),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class sg extends r.aG{constructor(i,a,p){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=a,this.projMatrix=p}}class wh extends r.cJ{constructor(i,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},i.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,g,b]=function(O){const L=new r.b4,k=new r.aU,U=131;L.reserve(17161),k.reserve(33800);const j=r.ag/128,Z=r.ag+j/2,ce=Z+j;for(let _e=-j;_e<ce;_e+=j)for(let me=-j;me<ce;me+=j){const Se=me<0||me>Z||_e<0||_e>Z?24575:0,ke=r.aw(Math.round(me),0,r.ag),Oe=r.aw(Math.round(_e),0,r.ag);L.emplaceBack(ke+Se,Oe)}const te=(_e,me)=>{const Se=me*U+_e;k.emplaceBack(Se+1,Se,Se+U),k.emplaceBack(Se+U,Se+U+1,Se+1)};for(let _e=1;_e<129;_e++)for(let me=1;me<129;me++)te(me,_e);return[0,129].forEach(_e=>{for(let me=0;me<130;me++)te(me,_e),te(_e,me)}),[L,k,32768]}(),T=i.context;this.gridBuffer=T.createVertexBuffer(p,r.b6.members),this.gridIndexBuffer=T.createIndexBuffer(g),this.gridSegments=r.b7.simpleSegment(0,0,p.length,g.length),this.gridNoSkirtSegments=r.b7.simpleSegment(0,0,p.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new hw(a.map),this.orthoMatrix=r.ab.mat4.create(),r.ab.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.ag,0,r.ag,0,1);const M=T.gl;this._overlapStencilMode=new $i({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ng(a.map),this._pendingGroundEffectLayers=[]}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),this._style=i,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,a,p){if(i&&i.terrain){this._style!==i&&(this.style=i,this._evaluationZoom=void 0);const g=i.terrain.properties,b=i.terrain.drapeRenderMode===0,T=i.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.q.now();const M=i.terrain&&i.terrain.scope,O=g.get("source"),L=b?this._mockSourceCache:i.getSourceCache(O,M);if(!L)return void r.w(`Couldn't find terrain source "${O}".`);if(this.sourceCache=L,this._attenuationRange=i.terrain.getAttenuationRange(),this._exaggeration=T?this.calculateExaggeration(a):g.get("exaggeration"),!a.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;const k=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const U=this.getScaledDemTileSize();this.sourceCache.update(a,U,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,k(),this._initializing=!0),k(),a.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(i){if(this._attenuationRange&&i.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(i.zoom);const a=this._previousCameraAltitude,p=i.getFreeCameraOptions().position.z/i.pixelsPerMeter*i.worldSize;this._previousCameraAltitude=p;const g=a!=null?p-a:Number.MAX_VALUE;if(Math.abs(g)<2)return this._exaggeration;const b=i.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(b);let M=b-this._previousZoom;const O=this._previousUpdateTimestamp;let L=b;this._evaluationZoom!=null&&(L=this._evaluationZoom,Math.abs(b-L)>.5&&(M=.5*(b-L+M)),M*g<0&&(L+=M)),this._evaluationZoom=L;const k=T.getExaggeration(L),U=k===T.getExaggeration(Math.max(0,L-.1));if(U&&Math.abs(k-this._exaggeration)<.01)return k;let j=Math.min(.1,.00375*(this._updateTimestamp-O));return(U||k<.1||Math.abs(M)<1e-4)&&(j=Math.min(.2,4*j)),r.af(this._exaggeration,k,j)}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._mergedSourceCaches)this._style._mergedSourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(r.aa.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const g=this.proxyCoords=a.getIds().map(O=>{const L=a.getTileByID(O).tileID;return L.projMatrix=p.calculateProjMatrix(L.toUnwrapped()),L});(function(O,L){const k=L.transform.pointCoordinate(L.transform.getCameraPoint()),U=new r.P(k.x,k.y);O.sort((j,Z)=>{if(Z.overscaledZ-j.overscaledZ)return Z.overscaledZ-j.overscaledZ;const ce=new r.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),te=new r.P(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),_e=U.mult(1<<j.canonical.z);return _e.x-=.5,_e.y-=.5,_e.distSqr(ce)-_e.distSqr(te)})})(g,this.painter);const b=this.proxyToSource||{};this.proxyToSource={},g.forEach(O=>{this.proxyToSource[O.key]={}}),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const O in T){const L=T[O];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,i[O],b),L.usedForTerrain))continue;const k=i[O];L.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[a.id]=g.map(O=>new sg(O,O.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;const M={};this._visibleDemTiles=[];for(const O of this.proxyCoords){const L=this.terrainTileForTile[O.key];if(!L)continue;const k=L.tileID.key;k in M||(this._visibleDemTiles.push(L),M[k]=k)}}_assignTerrainTiles(i){this._initializing||i.forEach(a=>{if(this.terrainTileForTile[a.key])return;const p=this._findTileCoveringTileID(a,this.sourceCache);p&&(this.terrainTileForTile[a.key]=p)})}_prepareDEMTextures(){const i=this.painter.context,a=i.gl;for(const p in this.terrainTileForTile){const g=this.terrainTileForTile[p],b=g.dem;!b||g.demTexture&&!g.needsDEMTextureUpload||(i.activeTexture.set(a.TEXTURE1),Ss(this.painter,g,b))}}_prepareDemTileUniforms(i,a,p,g){if(!a||a.demTexture==null)return!1;const b=i.tileID.canonical,T=Math.pow(2,a.tileID.canonical.z-b.z),M=g||"";return p[`u_dem_tl${M}`]=[b.x*T%1,b.y*T%1],p[`u_dem_scale${M}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let i=0;const a=this._visibleDemTiles.reduce((p,g)=>{if(!g.dem)return p;const b=g.dem.tree.minimums[0];return b>0&&i++,p+b},0);return i?a/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,a=i.gl;i.activeTexture.set(a.TEXTURE2);const p=this._getLoadedAreaMinimum(),g=new r.cK({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(g,{premultiply:!1}):b=this._emptyDEMTexture=new r.T(i,g,a.R32F,{premultiply:!1}),b}setupElevationDraw(i,a,p){const g=this.painter.context,b=g.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};T.u_exaggeration=this.exaggeration();let M=null,O=null,L=1;if(p&&p.morphing&&this._useVertexMorphing){const Z=p.morphing.srcDemTile,ce=p.morphing.dstDemTile;L=p.morphing.phase,Z&&ce&&(this._prepareDemTileUniforms(i,Z,T,"_prev")&&(O=Z),this._prepareDemTileUniforms(i,ce,T)&&(M=ce))}const k=Z=>Z&&Z.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST;let U=null;var j;if(this.enabled?O&&M?(U=M.demTexture,g.activeTexture.set(b.TEXTURE4),O.demTexture.bind(k(O),b.CLAMP_TO_EDGE),T.u_dem_lerp=L):(M=this.terrainTileForTile[i.tileID.key],U=this._prepareDemTileUniforms(i,M,T)?M.demTexture:this.emptyDEMTexture):U=this.emptyDEMTexture,g.activeTexture.set(b.TEXTURE2),U&&(T.u_dem_size=(j=U).size[0]===1?1:j.size[0]-2,U.bind(k(M),b.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,a,T),p&&p.useMeterToDem&&M){const Z=(1<<M.tileID.canonical.z)*r.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=Z}if(p&&p.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),a.setTerrainUniformValues(g,T),this.painter.transform.projection.name==="globe"){const Z=this.globeUniformValues(this.painter.transform,i.tileID.canonical,p&&p.useDenormalizedUpVectorScale);a.setGlobeUniformValues(g,Z)}}globeUniformValues(i,a,p){const g=i.projection;return{u_tile_tl_up:g.upVector(a,0,0),u_tile_tr_up:g.upVector(a,r.ag,0),u_tile_br_up:g.upVector(a,r.ag,r.ag),u_tile_bl_up:g.upVector(a,0,r.ag),u_tile_up_scale:p?r.cL(1):g.upVectorScale(a,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const a=this.painter,p=this.painter.context;i.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(g,b,T,M,O){if(g.transform.projection.name==="globe")(function(L,k,U,j,Z){const ce=L.context,te=ce.gl;let _e,me;const Se=L.transform,ke=r.cC(L,ce,Se),Oe=(Rt,Pt)=>{if(me===Pt)return;const ht=[Vp[Pt],"PROJECTION_GLOBE_VIEW"];ke&&ht.push("CUSTOM_ANTIALIASING");const bt=L.isTileAffectedByFog(Rt);_e=L.getOrCreateProgram("globeRaster",{defines:ht,overrideFog:bt}),me=Pt},je=L.colorModeForRenderPass(),Ve=new Ri(te.LEQUAL,Ri.ReadWrite,L.depthRangeFor3D);aa.update(Z);const Ue=r.cD(Se),Ne=[r.at(Se.center.lng),r.aA(Se.center.lat)],Ye=L.globeSharedBuffers,it=[Se.width*r.q.devicePixelRatio,Se.height*r.q.devicePixelRatio],xt=Float32Array.from(Se.globeMatrix),_t={useDenormalizedUpVectorScale:!0};{const Rt=L.transform,Pt=ef(Rt.zoom,k.exaggeration(),k.sourceCache._source.tileSize);me=-1;const ht=te.TRIANGLES;for(const bt of j){const Vt=U.getTile(bt),ut=$i.disabled,Ot=k.prevTerrainTileForTile[bt.key],wt=k.terrainTileForTile[bt.key];rg(Ot,wt)&&aa.newMorphing(bt.key,Ot,wt,Z,250),ce.activeTexture.set(te.TEXTURE0),Vt.texture&&Vt.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE);const Qt=aa.getMorphValuesForProxy(bt.key),kt=Qt?1:0;Qt&&r.J(_t,{morphing:{srcDemTile:Qt.from,dstDemTile:Qt.to,phase:r.cB(Qt.phase)}});const Dt=r.cE(bt.canonical),Gt=r.cF(Dt.getCenter().lat),Jt=r.cG(bt.canonical,Dt,Gt,Rt.worldSize/Rt._pixelsPerMercatorPixel),ci=r.bb(r.cH(bt.canonical)),_i=Vc(Rt.expandedFarZProjMatrix,xt,Ue,ci,r.ae(Rt.zoom),Ne,Rt.frustumCorners.TL,Rt.frustumCorners.TR,Rt.frustumCorners.BR,Rt.frustumCorners.BL,Rt.globeCenterInViewSpace,Rt.globeRadius,it,Pt,Rt._farZ,Jt);if(Oe(bt,kt),_e&&(k.setupElevationDraw(Vt,_e,_t),L.uploadCommonUniforms(ce,_e,bt.toUnwrapped()),Ye)){const[qi,Di,Oi]=Ye.getGridBuffers(Gt,Pt!==0);_e.draw(L,ht,Ve,ut,je,Fi.backCCW,_i,"globe_raster",qi,Di,Oi)}}}if(Ye&&(L.renderDefaultNorthPole||L.renderDefaultSouthPole)){const Rt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ke&&Rt.push("CUSTOM_ANTIALIASING"),_e=L.getOrCreateProgram("globeRaster",{defines:Rt});for(const Pt of j){const{x:ht,y:bt,z:Vt}=Pt.canonical,ut=bt===0,Ot=bt===(1<<Vt)-1,[wt,Qt,kt,Dt]=Ye.getPoleBuffers(Vt,!1);if(Dt&&(ut||Ot)){const Gt=U.getTile(Pt);ce.activeTexture.set(te.TEXTURE0),Gt.texture&&Gt.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE);let Jt=r.cI(Vt,ht,Se);const ci=r.bb(r.cH(Pt.canonical)),_i=(qi,Di)=>qi.draw(L,te.TRIANGLES,Ve,$i.disabled,je,Fi.disabled,Vc(Se.expandedFarZProjMatrix,Jt,Jt,ci,0,Ne,Se.frustumCorners.TL,Se.frustumCorners.TR,Se.frustumCorners.BR,Se.frustumCorners.BL,Se.globeCenterInViewSpace,Se.globeRadius,it,0,Se._farZ),"globe_pole_raster",Di,kt,Dt);k.setupElevationDraw(Gt,_e,_t),L.uploadCommonUniforms(ce,_e,Pt.toUnwrapped()),ut&&L.renderDefaultNorthPole&&_i(_e,wt),Ot&&L.renderDefaultSouthPole&&(Jt=r.ab.mat4.scale(r.ab.mat4.create(),Jt,[1,-1,1]),_i(_e,Qt))}}}})(g,b,T,M,O);else{const L=g.context,k=L.gl;let U,j;const Z=g.shadowRenderer,ce=tl(g,g.longestCutoffRange),te=je=>{if(j===je)return;const Ve=[];Ve.push(Vp[je]),ce.shouldRenderCutoff&&Ve.push("RENDER_CUTOFF"),Z&&(Ve.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Z.useNormalOffset&&Ve.push("NORMAL_OFFSET")),U=g.getOrCreateProgram("terrainRaster",{defines:Ve}),j=je},_e=g.colorModeForRenderPass(),me=new Ri(k.LEQUAL,Ri.ReadWrite,g.depthRangeFor3D);aa.update(O);const Se=g.transform,ke=ef(Se.zoom,b.exaggeration(),b.sourceCache._source.tileSize);let Oe=[0,0,0];if(Z){const je=g.style.directionalLight,Ve=g.style.ambientLight;je&&Ve&&(Oe=Wd(g.style,je,Ve))}{j=-1;const je=k.TRIANGLES,[Ve,Ue]=[b.gridIndexBuffer,b.gridSegments];for(const Ne of M){const Ye=T.getTile(Ne),it=$i.disabled,xt=b.prevTerrainTileForTile[Ne.key],_t=b.terrainTileForTile[Ne.key];rg(xt,_t)&&aa.newMorphing(Ne.key,xt,_t,O,250),L.activeTexture.set(k.TEXTURE0),Ye.texture&&Ye.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const Rt=aa.getMorphValuesForProxy(Ne.key),Pt=Rt?1:0;let ht;Rt&&(ht={morphing:{srcDemTile:Rt.from,dstDemTile:Rt.to,phase:r.cB(Rt.phase)}});const bt=ig(Ne.projMatrix,n1(Ne.canonical,Se.renderWorldCopies)?ke/10:ke,Oe);if(te(Pt),!U)continue;b.setupElevationDraw(Ye,U,ht);const Vt=Ne.toUnwrapped();Z&&Z.setupShadows(Vt,U),g.uploadCommonUniforms(L,U,Vt,null,ce),U.draw(g,je,me,it,_e,Fi.backCCW,bt,"terrain_raster",b.gridBuffer,Ve,Ue)}}}}(a,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const a=this.painter,p=this.painter.context,g=this.proxySourceCache,b=this.proxiedCoords[g.id],T=this._drapedRenderBatches.shift(),M=a.style.order,O=[];let L=0;for(const k of b){const U=g.getTileByID(k.proxyTileKey),j=g.proxyCachedFBO[k.key]?g.proxyCachedFBO[k.key][i]:void 0,Z=j!==void 0?g.renderCache[j]:this.pool[L++],ce=j!==void 0;if(U.texture=Z.tex,ce&&!Z.dirty){O.push(U.tileID);continue}let te;p.bindFramebuffer.set(Z.fb.framebuffer),this.renderedToTile=!1,Z.dirty&&(p.clear({color:r.aj.transparent,stencil:0}),Z.dirty=!1);for(let _e=T.start;_e<=T.end;++_e){const me=a.style._mergedLayers[M[_e]];if(me.isHidden(a.transform.zoom))continue;const Se=a.style.getLayerSourceCache(me),ke=Se?this.proxyToSource[k.key][Se.id]:[k];if(!ke)continue;const Oe=ke;p.viewport.set([0,0,Z.fb.width,Z.fb.height]),te!==(Se?Se.id:null)&&(this._setupStencil(Z,ke,me,Se),te=Se?Se.id:null),a.renderLayer(a,Se,me,Oe)}if(this._drapedRenderBatches.length===0)for(const _e of this._pendingGroundEffectLayers){const me=a.style._mergedLayers[M[_e]];if(me.isHidden(a.transform.zoom))continue;const Se=a.style.getLayerSourceCache(me),ke=Se?this.proxyToSource[k.key][Se.id]:[k];if(!ke)continue;const Oe=ke;p.viewport.set([0,0,Z.fb.width,Z.fb.height]),te!==(Se?Se.id:null)&&(this._setupStencil(Z,ke,me,Se),te=Se?Se.id:null),a.renderLayer(a,Se,me,Oe)}this.renderedToTile?(Z.dirty=!0,O.push(U.tileID)):ce||--L,L===5&&(L=0,this.renderToBackBuffer(O))}return this.renderToBackBuffer(O),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,a.width,a.height]),T.end+1}postRender(){}isLayerOrderingCorrect(i){const a=i.order.length;let p=-1,g=a;for(let b=0;b<a;++b)this._style.isLayerDraped(i._mergedLayers[i.order[b]])?p=Math.max(p,b):g=Math.min(g,b);return g>p}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{i=Math.min(i,a.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,a,p){if(!this._visibleDemTiles)return null;const g=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const T=b.tileID,M=1<<T.overscaledZ,{x:O,y:L}=T.canonical,k=O/M,U=(O+1)/M,j=L/M,Z=(L+1)/M;return{minx:k,miny:j,maxx:U,maxy:Z,t:b.dem.tree.raycastRoot(k,j,U,Z,i,a,p),tile:b}});g.sort((b,T)=>(b.t!==null?b.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const b of g){if(b.t==null)return null;const T=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,i,a,p);if(T!=null)return T}return null}_createFBO(){const i=this.painter.context,a=i.gl,p=this.drapeBufferSize;i.activeTexture.set(a.TEXTURE0);const g=new r.T(i,{width:p[0],height:p[1],data:null},a.RGBA8);g.bind(a.LINEAR,a.CLAMP_TO_EDGE);const b=i.createFramebuffer(p[0],p[1],!0,null);return b.colorAttachment.set(g.texture),b.depthAttachment=new r1(i,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:b,tex:g,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const a=this._style._mergedLayers[i],p=a.isHidden(this.painter.transform.zoom);return a.type==="hillshade"||a.type==="custom"?!p&&a.shouldRedrape():!p&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const p of this._style.getSources())if(p instanceof ki){i=!0;break}if(!i)return;const a={};for(let p=0;p<this._style.order.length;++p){const g=this._style._mergedLayers[this._style.order[p]],b=this._style.getLayerSourceCache(g);if(b&&!a[b.id]&&!g.isHidden(this.painter.transform.zoom)&&g.type==="line"&&g.widthExpression()instanceof r.a9){a[b.id]=!0;for(const T of this.proxyCoords){const M=this.proxyToSource[T.key][b.id];if(M)for(const O of M)this._clearRenderCacheForTile(b.id,O)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof Vs){i=!0;break}if(!i)return;const a={};for(let p=0;p<this._style.order.length;++p){const g=this._style._mergedLayers[this._style.order[p]],b=this._style.getLayerSourceCache(g);if(!b||a[b.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="raster")continue;const T=g.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const O=this.proxyToSource[M.key][b.id];if(O)for(const L of O){const k=tf(b.getTile(L),b.findLoadedParent(L,0),b,this.painter.transform,T);(k.opacity!==1||k.mix!==0)&&this._clearRenderCacheForTile(b.id,L)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const i=this._style.order,a=i.length;if(a===0)return;const p=[];this._pendingGroundEffectLayers=[];let g,b=0,T=this._style._mergedLayers[i[b]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++b<a;)T=this._style._mergedLayers[i[b]];for(;b<a;++b){const M=this._style._mergedLayers[i[b]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?g===void 0&&(g=b):(M.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),g!==void 0&&(p.push({start:g,end:b-1}),g=void 0)))}if(g!==void 0&&p.push({start:g,end:b-1}),p.length!==0){const M=p[p.length-1];this._pendingGroundEffectLayers.every(O=>O>M.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(i){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const T=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let M=0;M<T.length;++M){const O=Object.values(T[M]);a.renderCachePool.push(...O)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,g=this._tilesDirty;for(let T=p.length-1;T>=0;T--){const M=p[T];if(a.getTileByID(M.key),a.proxyCachedFBO[M.key]!==void 0){const O=i[M.key],L=this.proxyToSource[M.key];let k=0;for(const U in L){const j=L[U],Z=O[U];if(!Z||Z.length!==j.length||j.some((ce,te)=>ce!==Z[te]||g[U]&&g[U].hasOwnProperty(ce.key))){k=-1;break}++k}for(const U in a.proxyCachedFBO[M.key])a.renderCache[a.proxyCachedFBO[M.key][U]].dirty=k<0||k!==Object.values(O).length}}const b=[...this._drapedRenderBatches];b.sort((T,M)=>M.end-M.start-(T.end-T.start));for(const T of b)for(const M of p){if(a.proxyCachedFBO[M.key])continue;let O=a.renderCachePool.pop();O===void 0&&a.renderCache.length<50&&(O=a.renderCache.length,a.renderCache.push(this._createFBO())),O!==void 0&&(a.proxyCachedFBO[M.key]={},a.proxyCachedFBO[M.key][T.start]=O,a.renderCache[O].dirty=!0)}this._tilesDirty={}}_setupStencil(i,a,p,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,T=b.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let M;if(p.isTileClipped())M=a.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):$i.disabled}_renderTileClippingMasks(i,a){const p=this.painter,g=this.painter.context,b=g.gl;p._tileClippingMaskIDs={},g.setColorMode(gr.disabled),g.setDepthMode(Ri.disabled);const T=p.getOrCreateProgram("clippingMask");for(const M of i){const O=p._tileClippingMaskIDs[M.key]=--a;T.draw(p,b.TRIANGLES,Ri.disabled,new $i({func:b.ALWAYS,mask:0},O,255,b.KEEP,b.KEEP,b.REPLACE),gr.disabled,Fi.disabled,Up(M.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(i){const a=this.painter.transform;if(i.x<0||i.x>a.width||i.y<0||i.y>a.height)return null;const p=[i.x,i.y,1,1];r.ab.vec4.transformMat4(p,p,a.pixelMatrixInverse),r.ab.vec4.scale(p,p,1/p[3]),p[0]/=a.worldSize,p[1]/=a.worldSize;const g=a._camera.position,b=r.bH(1,a.center.lat),T=[g[0],g[1],g[2]/b,0],M=r.ab.vec3.subtract([],p.slice(0,3),T);r.ab.vec3.normalize(M,M);const O=this.raycast(T,M,this._exaggeration);return O!==null&&O?(r.ab.vec3.scaleAndAdd(T,T,M,O),T[3]=T[2],T[2]*=b,T):null}_setupProxiedCoordsForOrtho(i,a,p){if(i.getSource()instanceof r.aJ)return this._setupProxiedCoordsForImageSource(i,a,p);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const g=this.proxiedCoords[i.id]=[],b=this.proxyCoords;for(let O=0;O<b.length;O++){const L=b[O],k=this._findTileCoveringTileID(L,i);if(k){const U=this._createProxiedId(L,k,p[L.key]&&p[L.key][i.id]);g.push(U),this.proxyToSource[L.key][i.id]=[U]}}let T=!1;const M=new Set;for(let O=0;O<a.length;O++){const L=i.getTile(a[O]);if(!L||!L.hasData())continue;const k=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==L.tileID.canonical.z){const U=this.proxyToSource[k.tileID.key][i.id],j=this._createProxiedId(k.tileID,L,p[k.tileID.key]&&p[k.tileID.key][i.id]);U?U.splice(U.length-1,0,j):this.proxyToSource[k.tileID.key][i.id]=[j];const Z=this.proxyToSource[k.tileID.key][i.id];M.has(Z)||M.add(Z),g.push(j),T=!0}}if(this._sourceTilesOverlap[i.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const O of M)O.sort((L,k)=>k.overscaledZ-L.overscaledZ)}_setupProxiedCoordsForImageSource(i,a,p){if(!i.getSource().loaded())return;const g=this.proxiedCoords[i.id]=[],b=this.proxyCoords,T=i.getSource(),M=T.tileID;if(!M)return;const O=new r.P(M.x,M.y)._div(1<<M.z),L=T.coordinates.map(r.aa.fromLngLat).reduce((U,j)=>(U.min.x=Math.min(U.min.x,j.x-O.x),U.min.y=Math.min(U.min.y,j.y-O.y),U.max.x=Math.max(U.max.x,j.x-O.x),U.max.y=Math.max(U.max.y,j.y-O.y),U),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(U,j)=>{const Z=U.wrap+U.canonical.x/(1<<U.canonical.z),ce=U.canonical.y/(1<<U.canonical.z),te=r.ag/(1<<U.canonical.z),_e=j.wrap+j.canonical.x/(1<<j.canonical.z),me=j.canonical.y/(1<<j.canonical.z);return Z+te<_e+L.min.x||Z>_e+L.max.x||ce+te<me+L.min.y||ce>me+L.max.y};for(let U=0;U<b.length;U++){const j=b[U];for(let Z=0;Z<a.length;Z++){const ce=i.getTile(a[Z]);if(!ce||!ce.hasData()||k(j,ce.tileID))continue;const te=this._createProxiedId(j,ce,p[j.key]&&p[j.key][i.id]),_e=this.proxyToSource[j.key][i.id];_e?_e.push(te):this.proxyToSource[j.key][i.id]=[te],g.push(te)}}}_createProxiedId(i,a,p){let g=this.orthoMatrix;if(p){const b=p.find(T=>T.key===a.tileID.key);if(b)return b}if(a.tileID.key!==i.key){const b=i.canonical.z-a.tileID.canonical.z;let T,M,O;g=r.ab.mat4.create();const L=a.tileID.wrap-i.wrap<<i.overscaledZ;b>0?(T=r.ag>>b,M=T*((a.tileID.canonical.x<<b)-i.canonical.x+L),O=T*((a.tileID.canonical.y<<b)-i.canonical.y)):(T=r.ag<<-b,M=r.ag*(a.tileID.canonical.x-(i.canonical.x+L<<-b)),O=r.ag*(a.tileID.canonical.y-(i.canonical.y<<-b))),r.ab.mat4.ortho(g,0,T,0,T,0,1),r.ab.mat4.translate(g,g,[M,O,0])}return new sg(a.tileID,i.key,g)}_findTileCoveringTileID(i,a){let p=a.getTile(i);if(p&&p.hasData())return p;const g=this._findCoveringTileCache[a.id],b=g[i.key];if(p=b?a.getTileByID(b):null,p&&p.hasData()||b===null)return p;let T=p?p.tileID:i,M=T.overscaledZ;const O=a.getSource().minzoom,L=[];if(!b){const U=a.getSource().maxzoom;if(i.canonical.z>=U){const j=i.canonical.z-U;a.getSource().reparseOverscaled?(M=Math.max(i.canonical.z+2,a.transform.tileZoom),T=new r.aG(M,i.wrap,U,i.canonical.x>>j,i.canonical.y>>j)):j!==0&&(M=U,T=new r.aG(M,i.wrap,U,i.canonical.x>>j,i.canonical.y>>j))}T.key!==i.key&&(L.push(T.key),p=a.getTile(T))}const k=U=>{L.forEach(j=>{g[j]=U}),L.length=0};for(M-=1;M>=O&&(!p||!p.hasData());M--){p&&k(p.tileID.key);const U=T.calculateScaledKey(M);if(p=a.getTileByID(U),p&&p.hasData())break;const j=g[U];if(j===null)break;j===void 0?L.push(U):p=a.getTileByID(j)}return k(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,a){let p=this._tilesDirty[i];p||(p=this._tilesDirty[i]={}),p[a.key]=!0}}function dw(f,i,a){const p=function(M,O,L){const k=r.ab.vec3.dot(O,M),U=r.ab.vec3.dot(L,[.2126,.7152,.0722]),j=(ce,te,_e)=>(1-_e)*ce+_e*te,Z=j(1-.3*Math.min(U,1),1,Math.min(k+1,1));return j(.92,1,Math.asin(r.aw(O[2],-1,1))/Math.PI+.5)*Z}(f,[0,0,1],i),g=[0,0,0];r.ab.vec3.scale(g,a.slice(0,3),p);const b=[0,0,0];r.ab.vec3.scale(b,i.slice(0,3),f[2]);const T=[0,0,0];return r.ab.vec3.add(T,g,b),r.cf(T)}const fw=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],s1=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class o1{static cacheKey(i,a,p,g){let b=`${a}${g?g.cacheKey:""}`;for(const T of p)i.usedDefines.includes(T)&&(b+=`/${T}`);return b}constructor(i,a,p,g,b,T){const M=i.gl;this.program=M.createProgram(),this.configuration=g,this.name=a,this.fixedDefines=[...T];const O=g?g.getBinderAttributes():[],L=(p.staticAttributes||[]).concat(O);let k=g?g.defines():[];k=k.concat(T.map(_e=>`#define ${_e}`));const U=`#version 300 es
`;let j=U+k.concat("precision mediump float;",zn,Br.fragmentSource).join(`
`);for(const _e of p.fragmentIncludes)j+=`
${Tr[_e]}`;j+=`
${p.fragmentSource}`;let Z=U+k.concat("precision highp float;",zn,Br.vertexSource).join(`
`);for(const _e of p.vertexIncludes)Z+=`
${Tr[_e]}`;this.forceManualRenderingForInstanceIDShaders=i.forceManualRenderingForInstanceIDShaders&&p.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(Z+=`
uniform int u_instanceID;
`),Z+=`
${p.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(Z=Z.replaceAll("gl_InstanceID","u_instanceID"));const ce=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(ce,j),M.compileShader(ce),M.attachShader(this.program,ce);const te=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(te,Z),M.compileShader(te),M.attachShader(this.program,te),this.attributes={},this.numAttributes=L.length;for(let _e=0;_e<this.numAttributes;_e++)if(L[_e]){const me=L[_e].startsWith("a_")?L[_e]:`a_${L[_e]}`;M.bindAttribLocation(this.program,_e,me),this.attributes[me]=_e}M.linkProgram(this.program),M.deleteShader(te),M.deleteShader(ce),this.fixedUniforms=b(i),this.binderUniforms=g?g.getUniforms(i):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(_e=>({u_instanceID:new r.bN(_e)}))(i)),(T.includes("TERRAIN")||a.indexOf("symbol")!==-1||a.indexOf("circle")!==-1)&&(this.terrainUniforms=(_e=>({u_dem:new r.bN(_e),u_dem_prev:new r.bN(_e),u_dem_tl:new r.bK(_e),u_dem_scale:new r.bM(_e),u_dem_tl_prev:new r.bK(_e),u_dem_scale_prev:new r.bM(_e),u_dem_size:new r.bM(_e),u_dem_lerp:new r.bM(_e),u_exaggeration:new r.bM(_e),u_depth:new r.bN(_e),u_depth_size_inv:new r.bK(_e),u_depth_range_unpack:new r.bK(_e),u_occluder_half_size:new r.bM(_e),u_occlusion_depth_offset:new r.bM(_e),u_meter_to_dem:new r.bM(_e),u_label_plane_matrix_inv:new r.bJ(_e)}))(i)),T.includes("GLOBE")&&(this.globeUniforms=(_e=>({u_tile_tl_up:new r.bL(_e),u_tile_tr_up:new r.bL(_e),u_tile_br_up:new r.bL(_e),u_tile_bl_up:new r.bL(_e),u_tile_up_scale:new r.bM(_e)}))(i)),T.includes("FOG")&&(this.fogUniforms=(_e=>({u_fog_matrix:new r.bJ(_e),u_fog_range:new r.bK(_e),u_fog_color:new r.ca(_e),u_fog_horizon_blend:new r.bM(_e),u_fog_vertical_limit:new r.bK(_e),u_fog_temporal_offset:new r.bM(_e),u_frustum_tl:new r.bL(_e),u_frustum_tr:new r.bL(_e),u_frustum_br:new r.bL(_e),u_frustum_bl:new r.bL(_e),u_globe_pos:new r.bL(_e),u_globe_radius:new r.bM(_e),u_globe_transition:new r.bM(_e),u_is_globe:new r.bN(_e),u_viewport:new r.bK(_e)}))(i)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(_e=>({u_cutoff_params:new r.ca(_e)}))(i)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(_e=>({u_lighting_ambient_color:new r.bL(_e),u_lighting_directional_dir:new r.bL(_e),u_lighting_directional_color:new r.bL(_e),u_ground_radiance:new r.bL(_e)}))(i)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(_e=>({u_light_matrix_0:new r.bJ(_e),u_light_matrix_1:new r.bJ(_e),u_fade_range:new r.bK(_e),u_shadow_normal_offset:new r.bL(_e),u_shadow_intensity:new r.bM(_e),u_shadow_texel_size:new r.bM(_e),u_shadow_map_resolution:new r.bM(_e),u_shadow_direction:new r.bL(_e),u_shadow_bias:new r.bL(_e),u_shadowmap_0:new r.bN(_e),u_shadowmap_1:new r.bN(_e)}))(i))}}setTerrainUniformValues(i,a){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const g in a)p[g]&&p[g].set(this.program,g,a[g])}}setGlobeUniformValues(i,a){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const g in a)p[g]&&p[g].set(this.program,g,a[g])}}setFogUniformValues(i,a){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const g in a)p[g].set(this.program,g,a[g])}}setCutoffUniformValues(i,a){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const g in a)p[g].set(this.program,g,a[g])}}setLightsUniformValues(i,a){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const g in a)p[g].set(this.program,g,a[g])}}setShadowUniformValues(i,a){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;i.program.set(this.program);for(const g in a)p[g].set(this.program,g,a[g])}_drawDebugWireframe(i,a,p,g,b,T,M,O,L,k){const U=i.options.wireframe;if(U.terrain===!1&&U.layers2D===!1&&U.layers3D===!1)return;const j=i.context;if(!(()=>!(!U.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!U.layers2D||i._terrain&&i._terrain.renderingToTexture||!fw.includes(this.name))||!(!U.layers3D||!s1.includes(this.name)))())return;const Z=j.gl,ce=i.wireframeDebugCache.getLinesFromTrianglesBuffer(i.frameCounter,b,j);if(!ce)return;const te=[...this.fixedDefines];te.push("DEBUG_WIREFRAME");const _e=i.getOrCreateProgram(this.name,{config:this.configuration,defines:te});j.program.set(_e.program);const me=(Oe,je,Ve)=>{if(je[Oe]&&Ve[Oe])for(const Ue in je[Oe])Ve[Oe][Ue]&&Ve[Oe][Ue].set(Ve.program,Ue,je[Oe][Ue].current)};L&&L.setUniforms(_e.program,j,_e.binderUniforms,M,{zoom:O}),me("fixedUniforms",this,_e),me("terrainUniforms",this,_e),me("globeUniforms",this,_e),me("fogUniforms",this,_e),me("lightsUniforms",this,_e),me("shadowUniforms",this,_e),ce.bind(),j.setColorMode(new gr([Z.ONE,Z.ONE_MINUS_SRC_ALPHA,Z.ZERO,Z.ONE],r.aj.transparent,[!0,!0,!0,!1])),j.setDepthMode(new Ri(a.func===Z.LESS?Z.LEQUAL:a.func,Ri.ReadOnly,a.range)),j.setStencilMode($i.disabled);const Se=3*T.primitiveLength*2,ke=3*T.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const Oe=k||1;for(let je=0;je<Oe;++je)_e.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",je),Z.drawElements(Z.LINES,Se,Z.UNSIGNED_SHORT,ke)}else k&&k>1?Z.drawElementsInstanced(Z.LINES,Se,Z.UNSIGNED_SHORT,ke,k):Z.drawElements(Z.LINES,Se,Z.UNSIGNED_SHORT,ke);b.bind(),j.program.set(this.program),j.setDepthMode(a),j.setStencilMode(p),j.setColorMode(g)}checkUniforms(i,a,p){if(this.fixedDefines.includes(a)){for(const g of Object.keys(p))if(!p[g].initialized)throw new Error(`Program '${this.name}', from draw '${i}': uniform ${g} not set but required by ${a} being defined`)}}draw(i,a,p,g,b,T,M,O,L,k,U,j,Z,ce,te,_e){const me=i.context,Se=me.gl;if(this.failedToCreate)return;me.program.set(this.program),me.setDepthMode(p),me.setStencilMode(g),me.setColorMode(b),me.setCullFace(T);for(const je of Object.keys(this.fixedUniforms))this.fixedUniforms[je].set(this.program,je,M[je]);ce&&ce.setUniforms(this.program,me,this.binderUniforms,j,{zoom:Z});const ke={[Se.POINTS]:1,[Se.LINES]:2,[Se.TRIANGLES]:3,[Se.LINE_STRIP]:1}[a];this.checkUniforms(O,"RENDER_SHADOWS",this.shadowUniforms);const Oe=_e&&_e>0?1:void 0;for(const je of U.get()){const Ve=je.vaos||(je.vaos={});if((Ve[O]||(Ve[O]=new Ti)).bind(me,this,L,ce?ce.getPaintVertexBuffers():[],k,je.vertexOffset,te||[],Oe),this.forceManualRenderingForInstanceIDShaders){const Ue=_e||1;for(let Ne=0;Ne<Ue;++Ne)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ne),k?Se.drawElements(a,je.primitiveLength*ke,Se.UNSIGNED_SHORT,je.primitiveOffset*ke*2):Se.drawArrays(a,je.vertexOffset,je.vertexLength)}else _e&&_e>1?Se.drawElementsInstanced(a,je.primitiveLength*ke,Se.UNSIGNED_SHORT,je.primitiveOffset*ke*2,_e):k?Se.drawElements(a,je.primitiveLength*ke,Se.UNSIGNED_SHORT,je.primitiveOffset*ke*2):Se.drawArrays(a,je.vertexOffset,je.vertexLength);a===Se.TRIANGLES&&k&&this._drawDebugWireframe(i,p,g,b,k,je,j,Z,ce,_e)}}}function jp(f,i){const a=Math.pow(2,i.tileID.overscaledZ),p=i.tileSize*Math.pow(2,f.transform.tileZoom)/a,g=p*(i.tileID.canonical.x+i.tileID.wrap*a),b=p*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.ar(i,1,f.transform.tileZoom),u_pixel_coord_upper:[g>>16,b>>16],u_pixel_coord_lower:[65535&g,65535&b]}}const Th={terrain:0,flat:1},Eh=r.ab.mat4.create(),$p=(f,i,a,p,g,b,T,M,O,L,k,U,j,Z,ce,te,_e,me)=>{const Se=i.style.light,ke=Se.properties.get("position"),Oe=[ke.x,ke.y,ke.z],je=r.ab.mat3.create();Se.properties.get("anchor")==="viewport"&&(r.ab.mat3.fromRotation(je,-i.transform.angle),r.ab.vec3.transformMat3(Oe,Oe,je));const Ve=Se.properties.get("color"),Ue=i.transform,Ne={u_matrix:f,u_lightpos:Oe,u_lightintensity:Se.properties.get("intensity"),u_lightcolor:[Ve.r,Ve.g,Ve.b],u_vertical_gradient:+a,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Eh,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Th[L],u_base_type:Th[k],u_ao:g,u_edge_radius:b,u_width_scale:T,u_flood_light_color:ce,u_vertical_scale:te,u_flood_light_intensity:_e,u_ground_shadow_factor:me};return Ue.projection.name==="globe"&&(Ne.u_tile_id=[M.canonical.x,M.canonical.y,1<<M.canonical.z],Ne.u_zoom_transition=U,Ne.u_inv_rot_matrix=Z,Ne.u_merc_center=j,Ne.u_up_dir=Ue.projection.upVector(new r.bT(0,0,0),j[0]*r.ag,j[1]*r.ag),Ne.u_height_lift=O),Ne},rf=(f,i,a,p,g,b)=>({u_matrix:f,u_edge_radius:i,u_width_scale:a,u_vertical_scale:p,u_height_type:Th[g],u_base_type:Th[b]}),a1=(f,i,a,p,g,b,T,M,O,L,k,U,j,Z,ce,te,_e)=>{const me=$p(f,i,a,p,g,b,T,M,L,k,U,j,Z,ce,te,_e,1,[0,0,0]),Se={u_height_factor:-Math.pow(2,M.overscaledZ)/O.tileSize/8};return r.l(me,jp(i,O),Se)},nf=(f,i)=>({u_matrix:f,u_emissive_strength:i}),sf=(f,i,a,p)=>r.l(nf(f,i),jp(a,p)),og=(f,i,a)=>({u_matrix:f,u_world:a,u_emissive_strength:i}),l1=(f,i,a,p,g)=>r.l(sf(f,i,a,p),{u_world:g}),pw=(f,i,a,p)=>{const g=r.ag/a.tileSize;return{u_matrix:f,u_camera_to_center_distance:i.getCameraToCenterDistance(p),u_extrude_scale:[i.pixelsToGLUnits[0]/g,i.pixelsToGLUnits[1]/g]}},Au=(f,i,a=1)=>({u_matrix:f,u_color:i.toRenderColor(null),u_overlay:0,u_overlay_scale:a}),qp=r.ab.mat4.create(),gi=(f,i,a,p,g,b,T)=>{const M=f.transform,O=M.projection.name==="globe",L=O?r.cN(M.zoom,i.canonical)*M._pixelsPerMercatorPixel:r.ar(a,1,b),k={u_matrix:i.projMatrix,u_extrude_scale:L,u_intensity:T,u_inv_rot_matrix:qp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(O){k.u_inv_rot_matrix=p,k.u_merc_center=g,k.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],k.u_zoom_transition=r.ae(M.zoom);const U=g[0]*r.ag,j=g[1]*r.ag;k.u_up_dir=M.projection.upVector(new r.bT(0,0,0),U,j)}return k};function ag(f,[i,a,p,g],[b,T]){if(b===T)return[0,0,0,0];const M=255*(f-1)/(f*(T-b));return[i*M,a*M,p*M,g*M]}function lg(f,i,[a,p]){return a===p?0:.5/f+(i-a)*(f-1)/(f*(p-a))}const Uc=(f,i,a,p,g,b,T,M,O,L,k,U,j,Z,ce,te,_e,me,Se,ke,Oe)=>({u_matrix:f,u_normalize_matrix:i,u_globe_matrix:a,u_merc_matrix:p,u_grid_matrix:g,u_tl_parent:b,u_scale_parent:L,u_fade_t:k.mix,u_opacity:k.opacity*U.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:U.paint.get("raster-brightness-min"),u_brightness_high:U.paint.get("raster-brightness-max"),u_saturation_factor:r.cO(U.paint.get("raster-saturation")),u_contrast_factor:r.cP(U.paint.get("raster-contrast")),u_spin_weights:Cu(U.paint.get("raster-hue-rotate")),u_perspective_transform:j,u_raster_elevation:Z,u_zoom_transition:T,u_merc_center:M,u_cutoff_params:O,u_colorization_mix:ag(r.cQ,te,me),u_colorization_offset:lg(r.cQ,_e,me),u_color_ramp:ce,u_texture_offset:[ke/(Se+2*ke),Se/(Se+2*ke)],u_texture_res:[Se+2*ke,Se+2*ke],u_emissive_strength:Oe});function Cu(f){f*=Math.PI/180;const i=Math.sin(f),a=Math.cos(f);return[(2*a+1)/3,(-Math.sqrt(3)*i-a+1)/3,(Math.sqrt(3)*i-a+1)/3]}const Si=.05,cg=(f,i,a,p,g,b,T,M,O,L,k,U)=>({u_matrix:f,u_normalize_matrix:i,u_globe_matrix:a,u_merc_matrix:p,u_grid_matrix:g,u_tl_parent:b,u_scale_parent:L,u_fade_t:k.mix,u_opacity:k.opacity,u_image0:0,u_image1:1,u_raster_elevation:U,u_zoom_transition:T,u_merc_center:M,u_cutoff_params:O}),mw=(f,i,a,p,g,b,T,M,O,L)=>({u_particle_texture:f,u_particle_texture_side_len:i,u_tile_offset:a,u_velocity:p,u_color_ramp:b,u_velocity_res:g,u_max_speed:T,u_uv_offset:M,u_data_scale:[255*O[0],255*O[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Si,Si]}),_w=(f,i,a,p,g,b,T,M,O,L)=>({u_particle_texture:f,u_particle_texture_side_len:i,u_velocity:a,u_velocity_res:p,u_max_speed:g,u_speed_factor:b,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:M,u_data_scale:[255*O[0],255*O[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Si,Si]}),Hp=r.ab.mat4.create(),ug=(f,i,a,p,g,b,T,M,O,L,k,U,j,Z,ce,te,_e,me,Se,ke,Oe,je)=>{const Ve=g.transform,Ue={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:Ve.getCameraToCenterDistance(Se),u_rotate_symbol:+a,u_aspect_ratio:Ve.width/Ve.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:T,u_coord_matrix:M,u_is_text:+L,u_elevation_from_sea:O?1:0,u_pitch_with_map:+p,u_texsize:k,u_texsize_icon:U,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Hp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Hp,u_up_vector:[0,-1,0],u_color_adj_mat:ke,u_icon_transition:Oe||0,u_gamma_scale:p?g.transform.getCameraToCenterDistance(Se)*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:r.q.devicePixelRatio,u_is_halo:+j,u_scale_factor:je||1};return Se.name==="globe"&&(Ue.u_tile_id=[Z.canonical.x,Z.canonical.y,1<<Z.canonical.z],Ue.u_zoom_transition=ce,Ue.u_inv_rot_matrix=_e,Ue.u_merc_center=te,Ue.u_camera_forward=Ve._camera.forward(),Ue.u_ecef_origin=r.cR(Ve.globeMatrix,Z.toUnwrapped()),Ue.u_tile_matrix=Float32Array.from(Ve.globeMatrix),Ue.u_up_vector=me),Ue},hg=(f,i,a,p)=>({u_matrix:f,u_emissive_strength:i,u_opacity:a,u_color:p}),c1=(f,i,a,p,g,b,T,M,O)=>r.l(function(L,k,U,j,Z,ce){const{width:te,height:_e}=j.imageManager.getPixelSize(k),me=Math.pow(2,ce.tileID.overscaledZ),Se=ce.tileSize*Math.pow(2,j.transform.tileZoom)/me,ke=Se*(ce.tileID.canonical.x+ce.tileID.wrap*me),Oe=Se*ce.tileID.canonical.y;return{u_image:0,u_pattern_tl:U.tl,u_pattern_br:U.br,u_texsize:[te,_e],u_pattern_size:U.displaySize,u_pattern_units_to_pixels:Z?[j.transform.width,-1*j.transform.height]:[1/r.ar(ce,1,j.transform.tileZoom),1/r.ar(ce,1,j.transform.tileZoom)],u_pixel_coord_upper:[ke>>16,Oe>>16],u_pixel_coord_lower:[65535&ke,65535&Oe]}}(0,b,T,p,M,O),{u_matrix:f,u_emissive_strength:i,u_opacity:a}),dg=new Float32Array(r.ab.mat4.identity([])),of=(f,i,a,p,g,b,T,M,O,L,k,U,j,Z=[0,0,0],ce)=>{const te=g.style.light,_e=te.properties.get("position"),me=[-_e.x,-_e.y,_e.z],Se=r.ab.mat3.create();te.properties.get("anchor")==="viewport"&&(r.ab.mat3.fromRotation(Se,-g.transform.angle),r.ab.vec3.transformMat3(me,me,Se));const ke=k.alphaMode==="MASK",Oe=te.properties.get("color").toRenderColor(null),je=j.paint.get("model-ambient-occlusion-intensity"),Ve=j.paint.get("model-color").constantOr(r.aj.white).toRenderColor(null),Ue=j.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:f,u_lighting_matrix:i,u_normal_matrix:a,u_node_matrix:p||dg,u_lightpos:me,u_lightintensity:te.properties.get("intensity"),u_lightcolor:[Oe.r,Oe.g,Oe.b],u_camera_pos:Z,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+ke,u_alphaCutoff:k.alphaCutoff,u_baseColorFactor:[T.r,T.g,T.b,T.a],u_emissiveFactor:[M[0],M[1],M[2],1],u_metallicFactor:O,u_roughnessFactor:L,u_baseColorTexture:Wr.BaseColor,u_metallicRoughnessTexture:Wr.MetallicRoughness,u_normalTexture:Wr.Normal,u_occlusionTexture:Wr.Occlusion,u_emissionTexture:Wr.Emission,u_lutTexture:Wr.LUT,u_color_mix:[Ve.r,Ve.g,Ve.b,Ue],u_aoIntensity:je,u_emissive_strength:U,u_occlusionTextureTransform:ce||[0,0,0,0]}},Gp=(f,i=dg,a=dg)=>({u_matrix:f,u_instance:i,u_node_matrix:a}),fg={fillExtrusion:f=>({u_matrix:new r.bJ(f),u_lightpos:new r.bL(f),u_lightintensity:new r.bM(f),u_lightcolor:new r.bL(f),u_vertical_gradient:new r.bM(f),u_opacity:new r.bM(f),u_edge_radius:new r.bM(f),u_width_scale:new r.bM(f),u_ao:new r.bK(f),u_height_type:new r.bN(f),u_base_type:new r.bN(f),u_tile_id:new r.bL(f),u_zoom_transition:new r.bM(f),u_inv_rot_matrix:new r.bJ(f),u_merc_center:new r.bK(f),u_up_dir:new r.bL(f),u_height_lift:new r.bM(f),u_flood_light_color:new r.bL(f),u_vertical_scale:new r.bM(f),u_flood_light_intensity:new r.bM(f),u_ground_shadow_factor:new r.bL(f)}),fillExtrusionDepth:f=>({u_matrix:new r.bJ(f),u_edge_radius:new r.bM(f),u_width_scale:new r.bM(f),u_vertical_scale:new r.bM(f),u_height_type:new r.bN(f),u_base_type:new r.bN(f)}),fillExtrusionPattern:f=>({u_matrix:new r.bJ(f),u_lightpos:new r.bL(f),u_lightintensity:new r.bM(f),u_lightcolor:new r.bL(f),u_vertical_gradient:new r.bM(f),u_height_factor:new r.bM(f),u_edge_radius:new r.bM(f),u_width_scale:new r.bM(f),u_ao:new r.bK(f),u_height_type:new r.bN(f),u_base_type:new r.bN(f),u_tile_id:new r.bL(f),u_zoom_transition:new r.bM(f),u_inv_rot_matrix:new r.bJ(f),u_merc_center:new r.bK(f),u_up_dir:new r.bL(f),u_height_lift:new r.bM(f),u_image:new r.bN(f),u_texsize:new r.bK(f),u_pixel_coord_upper:new r.bK(f),u_pixel_coord_lower:new r.bK(f),u_tile_units_to_pixels:new r.bM(f),u_opacity:new r.bM(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new r.bJ(f),u_opacity:new r.bM(f),u_ao_pass:new r.bM(f),u_meter_to_tile:new r.bM(f),u_ao:new r.bK(f),u_flood_light_intensity:new r.bM(f),u_flood_light_color:new r.bL(f),u_attenuation:new r.bM(f),u_edge_radius:new r.bM(f),u_fb:new r.bN(f),u_fb_size:new r.bM(f),u_dynamic_offset:new r.bM(f)}),fill:f=>({u_matrix:new r.bJ(f),u_emissive_strength:new r.bM(f)}),fillPattern:f=>({u_matrix:new r.bJ(f),u_emissive_strength:new r.bM(f),u_image:new r.bN(f),u_texsize:new r.bK(f),u_pixel_coord_upper:new r.bK(f),u_pixel_coord_lower:new r.bK(f),u_tile_units_to_pixels:new r.bM(f)}),fillOutline:f=>({u_matrix:new r.bJ(f),u_emissive_strength:new r.bM(f),u_world:new r.bK(f)}),fillOutlinePattern:f=>({u_matrix:new r.bJ(f),u_emissive_strength:new r.bM(f),u_world:new r.bK(f),u_image:new r.bN(f),u_texsize:new r.bK(f),u_pixel_coord_upper:new r.bK(f),u_pixel_coord_lower:new r.bK(f),u_tile_units_to_pixels:new r.bM(f)}),circle:r.cS,collisionBox:f=>({u_matrix:new r.bJ(f),u_camera_to_center_distance:new r.bM(f),u_extrude_scale:new r.bK(f)}),collisionCircle:f=>({u_matrix:new r.bJ(f),u_inv_matrix:new r.bJ(f),u_camera_to_center_distance:new r.bM(f),u_viewport_size:new r.bK(f)}),debug:f=>({u_color:new r.cz(f),u_matrix:new r.bJ(f),u_overlay:new r.bN(f),u_overlay_scale:new r.bM(f)}),clippingMask:f=>({u_matrix:new r.bJ(f)}),heatmap:f=>({u_extrude_scale:new r.bM(f),u_intensity:new r.bM(f),u_matrix:new r.bJ(f),u_inv_rot_matrix:new r.bJ(f),u_merc_center:new r.bK(f),u_tile_id:new r.bL(f),u_zoom_transition:new r.bM(f),u_up_dir:new r.bL(f)}),heatmapTexture:f=>({u_image:new r.bN(f),u_color_ramp:new r.bN(f),u_opacity:new r.bM(f)}),hillshade:f=>({u_matrix:new r.bJ(f),u_image:new r.bN(f),u_latrange:new r.bK(f),u_light:new r.bK(f),u_shadow:new r.cz(f),u_highlight:new r.cz(f),u_emissive_strength:new r.bM(f),u_accent:new r.cz(f)}),hillshadePrepare:f=>({u_matrix:new r.bJ(f),u_image:new r.bN(f),u_dimension:new r.bK(f),u_zoom:new r.bM(f)}),line:r.cT,linePattern:r.cU,raster:f=>({u_matrix:new r.bJ(f),u_normalize_matrix:new r.bJ(f),u_globe_matrix:new r.bJ(f),u_merc_matrix:new r.bJ(f),u_grid_matrix:new r.cA(f),u_tl_parent:new r.bK(f),u_scale_parent:new r.bM(f),u_fade_t:new r.bM(f),u_opacity:new r.bM(f),u_image0:new r.bN(f),u_image1:new r.bN(f),u_brightness_low:new r.bM(f),u_brightness_high:new r.bM(f),u_saturation_factor:new r.bM(f),u_contrast_factor:new r.bM(f),u_spin_weights:new r.bL(f),u_perspective_transform:new r.bK(f),u_raster_elevation:new r.bM(f),u_zoom_transition:new r.bM(f),u_merc_center:new r.bK(f),u_cutoff_params:new r.ca(f),u_colorization_mix:new r.ca(f),u_colorization_offset:new r.bM(f),u_color_ramp:new r.bN(f),u_texture_offset:new r.bK(f),u_texture_res:new r.bK(f),u_emissive_strength:new r.bM(f)}),rasterParticle:f=>({u_matrix:new r.bJ(f),u_normalize_matrix:new r.bJ(f),u_globe_matrix:new r.bJ(f),u_merc_matrix:new r.bJ(f),u_grid_matrix:new r.cA(f),u_tl_parent:new r.bK(f),u_scale_parent:new r.bM(f),u_fade_t:new r.bM(f),u_opacity:new r.bM(f),u_image0:new r.bN(f),u_image1:new r.bN(f),u_raster_elevation:new r.bM(f),u_zoom_transition:new r.bM(f),u_merc_center:new r.bK(f),u_cutoff_params:new r.ca(f)}),rasterParticleTexture:f=>({u_texture:new r.bN(f),u_opacity:new r.bM(f)}),rasterParticleDraw:f=>({u_particle_texture:new r.bN(f),u_particle_texture_side_len:new r.bM(f),u_tile_offset:new r.bK(f),u_velocity:new r.bN(f),u_color_ramp:new r.bN(f),u_velocity_res:new r.bK(f),u_max_speed:new r.bM(f),u_uv_offset:new r.bK(f),u_data_scale:new r.bK(f),u_data_offset:new r.bM(f),u_particle_pos_scale:new r.bM(f),u_particle_pos_offset:new r.bK(f)}),rasterParticleUpdate:f=>({u_particle_texture:new r.bN(f),u_particle_texture_side_len:new r.bM(f),u_velocity:new r.bN(f),u_velocity_res:new r.bK(f),u_max_speed:new r.bM(f),u_speed_factor:new r.bM(f),u_reset_rate:new r.bM(f),u_rand_seed:new r.bM(f),u_uv_offset:new r.bK(f),u_data_scale:new r.bK(f),u_data_offset:new r.bM(f),u_particle_pos_scale:new r.bM(f),u_particle_pos_offset:new r.bK(f)}),symbol:f=>({u_is_size_zoom_constant:new r.bN(f),u_is_size_feature_constant:new r.bN(f),u_size_t:new r.bM(f),u_size:new r.bM(f),u_camera_to_center_distance:new r.bM(f),u_rotate_symbol:new r.bN(f),u_aspect_ratio:new r.bM(f),u_fade_change:new r.bM(f),u_matrix:new r.bJ(f),u_label_plane_matrix:new r.bJ(f),u_coord_matrix:new r.bJ(f),u_is_text:new r.bN(f),u_elevation_from_sea:new r.bN(f),u_pitch_with_map:new r.bN(f),u_texsize:new r.bK(f),u_texsize_icon:new r.bK(f),u_texture:new r.bN(f),u_texture_icon:new r.bN(f),u_gamma_scale:new r.bM(f),u_device_pixel_ratio:new r.bM(f),u_tile_id:new r.bL(f),u_zoom_transition:new r.bM(f),u_inv_rot_matrix:new r.bJ(f),u_merc_center:new r.bK(f),u_camera_forward:new r.bL(f),u_tile_matrix:new r.bJ(f),u_up_vector:new r.bL(f),u_ecef_origin:new r.bL(f),u_is_halo:new r.bN(f),u_icon_transition:new r.bM(f),u_color_adj_mat:new r.bJ(f),u_scale_factor:new r.bM(f)}),background:f=>({u_matrix:new r.bJ(f),u_emissive_strength:new r.bM(f),u_opacity:new r.bM(f),u_color:new r.cz(f)}),backgroundPattern:f=>({u_matrix:new r.bJ(f),u_emissive_strength:new r.bM(f),u_opacity:new r.bM(f),u_image:new r.bN(f),u_pattern_tl:new r.bK(f),u_pattern_br:new r.bK(f),u_texsize:new r.bK(f),u_pattern_size:new r.bK(f),u_pixel_coord_upper:new r.bK(f),u_pixel_coord_lower:new r.bK(f),u_pattern_units_to_pixels:new r.bK(f)}),terrainRaster:f=>({u_matrix:new r.bJ(f),u_image0:new r.bN(f),u_skirt_height:new r.bM(f),u_ground_shadow_factor:new r.bL(f)}),skybox:f=>({u_matrix:new r.bJ(f),u_sun_direction:new r.bL(f),u_cubemap:new r.bN(f),u_opacity:new r.bM(f),u_temporal_offset:new r.bM(f)}),skyboxGradient:f=>({u_matrix:new r.bJ(f),u_color_ramp:new r.bN(f),u_center_direction:new r.bL(f),u_radius:new r.bM(f),u_opacity:new r.bM(f),u_temporal_offset:new r.bM(f)}),skyboxCapture:f=>({u_matrix_3f:new r.cA(f),u_sun_direction:new r.bL(f),u_sun_intensity:new r.bM(f),u_color_tint_r:new r.ca(f),u_color_tint_m:new r.ca(f),u_luminance:new r.bM(f)}),globeRaster:f=>({u_proj_matrix:new r.bJ(f),u_globe_matrix:new r.bJ(f),u_normalize_matrix:new r.bJ(f),u_merc_matrix:new r.bJ(f),u_zoom_transition:new r.bM(f),u_merc_center:new r.bK(f),u_image0:new r.bN(f),u_grid_matrix:new r.cA(f),u_skirt_height:new r.bM(f),u_far_z_cutoff:new r.bM(f),u_frustum_tl:new r.bL(f),u_frustum_tr:new r.bL(f),u_frustum_br:new r.bL(f),u_frustum_bl:new r.bL(f),u_globe_pos:new r.bL(f),u_globe_radius:new r.bM(f),u_viewport:new r.bK(f)}),globeAtmosphere:f=>({u_frustum_tl:new r.bL(f),u_frustum_tr:new r.bL(f),u_frustum_br:new r.bL(f),u_frustum_bl:new r.bL(f),u_horizon:new r.bM(f),u_transition:new r.bM(f),u_fadeout_range:new r.bM(f),u_color:new r.ca(f),u_high_color:new r.ca(f),u_space_color:new r.ca(f),u_temporal_offset:new r.bM(f),u_horizon_angle:new r.bM(f)}),model:f=>({u_matrix:new r.bJ(f),u_lighting_matrix:new r.bJ(f),u_normal_matrix:new r.bJ(f),u_node_matrix:new r.bJ(f),u_lightpos:new r.bL(f),u_lightintensity:new r.bM(f),u_lightcolor:new r.bL(f),u_camera_pos:new r.bL(f),u_opacity:new r.bM(f),u_baseColorFactor:new r.ca(f),u_emissiveFactor:new r.ca(f),u_metallicFactor:new r.bM(f),u_roughnessFactor:new r.bM(f),u_baseTextureIsAlpha:new r.bN(f),u_alphaMask:new r.bN(f),u_alphaCutoff:new r.bM(f),u_baseColorTexture:new r.bN(f),u_metallicRoughnessTexture:new r.bN(f),u_normalTexture:new r.bN(f),u_occlusionTexture:new r.bN(f),u_emissionTexture:new r.bN(f),u_lutTexture:new r.bN(f),u_color_mix:new r.ca(f),u_aoIntensity:new r.bM(f),u_emissive_strength:new r.bM(f),u_occlusionTextureTransform:new r.ca(f)}),modelDepth:f=>({u_matrix:new r.bJ(f),u_instance:new r.bJ(f),u_node_matrix:new r.bJ(f)}),groundShadow:f=>({u_matrix:new r.bJ(f),u_ground_shadow_factor:new r.bL(f)}),stars:f=>({u_matrix:new r.bJ(f),u_up:new r.bL(f),u_right:new r.bL(f),u_intensity_multiplier:new r.bM(f)}),snowParticle:f=>({u_modelview:new r.bJ(f),u_projection:new r.bJ(f),u_time:new r.bM(f),u_cam_pos:new r.bL(f),u_velocityConeAperture:new r.bM(f),u_velocity:new r.bM(f),u_horizontalOscillationRadius:new r.bM(f),u_horizontalOscillationRate:new r.bM(f),u_boxSize:new r.bM(f),u_billboardSize:new r.bM(f),u_simpleShapeParameters:new r.bK(f),u_screenSize:new r.bK(f),u_thinningCenterPos:new r.bK(f),u_thinningShape:new r.bL(f),u_thinningAffectedRatio:new r.bM(f),u_thinningParticleOffset:new r.bM(f),u_particleColor:new r.ca(f),u_direction:new r.bL(f)}),rainParticle:f=>({u_modelview:new r.bJ(f),u_projection:new r.bJ(f),u_time:new r.bM(f),u_cam_pos:new r.bL(f),u_texScreen:new r.bN(f),u_velocityConeAperture:new r.bM(f),u_velocity:new r.bM(f),u_boxSize:new r.bM(f),u_rainDropletSize:new r.bK(f),u_distortionStrength:new r.bM(f),u_rainDirection:new r.bL(f),u_color:new r.ca(f),u_screenSize:new r.bK(f),u_thinningCenterPos:new r.bK(f),u_thinningShape:new r.bL(f),u_thinningAffectedRatio:new r.bM(f),u_thinningParticleOffset:new r.bM(f),u_shapeDirectionalPower:new r.bM(f),u_shapeNormalPower:new r.bM(f),u_mode:new r.bM(f)}),vignette:f=>({u_vignetteShape:new r.bL(f),u_vignetteColor:new r.ca(f)}),occlusion:f=>({u_matrix:new r.bJ(f),u_anchorPos:new r.bL(f),u_screenSizePx:new r.bK(f),u_occluderSizePx:new r.bK(f),u_color:new r.ca(f)})};class Ol{constructor(i,a,p,g){this.id=Ol.uniqueIdxCounter,Ol.uniqueIdxCounter++,this.context=i;const b=i.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||g||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){this.id=Ol.uniqueIdxCounter,Ol.uniqueIdxCounter++;const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Ol.uniqueIdxCounter=0;const Uo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class jc{constructor(i,a,p,g,b,T){this.length=a.length,this.attributes=p,this.itemSize=a.bytesPerElement,this.dynamicDraw=g,this.instanceCount=T,this.context=i;const M=i.gl;this.buffer=M.createBuffer(),i.bindVertexBuffer.set(this.buffer),M.bufferData(M.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||b||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,a){for(let p=0;p<this.attributes.length;p++){const g=a.attributes[this.attributes[p].name];g!==void 0&&i.enableVertexAttribArray(g)}}setVertexAttribPointers(i,a,p){for(let g=0;g<this.attributes.length;g++){const b=this.attributes[g],T=a.attributes[b.name];T!==void 0&&i.vertexAttribPointer(T,b.components,i[Uo[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(i,a,p){for(let g=0;g<this.attributes.length;g++){const b=a.attributes[this.attributes[g].name];b!==void 0&&this.instanceCount&&this.instanceCount>0&&i.vertexAttribDivisor(b,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class pg{constructor(i,a,p,g,b){this.context=i,this.width=a,this.height=p;const T=this.framebuffer=i.gl.createFramebuffer();g&&(this.colorAttachment=new bh(i,T)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new tg(i,T):new i1(i,T))}destroy(){const i=this.context.gl;if(this.colorAttachment){const a=this.colorAttachment.get();a&&i.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const a=this.depthAttachment.get();a&&i.deleteRenderbuffer(a)}else{const a=this.depthAttachment.get();a&&i.deleteTexture(a)}i.deleteFramebuffer(this.framebuffer)}}class mg{constructor(i,a){this.gl=i,this.clearColor=new yh(this),this.clearDepth=new vh(this),this.clearStencil=new G_(this),this.colorMask=new W_(this),this.depthMask=new K0(this),this.stencilMask=new J0(this),this.stencilFunc=new nw(this),this.stencilOp=new Jd(this),this.stencilTest=new Qd(this),this.depthRange=new Q0(this),this.depthTest=new Vo(this),this.depthFunc=new Z_(this),this.blend=new kp(this),this.blendFunc=new zp(this),this.blendColor=new Y_(this),this.blendEquation=new X_(this),this.cullFace=new Fp(this),this.cullFaceSide=new K_(this),this.frontFace=new J_(this),this.program=new Bp(this),this.activeTexture=new e1(this),this.viewport=new t1(this),this.bindFramebuffer=new xh(this),this.bindRenderbuffer=new sw(this),this.bindTexture=new ow(this),this.bindVertexBuffer=new aw(this),this.bindElementBuffer=new lw(this),this.bindVertexArrayOES=new cw(this),this.pixelStoreUnpack=new uw(this),this.pixelStoreUnpackPremultiplyAlpha=new Q_(this),this.pixelStoreUnpackFlipY=new eg(this),this.options=a?Object.assign({},a):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=a&&!!a.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=i.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.maxPointSize=i.getParameter(i.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,a,p){return new Ol(this,i,a,p)}createVertexBuffer(i,a,p,g,b){return new jc(this,i,a,p,g,b)}createRenderbuffer(i,a,p){const g=this.gl,b=g.createRenderbuffer();return this.bindRenderbuffer.set(b),g.renderbufferStorage(g.RENDERBUFFER,i,a,p),this.bindRenderbuffer.set(null),b}createFramebuffer(i,a,p,g){return new pg(this,i,a,p,g)}clear({color:i,depth:a,stencil:p,colorMask:g}){const b=this.gl;let T=0;i&&(T|=b.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set(g||[!0,!0,!0,!0])),a!==void 0&&(T|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),p!==void 0&&(T|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),b.clear(T)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){r.bn(i.blendFunction,gr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor),i.blendEquation?this.blendEquation.set(i.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(i.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Sh;function Wp(f,i,a,p,g,b,T){const M=f.context,O=M.gl,L=f.transform,k=f.getOrCreateProgram("collisionBox"),U=[];let j=0,Z=0;for(let Oe=0;Oe<p.length;Oe++){const je=p[Oe],Ve=i.getTile(je),Ue=Ve.getBucket(a);if(!Ue)continue;const Ne=sa(je,Ue,L);let Ye=Ne;g[0]===0&&g[1]===0||(Ye=f.translatePosMatrix(Ne,Ve,g,b));const it=T?Ue.textCollisionBox:Ue.iconCollisionBox,xt=Ue.collisionCircleArray;if(xt.length>0){const _t=r.ab.mat4.create(),Rt=Ye;r.ab.mat4.mul(_t,Ue.placementInvProjMatrix,L.glCoordMatrix),r.ab.mat4.mul(_t,_t,Ue.placementViewportMatrix),U.push({circleArray:xt,circleOffset:Z,transform:Rt,invTransform:_t,projection:Ue.getProjection()}),j+=xt.length/4,Z=j}it&&(f.terrain&&f.terrain.setupElevationDraw(Ve,k),k.draw(f,O.LINES,Ri.disabled,$i.disabled,f.colorModeForRenderPass(),Fi.disabled,pw(Ye,L,Ve,Ue.getProjection()),a.id,it.layoutVertexBuffer,it.indexBuffer,it.segments,null,L.zoom,null,[it.collisionVertexBuffer,it.collisionVertexBufferExt]))}if(!T||!U.length)return;const ce=f.getOrCreateProgram("collisionCircle"),te=new r.cV;te.resize(4*j),te._trim();let _e=0;for(const Oe of U)for(let je=0;je<Oe.circleArray.length/4;je++){const Ve=4*je,Ue=Oe.circleArray[Ve+0],Ne=Oe.circleArray[Ve+1],Ye=Oe.circleArray[Ve+2],it=Oe.circleArray[Ve+3];te.emplace(_e++,Ue,Ne,Ye,it,0),te.emplace(_e++,Ue,Ne,Ye,it,1),te.emplace(_e++,Ue,Ne,Ye,it,2),te.emplace(_e++,Ue,Ne,Ye,it,3)}(!Sh||Sh.length<2*j)&&(Sh=function(Oe){const je=2*Oe,Ve=new r.aU;Ve.resize(je),Ve._trim();for(let Ue=0;Ue<je;Ue++){const Ne=6*Ue;Ve.uint16[Ne+0]=4*Ue+0,Ve.uint16[Ne+1]=4*Ue+1,Ve.uint16[Ne+2]=4*Ue+2,Ve.uint16[Ne+3]=4*Ue+2,Ve.uint16[Ne+4]=4*Ue+3,Ve.uint16[Ne+5]=4*Ue+0}return Ve}(j));const me=M.createIndexBuffer(Sh,!0),Se=M.createVertexBuffer(te,r.cW.members,!0);for(const Oe of U){const je={u_matrix:Oe.transform,u_inv_matrix:Oe.invTransform,u_camera_to_center_distance:(ke=L).getCameraToCenterDistance(Oe.projection),u_viewport_size:[ke.width,ke.height]};ce.draw(f,O.TRIANGLES,Ri.disabled,$i.disabled,f.colorModeForRenderPass(),Fi.disabled,je,a.id,Se,me,r.b7.simpleSegment(0,2*Oe.circleOffset,Oe.circleArray.length,Oe.circleArray.length/2),null,L.zoom)}var ke;Se.destroy(),me.destroy()}const af=r.ab.mat4.create();function la(f){const i=f._camera.getWorldToCamera(f.worldSize,1),a=r.ab.mat4.multiply([],i,f.globeMatrix);r.ab.mat4.invert(a,a);const p=[0,0,0],g=[0,1,0,0];return r.ab.vec4.transformMat4(g,g,a),p[0]=g[0],p[1]=g[1],p[2]=g[2],r.ab.vec3.normalize(p,p),p}function bn({width:f,height:i,anchor:a,textOffset:p,textScale:g},b){const{horizontalAlign:T,verticalAlign:M}=r.bD(a),O=-(T-.5)*f,L=-(M-.5)*i,k=r.bC(a,p);return new r.P((O/g+k[0])*b,(L/g+k[1])*b)}function Zp(f,i,a,p,g,b,T,M,O,L,k){const U=f.text.placedSymbolArray,j=f.text.dynamicLayoutVertexArray,Z=f.icon.dynamicLayoutVertexArray,ce={},te=f.getProjection(),_e=ac(M,te,b),me=b.elevation,Se=te.upVectorScale(M.canonical,b.center.lat,b.worldSize).metersToTile;j.clear();for(let ke=0;ke<U.length;ke++){const Oe=U.get(ke),{tileAnchorX:je,tileAnchorY:Ve,numGlyphs:Ue}=Oe,Ne=Oe.hidden||!Oe.crossTileID||f.allowVerticalPlacement&&!Oe.placedOrientation?null:p[Oe.crossTileID];if(Ne){let Ye=0,it=0,xt=0;if(me){const wt=me?me.getAtTileOffset(M,je,Ve):0,[Qt,kt,Dt]=te.upVector(M.canonical,je,Ve);Ye=wt*Qt*Se,it=wt*kt*Se,xt=wt*Dt*Se}let[_t,Rt,Pt,ht]=Zs(Oe.projectedAnchorX+Ye,Oe.projectedAnchorY+it,Oe.projectedAnchorZ+xt,a?_e:T);const bt=hh(b.getCameraToCenterDistance(te),ht);let Vt=g.evaluateSizeForFeature(f.textSizeData,L,Oe)*bt/r.bw;a&&(Vt*=f.tilePixelRatio/O);const ut=bn(Ne,Vt);a?({x:_t,y:Rt,z:Pt}=te.projectTilePoint(je+ut.x,Ve+ut.y,M.canonical),[_t,Rt,Pt]=Zs(_t+Ye,Rt+it,Pt+xt,T)):(i&&ut._rotate(-b.angle),_t+=ut.x,Rt+=ut.y,Pt=0);const Ot=f.allowVerticalPlacement&&Oe.placedOrientation===r.bq.vertical?Math.PI/2:0;for(let wt=0;wt<Ue;wt++)r.bt(j,_t,Rt,Pt,Ot);k&&Oe.associatedIconIndex>=0&&(ce[Oe.associatedIconIndex]={x:_t,y:Rt,z:Pt,angle:Ot})}else kn(Ue,j)}if(k){Z.clear();const ke=f.icon.placedSymbolArray;for(let Oe=0;Oe<ke.length;Oe++){const je=ke.get(Oe),{numGlyphs:Ve}=je,Ue=ce[Oe];if(je.hidden||!Ue)kn(Ve,Z);else{const{x:Ne,y:Ye,z:it,angle:xt}=Ue;for(let _t=0;_t<Ve;_t++)r.bt(Z,Ne,Ye,it,xt)}}f.icon.dynamicLayoutVertexBuffer.updateData(Z)}f.text.dynamicLayoutVertexBuffer.updateData(j)}function lf(f,i,a,p,g,b,T={}){const M=a.paint.get("icon-translate"),O=a.paint.get("text-translate"),L=a.paint.get("icon-translate-anchor"),k=a.paint.get("text-translate-anchor"),U=a.layout.get("icon-rotation-alignment"),j=a.layout.get("text-rotation-alignment"),Z=a.layout.get("icon-pitch-alignment"),ce=a.layout.get("text-pitch-alignment"),te=a.layout.get("icon-keep-upright"),_e=a.layout.get("text-keep-upright"),me=a.paint.get("icon-color-saturation"),Se=a.paint.get("icon-color-contrast"),ke=a.paint.get("icon-color-brightness-min"),Oe=a.paint.get("icon-color-brightness-max"),je=a.layout.get("symbol-elevation-reference")==="sea",Ve=f.context,Ue=Ve.gl,Ne=f.transform,Ye=U==="map",it=j==="map",xt=Z==="map",_t=ce==="map",Rt=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Pt=!1;const ht=f.depthModeForSublayer(0,Ri.ReadOnly),bt=[r.at(Ne.center.lng),r.aA(Ne.center.lat)],Vt=a.layout.get("text-variable-anchor"),ut=Ne.projection.name==="globe",Ot=[],wt=[0,-1,0];for(const Qt of p){const kt=i.getTile(Qt),Dt=kt.getBucket(a);if(!Dt||Dt.projection.name==="mercator"&&ut||Dt.fullyClipped)continue;const Gt=Dt.projection.name==="globe",Jt=Gt?r.ae(Ne.zoom):0,ci=ac(Qt,Dt.getProjection(),Ne),_i=Ne.calculatePixelsToTileUnitsMatrix(kt),qi=Vt&&Dt.hasTextData(),Di=Dt.hasIconTextFit()&&qi&&Dt.hasIconData(),Oi=Dt.getProjection().createInversionMatrix(Ne,Qt.canonical),er=jr=>{Ne.depthOcclusionForSymbolsAndCircles&&(a.hasInitialOcclusionOpacityProperties||f.terrain)&&(jr.push("DEPTH_D24"),jr.push("DEPTH_OCCLUSION"))},Pr=()=>{const jr=Ye&&a.layout.get("symbol-placement")!=="point",Hr=[];er(Hr);const Nn=jr||Di,Ls=a.paint.get("icon-image-cross-fade").constantOr(0);f.terrainRenderModeElevated()&&xt&&Hr.push("PITCH_WITH_MAP_TERRAIN"),Gt&&(Hr.push("PROJECTION_GLOBE_VIEW"),Nn&&Hr.push("PROJECTED_POS_ON_VIEWPORT")),Ls>0&&Hr.push("ICON_TRANSITION"),Dt.icon.zOffsetVertexBuffer&&Hr.push("Z_OFFSET"),me===0&&Se===0&&ke===0&&Oe===1||Hr.push("COLOR_ADJUSTMENT"),Dt.sdfIcons&&Hr.push("RENDER_SDF");const gs=Dt.icon.programConfigurations.get(a.id),ys=f.getOrCreateProgram("symbol",{config:gs,defines:Hr}),ha=kt.imageAtlasTexture?kt.imageAtlasTexture.size:[0,0],fo=Dt.iconSizeData,Vn=r.bp(fo,Ne.zoom),pn=xt||Ne.pitch!==0,on=Es(ci,kt.tileID.canonical,xt,Ye,Ne,Dt.getProjection(),_i),Or=Nd(ci,kt.tileID.canonical,xt,Ye,Ne,Dt.getProjection(),_i),os=f.translatePosMatrix(Or,kt,M,L,!0),ks=f.translatePosMatrix(ci,kt,M,L),ln=Nn?af:on,po=Ye&&!xt&&!jr;let Oa=wt;!ut&&!Ne.mercatorFromTransition||Ye||(Oa=la(Ne));const qo=Gt?Oa:wt,Oo=a.getColorAdjustmentMatrix(me,Se,ke,Oe),Nl=ug(fo.kind,Vn,po,xt,f,ks,ln,os,je,!1,ha,[0,0],!0,Qt,Jt,bt,Oi,qo,Dt.getProjection(),Oo,Ls),La=kt.imageAtlasTexture?kt.imageAtlasTexture:null,da=a.layout.get("icon-size").constantOr(0)!==1||Dt.iconsNeedLinear,ku=Dt.sdfIcons||f.options.rotating||f.options.zooming||da||pn?Ue.LINEAR:Ue.NEAREST,Vl=Dt.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,zu=f.terrain&&xt&&jr?r.ab.mat4.invert(r.ab.mat4.create(),on):af;if(jr&&Dt.icon){const Bh=Ne.elevation,um=Bh?Bh.getAtTileOffsetFunc(Qt,Ne.center.lat,Ne.worldSize,Dt.getProjection()):null,Bg=Ln(ci,kt.tileID.canonical,xt,Ye,Ne,Dt.getProjection(),_i);dh(Dt,ci,f,!1,Bg,Or,xt,te,um,Qt)}return{program:ys,buffers:Dt.icon,uniformValues:Nl,atlasTexture:La,atlasTextureIcon:null,atlasInterpolation:ku,atlasInterpolationIcon:null,isSDF:Dt.sdfIcons,hasHalo:Vl,tile:kt,labelPlaneMatrixInv:zu}},Xr=()=>{const jr=it&&a.layout.get("symbol-placement")!=="point",Hr=[],Nn=jr||Vt||Di;f.terrainRenderModeElevated()&&_t&&Hr.push("PITCH_WITH_MAP_TERRAIN"),Gt&&(Hr.push("PROJECTION_GLOBE_VIEW"),Nn&&Hr.push("PROJECTED_POS_ON_VIEWPORT")),Dt.text.zOffsetVertexBuffer&&Hr.push("Z_OFFSET"),Dt.iconsInText&&Hr.push("RENDER_TEXT_AND_SYMBOL"),Hr.push("RENDER_SDF"),er(Hr);const Ls=Dt.text.programConfigurations.get(a.id),gs=f.getOrCreateProgram("symbol",{config:Ls,defines:Hr});let ys,ha=[0,0],fo=null;const Vn=Dt.textSizeData;Dt.iconsInText&&(ha=kt.imageAtlasTexture?kt.imageAtlasTexture.size:[0,0],fo=kt.imageAtlasTexture?kt.imageAtlasTexture:null,ys=_t||Ne.pitch!==0||f.options.rotating||f.options.zooming||Vn.kind==="composite"||Vn.kind==="camera"?Ue.LINEAR:Ue.NEAREST);const pn=kt.glyphAtlasTexture?kt.glyphAtlasTexture.size:[0,0],on=a.layout.get("text-size-scale-range"),Or=r.aw(f.scaleFactor,on[0],on[1]),os=r.bp(Vn,Ne.zoom,Or),ks=Es(ci,kt.tileID.canonical,_t,it,Ne,Dt.getProjection(),_i),ln=Nd(ci,kt.tileID.canonical,_t,it,Ne,Dt.getProjection(),_i),po=f.translatePosMatrix(ln,kt,O,k,!0),Oa=f.translatePosMatrix(ci,kt,O,k),qo=Nn?af:ks,Oo=it&&!_t&&!jr;let Nl=wt;!ut&&!Ne.mercatorFromTransition||it||(Nl=la(Ne));const La=ug(Vn.kind,os,Oo,_t,f,Oa,qo,po,je,!0,pn,ha,!0,Qt,Jt,bt,Oi,Gt?Nl:wt,Dt.getProjection(),null,null,Or),da=kt.glyphAtlasTexture?kt.glyphAtlasTexture:null,ku=Ue.LINEAR,Vl=a.paint.get("text-halo-width").constantOr(1)!==0,zu=f.terrain&&_t&&jr?r.ab.mat4.invert(r.ab.mat4.create(),ks):af;if(jr&&Dt.text){const Bh=Ne.elevation,um=Bh?Bh.getAtTileOffsetFunc(Qt,Ne.center.lat,Ne.worldSize,Dt.getProjection()):null,Bg=Ln(ci,kt.tileID.canonical,_t,it,Ne,Dt.getProjection(),_i);dh(Dt,ci,f,!0,Bg,ln,_t,_e,um,Qt)}return{program:gs,buffers:Dt.text,uniformValues:La,atlasTexture:da,atlasTextureIcon:fo,atlasInterpolation:ku,atlasInterpolationIcon:ys,isSDF:!0,hasHalo:Vl,tile:kt,labelPlaneMatrixInv:zu}},Hn=Dt.icon.segments.get().length,Tn=Dt.text.segments.get().length,ar=Hn&&!T.onlyText?Pr():null,Nr=Tn&&!T.onlyIcons?Xr():null,Ai=a.paint.get("icon-opacity").constantOr(1),Mr=a.paint.get("text-opacity").constantOr(1);if(Rt&&Dt.canOverlap){Pt=!0;const jr=Ai&&!T.onlyText?Dt.icon.segments.get():[],Hr=Mr&&!T.onlyIcons?Dt.text.segments.get():[];for(const Nn of jr)Ot.push({segments:new r.b7([Nn]),sortKey:Nn.sortKey,state:ar});for(const Nn of Hr)Ot.push({segments:new r.b7([Nn]),sortKey:Nn.sortKey,state:Nr})}else T.onlyText||Ot.push({segments:Ai?Dt.icon.segments:new r.b7([]),sortKey:0,state:ar}),T.onlyIcons||Ot.push({segments:Mr?Dt.text.segments:new r.b7([]),sortKey:0,state:Nr})}Pt&&Ot.sort((Qt,kt)=>Qt.sortKey-kt.sortKey);for(const Qt of Ot){const kt=Qt.state;if(kt)if(f.terrain?f.terrain.setupElevationDraw(kt.tile,kt.program,{useDepthForOcclusion:Ne.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:kt.labelPlaneMatrixInv}):f.setupDepthForOcclusion(Ne.depthOcclusionForSymbolsAndCircles,kt.program),Ve.activeTexture.set(Ue.TEXTURE0),kt.atlasTexture&&kt.atlasTexture.bind(kt.atlasInterpolation,Ue.CLAMP_TO_EDGE,!0),kt.atlasTextureIcon&&(Ve.activeTexture.set(Ue.TEXTURE1),kt.atlasTextureIcon&&kt.atlasTextureIcon.bind(kt.atlasInterpolationIcon,Ue.CLAMP_TO_EDGE,!0)),f.uploadCommonLightUniforms(f.context,kt.program),kt.hasHalo){const Dt=kt.uniformValues;Dt.u_is_halo=1,Yp(kt.buffers,Qt.segments,a,f,kt.program,ht,g,b,Dt,2),Dt.u_is_halo=0}else{if(kt.isSDF){const Dt=kt.uniformValues;kt.hasHalo&&(Dt.u_is_halo=1,Yp(kt.buffers,Qt.segments,a,f,kt.program,ht,g,b,Dt,1)),Dt.u_is_halo=0}Yp(kt.buffers,Qt.segments,a,f,kt.program,ht,g,b,kt.uniformValues,1)}}}function Yp(f,i,a,p,g,b,T,M,O,L){const k=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer];g.draw(p,p.context.gl.TRIANGLES,b,T,M,Fi.disabled,O,a.id,f.layoutVertexBuffer,f.indexBuffer,i,a.paint,p.transform.zoom,f.programConfigurations.get(a.id),k,L)}function _g(f,i,a,p,g,b,T){const M=f.context.gl,O=a.paint.get("fill-pattern"),L=a.is3D(),k=L?f.stencilModeFor3D():$i.disabled,U=O&&O.constantOr(1);let j,Z,ce,te,_e;T?(Z=U&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=M.LINES):(Z=U?"fillPattern":"fill",j=M.TRIANGLES);for(const me of p){const Se=i.getTile(me);if(U&&!Se.patternsLoaded())continue;const ke=Se.getBucket(a);if(!ke)continue;f.prepareDrawTile();const Oe=ke.programConfigurations.get(a.id),je=f.isTileAffectedByFog(me),Ve=f.getOrCreateProgram(Z,{config:Oe,overrideFog:je});U&&(f.context.activeTexture.set(M.TEXTURE0),Se.imageAtlasTexture&&Se.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Oe.updatePaintBuffers());const Ue=O.constantOr(null);if(Ue&&Se.imageAtlas){const it=Se.imageAtlas,xt=r.A.from(Ue).getPrimary().scaleSelf(r.q.devicePixelRatio).serialize(),_t=it.patternPositions[xt];_t&&Oe.setConstantPatternPositions(_t)}const Ne=f.translatePosMatrix(me.projMatrix,Se,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")),Ye=a.paint.get("fill-emissive-strength");if(T){te=ke.indexBuffer2,_e=ke.segments2;const it=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[M.drawingBufferWidth,M.drawingBufferHeight];ce=Z==="fillOutlinePattern"&&U?l1(Ne,Ye,f,Se,it):og(Ne,Ye,it)}else te=ke.indexBuffer,_e=ke.segments,ce=U?sf(Ne,Ye,f,Se):nf(Ne,Ye);f.uploadCommonUniforms(f.context,Ve,me.toUnwrapped()),Ve.draw(f,j,g,L?k:f.stencilModeForClipping(me),b,Fi.disabled,ce,a.id,ke.layoutVertexBuffer,te,_e,a.paint,f.transform.zoom,Oe,void 0)}}function cf(f,i,a,p,g,b,T,M){a.resetLayerRenderingStats(f);const O=f.context,L=O.gl,k=f.transform,U=a.paint.get("fill-extrusion-pattern"),j=U.constantOr(1),Z=a.paint.get("fill-extrusion-opacity"),ce=f.style.enable3dLights(),te=a.paint.get(ce&&!j?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),_e=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),te],me=a.layout.get("fill-extrusion-edge-radius"),Se=me>0&&!a.paint.get("fill-extrusion-rounded-roof"),ke=Se?0:me,Oe=k.projection.name==="globe"?r.d3():0,je=k.projection.name==="globe",Ve=je?r.ae(k.zoom):0,Ue=[r.at(k.center.lng),r.aA(k.center.lat)],Ne=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ye=a.paint.get("fill-extrusion-flood-light-color").toRenderColor(Ne?null:a.lut).toArray01().slice(0,3),it=a.paint.get("fill-extrusion-flood-light-intensity"),xt=a.paint.get("fill-extrusion-vertical-scale"),_t=a.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Rt=a.paint.get("fill-extrusion-height-alignment"),Pt=a.paint.get("fill-extrusion-base-alignment"),ht=tl(f,a.paint.get("fill-extrusion-cutoff-fade-range")),bt=[];let Vt;je&&bt.push("PROJECTION_GLOBE_VIEW"),_e[0]>0&&bt.push("FAUX_AO"),Se&&bt.push("ZERO_ROOF_RADIUS"),M&&bt.push("HAS_CENTROID"),it>0&&bt.push("FLOOD_LIGHT"),ht.shouldRenderCutoff&&bt.push("RENDER_CUTOFF"),_t&&bt.push("RENDER_WALL_MODE");const ut=f.renderPass==="shadow",Ot=f.shadowRenderer,wt=ut&&!!Ot;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let Qt=[0,0,0];if(Ot){const Gt=f.style.directionalLight,Jt=f.style.ambientLight;Gt&&Jt&&(Qt=Wd(f.style,Gt,Jt)),ut||(bt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Ot.useNormalOffset&&bt.push("NORMAL_OFFSET")),Vt=bt.concat(["SHADOWS_SINGLE_CASCADE"])}const kt=wt?"fillExtrusionDepth":j?"fillExtrusionPattern":"fillExtrusion",Dt=a.getLayerRenderingStats();for(const Gt of p){const Jt=i.getTile(Gt),ci=Jt.getBucket(a);if(!ci||ci.projection.name!==k.projection.name)continue;let _i=!1;Ot&&(_i=Ot.getMaxCascadeForTile(Gt.toUnwrapped())===0);const qi=f.isTileAffectedByFog(Gt),Di=ci.programConfigurations.get(a.id),Oi=f.getOrCreateProgram(kt,{config:Di,defines:_i?Vt:bt,overrideFog:qi});if(f.terrain&&f.terrain.setupElevationDraw(Jt,Oi,{useMeterToDem:!0}),!ci.centroidVertexBuffer){const Nr=Oi.attributes.a_centroid_pos;Nr!==void 0&&L.vertexAttrib2f(Nr,0,0)}!ut&&Ot&&Ot.setupShadows(Jt.tileID.toUnwrapped(),Oi,"vector-tile",Jt.tileID.overscaledZ),j&&(f.context.activeTexture.set(L.TEXTURE0),Jt.imageAtlasTexture&&Jt.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Di.updatePaintBuffers());const er=U.constantOr(null);if(er&&Jt.imageAtlas){const Nr=Jt.imageAtlas,Ai=r.A.from(er).getPrimary().scaleSelf(r.q.devicePixelRatio),Mr=Nr.patternPositions[Ai.serialize()];Mr&&Di.setConstantPatternPositions(Mr)}const Pr=a.paint.get("fill-extrusion-vertical-gradient"),Xr=1/ci.tileToMeter;let Hn;if(ut&&Ot){if(Ih(Jt.tileID,ci,f))continue;const Nr=Ot.calculateShadowPassMatrixFromTile(Jt.tileID.toUnwrapped());Hn=rf(Nr,ke,Xr,xt,Rt,Pt)}else{const Nr=f.translatePosMatrix(Gt.expandedProjMatrix,Jt,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Ai=k.projection.createInversionMatrix(k,Gt.canonical);Hn=j?a1(Nr,f,Pr,Z,_e,ke,Xr,Gt,Jt,Oe,Rt,Pt,Ve,Ue,Ai,Ye,xt):$p(Nr,f,Pr,Z,_e,ke,Xr,Gt,Oe,Rt,Pt,Ve,Ue,Ai,Ye,xt,it,Qt)}f.uploadCommonUniforms(O,Oi,Gt.toUnwrapped(),null,ht);let Tn=ci.segments;if(k.projection.name==="mercator"&&!ut&&(Tn=ci.getVisibleSegments(Jt.tileID,f.terrain,f.transform.getFrustum(0)),!Tn.get().length))continue;if(Dt)if(ut)for(const Nr of Tn.get())Dt.numRenderedVerticesInShadowPass+=Nr.primitiveLength;else for(const Nr of Tn.get())Dt.numRenderedVerticesInTransparentPass+=Nr.primitiveLength;const ar=[];(f.terrain||M)&&ar.push(ci.centroidVertexBuffer),je&&ar.push(ci.layoutVertexExtBuffer),_t&&ar.push(ci.wallVertexBuffer),Oi.draw(f,O.gl.TRIANGLES,g,b,T,Fi.backCCW,Hn,a.id,ci.layoutVertexBuffer,ci.indexBuffer,Tn,a.paint,f.transform.zoom,Di,ar)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}function Ah(f,i,a,p,g,b,T,M,O,L,k,U,j,Z,ce,te,_e,me,Se){const ke=f.context,Oe=ke.gl,je=f.transform,Ve=f.transform.zoom,Ue=[],Ne=tl(f,a.paint.get("fill-extrusion-cutoff-fade-range"));L==="clear"?(Ue.push("CLEAR_SUBPASS"),Se&&(Ue.push("CLEAR_FROM_TEXTURE"),ke.activeTexture.set(Oe.TEXTURE0),Se.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE))):L==="sdf"&&Ue.push("SDF_SUBPASS"),_e&&Ue.push("HAS_CENTROID"),Ne.shouldRenderCutoff&&Ue.push("RENDER_CUTOFF");const Ye=a.layout.get("fill-extrusion-edge-radius"),it=(xt,_t,Rt,Pt,ht)=>{const bt=_t.programConfigurations.get(a.id),Vt=f.isTileAffectedByFog(xt),ut=f.getOrCreateProgram("fillExtrusionGroundEffect",{config:bt,defines:Ue,overrideFog:Vt}),Ot=((Qt,kt,Dt,Gt,Jt,ci,_i,qi,Di,Oi,er)=>({u_matrix:kt,u_opacity:Dt,u_ao_pass:Gt?1:0,u_meter_to_tile:Jt,u_ao:ci,u_flood_light_intensity:_i,u_flood_light_color:qi,u_attenuation:Di,u_edge_radius:Oi,u_fb:0,u_fb_size:er,u_dynamic_offset:1}))(0,Pt,k,O,ht,[U,j*ht],Z,ce,te,Ve>=17?0:Ye*ht,Se?Se.size[0]:0),wt=[];_e&&wt.push(_t.hiddenByLandmarkVertexBuffer),f.uploadCommonUniforms(ke,ut,xt.toUnwrapped(),null,Ne),ut.draw(f,ke.gl.TRIANGLES,g,b,T,M,Ot,a.id,_t.vertexBuffer,_t.indexBuffer,Rt,a.paint,Ve,bt,wt)};for(const xt of p){const _t=i.getTile(xt),Rt=_t.getBucket(a);if(!Rt||Rt.projection.name!==je.projection.name||!Rt.groundEffect||Rt.groundEffect&&!Rt.groundEffect.hasData())continue;const Pt=Rt.groundEffect,ht=1/Rt.tileToMeter;{const bt=f.translatePosMatrix(xt.projMatrix,_t,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Vt=Pt.getDefaultSegment();it(xt,Pt,Vt,bt,ht)}if(me)for(let bt=0;bt<4;bt++){const Vt=r.d4[bt](xt),ut=i.getTile(Vt);if(!ut)continue;const Ot=ut.getBucket(a);if(!Ot||Ot.projection.name!==je.projection.name||!Ot.groundEffect||Ot.groundEffect&&!Ot.groundEffect.hasData())continue;const wt=Ot.groundEffect;let Qt,kt;bt===0?(Qt=[-r.ag,0,0],kt=1):bt===1?(Qt=[r.ag,0,0],kt=0):bt===2?(Qt=[0,-r.ag,0],kt=3):(Qt=[0,r.ag,0],kt=2);const Dt=wt.regionSegments[kt];if(!Dt)continue;const Gt=new Float32Array(16);r.ab.mat4.translate(Gt,xt.projMatrix,Qt),it(xt,wt,Dt,f.translatePosMatrix(Gt,_t,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),ht)}}}function Ch(f,i,a,p,g,b,T){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const M=b?b.findDEMTileFor(a):null;if(!(M&&M.dem||T))return;b&&M&&M.dem&&p.selfDEMTileTimestamp!==M.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=M.dem._timestamp);const O=me=>new r.P(Math.ceil((me+r.d7)*r.d8),0),L=me=>{const Se=i.getSource().minzoom,ke=je=>{const Ve=i.getTileByID(je);if(Ve&&Ve.hasData())return Ve.getBucket(g)},Oe=[0,-1,1];for(const je of Oe){if(me.overscaledZ+je<Se)continue;const Ve=ke(me.calculateScaledKey(me.overscaledZ+je));if(Ve)return Ve}},k=[0,0,0],U=(me,Se)=>(k[0]=Math.min(me.min.y,Se.min.y),k[1]=Math.max(me.max.y,Se.max.y),k[2]=r.ag-Se.min.x>me.max.x?Se.min.x-r.ag:me.max.x,k),j=(me,Se)=>(k[0]=Math.min(me.min.x,Se.min.x),k[1]=Math.max(me.max.x,Se.max.x),k[2]=r.ag-Se.min.y>me.max.y?Se.min.y-r.ag:me.max.y,k),Z=[(me,Se)=>U(me,Se),(me,Se)=>U(Se,me),(me,Se)=>j(me,Se),(me,Se)=>j(Se,me)],ce=(me,Se,ke,Oe,je,Ve,Ue)=>{if(!b)return 0;const Ne=[[Ve?ke:me,Ve?me:ke,0],[Ve?ke:Se,Ve?Se:ke,0]],Ye=Ue<0?r.ag+Ue:Ue,it=[Ve?Ye:(me+Se)/2,Ve?(me+Se)/2:Ye,0];return ke===0&&Ue<0||ke!==0&&Ue>0?b.getForTilePoints(je,[it],!0,Oe):Ne.push(it),b.getForTilePoints(a,Ne,!0,M),Math.max(Ne[0][2],Ne[1][2],it[2])/b.exaggeration()};for(let me=0;me<4;me++){const Se=p.borderFeatureIndices[me];if(Se.length===0)continue;const ke=r.d4[me](a),Oe=L(ke);if(!(Oe&&Oe instanceof r.d5))continue;const je=b?b.findDEMTileFor(ke):null;if(!(je&&je.dem||T)||(b&&je&&je.dem&&p.borderDEMTileTimestamp[me]!==je.dem._timestamp&&(p.borderDoneWithNeighborZ[me]=-1,p.borderDEMTileTimestamp[me]=je.dem._timestamp),p.borderDoneWithNeighborZ[me]===Oe.canonical.z))continue;Oe.centroidVertexArray.length===0&&Oe.createCentroidsBuffer();const Ve=(me<2?1:5)-me,Ue=Oe.borderDoneWithNeighborZ[Ve]!==p.canonical.z,Ne=Oe.borderFeatureIndices[Ve];let Ye=0;if(p.canonical.z!==Oe.canonical.z){for(const it of Se)p.showCentroid(p.featuresOnBorder[it]);if(Ue)for(const it of Ne)Oe.showCentroid(Oe.featuresOnBorder[it]);p.borderDoneWithNeighborZ[me]=Oe.canonical.z,Oe.borderDoneWithNeighborZ[Ve]=p.canonical.z}for(const it of Se){const xt=p.featuresOnBorder[it],_t=p.centroidData[xt.centroidDataIndex],Rt=xt.borders[me];let Pt;for(;Ye<Ne.length;){Pt=Oe.featuresOnBorder[Ne[Ye]];const ht=Pt.borders[Ve];if(ht[1]>Rt[0]+3||ht[0]>Rt[0]-3)break;Oe.showCentroid(Pt),Ye++}if(Pt&&Ye<Ne.length){const ht=Ye;let bt=0;for(;!(Pt.borders[Ve][0]>Rt[1]-3)&&(bt++,++Ye!==Ne.length);)Pt=Oe.featuresOnBorder[Ne[Ye]];Pt=Oe.featuresOnBorder[Ne[ht]];let Vt=!1;if(bt>=1){const wt=Pt.borders[Ve];Math.abs(Rt[0]-wt[0])<3&&Math.abs(Rt[1]-wt[1])<3&&(bt=1,Vt=!0,Ye=ht+1)}else if(bt===0){p.showCentroid(xt);continue}const ut=Oe.centroidData[Pt.centroidDataIndex];T&&Vt&&(((te=_t).flags|(_e=ut).flags)&r.d6?(te.flags|=r.d6,_e.flags|=r.d6):(te.flags&=~r.d6,_e.flags&=~r.d6));const Ot=xt.intersectsCount()>1||Pt.intersectsCount()>1;if(bt>1)Ye=ht,_t.centroidXY=ut.centroidXY=new r.P(0,0);else if(je&&je.dem&&!Ot){const wt=Z[me](_t,ut),Qt=me%2?r.ag-1:0,kt=ce(wt[0],Math.min(r.ag-1,wt[1]),Qt,je,ke,me<2,wt[2]);_t.centroidXY=ut.centroidXY=O(kt)}else Ot?_t.centroidXY=ut.centroidXY=new r.P(0,0):(_t.centroidXY=p.encodeBorderCentroid(xt),ut.centroidXY=Oe.encodeBorderCentroid(Pt));p.writeCentroidToBuffer(_t),Oe.writeCentroidToBuffer(ut)}else p.showCentroid(xt)}p.borderDoneWithNeighborZ[me]=Oe.canonical.z,Oe.borderDoneWithNeighborZ[Ve]=p.canonical.z}var te,_e;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(f)}const Mh=[1,0,0],Xt=[0,1,0],hi=[0,0,1];function Ih(f,i,a){const p=a.transform,g=a.shadowRenderer;if(!g)return!0;const b=f.toUnwrapped(),T=p.tileSize*g._cascades[a.currentShadowCascade].scale;let M=i.maxHeight;if(p.elevation){const te=p.elevation.getMinMaxForTile(f);te&&(M+=te.max)}const O=[...g.shadowDirection];O[2]=-O[2];const L=g.computeSimplifiedTileShadowVolume(b,M,T,O);if(!L)return!1;const k=[Mh,Xt,hi,O,[O[0],0,O[2]],[0,O[1],O[2]]],U=p.projection.name==="globe",j=p.scaleZoom(T),Z=r.bR.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,j,!U),ce=g.getCurrentCascadeFrustum();return Z.intersectsPrecise(L.vertices,L.planes,k)===0||ce.intersectsPrecise(L.vertices,L.planes,k)===0}function Bn(f){return[f[0]*r.d9,f[1]*r.d9,f[2]*r.d9,0]}function gt(f,i,a,p,g,b,T,M,O){const L=p.getSource(),k=a.globeSharedBuffers;if(!k)return;let U,j,Z;if(i&&(U=p.getTile(i)),L instanceof r.aJ?(j=L.texture,Z=r.cI(0,0,a.transform)):U&&i&&(j=U.texture,Z=r.cI(i.canonical.z,i.canonical.x,a.transform)),!j||!Z)return;f||(Z=r.ab.mat4.scale(r.ab.mat4.create(),Z,[1,-1,1]));const ce=a.context,te=ce.gl,_e=g.paint.get("raster-resampling")==="nearest"?te.NEAREST:te.LINEAR,me=a.colorModeForDrapableLayerRenderPass(b),Se=T.defines;Se.push("GLOBE_POLES");const ke=new Ri(te.LEQUAL,Ri.ReadWrite,a.depthRangeFor3D),Oe=Float32Array.from(a.transform.expandedFarZProjMatrix),je=Float32Array.from(r.bb(r.cH(new r.bT(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),ce.activeTexture.set(te.TEXTURE0),j.bind(_e,te.CLAMP_TO_EDGE),ce.activeTexture.set(te.TEXTURE1),j.bind(_e,te.CLAMP_TO_EDGE),j.useMipmap&&ce.extTextureFilterAnisotropic&&a.transform.pitch>20&&te.texParameterf(te.TEXTURE_2D,ce.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ce.extTextureFilterAnisotropicMax);const[Ve,Ue,Ne,Ye]=i?k.getPoleBuffers(i.canonical.z,!1):k.getPoleBuffers(0,!0),it=g.paint.get("raster-elevation");let xt;f?(xt=Ve,a.renderDefaultNorthPole=it!==0):(xt=Ue,a.renderDefaultSouthPole=it!==0);const _t=Bn(T.mix),Rt=((ht,bt,Vt,ut,Ot,wt,Qt,kt,Dt,Gt,Jt,ci,_i)=>Uc(ht,bt,Vt,new Float32Array(16),new Float32Array(9),[0,0],ut,[0,0],[0,0,0,0],1,{opacity:1,mix:0},wt,[0,0],kt,2,Gt,Jt,ci,1,0,_i))(Oe,je,Z,r.ae(a.transform.zoom),0,g,0,it,0,_t,T.offset,T.range,b),Pt=a.getOrCreateProgram("raster",{defines:Se});a.uploadCommonUniforms(ce,Pt,null),Pt.draw(a,te.TRIANGLES,ke,O,me,M,Rt,g.id,xt,Ne,Ye)}function u1(f){const i=f._nearZ,a=f.projection.farthestPixelDistance(f),p=a-i,g=.2*f.height,b=i+g;return[i,a,(b-g-i)/p,(b-i)/p]}function Xp(f,i,a,p){if(f)return i instanceof An&&f instanceof Ml?i.getTextureDescriptor(f,a,!0):{texture:f.texture,mix:Bn(p.mix),offset:p.offset,buffer:0,tileSize:1}}var gg=r.da([{name:"a_index",type:"Int16",components:1}]);class h1{constructor(i,a,p,g){const b={width:p[0],height:p[1],data:null},T=i.gl;this.targetColorTexture=new r.T(i,b,T.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(i,b,T.RGBA8,{useMipmap:!1}),this.context=i,this.updateParticleTexture(a,g),this.lastInvalidatedAt=0}updateParticleTexture(i,a){if(this.particleTextureDimension===a.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,g=a.width*a.height;this.particleTexture0=new r.T(this.context,a,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,a,p.RGBA8,{premultiply:!1,useMipmap:!1});const b=new r.db;b.reserve(g);for(let T=0;T<g;T++)b.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(b,gg.members,!0),this.particleSegment=r.b7.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=a.width}update(i){return!(this.lastInvalidatedAt<i&&(this.lastInvalidatedAt=r.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function d1(f,i,a){if(!f)return null;const p=i.getTextureDescriptor(f,a,!0);if(!p)return null;let{texture:g,mix:b,offset:T,tileSize:M,buffer:O,format:L}=p;if(!g||!L)return null;let k=!1;return L==="uint32"&&(k=!0,b[3]=0,b=ag(r.dc,b,[0,a.paint.get("raster-particle-max-speed")]),T=lg(r.dc,T,[0,a.paint.get("raster-particle-max-speed")])),{texture:g,textureOffset:[O/(M+2*O),M/(M+2*O)],tileSize:M,scalarData:k,scale:b,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[L]]}}function f1(f){const i=f._nearZ,a=f.projection.farthestPixelDistance(f),p=a-i,g=.2*f.height,b=i+g;return[i,a,(b-g-i)/p,(b-i)/p]}const Ph=new r.aj(1,0,0,1),gw=new r.aj(0,1,0,1),yw=new r.aj(0,0,1,1),p1=new r.aj(1,0,1,1),Kp=new r.aj(0,1,1,1);function $c(f,i,a,p,g,b,T){const M=f.context,O=f.transform,L=M.gl,k=O.projection.name==="globe",U=k?["PROJECTION_GLOBE_VIEW"]:[];let j=r.ab.mat4.clone(a.projMatrix);if(k&&r.ae(O.zoom)>0){const _t=r.ba(a.canonical,O),Rt=r.dd(_t);j=r.ab.mat4.multiply(new Float32Array(16),O.globeMatrix,Rt),r.ab.mat4.multiply(j,O.projMatrix,j)}const Z=r.ab.mat4.create();Z[12]+=2*g/(r.q.devicePixelRatio*O.width),Z[13]+=2*b/(r.q.devicePixelRatio*O.height),r.ab.mat4.multiply(j,Z,j);const ce=f.getOrCreateProgram("debug",{defines:U}),te=i.getTileByID(a.key);f.terrain&&f.terrain.setupElevationDraw(te,ce);const _e=Ri.disabled,me=$i.disabled,Se=f.colorModeForRenderPass(),ke="$debug";M.activeTexture.set(L.TEXTURE0),f.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),k?te._makeGlobeTileDebugBuffers(f.context,O):te._makeDebugTileBoundsBuffers(f.context,O.projection);const Oe=te._tileDebugBuffer||f.debugBuffer,je=te._tileDebugIndexBuffer||f.debugIndexBuffer,Ve=te._tileDebugSegments||f.debugSegments;if(ce.draw(f,L.LINE_STRIP,_e,me,Se,Fi.disabled,Au(j,p),ke,Oe,je,Ve,null,null,null,[te._globeTileDebugBorderBuffer]),T){const _t=te.latestRawTileData,Rt=Math.floor((_t&&_t.byteLength||0)/1024);let Pt=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(Pt+=` => ${a.overscaledZ}`),Pt+=` ${te.state}`,Pt+=` ${Rt}kb`,function(ht,bt){ht.initDebugOverlayCanvas();const Vt=ht.debugOverlayCanvas,ut=ht.context.gl,Ot=ht.debugOverlayCanvas.getContext("2d");Ot.clearRect(0,0,Vt.width,Vt.height),Ot.shadowColor="white",Ot.shadowBlur=2,Ot.lineWidth=1.5,Ot.strokeStyle="white",Ot.textBaseline="top",Ot.font="bold 36px Open Sans, sans-serif",Ot.fillText(bt,5,5),Ot.strokeText(bt,5,5),ht.debugOverlayTexture.update(Vt),ht.debugOverlayTexture.bind(ut.LINEAR,ut.CLAMP_TO_EDGE)}(f,Pt)}const Ue=i.getTile(a).tileSize,Ne=512/Math.min(Ue,512)*(a.overscaledZ/O.zoom)*.5,Ye=te._tileDebugTextBuffer||f.debugBuffer,it=te._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,xt=te._tileDebugTextSegments||f.debugSegments;ce.draw(f,L.TRIANGLES,_e,me,gr.alphaBlended,Fi.disabled,Au(j,r.aj.transparent,Ne),ke,Ye,it,xt,null,null,null,[te._globeTileDebugTextBuffer])}function yg(f,i,a,p){Mu(f,0,i+a/2,f.transform.width,a,p)}function vg(f,i,a,p){Mu(f,i-a/2,0,a,f.transform.height,p)}function Mu(f,i,a,p,g,b){const T=f.context,M=T.gl;M.enable(M.SCISSOR_TEST),M.scissor(i*r.q.devicePixelRatio,a*r.q.devicePixelRatio,p*r.q.devicePixelRatio,g*r.q.devicePixelRatio),T.clear({color:b}),M.disable(M.SCISSOR_TEST)}const Jp=r.da([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ll}=Jp;function pc(f,i,a,p){f.emplaceBack(i,a,p)}class m1{constructor(i){this.vertexArray=new r.de,this.indices=new r.aU,pc(this.vertexArray,-1,-1,1),pc(this.vertexArray,1,-1,1),pc(this.vertexArray,-1,1,1),pc(this.vertexArray,1,1,1),pc(this.vertexArray,-1,-1,-1),pc(this.vertexArray,1,-1,-1),pc(this.vertexArray,-1,1,-1),pc(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Ll),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=r.b7.simpleSegment(0,0,36,12)}}function js(f,i,a,p,g,b){const T=f.context.gl,M=i.paint.get("sky-atmosphere-color"),O=i.paint.get("sky-atmosphere-halo-color"),L=i.paint.get("sky-atmosphere-sun-intensity"),k=((U,j,Z,ce,te)=>({u_matrix_3f:U,u_sun_direction:j,u_sun_intensity:Z,u_color_tint_r:[ce.r,ce.g,ce.b,ce.a],u_color_tint_m:[te.r,te.g,te.b,te.a],u_luminance:5e-5}))(r.ab.mat3.fromMat4(r.ab.mat3.create(),p),g,L,M,O);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+b,i.skyboxTexture,0),a.draw(f,T.TRIANGLES,Ri.disabled,$i.disabled,gr.unblended,Fi.frontCW,k,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const vw=r.da([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class uf{constructor(i){const a=new r.df;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const p=new r.aU;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(a,vw.members),this.indexBuffer=i.createIndexBuffer(p),this.segments=r.b7.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const wn=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class qr{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class _1{constructor(i){this.colorModeAlphaBlendedWriteRGB=new gr([1,cc,1,cc],r.aj.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new gr([1,0,1,0],r.aj.transparent,[!1,!1,!1,!0]),this.params=new qr,this.updateNeeded=!0,i.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),i.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(i){const a=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new uf(a);const p=this.params.sizeRange,g=this.params.intensityRange,b=function(k){const U=r.di(30),j=[];for(let Z=0;Z<k;++Z){const ce=2*Math.PI*U(),te=Math.acos(1-2*U())-.5*Math.PI;j.push(r.ab.vec3.fromValues(Math.cos(te)*Math.cos(ce),Math.cos(te)*Math.sin(ce),Math.sin(te)))}return j}(this.params.starsCount),T=r.di(300),M=new r.dg,O=new r.aU;let L=0;for(let k=0;k<b.length;++k){const U=r.ab.vec3.scale([],b[k],200),j=Math.max(0,1+.01*p*(1*T()-.5)),Z=Math.max(0,1+.01*g*(1*T()-.5));M.emplaceBack(U[0],U[1],U[2],-1,-1,j,Z),M.emplaceBack(U[0],U[1],U[2],1,-1,j,Z),M.emplaceBack(U[0],U[1],U[2],1,1,j,Z),M.emplaceBack(U[0],U[1],U[2],-1,1,j,Z),O.emplaceBack(L+0,L+1,L+2),O.emplaceBack(L+0,L+2,L+3),L+=4}this.starsVx=a.createVertexBuffer(M,wn.members),this.starsIdx=a.createIndexBuffer(O),this.starsSegments=r.b7.simpleSegment(0,0,M.length,O.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(i,a){const p=i.context,g=p.gl,b=i.transform,T=new Ri(g.LEQUAL,Ri.ReadOnly,[0,1]),M=r.ae(b.zoom),O=i.style.getLut(a.scope),L=a.properties.get("color-use-theme")==="none",k=a.properties.get("color").toRenderColor(L?null:O).toArray01(),U=a.properties.get("high-color-use-theme")==="none",j=a.properties.get("high-color").toRenderColor(U?null:O).toArray01(),Z=a.properties.get("space-color-use-theme")==="none",ce=a.properties.get("space-color").toRenderColor(Z?null:O).toArray01PremultipliedAlpha(),te=5e-4,_e=r.dh(a.properties.get("horizon-blend"),0,1,te,.25),me=r.cC(i,p,b)&&_e===te?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,Se=i.frameCounter/1e3%1,ke=r.ab.vec3.length(b.globeCenterInViewSpace),Oe=Math.sqrt(Math.pow(ke,2)-Math.pow(me,2)),je=Math.acos(Oe/ke),Ve=Ue=>{const Ne=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ue&&Ne.push("ALPHA_PASS");const Ye=i.getOrCreateProgram("globeAtmosphere",{defines:Ne}),it=((_t,Rt,Pt,ht,bt,Vt,ut,Ot,wt,Qt,kt,Dt)=>({u_frustum_tl:_t,u_frustum_tr:Rt,u_frustum_br:Pt,u_frustum_bl:ht,u_horizon:bt,u_transition:Vt,u_fadeout_range:ut,u_color:Ot,u_high_color:wt,u_space_color:Qt,u_temporal_offset:kt,u_horizon_angle:Dt}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,M,_e,k,j,ce,Se,je);i.uploadCommonUniforms(p,Ye);const xt=this.atmosphereBuffer;xt&&Ye.draw(i,g.TRIANGLES,T,$i.disabled,Ue?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Fi.backCW,it,Ue?"atmosphere_glow_alpha":"atmosphere_glow",xt.vertexBuffer,xt.indexBuffer,xt.segments)};Ve(!1),Ve(!0)}drawStars(i,a){const p=r.aw(a.properties.get("star-intensity"),0,1);if(p===0)return;const g=i.context,b=g.gl,T=i.transform,M=i.getOrCreateProgram("stars"),O=r.ab.quat.identity([]);r.ab.quat.rotateX(O,O,-T._pitch),r.ab.quat.rotateZ(O,O,-T.angle),r.ab.quat.rotateX(O,O,r.ai(T._center.lat)),r.ab.quat.rotateY(O,O,-r.ai(T._center.lng));const L=r.ab.mat4.fromQuat(new Float32Array(16),O),k=r.ab.mat4.multiply([],T.starsProjMatrix,L),U=r.ab.mat3.fromMat4([],L),j=r.ab.mat3.invert([],U),Z=[0,1,0];r.ab.vec3.transformMat3(Z,Z,j),r.ab.vec3.scale(Z,Z,this.params.sizeMultiplier);const ce=[1,0,0];r.ab.vec3.transformMat3(ce,ce,j),r.ab.vec3.scale(ce,ce,this.params.sizeMultiplier);const te=(_e=Z,me=ce,Se=p,{u_matrix:Float32Array.from(k),u_up:_e,u_right:me,u_intensity_multiplier:Se});var _e,me,Se;i.uploadCommonUniforms(g,M),this.starsVx&&this.starsIdx&&M.draw(i,b.TRIANGLES,Ri.disabled,$i.disabled,this.colorModeAlphaBlendedWriteRGB,Fi.disabled,te,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function mc(f,i){const a=[...f],p=i.cameraWorldSizeForFog/i.worldSize,g=r.ab.mat4.identity([]);return r.ab.mat4.scale(g,g,[p,p,1]),r.ab.mat4.multiply(a,g,a),r.ab.mat4.multiply(a,i.worldToFogMatrix,a),a}function Rh(f,i,a,p,g){const b=a.material,T=p.context,{baseColorTexture:M,metallicRoughnessTexture:O}=b.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:k,emissionTexture:U}=b;function j(ce,te,_e){if(ce&&(f.push(te),T.activeTexture.set(T.gl.TEXTURE0+_e),ce.gfxTexture)){const{minFilter:me,magFilter:Se,wrapS:ke,wrapT:Oe}=ce.sampler;ce.gfxTexture.bindExtraParam(me,Se,ke,Oe)}}j(M,"HAS_TEXTURE_u_baseColorTexture",Wr.BaseColor),j(O,"HAS_TEXTURE_u_metallicRoughnessTexture",Wr.MetallicRoughness),j(L,"HAS_TEXTURE_u_normalTexture",Wr.Normal),j(k,"HAS_TEXTURE_u_occlusionTexture",Wr.Occlusion),j(U,"HAS_TEXTURE_u_emissionTexture",Wr.Emission),g&&(g.texture||(g.texture=new r.dk(p.context,g.image,[g.image.height,g.image.height,g.image.height],T.gl.RGBA8)),T.activeTexture.set(T.gl.TEXTURE0+Wr.LUT),g.texture&&g.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),a.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(a.texcoordBuffer)),a.colorBuffer&&(f.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(a.colorBuffer)),a.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(a.normalBuffer)),a.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(a.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||f.push("DIFFUSE_SHADED");const Z=p.shadowRenderer;Z&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Z.useNormalOffset&&f.push("NORMAL_OFFSET"))}function _c(f,i,a,p,g,b){const T=a.paint.get("model-opacity").constantOr(1),M=i.context,O=new Ri(i.context.gl.LEQUAL,Ri.ReadWrite,i.depthRangeFor3D),L=i.transform,k=f.mesh,U=k.material,j=U.pbrMetallicRoughness,Z=i.style.fog;let ce;ce=i.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:r.ab.mat4.multiply([],p.zScaleMatrix,f.nodeModelMatrix),r.ab.mat4.multiply(ce,p.negCameraPosMatrix,ce);const te=r.ab.mat4.invert([],ce);r.ab.mat4.transpose(te,te);const _e=a.paint.get("model-color-use-theme").constantOr("default")==="none",me=a.paint.get("model-emissive-strength").constantOr(0),Se=of(new Float32Array(f.worldViewProjection),new Float32Array(ce),new Float32Array(te),null,i,T,j.baseColorFactor.toRenderColor(null),U.emissiveFactor,j.metallicFactor,j.roughnessFactor,U,me,a),ke={defines:[]},Oe=[],je=i.shadowRenderer;je&&(je.useNormalOffset=!1),Rh(ke.defines,Oe,k,i,_e?null:a.lut);let Ve=null;if(Z){const Ye=mc(f.nodeModelMatrix,i.transform);if(Ve=new Float32Array(Ye),L.projection.name!=="globe"){const it=k.aabb.min,xt=k.aabb.max,[_t,Rt]=Z.getOpacityForBounds(Ye,it[0],it[1],xt[0],xt[1]);ke.overrideFog=_t>=Le||Rt>=Le}}const Ue=tl(i,a.paint.get("model-cutoff-fade-range"));Ue.shouldRenderCutoff&&ke.defines.push("RENDER_CUTOFF");const Ne=i.getOrCreateProgram("model",ke);i.uploadCommonUniforms(M,Ne,null,Ve,Ue),i.renderPass!=="shadow"&&je&&je.setupShadowsFromMatrix(f.nodeModelMatrix,Ne),Ne.draw(i,M.gl.TRIANGLES,O,g,b,k.material.doubleSided?Fi.disabled:Fi.backCCW,Se,a.id,k.vertexBuffer,k.indexBuffer,k.segments,a.paint,i.transform.zoom,void 0,Oe)}function Qp(f,i,a,p,g,b,T){let M;M=f.projection.name==="globe"?r.dl(a,f):[...a],r.ab.mat4.multiply(M,M,i.matrix);const O=r.ab.mat4.multiply([],p,M);if(i.meshes)for(const L of i.meshes){if(L.material.alphaMode!=="BLEND"){T.push({mesh:L,depth:0,modelIndex:g,worldViewProjection:O,nodeModelMatrix:M});continue}const k=r.ab.vec3.transformMat4([],L.centroid,O);!f.isOrthographic&&k[2]<=0||b.push({mesh:L,depth:k[2],modelIndex:g,worldViewProjection:O,nodeModelMatrix:M})}if(i.children)for(const L of i.children)Qp(f,L,a,p,g,b,T)}function hf(f,i,a,p){const g=a.shadowRenderer;if(!g)return;const b=g.getShadowPassDepthMode(),T=g.getShadowPassColorMode(),M=g.calculateShadowPassMatrixFromMatrix(i),O=Gp(M);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,b,$i.disabled,T,Fi.backCCW,O,p.id,f.vertexBuffer,f.indexBuffer,f.segments,p.paint,a.transform.zoom,void 0,void 0)}function kl(f,i,a){const p=i.updateZoomBasedPaintProperties(),g=function(b,T,M){let O,L,k,U=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&U>0){const j=b.terrain,Z=j.findDEMTileFor(M);Z&&Z.dem?O=r.dn.create(j,M,Z):U=0}if(U===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),U===T.validForExaggeration&&(U===0||O&&O._demTile&&O._demTile.tileID===T.validForDEMTile.id&&O._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const j in T.instancesPerModel){const Z=T.instancesPerModel[j];for(let ce=0;ce<Z.instancedDataArray.length;++ce){const te=(O?U*O.getElevationAt(0|Z.instancedDataArray.float32[16*ce],0|Z.instancedDataArray.float32[16*ce+1],!0,!0):0)+Z.instancesEvaluatedElevation[ce];Z.instancedDataArray.float32[16*ce+6]=te,L=L?Math.min(T.terrainElevationMin,te):te,k=k?Math.max(T.terrainElevationMax,te):te}}return T.terrainElevationMin=L||0,T.terrainElevationMax=k||0,T.validForExaggeration=U,T.validForDEMTile=O&&O._demTile?{id:O._demTile.tileID,timestamp:O._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,i,a);(p||g)&&(i.uploaded=!1,i.upload(f.context))}const ho={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.cd([0,0,0],[r.ag,r.ag,0])};function em(f,i){const a=1<<f.canonical.z,p=i.getFreeCameraOptions().position,g=i.elevation,b=f.canonical.x/a,T=(f.canonical.x+1)/a,M=f.canonical.y/a,O=(f.canonical.y+1)/a;let L=i._centerAltitude;if(g){const Z=g.getMinMaxForTile(f);Z&&Z.max>L&&(L=Z.max)}const k=r.aw(p.x,b,T)-p.x,U=r.aw(p.y,M,O)-p.y,j=r.bH(L,i.center.lat)-p.z;return i._zoomFromMercatorZ(Math.sqrt(k*k+U*U+j*j))}function df(f,i,a,p,g,b,T){const M=f.context,O=f.renderPass==="shadow",L=f.shadowRenderer,k=O&&L?L.getShadowPassDepthMode():new Ri(M.gl.LEQUAL,Ri.ReadWrite,f.depthRangeFor3D),U=f.isTileAffectedByFog(b);if(a.meshes)for(const j of a.meshes){const Z=["MODEL_POSITION_ON_GPU"],ce=[];let te,_e,me;p.instancedDataArray.length>20&&Z.push("INSTANCED_ARRAYS");const Se=tl(f,i.paint.get("model-cutoff-fade-range"));if(Se.shouldRenderCutoff&&Z.push("RENDER_CUTOFF"),O&&L)te=f.getOrCreateProgram("modelDepth",{defines:Z}),_e=Gp(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(a.matrix)),me=L.getShadowPassColorMode();else{Rh(Z,ce,j,f,i.paint.get("model-color-use-theme").constantOr("default")==="none"?null:i.lut),te=f.getOrCreateProgram("model",{defines:Z,overrideFog:U});const Oe=j.material,je=Oe.pbrMetallicRoughness,Ve=i.paint.get("model-opacity").constantOr(1),Ue=i.paint.get("model-emissive-strength").constantOr(0);_e=of(b.expandedProjMatrix,Float32Array.from(a.matrix),new Float32Array(16),null,f,Ve,je.baseColorFactor.toRenderColor(null),Oe.emissiveFactor,je.metallicFactor,je.roughnessFactor,Oe,Ue,i,g),L&&(T.shadowUniformsInitialized?te.setShadowUniformValues(M,L.getShadowUniformValues()):(L.setupShadows(b.toUnwrapped(),te,"model-tile",b.overscaledZ),T.shadowUniformsInitialized=!0)),me=Se.shouldRenderCutoff||Ve<1||Oe.alphaMode!=="OPAQUE"?gr.alphaBlended:gr.unblended}f.uploadCommonUniforms(M,te,b.toUnwrapped(),null,Se);const ke=j.material.doubleSided?Fi.disabled:Fi.backCCW;if(p.instancedDataArray.length>20)ce.push(p.instancedDataBuffer),te.draw(f,M.gl.TRIANGLES,k,$i.disabled,me,ke,_e,i.id,j.vertexBuffer,j.indexBuffer,j.segments,i.paint,f.transform.zoom,void 0,ce,p.instancedDataArray.length);else{const Oe=O?"u_instance":"u_normal_matrix";for(let je=0;je<p.instancedDataArray.length;++je)_e[Oe]=new Float32Array(p.instancedDataArray.arrayBuffer,64*je,16),te.draw(f,M.gl.TRIANGLES,k,$i.disabled,me,ke,_e,i.id,j.vertexBuffer,j.indexBuffer,j.segments,i.paint,f.transform.zoom,void 0,ce)}}if(a.children)for(const j of a.children)df(f,i,j,p,g,b,T)}const xg=[1,-1,1];function bg(f,i,a,p){if(!a.modelManager)return!0;const g=a.modelManager;if(!a.shadowRenderer)return!0;const b=a.shadowRenderer,T=i.aabb;let M=!0,O=f.maxHeight;if(O===0){let k=0;for(const U in f.instancesPerModel){const j=g.getModel(U,p);j?k=Math.max(k,Math.max(Math.max(j.aabb.max[0],j.aabb.max[1]),j.aabb.max[2])):M=!1}O=f.maxScale*k*1.41+f.maxVerticalOffset,M&&(f.maxHeight=O)}T.max[2]=O,T.min[2]+=f.terrainElevationMin,T.max[2]+=f.terrainElevationMax,r.ab.vec3.transformMat4(T.min,T.min,i.tileMatrix),r.ab.vec3.transformMat4(T.max,T.max,i.tileMatrix);const L=T.intersects(b.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=L===2),L===0}function Iu(f,i){const a=f.uniformValues.u_cutoff_params[0],p=f.uniformValues.u_cutoff_params[1],g=f.uniformValues.u_cutoff_params[2],b=f.uniformValues.u_cutoff_params[3];return p===a||b===g?1:r.aw(((i-a)/(p-a)-g)/(b-g),0,1)}function wg(f,i,a,p){if(i.pitch<20)return 1;const g=i.getWorldToCameraMatrix();r.ab.mat4.multiply(g,g,f);const b=r.ab.vec4.fromValues(a.min[0],a.min[1],a.min[2],1);let T=r.ab.vec4.transformMat4(r.ab.vec4.create(),b,g),M=T,O=T;b[1]=a.max[1],T=r.ab.vec4.transformMat4(r.ab.vec4.create(),b,g),M=T[1]<M[1]?T:M,O=T[1]>O[1]?T:O,b[0]=a.max[0],T=r.ab.vec4.transformMat4(r.ab.vec4.create(),b,g),M=T[1]<M[1]?T:M,O=T[1]>O[1]?T:O,b[1]=a.min[1],T=r.ab.vec4.transformMat4(r.ab.vec4.create(),b,g),M=T[1]<M[1]?T:M,O=T[1]>O[1]?T:O;const L=r.aw(p[0],0,1),k=100*i.pixelsPerMeter*r.aw(p[1],0,1),U=r.aw(p[2],0,1),j=r.ab.vec4.lerp(r.ab.vec4.create(),M,O,L),Z=Math.tan(.5*i.fovX),ce=-j[2]*Z;if(k===0)return j[1]<-Math.abs(ce)?U:1;const te=(-Math.abs(ce)-j[1])/k,_e=(Se,ke,Oe)=>(1-Oe)*Se+Oe*ke,me=r.aw(_e(1,U,te),U,1);return _e(1,me,r.aw((i.pitch-20)/20,0,1))}class qc{}class Tg{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(i,a,p){{const U=this._storage.get(a.id);if(U)return U.lastUsedFrameIdx=i,U.buf}const g=p.gl,b=g.getBufferParameter(g.ELEMENT_ARRAY_BUFFER,g.BUFFER_SIZE),T=new ArrayBuffer(b),M=new Int16Array(T);g.getBufferSubData(g.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const O=new r.dq;for(let U=0;U<b/2;U+=3){const j=M[U],Z=M[U+1],ce=M[U+2];O.emplaceBack(j,Z),O.emplaceBack(Z,ce),O.emplaceBack(ce,j)}const L=p.bindVertexArrayOES.current,k=new qc;return k.buf=new Ol(p,O),k.lastUsedFrameIdx=i,this._storage.set(a.id,k),p.bindVertexArrayOES.set(L),k.buf}update(i){for(const[a,p]of this._storage)i-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(a))}destroy(){for(const[i,a]of this._storage)a.buf.destroy(),this._storage.delete(i)}}class tm{constructor(i){this.occluderSize=30,this.depthOffset=-1e-4,i.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),i.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Eg=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Sg{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Xs{constructor(i,a){this.revealStart=11,this.revealRange=2,i.registerParameter(this,[...a,"Reveal"],"revealStart",{min:0,max:17,step:.05}),i.registerParameter(this,[...a,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Ag=r.da([{type:"Float32",name:"a_pos_2f",components:2}]);class Cg{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(i,a){const p=i.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const T=new r.dr,M=new r.aU;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(1,1),T.emplaceBack(-1,1),M.emplaceBack(0,1,2),M.emplaceBack(0,2,3),this.vignetteVx=i.context.createVertexBuffer(T,Ag.members),this.vignetteIdx=i.context.createIndexBuffer(M)}const g=r.b7.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){i.uploadCommonUniforms(i.context,p);const T={u_vignetteShape:(b={vignetteShape:[a.start,a.range,Math.pow(10,a.fadePower)],vignetteColor:[a.color.r,a.color.g,a.color.b,a.color.a*a.strength]}).vignetteShape,u_vignetteColor:b.vignetteColor};p.draw(i,i.context.gl.TRIANGLES,Ri.disabled,$i.disabled,gr.alphaBlended,Fi.disabled,T,"vignette",this.vignetteVx,this.vignetteIdx,g,{})}var b}}class ff{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(i,a){const p=i.getFreeCameraOptions().position,g=p.toAltitude(),b=p.toLngLat(),T=r.ai(b.lng),M=r.ai(b.lat),O=i.pixelsPerMeter/a,L=T*r.ds,k=r.ds*Math.log(Math.tan(Math.PI/4+M/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const U=-this._offsetYPrev+k,j=-this._elevationPrev+g;this._accumulatedOffsetX+=(-this._offsetXPrev+L)*O,this._accumulatedOffsetY+=U*O,this._accumulatedElevation+=j*O,this._offsetXPrev=L,this._offsetYPrev=k,this._elevationPrev=g}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Hc(f,i){return[-(f[0]-Math.floor(f[0]/i)*i),-(f[1]-Math.floor(f[1]/i)*i),-(f[2]-Math.floor(f[2]/i)*i)]}function im(f){const i=r.di(1323123451230),a=[];for(let p=0;p<f;++p){const g=2*i()-1,b=2*i()-1,T=2*i()-1;a.push(r.ab.vec3.fromValues(g,b,T))}return a}function zl(f,i,a,p,g){const b=r.aw((g-a)/(p-a),0,1);return(1-b)*f+b*i}class rm{constructor(i){this._movement=new ff,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Cg,this._ppmScaleFactor=i}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(i,a){const p=i.transform;this._movement.update(p,this._ppmScaleFactor);const g=p.starsProjMatrix,b=r.ab.quat.identity([]);r.ab.quat.rotateX(b,b,r.ai(90)-p._pitch),r.ab.quat.rotateZ(b,b,-p.angle);const T=r.ab.mat4.fromQuat(new Float32Array(16),b),M=r.ab.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),O=r.ab.mat4.transpose([],M),L=r.ab.mat4.multiply([],O,T),k=Date.now()/1e3;return this._accumulatedTimeFromStart+=(k-this._prevTime)*a,this._prevTime=k,{projectionMatrix:g,modelviewMatrix:L}}}class Dh extends rm{constructor(i){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Xs(i.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(i){const a=i.context;if(!this.particlesVx){const p=im(this.particlesCount),g=new r.dt,b=new r.aU;let T=0;const M=r.di(1323123451230);for(let O=0;O<p.length;++O){const L=p[O],k=[2*M()-1,M(),M(),M()];g.emplaceBack(L[0],L[1],L[2],-1,-1,...k),g.emplaceBack(L[0],L[1],L[2],1,-1,...k),g.emplaceBack(L[0],L[1],L[2],1,1,...k),g.emplaceBack(L[0],L[1],L[2],-1,1,...k),b.emplaceBack(T+0,T+1,T+2),b.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=a.createVertexBuffer(g,Eg.members),this.particlesIdx=a.createIndexBuffer(b)}}draw(i){if(!this._params.overrideStyleParameters&&!i.style.rain)return;const a=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=i.transform.zoom;if(a.revealStart>p)return;const g=zl(0,1,a.revealStart,a.revealStart+a.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;const b=structuredClone(this._params);let T=[-b.direction.x,b.direction.y,-100];r.ab.vec3.normalize(T,T);const M=structuredClone(this._vignetteParams);M.strength*=g,b.overrideStyleParameters||(b.intensity=i.style.rain.state.density,b.timeFactor=i.style.rain.state.intensity,b.color=structuredClone(i.style.rain.state.color),T=structuredClone(i.style.rain.state.direction),b.screenThinning.intensity=i.style.rain.state.centerThinning,b.dropletSizeX=i.style.rain.state.dropletSize[0],b.dropletSizeYScale=i.style.rain.state.dropletSize[1]/i.style.rain.state.dropletSize[0],b.distortionStrength=100*i.style.rain.state.distortionStrength,M.strength=1,M.color=structuredClone(i.style.rain.state.vignetteColor));const O=this.updateOnRender(i,b.timeFactor),L=i.context,k=L.gl,U=i.transform;this.screenTexture&&this.screenTexture.size[0]===i.width&&this.screenTexture.size[1]===i.height||(this.screenTexture=new r.T(L,{width:i.width,height:i.height,data:null},k.RGBA8)),b.distortionStrength>0&&(L.activeTexture.set(k.TEXTURE0),this.screenTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),k.copyTexSubImage2D(k.TEXTURE_2D,0,0,0,0,0,i.width,i.height));const j=i.getOrCreateProgram("rainParticle");i.uploadCommonUniforms(L,j),L.activeTexture.set(k.TEXTURE0),this.screenTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const Z=[b.color.r,b.color.g,b.color.b,b.color.a],ce=(te,_e)=>{const me=Hc(this._movement.getPosition(),te),Se=b.dropletSizeX,ke=b.dropletSizeX*b.dropletSizeYScale,Oe=i.width/2,je=i.height/2,Ve=zl(0,b.screenThinning.start,0,1,b.screenThinning.intensity),Ue=zl(.001,b.screenThinning.range,0,1,b.screenThinning.intensity),Ne=zl(0,b.screenThinning.particleOffset,0,1,b.screenThinning.intensity),Ye=(it={modelview:O.modelviewMatrix,projection:O.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:me,velocityConeAperture:b.velocityConeAperture,velocity:b.velocity,boxSize:te,rainDropletSize:[Se,ke],distortionStrength:b.distortionStrength,rainDirection:T,color:Z,screenSize:[U.width,U.height],thinningCenterPos:[Oe,je],thinningShape:[Ve,Ue,Math.pow(10,b.screenThinning.fadePower)],thinningAffectedRatio:b.screenThinning.affectedRatio,thinningParticleOffset:Ne,shapeDirectionalPower:b.shapeDirPower,shapeNormalPower:b.shapeNormalPower,mode:_e?0:1},{u_modelview:Float32Array.from(it.modelview),u_projection:Float32Array.from(it.projection),u_time:it.time,u_cam_pos:it.camPos,u_texScreen:0,u_velocityConeAperture:it.velocityConeAperture,u_velocity:it.velocity,u_boxSize:it.boxSize,u_rainDropletSize:it.rainDropletSize,u_distortionStrength:it.distortionStrength,u_rainDirection:it.rainDirection,u_color:it.color,u_screenSize:it.screenSize,u_thinningCenterPos:it.thinningCenterPos,u_thinningShape:it.thinningShape,u_thinningAffectedRatio:it.thinningAffectedRatio,u_thinningParticleOffset:it.thinningParticleOffset,u_shapeDirectionalPower:it.shapeDirectionalPower,u_shapeNormalPower:it.shapeNormalPower,u_mode:it.mode});var it;const xt=Math.round(b.intensity*this.particlesCount),_t=r.b7.simpleSegment(0,0,4*xt,2*xt);j.draw(i,k.TRIANGLES,Ri.disabled,$i.disabled,gr.alphaBlended,Fi.disabled,Ye,"rain_particles",this.particlesVx,this.particlesIdx,_t,{})};b.distortionStrength>0&&ce(b.boxSize,!0),ce(b.boxSize,!1),this._vignette.draw(i,M)}}const Mg=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Ig extends rm{constructor(i){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Xs(i.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(i){const a=i.context;if(!this.particlesVx){const p=im(this.particlesCount),g=new r.du,b=new r.aU;let T=0;const M=r.di(1323123451230);for(let O=0;O<p.length;++O){const L=p[O],k=M(),U=M(),j=M(),Z=[O/p.length,k,U,j],ce=[M(),M()];g.emplaceBack(L[0],L[1],L[2],-1,-1,...Z,...ce),g.emplaceBack(L[0],L[1],L[2],1,-1,...Z,...ce),g.emplaceBack(L[0],L[1],L[2],1,1,...Z,...ce),g.emplaceBack(L[0],L[1],L[2],-1,1,...Z,...ce),b.emplaceBack(T+0,T+1,T+2),b.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=a.createVertexBuffer(g,Mg.members),this.particlesIdx=a.createIndexBuffer(b)}}draw(i){if(!this._params.overrideStyleParameters&&!i.style.snow)return;const a=structuredClone(this._params);let p=[-a.direction.x,a.direction.y,-100];r.ab.vec3.normalize(p,p);const g=structuredClone(this._vignetteParams),b=a.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},T=i.transform.zoom;if(b.revealStart>T)return;const M=zl(0,1,b.revealStart,b.revealStart+b.revealRange,T);g.strength*=M,a.overrideStyleParameters||(a.intensity=i.style.snow.state.density,a.timeFactor=i.style.snow.state.intensity,a.color=structuredClone(i.style.snow.state.color),p=structuredClone(i.style.snow.state.direction),a.screenThinning.intensity=i.style.snow.state.centerThinning,a.billboardSize=2.79*i.style.snow.state.flakeSize,g.strength=1,g.color=structuredClone(i.style.snow.state.vignetteColor));const O=this.updateOnRender(i,a.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const L=i.context,k=L.gl,U=i.transform,j=i.getOrCreateProgram("snowParticle");i.uploadCommonUniforms(L,j),((Z,ce,te)=>{const _e=Hc(this._movement.getPosition(),Z),me=U.width/2,Se=U.height/2,ke=zl(0,te.screenThinning.start,0,1,te.screenThinning.intensity),Oe=zl(.001,te.screenThinning.range,0,1,te.screenThinning.intensity),je=zl(0,te.screenThinning.particleOffset,0,1,te.screenThinning.intensity),Ve=(Ue={modelview:O.modelviewMatrix,projection:O.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:_e,velocityConeAperture:te.velocityConeAperture,velocity:te.velocity,horizontalOscillationRadius:te.horizontalOscillationRadius,horizontalOscillationRate:te.horizontalOscillationRate,boxSize:Z,billboardSize:1*te.billboardSize,simpleShapeParameters:[te.shapeFadeStart,te.shapeFadePower],screenSize:[U.width,U.height],thinningCenterPos:[me,Se],thinningShape:[ke,Oe,Math.pow(10,te.screenThinning.fadePower)],thinningAffectedRatio:te.screenThinning.affectedRatio,thinningParticleOffset:je,color:[te.color.r,te.color.g,te.color.b,te.color.a],direction:p},{u_modelview:Float32Array.from(Ue.modelview),u_projection:Float32Array.from(Ue.projection),u_time:Ue.time,u_cam_pos:Ue.camPos,u_velocityConeAperture:Ue.velocityConeAperture,u_velocity:Ue.velocity,u_horizontalOscillationRadius:Ue.horizontalOscillationRadius,u_horizontalOscillationRate:Ue.horizontalOscillationRate,u_boxSize:Ue.boxSize,u_billboardSize:Ue.billboardSize,u_simpleShapeParameters:Ue.simpleShapeParameters,u_screenSize:Ue.screenSize,u_thinningCenterPos:Ue.thinningCenterPos,u_thinningShape:Ue.thinningShape,u_thinningAffectedRatio:Ue.thinningAffectedRatio,u_thinningParticleOffset:Ue.thinningParticleOffset,u_particleColor:Ue.color,u_direction:Ue.direction});var Ue;const Ne=Math.round(te.intensity*this.particlesCount),Ye=r.b7.simpleSegment(0,0,4*Ne,2*Ne);this.particlesVx&&this.particlesIdx&&j.draw(i,k.TRIANGLES,Ri.disabled,$i.disabled,gr.alphaBlended,Fi.disabled,Ve,"snow_particles",this.particlesVx,this.particlesIdx,Ye,{})})(a.boxSize,0,a),this._vignette.draw(i,g)}}const pf={symbol:function(f,i,a,p,g){if(f.renderPass!=="translucent")return;const b=$i.disabled,T=f.colorModeForRenderPass(),M=a.layout.get("text-variable-anchor"),O=a.layout.get("text-size-scale-range"),L=r.aw(f.scaleFactor,O[0],O[1]);M&&function(j,Z,ce,te,_e,me,Se,ke){const Oe=Z.transform,je=_e==="map",Ve=me==="map";for(const Ue of j){const Ne=te.getTile(Ue),Ye=Ne.getBucket(ce);if(!Ye||!Ye.text||!Ye.text.segments.get().length)continue;const it=r.bp(Ye.textSizeData,Oe.zoom,ke),xt=ac(Ue,Ye.getProjection(),Oe),_t=Oe.calculatePixelsToTileUnitsMatrix(Ne),Rt=Es(xt,Ne.tileID.canonical,Ve,je,Oe,Ye.getProjection(),_t),Pt=Ye.hasIconTextFit()&&Ye.hasIconData();if(it){const ht=Math.pow(2,Oe.zoom-Ne.tileID.overscaledZ);Zp(Ye,je,Ve,Se,r.cX,Oe,Rt,Ue,ht,it,Pt)}}}(p,f,a,i,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),g,L);const k=a.paint.get("icon-opacity").constantOr(1)!==0,U=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(k||U)?lf(f,i,a,p,b,T):(k&&lf(f,i,a,p,b,T,{onlyIcons:!0}),U&&lf(f,i,a,p,b,T,{onlyText:!0})),i.map.showCollisionBoxes&&(Wp(f,i,a,p,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),Wp(f,i,a,p,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(f,i,a,p){if(f.renderPass!=="translucent")return;const g=a.paint.get("circle-opacity"),b=a.paint.get("circle-stroke-width"),T=a.paint.get("circle-stroke-opacity"),M=a.layout.get("circle-sort-key").constantOr(1)!==void 0,O=a.paint.get("circle-emissive-strength");if(g.constantOr(1)===0&&(b.constantOr(1)===0||T.constantOr(1)===0))return;const L=f.context,k=L.gl,U=f.transform,j=f.depthModeForSublayer(0,Ri.ReadOnly),Z=$i.disabled,ce=f.colorModeForDrapableLayerRenderPass(O),te=U.projection.name==="globe",_e=[r.at(U.center.lng),r.aA(U.center.lat)],me=[];for(let ke=0;ke<p.length;ke++){const Oe=p[ke],je=i.getTile(Oe),Ve=je.getBucket(a);if(!Ve||Ve.projection.name!==U.projection.name)continue;const Ue=Ve.programConfigurations.get(a.id),Ne=r.cY(a),Ye=f.isTileAffectedByFog(Oe);te&&Ne.push("PROJECTION_GLOBE_VIEW"),Ne.push("DEPTH_D24"),f.terrain&&U.depthOcclusionForSymbolsAndCircles&&Ne.push("DEPTH_OCCLUSION");const it=f.getOrCreateProgram("circle",{config:Ue,defines:Ne,overrideFog:Ye}),xt=Ve.layoutVertexBuffer,_t=Ve.globeExtVertexBuffer,Rt=Ve.indexBuffer,Pt=U.projection.createInversionMatrix(U,Oe.canonical),ht={programConfiguration:Ue,program:it,layoutVertexBuffer:xt,globeExtVertexBuffer:_t,indexBuffer:Rt,uniformValues:r.cZ(f,Oe,je,Pt,_e,a),tile:je};if(M){const bt=Ve.segments.get();for(const Vt of bt)me.push({segments:new r.b7([Vt]),sortKey:Vt.sortKey,state:ht})}else me.push({segments:Ve.segments,sortKey:0,state:ht})}M&&me.sort((ke,Oe)=>ke.sortKey-Oe.sortKey);const Se={useDepthForOcclusion:U.depthOcclusionForSymbolsAndCircles};for(const ke of me){const{programConfiguration:Oe,program:je,layoutVertexBuffer:Ve,globeExtVertexBuffer:Ue,indexBuffer:Ne,uniformValues:Ye,tile:it}=ke.state,xt=ke.segments;f.terrain&&f.terrain.setupElevationDraw(it,je,Se),f.uploadCommonUniforms(L,je,it.tileID.toUnwrapped()),je.draw(f,k.TRIANGLES,j,Z,ce,Fi.disabled,Ye,a.id,Ve,Ne,xt,a.paint,U.zoom,Oe,[Ue])}},heatmap:function(f,i,a,p){if(a.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const g=f.context,b=g.gl,T=$i.disabled,M=new gr([b.ONE,b.ONE,b.ONE,b.ONE],r.aj.transparent,[!0,!0,!0,!0]);(function(Z,ce,te,_e){const me=Z.gl,Se=ce.width*_e,ke=ce.height*_e;Z.activeTexture.set(me.TEXTURE1),Z.viewport.set([0,0,Se,ke]);let Oe=te.heatmapFbo;if(!Oe||Oe&&(Oe.width!==Se||Oe.height!==ke)){Oe&&Oe.destroy();const je=me.createTexture();me.bindTexture(me.TEXTURE_2D,je),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_WRAP_S,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_WRAP_T,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_MIN_FILTER,me.LINEAR),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_MAG_FILTER,me.LINEAR),Oe=te.heatmapFbo=Z.createFramebuffer(Se,ke,!0,null),function(Ve,Ue,Ne,Ye,it,xt){const _t=Ve.gl;_t.texImage2D(_t.TEXTURE_2D,0,Ve.extRenderToTextureHalfFloat?_t.RGBA16F:_t.RGBA,it,xt,0,_t.RGBA,Ve.extRenderToTextureHalfFloat?_t.HALF_FLOAT:_t.UNSIGNED_BYTE,null),Ye.colorAttachment.set(Ne)}(Z,0,je,Oe,Se,ke)}else me.bindTexture(me.TEXTURE_2D,Oe.colorAttachment.get()),Z.bindFramebuffer.set(Oe.framebuffer)})(g,f,a,f.transform.projection.name==="globe"?.5:.25),g.clear({color:r.aj.transparent});const O=f.transform,L=O.projection.name==="globe",k=L?["PROJECTION_GLOBE_VIEW"]:[],U=L?Fi.frontCCW:Fi.disabled,j=[r.at(O.center.lng),r.aA(O.center.lat)];for(let Z=0;Z<p.length;Z++){const ce=p[Z];if(i.hasRenderableParent(ce))continue;const te=i.getTile(ce),_e=te.getBucket(a);if(!_e||_e.projection.name!==O.projection.name)continue;const me=f.isTileAffectedByFog(ce),Se=_e.programConfigurations.get(a.id),ke=f.getOrCreateProgram("heatmap",{config:Se,defines:k,overrideFog:me}),{zoom:Oe}=f.transform;f.terrain&&f.terrain.setupElevationDraw(te,ke),f.uploadCommonUniforms(g,ke,ce.toUnwrapped());const je=O.projection.createInversionMatrix(O,ce.canonical);ke.draw(f,b.TRIANGLES,Ri.disabled,T,M,U,gi(f,ce,te,je,j,Oe,a.paint.get("heatmap-intensity")),a.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,a.paint,f.transform.zoom,Se,L?[_e.globeExtVertexBuffer]:null)}g.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(g,b){const T=g.context,M=T.gl,O=b.heatmapFbo;if(!O)return;T.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,O.colorAttachment.get()),T.activeTexture.set(M.TEXTURE1);let L=b.colorRampTexture;L||(L=b.colorRampTexture=new r.T(T,b.colorRamp,M.RGBA8)),L.bind(M.LINEAR,M.CLAMP_TO_EDGE),g.getOrCreateProgram("heatmapTexture").draw(g,M.TRIANGLES,Ri.disabled,$i.disabled,g.colorModeForRenderPass(),Fi.disabled,((k,U,j,Z)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,b),b.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,b.paint,g.transform.zoom)}(f,a))},line:function(f,i,a,p){if(f.renderPass!=="translucent")return;const g=a.paint.get("line-opacity"),b=a.paint.get("line-width");if(g.constantOr(1)===0||b.constantOr(1)===0)return;const T=a.paint.get("line-emissive-strength"),M=a.paint.get("line-occlusion-opacity"),O=a.layout.get("line-elevation-reference"),L=a.layout.get("line-width-unit")==="meters",k=O==="sea",U=f.context,j=U.gl;if(a.hasElevatedBuckets&&f.transform.projection.name==="globe")return;const Z=a.layout.get("line-cross-slope"),ce=Z!==void 0,te=Z<1,_e=f.colorModeForDrapableLayerRenderPass(T),me=f.terrain&&f.terrain.renderingToTexture,Se=me?1:r.q.devicePixelRatio,ke=a.paint.get("line-dasharray"),Oe=ke.constantOr(1),je=a.layout.get("line-cap"),Ve=ke.constantOr(null),Ue=je.constantOr(null),Ne=a.paint.get("line-pattern"),Ye=Ne.constantOr(1),it=Ne.constantOr(null),xt=a.paint.get("line-opacity").constantOr(1);let _t=!Ye&&xt!==1||f.depthOcclusion&&M>0&&M<1;const Rt=a.paint.get("line-gradient"),Pt=Ye?"linePattern":"line",ht=r.c_(a);let bt;if(me&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(_t=!1),M!==0&&f.depthOcclusion){const ut=a.paint._values["line-opacity"];ut&&ut.value&&ut.value.kind==="constant"?bt=ut.value:r.w(`Occlusion opacity for layer ${a.id} is supported only when line-opacity isn't data-driven.`)}b.value.kind!=="constant"&&b.value.isLineProgressConstant===!1&&ht.push("VARIABLE_LINE_WIDTH");const Vt=(ut,Ot,wt,Qt,kt)=>{for(const Dt of ut){const Gt=i.getTile(Dt);if(Ye&&!Gt.patternsLoaded())continue;const Jt=Gt.getBucket(a);if(!Jt||Jt.hasZOffset&&!kt||!Jt.hasZOffset&&kt)continue;f.prepareDrawTile();const ci=Jt.programConfigurations.get(a.id),_i=f.isTileAffectedByFog(Dt),qi=f.getOrCreateProgram(Pt,{config:ci,defines:Ot,overrideFog:_i,overrideRtt:!kt&&void 0});if(it&&Gt.imageAtlas){const ar=r.A.from(it).getPrimary().scaleSelf(Se).serialize(),Nr=Gt.imageAtlas.patternPositions[ar];Nr&&ci.setConstantPatternPositions(Nr)}if(!Ye&&Ve&&Ue&&Gt.lineAtlas){const ar=Gt.lineAtlas.getDash(Ve,Ue);ar&&ci.setConstantPatternPositions(ar)}let[Di,Oi]=a.paint.get("line-trim-offset");(Ue==="round"||Ue==="square")&&Di!==Oi&&(Di===0&&(Di-=1),Oi===1&&(Oi+=1));const er=me?Dt.projMatrix:null,Pr=L?1/Jt.tileToMeter/r.ar(Gt,1,f.transform.zoom):1,Xr=L?1/Jt.tileToMeter/r.ar(Gt,1,Math.floor(f.transform.zoom)):1,Hn=Ye?r.c$(f,Gt,a,er,Se,Pr,Xr,[Di,Oi]):r.d0(f,Gt,a,er,Jt.lineClipsArray.length,Se,Pr,Xr,[Di,Oi]);if(Rt){const ar=Jt.gradients[a.id];let Nr=ar.texture;if(a.gradientVersion!==ar.version){let Ai=256;if(a.stepInterpolant){const Mr=i.getSource().maxzoom,jr=Dt.canonical.z===Mr?Math.ceil(1<<f.transform.maxZoom-Dt.canonical.z):1;Ai=r.aw(r.d1(Jt.maxLineLength/r.ag*1024*jr),256,U.maxTextureSize)}ar.gradient=r.d2({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:Ai,image:ar.gradient||void 0,clips:Jt.lineClipsArray}),ar.texture?ar.texture.update(ar.gradient):ar.texture=new r.T(U,ar.gradient,j.RGBA8),ar.version=a.gradientVersion,Nr=ar.texture}U.activeTexture.set(j.TEXTURE1),Nr.bind(a.stepInterpolant?j.NEAREST:j.LINEAR,j.CLAMP_TO_EDGE)}Oe&&(U.activeTexture.set(j.TEXTURE0),Gt.lineAtlasTexture&&Gt.lineAtlasTexture.bind(j.LINEAR,j.REPEAT),ci.updatePaintBuffers()),Ye&&(U.activeTexture.set(j.TEXTURE0),Gt.imageAtlasTexture&&Gt.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),ci.updatePaintBuffers()),kt&&!k&&f.terrain.setupElevationDraw(Gt,qi),f.uploadCommonUniforms(U,qi,Dt.toUnwrapped());const Tn=ar=>{bt!=null&&(bt.value=xt*M),qi.draw(f,j.TRIANGLES,wt,ar,_e,Fi.disabled,Hn,a.id,Jt.layoutVertexBuffer,Jt.indexBuffer,Jt.segments,a.paint,f.transform.zoom,ci,[Jt.layoutVertexBuffer2,Jt.patternVertexBuffer,Jt.zOffsetVertexBuffer]),bt!=null&&(bt.value=xt)};if(_t&&!kt){const ar=f.stencilModeForClipping(Dt).ref;ar===0&&me&&U.clear({stencil:0});const Nr={func:j.EQUAL,mask:255};Hn.u_alpha_discard_threshold=.8,Tn(new $i(Nr,ar,255,j.KEEP,j.KEEP,j.INVERT)),Hn.u_alpha_discard_threshold=0,Tn(new $i(Nr,ar,255,j.KEEP,j.KEEP,j.KEEP))}else _t&&kt&&(Hn.u_alpha_discard_threshold=.001),Tn(kt?Qt:f.stencilModeForClipping(Dt))}};if(a.hasNonElevatedBuckets){const ut=!me&&f.terrain;M!==0&&ut?r.w(`Occlusion opacity for layer ${a.id} is supported on terrain only if the layer has line-z-offset enabled.`):ut?r.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${a.id}.`):Vt(p,ht,f.depthModeForSublayer(0,Ri.ReadOnly),$i.disabled,!1)}if(a.hasElevatedBuckets){ht.push("ELEVATED"),ce&&ht.push(te?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),k&&ht.push("ELEVATION_REFERENCE_SEA");const ut=_t?f.stencilModeFor3D():$i.disabled,Ot=new Ri(f.depthOcclusion?j.GREATER:j.LEQUAL,Ri.ReadOnly,f.depthRangeFor3D);f.forceTerrainMode=!0,Vt(p,ht,Ot,ut,!0),f.forceTerrainMode=!1}_t&&(f.resetStencilClippingMasks(),me&&U.clear({stencil:0})),M===0||f.depthOcclusion||me||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,i,a,p){const g=a.paint.get("fill-color"),b=a.paint.get("fill-opacity"),T=a.is3D(),M=new Ri(f.context.gl.LEQUAL,Ri.ReadWrite,f.depthRangeFor3D);if(b.constantOr(1)===0)return;const O=a.paint.get("fill-emissive-strength"),L=f.colorModeForDrapableLayerRenderPass(O),k=a.paint.get("fill-pattern"),U=f.opaquePassEnabledForLayer()&&!k.constantOr(1)&&g.constantOr(r.aj.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===U){const j=T?M:f.depthModeForSublayer(1,f.renderPass==="opaque"?Ri.ReadWrite:Ri.ReadOnly);_g(f,i,a,p,j,L,!1)}if(!T&&f.renderPass==="translucent"&&a.paint.get("fill-antialias")){const j=T?M:f.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,Ri.ReadOnly);_g(f,i,a,p,j,L,!0)}},"fill-extrusion":function(f,i,a,p){const g=a.paint.get("fill-extrusion-opacity"),b=f.context,T=b.gl,M=f.terrain,O=M&&M.renderingToTexture;if(g===0)return;const L=f.conflationActive&&f.style.isLayerClipped(a,i.getSource()),k=f.style.order.indexOf(a.fqid);if(L&&function(U,j,Z,ce,te){for(const _e of ce){const me=j.getTile(_e).getBucket(Z);me&&(me.updateReplacement(_e,U.replacementSource,te),me.uploadCentroid(U.context))}}(f,i,a,p,k),M||L)for(const U of p){const j=i.getTile(U).getBucket(a);j&&Ch(f.context,i,U,j,a,M,L)}if(f.renderPass==="shadow"&&f.shadowRenderer){const U=f.shadowRenderer;if(M&&g<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.a9)return;const j=U.getShadowPassDepthMode(),Z=U.getShadowPassColorMode();cf(f,i,a,p,j,$i.disabled,Z,L)}else if(f.renderPass==="translucent"){const U=!a.paint.get("fill-extrusion-pattern").constantOr(1),j=a.paint.get("fill-extrusion-color").constantOr(r.aj.white);if(!O&&j.a!==0){const Z=new Ri(f.context.gl.LEQUAL,Ri.ReadWrite,f.depthRangeFor3D);g===1&&U?cf(f,i,a,p,Z,$i.disabled,gr.unblended,L):(cf(f,i,a,p,Z,$i.disabled,gr.disabled,L),cf(f,i,a,p,Z,f.stencilModeFor3D(),f.colorModeForRenderPass(),L),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&U&&(!M&&f.transform.projection.name!=="globe"||O)){const Z=a.paint.get("fill-extrusion-opacity"),ce=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),te=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),_e=a.paint.get("fill-extrusion-flood-light-intensity"),me=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Se=a.paint.get("fill-extrusion-flood-light-color").toRenderColor(me?null:a.lut).toArray01().slice(0,3),ke=ce>0&&te>0,Oe=_e>0,je=(Ue,Ne,Ye)=>(1-Ye)*Ue+Ye*Ne,Ve=Ue=>{const Ne=f.depthModeForSublayer(1,Ri.ReadOnly,T.LEQUAL,!0),Ye=a.paint.get(Ue?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),it=je(.1,3,Ye),xt=f._showOverdrawInspector;if(!xt){const _t=new $i({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),Rt=new gr([T.ONE,T.ONE,T.ONE,T.ONE],r.aj.transparent,[!1,!1,!1,!0],T.MIN);Ah(f,i,a,p,Ne,_t,Rt,Fi.disabled,Ue,"sdf",Z,ce,te,_e,Se,it,L,!1)}{const _t=xt?$i.disabled:new $i({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),Rt=xt?f.colorModeForRenderPass():new gr([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],r.aj.transparent,[!0,!0,!0,!0]);Ah(f,i,a,p,Ne,_t,Rt,Fi.disabled,Ue,"color",Z,ce,te,_e,Se,it,L,!1)}};if(O){const Ue=(Ne,Ye,it)=>{const xt=f.depthModeForSublayer(1,Ri.ReadOnly,T.LEQUAL,!1),_t=a.paint.get(Ne?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Rt=je(.1,3,_t);{const Pt=new gr([T.ONE,T.ONE,T.ONE,T.ONE],r.aj.transparent,[!1,!1,!1,!0]);Ah(f,i,a,p,xt,$i.disabled,Pt,Fi.disabled,Ne,"clear",Z,ce,te,_e,Se,Rt,L,Ye)}{const Pt=new $i({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),ht=new gr([T.ONE,T.ONE,T.ONE,T.ONE],r.aj.transparent,[!1,!1,!1,!0],T.MIN);Ah(f,i,a,p,xt,Pt,ht,Fi.disabled,Ne,"sdf",Z,ce,te,_e,Se,Rt,L,Ye)}{const Pt=Ne?T.ZERO:T.ONE_MINUS_DST_ALPHA,ht=new $i({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),bt=new gr([Pt,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],r.aj.transparent,[!0,!0,!0,!0]);Ah(f,i,a,p,xt,ht,bt,Fi.disabled,Ne,"color",Z,ce,te,_e,Se,Rt,L,Ye)}{const Pt=new gr([T.ONE,T.ONE,T.ONE,Ne?T.ZERO:T.ONE],r.aj.transparent,[!1,!1,!1,!0],Ne?T.FUNC_ADD:T.MAX);Ah(f,i,a,p,xt,$i.disabled,Pt,Fi.disabled,Ne,"clear",Z,ce,te,_e,Se,Rt,L,Ye,it)}};if(ke||Oe){let Ne;if(f.prepareDrawTile(),M){const Ye=M.drapeBufferSize[0],it=M.drapeBufferSize[1];Ne=M.framebufferCopyTexture,Ne&&(!Ne||Ne.size[0]===Ye&&Ne.size[1]===it)||(Ne&&Ne.destroy(),Ne=M.framebufferCopyTexture=new r.T(b,new r.r({width:Ye,height:it}),T.RGBA8)),Ne.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexSubImage2D(T.TEXTURE_2D,0,0,0,0,0,Ye,it)}ke&&Ue(!0,!1,Ne),Oe&&Ue(!1,!0,Ne)}}else ke&&Ve(!0),Oe&&Ve(!1),(ke||Oe)&&f.resetStencilClippingMasks()}}},hillshade:function(f,i,a,p){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const g=f.context,b=f.terrain&&f.terrain.renderingToTexture,[T,M]=f.renderPass!=="translucent"||b?[{},p]:f.stencilConfigForOverlap(p);for(const O of M){const L=i.getTile(O);if(L.needsHillshadePrepare&&f.renderPass==="offscreen")Nc(f,L,a);else if(f.renderPass==="translucent"){const k=f.depthModeForSublayer(0,Ri.ReadOnly),U=a.paint.get("hillshade-emissive-strength"),j=f.colorModeForDrapableLayerRenderPass(U),Z=b&&f.terrain?f.terrain.stencilModeForRTTOverlap(O):T[O.overscaledZ];ns(f,O,L,a,k,Z,j)}}g.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,i,a,p,g,b){if(f.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;const T=f.transform.projection.name==="globe",M=a.paint.get("raster-elevation")!==0,O=M&&T;if(f.renderElevatedRasterBackface&&!O)return;const L=f.context,k=L.gl,U=i.getSource(),j=function(Ve,Ue,Ne,Ye){const it=Ue.paint.get("raster-color"),xt=Ve.type==="raster-array",_t=[],Rt=Ue.paint.get("raster-resampling"),Pt=Ue.paint.get("raster-color-mix");let ht=Ue.paint.get("raster-color-range");const bt=[Pt[0],Pt[1],Pt[2],0],Vt=Pt[3];let ut=Rt==="nearest"?Ye.NEAREST:Ye.LINEAR;if(xt&&(_t.push("RASTER_ARRAY"),it||_t.push("RASTER_COLOR"),Rt==="linear"&&_t.push("RASTER_ARRAY_LINEAR"),ut=Ye.NEAREST,!ht&&Ve.rasterLayers)){const Ot=Ve.rasterLayers.find(({id:wt})=>wt===Ue.sourceLayer);Ot&&Ot.fields&&Ot.fields.range&&(ht=Ot.fields.range)}if(ht=ht||[0,1],it){_t.push("RASTER_COLOR"),Ne.activeTexture.set(Ye.TEXTURE2),Ue.updateColorRamp(ht);let Ot=Ue.colorRampTexture;Ot||(Ot=Ue.colorRampTexture=new r.T(Ne,Ue.colorRamp,Ye.RGBA8)),Ot.bind(Ye.LINEAR,Ye.CLAMP_TO_EDGE)}return{mix:bt,range:ht,offset:Vt,defines:_t,resampling:ut}}(U,a,L,k);if(U instanceof r.aJ&&!p.length&&!T)return;const Z=a.paint.get("raster-emissive-strength"),ce=f.colorModeForDrapableLayerRenderPass(Z),te=f.terrain&&f.terrain.renderingToTexture,_e=!f.options.moving,me=a.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;if(U instanceof r.aJ&&!p.length&&(U.onNorthPole||U.onSouthPole)){const Ve=M?f.stencilModeFor3D():$i.disabled;return void gt(!!U.onNorthPole,null,f,i,a,Z,j,Fi.disabled,Ve)}if(!p.length)return;const[Se,ke]=U instanceof r.aJ||te?[{},p]:f.stencilConfigForOverlap(p),Oe=ke[ke.length-1].overscaledZ;O&&j.defines.push("PROJECTION_GLOBE_VIEW"),M&&j.defines.push("RENDER_CUTOFF");const je=(Ve,Ue,Ne)=>{for(const Ye of Ve){const it=Ye.toUnwrapped(),xt=i.getTile(Ye);if(te&&(!xt||!xt.hasData()))continue;L.activeTexture.set(k.TEXTURE0);const _t=Xp(xt,U,a,j);if(!_t||!_t.texture)continue;const{texture:Rt,mix:Pt,offset:ht,tileSize:bt,buffer:Vt}=_t;let ut,Ot;te?(ut=Ri.disabled,Ot=Ye.projMatrix):M?(ut=new Ri(k.LEQUAL,Ri.ReadWrite,f.depthRangeFor3D),Ot=T?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(it,_e)):(ut=f.depthModeForSublayer(Ye.overscaledZ-Oe,a.paint.get("raster-opacity")===1?Ri.ReadWrite:Ri.ReadOnly,k.LESS),Ot=f.transform.calculateProjMatrix(it,_e));const wt=f.terrain&&te?f.terrain.stencilModeForRTTOverlap(Ye):Se[Ye.overscaledZ],Qt=b?0:a.paint.get("raster-fade-duration");xt.registerFadeDuration(Qt);const kt=i.findLoadedParent(Ye,0),Dt=tf(xt,kt,i,f.transform,Qt);let Gt,Jt;f.terrain&&f.terrain.prepareDrawTile(),L.activeTexture.set(k.TEXTURE0),Rt.bind(me,k.CLAMP_TO_EDGE),L.activeTexture.set(k.TEXTURE1),kt?(kt.texture&&kt.texture.bind(me,k.CLAMP_TO_EDGE),Gt=Math.pow(2,kt.tileID.overscaledZ-xt.tileID.overscaledZ),Jt=[xt.tileID.canonical.x*Gt%1,xt.tileID.canonical.y*Gt%1]):Rt.bind(me,k.CLAMP_TO_EDGE),Rt.useMipmap&&L.extTextureFilterAnisotropic&&f.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const ci=f.transform;let _i;const qi=M?u1(ci):[0,0,0,0];let Di,Oi,er,Pr,Xr,Hn=0;if(O&&U instanceof r.aJ&&U.coordinates.length>3)Di=Float32Array.from(r.bb(r.cH(new r.bT(0,0,0)))),Oi=Float32Array.from(ci.globeMatrix),er=Float32Array.from(r.cD(ci)),Pr=[r.at(ci.center.lng),r.aA(ci.center.lat)],_i=U.elevatedGlobePerspectiveTransform,Xr=U.elevatedGlobeGridMatrix||new Float32Array(9);else if(O){const Ai=r.cE(Ye.canonical);Hn=r.cF(Ai.getCenter().lat),Di=Float32Array.from(r.bb(r.cH(Ye.canonical))),Oi=Float32Array.from(ci.globeMatrix),er=Float32Array.from(r.cD(ci)),Pr=[r.at(ci.center.lng),r.aA(ci.center.lat)],_i=[0,0],Xr=Float32Array.from(r.cG(Ye.canonical,Ai,Hn,ci.worldSize/ci._pixelsPerMercatorPixel))}else _i=U instanceof r.aJ?U.perspectiveTransform:[0,0],Di=new Float32Array(16),Oi=new Float32Array(9),er=new Float32Array(16),Pr=[0,0],Xr=new Float32Array(9);const Tn=Uc(Ot,Di,Oi,er,Xr,Jt||[0,0],r.ae(f.transform.zoom),Pr,qi,Gt||1,Dt,a,_i,M?a.paint.get("raster-elevation"):0,2,Pt,ht,j.range,bt,Vt,Z),ar=f.isTileAffectedByFog(Ye),Nr=f.getOrCreateProgram("raster",{defines:j.defines,overrideFog:ar});if(f.uploadCommonUniforms(L,Nr,it),U instanceof r.aJ){const Ai=U.elevatedGlobeVertexBuffer,Mr=U.elevatedGlobeIndexBuffer;if(te||!T)U.boundsBuffer&&U.boundsSegments&&Nr.draw(f,k.TRIANGLES,ut,$i.disabled,ce,Fi.disabled,Tn,a.id,U.boundsBuffer,f.quadTriangleIndexBuffer,U.boundsSegments);else if(Ai&&Mr){const jr=ci.zoom<=r.c6?U.elevatedGlobeSegments:U.getSegmentsForLongitude(ci.center.lng);jr&&Nr.draw(f,k.TRIANGLES,ut,$i.disabled,ce,Ue,Tn,a.id,Ai,Mr,jr)}}else if(O){ut=new Ri(k.LEQUAL,Ri.ReadOnly,f.depthRangeFor3D);const Ai=f.globeSharedBuffers;if(Ai){const[Mr,jr,Hr]=Ai.getGridBuffers(Hn,!1);Nr.draw(f,k.TRIANGLES,ut,Ne||wt,f.colorModeForRenderPass(),Ue,Tn,a.id,Mr,jr,Hr)}}else{const{tileBoundsBuffer:Ai,tileBoundsIndexBuffer:Mr,tileBoundsSegments:jr}=f.getTileBoundsBuffers(xt);Nr.draw(f,k.TRIANGLES,ut,wt,ce,Fi.disabled,Tn,a.id,Ai,Mr,jr)}}if(!(U instanceof r.aJ)&&O)for(const Ye of Ve){const it=Ye.canonical.y===(1<<Ye.canonical.z)-1;Ye.canonical.y===0&&gt(!0,Ye,f,i,a,Z,j,Ue,Ne||$i.disabled),it&&gt(!1,Ye,f,i,a,Z,j,Ue===Fi.frontCW?Fi.backCW:Fi.frontCW,Ne||$i.disabled)}};O?je(ke,f.renderElevatedRasterBackface?Fi.backCW:Fi.frontCW,f.stencilModeFor3D()):je(ke,Fi.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,i,a,p,g,b){f.renderPass==="offscreen"&&function(T,M,O,L){if(!L.length)return;const k=T.context,U=k.gl,j=M.getSource();if(!(j instanceof An))return;const Z=Math.ceil(Math.sqrt(O.paint.get("raster-particle-count")));let ce=O.particlePositionRGBAImage;if(!ce||ce.width!==Z){const ke=function(Oe){const je=Oe*Oe,Ve=new Uint8Array(4*je),Ue=function(Ye){return Ye|=0,Ye=Math.imul(2747636419^Ye,2654435769),Ye=Math.imul(Ye^Ye>>>16,2654435769),((Ye=Math.imul(Ye^Ye>>>16,2654435769))>>>0)/4294967296},Ne=1/1.1;for(let Ye=0;Ye<je;Ye++){const it=Ne*(Ue(2*Ye+0)+Si),xt=Ne*(Ue(2*Ye+1)+Si),_t=255*it%1,Rt=255*xt%1,Pt=_t,ht=xt-Rt/255,bt=Rt;Ve[4*Ye+0]=255*(it-_t/255),Ve[4*Ye+1]=255*Pt,Ve[4*Ye+2]=255*ht,Ve[4*Ye+3]=255*bt}return Ve}(Z);ce=O.particlePositionRGBAImage=new r.r({width:Z,height:Z},ke)}let te=O.particleFramebuffer;te?te.width!==Z&&(te.destroy(),te=O.particleFramebuffer=k.createFramebuffer(Z,Z,!0,null)):te=O.particleFramebuffer=k.createFramebuffer(Z,Z,!0,null);const _e=[];for(const ke of L){const Oe=M.getTile(ke);if(!(Oe instanceof Ml))continue;const je=d1(Oe,j,O);if(!je)continue;const Ve=[Oe.tileSize,Oe.tileSize];let Ue=O.tileFramebuffer;Ue||(Ue=O.tileFramebuffer=k.createFramebuffer(Ve[0],Ve[1],!0,null));let Ne=Oe.rasterParticleState;Ne||(Ne=Oe.rasterParticleState=new h1(k,ke,Ve,ce));const Ye=Ne.update(O.lastInvalidatedAt);Ne.particleTextureDimension!==Z&&Ne.updateParticleTexture(ke,ce);const it=Ne.targetColorTexture;Ne.targetColorTexture=Ne.backgroundColorTexture,Ne.backgroundColorTexture=it;const xt=Ne.particleTexture0;Ne.particleTexture0=Ne.particleTexture1,Ne.particleTexture1=xt,_e.push([ke,je,Ne,Ye])}if(_e.length===0)return;const me=r.q.now(),Se=O.previousDrawTimestamp?.001*(me-O.previousDrawTimestamp):.0167;if(O.previousDrawTimestamp=me,O.hasColorMap()){k.activeTexture.set(U.TEXTURE0+2);let ke=O.colorRampTexture;ke||(ke=O.colorRampTexture=new r.T(k,O.colorRamp,U.RGBA8)),ke.bind(U.LINEAR,U.CLAMP_TO_EDGE)}k.bindFramebuffer.set(O.tileFramebuffer.framebuffer),function(ke,Oe,je){const Ve=ke.context,Ue=Ve.gl,Ne=Oe.tileFramebuffer;Ve.activeTexture.set(Ue.TEXTURE0);const Ye={u_texture:0,u_opacity:1.05*(xt=Oe.paint.get("raster-particle-fade-opacity-factor"))/(xt+.05)},it=ke.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var xt;for(const _t of je){const[,,Rt,Pt]=_t;Ne.colorAttachment.set(Rt.targetColorTexture.texture),Ve.viewport.set([0,0,Ne.width,Ne.height]),Ve.clear({color:r.aj.transparent}),Pt&&(Rt.backgroundColorTexture.bind(Ue.NEAREST,Ue.CLAMP_TO_EDGE),it.draw(ke,Ue.TRIANGLES,Ri.disabled,$i.disabled,gr.alphaBlended,Fi.disabled,Ye,Oe.id,ke.viewportBuffer,ke.quadTriangleIndexBuffer,ke.viewportSegments))}}(T,O,_e),function(ke,Oe,je,Ve){const Ue=ke.context,Ne=Ue.gl,Ye=je.tileFramebuffer,it=ke.transform.projection.name==="globe",xt=je.paint.get("raster-particle-max-speed");for(const _t of Ve){const[Rt,Pt,ht]=_t;Ue.activeTexture.set(Ne.TEXTURE0+0),Pt.texture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE),Ye.colorAttachment.set(ht.targetColorTexture.texture);const bt=ke.getOrCreateProgram("rasterParticleDraw",{defines:Pt.defines,overrideFog:!1});Ue.activeTexture.set(Ne.TEXTURE0+1);const Vt=Pt.scalarData?[]:[0,1,2,3].map(wt=>r.d4[wt](Rt));Vt.push(Rt);const ut=Rt.canonical.x,Ot=Rt.canonical.y;for(const wt of Vt){const Qt=Oe.getTile(it?wt.wrapped():wt);if(!Qt)continue;const kt=Qt.rasterParticleState;if(!kt)continue;const Dt=wt.canonical.x+(1<<wt.canonical.z)*(wt.wrap-Rt.wrap),Gt=wt.canonical.y;kt.particleTexture0.bind(Ne.NEAREST,Ne.CLAMP_TO_EDGE);const Jt=mw(1,kt.particleTexture0.size[0],[Dt-ut,Gt-Ot],0,Pt.texture.size,2,xt,Pt.textureOffset,Pt.scale,Pt.offset);bt.draw(ke,Ne.POINTS,Ri.disabled,$i.disabled,gr.alphaBlended,Fi.disabled,Jt,je.id,kt.particleIndexBuffer,void 0,kt.particleSegment)}}}(T,M,O,_e),k.bindFramebuffer.set(O.particleFramebuffer.framebuffer),function(ke,Oe,je,Ve){const Ue=ke.context,Ne=Ue.gl,Ye=Oe.paint.get("raster-particle-max-speed"),it=Ve*Oe.paint.get("raster-particle-speed-factor")*.15,xt=function(Rt){return Math.pow(Rt,6)}(.01+1*Oe.paint.get("raster-particle-reset-rate-factor")),_t=Oe.particleFramebuffer;Ue.viewport.set([0,0,_t.width,_t.height]);for(const Rt of je){const[,Pt,ht]=Rt;Ue.activeTexture.set(Ne.TEXTURE0+0),Pt.texture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE),Ue.activeTexture.set(Ne.TEXTURE0+1);const bt=ht.particleTexture0;bt.bind(Ne.NEAREST,Ne.CLAMP_TO_EDGE);const Vt=_w(1,bt.size[0],0,Pt.texture.size,Ye,it,xt,Pt.textureOffset,Pt.scale,Pt.offset);_t.colorAttachment.set(ht.particleTexture1.texture),Ue.clear({color:r.aj.transparent}),ke.getOrCreateProgram("rasterParticleUpdate",{defines:Pt.defines}).draw(ke,Ne.TRIANGLES,Ri.disabled,$i.disabled,gr.unblended,Fi.disabled,Vt,Oe.id,ke.viewportBuffer,ke.quadTriangleIndexBuffer,ke.viewportSegments)}}(T,O,_e,Se)}(f,i,a,p),f.renderPass==="translucent"&&(function(T,M,O,L,k){const U=T.context,j=U.gl,Z=M.getSource().tileSize,ce=5*(1-r.ac(r.bY,r.bY+1,T.transform.zoom))*Z+O.paint.get("raster-particle-elevation"),te=!T.options.moving,_e=T.transform.projection.name==="globe";if(!L.length)return;const[me,Se]=T.stencilConfigForOverlap(L),ke=[];_e&&ke.push("PROJECTION_GLOBE_VIEW");const Oe=T.stencilModeFor3D();for(const je of Se){const Ve=je.toUnwrapped(),Ue=M.getTile(je);if(!Ue.rasterParticleState)continue;const Ne=Ue.rasterParticleState,Ye=100;Ue.registerFadeDuration(Ye);const it=M.findLoadedParent(je,0),xt=tf(Ue,it,M,T.transform,Ye);let _t,Rt;T.terrain&&T.terrain.prepareDrawTile(),U.activeTexture.set(j.TEXTURE0),Ne.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),U.activeTexture.set(j.TEXTURE1),it&&it.rasterParticleState?(it.rasterParticleState.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),_t=Math.pow(2,it.tileID.overscaledZ-Ue.tileID.overscaledZ),Rt=[Ue.tileID.canonical.x*_t%1,Ue.tileID.canonical.y*_t%1]):Ne.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const Pt=_e?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(Ve,te),ht=T.transform,bt=f1(ht),Vt=r.cE(je.canonical),ut=r.cF(Vt.getCenter().lat);let Ot,wt,Qt,kt,Dt;_e?(Ot=Float32Array.from(r.bb(r.cH(je.canonical))),wt=Float32Array.from(ht.globeMatrix),Qt=Float32Array.from(r.cD(ht)),kt=[r.at(ht.center.lng),r.aA(ht.center.lat)],Dt=Float32Array.from(r.cG(je.canonical,Vt,ut,ht.worldSize/ht._pixelsPerMercatorPixel))):(Ot=new Float32Array(16),wt=new Float32Array(9),Qt=new Float32Array(16),kt=[0,0],Dt=new Float32Array(9));const Gt=cg(Pt,Ot,wt,Qt,Dt,Rt||[0,0],r.ae(T.transform.zoom),kt,bt,_t||1,xt,ce),Jt=T.isTileAffectedByFog(je),ci=T.getOrCreateProgram("rasterParticle",{defines:ke,overrideFog:Jt});if(T.uploadCommonUniforms(U,ci,Ve),_e){const _i=new Ri(j.LEQUAL,Ri.ReadOnly,T.depthRangeFor3D),qi=0,Di=T.globeSharedBuffers;if(Di){const[Oi,er,Pr]=Di.getGridBuffers(ut,qi!==0);ci.draw(T,j.TRIANGLES,_i,Oe,gr.alphaBlended,T.renderElevatedRasterBackface?Fi.frontCCW:Fi.backCCW,Gt,O.id,Oi,er,Pr)}}else{const _i=T.depthModeForSublayer(0,Ri.ReadOnly),qi=me[je.overscaledZ],{tileBoundsBuffer:Di,tileBoundsIndexBuffer:Oi,tileBoundsSegments:er}=T.getTileBoundsBuffers(Ue);ci.draw(T,j.TRIANGLES,_i,qi,gr.alphaBlended,Fi.disabled,Gt,O.id,Di,Oi,er)}}T.resetStencilClippingMasks()}(f,i,a,p),f.style.map.triggerRepaint())},background:function(f,i,a,p){const g=a.paint.get("background-color"),b=a.paint.get("background-color-use-theme").constantOr("default")==="none",T=a.paint.get("background-opacity"),M=a.paint.get("background-emissive-strength"),O=a.paint.get("background-pitch-alignment")==="viewport";if(T===0)return;const L=f.context,k=L.gl,U=f.transform,j=U.tileSize,Z=a.paint.get("background-pattern");let ce;if(Z!==void 0&&(Z===null||(ce=f.imageManager.getPattern(Z.toString(),a.scope,f.style.getLut(a.scope)),!ce)))return;const te=!Z&&g.a===1&&T===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==te)return;const _e=$i.disabled,me=f.depthModeForSublayer(0,te==="opaque"?Ri.ReadWrite:Ri.ReadOnly),Se=f.colorModeForDrapableLayerRenderPass(M),ke=Z?"backgroundPattern":"background";let Oe,je=p;if(je||(Oe=f.getBackgroundTiles(),je=Object.values(Oe).map(Ve=>Ve.tileID)),Z&&(L.activeTexture.set(k.TEXTURE0),f.imageManager.bind(f.context,a.scope)),O){const Ve=f.getOrCreateProgram(ke,{overrideFog:!1,overrideRtt:!0}),Ue=new Float32Array(r.ab.mat4.identity([])),Ne=new r.aG(0,0,0,0,0),Ye=Z?c1(Ue,M,T,f,0,a.scope,ce,O,{tileID:Ne,tileSize:j}):hg(Ue,M,T,g.toRenderColor(b?null:a.lut));Ve.draw(f,k.TRIANGLES,me,_e,Se,Fi.disabled,Ye,a.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}else for(const Ve of je){const Ue=f.isTileAffectedByFog(Ve),Ne=f.getOrCreateProgram(ke,{overrideFog:Ue}),Ye=Ve.toUnwrapped(),it=p?Ve.projMatrix:f.transform.calculateProjMatrix(Ye);f.prepareDrawTile();const xt=i?i.getTile(Ve):Oe?Oe[Ve.key]:new Xa(Ve,j,U.zoom,f),_t=Z?c1(it,M,T,f,0,a.scope,ce,O,{tileID:Ve,tileSize:j}):hg(it,M,T,g.toRenderColor(b?null:a.lut));f.uploadCommonUniforms(L,Ne,Ye);const{tileBoundsBuffer:Rt,tileBoundsIndexBuffer:Pt,tileBoundsSegments:ht}=f.getTileBoundsBuffers(xt);Ne.draw(f,k.TRIANGLES,me,_e,Se,Fi.disabled,_t,a.id,Rt,Pt,ht)}},sky:function(f,i,a){const p=f._atmosphere?r.ae(f.transform.zoom):1,g=a.paint.get("sky-opacity")*p;if(g===0)return;const b=f.context,T=a.paint.get("sky-type"),M=new Ri(b.gl.LEQUAL,Ri.ReadOnly,[0,1]),O=f.frameCounter/1e3%1;T==="atmosphere"?f.renderPass==="offscreen"?a.needsSkyboxCapture(f)&&(function(L,k,U,j){const Z=L.context,ce=Z.gl;let te=k.skyboxFbo;if(!te){te=k.skyboxFbo=Z.createFramebuffer(32,32,!0,null),k.skyboxGeometry=new m1(Z),k.skyboxTexture=Z.gl.createTexture(),ce.bindTexture(ce.TEXTURE_CUBE_MAP,k.skyboxTexture),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_WRAP_S,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_WRAP_T,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_MIN_FILTER,ce.LINEAR),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_MAG_FILTER,ce.LINEAR);for(let ke=0;ke<6;++ke)ce.texImage2D(ce.TEXTURE_CUBE_MAP_POSITIVE_X+ke,0,ce.RGBA,32,32,0,ce.RGBA,ce.UNSIGNED_BYTE,null)}Z.bindFramebuffer.set(te.framebuffer),Z.viewport.set([0,0,32,32]);const _e=k.getCenter(L,!0),me=L.getOrCreateProgram("skyboxCapture"),Se=new Float64Array(16);r.ab.mat4.identity(Se),r.ab.mat4.rotateY(Se,Se,.5*-Math.PI),js(L,k,me,Se,_e,0),r.ab.mat4.identity(Se),r.ab.mat4.rotateY(Se,Se,.5*Math.PI),js(L,k,me,Se,_e,1),r.ab.mat4.identity(Se),r.ab.mat4.rotateX(Se,Se,.5*-Math.PI),js(L,k,me,Se,_e,2),r.ab.mat4.identity(Se),r.ab.mat4.rotateX(Se,Se,.5*Math.PI),js(L,k,me,Se,_e,3),r.ab.mat4.identity(Se),js(L,k,me,Se,_e,4),r.ab.mat4.identity(Se),r.ab.mat4.rotateY(Se,Se,Math.PI),js(L,k,me,Se,_e,5),Z.viewport.set([0,0,L.width,L.height])}(f,a),a.markSkyboxValid(f)):f.renderPass==="sky"&&function(L,k,U,j,Z){const ce=L.context,te=ce.gl,_e=L.transform,me=L.getOrCreateProgram("skybox");ce.activeTexture.set(te.TEXTURE0),te.bindTexture(te.TEXTURE_CUBE_MAP,k.skyboxTexture);const Se=((ke,Oe,je,Ve,Ue)=>({u_matrix:ke,u_sun_direction:Oe,u_cubemap:0,u_opacity:Ve,u_temporal_offset:Ue}))(_e.skyboxMatrix,k.getCenter(L,!1),0,j,Z);L.uploadCommonUniforms(ce,me),me.draw(L,te.TRIANGLES,U,$i.disabled,L.colorModeForRenderPass(),Fi.backCW,Se,"skybox",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(f,a,M,g,O):T==="gradient"&&f.renderPass==="sky"&&function(L,k,U,j,Z){const ce=L.context,te=ce.gl,_e=L.transform,me=L.getOrCreateProgram("skyboxGradient");k.skyboxGeometry||(k.skyboxGeometry=new m1(ce)),ce.activeTexture.set(te.TEXTURE0);let Se=k.colorRampTexture;Se||(Se=k.colorRampTexture=new r.T(ce,k.colorRamp,te.RGBA8)),Se.bind(te.LINEAR,te.CLAMP_TO_EDGE);const ke=((Oe,je,Ve,Ue,Ne)=>({u_matrix:Oe,u_color_ramp:0,u_center_direction:je,u_radius:r.ai(Ve),u_opacity:Ue,u_temporal_offset:Ne}))(_e.skyboxMatrix,k.getCenter(L,!1),k.paint.get("sky-gradient-radius"),j,Z);L.uploadCommonUniforms(ce,me),me.draw(L,te.TRIANGLES,U,$i.disabled,L.colorModeForRenderPass(),Fi.backCW,ke,"skyboxGradient",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(f,a,M,g,O)},debug:function(f,i,a,p,g,b){for(let T=0;T<a.length;T++)if(g){const L=new r.aj(p.r*.8,p.g*.8,p.b*.8,1);$c(f,i,a[T],p,-1,-1,b),$c(f,i,a[T],p,-1,1,b),$c(f,i,a[T],p,1,1,b),$c(f,i,a[T],p,1,-1,b),$c(f,i,a[T],L,0,0,b)}else $c(f,i,a[T],p,0,0,b)},custom:function(f,i,a,p){const g=f.context,b=a.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&a.isDraped(i)){if(f.renderPass==="offscreen"){const T=b.prerender;if(T){if(f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const M=f.transform.pointMerc;T.call(b,g.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),r.ae(f.transform.zoom),[M.x,M.y],f.transform.pixelsPerMeterRatio)}else T.call(b,g.gl,f.transform.customLayerMatrix());g.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const M=b.renderToTile;if(M){const O=p[0].canonical,L=new r.aa(O.x+p[0].wrap*(1<<O.z),O.y,O.z);g.setDepthMode(Ri.disabled),g.setStencilMode($i.disabled),g.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),M.call(b,g.gl,L),g.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),g.setStencilMode($i.disabled);const T=b.renderingMode==="3d"?new Ri(f.context.gl.LEQUAL,Ri.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Ri.ReadOnly);if(g.setDepthMode(T),f.transform.projection.name==="globe"){const M=f.transform.pointMerc;b.render(g.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),r.ae(f.transform.zoom),[M.x,M.y],f.transform.pixelsPerMeterRatio)}else b.render(g.gl,f.transform.customLayerMatrix());g.setDirty(),f.setBaseState(),g.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,i,a,p){if(f.renderPass==="opaque")return;const g=a.paint.get("model-opacity").constantOr(1);if(g===0)return;const b=a.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!b||f.terrain&&g<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof r.a9))return;const T=f.shadowRenderer,M=a.paint.get("model-receive-shadows");T&&(T.useNormalOffset=!0,M||(T.enabled=!1));const O=()=>{T&&(T.useNormalOffset=!0,M||(T.enabled=!0))},L=i.getSource();if(f.renderPass==="light-beam"&&L.type!=="batched-model")return;if(L.type==="vector"||L.type==="geojson")return function(me,Se,ke,Oe,je){const Ve=me.transform;if(Ve.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${Ve.projection.name} projection is not yet implemented`);const Ue=Ve.getFreeCameraOptions().position;if(!me.modelManager)return;const Ne=me.modelManager;ke.modelManager=Ne;const Ye=me.shadowRenderer;if(!ke._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const it=ke._unevaluatedLayout._values["model-id"],xt=Object.assign({},ke.layout.get("model-id").parameters),_t=me.style.order.indexOf(ke.fqid);for(const Rt of Oe){const Pt=Se.getTile(Rt).getBucket(ke);if(!Pt||Pt.projection.name!==Ve.projection.name)continue;const ht=Pt.getModelUris();ht&&!Pt.modelsRequested&&(Ne.addModelsFromBucket(ht,je),Pt.modelsRequested=!0);const bt=em(Rt,Ve);xt.zoom=bt;const Vt=it.possiblyEvaluate(xt);if(kl(me,Pt,Rt),ho.shadowUniformsInitialized=!1,ho.useSingleShadowCascade=!!Ye&&Ye.getMaxCascadeForTile(Rt.toUnwrapped())===0,me.renderPass==="shadow"&&Ye){if(me.currentShadowCascade===1&&Pt.isInsideFirstShadowMapFrustum)continue;const wt=Ve.calculatePosMatrix(Rt.toUnwrapped(),Ve.worldSize);if(ho.tileMatrix.set(wt),ho.shadowTileMatrix=Float32Array.from(Ye.calculateShadowPassMatrixFromMatrix(wt)),ho.aabb.min.fill(0),ho.aabb.max[0]=ho.aabb.max[1]=r.ag,ho.aabb.max[2]=0,bg(Pt,ho,me,ke.scope))continue}const ut=1<<Rt.canonical.z,Ot=[((Ue.x-Rt.wrap)*ut-Rt.canonical.x)*r.ag,(Ue.y*ut-Rt.canonical.y)*r.ag,Ue.z*ut*r.ag];me.conflationActive&&Object.keys(Pt.instancesPerModel).length>0&&me.style.isLayerClipped(ke,Se.getSource())&&Pt.updateReplacement(Rt,me.replacementSource,_t,je)&&(Pt.uploaded=!1,Pt.upload(me.context));for(let wt in Pt.instancesPerModel){const Qt=Pt.instancesPerModel[wt];Qt.features.length>0&&(wt=Vt.evaluate(Qt.features[0].feature,{}));const kt=Ne.getModel(wt,je);if(kt&&kt.uploaded)for(const Dt of kt.nodes)df(me,ke,Dt,Qt,Ot,Rt,ho)}}}(f,i,a,p,L.type==="vector"?a.scope:""),void O();if(!L.loaded())return;if(L.type==="batched-model")return function(me,Se,ke,Oe){ke.resetLayerRenderingStats(me);const je=me.context,Ve=me.transform,Ue=me.style.fog,Ne=me.shadowRenderer;if(Ve.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${Ve.projection.name} projection is not yet implemented`);const Ye=me.transform.getFreeCameraOptions().position,it=r.ab.vec3.scale([],[Ye.x,Ye.y,Ye.z],me.transform.worldSize),xt=r.ab.vec3.negate([],it),_t=r.ab.mat4.identity([]),Rt=r.dj(Ve.center.lat,Ve.zoom),Pt=r.ab.mat4.fromScaling([],[1,1,1/Rt]);r.ab.mat4.translate(_t,_t,xt);const ht=ke.paint.get("model-opacity").constantOr(1),bt=new Ri(je.gl.LEQUAL,Ri.ReadWrite,me.depthRangeFor3D),Vt=new Ri(je.gl.LEQUAL,Ri.ReadOnly,me.depthRangeFor3D),ut=new r.cd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ot=me.renderPass==="shadow",wt=Ot&&Ne?Ne.getCurrentCascadeFrustum():Ve.getFrustum(Ve.scaleZoom(Ve.worldSize)),Qt=ke.paint.get("model-front-cutoff"),kt=Qt[2]<1,Dt=tl(me,ke.paint.get("model-cutoff-fade-range")),Gt=ke.getLayerRenderingStats();(function(Jt,ci,_i,qi){const Di=Jt.terrain?Jt.terrain.exaggeration():0,Oi=Jt.transform.zoom;for(const er of qi){const Pr=ci.getTile(er).getBucket(_i);Pr&&(Jt.conflationActive&&Pr.updateReplacement(er,Jt.replacementSource),Pr.evaluateScale(Jt,_i),Jt.terrain&&Di>0&&Pr.elevationUpdate(Jt.terrain,Di,er,_i.source),Pr.needsReEvaluation(Jt,Oi,_i)&&Pr.evaluate(_i))}})(me,Se,ke,Oe),function(){let Jt,ci,_i;kt?(Jt=Oe.length-1,ci=-1,_i=-1):(Jt=0,ci=Oe.length,_i=1);const qi=new Float64Array(16),Di=r.ab.vec3.create(),Oi=new r.P(0,0);for(let er=Jt;er!==ci;er+=_i){const Pr=Oe[er],Xr=Se.getTile(Pr).getBucket(ke);if(!Xr||!Xr.uploaded)continue;let Hn=!1;Ne&&(Hn=Ne.getMaxCascadeForTile(Pr.toUnwrapped())===0);const Tn=Ve.calculatePosMatrix(Pr.toUnwrapped(),Ve.worldSize),ar=Xr.modelTraits;!Ot&&kt&&(r.ab.mat4.invert(qi,Tn),r.ab.vec3.transformMat4(Di,it,qi),Oi.x=Di[0],Oi.y=Di[1]);const Nr=[];for(const Ai of Xr.getNodesInfo()){if(Ai.hiddenByReplacement||!Ai.node.meshes)continue;const Mr=Ai.node;let jr=0;me.terrain&&Mr.elevation&&(jr=Mr.elevation*me.terrain.exaggeration());const Hr=(()=>{const Or=Ai.aabb;return ut.min=[...Or.min],ut.max=[...Or.max],ut.min[2]+=jr,ut.max[2]+=jr,r.ab.vec3.transformMat4(ut.min,ut.min,Tn),r.ab.vec3.transformMat4(ut.max,ut.max,Tn),ut})(),Nn=Ai.evaluatedScale;if(Nn[0]<=1&&Nn[1]<=1&&Nn[2]<=1&&Hr.intersects(wt)===0)continue;if(!Ot&&kt){const Or=.16666666666666666;Ai.cameraCollisionOpacity=it[0]>Hr.min[0]&&it[0]<Hr.max[0]&&it[1]>Hr.min[1]&&it[1]<Hr.max[1]&&it[2]*Rt<Hr.max[2]&&Mr.footprint&&r.bA(Oi,Mr.footprint)?Math.max(Ai.cameraCollisionOpacity-Or,0):Math.min(1,Ai.cameraCollisionOpacity+Or)}const Ls=[...Tn],gs=Mr.anchor?Mr.anchor[0]:0,ys=Mr.anchor?Mr.anchor[1]:0;r.ab.mat4.translate(Ls,Ls,[gs*(Nn[0]-1),ys*(Nn[1]-1),jr]),r.ab.vec3.exactEquals(Nn,r.dm)||r.ab.mat4.scale(Ls,Ls,Nn);const ha=r.ab.mat4.multiply([],Ls,Mr.matrix),fo=r.ab.mat4.multiply([],Ve.expandedFarZProjMatrix,ha),Vn=r.ab.mat4.multiply([],Ve.expandedFarZProjMatrix,Ls),pn=r.ab.vec4.transformMat4([],[gs,ys,jr,1],fo)[2];Mr.hidden=!1;let on=ht;Ot||(kt&&(on*=Ai.cameraCollisionOpacity,on*=wg(Ls,Ve,Ai.aabb,Qt)),on*=Iu(Dt,pn)),on!==0?Nr.push({nodeInfo:Ai,depth:pn,opacity:on,wvpForNode:fo,wvpForTile:Vn,nodeModelMatrix:ha,tileModelMatrix:Ls}):Mr.hidden=!0}Ot||Nr.sort((Ai,Mr)=>!kt||Ai.opacity===1&&Mr.opacity===1?Ai.depth<Mr.depth?-1:1:Ai.opacity===1?-1:Mr.opacity===1?1:Ai.depth>Mr.depth?-1:1);for(const Ai of Nr){const Mr=Ai.nodeInfo,jr=Mr.node;let Hr=r.ab.mat4.multiply([],Pt,Ai.tileModelMatrix);r.ab.mat4.multiply(Hr,_t,Hr);const Nn=r.ab.mat4.invert([],Hr);r.ab.mat4.transpose(Nn,Nn),r.ab.mat4.scale(Nn,Nn,xg),Hr=r.ab.mat4.multiply(Hr,Hr,jr.matrix);const Ls=me.renderPass==="light-beam",gs=ke.paint.get("model-color-use-theme").constantOr("default")==="none",ys=ar&r.dp.HasMapboxMeshFeatures,ha=ys?0:Mr.evaluatedRMEA[0][2];for(let fo=0;fo<jr.meshes.length;++fo){const Vn=jr.meshes[fo],pn=fo===jr.lightMeshIndex;let on=Ai.wvpForNode;if(pn){if(!Ls&&!me.terrain&&me.shadowRenderer){me.currentLayer<me.firstLightBeamLayer&&(me.firstLightBeamLayer=me.currentLayer);continue}on=Ai.wvpForTile}else if(Ls)continue;const Or={defines:[]},os=[];if(!Ot&&Ne&&(Ne.useNormalOffset=!!Vn.normalBuffer),Rh(Or.defines,os,Vn,me,gs?null:ke.lut),ys||Or.defines.push("DIFFUSE_SHADED"),Hn&&Or.defines.push("SHADOWS_SINGLE_CASCADE"),Gt&&(Ot?Gt.numRenderedVerticesInShadowPass+=Vn.vertexArray.length:Gt.numRenderedVerticesInTransparentPass+=Vn.vertexArray.length),Ot){hf(Vn,Ai.nodeModelMatrix,me,ke);continue}let ks=null;if(Ue){const Nl=mc(Ai.nodeModelMatrix,me.transform);if(ks=new Float32Array(Nl),Ve.projection.name!=="globe"){const La=Vn.aabb.min,da=Vn.aabb.max,[ku,Vl]=Ue.getOpacityForBounds(Nl,La[0],La[1],da[0],da[1]);Or.overrideFog=ku>=Le||Vl>=Le}}const ln=Vn.material;let po;ln.occlusionTexture&&ln.occlusionTexture.offsetScale&&(po=ln.occlusionTexture.offsetScale,Or.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Oa=me.getOrCreateProgram("model",Or);!Ot&&Ne&&Ne.setupShadowsFromMatrix(Ai.tileModelMatrix,Oa,Ne.useNormalOffset),me.uploadCommonUniforms(je,Oa,null,ks);const qo=ln.pbrMetallicRoughness;qo.metallicFactor=.9,qo.roughnessFactor=.5;const Oo=of(new Float32Array(on),new Float32Array(Hr),new Float32Array(Nn),new Float32Array(jr.matrix),me,Ai.opacity,qo.baseColorFactor.toRenderColor(null),ln.emissiveFactor,qo.metallicFactor,qo.roughnessFactor,ln,ha,ke,[0,0,0],po);!pn&&(Mr.hasTranslucentParts||Ai.opacity<1)&&Oa.draw(me,je.gl.TRIANGLES,bt,$i.disabled,gr.disabled,Fi.backCCW,Oo,ke.id,Vn.vertexBuffer,Vn.indexBuffer,Vn.segments,ke.paint,me.transform.zoom,void 0,os),Oa.draw(me,je.gl.TRIANGLES,pn?Vt:bt,$i.disabled,pn||Ai.opacity<1||Mr.hasTranslucentParts?gr.alphaBlended:gr.unblended,Fi.backCCW,Oo,ke.id,Vn.vertexBuffer,Vn.indexBuffer,Vn.segments,ke.paint,me.transform.zoom,void 0,os)}}}}()}(f,i,a,p),void O();if(L.type!=="model")return;const k=L.getModels(),U=[],j=f.transform.getFreeCameraOptions().position,Z=r.ab.vec3.scale([],[j.x,j.y,j.z],f.transform.worldSize);r.ab.vec3.negate(Z,Z);const ce=[],te=[];let _e=0;for(const me of k){const Se=a.paint.get("model-rotation").constantOr(null),ke=a.paint.get("model-scale").constantOr(null),Oe=a.paint.get("model-translation").constantOr(null);me.computeModelMatrix(f,Se,ke,Oe,!0,!0,!1);const je=r.ab.mat4.identity([]),Ve=r.dj(me.position.lat,f.transform.zoom),Ue=r.ab.mat4.fromScaling([],[1,1,1/Ve]);r.ab.mat4.translate(je,je,Z),U.push({zScaleMatrix:Ue,negCameraPosMatrix:je});for(const Ne of me.nodes)Qp(f.transform,Ne,me.matrix,f.transform.expandedFarZProjMatrix,_e,ce,te);_e++}if(ce.sort((me,Se)=>Se.depth-me.depth),f.renderPass!=="shadow"){if(g===1)for(const me of te)_c(me,f,a,U[me.modelIndex],$i.disabled,f.colorModeForRenderPass());else{for(const me of te)_c(me,f,a,U[me.modelIndex],$i.disabled,gr.disabled);for(const me of te)_c(me,f,a,U[me.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(const me of ce)_c(me,f,a,U[me.modelIndex],$i.disabled,f.colorModeForRenderPass());O()}else{for(const me of te)hf(me.mesh,me.nodeModelMatrix,f,a);for(const me of ce)hf(me.mesh,me.nodeModelMatrix,f,a);O()}}},mf={line:function(f,i,a){if(f.hasElevatedBuckets=!1,f.hasNonElevatedBuckets=!1,f._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||f._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(i){const p=i.getVisibleCoordinates();for(const g of p){const b=i.getTile(g).getBucket(f);if(b&&(b.hasZOffset?f.hasElevatedBuckets=!0:f.hasNonElevatedBuckets=!0,f.hasElevatedBuckets&&f.hasNonElevatedBuckets))break}}}else f.hasNonElevatedBuckets=!0},model:function(f,i,a){const p=i.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,p.type==="vector"?f.scope:""));if(p.type==="batched-model"||p.type!=="model")return;const g=p.getModels();for(const b of g)b.upload(a.context)},raster:function(f,i,a){const p=i.getSource();if(!(p instanceof An&&p.loaded()))return;const g=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!g)return;const b=f.paint.get("raster-array-band")||p.getInitialBand(g);if(b==null)return;const T=i.getIds().map(M=>i.getTileByID(M));for(const M of T)M.updateNeeded(g,b)&&p.prepareTile(M,g,b)},"raster-particle":function(f,i,a){const p=i.getSource();if(!(p instanceof An&&p.loaded()))return;const g=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!g)return;const b=f.paint.get("raster-particle-array-band")||p.getInitialBand(g);if(b==null)return;const T=i.getIds().map(M=>i.getTileByID(M));for(const M of T)M.updateNeeded(g,b)&&p.prepareTile(M,g,b)}};class Pg{constructor(i,a,p,g,b){this.context=new mg(i,a),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._timeStamp=r.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const T=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const O of T)this._debugParams.enabledLayers[O]=!0;b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),b.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),b.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),b.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const O of T)b.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],O);this.occlusionParams=new tm(b),this.setup(),this.numSublayers=rs.maxUnderzooming+rs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.dv,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new uc(this),this._wireframeDebugCache=new Tg,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const M=new r.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,M,i.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=g}updateTerrain(i,a){const p=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new wh(this,i));const g=this._terrain;this.transform.elevation=p?g:null,g.update(i,this.transform,a),this.transform.elevation&&!g.enabled&&(this.transform.elevation=null)}_updateFog(i){const a=i.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,g]=a.getFovAdjustedRange(this.transform._fov);if(p>g)return void(this.transform.fogCullDistSq=null);const b=p+.78*(g-p);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(i){i&&!this._terrain&&(this._terrain=new wh(this,this.style)),this._forceTerrainMode=i}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(i,a){if(this.width=i*r.q.devicePixelRatio,this.height=a*r.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const i=this.context,a=new r.b4;a.emplaceBack(0,0),a.emplaceBack(r.ag,0),a.emplaceBack(0,r.ag),a.emplaceBack(r.ag,r.ag),this.tileExtentBuffer=i.createVertexBuffer(a,r.b6.members),this.tileExtentSegments=r.b7.simpleSegment(0,0,4,2);const p=new r.b4;p.emplaceBack(0,0),p.emplaceBack(r.ag,0),p.emplaceBack(0,r.ag),p.emplaceBack(r.ag,r.ag),this.debugBuffer=i.createVertexBuffer(p,r.b6.members),this.debugSegments=r.b7.simpleSegment(0,0,4,5);const g=new r.b4;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(g,r.b6.members),this.viewportSegments=r.b7.simpleSegment(0,0,4,2);const b=new r.aT;b.emplaceBack(0,0,0,0),b.emplaceBack(r.ag,0,r.ag,0),b.emplaceBack(0,r.ag,0,r.ag),b.emplaceBack(r.ag,r.ag,r.ag,r.ag),this.mercatorBoundsBuffer=i.createVertexBuffer(b,r.b9.members),this.mercatorBoundsSegments=r.b7.simpleSegment(0,0,4,2);const T=new r.aU;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(T);const M=new r.b5;for(const L of[0,1,3,2,0])M.emplaceBack(L);this.debugIndexBuffer=i.createIndexBuffer(M),this.emptyTexture=new r.T(i,new r.r({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA8),this.identityMat=r.ab.mat4.create();const O=this.context.gl;this.stencilClearMode=new $i({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,i.TRIANGLES,Ri.disabled,this.stencilClearMode,gr.disabled,Fi.disabled,Up(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,a,p){if(!a||this.currentStencilSource===a.id||!i.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(const O of p)if(this._tileClippingMaskIDs[O.key]===void 0){M=!0;break}if(!M)return}this.currentStencilSource=a.id;const g=this.context,b=g.gl;this.nextStencilID+p.length>256&&this.clearStencil(),g.setColorMode(gr.disabled),g.setDepthMode(Ri.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of p){const O=a.getTile(M),L=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:U,tileBoundsSegments:j}=this.getTileBoundsBuffers(O);T.draw(this,b.TRIANGLES,Ri.disabled,new $i({func:b.ALWAYS,mask:0},L,255,b.KEEP,b.KEEP,b.REPLACE),gr.disabled,Fi.disabled,Up(M.projMatrix),"$clipping",k,U,j)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,a=this.context.gl;return new $i({func:a.NOTEQUAL,mask:255},i,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const a=this.context.gl;return new $i({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(i){const a=this.context.gl,p=i.sort((T,M)=>M.overscaledZ-T.overscaledZ),g=p[p.length-1].overscaledZ,b=p[0].overscaledZ-g+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const T={};for(let M=0;M<b;M++)T[M+g]=new $i({func:a.GEQUAL,mask:255},M+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=b,[T,p]}return[{[g]:$i.disabled},p]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new gr([i.CONSTANT_COLOR,i.ONE,i.CONSTANT_COLOR,i.ONE],new r.aj(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?gr.unblended:gr.alphaBlended}colorModeForDrapableLayerRenderPass(i){const a=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&this.renderPass==="translucent"?new gr([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new r.aj(0,0,0,i===void 0?0:i),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(i,a,p,g=!1){if(this.depthOcclusion)return new Ri(this.context.gl.GREATER,Ri.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!g)return Ri.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new Ri(p||this.context.gl.LEQUAL,a,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const i=this.context.gl,a=Math.ceil(this.width),p=Math.ceil(this.height),g=this.context.bindFramebuffer.get(),b=i.getParameter(i.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===a&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),a!==0&&p!==0&&(this.depthFBO=new pg(this.context,a,p,!1,"texture"),this.depthTexture=new r.T(this.context,{width:a,height:p,data:null},i.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(g),i.bindTexture(i.TEXTURE_2D,b),this.depthFBO&&(i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),i.blitFramebuffer(0,0,a,p,0,0,a,p,i.DEPTH_BUFFER_BIT,i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((i,a)=>i+a/this._fpsHistory.length,0))}render(i,a){const p=r.q.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=i.map.repaint,this.style=i,this.options=a;const g=this.style._mergedLayers,b=!(!this.terrain||!this.terrain.enabled),T=()=>this.style._getOrder(b).filter(ht=>{const bt=g[ht];return!(bt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[bt.type]});let M=T(),O=!1,L=!1;for(const ht of M){const bt=g[ht];bt.type==="circle"&&(O=!0),bt.type==="symbol"&&(bt.hasInitialOcclusionOpacityProperties?L=!0:O=!0)}let k=M.map(ht=>g[ht]);const U=this.style._mergedSourceCaches;this.imageManager=i.imageManager,this.modelManager=i.modelManager,this.symbolFadeChange=i.placement.symbolFadeChange(r.q.now()),this.imageManager.beginFrame();let j=0,Z=!1;for(const ht in U){const bt=U[ht];bt.used&&(bt.prepare(this.context),bt.getSource().usedInConflation&&++j)}let ce=!1;for(const ht of k)ht.isHidden(this.transform.zoom)||(ht.type==="clip"&&(ce=!0),this.prepareLayer(ht));const te={},_e={},me={},Se={},ke={};for(const ht in U){const bt=U[ht];te[ht]=bt.getVisibleCoordinates(),_e[ht]=te[ht].slice().reverse(),me[ht]=bt.getVisibleCoordinates(!0).reverse(),Se[ht]=bt.getShadowCasterCoordinates(),ke[ht]=bt.sortCoordinatesByDistance(te[ht])}const Oe=ht=>{const bt=this.style.getLayerSourceCache(ht);return bt&&bt.used?bt.getSource():null};if(j||ce||this._clippingActiveLastFrame){const ht=[],bt=[];let Vt=0;for(const ut of k)this.isSourceForClippingOrConflation(ut,Oe(ut))&&(ht.push(ut),bt.push(Vt)),Vt++;if(ht&&(ce||ht.length>1)||this._clippingActiveLastFrame){ce=!1;const ut=[];for(let Ot=0;Ot<ht.length;Ot++){const wt=ht[Ot],Qt=bt[Ot],kt=this.style.getLayerSourceCache(wt);if(!kt||!kt.used||!kt.getSource().usedInConflation&&wt.type!=="clip")continue;let Dt=r.dx,Gt=r.by.None;const Jt=[];let ci=!0;if(wt.type==="clip"){Dt=Qt;for(const _i of wt.layout.get("clip-layer-types"))Gt|=_i==="model"?r.by.Model:_i==="symbol"?r.by.Symbol:r.by.FillExtrusion;for(const _i of wt.layout.get("clip-layer-scope"))Jt.push(_i);wt.isHidden(this.transform.zoom)?ci=!1:ce=!0}ci&&ut.push({layer:wt.fqid,cache:kt,order:Dt,clipMask:Gt,clipScope:Jt})}this.replacementSource.setSources(ut),Z=!0}}this._clippingActiveLastFrame=ce,Z||this.replacementSource.clear(),this.conflationActive=Z,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ht=0;ht<k.length;ht++){const bt=k[ht],Vt=bt.cutoffRange();if(this.longestCutoffRange=Math.max(Vt,this.longestCutoffRange),Vt>0){const ut=Oe(bt);ut&&(this.minCutoffZoom=Math.max(ut.minzoom,this.minCutoffZoom)),bt.minzoom&&(this.minCutoffZoom=Math.max(bt.minzoom,this.minCutoffZoom))}bt.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ht),this._lastOcclusionLayer=ht)}const je=this.style&&this.style.fog;je?(this._fogVisible=je.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=je.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(me),this.opaquePassCutoff=0,M=T(),k=M.map(ht=>g[ht]));const Ve=this._shadowRenderer;if(Ve){Ve.updateShadowParameters(this.transform,this.style.directionalLight);for(const ht in U)for(const bt of te[ht]){let Vt={min:0,max:0};this.terrain&&(Vt=this.terrain.getMinMaxForTile(bt)||Vt),Ve.addShadowReceiver(bt.toUnwrapped(),Vt.min,Vt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.dw(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new _1(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Ue=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Ne=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Ue&&!this._snow&&(this._snow=new Ig(this)),!Ue&&this._snow&&(this._snow.destroy(),delete this._snow),Ne&&!this._rain&&(this._rain=new Dh(this)),!Ne&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!be.has(this.context.gl))return;this.renderPass="offscreen";for(const ht of k){const bt=i.getLayerSourceCache(ht);if(!ht.hasOffscreenPass()||ht.isHidden(this.transform.zoom))continue;const Vt=bt?_e[bt.id]:void 0;(ht.type==="custom"||ht.type==="raster"||ht.type==="raster-particle"||ht.isSky()||Vt&&Vt.length)&&this.renderLayer(this,bt,ht,Vt)}this.depthRangeFor3D=[0,1-(k.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Se)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ye=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),it=(()=>{if(a.showOverdrawInspector)return r.aj.black;const ht=this.style.fog;if(ht&&this.transform.projection.supportsFog){const bt=this.style.getLut(ht.scope);if(!Ye){const Vt=ht.properties.get("color-use-theme")==="none",ut=ht.properties.get("color").toRenderColor(Vt?null:bt).toArray01();return new r.aj(...ut)}if(Ye){const Vt=ht.properties.get("space-color-use-theme")==="none",ut=ht.properties.get("space-color").toRenderColor(Vt?null:bt).toArray01();return new r.aj(...ut)}}return r.aj.transparent})();if(this.context.clear({color:it,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ye&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=M.length-1;this.currentLayer>=0;this.currentLayer--){const ht=k[this.currentLayer],bt=i.getLayerSourceCache(ht);if(ht.isSky())continue;const Vt=bt?(ht.is3D()?ke:_e)[bt.id]:void 0;this._renderTileClippingMasks(ht,bt,Vt),this.renderLayer(this,bt,ht,Vt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ye&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.ae(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<M.length;this.currentLayer++){const ht=k[this.currentLayer],bt=i.getLayerSourceCache(ht);ht.isSky()&&this.renderLayer(this,bt,ht,bt?_e[bt.id]:void 0)}function xt(ht,bt){let Vt;return bt&&(Vt=(ht.type==="symbol"?me:ht.is3D()?ke:_e)[bt.id]),Vt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<M.length;){const ht=k[this.currentLayer];if(ht.type==="raster"||ht.type==="raster-particle"){const bt=i.getLayerSourceCache(ht);this.renderLayer(this,bt,ht,xt(ht,bt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let _t=0;Ve&&(_t=Ve.getShadowCastingLayerCount());let Rt=!1,Pt=-1;for(let ht=0;ht<M.length;++ht){const bt=k[ht];bt.isHidden(this.transform.zoom)||bt.is3D()&&(Pt=ht)}for(L&&Pt===-1&&(O=!0);this.currentLayer<M.length;){const ht=k[this.currentLayer],bt=i.getLayerSourceCache(ht);if(ht.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(ht)){if(ht.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(O&&!Rt&&this.terrain&&!this.transform.isOrthographic&&(Rt=!0,this.blitDepth()),L&&Pt!==-1&&this.currentLayer===Pt+1&&!this.transform.isOrthographic&&this.blitDepth(),ht.is3D()||this.terrain||this._renderTileClippingMasks(ht,bt,bt?te[bt.id]:void 0),this.renderLayer(this,bt,ht,xt(ht,bt)),!this.terrain&&Ve&&_t>0&&ht.hasShadowPass()&&--_t==0&&(Ve.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Vt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Vt;this.currentLayer++){const ut=k[this.currentLayer];if(!ut.hasLightBeamPass())continue;const Ot=i.getLayerSourceCache(ut);this.renderLayer(this,Ot,ut,Ot?_e[Ot.id]:void 0)}this.currentLayer=Vt,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Vt=this.currentLayer;this.depthOcclusion=!0;for(const ut of this.layersWithOcclusionOpacity){this.currentLayer=ut;const Ot=k[this.currentLayer],wt=i.getLayerSourceCache(Ot),Qt=wt?_e[wt.id]:void 0;Ot.is3D()||this.terrain||this._renderTileClippingMasks(Ot,wt,wt?te[wt.id]:void 0),this.renderLayer(this,wt,Ot,Qt)}this.depthOcclusion=!1,this.currentLayer=Vt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ht=null;k.forEach(bt=>{const Vt=i.getLayerSourceCache(bt);Vt&&!bt.isHidden(this.transform.zoom)&&Vt.getVisibleCoordinates().length&&(!ht||ht.getSource().maxzoom<Vt.getSource().maxzoom)&&(ht=Vt)}),ht&&this.options.showTileBoundaries&&pf.debug(this,ht,ht.getVisibleCoordinates(),r.aj.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&pf.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.aj(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ht){const bt=ht.transform.padding;yg(ht,ht.transform.height-(bt.top||0),3,Ph),yg(ht,bt.bottom||0,3,gw),vg(ht,bt.left||0,3,yw),vg(ht,ht.transform.width-(bt.right||0),3,p1);const Vt=ht.transform.centerPoint;(function(ut,Ot,wt,Qt){Mu(ut,Ot-1,wt-10,2,20,Qt),Mu(ut,Ot-10,wt-1,20,2,Qt)})(ht,Vt.x,ht.transform.height-Vt.y,Kp)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Z||(this.conflationActive=!1)}prepareLayer(i){this.gpuTimingStart(i);const{unsupportedLayers:a}=this.transform.projection,p=!a||!a.includes(i.type);if(mf[i.type]&&(p||this.terrain&&i.type==="custom")){const g=this.style.getLayerSourceCache(i);mf[i.type](i,g,this)}this.gpuTimingEnd()}renderLayer(i,a,p,g){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||g&&g.length)&&(this.id=p.id,this.gpuTimingStart(p),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(p.type)&&(!i.terrain||p.type!=="custom")||p.type==="clip"||pf[p.type](i,a,p,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery,p=this.context.gl;let g=this.gpuTimers[i.id];g||(g=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:p.createQuery()}),g.calls++,p.beginQuery(a.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,a=this.context.gl,p=a.createQuery();this.deferredRenderGpuTimeQueries.push(p),a.beginQuery(i.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const a={};for(const p in i){const g=i[p],b=this.context.extTimerQuery,T=b.getQueryParameter(g.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(g.query),a[p]=T}return a}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.gl;let p=0;for(const g of i)p+=a.getQueryParameter(g,a.QUERY_RESULT)/1e6,a.deleteQuery(g);return p}translatePosMatrix(i,a,p,g,b){if(!p[0]&&!p[1])return i;const T=b?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(T){const L=Math.sin(T),k=Math.cos(T);p=[p[0]*k-p[1]*L,p[0]*L+p[1]*k]}const M=[b?p[0]:r.ar(a,p[0],this.transform.zoom),b?p[1]:r.ar(a,p[1],this.transform.zoom),0],O=new Float32Array(16);return r.ab.mat4.translate(O,i,M),O}saveTileTexture(i){const a=i.size[0],p=this._tileTextures[a];p?p.push(i):this._tileTextures[a]=[i]}getTileTexture(i){const a=this._tileTextures[i];return a&&a.length>0?a.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(i,a,p){const g=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,b=[];return this.style&&this.style.enable3dLights()&&(i==="globeRaster"||i==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):g||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||b.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||g||a!==void 0&&!a||b.push("FOG","FOG_DITHERING"),g&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(i,a){this.cache=this.cache||{};const p=a&&a.defines||[],g=a&&a.config,b=this.currentGlobalDefines(i,a&&a.overrideFog,a&&a.overrideRtt).concat(p),T=o1.cacheKey(Fn[i],i,b,g);return this.cache[T]||(this.cache[T]=new o1(this.context,i,Fn[i],g,fg[i],b)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(i,a){if(this.style.enable3dLights()){const p=this.style.directionalLight,g=this.style.ambientLight;if(p&&g){const b=((T,M,O)=>{const L=T.properties.get("direction"),k=T.properties.get("color-use-theme")==="none",U=T.properties.get("color").toRenderColor(k?null:O.getLut(T.scope)).toArray01(),j=T.properties.get("intensity"),Z=M.properties.get("color-use-theme")==="none",ce=M.properties.get("color").toRenderColor(Z?null:O.getLut(M.scope)).toArray01(),te=M.properties.get("intensity"),_e=[L.x,L.y,L.z],me=r.cM(ce,te),Se=r.cM(U,j);return{u_lighting_ambient_color:me,u_lighting_directional_dir:_e,u_lighting_directional_color:Se,u_ground_radiance:dw(_e,Se,me)}})(p,g,this.style);a.setLightsUniformValues(i,b)}}}uploadCommonUniforms(i,a,p,g,b){if(this.uploadCommonLightUniforms(i,a),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const M=T.getOpacity(this.transform.pitch),O=((L,k,U,j,Z,ce,te,_e,me,Se,ke,Oe)=>{const je=L.transform,Ve=k.properties.get("color-use-theme")==="none",Ue=k.properties.get("color").toRenderColor(Ve?null:L.style.getLut(k.scope)).toArray01();Ue[3]=j;const Ne=L.frameCounter/1e3%1,[Ye,it]=k.properties.get("vertical-range");return{u_fog_matrix:U?je.calculateFogTileMatrix(U):Oe||L.identityMat,u_fog_range:k.getFovAdjustedRange(je._fov),u_fog_color:Ue,u_fog_horizon_blend:k.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ye,it),it],u_fog_temporal_offset:Ne,u_frustum_tl:Z,u_frustum_tr:ce,u_frustum_br:te,u_frustum_bl:_e,u_globe_pos:me,u_globe_radius:Se,u_viewport:ke,u_globe_transition:r.ae(je.zoom),u_is_globe:+(je.projection.name==="globe")}})(this,T,p,M,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.q.devicePixelRatio,this.transform.height*r.q.devicePixelRatio],g);a.setFogUniformValues(i,O)}b&&a.setCutoffUniformValues(i,b.uniformValues)}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,a=i.createTexture();return i.bindTexture(i.TEXTURE_2D,a),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,a=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const g of p)a[g.key]=i[g.key]||new Xa(g,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(i,a){return!(!i.is3D()||i.type!=="clip"&&(i.minzoom&&i.minzoom>this.transform.zoom||(this.style._clipLayerPresent||i.sourceLayer!=="building")&&(!a||a.type!=="batched-model")))}isTileAffectedByFog(i){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[i.key];return a||(this._cachedTileFogOpacities[i.key]=a=this.style.fog.getOpacityForTile(i)),a[0]>=Le||a[1]>=Le}setupDepthForOcclusion(i,a,p){const g=this.context,b=g.gl,T=!!p;var M;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),g.activeTexture.set(b.TEXTURE3),i&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((M=this.depthRangeFor3D)[1]-M[0]),-1-2*M[0]/(M[1]-M[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),g.activeTexture.set(b.TEXTURE0),T||a.setTerrainUniformValues(g,p)}}function nm(f,i){let a=!1,p=null;const g=()=>{p=null,a&&(f(),p=setTimeout(g,i),a=!1)};return()=>(a=!0,p||g(),p)}class g1{constructor(i){this._hashName=i&&encodeURIComponent(i),r.aP(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=nm(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const a=Rg(i);if(this._hashName){const p=this._hashName;let g=!1;const b=location.hash.slice(1).split("&").map(T=>{const M=T.split("=")[0];return M===p?(g=!0,`${M}=${a}`):T}).filter(T=>T);return g||b.push(`${p}=${a}`),`#${b.join("&")}`}return`#${a}`}_getCurrentHash(){const i=location.hash.replace("#","");if(this._hashName){let a;return i.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(a=p)}),(a&&a[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(p=>isNaN(p))){const p=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(a[3]||0):i.getBearing();return i.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:p,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Rg(f,i){const a=f.getCenter(),p=Math.round(100*f.getZoom())/100,g=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,g),T=Math.round(a.lng*b)/b,M=Math.round(a.lat*b)/b,O=f.getBearing(),L=f.getPitch();let k=i?`/${T}/${M}/${p}`:`${p}/${M}/${T}`;return(O||L)&&(k+="/"+Math.round(10*O)/10),L&&(k+=`/${Math.round(L)}`),k}const _f={linearity:.3,easing:r.dy(0,0,.3,1)},y1=r.l({deceleration:2500,maxSpeed:1400},_f),v1=r.l({deceleration:20,maxSpeed:1400},_f),x1=r.l({deceleration:1e3,maxSpeed:360},_f),b1=r.l({deceleration:1e3,maxSpeed:90},_f);class w1{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.q.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,a=r.q.now();for(;i.length>0&&a-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)a.zoom+=b.zoomDelta||0,a.bearing+=b.bearingDelta||0,a.pitch+=b.pitchDelta||0,b.panDelta&&a.pan._add(b.panDelta),b.around&&(a.around=b.around),b.pinchAround&&(a.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(a.pan.mag()){const b=yf(a.pan.mag(),p,r.l({},y1,i||{}));g.offset=a.pan.mult(b.amount/a.pan.mag()),g.center=this._map.transform.center,gf(g,b)}if(a.zoom){const b=yf(a.zoom,p,v1);g.zoom=this._map.transform.zoom+b.amount,gf(g,b)}if(a.bearing){const b=yf(a.bearing,p,x1);g.bearing=this._map.transform.bearing+r.aw(b.amount,-179,179),gf(g,b)}if(a.pitch){const b=yf(a.pitch,p,b1);g.pitch=this._map.transform.pitch+b.amount,gf(g,b)}if(g.zoom||g.bearing){const b=a.pinchAround===void 0?a.around:a.pinchAround;g.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function gf(f,i){(!f.duration||f.duration<i.duration)&&(f.duration=i.duration,f.easing=i.easing)}function yf(f,i,a){const{maxSpeed:p,linearity:g,deceleration:b}=a,T=r.aw(f*g/(i/1e3),-p,p),M=Math.abs(T)/(b*g);return{easing:a.easing,duration:1e3*M,amount:T*(M/2)}}class jo extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a,p,g={}){const b=re(a.getCanvasContainer(),p),T=a.unproject(b);super(i,r.l({point:b,lngLat:T,originalEvent:p},g)),this._defaultPrevented=!1,this.target=a}}class vf extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a,p){const g=i==="touchend"?p.changedTouches:p.touches,b=oe(a.getCanvasContainer(),g),T=b.map(O=>a.unproject(O)),M=b.reduce((O,L,k,U)=>O.add(L.div(U.length)),new r.P(0,0));super(i,{points:b,point:M,lngLats:T,lngLat:a.unproject(M),originalEvent:p}),this._defaultPrevented=!1}}class T1 extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a){super("wheel",{originalEvent:a}),this._defaultPrevented=!1}}class xw{constructor(i,a){this._map=i,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new T1(this._map,i))}mousedown(i,a){return this._mousedownPos=a,this._firePreventable(new jo(i.type,this._map,i))}mouseup(i){this._map.fire(new jo(i.type,this._map,i))}preclick(i){const a=r.l({},i);a.type="preclick",this._map.fire(new jo(a.type,this._map,a))}click(i,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(i),this._map.fire(new jo(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new jo(i.type,this._map,i))}mouseover(i){this._map.fire(new jo(i.type,this._map,i))}mouseout(i){this._map.fire(new jo(i.type,this._map,i))}touchstart(i){return this._firePreventable(new vf(i.type,this._map,i))}touchmove(i){this._map.fire(new vf(i.type,this._map,i))}touchend(i){this._map.fire(new vf(i.type,this._map,i))}touchcancel(i){this._map.fire(new vf(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bw{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new jo(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new jo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new jo(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ts{constructor(i,a){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,a){this.isEnabled()&&i.shiftKey&&i.button===0&&(ne(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(i,a){if(!this._active)return;const p=a,g=this._startPos,b=this._lastPos;if(!g||!b||b.equals(p)||!this._box&&p.dist(g)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=G("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const T=Math.min(g.x,p.x),M=Math.max(g.x,p.x),O=Math.min(g.y,p.y),L=Math.max(g.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${O}px)`,this._box.style.width=M-T+"px",this._box.style.height=L-O+"px")})}mouseupWindow(i,a){if(!this._active)return;const p=this._startPos,g=a;if(p&&i.button===0){if(this.reset(),le(),p.x!==g.x||p.y!==g.y)return this._map.fire(new r.z("boxzoomend",{originalEvent:i})),{cameraAnimation:b=>b.fitScreenCoordinates(p,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ue(),delete this._startPos,delete this._lastPos}_fireEvent(i,a){return this._map.fire(new r.z(i,{originalEvent:a}))}}function sm(f,i){const a={};for(let p=0;p<f.length;p++)a[f[p].identifier]=i[p];return a}class ww{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,a,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),p.length===this.numTouches&&(this.centroid=function(g){const b=new r.P(0,0);for(const T of g)b._add(T);return b.div(g.length)}(a),this.touches=sm(p,a)))}touchmove(i,a,p){if(this.aborted||!this.centroid)return;const g=sm(p,a);for(const b in this.touches){const T=g[b];(!T||T.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(i,a,p){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Dg{constructor(i){this.singleTap=new ww(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,a,p){this.singleTap.touchstart(i,a,p)}touchmove(i,a,p){this.singleTap.touchmove(i,a,p)}touchend(i,a,p){const g=this.singleTap.touchend(i,a,p);if(g){const b=i.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(g)<30;if(b&&T||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class xf{constructor(){this._zoomIn=new Dg({numTouches:1,numTaps:2}),this._zoomOut=new Dg({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,a,p){this._zoomIn.touchstart(i,a,p),this._zoomOut.touchstart(i,a,p)}touchmove(i,a,p){this._zoomIn.touchmove(i,a,p),this._zoomOut.touchmove(i,a,p)}touchend(i,a,p){const g=this._zoomIn.touchend(i,a,p),b=this._zoomOut.touchend(i,a,p);return g?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(g)},{originalEvent:i})}):b?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(b)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const E1={0:1,2:2};class bf{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,a){return!1}_move(i,a){return{}}mousedown(i,a){if(this._lastPoint)return;const p=se(i);this._correctButton(i,p)&&(this._lastPoint=a,this._eventButton=p)}mousemoveWindow(i,a){const p=this._lastPoint;if(p){if(i.preventDefault(),this._eventButton!=null&&function(g,b){const T=E1[b];return g.buttons===void 0||(g.buttons&T)!==T}(i,this._eventButton))this.reset();else if(this._moved||!(a.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(p,a)}}mouseupWindow(i){this._lastPoint&&se(i)===this._eventButton&&(this._moved&&le(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class om extends bf{mousedown(i,a){super.mousedown(i,a),this._lastPoint&&(this._active=!0)}_correctButton(i,a){return a===0&&!i.ctrlKey}_move(i,a){return{around:a,panDelta:a.sub(i)}}}class Fl extends bf{_correctButton(i,a){return a===0&&i.ctrlKey||a===2}_move(i,a){const p=.8*(a.x-i.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(i){i.preventDefault()}}class wf extends bf{_correctButton(i,a){return a===0&&i.ctrlKey||a===2}_move(i,a){const p=-.5*(a.y-i.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(i){i.preventDefault()}}class ss{constructor(i,a){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),r.aP(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(i,a,p){return this._calculateTransform(i,a,p)}touchmove(i,a,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!r.dz())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,a,p)}}touchend(i,a,p){this._calculateTransform(i,a,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,a,p){p.length>0&&(this._active=!0);const g=sm(p,a),b=new r.P(0,0),T=new r.P(0,0);let M=0;for(const L in g){const k=g[L],U=this._touches[L];U&&(b._add(k),T._add(k.sub(U)),M++,g[L]=k)}if(this._touches=g,M<this._minTouches||!T.mag())return;const O=T.div(M);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(M),panDelta:O}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=G("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Da{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,a,p){return{}}touchstart(i,a,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([a[0],a[1]]))}touchmove(i,a,p){const g=this._firstTwoTouches;if(!g)return;i.preventDefault();const[b,T]=g,M=Oh(p,a,b),O=Oh(p,a,T);if(!M||!O)return;const L=this._aroundCenter?null:M.add(O).div(2);return this._move([M,O],L,i)}touchend(i,a,p){if(!this._firstTwoTouches)return;const[g,b]=this._firstTwoTouches,T=Oh(p,a,g),M=Oh(p,a,b);T&&M||(this._active&&le(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Oh(f,i,a){for(let p=0;p<f.length;p++)if(f[p].identifier===a)return i[p]}function Tf(f,i){return Math.log(f/i)/Math.LN2}class S1 extends Da{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,a){const p=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Tf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Tf(this._distance,p),pinchAround:a}}}function A1(f,i){return 180*f.angleWith(i)/Math.PI}class Ef extends Da{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,a){const p=this._vector;if(this._vector=i[0].sub(i[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:A1(this._vector,p),pinchAround:a}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const a=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const g=A1(i,p);return Math.abs(g)<a}}function Og(f){return Math.abs(f.y)>Math.abs(f.x)}class Tw extends Da{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,Og(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,a,p){const g=this._lastPoints;if(!g)return;const b=i[0].sub(g[0]),T=i[1].sub(g[1]);return this._map._cooperativeGestures&&!r.dz()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(b,T,p.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(b.y+T.y)/2*-.5})}gestureBeginsVertically(i,a,p){if(this._valid!==void 0)return this._valid;const g=i.mag()>=2,b=a.mag()>=2;if(!g&&!b)return;if(!g||!b)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const T=i.y>0==a.y>0;return Og(i)&&Og(a)&&T}}const Lg={panStep:100,bearingStep:15,pitchStep:10};class kg{constructor(){const i=Lg;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let a=0,p=0,g=0,b=0,T=0;switch(i.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:i.shiftKey?p=-1:(i.preventDefault(),b=-1);break;case 39:i.shiftKey?p=1:(i.preventDefault(),b=1);break;case 38:i.shiftKey?g=1:(i.preventDefault(),T=-1);break;case 40:i.shiftKey?g=-1:(i.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(p=0,g=0),{cameraAnimation:M=>{const O=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:Pu,zoom:a?Math.round(O)+a*(i.shiftKey?2:1):O,bearing:M.getBearing()+p*this._bearingStep,pitch:M.getPitch()+g*this._pitchStep,offset:[-b*this._panStep,-T*this._panStep],center:M.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Pu(f){return f*(2-f)}const Ru=4.000244140625,gc=1/450;class rl{constructor(i,a){this._map=i,this._el=i.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=gc,r.aP(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||r.dz()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const p=r.q.now(),g=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,a!==0&&a%Ru==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=a,this._timeout=window.setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(g*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),i.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=i,this._delta-=a,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=re(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>Ru?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&k!==0&&(k=1/k);const U=a(),j=Math.pow(2,U),Z=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):j;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(Z*k))),this._type==="wheel"&&(this._startZoom=U,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:a(),g=this._startZoom,b=this._easing;let T,M=!1;if(this._type==="wheel"&&g&&b){const L=Math.min((r.q.now()-this._lastWheelEventTime)/200,1),k=b(L);T=r.af(g,p,k),L<1?this._frameId||(this._frameId=!0):M=!0}else T=p,M=!0;this._active=!0,M&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let O=T-a();return O*this._lastDelta<0&&(O=0),{noInertia:!0,needsRenderFrame:!M,zoomDelta:O,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let a=r.dA;if(this._prevEase){const p=this._prevEase,g=(r.q.now()-p.start)/p.duration,b=p.easing(g+.01)-p.easing(g),T=.27/Math.sqrt(b*b+1e-4)*.01,M=Math.sqrt(.0729-T*T);a=r.dy(T,M,.25,1)}return this._prevEase={start:r.q.now(),duration:i,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=G("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Gc{constructor(i,a){this._clickZoom=i,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Du{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,a){return i.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(i.shiftKey?-1:1),around:p.unproject(a)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wc{constructor(){this._tap=new Dg({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,a,p){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=a[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(i,a,p))}touchmove(i,a,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const g=a[0],b=g.y-this._swipePoint.y;return this._swipePoint=g,i.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(i,a,p)}touchend(i,a,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(i,a,p)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ew{constructor(i,a,p){this._el=i,this._mousePan=a,this._touchPan=p}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Sw{constructor(i,a,p){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=a,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Aw{constructor(i,a,p,g){this._el=i,this._touchZoom=a,this._touchRotate=p,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const am=f=>f.zoom||f.drag||f.pitch||f.rotate;class C1 extends r.z{}class So{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,a){const p=r.ab.vec3.sub([],a,i);this.radius=r.ab.vec3.length(p[2]<0?r.ab.vec3.div([],p,this.constants):[p[0],p[1],0])}projectRay(i){r.ab.vec3.div(i,i,this.constants),r.ab.vec3.normalize(i,i),r.ab.vec3.mul(i,i,this.constants);const a=r.ab.vec3.scale([],i,this.radius);if(a[2]>0){const p=r.ab.vec3.scale([],[0,0,1],r.ab.vec3.dot(a,[0,0,1])),g=r.ab.vec3.scale([],r.ab.vec3.normalize([],[a[0],a[1],0]),this.radius),b=r.ab.vec3.add([],a,r.ab.vec3.scale([],r.ab.vec3.sub([],r.ab.vec3.add([],g,p),a),2));a[0]=b[0],a[1]=b[1]}return a}}function Lh(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class M1{constructor(i,a){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new w1(i),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new So,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),r.aP(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,b,T]of this._listeners){const M=g===document?this.handleWindowEvent:this.handleEvent;g.addEventListener(b,M,T)}}destroy(){for(const[i,a,p]of this._listeners){const g=i===document?this.handleWindowEvent:this.handleEvent;i.removeEventListener(a,g,p)}}_addDefaultHandlers(i){const a=this._map,p=a.getCanvasContainer();this._add("mapEvent",new xw(a,i));const g=a.boxZoom=new ts(a,i);this._add("boxZoom",g);const b=new xf,T=new Du;a.doubleClickZoom=new Gc(T,b),this._add("tapZoom",b),this._add("clickZoom",T);const M=new Wc;this._add("tapDragZoom",M);const O=a.touchPitch=new Tw(a);this._add("touchPitch",O);const L=new Fl(i),k=new wf(i);a.dragRotate=new Sw(i,L,k),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const U=new om(i),j=new ss(a,i);a.dragPan=new Ew(p,U,j),this._add("mousePan",U),this._add("touchPan",j,["touchZoom","touchRotate"]);const Z=new Ef,ce=new S1;a.touchZoomRotate=new Aw(p,ce,Z,M),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",ce,["touchPan","touchRotate"]),this._add("blockableMapEvent",new bw(a));const te=a.scrollZoom=new rl(a,this);this._add("scrollZoom",te,["mousePan"]);const _e=a.keyboard=new kg;this._add("keyboard",_e);for(const me of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[me]&&a[me].enable(i[me])}_add(i,a,p){this._handlers.push({handlerName:i,handler:a,allowed:p}),this._handlersById[i]=a}stop(i){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!am(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,a,p){for(const g in i)if(g!==p&&(!a||a.indexOf(g)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const a=[];for(const p of i)this._el.contains(p.target)&&a.push(p);return a}handleEvent(i,a){this._updatingCamera=!0;const p=i.type==="renderFrame",g=p?void 0:i,b={needsRenderFrame:!1},T={},M={},O=i.touches?this._getMapTouches(i.touches):void 0,L=O?oe(this._el,O):p?void 0:re(this._el,i);for(const{handlerName:j,handler:Z,allowed:ce}of this._handlers){if(!Z.isEnabled())continue;let te;this._blockedByActive(M,ce,j)?Z.reset():Z[a||i.type]&&(te=Z[a||i.type](i,L,O),this.mergeHandlerResult(b,T,te,j,g),te&&te.needsRenderFrame&&this._triggerRenderFrame()),(te||Z.isActive())&&(M[j]=Z)}const k={};for(const j in this._previousActiveHandlers)M[j]||(k[j]=g);this._previousActiveHandlers=M,(Object.keys(k).length||Lh(b))&&(this._changes.push([b,T,k]),this._triggerRenderFrame()),(Object.keys(M).length||Lh(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=b;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(i,a,p,g,b){if(!p)return;r.l(i,p);const T={handlerName:g,originalEvent:p.originalEvent||b};p.zoomDelta!==void 0&&(a.zoom=T),p.panDelta!==void 0&&(a.drag=T),p.pitchDelta!==void 0&&(a.pitch=T),p.bearingDelta!==void 0&&(a.rotate=T)}_applyChanges(){const i={},a={},p={};for(const[g,b,T]of this._changes)g.panDelta&&(i.panDelta=(i.panDelta||new r.P(0,0))._add(g.panDelta)),g.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(i.around=g.around),g.aroundCoord!==void 0&&(i.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(i.pinchAround=g.pinchAround),g.noInertia&&(i.noInertia=g.noInertia),r.l(a,b),r.l(p,T);this._updateMapTransform(i,a,p),this._changes=[]}_updateMapTransform(i,a,p){const g=this._map,b=g.transform,T=Se=>[Se.x,Se.y,Se.z];if((Se=>{const ke=this._eventsInProgress.drag;return ke&&!this._handlersById[ke.handlerName].isActive()})()&&!Lh(i)){const Se=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),Se!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&g._stop(!0),!Lh(i))return void this._fireEvents(a,p,!0);let{panDelta:M,zoomDelta:O,bearingDelta:L,pitchDelta:k,around:U,aroundCoord:j,pinchAround:Z}=i;b._isCameraConstrained&&(O>0&&(O=0),b._isCameraConstrained=!1),Z!==void 0&&(U=Z),(O||(Se=>a[Se]&&!this._eventsInProgress[Se])("drag"))&&U&&(this._dragOrigin=T(b.pointCoordinate3D(U)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",g._stop(!0),U=U||g.transform.centerPoint,L&&(b.bearing+=L),k&&(b.pitch+=k),b._updateCameraState();const ce=[0,0,0];if(M)if(b.projection.name==="mercator"){const Se=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(U).dir),ke=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(U.sub(M)).dir);ce[0]=ke[0]-Se[0],ce[1]=ke[1]-Se[1]}else{const Se=b.pointCoordinate(U);if(b.projection.name==="globe"){M=M.rotate(-b.angle);const ke=b._pixelsPerMercatorPixel/b.worldSize;ce[0]=-M.x*r.dB(r.aS(Se.y))*ke,ce[1]=-M.y*r.dB(b.center.lat)*ke}else{const ke=b.pointCoordinate(U.sub(M));Se&&ke&&(ce[0]=ke.x-Se.x,ce[1]=ke.y-Se.y)}}const te=b.zoom,_e=[0,0,0];if(O){const Se=T(j||b.pointCoordinate3D(U)),ke={dir:r.ab.vec3.normalize([],r.ab.vec3.sub([],Se,b._camera.position))};if(ke.dir[2]<0){const Oe=b.zoomDeltaToMovement(Se,O);r.ab.vec3.scale(_e,ke.dir,Oe)}}const me=r.ab.vec3.add(ce,ce,_e);b._translateCameraConstrained(me),O&&Math.abs(b.zoom-te)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(a,p,!0)}_fireEvents(i,a,p){const g=am(this._eventsInProgress),b=am(i),T={};for(const k in i){const{originalEvent:U}=i[k];this._eventsInProgress[k]||(T[`${k}start`]=U),this._eventsInProgress[k]=i[k]}!g&&b&&this._fireEvent("movestart",b.originalEvent);for(const k in T)this._fireEvent(k,T[k]);b&&this._fireEvent("move",b.originalEvent);for(const k in i){const{originalEvent:U}=i[k];this._fireEvent(k,U)}const M={};let O;for(const k in this._eventsInProgress){const{handlerName:U,originalEvent:j}=this._eventsInProgress[k];this._handlersById[U].isActive()||(delete this._eventsInProgress[k],O=a[U]||j,M[`${k}end`]=O)}for(const k in M)this._fireEvent(k,M[k]);const L=am(this._eventsInProgress);if(p&&(g||b)&&!L){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;k?(U(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:O})):(this._map.fire(new r.z("moveend",{originalEvent:O})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,a){this._map.fire(new r.z(i,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new C1("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const I1="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class kh extends r.E{constructor(i,a){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,r.aP(["_renderFrameCallback"],this)}getCenter(){return new r.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(i,a){return this.jumpTo({center:i},a)}panBy(i,a,p){return i=r.P.convert(i).mult(-1),this.panTo(this.transform.center,r.l({offset:i},a),p)}panTo(i,a,p){return this.easeTo(r.l({center:i},a),p)}getZoom(){return this.transform.zoom}setZoom(i,a){return this.jumpTo({zoom:i},a),this}zoomTo(i,a,p){return this.easeTo(r.l({zoom:i},a),p)}zoomIn(i,a){return this.zoomTo(this.getZoom()+1,i,a),this}zoomOut(i,a){return this.zoomTo(this.getZoom()-1,i,a),this}getBearing(){return this.transform.bearing}setBearing(i,a){return this.jumpTo({bearing:i},a),this}getPadding(){return this.transform.padding}setPadding(i,a){return this.jumpTo({padding:i},a),this}rotateTo(i,a,p){return this.easeTo(r.l({bearing:i},a),p)}resetNorth(i,a){return this.rotateTo(0,r.l({duration:1e3},i),a),this}resetNorthPitch(i,a){return this.easeTo(r.l({bearing:0,pitch:0,duration:1e3},i),a),this}snapToNorth(i,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,a):this}getPitch(){return this.transform.pitch}setPitch(i,a){return this.jumpTo({pitch:i},a),this}cameraForBounds(i,a){i=r.az.convert(i);const p=a&&a.bearing||0,g=a&&a.pitch||0,b=i.getNorthWest(),T=i.getSouthEast();return this._cameraForBounds(this.transform,b,T,p,g,a)}_extendPadding(i){const a={top:0,right:0,bottom:0,left:0};return i==null?r.l({},a,this.transform.padding):typeof i=="number"?{top:i,bottom:i,right:i,left:i}:r.l({},a,i)}_extendCameraOptions(i){return(i=r.l({offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=this._extendPadding(i.padding),i}_minimumAABBFrustumDistance(i,a){const p=a.max[0]-a.min[0],g=a.max[1]-a.min[1];return p/g>i.aspect?p/(2*Math.tan(.5*i.fovX)*i.aspect):g/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,a,p,g,b,T){const M=i.clone(),O=this._extendCameraOptions(T);M.bearing=g,M.pitch=b;const L=r.bO.convert(a),k=r.bO.convert(p),U=.5*(L.lat+k.lat),j=.5*(L.lng+k.lng),Z=r.dC(U,j),ce=r.ab.vec3.normalize([],Z),te=r.ab.vec3.normalize([],r.ab.vec3.cross([],ce,[0,1,0])),_e=r.ab.vec3.cross([],te,ce),me=[te[0],te[1],te[2],0,_e[0],_e[1],_e[2],0,ce[0],ce[1],ce[2],0,0,0,0,1],Se=[Z,r.dC(L.lat,L.lng),r.dC(k.lat,L.lng),r.dC(k.lat,k.lng),r.dC(L.lat,k.lng),r.dC(U,L.lng),r.dC(U,k.lng),r.dC(L.lat,j),r.dC(k.lat,j)];let ke=r.cd.fromPoints(Se.map(wt=>[r.ab.vec3.dot(te,wt),r.ab.vec3.dot(_e,wt),r.ab.vec3.dot(ce,wt)]));const Oe=r.ab.vec3.transformMat4([],ke.center,me);r.ab.vec3.squaredLength(Oe)===0&&r.ab.vec3.set(Oe,0,0,1),r.ab.vec3.normalize(Oe,Oe),r.ab.vec3.scale(Oe,Oe,r.ax),M.center=r.dD(Oe);const je=M.getWorldToCameraMatrix(),Ve=r.ab.mat4.invert(new Float64Array(16),je);ke=r.cd.applyTransform(ke,r.ab.mat4.multiply([],je,me));const Ue=this._extendAABB(ke,M,O,g);if(!Ue)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ke=Ue,r.ab.vec3.transformMat4(Oe,Oe,je);const Ne=.5*(ke.max[2]-ke.min[2]),Ye=this._minimumAABBFrustumDistance(M,ke),it=r.ab.vec3.scale([],[0,0,1],Ne),xt=r.ab.vec3.add(it,Oe,it),_t=Ye+(M.pitch===0?0:r.ab.vec3.distance(Oe,xt)),Rt=M.globeCenterInViewSpace,Pt=r.ab.vec3.sub([],Oe,[Rt[0],Rt[1],Rt[2]]);r.ab.vec3.normalize(Pt,Pt),r.ab.vec3.scale(Pt,Pt,_t);const ht=r.ab.vec3.add([],Oe,Pt);r.ab.vec3.transformMat4(ht,ht,Ve);const bt=r.ds/r.ax,Vt=r.ab.vec3.length(ht),ut=r.bH(Math.max(Vt*bt-r.ds,Number.EPSILON),0),Ot=Math.min(M.zoomFromMercatorZAdjusted(ut),O.maxZoom);return Ot>.5*(r.c6+r.bY)?(M.setProjection({name:"mercator"}),M.zoom=Ot,this._cameraForBounds(M,a,p,g,b,T)):{center:M.center,zoom:Ot,bearing:g,pitch:b}}_extendAABB(i,a,p,g){const b=.5*((p.padding.left||0)+(p.padding.right||0)),T=.5*((p.padding.top||0)+(p.padding.bottom||0)),M=T,O=b,L=b,k=T,U=a.width-(O+L),j=a.height-(M+k),Z=r.ab.vec3.sub([],i.max,i.min),ce=Math.min(U/Z[0],j/Z[1]),te=Math.min(a.scaleZoom(a.scale*ce),p.maxZoom);if(isNaN(te))return null;const _e=a.scale/a.zoomScale(te),me=new r.cd([i.min[0]-O*_e,i.min[1]-k*_e,i.min[2]],[i.max[0]+L*_e,i.max[1]+M*_e,i.max[2]]),Se=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new r.P(p.offset.x,p.offset.y):r.P.convert(p.offset)).rotate(-r.ai(g));return me.center[0]-=Se.x*_e,me.center[1]+=Se.y*_e,me}queryTerrainElevation(i,a){const p=this.transform.elevation;return p?(a=r.l({},{exaggerated:!0},a),p.getAtPoint(r.aa.fromLngLat(i),null,a.exaggerated)):null}_cameraForBounds(i,a,p,g,b,T){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,a,p,g,b,T);const M=i.clone(),O=this._extendCameraOptions(T);M.bearing=g,M.pitch=b;const L=r.bO.convert(a),k=r.bO.convert(p),U=new r.bO(L.lng,k.lat),j=new r.bO(k.lng,L.lat),Z=M.project(L),ce=M.project(k),te=this.queryTerrainElevation(L),_e=this.queryTerrainElevation(k),me=this.queryTerrainElevation(U),Se=this.queryTerrainElevation(j),ke=[[Z.x,Z.y,Math.min(te||0,_e||0,me||0,Se||0)],[ce.x,ce.y,Math.max(te||0,_e||0,me||0,Se||0)]];let Oe=r.cd.fromPoints(ke);const je=M.getWorldToCameraMatrix(),Ve=r.ab.mat4.invert(new Float64Array(16),je);Oe=r.cd.applyTransform(Oe,je);const Ue=this._extendAABB(Oe,M,O,g);if(!Ue)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Oe=Ue;const Ne=.5*r.ab.vec3.sub([],Oe.max,Oe.min)[2],Ye=this._minimumAABBFrustumDistance(M,Oe),it=[0,0,1,0];r.ab.vec4.transformMat4(it,it,je),r.ab.vec4.normalize(it,it);const xt=r.ab.vec3.scale([],it,Ye+Ne),_t=r.ab.vec3.add([],Oe.center,xt);r.ab.vec3.transformMat4(Oe.center,Oe.center,Ve),r.ab.vec3.transformMat4(_t,_t,Ve);const Rt=M.unproject(new r.P(Oe.center[0],Oe.center[1])),Pt=r.dE(M.projection,Rt),ht=Math.pow(2,Pt),bt=Math.min(M._zoomFromMercatorZ(_t[2]*M.pixelsPerMeter*ht/M.worldSize),O.maxZoom);return M.mercatorFromTransition&&bt<.5*(r.c6+r.bY)?(M.setProjection({name:"globe"}),M.zoom=bt,this._cameraForBounds(M,a,p,g,b,T)):{center:Rt,zoom:bt,bearing:g,pitch:b}}fitBounds(i,a,p){const g=this.cameraForBounds(i,a);return this._fitInternal(g,a,p)}fitScreenCoordinates(i,a,p,g,b){const T=r.P.convert(i),M=r.P.convert(a),O=new r.P(Math.min(T.x,M.x),Math.min(T.y,M.y)),L=new r.P(Math.max(T.x,M.x),Math.max(T.y,M.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,M))return this;const k=this.transform.pointLocation3D(O),U=this.transform.pointLocation3D(L),j=this.transform.pointLocation3D(new r.P(O.x,L.y)),Z=this.transform.pointLocation3D(new r.P(L.x,O.y)),ce=[Math.min(k.lng,U.lng,j.lng,Z.lng),Math.min(k.lat,U.lat,j.lat,Z.lat)],te=[Math.max(k.lng,U.lng,j.lng,Z.lng),Math.max(k.lat,U.lat,j.lat,Z.lat)],_e=g&&g.pitch?g.pitch:this.getPitch(),me=this._cameraForBounds(this.transform,ce,te,p,_e,g);return this._fitInternal(me,g,b)}_fitInternal(i,a,p){return i?(a=r.l(i,a)).linear?this.easeTo(a,p):this.flyTo(a,p):this}jumpTo(i,a){this.stop();const p=i.preloadOnly?this.transform.clone():this.transform;let g=!1,b=!1,T=!1;"zoom"in i&&p.zoom!==+i.zoom&&(g=!0,p.zoom=+i.zoom),i.center!==void 0&&(p.center=r.bO.convert(i.center)),"bearing"in i&&p.bearing!==+i.bearing&&(b=!0,p.bearing=+i.bearing),"pitch"in i&&p.pitch!==+i.pitch&&(T=!0,p.pitch=+i.pitch);const M=typeof i.padding=="number"?this._extendPadding(i.padding):i.padding;if(i.padding!=null&&!p.isPaddingEqual(M))if(i.retainPadding===!1){const O=p.clone();O.padding=M,p.setLocationAtPoint(p.center,O.centerPoint)}else p.padding=M;return i.preloadOnly?(this._preloadTiles(p),this):(this.fire(new r.z("movestart",a)).fire(new r.z("move",a)),g&&this.fire(new r.z("zoomstart",a)).fire(new r.z("zoom",a)).fire(new r.z("zoomend",a)),b&&this.fire(new r.z("rotatestart",a)).fire(new r.z("rotate",a)).fire(new r.z("rotateend",a)),T&&this.fire(new r.z("pitchstart",a)).fire(new r.z("pitch",a)).fire(new r.z("pitchend",a)),this.fire(new r.z("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(I1),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,a){const p=this.transform;if(!p.projection.supportsFreeCamera)return r.w(I1),this;this.stop();const g=p.zoom,b=p.pitch,T=p.bearing;p.setFreeCameraOptions(i);const M=g!==p.zoom,O=b!==p.pitch,L=T!==p.bearing;return this.fire(new r.z("movestart",a)).fire(new r.z("move",a)),M&&this.fire(new r.z("zoomstart",a)).fire(new r.z("zoom",a)).fire(new r.z("zoomend",a)),L&&this.fire(new r.z("rotatestart",a)).fire(new r.z("rotate",a)).fire(new r.z("rotateend",a)),O&&this.fire(new r.z("pitchstart",a)).fire(new r.z("pitch",a)).fire(new r.z("pitchend",a)),this.fire(new r.z("moveend",a)),this}easeTo(i,a){this._stop(!1,i.easeId),((i=r.l({offset:[0,0],duration:500,easing:r.dA},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);const p=this.transform,g=this.getZoom(),b=this.getBearing(),T=this.getPitch(),M=this.getPadding(),O="zoom"in i?+i.zoom:g,L="bearing"in i?this._normalizeBearing(i.bearing,b):b,k="pitch"in i?+i.pitch:T,U=this._extendPadding(i.padding),j=r.P.convert(i.offset);let Z,ce,te;if(p.projection.name==="globe"){const it=r.aa.fromLngLat(p.center),xt=j.rotate(-p.angle);it.x+=xt.x/p.worldSize,it.y+=xt.y/p.worldSize;const _t=it.toLngLat(),Rt=r.bO.convert(i.center||_t);this._normalizeCenter(Rt),Z=p.centerPoint.add(xt),ce=new r.P(it.x,it.y).mult(p.worldSize),te=new r.P(r.at(Rt.lng),r.aA(Rt.lat)).mult(p.worldSize).sub(ce)}else{Z=p.centerPoint.add(j);const it=p.pointLocation(Z),xt=r.bO.convert(i.center||it);this._normalizeCenter(xt),ce=p.project(it),te=p.project(xt).sub(ce)}const _e=p.zoomScale(O-g);let me,Se;i.around&&(me=r.bO.convert(i.around),Se=p.locationPoint(me));const ke=this._zooming||O!==g,Oe=this._rotating||b!==L,je=this._pitching||k!==T,Ve=!p.isPaddingEqual(U),Ue=i.retainPadding===!1?p.clone():p,Ne=it=>xt=>{if(ke&&(it.zoom=r.af(g,O,xt)),Oe&&(it.bearing=r.af(b,L,xt)),je&&(it.pitch=r.af(T,k,xt)),Ve&&(Ue.interpolatePadding(M,U,xt),Z=Ue.centerPoint.add(j)),me)it.setLocationAtPoint(me,Se);else{const _t=it.zoomScale(it.zoom-g),Rt=O>g?Math.min(2,_e):Math.max(.5,_e),Pt=Math.pow(Rt,1-xt),ht=it.unproject(ce.add(te.mult(xt*Pt)).mult(_t));it.setLocationAtPoint(it.renderWorldCopies?ht.wrap():ht,Z)}return i.preloadOnly||this._fireMoveEvents(a),it};if(i.preloadOnly){const it=this._emulate(Ne,i.duration,p);return this._preloadTiles(it),this}const Ye={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ke,this._rotating=Oe,this._pitching=je,this._padding=Ve,this._easeId=i.easeId,this._prepareEase(a,i.noMoveStart,Ye),this._ease(Ne(p),it=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(a,it)},i),this}_prepareEase(i,a,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||p.moving||this.fire(new r.z("movestart",i)),this._zooming&&!p.zooming&&this.fire(new r.z("zoomstart",i)),this._rotating&&!p.rotating&&this.fire(new r.z("rotatestart",i)),this._pitching&&!p.pitching&&this.fire(new r.z("pitchstart",i))}_fireMoveEvents(i){this.fire(new r.z("move",i)),this._zooming&&this.fire(new r.z("zoom",i)),this._rotating&&this.fire(new r.z("rotate",i)),this._pitching&&this.fire(new r.z("pitch",i))}_afterEase(i,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,g=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new r.z("zoomend",i)),g&&this.fire(new r.z("rotateend",i)),b&&this.fire(new r.z("pitchend",i)),this.fire(new r.z("moveend",i))}flyTo(i,a){if(this._prefersReducedMotion(i)){const wt=r.ay(i,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(wt,a)}this.stop(),i=r.l({offset:[0,0],speed:1.2,curve:1.42,easing:r.dA},i);const p=this.transform,g=this.getZoom(),b=this.getBearing(),T=this.getPitch(),M=this.getPadding(),O="zoom"in i?r.aw(+i.zoom,p.minZoom,p.maxZoom):g,L="bearing"in i?this._normalizeBearing(i.bearing,b):b,k="pitch"in i?+i.pitch:T,U=this._extendPadding(i.padding),j=p.zoomScale(O-g),Z=r.P.convert(i.offset);let ce=p.centerPoint.add(Z);const te=p.pointLocation(ce),_e=r.bO.convert(i.center||te);this._normalizeCenter(_e);const me=p.project(te),Se=p.project(_e).sub(me);let ke=i.curve;const Oe=Math.max(p.width,p.height),je=Oe/j,Ve=Se.mag();if("minZoom"in i){const wt=r.aw(Math.min(i.minZoom,g,O),p.minZoom,p.maxZoom),Qt=Oe/p.zoomScale(wt-g);ke=Math.sqrt(Qt/Ve*2)}const Ue=ke*ke;function Ne(wt){const Qt=(je*je-Oe*Oe+(wt?-1:1)*Ue*Ue*Ve*Ve)/(2*(wt?je:Oe)*Ue*Ve);return Math.log(Math.sqrt(Qt*Qt+1)-Qt)}function Ye(wt){return(Math.exp(wt)-Math.exp(-wt))/2}function it(wt){return(Math.exp(wt)+Math.exp(-wt))/2}const xt=Ne(0);let _t=function(wt){return it(xt)/it(xt+ke*wt)},Rt=function(wt){return Oe*((it(xt)*(Ye(Qt=xt+ke*wt)/it(Qt))-Ye(xt))/Ue)/Ve;var Qt},Pt=(Ne(1)-xt)/ke;if(Math.abs(Ve)<1e-6||!isFinite(Pt)){if(Math.abs(Oe-je)<1e-6)return this.easeTo(i,a);const wt=je<Oe?-1:1;Pt=Math.abs(Math.log(je/Oe))/ke,Rt=function(){return 0},_t=function(Qt){return Math.exp(wt*ke*Qt)}}i.duration="duration"in i?+i.duration:1e3*Pt/("screenSpeed"in i?+i.screenSpeed/ke:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const ht=b!==L,bt=k!==T,Vt=!p.isPaddingEqual(U),ut=i.retainPadding===!1?p.clone():p,Ot=wt=>Qt=>{const kt=Qt*Pt,Dt=1/_t(kt);wt.zoom=Qt===1?O:g+wt.scaleZoom(Dt),ht&&(wt.bearing=r.af(b,L,Qt)),bt&&(wt.pitch=r.af(T,k,Qt)),Vt&&(ut.interpolatePadding(M,U,Qt),ce=ut.centerPoint.add(Z));const Gt=Qt===1?_e:wt.unproject(me.add(Se.mult(Rt(kt))).mult(Dt));return wt.setLocationAtPoint(wt.renderWorldCopies?Gt.wrap():Gt,ce),wt._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(a),wt};if(i.preloadOnly){const wt=this._emulate(Ot,i.duration,p);return this._preloadTiles(wt),this}return this._zooming=!0,this._rotating=ht,this._pitching=bt,this._padding=Vt,this._prepareEase(a,!1),this._ease(Ot(p),()=>this._afterEase(a),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(i){}_cancelRenderFrame(i){}_stop(i,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,a)}if(!i){const p=this.handlers;p&&p.stop(!1)}return this}_ease(i,a,p){p.animate===!1||p.duration===0?(i(1),a()):(this._easeStart=r.q.now(),this._easeOptions=p,this._onEaseFrame=i,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((r.q.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,a){i=r.bF(i,-180,180);const p=Math.abs(i-a);return Math.abs(i-360-a)<p&&(i-=360),Math.abs(i+360-a)<p&&(i+=360),i}_normalizeCenter(i){const a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;const p=i.lng-a.center.lng;i.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&r.q.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,a,p){const g=Math.ceil(15*a/1e3),b=[],T=i(p.clone());for(let M=0;M<=g;M++){const O=T(M/g);b.push(O.clone())}return b}_preloadTiles(i,a){}}class lm{constructor(i={}){this.options=i,r.aP(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const a=this.options&&this.options.compact,p=i._getUIString("AttributionControl.ToggleAttribution");this._map=i,this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=G("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const g=G("span","mapboxgl-ctrl-icon",this._compactButton);return g.setAttribute("aria-hidden","true"),g.setAttribute("title",p),this._innerContainer=G("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(i){const p=a.reduce((g,b,T)=>(b.value&&(g+=`${b.key}=${b.value}${T<a.length-1?"&":""}`),g),"?");i.href=`${r.e.FEEDBACK_URL}/${p}#${Rg(this._map,!0)}`,i.rel="noopener nofollow"}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const a=this._map.style._mergedSourceCaches;for(const g in a){const b=a[g];if(b.used){const T=b.getSource();T.attribution&&i.indexOf(T.attribution)<0&&i.push(T.attribution)}}i.sort((g,b)=>g.length-b.length),i=i.filter((g,b)=>{for(let T=b+1;T<i.length;T++)if(i[T].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const p=i.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,i.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ca{constructor(){r.aP(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=G("div","mapboxgl-ctrl");const a=G("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const a in i){const p=i[a].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const a=i[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class ua{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const a=++this._id;return this._queue.push({callback:i,id:a,cancelled:!1}),a}remove(i){const a=this._currentlyRunning,p=a?this._queue.concat(a):this._queue;for(const g of p)if(g.id===i)return void(g.cancelled=!0)}run(i=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const p of a)if(!p.cancelled&&(p.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class zh{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const a=r.cB((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,a,p){this._start=this.getValue(a),this._end=i,this._startTime=a,this._endTime=a+p}}const Ou={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Lu extends r.z{constructor(i,a,p,g){const{point:b,lngLat:T,originalEvent:M,target:O}=i;super(i.type,{point:b,lngLat:T,originalEvent:M,target:O}),this.preventDefault=()=>{i.preventDefault()},this.id=a,this.interaction=p,this.feature=g}}class zg{constructor(i){this.map=i,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(i,a){if(this.typeById.has(i))throw new Error(`Interaction id "${i}" already exists.`);const p=a.filter;let g=a.type;p&&this.filters.set(i,r.aZ(p)),g==="mouseover"&&(g="mouseenter"),g==="mouseout"&&(g="mouseleave");const b=this.interactionsByType.get(g)||new Map;g==="mouseenter"||g==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(i,a)):b.size===0&&this.map.on(g,this.handleType),b.size===0&&this.interactionsByType.set(g,b),b.set(i,a),this.typeById.set(i,g)}get(i){const a=this.typeById.get(i);if(!a)return;const p=this.interactionsByType.get(a);return p?p.get(i):void 0}remove(i){const a=this.typeById.get(i);if(!a)return;this.typeById.delete(i),this.filters.delete(i);const p=this.interactionsByType.get(a);p&&(p.delete(i),a==="mouseenter"||a==="mouseleave"?(this.delegatedInteractions.delete(i),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):p.size===0&&this.map.off(a,this.handleType))}queryTargets(i,a){const p=[];for(const[g,b]of a)b.target&&p.push({targetId:g,target:b.target,filter:this.filters.get(g)});return this.map.style.queryRenderedTargets(i,p,this.map.transform)}handleMove(i){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const a=this.queryTargets(i.point,Array.from(this.delegatedInteractions).reverse());a.length&&(i.type="mouseenter",this.handleType(i,a));const p=new Map;for(const[g,{feature:b}]of this.prevHoveredFeatures)this.hoveredFeatures.has(g)||p.set(b.id,b);p.size&&(i.type="mouseleave",this.handleType(i,Array.from(p.values())))}handleOut(i){const a=Array.from(this.hoveredFeatures.values()).map(({feature:p})=>p);a.length&&(i.type="mouseleave",this.handleType(i,a)),this.hoveredFeatures.clear()}handleType(i,a){const p=Array.from(this.interactionsByType.get(i.type)).reverse(),g=!!a;a=a||this.queryTargets(i.point,p);const b=i.type==="mouseenter";let T=!1;const M=new Set;for(const O of a){for(const[L,k]of p){if(!k.target)continue;const U=O.variants?O.variants[L]:null;if(U){for(const j of U){if(io(j,O,M,L))continue;const Z=new r.cw(O,j),ce=ra(j,O,L);g&&(Z.state=this.map.getFeatureState(Z));const te=b?this.prevHoveredFeatures.get(ce):null,_e=new Lu(i,L,k,Z),me=te?te.stop:k.handler(_e);if(b&&this.hoveredFeatures.set(ce,{feature:O,stop:me}),me!==!1){T=!0;break}}if(T)break}}if(T)break}if(!T)for(const[O,L]of p){const{handler:k,target:U}=L;if(!U&&k(new Lu(i,O,L,null))!==!1)break}}}function Vr(f,i){if(Array.isArray(f)&&Array.isArray(i)){const a=new Set(f),p=new Set(i);return a.size===p.size&&f.every(g=>p.has(g))}return r.bn(f,i)}const Zc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Cw={showCompass:!0,showZoom:!0,visualizePitch:!1};class Mw{constructor(i,a,p=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new Fl({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,p&&(this.mousePitch=new wf({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),r.aP(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(i,a){this.mouseRotate.mousedown(i,a),this.mousePitch&&this.mousePitch.mousedown(i,a),ne()}move(i,a){const p=this.map,g=this.mouseRotate.mousemoveWindow(i,a),b=g&&g.bearingDelta;if(b&&p.setBearing(p.getBearing()+b),this.mousePitch){const T=this.mousePitch.mousemoveWindow(i,a),M=T&&T.pitchDelta;M&&p.setPitch(p.getPitch()+M)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ue(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(r.l({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),re(this.element,i)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,re(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=oe(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=oe(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function cm(f,i,a){if(f=new r.bO(f.lng,f.lat),i){const p=new r.bO(f.lng-360,f.lat),g=new r.bO(f.lng+360,f.lat),b=360*Math.ceil(Math.abs(f.lng-a.center.lng)/360),T=a.locationPoint(f).distSqr(i),M=i.x<0||i.y<0||i.x>a.width||i.y>a.height;a.locationPoint(p).distSqr(i)<T&&(M||Math.abs(p.lng-a.center.lng)<b)?f=p:a.locationPoint(g).distSqr(i)<T&&(M||Math.abs(g.lng-a.center.lng)<b)&&(f=g)}for(;Math.abs(f.lng-a.center.lng)>180;){const p=a.locationPoint(f);if(p.x>=0&&p.y>=0&&p.x<=a.width&&p.y<=a.height)break;f.lng>a.center.lng?f.lng-=360:f.lng+=360}return f}const Bl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class nl extends r.E{constructor(i,a){if(super(),(i instanceof HTMLElement||a)&&(i=r.l({element:i},a)),r.aP(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=r.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=G("div");const b=41,T=27,M=ae("svg",{display:"block",height:b*this._scale+"px",width:T*this._scale+"px",viewBox:`0 0 ${T} ${b}`},this._element),O=ae("radialGradient",{id:"shadowGradient"},ae("defs",{},M));ae("stop",{offset:"10%","stop-opacity":.4},O),ae("stop",{offset:"100%","stop-opacity":.05},O),ae("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},M),ae("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},M),ae("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},M),ae("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},M),this._offset=r.P.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});const p=this._element.classList;for(const b in Bl)p.remove(`mapboxgl-marker-anchor-${b}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`);const g=i&&i.className?i.className.trim().split(/\s+/):[];p.add(...g),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=r.bO.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const g=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const a=i.code,p=i.charCode||i.keyCode;a!=="Space"&&a!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(i){const a=i.originalEvent.target,p=this._element;this._popup&&(a===p||p.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,a=this._pos;if(!i||!a)return!1;const p=i.unproject(a),g=i.getFreeCameraOptions();if(!g.position)return!1;const b=g.position.toLngLat();return b.distanceTo(p)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const a=this._pos;if(!a||a.x<0||a.x>i.transform.width||a.y<0||a.y>i.transform.height)return void this._clearFadeTimer();const p=i.unproject(a);let g;i._showingGlobe()&&r.dH(i.transform,this._lngLat)?g=0:(g=1-i._queryFogOpacity(p),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${Bl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const i=this._pos,a=this._map,p=this.getPitchAlignment();if(!a||!i||p!=="map")return"";if(!a._showingGlobe()){const O=a.getPitch();return O?`rotateX(${O}deg)`:""}const g=r.c4(r.dI(a.transform,this._lngLat)),b=i.sub(r.dJ(a.transform)),T=Math.abs(b.x)+Math.abs(b.y);if(T===0)return"";const M=g/T;return`rotateX(${-b.y*M}deg) rotateY(${b.x*M}deg)`}_calculateZTransform(){const i=this._pos,a=this._map;if(!a||!i)return"";let p=0;const g=this.getRotationAlignment();if(g==="map")if(a._showingGlobe()){const b=a.project(new r.bO(this._lngLat.lng,this._lngLat.lat+.001)),T=a.project(new r.bO(this._lngLat.lng,this._lngLat.lat-.001)).sub(b);p=r.c4(Math.atan2(T.y,T.x))-90}else p=-a.getBearing();else if(g==="horizon"){const b=r.ac(4,6,a.getZoom()),T=r.dJ(a.transform);T.y+=b*a.transform.height;const M=i.sub(T),O=r.c4(Math.atan2(M.y,M.x));p=(O>90?O-270:O+90)*(1-b)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(i){cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=cm(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat),i===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=r.P.convert(i),this._update(),this}addClassName(i){return this._element.classList.add(i),this}removeClassName(i){return this._element.classList.remove(i),this}toggleClassName(i){return this._element.classList.toggle(i)}_onMove(i){const a=this._map;if(!a)return;const p=this._pointerdownPos,g=this._positionDelta;if(p&&g){if(!this._isDragging){const b=this._clickTolerance||a._clickTolerance;if(i.point.dist(p)<b)return;this._isDragging=!0}this._pos=i.point.sub(g),this._lngLat=a.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.z("dragstart"))),this.fire(new r.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.z("dragend")),this._state="inactive"}_addDragHandler(i){const a=this._map,p=this._pos;a&&p&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(p),this._pointerdownPos=i.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const a=this._map;return a&&(i?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ao={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},$o={maxWidth:100,unit:"metric"},Ks={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},P1={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},is=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Fg(f=new r.P(0,0),i="bottom"){if(typeof f=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(i){case"top":return new r.P(0,f);case"top-left":return new r.P(a,a);case"top-right":return new r.P(-a,a);case"bottom":return new r.P(0,-f);case"bottom-left":return new r.P(a,-a);case"bottom-right":return new r.P(-a,-a);case"left":return new r.P(f,0);case"right":return new r.P(-f,0)}return new r.P(0,0)}return f instanceof r.P||Array.isArray(f)?r.P.convert(f):r.P.convert(f[i]||[0,0])}return{version:D,supported:X.supported,setRTLTextPlugin:r.dK,getRTLTextPluginStatus:r.dL,Map:class extends kh{constructor(f){F.mark(B.create);const i=f;if((f=r.l({},Zc,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&r.dF(window)&&(f.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Bc(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new ua,this._domRenderTaskQueue=new ua,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.aV(),this._locale=r.l({},Ou,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new zh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new yt(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Object.assign({},f.contextCreateOptions):{},typeof f.container=="string"){const a=document.getElementById(f.container);if(!a)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=a}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,r.aP(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Sg),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new M1(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||r.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this.indoor=new Xd(this),f.hash&&(this._hash=new g1(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){i.center==null&&i.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const a=f.bounds;a&&(this.resize(),this.fitBounds(a,r.l({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new lm({customAttribution:f.customAttribution})),this._logoControl=new ca,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new r.z(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new r.z(`${a.dataType}dataloading`,a))}),this._interactions=new zg(this)}_getMapId(){return this._mapId}addControl(f,i){if(i===void 0&&(i=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new r.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=f.onAdd(this);this._controls.push(f);const p=this._controlPositions[i];return i.indexOf("bottom")!==-1?p.insertBefore(a,p.firstChild):p.appendChild(a),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new r.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(f);return i>-1&&this._controls.splice(i,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new r.z("movestart",f)).fire(new r.z("move",f)),this.fire(new r.z("resize",f)),i&&this.fire(new r.z("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(r.az.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(i=>i.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(i=>i==="auto"?navigator.language:i):f}setLanguage(f){const i=this._parseLanguage(f);if(!this.style||i===this._language)return this;this._language=i,this.style.reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,i=f.projection.name;let a;i==="globe"&&f.zoom>=r.bY?(f.setMercatorFromTransition(),a=!0):i==="mercator"&&f.zoom<r.bY&&(f.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,i){return this._updateProjection(f||i||{name:"mercator"})}_updateProjection(f){let i;return i=f.name==="globe"&&this.transform.zoom>=r.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f){return this.transform.locationPoint3D(r.bO.convert(f))}unproject(f){return this.transform.pointLocation3D(r.P.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,i,a){const p=g=>{let b=[];if(Array.isArray(i)){const T=i.filter(M=>this.getLayer(M));b=T.length?this.queryRenderedFeatures(g,{layers:T}):[]}else b=this.queryRenderedFeatures(g,{target:i});return b};if(f==="mouseenter"||f==="mouseover"){let g=!1;return{listener:a,targets:i,delegates:{mousemove:T=>{const M=p(T.point);M.length?g||(g=!0,a.call(this,new jo(f,this,T.originalEvent,{features:M}))):g=!1},mouseout:()=>{g=!1}}}}if(f==="mouseleave"||f==="mouseout"){let g=!1;return{listener:a,targets:i,delegates:{mousemove:M=>{p(M.point).length?g=!0:g&&(g=!1,a.call(this,new jo(f,this,M.originalEvent)))},mouseout:M=>{g&&(g=!1,a.call(this,new jo(f,this,M.originalEvent)))}}}}{const g=b=>{const T=p(b.point);T.length&&(b.features=T,a.call(this,b),delete b.features)};return{listener:a,targets:i,delegates:{[f]:g}}}}on(f,i,a){if(typeof i=="function"||a===void 0)return super.on(f,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const p=this._createDelegatedListener(f,i,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(const g in p.delegates)this.on(g,p.delegates[g]);return this}once(f,i,a){if(typeof i=="function"||a===void 0)return super.once(f,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const p=this._createDelegatedListener(f,i,a);for(const g in p.delegates)this.once(g,p.delegates[g]);return this}off(f,i,a){if(typeof i=="function"||a===void 0)return super.off(f,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const p=this._delegatedListeners?this._delegatedListeners[f]:void 0;return p&&(g=>{for(let b=0;b<g.length;b++){const T=g[b];if(T.listener===a&&Vr(T.targets,i)){for(const M in T.delegates)this.off(M,T.delegates[M]);return g.splice(b,1),this}}})(p),this}queryRenderedFeatures(f,i){if(!this.style)return[];if(f===void 0||f instanceof r.P||Array.isArray(f)||i!==void 0||(i=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!i){const b=this.style.queryRenderedFeatures(f,void 0,this.transform),T=this.style.queryRenderedFeatureset(f,void 0,this.transform);return b.concat(T)}let a=!0;if(i.target&&(a=this._isTargetValid(i.target),a&&!i.layers))return this.style.queryRenderedFeatureset(f,i,this.transform);let p=!0;if(i.layers&&Array.isArray(i.layers)){for(const b of i.layers)if(!this._isValidId(b)){p=!1;break}if(p&&!i.target)return this.style.queryRenderedFeatures(f,i,this.transform)}let g=[];return p&&(g=g.concat(this.style.queryRenderedFeatures(f,i,this.transform))),a&&(g=g.concat(this.style.queryRenderedFeatureset(f,i,this.transform))),g}querySourceFeatures(f,i){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,i)}isPointOnSurface(f){const{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&r.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(f))}addInteraction(f,i){return this._interactions.add(f,i),this}removeInteraction(f){return this._interactions.remove(f),this}setStyle(f,i){return i=r.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&f&&i.diff!==!1&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(f,(a,p)=>{a?(r.w(`Unable to perform style diff: ${String(a.message||a.error||a)}. Rebuilding the style from scratch.`),this._updateStyle(f,i)):p&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(f,i))}_getUIString(f){const i=this._locale[f];if(i==null)throw new Error(`Missing UI string '${f}'`);return i}_updateStyle(f,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const a=r.l({},i);i&&i.config&&(a.initialConfig=i.config,delete a.config),this.style=new uo(this,a).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new uo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new r.y(new Error("IDs can't be empty."))),!1):!r.cr(f)||(this.fire(new r.y(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(const i of f)if(!this._isValidId(i))return!1;return!0}return this._isTargetValid(f)}addSource(f,i){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,i),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,i,a){this._lazyInitEmptyStyle(),this.style.addSourceType(f,i,a)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,i,{pixelRatio:a=1,sdf:p=!1,stretchX:g,stretchY:b,content:T}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:M,height:O,data:L}=r.q.getImageData(i);this.style.addImage(f,{data:new r.r({width:M,height:O},L),pixelRatio:a,stretchX:g,stretchY:b,content:T,sdf:p,version:0,usvg:!1})}else if(i.width===void 0||i.height===void 0)this.fire(new r.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:O}=i,L=i;this.style.addImage(f,{data:new r.r({width:M,height:O},new Uint8Array(L.data)),pixelRatio:a,stretchX:g,stretchY:b,content:T,sdf:p,usvg:!1,version:0,userImage:L}),L.onAdd&&L.onAdd(this,f)}}updateImage(f,i){this._lazyInitEmptyStyle();const a=this.style.getImage(f);if(!a)return void this.fire(new r.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?r.q.getImageData(i):i,{width:g,height:b,data:T}=p;if(g===void 0||b===void 0)return void this.fire(new r.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==(a.usvg?a.icon.usvg_tree.width:a.data.width)||b!==(a.usvg?a.icon.usvg_tree.height:a.data.height))return void this.fire(new r.y(new Error(`The width and height of the updated image (${g}, ${b})
                must be that same as the previous version of the image
                (${a.data.width}, ${a.data.height})`)));const M=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);let O=!1;a.usvg?(a.data=new r.r({width:g,height:b},new Uint8Array(T)),a.usvg=!1,a.icon=void 0,O=!0):a.data.replace(T,M),this.style.updateImage(f,a,O)}hasImage(f){return f?!!this.style&&!!this.style.getImage(f):(this.fire(new r.y(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,i){r.o(this._requestManager.transformRequest(f,r.R.Image),(a,p)=>{i(a,p instanceof HTMLImageElement?r.q.getImageData(p):p)})}listImages(){return this.style.listImages()}addModel(f,i){this._lazyInitEmptyStyle(),this.style.addModel(f,i)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new r.y(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,i){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,i),this._update(!0)):this}getSlot(f){const i=this.getLayer(f);return i&&i.slot||null}setSlot(f,i){return this.style.setSlot(f,i),this.style.mergeLayers(),this._update(!0)}addImport(f,i){return this.style.addImport(f,i),this}updateImport(f,i){return typeof i!="string"&&i.id!==f?(this.removeImport(f),this.addImport(i)):(this.style.updateImport(f,i),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,i){return this.style.moveImport(f,i),this._update(!0)}moveLayer(f,i){return this._isValidId(f)?(this.style.moveLayer(f,i),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const i=this.style.getOwnLayer(f);return i?i.type==="custom"?i.implementation:i.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,i,a){return this._isValidId(f)?(this.style.setLayerZoomRange(f,i,a),this._update(!0)):this}setFilter(f,i,a={}){return this._isValidId(f)?(this.style.setFilter(f,i,a),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,i,a,p={}){return this._isValidId(f)?(this.style.setPaintProperty(f,i,a,p),this._update(!0)):this}getPaintProperty(f,i){return this._isValidId(f)?this.style.getPaintProperty(f,i):null}setLayoutProperty(f,i,a,p={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,i,a,p),this._update(!0)):this}getLayoutProperty(f,i){return this._isValidId(f)?this.style.getLayoutProperty(f,i):null}getSchema(f){return this.style.getSchema(f)}setSchema(f,i){return this.style.setSchema(f,i),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,i){return this.style.setConfig(f,i),this._update(!0)}getConfigProperty(f,i){return this.style.getConfigProperty(f,i)}setConfigProperty(f,i,a){return this.style.setConfigProperty(f,i,a),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const i=f[0];i.properties?this.style.setFlatLight(i.properties,i.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,i={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,i){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,i),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.bO.convert(f),this.transform):0}setFeatureState(f,i){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,i),this._update())}removeFeatureState(f,i){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,i),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let a,p,g,b=this._container;for(;b&&(!p||!g);){const T=window.getComputedStyle(b).transform;T&&T!=="none"&&(a=T.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(p=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(g=a[3])),b=b.parentElement}this._containerWidth=p?Math.abs(f/p):f,this._containerHeight=g?Math.abs(i/g):i}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=G("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=G("div","mapboxgl-canvas-container",f);this._canvas=G("canvas","mapboxgl-canvas",i),this._interactive&&(i.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=G("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(g=>{p[g]=G("div",`mapboxgl-ctrl-${g}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,i){const a=r.q.devicePixelRatio||1;this._canvas.width=a*Math.ceil(f),this._canvas.height=a*Math.ceil(i),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${i}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const i=this._markers.indexOf(f);i!==-1&&this._markers.splice(i,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const i=this._popups.indexOf(f);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const f=r.l({},X.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",f);i?(Be(i,!0),this.painter=new Pg(i,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.m.testSupport(i)):this.fire(new r.y(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.z("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new r.z("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let i;this.fire(new r.z("renderstart")),++this._frameId;const a=this.painter.context.extTimerQuery,p=r.q.now(),g=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=g.createQuery(),g.beginQuery(a.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,k=this.transform.pitch,U=r.q.now(),j=new r.a8(L,{now:U,fadeDuration:b,pitch:k,transition:this.style.transition});this.style.update(j)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(p),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(p);const M=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),M&&(this._placementDirty=M.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,F.mark(B.load),this.fire(new r.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const L=r.q.now()-p;g.endQuery(a.TIME_ELAPSED_EXT),setTimeout(()=>{const k=g.getQueryParameter(i,g.QUERY_RESULT)/1e6;g.deleteQuery(i),this.fire(new r.z("gpu-timing-frame",{cpuTime:L,gpuTime:k}))},50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(L);this.fire(new r.z("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){const L=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const k=this.painter.queryGpuTimeDeferredRender(L);this.fire(new r.z("gpu-timing-deferred-render",{gpuTime:k}))},50)}const O=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(O||this._repaint)this.triggerRepaint();else{const L=this.idle();if(L&&(T=this._updateAverageElevation(p,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),L&&(this.fire(new r.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new r.z("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,F.mark(B.fullLoad),this._performanceMetricsCollection&&xi(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const i of this._markers)f&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!f||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(f,i=!1){const a=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(i||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const g=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=f;const T=Math.abs(g-b);if(T>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(b),a(b);this._averageElevation.easeTo(b,f,300)}else if(T>1e-4)return this._averageElevation.jumpTo(b),a(b)}return!!this._averageElevation.isEasing(f)&&a(this._averageElevation.getValue(f))}_authenticate(){H(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===Ge||f.status===401)){const i=this.painter.context.gl;Be(i,!1),this._logoControl instanceof ca&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Hi(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Ii(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const a=this.painter.context.gl,p=a.createFramebuffer();function g(b){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,b,0);const T=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,T),T}return a.bindFramebuffer(a.FRAMEBUFFER,p),this._canvasPixelComparison(g(f),i.canvasCopies.map(g),i.timeStamps)}_canvasPixelComparison(f,i,a){let p=a[1]-a[0];const g=f.length/4;for(let b=0;b<i.length;b++){const T=i[b];let M=0;for(let O=0;O<T.length;O+=4)T[O]===f[O]&&T[O+1]===f[O+1]&&T[O+2]===f[O+2]&&T[O+3]===f[O+3]&&(M+=1);p+=(a[b+2]-a[b+1])*(1-M/g)}return p}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),be.delete(this.painter.context.gl),Yi.remove(),ni.remove(),this._removed=!0,this.fire(new r.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=r.q.frame(i=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(i)}))}_preloadTiles(f){const i=this.style?this.style.getSourceCaches():[];return r.bl(i,(a,p)=>a._preloadTiles(f,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,i){r.dG(f,i)}get version(){return D}},NavigationControl:class{constructor(f={}){this.options=r.l({},Cw,f),this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(r.aP(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),G("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),G("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aP(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:i}):a.resetNorth({},{originalEvent:i}))}),this._compassIcon=G("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const i=f.getZoom(),a=i===f.getMaxZoom(),p=i===f.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Mw(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,i){const a=G("button",f,this._container);return a.type="button",a.addEventListener("click",i),a}_setButtonTitle(f,i){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${i}`);f.setAttribute("aria-label",a),f.firstElementChild&&f.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends r.E{constructor(f={}){super();const i=navigator.geolocation;this.options=r.l({geolocation:i},Ao,f),r.aP(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=nm(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const i=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,f(a)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(a=>i(a.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(f){const i=this._map.getMaxBounds(),a=f.coords;return!!i&&(a.longitude<i.getWest()||a.longitude>i.getEast()||a.latitude<i.getSouth()||a.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new r.z("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("geolocate",f)),this._finish()}}_updateCamera(f){const i=new r.bO(f.coords.longitude,f.coords.latitude),a=f.coords.accuracy,p=this._map.getBearing(),g=r.l({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(a),g,{geolocateSource:!0})}_updateMarker(f){if(f){const i=new r.bO(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,i=r.bH(1,f._center.lat)*f.worldSize,a=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=G("button","mapboxgl-ctrl-geolocate",this._container),G("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=G("div","mapboxgl-user-location"),this._dotElement.appendChild(G("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(G("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new nl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=G("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new nl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.z("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:lm,ScaleControl:class{constructor(f={}){this.options=r.l({},$o,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.aP(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,i=this._map,a=i._containerHeight/2,p=i._containerWidth/2-f/2,g=i.unproject([p,a]),b=i.unproject([p+f,a]),T=g.distanceTo(b);if(this.options.unit==="imperial"){const M=3.2808*T;M>5280?this._setScale(f,M/5280,"mile"):this._setScale(f,M,"foot")}else this.options.unit==="nautical"?this._setScale(f,T/1852,"nautical-mile"):T>=1e3?this._setScale(f,T/1e3,"kilometer"):this._setScale(f,T,"meter")}_setScale(f,i,a){this._map._requestDomTask(()=>{const p=function(b){const T=Math.pow(10,`${Math.floor(b)}`.length-1);let M=b/T;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(O){const L=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*L)/L}(M),T*M}(i),g=p/i;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(p):`${p}&nbsp;${Ks[a]}`,this._container.style.width=f*g+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:r.w("Full screen control 'container' must be a DOM element.")),r.aP(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=G("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=G("button","mapboxgl-ctrl-fullscreen",this._controlContainer);G("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(f){super(),this.options=r.l(Object.create(P1),f),r.aP(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new r.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new r.z("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=r.bO.convert(f),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const i=document.createDocumentFragment(),a=document.createElement("body");let p;for(a.innerHTML=f;p=a.firstChild,p;)i.appendChild(p);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=G("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(f),this.options.closeButton){const a=this._closeButton=G("button","mapboxgl-popup-close-button",i);a.type="button",a.setAttribute("aria-label","Close popup"),a.innerHTML='<span aria-hidden="true">&#215;</span>',a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let i;return this._classList.delete(f)?i=!1:(this._classList.add(f),i=!0),this._updateClassList(),i}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const i=this._map,a=this._container,p=this._pos;if(!i||!a||!p)return"bottom";const g=a.offsetWidth,b=a.offsetHeight,T=p.x<g/2,M=p.x>i.transform.width-g/2;if(p.y+f<b)return T?"top-left":M?"top-right":"top";if(p.y>i.transform.height-b){if(T)return"bottom-left";if(M)return"bottom-right"}return T?"left":M?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),f.className=i.join(" ")}_update(f){const i=this._map,a=this._content;if(!i||!this._lngLat&&!this._trackPointer||!a)return;let p=this._container;if(p||(p=this._container=G("div","mapboxgl-popup",i.getContainer()),this._tip=G("div","mapboxgl-popup-tip",p),p.appendChild(a)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=cm(this._lngLat,this._pos,i.transform)),!this._trackPointer||f){const g=this._pos=this._trackPointer&&f instanceof r.P?f:i.project(this._lngLat),b=Fg(this.options.offset),T=this._anchor=this._getAnchor(b.y),M=Fg(this.options.offset,T),O=g.add(M).round();i._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${Bl[T]} translate(${O.x}px,${O.y}px)`)})}if(!this._marker&&i._showingGlobe()){const g=r.dH(i.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(is);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:nl,Style:uo,LngLat:r.bO,LngLatBounds:r.az,Point:r.P,MercatorCoordinate:r.aa,FreeCameraOptions:Dl,Evented:r.E,config:r.e,prewarm:r.dM,clearPrewarmedResources:r.dN,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(f){r.e.ACCESS_TOKEN=f},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(f){r.e.API_URL=f},get workerCount(){return r.dO.workerCount},set workerCount(f){r.dO.workerCount=f},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){r.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){r.dP(f)},get workerUrl(){return r.dQ.workerUrl},set workerUrl(f){r.dQ.workerUrl=f},get workerClass(){return r.dQ.workerClass},set workerClass(f){r.dQ.workerClass=f},get workerParams(){return r.dQ.workerParams},set workerParams(f){r.dQ.workerParams=f},get dracoUrl(){return r.dR()},set dracoUrl(f){r.dS(f)},get meshoptUrl(){return r.dT()},set meshoptUrl(f){r.dU(f)},setNow:r.q.setNow,restoreNow:r.q.restoreNow}});var v=d;return v})})(qz);var XK=qz.exports;const FT=$z(XK);const KK={name:"MapboxMap",data(){return{cines:[],map:null}},mounted(){FT.accessToken="pk.eyJ1IjoiZWxjZWxlIiwiYSI6ImNtOHJqaGIzNzA2a2kya3B2azlubmZpd2YifQ.SoaN9qTdXQZvsNybR3DQIw",this.map=new FT.Map({container:this.$refs.mapContainer,style:"mapbox://styles/mapbox/navigation-night-v1",center:[2.055501,41.357301],zoom:16}),this.getCines()},methods:{async getCines(){try{const n=await bs.get("cine/");this.cines=n.data,this.addMarkersToMap()}catch(n){console.log(n)}},addMarkersToMap(){this.cines.forEach(n=>{new FT.Marker().setLngLat([n.longitud,n.latitud]).addTo(this.map)})},posicionarCine(n){this.map.flyTo({center:[n.longitud,n.latitud],zoom:16,speed:.8,curve:1,easing(e){return e}})}}},JK={class:"contenedor"},QK={class:"text-primary",id:"cines"},eJ=["onClick"],tJ={ref:"mapContainer",class:"map-container"};function iJ(n,e,o,u,d,y){return zt(),Nt(ur,null,[e[0]||(e[0]=K("div",{class:"titulo-cines"},[K("h1",null,"CINES")],-1)),K("div",JK,[K("div",QK,[(zt(!0),Nt(ur,null,_n(d.cines,v=>(zt(),Nt("div",{class:"card-cines",key:v.id,onClick:r=>y.posicionarCine(v),style:Ps({backgroundImage:`linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(${v.image})`,backgroundSize:"cover",backgroundPosition:"center"})},[K("h2",null,oi(v.nombre),1)],12,eJ))),128))]),K("div",tJ,null,512)])],64)}const rJ=Wn(KK,[["render",iJ],["__scopeId","data-v-41fc03a2"]]);const nJ={data(){return{cines:[],myModal:{},cine:{},messageError:"",isError:!1,insert:!1}},created(){this.selectCine()},methods:{showForm(){this.insert=!0,this.cine={},new ds(document.getElementById("cineModal")).show()},updateCine(){const n=this;axios.put("cine/"+n.cine.id,n.cine).then(e=>{n.selectCine(),n.myModal.hide()}).catch(e=>{this.isError=!0,n.messageError=e.response.data.message})},insertCine(){const n=this;axios.post("cine",n.cine).then(e=>{n.selectCine(),n.myModal.hide()}).catch(e=>{this.isError=!0,n.messageError=e.response.data.message})},selectCine(){const n=this;axios.get("cine/").then(e=>{n.cines=e.data}).catch(e=>{console.log(e)})},editCine(n){this.insert=!1,this.cine=n,this.myModal=new ds("#cineModal"),this.myModal.show()},eliminarCine(n){this.isError=!1,this.cine=n,this.myModal=new ds("#deleteModalCine"),this.myModal.show()},deleteCine(n){const e=this;axios.delete("cine/"+n).then(o=>{e.selectCine(),e.myModal.hide()}).catch(o=>{this.isError=!0,e.messageError=o.response.data.message})}},mounted(){}},sJ={class:"tabla-cines"},oJ={class:"table"},aJ={scope:"row"},lJ=["onClick"],cJ=["onClick"],uJ={class:"modal",tabindex:"-1",id:"deleteModalCine"},hJ={class:"modal-dialog",role:"document"},dJ={class:"modal-content"},fJ={class:"modal-body"},pJ={key:0,class:"alert alert-danger"},mJ={class:"modal-footer"},_J={class:"modal",tabindex:"-1",id:"cineModal"},gJ={class:"modal-dialog",role:"document"},yJ={class:"modal-content"},vJ={class:"modal-header"},xJ={key:0,class:"modal-title"},bJ={key:1,class:"modal-title"},wJ={class:"modal-body"},TJ={"data-mdb-input-init":"",class:"form-outline mb-4"},EJ={"data-mdb-input-init":"",class:"form-outline mb-4"},SJ={class:"mb-3"},AJ={class:"mb-3"},CJ={key:0,class:"alert alert-danger"},MJ={class:"modal-footer"};function IJ(n,e,o,u,d,y){return zt(),Nt(ur,null,[K("div",null,[K("button",{onClick:e[0]||(e[0]=v=>y.showForm()),class:"anadirBoton"},e[8]||(e[8]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-plus-square",viewBox:"0 0 16 16"},[K("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),K("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"})],-1),K("strong",null," AÑADIR CINE",-1)]))]),K("div",sJ,[K("table",oJ,[e[11]||(e[11]=K("thead",null,[K("tr",null,[K("th",{scope:"col"},"ID"),K("th",{scope:"col"},"Nombre"),K("th",{scope:"col"},"Longitud"),K("th",{scope:"col"},"Latitud"),K("th",{scope:"col"},"Imagen")])],-1)),K("tbody",null,[(zt(!0),Nt(ur,null,_n(d.cines,v=>(zt(),Nt("tr",{key:v.id},[K("th",aJ,oi(v.id),1),K("td",null,oi(v.nombre),1),K("td",null,oi(v.longitud),1),K("td",null,oi(v.latitud),1),K("td",null,oi(v.image),1),K("th",null,[K("button",{onClick:r=>y.editCine(v),class:"editarBoton"},e[9]||(e[9]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-pencil-square"},[K("path",{d:"M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"}),K("path",{"fill-rule":"evenodd",d:"M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"})],-1)]),8,lJ)]),K("th",null,[K("button",{onClick:r=>y.eliminarCine(v),style:{border:"none",background:"none",cursor:"pointer",color:"rgb(255, 0, 0)"}},e[10]||(e[10]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[K("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"}),K("path",{d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"})],-1)]),8,cJ)])]))),128))])])]),K("div",uJ,[K("div",hJ,[K("div",dJ,[e[15]||(e[15]=K("div",{class:"modal-header"},[K("h5",{class:"modal-title"},"Borrar Cine nuevo"),K("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"})],-1)),K("div",fJ,[K("p",null,[e[12]||(e[12]=Eo("¿ Seguro que quieres borrar a ")),K("strong",null,oi(d.cine.nombre),1),e[13]||(e[13]=Eo(" ?"))]),d.isError?(zt(),Nt("p",pJ,oi(d.messageError),1)):Jn("",!0)]),K("div",mJ,[K("button",{type:"button",class:"btn btn-primary",onClick:e[1]||(e[1]=v=>y.deleteCine(d.cine.id))},"Borrar"),e[14]||(e[14]=K("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Cancelar",-1))])])])]),K("div",_J,[K("div",gJ,[K("div",yJ,[K("div",vJ,[d.insert?(zt(),Nt("h5",xJ,"Crear Cine nuevo")):(zt(),Nt("h5",bJ,"Modificar Cine"))]),K("div",wJ,[K("form",null,[K("div",TJ,[e[16]||(e[16]=K("label",{for:"cineNombre",class:"form-label"},"Titulo del Cine",-1)),tn(K("input",{type:"text",name:"nombre",class:"form-control",id:"cineNombre",required:"",placeholder:"Introducir Nombre","onUpdate:modelValue":e[2]||(e[2]=v=>d.cine.nombre=v)},null,512),[[hn,d.cine.nombre]])]),K("div",EJ,[e[17]||(e[17]=K("label",{for:"cineLongitud",class:"form-label"},"Longitud",-1)),tn(K("input",{type:"number",name:"longitud",class:"form-control",id:"cineLongitud",required:"","onUpdate:modelValue":e[3]||(e[3]=v=>d.cine.longitud=v)},null,512),[[hn,d.cine.longitud]])]),K("div",SJ,[e[18]||(e[18]=K("label",{for:"cineLatitud",class:"form-label"},"Latitud",-1)),tn(K("input",{type:"number",name:"latitud",class:"form-control",id:"cineLatitud",required:"",placeholder:"Latitud","onUpdate:modelValue":e[4]||(e[4]=v=>d.cine.latitud=v)},null,512),[[hn,d.cine.latitud]])]),K("div",AJ,[e[19]||(e[19]=K("label",{for:"cineImage",class:"form-label"},"URL Imagen",-1)),tn(K("input",{type:"text",name:"image",class:"form-control",id:"cineImage",required:"",placeholder:"Imagen","onUpdate:modelValue":e[5]||(e[5]=v=>d.cine.image=v)},null,512),[[hn,d.cine.image]])])]),d.isError?(zt(),Nt("p",CJ,oi(d.messageError),1)):Jn("",!0)]),K("div",MJ,[d.insert?(zt(),Nt("button",{key:0,type:"button",class:"btn btn-secondary",onClick:e[6]||(e[6]=v=>y.insertCine())},"Crear")):(zt(),Nt("button",{key:1,type:"button",class:"btn btn-secondary",onClick:e[7]||(e[7]=v=>y.updateCine())},"Editar")),e[20]||(e[20]=K("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal"},"Cerrar",-1))])])])])],64)}const PJ=Wn(nJ,[["render",IJ]]),RJ={};function DJ(n,e,o,u,d,y){return null}const OJ=Wn(RJ,[["render",DJ]]);const LJ={data(){return{actores:[],myModal:{},actor:{},messageError:"",isError:!1,insert:!1}},created(){this.selectActor()},methods:{showForm(){this.insert=!0,this.actor={},new ds(document.getElementById("cineActor")).show()},updateActor(){const n=this;let e=new FormData;e.append("nombre",n.actor.nombre),e.append("apellido",n.actor.apellido),n.actor.imagen&&e.append("imagen",n.actor.imagen),axios.put("actor/"+n.actor.id,e,{headers:{"Content-Type":"multipart/form-data"}}).catch(o=>{this.isError=!0,n.messageError=o.response.data.message})},subirImagen(n){const e=this;e.actor.imagen=n.target.files[0]},insertActor(){const n=this;let e=new FormData;e.append("nombre",n.actor.nombre),e.append("apellido",n.actor.apellido),e.append("imagen",n.actor.imagen),axios.post("actor",e,{headers:{"Content-Type":"multipart/form-data"}}).then(o=>{n.selectActor(),n.myModal.hide()}).catch(o=>{this.isError=!0,n.messageError=o.response.data.message})},selectActor(){const n=this;axios.get("actor/").then(e=>{n.actores=e.data}).catch(e=>{console.log(e)})},editActor(n){this.insert=!1,this.actor=n,this.myModal=new ds("#cineActor"),this.myModal.show()},eliminarActor(n){this.isError=!1,this.actor=n,this.myModal=new ds("#deleteModalActor"),this.myModal.show()},deleteActor(n){const e=this;axios.delete("actor/"+n).then(o=>{e.selectActor(),e.myModal.hide()}).catch(o=>{this.isError=!0,e.messageError=o.response.data.message})}},mounted(){}},kJ={class:"tab-actor"},zJ={class:"tabla-actor"},FJ={class:"table"},BJ={scope:"row"},NJ=["onClick"],VJ=["onClick"],UJ={class:"modal",tabindex:"-1",id:"deleteModalActor"},jJ={class:"modal-dialog",role:"document"},$J={class:"modal-content"},qJ={class:"modal-body"},HJ={key:0,class:"alert alert-danger"},GJ={class:"modal-footer"},WJ={class:"modal",tabindex:"-1",id:"cineActor"},ZJ={class:"modal-dialog",role:"document"},YJ={class:"modal-content"},XJ={class:"modal-header"},KJ={key:0,class:"modal-title"},JJ={key:1,class:"modal-title"},QJ={class:"modal-body"},eQ={"data-mdb-input-init":"",class:"form-outline mb-4"},tQ={"data-mdb-input-init":"",class:"form-outline mb-4"},iQ={class:"mb-3"},rQ={key:0,class:"alert alert-danger"},nQ={class:"modal-footer"};function sQ(n,e,o,u,d,y){return zt(),Nt(ur,null,[K("div",kJ,[K("div",null,[K("button",{onClick:e[0]||(e[0]=v=>y.showForm()),class:"anadirBoton"},e[7]||(e[7]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-plus-square",viewBox:"0 0 16 16"},[K("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),K("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"})],-1),K("strong",null," AÑADIR ACTOR",-1)]))]),K("div",zJ,[K("table",FJ,[e[10]||(e[10]=K("thead",null,[K("tr",null,[K("th",{scope:"col"},"ID"),K("th",{scope:"col"},"Nombre"),K("th",{scope:"col"},"Apellido"),K("th",{scope:"col"},"Imagen")])],-1)),K("tbody",null,[(zt(!0),Nt(ur,null,_n(d.actores,v=>(zt(),Nt("tr",{key:v.id},[K("th",BJ,oi(v.id),1),K("td",null,oi(v.nombre),1),K("td",null,oi(v.apellido),1),K("td",null,oi(v.imagen),1),K("th",null,[K("button",{onClick:r=>y.editActor(v),class:"editarBoton"},e[8]||(e[8]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-pencil-square"},[K("path",{d:"M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"}),K("path",{"fill-rule":"evenodd",d:"M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"})],-1)]),8,NJ)]),K("th",null,[K("button",{onClick:r=>y.eliminarActor(v),style:{border:"none",background:"none",cursor:"pointer",color:"rgb(255, 0, 0)"}},e[9]||(e[9]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[K("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"}),K("path",{d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"})],-1)]),8,VJ)])]))),128))])])])]),K("div",UJ,[K("div",jJ,[K("div",$J,[e[14]||(e[14]=K("div",{class:"modal-header"},[K("h5",{class:"modal-title"},"Borrar Actor nuevo"),K("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"})],-1)),K("div",qJ,[K("p",null,[e[11]||(e[11]=Eo("¿ Seguro que quieres borrar a ")),K("strong",null,oi(d.actor.nombre),1),e[12]||(e[12]=Eo(" ?"))]),d.isError?(zt(),Nt("p",HJ,oi(d.messageError),1)):Jn("",!0)]),K("div",GJ,[K("button",{type:"button",class:"btn btn-primary",onClick:e[1]||(e[1]=v=>y.deleteActor(d.actor.id))},"Borrar"),e[13]||(e[13]=K("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Cancelar",-1))])])])]),K("div",WJ,[K("div",ZJ,[K("div",YJ,[K("div",XJ,[d.insert?(zt(),Nt("h5",KJ,"Crear actor nuevo")):(zt(),Nt("h5",JJ,"Modificar Actor"))]),K("div",QJ,[K("form",null,[K("div",eQ,[e[15]||(e[15]=K("label",{for:"actorNombre",class:"form-label"},"Titulo del Cine",-1)),tn(K("input",{type:"text",name:"nombre",class:"form-control",id:"actorNombre",required:"",placeholder:"Introducir Nombre","onUpdate:modelValue":e[2]||(e[2]=v=>d.actor.nombre=v)},null,512),[[hn,d.actor.nombre]])]),K("div",tQ,[e[16]||(e[16]=K("label",{for:"actorApellido",class:"form-label"},"Apellido",-1)),tn(K("input",{type:"text",name:"apellido",class:"form-control",id:"actorApellido",required:"","onUpdate:modelValue":e[3]||(e[3]=v=>d.actor.apellido=v)},null,512),[[hn,d.actor.apellido]])]),K("div",iQ,[e[17]||(e[17]=K("label",{for:"actorImagen",class:"form-label"},"Imagen",-1)),K("input",{type:"file",name:"imagen",class:"form-control",id:"actorImagen",required:"",onChange:e[4]||(e[4]=(...v)=>y.subirImagen&&y.subirImagen(...v))},null,32)])]),d.isError?(zt(),Nt("p",rQ,oi(d.messageError),1)):Jn("",!0)]),K("div",nQ,[d.insert?(zt(),Nt("button",{key:0,type:"button",class:"btn btn-secondary",onClick:e[5]||(e[5]=v=>y.insertActor())},"Crear")):(zt(),Nt("button",{key:1,type:"button",class:"btn btn-secondary",onClick:e[6]||(e[6]=v=>y.updateActor())},"Editar")),e[18]||(e[18]=K("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal"},"Cerrar",-1))])])])])],64)}const oQ=Wn(LJ,[["render",sQ]]);const aQ={data(){return{peliculas:[]}},computed:{ultimasPeliculas(){return this.peliculas.slice(-5)}},created(){bs.get("pelicula").then(n=>{this.peliculas=n.data}).catch(n=>{console.log(n)})}},lQ={class:"peliculas-destacadas"},cQ={class:"pelis-destacadas"},uQ=["href"];function hQ(n,e,o,u,d,y){return zt(),Nt("div",lQ,[e[0]||(e[0]=K("h4",null,"Películas destacadas",-1)),K("div",cQ,[(zt(!0),Nt(ur,null,_n(y.ultimasPeliculas,(v,r)=>(zt(),Nt("a",{class:"url-peli",key:r,href:`/public/pelicula/${v.id}`},[K("div",{class:"destacada1",style:Ps({backgroundImage:`linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url(${v.image})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[K("p",null,oi(v.titulo),1)],4)],8,uQ))),128))])])}const dQ=Wn(aQ,[["render",hQ],["__scopeId","data-v-70db3f6d"]]);const fQ={data(){return{peliculas:[]}},computed:{ultimasPeliculas(){return this.peliculas.slice(-3)}},created(){bs.get("pelicula").then(n=>{this.peliculas=n.data}).catch(n=>{console.log(n)})}},pQ={class:"seguir-viendo"},mQ={key:0},_Q=["href"],gQ=["href"],yQ={class:"pelis-container"},vQ=["href"];function xQ(n,e,o,u,d,y){return zt(),Nt(ur,null,[e[0]||(e[0]=K("h4",null,"Sigue por donde lo dejaste",-1)),K("div",pQ,[d.peliculas.length>0?(zt(),Nt("div",mQ,[K("a",{class:"seguir-viendo-peli",href:`/public/pelicula/${d.peliculas[0].id}`},[K("div",{class:"seguir-viendo-peli1",style:Ps({backgroundImage:`linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url(${d.peliculas[0].image})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[K("p",null,oi(d.peliculas[0].titulo),1)],4)],8,_Q),K("a",{class:"seguir-viendo-links",href:`/public/pelicula/${d.peliculas[1].id}`},[K("div",{class:"seguir-viendo-peli2",style:Ps({backgroundImage:`linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url(${d.peliculas[1].image})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[K("p",null,oi(d.peliculas[1].titulo),1)],4)],8,gQ)])):Jn("",!0),K("div",yQ,[(zt(!0),Nt(ur,null,_n(y.ultimasPeliculas,(v,r)=>(zt(),Nt("a",{key:r,href:`/public/pelicula/${v.id}`,class:"seguir-viendo-link"},[K("div",{class:"seguir-viendo-peli2",style:Ps({backgroundImage:`linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url(${v.image})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[K("p",null,oi(v.titulo),1)],4)],8,vQ))),128))])])],64)}const bQ=Wn(fQ,[["render",xQ],["__scopeId","data-v-4d7c9b9a"]]),wQ={data(){return{peliculas:[]}},created(){bs.get(`/pelicula/${id}`).then(n=>{this.pelicula=n.data}).catch(n=>{console.log(n)})}},TQ={class:"pelicula"},EQ=["src"],SQ={class:"info-peli"},AQ={class:"titulo-pelicula"},CQ={class:"hora"},MQ={class:"edad"},IQ={class:"descripcion-peli"},PQ={class:"detalles"},RQ={class:"texto-detalles"};function DQ(n,e,o,u,d,y){return zt(!0),Nt(ur,null,_n(d.peliculas,v=>(zt(),Nt("div",{class:"reproductor",key:v.id},[K("div",TQ,[e[0]||(e[0]=K("div",{class:"degradado-info"},null,-1)),K("img",{src:v.image,alt:"",style:{width:"120rem",height:"58rem",objectFit:"cover"}},null,8,EQ)]),K("div",SQ,[K("div",AQ,[K("h1",null,oi(v.titulo),1),K("div",CQ,[K("p",null,[e[1]||(e[1]=Eo("Hora seleccionada: ")),K("strong",null,oi(n.hora),1)])])]),e[2]||(e[2]=K("div",{class:"categorias"},[K("p",null,"Comedia, acción, animación")],-1)),K("div",MQ,[K("p",null,"+ "+oi(v.restriccion_edad),1)]),K("div",IQ,[K("p",null,oi(v.descripcion),1)]),e[3]||(e[3]=x_('<div class="botones-pelicula"><div class="ver-ya"><button>VER YA</button><div class="play-button"></div></div><div class="otros-botones"><div class="trailer"><button>Trailer</button></div><div class="heart"></div></div></div>',1))]),K("div",PQ,[e[7]||(e[7]=K("div",{class:"titulo-detalles"},[K("h1",null,"DETALLES")],-1)),K("div",RQ,[K("h2",null,oi(v.titulo),1),K("p",null,oi(v.descripcion),1),e[4]||(e[4]=K("h4",null,"Género",-1)),e[5]||(e[5]=K("p",null,"Comedia, acción, animación",-1)),e[6]||(e[6]=K("h4",null,"Fecha de estreno",-1)),K("p",null,oi(v.fecha_estreno),1),K("h4",null,oi(v.calificacion)+"/10",1),K("p",null,"Edad: + "+oi(v.restriccion_edad),1)])]),e[8]||(e[8]=K("div",{class:"reparto"},[K("div",{class:"titulo-reparto"},[K("h1",null,"REPARTO")]),K("div",{class:"actores"})],-1))]))),128)}const OQ=Wn(wQ,[["render",DQ]]);const LQ={data(){return{categorias:[],myModal:{},categoria:{},messageError:"",isError:!1,insert:!1}},created(){this.selectCategoria()},methods:{showForm(){this.insert=!0,this.categoria={},new ds(document.getElementById("categoriaModal")).show()},updateCategoria(){const n=this;axios.put("categoria/"+n.categoria.id,n.categoria).then(e=>{n.selectCategoria(),n.myModal.hide()}).catch(e=>{this.isError=!0,n.messageError=e.response.data.message})},insertCategoria(){const n=this;axios.post("categoria",n.categoria).then(e=>{console.log(e),n.selectCategoria(),n.myModal.hide()}).catch(e=>{this.isError=!0,n.messageError=e.response.data.message})},selectCategoria(){const n=this;axios.get("categoria/").then(e=>{n.categorias=e.data}).catch(e=>{console.log(e)})},editCategoria(n){this.insert=!1,this.categoria=n,this.myModal=new ds("#categoriaModal"),this.myModal.show()},eliminarCategoria(n){this.isError=!1,this.categoria=n,this.myModal=new ds("#deleteModalCategoria"),this.myModal.show()},deleteCategoria(n){const e=this;axios.delete("categoria/"+n).then(o=>{e.selectCategoria(),e.myModal.hide()}).catch(o=>{this.isError=!0,e.messageError=o.response.data.message})}},mounted(){}},kQ={class:"tabla-categoria"},zQ={class:"table"},FQ={scope:"row"},BQ=["onClick"],NQ=["onClick"],VQ={class:"modal",tabindex:"-1",id:"deleteModalCategoria"},UQ={class:"modal-dialog",role:"document"},jQ={class:"modal-content"},$Q={class:"modal-body"},qQ={key:0,class:"alert alert-danger"},HQ={class:"modal-footer"},GQ={class:"modal",tabindex:"-1",id:"categoriaModal"},WQ={class:"modal-dialog",role:"document"},ZQ={class:"modal-content"},YQ={class:"modal-header"},XQ={key:0,class:"modal-title"},KQ={key:1,class:"modal-title"},JQ={class:"modal-body"},QQ={"data-mdb-input-init":"",class:"form-outline mb-4"},eee={"data-mdb-input-init":"",class:"form-outline mb-4"},tee={key:0,class:"alert alert-danger"},iee={class:"modal-footer"};function ree(n,e,o,u,d,y){return zt(),Nt(ur,null,[K("div",null,[K("button",{onClick:e[0]||(e[0]=v=>y.showForm()),class:"anadirBoton"},e[6]||(e[6]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-plus-square",viewBox:"0 0 16 16"},[K("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),K("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"})],-1),K("strong",null,"AÑADIR CATEGORIA",-1)]))]),K("div",kQ,[K("table",zQ,[e[9]||(e[9]=K("thead",null,[K("tr",null,[K("th",{scope:"col"},"ID"),K("th",{scope:"col"},"Categoria"),K("th",{scope:"col"},"Imagenes"),K("th",{scope:"col"},"Acciones")])],-1)),K("tbody",null,[(zt(!0),Nt(ur,null,_n(d.categorias,v=>(zt(),Nt("tr",{key:v.id},[K("th",FQ,oi(v.id),1),K("td",null,oi(v.categoria),1),K("td",null,oi(v.image),1),K("th",null,[K("button",{onClick:r=>y.editCategoria(v),class:"editarBoton"},e[7]||(e[7]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-pencil-square"},[K("path",{d:"M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"}),K("path",{"fill-rule":"evenodd",d:"M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"})],-1)]),8,BQ)]),K("th",null,[K("button",{onClick:r=>y.eliminarCategoria(v),style:{border:"none",background:"none",cursor:"pointer",color:"rgb(255, 0, 0)"}},e[8]||(e[8]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[K("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"}),K("path",{d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"})],-1)]),8,NQ)])]))),128))])])]),K("div",VQ,[K("div",UQ,[K("div",jQ,[e[13]||(e[13]=K("div",{class:"modal-header"},[K("h5",{class:"modal-title"},"Borrar Categoria nueva"),K("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"})],-1)),K("div",$Q,[K("p",null,[e[10]||(e[10]=Eo("¿ Seguro que quieres borrar a ")),K("strong",null,oi(d.categoria.categoria),1),e[11]||(e[11]=Eo(" ?"))]),d.isError?(zt(),Nt("p",qQ,oi(d.messageError),1)):Jn("",!0)]),K("div",HQ,[K("button",{type:"button",class:"btn btn-primary",onClick:e[1]||(e[1]=v=>y.deleteCategoria(d.categoria.id))},"Borrar"),e[12]||(e[12]=K("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Cancelar",-1))])])])]),K("div",GQ,[K("div",WQ,[K("div",ZQ,[K("div",YQ,[d.insert?(zt(),Nt("h5",XQ,"Crear Categoria nuevo")):(zt(),Nt("h5",KQ,"Modificar Categoria"))]),K("div",JQ,[K("form",null,[K("div",QQ,[e[14]||(e[14]=K("label",{for:"categoriaCat",class:"form-label"},"Categoria",-1)),tn(K("input",{type:"text",name:"categoria",class:"form-control",id:"categoriaCat",required:"",placeholder:"Introducir Categoria","onUpdate:modelValue":e[2]||(e[2]=v=>d.categoria.categoria=v)},null,512),[[hn,d.categoria.categoria]])]),K("div",eee,[e[15]||(e[15]=K("label",{for:"categoriaImg",class:"form-label"},"Imagenes",-1)),tn(K("input",{type:"text",name:"image",class:"form-control",id:"categoriaImg",required:"",placeholder:"Introducir Imagen url","onUpdate:modelValue":e[3]||(e[3]=v=>d.categoria.image=v)},null,512),[[hn,d.categoria.image]])])]),d.isError?(zt(),Nt("p",tee,oi(d.messageError),1)):Jn("",!0)]),K("div",iee,[d.insert?(zt(),Nt("button",{key:0,type:"button",class:"btn btn-secondary",onClick:e[4]||(e[4]=v=>y.insertCategoria())},"Crear")):(zt(),Nt("button",{key:1,type:"button",class:"btn btn-secondary",onClick:e[5]||(e[5]=v=>y.updateCategoria())},"Editar")),e[16]||(e[16]=K("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal"},"Cerrar",-1))])])])])],64)}const nee=Wn(LQ,[["render",ree],["__scopeId","data-v-124ada0c"]]);const see={data(){return{categorias:[]}},created(){bs.get("categoria").then(n=>{this.categorias=n.data}).catch(n=>{console.error(n)})}},oee={class:"text-primary",id:"categorias"},aee=["href"];function lee(n,e,o,u,d,y){return zt(),Nt("div",oee,[(zt(!0),Nt(ur,null,_n(d.categorias,v=>(zt(),Nt("a",{class:"url-peli",key:v.id,href:`/public/categoria/${v.id}`},[K("div",{class:"card-categorias",style:Ps({backgroundImage:`linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url(${v.image})`})},[K("h2",null,oi(v.categoria),1)],4)],8,aee))),128))])}const cee=Wn(see,[["render",lee]]);const uee={data(){return{peliculas:[],indiceActual:0,intervalo:null}},mounted(){this.iniciarCarrusel()},created(){bs.get("pelicula").then(n=>{this.peliculas=n.data}).catch(n=>{console.log(n)})},methods:{cambiarImagen(n){this.peliculas.length!==0&&(this.indiceActual=(this.indiceActual+n+this.peliculas.length)%this.peliculas.length)},iniciarCarrusel(){this.intervalo=setInterval(()=>{this.cambiarImagen(1)},6e3)}}},hee={class:"foto-principal"},dee=["href"],fee={class:"titulo-peli-catalogo"},pee={class:"descripcion-peli-catalogo"};function mee(n,e,o,u,d,y){var v,r,D,B;return zt(),Nt("div",hee,[K("button",{class:"flecha-siguiente-peli-foto",onClick:e[0]||(e[0]=F=>y.cambiarImagen(-1))},e[2]||(e[2]=[K("p",null,"❮",-1)])),K("a",{class:"pelicula-url",href:`/public/pelicula/${(v=d.peliculas[d.indiceActual])==null?void 0:v.id}`},[K("div",{class:"interior-foto",style:Ps({backgroundImage:`url(${(r=d.peliculas[d.indiceActual])==null?void 0:r.image})`,backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center"})},[K("div",fee,[K("h1",null,oi((D=d.peliculas[d.indiceActual])==null?void 0:D.titulo),1)]),K("div",pee,[K("p",null,oi((B=d.peliculas[d.indiceActual])==null?void 0:B.descripcion),1)])],4)],8,dee),K("button",{class:"flecha-anterior-peli-foto",onClick:e[1]||(e[1]=F=>y.cambiarImagen(1))},e[3]||(e[3]=[K("p",null,"❯",-1)]))])}const _ee=Wn(uee,[["render",mee],["__scopeId","data-v-a98dbe5b"]]);const gee={data(){return{peliculas:[],paginaActual:1,porPagina:5}},computed:{ultimasPeliculas(){return this.peliculas.slice(-30)},totalPaginas(){return Math.ceil(this.ultimasPeliculas.length/this.porPagina)},peliculasPaginadas(){const n=(this.paginaActual-1)*this.porPagina;return this.ultimasPeliculas.slice(n,n+this.porPagina)}},methods:{cambiarPagina(n){n>=1&&n<=this.totalPaginas&&(this.paginaActual=n)}},created(){bs.get("pelicula").then(n=>{this.peliculas=n.data}).catch(n=>{console.log(n)})}},yee={class:"peliculas-destacadas"},vee={class:"pelis-destacadas"},xee=["href"],bee={class:"pagination"},wee=["disabled"],Tee=["onClick"],Eee=["disabled"];function See(n,e,o,u,d,y){return zt(),Nt("div",yee,[e[2]||(e[2]=K("h4",null,"Películas destacadas",-1)),K("div",vee,[(zt(!0),Nt(ur,null,_n(y.peliculasPaginadas,(v,r)=>(zt(),Nt("a",{class:"url-peli",key:r,href:`/public/pelicula/${v.id}`},[K("div",{class:"destacada1",style:Ps({backgroundImage:`linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url(${v.image})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[K("p",null,oi(v.titulo),1)],4)],8,xee))),128))]),K("div",bee,[K("button",{onClick:e[0]||(e[0]=v=>y.cambiarPagina(d.paginaActual-1)),disabled:d.paginaActual===1}," < ",8,wee),(zt(!0),Nt(ur,null,_n(y.totalPaginas,v=>(zt(),Nt("button",{key:v,class:rh({activo:v===d.paginaActual}),onClick:r=>y.cambiarPagina(v)},oi(v),11,Tee))),128)),K("button",{onClick:e[1]||(e[1]=v=>y.cambiarPagina(d.paginaActual+1)),disabled:d.paginaActual===y.totalPaginas}," > ",8,Eee)])])}const Aee=Wn(gee,[["render",See],["__scopeId","data-v-9a3b7b14"]]);const Cee={data(){return{usuarios:[],roles:[],rolesChart:null}},mounted(){this.fetchData()},methods:{fetchData(){Promise.all([bs.get("usuario"),bs.get("rol")]).then(([n,e])=>{this.usuarios=n.data,this.roles=e.data,this.renderChart()}).catch(n=>{console.error("Error obteniendo datos:",n)})},renderChart(){const n=document.getElementById("rolesChart");if(!n)return;const e=this.roles.map(d=>d.tipo_rol||`Rol ${d.id}`),o=this.roles.map(d=>this.usuarios.filter(y=>y.rol_id===d.id).length),u=["#36A2EB","#FF6384","#FFCE56","#4BC0C0","#9966FF","#FF9F40","#8B8B8B"];this.rolesChart&&this.rolesChart.destroy(),this.rolesChart=new Chart(n,{type:"doughnut",data:{labels:e,datasets:[{data:o,backgroundColor:u.slice(0,o.length)}]},options:{plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:d=>`${d.label}: ${d.raw} usuario(s)`}}}}})}},beforeUnmount(){this.rolesChart&&this.rolesChart.destroy()}},Mee={class:"chart-container"};function Iee(n,e,o,u,d,y){return zt(),Nt("div",Mee,e[0]||(e[0]=[K("h2",null,"Usuarios por Rol",-1),K("canvas",{id:"rolesChart"},null,-1)]))}const Pee=Wn(Cee,[["render",Iee],["__scopeId","data-v-03472828"]]);const Ree={props:{idCategoria:{type:Number,required:!0}},data(){return{peliculas:[]}},computed:{ultimasPeliculas(){return this.peliculas.slice(-3)}},methods:{cargarPeliculasPorCategoria(){bs.get(`/categorias/${this.idCategoria}/peliculas`).then(n=>{this.peliculas=n.data}).catch(n=>{console.log(n)})}},watch:{idCategoria(n){this.cargarPeliculasPorCategoria()}},mounted(){this.cargarPeliculasPorCategoria()}},Dee={key:0,class:"porque-has-visto-interior"},Oee=["href"],Lee={class:"titulo-peli1"},kee={class:"duracion-peli1"},zee={class:"restriccion-edad"};function Fee(n,e,o,u,d,y){return y.ultimasPeliculas.length>0?(zt(),Nt("div",Dee,[(zt(!0),Nt(ur,null,_n(y.ultimasPeliculas,(v,r)=>(zt(),Nt("div",{key:r},[K("a",{href:`/public/pelicula/${v.id}`,style:{"text-decoration":"none",color:"inherit"}},[r===0?(zt(),Nt("div",{key:0,class:"porque-has-visto-1",style:Ps({backgroundImage:`linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url(${v.image})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[K("div",Lee,[K("h3",null,oi(v.titulo),1)]),K("div",kee,[K("h5",null,oi(v.duracion)+" min",1)]),K("div",zee,[K("p",null,"+"+oi(v.restriccion_edad),1)])],4)):(zt(),Nt("div",{key:1,class:"porque-has-visto-3",style:Ps({backgroundImage:`linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url(${v.image})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[K("h3",null,oi(v.titulo),1)],4))],8,Oee)]))),128))])):Jn("",!0)}const Bee=Wn(Ree,[["render",Fee],["__scopeId","data-v-3b96fcd0"]]);var Gz=(n,e,o)=>{if(!e.has(n))throw TypeError("Cannot "+o)},WR=(n,e,o)=>(Gz(n,e,"read from private field"),o?o.call(n):e.get(n)),Nee=(n,e,o)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,o)},Vee=(n,e,o,u)=>(Gz(n,e,"write to private field"),e.set(n,o),o);const Wz=[["aztec","Aztec"],["code_128","Code128"],["code_39","Code39"],["code_93","Code93"],["codabar","Codabar"],["databar","DataBar"],["databar_expanded","DataBarExpanded"],["data_matrix","DataMatrix"],["dx_film_edge","DXFilmEdge"],["ean_13","EAN-13"],["ean_8","EAN-8"],["itf","ITF"],["maxi_code","MaxiCode"],["micro_qr_code","MicroQRCode"],["pdf417","PDF417"],["qr_code","QRCode"],["rm_qr_code","rMQRCode"],["upc_a","UPC-A"],["upc_e","UPC-E"],["linear_codes","Linear-Codes"],["matrix_codes","Matrix-Codes"]],Uee=[...Wz,["unknown"]].map(n=>n[0]),Tx=new Map(Wz);function jee(n){for(const[e,o]of Tx)if(n===o)return e;return"unknown"}function $ee(n){if(Zz(n))return{width:n.naturalWidth,height:n.naturalHeight};if(Yz(n))return{width:n.width.baseVal.value,height:n.height.baseVal.value};if(Xz(n))return{width:n.videoWidth,height:n.videoHeight};if(Jz(n))return{width:n.width,height:n.height};if(e4(n))return{width:n.displayWidth,height:n.displayHeight};if(Kz(n))return{width:n.width,height:n.height};if(Qz(n))return{width:n.width,height:n.height};throw new TypeError("The provided value is not of type '(Blob or HTMLCanvasElement or HTMLImageElement or HTMLVideoElement or ImageBitmap or ImageData or OffscreenCanvas or SVGImageElement or VideoFrame)'.")}function Zz(n){try{return n instanceof HTMLImageElement}catch{return!1}}function Yz(n){try{return n instanceof SVGImageElement}catch{return!1}}function Xz(n){try{return n instanceof HTMLVideoElement}catch{return!1}}function Kz(n){try{return n instanceof HTMLCanvasElement}catch{return!1}}function Jz(n){try{return n instanceof ImageBitmap}catch{return!1}}function Qz(n){try{return n instanceof OffscreenCanvas}catch{return!1}}function e4(n){try{return n instanceof VideoFrame}catch{return!1}}function t4(n){try{return n instanceof Blob}catch{return!1}}function qee(n){try{return n instanceof ImageData}catch{return!1}}function Hee(n,e){try{const o=new OffscreenCanvas(n,e);if(o.getContext("2d")instanceof OffscreenCanvasRenderingContext2D)return o;throw void 0}catch{const u=document.createElement("canvas");return u.width=n,u.height=e,u}}async function i4(n){if(Zz(n)&&!await Yee(n))throw new DOMException("Failed to load or decode HTMLImageElement.","InvalidStateError");if(Yz(n)&&!await Xee(n))throw new DOMException("Failed to load or decode SVGImageElement.","InvalidStateError");if(e4(n)&&Kee(n))throw new DOMException("VideoFrame is closed.","InvalidStateError");if(Xz(n)&&(n.readyState===0||n.readyState===1))throw new DOMException("Invalid element or state.","InvalidStateError");if(Jz(n)&&Qee(n))throw new DOMException("The image source is detached.","InvalidStateError");const{width:e,height:o}=$ee(n);if(e===0||o===0)return null;const u=Hee(e,o).getContext("2d");u.drawImage(n,0,0);try{return u.getImageData(0,0,e,o)}catch{throw new DOMException("Source would taint origin.","SecurityError")}}async function Gee(n){let e;try{if(globalThis.createImageBitmap)e=await createImageBitmap(n);else if(globalThis.Image){e=new Image;let o="";try{o=URL.createObjectURL(n),e.src=o,await e.decode()}finally{URL.revokeObjectURL(o)}}else return n}catch{throw new DOMException("Failed to load or decode Blob.","InvalidStateError")}return await i4(e)}function Wee(n){const{width:e,height:o}=n;if(e===0||o===0)return null;const u=n.getContext("2d");try{return u.getImageData(0,0,e,o)}catch{throw new DOMException("Source would taint origin.","SecurityError")}}async function Zee(n){if(t4(n))return await Gee(n);if(qee(n)){if(Jee(n))throw new DOMException("The image data has been detached.","InvalidStateError");return n}return Kz(n)||Qz(n)?Wee(n):await i4(n)}async function Yee(n){try{return await n.decode(),!0}catch{return!1}}async function Xee(n){var e;try{return await((e=n.decode)==null?void 0:e.call(n)),!0}catch{return!1}}function Kee(n){return n.format===null}function Jee(n){return n.data.buffer.byteLength===0}function Qee(n){return n.width===0&&n.height===0}function ZR(n,e){return n instanceof DOMException?new DOMException(`${e}: ${n.message}`,n.name):n instanceof Error?new n.constructor(`${e}: ${n.message}`):new Error(`${e}: ${n}`)}const YR=["Aztec","Codabar","Code128","Code39","Code93","DataBar","DataBarExpanded","DataMatrix","DXFilmEdge","EAN-13","EAN-8","ITF","Linear-Codes","Matrix-Codes","MaxiCode","MicroQRCode","None","PDF417","QRCode","rMQRCode","UPC-A","UPC-E"];function ete(n){return n.join("|")}function tte(n){const e=XR(n);let o=0,u=YR.length-1;for(;o<=u;){const d=Math.floor((o+u)/2),y=YR[d],v=XR(y);if(v===e)return y;v<e?o=d+1:u=d-1}return"None"}function XR(n){return n.toLowerCase().replace(/_-\[\]/g,"")}function ite(n,e){return n.Binarizer[e]}function rte(n,e){return n.CharacterSet[e]}const nte=["Text","Binary","Mixed","GS1","ISO15434","UnknownECI"];function ste(n){return nte[n.value]}function ote(n,e){return n.EanAddOnSymbol[e]}function ate(n,e){return n.TextMode[e]}const I_={formats:[],tryHarder:!0,tryRotate:!0,tryInvert:!0,tryDownscale:!0,binarizer:"LocalAverage",isPure:!1,downscaleFactor:3,downscaleThreshold:500,minLineCount:2,maxNumberOfSymbols:255,tryCode39ExtendedMode:!1,validateCode39CheckSum:!1,validateITFCheckSum:!1,returnCodabarStartEnd:!1,returnErrors:!1,eanAddOnSymbol:"Read",textMode:"Plain",characterSet:"Unknown"};function r4(n,e){return{...e,formats:ete(e.formats),binarizer:ite(n,e.binarizer),eanAddOnSymbol:ote(n,e.eanAddOnSymbol),textMode:ate(n,e.textMode),characterSet:rte(n,e.characterSet)}}function n4(n){return{...n,format:tte(n.format),eccLevel:n.eccLevel,contentType:ste(n.contentType)}}const lte={locateFile:(n,e)=>{const o=n.match(/_(.+?)\.wasm$/);return o?`https://fastly.jsdelivr.net/npm/zxing-wasm@1.1.3/dist/${o[1]}/${n}`:e+n}};let KR=new WeakMap;function NA(n,e){var o;const u=KR.get(n);if(u!=null&&u.modulePromise&&e===void 0)return u.modulePromise;const d=(o=u==null?void 0:u.moduleOverrides)!=null?o:lte,y=n({...d});return KR.set(n,{moduleOverrides:d,modulePromise:y}),y}async function cte(n,e,o=I_){const u={...I_,...o},d=await NA(n),{size:y}=e,v=new Uint8Array(await e.arrayBuffer()),r=d._malloc(y);d.HEAPU8.set(v,r);const D=d.readBarcodesFromImage(r,y,r4(d,u));d._free(r);const B=[];for(let F=0;F<D.size();++F)B.push(n4(D.get(F)));return B}async function ute(n,e,o=I_){const u={...I_,...o},d=await NA(n),{data:y,width:v,height:r,data:{byteLength:D}}=e,B=d._malloc(D);d.HEAPU8.set(y,B);const F=d.readBarcodesFromPixmap(B,v,r,r4(d,u));d._free(B);const N=[];for(let Q=0;Q<F.size();++Q)N.push(n4(F.get(Q)));return N}({...I_,formats:[...I_.formats]});var VA=(()=>{var n=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return function(e={}){var o=e,u,d;o.ready=new Promise((he,pe)=>{u=he,d=pe});var y=Object.assign({},o),v="./this.program",r=typeof window=="object",D=typeof importScripts=="function";typeof process=="object"&&typeof process.versions=="object"&&process.versions.node;var B="";function F(he){return o.locateFile?o.locateFile(he,B):B+he}var N;(r||D)&&(D?B=self.location.href:typeof document<"u"&&document.currentScript&&(B=document.currentScript.src),n&&(B=n),B.indexOf("blob:")!==0?B=B.substr(0,B.replace(/[?#].*/,"").lastIndexOf("/")+1):B="",D&&(N=he=>{var pe=new XMLHttpRequest;return pe.open("GET",he,!1),pe.responseType="arraybuffer",pe.send(null),new Uint8Array(pe.response)})),o.print||console.log.bind(console);var Q=o.printErr||console.error.bind(console);Object.assign(o,y),y=null,o.arguments&&o.arguments,o.thisProgram&&(v=o.thisProgram),o.quit&&o.quit;var q;o.wasmBinary&&(q=o.wasmBinary),typeof WebAssembly!="object"&&ui("no native wasm support detected");var X,G=!1,ae,xe,Te,fe,ne,ue,ye,le;function re(){var he=X.buffer;o.HEAP8=ae=new Int8Array(he),o.HEAP16=Te=new Int16Array(he),o.HEAPU8=xe=new Uint8Array(he),o.HEAPU16=fe=new Uint16Array(he),o.HEAP32=ne=new Int32Array(he),o.HEAPU32=ue=new Uint32Array(he),o.HEAPF32=ye=new Float32Array(he),o.HEAPF64=le=new Float64Array(he)}var oe=[],se=[],Ae=[];function De(){if(o.preRun)for(typeof o.preRun=="function"&&(o.preRun=[o.preRun]);o.preRun.length;)ct(o.preRun.shift());be(oe)}function Ge(){be(se)}function yt(){if(o.postRun)for(typeof o.postRun=="function"&&(o.postRun=[o.postRun]);o.postRun.length;)et(o.postRun.shift());be(Ae)}function ct(he){oe.unshift(he)}function mt(he){se.unshift(he)}function et(he){Ae.unshift(he)}var Qe=0,vt=null;function st(he){var pe;Qe++,(pe=o.monitorRunDependencies)===null||pe===void 0||pe.call(o,Qe)}function Zt(he){var pe;if(Qe--,(pe=o.monitorRunDependencies)===null||pe===void 0||pe.call(o,Qe),Qe==0&&vt){var Fe=vt;vt=null,Fe()}}function ui(he){var pe;(pe=o.onAbort)===null||pe===void 0||pe.call(o,he),he="Aborted("+he+")",Q(he),G=!0,he+=". Build with -sASSERTIONS for more info.";var Fe=new WebAssembly.RuntimeError(he);throw d(Fe),Fe}var ni="data:application/octet-stream;base64,",Hi=he=>he.startsWith(ni),Ci;Ci="zxing_reader.wasm",Hi(Ci)||(Ci=F(Ci));function Ii(he){if(he==Ci&&q)return new Uint8Array(q);if(N)return N(he);throw"both async and sync fetching of the wasm failed"}function Ui(he){return!q&&(r||D)&&typeof fetch=="function"?fetch(he,{credentials:"same-origin"}).then(pe=>{if(!pe.ok)throw"failed to load wasm binary file at '"+he+"'";return pe.arrayBuffer()}).catch(()=>Ii(he)):Promise.resolve().then(()=>Ii(he))}function xi(he,pe,Fe){return Ui(he).then(Ke=>WebAssembly.instantiate(Ke,pe)).then(Ke=>Ke).then(Fe,Ke=>{Q(`failed to asynchronously prepare wasm: ${Ke}`),ui(Ke)})}function Yi(he,pe,Fe,Ke){return!he&&typeof WebAssembly.instantiateStreaming=="function"&&!Hi(pe)&&typeof fetch=="function"?fetch(pe,{credentials:"same-origin"}).then(At=>{var Lt=WebAssembly.instantiateStreaming(At,Fe);return Lt.then(Ke,function(jt){return Q(`wasm streaming compile failed: ${jt}`),Q("falling back to ArrayBuffer instantiation"),xi(pe,Fe,Ke)})}):xi(pe,Fe,Ke)}function H(){var he={a:Fc};function pe(Ke,At){return es=Ke.exports,X=es.ia,re(),io=es.ma,mt(es.ja),Zt(),es}st();function Fe(Ke){pe(Ke.instance)}if(o.instantiateWasm)try{return o.instantiateWasm(he,pe)}catch(Ke){Q(`Module.instantiateWasm callback failed with error: ${Ke}`),d(Ke)}return Yi(q,Ci,he,Fe).catch(d),{}}var be=he=>{for(;he.length>0;)he.shift()(o)};o.noExitRuntime;var Be=[],Ee=0,ve=he=>{var pe=new qe(he);return pe.get_caught()||(pe.set_caught(!0),Ee--),pe.set_rethrown(!1),Be.push(pe),gh(pe.excPtr),pe.get_exception_ptr()},Ie=0,Tt=()=>{Xn(0,0);var he=Be.pop();ii(he.excPtr),Ie=0};function qe(he){this.excPtr=he,this.ptr=he-24,this.set_type=function(pe){ue[this.ptr+4>>2]=pe},this.get_type=function(){return ue[this.ptr+4>>2]},this.set_destructor=function(pe){ue[this.ptr+8>>2]=pe},this.get_destructor=function(){return ue[this.ptr+8>>2]},this.set_caught=function(pe){pe=pe?1:0,ae[this.ptr+12>>0]=pe},this.get_caught=function(){return ae[this.ptr+12>>0]!=0},this.set_rethrown=function(pe){pe=pe?1:0,ae[this.ptr+13>>0]=pe},this.get_rethrown=function(){return ae[this.ptr+13>>0]!=0},this.init=function(pe,Fe){this.set_adjusted_ptr(0),this.set_type(pe),this.set_destructor(Fe)},this.set_adjusted_ptr=function(pe){ue[this.ptr+16>>2]=pe},this.get_adjusted_ptr=function(){return ue[this.ptr+16>>2]},this.get_exception_ptr=function(){var pe=Bc(this.get_type());if(pe)return ue[this.excPtr>>2];var Fe=this.get_adjusted_ptr();return Fe!==0?Fe:this.excPtr}}var Et=he=>{throw Ie||(Ie=he),Ie},It=he=>{var pe=Ie;if(!pe)return Dl(0),0;var Fe=new qe(pe);Fe.set_adjusted_ptr(pe);var Ke=Fe.get_type();if(!Ke)return Dl(0),pe;for(var At in he){var Lt=he[At];if(Lt===0||Lt===Ke)break;var jt=Fe.ptr+16;if(Tu(Lt,Ke,jt))return Dl(Lt),pe}return Dl(Ke),pe},$t=()=>It([]),Kt=he=>It([he]),ti=(he,pe)=>It([he,pe]),Li=()=>{var he=Be.pop();he||ui("no exception to throw");var pe=he.excPtr;throw he.get_rethrown()||(Be.push(he),he.set_rethrown(!0),he.set_caught(!1),Ee++),Ie=pe,Ie},Ut=(he,pe,Fe)=>{var Ke=new qe(he);throw Ke.init(pe,Fe),Ie=he,Ee++,Ie},yi=()=>Ee,zi={},Ni=he=>{for(;he.length;){var pe=he.pop(),Fe=he.pop();Fe(pe)}};function Ki(he){return this.fromWireType(ne[he>>2])}var sr={},Rr={},Yr={},kr,yr=he=>{throw new kr(he)},nn=(he,pe,Fe)=>{he.forEach(function(Yt){Yr[Yt]=pe});function Ke(Yt){var di=Fe(Yt);di.length!==he.length&&yr("Mismatched type converter count");for(var Ei=0;Ei<he.length;++Ei)xn(he[Ei],di[Ei])}var At=new Array(pe.length),Lt=[],jt=0;pe.forEach((Yt,di)=>{Rr.hasOwnProperty(Yt)?At[di]=Rr[Yt]:(Lt.push(Yt),sr.hasOwnProperty(Yt)||(sr[Yt]=[]),sr[Yt].push(()=>{At[di]=Rr[Yt],++jt,jt===Lt.length&&Ke(At)}))}),Lt.length===0&&Ke(At)},Ts=he=>{var pe=zi[he];delete zi[he];var Fe=pe.rawConstructor,Ke=pe.rawDestructor,At=pe.fields,Lt=At.map(jt=>jt.getterReturnType).concat(At.map(jt=>jt.setterArgumentType));nn([he],Lt,jt=>{var Yt={};return At.forEach((di,Ei)=>{var ji=di.fieldName,Tr=jt[Ei],Cr=di.getter,Br=di.getterContext,zn=jt[Ei+At.length],Fn=di.setter,fn=di.setterContext;Yt[ji]={read:Qi=>Tr.fromWireType(Cr(Br,Qi)),write:(Qi,Ti)=>{var rr=[];Fn(fn,Qi,zn.toWireType(rr,Ti)),Ni(rr)}}}),[{name:pe.name,fromWireType:di=>{var Ei={};for(var ji in Yt)Ei[ji]=Yt[ji].read(di);return Ke(di),Ei},toWireType:(di,Ei)=>{for(var ji in Yt)if(!(ji in Ei))throw new TypeError(`Missing field: "${ji}"`);var Tr=Fe();for(ji in Yt)Yt[ji].write(Tr,Ei[ji]);return di!==null&&di.push(Ke,Tr),Tr},argPackAdvance:$n,readValueFromPointer:Ki,destructorFunction:Ke}]})},Ar=(he,pe,Fe,Ke,At)=>{},Ur=()=>{for(var he=new Array(256),pe=0;pe<256;++pe)he[pe]=String.fromCharCode(pe);Vi=he},Vi,Zi=he=>{for(var pe="",Fe=he;xe[Fe];)pe+=Vi[xe[Fe++]];return pe},Rn,tr=he=>{throw new Rn(he)};function Yn(he,pe){let Fe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var Ke=pe.name;if(he||tr(`type "${Ke}" must have a positive integer typeid pointer`),Rr.hasOwnProperty(he)){if(Fe.ignoreDuplicateRegistrations)return;tr(`Cannot register type '${Ke}' twice`)}if(Rr[he]=pe,delete Yr[he],sr.hasOwnProperty(he)){var At=sr[he];delete sr[he],At.forEach(Lt=>Lt())}}function xn(he,pe){let Fe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!("argPackAdvance"in pe))throw new TypeError("registerType registeredInstance requires argPackAdvance");return Yn(he,pe,Fe)}var $n=8,Dn=(he,pe,Fe,Ke)=>{pe=Zi(pe),xn(he,{name:pe,fromWireType:function(At){return!!At},toWireType:function(At,Lt){return Lt?Fe:Ke},argPackAdvance:$n,readValueFromPointer:function(At){return this.fromWireType(xe[At])},destructorFunction:null})},Hs=he=>({count:he.count,deleteScheduled:he.deleteScheduled,preservePointerOnDelete:he.preservePointerOnDelete,ptr:he.ptr,ptrType:he.ptrType,smartPtr:he.smartPtr,smartPtrType:he.smartPtrType}),Rs=he=>{function pe(Fe){return Fe.$$.ptrType.registeredClass.name}tr(pe(he)+" instance already deleted")},vr=!1,or=he=>{},lr=he=>{he.smartPtr?he.smartPtrType.rawDestructor(he.smartPtr):he.ptrType.registeredClass.rawDestructor(he.ptr)},Pi=he=>{he.count.value-=1;var pe=he.count.value===0;pe&&lr(he)},br=(he,pe,Fe)=>{if(pe===Fe)return he;if(Fe.baseClass===void 0)return null;var Ke=br(he,pe,Fe.baseClass);return Ke===null?null:Fe.downcast(Ke)},ir={},Ji=()=>Object.keys(Le).length,gn=()=>{var he=[];for(var pe in Le)Le.hasOwnProperty(pe)&&he.push(Le[pe]);return he},ot=[],ee=()=>{for(;ot.length;){var he=ot.pop();he.$$.deleteScheduled=!1,he.delete()}},de,we=he=>{de=he,ot.length&&de&&de(ee)},ze=()=>{o.getInheritedInstanceCount=Ji,o.getLiveInheritedInstances=gn,o.flushPendingDeletes=ee,o.setDelayFunction=we},Le={},Ze=(he,pe)=>{for(pe===void 0&&tr("ptr should not be undefined");he.baseClass;)pe=he.upcast(pe),he=he.baseClass;return pe},rt=(he,pe)=>(pe=Ze(he,pe),Le[pe]),We=(he,pe)=>{(!pe.ptrType||!pe.ptr)&&yr("makeClassHandle requires ptr and ptrType");var Fe=!!pe.smartPtrType,Ke=!!pe.smartPtr;return Fe!==Ke&&yr("Both smartPtrType and smartPtr must be specified"),pe.count={value:1},lt(Object.create(he,{$$:{value:pe,writable:!0}}))};function pt(he){var pe=this.getPointee(he);if(!pe)return this.destructor(he),null;var Fe=rt(this.registeredClass,pe);if(Fe!==void 0){if(Fe.$$.count.value===0)return Fe.$$.ptr=pe,Fe.$$.smartPtr=he,Fe.clone();var Ke=Fe.clone();return this.destructor(he),Ke}function At(){return this.isSmartPointer?We(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:pe,smartPtrType:this,smartPtr:he}):We(this.registeredClass.instancePrototype,{ptrType:this,ptr:he})}var Lt=this.registeredClass.getActualType(pe),jt=ir[Lt];if(!jt)return At.call(this);var Yt;this.isConst?Yt=jt.constPointerType:Yt=jt.pointerType;var di=br(pe,this.registeredClass,Yt.registeredClass);return di===null?At.call(this):this.isSmartPointer?We(Yt.registeredClass.instancePrototype,{ptrType:Yt,ptr:di,smartPtrType:this,smartPtr:he}):We(Yt.registeredClass.instancePrototype,{ptrType:Yt,ptr:di})}var lt=he=>typeof FinalizationRegistry>"u"?(lt=pe=>pe,he):(vr=new FinalizationRegistry(pe=>{Pi(pe.$$)}),lt=pe=>{var Fe=pe.$$,Ke=!!Fe.smartPtr;if(Ke){var At={$$:Fe};vr.register(pe,At,pe)}return pe},or=pe=>vr.unregister(pe),lt(he)),dt=()=>{Object.assign(St.prototype,{isAliasOf(he){if(!(this instanceof St)||!(he instanceof St))return!1;var pe=this.$$.ptrType.registeredClass,Fe=this.$$.ptr;he.$$=he.$$;for(var Ke=he.$$.ptrType.registeredClass,At=he.$$.ptr;pe.baseClass;)Fe=pe.upcast(Fe),pe=pe.baseClass;for(;Ke.baseClass;)At=Ke.upcast(At),Ke=Ke.baseClass;return pe===Ke&&Fe===At},clone(){if(this.$$.ptr||Rs(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var he=lt(Object.create(Object.getPrototypeOf(this),{$$:{value:Hs(this.$$)}}));return he.$$.count.value+=1,he.$$.deleteScheduled=!1,he},delete(){this.$$.ptr||Rs(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&tr("Object already scheduled for deletion"),or(this),Pi(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)},isDeleted(){return!this.$$.ptr},deleteLater(){return this.$$.ptr||Rs(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&tr("Object already scheduled for deletion"),ot.push(this),ot.length===1&&de&&de(ee),this.$$.deleteScheduled=!0,this}})};function St(){}var qt=(he,pe)=>Object.defineProperty(pe,"name",{value:he}),Ht=(he,pe,Fe)=>{if(he[pe].overloadTable===void 0){var Ke=he[pe];he[pe]=function(){return he[pe].overloadTable.hasOwnProperty(arguments.length)||tr(`Function '${Fe}' called with an invalid number of arguments (${arguments.length}) - expects one of (${he[pe].overloadTable})!`),he[pe].overloadTable[arguments.length].apply(this,arguments)},he[pe].overloadTable=[],he[pe].overloadTable[Ke.argCount]=Ke}},li=(he,pe,Fe)=>{o.hasOwnProperty(he)?((Fe===void 0||o[he].overloadTable!==void 0&&o[he].overloadTable[Fe]!==void 0)&&tr(`Cannot register public name '${he}' twice`),Ht(o,he,he),o.hasOwnProperty(Fe)&&tr(`Cannot register multiple overloads of a function with the same number of arguments (${Fe})!`),o[he].overloadTable[Fe]=pe):(o[he]=pe,Fe!==void 0&&(o[he].numArguments=Fe))},pi=48,bi=57,Mi=he=>{if(he===void 0)return"_unknown";he=he.replace(/[^a-zA-Z0-9_]/g,"$");var pe=he.charCodeAt(0);return pe>=pi&&pe<=bi?`_${he}`:he};function dr(he,pe,Fe,Ke,At,Lt,jt,Yt){this.name=he,this.constructor=pe,this.instancePrototype=Fe,this.rawDestructor=Ke,this.baseClass=At,this.getActualType=Lt,this.upcast=jt,this.downcast=Yt,this.pureVirtualFunctions=[]}var fr=(he,pe,Fe)=>{for(;pe!==Fe;)pe.upcast||tr(`Expected null or instance of ${Fe.name}, got an instance of ${pe.name}`),he=pe.upcast(he),pe=pe.baseClass;return he};function Gi(he,pe){if(pe===null)return this.isReference&&tr(`null is not a valid ${this.name}`),0;pe.$$||tr(`Cannot pass "${mi(pe)}" as a ${this.name}`),pe.$$.ptr||tr(`Cannot pass deleted object as a pointer of type ${this.name}`);var Fe=pe.$$.ptrType.registeredClass,Ke=fr(pe.$$.ptr,Fe,this.registeredClass);return Ke}function _r(he,pe){var Fe;if(pe===null)return this.isReference&&tr(`null is not a valid ${this.name}`),this.isSmartPointer?(Fe=this.rawConstructor(),he!==null&&he.push(this.rawDestructor,Fe),Fe):0;(!pe||!pe.$$)&&tr(`Cannot pass "${mi(pe)}" as a ${this.name}`),pe.$$.ptr||tr(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&pe.$$.ptrType.isConst&&tr(`Cannot convert argument of type ${pe.$$.smartPtrType?pe.$$.smartPtrType.name:pe.$$.ptrType.name} to parameter type ${this.name}`);var Ke=pe.$$.ptrType.registeredClass;if(Fe=fr(pe.$$.ptr,Ke,this.registeredClass),this.isSmartPointer)switch(pe.$$.smartPtr===void 0&&tr("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:pe.$$.smartPtrType===this?Fe=pe.$$.smartPtr:tr(`Cannot convert argument of type ${pe.$$.smartPtrType?pe.$$.smartPtrType.name:pe.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:Fe=pe.$$.smartPtr;break;case 2:if(pe.$$.smartPtrType===this)Fe=pe.$$.smartPtr;else{var At=pe.clone();Fe=this.rawShare(Fe,Pa.toHandle(()=>At.delete())),he!==null&&he.push(this.rawDestructor,Fe)}break;default:tr("Unsupporting sharing policy")}return Fe}function wr(he,pe){if(pe===null)return this.isReference&&tr(`null is not a valid ${this.name}`),0;pe.$$||tr(`Cannot pass "${mi(pe)}" as a ${this.name}`),pe.$$.ptr||tr(`Cannot pass deleted object as a pointer of type ${this.name}`),pe.$$.ptrType.isConst&&tr(`Cannot convert argument of type ${pe.$$.ptrType.name} to parameter type ${this.name}`);var Fe=pe.$$.ptrType.registeredClass,Ke=fr(pe.$$.ptr,Fe,this.registeredClass);return Ke}function ki(he){return this.fromWireType(ue[he>>2])}var Vs=()=>{Object.assign(An.prototype,{getPointee(he){return this.rawGetPointee&&(he=this.rawGetPointee(he)),he},destructor(he){var pe;(pe=this.rawDestructor)===null||pe===void 0||pe.call(this,he)},argPackAdvance:$n,readValueFromPointer:ki,deleteObject(he){he!==null&&he.delete()},fromWireType:pt})};function An(he,pe,Fe,Ke,At,Lt,jt,Yt,di,Ei,ji){this.name=he,this.registeredClass=pe,this.isReference=Fe,this.isConst=Ke,this.isSmartPointer=At,this.pointeeType=Lt,this.sharingPolicy=jt,this.rawGetPointee=Yt,this.rawConstructor=di,this.rawShare=Ei,this.rawDestructor=ji,!At&&pe.baseClass===void 0?Ke?(this.toWireType=Gi,this.destructorFunction=null):(this.toWireType=wr,this.destructorFunction=null):this.toWireType=_r}var On=(he,pe,Fe)=>{o.hasOwnProperty(he)||yr("Replacing nonexistant public symbol"),o[he].overloadTable!==void 0&&Fe!==void 0?o[he].overloadTable[Fe]=pe:(o[he]=pe,o[he].argCount=Fe)},_s=(he,pe,Fe)=>{var Ke=o["dynCall_"+he];return Fe&&Fe.length?Ke.apply(null,[pe].concat(Fe)):Ke.call(null,pe)},ra=[],io,Cn=he=>{var pe=ra[he];return pe||(he>=ra.length&&(ra.length=he+1),ra[he]=pe=io.get(he)),pe},Rc=(he,pe,Fe)=>{if(he.includes("j"))return _s(he,pe,Fe);var Ke=Cn(pe).apply(null,Fe);return Ke},Cp=(he,pe)=>{var Fe=[];return function(){return Fe.length=0,Object.assign(Fe,arguments),Rc(he,pe,Fe)}},Ro=(he,pe)=>{he=Zi(he);function Fe(){return he.includes("j")?Cp(he,pe):Cn(pe)}var Ke=Fe();return typeof Ke!="function"&&tr(`unknown function pointer with signature ${he}: ${pe}`),Ke},zd=(he,pe)=>{var Fe=qt(pe,function(Ke){this.name=pe,this.message=Ke;var At=new Error(Ke).stack;At!==void 0&&(this.stack=this.toString()+`
`+At.replace(/^Error(:[^\n]*)?\n/,""))});return Fe.prototype=Object.create(he.prototype),Fe.prototype.constructor=Fe,Fe.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},Fe},Gs,Fo=he=>{var pe=Rl(he),Fe=Zi(pe);return Fi(pe),Fe},Bo=(he,pe)=>{var Fe=[],Ke={};function At(Lt){if(!Ke[Lt]&&!Rr[Lt]){if(Yr[Lt]){Yr[Lt].forEach(At);return}Fe.push(Lt),Ke[Lt]=!0}}throw pe.forEach(At),new Gs(`${he}: `+Fe.map(Fo).join([", "]))},Ma=(he,pe,Fe,Ke,At,Lt,jt,Yt,di,Ei,ji,Tr,Cr)=>{ji=Zi(ji),Lt=Ro(At,Lt),Yt&&(Yt=Ro(jt,Yt)),Ei&&(Ei=Ro(di,Ei)),Cr=Ro(Tr,Cr);var Br=Mi(ji);li(Br,function(){Bo(`Cannot construct ${ji} due to unbound types`,[Ke])}),nn([he,pe,Fe],Ke?[Ke]:[],function(zn){zn=zn[0];var Fn,fn;Ke?(Fn=zn.registeredClass,fn=Fn.instancePrototype):fn=St.prototype;var Qi=qt(ji,function(){if(Object.getPrototypeOf(this)!==Ti)throw new Rn("Use 'new' to construct "+ji);if(rr.constructor_body===void 0)throw new Rn(ji+" has no accessible constructor");var vh=rr.constructor_body[arguments.length];if(vh===void 0)throw new Rn(`Tried to invoke ctor of ${ji} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(rr.constructor_body).toString()}) parameters instead!`);return vh.apply(this,arguments)}),Ti=Object.create(fn,{constructor:{value:Qi}});Qi.prototype=Ti;var rr=new dr(ji,Qi,Ti,Cr,Fn,Lt,Yt,Ei);if(rr.baseClass){var ns,Ss;(Ss=(ns=rr.baseClass).__derivedClasses)!==null&&Ss!==void 0||(ns.__derivedClasses=[]),rr.baseClass.__derivedClasses.push(rr)}var Nc=new An(ji,rr,!0,!1,!1),sn=new An(ji+"*",rr,!1,!1,!1),yh=new An(ji+" const*",rr,!1,!0,!1);return ir[he]={pointerType:sn,constPointerType:yh},On(Br,Qi),[Nc,sn,yh]})},Do=(he,pe)=>{for(var Fe=[],Ke=0;Ke<he;Ke++)Fe.push(ue[pe+Ke*4>>2]);return Fe};function Ia(he){for(var pe=1;pe<he.length;++pe)if(he[pe]!==null&&he[pe].destructorFunction===void 0)return!0;return!1}function Dc(he,pe,Fe,Ke,At,Lt){var jt=pe.length;jt<2&&tr("argTypes array size mismatch! Must at least get return value and 'this' types!");var Yt=pe[1]!==null&&Fe!==null,di=Ia(pe),Ei=pe[0].name!=="void",ji=jt-2,Tr=new Array(ji),Cr=[],Br=[],zn=function(){arguments.length!==ji&&tr(`function ${he} called with ${arguments.length} arguments, expected ${ji}`),Br.length=0;var Fn;Cr.length=Yt?2:1,Cr[0]=At,Yt&&(Fn=pe[1].toWireType(Br,this),Cr[1]=Fn);for(var fn=0;fn<ji;++fn)Tr[fn]=pe[fn+2].toWireType(Br,arguments[fn]),Cr.push(Tr[fn]);var Qi=Ke.apply(null,Cr);function Ti(rr){if(di)Ni(Br);else for(var ns=Yt?1:2;ns<pe.length;ns++){var Ss=ns===1?Fn:Tr[ns-2];pe[ns].destructorFunction!==null&&pe[ns].destructorFunction(Ss)}if(Ei)return pe[0].fromWireType(rr)}return Ti(Qi)};return qt(he,zn)}var Fd=(he,pe,Fe,Ke,At,Lt)=>{var jt=Do(pe,Fe);At=Ro(Ke,At),nn([],[he],function(Yt){Yt=Yt[0];var di=`constructor ${Yt.name}`;if(Yt.registeredClass.constructor_body===void 0&&(Yt.registeredClass.constructor_body=[]),Yt.registeredClass.constructor_body[pe-1]!==void 0)throw new Rn(`Cannot register multiple constructors with identical number of parameters (${pe-1}) for class '${Yt.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return Yt.registeredClass.constructor_body[pe-1]=()=>{Bo(`Cannot construct ${Yt.name} due to unbound types`,jt)},nn([],jt,Ei=>(Ei.splice(1,0,null),Yt.registeredClass.constructor_body[pe-1]=Dc(di,Ei,null,At,Lt),[])),[]})},Xa=he=>{he=he.trim();const pe=he.indexOf("(");return pe!==-1?he.substr(0,pe):he},Ml=(he,pe,Fe,Ke,At,Lt,jt,Yt,di)=>{var Ei=Do(Fe,Ke);pe=Zi(pe),pe=Xa(pe),Lt=Ro(At,Lt),nn([],[he],function(ji){ji=ji[0];var Tr=`${ji.name}.${pe}`;pe.startsWith("@@")&&(pe=Symbol[pe.substring(2)]),Yt&&ji.registeredClass.pureVirtualFunctions.push(pe);function Cr(){Bo(`Cannot call ${Tr} due to unbound types`,Ei)}var Br=ji.registeredClass.instancePrototype,zn=Br[pe];return zn===void 0||zn.overloadTable===void 0&&zn.className!==ji.name&&zn.argCount===Fe-2?(Cr.argCount=Fe-2,Cr.className=ji.name,Br[pe]=Cr):(Ht(Br,pe,Tr),Br[pe].overloadTable[Fe-2]=Cr),nn([],Ei,function(Fn){var fn=Dc(Tr,Fn,ji,Lt,jt);return Br[pe].overloadTable===void 0?(fn.argCount=Fe-2,Br[pe]=fn):Br[pe].overloadTable[Fe-2]=fn,[]}),[]})};function Mp(){Object.assign(lh.prototype,{get(he){return this.allocated[he]},has(he){return this.allocated[he]!==void 0},allocate(he){var pe=this.freelist.pop()||this.allocated.length;return this.allocated[pe]=he,pe},free(he){this.allocated[he]=void 0,this.freelist.push(he)}})}function lh(){this.allocated=[void 0],this.freelist=[]}var rs=new lh,zr=he=>{he>=rs.reserved&&--rs.get(he).refcount===0&&rs.free(he)},Bd=()=>{for(var he=0,pe=rs.reserved;pe<rs.allocated.length;++pe)rs.allocated[pe]!==void 0&&++he;return he},Bi=()=>{rs.allocated.push({value:void 0},{value:null},{value:!0},{value:!1}),rs.reserved=rs.allocated.length,o.count_emval_handles=Bd},Pa={toValue:he=>(he||tr("Cannot use deleted val. handle = "+he),rs.get(he).value),toHandle:he=>{switch(he){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return rs.allocate({refcount:1,value:he})}}},ch=(he,pe)=>{pe=Zi(pe),xn(he,{name:pe,fromWireType:Fe=>{var Ke=Pa.toValue(Fe);return zr(Fe),Ke},toWireType:(Fe,Ke)=>Pa.toHandle(Ke),argPackAdvance:$n,readValueFromPointer:Ki,destructorFunction:null})},uh=(he,pe,Fe)=>{switch(pe){case 1:return Fe?function(Ke){return this.fromWireType(ae[Ke>>0])}:function(Ke){return this.fromWireType(xe[Ke>>0])};case 2:return Fe?function(Ke){return this.fromWireType(Te[Ke>>1])}:function(Ke){return this.fromWireType(fe[Ke>>1])};case 4:return Fe?function(Ke){return this.fromWireType(ne[Ke>>2])}:function(Ke){return this.fromWireType(ue[Ke>>2])};default:throw new TypeError(`invalid integer width (${pe}): ${he}`)}},xr=(he,pe,Fe,Ke)=>{pe=Zi(pe);function At(){}At.values={},xn(he,{name:pe,constructor:At,fromWireType:function(Lt){return this.constructor.values[Lt]},toWireType:(Lt,jt)=>jt.value,argPackAdvance:$n,readValueFromPointer:uh(pe,Fe,Ke),destructorFunction:null}),li(pe,At)},Oc=(he,pe)=>{var Fe=Rr[he];return Fe===void 0&&tr(pe+" has unknown type "+Fo(he)),Fe},oc=(he,pe,Fe)=>{var Ke=Oc(he,"enum");pe=Zi(pe);var At=Ke.constructor,Lt=Object.create(Ke.constructor.prototype,{value:{value:Fe},constructor:{value:qt(`${Ke.name}_${pe}`,function(){})}});At.values[Fe]=Lt,At[pe]=Lt},mi=he=>{if(he===null)return"null";var pe=typeof he;return pe==="object"||pe==="array"||pe==="function"?he.toString():""+he},$r=(he,pe)=>{switch(pe){case 4:return function(Fe){return this.fromWireType(ye[Fe>>2])};case 8:return function(Fe){return this.fromWireType(le[Fe>>3])};default:throw new TypeError(`invalid float width (${pe}): ${he}`)}},Dr=(he,pe,Fe)=>{pe=Zi(pe),xn(he,{name:pe,fromWireType:Ke=>Ke,toWireType:(Ke,At)=>At,argPackAdvance:$n,readValueFromPointer:$r(pe,Fe),destructorFunction:null})},Ws=(he,pe,Fe,Ke,At,Lt,jt)=>{var Yt=Do(pe,Fe);he=Zi(he),he=Xa(he),At=Ro(Ke,At),li(he,function(){Bo(`Cannot call ${he} due to unbound types`,Yt)},pe-1),nn([],Yt,function(di){var Ei=[di[0],null].concat(di.slice(1));return On(he,Dc(he,Ei,null,At,Lt),pe-1),[]})},Ka=(he,pe,Fe)=>{switch(pe){case 1:return Fe?Ke=>ae[Ke>>0]:Ke=>xe[Ke>>0];case 2:return Fe?Ke=>Te[Ke>>1]:Ke=>fe[Ke>>1];case 4:return Fe?Ke=>ne[Ke>>2]:Ke=>ue[Ke>>2];default:throw new TypeError(`invalid integer width (${pe}): ${he}`)}},Fr=(he,pe,Fe,Ke,At)=>{pe=Zi(pe);var Lt=ji=>ji;if(Ke===0){var jt=32-8*Fe;Lt=ji=>ji<<jt>>>jt}var Yt=pe.includes("unsigned"),di=(ji,Tr)=>{},Ei;Yt?Ei=function(ji,Tr){return di(Tr,this.name),Tr>>>0}:Ei=function(ji,Tr){return di(Tr,this.name),Tr},xn(he,{name:pe,fromWireType:Lt,toWireType:Ei,argPackAdvance:$n,readValueFromPointer:Ka(pe,Fe,Ke!==0),destructorFunction:null})},mu=(he,pe,Fe)=>{var Ke=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],At=Ke[pe];function Lt(jt){var Yt=ue[jt>>2],di=ue[jt+4>>2];return new At(ae.buffer,di,Yt)}Fe=Zi(Fe),xn(he,{name:Fe,fromWireType:Lt,argPackAdvance:$n,readValueFromPointer:Lt},{ignoreDuplicateRegistrations:!0})},na=(he,pe,Fe,Ke)=>{if(!(Ke>0))return 0;for(var At=Fe,Lt=Fe+Ke-1,jt=0;jt<he.length;++jt){var Yt=he.charCodeAt(jt);if(Yt>=55296&&Yt<=57343){var di=he.charCodeAt(++jt);Yt=65536+((Yt&1023)<<10)|di&1023}if(Yt<=127){if(Fe>=Lt)break;pe[Fe++]=Yt}else if(Yt<=2047){if(Fe+1>=Lt)break;pe[Fe++]=192|Yt>>6,pe[Fe++]=128|Yt&63}else if(Yt<=65535){if(Fe+2>=Lt)break;pe[Fe++]=224|Yt>>12,pe[Fe++]=128|Yt>>6&63,pe[Fe++]=128|Yt&63}else{if(Fe+3>=Lt)break;pe[Fe++]=240|Yt>>18,pe[Fe++]=128|Yt>>12&63,pe[Fe++]=128|Yt>>6&63,pe[Fe++]=128|Yt&63}}return pe[Fe]=0,Fe-At},_u=(he,pe,Fe)=>na(he,xe,pe,Fe),Es=he=>{for(var pe=0,Fe=0;Fe<he.length;++Fe){var Ke=he.charCodeAt(Fe);Ke<=127?pe++:Ke<=2047?pe+=2:Ke>=55296&&Ke<=57343?(pe+=4,++Fe):pe+=3}return pe},Ln=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,Nd=(he,pe,Fe)=>{for(var Ke=pe+Fe,At=pe;he[At]&&!(At>=Ke);)++At;if(At-pe>16&&he.buffer&&Ln)return Ln.decode(he.subarray(pe,At));for(var Lt="";pe<At;){var jt=he[pe++];if(!(jt&128)){Lt+=String.fromCharCode(jt);continue}var Yt=he[pe++]&63;if((jt&224)==192){Lt+=String.fromCharCode((jt&31)<<6|Yt);continue}var di=he[pe++]&63;if((jt&240)==224?jt=(jt&15)<<12|Yt<<6|di:jt=(jt&7)<<18|Yt<<12|di<<6|he[pe++]&63,jt<65536)Lt+=String.fromCharCode(jt);else{var Ei=jt-65536;Lt+=String.fromCharCode(55296|Ei>>10,56320|Ei&1023)}}return Lt},Zs=(he,pe)=>he?Nd(xe,he,pe):"",hh=(he,pe)=>{pe=Zi(pe);var Fe=pe==="std::string";xn(he,{name:pe,fromWireType(Ke){var At=ue[Ke>>2],Lt=Ke+4,jt;if(Fe)for(var Yt=Lt,di=0;di<=At;++di){var Ei=Lt+di;if(di==At||xe[Ei]==0){var ji=Ei-Yt,Tr=Zs(Yt,ji);jt===void 0?jt=Tr:(jt+="\0",jt+=Tr),Yt=Ei+1}}else{for(var Cr=new Array(At),di=0;di<At;++di)Cr[di]=String.fromCharCode(xe[Lt+di]);jt=Cr.join("")}return Fi(Ke),jt},toWireType(Ke,At){At instanceof ArrayBuffer&&(At=new Uint8Array(At));var Lt,jt=typeof At=="string";jt||At instanceof Uint8Array||At instanceof Uint8ClampedArray||At instanceof Int8Array||tr("Cannot pass non-string to std::string"),Fe&&jt?Lt=Es(At):Lt=At.length;var Yt=Pl(4+Lt+1),di=Yt+4;if(ue[Yt>>2]=Lt,Fe&&jt)_u(At,di,Lt+1);else if(jt)for(var Ei=0;Ei<Lt;++Ei){var ji=At.charCodeAt(Ei);ji>255&&(Fi(di),tr("String has UTF-16 code units that do not fit in 8 bits")),xe[di+Ei]=ji}else for(var Ei=0;Ei<Lt;++Ei)xe[di+Ei]=At[Ei];return Ke!==null&&Ke.push(Fi,Yt),Yt},argPackAdvance:$n,readValueFromPointer:ki,destructorFunction(Ke){Fi(Ke)}})},Lc=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,dh=(he,pe)=>{for(var Fe=he,Ke=Fe>>1,At=Ke+pe/2;!(Ke>=At)&&fe[Ke];)++Ke;if(Fe=Ke<<1,Fe-he>32&&Lc)return Lc.decode(xe.subarray(he,Fe));for(var Lt="",jt=0;!(jt>=pe/2);++jt){var Yt=Te[he+jt*2>>1];if(Yt==0)break;Lt+=String.fromCharCode(Yt)}return Lt},gu=(he,pe,Fe)=>{var Ke;if((Ke=Fe)!==null&&Ke!==void 0||(Fe=2147483647),Fe<2)return 0;Fe-=2;for(var At=pe,Lt=Fe<he.length*2?Fe/2:he.length,jt=0;jt<Lt;++jt){var Yt=he.charCodeAt(jt);Te[pe>>1]=Yt,pe+=2}return Te[pe>>1]=0,pe-At},Ys=he=>he.length*2,Ra=(he,pe)=>{for(var Fe=0,Ke="";!(Fe>=pe/4);){var At=ne[he+Fe*4>>2];if(At==0)break;if(++Fe,At>=65536){var Lt=At-65536;Ke+=String.fromCharCode(55296|Lt>>10,56320|Lt&1023)}else Ke+=String.fromCharCode(At)}return Ke},Us=(he,pe,Fe)=>{var Ke;if((Ke=Fe)!==null&&Ke!==void 0||(Fe=2147483647),Fe<4)return 0;for(var At=pe,Lt=At+Fe-4,jt=0;jt<he.length;++jt){var Yt=he.charCodeAt(jt);if(Yt>=55296&&Yt<=57343){var di=he.charCodeAt(++jt);Yt=65536+((Yt&1023)<<10)|di&1023}if(ne[pe>>2]=Yt,pe+=4,pe+4>Lt)break}return ne[pe>>2]=0,pe-At},Vd=he=>{for(var pe=0,Fe=0;Fe<he.length;++Fe){var Ke=he.charCodeAt(Fe);Ke>=55296&&Ke<=57343&&++Fe,pe+=4}return pe},Ja=(he,pe,Fe)=>{Fe=Zi(Fe);var Ke,At,Lt,jt,Yt;pe===2?(Ke=dh,At=gu,jt=Ys,Lt=()=>fe,Yt=1):pe===4&&(Ke=Ra,At=Us,jt=Vd,Lt=()=>ue,Yt=2),xn(he,{name:Fe,fromWireType:di=>{for(var Ei=ue[di>>2],ji=Lt(),Tr,Cr=di+4,Br=0;Br<=Ei;++Br){var zn=di+4+Br*pe;if(Br==Ei||ji[zn>>Yt]==0){var Fn=zn-Cr,fn=Ke(Cr,Fn);Tr===void 0?Tr=fn:(Tr+="\0",Tr+=fn),Cr=zn+pe}}return Fi(di),Tr},toWireType:(di,Ei)=>{typeof Ei!="string"&&tr(`Cannot pass non-string to C++ string type ${Fe}`);var ji=jt(Ei),Tr=Pl(4+ji+pe);return ue[Tr>>2]=ji>>Yt,At(Ei,Tr+4,ji+pe),di!==null&&di.push(Fi,Tr),Tr},argPackAdvance:$n,readValueFromPointer:Ki,destructorFunction(di){Fi(di)}})},kn=(he,pe,Fe,Ke,At,Lt)=>{zi[he]={name:Zi(pe),rawConstructor:Ro(Fe,Ke),rawDestructor:Ro(At,Lt),fields:[]}},No=(he,pe,Fe,Ke,At,Lt,jt,Yt,di,Ei)=>{zi[he].fields.push({fieldName:Zi(pe),getterReturnType:Fe,getter:Ro(Ke,At),getterContext:Lt,setterArgumentType:jt,setter:Ro(Yt,di),setterContext:Ei})},Ds=(he,pe)=>{pe=Zi(pe),xn(he,{isVoid:!0,name:pe,argPackAdvance:0,fromWireType:()=>{},toWireType:(Fe,Ke)=>{}})},qn=[],yu=(he,pe,Fe,Ke)=>(he=qn[he],pe=Pa.toValue(pe),he(null,pe,Fe,Ke)),sa={},ac=he=>{var pe=sa[he];return pe===void 0?Zi(he):pe},kc=()=>{if(typeof globalThis=="object")return globalThis;function he(pe){pe.$$$embind_global$$$=pe;var Fe=typeof $$$embind_global$$$=="object"&&pe.$$$embind_global$$$==pe;return Fe||delete pe.$$$embind_global$$$,Fe}if(typeof $$$embind_global$$$=="object"||(typeof global=="object"&&he(global)?$$$embind_global$$$=global:typeof self=="object"&&he(self)&&($$$embind_global$$$=self),typeof $$$embind_global$$$=="object"))return $$$embind_global$$$;throw Error("unable to get global object.")},oa=he=>he===0?Pa.toHandle(kc()):(he=ac(he),Pa.toHandle(kc()[he])),Ud=he=>{var pe=qn.length;return qn.push(he),pe},Qa=(he,pe)=>{for(var Fe=new Array(he),Ke=0;Ke<he;++Ke)Fe[Ke]=Oc(ue[pe+Ke*4>>2],"parameter "+Ke);return Fe},B_=Reflect.construct,jd=(he,pe,Fe)=>{var Ke=[],At=he.toWireType(Ke,Fe);return Ke.length&&(ue[pe>>2]=Pa.toHandle(Ke)),At},co=(he,pe,Fe)=>{var Ke=Qa(he,pe),At=Ke.shift();he--;var Lt=new Array(he),jt=(di,Ei,ji,Tr)=>{for(var Cr=0,Br=0;Br<he;++Br)Lt[Br]=Ke[Br].readValueFromPointer(Tr+Cr),Cr+=Ke[Br].argPackAdvance;for(var zn=Fe===1?B_(Ei,Lt):Ei.apply(di,Lt),Br=0;Br<he;++Br){var Fn,fn;(Fn=(fn=Ke[Br]).deleteObject)===null||Fn===void 0||Fn.call(fn,Lt[Br])}return jd(At,ji,zn)},Yt=`methodCaller<(${Ke.map(di=>di.name).join(", ")}) => ${At.name}>`;return Ud(qt(Yt,jt))},$d=he=>{he>4&&(rs.get(he).refcount+=1)},fh=he=>{var pe=Pa.toValue(he);Ni(pe),zr(he)},vu=(he,pe)=>{he=Oc(he,"_emval_take_value");var Fe=he.readValueFromPointer(pe);return Pa.toHandle(Fe)},xu=()=>{ui("")},N_=(he,pe,Fe)=>xe.copyWithin(he,pe,pe+Fe),V_=()=>2147483648,bu=he=>{var pe=X.buffer,Fe=(he-pe.byteLength+65535)/65536;try{return X.grow(Fe),re(),1}catch{}},wu=he=>{var pe=xe.length;he>>>=0;var Fe=V_();if(he>Fe)return!1;for(var Ke=(di,Ei)=>di+(Ei-di%Ei)%Ei,At=1;At<=4;At*=2){var Lt=pe*(1+.2/At);Lt=Math.min(Lt,he+100663296);var jt=Math.min(Fe,Ke(Math.max(he,Lt),65536)),Yt=bu(jt);if(Yt)return!0}return!1},qd={},zc=()=>v||"./this.program",lc=()=>{if(!lc.strings){var he=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",pe={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:he,_:zc()};for(var Fe in qd)qd[Fe]===void 0?delete pe[Fe]:pe[Fe]=qd[Fe];var Ke=[];for(var Fe in pe)Ke.push(`${Fe}=${pe[Fe]}`);lc.strings=Ke}return lc.strings},el=(he,pe)=>{for(var Fe=0;Fe<he.length;++Fe)ae[pe++>>0]=he.charCodeAt(Fe);ae[pe>>0]=0},Il=(he,pe)=>{var Fe=0;return lc().forEach((Ke,At)=>{var Lt=pe+Fe;ue[he+At*4>>2]=Lt,el(Ke,Lt),Fe+=Ke.length+1}),0},U_=(he,pe)=>{var Fe=lc();ue[he>>2]=Fe.length;var Ke=0;return Fe.forEach(At=>Ke+=At.length+1),ue[pe>>2]=Ke,0},Hd=he=>he,ph=he=>he%4===0&&(he%100!==0||he%400===0),Ip=(he,pe)=>{for(var Fe=0,Ke=0;Ke<=pe;Fe+=he[Ke++]);return Fe},Pp=[31,29,31,30,31,30,31,31,30,31,30,31],mh=[31,28,31,30,31,30,31,31,30,31,30,31],cc=(he,pe)=>{for(var Fe=new Date(he.getTime());pe>0;){var Ke=ph(Fe.getFullYear()),At=Fe.getMonth(),Lt=(Ke?Pp:mh)[At];if(pe>Lt-Fe.getDate())pe-=Lt-Fe.getDate()+1,Fe.setDate(1),At<11?Fe.setMonth(At+1):(Fe.setMonth(0),Fe.setFullYear(Fe.getFullYear()+1));else return Fe.setDate(Fe.getDate()+pe),Fe}return Fe};function gr(he,pe,Fe){var Ke=Es(he)+1,At=new Array(Ke);return na(he,At,0,At.length),At}var Ri=(he,pe)=>{ae.set(he,pe)},_h=(he,pe,Fe,Ke)=>{var At=ue[Ke+40>>2],Lt={tm_sec:ne[Ke>>2],tm_min:ne[Ke+4>>2],tm_hour:ne[Ke+8>>2],tm_mday:ne[Ke+12>>2],tm_mon:ne[Ke+16>>2],tm_year:ne[Ke+20>>2],tm_wday:ne[Ke+24>>2],tm_yday:ne[Ke+28>>2],tm_isdst:ne[Ke+32>>2],tm_gmtoff:ne[Ke+36>>2],tm_zone:At?Zs(At):""},jt=Zs(Fe),Yt={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var di in Yt)jt=jt.replace(new RegExp(di,"g"),Yt[di]);var Ei=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],ji=["January","February","March","April","May","June","July","August","September","October","November","December"];function Tr(Ti,rr,ns){for(var Ss=typeof Ti=="number"?Ti.toString():Ti||"";Ss.length<rr;)Ss=ns[0]+Ss;return Ss}function Cr(Ti,rr){return Tr(Ti,rr,"0")}function Br(Ti,rr){function ns(Nc){return Nc<0?-1:Nc>0?1:0}var Ss;return(Ss=ns(Ti.getFullYear()-rr.getFullYear()))===0&&(Ss=ns(Ti.getMonth()-rr.getMonth()))===0&&(Ss=ns(Ti.getDate()-rr.getDate())),Ss}function zn(Ti){switch(Ti.getDay()){case 0:return new Date(Ti.getFullYear()-1,11,29);case 1:return Ti;case 2:return new Date(Ti.getFullYear(),0,3);case 3:return new Date(Ti.getFullYear(),0,2);case 4:return new Date(Ti.getFullYear(),0,1);case 5:return new Date(Ti.getFullYear()-1,11,31);case 6:return new Date(Ti.getFullYear()-1,11,30)}}function Fn(Ti){var rr=cc(new Date(Ti.tm_year+1900,0,1),Ti.tm_yday),ns=new Date(rr.getFullYear(),0,4),Ss=new Date(rr.getFullYear()+1,0,4),Nc=zn(ns),sn=zn(Ss);return Br(Nc,rr)<=0?Br(sn,rr)<=0?rr.getFullYear()+1:rr.getFullYear():rr.getFullYear()-1}var fn={"%a":Ti=>Ei[Ti.tm_wday].substring(0,3),"%A":Ti=>Ei[Ti.tm_wday],"%b":Ti=>ji[Ti.tm_mon].substring(0,3),"%B":Ti=>ji[Ti.tm_mon],"%C":Ti=>{var rr=Ti.tm_year+1900;return Cr(rr/100|0,2)},"%d":Ti=>Cr(Ti.tm_mday,2),"%e":Ti=>Tr(Ti.tm_mday,2," "),"%g":Ti=>Fn(Ti).toString().substring(2),"%G":Ti=>Fn(Ti),"%H":Ti=>Cr(Ti.tm_hour,2),"%I":Ti=>{var rr=Ti.tm_hour;return rr==0?rr=12:rr>12&&(rr-=12),Cr(rr,2)},"%j":Ti=>Cr(Ti.tm_mday+Ip(ph(Ti.tm_year+1900)?Pp:mh,Ti.tm_mon-1),3),"%m":Ti=>Cr(Ti.tm_mon+1,2),"%M":Ti=>Cr(Ti.tm_min,2),"%n":()=>`
`,"%p":Ti=>Ti.tm_hour>=0&&Ti.tm_hour<12?"AM":"PM","%S":Ti=>Cr(Ti.tm_sec,2),"%t":()=>"	","%u":Ti=>Ti.tm_wday||7,"%U":Ti=>{var rr=Ti.tm_yday+7-Ti.tm_wday;return Cr(Math.floor(rr/7),2)},"%V":Ti=>{var rr=Math.floor((Ti.tm_yday+7-(Ti.tm_wday+6)%7)/7);if((Ti.tm_wday+371-Ti.tm_yday-2)%7<=2&&rr++,rr){if(rr==53){var ns=(Ti.tm_wday+371-Ti.tm_yday)%7;ns!=4&&(ns!=3||!ph(Ti.tm_year))&&(rr=1)}}else{rr=52;var Ss=(Ti.tm_wday+7-Ti.tm_yday-1)%7;(Ss==4||Ss==5&&ph(Ti.tm_year%400-1))&&rr++}return Cr(rr,2)},"%w":Ti=>Ti.tm_wday,"%W":Ti=>{var rr=Ti.tm_yday+7-(Ti.tm_wday+6)%7;return Cr(Math.floor(rr/7),2)},"%y":Ti=>(Ti.tm_year+1900).toString().substring(2),"%Y":Ti=>Ti.tm_year+1900,"%z":Ti=>{var rr=Ti.tm_gmtoff,ns=rr>=0;return rr=Math.abs(rr)/60,rr=rr/60*100+rr%60,(ns?"+":"-")+("0000"+rr).slice(-4)},"%Z":Ti=>Ti.tm_zone,"%%":()=>"%"};jt=jt.replace(/%%/g,"\0\0");for(var di in fn)jt.includes(di)&&(jt=jt.replace(new RegExp(di,"g"),fn[di](Lt)));jt=jt.replace(/\0\0/g,"%");var Qi=gr(jt);return Qi.length>pe?0:(Ri(Qi,he),Qi.length-1)},$i=(he,pe,Fe,Ke,At)=>_h(he,pe,Fe,Ke);kr=o.InternalError=class extends Error{constructor(he){super(he),this.name="InternalError"}},Ur(),Rn=o.BindingError=class extends Error{constructor(he){super(he),this.name="BindingError"}},dt(),ze(),Vs(),Gs=o.UnboundTypeError=zd(Error,"UnboundTypeError"),Mp(),Bi();var Fc={s:ve,u:Tt,b:$t,g:Kt,q:ti,J:Li,f:Ut,V:yi,d:Et,da:Ts,Q:Ar,_:Dn,ca:Ma,ba:Fd,w:Ml,Y:ch,x:xr,h:oc,L:Dr,M:Ws,t:Fr,o:mu,K:hh,C:Ja,A:kn,ea:No,$:Ds,R:yu,ha:zr,fa:oa,Z:co,N:$d,O:fh,aa:vu,B:xu,X:N_,W:wu,T:Il,U:U_,E:fc,D:hc,F:Dp,n:H_,a:Os,e:Wd,m:uc,k:Zd,H:Xd,v:Rp,G:q_,z:Kd,P:Lp,l:j_,j:dc,c:Gd,p:il,I:Yd,r:Op,i:$_,y:Eu,ga:Hd,S:$i},es=H(),Fi=o._free=he=>(Fi=o._free=es.ka)(he),Pl=o._malloc=he=>(Pl=o._malloc=es.la)(he),Rl=he=>(Rl=es.na)(he),Xn=(he,pe)=>(Xn=es.oa)(he,pe),Dl=he=>(Dl=es.pa)(he),rn=()=>(rn=es.qa)(),Wr=he=>(Wr=es.ra)(he),ii=he=>(ii=es.sa)(he),gh=he=>(gh=es.ta)(he),Tu=(he,pe,Fe)=>(Tu=es.ua)(he,pe,Fe),Bc=he=>(Bc=es.va)(he);o.dynCall_viijii=(he,pe,Fe,Ke,At,Lt,jt)=>(o.dynCall_viijii=es.wa)(he,pe,Fe,Ke,At,Lt,jt);var tl=o.dynCall_jiiii=(he,pe,Fe,Ke,At)=>(tl=o.dynCall_jiiii=es.xa)(he,pe,Fe,Ke,At);o.dynCall_iiiiij=(he,pe,Fe,Ke,At,Lt,jt)=>(o.dynCall_iiiiij=es.ya)(he,pe,Fe,Ke,At,Lt,jt),o.dynCall_iiiiijj=(he,pe,Fe,Ke,At,Lt,jt,Yt,di)=>(o.dynCall_iiiiijj=es.za)(he,pe,Fe,Ke,At,Lt,jt,Yt,di),o.dynCall_iiiiiijj=(he,pe,Fe,Ke,At,Lt,jt,Yt,di,Ei)=>(o.dynCall_iiiiiijj=es.Aa)(he,pe,Fe,Ke,At,Lt,jt,Yt,di,Ei);function Os(he,pe){var Fe=rn();try{return Cn(he)(pe)}catch(Ke){if(Wr(Fe),Ke!==Ke+0)throw Ke;Xn(1,0)}}function il(he,pe,Fe,Ke){var At=rn();try{Cn(he)(pe,Fe,Ke)}catch(Lt){if(Wr(At),Lt!==Lt+0)throw Lt;Xn(1,0)}}function Gd(he,pe,Fe){var Ke=rn();try{Cn(he)(pe,Fe)}catch(At){if(Wr(Ke),At!==At+0)throw At;Xn(1,0)}}function uc(he,pe,Fe,Ke){var At=rn();try{return Cn(he)(pe,Fe,Ke)}catch(Lt){if(Wr(At),Lt!==Lt+0)throw Lt;Xn(1,0)}}function hc(he,pe,Fe,Ke,At){var Lt=rn();try{return Cn(he)(pe,Fe,Ke,At)}catch(jt){if(Wr(Lt),jt!==jt+0)throw jt;Xn(1,0)}}function dc(he,pe){var Fe=rn();try{Cn(he)(pe)}catch(Ke){if(Wr(Fe),Ke!==Ke+0)throw Ke;Xn(1,0)}}function Wd(he,pe,Fe){var Ke=rn();try{return Cn(he)(pe,Fe)}catch(At){if(Wr(Ke),At!==At+0)throw At;Xn(1,0)}}function j_(he){var pe=rn();try{Cn(he)()}catch(Fe){if(Wr(pe),Fe!==Fe+0)throw Fe;Xn(1,0)}}function Zd(he,pe,Fe,Ke,At){var Lt=rn();try{return Cn(he)(pe,Fe,Ke,At)}catch(jt){if(Wr(Lt),jt!==jt+0)throw jt;Xn(1,0)}}function $_(he,pe,Fe,Ke,At,Lt,jt,Yt,di,Ei,ji){var Tr=rn();try{Cn(he)(pe,Fe,Ke,At,Lt,jt,Yt,di,Ei,ji)}catch(Cr){if(Wr(Tr),Cr!==Cr+0)throw Cr;Xn(1,0)}}function Rp(he,pe,Fe,Ke,At,Lt,jt){var Yt=rn();try{return Cn(he)(pe,Fe,Ke,At,Lt,jt)}catch(di){if(Wr(Yt),di!==di+0)throw di;Xn(1,0)}}function Yd(he,pe,Fe,Ke,At){var Lt=rn();try{Cn(he)(pe,Fe,Ke,At)}catch(jt){if(Wr(Lt),jt!==jt+0)throw jt;Xn(1,0)}}function Xd(he,pe,Fe,Ke,At,Lt){var jt=rn();try{return Cn(he)(pe,Fe,Ke,At,Lt)}catch(Yt){if(Wr(jt),Yt!==Yt+0)throw Yt;Xn(1,0)}}function q_(he,pe,Fe,Ke,At,Lt,jt,Yt){var di=rn();try{return Cn(he)(pe,Fe,Ke,At,Lt,jt,Yt)}catch(Ei){if(Wr(di),Ei!==Ei+0)throw Ei;Xn(1,0)}}function Dp(he,pe,Fe,Ke){var At=rn();try{return Cn(he)(pe,Fe,Ke)}catch(Lt){if(Wr(At),Lt!==Lt+0)throw Lt;Xn(1,0)}}function fc(he,pe,Fe,Ke){var At=rn();try{return Cn(he)(pe,Fe,Ke)}catch(Lt){if(Wr(At),Lt!==Lt+0)throw Lt;Xn(1,0)}}function H_(he){var pe=rn();try{return Cn(he)()}catch(Fe){if(Wr(pe),Fe!==Fe+0)throw Fe;Xn(1,0)}}function Op(he,pe,Fe,Ke,At,Lt,jt,Yt){var di=rn();try{Cn(he)(pe,Fe,Ke,At,Lt,jt,Yt)}catch(Ei){if(Wr(di),Ei!==Ei+0)throw Ei;Xn(1,0)}}function Kd(he,pe,Fe,Ke,At,Lt,jt,Yt,di,Ei,ji,Tr){var Cr=rn();try{return Cn(he)(pe,Fe,Ke,At,Lt,jt,Yt,di,Ei,ji,Tr)}catch(Br){if(Wr(Cr),Br!==Br+0)throw Br;Xn(1,0)}}function Eu(he,pe,Fe,Ke,At,Lt,jt,Yt,di,Ei,ji,Tr,Cr,Br,zn,Fn){var fn=rn();try{Cn(he)(pe,Fe,Ke,At,Lt,jt,Yt,di,Ei,ji,Tr,Cr,Br,zn,Fn)}catch(Qi){if(Wr(fn),Qi!==Qi+0)throw Qi;Xn(1,0)}}function Lp(he,pe,Fe,Ke,At){var Lt=rn();try{return tl(he,pe,Fe,Ke,At)}catch(jt){if(Wr(Lt),jt!==jt+0)throw jt;Xn(1,0)}}var uo;vt=function he(){uo||Su(),uo||(vt=he)};function Su(){if(Qe>0||(De(),Qe>0))return;function he(){uo||(uo=!0,o.calledRun=!0,!G&&(Ge(),u(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),yt()))}o.setStatus?(o.setStatus("Running..."),setTimeout(function(){setTimeout(function(){o.setStatus("")},1),he()},1)):he()}if(o.preInit)for(typeof o.preInit=="function"&&(o.preInit=[o.preInit]);o.preInit.length>0;)o.preInit.pop()();return Su(),e.ready}})();function hte(n){return NA(VA,n)}async function dte(n,e){return cte(VA,n,e)}async function fte(n,e){return ute(VA,n,e)}var Ny;class BT extends EventTarget{constructor(e={}){var o;super(),Nee(this,Ny,void 0);try{const u=(o=e==null?void 0:e.formats)==null?void 0:o.filter(d=>d!=="unknown");if((u==null?void 0:u.length)===0)throw new TypeError("Hint option provided, but is empty.");u==null||u.forEach(d=>{if(!Tx.has(d))throw new TypeError(`Failed to read the 'formats' property from 'BarcodeDetectorOptions': The provided value '${d}' is not a valid enum value of type BarcodeFormat.`)}),Vee(this,Ny,u??[]),hte().then(d=>{this.dispatchEvent(new CustomEvent("load",{detail:d}))}).catch(d=>{this.dispatchEvent(new CustomEvent("error",{detail:d}))})}catch(u){throw ZR(u,"Failed to construct 'BarcodeDetector'")}}static async getSupportedFormats(){return Uee.filter(e=>e!=="unknown")}async detect(e){try{const o=await Zee(e);if(o===null)return[];let u;try{t4(o)?u=await dte(o,{tryHarder:!0,formats:WR(this,Ny).map(d=>Tx.get(d))}):u=await fte(o,{tryHarder:!0,formats:WR(this,Ny).map(d=>Tx.get(d))})}catch(d){throw console.error(d),new DOMException("Barcode detection service unavailable.","NotSupportedError")}return u.map(d=>{const{topLeft:{x:y,y:v},topRight:{x:r,y:D},bottomLeft:{x:B,y:F},bottomRight:{x:N,y:Q}}=d.position,q=Math.min(y,r,B,N),X=Math.min(v,D,F,Q),G=Math.max(y,r,B,N),ae=Math.max(v,D,F,Q);return{boundingBox:new DOMRectReadOnly(q,X,G-q,ae-X),rawValue:d.text,format:jee(d.format),cornerPoints:[{x:y,y:v},{x:r,y:D},{x:N,y:Q},{x:B,y:F}]}})}catch(o){throw ZR(o,"Failed to execute 'detect' on 'BarcodeDetector'")}}}Ny=new WeakMap;const s4=(n,e,o="error")=>{let u,d;const y=new Promise((v,r)=>{u=v,d=r,n.addEventListener(e,u),n.addEventListener(o,d)});return y.finally(()=>{n.removeEventListener(e,u),n.removeEventListener(o,d)}),y},JR=n=>new Promise(e=>setTimeout(e,n));class o4 extends Error{constructor(){super("this browser has no Stream API support"),this.name="StreamApiNotSupportedError"}}class pte extends Error{constructor(){super("camera access is only permitted in secure context. Use HTTPS or localhost rather than HTTP."),this.name="InsecureContextError"}}class mte extends Error{constructor(){super("Loading camera stream timed out after 6 seconds. If you are on iOS in PWA mode, this is a known issue (see https://github.com/gruhn/vue-qrcode-reader/issues/298)"),this.name="StreamLoadTimeoutError"}}const _te=n=>{let e=!1,o;return(...u)=>(e||(o=n(u),e=!0),o)};function Jc(n,e){if(n===!1)throw new Error(e??"assertion failure")}function QR(n){throw new Error("this code should be unreachable")}function gte(){return navigator.platform.toUpperCase().includes("MAC")}let a4;async function yte(n){if(window.BarcodeDetector===void 0)return console.debug("[vue-qrcode-reader] Native BarcodeDetector not supported. Will use polyfill."),new BT({formats:n});const e=await window.BarcodeDetector.getSupportedFormats(),o=n.filter(u=>!e.includes(u));return o.length>0?(console.debug(`[vue-qrcode-reader] Native BarcodeDetector does not support formats ${JSON.stringify(o)}. Will use polyfill.`),new BT({formats:n})):gte()&&n.includes("pdf417")?(console.debug("[vue-qrcode-reader] Native BarcodeDetector is buggy for PDF417 codes on MacOS. Will use polyfill."),new BT({formats:n})):(console.debug("[vue-qrcode-reader] Will use native BarcodeDetector."),new window.BarcodeDetector({formats:n}))}async function l4(n){a4=await yte(n)}const vte=async(n,{detectHandler:e,locateHandler:o,minDelay:u,formats:d})=>{console.debug("[vue-qrcode-reader] start scanning"),await l4(d);const y=v=>async r=>{if(n.readyState===0)console.debug("[vue-qrcode-reader] stop scanning: video element readyState is 0");else{const{lastScanned:D,contentBefore:B,lastScanHadContent:F}=v;if(r-D<u)window.requestAnimationFrame(y(v));else{const N=await a4.detect(n),Q=N.some(G=>!B.includes(G.rawValue));Q&&e(N);const q=N.length>0;q&&o(N),!q&&F&&o(N);const X={lastScanned:r,lastScanHadContent:q,contentBefore:Q?N.map(G=>G.rawValue):B};window.requestAnimationFrame(y(X))}}};y({lastScanned:performance.now(),contentBefore:[],lastScanHadContent:!1})(performance.now())};var c4={},Ya={};Object.defineProperty(Ya,"__esModule",{value:!0});Ya.compactObject=d4;Ya.deprecated=Mte;var xte=Ya.detectBrowser=Ite;Ya.disableLog=Ste;Ya.disableWarnings=Ate;Ya.extractVersion=Ex;Ya.filterStats=Pte;Ya.log=Cte;Ya.walkStats=fb;Ya.wrapPeerConnectionEvent=Ete;function bte(n,e,o){return e=wte(e),e in n?Object.defineProperty(n,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[e]=o,n}function wte(n){var e=Tte(n,"string");return Md(e)==="symbol"?e:String(e)}function Tte(n,e){if(Md(n)!=="object"||n===null)return n;var o=n[Symbol.toPrimitive];if(o!==void 0){var u=o.call(n,e);if(Md(u)!=="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Md(n){"@babel/helpers - typeof";return Md=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Md(n)}var u4=!0,h4=!0;function Ex(n,e,o){var u=n.match(e);return u&&u.length>=o&&parseInt(u[o],10)}function Ete(n,e,o){if(n.RTCPeerConnection){var u=n.RTCPeerConnection.prototype,d=u.addEventListener;u.addEventListener=function(v,r){if(v!==e)return d.apply(this,arguments);var D=function(B){var F=o(B);F&&(r.handleEvent?r.handleEvent(F):r(F))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(r,D),d.apply(this,[v,D])};var y=u.removeEventListener;u.removeEventListener=function(v,r){if(v!==e||!this._eventMap||!this._eventMap[e])return y.apply(this,arguments);if(!this._eventMap[e].has(r))return y.apply(this,arguments);var D=this._eventMap[e].get(r);return this._eventMap[e].delete(r),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,y.apply(this,[v,D])},Object.defineProperty(u,"on"+e,{get:function(){return this["_on"+e]},set:function(v){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),v&&this.addEventListener(e,this["_on"+e]=v)},enumerable:!0,configurable:!0})}}function Ste(n){return typeof n!="boolean"?new Error("Argument type: "+Md(n)+". Please use a boolean."):(u4=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function Ate(n){return typeof n!="boolean"?new Error("Argument type: "+Md(n)+". Please use a boolean."):(h4=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function Cte(){if((typeof window>"u"?"undefined":Md(window))==="object"){if(u4)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Mte(n,e){h4&&console.warn(n+" is deprecated, please use "+e+" instead.")}function Ite(n){var e={browser:null,version:null};if(typeof n>"u"||!n.navigator||!n.navigator.userAgent)return e.browser="Not a browser.",e;var o=n.navigator;if(o.mozGetUserMedia)e.browser="firefox",e.version=Ex(o.userAgent,/Firefox\/(\d+)\./,1);else if(o.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection)e.browser="chrome",e.version=Ex(o.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.RTCPeerConnection&&o.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=Ex(o.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function eD(n){return Object.prototype.toString.call(n)==="[object Object]"}function d4(n){return eD(n)?Object.keys(n).reduce(function(e,o){var u=eD(n[o]),d=u?d4(n[o]):n[o],y=u&&!Object.keys(d).length;return d===void 0||y?e:Object.assign(e,bte({},o,d))},{}):n}function fb(n,e,o){!e||o.has(e.id)||(o.set(e.id,e),Object.keys(e).forEach(function(u){u.endsWith("Id")?fb(n,n.get(e[u]),o):u.endsWith("Ids")&&e[u].forEach(function(d){fb(n,n.get(d),o)})}))}function Pte(n,e,o){var u=o?"outbound-rtp":"inbound-rtp",d=new Map;if(e===null)return d;var y=[];return n.forEach(function(v){v.type==="track"&&v.trackIdentifier===e.id&&y.push(v)}),y.forEach(function(v){n.forEach(function(r){r.type===u&&r.trackId===v.id&&fb(n,r,d)})}),d}Object.defineProperty(c4,"__esModule",{value:!0});var Rte=c4.shimGetUserMedia=Lte,Dte=Ote(Ya);function f4(n){if(typeof WeakMap!="function")return null;var e=new WeakMap,o=new WeakMap;return(f4=function(u){return u?o:e})(n)}function Ote(n,e){if(n&&n.__esModule)return n;if(n===null||sd(n)!=="object"&&typeof n!="function")return{default:n};var o=f4(e);if(o&&o.has(n))return o.get(n);var u={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in n)if(y!=="default"&&Object.prototype.hasOwnProperty.call(n,y)){var v=d?Object.getOwnPropertyDescriptor(n,y):null;v&&(v.get||v.set)?Object.defineProperty(u,y,v):u[y]=n[y]}return u.default=n,o&&o.set(n,u),u}function sd(n){"@babel/helpers - typeof";return sd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sd(n)}var tD=Dte.log;function Lte(n,e){var o=n&&n.navigator;if(o.mediaDevices){var u=function(D){if(sd(D)!=="object"||D.mandatory||D.optional)return D;var B={};return Object.keys(D).forEach(function(F){if(!(F==="require"||F==="advanced"||F==="mediaSource")){var N=sd(D[F])==="object"?D[F]:{ideal:D[F]};N.exact!==void 0&&typeof N.exact=="number"&&(N.min=N.max=N.exact);var Q=function(X,G){return X?X+G.charAt(0).toUpperCase()+G.slice(1):G==="deviceId"?"sourceId":G};if(N.ideal!==void 0){B.optional=B.optional||[];var q={};typeof N.ideal=="number"?(q[Q("min",F)]=N.ideal,B.optional.push(q),q={},q[Q("max",F)]=N.ideal,B.optional.push(q)):(q[Q("",F)]=N.ideal,B.optional.push(q))}N.exact!==void 0&&typeof N.exact!="number"?(B.mandatory=B.mandatory||{},B.mandatory[Q("",F)]=N.exact):["min","max"].forEach(function(X){N[X]!==void 0&&(B.mandatory=B.mandatory||{},B.mandatory[Q(X,F)]=N[X])})}}),D.advanced&&(B.optional=(B.optional||[]).concat(D.advanced)),B},d=function(D,B){if(e.version>=61)return B(D);if(D=JSON.parse(JSON.stringify(D)),D&&sd(D.audio)==="object"){var F=function(X,G,ae){G in X&&!(ae in X)&&(X[ae]=X[G],delete X[G])};D=JSON.parse(JSON.stringify(D)),F(D.audio,"autoGainControl","googAutoGainControl"),F(D.audio,"noiseSuppression","googNoiseSuppression"),D.audio=u(D.audio)}if(D&&sd(D.video)==="object"){var N=D.video.facingMode;N=N&&(sd(N)==="object"?N:{ideal:N});var Q=e.version<66;if(N&&(N.exact==="user"||N.exact==="environment"||N.ideal==="user"||N.ideal==="environment")&&!(o.mediaDevices.getSupportedConstraints&&o.mediaDevices.getSupportedConstraints().facingMode&&!Q)){delete D.video.facingMode;var q;if(N.exact==="environment"||N.ideal==="environment"?q=["back","rear"]:(N.exact==="user"||N.ideal==="user")&&(q=["front"]),q)return o.mediaDevices.enumerateDevices().then(function(X){X=X.filter(function(ae){return ae.kind==="videoinput"});var G=X.find(function(ae){return q.some(function(xe){return ae.label.toLowerCase().includes(xe)})});return!G&&X.length&&q.includes("back")&&(G=X[X.length-1]),G&&(D.video.deviceId=N.exact?{exact:G.deviceId}:{ideal:G.deviceId}),D.video=u(D.video),tD("chrome: "+JSON.stringify(D)),B(D)})}D.video=u(D.video)}return tD("chrome: "+JSON.stringify(D)),B(D)},y=function(D){return e.version>=64?D:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[D.name]||D.name,message:D.message,constraint:D.constraint||D.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},v=function(D,B,F){d(D,function(N){o.webkitGetUserMedia(N,B,function(Q){F&&F(y(Q))})})};if(o.getUserMedia=v.bind(o),o.mediaDevices.getUserMedia){var r=o.mediaDevices.getUserMedia.bind(o.mediaDevices);o.mediaDevices.getUserMedia=function(D){return d(D,function(B){return r(B).then(function(F){if(B.audio&&!F.getAudioTracks().length||B.video&&!F.getVideoTracks().length)throw F.getTracks().forEach(function(N){N.stop()}),new DOMException("","NotFoundError");return F},function(F){return Promise.reject(y(F))})})}}}}var p4={};Object.defineProperty(p4,"__esModule",{value:!0});var kte=p4.shimGetUserMedia=Bte,zte=Fte(Ya);function m4(n){if(typeof WeakMap!="function")return null;var e=new WeakMap,o=new WeakMap;return(m4=function(u){return u?o:e})(n)}function Fte(n,e){if(n&&n.__esModule)return n;if(n===null||s_(n)!=="object"&&typeof n!="function")return{default:n};var o=m4(e);if(o&&o.has(n))return o.get(n);var u={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in n)if(y!=="default"&&Object.prototype.hasOwnProperty.call(n,y)){var v=d?Object.getOwnPropertyDescriptor(n,y):null;v&&(v.get||v.set)?Object.defineProperty(u,y,v):u[y]=n[y]}return u.default=n,o&&o.set(n,u),u}function s_(n){"@babel/helpers - typeof";return s_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s_(n)}function Bte(n,e){var o=n&&n.navigator,u=n&&n.MediaStreamTrack;if(o.getUserMedia=function(D,B,F){zte.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),o.mediaDevices.getUserMedia(D).then(B,F)},!(e.version>55&&"autoGainControl"in o.mediaDevices.getSupportedConstraints())){var d=function(D,B,F){B in D&&!(F in D)&&(D[F]=D[B],delete D[B])},y=o.mediaDevices.getUserMedia.bind(o.mediaDevices);if(o.mediaDevices.getUserMedia=function(D){return s_(D)==="object"&&s_(D.audio)==="object"&&(D=JSON.parse(JSON.stringify(D)),d(D.audio,"autoGainControl","mozAutoGainControl"),d(D.audio,"noiseSuppression","mozNoiseSuppression")),y(D)},u&&u.prototype.getSettings){var v=u.prototype.getSettings;u.prototype.getSettings=function(){var D=v.apply(this,arguments);return d(D,"mozAutoGainControl","autoGainControl"),d(D,"mozNoiseSuppression","noiseSuppression"),D}}if(u&&u.prototype.applyConstraints){var r=u.prototype.applyConstraints;u.prototype.applyConstraints=function(D){return this.kind==="audio"&&s_(D)==="object"&&(D=JSON.parse(JSON.stringify(D)),d(D,"autoGainControl","mozAutoGainControl"),d(D,"noiseSuppression","mozNoiseSuppression")),r.apply(this,[D])}}}}var pu={};Object.defineProperty(pu,"__esModule",{value:!0});pu.shimAudioContext=Zte;pu.shimCallbacksAPI=$te;pu.shimConstraints=y4;pu.shimCreateOfferLegacy=Wte;var Nte=pu.shimGetUserMedia=qte;pu.shimLocalStreamsAPI=Ute;pu.shimRTCIceServerUrls=Hte;pu.shimRemoteStreamsAPI=jte;pu.shimTrackEventTransceiver=Gte;var _4=Vte(Ya);function g4(n){if(typeof WeakMap!="function")return null;var e=new WeakMap,o=new WeakMap;return(g4=function(u){return u?o:e})(n)}function Vte(n,e){if(n&&n.__esModule)return n;if(n===null||Id(n)!=="object"&&typeof n!="function")return{default:n};var o=g4(e);if(o&&o.has(n))return o.get(n);var u={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in n)if(y!=="default"&&Object.prototype.hasOwnProperty.call(n,y)){var v=d?Object.getOwnPropertyDescriptor(n,y):null;v&&(v.get||v.set)?Object.defineProperty(u,y,v):u[y]=n[y]}return u.default=n,o&&o.set(n,u),u}function Id(n){"@babel/helpers - typeof";return Id=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Id(n)}function Ute(n){if(!(Id(n)!=="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){var e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(o){var u=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(o)||this._localStreams.push(o),o.getAudioTracks().forEach(function(d){return e.call(u,d,o)}),o.getVideoTracks().forEach(function(d){return e.call(u,d,o)})},n.RTCPeerConnection.prototype.addTrack=function(o){for(var u=this,d=arguments.length,y=new Array(d>1?d-1:0),v=1;v<d;v++)y[v-1]=arguments[v];return y&&y.forEach(function(r){u._localStreams?u._localStreams.includes(r)||u._localStreams.push(r):u._localStreams=[r]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(o){var u=this;this._localStreams||(this._localStreams=[]);var d=this._localStreams.indexOf(o);if(d!==-1){this._localStreams.splice(d,1);var y=o.getTracks();this.getSenders().forEach(function(v){y.includes(v.track)&&u.removeTrack(v)})}})}}function jte(n){if(!(Id(n)!=="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(o){var u=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=o),this.addEventListener("track",this._onaddstreampoly=function(d){d.streams.forEach(function(y){if(u._remoteStreams||(u._remoteStreams=[]),!u._remoteStreams.includes(y)){u._remoteStreams.push(y);var v=new Event("addstream");v.stream=y,u.dispatchEvent(v)}})})}});var e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){var o=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(u){u.streams.forEach(function(d){if(o._remoteStreams||(o._remoteStreams=[]),!(o._remoteStreams.indexOf(d)>=0)){o._remoteStreams.push(d);var y=new Event("addstream");y.stream=d,o.dispatchEvent(y)}})}),e.apply(o,arguments)}}}function $te(n){if(!(Id(n)!=="object"||!n.RTCPeerConnection)){var e=n.RTCPeerConnection.prototype,o=e.createOffer,u=e.createAnswer,d=e.setLocalDescription,y=e.setRemoteDescription,v=e.addIceCandidate;e.createOffer=function(D,B){var F=arguments.length>=2?arguments[2]:arguments[0],N=o.apply(this,[F]);return B?(N.then(D,B),Promise.resolve()):N},e.createAnswer=function(D,B){var F=arguments.length>=2?arguments[2]:arguments[0],N=u.apply(this,[F]);return B?(N.then(D,B),Promise.resolve()):N};var r=function(D,B,F){var N=d.apply(this,[D]);return F?(N.then(B,F),Promise.resolve()):N};e.setLocalDescription=r,r=function(D,B,F){var N=y.apply(this,[D]);return F?(N.then(B,F),Promise.resolve()):N},e.setRemoteDescription=r,r=function(D,B,F){var N=v.apply(this,[D]);return F?(N.then(B,F),Promise.resolve()):N},e.addIceCandidate=r}}function qte(n){var e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){var o=e.mediaDevices,u=o.getUserMedia.bind(o);e.mediaDevices.getUserMedia=function(d){return u(y4(d))}}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(d,y,v){e.mediaDevices.getUserMedia(d).then(y,v)}).bind(e))}function y4(n){return n&&n.video!==void 0?Object.assign({},n,{video:_4.compactObject(n.video)}):n}function Hte(n){if(n.RTCPeerConnection){var e=n.RTCPeerConnection;n.RTCPeerConnection=function(o,u){if(o&&o.iceServers){for(var d=[],y=0;y<o.iceServers.length;y++){var v=o.iceServers[y];v.urls===void 0&&v.url?(_4.deprecated("RTCIceServer.url","RTCIceServer.urls"),v=JSON.parse(JSON.stringify(v)),v.urls=v.url,delete v.url,d.push(v)):d.push(o.iceServers[y])}o.iceServers=d}return new e(o,u)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:function(){return e.generateCertificate}})}}function Gte(n){Id(n)==="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function Wte(n){var e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(o){if(o){typeof o.offerToReceiveAudio<"u"&&(o.offerToReceiveAudio=!!o.offerToReceiveAudio);var u=this.getTransceivers().find(function(y){return y.receiver.track.kind==="audio"});o.offerToReceiveAudio===!1&&u?u.direction==="sendrecv"?u.setDirection?u.setDirection("sendonly"):u.direction="sendonly":u.direction==="recvonly"&&(u.setDirection?u.setDirection("inactive"):u.direction="inactive"):o.offerToReceiveAudio===!0&&!u&&this.addTransceiver("audio",{direction:"recvonly"}),typeof o.offerToReceiveVideo<"u"&&(o.offerToReceiveVideo=!!o.offerToReceiveVideo);var d=this.getTransceivers().find(function(y){return y.receiver.track.kind==="video"});o.offerToReceiveVideo===!1&&d?d.direction==="sendrecv"?d.setDirection?d.setDirection("sendonly"):d.direction="sendonly":d.direction==="recvonly"&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive"):o.offerToReceiveVideo===!0&&!d&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Zte(n){Id(n)!=="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}const Yte=_te(()=>{const n=xte(window);switch(n.browser){case"chrome":Rte(window,n);break;case"firefox":kte(window,n);break;case"safari":Nte(window,n);break;default:throw new o4}});let o_=Promise.resolve({type:"stop",data:{}});async function iD(n,e,o){var u,d,y;if(console.debug("[vue-qrcode-reader] starting camera with constraints: ",JSON.stringify(e)),window.isSecureContext!==!0)throw new pte;if(((u=navigator==null?void 0:navigator.mediaDevices)==null?void 0:u.getUserMedia)===void 0)throw new o4;Yte(),console.debug("[vue-qrcode-reader] calling getUserMedia");const v=await navigator.mediaDevices.getUserMedia({audio:!1,video:e});n.srcObject!==void 0?n.srcObject=v:n.mozSrcObject!==void 0?n.mozSrcObject=v:window.URL.createObjectURL?n.src=window.URL.createObjectURL(v):window.webkitURL?n.src=window.webkitURL.createObjectURL(v):n.src=v.id,n.play(),console.debug("[vue-qrcode-reader] waiting for video element to load"),await Promise.race([s4(n,"loadeddata"),JR(6e3).then(()=>{throw new mte})]),console.debug("[vue-qrcode-reader] video element loaded"),await JR(500);const[r]=v.getVideoTracks(),D=(y=(d=r==null?void 0:r.getCapabilities)==null?void 0:d.call(r))!=null?y:{};let B=!1;return o&&D.torch&&(await r.applyConstraints({advanced:[{torch:!0}]}),B=!0),console.debug("[vue-qrcode-reader] camera ready"),{type:"start",data:{videoEl:n,stream:v,capabilities:D,constraints:e,isTorchOn:B}}}async function Xte(n,{constraints:e,torch:o,restart:u=!1}){o_=o_.then(y=>{if(y.type==="start"){const{data:{videoEl:v,stream:r,constraints:D,isTorchOn:B}}=y;return!u&&n===v&&e===D&&o===B?y:v4(v,r,B).then(()=>iD(n,e,o))}else if(y.type==="stop"||y.type==="failed")return iD(n,e,o);QR()}).catch(y=>(console.debug(`[vue-qrcode-reader] starting camera failed with "${y}"`),{type:"failed",error:y}));const d=await o_;if(d.type==="stop")throw new Error("Something went wrong with the camera task queue (start task).");if(d.type==="failed")throw d.error;if(d.type==="start")return d.data.capabilities;QR()}async function v4(n,e,o){console.debug("[vue-qrcode-reader] stopping camera"),n.src="",n.srcObject=null,n.load(),await s4(n,"error");for(const u of e.getTracks())o!=null||await u.applyConstraints({advanced:[{torch:!1}]}),e.removeTrack(u),u.stop();return{type:"stop",data:{}}}async function Jv(){if(o_=o_.then(n=>{if(n.type==="stop"||n.type==="failed")return n;const{data:{videoEl:e,stream:o,isTorchOn:u}}=n;return v4(e,o,u)}),(await o_).type==="start")throw new Error("Something went wrong with the camera task queue (stop task).")}const Kte=Gb({__name:"QrcodeStream",props:{constraints:{default:()=>({facingMode:"environment"})},formats:{default:()=>["qr_code"]},paused:{type:Boolean,default:!1},torch:{type:Boolean,default:!1},track:{type:Function,default:void 0}},emits:["detect","camera-on","camera-off","error"],setup(n,{emit:e}){const o=n,u=e,d=Bs(o.constraints),y=Bs(o.formats);Ua(()=>o.constraints,(fe,ne)=>{JSON.stringify(fe)!==JSON.stringify(ne)&&(d.value=fe)},{deep:!0}),Ua(()=>o.formats,(fe,ne)=>{JSON.stringify(fe)!==JSON.stringify(ne)&&(y.value=fe)},{deep:!0});const v=Bs(),r=Bs(),D=Bs(),B=Bs(!1),F=Bs(!1);Sl(()=>{F.value=!0}),H0(()=>{Jv()});const N=Ky(()=>({torch:o.torch,constraints:d.value,shouldStream:F.value&&!o.paused}));Ua(N,async fe=>{const ne=D.value;Jc(ne!==void 0,"cameraSettings watcher should never be triggered when component is not mounted. Thus video element should always be defined.");const ue=v.value;Jc(ue!==void 0,"cameraSettings watcher should never be triggered when component is not mounted. Thus canvas should always be defined.");const ye=ue.getContext("2d");if(Jc(ye!==null,"if cavnas is defined, canvas 2d context should also be non-null"),fe.shouldStream){Jv(),B.value=!1;try{const le=await Xte(ne,fe);F.value?(B.value=!0,u("camera-on",le)):await Jv()}catch(le){u("error",le)}}else ue.width=ne.videoWidth,ue.height=ne.videoHeight,ye.drawImage(ne,0,0,ne.videoWidth,ne.videoHeight),Jv(),B.value=!1,u("camera-off")},{deep:!0}),Ua(y,async fe=>{F.value&&await l4(fe)});const Q=Ky(()=>N.value.shouldStream&&B.value);Ua(Q,fe=>{if(fe){Jc(v.value!==void 0,"shouldScan watcher should only be triggered when component is mounted. Thus pause frame canvas is defined"),q(v.value),Jc(r.value!==void 0,"shouldScan watcher should only be triggered when component is mounted. Thus tracking canvas is defined"),q(r.value);const ne=()=>o.track===void 0?500:40;Jc(D.value!==void 0,"shouldScan watcher should only be triggered when component is mounted. Thus video element is defined"),vte(D.value,{detectHandler:ue=>u("detect",ue),formats:y.value,locateHandler:X,minDelay:ne()})}});const q=fe=>{const ne=fe.getContext("2d");Jc(ne!==null,"canvas 2d context should always be non-null"),ne.clearRect(0,0,fe.width,fe.height)},X=fe=>{const ne=r.value;Jc(ne!==void 0,"onLocate handler should only be called when component is mounted. Thus tracking canvas is always defined.");const ue=D.value;if(Jc(ue!==void 0,"onLocate handler should only be called when component is mounted. Thus video element is always defined."),fe.length===0||o.track===void 0)q(ne);else{const ye=ue.offsetWidth,le=ue.offsetHeight,re=ue.videoWidth,oe=ue.videoHeight,se=Math.max(ye/re,le/oe),Ae=re*se,De=oe*se,Ge=Ae/re,yt=De/oe,ct=(ye-Ae)/2,mt=(le-De)/2,et=({x:Zt,y:ui})=>({x:Math.floor(Zt*Ge),y:Math.floor(ui*yt)}),Qe=({x:Zt,y:ui})=>({x:Math.floor(Zt+ct),y:Math.floor(ui+mt)}),vt=fe.map(Zt=>{const{boundingBox:ui,cornerPoints:ni}=Zt,{x:Hi,y:Ci}=Qe(et({x:ui.x,y:ui.y})),{x:Ii,y:Ui}=et({x:ui.width,y:ui.height});return{...Zt,cornerPoints:ni.map(xi=>Qe(et(xi))),boundingBox:DOMRectReadOnly.fromRect({x:Hi,y:Ci,width:Ii,height:Ui})}});ne.width=ue.offsetWidth,ne.height=ue.offsetHeight;const st=ne.getContext("2d");Jc(st!==null,"canvas 2d context should always be non-null"),o.track(vt,st)}},G={width:"100%",height:"100%",position:"relative","z-index":"0"},ae={width:"100%",height:"100%",position:"absolute",top:"0",left:"0"},xe={width:"100%",height:"100%","object-fit":"cover"},Te=Ky(()=>Q.value?xe:{...xe,visibility:"hidden",position:"absolute"});return(fe,ne)=>(zt(),Nt("div",{style:G},[K("video",{ref_key:"videoRef",ref:D,style:Ps(Te.value),autoplay:"",muted:"",playsinline:""},null,4),tn(K("canvas",{id:"qrcode-stream-pause-frame",ref_key:"pauseFrameRef",ref:v,style:xe},null,512),[[lA,!Q.value]]),K("canvas",{id:"qrcode-stream-tracking-layer",ref_key:"trackingLayerRef",ref:r,style:ae},null,512),K("div",{style:ae},[wk(fe.$slots,"default")])]))}}),Jte={components:{QrcodeStream:Kte},data(){return{qrContent:null}},methods:{onDecode(n){this.qrContent=n},onInit(n){n.catch(e=>{console.error("Problema con la cámara:",e)})}}},Qte={key:0},eie=["href"];function tie(n,e,o,u,d,y){const v=tA("qrcode-stream");return zt(),Nt("div",null,[hs(v,{onDecode:y.onDecode,onInit:y.onInit},null,8,["onDecode","onInit"]),d.qrContent?(zt(),Nt("div",Qte,[e[0]||(e[0]=K("p",null,"QR escaneado:",-1)),K("a",{href:d.qrContent,target:"_blank"},oi(d.qrContent),9,eie)])):Jn("",!0)])}const iie=Wn(Jte,[["render",tie]]);var x4={exports:{}};(function(n,e){(function(o,u){n.exports=u()})(jz,function(){return function(o){var u={};function d(y){if(u[y])return u[y].exports;var v=u[y]={i:y,l:!1,exports:{}};return o[y].call(v.exports,v,v.exports,d),v.l=!0,v.exports}return d.m=o,d.c=u,d.d=function(y,v,r){d.o(y,v)||Object.defineProperty(y,v,{enumerable:!0,get:r})},d.r=function(y){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(y,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(y,"__esModule",{value:!0})},d.t=function(y,v){if(1&v&&(y=d(y)),8&v||4&v&&typeof y=="object"&&y&&y.__esModule)return y;var r=Object.create(null);if(d.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:y}),2&v&&typeof y!="string")for(var D in y)d.d(r,D,(function(B){return y[B]}).bind(null,D));return r},d.n=function(y){var v=y&&y.__esModule?function(){return y.default}:function(){return y};return d.d(v,"a",v),v},d.o=function(y,v){return Object.prototype.hasOwnProperty.call(y,v)},d.p="/dist/",d(d.s=13)}([function(o,u){o.exports=function(d,y){if(!(d instanceof y))throw new TypeError("Cannot call a class as a function")},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,u){function d(y,v){for(var r=0;r<v.length;r++){var D=v[r];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(y,D.key,D)}}o.exports=function(y,v,r){return v&&d(y.prototype,v),r&&d(y,r),Object.defineProperty(y,"prototype",{writable:!1}),y},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,u){function d(y){return o.exports=d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},o.exports.__esModule=!0,o.exports.default=o.exports,d(y)}o.exports=d,o.exports.__esModule=!0,o.exports.default=o.exports},function(o,u,d){o.exports=d(14)()},function(o,u,d){d.d(u,"a",function(){return N}),d.d(u,"b",function(){return Q}),d.d(u,"c",function(){return G});var y=d(0),v=d.n(y),r=d(1),D=d.n(r);function B(ue){var ye=encodeURI(ue).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return ye.length+(ye.length!=Number(ue)?3:0)}var F=function(){function ue(ye){v()(this,ue),this.mode=q.MODE_8BIT_BYTE,this.parsedData=[],this.data=ye;for(var le=[],re=0,oe=this.data.length;re<oe;re++){var se=[],Ae=this.data.charCodeAt(re);Ae>65536?(se[0]=240|(1835008&Ae)>>>18,se[1]=128|(258048&Ae)>>>12,se[2]=128|(4032&Ae)>>>6,se[3]=128|63&Ae):Ae>2048?(se[0]=224|(61440&Ae)>>>12,se[1]=128|(4032&Ae)>>>6,se[2]=128|63&Ae):Ae>128?(se[0]=192|(1984&Ae)>>>6,se[1]=128|63&Ae):se[0]=Ae,le.push(se)}this.parsedData=Array.prototype.concat.apply([],le),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}return D()(ue,[{key:"getLength",value:function(){return this.parsedData.length}},{key:"write",value:function(ye){for(var le=0,re=this.parsedData.length;le<re;le++)ye.put(this.parsedData[le],8)}}]),ue}(),N=function(){function ue(){var ye=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1,le=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Q.L;v()(this,ue),this.moduleCount=0,this.dataList=[],this.typeNumber=ye,this.errorCorrectLevel=le,this.moduleCount=0,this.dataList=[]}return D()(ue,[{key:"addData",value:function(ye){if(this.typeNumber<=0)this.typeNumber=function(re,oe){for(var se=1,Ae=B(re),De=0,Ge=ne.length;De<Ge;De++){var yt=0;switch(oe){case Q.L:yt=ne[De][0];break;case Q.M:yt=ne[De][1];break;case Q.Q:yt=ne[De][2];break;case Q.H:yt=ne[De][3]}if(Ae<=yt)break;se++}if(se>ne.length)throw new Error("Too long data");return se}(ye,this.errorCorrectLevel);else{if(this.typeNumber>40)throw new Error("Invalid QR version: ".concat(this.typeNumber));if(!function(re,oe,se){var Ae=B(oe),De=re-1,Ge=0;switch(se){case Q.L:Ge=ne[De][0];break;case Q.M:Ge=ne[De][1];break;case Q.Q:Ge=ne[De][2];break;case Q.H:Ge=ne[De][3]}return Ae<=Ge}(this.typeNumber,ye,this.errorCorrectLevel))throw new Error("Data is too long for QR version: ".concat(this.typeNumber))}var le=new F(ye);this.dataList.push(le),this.dataCache=void 0}},{key:"isDark",value:function(ye,le){if(ye<0||this.moduleCount<=ye||le<0||this.moduleCount<=le)throw new Error("".concat(ye,",").concat(le));return this.modules[ye][le]}},{key:"getModuleCount",value:function(){return this.moduleCount}},{key:"make",value:function(){this.makeImpl(!1,this.getBestMaskPattern())}},{key:"makeImpl",value:function(ye,le){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var re=0;re<this.moduleCount;re++){this.modules[re]=new Array(this.moduleCount);for(var oe=0;oe<this.moduleCount;oe++)this.modules[re][oe]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(ye,le),this.typeNumber>=7&&this.setupTypeNumber(ye),this.dataCache==null&&(this.dataCache=ue.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,le)}},{key:"setupPositionProbePattern",value:function(ye,le){for(var re=-1;re<=7;re++)if(!(ye+re<=-1||this.moduleCount<=ye+re))for(var oe=-1;oe<=7;oe++)le+oe<=-1||this.moduleCount<=le+oe||(this.modules[ye+re][le+oe]=0<=re&&re<=6&&(oe==0||oe==6)||0<=oe&&oe<=6&&(re==0||re==6)||2<=re&&re<=4&&2<=oe&&oe<=4)}},{key:"getBestMaskPattern",value:function(){if(Number.isInteger(this.maskPattern)&&Object.values(X).includes(this.maskPattern))return this.maskPattern;for(var ye=0,le=0,re=0;re<8;re++){this.makeImpl(!0,re);var oe=G.getLostPoint(this);(re==0||ye>oe)&&(ye=oe,le=re)}return le}},{key:"setupTimingPattern",value:function(){for(var ye=8;ye<this.moduleCount-8;ye++)this.modules[ye][6]==null&&(this.modules[ye][6]=ye%2==0);for(var le=8;le<this.moduleCount-8;le++)this.modules[6][le]==null&&(this.modules[6][le]=le%2==0)}},{key:"setupPositionAdjustPattern",value:function(){for(var ye=G.getPatternPosition(this.typeNumber),le=0;le<ye.length;le++)for(var re=0;re<ye.length;re++){var oe=ye[le],se=ye[re];if(this.modules[oe][se]==null)for(var Ae=-2;Ae<=2;Ae++)for(var De=-2;De<=2;De++)this.modules[oe+Ae][se+De]=Ae==-2||Ae==2||De==-2||De==2||Ae==0&&De==0}}},{key:"setupTypeNumber",value:function(ye){for(var le=G.getBCHTypeNumber(this.typeNumber),re=0;re<18;re++){var oe=!ye&&(le>>re&1)==1;this.modules[Math.floor(re/3)][re%3+this.moduleCount-8-3]=oe}for(re=0;re<18;re++)oe=!ye&&(le>>re&1)==1,this.modules[re%3+this.moduleCount-8-3][Math.floor(re/3)]=oe}},{key:"setupTypeInfo",value:function(ye,le){for(var re=this.errorCorrectLevel<<3|le,oe=G.getBCHTypeInfo(re),se=0;se<15;se++){var Ae=!ye&&(oe>>se&1)==1;se<6?this.modules[se][8]=Ae:se<8?this.modules[se+1][8]=Ae:this.modules[this.moduleCount-15+se][8]=Ae}for(se=0;se<15;se++)Ae=!ye&&(oe>>se&1)==1,se<8?this.modules[8][this.moduleCount-se-1]=Ae:se<9?this.modules[8][15-se-1+1]=Ae:this.modules[8][15-se-1]=Ae;this.modules[this.moduleCount-8][8]=!ye}},{key:"mapData",value:function(ye,le){for(var re=-1,oe=this.moduleCount-1,se=7,Ae=0,De=this.moduleCount-1;De>0;De-=2)for(De==6&&De--;;){for(var Ge=0;Ge<2;Ge++)if(this.modules[oe][De-Ge]==null){var yt=!1;Ae<ye.length&&(yt=(ye[Ae]>>>se&1)==1),G.getMask(le,oe,De-Ge)&&(yt=!yt),this.modules[oe][De-Ge]=yt,--se==-1&&(Ae++,se=7)}if((oe+=re)<0||this.moduleCount<=oe){oe-=re,re=-re;break}}}}],[{key:"createData",value:function(ye,le,re){for(var oe=Te.getRSBlocks(ye,le),se=new fe,Ae=0;Ae<re.length;Ae++){var De=re[Ae];se.put(De.mode,4),se.put(De.getLength(),G.getLengthInBits(De.mode,ye)),De.write(se)}var Ge=0;for(Ae=0;Ae<oe.length;Ae++)Ge+=oe[Ae].dataCount;if(se.getLengthInBits()>8*Ge)throw new Error("code length overflow. (".concat(se.getLengthInBits(),">").concat(8*Ge,")"));for(se.getLengthInBits()+4<=8*Ge&&se.put(0,4);se.getLengthInBits()%8!=0;)se.putBit(!1);for(;!(se.getLengthInBits()>=8*Ge||(se.put(ue.PAD0,8),se.getLengthInBits()>=8*Ge));)se.put(ue.PAD1,8);return ue.createBytes(se,oe)}},{key:"createBytes",value:function(ye,le){for(var re=0,oe=0,se=0,Ae=new Array(le.length),De=new Array(le.length),Ge=0;Ge<le.length;Ge++){var yt=le[Ge].dataCount,ct=le[Ge].totalCount-yt;oe=Math.max(oe,yt),se=Math.max(se,ct),Ae[Ge]=new Array(yt);for(var mt=0;mt<Ae[Ge].length;mt++)Ae[Ge][mt]=255&ye.buffer[mt+re];re+=yt;var et=G.getErrorCorrectPolynomial(ct),Qe=new xe(Ae[Ge],et.getLength()-1).mod(et);for(De[Ge]=new Array(et.getLength()-1),mt=0;mt<De[Ge].length;mt++){var vt=mt+Qe.getLength()-De[Ge].length;De[Ge][mt]=vt>=0?Qe.get(vt):0}}var st=0;for(mt=0;mt<le.length;mt++)st+=le[mt].totalCount;var Zt=new Array(st),ui=0;for(mt=0;mt<oe;mt++)for(Ge=0;Ge<le.length;Ge++)mt<Ae[Ge].length&&(Zt[ui++]=Ae[Ge][mt]);for(mt=0;mt<se;mt++)for(Ge=0;Ge<le.length;Ge++)mt<De[Ge].length&&(Zt[ui++]=De[Ge][mt]);return Zt}}]),ue}();N.PAD0=236,N.PAD1=17;var Q={L:1,M:0,Q:3,H:2},q={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},X={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},G=function(){function ue(){v()(this,ue)}return D()(ue,null,[{key:"getBCHTypeInfo",value:function(ye){for(var le=ye<<10;ue.getBCHDigit(le)-ue.getBCHDigit(ue.G15)>=0;)le^=ue.G15<<ue.getBCHDigit(le)-ue.getBCHDigit(ue.G15);return(ye<<10|le)^ue.G15_MASK}},{key:"getBCHTypeNumber",value:function(ye){for(var le=ye<<12;ue.getBCHDigit(le)-ue.getBCHDigit(ue.G18)>=0;)le^=ue.G18<<ue.getBCHDigit(le)-ue.getBCHDigit(ue.G18);return ye<<12|le}},{key:"getBCHDigit",value:function(ye){for(var le=0;ye!=0;)le++,ye>>>=1;return le}},{key:"getPatternPosition",value:function(ye){return ue.PATTERN_POSITION_TABLE[ye-1]}},{key:"getMask",value:function(ye,le,re){switch(ye){case X.PATTERN000:return(le+re)%2==0;case X.PATTERN001:return le%2==0;case X.PATTERN010:return re%3==0;case X.PATTERN011:return(le+re)%3==0;case X.PATTERN100:return(Math.floor(le/2)+Math.floor(re/3))%2==0;case X.PATTERN101:return le*re%2+le*re%3==0;case X.PATTERN110:return(le*re%2+le*re%3)%2==0;case X.PATTERN111:return(le*re%3+(le+re)%2)%2==0;default:throw new Error("bad maskPattern:".concat(ye))}}},{key:"getErrorCorrectPolynomial",value:function(ye){for(var le=new xe([1],0),re=0;re<ye;re++)le=le.multiply(new xe([1,ae.gexp(re)],0));return le}},{key:"getLengthInBits",value:function(ye,le){if(1<=le&&le<10)switch(ye){case q.MODE_NUMBER:return 10;case q.MODE_ALPHA_NUM:return 9;case q.MODE_8BIT_BYTE:case q.MODE_KANJI:return 8;default:throw new Error("mode:".concat(ye))}else if(le<27)switch(ye){case q.MODE_NUMBER:return 12;case q.MODE_ALPHA_NUM:return 11;case q.MODE_8BIT_BYTE:return 16;case q.MODE_KANJI:return 10;default:throw new Error("mode:".concat(ye))}else{if(!(le<41))throw new Error("type:".concat(le));switch(ye){case q.MODE_NUMBER:return 14;case q.MODE_ALPHA_NUM:return 13;case q.MODE_8BIT_BYTE:return 16;case q.MODE_KANJI:return 12;default:throw new Error("mode:".concat(ye))}}}},{key:"getLostPoint",value:function(ye){for(var le=ye.getModuleCount(),re=0,oe=0;oe<le;oe++)for(var se=0;se<le;se++){for(var Ae=0,De=ye.isDark(oe,se),Ge=-1;Ge<=1;Ge++)if(!(oe+Ge<0||le<=oe+Ge))for(var yt=-1;yt<=1;yt++)se+yt<0||le<=se+yt||Ge==0&&yt==0||De==ye.isDark(oe+Ge,se+yt)&&Ae++;Ae>5&&(re+=3+Ae-5)}for(oe=0;oe<le-1;oe++)for(se=0;se<le-1;se++){var ct=0;ye.isDark(oe,se)&&ct++,ye.isDark(oe+1,se)&&ct++,ye.isDark(oe,se+1)&&ct++,ye.isDark(oe+1,se+1)&&ct++,ct!=0&&ct!=4||(re+=3)}for(oe=0;oe<le;oe++)for(se=0;se<le-6;se++)ye.isDark(oe,se)&&!ye.isDark(oe,se+1)&&ye.isDark(oe,se+2)&&ye.isDark(oe,se+3)&&ye.isDark(oe,se+4)&&!ye.isDark(oe,se+5)&&ye.isDark(oe,se+6)&&(re+=40);for(se=0;se<le;se++)for(oe=0;oe<le-6;oe++)ye.isDark(oe,se)&&!ye.isDark(oe+1,se)&&ye.isDark(oe+2,se)&&ye.isDark(oe+3,se)&&ye.isDark(oe+4,se)&&!ye.isDark(oe+5,se)&&ye.isDark(oe+6,se)&&(re+=40);var mt=0;for(se=0;se<le;se++)for(oe=0;oe<le;oe++)ye.isDark(oe,se)&&mt++;return re+=10*(Math.abs(100*mt/le/le-50)/5)}}]),ue}();G.PATTERN_POSITION_TABLE=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G.G15=1335,G.G18=7973,G.G15_MASK=21522;var ae=function(){function ue(){v()(this,ue)}return D()(ue,null,[{key:"glog",value:function(ye){if(ye<1)throw new Error("glog(".concat(ye,")"));return ue.LOG_TABLE[ye]}},{key:"gexp",value:function(ye){for(;ye<0;)ye+=255;for(;ye>=256;)ye-=255;return ue.EXP_TABLE[ye]}}]),ue}();ae.EXP_TABLE=new Array(256),ae.LOG_TABLE=new Array(256),ae._constructor=function(){for(var ue=0;ue<8;ue++)ae.EXP_TABLE[ue]=1<<ue;for(ue=8;ue<256;ue++)ae.EXP_TABLE[ue]=ae.EXP_TABLE[ue-4]^ae.EXP_TABLE[ue-5]^ae.EXP_TABLE[ue-6]^ae.EXP_TABLE[ue-8];for(ue=0;ue<255;ue++)ae.LOG_TABLE[ae.EXP_TABLE[ue]]=ue}();var xe=function(){function ue(ye,le){if(v()(this,ue),ye.length==null)throw new Error("".concat(ye.length,"/").concat(le));for(var re=0;re<ye.length&&ye[re]==0;)re++;this.num=new Array(ye.length-re+le);for(var oe=0;oe<ye.length-re;oe++)this.num[oe]=ye[oe+re]}return D()(ue,[{key:"get",value:function(ye){return this.num[ye]}},{key:"getLength",value:function(){return this.num.length}},{key:"multiply",value:function(ye){for(var le=new Array(this.getLength()+ye.getLength()-1),re=0;re<this.getLength();re++)for(var oe=0;oe<ye.getLength();oe++)le[re+oe]^=ae.gexp(ae.glog(this.get(re))+ae.glog(ye.get(oe)));return new ue(le,0)}},{key:"mod",value:function(ye){if(this.getLength()-ye.getLength()<0)return this;for(var le=ae.glog(this.get(0))-ae.glog(ye.get(0)),re=new Array(this.getLength()),oe=0;oe<this.getLength();oe++)re[oe]=this.get(oe);for(oe=0;oe<ye.getLength();oe++)re[oe]^=ae.gexp(ae.glog(ye.get(oe))+le);return new ue(re,0).mod(ye)}}]),ue}(),Te=function(){function ue(ye,le){v()(this,ue),this.totalCount=ye,this.dataCount=le}return D()(ue,null,[{key:"getRSBlocks",value:function(ye,le){var re=ue.getRsBlockTable(ye,le);if(re==null)throw new Error("bad rs block @ typeNumber:".concat(ye,"/errorCorrectLevel:").concat(le));for(var oe=re.length/3,se=[],Ae=0;Ae<oe;Ae++)for(var De=re[3*Ae+0],Ge=re[3*Ae+1],yt=re[3*Ae+2],ct=0;ct<De;ct++)se.push(new ue(Ge,yt));return se}},{key:"getRsBlockTable",value:function(ye,le){switch(le){case Q.L:return ue.RS_BLOCK_TABLE[4*(ye-1)+0];case Q.M:return ue.RS_BLOCK_TABLE[4*(ye-1)+1];case Q.Q:return ue.RS_BLOCK_TABLE[4*(ye-1)+2];case Q.H:return ue.RS_BLOCK_TABLE[4*(ye-1)+3];default:return}}}]),ue}();Te.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];var fe=function(){function ue(){v()(this,ue),this.buffer=[],this.length=0}return D()(ue,[{key:"get",value:function(ye){var le=Math.floor(ye/8);return(this.buffer[le]>>>7-ye%8&1)==1}},{key:"put",value:function(ye,le){for(var re=0;re<le;re++)this.putBit((ye>>>le-re-1&1)==1)}},{key:"getLengthInBits",value:function(){return this.length}},{key:"putBit",value:function(ye){var le=Math.floor(this.length/8);this.buffer.length<=le&&this.buffer.push(0),ye&&(this.buffer[le]|=128>>>this.length%8),this.length++}}]),ue}(),ne=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]]},function(o,u,d){(function(y){d.d(u,"b",function(){return N}),d.d(u,"a",function(){return Q});var v=d(2),r=d.n(v);function D(q){if(typeof q!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(q))}function B(q,X){for(var G,ae="",xe=0,Te=-1,fe=0,ne=0;ne<=q.length;++ne){if(ne<q.length)G=q.charCodeAt(ne);else{if(G===47)break;G=47}if(G===47){if(!(Te===ne-1||fe===1))if(Te!==ne-1&&fe===2){if(ae.length<2||xe!==2||ae.charCodeAt(ae.length-1)!==46||ae.charCodeAt(ae.length-2)!==46){if(ae.length>2){var ue=ae.lastIndexOf("/");if(ue!==ae.length-1){ue===-1?(ae="",xe=0):xe=(ae=ae.slice(0,ue)).length-1-ae.lastIndexOf("/"),Te=ne,fe=0;continue}}else if(ae.length===2||ae.length===1){ae="",xe=0,Te=ne,fe=0;continue}}X&&(ae.length>0?ae+="/..":ae="..",xe=2)}else ae.length>0?ae+="/"+q.slice(Te+1,ne):ae=q.slice(Te+1,ne),xe=ne-Te-1;Te=ne,fe=0}else G===46&&fe!==-1?++fe:fe=-1}return ae}var F={resolve:function(){for(var q,X="",G=!1,ae=arguments.length-1;ae>=-1&&!G;ae--){var xe;ae>=0?xe=arguments[ae]:(q===void 0&&(q=y.cwd()),xe=q),D(xe),xe.length!==0&&(X=xe+"/"+X,G=xe.charCodeAt(0)===47)}return X=B(X,!G),G?X.length>0?"/"+X:"/":X.length>0?X:"."},normalize:function(q){if(D(q),q.length===0)return".";var X=q.charCodeAt(0)===47,G=q.charCodeAt(q.length-1)===47;return(q=B(q,!X)).length!==0||X||(q="."),q.length>0&&G&&(q+="/"),X?"/"+q:q},isAbsolute:function(q){return D(q),q.length>0&&q.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var q,X=0;X<arguments.length;++X){var G=arguments[X];D(G),G.length>0&&(q===void 0?q=G:q+="/"+G)}return q===void 0?".":F.normalize(q)},relative:function(q,X){if(D(q),D(X),q===X||(q=F.resolve(q))===(X=F.resolve(X)))return"";for(var G=1;G<q.length&&q.charCodeAt(G)===47;++G);for(var ae=q.length,xe=ae-G,Te=1;Te<X.length&&X.charCodeAt(Te)===47;++Te);for(var fe=X.length-Te,ne=xe<fe?xe:fe,ue=-1,ye=0;ye<=ne;++ye){if(ye===ne){if(fe>ne){if(X.charCodeAt(Te+ye)===47)return X.slice(Te+ye+1);if(ye===0)return X.slice(Te+ye)}else xe>ne&&(q.charCodeAt(G+ye)===47?ue=ye:ye===0&&(ue=0));break}var le=q.charCodeAt(G+ye);if(le!==X.charCodeAt(Te+ye))break;le===47&&(ue=ye)}var re="";for(ye=G+ue+1;ye<=ae;++ye)ye!==ae&&q.charCodeAt(ye)!==47||(re.length===0?re+="..":re+="/..");return re.length>0?re+X.slice(Te+ue):(Te+=ue,X.charCodeAt(Te)===47&&++Te,X.slice(Te))},_makeLong:function(q){return q},dirname:function(q){if(D(q),q.length===0)return".";for(var X=q.charCodeAt(0),G=X===47,ae=-1,xe=!0,Te=q.length-1;Te>=1;--Te)if((X=q.charCodeAt(Te))===47){if(!xe){ae=Te;break}}else xe=!1;return ae===-1?G?"/":".":G&&ae===1?"//":q.slice(0,ae)},basename:function(q,X){if(X!==void 0&&typeof X!="string")throw new TypeError('"ext" argument must be a string');D(q);var G,ae=0,xe=-1,Te=!0;if(X!==void 0&&X.length>0&&X.length<=q.length){if(X.length===q.length&&X===q)return"";var fe=X.length-1,ne=-1;for(G=q.length-1;G>=0;--G){var ue=q.charCodeAt(G);if(ue===47){if(!Te){ae=G+1;break}}else ne===-1&&(Te=!1,ne=G+1),fe>=0&&(ue===X.charCodeAt(fe)?--fe==-1&&(xe=G):(fe=-1,xe=ne))}return ae===xe?xe=ne:xe===-1&&(xe=q.length),q.slice(ae,xe)}for(G=q.length-1;G>=0;--G)if(q.charCodeAt(G)===47){if(!Te){ae=G+1;break}}else xe===-1&&(Te=!1,xe=G+1);return xe===-1?"":q.slice(ae,xe)},extname:function(q){D(q);for(var X=-1,G=0,ae=-1,xe=!0,Te=0,fe=q.length-1;fe>=0;--fe){var ne=q.charCodeAt(fe);if(ne!==47)ae===-1&&(xe=!1,ae=fe+1),ne===46?X===-1?X=fe:Te!==1&&(Te=1):X!==-1&&(Te=-1);else if(!xe){G=fe+1;break}}return X===-1||ae===-1||Te===0||Te===1&&X===ae-1&&X===G+1?"":q.slice(X,ae)},format:function(q){if(q===null||r()(q)!=="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+r()(q));return function(X,G){var ae=G.dir||G.root,xe=G.base||(G.name||"")+(G.ext||"");return ae?ae===G.root?ae+xe:ae+X+xe:xe}("/",q)},parse:function(q){D(q);var X={root:"",dir:"",base:"",ext:"",name:""};if(q.length===0)return X;var G,ae=q.charCodeAt(0),xe=ae===47;xe?(X.root="/",G=1):G=0;for(var Te=-1,fe=0,ne=-1,ue=!0,ye=q.length-1,le=0;ye>=G;--ye)if((ae=q.charCodeAt(ye))!==47)ne===-1&&(ue=!1,ne=ye+1),ae===46?Te===-1?Te=ye:le!==1&&(le=1):Te!==-1&&(le=-1);else if(!ue){fe=ye+1;break}return Te===-1||ne===-1||le===0||le===1&&Te===ne-1&&Te===fe+1?ne!==-1&&(X.base=X.name=fe===0&&xe?q.slice(1,ne):q.slice(fe,ne)):(fe===0&&xe?(X.name=q.slice(1,Te),X.base=q.slice(1,ne)):(X.name=q.slice(fe,Te),X.base=q.slice(fe,ne)),X.ext=q.slice(Te,ne)),fe>0?X.dir=q.slice(0,fe-1):xe&&(X.dir="/"),X},sep:"/",delimiter:":",win32:null,posix:null};F.posix=F;var N=F.extname,Q=F.basename}).call(this,d(19))},function(o,u){function d(y,v,r,D,B,F,N){try{var Q=y[F](N),q=Q.value}catch(X){return void r(X)}Q.done?v(q):Promise.resolve(q).then(D,B)}o.exports=function(y){return function(){var v=this,r=arguments;return new Promise(function(D,B){var F=y.apply(v,r);function N(q){d(F,D,B,N,Q,"next",q)}function Q(q){d(F,D,B,N,Q,"throw",q)}N(void 0)})}},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,u,d){d.d(u,"b",function(){return ue}),d.d(u,"a",function(){return le});const y=(re,oe,se={},Ae=se)=>{if(Array.isArray(oe))oe.forEach(De=>y(re,De,se,Ae));else if(typeof oe=="function")oe(re,se,Ae,y);else{const De=Object.keys(oe)[0];Array.isArray(oe[De])?(Ae[De]={},y(re,oe[De],se,Ae[De])):Ae[De]=oe[De](re,se,Ae,y)}return se},v=(re,oe)=>(se,Ae,De,Ge)=>{oe(se,Ae,De)&&Ge(se,re,Ae,De)},r=(re=0)=>oe=>oe.data[oe.pos+re],D=re=>oe=>oe.data.subarray(oe.pos,oe.pos+=re),B=re=>oe=>oe.data.subarray(oe.pos,oe.pos+re),F=re=>oe=>Array.from(D(re)(oe)).map(se=>String.fromCharCode(se)).join(""),N=re=>oe=>{const se=D(2)(oe);return re?(se[1]<<8)+se[0]:(se[0]<<8)+se[1]},Q=(re,oe)=>(se,Ae,De)=>{const Ge=typeof oe=="function"?oe(se,Ae,De):oe,yt=D(re),ct=new Array(Ge);for(var mt=0;mt<Ge;mt++)ct[mt]=yt(se);return ct},q=re=>oe=>{const se=(Ge=>Ge.data[Ge.pos++])(oe),Ae=new Array(8);for(var De=0;De<8;De++)Ae[7-De]=!!(se&1<<De);return Object.keys(re).reduce((Ge,yt)=>{const ct=re[yt];return ct.length?Ge[yt]=((mt,et,Qe)=>{for(var vt=0,st=0;st<Qe;st++)vt+=mt[et+st]&&2**(Qe-st-1);return vt})(Ae,ct.index,ct.length):Ge[yt]=Ae[ct.index],Ge},{})};var X={blocks:re=>{const oe=[],se=re.data.length;for(var Ae=0,De=(mt=>mt.data[mt.pos++])(re);De!==0&&De;De=(mt=>mt.data[mt.pos++])(re)){if(re.pos+De>=se){const mt=se-re.pos;oe.push(D(mt)(re)),Ae+=mt;break}oe.push(D(De)(re)),Ae+=De}const Ge=new Uint8Array(Ae);for(var yt=0,ct=0;ct<oe.length;ct++)Ge.set(oe[ct],yt),yt+=oe[ct].length;return Ge}};const G=v({gce:[{codes:D(2)},{byteSize:re=>re.data[re.pos++]},{extras:q({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:N(!0)},{transparentColorIndex:re=>re.data[re.pos++]},{terminator:re=>re.data[re.pos++]}]},re=>{var oe=B(2)(re);return oe[0]===33&&oe[1]===249}),ae=v({image:[{code:re=>re.data[re.pos++]},{descriptor:[{left:N(!0)},{top:N(!0)},{width:N(!0)},{height:N(!0)},{lct:q({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},v({lct:Q(3,(re,oe,se)=>Math.pow(2,se.descriptor.lct.size+1))},(re,oe,se)=>se.descriptor.lct.exists),{data:[{minCodeSize:re=>re.data[re.pos++]},X]}]},re=>r()(re)===44),xe=v({text:[{codes:D(2)},{blockSize:re=>re.data[re.pos++]},{preData:(re,oe,se)=>D(se.text.blockSize)(re)},X]},re=>{var oe=B(2)(re);return oe[0]===33&&oe[1]===1}),Te=v({application:[{codes:D(2)},{blockSize:re=>re.data[re.pos++]},{id:(re,oe,se)=>F(se.blockSize)(re)},X]},re=>{var oe=B(2)(re);return oe[0]===33&&oe[1]===255}),fe=v({comment:[{codes:D(2)},X]},re=>{var oe=B(2)(re);return oe[0]===33&&oe[1]===254});var ne=[{header:[{signature:F(3)},{version:F(3)}]},{lsd:[{width:N(!0)},{height:N(!0)},{gct:q({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:re=>re.data[re.pos++]},{pixelAspectRatio:re=>re.data[re.pos++]}]},v({gct:Q(3,(re,oe)=>Math.pow(2,oe.lsd.gct.size+1))},(re,oe)=>oe.lsd.gct.exists),{frames:((re,oe)=>(se,Ae,De,Ge)=>{const yt=[];let ct=se.pos;for(;oe(se,Ae,De);){const mt={};if(Ge(se,re,Ae,mt),se.pos===ct)break;ct=se.pos,yt.push(mt)}return yt})([G,Te,fe,ae,xe],re=>{var oe=r()(re);return oe===33||oe===44})}],ue=function(re){var oe=new Uint8Array(re);return y({data:oe,pos:0},ne)},ye=function(re,oe,se){if(re.image){var Ae=re.image,De=Ae.descriptor.width*Ae.descriptor.height,Ge=function(ct,mt,et){var Qe,vt,st,Zt,ui,ni,Hi,Ci,Ii,Ui,xi,Yi,H,be,Be,Ee,ve=et,Ie=new Array(et),Tt=new Array(4096),qe=new Array(4096),Et=new Array(4097);for(ui=(vt=1<<(Ui=ct))+1,Qe=vt+2,Hi=-1,st=(1<<(Zt=Ui+1))-1,Ci=0;Ci<vt;Ci++)Tt[Ci]=0,qe[Ci]=Ci;for(xi=Yi=H=be=Be=Ee=0,Ii=0;Ii<ve;){if(be===0){if(Yi<Zt){xi+=mt[Ee]<<Yi,Yi+=8,Ee++;continue}if(Ci=xi&st,xi>>=Zt,Yi-=Zt,Ci>Qe||Ci==ui)break;if(Ci==vt){st=(1<<(Zt=Ui+1))-1,Qe=vt+2,Hi=-1;continue}if(Hi==-1){Et[be++]=qe[Ci],Hi=Ci,H=Ci;continue}for(ni=Ci,Ci==Qe&&(Et[be++]=H,Ci=Hi);Ci>vt;)Et[be++]=qe[Ci],Ci=Tt[Ci];H=255&qe[Ci],Et[be++]=H,Qe<4096&&(Tt[Qe]=Hi,qe[Qe]=H,!(++Qe&st)&&Qe<4096&&(Zt++,st+=Qe)),Hi=ni}be--,Ie[Be++]=Et[be],Ii++}for(Ii=Be;Ii<ve;Ii++)Ie[Ii]=0;return Ie}(Ae.data.minCodeSize,Ae.data.blocks,De);Ae.descriptor.lct.interlaced&&(Ge=function(ct,mt){for(var et=new Array(ct.length),Qe=ct.length/mt,vt=function(Ci,Ii){var Ui=ct.slice(Ii*mt,(Ii+1)*mt);et.splice.apply(et,[Ci*mt,mt].concat(Ui))},st=[0,4,2,1],Zt=[8,8,4,2],ui=0,ni=0;ni<4;ni++)for(var Hi=st[ni];Hi<Qe;Hi+=Zt[ni])vt(Hi,ui),ui++;return et}(Ge,Ae.descriptor.width));var yt={pixels:Ge,dims:{top:re.image.descriptor.top,left:re.image.descriptor.left,width:re.image.descriptor.width,height:re.image.descriptor.height}};return Ae.descriptor.lct&&Ae.descriptor.lct.exists?yt.colorTable=Ae.lct:yt.colorTable=oe,re.gce&&(yt.delay=10*(re.gce.delay||10),yt.disposalType=re.gce.extras.disposal,re.gce.extras.transparentColorGiven&&(yt.transparentIndex=re.gce.transparentColorIndex)),se&&(yt.patch=function(ct){for(var mt=ct.pixels.length,et=new Uint8ClampedArray(4*mt),Qe=0;Qe<mt;Qe++){var vt=4*Qe,st=ct.pixels[Qe],Zt=ct.colorTable[st];et[vt]=Zt[0],et[vt+1]=Zt[1],et[vt+2]=Zt[2],et[vt+3]=st!==ct.transparentIndex?255:0}return et}(yt)),yt}console.warn("gif frame does not have associated image.")},le=function(re,oe){return re.frames.filter(function(se){return se.image}).map(function(se){return ye(se,re.gct,oe)})}},function(o,u){var d;d=function(){return this}();try{d=d||new Function("return this")()}catch{typeof window=="object"&&(d=window)}o.exports=d},function(o,u,d){(function(y){d.d(u,"a",function(){return ue});var v=d(2),r=d.n(v),D=d(0),B=d.n(D),F=d(1),N=d.n(F),Q=d(3),q=d.n(Q),X=d(10),G=d(7),ae=d(4),xe=d(12),Te=function(le,re,oe,se){return new(oe||(oe=Promise))(function(Ae,De){function Ge(mt){try{ct(se.next(mt))}catch(et){De(et)}}function yt(mt){try{ct(se.throw(mt))}catch(et){De(et)}}function ct(mt){var et;mt.done?Ae(mt.value):(et=mt.value,et instanceof oe?et:new oe(function(Qe){Qe(et)})).then(Ge,yt)}ct((se=se.apply(le,re||[])).next())})},fe=X.a.Canvas;function ne(le){if(le)return new Promise(function(oe,se){if(le.slice(0,4)=="data"){var Ae=new Image;return Ae.onload=function(){oe(Ae),re(Ae)},Ae.onerror=function(){se("Image load error"),re(Ae)},void(Ae.src=le)}var De=new Image;De.setAttribute("crossOrigin","Anonymous"),De.onload=function(){oe(De)},De.onerror=function(){se("Image load error")},De.src=le});function re(oe){oe.onload=null,oe.onerror=null}}var ue=function(){function le(re){B()(this,le);var oe=Object.assign({},re);if(Object.keys(le.defaultOptions).forEach(function(se){se in oe||Object.defineProperty(oe,se,{value:le.defaultOptions[se],enumerable:!0,writable:!0})}),oe.components?r()(oe.components)==="object"&&Object.keys(le.defaultComponentOptions).forEach(function(se){se in oe.components?Object.defineProperty(oe.components,se,{value:Object.assign(Object.assign({},le.defaultComponentOptions[se]),oe.components[se]),enumerable:!0,writable:!0}):Object.defineProperty(oe.components,se,{value:le.defaultComponentOptions[se],enumerable:!0,writable:!0})}):oe.components=le.defaultComponentOptions,oe.dotScale!==null&&oe.dotScale!==void 0){if(oe.dotScale<=0||oe.dotScale>1)throw new Error("dotScale should be in range (0, 1].");oe.components.data.scale=oe.dotScale,oe.components.timing.scale=oe.dotScale,oe.components.alignment.scale=oe.dotScale}this.options=oe,this.canvas=new fe(re.size,re.size),this.canvasContext=this.canvas.getContext("2d"),this.qrCode=new ae.a(-1,this.options.correctLevel),Number.isInteger(this.options.maskPattern)&&(this.qrCode.maskPattern=this.options.maskPattern),Number.isInteger(this.options.version)&&(this.qrCode.typeNumber=this.options.version),this.qrCode.addData(this.options.text),this.qrCode.make()}return N()(le,[{key:"draw",value:function(){var re=this;return new Promise(function(oe){return re._draw().then(oe)})}},{key:"_clear",value:function(){this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:"_draw",value:function(){var re,oe,se,Ae,De,Ge,yt,ct,mt,et,Qe,vt,st,Zt,ui,ni,Hi,Ci,Ii;return Te(this,void 0,void 0,q.a.mark(function Ui(){var xi,Yi,H,be,Be,Ee,ve,Ie,Tt,qe,Et,It,$t,Kt,ti,Li,Ut,yi,zi,Ni,Ki,sr,Rr,Yr,kr,yr,nn,Ts,Ar,Ur,Vi,Zi,Rn,tr,Yn,xn,$n,Dn,Hs,Rs,vr,or,lr,Pi,br,ir,Ji,gn,ot,ee,de,we,ze,Le,Ze,rt,We,pt,lt,dt,St,qt,Ht,li,pi,bi,Mi,dr,fr,Gi,_r,wr;return q.a.wrap(function(ki){for(;;)switch(ki.prev=ki.next){case 0:if(xi=(re=this.qrCode)===null||re===void 0?void 0:re.moduleCount,Yi=this.options.size,((H=this.options.margin)<0||2*H>=Yi)&&(H=0),be=Math.ceil(H),Be=Yi-2*H,Ee=this.options.whiteMargin,ve=this.options.backgroundDimming,Ie=Math.ceil(Be/xi),Et=new fe(qe=(Tt=Ie*xi)+2*be,qe),It=Et.getContext("2d"),this._clear(),It.save(),It.translate(be,be),$t=new fe(qe,qe),Kt=$t.getContext("2d"),ti=null,Li=[],!this.options.gifBackground){ki.next=47;break}if(Ut=Object(G.b)(this.options.gifBackground),ti=Ut,Li=Object(G.a)(Ut,!0),!this.options.autoColor){ki.next=45;break}yi=0,zi=0,Ni=0,Ki=0,sr=0;case 28:if(!(sr<Li[0].colorTable.length)){ki.next=41;break}if(!((Rr=Li[0].colorTable[sr])[0]>200||Rr[1]>200||Rr[2]>200)){ki.next=32;break}return ki.abrupt("continue",38);case 32:if(Rr[0]!==0||Rr[1]!==0||Rr[2]!==0){ki.next=34;break}return ki.abrupt("continue",38);case 34:Ki++,yi+=Rr[0],zi+=Rr[1],Ni+=Rr[2];case 38:sr++,ki.next=28;break;case 41:yi=~~(yi/Ki),zi=~~(zi/Ki),Ni=~~(Ni/Ki),this.options.colorDark="rgb(".concat(yi,",").concat(zi,",").concat(Ni,")");case 45:ki.next=61;break;case 47:if(!this.options.backgroundImage){ki.next=58;break}return ki.next=50,ne(this.options.backgroundImage);case 50:Yr=ki.sent,this.options.autoColor&&(kr=le._getAverageRGB(Yr),this.options.colorDark="rgb(".concat(kr.r,",").concat(kr.g,",").concat(kr.b,")")),Kt.drawImage(Yr,0,0,Yr.width,Yr.height,0,0,qe,qe),Kt.rect(0,0,qe,qe),Kt.fillStyle=ve,Kt.fill(),ki.next=61;break;case 58:Kt.rect(0,0,qe,qe),Kt.fillStyle=this.options.colorLight,Kt.fill();case 61:for(yr=ae.c.getPatternPosition(this.qrCode.typeNumber),nn=((se=(oe=this.options.components)===null||oe===void 0?void 0:oe.data)===null||se===void 0?void 0:se.scale)||.4,Ts=.5*(1-nn),Ar=0;Ar<xi;Ar++)for(Ur=0;Ur<xi;Ur++){for(Vi=this.qrCode.isDark(Ar,Ur),Zi=Ar==6&&Ur>=8&&Ur<=xi-8||Ur==6&&Ar>=8&&Ar<=xi-8,Rn=Ur<8&&(Ar<8||Ar>=xi-8)||Ur>=xi-8&&Ar<8||Zi,tr=1;tr<yr.length-1;tr++)Rn=Rn||Ar>=yr[tr]-2&&Ar<=yr[tr]+2&&Ur>=yr[tr]-2&&Ur<=yr[tr]+2;Yn=Ur*Ie+(Rn?0:Ts*Ie),xn=Ar*Ie+(Rn?0:Ts*Ie),It.strokeStyle=Vi?this.options.colorDark:this.options.colorLight,It.lineWidth=.5,It.fillStyle=Vi?this.options.colorDark:this.options.colorLight,yr.length===0?Rn||It.fillRect(Yn,xn,(Rn?1:nn)*Ie,(Rn?1:nn)*Ie):($n=Ur<xi-4&&Ur>=xi-4-5&&Ar<xi-4&&Ar>=xi-4-5,Rn||$n||It.fillRect(Yn,xn,(Rn?1:nn)*Ie,(Rn?1:nn)*Ie))}if(Dn=yr[yr.length-1],Hs=this.options.colorLight,It.fillStyle=Hs,It.fillRect(0,0,8*Ie,8*Ie),It.fillRect(0,(xi-8)*Ie,8*Ie,8*Ie),It.fillRect((xi-8)*Ie,0,8*Ie,8*Ie),!((De=(Ae=this.options.components)===null||Ae===void 0?void 0:Ae.timing)===null||De===void 0)&&De.protectors&&(It.fillRect(8*Ie,6*Ie,(xi-8-8)*Ie,Ie),It.fillRect(6*Ie,8*Ie,Ie,(xi-8-8)*Ie)),!((yt=(Ge=this.options.components)===null||Ge===void 0?void 0:Ge.cornerAlignment)===null||yt===void 0)&&yt.protectors&&le._drawAlignProtector(It,Dn,Dn,Ie),!(!((mt=(ct=this.options.components)===null||ct===void 0?void 0:ct.alignment)===null||mt===void 0)&&mt.protectors)){ki.next=99;break}Rs=0;case 75:if(!(Rs<yr.length)){ki.next=99;break}vr=0;case 77:if(!(vr<yr.length)){ki.next=96;break}if(or=yr[vr],lr=yr[Rs],or!==6||lr!==6&&lr!==Dn){ki.next=84;break}return ki.abrupt("continue",93);case 84:if(lr!==6||or!==6&&or!==Dn){ki.next=88;break}return ki.abrupt("continue",93);case 88:if(or!==Dn||lr!==Dn){ki.next=92;break}return ki.abrupt("continue",93);case 92:le._drawAlignProtector(It,or,lr,Ie);case 93:vr++,ki.next=77;break;case 96:Rs++,ki.next=75;break;case 99:for(It.fillStyle=this.options.colorDark,It.fillRect(0,0,7*Ie,Ie),It.fillRect((xi-7)*Ie,0,7*Ie,Ie),It.fillRect(0,6*Ie,7*Ie,Ie),It.fillRect((xi-7)*Ie,6*Ie,7*Ie,Ie),It.fillRect(0,(xi-7)*Ie,7*Ie,Ie),It.fillRect(0,(xi-7+6)*Ie,7*Ie,Ie),It.fillRect(0,0,Ie,7*Ie),It.fillRect(6*Ie,0,Ie,7*Ie),It.fillRect((xi-7)*Ie,0,Ie,7*Ie),It.fillRect((xi-7+6)*Ie,0,Ie,7*Ie),It.fillRect(0,(xi-7)*Ie,Ie,7*Ie),It.fillRect(6*Ie,(xi-7)*Ie,Ie,7*Ie),It.fillRect(2*Ie,2*Ie,3*Ie,3*Ie),It.fillRect((xi-7+2)*Ie,2*Ie,3*Ie,3*Ie),It.fillRect(2*Ie,(xi-7+2)*Ie,3*Ie,3*Ie),Pi=((Qe=(et=this.options.components)===null||et===void 0?void 0:et.timing)===null||Qe===void 0?void 0:Qe.scale)||.4,br=.5*(1-Pi),ir=0;ir<xi-8;ir+=2)le._drawDot(It,8+ir,6,Ie,br,Pi),le._drawDot(It,6,8+ir,Ie,br,Pi);Ji=((st=(vt=this.options.components)===null||vt===void 0?void 0:vt.cornerAlignment)===null||st===void 0?void 0:st.scale)||.4,gn=.5*(1-Ji),le._drawAlign(It,Dn,Dn,Ie,gn,Ji,this.options.colorDark,((ui=(Zt=this.options.components)===null||Zt===void 0?void 0:Zt.cornerAlignment)===null||ui===void 0?void 0:ui.protectors)||!1),ot=((Hi=(ni=this.options.components)===null||ni===void 0?void 0:ni.alignment)===null||Hi===void 0?void 0:Hi.scale)||.4,ee=.5*(1-ot),de=0;case 124:if(!(de<yr.length)){ki.next=148;break}we=0;case 126:if(!(we<yr.length)){ki.next=145;break}if(ze=yr[we],Le=yr[de],ze!==6||Le!==6&&Le!==Dn){ki.next=133;break}return ki.abrupt("continue",142);case 133:if(Le!==6||ze!==6&&ze!==Dn){ki.next=137;break}return ki.abrupt("continue",142);case 137:if(ze!==Dn||Le!==Dn){ki.next=141;break}return ki.abrupt("continue",142);case 141:le._drawAlign(It,ze,Le,Ie,ee,ot,this.options.colorDark,((Ii=(Ci=this.options.components)===null||Ci===void 0?void 0:Ci.alignment)===null||Ii===void 0?void 0:Ii.protectors)||!1);case 142:we++,ki.next=126;break;case 145:de++,ki.next=124;break;case 148:if(Ee&&(It.fillStyle=this.options.backgroundColor,It.fillRect(-be,-be,qe,be),It.fillRect(-be,Tt,qe,be),It.fillRect(Tt,-be,be,qe),It.fillRect(-be,-be,be,qe)),!this.options.logoImage){ki.next=179;break}return ki.next=152,ne(this.options.logoImage);case 152:Ze=ki.sent,rt=this.options.logoScale,We=this.options.logoMargin,pt=this.options.logoCornerRadius,(rt<=0||rt>=1)&&(rt=.2),We<0&&(We=0),pt<0&&(pt=0),St=dt=.5*(qe-(lt=Tt*rt)),It.restore(),It.fillStyle=this.options.logoBackgroundColor,It.save(),le._prepareRoundedCornerClip(It,dt-We,St-We,lt+2*We,lt+2*We,pt+We),It.clip(),qt=It.globalCompositeOperation,It.globalCompositeOperation="destination-out",It.fill(),It.globalCompositeOperation=qt,It.restore(),It.save(),le._prepareRoundedCornerClip(It,dt,St,lt,lt,pt),It.clip(),It.drawImage(Ze,dt,St,lt,lt),It.restore(),It.save(),It.translate(be,be);case 179:if(!ti){ki.next=191;break}if(Li.forEach(function(Vs){Ht||((Ht=new xe.a(Yi,Yi)).setDelay(Vs.delay),Ht.setRepeat(0));var An=Vs.dims,On=An.width,_s=An.height;li||(li=new fe(On,_s),(pi=li.getContext("2d")).rect(0,0,li.width,li.height),pi.fillStyle="#ffffff",pi.fill()),bi&&dr&&On===bi.width&&_s===bi.height||(bi=new fe(On,_s),Mi=bi.getContext("2d"),dr=Mi.createImageData(On,_s)),dr.data.set(Vs.patch),Mi.putImageData(dr,0,0),pi.drawImage(bi.getContext("2d").canvas,Vs.dims.left,Vs.dims.top);var ra=new fe(qe,qe),io=ra.getContext("2d");io.drawImage(li.getContext("2d").canvas,0,0,qe,qe),io.rect(0,0,qe,qe),io.fillStyle=ve,io.fill(),io.drawImage(Et.getContext("2d").canvas,0,0,qe,qe);var Cn=new fe(Yi,Yi),Rc=Cn.getContext("2d");Rc.drawImage(ra.getContext("2d").canvas,0,0,Yi,Yi),Ht.addFrame(Rc.getImageData(0,0,Cn.width,Cn.height).data)}),Ht){ki.next=183;break}throw new Error("No frames.");case 183:if(Ht.finish(),!ye(this.canvas)){ki.next=188;break}return fr=Ht.stream().toFlattenUint8Array(),Gi=fr.reduce(function(Vs,An){return Vs+String.fromCharCode(An)},""),ki.abrupt("return",Promise.resolve("data:image/gif;base64,".concat(window.btoa(Gi))));case 188:return ki.abrupt("return",Promise.resolve(y.from(Ht.stream().toFlattenUint8Array())));case 191:if(Kt.drawImage(Et.getContext("2d").canvas,0,0,qe,qe),It.drawImage($t.getContext("2d").canvas,-be,-be,qe,qe),_r=new fe(Yi,Yi),_r.getContext("2d").drawImage(Et.getContext("2d").canvas,0,0,Yi,Yi),this.canvas=_r,wr=this.options.gifBackground?"gif":"png",!ye(this.canvas)){ki.next=200;break}return ki.abrupt("return",Promise.resolve(this.canvas.toDataURL(wr)));case 200:return ki.abrupt("return",Promise.resolve(this.canvas.toBuffer(wr)));case 201:case"end":return ki.stop()}},Ui,this)}))}}],[{key:"_prepareRoundedCornerClip",value:function(re,oe,se,Ae,De,Ge){re.beginPath(),re.moveTo(oe,se),re.arcTo(oe+Ae,se,oe+Ae,se+De,Ge),re.arcTo(oe+Ae,se+De,oe,se+De,Ge),re.arcTo(oe,se+De,oe,se,Ge),re.arcTo(oe,se,oe+Ae,se,Ge),re.closePath()}},{key:"_getAverageRGB",value:function(re){var oe,se,Ae={r:0,g:0,b:0},De=-4,Ge={r:0,g:0,b:0},yt=0;se=re.naturalHeight||re.height,oe=re.naturalWidth||re.width;var ct,mt=new fe(oe,se).getContext("2d");if(!mt)return Ae;mt.drawImage(re,0,0);try{ct=mt.getImageData(0,0,oe,se)}catch{return Ae}for(;(De+=20)<ct.data.length;)ct.data[De]>200||ct.data[De+1]>200||ct.data[De+2]>200||(++yt,Ge.r+=ct.data[De],Ge.g+=ct.data[De+1],Ge.b+=ct.data[De+2]);return Ge.r=~~(Ge.r/yt),Ge.g=~~(Ge.g/yt),Ge.b=~~(Ge.b/yt),Ge}},{key:"_drawDot",value:function(re,oe,se,Ae){var De=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,Ge=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1;re.fillRect((oe+De)*Ae,(se+De)*Ae,Ge*Ae,Ge*Ae)}},{key:"_drawAlignProtector",value:function(re,oe,se,Ae){re.clearRect((oe-2)*Ae,(se-2)*Ae,5*Ae,5*Ae),re.fillRect((oe-2)*Ae,(se-2)*Ae,5*Ae,5*Ae)}},{key:"_drawAlign",value:function(re,oe,se,Ae){var De=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,Ge=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,yt=arguments.length>6?arguments[6]:void 0,ct=arguments.length>7?arguments[7]:void 0,mt=re.fillStyle;re.fillStyle=yt,new Array(4).fill(0).map(function(et,Qe){le._drawDot(re,oe-2+Qe,se-2,Ae,De,Ge),le._drawDot(re,oe+2,se-2+Qe,Ae,De,Ge),le._drawDot(re,oe+2-Qe,se+2,Ae,De,Ge),le._drawDot(re,oe-2,se+2-Qe,Ae,De,Ge)}),le._drawDot(re,oe,se,Ae,De,Ge),ct||(re.fillStyle="rgba(255, 255, 255, 0.6)",new Array(2).fill(0).map(function(et,Qe){le._drawDot(re,oe-1+Qe,se-1,Ae,De,Ge),le._drawDot(re,oe+1,se-1+Qe,Ae,De,Ge),le._drawDot(re,oe+1-Qe,se+1,Ae,De,Ge),le._drawDot(re,oe-1,se+1-Qe,Ae,De,Ge)})),re.fillStyle=mt}}]),le}();function ye(le){try{return le instanceof HTMLElement}catch{return r()(le)==="object"&&le.nodeType===1&&r()(le.style)==="object"&&r()(le.ownerDocument)==="object"}}ue.CorrectLevel=ae.b,ue.defaultComponentOptions={data:{scale:.4},timing:{scale:.5,protectors:!1},alignment:{scale:.5,protectors:!1},cornerAlignment:{scale:.5,protectors:!0}},ue.defaultOptions={text:"",size:400,margin:20,colorDark:"#000000",colorLight:"rgba(255, 255, 255, 0.6)",correctLevel:ae.b.M,backgroundImage:void 0,backgroundDimming:"rgba(0,0,0,0)",logoImage:void 0,logoScale:.2,logoMargin:4,logoCornerRadius:8,whiteMargin:!0,components:ue.defaultComponentOptions,autoColor:!0,logoBackgroundColor:"#ffffff",backgroundColor:"#ffffff"}}).call(this,d(15).Buffer)},function(o,u,d){var y=d(11);const{asBuffer:v,asDownload:r,asZipDownload:D,atScale:B,options:F}=y.a,N=Symbol.for("toDataURL"),{CanvasRenderingContext2D:Q,CanvasGradient:q,CanvasPattern:X,Image:G,ImageData:ae,Path2D:xe,DOMMatrix:Te,DOMRect:fe,DOMPoint:ne}=window,ue={Canvas:class{constructor(ye,le){let re=document.createElement("canvas"),oe=[];for(var[se,Ae]of(Object.defineProperty(re,"async",{value:!0,writable:!1,enumerable:!0}),Object.entries({png:()=>v(re,"image/png"),jpg:()=>v(re,"image/jpeg"),pages:()=>oe.concat(re).map(De=>De.getContext("2d"))})))Object.defineProperty(re,se,{get:Ae});return Object.assign(re,{width:ye,height:le,newPage(...De){var{width:yt,height:ct}=re,Ge=Object.assign(document.createElement("canvas"),{width:yt,height:ct});Ge.getContext("2d").drawImage(re,0,0),oe.push(Ge);var[yt,ct]=De.length?De:[yt,ct];return Object.assign(re,{width:yt,height:ct}).getContext("2d")},saveAs(De,Ge){Ge=typeof Ge=="number"?{quality:Ge}:Ge;let yt=F(this.pages,{filename:De,...Ge}),{pattern:ct,padding:mt,mime:et,quality:Qe,matte:vt,density:st,archive:Zt}=yt,ui=B(yt.pages,st);return mt==null?r(ui[0],et,Qe,vt,De):D(ui,et,Qe,vt,Zt,ct,mt)},toBuffer(De="png",Ge={}){Ge=typeof Ge=="number"?{quality:Ge}:Ge;let yt=F(this.pages,{extension:De,...Ge}),{mime:ct,quality:mt,matte:et,pages:Qe,density:vt}=yt,st=B(Qe,vt,et)[0];return v(st,ct,mt,et)},[N]:re.toDataURL.bind(re),toDataURL(De="png",Ge={}){Ge=typeof Ge=="number"?{quality:Ge}:Ge;let yt=F(this.pages,{extension:De,...Ge}),{mime:ct,quality:mt,matte:et,pages:Qe,density:vt}=yt,st=B(Qe,vt,et)[0],Zt=st[st===re?N:"toDataURL"](ct,mt);return Promise.resolve(Zt)}})}},loadImage:ye=>new Promise((le,re)=>Object.assign(new G,{crossOrigin:"Anonymous",onload:le,onerror:re,src:ye})),CanvasRenderingContext2D:Q,CanvasGradient:q,CanvasPattern:X,Image:G,ImageData:ae,Path2D:xe,DOMMatrix:Te,DOMRect:fe,DOMPoint:ne};u.a=ue},function(o,u,d){(function(y){var v=d(5);class r{constructor(){let G=y===void 0,ae="image/png",xe="image/jpeg",Te="application/pdf",fe="image/svg+xml";Object.assign(this,{toMime:this.toMime.bind(this),fromMime:this.fromMime.bind(this),expected:G?'"png", "jpg", or "webp"':'"png", "jpg", "pdf", or "svg"',formats:G?{png:ae,jpg:xe,jpeg:"image/jpeg",webp:"image/webp"}:{png:ae,jpg:xe,jpeg:"image/jpeg",pdf:Te,svg:fe},mimes:G?{[ae]:"png",[xe]:"jpg","image/webp":"webp"}:{[ae]:"png",[xe]:"jpg",[Te]:"pdf",[fe]:"svg"}})}toMime(G){return this.formats[(G||"").replace(/^\./,"").toLowerCase()]}fromMime(G){return this.mimes[G]}}class D{static for(G){return new D().append(G).get()}constructor(){this.crc=-1}get(){return~this.crc}append(G){for(var ae=0|this.crc,xe=this.table,Te=0,fe=0|G.length;Te<fe;Te++)ae=ae>>>8^xe[255&(ae^G[Te])];return this.crc=ae,this}}function B(X){let G=new Uint8Array(X),ae=new DataView(G.buffer),xe={array:G,view:ae,size:X,set8:(Te,fe)=>(ae.setUint8(Te,fe),xe),set16:(Te,fe)=>(ae.setUint16(Te,fe,!0),xe),set32:(Te,fe)=>(ae.setUint32(Te,fe,!0),xe),bytes:(Te,fe)=>(G.set(fe,Te),xe)};return xe}D.prototype.table=(()=>{var X,G,ae,xe=[];for(X=0;X<256;X++){for(ae=X,G=0;G<8;G++)ae=1&ae?ae>>>1^3988292384:ae>>>1;xe[X]=ae}return xe})();class F{constructor(G){let ae=new Date;Object.assign(this,{directory:G,offset:0,files:[],time:(ae.getHours()<<6|ae.getMinutes())<<5|ae.getSeconds()/2,date:(ae.getFullYear()-1980<<4|ae.getMonth()+1)<<5|ae.getDate()}),this.add(G)}async add(G,ae){let xe=!ae,Te=F.encoder.encode(`${this.directory}/${xe?"":G}`),fe=new Uint8Array(xe?0:await ae.arrayBuffer()),ne=30+Te.length,ue=ne+fe.length,{offset:ye}=this,le=B(26).set32(0,134742036).set16(6,this.time).set16(8,this.date).set32(10,D.for(fe)).set32(14,fe.length).set32(18,fe.length).set16(22,Te.length);ye+=ne;let re=B(ne+fe.length+16).set32(0,67324752).bytes(4,le.array).bytes(30,Te).bytes(ne,fe);ye+=fe.length,re.set32(ue,134695760).bytes(ue+4,le.array.slice(10,22)),ye+=16,this.files.push({offset:ye,folder:xe,name:Te,header:le,payload:re}),this.offset=ye}toBuffer(){let G=this.files.reduce((oe,{name:se})=>46+se.length+oe,0),ae=B(G+22),xe=0;for(var{offset:Te,name:fe,header:ne,folder:ue}of this.files)ae.set32(xe,33639248).set16(xe+4,20).bytes(xe+6,ne.array).set8(xe+38,ue?16:0).set32(xe+42,Te).bytes(xe+46,fe),xe+=46+fe.length;ae.set32(xe,101010256).set16(xe+8,this.files.length).set16(xe+10,this.files.length).set32(xe+12,G).set32(xe+16,this.offset);let ye=new Uint8Array(this.offset+ae.size),le=0;for(var{payload:re}of this.files)ye.set(re.array,le),le+=re.size;return ye.set(ae.array,le),ye}get blob(){return new Blob([this.toBuffer()],{type:"application/zip"})}}F.encoder=new TextEncoder;const N=(X,G,ae,xe)=>{if(xe){let{width:Te,height:fe}=X,ne=Object.assign(document.createElement("canvas"),{width:Te,height:fe}),ue=ne.getContext("2d");ue.fillStyle=xe,ue.fillRect(0,0,Te,fe),ue.drawImage(X,0,0),X=ne}return new Promise((Te,fe)=>X.toBlob(Te,G,ae))},Q=(X,G)=>{const ae=window.URL.createObjectURL(G),xe=document.createElement("a");xe.style.display="none",xe.href=ae,xe.setAttribute("download",X),xe.download===void 0&&xe.setAttribute("target","_blank"),document.body.appendChild(xe),xe.click(),document.body.removeChild(xe),setTimeout(()=>window.URL.revokeObjectURL(ae),100)},q={asBuffer:(...X)=>N(...X).then(G=>G.arrayBuffer()),asDownload:async(X,G,ae,xe,Te)=>{Q(Te,await N(X,G,ae,xe))},asZipDownload:async(X,G,ae,xe,Te,fe,ne)=>{let ue=Object(v.a)(Te,".zip")||"archive",ye=new F(ue);await Promise.all(X.map(async(le,re)=>{let oe=(se=>fe.replace("{}",String(se+1).padStart(ne,"0")))(re);await ye.add(oe,await N(le,G,ae,xe))})),Q(ue+".zip",ye.blob)},atScale:(X,G,ae)=>X.map(xe=>{if(G==1&&!ae)return xe.canvas;let Te=document.createElement("canvas"),fe=Te.getContext("2d"),ne=xe.canvas?xe.canvas:xe;return Te.width=ne.width*G,Te.height=ne.height*G,ae&&(fe.fillStyle=ae,fe.fillRect(0,0,Te.width,Te.height)),fe.scale(G,G),fe.drawImage(ne,0,0),Te}),options:function(X,{filename:G="",extension:ae="",format:xe,page:Te,quality:fe,matte:ne,density:ue,outline:ye,archive:le}={}){var{fromMime:re,toMime:oe,expected:se}=new r,Ae=(le=le||"canvas",xe||ae.replace(/@\d+x$/i,"")||Object(v.b)(G)),De=(xe=re(oe(Ae)||Ae),oe(xe)),Ge=X.length;if(!Ae)throw new Error("Cannot determine image format (use a filename extension or 'format' argument)");if(!xe)throw new Error(`Unsupported file format "${Ae}" (expected ${se})`);if(!Ge)throw new RangeError("Canvas has no associated contexts (try calling getContext or newPage first)");let yt,ct,mt=G.replace(/{(\d*)}/g,(Qe,vt)=>(ct=!0,vt=parseInt(vt,10),yt=isFinite(vt)?vt:isFinite(yt)?yt:-1,"{}")),et=Te>0?Te-1:Te<0?Ge+Te:void 0;if(isFinite(et)&&et<0||et>=Ge)throw new RangeError(Ge==1?`Canvas only has a ‘page 1’ (${et} is out of bounds)`:`Canvas has pages 1–${Ge} (${et} is out of bounds)`);if(X=isFinite(et)?[X[et]]:ct||xe=="pdf"?X:X.slice(-1),fe===void 0)fe=.92;else if(typeof fe!="number"||!isFinite(fe)||fe<0||fe>1)throw new TypeError("The quality option must be an number in the 0.0–1.0 range");if(ue===void 0){let Qe=(ae||Object(v.a)(G,Ae)).match(/@(\d+)x$/i);ue=Qe?parseInt(Qe[1],10):1}else if(typeof ue!="number"||!Number.isInteger(ue)||ue<1)throw new TypeError("The density option must be a non-negative integer");return ye===void 0?ye=!0:xe=="svg"&&(ye=!!ye),{filename:G,pattern:mt,format:xe,mime:De,pages:X,padding:yt,quality:fe,matte:ne,density:ue,outline:ye,archive:le}}};u.a=q}).call(this,d(8))},function(o,u,d){var y=function(N,Q){var q,X,G,ae,xe;function Te(ue,ye,le,re,oe){q[ye][0]-=ue*(q[ye][0]-le)/1024,q[ye][1]-=ue*(q[ye][1]-re)/1024,q[ye][2]-=ue*(q[ye][2]-oe)/1024}function fe(ue,ye,le,re,oe){for(var se,Ae,De=Math.abs(ye-ue),Ge=Math.min(ye+ue,256),yt=ye+1,ct=ye-1,mt=1;yt<Ge||ct>De;)Ae=xe[mt++],yt<Ge&&((se=q[yt++])[0]-=Ae*(se[0]-le)/262144,se[1]-=Ae*(se[1]-re)/262144,se[2]-=Ae*(se[2]-oe)/262144),ct>De&&((se=q[ct--])[0]-=Ae*(se[0]-le)/262144,se[1]-=Ae*(se[1]-re)/262144,se[2]-=Ae*(se[2]-oe)/262144)}function ne(ue,ye,le){var re,oe,se,Ae,De,Ge=2147483647,yt=Ge,ct=-1,mt=ct;for(re=0;re<256;re++)oe=q[re],(se=Math.abs(oe[0]-ue)+Math.abs(oe[1]-ye)+Math.abs(oe[2]-le))<Ge&&(Ge=se,ct=re),(Ae=se-(G[re]>>12))<yt&&(yt=Ae,mt=re),De=ae[re]>>10,ae[re]-=De,G[re]+=De<<10;return ae[ct]+=64,G[ct]-=65536,mt}this.buildColormap=function(){(function(){var ue,ye;for(q=[],X=new Int32Array(256),G=new Int32Array(256),ae=new Int32Array(256),xe=new Int32Array(32),ue=0;ue<256;ue++)ye=(ue<<12)/256,q[ue]=new Float64Array([ye,ye,ye,0]),ae[ue]=256,G[ue]=0})(),function(){var ue,ye,le,re,oe,se,Ae=N.length,De=30+(Q-1)/3,Ge=Ae/(3*Q),yt=~~(Ge/100),ct=1024,mt=2048,et=mt>>6;for(et<=1&&(et=0),ue=0;ue<et;ue++)xe[ue]=ct*(256*(et*et-ue*ue)/(et*et));Ae<1509?(Q=1,ye=3):ye=Ae%499!=0?1497:Ae%491!=0?1473:Ae%487!=0?1461:1509;var Qe=0;for(ue=0;ue<Ge;)if(Te(ct,se=ne(le=(255&N[Qe])<<4,re=(255&N[Qe+1])<<4,oe=(255&N[Qe+2])<<4),le,re,oe),et!==0&&fe(et,se,le,re,oe),(Qe+=ye)>=Ae&&(Qe-=Ae),yt===0&&(yt=1),++ue%yt==0)for(ct-=ct/De,(et=(mt-=mt/30)>>6)<=1&&(et=0),se=0;se<et;se++)xe[se]=ct*(256*(et*et-se*se)/(et*et))}(),function(){for(var ue=0;ue<256;ue++)q[ue][0]>>=4,q[ue][1]>>=4,q[ue][2]>>=4,q[ue][3]=ue}(),function(){var ue,ye,le,re,oe,se,Ae=0,De=0;for(ue=0;ue<256;ue++){for(oe=ue,se=(le=q[ue])[1],ye=ue+1;ye<256;ye++)(re=q[ye])[1]<se&&(oe=ye,se=re[1]);if(re=q[oe],ue!=oe&&(ye=re[0],re[0]=le[0],le[0]=ye,ye=re[1],re[1]=le[1],le[1]=ye,ye=re[2],re[2]=le[2],le[2]=ye,ye=re[3],re[3]=le[3],le[3]=ye),se!=Ae){for(X[Ae]=De+ue>>1,ye=Ae+1;ye<se;ye++)X[ye]=ue;Ae=se,De=ue}}for(X[Ae]=De+255>>1,ye=Ae+1;ye<256;ye++)X[ye]=255}()},this.getColormap=function(){for(var ue=[],ye=[],le=0;le<256;le++)ye[q[le][3]]=le;for(var re=0,oe=0;oe<256;oe++){var se=ye[oe];ue[re++]=q[se][0],ue[re++]=q[se][1],ue[re++]=q[se][2]}return ue},this.lookupRGB=function(ue,ye,le){for(var re,oe,se,Ae=1e3,De=-1,Ge=X[ye],yt=Ge-1;Ge<256||yt>=0;)Ge<256&&((se=(oe=q[Ge])[1]-ye)>=Ae?Ge=256:(Ge++,se<0&&(se=-se),(re=oe[0]-ue)<0&&(re=-re),(se+=re)<Ae&&((re=oe[2]-le)<0&&(re=-re),(se+=re)<Ae&&(Ae=se,De=oe[3])))),yt>=0&&((se=ye-(oe=q[yt])[1])>=Ae?yt=-1:(yt--,se<0&&(se=-se),(re=oe[0]-ue)<0&&(re=-re),(se+=re)<Ae&&((re=oe[2]-le)<0&&(re=-re),(se+=re)<Ae&&(Ae=se,De=oe[3]))));return De}},v=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],r=function(N,Q,q,X){var G,ae,xe,Te,fe,ne,ue,ye,le,re=Math.max(2,X),oe=new Uint8Array(256),se=new Int32Array(5003),Ae=new Int32Array(5003),De=0,Ge=0,yt=!1;function ct(ui,ni){oe[ae++]=ui,ae>=254&&Qe(ni)}function mt(ui){et(5003),Ge=fe+2,yt=!0,Zt(fe,ui)}function et(ui){for(var ni=0;ni<ui;++ni)se[ni]=-1}function Qe(ui){ae>0&&(ui.writeByte(ae),ui.writeBytes(oe,0,ae),ae=0)}function vt(ui){return(1<<ui)-1}function st(){return ue===0?-1:(--ue,255&q[ye++])}function Zt(ui,ni){for(G&=v[De],De>0?G|=ui<<De:G=ui,De+=le;De>=8;)ct(255&G,ni),G>>=8,De-=8;if((Ge>xe||yt)&&(yt?(xe=vt(le=Te),yt=!1):(++le,xe=le==12?4096:vt(le))),ui==ne){for(;De>0;)ct(255&G,ni),G>>=8,De-=8;Qe(ni)}}this.encode=function(ui){ui.writeByte(re),ue=N*Q,ye=0,function(ni,Hi){var Ci,Ii,Ui,xi,Yi,H;for(yt=!1,xe=vt(le=Te=ni),ne=(fe=1<<ni-1)+1,Ge=fe+2,ae=0,xi=st(),H=0,Ci=5003;Ci<65536;Ci*=2)++H;H=8-H,et(5003),Zt(fe,Hi);e:for(;(Ii=st())!=-1;)if(Ci=(Ii<<12)+xi,se[Ui=Ii<<H^xi]!==Ci){if(se[Ui]>=0){Yi=5003-Ui,Ui===0&&(Yi=1);do if((Ui-=Yi)<0&&(Ui+=5003),se[Ui]===Ci){xi=Ae[Ui];continue e}while(se[Ui]>=0)}Zt(xi,Hi),xi=Ii,Ge<4096?(Ae[Ui]=Ge++,se[Ui]=Ci):mt(Hi)}else xi=Ae[Ui];Zt(xi,Hi),Zt(ne,Hi)}(re+1,ui),ui.writeByte(0)}};function D(){this.page=-1,this.pages=[],this.newPage()}D.pageSize=4096,D.charMap={};for(var B=0;B<256;B++)D.charMap[B]=String.fromCharCode(B);function F(N,Q){this.width=~~N,this.height=~~Q,this.transparent=null,this.transIndex=0,this.repeat=-1,this.delay=0,this.image=null,this.pixels=null,this.indexedPixels=null,this.colorDepth=null,this.colorTab=null,this.neuQuant=null,this.usedEntry=new Array,this.palSize=7,this.dispose=-1,this.firstFrame=!0,this.sample=10,this.dither=!1,this.globalPalette=!1,this.out=new D}D.prototype.newPage=function(){this.pages[++this.page]=new Uint8Array(D.pageSize),this.cursor=0},D.prototype.getData=function(){for(var N="",Q=0;Q<this.pages.length;Q++)for(var q=0;q<D.pageSize;q++)N+=D.charMap[this.pages[Q][q]];return N},D.prototype.toFlattenUint8Array=function(){for(var N=[],Q=0;Q<this.pages.length;Q++)if(Q===this.pages.length-1){var q=Uint8Array.from(this.pages[Q].slice(0,this.cursor));N.push(q)}else N.push(this.pages[Q]);var X=new Uint8Array(N.reduce(function(G,ae){return G+ae.length},0));return N.reduce(function(G,ae){return X.set(ae,G),G+ae.length},0),X},D.prototype.writeByte=function(N){this.cursor>=D.pageSize&&this.newPage(),this.pages[this.page][this.cursor++]=N},D.prototype.writeUTFBytes=function(N){for(var Q=N.length,q=0;q<Q;q++)this.writeByte(N.charCodeAt(q))},D.prototype.writeBytes=function(N,Q,q){for(var X=q||N.length,G=Q||0;G<X;G++)this.writeByte(N[G])},F.prototype.setDelay=function(N){this.delay=Math.round(N/10)},F.prototype.setFrameRate=function(N){this.delay=Math.round(100/N)},F.prototype.setDispose=function(N){N>=0&&(this.dispose=N)},F.prototype.setRepeat=function(N){this.repeat=N},F.prototype.setTransparent=function(N){this.transparent=N},F.prototype.addFrame=function(N){this.image=N,this.colorTab=this.globalPalette&&this.globalPalette.slice?this.globalPalette:null,this.getImagePixels(),this.analyzePixels(),this.globalPalette===!0&&(this.globalPalette=this.colorTab),this.firstFrame&&(this.writeHeader(),this.writeLSD(),this.writePalette(),this.repeat>=0&&this.writeNetscapeExt()),this.writeGraphicCtrlExt(),this.writeImageDesc(),this.firstFrame||this.globalPalette||this.writePalette(),this.writePixels(),this.firstFrame=!1},F.prototype.finish=function(){this.out.writeByte(59)},F.prototype.setQuality=function(N){N<1&&(N=1),this.sample=N},F.prototype.setDither=function(N){N===!0&&(N="FloydSteinberg"),this.dither=N},F.prototype.setGlobalPalette=function(N){this.globalPalette=N},F.prototype.getGlobalPalette=function(){return this.globalPalette&&this.globalPalette.slice&&this.globalPalette.slice(0)||this.globalPalette},F.prototype.writeHeader=function(){this.out.writeUTFBytes("GIF89a")},F.prototype.analyzePixels=function(){this.colorTab||(this.neuQuant=new y(this.pixels,this.sample),this.neuQuant.buildColormap(),this.colorTab=this.neuQuant.getColormap()),this.dither?this.ditherPixels(this.dither.replace("-serpentine",""),this.dither.match(/-serpentine/)!==null):this.indexPixels(),this.pixels=null,this.colorDepth=8,this.palSize=7,this.transparent!==null&&(this.transIndex=this.findClosest(this.transparent,!0))},F.prototype.indexPixels=function(N){var Q=this.pixels.length/3;this.indexedPixels=new Uint8Array(Q);for(var q=0,X=0;X<Q;X++){var G=this.findClosestRGB(255&this.pixels[q++],255&this.pixels[q++],255&this.pixels[q++]);this.usedEntry[G]=!0,this.indexedPixels[X]=G}},F.prototype.ditherPixels=function(N,Q){var q={FalseFloydSteinberg:[[.375,1,0],[.375,0,1],[.25,1,1]],FloydSteinberg:[[.4375,1,0],[.1875,-1,1],[.3125,0,1],[.0625,1,1]],Stucki:[[.19047619047619047,1,0],[.09523809523809523,2,0],[.047619047619047616,-2,1],[.09523809523809523,-1,1],[.19047619047619047,0,1],[.09523809523809523,1,1],[.047619047619047616,2,1],[.023809523809523808,-2,2],[.047619047619047616,-1,2],[.09523809523809523,0,2],[.047619047619047616,1,2],[.023809523809523808,2,2]],Atkinson:[[.125,1,0],[.125,2,0],[.125,-1,1],[.125,0,1],[.125,1,1],[.125,0,2]]};if(!N||!q[N])throw"Unknown dithering kernel: "+N;var X=q[N],G=0,ae=this.height,xe=this.width,Te=this.pixels,fe=Q?-1:1;this.indexedPixels=new Uint8Array(this.pixels.length/3);for(var ne=0;ne<ae;ne++){Q&&(fe*=-1);for(var ue=fe==1?0:xe-1,ye=fe==1?xe:0;ue!==ye;ue+=fe){var le=3*(G=ne*xe+ue),re=Te[le],oe=Te[le+1],se=Te[le+2];le=this.findClosestRGB(re,oe,se),this.usedEntry[le]=!0,this.indexedPixels[G]=le,le*=3;for(var Ae=re-this.colorTab[le],De=oe-this.colorTab[le+1],Ge=se-this.colorTab[le+2],yt=fe==1?0:X.length-1,ct=fe==1?X.length:0;yt!==ct;yt+=fe){var mt=X[yt][1],et=X[yt][2];if(mt+ue>=0&&mt+ue<xe&&et+ne>=0&&et+ne<ae){var Qe=X[yt][0];le=G+mt+et*xe,Te[le*=3]=Math.max(0,Math.min(255,Te[le]+Ae*Qe)),Te[le+1]=Math.max(0,Math.min(255,Te[le+1]+De*Qe)),Te[le+2]=Math.max(0,Math.min(255,Te[le+2]+Ge*Qe))}}}}},F.prototype.findClosest=function(N,Q){return this.findClosestRGB((16711680&N)>>16,(65280&N)>>8,255&N,Q)},F.prototype.findClosestRGB=function(N,Q,q,X){if(this.colorTab===null)return-1;if(this.neuQuant&&!X)return this.neuQuant.lookupRGB(N,Q,q);for(var G=0,ae=16777216,xe=this.colorTab.length,Te=0,fe=0;Te<xe;fe++){var ne=N-(255&this.colorTab[Te++]),ue=Q-(255&this.colorTab[Te++]),ye=q-(255&this.colorTab[Te++]),le=ne*ne+ue*ue+ye*ye;(!X||this.usedEntry[fe])&&le<ae&&(ae=le,G=fe)}return G},F.prototype.getImagePixels=function(){var N=this.width,Q=this.height;this.pixels=new Uint8Array(N*Q*3);for(var q=this.image,X=0,G=0,ae=0;ae<Q;ae++)for(var xe=0;xe<N;xe++)this.pixels[G++]=q[X++],this.pixels[G++]=q[X++],this.pixels[G++]=q[X++],X++},F.prototype.writeGraphicCtrlExt=function(){var N,Q;this.out.writeByte(33),this.out.writeByte(249),this.out.writeByte(4),this.transparent===null?(N=0,Q=0):(N=1,Q=2),this.dispose>=0&&(Q=7&this.dispose),Q<<=2,this.out.writeByte(0|Q|N),this.writeShort(this.delay),this.out.writeByte(this.transIndex),this.out.writeByte(0)},F.prototype.writeImageDesc=function(){this.out.writeByte(44),this.writeShort(0),this.writeShort(0),this.writeShort(this.width),this.writeShort(this.height),this.firstFrame||this.globalPalette?this.out.writeByte(0):this.out.writeByte(128|this.palSize)},F.prototype.writeLSD=function(){this.writeShort(this.width),this.writeShort(this.height),this.out.writeByte(240|this.palSize),this.out.writeByte(0),this.out.writeByte(0)},F.prototype.writeNetscapeExt=function(){this.out.writeByte(33),this.out.writeByte(255),this.out.writeByte(11),this.out.writeUTFBytes("NETSCAPE2.0"),this.out.writeByte(3),this.out.writeByte(1),this.writeShort(this.repeat),this.out.writeByte(0)},F.prototype.writePalette=function(){this.out.writeBytes(this.colorTab);for(var N=768-this.colorTab.length,Q=0;Q<N;Q++)this.out.writeByte(0)},F.prototype.writeShort=function(N){this.out.writeByte(255&N),this.out.writeByte(N>>8&255)},F.prototype.writePixels=function(){new r(this.width,this.height,this.indexedPixels,this.colorDepth).encode(this.out)},F.prototype.stream=function(){return this.out},u.a=F},function(o,u,d){o.exports=d(20)},function(o,u,d){var y=d(2).default;function v(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */o.exports=v=function(){return r},o.exports.__esModule=!0,o.exports.default=o.exports;var r={},D=Object.prototype,B=D.hasOwnProperty,F=typeof Symbol=="function"?Symbol:{},N=F.iterator||"@@iterator",Q=F.asyncIterator||"@@asyncIterator",q=F.toStringTag||"@@toStringTag";function X(et,Qe,vt){return Object.defineProperty(et,Qe,{value:vt,enumerable:!0,configurable:!0,writable:!0}),et[Qe]}try{X({},"")}catch{X=function(Qe,vt,st){return Qe[vt]=st}}function G(et,Qe,vt,st){var Zt=Qe&&Qe.prototype instanceof Te?Qe:Te,ui=Object.create(Zt.prototype),ni=new yt(st||[]);return ui._invoke=function(Hi,Ci,Ii){var Ui="suspendedStart";return function(xi,Yi){if(Ui==="executing")throw new Error("Generator is already running");if(Ui==="completed"){if(xi==="throw")throw Yi;return mt()}for(Ii.method=xi,Ii.arg=Yi;;){var H=Ii.delegate;if(H){var be=Ae(H,Ii);if(be){if(be===xe)continue;return be}}if(Ii.method==="next")Ii.sent=Ii._sent=Ii.arg;else if(Ii.method==="throw"){if(Ui==="suspendedStart")throw Ui="completed",Ii.arg;Ii.dispatchException(Ii.arg)}else Ii.method==="return"&&Ii.abrupt("return",Ii.arg);Ui="executing";var Be=ae(Hi,Ci,Ii);if(Be.type==="normal"){if(Ui=Ii.done?"completed":"suspendedYield",Be.arg===xe)continue;return{value:Be.arg,done:Ii.done}}Be.type==="throw"&&(Ui="completed",Ii.method="throw",Ii.arg=Be.arg)}}}(et,vt,ni),ui}function ae(et,Qe,vt){try{return{type:"normal",arg:et.call(Qe,vt)}}catch(st){return{type:"throw",arg:st}}}r.wrap=G;var xe={};function Te(){}function fe(){}function ne(){}var ue={};X(ue,N,function(){return this});var ye=Object.getPrototypeOf,le=ye&&ye(ye(ct([])));le&&le!==D&&B.call(le,N)&&(ue=le);var re=ne.prototype=Te.prototype=Object.create(ue);function oe(et){["next","throw","return"].forEach(function(Qe){X(et,Qe,function(vt){return this._invoke(Qe,vt)})})}function se(et,Qe){var vt;this._invoke=function(st,Zt){function ui(){return new Qe(function(ni,Hi){(function Ci(Ii,Ui,xi,Yi){var H=ae(et[Ii],et,Ui);if(H.type!=="throw"){var be=H.arg,Be=be.value;return Be&&y(Be)=="object"&&B.call(Be,"__await")?Qe.resolve(Be.__await).then(function(Ee){Ci("next",Ee,xi,Yi)},function(Ee){Ci("throw",Ee,xi,Yi)}):Qe.resolve(Be).then(function(Ee){be.value=Ee,xi(be)},function(Ee){return Ci("throw",Ee,xi,Yi)})}Yi(H.arg)})(st,Zt,ni,Hi)})}return vt=vt?vt.then(ui,ui):ui()}}function Ae(et,Qe){var vt=et.iterator[Qe.method];if(vt===void 0){if(Qe.delegate=null,Qe.method==="throw"){if(et.iterator.return&&(Qe.method="return",Qe.arg=void 0,Ae(et,Qe),Qe.method==="throw"))return xe;Qe.method="throw",Qe.arg=new TypeError("The iterator does not provide a 'throw' method")}return xe}var st=ae(vt,et.iterator,Qe.arg);if(st.type==="throw")return Qe.method="throw",Qe.arg=st.arg,Qe.delegate=null,xe;var Zt=st.arg;return Zt?Zt.done?(Qe[et.resultName]=Zt.value,Qe.next=et.nextLoc,Qe.method!=="return"&&(Qe.method="next",Qe.arg=void 0),Qe.delegate=null,xe):Zt:(Qe.method="throw",Qe.arg=new TypeError("iterator result is not an object"),Qe.delegate=null,xe)}function De(et){var Qe={tryLoc:et[0]};1 in et&&(Qe.catchLoc=et[1]),2 in et&&(Qe.finallyLoc=et[2],Qe.afterLoc=et[3]),this.tryEntries.push(Qe)}function Ge(et){var Qe=et.completion||{};Qe.type="normal",delete Qe.arg,et.completion=Qe}function yt(et){this.tryEntries=[{tryLoc:"root"}],et.forEach(De,this),this.reset(!0)}function ct(et){if(et){var Qe=et[N];if(Qe)return Qe.call(et);if(typeof et.next=="function")return et;if(!isNaN(et.length)){var vt=-1,st=function Zt(){for(;++vt<et.length;)if(B.call(et,vt))return Zt.value=et[vt],Zt.done=!1,Zt;return Zt.value=void 0,Zt.done=!0,Zt};return st.next=st}}return{next:mt}}function mt(){return{value:void 0,done:!0}}return fe.prototype=ne,X(re,"constructor",ne),X(ne,"constructor",fe),fe.displayName=X(ne,q,"GeneratorFunction"),r.isGeneratorFunction=function(et){var Qe=typeof et=="function"&&et.constructor;return!!Qe&&(Qe===fe||(Qe.displayName||Qe.name)==="GeneratorFunction")},r.mark=function(et){return Object.setPrototypeOf?Object.setPrototypeOf(et,ne):(et.__proto__=ne,X(et,q,"GeneratorFunction")),et.prototype=Object.create(re),et},r.awrap=function(et){return{__await:et}},oe(se.prototype),X(se.prototype,Q,function(){return this}),r.AsyncIterator=se,r.async=function(et,Qe,vt,st,Zt){Zt===void 0&&(Zt=Promise);var ui=new se(G(et,Qe,vt,st),Zt);return r.isGeneratorFunction(Qe)?ui:ui.next().then(function(ni){return ni.done?ni.value:ui.next()})},oe(re),X(re,q,"Generator"),X(re,N,function(){return this}),X(re,"toString",function(){return"[object Generator]"}),r.keys=function(et){var Qe=[];for(var vt in et)Qe.push(vt);return Qe.reverse(),function st(){for(;Qe.length;){var Zt=Qe.pop();if(Zt in et)return st.value=Zt,st.done=!1,st}return st.done=!0,st}},r.values=ct,yt.prototype={constructor:yt,reset:function(et){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(Ge),!et)for(var Qe in this)Qe.charAt(0)==="t"&&B.call(this,Qe)&&!isNaN(+Qe.slice(1))&&(this[Qe]=void 0)},stop:function(){this.done=!0;var et=this.tryEntries[0].completion;if(et.type==="throw")throw et.arg;return this.rval},dispatchException:function(et){if(this.done)throw et;var Qe=this;function vt(Ci,Ii){return ui.type="throw",ui.arg=et,Qe.next=Ci,Ii&&(Qe.method="next",Qe.arg=void 0),!!Ii}for(var st=this.tryEntries.length-1;st>=0;--st){var Zt=this.tryEntries[st],ui=Zt.completion;if(Zt.tryLoc==="root")return vt("end");if(Zt.tryLoc<=this.prev){var ni=B.call(Zt,"catchLoc"),Hi=B.call(Zt,"finallyLoc");if(ni&&Hi){if(this.prev<Zt.catchLoc)return vt(Zt.catchLoc,!0);if(this.prev<Zt.finallyLoc)return vt(Zt.finallyLoc)}else if(ni){if(this.prev<Zt.catchLoc)return vt(Zt.catchLoc,!0)}else{if(!Hi)throw new Error("try statement without catch or finally");if(this.prev<Zt.finallyLoc)return vt(Zt.finallyLoc)}}}},abrupt:function(et,Qe){for(var vt=this.tryEntries.length-1;vt>=0;--vt){var st=this.tryEntries[vt];if(st.tryLoc<=this.prev&&B.call(st,"finallyLoc")&&this.prev<st.finallyLoc){var Zt=st;break}}Zt&&(et==="break"||et==="continue")&&Zt.tryLoc<=Qe&&Qe<=Zt.finallyLoc&&(Zt=null);var ui=Zt?Zt.completion:{};return ui.type=et,ui.arg=Qe,Zt?(this.method="next",this.next=Zt.finallyLoc,xe):this.complete(ui)},complete:function(et,Qe){if(et.type==="throw")throw et.arg;return et.type==="break"||et.type==="continue"?this.next=et.arg:et.type==="return"?(this.rval=this.arg=et.arg,this.method="return",this.next="end"):et.type==="normal"&&Qe&&(this.next=Qe),xe},finish:function(et){for(var Qe=this.tryEntries.length-1;Qe>=0;--Qe){var vt=this.tryEntries[Qe];if(vt.finallyLoc===et)return this.complete(vt.completion,vt.afterLoc),Ge(vt),xe}},catch:function(et){for(var Qe=this.tryEntries.length-1;Qe>=0;--Qe){var vt=this.tryEntries[Qe];if(vt.tryLoc===et){var st=vt.completion;if(st.type==="throw"){var Zt=st.arg;Ge(vt)}return Zt}}throw new Error("illegal catch attempt")},delegateYield:function(et,Qe,vt){return this.delegate={iterator:ct(et),resultName:Qe,nextLoc:vt},this.method==="next"&&(this.arg=void 0),xe}},r}o.exports=v,o.exports.__esModule=!0,o.exports.default=o.exports},function(o,u,d){(function(y){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */var v=d(16),r=d(17),D=d(18);function B(){return N.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function F(H,be){if(B()<be)throw new RangeError("Invalid typed array length");return N.TYPED_ARRAY_SUPPORT?(H=new Uint8Array(be)).__proto__=N.prototype:(H===null&&(H=new N(be)),H.length=be),H}function N(H,be,Be){if(!(N.TYPED_ARRAY_SUPPORT||this instanceof N))return new N(H,be,Be);if(typeof H=="number"){if(typeof be=="string")throw new Error("If encoding is specified then the first argument must be a string");return X(this,H)}return Q(this,H,be,Be)}function Q(H,be,Be,Ee){if(typeof be=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&be instanceof ArrayBuffer?function(ve,Ie,Tt,qe){if(Ie.byteLength,Tt<0||Ie.byteLength<Tt)throw new RangeError("'offset' is out of bounds");if(Ie.byteLength<Tt+(qe||0))throw new RangeError("'length' is out of bounds");return Ie=Tt===void 0&&qe===void 0?new Uint8Array(Ie):qe===void 0?new Uint8Array(Ie,Tt):new Uint8Array(Ie,Tt,qe),N.TYPED_ARRAY_SUPPORT?(ve=Ie).__proto__=N.prototype:ve=G(ve,Ie),ve}(H,be,Be,Ee):typeof be=="string"?function(ve,Ie,Tt){if(typeof Tt=="string"&&Tt!==""||(Tt="utf8"),!N.isEncoding(Tt))throw new TypeError('"encoding" must be a valid string encoding');var qe=0|xe(Ie,Tt),Et=(ve=F(ve,qe)).write(Ie,Tt);return Et!==qe&&(ve=ve.slice(0,Et)),ve}(H,be,Be):function(ve,Ie){if(N.isBuffer(Ie)){var Tt=0|ae(Ie.length);return(ve=F(ve,Tt)).length===0||Ie.copy(ve,0,0,Tt),ve}if(Ie){if(typeof ArrayBuffer<"u"&&Ie.buffer instanceof ArrayBuffer||"length"in Ie)return typeof Ie.length!="number"||(qe=Ie.length)!=qe?F(ve,0):G(ve,Ie);if(Ie.type==="Buffer"&&D(Ie.data))return G(ve,Ie.data)}var qe;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(H,be)}function q(H){if(typeof H!="number")throw new TypeError('"size" argument must be a number');if(H<0)throw new RangeError('"size" argument must not be negative')}function X(H,be){if(q(be),H=F(H,be<0?0:0|ae(be)),!N.TYPED_ARRAY_SUPPORT)for(var Be=0;Be<be;++Be)H[Be]=0;return H}function G(H,be){var Be=be.length<0?0:0|ae(be.length);H=F(H,Be);for(var Ee=0;Ee<Be;Ee+=1)H[Ee]=255&be[Ee];return H}function ae(H){if(H>=B())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+B().toString(16)+" bytes");return 0|H}function xe(H,be){if(N.isBuffer(H))return H.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(H)||H instanceof ArrayBuffer))return H.byteLength;typeof H!="string"&&(H=""+H);var Be=H.length;if(Be===0)return 0;for(var Ee=!1;;)switch(be){case"ascii":case"latin1":case"binary":return Be;case"utf8":case"utf-8":case void 0:return Ui(H).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*Be;case"hex":return Be>>>1;case"base64":return xi(H).length;default:if(Ee)return Ui(H).length;be=(""+be).toLowerCase(),Ee=!0}}function Te(H,be,Be){var Ee=!1;if((be===void 0||be<0)&&(be=0),be>this.length||((Be===void 0||Be>this.length)&&(Be=this.length),Be<=0)||(Be>>>=0)<=(be>>>=0))return"";for(H||(H="utf8");;)switch(H){case"hex":return mt(this,be,Be);case"utf8":case"utf-8":return Ge(this,be,Be);case"ascii":return yt(this,be,Be);case"latin1":case"binary":return ct(this,be,Be);case"base64":return De(this,be,Be);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return et(this,be,Be);default:if(Ee)throw new TypeError("Unknown encoding: "+H);H=(H+"").toLowerCase(),Ee=!0}}function fe(H,be,Be){var Ee=H[be];H[be]=H[Be],H[Be]=Ee}function ne(H,be,Be,Ee,ve){if(H.length===0)return-1;if(typeof Be=="string"?(Ee=Be,Be=0):Be>2147483647?Be=2147483647:Be<-2147483648&&(Be=-2147483648),Be=+Be,isNaN(Be)&&(Be=ve?0:H.length-1),Be<0&&(Be=H.length+Be),Be>=H.length){if(ve)return-1;Be=H.length-1}else if(Be<0){if(!ve)return-1;Be=0}if(typeof be=="string"&&(be=N.from(be,Ee)),N.isBuffer(be))return be.length===0?-1:ue(H,be,Be,Ee,ve);if(typeof be=="number")return be&=255,N.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?ve?Uint8Array.prototype.indexOf.call(H,be,Be):Uint8Array.prototype.lastIndexOf.call(H,be,Be):ue(H,[be],Be,Ee,ve);throw new TypeError("val must be string, number or Buffer")}function ue(H,be,Be,Ee,ve){var Ie,Tt=1,qe=H.length,Et=be.length;if(Ee!==void 0&&((Ee=String(Ee).toLowerCase())==="ucs2"||Ee==="ucs-2"||Ee==="utf16le"||Ee==="utf-16le")){if(H.length<2||be.length<2)return-1;Tt=2,qe/=2,Et/=2,Be/=2}function It(Li,Ut){return Tt===1?Li[Ut]:Li.readUInt16BE(Ut*Tt)}if(ve){var $t=-1;for(Ie=Be;Ie<qe;Ie++)if(It(H,Ie)===It(be,$t===-1?0:Ie-$t)){if($t===-1&&($t=Ie),Ie-$t+1===Et)return $t*Tt}else $t!==-1&&(Ie-=Ie-$t),$t=-1}else for(Be+Et>qe&&(Be=qe-Et),Ie=Be;Ie>=0;Ie--){for(var Kt=!0,ti=0;ti<Et;ti++)if(It(H,Ie+ti)!==It(be,ti)){Kt=!1;break}if(Kt)return Ie}return-1}function ye(H,be,Be,Ee){Be=Number(Be)||0;var ve=H.length-Be;Ee?(Ee=Number(Ee))>ve&&(Ee=ve):Ee=ve;var Ie=be.length;if(Ie%2!=0)throw new TypeError("Invalid hex string");Ee>Ie/2&&(Ee=Ie/2);for(var Tt=0;Tt<Ee;++Tt){var qe=parseInt(be.substr(2*Tt,2),16);if(isNaN(qe))return Tt;H[Be+Tt]=qe}return Tt}function le(H,be,Be,Ee){return Yi(Ui(be,H.length-Be),H,Be,Ee)}function re(H,be,Be,Ee){return Yi(function(ve){for(var Ie=[],Tt=0;Tt<ve.length;++Tt)Ie.push(255&ve.charCodeAt(Tt));return Ie}(be),H,Be,Ee)}function oe(H,be,Be,Ee){return re(H,be,Be,Ee)}function se(H,be,Be,Ee){return Yi(xi(be),H,Be,Ee)}function Ae(H,be,Be,Ee){return Yi(function(ve,Ie){for(var Tt,qe,Et,It=[],$t=0;$t<ve.length&&!((Ie-=2)<0);++$t)Tt=ve.charCodeAt($t),qe=Tt>>8,Et=Tt%256,It.push(Et),It.push(qe);return It}(be,H.length-Be),H,Be,Ee)}function De(H,be,Be){return be===0&&Be===H.length?v.fromByteArray(H):v.fromByteArray(H.slice(be,Be))}function Ge(H,be,Be){Be=Math.min(H.length,Be);for(var Ee=[],ve=be;ve<Be;){var Ie,Tt,qe,Et,It=H[ve],$t=null,Kt=It>239?4:It>223?3:It>191?2:1;if(ve+Kt<=Be)switch(Kt){case 1:It<128&&($t=It);break;case 2:(192&(Ie=H[ve+1]))==128&&(Et=(31&It)<<6|63&Ie)>127&&($t=Et);break;case 3:Ie=H[ve+1],Tt=H[ve+2],(192&Ie)==128&&(192&Tt)==128&&(Et=(15&It)<<12|(63&Ie)<<6|63&Tt)>2047&&(Et<55296||Et>57343)&&($t=Et);break;case 4:Ie=H[ve+1],Tt=H[ve+2],qe=H[ve+3],(192&Ie)==128&&(192&Tt)==128&&(192&qe)==128&&(Et=(15&It)<<18|(63&Ie)<<12|(63&Tt)<<6|63&qe)>65535&&Et<1114112&&($t=Et)}$t===null?($t=65533,Kt=1):$t>65535&&($t-=65536,Ee.push($t>>>10&1023|55296),$t=56320|1023&$t),Ee.push($t),ve+=Kt}return function(ti){var Li=ti.length;if(Li<=4096)return String.fromCharCode.apply(String,ti);for(var Ut="",yi=0;yi<Li;)Ut+=String.fromCharCode.apply(String,ti.slice(yi,yi+=4096));return Ut}(Ee)}u.Buffer=N,u.SlowBuffer=function(H){return+H!=H&&(H=0),N.alloc(+H)},u.INSPECT_MAX_BYTES=50,N.TYPED_ARRAY_SUPPORT=y.TYPED_ARRAY_SUPPORT!==void 0?y.TYPED_ARRAY_SUPPORT:function(){try{var H=new Uint8Array(1);return H.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},H.foo()===42&&typeof H.subarray=="function"&&H.subarray(1,1).byteLength===0}catch{return!1}}(),u.kMaxLength=B(),N.poolSize=8192,N._augment=function(H){return H.__proto__=N.prototype,H},N.from=function(H,be,Be){return Q(null,H,be,Be)},N.TYPED_ARRAY_SUPPORT&&(N.prototype.__proto__=Uint8Array.prototype,N.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&N[Symbol.species]===N&&Object.defineProperty(N,Symbol.species,{value:null,configurable:!0})),N.alloc=function(H,be,Be){return function(Ee,ve,Ie,Tt){return q(ve),ve<=0?F(Ee,ve):Ie!==void 0?typeof Tt=="string"?F(Ee,ve).fill(Ie,Tt):F(Ee,ve).fill(Ie):F(Ee,ve)}(null,H,be,Be)},N.allocUnsafe=function(H){return X(null,H)},N.allocUnsafeSlow=function(H){return X(null,H)},N.isBuffer=function(H){return!(H==null||!H._isBuffer)},N.compare=function(H,be){if(!N.isBuffer(H)||!N.isBuffer(be))throw new TypeError("Arguments must be Buffers");if(H===be)return 0;for(var Be=H.length,Ee=be.length,ve=0,Ie=Math.min(Be,Ee);ve<Ie;++ve)if(H[ve]!==be[ve]){Be=H[ve],Ee=be[ve];break}return Be<Ee?-1:Ee<Be?1:0},N.isEncoding=function(H){switch(String(H).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},N.concat=function(H,be){if(!D(H))throw new TypeError('"list" argument must be an Array of Buffers');if(H.length===0)return N.alloc(0);var Be;if(be===void 0)for(be=0,Be=0;Be<H.length;++Be)be+=H[Be].length;var Ee=N.allocUnsafe(be),ve=0;for(Be=0;Be<H.length;++Be){var Ie=H[Be];if(!N.isBuffer(Ie))throw new TypeError('"list" argument must be an Array of Buffers');Ie.copy(Ee,ve),ve+=Ie.length}return Ee},N.byteLength=xe,N.prototype._isBuffer=!0,N.prototype.swap16=function(){var H=this.length;if(H%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var be=0;be<H;be+=2)fe(this,be,be+1);return this},N.prototype.swap32=function(){var H=this.length;if(H%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var be=0;be<H;be+=4)fe(this,be,be+3),fe(this,be+1,be+2);return this},N.prototype.swap64=function(){var H=this.length;if(H%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var be=0;be<H;be+=8)fe(this,be,be+7),fe(this,be+1,be+6),fe(this,be+2,be+5),fe(this,be+3,be+4);return this},N.prototype.toString=function(){var H=0|this.length;return H===0?"":arguments.length===0?Ge(this,0,H):Te.apply(this,arguments)},N.prototype.equals=function(H){if(!N.isBuffer(H))throw new TypeError("Argument must be a Buffer");return this===H||N.compare(this,H)===0},N.prototype.inspect=function(){var H="",be=u.INSPECT_MAX_BYTES;return this.length>0&&(H=this.toString("hex",0,be).match(/.{2}/g).join(" "),this.length>be&&(H+=" ... ")),"<Buffer "+H+">"},N.prototype.compare=function(H,be,Be,Ee,ve){if(!N.isBuffer(H))throw new TypeError("Argument must be a Buffer");if(be===void 0&&(be=0),Be===void 0&&(Be=H?H.length:0),Ee===void 0&&(Ee=0),ve===void 0&&(ve=this.length),be<0||Be>H.length||Ee<0||ve>this.length)throw new RangeError("out of range index");if(Ee>=ve&&be>=Be)return 0;if(Ee>=ve)return-1;if(be>=Be)return 1;if(this===H)return 0;for(var Ie=(ve>>>=0)-(Ee>>>=0),Tt=(Be>>>=0)-(be>>>=0),qe=Math.min(Ie,Tt),Et=this.slice(Ee,ve),It=H.slice(be,Be),$t=0;$t<qe;++$t)if(Et[$t]!==It[$t]){Ie=Et[$t],Tt=It[$t];break}return Ie<Tt?-1:Tt<Ie?1:0},N.prototype.includes=function(H,be,Be){return this.indexOf(H,be,Be)!==-1},N.prototype.indexOf=function(H,be,Be){return ne(this,H,be,Be,!0)},N.prototype.lastIndexOf=function(H,be,Be){return ne(this,H,be,Be,!1)},N.prototype.write=function(H,be,Be,Ee){if(be===void 0)Ee="utf8",Be=this.length,be=0;else if(Be===void 0&&typeof be=="string")Ee=be,Be=this.length,be=0;else{if(!isFinite(be))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");be|=0,isFinite(Be)?(Be|=0,Ee===void 0&&(Ee="utf8")):(Ee=Be,Be=void 0)}var ve=this.length-be;if((Be===void 0||Be>ve)&&(Be=ve),H.length>0&&(Be<0||be<0)||be>this.length)throw new RangeError("Attempt to write outside buffer bounds");Ee||(Ee="utf8");for(var Ie=!1;;)switch(Ee){case"hex":return ye(this,H,be,Be);case"utf8":case"utf-8":return le(this,H,be,Be);case"ascii":return re(this,H,be,Be);case"latin1":case"binary":return oe(this,H,be,Be);case"base64":return se(this,H,be,Be);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ae(this,H,be,Be);default:if(Ie)throw new TypeError("Unknown encoding: "+Ee);Ee=(""+Ee).toLowerCase(),Ie=!0}},N.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function yt(H,be,Be){var Ee="";Be=Math.min(H.length,Be);for(var ve=be;ve<Be;++ve)Ee+=String.fromCharCode(127&H[ve]);return Ee}function ct(H,be,Be){var Ee="";Be=Math.min(H.length,Be);for(var ve=be;ve<Be;++ve)Ee+=String.fromCharCode(H[ve]);return Ee}function mt(H,be,Be){var Ee=H.length;(!be||be<0)&&(be=0),(!Be||Be<0||Be>Ee)&&(Be=Ee);for(var ve="",Ie=be;Ie<Be;++Ie)ve+=Ii(H[Ie]);return ve}function et(H,be,Be){for(var Ee=H.slice(be,Be),ve="",Ie=0;Ie<Ee.length;Ie+=2)ve+=String.fromCharCode(Ee[Ie]+256*Ee[Ie+1]);return ve}function Qe(H,be,Be){if(H%1!=0||H<0)throw new RangeError("offset is not uint");if(H+be>Be)throw new RangeError("Trying to access beyond buffer length")}function vt(H,be,Be,Ee,ve,Ie){if(!N.isBuffer(H))throw new TypeError('"buffer" argument must be a Buffer instance');if(be>ve||be<Ie)throw new RangeError('"value" argument is out of bounds');if(Be+Ee>H.length)throw new RangeError("Index out of range")}function st(H,be,Be,Ee){be<0&&(be=65535+be+1);for(var ve=0,Ie=Math.min(H.length-Be,2);ve<Ie;++ve)H[Be+ve]=(be&255<<8*(Ee?ve:1-ve))>>>8*(Ee?ve:1-ve)}function Zt(H,be,Be,Ee){be<0&&(be=4294967295+be+1);for(var ve=0,Ie=Math.min(H.length-Be,4);ve<Ie;++ve)H[Be+ve]=be>>>8*(Ee?ve:3-ve)&255}function ui(H,be,Be,Ee,ve,Ie){if(Be+Ee>H.length)throw new RangeError("Index out of range");if(Be<0)throw new RangeError("Index out of range")}function ni(H,be,Be,Ee,ve){return ve||ui(H,0,Be,4),r.write(H,be,Be,Ee,23,4),Be+4}function Hi(H,be,Be,Ee,ve){return ve||ui(H,0,Be,8),r.write(H,be,Be,Ee,52,8),Be+8}N.prototype.slice=function(H,be){var Be,Ee=this.length;if((H=~~H)<0?(H+=Ee)<0&&(H=0):H>Ee&&(H=Ee),(be=be===void 0?Ee:~~be)<0?(be+=Ee)<0&&(be=0):be>Ee&&(be=Ee),be<H&&(be=H),N.TYPED_ARRAY_SUPPORT)(Be=this.subarray(H,be)).__proto__=N.prototype;else{var ve=be-H;Be=new N(ve,void 0);for(var Ie=0;Ie<ve;++Ie)Be[Ie]=this[Ie+H]}return Be},N.prototype.readUIntLE=function(H,be,Be){H|=0,be|=0,Be||Qe(H,be,this.length);for(var Ee=this[H],ve=1,Ie=0;++Ie<be&&(ve*=256);)Ee+=this[H+Ie]*ve;return Ee},N.prototype.readUIntBE=function(H,be,Be){H|=0,be|=0,Be||Qe(H,be,this.length);for(var Ee=this[H+--be],ve=1;be>0&&(ve*=256);)Ee+=this[H+--be]*ve;return Ee},N.prototype.readUInt8=function(H,be){return be||Qe(H,1,this.length),this[H]},N.prototype.readUInt16LE=function(H,be){return be||Qe(H,2,this.length),this[H]|this[H+1]<<8},N.prototype.readUInt16BE=function(H,be){return be||Qe(H,2,this.length),this[H]<<8|this[H+1]},N.prototype.readUInt32LE=function(H,be){return be||Qe(H,4,this.length),(this[H]|this[H+1]<<8|this[H+2]<<16)+16777216*this[H+3]},N.prototype.readUInt32BE=function(H,be){return be||Qe(H,4,this.length),16777216*this[H]+(this[H+1]<<16|this[H+2]<<8|this[H+3])},N.prototype.readIntLE=function(H,be,Be){H|=0,be|=0,Be||Qe(H,be,this.length);for(var Ee=this[H],ve=1,Ie=0;++Ie<be&&(ve*=256);)Ee+=this[H+Ie]*ve;return Ee>=(ve*=128)&&(Ee-=Math.pow(2,8*be)),Ee},N.prototype.readIntBE=function(H,be,Be){H|=0,be|=0,Be||Qe(H,be,this.length);for(var Ee=be,ve=1,Ie=this[H+--Ee];Ee>0&&(ve*=256);)Ie+=this[H+--Ee]*ve;return Ie>=(ve*=128)&&(Ie-=Math.pow(2,8*be)),Ie},N.prototype.readInt8=function(H,be){return be||Qe(H,1,this.length),128&this[H]?-1*(255-this[H]+1):this[H]},N.prototype.readInt16LE=function(H,be){be||Qe(H,2,this.length);var Be=this[H]|this[H+1]<<8;return 32768&Be?4294901760|Be:Be},N.prototype.readInt16BE=function(H,be){be||Qe(H,2,this.length);var Be=this[H+1]|this[H]<<8;return 32768&Be?4294901760|Be:Be},N.prototype.readInt32LE=function(H,be){return be||Qe(H,4,this.length),this[H]|this[H+1]<<8|this[H+2]<<16|this[H+3]<<24},N.prototype.readInt32BE=function(H,be){return be||Qe(H,4,this.length),this[H]<<24|this[H+1]<<16|this[H+2]<<8|this[H+3]},N.prototype.readFloatLE=function(H,be){return be||Qe(H,4,this.length),r.read(this,H,!0,23,4)},N.prototype.readFloatBE=function(H,be){return be||Qe(H,4,this.length),r.read(this,H,!1,23,4)},N.prototype.readDoubleLE=function(H,be){return be||Qe(H,8,this.length),r.read(this,H,!0,52,8)},N.prototype.readDoubleBE=function(H,be){return be||Qe(H,8,this.length),r.read(this,H,!1,52,8)},N.prototype.writeUIntLE=function(H,be,Be,Ee){H=+H,be|=0,Be|=0,Ee||vt(this,H,be,Be,Math.pow(2,8*Be)-1,0);var ve=1,Ie=0;for(this[be]=255&H;++Ie<Be&&(ve*=256);)this[be+Ie]=H/ve&255;return be+Be},N.prototype.writeUIntBE=function(H,be,Be,Ee){H=+H,be|=0,Be|=0,Ee||vt(this,H,be,Be,Math.pow(2,8*Be)-1,0);var ve=Be-1,Ie=1;for(this[be+ve]=255&H;--ve>=0&&(Ie*=256);)this[be+ve]=H/Ie&255;return be+Be},N.prototype.writeUInt8=function(H,be,Be){return H=+H,be|=0,Be||vt(this,H,be,1,255,0),N.TYPED_ARRAY_SUPPORT||(H=Math.floor(H)),this[be]=255&H,be+1},N.prototype.writeUInt16LE=function(H,be,Be){return H=+H,be|=0,Be||vt(this,H,be,2,65535,0),N.TYPED_ARRAY_SUPPORT?(this[be]=255&H,this[be+1]=H>>>8):st(this,H,be,!0),be+2},N.prototype.writeUInt16BE=function(H,be,Be){return H=+H,be|=0,Be||vt(this,H,be,2,65535,0),N.TYPED_ARRAY_SUPPORT?(this[be]=H>>>8,this[be+1]=255&H):st(this,H,be,!1),be+2},N.prototype.writeUInt32LE=function(H,be,Be){return H=+H,be|=0,Be||vt(this,H,be,4,4294967295,0),N.TYPED_ARRAY_SUPPORT?(this[be+3]=H>>>24,this[be+2]=H>>>16,this[be+1]=H>>>8,this[be]=255&H):Zt(this,H,be,!0),be+4},N.prototype.writeUInt32BE=function(H,be,Be){return H=+H,be|=0,Be||vt(this,H,be,4,4294967295,0),N.TYPED_ARRAY_SUPPORT?(this[be]=H>>>24,this[be+1]=H>>>16,this[be+2]=H>>>8,this[be+3]=255&H):Zt(this,H,be,!1),be+4},N.prototype.writeIntLE=function(H,be,Be,Ee){if(H=+H,be|=0,!Ee){var ve=Math.pow(2,8*Be-1);vt(this,H,be,Be,ve-1,-ve)}var Ie=0,Tt=1,qe=0;for(this[be]=255&H;++Ie<Be&&(Tt*=256);)H<0&&qe===0&&this[be+Ie-1]!==0&&(qe=1),this[be+Ie]=(H/Tt>>0)-qe&255;return be+Be},N.prototype.writeIntBE=function(H,be,Be,Ee){if(H=+H,be|=0,!Ee){var ve=Math.pow(2,8*Be-1);vt(this,H,be,Be,ve-1,-ve)}var Ie=Be-1,Tt=1,qe=0;for(this[be+Ie]=255&H;--Ie>=0&&(Tt*=256);)H<0&&qe===0&&this[be+Ie+1]!==0&&(qe=1),this[be+Ie]=(H/Tt>>0)-qe&255;return be+Be},N.prototype.writeInt8=function(H,be,Be){return H=+H,be|=0,Be||vt(this,H,be,1,127,-128),N.TYPED_ARRAY_SUPPORT||(H=Math.floor(H)),H<0&&(H=255+H+1),this[be]=255&H,be+1},N.prototype.writeInt16LE=function(H,be,Be){return H=+H,be|=0,Be||vt(this,H,be,2,32767,-32768),N.TYPED_ARRAY_SUPPORT?(this[be]=255&H,this[be+1]=H>>>8):st(this,H,be,!0),be+2},N.prototype.writeInt16BE=function(H,be,Be){return H=+H,be|=0,Be||vt(this,H,be,2,32767,-32768),N.TYPED_ARRAY_SUPPORT?(this[be]=H>>>8,this[be+1]=255&H):st(this,H,be,!1),be+2},N.prototype.writeInt32LE=function(H,be,Be){return H=+H,be|=0,Be||vt(this,H,be,4,2147483647,-2147483648),N.TYPED_ARRAY_SUPPORT?(this[be]=255&H,this[be+1]=H>>>8,this[be+2]=H>>>16,this[be+3]=H>>>24):Zt(this,H,be,!0),be+4},N.prototype.writeInt32BE=function(H,be,Be){return H=+H,be|=0,Be||vt(this,H,be,4,2147483647,-2147483648),H<0&&(H=4294967295+H+1),N.TYPED_ARRAY_SUPPORT?(this[be]=H>>>24,this[be+1]=H>>>16,this[be+2]=H>>>8,this[be+3]=255&H):Zt(this,H,be,!1),be+4},N.prototype.writeFloatLE=function(H,be,Be){return ni(this,H,be,!0,Be)},N.prototype.writeFloatBE=function(H,be,Be){return ni(this,H,be,!1,Be)},N.prototype.writeDoubleLE=function(H,be,Be){return Hi(this,H,be,!0,Be)},N.prototype.writeDoubleBE=function(H,be,Be){return Hi(this,H,be,!1,Be)},N.prototype.copy=function(H,be,Be,Ee){if(Be||(Be=0),Ee||Ee===0||(Ee=this.length),be>=H.length&&(be=H.length),be||(be=0),Ee>0&&Ee<Be&&(Ee=Be),Ee===Be||H.length===0||this.length===0)return 0;if(be<0)throw new RangeError("targetStart out of bounds");if(Be<0||Be>=this.length)throw new RangeError("sourceStart out of bounds");if(Ee<0)throw new RangeError("sourceEnd out of bounds");Ee>this.length&&(Ee=this.length),H.length-be<Ee-Be&&(Ee=H.length-be+Be);var ve,Ie=Ee-Be;if(this===H&&Be<be&&be<Ee)for(ve=Ie-1;ve>=0;--ve)H[ve+be]=this[ve+Be];else if(Ie<1e3||!N.TYPED_ARRAY_SUPPORT)for(ve=0;ve<Ie;++ve)H[ve+be]=this[ve+Be];else Uint8Array.prototype.set.call(H,this.subarray(Be,Be+Ie),be);return Ie},N.prototype.fill=function(H,be,Be,Ee){if(typeof H=="string"){if(typeof be=="string"?(Ee=be,be=0,Be=this.length):typeof Be=="string"&&(Ee=Be,Be=this.length),H.length===1){var ve=H.charCodeAt(0);ve<256&&(H=ve)}if(Ee!==void 0&&typeof Ee!="string")throw new TypeError("encoding must be a string");if(typeof Ee=="string"&&!N.isEncoding(Ee))throw new TypeError("Unknown encoding: "+Ee)}else typeof H=="number"&&(H&=255);if(be<0||this.length<be||this.length<Be)throw new RangeError("Out of range index");if(Be<=be)return this;var Ie;if(be>>>=0,Be=Be===void 0?this.length:Be>>>0,H||(H=0),typeof H=="number")for(Ie=be;Ie<Be;++Ie)this[Ie]=H;else{var Tt=N.isBuffer(H)?H:Ui(new N(H,Ee).toString()),qe=Tt.length;for(Ie=0;Ie<Be-be;++Ie)this[Ie+be]=Tt[Ie%qe]}return this};var Ci=/[^+\/0-9A-Za-z-_]/g;function Ii(H){return H<16?"0"+H.toString(16):H.toString(16)}function Ui(H,be){var Be;be=be||1/0;for(var Ee=H.length,ve=null,Ie=[],Tt=0;Tt<Ee;++Tt){if((Be=H.charCodeAt(Tt))>55295&&Be<57344){if(!ve){if(Be>56319){(be-=3)>-1&&Ie.push(239,191,189);continue}if(Tt+1===Ee){(be-=3)>-1&&Ie.push(239,191,189);continue}ve=Be;continue}if(Be<56320){(be-=3)>-1&&Ie.push(239,191,189),ve=Be;continue}Be=65536+(ve-55296<<10|Be-56320)}else ve&&(be-=3)>-1&&Ie.push(239,191,189);if(ve=null,Be<128){if((be-=1)<0)break;Ie.push(Be)}else if(Be<2048){if((be-=2)<0)break;Ie.push(Be>>6|192,63&Be|128)}else if(Be<65536){if((be-=3)<0)break;Ie.push(Be>>12|224,Be>>6&63|128,63&Be|128)}else{if(!(Be<1114112))throw new Error("Invalid code point");if((be-=4)<0)break;Ie.push(Be>>18|240,Be>>12&63|128,Be>>6&63|128,63&Be|128)}}return Ie}function xi(H){return v.toByteArray(function(be){if((be=function(Be){return Be.trim?Be.trim():Be.replace(/^\s+|\s+$/g,"")}(be).replace(Ci,"")).length<2)return"";for(;be.length%4!=0;)be+="=";return be}(H))}function Yi(H,be,Be,Ee){for(var ve=0;ve<Ee&&!(ve+Be>=be.length||ve>=H.length);++ve)be[ve+Be]=H[ve];return ve}}).call(this,d(8))},function(o,u,d){u.byteLength=function(q){var X=N(q),G=X[0],ae=X[1];return 3*(G+ae)/4-ae},u.toByteArray=function(q){var X,G,ae=N(q),xe=ae[0],Te=ae[1],fe=new r(function(ye,le,re){return 3*(le+re)/4-re}(0,xe,Te)),ne=0,ue=Te>0?xe-4:xe;for(G=0;G<ue;G+=4)X=v[q.charCodeAt(G)]<<18|v[q.charCodeAt(G+1)]<<12|v[q.charCodeAt(G+2)]<<6|v[q.charCodeAt(G+3)],fe[ne++]=X>>16&255,fe[ne++]=X>>8&255,fe[ne++]=255&X;return Te===2&&(X=v[q.charCodeAt(G)]<<2|v[q.charCodeAt(G+1)]>>4,fe[ne++]=255&X),Te===1&&(X=v[q.charCodeAt(G)]<<10|v[q.charCodeAt(G+1)]<<4|v[q.charCodeAt(G+2)]>>2,fe[ne++]=X>>8&255,fe[ne++]=255&X),fe},u.fromByteArray=function(q){for(var X,G=q.length,ae=G%3,xe=[],Te=0,fe=G-ae;Te<fe;Te+=16383)xe.push(Q(q,Te,Te+16383>fe?fe:Te+16383));return ae===1?(X=q[G-1],xe.push(y[X>>2]+y[X<<4&63]+"==")):ae===2&&(X=(q[G-2]<<8)+q[G-1],xe.push(y[X>>10]+y[X>>4&63]+y[X<<2&63]+"=")),xe.join("")};for(var y=[],v=[],r=typeof Uint8Array<"u"?Uint8Array:Array,D="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",B=0,F=D.length;B<F;++B)y[B]=D[B],v[D.charCodeAt(B)]=B;function N(q){var X=q.length;if(X%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var G=q.indexOf("=");return G===-1&&(G=X),[G,G===X?0:4-G%4]}function Q(q,X,G){for(var ae,xe,Te=[],fe=X;fe<G;fe+=3)ae=(q[fe]<<16&16711680)+(q[fe+1]<<8&65280)+(255&q[fe+2]),Te.push(y[(xe=ae)>>18&63]+y[xe>>12&63]+y[xe>>6&63]+y[63&xe]);return Te.join("")}v["-".charCodeAt(0)]=62,v["_".charCodeAt(0)]=63},function(o,u){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */u.read=function(d,y,v,r,D){var B,F,N=8*D-r-1,Q=(1<<N)-1,q=Q>>1,X=-7,G=v?D-1:0,ae=v?-1:1,xe=d[y+G];for(G+=ae,B=xe&(1<<-X)-1,xe>>=-X,X+=N;X>0;B=256*B+d[y+G],G+=ae,X-=8);for(F=B&(1<<-X)-1,B>>=-X,X+=r;X>0;F=256*F+d[y+G],G+=ae,X-=8);if(B===0)B=1-q;else{if(B===Q)return F?NaN:1/0*(xe?-1:1);F+=Math.pow(2,r),B-=q}return(xe?-1:1)*F*Math.pow(2,B-r)},u.write=function(d,y,v,r,D,B){var F,N,Q,q=8*B-D-1,X=(1<<q)-1,G=X>>1,ae=D===23?Math.pow(2,-24)-Math.pow(2,-77):0,xe=r?0:B-1,Te=r?1:-1,fe=y<0||y===0&&1/y<0?1:0;for(y=Math.abs(y),isNaN(y)||y===1/0?(N=isNaN(y)?1:0,F=X):(F=Math.floor(Math.log(y)/Math.LN2),y*(Q=Math.pow(2,-F))<1&&(F--,Q*=2),(y+=F+G>=1?ae/Q:ae*Math.pow(2,1-G))*Q>=2&&(F++,Q/=2),F+G>=X?(N=0,F=X):F+G>=1?(N=(y*Q-1)*Math.pow(2,D),F+=G):(N=y*Math.pow(2,G-1)*Math.pow(2,D),F=0));D>=8;d[v+xe]=255&N,xe+=Te,N/=256,D-=8);for(F=F<<D|N,q+=D;q>0;d[v+xe]=255&F,xe+=Te,F/=256,q-=8);d[v+xe-Te]|=128*fe}},function(o,u){var d={}.toString;o.exports=Array.isArray||function(y){return d.call(y)=="[object Array]"}},function(o,u){var d,y,v=o.exports={};function r(){throw new Error("setTimeout has not been defined")}function D(){throw new Error("clearTimeout has not been defined")}function B(Te){if(d===setTimeout)return setTimeout(Te,0);if((d===r||!d)&&setTimeout)return d=setTimeout,setTimeout(Te,0);try{return d(Te,0)}catch{try{return d.call(null,Te,0)}catch{return d.call(this,Te,0)}}}(function(){try{d=typeof setTimeout=="function"?setTimeout:r}catch{d=r}try{y=typeof clearTimeout=="function"?clearTimeout:D}catch{y=D}})();var F,N=[],Q=!1,q=-1;function X(){Q&&F&&(Q=!1,F.length?N=F.concat(N):q=-1,N.length&&G())}function G(){if(!Q){var Te=B(X);Q=!0;for(var fe=N.length;fe;){for(F=N,N=[];++q<fe;)F&&F[q].run();q=-1,fe=N.length}F=null,Q=!1,function(ne){if(y===clearTimeout)return clearTimeout(ne);if((y===D||!y)&&clearTimeout)return y=clearTimeout,clearTimeout(ne);try{y(ne)}catch{try{return y.call(null,ne)}catch{return y.call(this,ne)}}}(Te)}}function ae(Te,fe){this.fun=Te,this.array=fe}function xe(){}v.nextTick=function(Te){var fe=new Array(arguments.length-1);if(arguments.length>1)for(var ne=1;ne<arguments.length;ne++)fe[ne-1]=arguments[ne];N.push(new ae(Te,fe)),N.length!==1||Q||B(G)},ae.prototype.run=function(){this.fun.apply(null,this.array)},v.title="browser",v.browser=!0,v.env={},v.argv=[],v.version="",v.versions={},v.on=xe,v.addListener=xe,v.once=xe,v.off=xe,v.removeListener=xe,v.removeAllListeners=xe,v.emit=xe,v.prependListener=xe,v.prependOnceListener=xe,v.listeners=function(Te){return[]},v.binding=function(Te){throw new Error("process.binding is not supported")},v.cwd=function(){return"/"},v.chdir=function(Te){throw new Error("process.chdir is not supported")},v.umask=function(){return 0}},function(o,u,d){d.r(u);var y=d(6),v=d.n(y),r=d(3),D=d.n(r);function B(G){return G===""?G:G==="true"||G=="1"}var F=function(G,ae){return new Promise(function(xe,Te){var fe=new XMLHttpRequest;fe.responseType="blob",fe.onload=function(){var ne=new FileReader;ne.onloadend=function(){xe(ne.result)},ne.readAsArrayBuffer(fe.response)},fe.open("GET",G),fe.send()})},N=d(9),Q=function(G,ae,xe,Te,fe,ne,ue,ye){var le,re=typeof G=="function"?G.options:G;if(ae&&(re.render=ae,re.staticRenderFns=xe,re._compiled=!0),Te&&(re.functional=!0),ne&&(re._scopeId="data-v-"+ne),ue?(le=function(Ae){(Ae=Ae||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||typeof __VUE_SSR_CONTEXT__>"u"||(Ae=__VUE_SSR_CONTEXT__),fe&&fe.call(this,Ae),Ae&&Ae._registeredComponents&&Ae._registeredComponents.add(ue)},re._ssrRegister=le):fe&&(le=ye?function(){fe.call(this,(re.functional?this.parent:this).$root.$options.shadowRoot)}:fe),le)if(re.functional){re._injectStyles=le;var oe=re.render;re.render=function(Ae,De){return le.call(De),oe(Ae,De)}}else{var se=re.beforeCreate;re.beforeCreate=se?[].concat(se,le):[le]}return{exports:G,options:re}}({props:{text:{type:String,required:!0},qid:{type:String},correctLevel:{type:Number,default:1},size:{type:Number,default:200},margin:{type:Number,default:20},colorDark:{type:String,default:"#000000"},colorLight:{type:String,default:"#FFFFFF"},bgSrc:{type:String,default:void 0},background:{type:String,default:"rgba(0,0,0,0)"},backgroundDimming:{type:String,default:"rgba(0,0,0,0)"},logoSrc:{type:String,default:void 0},logoBackgroundColor:{type:String,default:"rgba(255,255,255,1)"},gifBgSrc:{type:String,default:void 0},logoScale:{type:Number,default:.2},logoMargin:{type:Number,default:0},logoCornerRadius:{type:Number,default:8},whiteMargin:{type:[Boolean,String],default:!0},dotScale:{type:Number,default:1},autoColor:{type:[Boolean,String],default:!0},binarize:{type:[Boolean,String],default:!1},binarizeThreshold:{type:Number,default:128},callback:{type:Function,default:function(){}},bindElement:{type:Boolean,default:!0},backgroundColor:{type:String,default:"#FFFFFF"},components:{default:function(){return{data:{scale:1},timing:{scale:1,protectors:!1},alignment:{scale:1,protectors:!1},cornerAlignment:{scale:1,protectors:!0}}}}},name:"vue-qr",data:function(){return{imgUrl:""}},watch:{$props:{deep:!0,handler:function(){this.main()}}},mounted:function(){this.main()},methods:{main:function(){var G=this;return v()(D.a.mark(function ae(){var xe,Te,fe,ne;return D.a.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:if(!G.gifBgSrc){ue.next=7;break}return ue.next=3,F(G.gifBgSrc);case 3:return xe=ue.sent,Te=G.logoSrc,G.render(void 0,Te,xe),ue.abrupt("return");case 7:fe=G.bgSrc,ne=G.logoSrc,G.render(fe,ne);case 10:case"end":return ue.stop()}},ae)}))()},render:function(G,ae,xe){var Te=this;return v()(D.a.mark(function fe(){var ne;return D.a.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:ne=Te,new N.a({gifBackground:xe,text:ne.text,size:ne.size,margin:ne.margin,colorDark:ne.colorDark,colorLight:ne.colorLight,backgroundColor:ne.backgroundColor,backgroundImage:G,backgroundDimming:ne.backgroundDimming,logoImage:ae,logoScale:ne.logoScale,logoBackgroundColor:ne.logoBackgroundColor,correctLevel:ne.correctLevel,logoMargin:ne.logoMargin,logoCornerRadius:ne.logoCornerRadius,whiteMargin:B(ne.whiteMargin),dotScale:ne.dotScale,autoColor:B(ne.autoColor),binarize:B(ne.binarize),binarizeThreshold:ne.binarizeThreshold,components:ne.components}).draw().then(function(ye){Te.imgUrl=ye,ne.callback&&ne.callback(ye,ne.qid)});case 2:case"end":return ue.stop()}},fe)}))()}}},function(){var G=this.$createElement,ae=this._self._c||G;return this.bindElement?ae("img",{staticStyle:{display:"inline-block"},attrs:{src:this.imgUrl}}):this._e()},[],!1,null,null,null).exports;Q.install=function(G){return G.component(Q.name,Q)};var q=Q,X=[q];typeof window<"u"&&window.Vue&&function(G){X.map(function(ae){G.component(ae.name,ae)})}(window.Vue),u.default=q}])})})(x4);var rie=x4.exports;const nie=$z(rie),sie={components:{VueQr:nie},props:{pelicula_nueva:Object},computed:{qrText(){return!this.pelicula_nueva||!this.pelicula_nueva.id?"":`/Filmoss/public/pelicula_nueva/${this.pelicula_nueva.id}`}}};function oie(n,e,o,u,d,y){const v=tA("vue-qr");return zt(),Nt("div",null,[y.qrText?(zt(),C0(v,{key:0,text:y.qrText,size:200},null,8,["text"])):Jn("",!0)])}const aie=Wn(sie,[["render",oie]]);const lie={props:{idCategoria:{type:Number,required:!0}},data(){return{peliculas:[]}},computed:{ultimasPeliculas(){return this.peliculas.slice(-5)}},methods:{cargarPeliculasPorCategoria(){bs.get(`/categorias/${this.idCategoria}/peliculas`).then(n=>{this.peliculas=n.data}).catch(n=>{console.log(n)})}},watch:{idCategoria(n){this.cargarPeliculasPorCategoria()}},mounted(){this.cargarPeliculasPorCategoria()}},cie={key:0,class:"has-visto-interior"},uie=["href"];function hie(n,e,o,u,d,y){return y.ultimasPeliculas.length>0?(zt(),Nt("div",cie,[(zt(!0),Nt(ur,null,_n(y.ultimasPeliculas,(v,r)=>(zt(),Nt("div",{key:r},[K("a",{href:`/public/pelicula/${v.id}`,style:{"text-decoration":"none",color:"inherit"}},[r===0?(zt(),Nt("div",{key:0,class:"has-visto-1",style:Ps({backgroundImage:`linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url(${v.image})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[K("div",null,[K("h3",null,oi(v.titulo),1)])],4)):(zt(),Nt("div",{key:1,class:"has-visto-1",style:Ps({backgroundImage:`linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url(${v.image})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[K("h3",null,oi(v.titulo),1)],4))],8,uie)]))),128))])):Jn("",!0)}const die=Wn(lie,[["render",hie],["__scopeId","data-v-78479ead"]]);const fie={class:"carrusel-categoria"},pie={class:"carrusel-coverflow"},mie=["onClick"],_ie=["href"],gie={__name:"categoria-tesorpendera",props:{idCategoria:{type:Number,required:!0}},setup(n){const e=n,o=Bs([]),u=Bs(0),d=async()=>{try{const v=await bs.get(`/categorias/${e.idCategoria}/peliculas`);o.value=v.data.slice(-5),u.value=0}catch(v){console.error(v)}};Sl(d),Ua(()=>e.idCategoria,d);const y=v=>{v>=0&&v<o.value.length&&(u.value=v)};return(v,r)=>(zt(),Nt("div",fie,[r[1]||(r[1]=K("h1",null,"Te sorprenderán",-1)),K("div",pie,[(zt(!0),Nt(ur,null,_n(o.value,(D,B)=>(zt(),Nt("div",{key:D.id,class:rh(["slide",{active:B===u.value,prev:B===u.value-1,next:B===u.value+1}]),style:Ps({backgroundImage:`linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.5)), url(${D.image})`}),onClick:F=>y(B)},[K("a",{href:`/public/pelicula/${D.id}`,onClick:r[0]||(r[0]=Jb(()=>{},["stop"])),style:{"text-decoration":"none",color:"inherit"}},[K("h3",null,oi(D.titulo),1)],8,_ie)],14,mie))),128))])]))}},yie=Wn(gie,[["__scopeId","data-v-a813f00b"]]);const vie={class:"novedades"},xie={class:"carousel-wrapper"},bie=["href"],wie={__name:"categoria-novedades",props:{idCategoria:Number},setup(n){const e=n,o=Bs([]);async function u(){try{const y=await bs.get(`/categorias/${e.idCategoria}/peliculas`);o.value=y.data.slice(-10)}catch(y){console.error(y)}}Sl(u),Ua(()=>e.idCategoria,u);const d=Bs(null);return Sl(()=>{setInterval(()=>{d.value&&d.value.scrollBy({left:300,behavior:"smooth"})},3e3)}),(y,v)=>(zt(),Nt("div",vie,[v[0]||(v[0]=K("h4",null,"Novedades",-1)),K("div",xie,[K("div",{class:"carousel",ref_key:"carouselRef",ref:d},[(zt(!0),Nt(ur,null,_n(o.value,r=>(zt(),Nt("div",{key:r.id,class:"novedades-1",style:Ps({backgroundImage:`linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.5)), url(${r.image})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[K("a",{href:`/public/pelicula/${r.id}`},[K("h3",null,oi(r.titulo),1)],8,bie)],4))),128))],512)])]))}},Tie=Wn(wie,[["__scopeId","data-v-2c6138ef"]]);const Eie={class:"novedades"},Sie={class:"carousel-wrapper"},Aie=["href"],Cie={__name:"catalogo-destacanseguntusgustos",props:{idCategoria:Number},setup(n){const e=n,o=Bs([]);async function u(){try{const y=await bs.get("pelicula");o.value=y.data.slice(-8)}catch(y){console.error(y)}}Sl(u),Ua(()=>e.idCategoria,u);const d=Bs(null);return Sl(()=>{setInterval(()=>{d.value&&d.value.scrollBy({left:300,behavior:"smooth"})},3e3)}),(y,v)=>(zt(),Nt("div",Eie,[K("div",Sie,[K("div",{class:"carousel",ref_key:"carouselRef",ref:d},[(zt(!0),Nt(ur,null,_n(o.value,r=>(zt(),Nt("div",{key:r.id,class:"novedades-1",style:Ps({backgroundImage:`linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.5)), url(${r.image})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[K("a",{href:`/public/pelicula/${r.id}`},[K("h3",null,oi(r.titulo),1)],8,Aie)],4))),128))],512)])]))}},Mie=Wn(Cie,[["__scopeId","data-v-403a572e"]]),Iie="/build/assets/Google_Pay_Logo-ef36f158.png",Pie="/build/assets/Mastercard-logo-017bde04.png",Rie="/build/assets/Paypal_logo-256d711a.png",Die="/build/assets/Visa_Logo-f031699e.png",Oie="/build/assets/filmo-logo-759b2c08.png",Lie="/build/assets/fondo-e508c089.jpg",kie="/build/assets/log-4c4ed2a2.png",zie="/build/assets/personas-5a76067c.png",Fie="/build/assets/terror-ej-b26f450a.jpg";const Bie={data(){return{visible:!1,visiblePrecio:!1,subscripciones:[],suscripcionSeleccionada:null}},mounted(){this.getSuscripciones(),localStorage.getItem("pagoMostrado")||(this.visiblePrecio=!0)},methods:{async getSuscripciones(){try{const n=await bs.get("subscripcion");console.log(n.data),this.subscripciones=n.data}catch(n){console.error("Error al obtener las suscripciones:",n)}},abrirMetodoPago(n){const e=this;e.suscripcionSeleccionada=n,e.visiblePrecio=!1,e.visible=!0},cerrarModal(){this.visible=!1,localStorage.setItem("pagoMostrado","true")},cerrarAmbosModales(){this.visiblePrecio=!1,this.visible=!1,localStorage.setItem("pagoMostrado","true")},getImageUrl(n){return new URL(Object.assign({"/public/images/Google_Pay_Logo.png":Iie,"/public/images/Mastercard-logo.png":Pie,"/public/images/Paypal_logo.png":Rie,"/public/images/Visa_Logo.png":Die,"/public/images/filmo-logo.png":Oie,"/public/images/fondo.jpg":Lie,"/public/images/log.png":kie,"/public/images/personas.png":zie,"/public/images/terror-ej.jpg":Fie})[`/public/images/${n}`],self.location).href}}},Nie={key:0,class:"modal-overlay"},Vie={class:"modal-container"},Uie={class:"metodo_pagos"},jie={class:"titulo-metodo_pago_precio"},$ie=["onClick"],qie={key:1,class:"modal-overlay"},Hie={class:"modal-container"},Gie={class:"metodo_pago"},Wie={class:"imagenes-metodo_pago"},Zie=["src"],Yie=["src"],Xie=["src"],Kie=["src"],Jie={class:"formulario-metodo_pago"};function Qie(n,e,o,u,d,y){return zt(),Nt("div",null,[d.visiblePrecio?(zt(),Nt("div",Nie,[K("div",Vie,[K("div",Uie,[K("button",{class:"cerrar-modal",onClick:e[0]||(e[0]=(...v)=>y.cerrarAmbosModales&&y.cerrarAmbosModales(...v))},"✕"),e[5]||(e[5]=K("div",{class:"titulo-metodo_pago_precio"},[K("h1",null,[K("strong",null,"SUSCRIPCIÓN")])],-1)),(zt(!0),Nt(ur,null,_n(d.subscripciones,v=>(zt(),Nt("div",{class:"boton-pago",key:v.id},[K("div",jie,[e[3]||(e[3]=K("h1",null,[K("strong",null,"PLAN MENSUAL")],-1)),K("h1",null,[K("strong",null,oi(v.tipo_subscripcion),1)]),K("button",{onClick:r=>y.abrirMetodoPago(v),class:"btn btn-primary"},oi(v.precio)+" € + IVA ",9,$ie),e[4]||(e[4]=K("div",{class:"preciomanual"},[K("h3",null,"59.99€ anuales")],-1))])]))),128))])])])):Jn("",!0),d.visible?(zt(),Nt("div",qie,[K("div",Hie,[K("div",Gie,[K("button",{class:"cerrar-modal",onClick:e[1]||(e[1]=(...v)=>y.cerrarModal&&y.cerrarModal(...v))},"✕"),e[7]||(e[7]=K("div",{class:"titulo-metodo_pago"},[K("h1",null,[Eo("AÑADIR METODO DE "),K("span",null,"PAGO")])],-1)),K("div",Wie,[K("img",{id:"mastercard",src:y.getImageUrl("Mastercard-logo.png"),alt:"Mastercard"},null,8,Zie),K("img",{id:"visa",src:y.getImageUrl("Visa_Logo.png"),alt:"Visa"},null,8,Yie),K("img",{id:"paypal",src:y.getImageUrl("Paypal_logo.png"),alt:"Paypal"},null,8,Xie),K("img",{id:"google",src:y.getImageUrl("Google_Pay_Logo.png"),alt:"Google Pay"},null,8,Kie)]),K("div",Jie,[K("form",{onSubmit:e[2]||(e[2]=Jb((...v)=>y.cerrarModal&&y.cerrarModal(...v),["prevent"]))},e[6]||(e[6]=[x_('<label for="tipo-tarjeta" data-v-2b93aa1b><h3 data-v-2b93aa1b>Tipo tarjeta</h3></label><select class="form-select" id="tipo-tarjeta" data-v-2b93aa1b><option selected data-v-2b93aa1b>-</option><option value="1" data-v-2b93aa1b>MasterCard</option><option value="2" data-v-2b93aa1b>Visa</option><option value="3" data-v-2b93aa1b>PayPal</option><option value="4" data-v-2b93aa1b>GooglePay</option></select><div class="mb-3" data-v-2b93aa1b><label for="nombre-titular" data-v-2b93aa1b><h3 data-v-2b93aa1b>Nombre del titular</h3></label><input type="text" required class="form-control" id="nombre-titular" placeholder="Introduce el nombre del titular" data-v-2b93aa1b></div><div class="mb-3" data-v-2b93aa1b><label for="numero-tarjeta" data-v-2b93aa1b><h3 data-v-2b93aa1b>Número de tarjeta</h3></label><input type="text" required class="form-control" maxlength="16" id="numero-tarjeta" placeholder="0000-0000-0000-0000" data-v-2b93aa1b></div>',4),K("div",{class:"fecha-cvv"},[K("div",{class:"mb-3"},[K("label",{for:"fecha-cad"},[K("h3",null,"Fecha caducidad")]),K("input",{type:"date",required:"",class:"form-control",id:"fecha-cad"})]),K("div",{class:"mb-3"},[K("label",{for:"cvv"},[K("h3",null,"CVV")]),K("input",{type:"text",required:"",class:"form-control",id:"cvv",placeholder:"000",maxlength:"3",inputmode:"numeric"})])],-1),x_('<div class="form-check" data-v-2b93aa1b><input class="form-check-input" required type="checkbox" id="checkDefault" data-v-2b93aa1b><label class="form-check-label" for="checkDefault" data-v-2b93aa1b><p data-v-2b93aa1b>Acepto las políticas de privacidad</p></label></div><div class="boton-pago" data-v-2b93aa1b><button type="submit" class="btn btn-primary" id="boton-pago" data-v-2b93aa1b>PAGAR</button></div>',2)]),32)])])])])):Jn("",!0)])}const ere=Wn(Bie,[["render",Qie],["__scopeId","data-v-2b93aa1b"]]);const tre={style:{display:"flex","justify-content":"space-between","align-items":"center"}},ire={xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"20",height:"20",viewBox:"0,0,256,256",style:{fill:"#40C057"}},rre={class:"chat-en-curso"},nre={class:"hora-envio-chat"},sre={style:{"font-size":"0.75rem",color:"gray",margin:"5px 0 4px 0"}},ore={class:"usuario-mas-mensaje"},are={class:"nombre-usuario-chat"},lre={class:"mensaje-usuario"},cre={class:"enviar-chat"},ure={class:"input-group mb-3"},hre=["onKeypress"],dre={__name:"chat",props:{peliculaId:Number,hora:TimeRanges,eventoId:Number,usuarioId:Number},setup(n){const e=n,o=Bs(!1),u=Bs(!0),d=Bs(""),y=Bs([]),v=Bs(null),r=()=>{o.value=!0,B()},D=()=>{o.value=!1},B=async()=>{try{const N=await bs.get(`/pelicula_nueva/${e.peliculaId}/${e.hora}/${e.eventoId}/chat`);y.value=N.data}catch(N){console.error("Error al cargar los mensajes:",N)}},F=async()=>{if(d.value.trim())try{const N=await bs.post(`/pelicula_nueva/${e.peliculaId}/${e.hora}/${e.eventoId}/chat`,{mensaje:d.value,evento_pelicula_id:e.eventoId,usuario_id:e.usuarioId});y.value.push({mensaje:d.value,enviado:!0,usuario:{nombre:"Tú"},fecha:new Date().toLocaleTimeString()}),d.value="",scrollToBottom()}catch(N){console.error("Error completo:",N),N.response&&(console.error("Datos del error:",N.response.data),console.error("Status:",N.response.status),console.error("Headers:",N.response.headers))}};return Sl(()=>{B()}),(N,Q)=>(zt(),Nt(ur,null,[u.value?(zt(),Nt("div",{key:0,class:"boton-mostrar-chat",onClick:r},Q[1]||(Q[1]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",fill:"#2EBFA5",viewBox:"0 0 24 24"},[K("path",{d:"M9 18l6-6-6-6"})],-1)]))):Jn("",!0),K("div",{id:"chat-lateral",style:Ps({right:o.value?"0":"-400px"})},[K("div",tre,[Q[3]||(Q[3]=K("img",{src:"https://i.postimg.cc/x1c4B87p/Ellipse-49.png",alt:"Logo",style:{width:"20px",height:"20px"}},null,-1)),Q[4]||(Q[4]=K("h3",null,"Live chat",-1)),K("button",{id:"cerrar-chat",onClick:D},[(zt(),Nt("svg",ire,Q[2]||(Q[2]=[K("g",{fill:"#40c057","fill-rule":"nonzero",stroke:"none","stroke-width":"1","stroke-linecap":"butt","stroke-linejoin":"miter","stroke-miterlimit":"10","stroke-dasharray":"","stroke-dashoffset":"0","font-family":"none","font-weight":"none","font-size":"none","text-anchor":"none",style:{"mix-blend-mode":"normal"}},[K("g",{transform:"scale(10.66667,10.66667)"},[K("path",{d:"M19.99023,2.98633c-0.26377,0.00624 -0.51439,0.11645 -0.69727,0.30664l-7.29297,7.29297l-7.29297,-7.29297c-0.18827,-0.19353 -0.4468,-0.30272 -0.7168,-0.30273c-0.40692,0.00011 -0.77321,0.24676 -0.92633,0.62377c-0.15312,0.37701 -0.06255,0.80921 0.22907,1.09303l7.29297,7.29297l-7.29297,7.29297c-0.26124,0.25082 -0.36647,0.62327 -0.27511,0.97371c0.09136,0.35044 0.36503,0.62411 0.71547,0.71547c0.35044,0.09136 0.72289,-0.01388 0.97371,-0.27511l7.29297,-7.29297l7.29297,7.29297c0.25082,0.26124 0.62327,0.36648 0.97371,0.27512c0.35044,-0.09136 0.62411,-0.36503 0.71547,-0.71547c0.09136,-0.35044 -0.01388,-0.72289 -0.27512,-0.97371l-7.29297,-7.29297l7.29297,-7.29297c0.29724,-0.28583 0.38857,-0.7248 0.23,-1.10546c-0.15857,-0.38066 -0.53454,-0.62497 -0.94679,-0.61524z"})])],-1)])))])]),K("div",rre,[K("div",{class:"interior-chat-en-curso",ref_key:"contenedorChat",ref:v},[(zt(!0),Nt(ur,null,_n(y.value,(q,X)=>(zt(),Nt("div",{key:X,class:"bloque-mensaje"},[K("div",nre,[K("p",sre,oi(q.fecha),1)]),K("div",ore,[K("div",are,oi(q.enviado?q.usuario.nombre:"Otro Usuario"),1),K("div",lre,[K("p",null,oi(q.mensaje),1)])])]))),128))],512)]),K("div",cre,[K("div",ure,[tn(K("input",{"onUpdate:modelValue":Q[0]||(Q[0]=q=>d.value=q),onKeypress:T5(Jb(F,["prevent"]),["enter"]),type:"text",class:"form-control",placeholder:"Escribe tu mensaje"},null,40,hre),[[hn,d.value]]),K("button",{class:"btn btn-secondary",type:"button",onClick:F},">")])])],4)],64))}},fre=Wn(dre,[["__scopeId","data-v-aa48686f"]]);const pre={data(){return{peliculas:[],moviesChart:null}},mounted(){this.getPeliculas()},methods:{getPeliculas(){bs.get("pelicula").then(n=>{this.peliculas=n.data,this.renderChart()}).catch(n=>{console.log(n)})},renderChart(){const n=document.getElementById("moviesChart");if(!n)return;const o=this.peliculas.map(y=>new Date(y.fecha_estreno).getFullYear()).reduce((y,v)=>(y[v]=(y[v]||0)+1,y),{}),u=Object.keys(o).sort(),d=u.map(y=>o[y]);this.moviesChart&&this.moviesChart.destroy(),this.moviesChart=new Chart(n,{type:"bar",data:{labels:u,datasets:[{label:"Películas estrenadas",data:d,backgroundColor:"#36A2EB",borderRadius:5}]},options:{responsive:!0,plugins:{legend:{display:!1},tooltip:{callbacks:{label:y=>`${y.label}: ${y.raw} película(s)`}}},scales:{y:{beginAtZero:!0,ticks:{precision:0}}}}})}},beforeUnmount(){this.moviesChart&&this.moviesChart.destroy()}},mre={class:"chart-container"};function _re(n,e,o,u,d,y){return zt(),Nt("div",mre,e[0]||(e[0]=[K("h2",null,"Películas estrenadas por año",-1),K("canvas",{id:"moviesChart"},null,-1)]))}const gre=Wn(pre,[["render",_re],["__scopeId","data-v-189396d9"]]);const yre={props:{idUsuario:{type:Number,required:!0}},data(){return{usuario:null,peliculas:[]}},computed:{ultimasPeliculas(){return this.peliculas.slice(-5)}},mounted(){this.obtenerPerfil()},created(){bs.get("pelicula").then(n=>{this.peliculas=n.data}).catch(n=>{console.log(n)})},methods:{obtenerPerfil(){bs.get(`usuario/${this.idUsuario}`).then(n=>{this.usuario=n.data}).catch(n=>{console.error("Error al obtener perfil con Axios:",n)})},obtenerPelisculasVistas(){bs.get(`usuario/${this.idUsuario}/peliculas`).then(n=>{this.peliculas=n.data}).catch(n=>{console.error("Error al obtener peliculas vistas:",n)})}}},vre={key:0,class:"perfil"},xre={class:"contenido-texto"},bre={class:"peliculas-vistas"},wre={class:"pelis-destacadas"},Tre=["href"];function Ere(n,e,o,u,d,y){return zt(),Nt(ur,null,[d.usuario?(zt(),Nt("div",vre,[e[1]||(e[1]=K("img",{src:"https://i.postimg.cc/ZKjxw3XV/al-pacino-dans-une-scene-du-film-scarface-1.png",alt:"",class:"imagen-perfil"},null,-1)),e[2]||(e[2]=K("div",{class:"linea-vertical"},null,-1)),K("div",xre,[K("h1",null,"Perfil: "+oi(d.usuario.nombre),1),e[0]||(e[0]=K("p",null,"Perfil de filmo para ver las películas vistas y tremendas películas que hay para ver, madre mía no tienes tiempo para tanta película.",-1))])])):Jn("",!0),K("div",bre,[e[3]||(e[3]=K("h1",null,"Peliculas vistas",-1)),K("div",wre,[(zt(!0),Nt(ur,null,_n(y.ultimasPeliculas,(v,r)=>(zt(),Nt("a",{class:"url-peli",key:r,href:`/public/pelicula/${v.id}`},[K("div",{class:"destacada1",style:Ps({backgroundImage:`linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url(${v.image})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[K("p",null,oi(v.titulo),1)],4)],8,Tre))),128))])])],64)}const Sre=Wn(yre,[["render",Ere],["__scopeId","data-v-c49997e5"]]),Zn=Qx({});Zn.component("portada-categoria",Bee);Zn.component("pelicula",OQ);Zn.component("seguir-viendo",bQ);Zn.component("pelicula-destacada",dQ);Zn.component("nav-desplegable",OJ);Zn.component("actor-crud",oQ);Zn.component("film",QZ);Zn.component("scroll",CY);Zn.component("usuario-update",tX);Zn.component("peliculas-crud",zX);Zn.component("pelicula-crud",YK);Zn.component("eventos-crud",hK);Zn.component("mapa",rJ);Zn.component("cines-crud",PJ);Zn.component("categoria-crud",nee);Zn.component("categorias",cee);Zn.component("animation-catalogo",_ee);Zn.component("peliculas-recientemente",Aee);Zn.component("estadisticas",Pee);Zn.component("estadisticas-pelis",gre);Zn.component("escanearqr",iie);Zn.component("generarqr",aie);Zn.component("categoria-yahasvisto",die);Zn.component("categoria-tesorpendera",yie);Zn.component("categoria-novedades",Tie);Zn.component("catalogo-destacanseguntusgustos",Mie);Zn.component("metodo-pago",ere);Zn.component("chat",fre);Zn.component("perfil",Sre);Zn.mount("#app");
//# sourceMappingURL=app-ee30d091.js.map
