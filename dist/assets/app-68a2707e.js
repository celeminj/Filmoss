var V5=Object.defineProperty;var U5=(r,t,l)=>t in r?V5(r,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[t]=l;var Li=(r,t,l)=>(U5(r,typeof t!="symbol"?t+"":t,l),l);var io="top",jo="bottom",$o="right",no="left",t1="auto",Lp=[io,jo,$o,no],hd="start",fp="end",pP="clippingParents",NT="viewport",Zf="popper",mP="reference",Rw=Lp.reduce(function(r,t){return r.concat([t+"-"+hd,t+"-"+fp])},[]),BT=[].concat(Lp,[t1]).reduce(function(r,t){return r.concat([t,t+"-"+hd,t+"-"+fp])},[]),_P="beforeRead",gP="read",yP="afterRead",vP="beforeMain",xP="main",bP="afterMain",wP="beforeWrite",TP="write",EP="afterWrite",SP=[_P,gP,yP,vP,xP,bP,wP,TP,EP];function Al(r){return r?(r.nodeName||"").toLowerCase():null}function qo(r){if(r==null)return window;if(r.toString()!=="[object Window]"){var t=r.ownerDocument;return t&&t.defaultView||window}return r}function dd(r){var t=qo(r).Element;return r instanceof t||r instanceof Element}function xa(r){var t=qo(r).HTMLElement;return r instanceof t||r instanceof HTMLElement}function VT(r){if(typeof ShadowRoot>"u")return!1;var t=qo(r).ShadowRoot;return r instanceof t||r instanceof ShadowRoot}function j5(r){var t=r.state;Object.keys(t.elements).forEach(function(l){var f=t.styles[l]||{},_=t.attributes[l]||{},b=t.elements[l];!xa(b)||!Al(b)||(Object.assign(b.style,f),Object.keys(_).forEach(function(T){var n=_[T];n===!1?b.removeAttribute(T):b.setAttribute(T,n===!0?"":n)}))})}function $5(r){var t=r.state,l={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,l.popper),t.styles=l,t.elements.arrow&&Object.assign(t.elements.arrow.style,l.arrow),function(){Object.keys(t.elements).forEach(function(f){var _=t.elements[f],b=t.attributes[f]||{},T=Object.keys(t.styles.hasOwnProperty(f)?t.styles[f]:l[f]),n=T.reduce(function(k,j){return k[j]="",k},{});!xa(_)||!Al(_)||(Object.assign(_.style,n),Object.keys(b).forEach(function(k){_.removeAttribute(k)}))})}}const UT={name:"applyStyles",enabled:!0,phase:"write",fn:j5,effect:$5,requires:["computeStyles"]};function Tl(r){return r.split("-")[0]}var ed=Math.max,_v=Math.min,pp=Math.round;function Dw(){var r=navigator.userAgentData;return r!=null&&r.brands&&Array.isArray(r.brands)?r.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function AP(){return!/^((?!chrome|android).)*safari/i.test(Dw())}function mp(r,t,l){t===void 0&&(t=!1),l===void 0&&(l=!1);var f=r.getBoundingClientRect(),_=1,b=1;t&&xa(r)&&(_=r.offsetWidth>0&&pp(f.width)/r.offsetWidth||1,b=r.offsetHeight>0&&pp(f.height)/r.offsetHeight||1);var T=dd(r)?qo(r):window,n=T.visualViewport,k=!AP()&&l,j=(f.left+(k&&n?n.offsetLeft:0))/_,U=(f.top+(k&&n?n.offsetTop:0))/b,Z=f.width/_,re=f.height/b;return{width:Z,height:re,top:U,right:j+Z,bottom:U+re,left:j,x:j,y:U}}function jT(r){var t=mp(r),l=r.offsetWidth,f=r.offsetHeight;return Math.abs(t.width-l)<=1&&(l=t.width),Math.abs(t.height-f)<=1&&(f=t.height),{x:r.offsetLeft,y:r.offsetTop,width:l,height:f}}function MP(r,t){var l=t.getRootNode&&t.getRootNode();if(r.contains(t))return!0;if(l&&VT(l)){var f=t;do{if(f&&r.isSameNode(f))return!0;f=f.parentNode||f.host}while(f)}return!1}function hc(r){return qo(r).getComputedStyle(r)}function q5(r){return["table","td","th"].indexOf(Al(r))>=0}function Ru(r){return((dd(r)?r.ownerDocument:r.document)||window.document).documentElement}function i1(r){return Al(r)==="html"?r:r.assignedSlot||r.parentNode||(VT(r)?r.host:null)||Ru(r)}function HM(r){return!xa(r)||hc(r).position==="fixed"?null:r.offsetParent}function H5(r){var t=/firefox/i.test(Dw()),l=/Trident/i.test(Dw());if(l&&xa(r)){var f=hc(r);if(f.position==="fixed")return null}var _=i1(r);for(VT(_)&&(_=_.host);xa(_)&&["html","body"].indexOf(Al(_))<0;){var b=hc(_);if(b.transform!=="none"||b.perspective!=="none"||b.contain==="paint"||["transform","perspective"].indexOf(b.willChange)!==-1||t&&b.willChange==="filter"||t&&b.filter&&b.filter!=="none")return _;_=_.parentNode}return null}function kg(r){for(var t=qo(r),l=HM(r);l&&q5(l)&&hc(l).position==="static";)l=HM(l);return l&&(Al(l)==="html"||Al(l)==="body"&&hc(l).position==="static")?t:l||H5(r)||t}function $T(r){return["top","bottom"].indexOf(r)>=0?"x":"y"}function J_(r,t,l){return ed(r,_v(t,l))}function G5(r,t,l){var f=J_(r,t,l);return f>l?l:f}function CP(){return{top:0,right:0,bottom:0,left:0}}function IP(r){return Object.assign({},CP(),r)}function PP(r,t){return t.reduce(function(l,f){return l[f]=r,l},{})}var W5=function(t,l){return t=typeof t=="function"?t(Object.assign({},l.rects,{placement:l.placement})):t,IP(typeof t!="number"?t:PP(t,Lp))};function Z5(r){var t,l=r.state,f=r.name,_=r.options,b=l.elements.arrow,T=l.modifiersData.popperOffsets,n=Tl(l.placement),k=$T(n),j=[no,$o].indexOf(n)>=0,U=j?"height":"width";if(!(!b||!T)){var Z=W5(_.padding,l),re=jT(b),se=k==="y"?io:no,ue=k==="y"?jo:$o,ne=l.rects.reference[U]+l.rects.reference[k]-T[k]-l.rects.popper[U],be=T[k]-l.rects.reference[k],De=kg(b),Be=De?k==="y"?De.clientHeight||0:De.clientWidth||0:0,Te=ne/2-be/2,me=Z[se],Ie=Be-re[U]-Z[ue],Xe=Be/2-re[U]/2+Te,je=J_(me,Xe,Ie),rt=k;l.modifiersData[f]=(t={},t[rt]=je,t.centerOffset=je-Xe,t)}}function X5(r){var t=r.state,l=r.options,f=l.element,_=f===void 0?"[data-popper-arrow]":f;_!=null&&(typeof _=="string"&&(_=t.elements.popper.querySelector(_),!_)||MP(t.elements.popper,_)&&(t.elements.arrow=_))}const RP={name:"arrow",enabled:!0,phase:"main",fn:Z5,effect:X5,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function _p(r){return r.split("-")[1]}var Y5={top:"auto",right:"auto",bottom:"auto",left:"auto"};function K5(r,t){var l=r.x,f=r.y,_=t.devicePixelRatio||1;return{x:pp(l*_)/_||0,y:pp(f*_)/_||0}}function GM(r){var t,l=r.popper,f=r.popperRect,_=r.placement,b=r.variation,T=r.offsets,n=r.position,k=r.gpuAcceleration,j=r.adaptive,U=r.roundOffsets,Z=r.isFixed,re=T.x,se=re===void 0?0:re,ue=T.y,ne=ue===void 0?0:ue,be=typeof U=="function"?U({x:se,y:ne}):{x:se,y:ne};se=be.x,ne=be.y;var De=T.hasOwnProperty("x"),Be=T.hasOwnProperty("y"),Te=no,me=io,Ie=window;if(j){var Xe=kg(l),je="clientHeight",rt="clientWidth";if(Xe===qo(l)&&(Xe=Ru(l),hc(Xe).position!=="static"&&n==="absolute"&&(je="scrollHeight",rt="scrollWidth")),Xe=Xe,_===io||(_===no||_===$o)&&b===fp){me=jo;var Ve=Z&&Xe===Ie&&Ie.visualViewport?Ie.visualViewport.height:Xe[je];ne-=Ve-f.height,ne*=k?1:-1}if(_===no||(_===io||_===jo)&&b===fp){Te=$o;var He=Z&&Xe===Ie&&Ie.visualViewport?Ie.visualViewport.width:Xe[rt];se-=He-f.width,se*=k?1:-1}}var st=Object.assign({position:n},j&&Y5),dt=U===!0?K5({x:se,y:ne},qo(l)):{x:se,y:ne};if(se=dt.x,ne=dt.y,k){var At;return Object.assign({},st,(At={},At[me]=Be?"0":"",At[Te]=De?"0":"",At.transform=(Ie.devicePixelRatio||1)<=1?"translate("+se+"px, "+ne+"px)":"translate3d("+se+"px, "+ne+"px, 0)",At))}return Object.assign({},st,(t={},t[me]=Be?ne+"px":"",t[Te]=De?se+"px":"",t.transform="",t))}function J5(r){var t=r.state,l=r.options,f=l.gpuAcceleration,_=f===void 0?!0:f,b=l.adaptive,T=b===void 0?!0:b,n=l.roundOffsets,k=n===void 0?!0:n,j={placement:Tl(t.placement),variation:_p(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:_,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,GM(Object.assign({},j,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:T,roundOffsets:k})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,GM(Object.assign({},j,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:k})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const qT={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:J5,data:{}};var P0={passive:!0};function Q5(r){var t=r.state,l=r.instance,f=r.options,_=f.scroll,b=_===void 0?!0:_,T=f.resize,n=T===void 0?!0:T,k=qo(t.elements.popper),j=[].concat(t.scrollParents.reference,t.scrollParents.popper);return b&&j.forEach(function(U){U.addEventListener("scroll",l.update,P0)}),n&&k.addEventListener("resize",l.update,P0),function(){b&&j.forEach(function(U){U.removeEventListener("scroll",l.update,P0)}),n&&k.removeEventListener("resize",l.update,P0)}}const HT={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Q5,data:{}};var eF={left:"right",right:"left",bottom:"top",top:"bottom"};function J0(r){return r.replace(/left|right|bottom|top/g,function(t){return eF[t]})}var tF={start:"end",end:"start"};function WM(r){return r.replace(/start|end/g,function(t){return tF[t]})}function GT(r){var t=qo(r),l=t.pageXOffset,f=t.pageYOffset;return{scrollLeft:l,scrollTop:f}}function WT(r){return mp(Ru(r)).left+GT(r).scrollLeft}function iF(r,t){var l=qo(r),f=Ru(r),_=l.visualViewport,b=f.clientWidth,T=f.clientHeight,n=0,k=0;if(_){b=_.width,T=_.height;var j=AP();(j||!j&&t==="fixed")&&(n=_.offsetLeft,k=_.offsetTop)}return{width:b,height:T,x:n+WT(r),y:k}}function nF(r){var t,l=Ru(r),f=GT(r),_=(t=r.ownerDocument)==null?void 0:t.body,b=ed(l.scrollWidth,l.clientWidth,_?_.scrollWidth:0,_?_.clientWidth:0),T=ed(l.scrollHeight,l.clientHeight,_?_.scrollHeight:0,_?_.clientHeight:0),n=-f.scrollLeft+WT(r),k=-f.scrollTop;return hc(_||l).direction==="rtl"&&(n+=ed(l.clientWidth,_?_.clientWidth:0)-b),{width:b,height:T,x:n,y:k}}function ZT(r){var t=hc(r),l=t.overflow,f=t.overflowX,_=t.overflowY;return/auto|scroll|overlay|hidden/.test(l+_+f)}function DP(r){return["html","body","#document"].indexOf(Al(r))>=0?r.ownerDocument.body:xa(r)&&ZT(r)?r:DP(i1(r))}function Q_(r,t){var l;t===void 0&&(t=[]);var f=DP(r),_=f===((l=r.ownerDocument)==null?void 0:l.body),b=qo(f),T=_?[b].concat(b.visualViewport||[],ZT(f)?f:[]):f,n=t.concat(T);return _?n:n.concat(Q_(i1(T)))}function Lw(r){return Object.assign({},r,{left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height})}function rF(r,t){var l=mp(r,!1,t==="fixed");return l.top=l.top+r.clientTop,l.left=l.left+r.clientLeft,l.bottom=l.top+r.clientHeight,l.right=l.left+r.clientWidth,l.width=r.clientWidth,l.height=r.clientHeight,l.x=l.left,l.y=l.top,l}function ZM(r,t,l){return t===NT?Lw(iF(r,l)):dd(t)?rF(t,l):Lw(nF(Ru(r)))}function sF(r){var t=Q_(i1(r)),l=["absolute","fixed"].indexOf(hc(r).position)>=0,f=l&&xa(r)?kg(r):r;return dd(f)?t.filter(function(_){return dd(_)&&MP(_,f)&&Al(_)!=="body"}):[]}function oF(r,t,l,f){var _=t==="clippingParents"?sF(r):[].concat(t),b=[].concat(_,[l]),T=b[0],n=b.reduce(function(k,j){var U=ZM(r,j,f);return k.top=ed(U.top,k.top),k.right=_v(U.right,k.right),k.bottom=_v(U.bottom,k.bottom),k.left=ed(U.left,k.left),k},ZM(r,T,f));return n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}function LP(r){var t=r.reference,l=r.element,f=r.placement,_=f?Tl(f):null,b=f?_p(f):null,T=t.x+t.width/2-l.width/2,n=t.y+t.height/2-l.height/2,k;switch(_){case io:k={x:T,y:t.y-l.height};break;case jo:k={x:T,y:t.y+t.height};break;case $o:k={x:t.x+t.width,y:n};break;case no:k={x:t.x-l.width,y:n};break;default:k={x:t.x,y:t.y}}var j=_?$T(_):null;if(j!=null){var U=j==="y"?"height":"width";switch(b){case hd:k[j]=k[j]-(t[U]/2-l[U]/2);break;case fp:k[j]=k[j]+(t[U]/2-l[U]/2);break}}return k}function gp(r,t){t===void 0&&(t={});var l=t,f=l.placement,_=f===void 0?r.placement:f,b=l.strategy,T=b===void 0?r.strategy:b,n=l.boundary,k=n===void 0?pP:n,j=l.rootBoundary,U=j===void 0?NT:j,Z=l.elementContext,re=Z===void 0?Zf:Z,se=l.altBoundary,ue=se===void 0?!1:se,ne=l.padding,be=ne===void 0?0:ne,De=IP(typeof be!="number"?be:PP(be,Lp)),Be=re===Zf?mP:Zf,Te=r.rects.popper,me=r.elements[ue?Be:re],Ie=oF(dd(me)?me:me.contextElement||Ru(r.elements.popper),k,U,T),Xe=mp(r.elements.reference),je=LP({reference:Xe,element:Te,strategy:"absolute",placement:_}),rt=Lw(Object.assign({},Te,je)),Ve=re===Zf?rt:Xe,He={top:Ie.top-Ve.top+De.top,bottom:Ve.bottom-Ie.bottom+De.bottom,left:Ie.left-Ve.left+De.left,right:Ve.right-Ie.right+De.right},st=r.modifiersData.offset;if(re===Zf&&st){var dt=st[_];Object.keys(He).forEach(function(At){var ni=[$o,jo].indexOf(At)>=0?1:-1,Tt=[io,jo].indexOf(At)>=0?"y":"x";He[At]+=dt[Tt]*ni})}return He}function aF(r,t){t===void 0&&(t={});var l=t,f=l.placement,_=l.boundary,b=l.rootBoundary,T=l.padding,n=l.flipVariations,k=l.allowedAutoPlacements,j=k===void 0?BT:k,U=_p(f),Z=U?n?Rw:Rw.filter(function(ue){return _p(ue)===U}):Lp,re=Z.filter(function(ue){return j.indexOf(ue)>=0});re.length===0&&(re=Z);var se=re.reduce(function(ue,ne){return ue[ne]=gp(r,{placement:ne,boundary:_,rootBoundary:b,padding:T})[Tl(ne)],ue},{});return Object.keys(se).sort(function(ue,ne){return se[ue]-se[ne]})}function lF(r){if(Tl(r)===t1)return[];var t=J0(r);return[WM(r),t,WM(t)]}function cF(r){var t=r.state,l=r.options,f=r.name;if(!t.modifiersData[f]._skip){for(var _=l.mainAxis,b=_===void 0?!0:_,T=l.altAxis,n=T===void 0?!0:T,k=l.fallbackPlacements,j=l.padding,U=l.boundary,Z=l.rootBoundary,re=l.altBoundary,se=l.flipVariations,ue=se===void 0?!0:se,ne=l.allowedAutoPlacements,be=t.options.placement,De=Tl(be),Be=De===be,Te=k||(Be||!ue?[J0(be)]:lF(be)),me=[be].concat(Te).reduce(function(dr,Wn){return dr.concat(Tl(Wn)===t1?aF(t,{placement:Wn,boundary:U,rootBoundary:Z,padding:j,flipVariations:ue,allowedAutoPlacements:ne}):Wn)},[]),Ie=t.rects.reference,Xe=t.rects.popper,je=new Map,rt=!0,Ve=me[0],He=0;He<me.length;He++){var st=me[He],dt=Tl(st),At=_p(st)===hd,ni=[io,jo].indexOf(dt)>=0,Tt=ni?"width":"height",kt=gp(t,{placement:st,boundary:U,rootBoundary:Z,altBoundary:re,padding:j}),ti=ni?At?$o:no:At?jo:io;Ie[Tt]>Xe[Tt]&&(ti=J0(ti));var li=J0(ti),ii=[];if(b&&ii.push(kt[dt]<=0),n&&ii.push(kt[ti]<=0,kt[li]<=0),ii.every(function(dr){return dr})){Ve=st,rt=!1;break}je.set(st,ii)}if(rt)for(var Pn=ue?3:1,Fn=function(Wn){var Vr=me.find(function(hs){var fr=je.get(hs);if(fr)return fr.slice(0,Wn).every(function(Us){return Us})});if(Vr)return Ve=Vr,"break"},xn=Pn;xn>0;xn--){var _i=Fn(xn);if(_i==="break")break}t.placement!==Ve&&(t.modifiersData[f]._skip=!0,t.placement=Ve,t.reset=!0)}}const OP={name:"flip",enabled:!0,phase:"main",fn:cF,requiresIfExists:["offset"],data:{_skip:!1}};function XM(r,t,l){return l===void 0&&(l={x:0,y:0}),{top:r.top-t.height-l.y,right:r.right-t.width+l.x,bottom:r.bottom-t.height+l.y,left:r.left-t.width-l.x}}function YM(r){return[io,$o,jo,no].some(function(t){return r[t]>=0})}function uF(r){var t=r.state,l=r.name,f=t.rects.reference,_=t.rects.popper,b=t.modifiersData.preventOverflow,T=gp(t,{elementContext:"reference"}),n=gp(t,{altBoundary:!0}),k=XM(T,f),j=XM(n,_,b),U=YM(k),Z=YM(j);t.modifiersData[l]={referenceClippingOffsets:k,popperEscapeOffsets:j,isReferenceHidden:U,hasPopperEscaped:Z},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":U,"data-popper-escaped":Z})}const zP={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:uF};function hF(r,t,l){var f=Tl(r),_=[no,io].indexOf(f)>=0?-1:1,b=typeof l=="function"?l(Object.assign({},t,{placement:r})):l,T=b[0],n=b[1];return T=T||0,n=(n||0)*_,[no,$o].indexOf(f)>=0?{x:n,y:T}:{x:T,y:n}}function dF(r){var t=r.state,l=r.options,f=r.name,_=l.offset,b=_===void 0?[0,0]:_,T=BT.reduce(function(U,Z){return U[Z]=hF(Z,t.rects,b),U},{}),n=T[t.placement],k=n.x,j=n.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=k,t.modifiersData.popperOffsets.y+=j),t.modifiersData[f]=T}const kP={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:dF};function fF(r){var t=r.state,l=r.name;t.modifiersData[l]=LP({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})}const XT={name:"popperOffsets",enabled:!0,phase:"read",fn:fF,data:{}};function pF(r){return r==="x"?"y":"x"}function mF(r){var t=r.state,l=r.options,f=r.name,_=l.mainAxis,b=_===void 0?!0:_,T=l.altAxis,n=T===void 0?!1:T,k=l.boundary,j=l.rootBoundary,U=l.altBoundary,Z=l.padding,re=l.tether,se=re===void 0?!0:re,ue=l.tetherOffset,ne=ue===void 0?0:ue,be=gp(t,{boundary:k,rootBoundary:j,padding:Z,altBoundary:U}),De=Tl(t.placement),Be=_p(t.placement),Te=!Be,me=$T(De),Ie=pF(me),Xe=t.modifiersData.popperOffsets,je=t.rects.reference,rt=t.rects.popper,Ve=typeof ne=="function"?ne(Object.assign({},t.rects,{placement:t.placement})):ne,He=typeof Ve=="number"?{mainAxis:Ve,altAxis:Ve}:Object.assign({mainAxis:0,altAxis:0},Ve),st=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,dt={x:0,y:0};if(Xe){if(b){var At,ni=me==="y"?io:no,Tt=me==="y"?jo:$o,kt=me==="y"?"height":"width",ti=Xe[me],li=ti+be[ni],ii=ti-be[Tt],Pn=se?-rt[kt]/2:0,Fn=Be===hd?je[kt]:rt[kt],xn=Be===hd?-rt[kt]:-je[kt],_i=t.elements.arrow,dr=se&&_i?jT(_i):{width:0,height:0},Wn=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:CP(),Vr=Wn[ni],hs=Wn[Tt],fr=J_(0,je[kt],dr[kt]),Us=Te?je[kt]/2-Pn-fr-Vr-He.mainAxis:Fn-fr-Vr-He.mainAxis,Le=Te?-je[kt]/2+Pn+fr+hs+He.mainAxis:xn+fr+hs+He.mainAxis,Ss=t.elements.arrow&&kg(t.elements.arrow),ro=Ss?me==="y"?Ss.clientTop||0:Ss.clientLeft||0:0,Ze=(At=st==null?void 0:st[me])!=null?At:0,Se=ti+Us-Ze-ro,bt=ti+Le-Ze,Bt=J_(se?_v(li,Se):li,ti,se?ed(ii,bt):ii);Xe[me]=Bt,dt[me]=Bt-ti}if(n){var Ut,yt=me==="x"?io:no,Kt=me==="x"?jo:$o,Zt=Xe[Ie],Jt=Ie==="y"?"height":"width",Ht=Zt+be[yt],Si=Zt-be[Kt],Ct=[io,no].indexOf(De)!==-1,yi=(Ut=st==null?void 0:st[Ie])!=null?Ut:0,Ai=Ct?Ht:Zt-je[Jt]-rt[Jt]-yi+He.altAxis,Gi=Ct?Zt+je[Jt]+rt[Jt]-yi-He.altAxis:Si,Wi=se&&Ct?G5(Ai,Zt,Gi):J_(se?Ai:Ht,Zt,se?Gi:Si);Xe[Ie]=Wi,dt[Ie]=Wi-Zt}t.modifiersData[f]=dt}}const FP={name:"preventOverflow",enabled:!0,phase:"main",fn:mF,requiresIfExists:["offset"]};function _F(r){return{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}}function gF(r){return r===qo(r)||!xa(r)?GT(r):_F(r)}function yF(r){var t=r.getBoundingClientRect(),l=pp(t.width)/r.offsetWidth||1,f=pp(t.height)/r.offsetHeight||1;return l!==1||f!==1}function vF(r,t,l){l===void 0&&(l=!1);var f=xa(t),_=xa(t)&&yF(t),b=Ru(t),T=mp(r,_,l),n={scrollLeft:0,scrollTop:0},k={x:0,y:0};return(f||!f&&!l)&&((Al(t)!=="body"||ZT(b))&&(n=gF(t)),xa(t)?(k=mp(t,!0),k.x+=t.clientLeft,k.y+=t.clientTop):b&&(k.x=WT(b))),{x:T.left+n.scrollLeft-k.x,y:T.top+n.scrollTop-k.y,width:T.width,height:T.height}}function xF(r){var t=new Map,l=new Set,f=[];r.forEach(function(b){t.set(b.name,b)});function _(b){l.add(b.name);var T=[].concat(b.requires||[],b.requiresIfExists||[]);T.forEach(function(n){if(!l.has(n)){var k=t.get(n);k&&_(k)}}),f.push(b)}return r.forEach(function(b){l.has(b.name)||_(b)}),f}function bF(r){var t=xF(r);return SP.reduce(function(l,f){return l.concat(t.filter(function(_){return _.phase===f}))},[])}function wF(r){var t;return function(){return t||(t=new Promise(function(l){Promise.resolve().then(function(){t=void 0,l(r())})})),t}}function TF(r){var t=r.reduce(function(l,f){var _=l[f.name];return l[f.name]=_?Object.assign({},_,f,{options:Object.assign({},_.options,f.options),data:Object.assign({},_.data,f.data)}):f,l},{});return Object.keys(t).map(function(l){return t[l]})}var KM={placement:"bottom",modifiers:[],strategy:"absolute"};function JM(){for(var r=arguments.length,t=new Array(r),l=0;l<r;l++)t[l]=arguments[l];return!t.some(function(f){return!(f&&typeof f.getBoundingClientRect=="function")})}function n1(r){r===void 0&&(r={});var t=r,l=t.defaultModifiers,f=l===void 0?[]:l,_=t.defaultOptions,b=_===void 0?KM:_;return function(n,k,j){j===void 0&&(j=b);var U={placement:"bottom",orderedModifiers:[],options:Object.assign({},KM,b),modifiersData:{},elements:{reference:n,popper:k},attributes:{},styles:{}},Z=[],re=!1,se={state:U,setOptions:function(De){var Be=typeof De=="function"?De(U.options):De;ne(),U.options=Object.assign({},b,U.options,Be),U.scrollParents={reference:dd(n)?Q_(n):n.contextElement?Q_(n.contextElement):[],popper:Q_(k)};var Te=bF(TF([].concat(f,U.options.modifiers)));return U.orderedModifiers=Te.filter(function(me){return me.enabled}),ue(),se.update()},forceUpdate:function(){if(!re){var De=U.elements,Be=De.reference,Te=De.popper;if(JM(Be,Te)){U.rects={reference:vF(Be,kg(Te),U.options.strategy==="fixed"),popper:jT(Te)},U.reset=!1,U.placement=U.options.placement,U.orderedModifiers.forEach(function(He){return U.modifiersData[He.name]=Object.assign({},He.data)});for(var me=0;me<U.orderedModifiers.length;me++){if(U.reset===!0){U.reset=!1,me=-1;continue}var Ie=U.orderedModifiers[me],Xe=Ie.fn,je=Ie.options,rt=je===void 0?{}:je,Ve=Ie.name;typeof Xe=="function"&&(U=Xe({state:U,options:rt,name:Ve,instance:se})||U)}}}},update:wF(function(){return new Promise(function(be){se.forceUpdate(),be(U)})}),destroy:function(){ne(),re=!0}};if(!JM(n,k))return se;se.setOptions(j).then(function(be){!re&&j.onFirstUpdate&&j.onFirstUpdate(be)});function ue(){U.orderedModifiers.forEach(function(be){var De=be.name,Be=be.options,Te=Be===void 0?{}:Be,me=be.effect;if(typeof me=="function"){var Ie=me({state:U,name:De,instance:se,options:Te}),Xe=function(){};Z.push(Ie||Xe)}})}function ne(){Z.forEach(function(be){return be()}),Z=[]}return se}}var EF=n1(),SF=[HT,XT,qT,UT],AF=n1({defaultModifiers:SF}),MF=[HT,XT,qT,UT,kP,OP,FP,RP,zP],YT=n1({defaultModifiers:MF});const NP=Object.freeze(Object.defineProperty({__proto__:null,afterMain:bP,afterRead:yP,afterWrite:EP,applyStyles:UT,arrow:RP,auto:t1,basePlacements:Lp,beforeMain:vP,beforeRead:_P,beforeWrite:wP,bottom:jo,clippingParents:pP,computeStyles:qT,createPopper:YT,createPopperBase:EF,createPopperLite:AF,detectOverflow:gp,end:fp,eventListeners:HT,flip:OP,hide:zP,left:no,main:xP,modifierPhases:SP,offset:kP,placements:BT,popper:Zf,popperGenerator:n1,popperOffsets:XT,preventOverflow:FP,read:gP,reference:mP,right:$o,start:hd,top:io,variationPlacements:Rw,viewport:NT,write:TP},Symbol.toStringTag,{value:"Module"}));/*!
  * Bootstrap v5.3.3 (https://getbootstrap.com/)
  * Copyright 2011-2024 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */const nu=new Map,qb={set(r,t,l){nu.has(r)||nu.set(r,new Map);const f=nu.get(r);if(!f.has(t)&&f.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(f.keys())[0]}.`);return}f.set(t,l)},get(r,t){return nu.has(r)&&nu.get(r).get(t)||null},remove(r,t){if(!nu.has(r))return;const l=nu.get(r);l.delete(t),l.size===0&&nu.delete(r)}},CF=1e6,IF=1e3,Ow="transitionend",BP=r=>(r&&window.CSS&&window.CSS.escape&&(r=r.replace(/#([^\s"#']+)/g,(t,l)=>`#${CSS.escape(l)}`)),r),PF=r=>r==null?`${r}`:Object.prototype.toString.call(r).match(/\s([a-z]+)/i)[1].toLowerCase(),RF=r=>{do r+=Math.floor(Math.random()*CF);while(document.getElementById(r));return r},DF=r=>{if(!r)return 0;let{transitionDuration:t,transitionDelay:l}=window.getComputedStyle(r);const f=Number.parseFloat(t),_=Number.parseFloat(l);return!f&&!_?0:(t=t.split(",")[0],l=l.split(",")[0],(Number.parseFloat(t)+Number.parseFloat(l))*IF)},VP=r=>{r.dispatchEvent(new Event(Ow))},lc=r=>!r||typeof r!="object"?!1:(typeof r.jquery<"u"&&(r=r[0]),typeof r.nodeType<"u"),Tu=r=>lc(r)?r.jquery?r[0]:r:typeof r=="string"&&r.length>0?document.querySelector(BP(r)):null,Op=r=>{if(!lc(r)||r.getClientRects().length===0)return!1;const t=getComputedStyle(r).getPropertyValue("visibility")==="visible",l=r.closest("details:not([open])");if(!l)return t;if(l!==r){const f=r.closest("summary");if(f&&f.parentNode!==l||f===null)return!1}return t},Eu=r=>!r||r.nodeType!==Node.ELEMENT_NODE||r.classList.contains("disabled")?!0:typeof r.disabled<"u"?r.disabled:r.hasAttribute("disabled")&&r.getAttribute("disabled")!=="false",UP=r=>{if(!document.documentElement.attachShadow)return null;if(typeof r.getRootNode=="function"){const t=r.getRootNode();return t instanceof ShadowRoot?t:null}return r instanceof ShadowRoot?r:r.parentNode?UP(r.parentNode):null},gv=()=>{},Fg=r=>{r.offsetHeight},jP=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,Hb=[],LF=r=>{document.readyState==="loading"?(Hb.length||document.addEventListener("DOMContentLoaded",()=>{for(const t of Hb)t()}),Hb.push(r)):r()},wa=()=>document.documentElement.dir==="rtl",Sa=r=>{LF(()=>{const t=jP();if(t){const l=r.NAME,f=t.fn[l];t.fn[l]=r.jQueryInterface,t.fn[l].Constructor=r,t.fn[l].noConflict=()=>(t.fn[l]=f,r.jQueryInterface)}})},_o=(r,t=[],l=r)=>typeof r=="function"?r(...t):l,$P=(r,t,l=!0)=>{if(!l){_o(r);return}const f=5,_=DF(t)+f;let b=!1;const T=({target:n})=>{n===t&&(b=!0,t.removeEventListener(Ow,T),_o(r))};t.addEventListener(Ow,T),setTimeout(()=>{b||VP(t)},_)},KT=(r,t,l,f)=>{const _=r.length;let b=r.indexOf(t);return b===-1?!l&&f?r[_-1]:r[0]:(b+=l?1:-1,f&&(b=(b+_)%_),r[Math.max(0,Math.min(b,_-1))])},OF=/[^.]*(?=\..*)\.|.*/,zF=/\..*/,kF=/::\d+$/,Gb={};let QM=1;const qP={mouseenter:"mouseover",mouseleave:"mouseout"},FF=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function HP(r,t){return t&&`${t}::${QM++}`||r.uidEvent||QM++}function GP(r){const t=HP(r);return r.uidEvent=t,Gb[t]=Gb[t]||{},Gb[t]}function NF(r,t){return function l(f){return JT(f,{delegateTarget:r}),l.oneOff&&Xt.off(r,f.type,t),t.apply(r,[f])}}function BF(r,t,l){return function f(_){const b=r.querySelectorAll(t);for(let{target:T}=_;T&&T!==this;T=T.parentNode)for(const n of b)if(n===T)return JT(_,{delegateTarget:T}),f.oneOff&&Xt.off(r,_.type,t,l),l.apply(T,[_])}}function WP(r,t,l=null){return Object.values(r).find(f=>f.callable===t&&f.delegationSelector===l)}function ZP(r,t,l){const f=typeof t=="string",_=f?l:t||l;let b=XP(r);return FF.has(b)||(b=r),[f,_,b]}function eC(r,t,l,f,_){if(typeof t!="string"||!r)return;let[b,T,n]=ZP(t,l,f);t in qP&&(T=(ue=>function(ne){if(!ne.relatedTarget||ne.relatedTarget!==ne.delegateTarget&&!ne.delegateTarget.contains(ne.relatedTarget))return ue.call(this,ne)})(T));const k=GP(r),j=k[n]||(k[n]={}),U=WP(j,T,b?l:null);if(U){U.oneOff=U.oneOff&&_;return}const Z=HP(T,t.replace(OF,"")),re=b?BF(r,l,T):NF(r,T);re.delegationSelector=b?l:null,re.callable=T,re.oneOff=_,re.uidEvent=Z,j[Z]=re,r.addEventListener(n,re,b)}function zw(r,t,l,f,_){const b=WP(t[l],f,_);b&&(r.removeEventListener(l,b,!!_),delete t[l][b.uidEvent])}function VF(r,t,l,f){const _=t[l]||{};for(const[b,T]of Object.entries(_))b.includes(f)&&zw(r,t,l,T.callable,T.delegationSelector)}function XP(r){return r=r.replace(zF,""),qP[r]||r}const Xt={on(r,t,l,f){eC(r,t,l,f,!1)},one(r,t,l,f){eC(r,t,l,f,!0)},off(r,t,l,f){if(typeof t!="string"||!r)return;const[_,b,T]=ZP(t,l,f),n=T!==t,k=GP(r),j=k[T]||{},U=t.startsWith(".");if(typeof b<"u"){if(!Object.keys(j).length)return;zw(r,k,T,b,_?l:null);return}if(U)for(const Z of Object.keys(k))VF(r,k,Z,t.slice(1));for(const[Z,re]of Object.entries(j)){const se=Z.replace(kF,"");(!n||t.includes(se))&&zw(r,k,T,re.callable,re.delegationSelector)}},trigger(r,t,l){if(typeof t!="string"||!r)return null;const f=jP(),_=XP(t),b=t!==_;let T=null,n=!0,k=!0,j=!1;b&&f&&(T=f.Event(t,l),f(r).trigger(T),n=!T.isPropagationStopped(),k=!T.isImmediatePropagationStopped(),j=T.isDefaultPrevented());const U=JT(new Event(t,{bubbles:n,cancelable:!0}),l);return j&&U.preventDefault(),k&&r.dispatchEvent(U),U.defaultPrevented&&T&&T.preventDefault(),U}};function JT(r,t={}){for(const[l,f]of Object.entries(t))try{r[l]=f}catch{Object.defineProperty(r,l,{configurable:!0,get(){return f}})}return r}function tC(r){if(r==="true")return!0;if(r==="false")return!1;if(r===Number(r).toString())return Number(r);if(r===""||r==="null")return null;if(typeof r!="string")return r;try{return JSON.parse(decodeURIComponent(r))}catch{return r}}function Wb(r){return r.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`)}const cc={setDataAttribute(r,t,l){r.setAttribute(`data-bs-${Wb(t)}`,l)},removeDataAttribute(r,t){r.removeAttribute(`data-bs-${Wb(t)}`)},getDataAttributes(r){if(!r)return{};const t={},l=Object.keys(r.dataset).filter(f=>f.startsWith("bs")&&!f.startsWith("bsConfig"));for(const f of l){let _=f.replace(/^bs/,"");_=_.charAt(0).toLowerCase()+_.slice(1,_.length),t[_]=tC(r.dataset[f])}return t},getDataAttribute(r,t){return tC(r.getAttribute(`data-bs-${Wb(t)}`))}};class Ng{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(t){return t=this._mergeConfigObj(t),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}_configAfterMerge(t){return t}_mergeConfigObj(t,l){const f=lc(l)?cc.getDataAttribute(l,"config"):{};return{...this.constructor.Default,...typeof f=="object"?f:{},...lc(l)?cc.getDataAttributes(l):{},...typeof t=="object"?t:{}}}_typeCheckConfig(t,l=this.constructor.DefaultType){for(const[f,_]of Object.entries(l)){const b=t[f],T=lc(b)?"element":PF(b);if(!new RegExp(_).test(T))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${f}" provided type "${T}" but expected type "${_}".`)}}}const UF="5.3.3";class Ka extends Ng{constructor(t,l){super(),t=Tu(t),t&&(this._element=t,this._config=this._getConfig(l),qb.set(this._element,this.constructor.DATA_KEY,this))}dispose(){qb.remove(this._element,this.constructor.DATA_KEY),Xt.off(this._element,this.constructor.EVENT_KEY);for(const t of Object.getOwnPropertyNames(this))this[t]=null}_queueCallback(t,l,f=!0){$P(t,l,f)}_getConfig(t){return t=this._mergeConfigObj(t,this._element),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}static getInstance(t){return qb.get(Tu(t),this.DATA_KEY)}static getOrCreateInstance(t,l={}){return this.getInstance(t)||new this(t,typeof l=="object"?l:null)}static get VERSION(){return UF}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(t){return`${t}${this.EVENT_KEY}`}}const Zb=r=>{let t=r.getAttribute("data-bs-target");if(!t||t==="#"){let l=r.getAttribute("href");if(!l||!l.includes("#")&&!l.startsWith("."))return null;l.includes("#")&&!l.startsWith("#")&&(l=`#${l.split("#")[1]}`),t=l&&l!=="#"?l.trim():null}return t?t.split(",").map(l=>BP(l)).join(","):null},Fi={find(r,t=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(t,r))},findOne(r,t=document.documentElement){return Element.prototype.querySelector.call(t,r)},children(r,t){return[].concat(...r.children).filter(l=>l.matches(t))},parents(r,t){const l=[];let f=r.parentNode.closest(t);for(;f;)l.push(f),f=f.parentNode.closest(t);return l},prev(r,t){let l=r.previousElementSibling;for(;l;){if(l.matches(t))return[l];l=l.previousElementSibling}return[]},next(r,t){let l=r.nextElementSibling;for(;l;){if(l.matches(t))return[l];l=l.nextElementSibling}return[]},focusableChildren(r){const t=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(l=>`${l}:not([tabindex^="-"])`).join(",");return this.find(t,r).filter(l=>!Eu(l)&&Op(l))},getSelectorFromElement(r){const t=Zb(r);return t&&Fi.findOne(t)?t:null},getElementFromSelector(r){const t=Zb(r);return t?Fi.findOne(t):null},getMultipleElementsFromSelector(r){const t=Zb(r);return t?Fi.find(t):[]}},r1=(r,t="hide")=>{const l=`click.dismiss${r.EVENT_KEY}`,f=r.NAME;Xt.on(document,l,`[data-bs-dismiss="${f}"]`,function(_){if(["A","AREA"].includes(this.tagName)&&_.preventDefault(),Eu(this))return;const b=Fi.getElementFromSelector(this)||this.closest(`.${f}`);r.getOrCreateInstance(b)[t]()})},jF="alert",$F="bs.alert",YP=`.${$F}`,qF=`close${YP}`,HF=`closed${YP}`,GF="fade",WF="show";class s1 extends Ka{static get NAME(){return jF}close(){if(Xt.trigger(this._element,qF).defaultPrevented)return;this._element.classList.remove(WF);const l=this._element.classList.contains(GF);this._queueCallback(()=>this._destroyElement(),this._element,l)}_destroyElement(){this._element.remove(),Xt.trigger(this._element,HF),this.dispose()}static jQueryInterface(t){return this.each(function(){const l=s1.getOrCreateInstance(this);if(typeof t=="string"){if(l[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);l[t](this)}})}}r1(s1,"close");Sa(s1);const ZF="button",XF="bs.button",YF=`.${XF}`,KF=".data-api",JF="active",iC='[data-bs-toggle="button"]',QF=`click${YF}${KF}`;class o1 extends Ka{static get NAME(){return ZF}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle(JF))}static jQueryInterface(t){return this.each(function(){const l=o1.getOrCreateInstance(this);t==="toggle"&&l[t]()})}}Xt.on(document,QF,iC,r=>{r.preventDefault();const t=r.target.closest(iC);o1.getOrCreateInstance(t).toggle()});Sa(o1);const e4="swipe",zp=".bs.swipe",t4=`touchstart${zp}`,i4=`touchmove${zp}`,n4=`touchend${zp}`,r4=`pointerdown${zp}`,s4=`pointerup${zp}`,o4="touch",a4="pen",l4="pointer-event",c4=40,u4={endCallback:null,leftCallback:null,rightCallback:null},h4={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class yv extends Ng{constructor(t,l){super(),this._element=t,!(!t||!yv.isSupported())&&(this._config=this._getConfig(l),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return u4}static get DefaultType(){return h4}static get NAME(){return e4}dispose(){Xt.off(this._element,zp)}_start(t){if(!this._supportPointerEvents){this._deltaX=t.touches[0].clientX;return}this._eventIsPointerPenTouch(t)&&(this._deltaX=t.clientX)}_end(t){this._eventIsPointerPenTouch(t)&&(this._deltaX=t.clientX-this._deltaX),this._handleSwipe(),_o(this._config.endCallback)}_move(t){this._deltaX=t.touches&&t.touches.length>1?0:t.touches[0].clientX-this._deltaX}_handleSwipe(){const t=Math.abs(this._deltaX);if(t<=c4)return;const l=t/this._deltaX;this._deltaX=0,l&&_o(l>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(Xt.on(this._element,r4,t=>this._start(t)),Xt.on(this._element,s4,t=>this._end(t)),this._element.classList.add(l4)):(Xt.on(this._element,t4,t=>this._start(t)),Xt.on(this._element,i4,t=>this._move(t)),Xt.on(this._element,n4,t=>this._end(t)))}_eventIsPointerPenTouch(t){return this._supportPointerEvents&&(t.pointerType===a4||t.pointerType===o4)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const d4="carousel",f4="bs.carousel",Du=`.${f4}`,KP=".data-api",p4="ArrowLeft",m4="ArrowRight",_4=500,V_="next",Uf="prev",Xf="left",Q0="right",g4=`slide${Du}`,Xb=`slid${Du}`,y4=`keydown${Du}`,v4=`mouseenter${Du}`,x4=`mouseleave${Du}`,b4=`dragstart${Du}`,w4=`load${Du}${KP}`,T4=`click${Du}${KP}`,JP="carousel",R0="active",E4="slide",S4="carousel-item-end",A4="carousel-item-start",M4="carousel-item-next",C4="carousel-item-prev",QP=".active",eR=".carousel-item",I4=QP+eR,P4=".carousel-item img",R4=".carousel-indicators",D4="[data-bs-slide], [data-bs-slide-to]",L4='[data-bs-ride="carousel"]',O4={[p4]:Q0,[m4]:Xf},z4={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},k4={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class Bg extends Ka{constructor(t,l){super(t,l),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=Fi.findOne(R4,this._element),this._addEventListeners(),this._config.ride===JP&&this.cycle()}static get Default(){return z4}static get DefaultType(){return k4}static get NAME(){return d4}next(){this._slide(V_)}nextWhenVisible(){!document.hidden&&Op(this._element)&&this.next()}prev(){this._slide(Uf)}pause(){this._isSliding&&VP(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){if(this._config.ride){if(this._isSliding){Xt.one(this._element,Xb,()=>this.cycle());return}this.cycle()}}to(t){const l=this._getItems();if(t>l.length-1||t<0)return;if(this._isSliding){Xt.one(this._element,Xb,()=>this.to(t));return}const f=this._getItemIndex(this._getActive());if(f===t)return;const _=t>f?V_:Uf;this._slide(_,l[t])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(t){return t.defaultInterval=t.interval,t}_addEventListeners(){this._config.keyboard&&Xt.on(this._element,y4,t=>this._keydown(t)),this._config.pause==="hover"&&(Xt.on(this._element,v4,()=>this.pause()),Xt.on(this._element,x4,()=>this._maybeEnableCycle())),this._config.touch&&yv.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const f of Fi.find(P4,this._element))Xt.on(f,b4,_=>_.preventDefault());const l={leftCallback:()=>this._slide(this._directionToOrder(Xf)),rightCallback:()=>this._slide(this._directionToOrder(Q0)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),_4+this._config.interval))}};this._swipeHelper=new yv(this._element,l)}_keydown(t){if(/input|textarea/i.test(t.target.tagName))return;const l=O4[t.key];l&&(t.preventDefault(),this._slide(this._directionToOrder(l)))}_getItemIndex(t){return this._getItems().indexOf(t)}_setActiveIndicatorElement(t){if(!this._indicatorsElement)return;const l=Fi.findOne(QP,this._indicatorsElement);l.classList.remove(R0),l.removeAttribute("aria-current");const f=Fi.findOne(`[data-bs-slide-to="${t}"]`,this._indicatorsElement);f&&(f.classList.add(R0),f.setAttribute("aria-current","true"))}_updateInterval(){const t=this._activeElement||this._getActive();if(!t)return;const l=Number.parseInt(t.getAttribute("data-bs-interval"),10);this._config.interval=l||this._config.defaultInterval}_slide(t,l=null){if(this._isSliding)return;const f=this._getActive(),_=t===V_,b=l||KT(this._getItems(),f,_,this._config.wrap);if(b===f)return;const T=this._getItemIndex(b),n=se=>Xt.trigger(this._element,se,{relatedTarget:b,direction:this._orderToDirection(t),from:this._getItemIndex(f),to:T});if(n(g4).defaultPrevented||!f||!b)return;const j=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(T),this._activeElement=b;const U=_?A4:S4,Z=_?M4:C4;b.classList.add(Z),Fg(b),f.classList.add(U),b.classList.add(U);const re=()=>{b.classList.remove(U,Z),b.classList.add(R0),f.classList.remove(R0,Z,U),this._isSliding=!1,n(Xb)};this._queueCallback(re,f,this._isAnimated()),j&&this.cycle()}_isAnimated(){return this._element.classList.contains(E4)}_getActive(){return Fi.findOne(I4,this._element)}_getItems(){return Fi.find(eR,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(t){return wa()?t===Xf?Uf:V_:t===Xf?V_:Uf}_orderToDirection(t){return wa()?t===Uf?Xf:Q0:t===Uf?Q0:Xf}static jQueryInterface(t){return this.each(function(){const l=Bg.getOrCreateInstance(this,t);if(typeof t=="number"){l.to(t);return}if(typeof t=="string"){if(l[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);l[t]()}})}}Xt.on(document,T4,D4,function(r){const t=Fi.getElementFromSelector(this);if(!t||!t.classList.contains(JP))return;r.preventDefault();const l=Bg.getOrCreateInstance(t),f=this.getAttribute("data-bs-slide-to");if(f){l.to(f),l._maybeEnableCycle();return}if(cc.getDataAttribute(this,"slide")==="next"){l.next(),l._maybeEnableCycle();return}l.prev(),l._maybeEnableCycle()});Xt.on(window,w4,()=>{const r=Fi.find(L4);for(const t of r)Bg.getOrCreateInstance(t)});Sa(Bg);const F4="collapse",N4="bs.collapse",Vg=`.${N4}`,B4=".data-api",V4=`show${Vg}`,U4=`shown${Vg}`,j4=`hide${Vg}`,$4=`hidden${Vg}`,q4=`click${Vg}${B4}`,Yb="show",Qf="collapse",D0="collapsing",H4="collapsed",G4=`:scope .${Qf} .${Qf}`,W4="collapse-horizontal",Z4="width",X4="height",Y4=".collapse.show, .collapse.collapsing",kw='[data-bs-toggle="collapse"]',K4={parent:null,toggle:!0},J4={parent:"(null|element)",toggle:"boolean"};class dg extends Ka{constructor(t,l){super(t,l),this._isTransitioning=!1,this._triggerArray=[];const f=Fi.find(kw);for(const _ of f){const b=Fi.getSelectorFromElement(_),T=Fi.find(b).filter(n=>n===this._element);b!==null&&T.length&&this._triggerArray.push(_)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return K4}static get DefaultType(){return J4}static get NAME(){return F4}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let t=[];if(this._config.parent&&(t=this._getFirstLevelChildren(Y4).filter(n=>n!==this._element).map(n=>dg.getOrCreateInstance(n,{toggle:!1}))),t.length&&t[0]._isTransitioning||Xt.trigger(this._element,V4).defaultPrevented)return;for(const n of t)n.hide();const f=this._getDimension();this._element.classList.remove(Qf),this._element.classList.add(D0),this._element.style[f]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const _=()=>{this._isTransitioning=!1,this._element.classList.remove(D0),this._element.classList.add(Qf,Yb),this._element.style[f]="",Xt.trigger(this._element,U4)},T=`scroll${f[0].toUpperCase()+f.slice(1)}`;this._queueCallback(_,this._element,!0),this._element.style[f]=`${this._element[T]}px`}hide(){if(this._isTransitioning||!this._isShown()||Xt.trigger(this._element,j4).defaultPrevented)return;const l=this._getDimension();this._element.style[l]=`${this._element.getBoundingClientRect()[l]}px`,Fg(this._element),this._element.classList.add(D0),this._element.classList.remove(Qf,Yb);for(const _ of this._triggerArray){const b=Fi.getElementFromSelector(_);b&&!this._isShown(b)&&this._addAriaAndCollapsedClass([_],!1)}this._isTransitioning=!0;const f=()=>{this._isTransitioning=!1,this._element.classList.remove(D0),this._element.classList.add(Qf),Xt.trigger(this._element,$4)};this._element.style[l]="",this._queueCallback(f,this._element,!0)}_isShown(t=this._element){return t.classList.contains(Yb)}_configAfterMerge(t){return t.toggle=!!t.toggle,t.parent=Tu(t.parent),t}_getDimension(){return this._element.classList.contains(W4)?Z4:X4}_initializeChildren(){if(!this._config.parent)return;const t=this._getFirstLevelChildren(kw);for(const l of t){const f=Fi.getElementFromSelector(l);f&&this._addAriaAndCollapsedClass([l],this._isShown(f))}}_getFirstLevelChildren(t){const l=Fi.find(G4,this._config.parent);return Fi.find(t,this._config.parent).filter(f=>!l.includes(f))}_addAriaAndCollapsedClass(t,l){if(t.length)for(const f of t)f.classList.toggle(H4,!l),f.setAttribute("aria-expanded",l)}static jQueryInterface(t){const l={};return typeof t=="string"&&/show|hide/.test(t)&&(l.toggle=!1),this.each(function(){const f=dg.getOrCreateInstance(this,l);if(typeof t=="string"){if(typeof f[t]>"u")throw new TypeError(`No method named "${t}"`);f[t]()}})}}Xt.on(document,q4,kw,function(r){(r.target.tagName==="A"||r.delegateTarget&&r.delegateTarget.tagName==="A")&&r.preventDefault();for(const t of Fi.getMultipleElementsFromSelector(this))dg.getOrCreateInstance(t,{toggle:!1}).toggle()});Sa(dg);const nC="dropdown",Q4="bs.dropdown",bd=`.${Q4}`,QT=".data-api",eN="Escape",rC="Tab",tN="ArrowUp",sC="ArrowDown",iN=2,nN=`hide${bd}`,rN=`hidden${bd}`,sN=`show${bd}`,oN=`shown${bd}`,tR=`click${bd}${QT}`,iR=`keydown${bd}${QT}`,aN=`keyup${bd}${QT}`,Yf="show",lN="dropup",cN="dropend",uN="dropstart",hN="dropup-center",dN="dropdown-center",Gh='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',fN=`${Gh}.${Yf}`,ev=".dropdown-menu",pN=".navbar",mN=".navbar-nav",_N=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",gN=wa()?"top-end":"top-start",yN=wa()?"top-start":"top-end",vN=wa()?"bottom-end":"bottom-start",xN=wa()?"bottom-start":"bottom-end",bN=wa()?"left-start":"right-start",wN=wa()?"right-start":"left-start",TN="top",EN="bottom",SN={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},AN={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class El extends Ka{constructor(t,l){super(t,l),this._popper=null,this._parent=this._element.parentNode,this._menu=Fi.next(this._element,ev)[0]||Fi.prev(this._element,ev)[0]||Fi.findOne(ev,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return SN}static get DefaultType(){return AN}static get NAME(){return nC}toggle(){return this._isShown()?this.hide():this.show()}show(){if(Eu(this._element)||this._isShown())return;const t={relatedTarget:this._element};if(!Xt.trigger(this._element,sN,t).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(mN))for(const f of[].concat(...document.body.children))Xt.on(f,"mouseover",gv);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Yf),this._element.classList.add(Yf),Xt.trigger(this._element,oN,t)}}hide(){if(Eu(this._element)||!this._isShown())return;const t={relatedTarget:this._element};this._completeHide(t)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(t){if(!Xt.trigger(this._element,nN,t).defaultPrevented){if("ontouchstart"in document.documentElement)for(const f of[].concat(...document.body.children))Xt.off(f,"mouseover",gv);this._popper&&this._popper.destroy(),this._menu.classList.remove(Yf),this._element.classList.remove(Yf),this._element.setAttribute("aria-expanded","false"),cc.removeDataAttribute(this._menu,"popper"),Xt.trigger(this._element,rN,t)}}_getConfig(t){if(t=super._getConfig(t),typeof t.reference=="object"&&!lc(t.reference)&&typeof t.reference.getBoundingClientRect!="function")throw new TypeError(`${nC.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return t}_createPopper(){if(typeof NP>"u")throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let t=this._element;this._config.reference==="parent"?t=this._parent:lc(this._config.reference)?t=Tu(this._config.reference):typeof this._config.reference=="object"&&(t=this._config.reference);const l=this._getPopperConfig();this._popper=YT(t,this._menu,l)}_isShown(){return this._menu.classList.contains(Yf)}_getPlacement(){const t=this._parent;if(t.classList.contains(cN))return bN;if(t.classList.contains(uN))return wN;if(t.classList.contains(hN))return TN;if(t.classList.contains(dN))return EN;const l=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return t.classList.contains(lN)?l?yN:gN:l?xN:vN}_detectNavbar(){return this._element.closest(pN)!==null}_getOffset(){const{offset:t}=this._config;return typeof t=="string"?t.split(",").map(l=>Number.parseInt(l,10)):typeof t=="function"?l=>t(l,this._element):t}_getPopperConfig(){const t={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(cc.setDataAttribute(this._menu,"popper","static"),t.modifiers=[{name:"applyStyles",enabled:!1}]),{...t,..._o(this._config.popperConfig,[t])}}_selectMenuItem({key:t,target:l}){const f=Fi.find(_N,this._menu).filter(_=>Op(_));f.length&&KT(f,l,t===sC,!f.includes(l)).focus()}static jQueryInterface(t){return this.each(function(){const l=El.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof l[t]>"u")throw new TypeError(`No method named "${t}"`);l[t]()}})}static clearMenus(t){if(t.button===iN||t.type==="keyup"&&t.key!==rC)return;const l=Fi.find(fN);for(const f of l){const _=El.getInstance(f);if(!_||_._config.autoClose===!1)continue;const b=t.composedPath(),T=b.includes(_._menu);if(b.includes(_._element)||_._config.autoClose==="inside"&&!T||_._config.autoClose==="outside"&&T||_._menu.contains(t.target)&&(t.type==="keyup"&&t.key===rC||/input|select|option|textarea|form/i.test(t.target.tagName)))continue;const n={relatedTarget:_._element};t.type==="click"&&(n.clickEvent=t),_._completeHide(n)}}static dataApiKeydownHandler(t){const l=/input|textarea/i.test(t.target.tagName),f=t.key===eN,_=[tN,sC].includes(t.key);if(!_&&!f||l&&!f)return;t.preventDefault();const b=this.matches(Gh)?this:Fi.prev(this,Gh)[0]||Fi.next(this,Gh)[0]||Fi.findOne(Gh,t.delegateTarget.parentNode),T=El.getOrCreateInstance(b);if(_){t.stopPropagation(),T.show(),T._selectMenuItem(t);return}T._isShown()&&(t.stopPropagation(),T.hide(),b.focus())}}Xt.on(document,iR,Gh,El.dataApiKeydownHandler);Xt.on(document,iR,ev,El.dataApiKeydownHandler);Xt.on(document,tR,El.clearMenus);Xt.on(document,aN,El.clearMenus);Xt.on(document,tR,Gh,function(r){r.preventDefault(),El.getOrCreateInstance(this).toggle()});Sa(El);const nR="backdrop",MN="fade",oC="show",aC=`mousedown.bs.${nR}`,CN={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},IN={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class rR extends Ng{constructor(t){super(),this._config=this._getConfig(t),this._isAppended=!1,this._element=null}static get Default(){return CN}static get DefaultType(){return IN}static get NAME(){return nR}show(t){if(!this._config.isVisible){_o(t);return}this._append();const l=this._getElement();this._config.isAnimated&&Fg(l),l.classList.add(oC),this._emulateAnimation(()=>{_o(t)})}hide(t){if(!this._config.isVisible){_o(t);return}this._getElement().classList.remove(oC),this._emulateAnimation(()=>{this.dispose(),_o(t)})}dispose(){this._isAppended&&(Xt.off(this._element,aC),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const t=document.createElement("div");t.className=this._config.className,this._config.isAnimated&&t.classList.add(MN),this._element=t}return this._element}_configAfterMerge(t){return t.rootElement=Tu(t.rootElement),t}_append(){if(this._isAppended)return;const t=this._getElement();this._config.rootElement.append(t),Xt.on(t,aC,()=>{_o(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(t){$P(t,this._getElement(),this._config.isAnimated)}}const PN="focustrap",RN="bs.focustrap",vv=`.${RN}`,DN=`focusin${vv}`,LN=`keydown.tab${vv}`,ON="Tab",zN="forward",lC="backward",kN={autofocus:!0,trapElement:null},FN={autofocus:"boolean",trapElement:"element"};class sR extends Ng{constructor(t){super(),this._config=this._getConfig(t),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return kN}static get DefaultType(){return FN}static get NAME(){return PN}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),Xt.off(document,vv),Xt.on(document,DN,t=>this._handleFocusin(t)),Xt.on(document,LN,t=>this._handleKeydown(t)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,Xt.off(document,vv))}_handleFocusin(t){const{trapElement:l}=this._config;if(t.target===document||t.target===l||l.contains(t.target))return;const f=Fi.focusableChildren(l);f.length===0?l.focus():this._lastTabNavDirection===lC?f[f.length-1].focus():f[0].focus()}_handleKeydown(t){t.key===ON&&(this._lastTabNavDirection=t.shiftKey?lC:zN)}}const cC=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",uC=".sticky-top",L0="padding-right",hC="margin-right";class Fw{constructor(){this._element=document.body}getWidth(){const t=document.documentElement.clientWidth;return Math.abs(window.innerWidth-t)}hide(){const t=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,L0,l=>l+t),this._setElementAttributes(cC,L0,l=>l+t),this._setElementAttributes(uC,hC,l=>l-t)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,L0),this._resetElementAttributes(cC,L0),this._resetElementAttributes(uC,hC)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(t,l,f){const _=this.getWidth(),b=T=>{if(T!==this._element&&window.innerWidth>T.clientWidth+_)return;this._saveInitialAttribute(T,l);const n=window.getComputedStyle(T).getPropertyValue(l);T.style.setProperty(l,`${f(Number.parseFloat(n))}px`)};this._applyManipulationCallback(t,b)}_saveInitialAttribute(t,l){const f=t.style.getPropertyValue(l);f&&cc.setDataAttribute(t,l,f)}_resetElementAttributes(t,l){const f=_=>{const b=cc.getDataAttribute(_,l);if(b===null){_.style.removeProperty(l);return}cc.removeDataAttribute(_,l),_.style.setProperty(l,b)};this._applyManipulationCallback(t,f)}_applyManipulationCallback(t,l){if(lc(t)){l(t);return}for(const f of Fi.find(t,this._element))l(f)}}const NN="modal",BN="bs.modal",Ta=`.${BN}`,VN=".data-api",UN="Escape",jN=`hide${Ta}`,$N=`hidePrevented${Ta}`,oR=`hidden${Ta}`,aR=`show${Ta}`,qN=`shown${Ta}`,HN=`resize${Ta}`,GN=`click.dismiss${Ta}`,WN=`mousedown.dismiss${Ta}`,ZN=`keydown.dismiss${Ta}`,XN=`click${Ta}${VN}`,dC="modal-open",YN="fade",fC="show",Kb="modal-static",KN=".modal.show",JN=".modal-dialog",QN=".modal-body",eB='[data-bs-toggle="modal"]',tB={backdrop:!0,focus:!0,keyboard:!0},iB={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class er extends Ka{constructor(t,l){super(t,l),this._dialog=Fi.findOne(JN,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new Fw,this._addEventListeners()}static get Default(){return tB}static get DefaultType(){return iB}static get NAME(){return NN}toggle(t){return this._isShown?this.hide():this.show(t)}show(t){this._isShown||this._isTransitioning||Xt.trigger(this._element,aR,{relatedTarget:t}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(dC),this._adjustDialog(),this._backdrop.show(()=>this._showElement(t)))}hide(){!this._isShown||this._isTransitioning||Xt.trigger(this._element,jN).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(fC),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated()))}dispose(){Xt.off(window,Ta),Xt.off(this._dialog,Ta),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new rR({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new sR({trapElement:this._element})}_showElement(t){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const l=Fi.findOne(QN,this._dialog);l&&(l.scrollTop=0),Fg(this._element),this._element.classList.add(fC);const f=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,Xt.trigger(this._element,qN,{relatedTarget:t})};this._queueCallback(f,this._dialog,this._isAnimated())}_addEventListeners(){Xt.on(this._element,ZN,t=>{if(t.key===UN){if(this._config.keyboard){this.hide();return}this._triggerBackdropTransition()}}),Xt.on(window,HN,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),Xt.on(this._element,WN,t=>{Xt.one(this._element,GN,l=>{if(!(this._element!==t.target||this._element!==l.target)){if(this._config.backdrop==="static"){this._triggerBackdropTransition();return}this._config.backdrop&&this.hide()}})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(dC),this._resetAdjustments(),this._scrollBar.reset(),Xt.trigger(this._element,oR)})}_isAnimated(){return this._element.classList.contains(YN)}_triggerBackdropTransition(){if(Xt.trigger(this._element,$N).defaultPrevented)return;const l=this._element.scrollHeight>document.documentElement.clientHeight,f=this._element.style.overflowY;f==="hidden"||this._element.classList.contains(Kb)||(l||(this._element.style.overflowY="hidden"),this._element.classList.add(Kb),this._queueCallback(()=>{this._element.classList.remove(Kb),this._queueCallback(()=>{this._element.style.overflowY=f},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const t=this._element.scrollHeight>document.documentElement.clientHeight,l=this._scrollBar.getWidth(),f=l>0;if(f&&!t){const _=wa()?"paddingLeft":"paddingRight";this._element.style[_]=`${l}px`}if(!f&&t){const _=wa()?"paddingRight":"paddingLeft";this._element.style[_]=`${l}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(t,l){return this.each(function(){const f=er.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof f[t]>"u")throw new TypeError(`No method named "${t}"`);f[t](l)}})}}Xt.on(document,XN,eB,function(r){const t=Fi.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&r.preventDefault(),Xt.one(t,aR,_=>{_.defaultPrevented||Xt.one(t,oR,()=>{Op(this)&&this.focus()})});const l=Fi.findOne(KN);l&&er.getInstance(l).hide(),er.getOrCreateInstance(t).toggle(this)});r1(er);Sa(er);const nB="offcanvas",rB="bs.offcanvas",_c=`.${rB}`,lR=".data-api",sB=`load${_c}${lR}`,oB="Escape",pC="show",mC="showing",_C="hiding",aB="offcanvas-backdrop",cR=".offcanvas.show",lB=`show${_c}`,cB=`shown${_c}`,uB=`hide${_c}`,gC=`hidePrevented${_c}`,uR=`hidden${_c}`,hB=`resize${_c}`,dB=`click${_c}${lR}`,fB=`keydown.dismiss${_c}`,pB='[data-bs-toggle="offcanvas"]',mB={backdrop:!0,keyboard:!0,scroll:!1},_B={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class Su extends Ka{constructor(t,l){super(t,l),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return mB}static get DefaultType(){return _B}static get NAME(){return nB}toggle(t){return this._isShown?this.hide():this.show(t)}show(t){if(this._isShown||Xt.trigger(this._element,lB,{relatedTarget:t}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||new Fw().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(mC);const f=()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add(pC),this._element.classList.remove(mC),Xt.trigger(this._element,cB,{relatedTarget:t})};this._queueCallback(f,this._element,!0)}hide(){if(!this._isShown||Xt.trigger(this._element,uB).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(_C),this._backdrop.hide();const l=()=>{this._element.classList.remove(pC,_C),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new Fw().reset(),Xt.trigger(this._element,uR)};this._queueCallback(l,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const t=()=>{if(this._config.backdrop==="static"){Xt.trigger(this._element,gC);return}this.hide()},l=!!this._config.backdrop;return new rR({className:aB,isVisible:l,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:l?t:null})}_initializeFocusTrap(){return new sR({trapElement:this._element})}_addEventListeners(){Xt.on(this._element,fB,t=>{if(t.key===oB){if(this._config.keyboard){this.hide();return}Xt.trigger(this._element,gC)}})}static jQueryInterface(t){return this.each(function(){const l=Su.getOrCreateInstance(this,t);if(typeof t=="string"){if(l[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);l[t](this)}})}}Xt.on(document,dB,pB,function(r){const t=Fi.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&r.preventDefault(),Eu(this))return;Xt.one(t,uR,()=>{Op(this)&&this.focus()});const l=Fi.findOne(cR);l&&l!==t&&Su.getInstance(l).hide(),Su.getOrCreateInstance(t).toggle(this)});Xt.on(window,sB,()=>{for(const r of Fi.find(cR))Su.getOrCreateInstance(r).show()});Xt.on(window,hB,()=>{for(const r of Fi.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(r).position!=="fixed"&&Su.getOrCreateInstance(r).hide()});r1(Su);Sa(Su);const gB=/^aria-[\w-]*$/i,hR={"*":["class","dir","id","lang","role",gB],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},yB=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),vB=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,xB=(r,t)=>{const l=r.nodeName.toLowerCase();return t.includes(l)?yB.has(l)?!!vB.test(r.nodeValue):!0:t.filter(f=>f instanceof RegExp).some(f=>f.test(l))};function bB(r,t,l){if(!r.length)return r;if(l&&typeof l=="function")return l(r);const _=new window.DOMParser().parseFromString(r,"text/html"),b=[].concat(..._.body.querySelectorAll("*"));for(const T of b){const n=T.nodeName.toLowerCase();if(!Object.keys(t).includes(n)){T.remove();continue}const k=[].concat(...T.attributes),j=[].concat(t["*"]||[],t[n]||[]);for(const U of k)xB(U,j)||T.removeAttribute(U.nodeName)}return _.body.innerHTML}const wB="TemplateFactory",TB={allowList:hR,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},EB={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},SB={entry:"(string|element|function|null)",selector:"(string|element)"};class AB extends Ng{constructor(t){super(),this._config=this._getConfig(t)}static get Default(){return TB}static get DefaultType(){return EB}static get NAME(){return wB}getContent(){return Object.values(this._config.content).map(t=>this._resolvePossibleFunction(t)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(t){return this._checkContent(t),this._config.content={...this._config.content,...t},this}toHtml(){const t=document.createElement("div");t.innerHTML=this._maybeSanitize(this._config.template);for(const[_,b]of Object.entries(this._config.content))this._setContent(t,b,_);const l=t.children[0],f=this._resolvePossibleFunction(this._config.extraClass);return f&&l.classList.add(...f.split(" ")),l}_typeCheckConfig(t){super._typeCheckConfig(t),this._checkContent(t.content)}_checkContent(t){for(const[l,f]of Object.entries(t))super._typeCheckConfig({selector:l,entry:f},SB)}_setContent(t,l,f){const _=Fi.findOne(f,t);if(_){if(l=this._resolvePossibleFunction(l),!l){_.remove();return}if(lc(l)){this._putElementInTemplate(Tu(l),_);return}if(this._config.html){_.innerHTML=this._maybeSanitize(l);return}_.textContent=l}}_maybeSanitize(t){return this._config.sanitize?bB(t,this._config.allowList,this._config.sanitizeFn):t}_resolvePossibleFunction(t){return _o(t,[this])}_putElementInTemplate(t,l){if(this._config.html){l.innerHTML="",l.append(t);return}l.textContent=t.textContent}}const MB="tooltip",CB=new Set(["sanitize","allowList","sanitizeFn"]),Jb="fade",IB="modal",O0="show",PB=".tooltip-inner",yC=`.${IB}`,vC="hide.bs.modal",U_="hover",Qb="focus",RB="click",DB="manual",LB="hide",OB="hidden",zB="show",kB="shown",FB="inserted",NB="click",BB="focusin",VB="focusout",UB="mouseenter",jB="mouseleave",$B={AUTO:"auto",TOP:"top",RIGHT:wa()?"left":"right",BOTTOM:"bottom",LEFT:wa()?"right":"left"},qB={allowList:hR,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},HB={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class kp extends Ka{constructor(t,l){if(typeof NP>"u")throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(t,l),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return qB}static get DefaultType(){return HB}static get NAME(){return MB}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(this._isEnabled){if(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()){this._leave();return}this._enter()}}dispose(){clearTimeout(this._timeout),Xt.off(this._element.closest(yC),vC,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!(this._isWithContent()&&this._isEnabled))return;const t=Xt.trigger(this._element,this.constructor.eventName(zB)),f=(UP(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(t.defaultPrevented||!f)return;this._disposePopper();const _=this._getTipElement();this._element.setAttribute("aria-describedby",_.getAttribute("id"));const{container:b}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(b.append(_),Xt.trigger(this._element,this.constructor.eventName(FB))),this._popper=this._createPopper(_),_.classList.add(O0),"ontouchstart"in document.documentElement)for(const n of[].concat(...document.body.children))Xt.on(n,"mouseover",gv);const T=()=>{Xt.trigger(this._element,this.constructor.eventName(kB)),this._isHovered===!1&&this._leave(),this._isHovered=!1};this._queueCallback(T,this.tip,this._isAnimated())}hide(){if(!this._isShown()||Xt.trigger(this._element,this.constructor.eventName(LB)).defaultPrevented)return;if(this._getTipElement().classList.remove(O0),"ontouchstart"in document.documentElement)for(const _ of[].concat(...document.body.children))Xt.off(_,"mouseover",gv);this._activeTrigger[RB]=!1,this._activeTrigger[Qb]=!1,this._activeTrigger[U_]=!1,this._isHovered=null;const f=()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),Xt.trigger(this._element,this.constructor.eventName(OB)))};this._queueCallback(f,this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(t){const l=this._getTemplateFactory(t).toHtml();if(!l)return null;l.classList.remove(Jb,O0),l.classList.add(`bs-${this.constructor.NAME}-auto`);const f=RF(this.constructor.NAME).toString();return l.setAttribute("id",f),this._isAnimated()&&l.classList.add(Jb),l}setContent(t){this._newContent=t,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(t){return this._templateFactory?this._templateFactory.changeContent(t):this._templateFactory=new AB({...this._config,content:t,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[PB]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(t){return this.constructor.getOrCreateInstance(t.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(Jb)}_isShown(){return this.tip&&this.tip.classList.contains(O0)}_createPopper(t){const l=_o(this._config.placement,[this,t,this._element]),f=$B[l.toUpperCase()];return YT(this._element,t,this._getPopperConfig(f))}_getOffset(){const{offset:t}=this._config;return typeof t=="string"?t.split(",").map(l=>Number.parseInt(l,10)):typeof t=="function"?l=>t(l,this._element):t}_resolvePossibleFunction(t){return _o(t,[this._element])}_getPopperConfig(t){const l={placement:t,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:f=>{this._getTipElement().setAttribute("data-popper-placement",f.state.placement)}}]};return{...l,..._o(this._config.popperConfig,[l])}}_setListeners(){const t=this._config.trigger.split(" ");for(const l of t)if(l==="click")Xt.on(this._element,this.constructor.eventName(NB),this._config.selector,f=>{this._initializeOnDelegatedTarget(f).toggle()});else if(l!==DB){const f=l===U_?this.constructor.eventName(UB):this.constructor.eventName(BB),_=l===U_?this.constructor.eventName(jB):this.constructor.eventName(VB);Xt.on(this._element,f,this._config.selector,b=>{const T=this._initializeOnDelegatedTarget(b);T._activeTrigger[b.type==="focusin"?Qb:U_]=!0,T._enter()}),Xt.on(this._element,_,this._config.selector,b=>{const T=this._initializeOnDelegatedTarget(b);T._activeTrigger[b.type==="focusout"?Qb:U_]=T._element.contains(b.relatedTarget),T._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},Xt.on(this._element.closest(yC),vC,this._hideModalHandler)}_fixTitle(){const t=this._element.getAttribute("title");t&&(!this._element.getAttribute("aria-label")&&!this._element.textContent.trim()&&this._element.setAttribute("aria-label",t),this._element.setAttribute("data-bs-original-title",t),this._element.removeAttribute("title"))}_enter(){if(this._isShown()||this._isHovered){this._isHovered=!0;return}this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show)}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(t,l){clearTimeout(this._timeout),this._timeout=setTimeout(t,l)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(t){const l=cc.getDataAttributes(this._element);for(const f of Object.keys(l))CB.has(f)&&delete l[f];return t={...l,...typeof t=="object"&&t?t:{}},t=this._mergeConfigObj(t),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}_configAfterMerge(t){return t.container=t.container===!1?document.body:Tu(t.container),typeof t.delay=="number"&&(t.delay={show:t.delay,hide:t.delay}),typeof t.title=="number"&&(t.title=t.title.toString()),typeof t.content=="number"&&(t.content=t.content.toString()),t}_getDelegateConfig(){const t={};for(const[l,f]of Object.entries(this._config))this.constructor.Default[l]!==f&&(t[l]=f);return t.selector=!1,t.trigger="manual",t}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(t){return this.each(function(){const l=kp.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof l[t]>"u")throw new TypeError(`No method named "${t}"`);l[t]()}})}}Sa(kp);const GB="popover",WB=".popover-header",ZB=".popover-body",XB={...kp.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},YB={...kp.DefaultType,content:"(null|string|element|function)"};class e2 extends kp{static get Default(){return XB}static get DefaultType(){return YB}static get NAME(){return GB}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[WB]:this._getTitle(),[ZB]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(t){return this.each(function(){const l=e2.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof l[t]>"u")throw new TypeError(`No method named "${t}"`);l[t]()}})}}Sa(e2);const KB="scrollspy",JB="bs.scrollspy",t2=`.${JB}`,QB=".data-api",eV=`activate${t2}`,xC=`click${t2}`,tV=`load${t2}${QB}`,iV="dropdown-item",jf="active",nV='[data-bs-spy="scroll"]',ew="[href]",rV=".nav, .list-group",bC=".nav-link",sV=".nav-item",oV=".list-group-item",aV=`${bC}, ${sV} > ${bC}, ${oV}`,lV=".dropdown",cV=".dropdown-toggle",uV={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},hV={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class a1 extends Ka{constructor(t,l){super(t,l),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return uV}static get DefaultType(){return hV}static get NAME(){return KB}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const t of this._observableSections.values())this._observer.observe(t)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(t){return t.target=Tu(t.target)||document.body,t.rootMargin=t.offset?`${t.offset}px 0px -30%`:t.rootMargin,typeof t.threshold=="string"&&(t.threshold=t.threshold.split(",").map(l=>Number.parseFloat(l))),t}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(Xt.off(this._config.target,xC),Xt.on(this._config.target,xC,ew,t=>{const l=this._observableSections.get(t.target.hash);if(l){t.preventDefault();const f=this._rootElement||window,_=l.offsetTop-this._element.offsetTop;if(f.scrollTo){f.scrollTo({top:_,behavior:"smooth"});return}f.scrollTop=_}}))}_getNewObserver(){const t={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(l=>this._observerCallback(l),t)}_observerCallback(t){const l=T=>this._targetLinks.get(`#${T.target.id}`),f=T=>{this._previousScrollData.visibleEntryTop=T.target.offsetTop,this._process(l(T))},_=(this._rootElement||document.documentElement).scrollTop,b=_>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=_;for(const T of t){if(!T.isIntersecting){this._activeTarget=null,this._clearActiveClass(l(T));continue}const n=T.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(b&&n){if(f(T),!_)return;continue}!b&&!n&&f(T)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const t=Fi.find(ew,this._config.target);for(const l of t){if(!l.hash||Eu(l))continue;const f=Fi.findOne(decodeURI(l.hash),this._element);Op(f)&&(this._targetLinks.set(decodeURI(l.hash),l),this._observableSections.set(l.hash,f))}}_process(t){this._activeTarget!==t&&(this._clearActiveClass(this._config.target),this._activeTarget=t,t.classList.add(jf),this._activateParents(t),Xt.trigger(this._element,eV,{relatedTarget:t}))}_activateParents(t){if(t.classList.contains(iV)){Fi.findOne(cV,t.closest(lV)).classList.add(jf);return}for(const l of Fi.parents(t,rV))for(const f of Fi.prev(l,aV))f.classList.add(jf)}_clearActiveClass(t){t.classList.remove(jf);const l=Fi.find(`${ew}.${jf}`,t);for(const f of l)f.classList.remove(jf)}static jQueryInterface(t){return this.each(function(){const l=a1.getOrCreateInstance(this,t);if(typeof t=="string"){if(l[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);l[t]()}})}}Xt.on(window,tV,()=>{for(const r of Fi.find(nV))a1.getOrCreateInstance(r)});Sa(a1);const dV="tab",fV="bs.tab",wd=`.${fV}`,pV=`hide${wd}`,mV=`hidden${wd}`,_V=`show${wd}`,gV=`shown${wd}`,yV=`click${wd}`,vV=`keydown${wd}`,xV=`load${wd}`,bV="ArrowLeft",wC="ArrowRight",wV="ArrowUp",TC="ArrowDown",tw="Home",EC="End",Wh="active",SC="fade",iw="show",TV="dropdown",dR=".dropdown-toggle",EV=".dropdown-menu",nw=`:not(${dR})`,SV='.list-group, .nav, [role="tablist"]',AV=".nav-item, .list-group-item",MV=`.nav-link${nw}, .list-group-item${nw}, [role="tab"]${nw}`,fR='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',rw=`${MV}, ${fR}`,CV=`.${Wh}[data-bs-toggle="tab"], .${Wh}[data-bs-toggle="pill"], .${Wh}[data-bs-toggle="list"]`;class yp extends Ka{constructor(t){super(t),this._parent=this._element.closest(SV),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),Xt.on(this._element,vV,l=>this._keydown(l)))}static get NAME(){return dV}show(){const t=this._element;if(this._elemIsActive(t))return;const l=this._getActiveElem(),f=l?Xt.trigger(l,pV,{relatedTarget:t}):null;Xt.trigger(t,_V,{relatedTarget:l}).defaultPrevented||f&&f.defaultPrevented||(this._deactivate(l,t),this._activate(t,l))}_activate(t,l){if(!t)return;t.classList.add(Wh),this._activate(Fi.getElementFromSelector(t));const f=()=>{if(t.getAttribute("role")!=="tab"){t.classList.add(iw);return}t.removeAttribute("tabindex"),t.setAttribute("aria-selected",!0),this._toggleDropDown(t,!0),Xt.trigger(t,gV,{relatedTarget:l})};this._queueCallback(f,t,t.classList.contains(SC))}_deactivate(t,l){if(!t)return;t.classList.remove(Wh),t.blur(),this._deactivate(Fi.getElementFromSelector(t));const f=()=>{if(t.getAttribute("role")!=="tab"){t.classList.remove(iw);return}t.setAttribute("aria-selected",!1),t.setAttribute("tabindex","-1"),this._toggleDropDown(t,!1),Xt.trigger(t,mV,{relatedTarget:l})};this._queueCallback(f,t,t.classList.contains(SC))}_keydown(t){if(![bV,wC,wV,TC,tw,EC].includes(t.key))return;t.stopPropagation(),t.preventDefault();const l=this._getChildren().filter(_=>!Eu(_));let f;if([tw,EC].includes(t.key))f=l[t.key===tw?0:l.length-1];else{const _=[wC,TC].includes(t.key);f=KT(l,t.target,_,!0)}f&&(f.focus({preventScroll:!0}),yp.getOrCreateInstance(f).show())}_getChildren(){return Fi.find(rw,this._parent)}_getActiveElem(){return this._getChildren().find(t=>this._elemIsActive(t))||null}_setInitialAttributes(t,l){this._setAttributeIfNotExists(t,"role","tablist");for(const f of l)this._setInitialAttributesOnChild(f)}_setInitialAttributesOnChild(t){t=this._getInnerElement(t);const l=this._elemIsActive(t),f=this._getOuterElement(t);t.setAttribute("aria-selected",l),f!==t&&this._setAttributeIfNotExists(f,"role","presentation"),l||t.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(t,"role","tab"),this._setInitialAttributesOnTargetPanel(t)}_setInitialAttributesOnTargetPanel(t){const l=Fi.getElementFromSelector(t);l&&(this._setAttributeIfNotExists(l,"role","tabpanel"),t.id&&this._setAttributeIfNotExists(l,"aria-labelledby",`${t.id}`))}_toggleDropDown(t,l){const f=this._getOuterElement(t);if(!f.classList.contains(TV))return;const _=(b,T)=>{const n=Fi.findOne(b,f);n&&n.classList.toggle(T,l)};_(dR,Wh),_(EV,iw),f.setAttribute("aria-expanded",l)}_setAttributeIfNotExists(t,l,f){t.hasAttribute(l)||t.setAttribute(l,f)}_elemIsActive(t){return t.classList.contains(Wh)}_getInnerElement(t){return t.matches(rw)?t:Fi.findOne(rw,t)}_getOuterElement(t){return t.closest(AV)||t}static jQueryInterface(t){return this.each(function(){const l=yp.getOrCreateInstance(this);if(typeof t=="string"){if(l[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);l[t]()}})}}Xt.on(document,yV,fR,function(r){["A","AREA"].includes(this.tagName)&&r.preventDefault(),!Eu(this)&&yp.getOrCreateInstance(this).show()});Xt.on(window,xV,()=>{for(const r of Fi.find(CV))yp.getOrCreateInstance(r)});Sa(yp);const IV="toast",PV="bs.toast",Lu=`.${PV}`,RV=`mouseover${Lu}`,DV=`mouseout${Lu}`,LV=`focusin${Lu}`,OV=`focusout${Lu}`,zV=`hide${Lu}`,kV=`hidden${Lu}`,FV=`show${Lu}`,NV=`shown${Lu}`,BV="fade",AC="hide",z0="show",k0="showing",VV={animation:"boolean",autohide:"boolean",delay:"number"},UV={animation:!0,autohide:!0,delay:5e3};class l1 extends Ka{constructor(t,l){super(t,l),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return UV}static get DefaultType(){return VV}static get NAME(){return IV}show(){if(Xt.trigger(this._element,FV).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add(BV);const l=()=>{this._element.classList.remove(k0),Xt.trigger(this._element,NV),this._maybeScheduleHide()};this._element.classList.remove(AC),Fg(this._element),this._element.classList.add(z0,k0),this._queueCallback(l,this._element,this._config.animation)}hide(){if(!this.isShown()||Xt.trigger(this._element,zV).defaultPrevented)return;const l=()=>{this._element.classList.add(AC),this._element.classList.remove(k0,z0),Xt.trigger(this._element,kV)};this._element.classList.add(k0),this._queueCallback(l,this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(z0),super.dispose()}isShown(){return this._element.classList.contains(z0)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(t,l){switch(t.type){case"mouseover":case"mouseout":{this._hasMouseInteraction=l;break}case"focusin":case"focusout":{this._hasKeyboardInteraction=l;break}}if(l){this._clearTimeout();return}const f=t.relatedTarget;this._element===f||this._element.contains(f)||this._maybeScheduleHide()}_setListeners(){Xt.on(this._element,RV,t=>this._onInteraction(t,!0)),Xt.on(this._element,DV,t=>this._onInteraction(t,!1)),Xt.on(this._element,LV,t=>this._onInteraction(t,!0)),Xt.on(this._element,OV,t=>this._onInteraction(t,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(t){return this.each(function(){const l=l1.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof l[t]>"u")throw new TypeError(`No method named "${t}"`);l[t](this)}})}}r1(l1);Sa(l1);function pR(r,t){return function(){return r.apply(t,arguments)}}const{toString:jV}=Object.prototype,{getPrototypeOf:i2}=Object,c1=(r=>t=>{const l=jV.call(t);return r[l]||(r[l]=l.slice(8,-1).toLowerCase())})(Object.create(null)),Ja=r=>(r=r.toLowerCase(),t=>c1(t)===r),u1=r=>t=>typeof t===r,{isArray:Fp}=Array,fg=u1("undefined");function $V(r){return r!==null&&!fg(r)&&r.constructor!==null&&!fg(r.constructor)&&Bo(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const mR=Ja("ArrayBuffer");function qV(r){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(r):t=r&&r.buffer&&mR(r.buffer),t}const HV=u1("string"),Bo=u1("function"),_R=u1("number"),h1=r=>r!==null&&typeof r=="object",GV=r=>r===!0||r===!1,tv=r=>{if(c1(r)!=="object")return!1;const t=i2(r);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},WV=Ja("Date"),ZV=Ja("File"),XV=Ja("Blob"),YV=Ja("FileList"),KV=r=>h1(r)&&Bo(r.pipe),JV=r=>{let t;return r&&(typeof FormData=="function"&&r instanceof FormData||Bo(r.append)&&((t=c1(r))==="formdata"||t==="object"&&Bo(r.toString)&&r.toString()==="[object FormData]"))},QV=Ja("URLSearchParams"),[e6,t6,i6,n6]=["ReadableStream","Request","Response","Headers"].map(Ja),r6=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Ug(r,t,{allOwnKeys:l=!1}={}){if(r===null||typeof r>"u")return;let f,_;if(typeof r!="object"&&(r=[r]),Fp(r))for(f=0,_=r.length;f<_;f++)t.call(null,r[f],f,r);else{const b=l?Object.getOwnPropertyNames(r):Object.keys(r),T=b.length;let n;for(f=0;f<T;f++)n=b[f],t.call(null,r[n],n,r)}}function gR(r,t){t=t.toLowerCase();const l=Object.keys(r);let f=l.length,_;for(;f-- >0;)if(_=l[f],t===_.toLowerCase())return _;return null}const Zh=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),yR=r=>!fg(r)&&r!==Zh;function Nw(){const{caseless:r}=yR(this)&&this||{},t={},l=(f,_)=>{const b=r&&gR(t,_)||_;tv(t[b])&&tv(f)?t[b]=Nw(t[b],f):tv(f)?t[b]=Nw({},f):Fp(f)?t[b]=f.slice():t[b]=f};for(let f=0,_=arguments.length;f<_;f++)arguments[f]&&Ug(arguments[f],l);return t}const s6=(r,t,l,{allOwnKeys:f}={})=>(Ug(t,(_,b)=>{l&&Bo(_)?r[b]=pR(_,l):r[b]=_},{allOwnKeys:f}),r),o6=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),a6=(r,t,l,f)=>{r.prototype=Object.create(t.prototype,f),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:t.prototype}),l&&Object.assign(r.prototype,l)},l6=(r,t,l,f)=>{let _,b,T;const n={};if(t=t||{},r==null)return t;do{for(_=Object.getOwnPropertyNames(r),b=_.length;b-- >0;)T=_[b],(!f||f(T,r,t))&&!n[T]&&(t[T]=r[T],n[T]=!0);r=l!==!1&&i2(r)}while(r&&(!l||l(r,t))&&r!==Object.prototype);return t},c6=(r,t,l)=>{r=String(r),(l===void 0||l>r.length)&&(l=r.length),l-=t.length;const f=r.indexOf(t,l);return f!==-1&&f===l},u6=r=>{if(!r)return null;if(Fp(r))return r;let t=r.length;if(!_R(t))return null;const l=new Array(t);for(;t-- >0;)l[t]=r[t];return l},h6=(r=>t=>r&&t instanceof r)(typeof Uint8Array<"u"&&i2(Uint8Array)),d6=(r,t)=>{const f=(r&&r[Symbol.iterator]).call(r);let _;for(;(_=f.next())&&!_.done;){const b=_.value;t.call(r,b[0],b[1])}},f6=(r,t)=>{let l;const f=[];for(;(l=r.exec(t))!==null;)f.push(l);return f},p6=Ja("HTMLFormElement"),m6=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(l,f,_){return f.toUpperCase()+_}),MC=(({hasOwnProperty:r})=>(t,l)=>r.call(t,l))(Object.prototype),_6=Ja("RegExp"),vR=(r,t)=>{const l=Object.getOwnPropertyDescriptors(r),f={};Ug(l,(_,b)=>{let T;(T=t(_,b,r))!==!1&&(f[b]=T||_)}),Object.defineProperties(r,f)},g6=r=>{vR(r,(t,l)=>{if(Bo(r)&&["arguments","caller","callee"].indexOf(l)!==-1)return!1;const f=r[l];if(Bo(f)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+l+"'")})}})},y6=(r,t)=>{const l={},f=_=>{_.forEach(b=>{l[b]=!0})};return Fp(r)?f(r):f(String(r).split(t)),l},v6=()=>{},x6=(r,t)=>r!=null&&Number.isFinite(r=+r)?r:t;function b6(r){return!!(r&&Bo(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}const w6=r=>{const t=new Array(10),l=(f,_)=>{if(h1(f)){if(t.indexOf(f)>=0)return;if(!("toJSON"in f)){t[_]=f;const b=Fp(f)?[]:{};return Ug(f,(T,n)=>{const k=l(T,_+1);!fg(k)&&(b[n]=k)}),t[_]=void 0,b}}return f};return l(r,0)},T6=Ja("AsyncFunction"),E6=r=>r&&(h1(r)||Bo(r))&&Bo(r.then)&&Bo(r.catch),xR=((r,t)=>r?setImmediate:t?((l,f)=>(Zh.addEventListener("message",({source:_,data:b})=>{_===Zh&&b===l&&f.length&&f.shift()()},!1),_=>{f.push(_),Zh.postMessage(l,"*")}))(`axios@${Math.random()}`,[]):l=>setTimeout(l))(typeof setImmediate=="function",Bo(Zh.postMessage)),S6=typeof queueMicrotask<"u"?queueMicrotask.bind(Zh):typeof process<"u"&&process.nextTick||xR,Mt={isArray:Fp,isArrayBuffer:mR,isBuffer:$V,isFormData:JV,isArrayBufferView:qV,isString:HV,isNumber:_R,isBoolean:GV,isObject:h1,isPlainObject:tv,isReadableStream:e6,isRequest:t6,isResponse:i6,isHeaders:n6,isUndefined:fg,isDate:WV,isFile:ZV,isBlob:XV,isRegExp:_6,isFunction:Bo,isStream:KV,isURLSearchParams:QV,isTypedArray:h6,isFileList:YV,forEach:Ug,merge:Nw,extend:s6,trim:r6,stripBOM:o6,inherits:a6,toFlatObject:l6,kindOf:c1,kindOfTest:Ja,endsWith:c6,toArray:u6,forEachEntry:d6,matchAll:f6,isHTMLForm:p6,hasOwnProperty:MC,hasOwnProp:MC,reduceDescriptors:vR,freezeMethods:g6,toObjectSet:y6,toCamelCase:m6,noop:v6,toFiniteNumber:x6,findKey:gR,global:Zh,isContextDefined:yR,isSpecCompliantForm:b6,toJSONObject:w6,isAsyncFn:T6,isThenable:E6,setImmediate:xR,asap:S6};function ln(r,t,l,f,_){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",t&&(this.code=t),l&&(this.config=l),f&&(this.request=f),_&&(this.response=_,this.status=_.status?_.status:null)}Mt.inherits(ln,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Mt.toJSONObject(this.config),code:this.code,status:this.status}}});const bR=ln.prototype,wR={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{wR[r]={value:r}});Object.defineProperties(ln,wR);Object.defineProperty(bR,"isAxiosError",{value:!0});ln.from=(r,t,l,f,_,b)=>{const T=Object.create(bR);return Mt.toFlatObject(r,T,function(k){return k!==Error.prototype},n=>n!=="isAxiosError"),ln.call(T,r.message,t,l,f,_),T.cause=r,T.name=r.name,b&&Object.assign(T,b),T};const A6=null;function Bw(r){return Mt.isPlainObject(r)||Mt.isArray(r)}function TR(r){return Mt.endsWith(r,"[]")?r.slice(0,-2):r}function CC(r,t,l){return r?r.concat(t).map(function(_,b){return _=TR(_),!l&&b?"["+_+"]":_}).join(l?".":""):t}function M6(r){return Mt.isArray(r)&&!r.some(Bw)}const C6=Mt.toFlatObject(Mt,{},null,function(t){return/^is[A-Z]/.test(t)});function d1(r,t,l){if(!Mt.isObject(r))throw new TypeError("target must be an object");t=t||new FormData,l=Mt.toFlatObject(l,{metaTokens:!0,dots:!1,indexes:!1},!1,function(ne,be){return!Mt.isUndefined(be[ne])});const f=l.metaTokens,_=l.visitor||U,b=l.dots,T=l.indexes,k=(l.Blob||typeof Blob<"u"&&Blob)&&Mt.isSpecCompliantForm(t);if(!Mt.isFunction(_))throw new TypeError("visitor must be a function");function j(ue){if(ue===null)return"";if(Mt.isDate(ue))return ue.toISOString();if(!k&&Mt.isBlob(ue))throw new ln("Blob is not supported. Use a Buffer instead.");return Mt.isArrayBuffer(ue)||Mt.isTypedArray(ue)?k&&typeof Blob=="function"?new Blob([ue]):Buffer.from(ue):ue}function U(ue,ne,be){let De=ue;if(ue&&!be&&typeof ue=="object"){if(Mt.endsWith(ne,"{}"))ne=f?ne:ne.slice(0,-2),ue=JSON.stringify(ue);else if(Mt.isArray(ue)&&M6(ue)||(Mt.isFileList(ue)||Mt.endsWith(ne,"[]"))&&(De=Mt.toArray(ue)))return ne=TR(ne),De.forEach(function(Te,me){!(Mt.isUndefined(Te)||Te===null)&&t.append(T===!0?CC([ne],me,b):T===null?ne:ne+"[]",j(Te))}),!1}return Bw(ue)?!0:(t.append(CC(be,ne,b),j(ue)),!1)}const Z=[],re=Object.assign(C6,{defaultVisitor:U,convertValue:j,isVisitable:Bw});function se(ue,ne){if(!Mt.isUndefined(ue)){if(Z.indexOf(ue)!==-1)throw Error("Circular reference detected in "+ne.join("."));Z.push(ue),Mt.forEach(ue,function(De,Be){(!(Mt.isUndefined(De)||De===null)&&_.call(t,De,Mt.isString(Be)?Be.trim():Be,ne,re))===!0&&se(De,ne?ne.concat(Be):[Be])}),Z.pop()}}if(!Mt.isObject(r))throw new TypeError("data must be an object");return se(r),t}function IC(r){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(f){return t[f]})}function n2(r,t){this._pairs=[],r&&d1(r,this,t)}const ER=n2.prototype;ER.append=function(t,l){this._pairs.push([t,l])};ER.toString=function(t){const l=t?function(f){return t.call(this,f,IC)}:IC;return this._pairs.map(function(_){return l(_[0])+"="+l(_[1])},"").join("&")};function I6(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function SR(r,t,l){if(!t)return r;const f=l&&l.encode||I6;Mt.isFunction(l)&&(l={serialize:l});const _=l&&l.serialize;let b;if(_?b=_(t,l):b=Mt.isURLSearchParams(t)?t.toString():new n2(t,l).toString(f),b){const T=r.indexOf("#");T!==-1&&(r=r.slice(0,T)),r+=(r.indexOf("?")===-1?"?":"&")+b}return r}class P6{constructor(){this.handlers=[]}use(t,l,f){return this.handlers.push({fulfilled:t,rejected:l,synchronous:f?f.synchronous:!1,runWhen:f?f.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){Mt.forEach(this.handlers,function(f){f!==null&&t(f)})}}const PC=P6,AR={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},R6=typeof URLSearchParams<"u"?URLSearchParams:n2,D6=typeof FormData<"u"?FormData:null,L6=typeof Blob<"u"?Blob:null,O6={isBrowser:!0,classes:{URLSearchParams:R6,FormData:D6,Blob:L6},protocols:["http","https","file","blob","url","data"]},r2=typeof window<"u"&&typeof document<"u",Vw=typeof navigator=="object"&&navigator||void 0,z6=r2&&(!Vw||["ReactNative","NativeScript","NS"].indexOf(Vw.product)<0),k6=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),F6=r2&&window.location.href||"http://localhost",N6=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:r2,hasStandardBrowserEnv:z6,hasStandardBrowserWebWorkerEnv:k6,navigator:Vw,origin:F6},Symbol.toStringTag,{value:"Module"})),ks={...N6,...O6};function B6(r,t){return d1(r,new ks.classes.URLSearchParams,Object.assign({visitor:function(l,f,_,b){return ks.isNode&&Mt.isBuffer(l)?(this.append(f,l.toString("base64")),!1):b.defaultVisitor.apply(this,arguments)}},t))}function V6(r){return Mt.matchAll(/\w+|\[(\w*)]/g,r).map(t=>t[0]==="[]"?"":t[1]||t[0])}function U6(r){const t={},l=Object.keys(r);let f;const _=l.length;let b;for(f=0;f<_;f++)b=l[f],t[b]=r[b];return t}function MR(r){function t(l,f,_,b){let T=l[b++];if(T==="__proto__")return!0;const n=Number.isFinite(+T),k=b>=l.length;return T=!T&&Mt.isArray(_)?_.length:T,k?(Mt.hasOwnProp(_,T)?_[T]=[_[T],f]:_[T]=f,!n):((!_[T]||!Mt.isObject(_[T]))&&(_[T]=[]),t(l,f,_[T],b)&&Mt.isArray(_[T])&&(_[T]=U6(_[T])),!n)}if(Mt.isFormData(r)&&Mt.isFunction(r.entries)){const l={};return Mt.forEachEntry(r,(f,_)=>{t(V6(f),_,l,0)}),l}return null}function j6(r,t,l){if(Mt.isString(r))try{return(t||JSON.parse)(r),Mt.trim(r)}catch(f){if(f.name!=="SyntaxError")throw f}return(l||JSON.stringify)(r)}const s2={transitional:AR,adapter:["xhr","http","fetch"],transformRequest:[function(t,l){const f=l.getContentType()||"",_=f.indexOf("application/json")>-1,b=Mt.isObject(t);if(b&&Mt.isHTMLForm(t)&&(t=new FormData(t)),Mt.isFormData(t))return _?JSON.stringify(MR(t)):t;if(Mt.isArrayBuffer(t)||Mt.isBuffer(t)||Mt.isStream(t)||Mt.isFile(t)||Mt.isBlob(t)||Mt.isReadableStream(t))return t;if(Mt.isArrayBufferView(t))return t.buffer;if(Mt.isURLSearchParams(t))return l.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let n;if(b){if(f.indexOf("application/x-www-form-urlencoded")>-1)return B6(t,this.formSerializer).toString();if((n=Mt.isFileList(t))||f.indexOf("multipart/form-data")>-1){const k=this.env&&this.env.FormData;return d1(n?{"files[]":t}:t,k&&new k,this.formSerializer)}}return b||_?(l.setContentType("application/json",!1),j6(t)):t}],transformResponse:[function(t){const l=this.transitional||s2.transitional,f=l&&l.forcedJSONParsing,_=this.responseType==="json";if(Mt.isResponse(t)||Mt.isReadableStream(t))return t;if(t&&Mt.isString(t)&&(f&&!this.responseType||_)){const T=!(l&&l.silentJSONParsing)&&_;try{return JSON.parse(t)}catch(n){if(T)throw n.name==="SyntaxError"?ln.from(n,ln.ERR_BAD_RESPONSE,this,null,this.response):n}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ks.classes.FormData,Blob:ks.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Mt.forEach(["delete","get","head","post","put","patch"],r=>{s2.headers[r]={}});const o2=s2,$6=Mt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),q6=r=>{const t={};let l,f,_;return r&&r.split(`
`).forEach(function(T){_=T.indexOf(":"),l=T.substring(0,_).trim().toLowerCase(),f=T.substring(_+1).trim(),!(!l||t[l]&&$6[l])&&(l==="set-cookie"?t[l]?t[l].push(f):t[l]=[f]:t[l]=t[l]?t[l]+", "+f:f)}),t},RC=Symbol("internals");function j_(r){return r&&String(r).trim().toLowerCase()}function iv(r){return r===!1||r==null?r:Mt.isArray(r)?r.map(iv):String(r)}function H6(r){const t=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let f;for(;f=l.exec(r);)t[f[1]]=f[2];return t}const G6=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function sw(r,t,l,f,_){if(Mt.isFunction(f))return f.call(this,t,l);if(_&&(t=l),!!Mt.isString(t)){if(Mt.isString(f))return t.indexOf(f)!==-1;if(Mt.isRegExp(f))return f.test(t)}}function W6(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,l,f)=>l.toUpperCase()+f)}function Z6(r,t){const l=Mt.toCamelCase(" "+t);["get","set","has"].forEach(f=>{Object.defineProperty(r,f+l,{value:function(_,b,T){return this[f].call(this,t,_,b,T)},configurable:!0})})}class f1{constructor(t){t&&this.set(t)}set(t,l,f){const _=this;function b(n,k,j){const U=j_(k);if(!U)throw new Error("header name must be a non-empty string");const Z=Mt.findKey(_,U);(!Z||_[Z]===void 0||j===!0||j===void 0&&_[Z]!==!1)&&(_[Z||k]=iv(n))}const T=(n,k)=>Mt.forEach(n,(j,U)=>b(j,U,k));if(Mt.isPlainObject(t)||t instanceof this.constructor)T(t,l);else if(Mt.isString(t)&&(t=t.trim())&&!G6(t))T(q6(t),l);else if(Mt.isHeaders(t))for(const[n,k]of t.entries())b(k,n,f);else t!=null&&b(l,t,f);return this}get(t,l){if(t=j_(t),t){const f=Mt.findKey(this,t);if(f){const _=this[f];if(!l)return _;if(l===!0)return H6(_);if(Mt.isFunction(l))return l.call(this,_,f);if(Mt.isRegExp(l))return l.exec(_);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,l){if(t=j_(t),t){const f=Mt.findKey(this,t);return!!(f&&this[f]!==void 0&&(!l||sw(this,this[f],f,l)))}return!1}delete(t,l){const f=this;let _=!1;function b(T){if(T=j_(T),T){const n=Mt.findKey(f,T);n&&(!l||sw(f,f[n],n,l))&&(delete f[n],_=!0)}}return Mt.isArray(t)?t.forEach(b):b(t),_}clear(t){const l=Object.keys(this);let f=l.length,_=!1;for(;f--;){const b=l[f];(!t||sw(this,this[b],b,t,!0))&&(delete this[b],_=!0)}return _}normalize(t){const l=this,f={};return Mt.forEach(this,(_,b)=>{const T=Mt.findKey(f,b);if(T){l[T]=iv(_),delete l[b];return}const n=t?W6(b):String(b).trim();n!==b&&delete l[b],l[n]=iv(_),f[n]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const l=Object.create(null);return Mt.forEach(this,(f,_)=>{f!=null&&f!==!1&&(l[_]=t&&Mt.isArray(f)?f.join(", "):f)}),l}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,l])=>t+": "+l).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...l){const f=new this(t);return l.forEach(_=>f.set(_)),f}static accessor(t){const f=(this[RC]=this[RC]={accessors:{}}).accessors,_=this.prototype;function b(T){const n=j_(T);f[n]||(Z6(_,T),f[n]=!0)}return Mt.isArray(t)?t.forEach(b):b(t),this}}f1.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Mt.reduceDescriptors(f1.prototype,({value:r},t)=>{let l=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(f){this[l]=f}}});Mt.freezeMethods(f1);const Wa=f1;function ow(r,t){const l=this||o2,f=t||l,_=Wa.from(f.headers);let b=f.data;return Mt.forEach(r,function(n){b=n.call(l,b,_.normalize(),t?t.status:void 0)}),_.normalize(),b}function CR(r){return!!(r&&r.__CANCEL__)}function Np(r,t,l){ln.call(this,r??"canceled",ln.ERR_CANCELED,t,l),this.name="CanceledError"}Mt.inherits(Np,ln,{__CANCEL__:!0});function IR(r,t,l){const f=l.config.validateStatus;!l.status||!f||f(l.status)?r(l):t(new ln("Request failed with status code "+l.status,[ln.ERR_BAD_REQUEST,ln.ERR_BAD_RESPONSE][Math.floor(l.status/100)-4],l.config,l.request,l))}function X6(r){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return t&&t[1]||""}function Y6(r,t){r=r||10;const l=new Array(r),f=new Array(r);let _=0,b=0,T;return t=t!==void 0?t:1e3,function(k){const j=Date.now(),U=f[b];T||(T=j),l[_]=k,f[_]=j;let Z=b,re=0;for(;Z!==_;)re+=l[Z++],Z=Z%r;if(_=(_+1)%r,_===b&&(b=(b+1)%r),j-T<t)return;const se=U&&j-U;return se?Math.round(re*1e3/se):void 0}}function K6(r,t){let l=0,f=1e3/t,_,b;const T=(j,U=Date.now())=>{l=U,_=null,b&&(clearTimeout(b),b=null),r.apply(null,j)};return[(...j)=>{const U=Date.now(),Z=U-l;Z>=f?T(j,U):(_=j,b||(b=setTimeout(()=>{b=null,T(_)},f-Z)))},()=>_&&T(_)]}const xv=(r,t,l=3)=>{let f=0;const _=Y6(50,250);return K6(b=>{const T=b.loaded,n=b.lengthComputable?b.total:void 0,k=T-f,j=_(k),U=T<=n;f=T;const Z={loaded:T,total:n,progress:n?T/n:void 0,bytes:k,rate:j||void 0,estimated:j&&n&&U?(n-T)/j:void 0,event:b,lengthComputable:n!=null,[t?"download":"upload"]:!0};r(Z)},l)},DC=(r,t)=>{const l=r!=null;return[f=>t[0]({lengthComputable:l,total:r,loaded:f}),t[1]]},LC=r=>(...t)=>Mt.asap(()=>r(...t)),J6=ks.hasStandardBrowserEnv?((r,t)=>l=>(l=new URL(l,ks.origin),r.protocol===l.protocol&&r.host===l.host&&(t||r.port===l.port)))(new URL(ks.origin),ks.navigator&&/(msie|trident)/i.test(ks.navigator.userAgent)):()=>!0,Q6=ks.hasStandardBrowserEnv?{write(r,t,l,f,_,b){const T=[r+"="+encodeURIComponent(t)];Mt.isNumber(l)&&T.push("expires="+new Date(l).toGMTString()),Mt.isString(f)&&T.push("path="+f),Mt.isString(_)&&T.push("domain="+_),b===!0&&T.push("secure"),document.cookie=T.join("; ")},read(r){const t=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function eU(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function tU(r,t){return t?r.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):r}function PR(r,t,l){let f=!eU(t);return r&&f||l==!1?tU(r,t):t}const OC=r=>r instanceof Wa?{...r}:r;function fd(r,t){t=t||{};const l={};function f(j,U,Z,re){return Mt.isPlainObject(j)&&Mt.isPlainObject(U)?Mt.merge.call({caseless:re},j,U):Mt.isPlainObject(U)?Mt.merge({},U):Mt.isArray(U)?U.slice():U}function _(j,U,Z,re){if(Mt.isUndefined(U)){if(!Mt.isUndefined(j))return f(void 0,j,Z,re)}else return f(j,U,Z,re)}function b(j,U){if(!Mt.isUndefined(U))return f(void 0,U)}function T(j,U){if(Mt.isUndefined(U)){if(!Mt.isUndefined(j))return f(void 0,j)}else return f(void 0,U)}function n(j,U,Z){if(Z in t)return f(j,U);if(Z in r)return f(void 0,j)}const k={url:b,method:b,data:b,baseURL:T,transformRequest:T,transformResponse:T,paramsSerializer:T,timeout:T,timeoutMessage:T,withCredentials:T,withXSRFToken:T,adapter:T,responseType:T,xsrfCookieName:T,xsrfHeaderName:T,onUploadProgress:T,onDownloadProgress:T,decompress:T,maxContentLength:T,maxBodyLength:T,beforeRedirect:T,transport:T,httpAgent:T,httpsAgent:T,cancelToken:T,socketPath:T,responseEncoding:T,validateStatus:n,headers:(j,U,Z)=>_(OC(j),OC(U),Z,!0)};return Mt.forEach(Object.keys(Object.assign({},r,t)),function(U){const Z=k[U]||_,re=Z(r[U],t[U],U);Mt.isUndefined(re)&&Z!==n||(l[U]=re)}),l}const RR=r=>{const t=fd({},r);let{data:l,withXSRFToken:f,xsrfHeaderName:_,xsrfCookieName:b,headers:T,auth:n}=t;t.headers=T=Wa.from(T),t.url=SR(PR(t.baseURL,t.url),r.params,r.paramsSerializer),n&&T.set("Authorization","Basic "+btoa((n.username||"")+":"+(n.password?unescape(encodeURIComponent(n.password)):"")));let k;if(Mt.isFormData(l)){if(ks.hasStandardBrowserEnv||ks.hasStandardBrowserWebWorkerEnv)T.setContentType(void 0);else if((k=T.getContentType())!==!1){const[j,...U]=k?k.split(";").map(Z=>Z.trim()).filter(Boolean):[];T.setContentType([j||"multipart/form-data",...U].join("; "))}}if(ks.hasStandardBrowserEnv&&(f&&Mt.isFunction(f)&&(f=f(t)),f||f!==!1&&J6(t.url))){const j=_&&b&&Q6.read(b);j&&T.set(_,j)}return t},iU=typeof XMLHttpRequest<"u",nU=iU&&function(r){return new Promise(function(l,f){const _=RR(r);let b=_.data;const T=Wa.from(_.headers).normalize();let{responseType:n,onUploadProgress:k,onDownloadProgress:j}=_,U,Z,re,se,ue;function ne(){se&&se(),ue&&ue(),_.cancelToken&&_.cancelToken.unsubscribe(U),_.signal&&_.signal.removeEventListener("abort",U)}let be=new XMLHttpRequest;be.open(_.method.toUpperCase(),_.url,!0),be.timeout=_.timeout;function De(){if(!be)return;const Te=Wa.from("getAllResponseHeaders"in be&&be.getAllResponseHeaders()),Ie={data:!n||n==="text"||n==="json"?be.responseText:be.response,status:be.status,statusText:be.statusText,headers:Te,config:r,request:be};IR(function(je){l(je),ne()},function(je){f(je),ne()},Ie),be=null}"onloadend"in be?be.onloadend=De:be.onreadystatechange=function(){!be||be.readyState!==4||be.status===0&&!(be.responseURL&&be.responseURL.indexOf("file:")===0)||setTimeout(De)},be.onabort=function(){be&&(f(new ln("Request aborted",ln.ECONNABORTED,r,be)),be=null)},be.onerror=function(){f(new ln("Network Error",ln.ERR_NETWORK,r,be)),be=null},be.ontimeout=function(){let me=_.timeout?"timeout of "+_.timeout+"ms exceeded":"timeout exceeded";const Ie=_.transitional||AR;_.timeoutErrorMessage&&(me=_.timeoutErrorMessage),f(new ln(me,Ie.clarifyTimeoutError?ln.ETIMEDOUT:ln.ECONNABORTED,r,be)),be=null},b===void 0&&T.setContentType(null),"setRequestHeader"in be&&Mt.forEach(T.toJSON(),function(me,Ie){be.setRequestHeader(Ie,me)}),Mt.isUndefined(_.withCredentials)||(be.withCredentials=!!_.withCredentials),n&&n!=="json"&&(be.responseType=_.responseType),j&&([re,ue]=xv(j,!0),be.addEventListener("progress",re)),k&&be.upload&&([Z,se]=xv(k),be.upload.addEventListener("progress",Z),be.upload.addEventListener("loadend",se)),(_.cancelToken||_.signal)&&(U=Te=>{be&&(f(!Te||Te.type?new Np(null,r,be):Te),be.abort(),be=null)},_.cancelToken&&_.cancelToken.subscribe(U),_.signal&&(_.signal.aborted?U():_.signal.addEventListener("abort",U)));const Be=X6(_.url);if(Be&&ks.protocols.indexOf(Be)===-1){f(new ln("Unsupported protocol "+Be+":",ln.ERR_BAD_REQUEST,r));return}be.send(b||null)})},rU=(r,t)=>{const{length:l}=r=r?r.filter(Boolean):[];if(t||l){let f=new AbortController,_;const b=function(j){if(!_){_=!0,n();const U=j instanceof Error?j:this.reason;f.abort(U instanceof ln?U:new Np(U instanceof Error?U.message:U))}};let T=t&&setTimeout(()=>{T=null,b(new ln(`timeout ${t} of ms exceeded`,ln.ETIMEDOUT))},t);const n=()=>{r&&(T&&clearTimeout(T),T=null,r.forEach(j=>{j.unsubscribe?j.unsubscribe(b):j.removeEventListener("abort",b)}),r=null)};r.forEach(j=>j.addEventListener("abort",b));const{signal:k}=f;return k.unsubscribe=()=>Mt.asap(n),k}},sU=rU,oU=function*(r,t){let l=r.byteLength;if(!t||l<t){yield r;return}let f=0,_;for(;f<l;)_=f+t,yield r.slice(f,_),f=_},aU=async function*(r,t){for await(const l of lU(r))yield*oU(l,t)},lU=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const t=r.getReader();try{for(;;){const{done:l,value:f}=await t.read();if(l)break;yield f}}finally{await t.cancel()}},zC=(r,t,l,f)=>{const _=aU(r,t);let b=0,T,n=k=>{T||(T=!0,f&&f(k))};return new ReadableStream({async pull(k){try{const{done:j,value:U}=await _.next();if(j){n(),k.close();return}let Z=U.byteLength;if(l){let re=b+=Z;l(re)}k.enqueue(new Uint8Array(U))}catch(j){throw n(j),j}},cancel(k){return n(k),_.return()}},{highWaterMark:2})},p1=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",DR=p1&&typeof ReadableStream=="function",cU=p1&&(typeof TextEncoder=="function"?(r=>t=>r.encode(t))(new TextEncoder):async r=>new Uint8Array(await new Response(r).arrayBuffer())),LR=(r,...t)=>{try{return!!r(...t)}catch{return!1}},uU=DR&&LR(()=>{let r=!1;const t=new Request(ks.origin,{body:new ReadableStream,method:"POST",get duplex(){return r=!0,"half"}}).headers.has("Content-Type");return r&&!t}),kC=64*1024,Uw=DR&&LR(()=>Mt.isReadableStream(new Response("").body)),bv={stream:Uw&&(r=>r.body)};p1&&(r=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!bv[t]&&(bv[t]=Mt.isFunction(r[t])?l=>l[t]():(l,f)=>{throw new ln(`Response type '${t}' is not supported`,ln.ERR_NOT_SUPPORT,f)})})})(new Response);const hU=async r=>{if(r==null)return 0;if(Mt.isBlob(r))return r.size;if(Mt.isSpecCompliantForm(r))return(await new Request(ks.origin,{method:"POST",body:r}).arrayBuffer()).byteLength;if(Mt.isArrayBufferView(r)||Mt.isArrayBuffer(r))return r.byteLength;if(Mt.isURLSearchParams(r)&&(r=r+""),Mt.isString(r))return(await cU(r)).byteLength},dU=async(r,t)=>{const l=Mt.toFiniteNumber(r.getContentLength());return l??hU(t)},fU=p1&&(async r=>{let{url:t,method:l,data:f,signal:_,cancelToken:b,timeout:T,onDownloadProgress:n,onUploadProgress:k,responseType:j,headers:U,withCredentials:Z="same-origin",fetchOptions:re}=RR(r);j=j?(j+"").toLowerCase():"text";let se=sU([_,b&&b.toAbortSignal()],T),ue;const ne=se&&se.unsubscribe&&(()=>{se.unsubscribe()});let be;try{if(k&&uU&&l!=="get"&&l!=="head"&&(be=await dU(U,f))!==0){let Ie=new Request(t,{method:"POST",body:f,duplex:"half"}),Xe;if(Mt.isFormData(f)&&(Xe=Ie.headers.get("content-type"))&&U.setContentType(Xe),Ie.body){const[je,rt]=DC(be,xv(LC(k)));f=zC(Ie.body,kC,je,rt)}}Mt.isString(Z)||(Z=Z?"include":"omit");const De="credentials"in Request.prototype;ue=new Request(t,{...re,signal:se,method:l.toUpperCase(),headers:U.normalize().toJSON(),body:f,duplex:"half",credentials:De?Z:void 0});let Be=await fetch(ue);const Te=Uw&&(j==="stream"||j==="response");if(Uw&&(n||Te&&ne)){const Ie={};["status","statusText","headers"].forEach(Ve=>{Ie[Ve]=Be[Ve]});const Xe=Mt.toFiniteNumber(Be.headers.get("content-length")),[je,rt]=n&&DC(Xe,xv(LC(n),!0))||[];Be=new Response(zC(Be.body,kC,je,()=>{rt&&rt(),ne&&ne()}),Ie)}j=j||"text";let me=await bv[Mt.findKey(bv,j)||"text"](Be,r);return!Te&&ne&&ne(),await new Promise((Ie,Xe)=>{IR(Ie,Xe,{data:me,headers:Wa.from(Be.headers),status:Be.status,statusText:Be.statusText,config:r,request:ue})})}catch(De){throw ne&&ne(),De&&De.name==="TypeError"&&/fetch/i.test(De.message)?Object.assign(new ln("Network Error",ln.ERR_NETWORK,r,ue),{cause:De.cause||De}):ln.from(De,De&&De.code,r,ue)}}),jw={http:A6,xhr:nU,fetch:fU};Mt.forEach(jw,(r,t)=>{if(r){try{Object.defineProperty(r,"name",{value:t})}catch{}Object.defineProperty(r,"adapterName",{value:t})}});const FC=r=>`- ${r}`,pU=r=>Mt.isFunction(r)||r===null||r===!1,OR={getAdapter:r=>{r=Mt.isArray(r)?r:[r];const{length:t}=r;let l,f;const _={};for(let b=0;b<t;b++){l=r[b];let T;if(f=l,!pU(l)&&(f=jw[(T=String(l)).toLowerCase()],f===void 0))throw new ln(`Unknown adapter '${T}'`);if(f)break;_[T||"#"+b]=f}if(!f){const b=Object.entries(_).map(([n,k])=>`adapter ${n} `+(k===!1?"is not supported by the environment":"is not available in the build"));let T=t?b.length>1?`since :
`+b.map(FC).join(`
`):" "+FC(b[0]):"as no adapter specified";throw new ln("There is no suitable adapter to dispatch the request "+T,"ERR_NOT_SUPPORT")}return f},adapters:jw};function aw(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Np(null,r)}function NC(r){return aw(r),r.headers=Wa.from(r.headers),r.data=ow.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),OR.getAdapter(r.adapter||o2.adapter)(r).then(function(f){return aw(r),f.data=ow.call(r,r.transformResponse,f),f.headers=Wa.from(f.headers),f},function(f){return CR(f)||(aw(r),f&&f.response&&(f.response.data=ow.call(r,r.transformResponse,f.response),f.response.headers=Wa.from(f.response.headers))),Promise.reject(f)})}const zR="1.8.2",m1={};["object","boolean","number","function","string","symbol"].forEach((r,t)=>{m1[r]=function(f){return typeof f===r||"a"+(t<1?"n ":" ")+r}});const BC={};m1.transitional=function(t,l,f){function _(b,T){return"[Axios v"+zR+"] Transitional option '"+b+"'"+T+(f?". "+f:"")}return(b,T,n)=>{if(t===!1)throw new ln(_(T," has been removed"+(l?" in "+l:"")),ln.ERR_DEPRECATED);return l&&!BC[T]&&(BC[T]=!0,console.warn(_(T," has been deprecated since v"+l+" and will be removed in the near future"))),t?t(b,T,n):!0}};m1.spelling=function(t){return(l,f)=>(console.warn(`${f} is likely a misspelling of ${t}`),!0)};function mU(r,t,l){if(typeof r!="object")throw new ln("options must be an object",ln.ERR_BAD_OPTION_VALUE);const f=Object.keys(r);let _=f.length;for(;_-- >0;){const b=f[_],T=t[b];if(T){const n=r[b],k=n===void 0||T(n,b,r);if(k!==!0)throw new ln("option "+b+" must be "+k,ln.ERR_BAD_OPTION_VALUE);continue}if(l!==!0)throw new ln("Unknown option "+b,ln.ERR_BAD_OPTION)}}const nv={assertOptions:mU,validators:m1},ml=nv.validators;class wv{constructor(t){this.defaults=t,this.interceptors={request:new PC,response:new PC}}async request(t,l){try{return await this._request(t,l)}catch(f){if(f instanceof Error){let _={};Error.captureStackTrace?Error.captureStackTrace(_):_=new Error;const b=_.stack?_.stack.replace(/^.+\n/,""):"";try{f.stack?b&&!String(f.stack).endsWith(b.replace(/^.+\n.+\n/,""))&&(f.stack+=`
`+b):f.stack=b}catch{}}throw f}}_request(t,l){typeof t=="string"?(l=l||{},l.url=t):l=t||{},l=fd(this.defaults,l);const{transitional:f,paramsSerializer:_,headers:b}=l;f!==void 0&&nv.assertOptions(f,{silentJSONParsing:ml.transitional(ml.boolean),forcedJSONParsing:ml.transitional(ml.boolean),clarifyTimeoutError:ml.transitional(ml.boolean)},!1),_!=null&&(Mt.isFunction(_)?l.paramsSerializer={serialize:_}:nv.assertOptions(_,{encode:ml.function,serialize:ml.function},!0)),l.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?l.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:l.allowAbsoluteUrls=!0),nv.assertOptions(l,{baseUrl:ml.spelling("baseURL"),withXsrfToken:ml.spelling("withXSRFToken")},!0),l.method=(l.method||this.defaults.method||"get").toLowerCase();let T=b&&Mt.merge(b.common,b[l.method]);b&&Mt.forEach(["delete","get","head","post","put","patch","common"],ue=>{delete b[ue]}),l.headers=Wa.concat(T,b);const n=[];let k=!0;this.interceptors.request.forEach(function(ne){typeof ne.runWhen=="function"&&ne.runWhen(l)===!1||(k=k&&ne.synchronous,n.unshift(ne.fulfilled,ne.rejected))});const j=[];this.interceptors.response.forEach(function(ne){j.push(ne.fulfilled,ne.rejected)});let U,Z=0,re;if(!k){const ue=[NC.bind(this),void 0];for(ue.unshift.apply(ue,n),ue.push.apply(ue,j),re=ue.length,U=Promise.resolve(l);Z<re;)U=U.then(ue[Z++],ue[Z++]);return U}re=n.length;let se=l;for(Z=0;Z<re;){const ue=n[Z++],ne=n[Z++];try{se=ue(se)}catch(be){ne.call(this,be);break}}try{U=NC.call(this,se)}catch(ue){return Promise.reject(ue)}for(Z=0,re=j.length;Z<re;)U=U.then(j[Z++],j[Z++]);return U}getUri(t){t=fd(this.defaults,t);const l=PR(t.baseURL,t.url,t.allowAbsoluteUrls);return SR(l,t.params,t.paramsSerializer)}}Mt.forEach(["delete","get","head","options"],function(t){wv.prototype[t]=function(l,f){return this.request(fd(f||{},{method:t,url:l,data:(f||{}).data}))}});Mt.forEach(["post","put","patch"],function(t){function l(f){return function(b,T,n){return this.request(fd(n||{},{method:t,headers:f?{"Content-Type":"multipart/form-data"}:{},url:b,data:T}))}}wv.prototype[t]=l(),wv.prototype[t+"Form"]=l(!0)});const rv=wv;class a2{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let l;this.promise=new Promise(function(b){l=b});const f=this;this.promise.then(_=>{if(!f._listeners)return;let b=f._listeners.length;for(;b-- >0;)f._listeners[b](_);f._listeners=null}),this.promise.then=_=>{let b;const T=new Promise(n=>{f.subscribe(n),b=n}).then(_);return T.cancel=function(){f.unsubscribe(b)},T},t(function(b,T,n){f.reason||(f.reason=new Np(b,T,n),l(f.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const l=this._listeners.indexOf(t);l!==-1&&this._listeners.splice(l,1)}toAbortSignal(){const t=new AbortController,l=f=>{t.abort(f)};return this.subscribe(l),t.signal.unsubscribe=()=>this.unsubscribe(l),t.signal}static source(){let t;return{token:new a2(function(_){t=_}),cancel:t}}}const _U=a2;function gU(r){return function(l){return r.apply(null,l)}}function yU(r){return Mt.isObject(r)&&r.isAxiosError===!0}const $w={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries($w).forEach(([r,t])=>{$w[t]=r});const vU=$w;function kR(r){const t=new rv(r),l=pR(rv.prototype.request,t);return Mt.extend(l,rv.prototype,t,{allOwnKeys:!0}),Mt.extend(l,t,null,{allOwnKeys:!0}),l.create=function(_){return kR(fd(r,_))},l}const Yr=kR(o2);Yr.Axios=rv;Yr.CanceledError=Np;Yr.CancelToken=_U;Yr.isCancel=CR;Yr.VERSION=zR;Yr.toFormData=d1;Yr.AxiosError=ln;Yr.Cancel=Yr.CanceledError;Yr.all=function(t){return Promise.all(t)};Yr.spread=gU;Yr.isAxiosError=yU;Yr.mergeConfig=fd;Yr.AxiosHeaders=Wa;Yr.formToJSON=r=>MR(Mt.isHTMLForm(r)?new FormData(r):r);Yr.getAdapter=OR.getAdapter;Yr.HttpStatusCode=vU;Yr.default=Yr;const Ho=Yr;window.axios=Ho;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";window.axios.defaults.baseURL="/public/api/";function ic(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function FR(r,t){r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.__proto__=t}/*!
 * GSAP 3.12.7
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Vo={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},vp={duration:.5,overwrite:!1,delay:0},l2,Ts,yr,ga=1e8,Qn=1/ga,qw=Math.PI*2,xU=qw/4,bU=0,NR=Math.sqrt,wU=Math.cos,TU=Math.sin,gs=function(t){return typeof t=="string"},Ir=function(t){return typeof t=="function"},dc=function(t){return typeof t=="number"},c2=function(t){return typeof t>"u"},Ml=function(t){return typeof t=="object"},vo=function(t){return t!==!1},u2=function(){return typeof window<"u"},F0=function(t){return Ir(t)||gs(t)},BR=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},Bs=Array.isArray,Hw=/(?:-?\.?\d|\.)+/gi,VR=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,ep=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,lw=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,UR=/[+-]=-?[.\d]+/,jR=/[^,'"\[\]\s]+/gi,EU=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,Sr,yl,Gw,h2,Go={},Tv={},$R,qR=function(t){return(Tv=xp(t,Go))&&To},d2=function(t,l){return console.warn("Invalid property",t,"set to",l,"Missing plugin? gsap.registerPlugin()")},pg=function(t,l){return!l&&console.warn(t)},HR=function(t,l){return t&&(Go[t]=l)&&Tv&&(Tv[t]=l)||Go},mg=function(){return 0},SU={suppressEvents:!0,isStart:!0,kill:!1},sv={suppressEvents:!0,kill:!1},AU={suppressEvents:!0},f2={},_u=[],Ww={},GR,zo={},cw={},VC=30,ov=[],p2="",m2=function(t){var l=t[0],f,_;if(Ml(l)||Ir(l)||(t=[t]),!(f=(l._gsap||{}).harness)){for(_=ov.length;_--&&!ov[_].targetTest(l););f=ov[_]}for(_=t.length;_--;)t[_]&&(t[_]._gsap||(t[_]._gsap=new _3(t[_],f)))||t.splice(_,1);return t},td=function(t){return t._gsap||m2(ya(t))[0]._gsap},WR=function(t,l,f){return(f=t[l])&&Ir(f)?t[l]():c2(f)&&t.getAttribute&&t.getAttribute(l)||f},xo=function(t,l){return(t=t.split(",")).forEach(l)||t},Fr=function(t){return Math.round(t*1e5)/1e5||0},Zr=function(t){return Math.round(t*1e7)/1e7||0},np=function(t,l){var f=l.charAt(0),_=parseFloat(l.substr(2));return t=parseFloat(t),f==="+"?t+_:f==="-"?t-_:f==="*"?t*_:t/_},MU=function(t,l){for(var f=l.length,_=0;t.indexOf(l[_])<0&&++_<f;);return _<f},Ev=function(){var t=_u.length,l=_u.slice(0),f,_;for(Ww={},_u.length=0,f=0;f<t;f++)_=l[f],_&&_._lazy&&(_.render(_._lazy[0],_._lazy[1],!0)._lazy=0)},ZR=function(t,l,f,_){_u.length&&!Ts&&Ev(),t.render(l,f,_||Ts&&l<0&&(t._initted||t._startAt)),_u.length&&!Ts&&Ev()},XR=function(t){var l=parseFloat(t);return(l||l===0)&&(t+"").match(jR).length<2?l:gs(t)?t.trim():t},YR=function(t){return t},Wo=function(t,l){for(var f in l)f in t||(t[f]=l[f]);return t},CU=function(t){return function(l,f){for(var _ in f)_ in l||_==="duration"&&t||_==="ease"||(l[_]=f[_])}},xp=function(t,l){for(var f in l)t[f]=l[f];return t},UC=function r(t,l){for(var f in l)f!=="__proto__"&&f!=="constructor"&&f!=="prototype"&&(t[f]=Ml(l[f])?r(t[f]||(t[f]={}),l[f]):l[f]);return t},Sv=function(t,l){var f={},_;for(_ in t)_ in l||(f[_]=t[_]);return f},eg=function(t){var l=t.parent||Sr,f=t.keyframes?CU(Bs(t.keyframes)):Wo;if(vo(t.inherit))for(;l;)f(t,l.vars.defaults),l=l.parent||l._dp;return t},IU=function(t,l){for(var f=t.length,_=f===l.length;_&&f--&&t[f]===l[f];);return f<0},KR=function(t,l,f,_,b){f===void 0&&(f="_first"),_===void 0&&(_="_last");var T=t[_],n;if(b)for(n=l[b];T&&T[b]>n;)T=T._prev;return T?(l._next=T._next,T._next=l):(l._next=t[f],t[f]=l),l._next?l._next._prev=l:t[_]=l,l._prev=T,l.parent=l._dp=t,l},_1=function(t,l,f,_){f===void 0&&(f="_first"),_===void 0&&(_="_last");var b=l._prev,T=l._next;b?b._next=T:t[f]===l&&(t[f]=T),T?T._prev=b:t[_]===l&&(t[_]=b),l._next=l._prev=l.parent=null},Au=function(t,l){t.parent&&(!l||t.parent.autoRemoveChildren)&&t.parent.remove&&t.parent.remove(t),t._act=0},nd=function(t,l){if(t&&(!l||l._end>t._dur||l._start<0))for(var f=t;f;)f._dirty=1,f=f.parent;return t},PU=function(t){for(var l=t.parent;l&&l.parent;)l._dirty=1,l.totalDuration(),l=l.parent;return t},Zw=function(t,l,f,_){return t._startAt&&(Ts?t._startAt.revert(sv):t.vars.immediateRender&&!t.vars.autoRevert||t._startAt.render(l,!0,_))},RU=function r(t){return!t||t._ts&&r(t.parent)},jC=function(t){return t._repeat?bp(t._tTime,t=t.duration()+t._rDelay)*t:0},bp=function(t,l){var f=Math.floor(t=Zr(t/l));return t&&f===t?f-1:f},Av=function(t,l){return(t-l._start)*l._ts+(l._ts>=0?0:l._dirty?l.totalDuration():l._tDur)},g1=function(t){return t._end=Zr(t._start+(t._tDur/Math.abs(t._ts||t._rts||Qn)||0))},y1=function(t,l){var f=t._dp;return f&&f.smoothChildTiming&&t._ts&&(t._start=Zr(f._time-(t._ts>0?l/t._ts:((t._dirty?t.totalDuration():t._tDur)-l)/-t._ts)),g1(t),f._dirty||nd(f,t)),t},JR=function(t,l){var f;if((l._time||!l._dur&&l._initted||l._start<t._time&&(l._dur||!l.add))&&(f=Av(t.rawTime(),l),(!l._dur||jg(0,l.totalDuration(),f)-l._tTime>Qn)&&l.render(f,!0)),nd(t,l)._dp&&t._initted&&t._time>=t._dur&&t._ts){if(t._dur<t.duration())for(f=t;f._dp;)f.rawTime()>=0&&f.totalTime(f._tTime),f=f._dp;t._zTime=-Qn}},xl=function(t,l,f,_){return l.parent&&Au(l),l._start=Zr((dc(f)?f:f||t!==Sr?ma(t,f,l):t._time)+l._delay),l._end=Zr(l._start+(l.totalDuration()/Math.abs(l.timeScale())||0)),KR(t,l,"_first","_last",t._sort?"_start":0),Xw(l)||(t._recent=l),_||JR(t,l),t._ts<0&&y1(t,t._tTime),t},QR=function(t,l){return(Go.ScrollTrigger||d2("scrollTrigger",l))&&Go.ScrollTrigger.create(l,t)},e3=function(t,l,f,_,b){if(g2(t,l,b),!t._initted)return 1;if(!f&&t._pt&&!Ts&&(t._dur&&t.vars.lazy!==!1||!t._dur&&t.vars.lazy)&&GR!==ko.frame)return _u.push(t),t._lazy=[b,_],1},DU=function r(t){var l=t.parent;return l&&l._ts&&l._initted&&!l._lock&&(l.rawTime()<0||r(l))},Xw=function(t){var l=t.data;return l==="isFromStart"||l==="isStart"},LU=function(t,l,f,_){var b=t.ratio,T=l<0||!l&&(!t._start&&DU(t)&&!(!t._initted&&Xw(t))||(t._ts<0||t._dp._ts<0)&&!Xw(t))?0:1,n=t._rDelay,k=0,j,U,Z;if(n&&t._repeat&&(k=jg(0,t._tDur,l),U=bp(k,n),t._yoyo&&U&1&&(T=1-T),U!==bp(t._tTime,n)&&(b=1-T,t.vars.repeatRefresh&&t._initted&&t.invalidate())),T!==b||Ts||_||t._zTime===Qn||!l&&t._zTime){if(!t._initted&&e3(t,l,_,f,k))return;for(Z=t._zTime,t._zTime=l||(f?Qn:0),f||(f=l&&!Z),t.ratio=T,t._from&&(T=1-T),t._time=0,t._tTime=k,j=t._pt;j;)j.r(T,j.d),j=j._next;l<0&&Zw(t,l,f,!0),t._onUpdate&&!f&&Fo(t,"onUpdate"),k&&t._repeat&&!f&&t.parent&&Fo(t,"onRepeat"),(l>=t._tDur||l<0)&&t.ratio===T&&(T&&Au(t,1),!f&&!Ts&&(Fo(t,T?"onComplete":"onReverseComplete",!0),t._prom&&t._prom()))}else t._zTime||(t._zTime=l)},OU=function(t,l,f){var _;if(f>l)for(_=t._first;_&&_._start<=f;){if(_.data==="isPause"&&_._start>l)return _;_=_._next}else for(_=t._last;_&&_._start>=f;){if(_.data==="isPause"&&_._start<l)return _;_=_._prev}},wp=function(t,l,f,_){var b=t._repeat,T=Zr(l)||0,n=t._tTime/t._tDur;return n&&!_&&(t._time*=T/t._dur),t._dur=T,t._tDur=b?b<0?1e10:Zr(T*(b+1)+t._rDelay*b):T,n>0&&!_&&y1(t,t._tTime=t._tDur*n),t.parent&&g1(t),f||nd(t.parent,t),t},$C=function(t){return t instanceof to?nd(t):wp(t,t._dur)},zU={_start:0,endTime:mg,totalDuration:mg},ma=function r(t,l,f){var _=t.labels,b=t._recent||zU,T=t.duration()>=ga?b.endTime(!1):t._dur,n,k,j;return gs(l)&&(isNaN(l)||l in _)?(k=l.charAt(0),j=l.substr(-1)==="%",n=l.indexOf("="),k==="<"||k===">"?(n>=0&&(l=l.replace(/=/,"")),(k==="<"?b._start:b.endTime(b._repeat>=0))+(parseFloat(l.substr(1))||0)*(j?(n<0?b:f).totalDuration()/100:1)):n<0?(l in _||(_[l]=T),_[l]):(k=parseFloat(l.charAt(n-1)+l.substr(n+1)),j&&f&&(k=k/100*(Bs(f)?f[0]:f).totalDuration()),n>1?r(t,l.substr(0,n-1),f)+k:T+k)):l==null?T:+l},tg=function(t,l,f){var _=dc(l[1]),b=(_?2:1)+(t<2?0:1),T=l[b],n,k;if(_&&(T.duration=l[1]),T.parent=f,t){for(n=T,k=f;k&&!("immediateRender"in n);)n=k.vars.defaults||{},k=vo(k.vars.inherit)&&k.parent;T.immediateRender=vo(n.immediateRender),t<2?T.runBackwards=1:T.startAt=l[b-1]}return new Wr(l[0],T,l[b+1])},Ou=function(t,l){return t||t===0?l(t):l},jg=function(t,l,f){return f<t?t:f>l?l:f},Fs=function(t,l){return!gs(t)||!(l=EU.exec(t))?"":l[1]},kU=function(t,l,f){return Ou(f,function(_){return jg(t,l,_)})},Yw=[].slice,t3=function(t,l){return t&&Ml(t)&&"length"in t&&(!l&&!t.length||t.length-1 in t&&Ml(t[0]))&&!t.nodeType&&t!==yl},FU=function(t,l,f){return f===void 0&&(f=[]),t.forEach(function(_){var b;return gs(_)&&!l||t3(_,1)?(b=f).push.apply(b,ya(_)):f.push(_)})||f},ya=function(t,l,f){return yr&&!l&&yr.selector?yr.selector(t):gs(t)&&!f&&(Gw||!Tp())?Yw.call((l||h2).querySelectorAll(t),0):Bs(t)?FU(t,f):t3(t)?Yw.call(t,0):t?[t]:[]},Kw=function(t){return t=ya(t)[0]||pg("Invalid scope")||{},function(l){var f=t.current||t.nativeElement||t;return ya(l,f.querySelectorAll?f:f===t?pg("Invalid scope")||h2.createElement("div"):t)}},i3=function(t){return t.sort(function(){return .5-Math.random()})},n3=function(t){if(Ir(t))return t;var l=Ml(t)?t:{each:t},f=rd(l.ease),_=l.from||0,b=parseFloat(l.base)||0,T={},n=_>0&&_<1,k=isNaN(_)||n,j=l.axis,U=_,Z=_;return gs(_)?U=Z={center:.5,edges:.5,end:1}[_]||0:!n&&k&&(U=_[0],Z=_[1]),function(re,se,ue){var ne=(ue||l).length,be=T[ne],De,Be,Te,me,Ie,Xe,je,rt,Ve;if(!be){if(Ve=l.grid==="auto"?0:(l.grid||[1,ga])[1],!Ve){for(je=-ga;je<(je=ue[Ve++].getBoundingClientRect().left)&&Ve<ne;);Ve<ne&&Ve--}for(be=T[ne]=[],De=k?Math.min(Ve,ne)*U-.5:_%Ve,Be=Ve===ga?0:k?ne*Z/Ve-.5:_/Ve|0,je=0,rt=ga,Xe=0;Xe<ne;Xe++)Te=Xe%Ve-De,me=Be-(Xe/Ve|0),be[Xe]=Ie=j?Math.abs(j==="y"?me:Te):NR(Te*Te+me*me),Ie>je&&(je=Ie),Ie<rt&&(rt=Ie);_==="random"&&i3(be),be.max=je-rt,be.min=rt,be.v=ne=(parseFloat(l.amount)||parseFloat(l.each)*(Ve>ne?ne-1:j?j==="y"?ne/Ve:Ve:Math.max(Ve,ne/Ve))||0)*(_==="edges"?-1:1),be.b=ne<0?b-ne:b,be.u=Fs(l.amount||l.each)||0,f=f&&ne<0?f3(f):f}return ne=(be[re]-be.min)/be.max||0,Zr(be.b+(f?f(ne):ne)*be.v)+be.u}},Jw=function(t){var l=Math.pow(10,((t+"").split(".")[1]||"").length);return function(f){var _=Zr(Math.round(parseFloat(f)/t)*t*l);return(_-_%1)/l+(dc(f)?0:Fs(f))}},r3=function(t,l){var f=Bs(t),_,b;return!f&&Ml(t)&&(_=f=t.radius||ga,t.values?(t=ya(t.values),(b=!dc(t[0]))&&(_*=_)):t=Jw(t.increment)),Ou(l,f?Ir(t)?function(T){return b=t(T),Math.abs(b-T)<=_?b:T}:function(T){for(var n=parseFloat(b?T.x:T),k=parseFloat(b?T.y:0),j=ga,U=0,Z=t.length,re,se;Z--;)b?(re=t[Z].x-n,se=t[Z].y-k,re=re*re+se*se):re=Math.abs(t[Z]-n),re<j&&(j=re,U=Z);return U=!_||j<=_?t[U]:T,b||U===T||dc(T)?U:U+Fs(T)}:Jw(t))},s3=function(t,l,f,_){return Ou(Bs(t)?!l:f===!0?!!(f=0):!_,function(){return Bs(t)?t[~~(Math.random()*t.length)]:(f=f||1e-5)&&(_=f<1?Math.pow(10,(f+"").length-2):1)&&Math.floor(Math.round((t-f/2+Math.random()*(l-t+f*.99))/f)*f*_)/_})},NU=function(){for(var t=arguments.length,l=new Array(t),f=0;f<t;f++)l[f]=arguments[f];return function(_){return l.reduce(function(b,T){return T(b)},_)}},BU=function(t,l){return function(f){return t(parseFloat(f))+(l||Fs(f))}},VU=function(t,l,f){return a3(t,l,0,1,f)},o3=function(t,l,f){return Ou(f,function(_){return t[~~l(_)]})},UU=function r(t,l,f){var _=l-t;return Bs(t)?o3(t,r(0,t.length),l):Ou(f,function(b){return(_+(b-t)%_)%_+t})},jU=function r(t,l,f){var _=l-t,b=_*2;return Bs(t)?o3(t,r(0,t.length-1),l):Ou(f,function(T){return T=(b+(T-t)%b)%b||0,t+(T>_?b-T:T)})},_g=function(t){for(var l=0,f="",_,b,T,n;~(_=t.indexOf("random(",l));)T=t.indexOf(")",_),n=t.charAt(_+7)==="[",b=t.substr(_+7,T-_-7).match(n?jR:Hw),f+=t.substr(l,_-l)+s3(n?b:+b[0],n?0:+b[1],+b[2]||1e-5),l=T+1;return f+t.substr(l,t.length-l)},a3=function(t,l,f,_,b){var T=l-t,n=_-f;return Ou(b,function(k){return f+((k-t)/T*n||0)})},$U=function r(t,l,f,_){var b=isNaN(t+l)?0:function(se){return(1-se)*t+se*l};if(!b){var T=gs(t),n={},k,j,U,Z,re;if(f===!0&&(_=1)&&(f=null),T)t={p:t},l={p:l};else if(Bs(t)&&!Bs(l)){for(U=[],Z=t.length,re=Z-2,j=1;j<Z;j++)U.push(r(t[j-1],t[j]));Z--,b=function(ue){ue*=Z;var ne=Math.min(re,~~ue);return U[ne](ue-ne)},f=l}else _||(t=xp(Bs(t)?[]:{},t));if(!U){for(k in l)_2.call(n,t,k,"get",l[k]);b=function(ue){return x2(ue,n)||(T?t.p:t)}}}return Ou(f,b)},qC=function(t,l,f){var _=t.labels,b=ga,T,n,k;for(T in _)n=_[T]-l,n<0==!!f&&n&&b>(n=Math.abs(n))&&(k=T,b=n);return k},Fo=function(t,l,f){var _=t.vars,b=_[l],T=yr,n=t._ctx,k,j,U;if(b)return k=_[l+"Params"],j=_.callbackScope||t,f&&_u.length&&Ev(),n&&(yr=n),U=k?b.apply(j,k):b.call(j),yr=T,U},W_=function(t){return Au(t),t.scrollTrigger&&t.scrollTrigger.kill(!!Ts),t.progress()<1&&Fo(t,"onInterrupt"),t},tp,l3=[],c3=function(t){if(t)if(t=!t.name&&t.default||t,u2()||t.headless){var l=t.name,f=Ir(t),_=l&&!f&&t.init?function(){this._props=[]}:t,b={init:mg,render:x2,add:_2,kill:sj,modifier:rj,rawVars:0},T={targetTest:0,get:0,getSetter:v2,aliases:{},register:0};if(Tp(),t!==_){if(zo[l])return;Wo(_,Wo(Sv(t,b),T)),xp(_.prototype,xp(b,Sv(t,T))),zo[_.prop=l]=_,t.targetTest&&(ov.push(_),f2[l]=1),l=(l==="css"?"CSS":l.charAt(0).toUpperCase()+l.substr(1))+"Plugin"}HR(l,_),t.register&&t.register(To,_,bo)}else l3.push(t)},Jn=255,Z_={aqua:[0,Jn,Jn],lime:[0,Jn,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Jn],navy:[0,0,128],white:[Jn,Jn,Jn],olive:[128,128,0],yellow:[Jn,Jn,0],orange:[Jn,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Jn,0,0],pink:[Jn,192,203],cyan:[0,Jn,Jn],transparent:[Jn,Jn,Jn,0]},uw=function(t,l,f){return t+=t<0?1:t>1?-1:0,(t*6<1?l+(f-l)*t*6:t<.5?f:t*3<2?l+(f-l)*(2/3-t)*6:l)*Jn+.5|0},u3=function(t,l,f){var _=t?dc(t)?[t>>16,t>>8&Jn,t&Jn]:0:Z_.black,b,T,n,k,j,U,Z,re,se,ue;if(!_){if(t.substr(-1)===","&&(t=t.substr(0,t.length-1)),Z_[t])_=Z_[t];else if(t.charAt(0)==="#"){if(t.length<6&&(b=t.charAt(1),T=t.charAt(2),n=t.charAt(3),t="#"+b+b+T+T+n+n+(t.length===5?t.charAt(4)+t.charAt(4):"")),t.length===9)return _=parseInt(t.substr(1,6),16),[_>>16,_>>8&Jn,_&Jn,parseInt(t.substr(7),16)/255];t=parseInt(t.substr(1),16),_=[t>>16,t>>8&Jn,t&Jn]}else if(t.substr(0,3)==="hsl"){if(_=ue=t.match(Hw),!l)k=+_[0]%360/360,j=+_[1]/100,U=+_[2]/100,T=U<=.5?U*(j+1):U+j-U*j,b=U*2-T,_.length>3&&(_[3]*=1),_[0]=uw(k+1/3,b,T),_[1]=uw(k,b,T),_[2]=uw(k-1/3,b,T);else if(~t.indexOf("="))return _=t.match(VR),f&&_.length<4&&(_[3]=1),_}else _=t.match(Hw)||Z_.transparent;_=_.map(Number)}return l&&!ue&&(b=_[0]/Jn,T=_[1]/Jn,n=_[2]/Jn,Z=Math.max(b,T,n),re=Math.min(b,T,n),U=(Z+re)/2,Z===re?k=j=0:(se=Z-re,j=U>.5?se/(2-Z-re):se/(Z+re),k=Z===b?(T-n)/se+(T<n?6:0):Z===T?(n-b)/se+2:(b-T)/se+4,k*=60),_[0]=~~(k+.5),_[1]=~~(j*100+.5),_[2]=~~(U*100+.5)),f&&_.length<4&&(_[3]=1),_},h3=function(t){var l=[],f=[],_=-1;return t.split(gu).forEach(function(b){var T=b.match(ep)||[];l.push.apply(l,T),f.push(_+=T.length+1)}),l.c=f,l},HC=function(t,l,f){var _="",b=(t+_).match(gu),T=l?"hsla(":"rgba(",n=0,k,j,U,Z;if(!b)return t;if(b=b.map(function(re){return(re=u3(re,l,1))&&T+(l?re[0]+","+re[1]+"%,"+re[2]+"%,"+re[3]:re.join(","))+")"}),f&&(U=h3(t),k=f.c,k.join(_)!==U.c.join(_)))for(j=t.replace(gu,"1").split(ep),Z=j.length-1;n<Z;n++)_+=j[n]+(~k.indexOf(n)?b.shift()||T+"0,0,0,0)":(U.length?U:b.length?b:f).shift());if(!j)for(j=t.split(gu),Z=j.length-1;n<Z;n++)_+=j[n]+b[n];return _+j[Z]},gu=function(){var r="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",t;for(t in Z_)r+="|"+t+"\\b";return new RegExp(r+")","gi")}(),qU=/hsl[a]?\(/,d3=function(t){var l=t.join(" "),f;if(gu.lastIndex=0,gu.test(l))return f=qU.test(l),t[1]=HC(t[1],f),t[0]=HC(t[0],f,h3(t[1])),!0},gg,ko=function(){var r=Date.now,t=500,l=33,f=r(),_=f,b=1e3/240,T=b,n=[],k,j,U,Z,re,se,ue=function ne(be){var De=r()-_,Be=be===!0,Te,me,Ie,Xe;if((De>t||De<0)&&(f+=De-l),_+=De,Ie=_-f,Te=Ie-T,(Te>0||Be)&&(Xe=++Z.frame,re=Ie-Z.time*1e3,Z.time=Ie=Ie/1e3,T+=Te+(Te>=b?4:b-Te),me=1),Be||(k=j(ne)),me)for(se=0;se<n.length;se++)n[se](Ie,re,Xe,be)};return Z={time:0,frame:0,tick:function(){ue(!0)},deltaRatio:function(be){return re/(1e3/(be||60))},wake:function(){$R&&(!Gw&&u2()&&(yl=Gw=window,h2=yl.document||{},Go.gsap=To,(yl.gsapVersions||(yl.gsapVersions=[])).push(To.version),qR(Tv||yl.GreenSockGlobals||!yl.gsap&&yl||{}),l3.forEach(c3)),U=typeof requestAnimationFrame<"u"&&requestAnimationFrame,k&&Z.sleep(),j=U||function(be){return setTimeout(be,T-Z.time*1e3+1|0)},gg=1,ue(2))},sleep:function(){(U?cancelAnimationFrame:clearTimeout)(k),gg=0,j=mg},lagSmoothing:function(be,De){t=be||1/0,l=Math.min(De||33,t)},fps:function(be){b=1e3/(be||240),T=Z.time*1e3+b},add:function(be,De,Be){var Te=De?function(me,Ie,Xe,je){be(me,Ie,Xe,je),Z.remove(Te)}:be;return Z.remove(be),n[Be?"unshift":"push"](Te),Tp(),Te},remove:function(be,De){~(De=n.indexOf(be))&&n.splice(De,1)&&se>=De&&se--},_listeners:n},Z}(),Tp=function(){return!gg&&ko.wake()},Sn={},HU=/^[\d.\-M][\d.\-,\s]/,GU=/["']/g,WU=function(t){for(var l={},f=t.substr(1,t.length-3).split(":"),_=f[0],b=1,T=f.length,n,k,j;b<T;b++)k=f[b],n=b!==T-1?k.lastIndexOf(","):k.length,j=k.substr(0,n),l[_]=isNaN(j)?j.replace(GU,"").trim():+j,_=k.substr(n+1).trim();return l},ZU=function(t){var l=t.indexOf("(")+1,f=t.indexOf(")"),_=t.indexOf("(",l);return t.substring(l,~_&&_<f?t.indexOf(")",f+1):f)},XU=function(t){var l=(t+"").split("("),f=Sn[l[0]];return f&&l.length>1&&f.config?f.config.apply(null,~t.indexOf("{")?[WU(l[1])]:ZU(t).split(",").map(XR)):Sn._CE&&HU.test(t)?Sn._CE("",t):f},f3=function(t){return function(l){return 1-t(1-l)}},p3=function r(t,l){for(var f=t._first,_;f;)f instanceof to?r(f,l):f.vars.yoyoEase&&(!f._yoyo||!f._repeat)&&f._yoyo!==l&&(f.timeline?r(f.timeline,l):(_=f._ease,f._ease=f._yEase,f._yEase=_,f._yoyo=l)),f=f._next},rd=function(t,l){return t&&(Ir(t)?t:Sn[t]||XU(t))||l},Td=function(t,l,f,_){f===void 0&&(f=function(k){return 1-l(1-k)}),_===void 0&&(_=function(k){return k<.5?l(k*2)/2:1-l((1-k)*2)/2});var b={easeIn:l,easeOut:f,easeInOut:_},T;return xo(t,function(n){Sn[n]=Go[n]=b,Sn[T=n.toLowerCase()]=f;for(var k in b)Sn[T+(k==="easeIn"?".in":k==="easeOut"?".out":".inOut")]=Sn[n+"."+k]=b[k]}),b},m3=function(t){return function(l){return l<.5?(1-t(1-l*2))/2:.5+t((l-.5)*2)/2}},hw=function r(t,l,f){var _=l>=1?l:1,b=(f||(t?.3:.45))/(l<1?l:1),T=b/qw*(Math.asin(1/_)||0),n=function(U){return U===1?1:_*Math.pow(2,-10*U)*TU((U-T)*b)+1},k=t==="out"?n:t==="in"?function(j){return 1-n(1-j)}:m3(n);return b=qw/b,k.config=function(j,U){return r(t,j,U)},k},dw=function r(t,l){l===void 0&&(l=1.70158);var f=function(T){return T?--T*T*((l+1)*T+l)+1:0},_=t==="out"?f:t==="in"?function(b){return 1-f(1-b)}:m3(f);return _.config=function(b){return r(t,b)},_};xo("Linear,Quad,Cubic,Quart,Quint,Strong",function(r,t){var l=t<5?t+1:t;Td(r+",Power"+(l-1),t?function(f){return Math.pow(f,l)}:function(f){return f},function(f){return 1-Math.pow(1-f,l)},function(f){return f<.5?Math.pow(f*2,l)/2:1-Math.pow((1-f)*2,l)/2})});Sn.Linear.easeNone=Sn.none=Sn.Linear.easeIn;Td("Elastic",hw("in"),hw("out"),hw());(function(r,t){var l=1/t,f=2*l,_=2.5*l,b=function(n){return n<l?r*n*n:n<f?r*Math.pow(n-1.5/t,2)+.75:n<_?r*(n-=2.25/t)*n+.9375:r*Math.pow(n-2.625/t,2)+.984375};Td("Bounce",function(T){return 1-b(1-T)},b)})(7.5625,2.75);Td("Expo",function(r){return Math.pow(2,10*(r-1))*r+r*r*r*r*r*r*(1-r)});Td("Circ",function(r){return-(NR(1-r*r)-1)});Td("Sine",function(r){return r===1?1:-wU(r*xU)+1});Td("Back",dw("in"),dw("out"),dw());Sn.SteppedEase=Sn.steps=Go.SteppedEase={config:function(t,l){t===void 0&&(t=1);var f=1/t,_=t+(l?0:1),b=l?1:0,T=1-Qn;return function(n){return((_*jg(0,T,n)|0)+b)*f}}};vp.ease=Sn["quad.out"];xo("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(r){return p2+=r+","+r+"Params,"});var _3=function(t,l){this.id=bU++,t._gsap=this,this.target=t,this.harness=l,this.get=l?l.get:WR,this.set=l?l.getSetter:v2},yg=function(){function r(l){this.vars=l,this._delay=+l.delay||0,(this._repeat=l.repeat===1/0?-2:l.repeat||0)&&(this._rDelay=l.repeatDelay||0,this._yoyo=!!l.yoyo||!!l.yoyoEase),this._ts=1,wp(this,+l.duration,1,1),this.data=l.data,yr&&(this._ctx=yr,yr.data.push(this)),gg||ko.wake()}var t=r.prototype;return t.delay=function(f){return f||f===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+f-this._delay),this._delay=f,this):this._delay},t.duration=function(f){return arguments.length?this.totalDuration(this._repeat>0?f+(f+this._rDelay)*this._repeat:f):this.totalDuration()&&this._dur},t.totalDuration=function(f){return arguments.length?(this._dirty=0,wp(this,this._repeat<0?f:(f-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},t.totalTime=function(f,_){if(Tp(),!arguments.length)return this._tTime;var b=this._dp;if(b&&b.smoothChildTiming&&this._ts){for(y1(this,f),!b._dp||b.parent||JR(b,this);b&&b.parent;)b.parent._time!==b._start+(b._ts>=0?b._tTime/b._ts:(b.totalDuration()-b._tTime)/-b._ts)&&b.totalTime(b._tTime,!0),b=b.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&f<this._tDur||this._ts<0&&f>0||!this._tDur&&!f)&&xl(this._dp,this,this._start-this._delay)}return(this._tTime!==f||!this._dur&&!_||this._initted&&Math.abs(this._zTime)===Qn||!f&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=f),ZR(this,f,_)),this},t.time=function(f,_){return arguments.length?this.totalTime(Math.min(this.totalDuration(),f+jC(this))%(this._dur+this._rDelay)||(f?this._dur:0),_):this._time},t.totalProgress=function(f,_){return arguments.length?this.totalTime(this.totalDuration()*f,_):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},t.progress=function(f,_){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-f:f)+jC(this),_):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},t.iteration=function(f,_){var b=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(f-1)*b,_):this._repeat?bp(this._tTime,b)+1:1},t.timeScale=function(f,_){if(!arguments.length)return this._rts===-Qn?0:this._rts;if(this._rts===f)return this;var b=this.parent&&this._ts?Av(this.parent._time,this):this._tTime;return this._rts=+f||0,this._ts=this._ps||f===-Qn?0:this._rts,this.totalTime(jg(-Math.abs(this._delay),this._tDur,b),_!==!1),g1(this),PU(this)},t.paused=function(f){return arguments.length?(this._ps!==f&&(this._ps=f,f?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Tp(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==Qn&&(this._tTime-=Qn)))),this):this._ps},t.startTime=function(f){if(arguments.length){this._start=f;var _=this.parent||this._dp;return _&&(_._sort||!this.parent)&&xl(_,this,f-this._delay),this}return this._start},t.endTime=function(f){return this._start+(vo(f)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},t.rawTime=function(f){var _=this.parent||this._dp;return _?f&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Av(_.rawTime(f),this):this._tTime:this._tTime},t.revert=function(f){f===void 0&&(f=AU);var _=Ts;return Ts=f,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(f),this.totalTime(-.01,f.suppressEvents)),this.data!=="nested"&&f.kill!==!1&&this.kill(),Ts=_,this},t.globalTime=function(f){for(var _=this,b=arguments.length?f:_.rawTime();_;)b=_._start+b/(Math.abs(_._ts)||1),_=_._dp;return!this.parent&&this._sat?this._sat.globalTime(f):b},t.repeat=function(f){return arguments.length?(this._repeat=f===1/0?-2:f,$C(this)):this._repeat===-2?1/0:this._repeat},t.repeatDelay=function(f){if(arguments.length){var _=this._time;return this._rDelay=f,$C(this),_?this.time(_):this}return this._rDelay},t.yoyo=function(f){return arguments.length?(this._yoyo=f,this):this._yoyo},t.seek=function(f,_){return this.totalTime(ma(this,f),vo(_))},t.restart=function(f,_){return this.play().totalTime(f?-this._delay:0,vo(_)),this._dur||(this._zTime=-Qn),this},t.play=function(f,_){return f!=null&&this.seek(f,_),this.reversed(!1).paused(!1)},t.reverse=function(f,_){return f!=null&&this.seek(f||this.totalDuration(),_),this.reversed(!0).paused(!1)},t.pause=function(f,_){return f!=null&&this.seek(f,_),this.paused(!0)},t.resume=function(){return this.paused(!1)},t.reversed=function(f){return arguments.length?(!!f!==this.reversed()&&this.timeScale(-this._rts||(f?-Qn:0)),this):this._rts<0},t.invalidate=function(){return this._initted=this._act=0,this._zTime=-Qn,this},t.isActive=function(){var f=this.parent||this._dp,_=this._start,b;return!!(!f||this._ts&&this._initted&&f.isActive()&&(b=f.rawTime(!0))>=_&&b<this.endTime(!0)-Qn)},t.eventCallback=function(f,_,b){var T=this.vars;return arguments.length>1?(_?(T[f]=_,b&&(T[f+"Params"]=b),f==="onUpdate"&&(this._onUpdate=_)):delete T[f],this):T[f]},t.then=function(f){var _=this;return new Promise(function(b){var T=Ir(f)?f:YR,n=function(){var j=_.then;_.then=null,Ir(T)&&(T=T(_))&&(T.then||T===_)&&(_.then=j),b(T),_.then=j};_._initted&&_.totalProgress()===1&&_._ts>=0||!_._tTime&&_._ts<0?n():_._prom=n})},t.kill=function(){W_(this)},r}();Wo(yg.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-Qn,_prom:0,_ps:!1,_rts:1});var to=function(r){FR(t,r);function t(f,_){var b;return f===void 0&&(f={}),b=r.call(this,f)||this,b.labels={},b.smoothChildTiming=!!f.smoothChildTiming,b.autoRemoveChildren=!!f.autoRemoveChildren,b._sort=vo(f.sortChildren),Sr&&xl(f.parent||Sr,ic(b),_),f.reversed&&b.reverse(),f.paused&&b.paused(!0),f.scrollTrigger&&QR(ic(b),f.scrollTrigger),b}var l=t.prototype;return l.to=function(_,b,T){return tg(0,arguments,this),this},l.from=function(_,b,T){return tg(1,arguments,this),this},l.fromTo=function(_,b,T,n){return tg(2,arguments,this),this},l.set=function(_,b,T){return b.duration=0,b.parent=this,eg(b).repeatDelay||(b.repeat=0),b.immediateRender=!!b.immediateRender,new Wr(_,b,ma(this,T),1),this},l.call=function(_,b,T){return xl(this,Wr.delayedCall(0,_,b),T)},l.staggerTo=function(_,b,T,n,k,j,U){return T.duration=b,T.stagger=T.stagger||n,T.onComplete=j,T.onCompleteParams=U,T.parent=this,new Wr(_,T,ma(this,k)),this},l.staggerFrom=function(_,b,T,n,k,j,U){return T.runBackwards=1,eg(T).immediateRender=vo(T.immediateRender),this.staggerTo(_,b,T,n,k,j,U)},l.staggerFromTo=function(_,b,T,n,k,j,U,Z){return n.startAt=T,eg(n).immediateRender=vo(n.immediateRender),this.staggerTo(_,b,n,k,j,U,Z)},l.render=function(_,b,T){var n=this._time,k=this._dirty?this.totalDuration():this._tDur,j=this._dur,U=_<=0?0:Zr(_),Z=this._zTime<0!=_<0&&(this._initted||!j),re,se,ue,ne,be,De,Be,Te,me,Ie,Xe,je;if(this!==Sr&&U>k&&_>=0&&(U=k),U!==this._tTime||T||Z){if(n!==this._time&&j&&(U+=this._time-n,_+=this._time-n),re=U,me=this._start,Te=this._ts,De=!Te,Z&&(j||(n=this._zTime),(_||!b)&&(this._zTime=_)),this._repeat){if(Xe=this._yoyo,be=j+this._rDelay,this._repeat<-1&&_<0)return this.totalTime(be*100+_,b,T);if(re=Zr(U%be),U===k?(ne=this._repeat,re=j):(Ie=Zr(U/be),ne=~~Ie,ne&&ne===Ie&&(re=j,ne--),re>j&&(re=j)),Ie=bp(this._tTime,be),!n&&this._tTime&&Ie!==ne&&this._tTime-Ie*be-this._dur<=0&&(Ie=ne),Xe&&ne&1&&(re=j-re,je=1),ne!==Ie&&!this._lock){var rt=Xe&&Ie&1,Ve=rt===(Xe&&ne&1);if(ne<Ie&&(rt=!rt),n=rt?0:U%j?j:U,this._lock=1,this.render(n||(je?0:Zr(ne*be)),b,!j)._lock=0,this._tTime=U,!b&&this.parent&&Fo(this,"onRepeat"),this.vars.repeatRefresh&&!je&&(this.invalidate()._lock=1),n&&n!==this._time||De!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(j=this._dur,k=this._tDur,Ve&&(this._lock=2,n=rt?j:-1e-4,this.render(n,!0),this.vars.repeatRefresh&&!je&&this.invalidate()),this._lock=0,!this._ts&&!De)return this;p3(this,je)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(Be=OU(this,Zr(n),Zr(re)),Be&&(U-=re-(re=Be._start))),this._tTime=U,this._time=re,this._act=!Te,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=_,n=0),!n&&re&&!b&&!ne&&(Fo(this,"onStart"),this._tTime!==U))return this;if(re>=n&&_>=0)for(se=this._first;se;){if(ue=se._next,(se._act||re>=se._start)&&se._ts&&Be!==se){if(se.parent!==this)return this.render(_,b,T);if(se.render(se._ts>0?(re-se._start)*se._ts:(se._dirty?se.totalDuration():se._tDur)+(re-se._start)*se._ts,b,T),re!==this._time||!this._ts&&!De){Be=0,ue&&(U+=this._zTime=-Qn);break}}se=ue}else{se=this._last;for(var He=_<0?_:re;se;){if(ue=se._prev,(se._act||He<=se._end)&&se._ts&&Be!==se){if(se.parent!==this)return this.render(_,b,T);if(se.render(se._ts>0?(He-se._start)*se._ts:(se._dirty?se.totalDuration():se._tDur)+(He-se._start)*se._ts,b,T||Ts&&(se._initted||se._startAt)),re!==this._time||!this._ts&&!De){Be=0,ue&&(U+=this._zTime=He?-Qn:Qn);break}}se=ue}}if(Be&&!b&&(this.pause(),Be.render(re>=n?0:-Qn)._zTime=re>=n?1:-1,this._ts))return this._start=me,g1(this),this.render(_,b,T);this._onUpdate&&!b&&Fo(this,"onUpdate",!0),(U===k&&this._tTime>=this.totalDuration()||!U&&n)&&(me===this._start||Math.abs(Te)!==Math.abs(this._ts))&&(this._lock||((_||!j)&&(U===k&&this._ts>0||!U&&this._ts<0)&&Au(this,1),!b&&!(_<0&&!n)&&(U||n||!k)&&(Fo(this,U===k&&_>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(U<k&&this.timeScale()>0)&&this._prom())))}return this},l.add=function(_,b){var T=this;if(dc(b)||(b=ma(this,b,_)),!(_ instanceof yg)){if(Bs(_))return _.forEach(function(n){return T.add(n,b)}),this;if(gs(_))return this.addLabel(_,b);if(Ir(_))_=Wr.delayedCall(0,_);else return this}return this!==_?xl(this,_,b):this},l.getChildren=function(_,b,T,n){_===void 0&&(_=!0),b===void 0&&(b=!0),T===void 0&&(T=!0),n===void 0&&(n=-ga);for(var k=[],j=this._first;j;)j._start>=n&&(j instanceof Wr?b&&k.push(j):(T&&k.push(j),_&&k.push.apply(k,j.getChildren(!0,b,T)))),j=j._next;return k},l.getById=function(_){for(var b=this.getChildren(1,1,1),T=b.length;T--;)if(b[T].vars.id===_)return b[T]},l.remove=function(_){return gs(_)?this.removeLabel(_):Ir(_)?this.killTweensOf(_):(_.parent===this&&_1(this,_),_===this._recent&&(this._recent=this._last),nd(this))},l.totalTime=function(_,b){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Zr(ko.time-(this._ts>0?_/this._ts:(this.totalDuration()-_)/-this._ts))),r.prototype.totalTime.call(this,_,b),this._forcing=0,this):this._tTime},l.addLabel=function(_,b){return this.labels[_]=ma(this,b),this},l.removeLabel=function(_){return delete this.labels[_],this},l.addPause=function(_,b,T){var n=Wr.delayedCall(0,b||mg,T);return n.data="isPause",this._hasPause=1,xl(this,n,ma(this,_))},l.removePause=function(_){var b=this._first;for(_=ma(this,_);b;)b._start===_&&b.data==="isPause"&&Au(b),b=b._next},l.killTweensOf=function(_,b,T){for(var n=this.getTweensOf(_,T),k=n.length;k--;)fu!==n[k]&&n[k].kill(_,b);return this},l.getTweensOf=function(_,b){for(var T=[],n=ya(_),k=this._first,j=dc(b),U;k;)k instanceof Wr?MU(k._targets,n)&&(j?(!fu||k._initted&&k._ts)&&k.globalTime(0)<=b&&k.globalTime(k.totalDuration())>b:!b||k.isActive())&&T.push(k):(U=k.getTweensOf(n,b)).length&&T.push.apply(T,U),k=k._next;return T},l.tweenTo=function(_,b){b=b||{};var T=this,n=ma(T,_),k=b,j=k.startAt,U=k.onStart,Z=k.onStartParams,re=k.immediateRender,se,ue=Wr.to(T,Wo({ease:b.ease||"none",lazy:!1,immediateRender:!1,time:n,overwrite:"auto",duration:b.duration||Math.abs((n-(j&&"time"in j?j.time:T._time))/T.timeScale())||Qn,onStart:function(){if(T.pause(),!se){var be=b.duration||Math.abs((n-(j&&"time"in j?j.time:T._time))/T.timeScale());ue._dur!==be&&wp(ue,be,0,1).render(ue._time,!0,!0),se=1}U&&U.apply(ue,Z||[])}},b));return re?ue.render(0):ue},l.tweenFromTo=function(_,b,T){return this.tweenTo(b,Wo({startAt:{time:ma(this,_)}},T))},l.recent=function(){return this._recent},l.nextLabel=function(_){return _===void 0&&(_=this._time),qC(this,ma(this,_))},l.previousLabel=function(_){return _===void 0&&(_=this._time),qC(this,ma(this,_),1)},l.currentLabel=function(_){return arguments.length?this.seek(_,!0):this.previousLabel(this._time+Qn)},l.shiftChildren=function(_,b,T){T===void 0&&(T=0);for(var n=this._first,k=this.labels,j;n;)n._start>=T&&(n._start+=_,n._end+=_),n=n._next;if(b)for(j in k)k[j]>=T&&(k[j]+=_);return nd(this)},l.invalidate=function(_){var b=this._first;for(this._lock=0;b;)b.invalidate(_),b=b._next;return r.prototype.invalidate.call(this,_)},l.clear=function(_){_===void 0&&(_=!0);for(var b=this._first,T;b;)T=b._next,this.remove(b),b=T;return this._dp&&(this._time=this._tTime=this._pTime=0),_&&(this.labels={}),nd(this)},l.totalDuration=function(_){var b=0,T=this,n=T._last,k=ga,j,U,Z;if(arguments.length)return T.timeScale((T._repeat<0?T.duration():T.totalDuration())/(T.reversed()?-_:_));if(T._dirty){for(Z=T.parent;n;)j=n._prev,n._dirty&&n.totalDuration(),U=n._start,U>k&&T._sort&&n._ts&&!T._lock?(T._lock=1,xl(T,n,U-n._delay,1)._lock=0):k=U,U<0&&n._ts&&(b-=U,(!Z&&!T._dp||Z&&Z.smoothChildTiming)&&(T._start+=U/T._ts,T._time-=U,T._tTime-=U),T.shiftChildren(-U,!1,-1/0),k=0),n._end>b&&n._ts&&(b=n._end),n=j;wp(T,T===Sr&&T._time>b?T._time:b,1,1),T._dirty=0}return T._tDur},t.updateRoot=function(_){if(Sr._ts&&(ZR(Sr,Av(_,Sr)),GR=ko.frame),ko.frame>=VC){VC+=Vo.autoSleep||120;var b=Sr._first;if((!b||!b._ts)&&Vo.autoSleep&&ko._listeners.length<2){for(;b&&!b._ts;)b=b._next;b||ko.sleep()}}},t}(yg);Wo(to.prototype,{_lock:0,_hasPause:0,_forcing:0});var YU=function(t,l,f,_,b,T,n){var k=new bo(this._pt,t,l,0,1,w3,null,b),j=0,U=0,Z,re,se,ue,ne,be,De,Be;for(k.b=f,k.e=_,f+="",_+="",(De=~_.indexOf("random("))&&(_=_g(_)),T&&(Be=[f,_],T(Be,t,l),f=Be[0],_=Be[1]),re=f.match(lw)||[];Z=lw.exec(_);)ue=Z[0],ne=_.substring(j,Z.index),se?se=(se+1)%5:ne.substr(-5)==="rgba("&&(se=1),ue!==re[U++]&&(be=parseFloat(re[U-1])||0,k._pt={_next:k._pt,p:ne||U===1?ne:",",s:be,c:ue.charAt(1)==="="?np(be,ue)-be:parseFloat(ue)-be,m:se&&se<4?Math.round:0},j=lw.lastIndex);return k.c=j<_.length?_.substring(j,_.length):"",k.fp=n,(UR.test(_)||De)&&(k.e=0),this._pt=k,k},_2=function(t,l,f,_,b,T,n,k,j,U){Ir(_)&&(_=_(b||0,t,T));var Z=t[l],re=f!=="get"?f:Ir(Z)?j?t[l.indexOf("set")||!Ir(t["get"+l.substr(3)])?l:"get"+l.substr(3)](j):t[l]():Z,se=Ir(Z)?j?tj:x3:y2,ue;if(gs(_)&&(~_.indexOf("random(")&&(_=_g(_)),_.charAt(1)==="="&&(ue=np(re,_)+(Fs(re)||0),(ue||ue===0)&&(_=ue))),!U||re!==_||Qw)return!isNaN(re*_)&&_!==""?(ue=new bo(this._pt,t,l,+re||0,_-(re||0),typeof Z=="boolean"?nj:b3,0,se),j&&(ue.fp=j),n&&ue.modifier(n,this,t),this._pt=ue):(!Z&&!(l in t)&&d2(l,_),YU.call(this,t,l,re,_,se,k||Vo.stringFilter,j))},KU=function(t,l,f,_,b){if(Ir(t)&&(t=ig(t,b,l,f,_)),!Ml(t)||t.style&&t.nodeType||Bs(t)||BR(t))return gs(t)?ig(t,b,l,f,_):t;var T={},n;for(n in t)T[n]=ig(t[n],b,l,f,_);return T},g3=function(t,l,f,_,b,T){var n,k,j,U;if(zo[t]&&(n=new zo[t]).init(b,n.rawVars?l[t]:KU(l[t],_,b,T,f),f,_,T)!==!1&&(f._pt=k=new bo(f._pt,b,t,0,1,n.render,n,0,n.priority),f!==tp))for(j=f._ptLookup[f._targets.indexOf(b)],U=n._props.length;U--;)j[n._props[U]]=k;return n},fu,Qw,g2=function r(t,l,f){var _=t.vars,b=_.ease,T=_.startAt,n=_.immediateRender,k=_.lazy,j=_.onUpdate,U=_.runBackwards,Z=_.yoyoEase,re=_.keyframes,se=_.autoRevert,ue=t._dur,ne=t._startAt,be=t._targets,De=t.parent,Be=De&&De.data==="nested"?De.vars.targets:be,Te=t._overwrite==="auto"&&!l2,me=t.timeline,Ie,Xe,je,rt,Ve,He,st,dt,At,ni,Tt,kt,ti;if(me&&(!re||!b)&&(b="none"),t._ease=rd(b,vp.ease),t._yEase=Z?f3(rd(Z===!0?b:Z,vp.ease)):0,Z&&t._yoyo&&!t._repeat&&(Z=t._yEase,t._yEase=t._ease,t._ease=Z),t._from=!me&&!!_.runBackwards,!me||re&&!_.stagger){if(dt=be[0]?td(be[0]).harness:0,kt=dt&&_[dt.prop],Ie=Sv(_,f2),ne&&(ne._zTime<0&&ne.progress(1),l<0&&U&&n&&!se?ne.render(-1,!0):ne.revert(U&&ue?sv:SU),ne._lazy=0),T){if(Au(t._startAt=Wr.set(be,Wo({data:"isStart",overwrite:!1,parent:De,immediateRender:!0,lazy:!ne&&vo(k),startAt:null,delay:0,onUpdate:j&&function(){return Fo(t,"onUpdate")},stagger:0},T))),t._startAt._dp=0,t._startAt._sat=t,l<0&&(Ts||!n&&!se)&&t._startAt.revert(sv),n&&ue&&l<=0&&f<=0){l&&(t._zTime=l);return}}else if(U&&ue&&!ne){if(l&&(n=!1),je=Wo({overwrite:!1,data:"isFromStart",lazy:n&&!ne&&vo(k),immediateRender:n,stagger:0,parent:De},Ie),kt&&(je[dt.prop]=kt),Au(t._startAt=Wr.set(be,je)),t._startAt._dp=0,t._startAt._sat=t,l<0&&(Ts?t._startAt.revert(sv):t._startAt.render(-1,!0)),t._zTime=l,!n)r(t._startAt,Qn,Qn);else if(!l)return}for(t._pt=t._ptCache=0,k=ue&&vo(k)||k&&!ue,Xe=0;Xe<be.length;Xe++){if(Ve=be[Xe],st=Ve._gsap||m2(be)[Xe]._gsap,t._ptLookup[Xe]=ni={},Ww[st.id]&&_u.length&&Ev(),Tt=Be===be?Xe:Be.indexOf(Ve),dt&&(At=new dt).init(Ve,kt||Ie,t,Tt,Be)!==!1&&(t._pt=rt=new bo(t._pt,Ve,At.name,0,1,At.render,At,0,At.priority),At._props.forEach(function(li){ni[li]=rt}),At.priority&&(He=1)),!dt||kt)for(je in Ie)zo[je]&&(At=g3(je,Ie,t,Tt,Ve,Be))?At.priority&&(He=1):ni[je]=rt=_2.call(t,Ve,je,"get",Ie[je],Tt,Be,0,_.stringFilter);t._op&&t._op[Xe]&&t.kill(Ve,t._op[Xe]),Te&&t._pt&&(fu=t,Sr.killTweensOf(Ve,ni,t.globalTime(l)),ti=!t.parent,fu=0),t._pt&&k&&(Ww[st.id]=1)}He&&T3(t),t._onInit&&t._onInit(t)}t._onUpdate=j,t._initted=(!t._op||t._pt)&&!ti,re&&l<=0&&me.render(ga,!0,!0)},JU=function(t,l,f,_,b,T,n,k){var j=(t._pt&&t._ptCache||(t._ptCache={}))[l],U,Z,re,se;if(!j)for(j=t._ptCache[l]=[],re=t._ptLookup,se=t._targets.length;se--;){if(U=re[se][l],U&&U.d&&U.d._pt)for(U=U.d._pt;U&&U.p!==l&&U.fp!==l;)U=U._next;if(!U)return Qw=1,t.vars[l]="+=0",g2(t,n),Qw=0,k?pg(l+" not eligible for reset"):1;j.push(U)}for(se=j.length;se--;)Z=j[se],U=Z._pt||Z,U.s=(_||_===0)&&!b?_:U.s+(_||0)+T*U.c,U.c=f-U.s,Z.e&&(Z.e=Fr(f)+Fs(Z.e)),Z.b&&(Z.b=U.s+Fs(Z.b))},QU=function(t,l){var f=t[0]?td(t[0]).harness:0,_=f&&f.aliases,b,T,n,k;if(!_)return l;b=xp({},l);for(T in _)if(T in b)for(k=_[T].split(","),n=k.length;n--;)b[k[n]]=b[T];return b},ej=function(t,l,f,_){var b=l.ease||_||"power1.inOut",T,n;if(Bs(l))n=f[t]||(f[t]=[]),l.forEach(function(k,j){return n.push({t:j/(l.length-1)*100,v:k,e:b})});else for(T in l)n=f[T]||(f[T]=[]),T==="ease"||n.push({t:parseFloat(t),v:l[T],e:b})},ig=function(t,l,f,_,b){return Ir(t)?t.call(l,f,_,b):gs(t)&&~t.indexOf("random(")?_g(t):t},y3=p2+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",v3={};xo(y3+",id,stagger,delay,duration,paused,scrollTrigger",function(r){return v3[r]=1});var Wr=function(r){FR(t,r);function t(f,_,b,T){var n;typeof _=="number"&&(b.duration=_,_=b,b=null),n=r.call(this,T?_:eg(_))||this;var k=n.vars,j=k.duration,U=k.delay,Z=k.immediateRender,re=k.stagger,se=k.overwrite,ue=k.keyframes,ne=k.defaults,be=k.scrollTrigger,De=k.yoyoEase,Be=_.parent||Sr,Te=(Bs(f)||BR(f)?dc(f[0]):"length"in _)?[f]:ya(f),me,Ie,Xe,je,rt,Ve,He,st;if(n._targets=Te.length?m2(Te):pg("GSAP target "+f+" not found. https://gsap.com",!Vo.nullTargetWarn)||[],n._ptLookup=[],n._overwrite=se,ue||re||F0(j)||F0(U)){if(_=n.vars,me=n.timeline=new to({data:"nested",defaults:ne||{},targets:Be&&Be.data==="nested"?Be.vars.targets:Te}),me.kill(),me.parent=me._dp=ic(n),me._start=0,re||F0(j)||F0(U)){if(je=Te.length,He=re&&n3(re),Ml(re))for(rt in re)~y3.indexOf(rt)&&(st||(st={}),st[rt]=re[rt]);for(Ie=0;Ie<je;Ie++)Xe=Sv(_,v3),Xe.stagger=0,De&&(Xe.yoyoEase=De),st&&xp(Xe,st),Ve=Te[Ie],Xe.duration=+ig(j,ic(n),Ie,Ve,Te),Xe.delay=(+ig(U,ic(n),Ie,Ve,Te)||0)-n._delay,!re&&je===1&&Xe.delay&&(n._delay=U=Xe.delay,n._start+=U,Xe.delay=0),me.to(Ve,Xe,He?He(Ie,Ve,Te):0),me._ease=Sn.none;me.duration()?j=U=0:n.timeline=0}else if(ue){eg(Wo(me.vars.defaults,{ease:"none"})),me._ease=rd(ue.ease||_.ease||"none");var dt=0,At,ni,Tt;if(Bs(ue))ue.forEach(function(kt){return me.to(Te,kt,">")}),me.duration();else{Xe={};for(rt in ue)rt==="ease"||rt==="easeEach"||ej(rt,ue[rt],Xe,ue.easeEach);for(rt in Xe)for(At=Xe[rt].sort(function(kt,ti){return kt.t-ti.t}),dt=0,Ie=0;Ie<At.length;Ie++)ni=At[Ie],Tt={ease:ni.e,duration:(ni.t-(Ie?At[Ie-1].t:0))/100*j},Tt[rt]=ni.v,me.to(Te,Tt,dt),dt+=Tt.duration;me.duration()<j&&me.to({},{duration:j-me.duration()})}}j||n.duration(j=me.duration())}else n.timeline=0;return se===!0&&!l2&&(fu=ic(n),Sr.killTweensOf(Te),fu=0),xl(Be,ic(n),b),_.reversed&&n.reverse(),_.paused&&n.paused(!0),(Z||!j&&!ue&&n._start===Zr(Be._time)&&vo(Z)&&RU(ic(n))&&Be.data!=="nested")&&(n._tTime=-Qn,n.render(Math.max(0,-U)||0)),be&&QR(ic(n),be),n}var l=t.prototype;return l.render=function(_,b,T){var n=this._time,k=this._tDur,j=this._dur,U=_<0,Z=_>k-Qn&&!U?k:_<Qn?0:_,re,se,ue,ne,be,De,Be,Te,me;if(!j)LU(this,_,b,T);else if(Z!==this._tTime||!_||T||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==U||this._lazy){if(re=Z,Te=this.timeline,this._repeat){if(ne=j+this._rDelay,this._repeat<-1&&U)return this.totalTime(ne*100+_,b,T);if(re=Zr(Z%ne),Z===k?(ue=this._repeat,re=j):(be=Zr(Z/ne),ue=~~be,ue&&ue===be?(re=j,ue--):re>j&&(re=j)),De=this._yoyo&&ue&1,De&&(me=this._yEase,re=j-re),be=bp(this._tTime,ne),re===n&&!T&&this._initted&&ue===be)return this._tTime=Z,this;ue!==be&&(Te&&this._yEase&&p3(Te,De),this.vars.repeatRefresh&&!De&&!this._lock&&re!==ne&&this._initted&&(this._lock=T=1,this.render(Zr(ne*ue),!0).invalidate()._lock=0))}if(!this._initted){if(e3(this,U?_:re,T,b,Z))return this._tTime=0,this;if(n!==this._time&&!(T&&this.vars.repeatRefresh&&ue!==be))return this;if(j!==this._dur)return this.render(_,b,T)}if(this._tTime=Z,this._time=re,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=Be=(me||this._ease)(re/j),this._from&&(this.ratio=Be=1-Be),re&&!n&&!b&&!ue&&(Fo(this,"onStart"),this._tTime!==Z))return this;for(se=this._pt;se;)se.r(Be,se.d),se=se._next;Te&&Te.render(_<0?_:Te._dur*Te._ease(re/this._dur),b,T)||this._startAt&&(this._zTime=_),this._onUpdate&&!b&&(U&&Zw(this,_,b,T),Fo(this,"onUpdate")),this._repeat&&ue!==be&&this.vars.onRepeat&&!b&&this.parent&&Fo(this,"onRepeat"),(Z===this._tDur||!Z)&&this._tTime===Z&&(U&&!this._onUpdate&&Zw(this,_,!0,!0),(_||!j)&&(Z===this._tDur&&this._ts>0||!Z&&this._ts<0)&&Au(this,1),!b&&!(U&&!n)&&(Z||n||De)&&(Fo(this,Z===k?"onComplete":"onReverseComplete",!0),this._prom&&!(Z<k&&this.timeScale()>0)&&this._prom()))}return this},l.targets=function(){return this._targets},l.invalidate=function(_){return(!_||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(_),r.prototype.invalidate.call(this,_)},l.resetTo=function(_,b,T,n,k){gg||ko.wake(),this._ts||this.play();var j=Math.min(this._dur,(this._dp._time-this._start)*this._ts),U;return this._initted||g2(this,j),U=this._ease(j/this._dur),JU(this,_,b,T,n,U,j,k)?this.resetTo(_,b,T,n,1):(y1(this,0),this.parent||KR(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},l.kill=function(_,b){if(b===void 0&&(b="all"),!_&&(!b||b==="all"))return this._lazy=this._pt=0,this.parent?W_(this):this.scrollTrigger&&this.scrollTrigger.kill(!!Ts),this;if(this.timeline){var T=this.timeline.totalDuration();return this.timeline.killTweensOf(_,b,fu&&fu.vars.overwrite!==!0)._first||W_(this),this.parent&&T!==this.timeline.totalDuration()&&wp(this,this._dur*this.timeline._tDur/T,0,1),this}var n=this._targets,k=_?ya(_):n,j=this._ptLookup,U=this._pt,Z,re,se,ue,ne,be,De;if((!b||b==="all")&&IU(n,k))return b==="all"&&(this._pt=0),W_(this);for(Z=this._op=this._op||[],b!=="all"&&(gs(b)&&(ne={},xo(b,function(Be){return ne[Be]=1}),b=ne),b=QU(n,b)),De=n.length;De--;)if(~k.indexOf(n[De])){re=j[De],b==="all"?(Z[De]=b,ue=re,se={}):(se=Z[De]=Z[De]||{},ue=b);for(ne in ue)be=re&&re[ne],be&&((!("kill"in be.d)||be.d.kill(ne)===!0)&&_1(this,be,"_pt"),delete re[ne]),se!=="all"&&(se[ne]=1)}return this._initted&&!this._pt&&U&&W_(this),this},t.to=function(_,b){return new t(_,b,arguments[2])},t.from=function(_,b){return tg(1,arguments)},t.delayedCall=function(_,b,T,n){return new t(b,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:_,onComplete:b,onReverseComplete:b,onCompleteParams:T,onReverseCompleteParams:T,callbackScope:n})},t.fromTo=function(_,b,T){return tg(2,arguments)},t.set=function(_,b){return b.duration=0,b.repeatDelay||(b.repeat=0),new t(_,b)},t.killTweensOf=function(_,b,T){return Sr.killTweensOf(_,b,T)},t}(yg);Wo(Wr.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});xo("staggerTo,staggerFrom,staggerFromTo",function(r){Wr[r]=function(){var t=new to,l=Yw.call(arguments,0);return l.splice(r==="staggerFromTo"?5:4,0,0),t[r].apply(t,l)}});var y2=function(t,l,f){return t[l]=f},x3=function(t,l,f){return t[l](f)},tj=function(t,l,f,_){return t[l](_.fp,f)},ij=function(t,l,f){return t.setAttribute(l,f)},v2=function(t,l){return Ir(t[l])?x3:c2(t[l])&&t.setAttribute?ij:y2},b3=function(t,l){return l.set(l.t,l.p,Math.round((l.s+l.c*t)*1e6)/1e6,l)},nj=function(t,l){return l.set(l.t,l.p,!!(l.s+l.c*t),l)},w3=function(t,l){var f=l._pt,_="";if(!t&&l.b)_=l.b;else if(t===1&&l.e)_=l.e;else{for(;f;)_=f.p+(f.m?f.m(f.s+f.c*t):Math.round((f.s+f.c*t)*1e4)/1e4)+_,f=f._next;_+=l.c}l.set(l.t,l.p,_,l)},x2=function(t,l){for(var f=l._pt;f;)f.r(t,f.d),f=f._next},rj=function(t,l,f,_){for(var b=this._pt,T;b;)T=b._next,b.p===_&&b.modifier(t,l,f),b=T},sj=function(t){for(var l=this._pt,f,_;l;)_=l._next,l.p===t&&!l.op||l.op===t?_1(this,l,"_pt"):l.dep||(f=1),l=_;return!f},oj=function(t,l,f,_){_.mSet(t,l,_.m.call(_.tween,f,_.mt),_)},T3=function(t){for(var l=t._pt,f,_,b,T;l;){for(f=l._next,_=b;_&&_.pr>l.pr;)_=_._next;(l._prev=_?_._prev:T)?l._prev._next=l:b=l,(l._next=_)?_._prev=l:T=l,l=f}t._pt=b},bo=function(){function r(l,f,_,b,T,n,k,j,U){this.t=f,this.s=b,this.c=T,this.p=_,this.r=n||b3,this.d=k||this,this.set=j||y2,this.pr=U||0,this._next=l,l&&(l._prev=this)}var t=r.prototype;return t.modifier=function(f,_,b){this.mSet=this.mSet||this.set,this.set=oj,this.m=f,this.mt=b,this.tween=_},r}();xo(p2+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(r){return f2[r]=1});Go.TweenMax=Go.TweenLite=Wr;Go.TimelineLite=Go.TimelineMax=to;Sr=new to({sortChildren:!1,defaults:vp,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});Vo.stringFilter=d3;var sd=[],av={},aj=[],GC=0,lj=0,fw=function(t){return(av[t]||aj).map(function(l){return l()})},eT=function(){var t=Date.now(),l=[];t-GC>2&&(fw("matchMediaInit"),sd.forEach(function(f){var _=f.queries,b=f.conditions,T,n,k,j;for(n in _)T=yl.matchMedia(_[n]).matches,T&&(k=1),T!==b[n]&&(b[n]=T,j=1);j&&(f.revert(),k&&l.push(f))}),fw("matchMediaRevert"),l.forEach(function(f){return f.onMatch(f,function(_){return f.add(null,_)})}),GC=t,fw("matchMedia"))},E3=function(){function r(l,f){this.selector=f&&Kw(f),this.data=[],this._r=[],this.isReverted=!1,this.id=lj++,l&&this.add(l)}var t=r.prototype;return t.add=function(f,_,b){Ir(f)&&(b=_,_=f,f=Ir);var T=this,n=function(){var j=yr,U=T.selector,Z;return j&&j!==T&&j.data.push(T),b&&(T.selector=Kw(b)),yr=T,Z=_.apply(T,arguments),Ir(Z)&&T._r.push(Z),yr=j,T.selector=U,T.isReverted=!1,Z};return T.last=n,f===Ir?n(T,function(k){return T.add(null,k)}):f?T[f]=n:n},t.ignore=function(f){var _=yr;yr=null,f(this),yr=_},t.getTweens=function(){var f=[];return this.data.forEach(function(_){return _ instanceof r?f.push.apply(f,_.getTweens()):_ instanceof Wr&&!(_.parent&&_.parent.data==="nested")&&f.push(_)}),f},t.clear=function(){this._r.length=this.data.length=0},t.kill=function(f,_){var b=this;if(f?function(){for(var n=b.getTweens(),k=b.data.length,j;k--;)j=b.data[k],j.data==="isFlip"&&(j.revert(),j.getChildren(!0,!0,!1).forEach(function(U){return n.splice(n.indexOf(U),1)}));for(n.map(function(U){return{g:U._dur||U._delay||U._sat&&!U._sat.vars.immediateRender?U.globalTime(0):-1/0,t:U}}).sort(function(U,Z){return Z.g-U.g||-1/0}).forEach(function(U){return U.t.revert(f)}),k=b.data.length;k--;)j=b.data[k],j instanceof to?j.data!=="nested"&&(j.scrollTrigger&&j.scrollTrigger.revert(),j.kill()):!(j instanceof Wr)&&j.revert&&j.revert(f);b._r.forEach(function(U){return U(f,b)}),b.isReverted=!0}():this.data.forEach(function(n){return n.kill&&n.kill()}),this.clear(),_)for(var T=sd.length;T--;)sd[T].id===this.id&&sd.splice(T,1)},t.revert=function(f){this.kill(f||{})},r}(),cj=function(){function r(l){this.contexts=[],this.scope=l,yr&&yr.data.push(this)}var t=r.prototype;return t.add=function(f,_,b){Ml(f)||(f={matches:f});var T=new E3(0,b||this.scope),n=T.conditions={},k,j,U;yr&&!T.selector&&(T.selector=yr.selector),this.contexts.push(T),_=T.add("onMatch",_),T.queries=f;for(j in f)j==="all"?U=1:(k=yl.matchMedia(f[j]),k&&(sd.indexOf(T)<0&&sd.push(T),(n[j]=k.matches)&&(U=1),k.addListener?k.addListener(eT):k.addEventListener("change",eT)));return U&&_(T,function(Z){return T.add(null,Z)}),this},t.revert=function(f){this.kill(f||{})},t.kill=function(f){this.contexts.forEach(function(_){return _.kill(f,!0)})},r}(),Mv={registerPlugin:function(){for(var t=arguments.length,l=new Array(t),f=0;f<t;f++)l[f]=arguments[f];l.forEach(function(_){return c3(_)})},timeline:function(t){return new to(t)},getTweensOf:function(t,l){return Sr.getTweensOf(t,l)},getProperty:function(t,l,f,_){gs(t)&&(t=ya(t)[0]);var b=td(t||{}).get,T=f?YR:XR;return f==="native"&&(f=""),t&&(l?T((zo[l]&&zo[l].get||b)(t,l,f,_)):function(n,k,j){return T((zo[n]&&zo[n].get||b)(t,n,k,j))})},quickSetter:function(t,l,f){if(t=ya(t),t.length>1){var _=t.map(function(U){return To.quickSetter(U,l,f)}),b=_.length;return function(U){for(var Z=b;Z--;)_[Z](U)}}t=t[0]||{};var T=zo[l],n=td(t),k=n.harness&&(n.harness.aliases||{})[l]||l,j=T?function(U){var Z=new T;tp._pt=0,Z.init(t,f?U+f:U,tp,0,[t]),Z.render(1,Z),tp._pt&&x2(1,tp)}:n.set(t,k);return T?j:function(U){return j(t,k,f?U+f:U,n,1)}},quickTo:function(t,l,f){var _,b=To.to(t,Wo((_={},_[l]="+=0.1",_.paused=!0,_.stagger=0,_),f||{})),T=function(k,j,U){return b.resetTo(l,k,j,U)};return T.tween=b,T},isTweening:function(t){return Sr.getTweensOf(t,!0).length>0},defaults:function(t){return t&&t.ease&&(t.ease=rd(t.ease,vp.ease)),UC(vp,t||{})},config:function(t){return UC(Vo,t||{})},registerEffect:function(t){var l=t.name,f=t.effect,_=t.plugins,b=t.defaults,T=t.extendTimeline;(_||"").split(",").forEach(function(n){return n&&!zo[n]&&!Go[n]&&pg(l+" effect requires "+n+" plugin.")}),cw[l]=function(n,k,j){return f(ya(n),Wo(k||{},b),j)},T&&(to.prototype[l]=function(n,k,j){return this.add(cw[l](n,Ml(k)?k:(j=k)&&{},this),j)})},registerEase:function(t,l){Sn[t]=rd(l)},parseEase:function(t,l){return arguments.length?rd(t,l):Sn},getById:function(t){return Sr.getById(t)},exportRoot:function(t,l){t===void 0&&(t={});var f=new to(t),_,b;for(f.smoothChildTiming=vo(t.smoothChildTiming),Sr.remove(f),f._dp=0,f._time=f._tTime=Sr._time,_=Sr._first;_;)b=_._next,(l||!(!_._dur&&_ instanceof Wr&&_.vars.onComplete===_._targets[0]))&&xl(f,_,_._start-_._delay),_=b;return xl(Sr,f,0),f},context:function(t,l){return t?new E3(t,l):yr},matchMedia:function(t){return new cj(t)},matchMediaRefresh:function(){return sd.forEach(function(t){var l=t.conditions,f,_;for(_ in l)l[_]&&(l[_]=!1,f=1);f&&t.revert()})||eT()},addEventListener:function(t,l){var f=av[t]||(av[t]=[]);~f.indexOf(l)||f.push(l)},removeEventListener:function(t,l){var f=av[t],_=f&&f.indexOf(l);_>=0&&f.splice(_,1)},utils:{wrap:UU,wrapYoyo:jU,distribute:n3,random:s3,snap:r3,normalize:VU,getUnit:Fs,clamp:kU,splitColor:u3,toArray:ya,selector:Kw,mapRange:a3,pipe:NU,unitize:BU,interpolate:$U,shuffle:i3},install:qR,effects:cw,ticker:ko,updateRoot:to.updateRoot,plugins:zo,globalTimeline:Sr,core:{PropTween:bo,globals:HR,Tween:Wr,Timeline:to,Animation:yg,getCache:td,_removeLinkedListItem:_1,reverting:function(){return Ts},context:function(t){return t&&yr&&(yr.data.push(t),t._ctx=yr),yr},suppressOverwrites:function(t){return l2=t}}};xo("to,from,fromTo,delayedCall,set,killTweensOf",function(r){return Mv[r]=Wr[r]});ko.add(to.updateRoot);tp=Mv.to({},{duration:0});var uj=function(t,l){for(var f=t._pt;f&&f.p!==l&&f.op!==l&&f.fp!==l;)f=f._next;return f},hj=function(t,l){var f=t._targets,_,b,T;for(_ in l)for(b=f.length;b--;)T=t._ptLookup[b][_],T&&(T=T.d)&&(T._pt&&(T=uj(T,_)),T&&T.modifier&&T.modifier(l[_],t,f[b],_))},pw=function(t,l){return{name:t,rawVars:1,init:function(_,b,T){T._onInit=function(n){var k,j;if(gs(b)&&(k={},xo(b,function(U){return k[U]=1}),b=k),l){k={};for(j in b)k[j]=l(b[j]);b=k}hj(n,b)}}}},To=Mv.registerPlugin({name:"attr",init:function(t,l,f,_,b){var T,n,k;this.tween=f;for(T in l)k=t.getAttribute(T)||"",n=this.add(t,"setAttribute",(k||0)+"",l[T],_,b,0,0,T),n.op=T,n.b=k,this._props.push(T)},render:function(t,l){for(var f=l._pt;f;)Ts?f.set(f.t,f.p,f.b,f):f.r(t,f.d),f=f._next}},{name:"endArray",init:function(t,l){for(var f=l.length;f--;)this.add(t,f,t[f]||0,l[f],0,0,0,0,0,1)}},pw("roundProps",Jw),pw("modifiers"),pw("snap",r3))||Mv;Wr.version=to.version=To.version="3.12.7";$R=1;u2()&&Tp();Sn.Power0;Sn.Power1;Sn.Power2;Sn.Power3;Sn.Power4;Sn.Linear;Sn.Quad;Sn.Cubic;Sn.Quart;Sn.Quint;Sn.Strong;Sn.Elastic;Sn.Back;Sn.SteppedEase;Sn.Bounce;Sn.Sine;Sn.Expo;Sn.Circ;/*!
 * CSSPlugin 3.12.7
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var WC,pu,rp,b2,Xh,ZC,w2,dj=function(){return typeof window<"u"},fc={},qh=180/Math.PI,sp=Math.PI/180,$f=Math.atan2,XC=1e8,T2=/([A-Z])/g,fj=/(left|right|width|margin|padding|x)/i,pj=/[\s,\(]\S/,bl={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},tT=function(t,l){return l.set(l.t,l.p,Math.round((l.s+l.c*t)*1e4)/1e4+l.u,l)},mj=function(t,l){return l.set(l.t,l.p,t===1?l.e:Math.round((l.s+l.c*t)*1e4)/1e4+l.u,l)},_j=function(t,l){return l.set(l.t,l.p,t?Math.round((l.s+l.c*t)*1e4)/1e4+l.u:l.b,l)},gj=function(t,l){var f=l.s+l.c*t;l.set(l.t,l.p,~~(f+(f<0?-.5:.5))+l.u,l)},S3=function(t,l){return l.set(l.t,l.p,t?l.e:l.b,l)},A3=function(t,l){return l.set(l.t,l.p,t!==1?l.b:l.e,l)},yj=function(t,l,f){return t.style[l]=f},vj=function(t,l,f){return t.style.setProperty(l,f)},xj=function(t,l,f){return t._gsap[l]=f},bj=function(t,l,f){return t._gsap.scaleX=t._gsap.scaleY=f},wj=function(t,l,f,_,b){var T=t._gsap;T.scaleX=T.scaleY=f,T.renderTransform(b,T)},Tj=function(t,l,f,_,b){var T=t._gsap;T[l]=f,T.renderTransform(b,T)},Ar="transform",wo=Ar+"Origin",Ej=function r(t,l){var f=this,_=this.target,b=_.style,T=_._gsap;if(t in fc&&b){if(this.tfm=this.tfm||{},t!=="transform")t=bl[t]||t,~t.indexOf(",")?t.split(",").forEach(function(n){return f.tfm[n]=rc(_,n)}):this.tfm[t]=T.x?T[t]:rc(_,t),t===wo&&(this.tfm.zOrigin=T.zOrigin);else return bl.transform.split(",").forEach(function(n){return r.call(f,n,l)});if(this.props.indexOf(Ar)>=0)return;T.svg&&(this.svgo=_.getAttribute("data-svg-origin"),this.props.push(wo,l,"")),t=Ar}(b||l)&&this.props.push(t,l,b[t])},M3=function(t){t.translate&&(t.removeProperty("translate"),t.removeProperty("scale"),t.removeProperty("rotate"))},Sj=function(){var t=this.props,l=this.target,f=l.style,_=l._gsap,b,T;for(b=0;b<t.length;b+=3)t[b+1]?t[b+1]===2?l[t[b]](t[b+2]):l[t[b]]=t[b+2]:t[b+2]?f[t[b]]=t[b+2]:f.removeProperty(t[b].substr(0,2)==="--"?t[b]:t[b].replace(T2,"-$1").toLowerCase());if(this.tfm){for(T in this.tfm)_[T]=this.tfm[T];_.svg&&(_.renderTransform(),l.setAttribute("data-svg-origin",this.svgo||"")),b=w2(),(!b||!b.isStart)&&!f[Ar]&&(M3(f),_.zOrigin&&f[wo]&&(f[wo]+=" "+_.zOrigin+"px",_.zOrigin=0,_.renderTransform()),_.uncache=1)}},C3=function(t,l){var f={target:t,props:[],revert:Sj,save:Ej};return t._gsap||To.core.getCache(t),l&&t.style&&t.nodeType&&l.split(",").forEach(function(_){return f.save(_)}),f},I3,iT=function(t,l){var f=pu.createElementNS?pu.createElementNS((l||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),t):pu.createElement(t);return f&&f.style?f:pu.createElement(t)},Sl=function r(t,l,f){var _=getComputedStyle(t);return _[l]||_.getPropertyValue(l.replace(T2,"-$1").toLowerCase())||_.getPropertyValue(l)||!f&&r(t,Ep(l)||l,1)||""},YC="O,Moz,ms,Ms,Webkit".split(","),Ep=function(t,l,f){var _=l||Xh,b=_.style,T=5;if(t in b&&!f)return t;for(t=t.charAt(0).toUpperCase()+t.substr(1);T--&&!(YC[T]+t in b););return T<0?null:(T===3?"ms":T>=0?YC[T]:"")+t},nT=function(){dj()&&window.document&&(WC=window,pu=WC.document,rp=pu.documentElement,Xh=iT("div")||{style:{}},iT("div"),Ar=Ep(Ar),wo=Ar+"Origin",Xh.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",I3=!!Ep("perspective"),w2=To.core.reverting,b2=1)},KC=function(t){var l=t.ownerSVGElement,f=iT("svg",l&&l.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),_=t.cloneNode(!0),b;_.style.display="block",f.appendChild(_),rp.appendChild(f);try{b=_.getBBox()}catch{}return f.removeChild(_),rp.removeChild(f),b},JC=function(t,l){for(var f=l.length;f--;)if(t.hasAttribute(l[f]))return t.getAttribute(l[f])},P3=function(t){var l,f;try{l=t.getBBox()}catch{l=KC(t),f=1}return l&&(l.width||l.height)||f||(l=KC(t)),l&&!l.width&&!l.x&&!l.y?{x:+JC(t,["x","cx","x1"])||0,y:+JC(t,["y","cy","y1"])||0,width:0,height:0}:l},R3=function(t){return!!(t.getCTM&&(!t.parentNode||t.ownerSVGElement)&&P3(t))},pd=function(t,l){if(l){var f=t.style,_;l in fc&&l!==wo&&(l=Ar),f.removeProperty?(_=l.substr(0,2),(_==="ms"||l.substr(0,6)==="webkit")&&(l="-"+l),f.removeProperty(_==="--"?l:l.replace(T2,"-$1").toLowerCase())):f.removeAttribute(l)}},mu=function(t,l,f,_,b,T){var n=new bo(t._pt,l,f,0,1,T?A3:S3);return t._pt=n,n.b=_,n.e=b,t._props.push(f),n},QC={deg:1,rad:1,turn:1},Aj={grid:1,flex:1},Mu=function r(t,l,f,_){var b=parseFloat(f)||0,T=(f+"").trim().substr((b+"").length)||"px",n=Xh.style,k=fj.test(l),j=t.tagName.toLowerCase()==="svg",U=(j?"client":"offset")+(k?"Width":"Height"),Z=100,re=_==="px",se=_==="%",ue,ne,be,De;if(_===T||!b||QC[_]||QC[T])return b;if(T!=="px"&&!re&&(b=r(t,l,f,"px")),De=t.getCTM&&R3(t),(se||T==="%")&&(fc[l]||~l.indexOf("adius")))return ue=De?t.getBBox()[k?"width":"height"]:t[U],Fr(se?b/ue*Z:b/100*ue);if(n[k?"width":"height"]=Z+(re?T:_),ne=_!=="rem"&&~l.indexOf("adius")||_==="em"&&t.appendChild&&!j?t:t.parentNode,De&&(ne=(t.ownerSVGElement||{}).parentNode),(!ne||ne===pu||!ne.appendChild)&&(ne=pu.body),be=ne._gsap,be&&se&&be.width&&k&&be.time===ko.time&&!be.uncache)return Fr(b/be.width*Z);if(se&&(l==="height"||l==="width")){var Be=t.style[l];t.style[l]=Z+_,ue=t[U],Be?t.style[l]=Be:pd(t,l)}else(se||T==="%")&&!Aj[Sl(ne,"display")]&&(n.position=Sl(t,"position")),ne===t&&(n.position="static"),ne.appendChild(Xh),ue=Xh[U],ne.removeChild(Xh),n.position="absolute";return k&&se&&(be=td(ne),be.time=ko.time,be.width=ne[U]),Fr(re?ue*b/Z:ue&&b?Z/ue*b:0)},rc=function(t,l,f,_){var b;return b2||nT(),l in bl&&l!=="transform"&&(l=bl[l],~l.indexOf(",")&&(l=l.split(",")[0])),fc[l]&&l!=="transform"?(b=xg(t,_),b=l!=="transformOrigin"?b[l]:b.svg?b.origin:Iv(Sl(t,wo))+" "+b.zOrigin+"px"):(b=t.style[l],(!b||b==="auto"||_||~(b+"").indexOf("calc("))&&(b=Cv[l]&&Cv[l](t,l,f)||Sl(t,l)||WR(t,l)||(l==="opacity"?1:0))),f&&!~(b+"").trim().indexOf(" ")?Mu(t,l,b,f)+f:b},Mj=function(t,l,f,_){if(!f||f==="none"){var b=Ep(l,t,1),T=b&&Sl(t,b,1);T&&T!==f?(l=b,f=T):l==="borderColor"&&(f=Sl(t,"borderTopColor"))}var n=new bo(this._pt,t.style,l,0,1,w3),k=0,j=0,U,Z,re,se,ue,ne,be,De,Be,Te,me,Ie;if(n.b=f,n.e=_,f+="",_+="",_==="auto"&&(ne=t.style[l],t.style[l]=_,_=Sl(t,l)||_,ne?t.style[l]=ne:pd(t,l)),U=[f,_],d3(U),f=U[0],_=U[1],re=f.match(ep)||[],Ie=_.match(ep)||[],Ie.length){for(;Z=ep.exec(_);)be=Z[0],Be=_.substring(k,Z.index),ue?ue=(ue+1)%5:(Be.substr(-5)==="rgba("||Be.substr(-5)==="hsla(")&&(ue=1),be!==(ne=re[j++]||"")&&(se=parseFloat(ne)||0,me=ne.substr((se+"").length),be.charAt(1)==="="&&(be=np(se,be)+me),De=parseFloat(be),Te=be.substr((De+"").length),k=ep.lastIndex-Te.length,Te||(Te=Te||Vo.units[l]||me,k===_.length&&(_+=Te,n.e+=Te)),me!==Te&&(se=Mu(t,l,ne,Te)||0),n._pt={_next:n._pt,p:Be||j===1?Be:",",s:se,c:De-se,m:ue&&ue<4||l==="zIndex"?Math.round:0});n.c=k<_.length?_.substring(k,_.length):""}else n.r=l==="display"&&_==="none"?A3:S3;return UR.test(_)&&(n.e=0),this._pt=n,n},eI={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Cj=function(t){var l=t.split(" "),f=l[0],_=l[1]||"50%";return(f==="top"||f==="bottom"||_==="left"||_==="right")&&(t=f,f=_,_=t),l[0]=eI[f]||f,l[1]=eI[_]||_,l.join(" ")},Ij=function(t,l){if(l.tween&&l.tween._time===l.tween._dur){var f=l.t,_=f.style,b=l.u,T=f._gsap,n,k,j;if(b==="all"||b===!0)_.cssText="",k=1;else for(b=b.split(","),j=b.length;--j>-1;)n=b[j],fc[n]&&(k=1,n=n==="transformOrigin"?wo:Ar),pd(f,n);k&&(pd(f,Ar),T&&(T.svg&&f.removeAttribute("transform"),_.scale=_.rotate=_.translate="none",xg(f,1),T.uncache=1,M3(_)))}},Cv={clearProps:function(t,l,f,_,b){if(b.data!=="isFromStart"){var T=t._pt=new bo(t._pt,l,f,0,0,Ij);return T.u=_,T.pr=-10,T.tween=b,t._props.push(f),1}}},vg=[1,0,0,1,0,0],D3={},L3=function(t){return t==="matrix(1, 0, 0, 1, 0, 0)"||t==="none"||!t},tI=function(t){var l=Sl(t,Ar);return L3(l)?vg:l.substr(7).match(VR).map(Fr)},E2=function(t,l){var f=t._gsap||td(t),_=t.style,b=tI(t),T,n,k,j;return f.svg&&t.getAttribute("transform")?(k=t.transform.baseVal.consolidate().matrix,b=[k.a,k.b,k.c,k.d,k.e,k.f],b.join(",")==="1,0,0,1,0,0"?vg:b):(b===vg&&!t.offsetParent&&t!==rp&&!f.svg&&(k=_.display,_.display="block",T=t.parentNode,(!T||!t.offsetParent&&!t.getBoundingClientRect().width)&&(j=1,n=t.nextElementSibling,rp.appendChild(t)),b=tI(t),k?_.display=k:pd(t,"display"),j&&(n?T.insertBefore(t,n):T?T.appendChild(t):rp.removeChild(t))),l&&b.length>6?[b[0],b[1],b[4],b[5],b[12],b[13]]:b)},rT=function(t,l,f,_,b,T){var n=t._gsap,k=b||E2(t,!0),j=n.xOrigin||0,U=n.yOrigin||0,Z=n.xOffset||0,re=n.yOffset||0,se=k[0],ue=k[1],ne=k[2],be=k[3],De=k[4],Be=k[5],Te=l.split(" "),me=parseFloat(Te[0])||0,Ie=parseFloat(Te[1])||0,Xe,je,rt,Ve;f?k!==vg&&(je=se*be-ue*ne)&&(rt=me*(be/je)+Ie*(-ne/je)+(ne*Be-be*De)/je,Ve=me*(-ue/je)+Ie*(se/je)-(se*Be-ue*De)/je,me=rt,Ie=Ve):(Xe=P3(t),me=Xe.x+(~Te[0].indexOf("%")?me/100*Xe.width:me),Ie=Xe.y+(~(Te[1]||Te[0]).indexOf("%")?Ie/100*Xe.height:Ie)),_||_!==!1&&n.smooth?(De=me-j,Be=Ie-U,n.xOffset=Z+(De*se+Be*ne)-De,n.yOffset=re+(De*ue+Be*be)-Be):n.xOffset=n.yOffset=0,n.xOrigin=me,n.yOrigin=Ie,n.smooth=!!_,n.origin=l,n.originIsAbsolute=!!f,t.style[wo]="0px 0px",T&&(mu(T,n,"xOrigin",j,me),mu(T,n,"yOrigin",U,Ie),mu(T,n,"xOffset",Z,n.xOffset),mu(T,n,"yOffset",re,n.yOffset)),t.setAttribute("data-svg-origin",me+" "+Ie)},xg=function(t,l){var f=t._gsap||new _3(t);if("x"in f&&!l&&!f.uncache)return f;var _=t.style,b=f.scaleX<0,T="px",n="deg",k=getComputedStyle(t),j=Sl(t,wo)||"0",U,Z,re,se,ue,ne,be,De,Be,Te,me,Ie,Xe,je,rt,Ve,He,st,dt,At,ni,Tt,kt,ti,li,ii,Pn,Fn,xn,_i,dr,Wn;return U=Z=re=ne=be=De=Be=Te=me=0,se=ue=1,f.svg=!!(t.getCTM&&R3(t)),k.translate&&((k.translate!=="none"||k.scale!=="none"||k.rotate!=="none")&&(_[Ar]=(k.translate!=="none"?"translate3d("+(k.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(k.rotate!=="none"?"rotate("+k.rotate+") ":"")+(k.scale!=="none"?"scale("+k.scale.split(" ").join(",")+") ":"")+(k[Ar]!=="none"?k[Ar]:"")),_.scale=_.rotate=_.translate="none"),je=E2(t,f.svg),f.svg&&(f.uncache?(li=t.getBBox(),j=f.xOrigin-li.x+"px "+(f.yOrigin-li.y)+"px",ti=""):ti=!l&&t.getAttribute("data-svg-origin"),rT(t,ti||j,!!ti||f.originIsAbsolute,f.smooth!==!1,je)),Ie=f.xOrigin||0,Xe=f.yOrigin||0,je!==vg&&(st=je[0],dt=je[1],At=je[2],ni=je[3],U=Tt=je[4],Z=kt=je[5],je.length===6?(se=Math.sqrt(st*st+dt*dt),ue=Math.sqrt(ni*ni+At*At),ne=st||dt?$f(dt,st)*qh:0,Be=At||ni?$f(At,ni)*qh+ne:0,Be&&(ue*=Math.abs(Math.cos(Be*sp))),f.svg&&(U-=Ie-(Ie*st+Xe*At),Z-=Xe-(Ie*dt+Xe*ni))):(Wn=je[6],_i=je[7],Pn=je[8],Fn=je[9],xn=je[10],dr=je[11],U=je[12],Z=je[13],re=je[14],rt=$f(Wn,xn),be=rt*qh,rt&&(Ve=Math.cos(-rt),He=Math.sin(-rt),ti=Tt*Ve+Pn*He,li=kt*Ve+Fn*He,ii=Wn*Ve+xn*He,Pn=Tt*-He+Pn*Ve,Fn=kt*-He+Fn*Ve,xn=Wn*-He+xn*Ve,dr=_i*-He+dr*Ve,Tt=ti,kt=li,Wn=ii),rt=$f(-At,xn),De=rt*qh,rt&&(Ve=Math.cos(-rt),He=Math.sin(-rt),ti=st*Ve-Pn*He,li=dt*Ve-Fn*He,ii=At*Ve-xn*He,dr=ni*He+dr*Ve,st=ti,dt=li,At=ii),rt=$f(dt,st),ne=rt*qh,rt&&(Ve=Math.cos(rt),He=Math.sin(rt),ti=st*Ve+dt*He,li=Tt*Ve+kt*He,dt=dt*Ve-st*He,kt=kt*Ve-Tt*He,st=ti,Tt=li),be&&Math.abs(be)+Math.abs(ne)>359.9&&(be=ne=0,De=180-De),se=Fr(Math.sqrt(st*st+dt*dt+At*At)),ue=Fr(Math.sqrt(kt*kt+Wn*Wn)),rt=$f(Tt,kt),Be=Math.abs(rt)>2e-4?rt*qh:0,me=dr?1/(dr<0?-dr:dr):0),f.svg&&(ti=t.getAttribute("transform"),f.forceCSS=t.setAttribute("transform","")||!L3(Sl(t,Ar)),ti&&t.setAttribute("transform",ti))),Math.abs(Be)>90&&Math.abs(Be)<270&&(b?(se*=-1,Be+=ne<=0?180:-180,ne+=ne<=0?180:-180):(ue*=-1,Be+=Be<=0?180:-180)),l=l||f.uncache,f.x=U-((f.xPercent=U&&(!l&&f.xPercent||(Math.round(t.offsetWidth/2)===Math.round(-U)?-50:0)))?t.offsetWidth*f.xPercent/100:0)+T,f.y=Z-((f.yPercent=Z&&(!l&&f.yPercent||(Math.round(t.offsetHeight/2)===Math.round(-Z)?-50:0)))?t.offsetHeight*f.yPercent/100:0)+T,f.z=re+T,f.scaleX=Fr(se),f.scaleY=Fr(ue),f.rotation=Fr(ne)+n,f.rotationX=Fr(be)+n,f.rotationY=Fr(De)+n,f.skewX=Be+n,f.skewY=Te+n,f.transformPerspective=me+T,(f.zOrigin=parseFloat(j.split(" ")[2])||!l&&f.zOrigin||0)&&(_[wo]=Iv(j)),f.xOffset=f.yOffset=0,f.force3D=Vo.force3D,f.renderTransform=f.svg?Rj:I3?O3:Pj,f.uncache=0,f},Iv=function(t){return(t=t.split(" "))[0]+" "+t[1]},mw=function(t,l,f){var _=Fs(l);return Fr(parseFloat(l)+parseFloat(Mu(t,"x",f+"px",_)))+_},Pj=function(t,l){l.z="0px",l.rotationY=l.rotationX="0deg",l.force3D=0,O3(t,l)},Vh="0deg",$_="0px",Uh=") ",O3=function(t,l){var f=l||this,_=f.xPercent,b=f.yPercent,T=f.x,n=f.y,k=f.z,j=f.rotation,U=f.rotationY,Z=f.rotationX,re=f.skewX,se=f.skewY,ue=f.scaleX,ne=f.scaleY,be=f.transformPerspective,De=f.force3D,Be=f.target,Te=f.zOrigin,me="",Ie=De==="auto"&&t&&t!==1||De===!0;if(Te&&(Z!==Vh||U!==Vh)){var Xe=parseFloat(U)*sp,je=Math.sin(Xe),rt=Math.cos(Xe),Ve;Xe=parseFloat(Z)*sp,Ve=Math.cos(Xe),T=mw(Be,T,je*Ve*-Te),n=mw(Be,n,-Math.sin(Xe)*-Te),k=mw(Be,k,rt*Ve*-Te+Te)}be!==$_&&(me+="perspective("+be+Uh),(_||b)&&(me+="translate("+_+"%, "+b+"%) "),(Ie||T!==$_||n!==$_||k!==$_)&&(me+=k!==$_||Ie?"translate3d("+T+", "+n+", "+k+") ":"translate("+T+", "+n+Uh),j!==Vh&&(me+="rotate("+j+Uh),U!==Vh&&(me+="rotateY("+U+Uh),Z!==Vh&&(me+="rotateX("+Z+Uh),(re!==Vh||se!==Vh)&&(me+="skew("+re+", "+se+Uh),(ue!==1||ne!==1)&&(me+="scale("+ue+", "+ne+Uh),Be.style[Ar]=me||"translate(0, 0)"},Rj=function(t,l){var f=l||this,_=f.xPercent,b=f.yPercent,T=f.x,n=f.y,k=f.rotation,j=f.skewX,U=f.skewY,Z=f.scaleX,re=f.scaleY,se=f.target,ue=f.xOrigin,ne=f.yOrigin,be=f.xOffset,De=f.yOffset,Be=f.forceCSS,Te=parseFloat(T),me=parseFloat(n),Ie,Xe,je,rt,Ve;k=parseFloat(k),j=parseFloat(j),U=parseFloat(U),U&&(U=parseFloat(U),j+=U,k+=U),k||j?(k*=sp,j*=sp,Ie=Math.cos(k)*Z,Xe=Math.sin(k)*Z,je=Math.sin(k-j)*-re,rt=Math.cos(k-j)*re,j&&(U*=sp,Ve=Math.tan(j-U),Ve=Math.sqrt(1+Ve*Ve),je*=Ve,rt*=Ve,U&&(Ve=Math.tan(U),Ve=Math.sqrt(1+Ve*Ve),Ie*=Ve,Xe*=Ve)),Ie=Fr(Ie),Xe=Fr(Xe),je=Fr(je),rt=Fr(rt)):(Ie=Z,rt=re,Xe=je=0),(Te&&!~(T+"").indexOf("px")||me&&!~(n+"").indexOf("px"))&&(Te=Mu(se,"x",T,"px"),me=Mu(se,"y",n,"px")),(ue||ne||be||De)&&(Te=Fr(Te+ue-(ue*Ie+ne*je)+be),me=Fr(me+ne-(ue*Xe+ne*rt)+De)),(_||b)&&(Ve=se.getBBox(),Te=Fr(Te+_/100*Ve.width),me=Fr(me+b/100*Ve.height)),Ve="matrix("+Ie+","+Xe+","+je+","+rt+","+Te+","+me+")",se.setAttribute("transform",Ve),Be&&(se.style[Ar]=Ve)},Dj=function(t,l,f,_,b){var T=360,n=gs(b),k=parseFloat(b)*(n&&~b.indexOf("rad")?qh:1),j=k-_,U=_+j+"deg",Z,re;return n&&(Z=b.split("_")[1],Z==="short"&&(j%=T,j!==j%(T/2)&&(j+=j<0?T:-T)),Z==="cw"&&j<0?j=(j+T*XC)%T-~~(j/T)*T:Z==="ccw"&&j>0&&(j=(j-T*XC)%T-~~(j/T)*T)),t._pt=re=new bo(t._pt,l,f,_,j,mj),re.e=U,re.u="deg",t._props.push(f),re},iI=function(t,l){for(var f in l)t[f]=l[f];return t},Lj=function(t,l,f){var _=iI({},f._gsap),b="perspective,force3D,transformOrigin,svgOrigin",T=f.style,n,k,j,U,Z,re,se,ue;_.svg?(j=f.getAttribute("transform"),f.setAttribute("transform",""),T[Ar]=l,n=xg(f,1),pd(f,Ar),f.setAttribute("transform",j)):(j=getComputedStyle(f)[Ar],T[Ar]=l,n=xg(f,1),T[Ar]=j);for(k in fc)j=_[k],U=n[k],j!==U&&b.indexOf(k)<0&&(se=Fs(j),ue=Fs(U),Z=se!==ue?Mu(f,k,j,ue):parseFloat(j),re=parseFloat(U),t._pt=new bo(t._pt,n,k,Z,re-Z,tT),t._pt.u=ue||0,t._props.push(k));iI(n,_)};xo("padding,margin,Width,Radius",function(r,t){var l="Top",f="Right",_="Bottom",b="Left",T=(t<3?[l,f,_,b]:[l+b,l+f,_+f,_+b]).map(function(n){return t<2?r+n:"border"+n+r});Cv[t>1?"border"+r:r]=function(n,k,j,U,Z){var re,se;if(arguments.length<4)return re=T.map(function(ue){return rc(n,ue,j)}),se=re.join(" "),se.split(re[0]).length===5?re[0]:se;re=(U+"").split(" "),se={},T.forEach(function(ue,ne){return se[ue]=re[ne]=re[ne]||re[(ne-1)/2|0]}),n.init(k,se,Z)}});var z3={name:"css",register:nT,targetTest:function(t){return t.style&&t.nodeType},init:function(t,l,f,_,b){var T=this._props,n=t.style,k=f.vars.startAt,j,U,Z,re,se,ue,ne,be,De,Be,Te,me,Ie,Xe,je,rt;b2||nT(),this.styles=this.styles||C3(t),rt=this.styles.props,this.tween=f;for(ne in l)if(ne!=="autoRound"&&(U=l[ne],!(zo[ne]&&g3(ne,l,f,_,t,b)))){if(se=typeof U,ue=Cv[ne],se==="function"&&(U=U.call(f,_,t,b),se=typeof U),se==="string"&&~U.indexOf("random(")&&(U=_g(U)),ue)ue(this,t,ne,U,f)&&(je=1);else if(ne.substr(0,2)==="--")j=(getComputedStyle(t).getPropertyValue(ne)+"").trim(),U+="",gu.lastIndex=0,gu.test(j)||(be=Fs(j),De=Fs(U)),De?be!==De&&(j=Mu(t,ne,j,De)+De):be&&(U+=be),this.add(n,"setProperty",j,U,_,b,0,0,ne),T.push(ne),rt.push(ne,0,n[ne]);else if(se!=="undefined"){if(k&&ne in k?(j=typeof k[ne]=="function"?k[ne].call(f,_,t,b):k[ne],gs(j)&&~j.indexOf("random(")&&(j=_g(j)),Fs(j+"")||j==="auto"||(j+=Vo.units[ne]||Fs(rc(t,ne))||""),(j+"").charAt(1)==="="&&(j=rc(t,ne))):j=rc(t,ne),re=parseFloat(j),Be=se==="string"&&U.charAt(1)==="="&&U.substr(0,2),Be&&(U=U.substr(2)),Z=parseFloat(U),ne in bl&&(ne==="autoAlpha"&&(re===1&&rc(t,"visibility")==="hidden"&&Z&&(re=0),rt.push("visibility",0,n.visibility),mu(this,n,"visibility",re?"inherit":"hidden",Z?"inherit":"hidden",!Z)),ne!=="scale"&&ne!=="transform"&&(ne=bl[ne],~ne.indexOf(",")&&(ne=ne.split(",")[0]))),Te=ne in fc,Te){if(this.styles.save(ne),me||(Ie=t._gsap,Ie.renderTransform&&!l.parseTransform||xg(t,l.parseTransform),Xe=l.smoothOrigin!==!1&&Ie.smooth,me=this._pt=new bo(this._pt,n,Ar,0,1,Ie.renderTransform,Ie,0,-1),me.dep=1),ne==="scale")this._pt=new bo(this._pt,Ie,"scaleY",Ie.scaleY,(Be?np(Ie.scaleY,Be+Z):Z)-Ie.scaleY||0,tT),this._pt.u=0,T.push("scaleY",ne),ne+="X";else if(ne==="transformOrigin"){rt.push(wo,0,n[wo]),U=Cj(U),Ie.svg?rT(t,U,0,Xe,0,this):(De=parseFloat(U.split(" ")[2])||0,De!==Ie.zOrigin&&mu(this,Ie,"zOrigin",Ie.zOrigin,De),mu(this,n,ne,Iv(j),Iv(U)));continue}else if(ne==="svgOrigin"){rT(t,U,1,Xe,0,this);continue}else if(ne in D3){Dj(this,Ie,ne,re,Be?np(re,Be+U):U);continue}else if(ne==="smoothOrigin"){mu(this,Ie,"smooth",Ie.smooth,U);continue}else if(ne==="force3D"){Ie[ne]=U;continue}else if(ne==="transform"){Lj(this,U,t);continue}}else ne in n||(ne=Ep(ne)||ne);if(Te||(Z||Z===0)&&(re||re===0)&&!pj.test(U)&&ne in n)be=(j+"").substr((re+"").length),Z||(Z=0),De=Fs(U)||(ne in Vo.units?Vo.units[ne]:be),be!==De&&(re=Mu(t,ne,j,De)),this._pt=new bo(this._pt,Te?Ie:n,ne,re,(Be?np(re,Be+Z):Z)-re,!Te&&(De==="px"||ne==="zIndex")&&l.autoRound!==!1?gj:tT),this._pt.u=De||0,be!==De&&De!=="%"&&(this._pt.b=j,this._pt.r=_j);else if(ne in n)Mj.call(this,t,ne,j,Be?Be+U:U);else if(ne in t)this.add(t,ne,j||t[ne],Be?Be+U:U,_,b);else if(ne!=="parseTransform"){d2(ne,U);continue}Te||(ne in n?rt.push(ne,0,n[ne]):typeof t[ne]=="function"?rt.push(ne,2,t[ne]()):rt.push(ne,1,j||t[ne])),T.push(ne)}}je&&T3(this)},render:function(t,l){if(l.tween._time||!w2())for(var f=l._pt;f;)f.r(t,f.d),f=f._next;else l.styles.revert()},get:rc,aliases:bl,getSetter:function(t,l,f){var _=bl[l];return _&&_.indexOf(",")<0&&(l=_),l in fc&&l!==wo&&(t._gsap.x||rc(t,"x"))?f&&ZC===f?l==="scale"?bj:xj:(ZC=f||{})&&(l==="scale"?wj:Tj):t.style&&!c2(t.style[l])?yj:~l.indexOf("-")?vj:v2(t,l)},core:{_removeProperty:pd,_getMatrix:E2}};To.utils.checkPrefix=Ep;To.core.getStyleSaver=C3;(function(r,t,l,f){var _=xo(r+","+t+","+l,function(b){fc[b]=1});xo(t,function(b){Vo.units[b]="deg",D3[b]=1}),bl[_[13]]=r+","+t,xo(f,function(b){var T=b.split(":");bl[T[1]]=_[T[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");xo("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(r){Vo.units[r]="px"});To.registerPlugin(z3);var sT=To.registerPlugin(z3)||To;sT.core.Tween;/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Zo(r){const t=Object.create(null);for(const l of r.split(","))t[l]=1;return l=>l in t}const yn={},op=[],_s=()=>{},X_=()=>!1,Ed=r=>r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&(r.charCodeAt(2)>122||r.charCodeAt(2)<97),S2=r=>r.startsWith("onUpdate:"),vn=Object.assign,A2=(r,t)=>{const l=r.indexOf(t);l>-1&&r.splice(l,1)},Oj=Object.prototype.hasOwnProperty,zn=(r,t)=>Oj.call(r,t),vi=Array.isArray,ap=r=>Bp(r)==="[object Map]",Sd=r=>Bp(r)==="[object Set]",nI=r=>Bp(r)==="[object Date]",zj=r=>Bp(r)==="[object RegExp]",ji=r=>typeof r=="function",nn=r=>typeof r=="string",Eo=r=>typeof r=="symbol",$n=r=>r!==null&&typeof r=="object",M2=r=>($n(r)||ji(r))&&ji(r.then)&&ji(r.catch),k3=Object.prototype.toString,Bp=r=>k3.call(r),kj=r=>Bp(r).slice(8,-1),v1=r=>Bp(r)==="[object Object]",C2=r=>nn(r)&&r!=="NaN"&&r[0]!=="-"&&""+parseInt(r,10)===r,yu=Zo(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Fj=Zo("bind,cloak,else-if,else,for,html,if,model,on,once,pre,show,slot,text,memo"),x1=r=>{const t=Object.create(null);return l=>t[l]||(t[l]=r(l))},Nj=/-(\w)/g,hr=x1(r=>r.replace(Nj,(t,l)=>l?l.toUpperCase():"")),Bj=/\B([A-Z])/g,go=x1(r=>r.replace(Bj,"-$1").toLowerCase()),Ad=x1(r=>r.charAt(0).toUpperCase()+r.slice(1)),lp=x1(r=>r?`on${Ad(r)}`:""),Js=(r,t)=>!Object.is(r,t),cp=(r,...t)=>{for(let l=0;l<r.length;l++)r[l](...t)},F3=(r,t,l,f=!1)=>{Object.defineProperty(r,t,{configurable:!0,enumerable:!1,writable:f,value:l})},Pv=r=>{const t=parseFloat(r);return isNaN(t)?r:t},Rv=r=>{const t=nn(r)?Number(r):NaN;return isNaN(t)?r:t};let rI;const b1=()=>rI||(rI=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Vj(r,t){return r+JSON.stringify(t,(l,f)=>typeof f=="function"?f.toString():f)}const Uj="Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt,console,Error,Symbol",jj=Zo(Uj);function Es(r){if(vi(r)){const t={};for(let l=0;l<r.length;l++){const f=r[l],_=nn(f)?N3(f):Es(f);if(_)for(const b in _)t[b]=_[b]}return t}else if(nn(r)||$n(r))return r}const $j=/;(?![^(]*\))/g,qj=/:([^]+)/,Hj=/\/\*[^]*?\*\//g;function N3(r){const t={};return r.replace(Hj,"").split($j).forEach(l=>{if(l){const f=l.split(qj);f.length>1&&(t[f[0].trim()]=f[1].trim())}}),t}function md(r){let t="";if(nn(r))t=r;else if(vi(r))for(let l=0;l<r.length;l++){const f=md(r[l]);f&&(t+=f+" ")}else if($n(r))for(const l in r)r[l]&&(t+=l+" ");return t.trim()}function Gj(r){if(!r)return null;let{class:t,style:l}=r;return t&&!nn(t)&&(r.class=md(t)),l&&(r.style=Es(l)),r}const Wj="html,body,base,head,link,meta,style,title,address,article,aside,footer,header,hgroup,h1,h2,h3,h4,h5,h6,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,summary,template,blockquote,iframe,tfoot",Zj="svg,animate,animateMotion,animateTransform,circle,clipPath,color-profile,defs,desc,discard,ellipse,feBlend,feColorMatrix,feComponentTransfer,feComposite,feConvolveMatrix,feDiffuseLighting,feDisplacementMap,feDistantLight,feDropShadow,feFlood,feFuncA,feFuncB,feFuncG,feFuncR,feGaussianBlur,feImage,feMerge,feMergeNode,feMorphology,feOffset,fePointLight,feSpecularLighting,feSpotLight,feTile,feTurbulence,filter,foreignObject,g,hatch,hatchpath,image,line,linearGradient,marker,mask,mesh,meshgradient,meshpatch,meshrow,metadata,mpath,path,pattern,polygon,polyline,radialGradient,rect,set,solidcolor,stop,switch,symbol,text,textPath,title,tspan,unknown,use,view",Xj="annotation,annotation-xml,maction,maligngroup,malignmark,math,menclose,merror,mfenced,mfrac,mfraction,mglyph,mi,mlabeledtr,mlongdiv,mmultiscripts,mn,mo,mover,mpadded,mphantom,mprescripts,mroot,mrow,ms,mscarries,mscarry,msgroup,msline,mspace,msqrt,msrow,mstack,mstyle,msub,msubsup,msup,mtable,mtd,mtext,mtr,munder,munderover,none,semantics",Yj="area,base,br,col,embed,hr,img,input,link,meta,param,source,track,wbr",Kj=Zo(Wj),Jj=Zo(Zj),Qj=Zo(Xj),e$=Zo(Yj),t$="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",i$=Zo(t$);function B3(r){return!!r||r===""}function n$(r,t){if(r.length!==t.length)return!1;let l=!0;for(let f=0;l&&f<r.length;f++)l=Cu(r[f],t[f]);return l}function Cu(r,t){if(r===t)return!0;let l=nI(r),f=nI(t);if(l||f)return l&&f?r.getTime()===t.getTime():!1;if(l=Eo(r),f=Eo(t),l||f)return r===t;if(l=vi(r),f=vi(t),l||f)return l&&f?n$(r,t):!1;if(l=$n(r),f=$n(t),l||f){if(!l||!f)return!1;const _=Object.keys(r).length,b=Object.keys(t).length;if(_!==b)return!1;for(const T in r){const n=r.hasOwnProperty(T),k=t.hasOwnProperty(T);if(n&&!k||!n&&k||!Cu(r[T],t[T]))return!1}}return String(r)===String(t)}function w1(r,t){return r.findIndex(l=>Cu(l,t))}const V3=r=>!!(r&&r.__v_isRef===!0),qt=r=>nn(r)?r:r==null?"":vi(r)||$n(r)&&(r.toString===k3||!ji(r.toString))?V3(r)?qt(r.value):JSON.stringify(r,U3,2):String(r),U3=(r,t)=>V3(t)?U3(r,t.value):ap(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((l,[f,_],b)=>(l[_w(f,b)+" =>"]=_,l),{})}:Sd(t)?{[`Set(${t.size})`]:[...t.values()].map(l=>_w(l))}:Eo(t)?_w(t):$n(t)&&!vi(t)&&!v1(t)?String(t):t,_w=(r,t="")=>{var l;return Eo(r)?`Symbol(${(l=r.description)!=null?l:t})`:r};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Ks;class I2{constructor(t=!1){this.detached=t,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Ks,!t&&Ks&&(this.index=(Ks.scopes||(Ks.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let t,l;if(this.scopes)for(t=0,l=this.scopes.length;t<l;t++)this.scopes[t].pause();for(t=0,l=this.effects.length;t<l;t++)this.effects[t].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let t,l;if(this.scopes)for(t=0,l=this.scopes.length;t<l;t++)this.scopes[t].resume();for(t=0,l=this.effects.length;t<l;t++)this.effects[t].resume()}}run(t){if(this._active){const l=Ks;try{return Ks=this,t()}finally{Ks=l}}}on(){Ks=this}off(){Ks=this.parent}stop(t){if(this._active){this._active=!1;let l,f;for(l=0,f=this.effects.length;l<f;l++)this.effects[l].stop();for(this.effects.length=0,l=0,f=this.cleanups.length;l<f;l++)this.cleanups[l]();if(this.cleanups.length=0,this.scopes){for(l=0,f=this.scopes.length;l<f;l++)this.scopes[l].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!t){const _=this.parent.scopes.pop();_&&_!==this&&(this.parent.scopes[this.index]=_,_.index=this.index)}this.parent=void 0}}}function r$(r){return new I2(r)}function j3(){return Ks}function s$(r,t=!1){Ks&&Ks.cleanups.push(r)}let rr;const gw=new WeakSet;class bg{constructor(t){this.fn=t,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Ks&&Ks.active&&Ks.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,gw.has(this)&&(gw.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||q3(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,sI(this),H3(this);const t=rr,l=Za;rr=this,Za=!0;try{return this.fn()}finally{G3(this),rr=t,Za=l,this.flags&=-3}}stop(){if(this.flags&1){for(let t=this.deps;t;t=t.nextDep)D2(t);this.deps=this.depsTail=void 0,sI(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?gw.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){oT(this)&&this.run()}get dirty(){return oT(this)}}let $3=0,ng,rg;function q3(r,t=!1){if(r.flags|=8,t){r.next=rg,rg=r;return}r.next=ng,ng=r}function P2(){$3++}function R2(){if(--$3>0)return;if(rg){let t=rg;for(rg=void 0;t;){const l=t.next;t.next=void 0,t.flags&=-9,t=l}}let r;for(;ng;){let t=ng;for(ng=void 0;t;){const l=t.next;if(t.next=void 0,t.flags&=-9,t.flags&1)try{t.trigger()}catch(f){r||(r=f)}t=l}}if(r)throw r}function H3(r){for(let t=r.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function G3(r){let t,l=r.depsTail,f=l;for(;f;){const _=f.prevDep;f.version===-1?(f===l&&(l=_),D2(f),o$(f)):t=f,f.dep.activeLink=f.prevActiveLink,f.prevActiveLink=void 0,f=_}r.deps=t,r.depsTail=l}function oT(r){for(let t=r.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(W3(t.dep.computed)||t.dep.version!==t.version))return!0;return!!r._dirty}function W3(r){if(r.flags&4&&!(r.flags&16)||(r.flags&=-17,r.globalVersion===wg))return;r.globalVersion=wg;const t=r.dep;if(r.flags|=2,t.version>0&&!r.isSSR&&r.deps&&!oT(r)){r.flags&=-3;return}const l=rr,f=Za;rr=r,Za=!0;try{H3(r);const _=r.fn(r._value);(t.version===0||Js(_,r._value))&&(r._value=_,t.version++)}catch(_){throw t.version++,_}finally{rr=l,Za=f,G3(r),r.flags&=-3}}function D2(r,t=!1){const{dep:l,prevSub:f,nextSub:_}=r;if(f&&(f.nextSub=_,r.prevSub=void 0),_&&(_.prevSub=f,r.nextSub=void 0),l.subs===r&&(l.subs=f,!f&&l.computed)){l.computed.flags&=-5;for(let b=l.computed.deps;b;b=b.nextDep)D2(b,!0)}!t&&!--l.sc&&l.map&&l.map.delete(l.key)}function o$(r){const{prevDep:t,nextDep:l}=r;t&&(t.nextDep=l,r.prevDep=void 0),l&&(l.prevDep=t,r.nextDep=void 0)}function a$(r,t){r.effect instanceof bg&&(r=r.effect.fn);const l=new bg(r);t&&vn(l,t);try{l.run()}catch(_){throw l.stop(),_}const f=l.run.bind(l);return f.effect=l,f}function l$(r){r.effect.stop()}let Za=!0;const Z3=[];function zu(){Z3.push(Za),Za=!1}function ku(){const r=Z3.pop();Za=r===void 0?!0:r}function sI(r){const{cleanup:t}=r;if(r.cleanup=void 0,t){const l=rr;rr=void 0;try{t()}finally{rr=l}}}let wg=0;class c${constructor(t,l){this.sub=t,this.dep=l,this.version=l.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class T1{constructor(t){this.computed=t,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(t){if(!rr||!Za||rr===this.computed)return;let l=this.activeLink;if(l===void 0||l.sub!==rr)l=this.activeLink=new c$(rr,this),rr.deps?(l.prevDep=rr.depsTail,rr.depsTail.nextDep=l,rr.depsTail=l):rr.deps=rr.depsTail=l,X3(l);else if(l.version===-1&&(l.version=this.version,l.nextDep)){const f=l.nextDep;f.prevDep=l.prevDep,l.prevDep&&(l.prevDep.nextDep=f),l.prevDep=rr.depsTail,l.nextDep=void 0,rr.depsTail.nextDep=l,rr.depsTail=l,rr.deps===l&&(rr.deps=f)}return l}trigger(t){this.version++,wg++,this.notify(t)}notify(t){P2();try{for(let l=this.subs;l;l=l.prevSub)l.sub.notify()&&l.sub.dep.notify()}finally{R2()}}}function X3(r){if(r.dep.sc++,r.sub.flags&4){const t=r.dep.computed;if(t&&!r.dep.subs){t.flags|=20;for(let f=t.deps;f;f=f.nextDep)X3(f)}const l=r.dep.subs;l!==r&&(r.prevSub=l,l&&(l.nextSub=r)),r.dep.subs=r}}const Dv=new WeakMap,od=Symbol(""),aT=Symbol(""),Tg=Symbol("");function Os(r,t,l){if(Za&&rr){let f=Dv.get(r);f||Dv.set(r,f=new Map);let _=f.get(l);_||(f.set(l,_=new T1),_.map=f,_.key=l),_.track()}}function sc(r,t,l,f,_,b){const T=Dv.get(r);if(!T){wg++;return}const n=k=>{k&&k.trigger()};if(P2(),t==="clear")T.forEach(n);else{const k=vi(r),j=k&&C2(l);if(k&&l==="length"){const U=Number(f);T.forEach((Z,re)=>{(re==="length"||re===Tg||!Eo(re)&&re>=U)&&n(Z)})}else switch((l!==void 0||T.has(void 0))&&n(T.get(l)),j&&n(T.get(Tg)),t){case"add":k?j&&n(T.get("length")):(n(T.get(od)),ap(r)&&n(T.get(aT)));break;case"delete":k||(n(T.get(od)),ap(r)&&n(T.get(aT)));break;case"set":ap(r)&&n(T.get(od));break}}R2()}function u$(r,t){const l=Dv.get(r);return l&&l.get(t)}function qf(r){const t=In(r);return t===r?t:(Os(t,"iterate",Tg),Uo(r)?t:t.map(zs))}function E1(r){return Os(r=In(r),"iterate",Tg),r}const h$={__proto__:null,[Symbol.iterator](){return yw(this,Symbol.iterator,zs)},concat(...r){return qf(this).concat(...r.map(t=>vi(t)?qf(t):t))},entries(){return yw(this,"entries",r=>(r[1]=zs(r[1]),r))},every(r,t){return Ql(this,"every",r,t,void 0,arguments)},filter(r,t){return Ql(this,"filter",r,t,l=>l.map(zs),arguments)},find(r,t){return Ql(this,"find",r,t,zs,arguments)},findIndex(r,t){return Ql(this,"findIndex",r,t,void 0,arguments)},findLast(r,t){return Ql(this,"findLast",r,t,zs,arguments)},findLastIndex(r,t){return Ql(this,"findLastIndex",r,t,void 0,arguments)},forEach(r,t){return Ql(this,"forEach",r,t,void 0,arguments)},includes(...r){return vw(this,"includes",r)},indexOf(...r){return vw(this,"indexOf",r)},join(r){return qf(this).join(r)},lastIndexOf(...r){return vw(this,"lastIndexOf",r)},map(r,t){return Ql(this,"map",r,t,void 0,arguments)},pop(){return q_(this,"pop")},push(...r){return q_(this,"push",r)},reduce(r,...t){return oI(this,"reduce",r,t)},reduceRight(r,...t){return oI(this,"reduceRight",r,t)},shift(){return q_(this,"shift")},some(r,t){return Ql(this,"some",r,t,void 0,arguments)},splice(...r){return q_(this,"splice",r)},toReversed(){return qf(this).toReversed()},toSorted(r){return qf(this).toSorted(r)},toSpliced(...r){return qf(this).toSpliced(...r)},unshift(...r){return q_(this,"unshift",r)},values(){return yw(this,"values",zs)}};function yw(r,t,l){const f=E1(r),_=f[t]();return f!==r&&!Uo(r)&&(_._next=_.next,_.next=()=>{const b=_._next();return b.value&&(b.value=l(b.value)),b}),_}const d$=Array.prototype;function Ql(r,t,l,f,_,b){const T=E1(r),n=T!==r&&!Uo(r),k=T[t];if(k!==d$[t]){const Z=k.apply(r,b);return n?zs(Z):Z}let j=l;T!==r&&(n?j=function(Z,re){return l.call(this,zs(Z),re,r)}:l.length>2&&(j=function(Z,re){return l.call(this,Z,re,r)}));const U=k.call(T,j,f);return n&&_?_(U):U}function oI(r,t,l,f){const _=E1(r);let b=l;return _!==r&&(Uo(r)?l.length>3&&(b=function(T,n,k){return l.call(this,T,n,k,r)}):b=function(T,n,k){return l.call(this,T,zs(n),k,r)}),_[t](b,...f)}function vw(r,t,l){const f=In(r);Os(f,"iterate",Tg);const _=f[t](...l);return(_===-1||_===!1)&&C1(l[0])?(l[0]=In(l[0]),f[t](...l)):_}function q_(r,t,l=[]){zu(),P2();const f=In(r)[t].apply(r,l);return R2(),ku(),f}const f$=Zo("__proto__,__v_isRef,__isVue"),Y3=new Set(Object.getOwnPropertyNames(Symbol).filter(r=>r!=="arguments"&&r!=="caller").map(r=>Symbol[r]).filter(Eo));function p$(r){Eo(r)||(r=String(r));const t=In(this);return Os(t,"has",r),t.hasOwnProperty(r)}class K3{constructor(t=!1,l=!1){this._isReadonly=t,this._isShallow=l}get(t,l,f){if(l==="__v_skip")return t.__v_skip;const _=this._isReadonly,b=this._isShallow;if(l==="__v_isReactive")return!_;if(l==="__v_isReadonly")return _;if(l==="__v_isShallow")return b;if(l==="__v_raw")return f===(_?b?nD:iD:b?tD:eD).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(f)?t:void 0;const T=vi(t);if(!_){let k;if(T&&(k=h$[l]))return k;if(l==="hasOwnProperty")return p$}const n=Reflect.get(t,l,cs(t)?t:f);return(Eo(l)?Y3.has(l):f$(l))||(_||Os(t,"get",l),b)?n:cs(n)?T&&C2(l)?n:n.value:$n(n)?_?L2(n):A1(n):n}}class J3 extends K3{constructor(t=!1){super(!1,t)}set(t,l,f,_){let b=t[l];if(!this._isShallow){const k=Iu(b);if(!Uo(f)&&!Iu(f)&&(b=In(b),f=In(f)),!vi(t)&&cs(b)&&!cs(f))return k?!1:(b.value=f,!0)}const T=vi(t)&&C2(l)?Number(l)<t.length:zn(t,l),n=Reflect.set(t,l,f,cs(t)?t:_);return t===In(_)&&(T?Js(f,b)&&sc(t,"set",l,f):sc(t,"add",l,f)),n}deleteProperty(t,l){const f=zn(t,l);t[l];const _=Reflect.deleteProperty(t,l);return _&&f&&sc(t,"delete",l,void 0),_}has(t,l){const f=Reflect.has(t,l);return(!Eo(l)||!Y3.has(l))&&Os(t,"has",l),f}ownKeys(t){return Os(t,"iterate",vi(t)?"length":od),Reflect.ownKeys(t)}}class Q3 extends K3{constructor(t=!1){super(!0,t)}set(t,l){return!0}deleteProperty(t,l){return!0}}const m$=new J3,_$=new Q3,g$=new J3(!0),y$=new Q3(!0),lT=r=>r,N0=r=>Reflect.getPrototypeOf(r);function v$(r,t,l){return function(...f){const _=this.__v_raw,b=In(_),T=ap(b),n=r==="entries"||r===Symbol.iterator&&T,k=r==="keys"&&T,j=_[r](...f),U=l?lT:t?cT:zs;return!t&&Os(b,"iterate",k?aT:od),{next(){const{value:Z,done:re}=j.next();return re?{value:Z,done:re}:{value:n?[U(Z[0]),U(Z[1])]:U(Z),done:re}},[Symbol.iterator](){return this}}}}function B0(r){return function(...t){return r==="delete"?!1:r==="clear"?void 0:this}}function x$(r,t){const l={get(_){const b=this.__v_raw,T=In(b),n=In(_);r||(Js(_,n)&&Os(T,"get",_),Os(T,"get",n));const{has:k}=N0(T),j=t?lT:r?cT:zs;if(k.call(T,_))return j(b.get(_));if(k.call(T,n))return j(b.get(n));b!==T&&b.get(_)},get size(){const _=this.__v_raw;return!r&&Os(In(_),"iterate",od),Reflect.get(_,"size",_)},has(_){const b=this.__v_raw,T=In(b),n=In(_);return r||(Js(_,n)&&Os(T,"has",_),Os(T,"has",n)),_===n?b.has(_):b.has(_)||b.has(n)},forEach(_,b){const T=this,n=T.__v_raw,k=In(n),j=t?lT:r?cT:zs;return!r&&Os(k,"iterate",od),n.forEach((U,Z)=>_.call(b,j(U),j(Z),T))}};return vn(l,r?{add:B0("add"),set:B0("set"),delete:B0("delete"),clear:B0("clear")}:{add(_){!t&&!Uo(_)&&!Iu(_)&&(_=In(_));const b=In(this);return N0(b).has.call(b,_)||(b.add(_),sc(b,"add",_,_)),this},set(_,b){!t&&!Uo(b)&&!Iu(b)&&(b=In(b));const T=In(this),{has:n,get:k}=N0(T);let j=n.call(T,_);j||(_=In(_),j=n.call(T,_));const U=k.call(T,_);return T.set(_,b),j?Js(b,U)&&sc(T,"set",_,b):sc(T,"add",_,b),this},delete(_){const b=In(this),{has:T,get:n}=N0(b);let k=T.call(b,_);k||(_=In(_),k=T.call(b,_)),n&&n.call(b,_);const j=b.delete(_);return k&&sc(b,"delete",_,void 0),j},clear(){const _=In(this),b=_.size!==0,T=_.clear();return b&&sc(_,"clear",void 0,void 0),T}}),["keys","values","entries",Symbol.iterator].forEach(_=>{l[_]=v$(_,r,t)}),l}function S1(r,t){const l=x$(r,t);return(f,_,b)=>_==="__v_isReactive"?!r:_==="__v_isReadonly"?r:_==="__v_raw"?f:Reflect.get(zn(l,_)&&_ in f?l:f,_,b)}const b$={get:S1(!1,!1)},w$={get:S1(!1,!0)},T$={get:S1(!0,!1)},E$={get:S1(!0,!0)},eD=new WeakMap,tD=new WeakMap,iD=new WeakMap,nD=new WeakMap;function S$(r){switch(r){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function A$(r){return r.__v_skip||!Object.isExtensible(r)?0:S$(kj(r))}function A1(r){return Iu(r)?r:M1(r,!1,m$,b$,eD)}function rD(r){return M1(r,!1,g$,w$,tD)}function L2(r){return M1(r,!0,_$,T$,iD)}function M$(r){return M1(r,!0,y$,E$,nD)}function M1(r,t,l,f,_){if(!$n(r)||r.__v_raw&&!(t&&r.__v_isReactive))return r;const b=_.get(r);if(b)return b;const T=A$(r);if(T===0)return r;const n=new Proxy(r,T===2?f:l);return _.set(r,n),n}function vu(r){return Iu(r)?vu(r.__v_raw):!!(r&&r.__v_isReactive)}function Iu(r){return!!(r&&r.__v_isReadonly)}function Uo(r){return!!(r&&r.__v_isShallow)}function C1(r){return r?!!r.__v_raw:!1}function In(r){const t=r&&r.__v_raw;return t?In(t):r}function sD(r){return!zn(r,"__v_skip")&&Object.isExtensible(r)&&F3(r,"__v_skip",!0),r}const zs=r=>$n(r)?A1(r):r,cT=r=>$n(r)?L2(r):r;function cs(r){return r?r.__v_isRef===!0:!1}function sg(r){return aD(r,!1)}function oD(r){return aD(r,!0)}function aD(r,t){return cs(r)?r:new C$(r,t)}class C${constructor(t,l){this.dep=new T1,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=l?t:In(t),this._value=l?t:zs(t),this.__v_isShallow=l}get value(){return this.dep.track(),this._value}set value(t){const l=this._rawValue,f=this.__v_isShallow||Uo(t)||Iu(t);t=f?t:In(t),Js(t,l)&&(this._rawValue=t,this._value=f?t:zs(t),this.dep.trigger())}}function I$(r){r.dep&&r.dep.trigger()}function I1(r){return cs(r)?r.value:r}function P$(r){return ji(r)?r():I1(r)}const R$={get:(r,t,l)=>t==="__v_raw"?r:I1(Reflect.get(r,t,l)),set:(r,t,l,f)=>{const _=r[t];return cs(_)&&!cs(l)?(_.value=l,!0):Reflect.set(r,t,l,f)}};function O2(r){return vu(r)?r:new Proxy(r,R$)}class D${constructor(t){this.__v_isRef=!0,this._value=void 0;const l=this.dep=new T1,{get:f,set:_}=t(l.track.bind(l),l.trigger.bind(l));this._get=f,this._set=_}get value(){return this._value=this._get()}set value(t){this._set(t)}}function lD(r){return new D$(r)}function L$(r){const t=vi(r)?new Array(r.length):{};for(const l in r)t[l]=cD(r,l);return t}class O${constructor(t,l,f){this._object=t,this._key=l,this._defaultValue=f,this.__v_isRef=!0,this._value=void 0}get value(){const t=this._object[this._key];return this._value=t===void 0?this._defaultValue:t}set value(t){this._object[this._key]=t}get dep(){return u$(In(this._object),this._key)}}class z${constructor(t){this._getter=t,this.__v_isRef=!0,this.__v_isReadonly=!0,this._value=void 0}get value(){return this._value=this._getter()}}function k$(r,t,l){return cs(r)?r:ji(r)?new z$(r):$n(r)&&arguments.length>1?cD(r,t,l):sg(r)}function cD(r,t,l){const f=r[t];return cs(f)?f:new O$(r,t,l)}class F${constructor(t,l,f){this.fn=t,this.setter=l,this._value=void 0,this.dep=new T1(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=wg-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!l,this.isSSR=f}notify(){if(this.flags|=16,!(this.flags&8)&&rr!==this)return q3(this,!0),!0}get value(){const t=this.dep.track();return W3(this),t&&(t.version=this.dep.version),this._value}set value(t){this.setter&&this.setter(t)}}function N$(r,t,l=!1){let f,_;return ji(r)?f=r:(f=r.get,_=r.set),new F$(f,_,l)}const B$={GET:"get",HAS:"has",ITERATE:"iterate"},V$={SET:"set",ADD:"add",DELETE:"delete",CLEAR:"clear"},V0={},Lv=new WeakMap;let lu;function U$(){return lu}function uD(r,t=!1,l=lu){if(l){let f=Lv.get(l);f||Lv.set(l,f=[]),f.push(r)}}function j$(r,t,l=yn){const{immediate:f,deep:_,once:b,scheduler:T,augmentJob:n,call:k}=l,j=me=>_?me:Uo(me)||_===!1||_===0?oc(me,1):oc(me);let U,Z,re,se,ue=!1,ne=!1;if(cs(r)?(Z=()=>r.value,ue=Uo(r)):vu(r)?(Z=()=>j(r),ue=!0):vi(r)?(ne=!0,ue=r.some(me=>vu(me)||Uo(me)),Z=()=>r.map(me=>{if(cs(me))return me.value;if(vu(me))return j(me);if(ji(me))return k?k(me,2):me()})):ji(r)?t?Z=k?()=>k(r,2):r:Z=()=>{if(re){zu();try{re()}finally{ku()}}const me=lu;lu=U;try{return k?k(r,3,[se]):r(se)}finally{lu=me}}:Z=_s,t&&_){const me=Z,Ie=_===!0?1/0:_;Z=()=>oc(me(),Ie)}const be=j3(),De=()=>{U.stop(),be&&be.active&&A2(be.effects,U)};if(b&&t){const me=t;t=(...Ie)=>{me(...Ie),De()}}let Be=ne?new Array(r.length).fill(V0):V0;const Te=me=>{if(!(!(U.flags&1)||!U.dirty&&!me))if(t){const Ie=U.run();if(_||ue||(ne?Ie.some((Xe,je)=>Js(Xe,Be[je])):Js(Ie,Be))){re&&re();const Xe=lu;lu=U;try{const je=[Ie,Be===V0?void 0:ne&&Be[0]===V0?[]:Be,se];k?k(t,3,je):t(...je),Be=Ie}finally{lu=Xe}}}else U.run()};return n&&n(Te),U=new bg(Z),U.scheduler=T?()=>T(Te,!1):Te,se=me=>uD(me,!1,U),re=U.onStop=()=>{const me=Lv.get(U);if(me){if(k)k(me,4);else for(const Ie of me)Ie();Lv.delete(U)}},t?f?Te(!0):Be=U.run():T?T(Te.bind(null,!0),!0):U.run(),De.pause=U.pause.bind(U),De.resume=U.resume.bind(U),De.stop=De,De}function oc(r,t=1/0,l){if(t<=0||!$n(r)||r.__v_skip||(l=l||new Set,l.has(r)))return r;if(l.add(r),t--,cs(r))oc(r.value,t,l);else if(vi(r))for(let f=0;f<r.length;f++)oc(r[f],t,l);else if(Sd(r)||ap(r))r.forEach(f=>{oc(f,t,l)});else if(v1(r)){for(const f in r)oc(r[f],t,l);for(const f of Object.getOwnPropertySymbols(r))Object.prototype.propertyIsEnumerable.call(r,f)&&oc(r[f],t,l)}return r}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const hD=[];function $$(r){hD.push(r)}function q$(){hD.pop()}function H$(r,t){}const G$={SETUP_FUNCTION:0,0:"SETUP_FUNCTION",RENDER_FUNCTION:1,1:"RENDER_FUNCTION",NATIVE_EVENT_HANDLER:5,5:"NATIVE_EVENT_HANDLER",COMPONENT_EVENT_HANDLER:6,6:"COMPONENT_EVENT_HANDLER",VNODE_HOOK:7,7:"VNODE_HOOK",DIRECTIVE_HOOK:8,8:"DIRECTIVE_HOOK",TRANSITION_HOOK:9,9:"TRANSITION_HOOK",APP_ERROR_HANDLER:10,10:"APP_ERROR_HANDLER",APP_WARN_HANDLER:11,11:"APP_WARN_HANDLER",FUNCTION_REF:12,12:"FUNCTION_REF",ASYNC_COMPONENT_LOADER:13,13:"ASYNC_COMPONENT_LOADER",SCHEDULER:14,14:"SCHEDULER",COMPONENT_UPDATE:15,15:"COMPONENT_UPDATE",APP_UNMOUNT_CLEANUP:16,16:"APP_UNMOUNT_CLEANUP"},W$={sp:"serverPrefetch hook",bc:"beforeCreate hook",c:"created hook",bm:"beforeMount hook",m:"mounted hook",bu:"beforeUpdate hook",u:"updated",bum:"beforeUnmount hook",um:"unmounted hook",a:"activated hook",da:"deactivated hook",ec:"errorCaptured hook",rtc:"renderTracked hook",rtg:"renderTriggered hook",0:"setup function",1:"render function",2:"watcher getter",3:"watcher callback",4:"watcher cleanup function",5:"native event handler",6:"component event handler",7:"vnode hook",8:"directive hook",9:"transition hook",10:"app errorHandler",11:"app warnHandler",12:"ref function",13:"async component loader",14:"scheduler flush",15:"component update",16:"app unmount cleanup function"};function Vp(r,t,l,f){try{return f?r(...f):r()}catch(_){Md(_,t,l)}}function Ea(r,t,l,f){if(ji(r)){const _=Vp(r,t,l,f);return _&&M2(_)&&_.catch(b=>{Md(b,t,l)}),_}if(vi(r)){const _=[];for(let b=0;b<r.length;b++)_.push(Ea(r[b],t,l,f));return _}}function Md(r,t,l,f=!0){const _=t?t.vnode:null,{errorHandler:b,throwUnhandledErrorInProduction:T}=t&&t.appContext.config||yn;if(t){let n=t.parent;const k=t.proxy,j=`https://vuejs.org/error-reference/#runtime-${l}`;for(;n;){const U=n.ec;if(U){for(let Z=0;Z<U.length;Z++)if(U[Z](r,k,j)===!1)return}n=n.parent}if(b){zu(),Vp(b,null,10,[r,k,j]),ku();return}}Z$(r,l,_,f,T)}function Z$(r,t,l,f=!0,_=!1){if(_)throw r;console.error(r)}const Qs=[];let gl=-1;const up=[];let cu=null,Kf=0;const dD=Promise.resolve();let Ov=null;function P1(r){const t=Ov||dD;return r?t.then(this?r.bind(this):r):t}function X$(r){let t=gl+1,l=Qs.length;for(;t<l;){const f=t+l>>>1,_=Qs[f],b=Sg(_);b<r||b===r&&_.flags&2?t=f+1:l=f}return t}function z2(r){if(!(r.flags&1)){const t=Sg(r),l=Qs[Qs.length-1];!l||!(r.flags&2)&&t>=Sg(l)?Qs.push(r):Qs.splice(X$(t),0,r),r.flags|=1,fD()}}function fD(){Ov||(Ov=dD.then(pD))}function Eg(r){vi(r)?up.push(...r):cu&&r.id===-1?cu.splice(Kf+1,0,r):r.flags&1||(up.push(r),r.flags|=1),fD()}function aI(r,t,l=gl+1){for(;l<Qs.length;l++){const f=Qs[l];if(f&&f.flags&2){if(r&&f.id!==r.uid)continue;Qs.splice(l,1),l--,f.flags&4&&(f.flags&=-2),f(),f.flags&4||(f.flags&=-2)}}}function zv(r){if(up.length){const t=[...new Set(up)].sort((l,f)=>Sg(l)-Sg(f));if(up.length=0,cu){cu.push(...t);return}for(cu=t,Kf=0;Kf<cu.length;Kf++){const l=cu[Kf];l.flags&4&&(l.flags&=-2),l.flags&8||l(),l.flags&=-2}cu=null,Kf=0}}const Sg=r=>r.id==null?r.flags&2?-1:1/0:r.id;function pD(r){const t=_s;try{for(gl=0;gl<Qs.length;gl++){const l=Qs[gl];l&&!(l.flags&8)&&(l.flags&4&&(l.flags&=-2),Vp(l,l.i,l.i?15:14),l.flags&4||(l.flags&=-2))}}finally{for(;gl<Qs.length;gl++){const l=Qs[gl];l&&(l.flags&=-2)}gl=-1,Qs.length=0,zv(),Ov=null,(Qs.length||up.length)&&pD()}}let Jf,U0=[];function mD(r,t){var l,f;Jf=r,Jf?(Jf.enabled=!0,U0.forEach(({event:_,args:b})=>Jf.emit(_,...b)),U0=[]):typeof window<"u"&&window.HTMLElement&&!((f=(l=window.navigator)==null?void 0:l.userAgent)!=null&&f.includes("jsdom"))?((t.__VUE_DEVTOOLS_HOOK_REPLAY__=t.__VUE_DEVTOOLS_HOOK_REPLAY__||[]).push(b=>{mD(b,t)}),setTimeout(()=>{Jf||(t.__VUE_DEVTOOLS_HOOK_REPLAY__=null,U0=[])},3e3)):U0=[]}let ls=null,R1=null;function Ag(r){const t=ls;return ls=r,R1=r&&r.type.__scopeId||null,t}function Y$(r){R1=r}function K$(){R1=null}const J$=r=>k2;function k2(r,t=ls,l){if(!t||r._n)return r;const f=(..._)=>{f._d&&gT(-1);const b=Ag(t);let T;try{T=r(..._)}finally{Ag(b),f._d&&gT(1)}return T};return f._n=!0,f._c=!0,f._d=!0,f}function fn(r,t){if(ls===null)return r;const l=Gg(ls),f=r.dirs||(r.dirs=[]);for(let _=0;_<t.length;_++){let[b,T,n,k=yn]=t[_];b&&(ji(b)&&(b={mounted:b,updated:b}),b.deep&&oc(T),f.push({dir:b,instance:l,value:T,oldValue:void 0,arg:n,modifiers:k}))}return r}function vl(r,t,l,f){const _=r.dirs,b=t&&t.dirs;for(let T=0;T<_.length;T++){const n=_[T];b&&(n.oldValue=b[T].value);let k=n.dir[f];k&&(zu(),Ea(k,l,8,[r.el,n,r,t]),ku())}}const _D=Symbol("_vte"),gD=r=>r.__isTeleport,og=r=>r&&(r.disabled||r.disabled===""),lI=r=>r&&(r.defer||r.defer===""),cI=r=>typeof SVGElement<"u"&&r instanceof SVGElement,uI=r=>typeof MathMLElement=="function"&&r instanceof MathMLElement,uT=(r,t)=>{const l=r&&r.to;return nn(l)?t?t(l):null:l},yD={name:"Teleport",__isTeleport:!0,process(r,t,l,f,_,b,T,n,k,j){const{mc:U,pc:Z,pbc:re,o:{insert:se,querySelector:ue,createText:ne,createComment:be}}=j,De=og(t.props);let{shapeFlag:Be,children:Te,dynamicChildren:me}=t;if(r==null){const Ie=t.el=ne(""),Xe=t.anchor=ne("");se(Ie,l,f),se(Xe,l,f);const je=(Ve,He)=>{Be&16&&(_&&_.isCE&&(_.ce._teleportTarget=Ve),U(Te,Ve,He,_,b,T,n,k))},rt=()=>{const Ve=t.target=uT(t.props,ue),He=vD(Ve,t,ne,se);Ve&&(T!=="svg"&&cI(Ve)?T="svg":T!=="mathml"&&uI(Ve)&&(T="mathml"),De||(je(Ve,He),lv(t,!1)))};De&&(je(l,Xe),lv(t,!0)),lI(t.props)?ss(()=>{rt(),t.el.__isMounted=!0},b):rt()}else{if(lI(t.props)&&!r.el.__isMounted){ss(()=>{yD.process(r,t,l,f,_,b,T,n,k,j),delete r.el.__isMounted},b);return}t.el=r.el,t.targetStart=r.targetStart;const Ie=t.anchor=r.anchor,Xe=t.target=r.target,je=t.targetAnchor=r.targetAnchor,rt=og(r.props),Ve=rt?l:Xe,He=rt?Ie:je;if(T==="svg"||cI(Xe)?T="svg":(T==="mathml"||uI(Xe))&&(T="mathml"),me?(re(r.dynamicChildren,me,Ve,_,b,T,n),W2(r,t,!0)):k||Z(r,t,Ve,He,_,b,T,n,!1),De)rt?t.props&&r.props&&t.props.to!==r.props.to&&(t.props.to=r.props.to):j0(t,l,Ie,j,1);else if((t.props&&t.props.to)!==(r.props&&r.props.to)){const st=t.target=uT(t.props,ue);st&&j0(t,st,null,j,0)}else rt&&j0(t,Xe,je,j,1);lv(t,De)}},remove(r,t,l,{um:f,o:{remove:_}},b){const{shapeFlag:T,children:n,anchor:k,targetStart:j,targetAnchor:U,target:Z,props:re}=r;if(Z&&(_(j),_(U)),b&&_(k),T&16){const se=b||!og(re);for(let ue=0;ue<n.length;ue++){const ne=n[ue];f(ne,t,l,se,!!ne.dynamicChildren)}}},move:j0,hydrate:Q$};function j0(r,t,l,{o:{insert:f},m:_},b=2){b===0&&f(r.targetAnchor,t,l);const{el:T,anchor:n,shapeFlag:k,children:j,props:U}=r,Z=b===2;if(Z&&f(T,t,l),(!Z||og(U))&&k&16)for(let re=0;re<j.length;re++)_(j[re],t,l,2);Z&&f(n,t,l)}function Q$(r,t,l,f,_,b,{o:{nextSibling:T,parentNode:n,querySelector:k,insert:j,createText:U}},Z){const re=t.target=uT(t.props,k);if(re){const se=og(t.props),ue=re._lpa||re.firstChild;if(t.shapeFlag&16)if(se)t.anchor=Z(T(r),t,n(r),l,f,_,b),t.targetStart=ue,t.targetAnchor=ue&&T(ue);else{t.anchor=T(r);let ne=ue;for(;ne;){if(ne&&ne.nodeType===8){if(ne.data==="teleport start anchor")t.targetStart=ne;else if(ne.data==="teleport anchor"){t.targetAnchor=ne,re._lpa=t.targetAnchor&&T(t.targetAnchor);break}}ne=T(ne)}t.targetAnchor||vD(re,t,U,j),Z(ue&&T(ue),t,re,l,f,_,b)}lv(t,se)}return t.anchor&&T(t.anchor)}const e8=yD;function lv(r,t){const l=r.ctx;if(l&&l.ut){let f,_;for(t?(f=r.el,_=r.anchor):(f=r.targetStart,_=r.targetAnchor);f&&f!==_;)f.nodeType===1&&f.setAttribute("data-v-owner",l.uid),f=f.nextSibling;l.ut()}}function vD(r,t,l,f){const _=t.targetStart=l(""),b=t.targetAnchor=l("");return _[_D]=b,r&&(f(_,r),f(b,r)),b}const uu=Symbol("_leaveCb"),$0=Symbol("_enterCb");function F2(){const r={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return qg(()=>{r.isMounted=!0}),z1(()=>{r.isUnmounting=!0}),r}const pa=[Function,Array],N2={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:pa,onEnter:pa,onAfterEnter:pa,onEnterCancelled:pa,onBeforeLeave:pa,onLeave:pa,onAfterLeave:pa,onLeaveCancelled:pa,onBeforeAppear:pa,onAppear:pa,onAfterAppear:pa,onAppearCancelled:pa},xD=r=>{const t=r.subTree;return t.component?xD(t.component):t},t8={name:"BaseTransition",props:N2,setup(r,{slots:t}){const l=Aa(),f=F2();return()=>{const _=t.default&&D1(t.default(),!0);if(!_||!_.length)return;const b=bD(_),T=In(r),{mode:n}=T;if(f.isLeaving)return xw(b);const k=hI(b);if(!k)return xw(b);let j=Sp(k,T,f,l,Z=>j=Z);k.type!==Xr&&pc(k,j);let U=l.subTree&&hI(l.subTree);if(U&&U.type!==Xr&&!Ga(k,U)&&xD(l).type!==Xr){let Z=Sp(U,T,f,l);if(pc(U,Z),n==="out-in"&&k.type!==Xr)return f.isLeaving=!0,Z.afterLeave=()=>{f.isLeaving=!1,l.job.flags&8||l.update(),delete Z.afterLeave,U=void 0},xw(b);n==="in-out"&&k.type!==Xr?Z.delayLeave=(re,se,ue)=>{const ne=TD(f,U);ne[String(U.key)]=U,re[uu]=()=>{se(),re[uu]=void 0,delete j.delayedLeave,U=void 0},j.delayedLeave=()=>{ue(),delete j.delayedLeave,U=void 0}}:U=void 0}else U&&(U=void 0);return b}}};function bD(r){let t=r[0];if(r.length>1){for(const l of r)if(l.type!==Xr){t=l;break}}return t}const wD=t8;function TD(r,t){const{leavingVNodes:l}=r;let f=l.get(t.type);return f||(f=Object.create(null),l.set(t.type,f)),f}function Sp(r,t,l,f,_){const{appear:b,mode:T,persisted:n=!1,onBeforeEnter:k,onEnter:j,onAfterEnter:U,onEnterCancelled:Z,onBeforeLeave:re,onLeave:se,onAfterLeave:ue,onLeaveCancelled:ne,onBeforeAppear:be,onAppear:De,onAfterAppear:Be,onAppearCancelled:Te}=t,me=String(r.key),Ie=TD(l,r),Xe=(Ve,He)=>{Ve&&Ea(Ve,f,9,He)},je=(Ve,He)=>{const st=He[1];Xe(Ve,He),vi(Ve)?Ve.every(dt=>dt.length<=1)&&st():Ve.length<=1&&st()},rt={mode:T,persisted:n,beforeEnter(Ve){let He=k;if(!l.isMounted)if(b)He=be||k;else return;Ve[uu]&&Ve[uu](!0);const st=Ie[me];st&&Ga(r,st)&&st.el[uu]&&st.el[uu](),Xe(He,[Ve])},enter(Ve){let He=j,st=U,dt=Z;if(!l.isMounted)if(b)He=De||j,st=Be||U,dt=Te||Z;else return;let At=!1;const ni=Ve[$0]=Tt=>{At||(At=!0,Tt?Xe(dt,[Ve]):Xe(st,[Ve]),rt.delayedLeave&&rt.delayedLeave(),Ve[$0]=void 0)};He?je(He,[Ve,ni]):ni()},leave(Ve,He){const st=String(r.key);if(Ve[$0]&&Ve[$0](!0),l.isUnmounting)return He();Xe(re,[Ve]);let dt=!1;const At=Ve[uu]=ni=>{dt||(dt=!0,He(),ni?Xe(ne,[Ve]):Xe(ue,[Ve]),Ve[uu]=void 0,Ie[st]===r&&delete Ie[st])};Ie[st]=r,se?je(se,[Ve,At]):At()},clone(Ve){const He=Sp(Ve,t,l,f,_);return _&&_(He),He}};return rt}function xw(r){if($g(r))return r=Cl(r),r.children=null,r}function hI(r){if(!$g(r))return gD(r.type)&&r.children?bD(r.children):r;const{shapeFlag:t,children:l}=r;if(l){if(t&16)return l[0];if(t&32&&ji(l.default))return l.default()}}function pc(r,t){r.shapeFlag&6&&r.component?(r.transition=t,pc(r.component.subTree,t)):r.shapeFlag&128?(r.ssContent.transition=t.clone(r.ssContent),r.ssFallback.transition=t.clone(r.ssFallback)):r.transition=t}function D1(r,t=!1,l){let f=[],_=0;for(let b=0;b<r.length;b++){let T=r[b];const n=l==null?T.key:String(l)+String(T.key!=null?T.key:b);T.type===Oi?(T.patchFlag&128&&_++,f=f.concat(D1(T.children,t,n))):(t||T.type!==Xr)&&f.push(n!=null?Cl(T,{key:n}):T)}if(_>1)for(let b=0;b<f.length;b++)f[b].patchFlag=-2;return f}/*! #__NO_SIDE_EFFECTS__ */function B2(r,t){return ji(r)?(()=>vn({name:r.name},t,{setup:r}))():r}function i8(){const r=Aa();return r?(r.appContext.config.idPrefix||"v")+"-"+r.ids[0]+r.ids[1]++:""}function V2(r){r.ids=[r.ids[0]+r.ids[2]+++"-",0,0]}function n8(r){const t=Aa(),l=oD(null);if(t){const _=t.refs===yn?t.refs={}:t.refs;Object.defineProperty(_,r,{enumerable:!0,get:()=>l.value,set:b=>l.value=b})}return l}function Mg(r,t,l,f,_=!1){if(vi(r)){r.forEach((ue,ne)=>Mg(ue,t&&(vi(t)?t[ne]:t),l,f,_));return}if(xu(f)&&!_){f.shapeFlag&512&&f.type.__asyncResolved&&f.component.subTree.component&&Mg(r,t,l,f.component.subTree);return}const b=f.shapeFlag&4?Gg(f.component):f.el,T=_?null:b,{i:n,r:k}=r,j=t&&t.r,U=n.refs===yn?n.refs={}:n.refs,Z=n.setupState,re=In(Z),se=Z===yn?()=>!1:ue=>zn(re,ue);if(j!=null&&j!==k&&(nn(j)?(U[j]=null,se(j)&&(Z[j]=null)):cs(j)&&(j.value=null)),ji(k))Vp(k,n,12,[T,U]);else{const ue=nn(k),ne=cs(k);if(ue||ne){const be=()=>{if(r.f){const De=ue?se(k)?Z[k]:U[k]:k.value;_?vi(De)&&A2(De,b):vi(De)?De.includes(b)||De.push(b):ue?(U[k]=[b],se(k)&&(Z[k]=U[k])):(k.value=[b],r.k&&(U[r.k]=k.value))}else ue?(U[k]=T,se(k)&&(Z[k]=T)):ne&&(k.value=T,r.k&&(U[r.k]=T))};T?(be.id=-1,ss(be,l)):be()}}}let dI=!1;const Hf=()=>{dI||(console.error("Hydration completed but contains mismatches."),dI=!0)},r8=r=>r.namespaceURI.includes("svg")&&r.tagName!=="foreignObject",s8=r=>r.namespaceURI.includes("MathML"),q0=r=>{if(r.nodeType===1){if(r8(r))return"svg";if(s8(r))return"mathml"}},ip=r=>r.nodeType===8;function o8(r){const{mt:t,p:l,o:{patchProp:f,createText:_,nextSibling:b,parentNode:T,remove:n,insert:k,createComment:j}}=r,U=(Te,me)=>{if(!me.hasChildNodes()){l(null,Te,me),zv(),me._vnode=Te;return}Z(me.firstChild,Te,null,null,null),zv(),me._vnode=Te},Z=(Te,me,Ie,Xe,je,rt=!1)=>{rt=rt||!!me.dynamicChildren;const Ve=ip(Te)&&Te.data==="[",He=()=>ne(Te,me,Ie,Xe,je,Ve),{type:st,ref:dt,shapeFlag:At,patchFlag:ni}=me;let Tt=Te.nodeType;me.el=Te,ni===-2&&(rt=!1,me.dynamicChildren=null);let kt=null;switch(st){case bu:Tt!==3?me.children===""?(k(me.el=_(""),T(Te),Te),kt=Te):kt=He():(Te.data!==me.children&&(Hf(),Te.data=me.children),kt=b(Te));break;case Xr:Be(Te)?(kt=b(Te),De(me.el=Te.content.firstChild,Te,Ie)):Tt!==8||Ve?kt=He():kt=b(Te);break;case ld:if(Ve&&(Te=b(Te),Tt=Te.nodeType),Tt===1||Tt===3){kt=Te;const ti=!me.children.length;for(let li=0;li<me.staticCount;li++)ti&&(me.children+=kt.nodeType===1?kt.outerHTML:kt.data),li===me.staticCount-1&&(me.anchor=kt),kt=b(kt);return Ve?b(kt):kt}else He();break;case Oi:Ve?kt=ue(Te,me,Ie,Xe,je,rt):kt=He();break;default:if(At&1)(Tt!==1||me.type.toLowerCase()!==Te.tagName.toLowerCase())&&!Be(Te)?kt=He():kt=re(Te,me,Ie,Xe,je,rt);else if(At&6){me.slotScopeIds=je;const ti=T(Te);if(Ve?kt=be(Te):ip(Te)&&Te.data==="teleport start"?kt=be(Te,Te.data,"teleport end"):kt=b(Te),t(me,ti,null,Ie,Xe,q0(ti),rt),xu(me)&&!me.type.__asyncResolved){let li;Ve?(li=ur(Oi),li.anchor=kt?kt.previousSibling:ti.lastChild):li=Te.nodeType===3?us(""):ur("div"),li.el=Te,me.component.subTree=li}}else At&64?Tt!==8?kt=He():kt=me.type.hydrate(Te,me,Ie,Xe,je,rt,r,se):At&128&&(kt=me.type.hydrate(Te,me,Ie,Xe,q0(T(Te)),je,rt,r,Z))}return dt!=null&&Mg(dt,null,Xe,me),kt},re=(Te,me,Ie,Xe,je,rt)=>{rt=rt||!!me.dynamicChildren;const{type:Ve,props:He,patchFlag:st,shapeFlag:dt,dirs:At,transition:ni}=me,Tt=Ve==="input"||Ve==="option";if(Tt||st!==-1){At&&vl(me,null,Ie,"created");let kt=!1;if(Be(Te)){kt=XD(null,ni)&&Ie&&Ie.vnode.props&&Ie.vnode.props.appear;const li=Te.content.firstChild;kt&&ni.beforeEnter(li),De(li,Te,Ie),me.el=Te=li}if(dt&16&&!(He&&(He.innerHTML||He.textContent))){let li=se(Te.firstChild,me,Te,Ie,Xe,je,rt);for(;li;){H0(Te,1)||Hf();const ii=li;li=li.nextSibling,n(ii)}}else if(dt&8){let li=me.children;li[0]===`
`&&(Te.tagName==="PRE"||Te.tagName==="TEXTAREA")&&(li=li.slice(1)),Te.textContent!==li&&(H0(Te,0)||Hf(),Te.textContent=me.children)}if(He){if(Tt||!rt||st&48){const li=Te.tagName.includes("-");for(const ii in He)(Tt&&(ii.endsWith("value")||ii==="indeterminate")||Ed(ii)&&!yu(ii)||ii[0]==="."||li)&&f(Te,ii,null,He[ii],void 0,Ie)}else if(He.onClick)f(Te,"onClick",null,He.onClick,void 0,Ie);else if(st&4&&vu(He.style))for(const li in He.style)He.style[li]}let ti;(ti=He&&He.onVnodeBeforeMount)&&po(ti,Ie,me),At&&vl(me,null,Ie,"beforeMount"),((ti=He&&He.onVnodeMounted)||At||kt)&&rL(()=>{ti&&po(ti,Ie,me),kt&&ni.enter(Te),At&&vl(me,null,Ie,"mounted")},Xe)}return Te.nextSibling},se=(Te,me,Ie,Xe,je,rt,Ve)=>{Ve=Ve||!!me.dynamicChildren;const He=me.children,st=He.length;for(let dt=0;dt<st;dt++){const At=Ve?He[dt]:He[dt]=mo(He[dt]),ni=At.type===bu;Te?(ni&&!Ve&&dt+1<st&&mo(He[dt+1]).type===bu&&(k(_(Te.data.slice(At.children.length)),Ie,b(Te)),Te.data=At.children),Te=Z(Te,At,Xe,je,rt,Ve)):ni&&!At.children?k(At.el=_(""),Ie):(H0(Ie,1)||Hf(),l(null,At,Ie,null,Xe,je,q0(Ie),rt))}return Te},ue=(Te,me,Ie,Xe,je,rt)=>{const{slotScopeIds:Ve}=me;Ve&&(je=je?je.concat(Ve):Ve);const He=T(Te),st=se(b(Te),me,He,Ie,Xe,je,rt);return st&&ip(st)&&st.data==="]"?b(me.anchor=st):(Hf(),k(me.anchor=j("]"),He,st),st)},ne=(Te,me,Ie,Xe,je,rt)=>{if(H0(Te.parentElement,1)||Hf(),me.el=null,rt){const st=be(Te);for(;;){const dt=b(Te);if(dt&&dt!==st)n(dt);else break}}const Ve=b(Te),He=T(Te);return n(Te),l(null,me,He,Ve,Ie,Xe,q0(He),je),Ie&&(Ie.vnode.el=me.el,N1(Ie,me.el)),Ve},be=(Te,me="[",Ie="]")=>{let Xe=0;for(;Te;)if(Te=b(Te),Te&&ip(Te)&&(Te.data===me&&Xe++,Te.data===Ie)){if(Xe===0)return b(Te);Xe--}return Te},De=(Te,me,Ie)=>{const Xe=me.parentNode;Xe&&Xe.replaceChild(Te,me);let je=Ie;for(;je;)je.vnode.el===me&&(je.vnode.el=je.subTree.el=Te),je=je.parent},Be=Te=>Te.nodeType===1&&Te.tagName==="TEMPLATE";return[U,Z]}const fI="data-allow-mismatch",a8={0:"text",1:"children",2:"class",3:"style",4:"attribute"};function H0(r,t){if(t===0||t===1)for(;r&&!r.hasAttribute(fI);)r=r.parentElement;const l=r&&r.getAttribute(fI);if(l==null)return!1;if(l==="")return!0;{const f=l.split(",");return t===0&&f.includes("children")?!0:l.split(",").includes(a8[t])}}const l8=b1().requestIdleCallback||(r=>setTimeout(r,1)),c8=b1().cancelIdleCallback||(r=>clearTimeout(r)),u8=(r=1e4)=>t=>{const l=l8(t,{timeout:r});return()=>c8(l)};function h8(r){const{top:t,left:l,bottom:f,right:_}=r.getBoundingClientRect(),{innerHeight:b,innerWidth:T}=window;return(t>0&&t<b||f>0&&f<b)&&(l>0&&l<T||_>0&&_<T)}const d8=r=>(t,l)=>{const f=new IntersectionObserver(_=>{for(const b of _)if(b.isIntersecting){f.disconnect(),t();break}},r);return l(_=>{if(_ instanceof Element){if(h8(_))return t(),f.disconnect(),!1;f.observe(_)}}),()=>f.disconnect()},f8=r=>t=>{if(r){const l=matchMedia(r);if(l.matches)t();else return l.addEventListener("change",t,{once:!0}),()=>l.removeEventListener("change",t)}},p8=(r=[])=>(t,l)=>{nn(r)&&(r=[r]);let f=!1;const _=T=>{f||(f=!0,b(),t(),T.target.dispatchEvent(new T.constructor(T.type,T)))},b=()=>{l(T=>{for(const n of r)T.removeEventListener(n,_)})};return l(T=>{for(const n of r)T.addEventListener(n,_,{once:!0})}),b};function m8(r,t){if(ip(r)&&r.data==="["){let l=1,f=r.nextSibling;for(;f;){if(f.nodeType===1){if(t(f)===!1)break}else if(ip(f))if(f.data==="]"){if(--l===0)break}else f.data==="["&&l++;f=f.nextSibling}}else t(r)}const xu=r=>!!r.type.__asyncLoader;/*! #__NO_SIDE_EFFECTS__ */function _8(r){ji(r)&&(r={loader:r});const{loader:t,loadingComponent:l,errorComponent:f,delay:_=200,hydrate:b,timeout:T,suspensible:n=!0,onError:k}=r;let j=null,U,Z=0;const re=()=>(Z++,j=null,se()),se=()=>{let ue;return j||(ue=j=t().catch(ne=>{if(ne=ne instanceof Error?ne:new Error(String(ne)),k)return new Promise((be,De)=>{k(ne,()=>be(re()),()=>De(ne),Z+1)});throw ne}).then(ne=>ue!==j&&j?j:(ne&&(ne.__esModule||ne[Symbol.toStringTag]==="Module")&&(ne=ne.default),U=ne,ne)))};return B2({name:"AsyncComponentWrapper",__asyncLoader:se,__asyncHydrate(ue,ne,be){const De=b?()=>{const Be=b(be,Te=>m8(ue,Te));Be&&(ne.bum||(ne.bum=[])).push(Be)}:be;U?De():se().then(()=>!ne.isUnmounted&&De())},get __asyncResolved(){return U},setup(){const ue=as;if(V2(ue),U)return()=>bw(U,ue);const ne=Te=>{j=null,Md(Te,ue,13,!f)};if(n&&ue.suspense||Ap)return se().then(Te=>()=>bw(Te,ue)).catch(Te=>(ne(Te),()=>f?ur(f,{error:Te}):null));const be=sg(!1),De=sg(),Be=sg(!!_);return _&&setTimeout(()=>{Be.value=!1},_),T!=null&&setTimeout(()=>{if(!be.value&&!De.value){const Te=new Error(`Async component timed out after ${T}ms.`);ne(Te),De.value=Te}},T),se().then(()=>{be.value=!0,ue.parent&&$g(ue.parent.vnode)&&ue.parent.update()}).catch(Te=>{ne(Te),De.value=Te}),()=>{if(be.value&&U)return bw(U,ue);if(De.value&&f)return ur(f,{error:De.value});if(l&&!Be.value)return ur(l)}}})}function bw(r,t){const{ref:l,props:f,children:_,ce:b}=t.vnode,T=ur(r,f,_);return T.ref=l,T.ce=b,delete t.vnode.ce,T}const $g=r=>r.type.__isKeepAlive,g8={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(r,{slots:t}){const l=Aa(),f=l.ctx;if(!f.renderer)return()=>{const Be=t.default&&t.default();return Be&&Be.length===1?Be[0]:Be};const _=new Map,b=new Set;let T=null;const n=l.suspense,{renderer:{p:k,m:j,um:U,o:{createElement:Z}}}=f,re=Z("div");f.activate=(Be,Te,me,Ie,Xe)=>{const je=Be.component;j(Be,Te,me,0,n),k(je.vnode,Be,Te,me,je,n,Ie,Be.slotScopeIds,Xe),ss(()=>{je.isDeactivated=!1,je.a&&cp(je.a);const rt=Be.props&&Be.props.onVnodeMounted;rt&&po(rt,je.parent,Be)},n)},f.deactivate=Be=>{const Te=Be.component;Fv(Te.m),Fv(Te.a),j(Be,re,null,1,n),ss(()=>{Te.da&&cp(Te.da);const me=Be.props&&Be.props.onVnodeUnmounted;me&&po(me,Te.parent,Be),Te.isDeactivated=!0},n)};function se(Be){ww(Be),U(Be,l,n,!0)}function ue(Be){_.forEach((Te,me)=>{const Ie=wT(Te.type);Ie&&!Be(Ie)&&ne(me)})}function ne(Be){const Te=_.get(Be);Te&&(!T||!Ga(Te,T))?se(Te):T&&ww(T),_.delete(Be),b.delete(Be)}hp(()=>[r.include,r.exclude],([Be,Te])=>{Be&&ue(me=>Y_(Be,me)),Te&&ue(me=>!Y_(Te,me))},{flush:"post",deep:!0});let be=null;const De=()=>{be!=null&&(Nv(l.subTree.type)?ss(()=>{_.set(be,G0(l.subTree))},l.subTree.suspense):_.set(be,G0(l.subTree)))};return qg(De),O1(De),z1(()=>{_.forEach(Be=>{const{subTree:Te,suspense:me}=l,Ie=G0(Te);if(Be.type===Ie.type&&Be.key===Ie.key){ww(Ie);const Xe=Ie.component.da;Xe&&ss(Xe,me);return}se(Be)})}),()=>{if(be=null,!t.default)return T=null;const Be=t.default(),Te=Be[0];if(Be.length>1)return T=null,Be;if(!mc(Te)||!(Te.shapeFlag&4)&&!(Te.shapeFlag&128))return T=null,Te;let me=G0(Te);if(me.type===Xr)return T=null,me;const Ie=me.type,Xe=wT(xu(me)?me.type.__asyncResolved||{}:Ie),{include:je,exclude:rt,max:Ve}=r;if(je&&(!Xe||!Y_(je,Xe))||rt&&Xe&&Y_(rt,Xe))return me.shapeFlag&=-257,T=me,Te;const He=me.key==null?Ie:me.key,st=_.get(He);return me.el&&(me=Cl(me),Te.shapeFlag&128&&(Te.ssContent=me)),be=He,st?(me.el=st.el,me.component=st.component,me.transition&&pc(me,me.transition),me.shapeFlag|=512,b.delete(He),b.add(He)):(b.add(He),Ve&&b.size>parseInt(Ve,10)&&ne(b.values().next().value)),me.shapeFlag|=256,T=me,Nv(Te.type)?Te:me}}},y8=g8;function Y_(r,t){return vi(r)?r.some(l=>Y_(l,t)):nn(r)?r.split(",").includes(t):zj(r)?(r.lastIndex=0,r.test(t)):!1}function ED(r,t){AD(r,"a",t)}function SD(r,t){AD(r,"da",t)}function AD(r,t,l=as){const f=r.__wdc||(r.__wdc=()=>{let _=l;for(;_;){if(_.isDeactivated)return;_=_.parent}return r()});if(L1(t,f,l),l){let _=l.parent;for(;_&&_.parent;)$g(_.parent.vnode)&&v8(f,t,l,_),_=_.parent}}function v8(r,t,l,f){const _=L1(t,r,f,!0);k1(()=>{A2(f[t],_)},l)}function ww(r){r.shapeFlag&=-257,r.shapeFlag&=-513}function G0(r){return r.shapeFlag&128?r.ssContent:r}function L1(r,t,l=as,f=!1){if(l){const _=l[r]||(l[r]=[]),b=t.__weh||(t.__weh=(...T)=>{zu();const n=gd(l),k=Ea(t,l,r,T);return n(),ku(),k});return f?_.unshift(b):_.push(b),b}}const gc=r=>(t,l=as)=>{(!Ap||r==="sp")&&L1(r,(...f)=>t(...f),l)},MD=gc("bm"),qg=gc("m"),U2=gc("bu"),O1=gc("u"),z1=gc("bum"),k1=gc("um"),CD=gc("sp"),ID=gc("rtg"),PD=gc("rtc");function RD(r,t=as){L1("ec",r,t)}const j2="components",x8="directives";function b8(r,t){return $2(j2,r,!0,t)||r}const DD=Symbol.for("v-ndc");function w8(r){return nn(r)?$2(j2,r,!1)||r:r||DD}function T8(r){return $2(x8,r)}function $2(r,t,l=!0,f=!1){const _=ls||as;if(_){const b=_.type;if(r===j2){const n=wT(b,!1);if(n&&(n===t||n===hr(t)||n===Ad(hr(t))))return b}const T=pI(_[r]||b[r],t)||pI(_.appContext[r],t);return!T&&f?b:T}}function pI(r,t){return r&&(r[t]||r[hr(t)]||r[Ad(hr(t))])}function jn(r,t,l,f){let _;const b=l&&l[f],T=vi(r);if(T||nn(r)){const n=T&&vu(r);let k=!1;n&&(k=!Uo(r),r=E1(r)),_=new Array(r.length);for(let j=0,U=r.length;j<U;j++)_[j]=t(k?zs(r[j]):r[j],j,void 0,b&&b[j])}else if(typeof r=="number"){_=new Array(r);for(let n=0;n<r;n++)_[n]=t(n+1,n,void 0,b&&b[n])}else if($n(r))if(r[Symbol.iterator])_=Array.from(r,(n,k)=>t(n,k,void 0,b&&b[k]));else{const n=Object.keys(r);_=new Array(n.length);for(let k=0,j=n.length;k<j;k++){const U=n[k];_[k]=t(r[U],U,k,b&&b[k])}}else _=[];return l&&(l[f]=_),_}function E8(r,t){for(let l=0;l<t.length;l++){const f=t[l];if(vi(f))for(let _=0;_<f.length;_++)r[f[_].name]=f[_].fn;else f&&(r[f.name]=f.key?(..._)=>{const b=f.fn(..._);return b&&(b.key=f.key),b}:f.fn)}return r}function S8(r,t,l={},f,_){if(ls.ce||ls.parent&&xu(ls.parent)&&ls.parent.ce)return t!=="default"&&(l.name=t),Dt(),Bv(Oi,null,[ur("slot",l,f&&f())],64);let b=r[t];b&&b._c&&(b._d=!1),Dt();const T=b&&q2(b(l)),n=l.key||T&&T.key,k=Bv(Oi,{key:(n&&!Eo(n)?n:`_${t}`)+(!T&&f?"_fb":"")},T||(f?f():[]),T&&r._===1?64:-2);return!_&&k.scopeId&&(k.slotScopeIds=[k.scopeId+"-s"]),b&&b._c&&(b._d=!0),k}function q2(r){return r.some(t=>mc(t)?!(t.type===Xr||t.type===Oi&&!q2(t.children)):!0)?r:null}function A8(r,t){const l={};for(const f in r)l[t&&/[A-Z]/.test(f)?`on:${f}`:lp(f)]=r[f];return l}const hT=r=>r?hL(r)?Gg(r):hT(r.parent):null,ag=vn(Object.create(null),{$:r=>r,$el:r=>r.vnode.el,$data:r=>r.data,$props:r=>r.props,$attrs:r=>r.attrs,$slots:r=>r.slots,$refs:r=>r.refs,$parent:r=>hT(r.parent),$root:r=>hT(r.root),$host:r=>r.ce,$emit:r=>r.emit,$options:r=>H2(r),$forceUpdate:r=>r.f||(r.f=()=>{z2(r.update)}),$nextTick:r=>r.n||(r.n=P1.bind(r.proxy)),$watch:r=>rq.bind(r)}),Tw=(r,t)=>r!==yn&&!r.__isScriptSetup&&zn(r,t),dT={get({_:r},t){if(t==="__v_skip")return!0;const{ctx:l,setupState:f,data:_,props:b,accessCache:T,type:n,appContext:k}=r;let j;if(t[0]!=="$"){const se=T[t];if(se!==void 0)switch(se){case 1:return f[t];case 2:return _[t];case 4:return l[t];case 3:return b[t]}else{if(Tw(f,t))return T[t]=1,f[t];if(_!==yn&&zn(_,t))return T[t]=2,_[t];if((j=r.propsOptions[0])&&zn(j,t))return T[t]=3,b[t];if(l!==yn&&zn(l,t))return T[t]=4,l[t];fT&&(T[t]=0)}}const U=ag[t];let Z,re;if(U)return t==="$attrs"&&Os(r.attrs,"get",""),U(r);if((Z=n.__cssModules)&&(Z=Z[t]))return Z;if(l!==yn&&zn(l,t))return T[t]=4,l[t];if(re=k.config.globalProperties,zn(re,t))return re[t]},set({_:r},t,l){const{data:f,setupState:_,ctx:b}=r;return Tw(_,t)?(_[t]=l,!0):f!==yn&&zn(f,t)?(f[t]=l,!0):zn(r.props,t)||t[0]==="$"&&t.slice(1)in r?!1:(b[t]=l,!0)},has({_:{data:r,setupState:t,accessCache:l,ctx:f,appContext:_,propsOptions:b}},T){let n;return!!l[T]||r!==yn&&zn(r,T)||Tw(t,T)||(n=b[0])&&zn(n,T)||zn(f,T)||zn(ag,T)||zn(_.config.globalProperties,T)},defineProperty(r,t,l){return l.get!=null?r._.accessCache[t]=0:zn(l,"value")&&this.set(r,t,l.value,null),Reflect.defineProperty(r,t,l)}},M8=vn({},dT,{get(r,t){if(t!==Symbol.unscopables)return dT.get(r,t,r)},has(r,t){return t[0]!=="_"&&!jj(t)}});function C8(){return null}function I8(){return null}function P8(r){}function R8(r){}function D8(){return null}function L8(){}function O8(r,t){return null}function z8(){return LD().slots}function k8(){return LD().attrs}function LD(){const r=Aa();return r.setupContext||(r.setupContext=mL(r))}function Cg(r){return vi(r)?r.reduce((t,l)=>(t[l]=null,t),{}):r}function F8(r,t){const l=Cg(r);for(const f in t){if(f.startsWith("__skip"))continue;let _=l[f];_?vi(_)||ji(_)?_=l[f]={type:_,default:t[f]}:_.default=t[f]:_===null&&(_=l[f]={default:t[f]}),_&&t[`__skip_${f}`]&&(_.skipFactory=!0)}return l}function N8(r,t){return!r||!t?r||t:vi(r)&&vi(t)?r.concat(t):vn({},Cg(r),Cg(t))}function B8(r,t){const l={};for(const f in r)t.includes(f)||Object.defineProperty(l,f,{enumerable:!0,get:()=>r[f]});return l}function V8(r){const t=Aa();let l=r();return vT(),M2(l)&&(l=l.catch(f=>{throw gd(t),f})),[l,()=>gd(t)]}let fT=!0;function U8(r){const t=H2(r),l=r.proxy,f=r.ctx;fT=!1,t.beforeCreate&&mI(t.beforeCreate,r,"bc");const{data:_,computed:b,methods:T,watch:n,provide:k,inject:j,created:U,beforeMount:Z,mounted:re,beforeUpdate:se,updated:ue,activated:ne,deactivated:be,beforeDestroy:De,beforeUnmount:Be,destroyed:Te,unmounted:me,render:Ie,renderTracked:Xe,renderTriggered:je,errorCaptured:rt,serverPrefetch:Ve,expose:He,inheritAttrs:st,components:dt,directives:At,filters:ni}=t;if(j&&j8(j,f,null),T)for(const ti in T){const li=T[ti];ji(li)&&(f[ti]=li.bind(l))}if(_){const ti=_.call(l,l);$n(ti)&&(r.data=A1(ti))}if(fT=!0,b)for(const ti in b){const li=b[ti],ii=ji(li)?li.bind(l,l):ji(li.get)?li.get.bind(l,l):_s,Pn=!ji(li)&&ji(li.set)?li.set.bind(l):_s,Fn=_L({get:ii,set:Pn});Object.defineProperty(f,ti,{enumerable:!0,configurable:!0,get:()=>Fn.value,set:xn=>Fn.value=xn})}if(n)for(const ti in n)OD(n[ti],f,l,ti);if(k){const ti=ji(k)?k.call(l):k;Reflect.ownKeys(ti).forEach(li=>{kD(li,ti[li])})}U&&mI(U,r,"c");function kt(ti,li){vi(li)?li.forEach(ii=>ti(ii.bind(l))):li&&ti(li.bind(l))}if(kt(MD,Z),kt(qg,re),kt(U2,se),kt(O1,ue),kt(ED,ne),kt(SD,be),kt(RD,rt),kt(PD,Xe),kt(ID,je),kt(z1,Be),kt(k1,me),kt(CD,Ve),vi(He))if(He.length){const ti=r.exposed||(r.exposed={});He.forEach(li=>{Object.defineProperty(ti,li,{get:()=>l[li],set:ii=>l[li]=ii})})}else r.exposed||(r.exposed={});Ie&&r.render===_s&&(r.render=Ie),st!=null&&(r.inheritAttrs=st),dt&&(r.components=dt),At&&(r.directives=At),Ve&&V2(r)}function j8(r,t,l=_s){vi(r)&&(r=pT(r));for(const f in r){const _=r[f];let b;$n(_)?"default"in _?b=lg(_.from||f,_.default,!0):b=lg(_.from||f):b=lg(_),cs(b)?Object.defineProperty(t,f,{enumerable:!0,configurable:!0,get:()=>b.value,set:T=>b.value=T}):t[f]=b}}function mI(r,t,l){Ea(vi(r)?r.map(f=>f.bind(t.proxy)):r.bind(t.proxy),t,l)}function OD(r,t,l,f){let _=f.includes(".")?eL(l,f):()=>l[f];if(nn(r)){const b=t[r];ji(b)&&hp(_,b)}else if(ji(r))hp(_,r.bind(l));else if($n(r))if(vi(r))r.forEach(b=>OD(b,t,l,f));else{const b=ji(r.handler)?r.handler.bind(l):t[r.handler];ji(b)&&hp(_,b,r)}}function H2(r){const t=r.type,{mixins:l,extends:f}=t,{mixins:_,optionsCache:b,config:{optionMergeStrategies:T}}=r.appContext,n=b.get(t);let k;return n?k=n:!_.length&&!l&&!f?k=t:(k={},_.length&&_.forEach(j=>kv(k,j,T,!0)),kv(k,t,T)),$n(t)&&b.set(t,k),k}function kv(r,t,l,f=!1){const{mixins:_,extends:b}=t;b&&kv(r,b,l,!0),_&&_.forEach(T=>kv(r,T,l,!0));for(const T in t)if(!(f&&T==="expose")){const n=$8[T]||l&&l[T];r[T]=n?n(r[T],t[T]):t[T]}return r}const $8={data:_I,props:gI,emits:gI,methods:K_,computed:K_,beforeCreate:Ys,created:Ys,beforeMount:Ys,mounted:Ys,beforeUpdate:Ys,updated:Ys,beforeDestroy:Ys,beforeUnmount:Ys,destroyed:Ys,unmounted:Ys,activated:Ys,deactivated:Ys,errorCaptured:Ys,serverPrefetch:Ys,components:K_,directives:K_,watch:H8,provide:_I,inject:q8};function _I(r,t){return t?r?function(){return vn(ji(r)?r.call(this,this):r,ji(t)?t.call(this,this):t)}:t:r}function q8(r,t){return K_(pT(r),pT(t))}function pT(r){if(vi(r)){const t={};for(let l=0;l<r.length;l++)t[r[l]]=r[l];return t}return r}function Ys(r,t){return r?[...new Set([].concat(r,t))]:t}function K_(r,t){return r?vn(Object.create(null),r,t):t}function gI(r,t){return r?vi(r)&&vi(t)?[...new Set([...r,...t])]:vn(Object.create(null),Cg(r),Cg(t??{})):t}function H8(r,t){if(!r)return t;if(!t)return r;const l=vn(Object.create(null),r);for(const f in t)l[f]=Ys(r[f],t[f]);return l}function zD(){return{app:null,config:{isNativeTag:X_,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let G8=0;function W8(r,t){return function(f,_=null){ji(f)||(f=vn({},f)),_!=null&&!$n(_)&&(_=null);const b=zD(),T=new WeakSet,n=[];let k=!1;const j=b.app={_uid:G8++,_component:f,_props:_,_container:null,_context:b,_instance:null,version:vL,get config(){return b.config},set config(U){},use(U,...Z){return T.has(U)||(U&&ji(U.install)?(T.add(U),U.install(j,...Z)):ji(U)&&(T.add(U),U(j,...Z))),j},mixin(U){return b.mixins.includes(U)||b.mixins.push(U),j},component(U,Z){return Z?(b.components[U]=Z,j):b.components[U]},directive(U,Z){return Z?(b.directives[U]=Z,j):b.directives[U]},mount(U,Z,re){if(!k){const se=j._ceVNode||ur(f,_);return se.appContext=b,re===!0?re="svg":re===!1&&(re=void 0),Z&&t?t(se,U):r(se,U,re),k=!0,j._container=U,U.__vue_app__=j,Gg(se.component)}},onUnmount(U){n.push(U)},unmount(){k&&(Ea(n,j._instance,16),r(null,j._container),delete j._container.__vue_app__)},provide(U,Z){return b.provides[U]=Z,j},runWithContext(U){const Z=ad;ad=j;try{return U()}finally{ad=Z}}};return j}}let ad=null;function kD(r,t){if(as){let l=as.provides;const f=as.parent&&as.parent.provides;f===l&&(l=as.provides=Object.create(f)),l[r]=t}}function lg(r,t,l=!1){const f=as||ls;if(f||ad){const _=ad?ad._context.provides:f?f.parent==null?f.vnode.appContext&&f.vnode.appContext.provides:f.parent.provides:void 0;if(_&&r in _)return _[r];if(arguments.length>1)return l&&ji(t)?t.call(f&&f.proxy):t}}function Z8(){return!!(as||ls||ad)}const FD={},ND=()=>Object.create(FD),BD=r=>Object.getPrototypeOf(r)===FD;function X8(r,t,l,f=!1){const _={},b=ND();r.propsDefaults=Object.create(null),VD(r,t,_,b);for(const T in r.propsOptions[0])T in _||(_[T]=void 0);l?r.props=f?_:rD(_):r.type.props?r.props=_:r.props=b,r.attrs=b}function Y8(r,t,l,f){const{props:_,attrs:b,vnode:{patchFlag:T}}=r,n=In(_),[k]=r.propsOptions;let j=!1;if((f||T>0)&&!(T&16)){if(T&8){const U=r.vnode.dynamicProps;for(let Z=0;Z<U.length;Z++){let re=U[Z];if(F1(r.emitsOptions,re))continue;const se=t[re];if(k)if(zn(b,re))se!==b[re]&&(b[re]=se,j=!0);else{const ue=hr(re);_[ue]=mT(k,n,ue,se,r,!1)}else se!==b[re]&&(b[re]=se,j=!0)}}}else{VD(r,t,_,b)&&(j=!0);let U;for(const Z in n)(!t||!zn(t,Z)&&((U=go(Z))===Z||!zn(t,U)))&&(k?l&&(l[Z]!==void 0||l[U]!==void 0)&&(_[Z]=mT(k,n,Z,void 0,r,!0)):delete _[Z]);if(b!==n)for(const Z in b)(!t||!zn(t,Z))&&(delete b[Z],j=!0)}j&&sc(r.attrs,"set","")}function VD(r,t,l,f){const[_,b]=r.propsOptions;let T=!1,n;if(t)for(let k in t){if(yu(k))continue;const j=t[k];let U;_&&zn(_,U=hr(k))?!b||!b.includes(U)?l[U]=j:(n||(n={}))[U]=j:F1(r.emitsOptions,k)||(!(k in f)||j!==f[k])&&(f[k]=j,T=!0)}if(b){const k=In(l),j=n||yn;for(let U=0;U<b.length;U++){const Z=b[U];l[Z]=mT(_,k,Z,j[Z],r,!zn(j,Z))}}return T}function mT(r,t,l,f,_,b){const T=r[l];if(T!=null){const n=zn(T,"default");if(n&&f===void 0){const k=T.default;if(T.type!==Function&&!T.skipFactory&&ji(k)){const{propsDefaults:j}=_;if(l in j)f=j[l];else{const U=gd(_);f=j[l]=k.call(null,t),U()}}else f=k;_.ce&&_.ce._setProp(l,f)}T[0]&&(b&&!n?f=!1:T[1]&&(f===""||f===go(l))&&(f=!0))}return f}const K8=new WeakMap;function UD(r,t,l=!1){const f=l?K8:t.propsCache,_=f.get(r);if(_)return _;const b=r.props,T={},n=[];let k=!1;if(!ji(r)){const U=Z=>{k=!0;const[re,se]=UD(Z,t,!0);vn(T,re),se&&n.push(...se)};!l&&t.mixins.length&&t.mixins.forEach(U),r.extends&&U(r.extends),r.mixins&&r.mixins.forEach(U)}if(!b&&!k)return $n(r)&&f.set(r,op),op;if(vi(b))for(let U=0;U<b.length;U++){const Z=hr(b[U]);yI(Z)&&(T[Z]=yn)}else if(b)for(const U in b){const Z=hr(U);if(yI(Z)){const re=b[U],se=T[Z]=vi(re)||ji(re)?{type:re}:vn({},re),ue=se.type;let ne=!1,be=!0;if(vi(ue))for(let De=0;De<ue.length;++De){const Be=ue[De],Te=ji(Be)&&Be.name;if(Te==="Boolean"){ne=!0;break}else Te==="String"&&(be=!1)}else ne=ji(ue)&&ue.name==="Boolean";se[0]=ne,se[1]=be,(ne||zn(se,"default"))&&n.push(Z)}}const j=[T,n];return $n(r)&&f.set(r,j),j}function yI(r){return r[0]!=="$"&&!yu(r)}const jD=r=>r[0]==="_"||r==="$stable",G2=r=>vi(r)?r.map(mo):[mo(r)],J8=(r,t,l)=>{if(t._n)return t;const f=k2((..._)=>G2(t(..._)),l);return f._c=!1,f},$D=(r,t,l)=>{const f=r._ctx;for(const _ in r){if(jD(_))continue;const b=r[_];if(ji(b))t[_]=J8(_,b,f);else if(b!=null){const T=G2(b);t[_]=()=>T}}},qD=(r,t)=>{const l=G2(t);r.slots.default=()=>l},HD=(r,t,l)=>{for(const f in t)(l||f!=="_")&&(r[f]=t[f])},Q8=(r,t,l)=>{const f=r.slots=ND();if(r.vnode.shapeFlag&32){const _=t._;_?(HD(f,t,l),l&&F3(f,"_",_,!0)):$D(t,f)}else t&&qD(r,t)},eq=(r,t,l)=>{const{vnode:f,slots:_}=r;let b=!0,T=yn;if(f.shapeFlag&32){const n=t._;n?l&&n===1?b=!1:HD(_,t,l):(b=!t.$stable,$D(t,_)),T=t}else t&&(qD(r,t),T={default:1});if(b)for(const n in _)!jD(n)&&T[n]==null&&delete _[n]},ss=rL;function GD(r){return ZD(r)}function WD(r){return ZD(r,o8)}function ZD(r,t){const l=b1();l.__VUE__=!0;const{insert:f,remove:_,patchProp:b,createElement:T,createText:n,createComment:k,setText:j,setElementText:U,parentNode:Z,nextSibling:re,setScopeId:se=_s,insertStaticContent:ue}=r,ne=(Ze,Se,bt,Bt=null,Ut=null,yt=null,Kt=void 0,Zt=null,Jt=!!Se.dynamicChildren)=>{if(Ze===Se)return;Ze&&!Ga(Ze,Se)&&(Bt=hs(Ze),xn(Ze,Ut,yt,!0),Ze=null),Se.patchFlag===-2&&(Jt=!1,Se.dynamicChildren=null);const{type:Ht,ref:Si,shapeFlag:Ct}=Se;switch(Ht){case bu:be(Ze,Se,bt,Bt);break;case Xr:De(Ze,Se,bt,Bt);break;case ld:Ze==null&&Be(Se,bt,Bt,Kt);break;case Oi:dt(Ze,Se,bt,Bt,Ut,yt,Kt,Zt,Jt);break;default:Ct&1?Ie(Ze,Se,bt,Bt,Ut,yt,Kt,Zt,Jt):Ct&6?At(Ze,Se,bt,Bt,Ut,yt,Kt,Zt,Jt):(Ct&64||Ct&128)&&Ht.process(Ze,Se,bt,Bt,Ut,yt,Kt,Zt,Jt,Le)}Si!=null&&Ut&&Mg(Si,Ze&&Ze.ref,yt,Se||Ze,!Se)},be=(Ze,Se,bt,Bt)=>{if(Ze==null)f(Se.el=n(Se.children),bt,Bt);else{const Ut=Se.el=Ze.el;Se.children!==Ze.children&&j(Ut,Se.children)}},De=(Ze,Se,bt,Bt)=>{Ze==null?f(Se.el=k(Se.children||""),bt,Bt):Se.el=Ze.el},Be=(Ze,Se,bt,Bt)=>{[Ze.el,Ze.anchor]=ue(Ze.children,Se,bt,Bt,Ze.el,Ze.anchor)},Te=({el:Ze,anchor:Se},bt,Bt)=>{let Ut;for(;Ze&&Ze!==Se;)Ut=re(Ze),f(Ze,bt,Bt),Ze=Ut;f(Se,bt,Bt)},me=({el:Ze,anchor:Se})=>{let bt;for(;Ze&&Ze!==Se;)bt=re(Ze),_(Ze),Ze=bt;_(Se)},Ie=(Ze,Se,bt,Bt,Ut,yt,Kt,Zt,Jt)=>{Se.type==="svg"?Kt="svg":Se.type==="math"&&(Kt="mathml"),Ze==null?Xe(Se,bt,Bt,Ut,yt,Kt,Zt,Jt):Ve(Ze,Se,Ut,yt,Kt,Zt,Jt)},Xe=(Ze,Se,bt,Bt,Ut,yt,Kt,Zt)=>{let Jt,Ht;const{props:Si,shapeFlag:Ct,transition:yi,dirs:Ai}=Ze;if(Jt=Ze.el=T(Ze.type,yt,Si&&Si.is,Si),Ct&8?U(Jt,Ze.children):Ct&16&&rt(Ze.children,Jt,null,Bt,Ut,Ew(Ze,yt),Kt,Zt),Ai&&vl(Ze,null,Bt,"created"),je(Jt,Ze,Ze.scopeId,Kt,Bt),Si){for(const Wi in Si)Wi!=="value"&&!yu(Wi)&&b(Jt,Wi,null,Si[Wi],yt,Bt);"value"in Si&&b(Jt,"value",null,Si.value,yt),(Ht=Si.onVnodeBeforeMount)&&po(Ht,Bt,Ze)}Ai&&vl(Ze,null,Bt,"beforeMount");const Gi=XD(Ut,yi);Gi&&yi.beforeEnter(Jt),f(Jt,Se,bt),((Ht=Si&&Si.onVnodeMounted)||Gi||Ai)&&ss(()=>{Ht&&po(Ht,Bt,Ze),Gi&&yi.enter(Jt),Ai&&vl(Ze,null,Bt,"mounted")},Ut)},je=(Ze,Se,bt,Bt,Ut)=>{if(bt&&se(Ze,bt),Bt)for(let yt=0;yt<Bt.length;yt++)se(Ze,Bt[yt]);if(Ut){let yt=Ut.subTree;if(Se===yt||Nv(yt.type)&&(yt.ssContent===Se||yt.ssFallback===Se)){const Kt=Ut.vnode;je(Ze,Kt,Kt.scopeId,Kt.slotScopeIds,Ut.parent)}}},rt=(Ze,Se,bt,Bt,Ut,yt,Kt,Zt,Jt=0)=>{for(let Ht=Jt;Ht<Ze.length;Ht++){const Si=Ze[Ht]=Zt?hu(Ze[Ht]):mo(Ze[Ht]);ne(null,Si,Se,bt,Bt,Ut,yt,Kt,Zt)}},Ve=(Ze,Se,bt,Bt,Ut,yt,Kt)=>{const Zt=Se.el=Ze.el;let{patchFlag:Jt,dynamicChildren:Ht,dirs:Si}=Se;Jt|=Ze.patchFlag&16;const Ct=Ze.props||yn,yi=Se.props||yn;let Ai;if(bt&&jh(bt,!1),(Ai=yi.onVnodeBeforeUpdate)&&po(Ai,bt,Se,Ze),Si&&vl(Se,Ze,bt,"beforeUpdate"),bt&&jh(bt,!0),(Ct.innerHTML&&yi.innerHTML==null||Ct.textContent&&yi.textContent==null)&&U(Zt,""),Ht?He(Ze.dynamicChildren,Ht,Zt,bt,Bt,Ew(Se,Ut),yt):Kt||li(Ze,Se,Zt,null,bt,Bt,Ew(Se,Ut),yt,!1),Jt>0){if(Jt&16)st(Zt,Ct,yi,bt,Ut);else if(Jt&2&&Ct.class!==yi.class&&b(Zt,"class",null,yi.class,Ut),Jt&4&&b(Zt,"style",Ct.style,yi.style,Ut),Jt&8){const Gi=Se.dynamicProps;for(let Wi=0;Wi<Gi.length;Wi++){const un=Gi[Wi],xr=Ct[un],sr=yi[un];(sr!==xr||un==="value")&&b(Zt,un,xr,sr,Ut,bt)}}Jt&1&&Ze.children!==Se.children&&U(Zt,Se.children)}else!Kt&&Ht==null&&st(Zt,Ct,yi,bt,Ut);((Ai=yi.onVnodeUpdated)||Si)&&ss(()=>{Ai&&po(Ai,bt,Se,Ze),Si&&vl(Se,Ze,bt,"updated")},Bt)},He=(Ze,Se,bt,Bt,Ut,yt,Kt)=>{for(let Zt=0;Zt<Se.length;Zt++){const Jt=Ze[Zt],Ht=Se[Zt],Si=Jt.el&&(Jt.type===Oi||!Ga(Jt,Ht)||Jt.shapeFlag&70)?Z(Jt.el):bt;ne(Jt,Ht,Si,null,Bt,Ut,yt,Kt,!0)}},st=(Ze,Se,bt,Bt,Ut)=>{if(Se!==bt){if(Se!==yn)for(const yt in Se)!yu(yt)&&!(yt in bt)&&b(Ze,yt,Se[yt],null,Ut,Bt);for(const yt in bt){if(yu(yt))continue;const Kt=bt[yt],Zt=Se[yt];Kt!==Zt&&yt!=="value"&&b(Ze,yt,Zt,Kt,Ut,Bt)}"value"in bt&&b(Ze,"value",Se.value,bt.value,Ut)}},dt=(Ze,Se,bt,Bt,Ut,yt,Kt,Zt,Jt)=>{const Ht=Se.el=Ze?Ze.el:n(""),Si=Se.anchor=Ze?Ze.anchor:n("");let{patchFlag:Ct,dynamicChildren:yi,slotScopeIds:Ai}=Se;Ai&&(Zt=Zt?Zt.concat(Ai):Ai),Ze==null?(f(Ht,bt,Bt),f(Si,bt,Bt),rt(Se.children||[],bt,Si,Ut,yt,Kt,Zt,Jt)):Ct>0&&Ct&64&&yi&&Ze.dynamicChildren?(He(Ze.dynamicChildren,yi,bt,Ut,yt,Kt,Zt),(Se.key!=null||Ut&&Se===Ut.subTree)&&W2(Ze,Se,!0)):li(Ze,Se,bt,Si,Ut,yt,Kt,Zt,Jt)},At=(Ze,Se,bt,Bt,Ut,yt,Kt,Zt,Jt)=>{Se.slotScopeIds=Zt,Ze==null?Se.shapeFlag&512?Ut.ctx.activate(Se,bt,Bt,Kt,Jt):ni(Se,bt,Bt,Ut,yt,Kt,Jt):Tt(Ze,Se,Jt)},ni=(Ze,Se,bt,Bt,Ut,yt,Kt)=>{const Zt=Ze.component=uL(Ze,Bt,Ut);if($g(Ze)&&(Zt.ctx.renderer=Le),dL(Zt,!1,Kt),Zt.asyncDep){if(Ut&&Ut.registerDep(Zt,kt,Kt),!Ze.el){const Jt=Zt.subTree=ur(Xr);De(null,Jt,Se,bt)}}else kt(Zt,Ze,Se,bt,Ut,yt,Kt)},Tt=(Ze,Se,bt)=>{const Bt=Se.component=Ze.component;if(uq(Ze,Se,bt))if(Bt.asyncDep&&!Bt.asyncResolved){ti(Bt,Se,bt);return}else Bt.next=Se,Bt.update();else Se.el=Ze.el,Bt.vnode=Se},kt=(Ze,Se,bt,Bt,Ut,yt,Kt)=>{const Zt=()=>{if(Ze.isMounted){let{next:Ct,bu:yi,u:Ai,parent:Gi,vnode:Wi}=Ze;{const Rn=YD(Ze);if(Rn){Ct&&(Ct.el=Wi.el,ti(Ze,Ct,Kt)),Rn.asyncDep.then(()=>{Ze.isUnmounted||Zt()});return}}let un=Ct,xr;jh(Ze,!1),Ct?(Ct.el=Wi.el,ti(Ze,Ct,Kt)):Ct=Wi,yi&&cp(yi),(xr=Ct.props&&Ct.props.onVnodeBeforeUpdate)&&po(xr,Gi,Ct,Wi),jh(Ze,!0);const sr=cv(Ze),Ur=Ze.subTree;Ze.subTree=sr,ne(Ur,sr,Z(Ur.el),hs(Ur),Ze,Ut,yt),Ct.el=sr.el,un===null&&N1(Ze,sr.el),Ai&&ss(Ai,Ut),(xr=Ct.props&&Ct.props.onVnodeUpdated)&&ss(()=>po(xr,Gi,Ct,Wi),Ut)}else{let Ct;const{el:yi,props:Ai}=Se,{bm:Gi,m:Wi,parent:un,root:xr,type:sr}=Ze,Ur=xu(Se);if(jh(Ze,!1),Gi&&cp(Gi),!Ur&&(Ct=Ai&&Ai.onVnodeBeforeMount)&&po(Ct,un,Se),jh(Ze,!0),yi&&ro){const Rn=()=>{Ze.subTree=cv(Ze),ro(yi,Ze.subTree,Ze,Ut,null)};Ur&&sr.__asyncHydrate?sr.__asyncHydrate(yi,Ze,Rn):Rn()}else{xr.ce&&xr.ce._injectChildStyle(sr);const Rn=Ze.subTree=cv(Ze);ne(null,Rn,bt,Bt,Ze,Ut,yt),Se.el=Rn.el}if(Wi&&ss(Wi,Ut),!Ur&&(Ct=Ai&&Ai.onVnodeMounted)){const Rn=Se;ss(()=>po(Ct,un,Rn),Ut)}(Se.shapeFlag&256||un&&xu(un.vnode)&&un.vnode.shapeFlag&256)&&Ze.a&&ss(Ze.a,Ut),Ze.isMounted=!0,Se=bt=Bt=null}};Ze.scope.on();const Jt=Ze.effect=new bg(Zt);Ze.scope.off();const Ht=Ze.update=Jt.run.bind(Jt),Si=Ze.job=Jt.runIfDirty.bind(Jt);Si.i=Ze,Si.id=Ze.uid,Jt.scheduler=()=>z2(Si),jh(Ze,!0),Ht()},ti=(Ze,Se,bt)=>{Se.component=Ze;const Bt=Ze.vnode.props;Ze.vnode=Se,Ze.next=null,Y8(Ze,Se.props,Bt,bt),eq(Ze,Se.children,bt),zu(),aI(Ze),ku()},li=(Ze,Se,bt,Bt,Ut,yt,Kt,Zt,Jt=!1)=>{const Ht=Ze&&Ze.children,Si=Ze?Ze.shapeFlag:0,Ct=Se.children,{patchFlag:yi,shapeFlag:Ai}=Se;if(yi>0){if(yi&128){Pn(Ht,Ct,bt,Bt,Ut,yt,Kt,Zt,Jt);return}else if(yi&256){ii(Ht,Ct,bt,Bt,Ut,yt,Kt,Zt,Jt);return}}Ai&8?(Si&16&&Vr(Ht,Ut,yt),Ct!==Ht&&U(bt,Ct)):Si&16?Ai&16?Pn(Ht,Ct,bt,Bt,Ut,yt,Kt,Zt,Jt):Vr(Ht,Ut,yt,!0):(Si&8&&U(bt,""),Ai&16&&rt(Ct,bt,Bt,Ut,yt,Kt,Zt,Jt))},ii=(Ze,Se,bt,Bt,Ut,yt,Kt,Zt,Jt)=>{Ze=Ze||op,Se=Se||op;const Ht=Ze.length,Si=Se.length,Ct=Math.min(Ht,Si);let yi;for(yi=0;yi<Ct;yi++){const Ai=Se[yi]=Jt?hu(Se[yi]):mo(Se[yi]);ne(Ze[yi],Ai,bt,null,Ut,yt,Kt,Zt,Jt)}Ht>Si?Vr(Ze,Ut,yt,!0,!1,Ct):rt(Se,bt,Bt,Ut,yt,Kt,Zt,Jt,Ct)},Pn=(Ze,Se,bt,Bt,Ut,yt,Kt,Zt,Jt)=>{let Ht=0;const Si=Se.length;let Ct=Ze.length-1,yi=Si-1;for(;Ht<=Ct&&Ht<=yi;){const Ai=Ze[Ht],Gi=Se[Ht]=Jt?hu(Se[Ht]):mo(Se[Ht]);if(Ga(Ai,Gi))ne(Ai,Gi,bt,null,Ut,yt,Kt,Zt,Jt);else break;Ht++}for(;Ht<=Ct&&Ht<=yi;){const Ai=Ze[Ct],Gi=Se[yi]=Jt?hu(Se[yi]):mo(Se[yi]);if(Ga(Ai,Gi))ne(Ai,Gi,bt,null,Ut,yt,Kt,Zt,Jt);else break;Ct--,yi--}if(Ht>Ct){if(Ht<=yi){const Ai=yi+1,Gi=Ai<Si?Se[Ai].el:Bt;for(;Ht<=yi;)ne(null,Se[Ht]=Jt?hu(Se[Ht]):mo(Se[Ht]),bt,Gi,Ut,yt,Kt,Zt,Jt),Ht++}}else if(Ht>yi)for(;Ht<=Ct;)xn(Ze[Ht],Ut,yt,!0),Ht++;else{const Ai=Ht,Gi=Ht,Wi=new Map;for(Ht=Gi;Ht<=yi;Ht++){const Bn=Se[Ht]=Jt?hu(Se[Ht]):mo(Se[Ht]);Bn.key!=null&&Wi.set(Bn.key,Ht)}let un,xr=0;const sr=yi-Gi+1;let Ur=!1,Rn=0;const so=new Array(sr);for(Ht=0;Ht<sr;Ht++)so[Ht]=0;for(Ht=Ai;Ht<=Ct;Ht++){const Bn=Ze[Ht];if(xr>=sr){xn(Bn,Ut,yt,!0);continue}let jr;if(Bn.key!=null)jr=Wi.get(Bn.key);else for(un=Gi;un<=yi;un++)if(so[un-Gi]===0&&Ga(Bn,Se[un])){jr=un;break}jr===void 0?xn(Bn,Ut,yt,!0):(so[jr-Gi]=Ht+1,jr>=Rn?Rn=jr:Ur=!0,ne(Bn,Se[jr],bt,null,Ut,yt,Kt,Zt,Jt),xr++)}const Ma=Ur?tq(so):op;for(un=Ma.length-1,Ht=sr-1;Ht>=0;Ht--){const Bn=Gi+Ht,jr=Se[Bn],Ti=Bn+1<Si?Se[Bn+1].el:Bt;so[Ht]===0?ne(null,jr,bt,Ti,Ut,yt,Kt,Zt,Jt):Ur&&(un<0||Ht!==Ma[un]?Fn(jr,bt,Ti,2):un--)}}},Fn=(Ze,Se,bt,Bt,Ut=null)=>{const{el:yt,type:Kt,transition:Zt,children:Jt,shapeFlag:Ht}=Ze;if(Ht&6){Fn(Ze.component.subTree,Se,bt,Bt);return}if(Ht&128){Ze.suspense.move(Se,bt,Bt);return}if(Ht&64){Kt.move(Ze,Se,bt,Le);return}if(Kt===Oi){f(yt,Se,bt);for(let Ct=0;Ct<Jt.length;Ct++)Fn(Jt[Ct],Se,bt,Bt);f(Ze.anchor,Se,bt);return}if(Kt===ld){Te(Ze,Se,bt);return}if(Bt!==2&&Ht&1&&Zt)if(Bt===0)Zt.beforeEnter(yt),f(yt,Se,bt),ss(()=>Zt.enter(yt),Ut);else{const{leave:Ct,delayLeave:yi,afterLeave:Ai}=Zt,Gi=()=>f(yt,Se,bt),Wi=()=>{Ct(yt,()=>{Gi(),Ai&&Ai()})};yi?yi(yt,Gi,Wi):Wi()}else f(yt,Se,bt)},xn=(Ze,Se,bt,Bt=!1,Ut=!1)=>{const{type:yt,props:Kt,ref:Zt,children:Jt,dynamicChildren:Ht,shapeFlag:Si,patchFlag:Ct,dirs:yi,cacheIndex:Ai}=Ze;if(Ct===-2&&(Ut=!1),Zt!=null&&Mg(Zt,null,bt,Ze,!0),Ai!=null&&(Se.renderCache[Ai]=void 0),Si&256){Se.ctx.deactivate(Ze);return}const Gi=Si&1&&yi,Wi=!xu(Ze);let un;if(Wi&&(un=Kt&&Kt.onVnodeBeforeUnmount)&&po(un,Se,Ze),Si&6)Wn(Ze.component,bt,Bt);else{if(Si&128){Ze.suspense.unmount(bt,Bt);return}Gi&&vl(Ze,null,Se,"beforeUnmount"),Si&64?Ze.type.remove(Ze,Se,bt,Le,Bt):Ht&&!Ht.hasOnce&&(yt!==Oi||Ct>0&&Ct&64)?Vr(Ht,Se,bt,!1,!0):(yt===Oi&&Ct&384||!Ut&&Si&16)&&Vr(Jt,Se,bt),Bt&&_i(Ze)}(Wi&&(un=Kt&&Kt.onVnodeUnmounted)||Gi)&&ss(()=>{un&&po(un,Se,Ze),Gi&&vl(Ze,null,Se,"unmounted")},bt)},_i=Ze=>{const{type:Se,el:bt,anchor:Bt,transition:Ut}=Ze;if(Se===Oi){dr(bt,Bt);return}if(Se===ld){me(Ze);return}const yt=()=>{_(bt),Ut&&!Ut.persisted&&Ut.afterLeave&&Ut.afterLeave()};if(Ze.shapeFlag&1&&Ut&&!Ut.persisted){const{leave:Kt,delayLeave:Zt}=Ut,Jt=()=>Kt(bt,yt);Zt?Zt(Ze.el,yt,Jt):Jt()}else yt()},dr=(Ze,Se)=>{let bt;for(;Ze!==Se;)bt=re(Ze),_(Ze),Ze=bt;_(Se)},Wn=(Ze,Se,bt)=>{const{bum:Bt,scope:Ut,job:yt,subTree:Kt,um:Zt,m:Jt,a:Ht}=Ze;Fv(Jt),Fv(Ht),Bt&&cp(Bt),Ut.stop(),yt&&(yt.flags|=8,xn(Kt,Ze,Se,bt)),Zt&&ss(Zt,Se),ss(()=>{Ze.isUnmounted=!0},Se),Se&&Se.pendingBranch&&!Se.isUnmounted&&Ze.asyncDep&&!Ze.asyncResolved&&Ze.suspenseId===Se.pendingId&&(Se.deps--,Se.deps===0&&Se.resolve())},Vr=(Ze,Se,bt,Bt=!1,Ut=!1,yt=0)=>{for(let Kt=yt;Kt<Ze.length;Kt++)xn(Ze[Kt],Se,bt,Bt,Ut)},hs=Ze=>{if(Ze.shapeFlag&6)return hs(Ze.component.subTree);if(Ze.shapeFlag&128)return Ze.suspense.next();const Se=re(Ze.anchor||Ze.el),bt=Se&&Se[_D];return bt?re(bt):Se};let fr=!1;const Us=(Ze,Se,bt)=>{Ze==null?Se._vnode&&xn(Se._vnode,null,null,!0):ne(Se._vnode||null,Ze,Se,null,null,null,bt),Se._vnode=Ze,fr||(fr=!0,aI(),zv(),fr=!1)},Le={p:ne,um:xn,m:Fn,r:_i,mt:ni,mc:rt,pc:li,pbc:He,n:hs,o:r};let Ss,ro;return t&&([Ss,ro]=t(Le)),{render:Us,hydrate:Ss,createApp:W8(Us,Ss)}}function Ew({type:r,props:t},l){return l==="svg"&&r==="foreignObject"||l==="mathml"&&r==="annotation-xml"&&t&&t.encoding&&t.encoding.includes("html")?void 0:l}function jh({effect:r,job:t},l){l?(r.flags|=32,t.flags|=4):(r.flags&=-33,t.flags&=-5)}function XD(r,t){return(!r||r&&!r.pendingBranch)&&t&&!t.persisted}function W2(r,t,l=!1){const f=r.children,_=t.children;if(vi(f)&&vi(_))for(let b=0;b<f.length;b++){const T=f[b];let n=_[b];n.shapeFlag&1&&!n.dynamicChildren&&((n.patchFlag<=0||n.patchFlag===32)&&(n=_[b]=hu(_[b]),n.el=T.el),!l&&n.patchFlag!==-2&&W2(T,n)),n.type===bu&&(n.el=T.el)}}function tq(r){const t=r.slice(),l=[0];let f,_,b,T,n;const k=r.length;for(f=0;f<k;f++){const j=r[f];if(j!==0){if(_=l[l.length-1],r[_]<j){t[f]=_,l.push(f);continue}for(b=0,T=l.length-1;b<T;)n=b+T>>1,r[l[n]]<j?b=n+1:T=n;j<r[l[b]]&&(b>0&&(t[f]=l[b-1]),l[b]=f)}}for(b=l.length,T=l[b-1];b-- >0;)l[b]=T,T=t[T];return l}function YD(r){const t=r.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:YD(t)}function Fv(r){if(r)for(let t=0;t<r.length;t++)r[t].flags|=8}const KD=Symbol.for("v-scx"),JD=()=>lg(KD);function iq(r,t){return Hg(r,null,t)}function nq(r,t){return Hg(r,null,{flush:"post"})}function QD(r,t){return Hg(r,null,{flush:"sync"})}function hp(r,t,l){return Hg(r,t,l)}function Hg(r,t,l=yn){const{immediate:f,deep:_,flush:b,once:T}=l,n=vn({},l),k=t&&f||!t&&b!=="post";let j;if(Ap){if(b==="sync"){const se=JD();j=se.__watcherHandles||(se.__watcherHandles=[])}else if(!k){const se=()=>{};return se.stop=_s,se.resume=_s,se.pause=_s,se}}const U=as;n.call=(se,ue,ne)=>Ea(se,U,ue,ne);let Z=!1;b==="post"?n.scheduler=se=>{ss(se,U&&U.suspense)}:b!=="sync"&&(Z=!0,n.scheduler=(se,ue)=>{ue?se():z2(se)}),n.augmentJob=se=>{t&&(se.flags|=4),Z&&(se.flags|=2,U&&(se.id=U.uid,se.i=U))};const re=j$(r,t,n);return Ap&&(j?j.push(re):k&&re()),re}function rq(r,t,l){const f=this.proxy,_=nn(r)?r.includes(".")?eL(f,r):()=>f[r]:r.bind(f,f);let b;ji(t)?b=t:(b=t.handler,l=t);const T=gd(this),n=Hg(_,b.bind(f),l);return T(),n}function eL(r,t){const l=t.split(".");return()=>{let f=r;for(let _=0;_<l.length&&f;_++)f=f[l[_]];return f}}function sq(r,t,l=yn){const f=Aa(),_=hr(t),b=go(t),T=tL(r,_),n=lD((k,j)=>{let U,Z=yn,re;return QD(()=>{const se=r[_];Js(U,se)&&(U=se,j())}),{get(){return k(),l.get?l.get(U):U},set(se){const ue=l.set?l.set(se):se;if(!Js(ue,U)&&!(Z!==yn&&Js(se,Z)))return;const ne=f.vnode.props;ne&&(t in ne||_ in ne||b in ne)&&(`onUpdate:${t}`in ne||`onUpdate:${_}`in ne||`onUpdate:${b}`in ne)||(U=se,j()),f.emit(`update:${t}`,ue),Js(se,ue)&&Js(se,Z)&&!Js(ue,re)&&j(),Z=se,re=ue}}});return n[Symbol.iterator]=()=>{let k=0;return{next(){return k<2?{value:k++?T||yn:n,done:!1}:{done:!0}}}},n}const tL=(r,t)=>t==="modelValue"||t==="model-value"?r.modelModifiers:r[`${t}Modifiers`]||r[`${hr(t)}Modifiers`]||r[`${go(t)}Modifiers`];function oq(r,t,...l){if(r.isUnmounted)return;const f=r.vnode.props||yn;let _=l;const b=t.startsWith("update:"),T=b&&tL(f,t.slice(7));T&&(T.trim&&(_=l.map(U=>nn(U)?U.trim():U)),T.number&&(_=l.map(Pv)));let n,k=f[n=lp(t)]||f[n=lp(hr(t))];!k&&b&&(k=f[n=lp(go(t))]),k&&Ea(k,r,6,_);const j=f[n+"Once"];if(j){if(!r.emitted)r.emitted={};else if(r.emitted[n])return;r.emitted[n]=!0,Ea(j,r,6,_)}}function iL(r,t,l=!1){const f=t.emitsCache,_=f.get(r);if(_!==void 0)return _;const b=r.emits;let T={},n=!1;if(!ji(r)){const k=j=>{const U=iL(j,t,!0);U&&(n=!0,vn(T,U))};!l&&t.mixins.length&&t.mixins.forEach(k),r.extends&&k(r.extends),r.mixins&&r.mixins.forEach(k)}return!b&&!n?($n(r)&&f.set(r,null),null):(vi(b)?b.forEach(k=>T[k]=null):vn(T,b),$n(r)&&f.set(r,T),T)}function F1(r,t){return!r||!Ed(t)?!1:(t=t.slice(2).replace(/Once$/,""),zn(r,t[0].toLowerCase()+t.slice(1))||zn(r,go(t))||zn(r,t))}function cv(r){const{type:t,vnode:l,proxy:f,withProxy:_,propsOptions:[b],slots:T,attrs:n,emit:k,render:j,renderCache:U,props:Z,data:re,setupState:se,ctx:ue,inheritAttrs:ne}=r,be=Ag(r);let De,Be;try{if(l.shapeFlag&4){const me=_||f,Ie=me;De=mo(j.call(Ie,me,U,Z,se,re,ue)),Be=n}else{const me=t;De=mo(me.length>1?me(Z,{attrs:n,slots:T,emit:k}):me(Z,null)),Be=t.props?n:lq(n)}}catch(me){cg.length=0,Md(me,r,1),De=ur(Xr)}let Te=De;if(Be&&ne!==!1){const me=Object.keys(Be),{shapeFlag:Ie}=Te;me.length&&Ie&7&&(b&&me.some(S2)&&(Be=cq(Be,b)),Te=Cl(Te,Be,!1,!0))}return l.dirs&&(Te=Cl(Te,null,!1,!0),Te.dirs=Te.dirs?Te.dirs.concat(l.dirs):l.dirs),l.transition&&pc(Te,l.transition),De=Te,Ag(be),De}function aq(r,t=!0){let l;for(let f=0;f<r.length;f++){const _=r[f];if(mc(_)){if(_.type!==Xr||_.children==="v-if"){if(l)return;l=_}}else return}return l}const lq=r=>{let t;for(const l in r)(l==="class"||l==="style"||Ed(l))&&((t||(t={}))[l]=r[l]);return t},cq=(r,t)=>{const l={};for(const f in r)(!S2(f)||!(f.slice(9)in t))&&(l[f]=r[f]);return l};function uq(r,t,l){const{props:f,children:_,component:b}=r,{props:T,children:n,patchFlag:k}=t,j=b.emitsOptions;if(t.dirs||t.transition)return!0;if(l&&k>=0){if(k&1024)return!0;if(k&16)return f?vI(f,T,j):!!T;if(k&8){const U=t.dynamicProps;for(let Z=0;Z<U.length;Z++){const re=U[Z];if(T[re]!==f[re]&&!F1(j,re))return!0}}}else return(_||n)&&(!n||!n.$stable)?!0:f===T?!1:f?T?vI(f,T,j):!0:!!T;return!1}function vI(r,t,l){const f=Object.keys(t);if(f.length!==Object.keys(r).length)return!0;for(let _=0;_<f.length;_++){const b=f[_];if(t[b]!==r[b]&&!F1(l,b))return!0}return!1}function N1({vnode:r,parent:t},l){for(;t;){const f=t.subTree;if(f.suspense&&f.suspense.activeBranch===r&&(f.el=r.el),f===r)(r=t.vnode).el=l,t=t.parent;else break}}const Nv=r=>r.__isSuspense;let _T=0;const hq={name:"Suspense",__isSuspense:!0,process(r,t,l,f,_,b,T,n,k,j){if(r==null)fq(t,l,f,_,b,T,n,k,j);else{if(b&&b.deps>0&&!r.suspense.isInFallback){t.suspense=r.suspense,t.suspense.vnode=t,t.el=r.el;return}pq(r,t,l,f,_,T,n,k,j)}},hydrate:mq,normalize:_q},dq=hq;function Ig(r,t){const l=r.props&&r.props[t];ji(l)&&l()}function fq(r,t,l,f,_,b,T,n,k){const{p:j,o:{createElement:U}}=k,Z=U("div"),re=r.suspense=nL(r,_,f,t,Z,l,b,T,n,k);j(null,re.pendingBranch=r.ssContent,Z,null,f,re,b,T),re.deps>0?(Ig(r,"onPending"),Ig(r,"onFallback"),j(null,r.ssFallback,t,l,f,null,b,T),dp(re,r.ssFallback)):re.resolve(!1,!0)}function pq(r,t,l,f,_,b,T,n,{p:k,um:j,o:{createElement:U}}){const Z=t.suspense=r.suspense;Z.vnode=t,t.el=r.el;const re=t.ssContent,se=t.ssFallback,{activeBranch:ue,pendingBranch:ne,isInFallback:be,isHydrating:De}=Z;if(ne)Z.pendingBranch=re,Ga(re,ne)?(k(ne,re,Z.hiddenContainer,null,_,Z,b,T,n),Z.deps<=0?Z.resolve():be&&(De||(k(ue,se,l,f,_,null,b,T,n),dp(Z,se)))):(Z.pendingId=_T++,De?(Z.isHydrating=!1,Z.activeBranch=ne):j(ne,_,Z),Z.deps=0,Z.effects.length=0,Z.hiddenContainer=U("div"),be?(k(null,re,Z.hiddenContainer,null,_,Z,b,T,n),Z.deps<=0?Z.resolve():(k(ue,se,l,f,_,null,b,T,n),dp(Z,se))):ue&&Ga(re,ue)?(k(ue,re,l,f,_,Z,b,T,n),Z.resolve(!0)):(k(null,re,Z.hiddenContainer,null,_,Z,b,T,n),Z.deps<=0&&Z.resolve()));else if(ue&&Ga(re,ue))k(ue,re,l,f,_,Z,b,T,n),dp(Z,re);else if(Ig(t,"onPending"),Z.pendingBranch=re,re.shapeFlag&512?Z.pendingId=re.component.suspenseId:Z.pendingId=_T++,k(null,re,Z.hiddenContainer,null,_,Z,b,T,n),Z.deps<=0)Z.resolve();else{const{timeout:Be,pendingId:Te}=Z;Be>0?setTimeout(()=>{Z.pendingId===Te&&Z.fallback(se)},Be):Be===0&&Z.fallback(se)}}function nL(r,t,l,f,_,b,T,n,k,j,U=!1){const{p:Z,m:re,um:se,n:ue,o:{parentNode:ne,remove:be}}=j;let De;const Be=gq(r);Be&&t&&t.pendingBranch&&(De=t.pendingId,t.deps++);const Te=r.props?Rv(r.props.timeout):void 0,me=b,Ie={vnode:r,parent:t,parentComponent:l,namespace:T,container:f,hiddenContainer:_,deps:0,pendingId:_T++,timeout:typeof Te=="number"?Te:-1,activeBranch:null,pendingBranch:null,isInFallback:!U,isHydrating:U,isUnmounted:!1,effects:[],resolve(Xe=!1,je=!1){const{vnode:rt,activeBranch:Ve,pendingBranch:He,pendingId:st,effects:dt,parentComponent:At,container:ni}=Ie;let Tt=!1;Ie.isHydrating?Ie.isHydrating=!1:Xe||(Tt=Ve&&He.transition&&He.transition.mode==="out-in",Tt&&(Ve.transition.afterLeave=()=>{st===Ie.pendingId&&(re(He,ni,b===me?ue(Ve):b,0),Eg(dt))}),Ve&&(ne(Ve.el)===ni&&(b=ue(Ve)),se(Ve,At,Ie,!0)),Tt||re(He,ni,b,0)),dp(Ie,He),Ie.pendingBranch=null,Ie.isInFallback=!1;let kt=Ie.parent,ti=!1;for(;kt;){if(kt.pendingBranch){kt.effects.push(...dt),ti=!0;break}kt=kt.parent}!ti&&!Tt&&Eg(dt),Ie.effects=[],Be&&t&&t.pendingBranch&&De===t.pendingId&&(t.deps--,t.deps===0&&!je&&t.resolve()),Ig(rt,"onResolve")},fallback(Xe){if(!Ie.pendingBranch)return;const{vnode:je,activeBranch:rt,parentComponent:Ve,container:He,namespace:st}=Ie;Ig(je,"onFallback");const dt=ue(rt),At=()=>{Ie.isInFallback&&(Z(null,Xe,He,dt,Ve,null,st,n,k),dp(Ie,Xe))},ni=Xe.transition&&Xe.transition.mode==="out-in";ni&&(rt.transition.afterLeave=At),Ie.isInFallback=!0,se(rt,Ve,null,!0),ni||At()},move(Xe,je,rt){Ie.activeBranch&&re(Ie.activeBranch,Xe,je,rt),Ie.container=Xe},next(){return Ie.activeBranch&&ue(Ie.activeBranch)},registerDep(Xe,je,rt){const Ve=!!Ie.pendingBranch;Ve&&Ie.deps++;const He=Xe.vnode.el;Xe.asyncDep.catch(st=>{Md(st,Xe,0)}).then(st=>{if(Xe.isUnmounted||Ie.isUnmounted||Ie.pendingId!==Xe.suspenseId)return;Xe.asyncResolved=!0;const{vnode:dt}=Xe;xT(Xe,st,!1),He&&(dt.el=He);const At=!He&&Xe.subTree.el;je(Xe,dt,ne(He||Xe.subTree.el),He?null:ue(Xe.subTree),Ie,T,rt),At&&be(At),N1(Xe,dt.el),Ve&&--Ie.deps===0&&Ie.resolve()})},unmount(Xe,je){Ie.isUnmounted=!0,Ie.activeBranch&&se(Ie.activeBranch,l,Xe,je),Ie.pendingBranch&&se(Ie.pendingBranch,l,Xe,je)}};return Ie}function mq(r,t,l,f,_,b,T,n,k){const j=t.suspense=nL(t,f,l,r.parentNode,document.createElement("div"),null,_,b,T,n,!0),U=k(r,j.pendingBranch=t.ssContent,l,j,b,T);return j.deps===0&&j.resolve(!1,!0),U}function _q(r){const{shapeFlag:t,children:l}=r,f=t&32;r.ssContent=xI(f?l.default:l),r.ssFallback=f?xI(l.fallback):ur(Xr)}function xI(r){let t;if(ji(r)){const l=_d&&r._c;l&&(r._d=!1,Dt()),r=r(),l&&(r._d=!0,t=Ns,sL())}return vi(r)&&(r=aq(r)),r=mo(r),t&&!r.dynamicChildren&&(r.dynamicChildren=t.filter(l=>l!==r)),r}function rL(r,t){t&&t.pendingBranch?vi(r)?t.effects.push(...r):t.effects.push(r):Eg(r)}function dp(r,t){r.activeBranch=t;const{vnode:l,parentComponent:f}=r;let _=t.el;for(;!_&&t.component;)t=t.component.subTree,_=t.el;l.el=_,f&&f.subTree===l&&(f.vnode.el=_,N1(f,_))}function gq(r){const t=r.props&&r.props.suspensible;return t!=null&&t!==!1}const Oi=Symbol.for("v-fgt"),bu=Symbol.for("v-txt"),Xr=Symbol.for("v-cmt"),ld=Symbol.for("v-stc"),cg=[];let Ns=null;function Dt(r=!1){cg.push(Ns=r?null:[])}function sL(){cg.pop(),Ns=cg[cg.length-1]||null}let _d=1;function gT(r,t=!1){_d+=r,r<0&&Ns&&t&&(Ns.hasOnce=!0)}function oL(r){return r.dynamicChildren=_d>0?Ns||op:null,sL(),_d>0&&Ns&&Ns.push(r),r}function Ot(r,t,l,f,_,b){return oL(W(r,t,l,f,_,b,!0))}function Bv(r,t,l,f,_){return oL(ur(r,t,l,f,_,!0))}function mc(r){return r?r.__v_isVNode===!0:!1}function Ga(r,t){return r.type===t.type&&r.key===t.key}function yq(r){}const aL=({key:r})=>r??null,uv=({ref:r,ref_key:t,ref_for:l})=>(typeof r=="number"&&(r=""+r),r!=null?nn(r)||cs(r)||ji(r)?{i:ls,r,k:t,f:!!l}:r:null);function W(r,t=null,l=null,f=0,_=null,b=r===Oi?0:1,T=!1,n=!1){const k={__v_isVNode:!0,__v_skip:!0,type:r,props:t,key:t&&aL(t),ref:t&&uv(t),scopeId:R1,slotScopeIds:null,children:l,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:b,patchFlag:f,dynamicProps:_,dynamicChildren:null,appContext:null,ctx:ls};return n?(Z2(k,l),b&128&&r.normalize(k)):l&&(k.shapeFlag|=nn(l)?8:16),_d>0&&!T&&Ns&&(k.patchFlag>0||b&6)&&k.patchFlag!==32&&Ns.push(k),k}const ur=vq;function vq(r,t=null,l=null,f=0,_=null,b=!1){if((!r||r===DD)&&(r=Xr),mc(r)){const n=Cl(r,t,!0);return l&&Z2(n,l),_d>0&&!b&&Ns&&(n.shapeFlag&6?Ns[Ns.indexOf(r)]=n:Ns.push(n)),n.patchFlag=-2,n}if(Sq(r)&&(r=r.__vccOpts),t){t=lL(t);let{class:n,style:k}=t;n&&!nn(n)&&(t.class=md(n)),$n(k)&&(C1(k)&&!vi(k)&&(k=vn({},k)),t.style=Es(k))}const T=nn(r)?1:Nv(r)?128:gD(r)?64:$n(r)?4:ji(r)?2:0;return W(r,t,l,f,_,T,b,!0)}function lL(r){return r?C1(r)||BD(r)?vn({},r):r:null}function Cl(r,t,l=!1,f=!1){const{props:_,ref:b,patchFlag:T,children:n,transition:k}=r,j=t?cL(_||{},t):_,U={__v_isVNode:!0,__v_skip:!0,type:r.type,props:j,key:j&&aL(j),ref:t&&t.ref?l&&b?vi(b)?b.concat(uv(t)):[b,uv(t)]:uv(t):b,scopeId:r.scopeId,slotScopeIds:r.slotScopeIds,children:n,target:r.target,targetStart:r.targetStart,targetAnchor:r.targetAnchor,staticCount:r.staticCount,shapeFlag:r.shapeFlag,patchFlag:t&&r.type!==Oi?T===-1?16:T|16:T,dynamicProps:r.dynamicProps,dynamicChildren:r.dynamicChildren,appContext:r.appContext,dirs:r.dirs,transition:k,component:r.component,suspense:r.suspense,ssContent:r.ssContent&&Cl(r.ssContent),ssFallback:r.ssFallback&&Cl(r.ssFallback),el:r.el,anchor:r.anchor,ctx:r.ctx,ce:r.ce};return k&&f&&pc(U,k.clone(U)),U}function us(r=" ",t=0){return ur(bu,null,r,t)}function B1(r,t){const l=ur(ld,null,r);return l.staticCount=t,l}function Pr(r="",t=!1){return t?(Dt(),Bv(Xr,null,r)):ur(Xr,null,r)}function mo(r){return r==null||typeof r=="boolean"?ur(Xr):vi(r)?ur(Oi,null,r.slice()):mc(r)?hu(r):ur(bu,null,String(r))}function hu(r){return r.el===null&&r.patchFlag!==-1||r.memo?r:Cl(r)}function Z2(r,t){let l=0;const{shapeFlag:f}=r;if(t==null)t=null;else if(vi(t))l=16;else if(typeof t=="object")if(f&65){const _=t.default;_&&(_._c&&(_._d=!1),Z2(r,_()),_._c&&(_._d=!0));return}else{l=32;const _=t._;!_&&!BD(t)?t._ctx=ls:_===3&&ls&&(ls.slots._===1?t._=1:(t._=2,r.patchFlag|=1024))}else ji(t)?(t={default:t,_ctx:ls},l=32):(t=String(t),f&64?(l=16,t=[us(t)]):l=8);r.children=t,r.shapeFlag|=l}function cL(...r){const t={};for(let l=0;l<r.length;l++){const f=r[l];for(const _ in f)if(_==="class")t.class!==f.class&&(t.class=md([t.class,f.class]));else if(_==="style")t.style=Es([t.style,f.style]);else if(Ed(_)){const b=t[_],T=f[_];T&&b!==T&&!(vi(b)&&b.includes(T))&&(t[_]=b?[].concat(b,T):T)}else _!==""&&(t[_]=f[_])}return t}function po(r,t,l,f=null){Ea(r,t,7,[l,f])}const xq=zD();let bq=0;function uL(r,t,l){const f=r.type,_=(t?t.appContext:r.appContext)||xq,b={uid:bq++,vnode:r,type:f,parent:t,appContext:_,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new I2(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(_.provides),ids:t?t.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:UD(f,_),emitsOptions:iL(f,_),emit:null,emitted:null,propsDefaults:yn,inheritAttrs:f.inheritAttrs,ctx:yn,data:yn,props:yn,attrs:yn,slots:yn,refs:yn,setupState:yn,setupContext:null,suspense:l,suspenseId:l?l.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return b.ctx={_:b},b.root=t?t.root:b,b.emit=oq.bind(null,b),r.ce&&r.ce(b),b}let as=null;const Aa=()=>as||ls;let Vv,yT;{const r=b1(),t=(l,f)=>{let _;return(_=r[l])||(_=r[l]=[]),_.push(f),b=>{_.length>1?_.forEach(T=>T(b)):_[0](b)}};Vv=t("__VUE_INSTANCE_SETTERS__",l=>as=l),yT=t("__VUE_SSR_SETTERS__",l=>Ap=l)}const gd=r=>{const t=as;return Vv(r),r.scope.on(),()=>{r.scope.off(),Vv(t)}},vT=()=>{as&&as.scope.off(),Vv(null)};function hL(r){return r.vnode.shapeFlag&4}let Ap=!1;function dL(r,t=!1,l=!1){t&&yT(t);const{props:f,children:_}=r.vnode,b=hL(r);X8(r,f,b,t),Q8(r,_,l);const T=b?wq(r,t):void 0;return t&&yT(!1),T}function wq(r,t){const l=r.type;r.accessCache=Object.create(null),r.proxy=new Proxy(r.ctx,dT);const{setup:f}=l;if(f){zu();const _=r.setupContext=f.length>1?mL(r):null,b=gd(r),T=Vp(f,r,0,[r.props,_]),n=M2(T);if(ku(),b(),(n||r.sp)&&!xu(r)&&V2(r),n){if(T.then(vT,vT),t)return T.then(k=>{xT(r,k,t)}).catch(k=>{Md(k,r,0)});r.asyncDep=T}else xT(r,T,t)}else pL(r,t)}function xT(r,t,l){ji(t)?r.type.__ssrInlineRender?r.ssrRender=t:r.render=t:$n(t)&&(r.setupState=O2(t)),pL(r,l)}let Uv,bT;function fL(r){Uv=r,bT=t=>{t.render._rc&&(t.withProxy=new Proxy(t.ctx,M8))}}const Tq=()=>!Uv;function pL(r,t,l){const f=r.type;if(!r.render){if(!t&&Uv&&!f.render){const _=f.template||H2(r).template;if(_){const{isCustomElement:b,compilerOptions:T}=r.appContext.config,{delimiters:n,compilerOptions:k}=f,j=vn(vn({isCustomElement:b,delimiters:n},T),k);f.render=Uv(_,j)}}r.render=f.render||_s,bT&&bT(r)}{const _=gd(r);zu();try{U8(r)}finally{ku(),_()}}}const Eq={get(r,t){return Os(r,"get",""),r[t]}};function mL(r){const t=l=>{r.exposed=l||{}};return{attrs:new Proxy(r.attrs,Eq),slots:r.slots,emit:r.emit,expose:t}}function Gg(r){return r.exposed?r.exposeProxy||(r.exposeProxy=new Proxy(O2(sD(r.exposed)),{get(t,l){if(l in t)return t[l];if(l in ag)return ag[l](r)},has(t,l){return l in t||l in ag}})):r.proxy}function wT(r,t=!0){return ji(r)?r.displayName||r.name:r.name||t&&r.__name}function Sq(r){return ji(r)&&"__vccOpts"in r}const _L=(r,t)=>N$(r,t,Ap);function gL(r,t,l){const f=arguments.length;return f===2?$n(t)&&!vi(t)?mc(t)?ur(r,null,[t]):ur(r,t):ur(r,null,t):(f>3?l=Array.prototype.slice.call(arguments,2):f===3&&mc(l)&&(l=[l]),ur(r,t,l))}function Aq(){}function Mq(r,t,l,f){const _=l[f];if(_&&yL(_,r))return _;const b=t();return b.memo=r.slice(),b.cacheIndex=f,l[f]=b}function yL(r,t){const l=r.memo;if(l.length!=t.length)return!1;for(let f=0;f<l.length;f++)if(Js(l[f],t[f]))return!1;return _d>0&&Ns&&Ns.push(r),!0}const vL="3.5.13",Cq=_s,Iq=W$,Pq=Jf,Rq=mD,Dq={createComponentInstance:uL,setupComponent:dL,renderComponentRoot:cv,setCurrentRenderingInstance:Ag,isVNode:mc,normalizeVNode:mo,getComponentPublicInstance:Gg,ensureValidVNode:q2,pushWarningContext:$$,popWarningContext:q$},Lq=Dq,Oq=null,zq=null,kq=null;/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let TT;const bI=typeof window<"u"&&window.trustedTypes;if(bI)try{TT=bI.createPolicy("vue",{createHTML:r=>r})}catch{}const xL=TT?r=>TT.createHTML(r):r=>r,Fq="http://www.w3.org/2000/svg",Nq="http://www.w3.org/1998/Math/MathML",nc=typeof document<"u"?document:null,wI=nc&&nc.createElement("template"),Bq={insert:(r,t,l)=>{t.insertBefore(r,l||null)},remove:r=>{const t=r.parentNode;t&&t.removeChild(r)},createElement:(r,t,l,f)=>{const _=t==="svg"?nc.createElementNS(Fq,r):t==="mathml"?nc.createElementNS(Nq,r):l?nc.createElement(r,{is:l}):nc.createElement(r);return r==="select"&&f&&f.multiple!=null&&_.setAttribute("multiple",f.multiple),_},createText:r=>nc.createTextNode(r),createComment:r=>nc.createComment(r),setText:(r,t)=>{r.nodeValue=t},setElementText:(r,t)=>{r.textContent=t},parentNode:r=>r.parentNode,nextSibling:r=>r.nextSibling,querySelector:r=>nc.querySelector(r),setScopeId(r,t){r.setAttribute(t,"")},insertStaticContent(r,t,l,f,_,b){const T=l?l.previousSibling:t.lastChild;if(_&&(_===b||_.nextSibling))for(;t.insertBefore(_.cloneNode(!0),l),!(_===b||!(_=_.nextSibling)););else{wI.innerHTML=xL(f==="svg"?`<svg>${r}</svg>`:f==="mathml"?`<math>${r}</math>`:r);const n=wI.content;if(f==="svg"||f==="mathml"){const k=n.firstChild;for(;k.firstChild;)n.appendChild(k.firstChild);n.removeChild(k)}t.insertBefore(n,l)}return[T?T.nextSibling:t.firstChild,l?l.previousSibling:t.lastChild]}},ru="transition",H_="animation",Mp=Symbol("_vtc"),bL={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},wL=vn({},N2,bL),Vq=r=>(r.displayName="Transition",r.props=wL,r),Uq=Vq((r,{slots:t})=>gL(wD,TL(r),t)),$h=(r,t=[])=>{vi(r)?r.forEach(l=>l(...t)):r&&r(...t)},TI=r=>r?vi(r)?r.some(t=>t.length>1):r.length>1:!1;function TL(r){const t={};for(const dt in r)dt in bL||(t[dt]=r[dt]);if(r.css===!1)return t;const{name:l="v",type:f,duration:_,enterFromClass:b=`${l}-enter-from`,enterActiveClass:T=`${l}-enter-active`,enterToClass:n=`${l}-enter-to`,appearFromClass:k=b,appearActiveClass:j=T,appearToClass:U=n,leaveFromClass:Z=`${l}-leave-from`,leaveActiveClass:re=`${l}-leave-active`,leaveToClass:se=`${l}-leave-to`}=r,ue=jq(_),ne=ue&&ue[0],be=ue&&ue[1],{onBeforeEnter:De,onEnter:Be,onEnterCancelled:Te,onLeave:me,onLeaveCancelled:Ie,onBeforeAppear:Xe=De,onAppear:je=Be,onAppearCancelled:rt=Te}=t,Ve=(dt,At,ni,Tt)=>{dt._enterCancelled=Tt,au(dt,At?U:n),au(dt,At?j:T),ni&&ni()},He=(dt,At)=>{dt._isLeaving=!1,au(dt,Z),au(dt,se),au(dt,re),At&&At()},st=dt=>(At,ni)=>{const Tt=dt?je:Be,kt=()=>Ve(At,dt,ni);$h(Tt,[At,kt]),EI(()=>{au(At,dt?k:b),_l(At,dt?U:n),TI(Tt)||SI(At,f,ne,kt)})};return vn(t,{onBeforeEnter(dt){$h(De,[dt]),_l(dt,b),_l(dt,T)},onBeforeAppear(dt){$h(Xe,[dt]),_l(dt,k),_l(dt,j)},onEnter:st(!1),onAppear:st(!0),onLeave(dt,At){dt._isLeaving=!0;const ni=()=>He(dt,At);_l(dt,Z),dt._enterCancelled?(_l(dt,re),ET()):(ET(),_l(dt,re)),EI(()=>{dt._isLeaving&&(au(dt,Z),_l(dt,se),TI(me)||SI(dt,f,be,ni))}),$h(me,[dt,ni])},onEnterCancelled(dt){Ve(dt,!1,void 0,!0),$h(Te,[dt])},onAppearCancelled(dt){Ve(dt,!0,void 0,!0),$h(rt,[dt])},onLeaveCancelled(dt){He(dt),$h(Ie,[dt])}})}function jq(r){if(r==null)return null;if($n(r))return[Sw(r.enter),Sw(r.leave)];{const t=Sw(r);return[t,t]}}function Sw(r){return Rv(r)}function _l(r,t){t.split(/\s+/).forEach(l=>l&&r.classList.add(l)),(r[Mp]||(r[Mp]=new Set)).add(t)}function au(r,t){t.split(/\s+/).forEach(f=>f&&r.classList.remove(f));const l=r[Mp];l&&(l.delete(t),l.size||(r[Mp]=void 0))}function EI(r){requestAnimationFrame(()=>{requestAnimationFrame(r)})}let $q=0;function SI(r,t,l,f){const _=r._endId=++$q,b=()=>{_===r._endId&&f()};if(l!=null)return setTimeout(b,l);const{type:T,timeout:n,propCount:k}=EL(r,t);if(!T)return f();const j=T+"end";let U=0;const Z=()=>{r.removeEventListener(j,re),b()},re=se=>{se.target===r&&++U>=k&&Z()};setTimeout(()=>{U<k&&Z()},n+1),r.addEventListener(j,re)}function EL(r,t){const l=window.getComputedStyle(r),f=ue=>(l[ue]||"").split(", "),_=f(`${ru}Delay`),b=f(`${ru}Duration`),T=AI(_,b),n=f(`${H_}Delay`),k=f(`${H_}Duration`),j=AI(n,k);let U=null,Z=0,re=0;t===ru?T>0&&(U=ru,Z=T,re=b.length):t===H_?j>0&&(U=H_,Z=j,re=k.length):(Z=Math.max(T,j),U=Z>0?T>j?ru:H_:null,re=U?U===ru?b.length:k.length:0);const se=U===ru&&/\b(transform|all)(,|$)/.test(f(`${ru}Property`).toString());return{type:U,timeout:Z,propCount:re,hasTransform:se}}function AI(r,t){for(;r.length<t.length;)r=r.concat(r);return Math.max(...t.map((l,f)=>MI(l)+MI(r[f])))}function MI(r){return r==="auto"?0:Number(r.slice(0,-1).replace(",","."))*1e3}function ET(){return document.body.offsetHeight}function qq(r,t,l){const f=r[Mp];f&&(t=(t?[t,...f]:[...f]).join(" ")),t==null?r.removeAttribute("class"):l?r.setAttribute("class",t):r.className=t}const jv=Symbol("_vod"),SL=Symbol("_vsh"),AL={beforeMount(r,{value:t},{transition:l}){r[jv]=r.style.display==="none"?"":r.style.display,l&&t?l.beforeEnter(r):G_(r,t)},mounted(r,{value:t},{transition:l}){l&&t&&l.enter(r)},updated(r,{value:t,oldValue:l},{transition:f}){!t!=!l&&(f?t?(f.beforeEnter(r),G_(r,!0),f.enter(r)):f.leave(r,()=>{G_(r,!1)}):G_(r,t))},beforeUnmount(r,{value:t}){G_(r,t)}};function G_(r,t){r.style.display=t?r[jv]:"none",r[SL]=!t}function Hq(){AL.getSSRProps=({value:r})=>{if(!r)return{style:{display:"none"}}}}const ML=Symbol("");function Gq(r){const t=Aa();if(!t)return;const l=t.ut=(_=r(t.proxy))=>{Array.from(document.querySelectorAll(`[data-v-owner="${t.uid}"]`)).forEach(b=>$v(b,_))},f=()=>{const _=r(t.proxy);t.ce?$v(t.ce,_):ST(t.subTree,_),l(_)};U2(()=>{Eg(f)}),qg(()=>{hp(f,_s,{flush:"post"});const _=new MutationObserver(f);_.observe(t.subTree.el.parentNode,{childList:!0}),k1(()=>_.disconnect())})}function ST(r,t){if(r.shapeFlag&128){const l=r.suspense;r=l.activeBranch,l.pendingBranch&&!l.isHydrating&&l.effects.push(()=>{ST(l.activeBranch,t)})}for(;r.component;)r=r.component.subTree;if(r.shapeFlag&1&&r.el)$v(r.el,t);else if(r.type===Oi)r.children.forEach(l=>ST(l,t));else if(r.type===ld){let{el:l,anchor:f}=r;for(;l&&($v(l,t),l!==f);)l=l.nextSibling}}function $v(r,t){if(r.nodeType===1){const l=r.style;let f="";for(const _ in t)l.setProperty(`--${_}`,t[_]),f+=`--${_}: ${t[_]};`;l[ML]=f}}const Wq=/(^|;)\s*display\s*:/;function Zq(r,t,l){const f=r.style,_=nn(l);let b=!1;if(l&&!_){if(t)if(nn(t))for(const T of t.split(";")){const n=T.slice(0,T.indexOf(":")).trim();l[n]==null&&hv(f,n,"")}else for(const T in t)l[T]==null&&hv(f,T,"");for(const T in l)T==="display"&&(b=!0),hv(f,T,l[T])}else if(_){if(t!==l){const T=f[ML];T&&(l+=";"+T),f.cssText=l,b=Wq.test(l)}}else t&&r.removeAttribute("style");jv in r&&(r[jv]=b?f.display:"",r[SL]&&(f.display="none"))}const CI=/\s*!important$/;function hv(r,t,l){if(vi(l))l.forEach(f=>hv(r,t,f));else if(l==null&&(l=""),t.startsWith("--"))r.setProperty(t,l);else{const f=Xq(r,t);CI.test(l)?r.setProperty(go(f),l.replace(CI,""),"important"):r[f]=l}}const II=["Webkit","Moz","ms"],Aw={};function Xq(r,t){const l=Aw[t];if(l)return l;let f=hr(t);if(f!=="filter"&&f in r)return Aw[t]=f;f=Ad(f);for(let _=0;_<II.length;_++){const b=II[_]+f;if(b in r)return Aw[t]=b}return t}const PI="http://www.w3.org/1999/xlink";function RI(r,t,l,f,_,b=i$(t)){f&&t.startsWith("xlink:")?l==null?r.removeAttributeNS(PI,t.slice(6,t.length)):r.setAttributeNS(PI,t,l):l==null||b&&!B3(l)?r.removeAttribute(t):r.setAttribute(t,b?"":Eo(l)?String(l):l)}function DI(r,t,l,f,_){if(t==="innerHTML"||t==="textContent"){l!=null&&(r[t]=t==="innerHTML"?xL(l):l);return}const b=r.tagName;if(t==="value"&&b!=="PROGRESS"&&!b.includes("-")){const n=b==="OPTION"?r.getAttribute("value")||"":r.value,k=l==null?r.type==="checkbox"?"on":"":String(l);(n!==k||!("_value"in r))&&(r.value=k),l==null&&r.removeAttribute(t),r._value=l;return}let T=!1;if(l===""||l==null){const n=typeof r[t];n==="boolean"?l=B3(l):l==null&&n==="string"?(l="",T=!0):n==="number"&&(l=0,T=!0)}try{r[t]=l}catch{}T&&r.removeAttribute(_||t)}function ac(r,t,l,f){r.addEventListener(t,l,f)}function Yq(r,t,l,f){r.removeEventListener(t,l,f)}const LI=Symbol("_vei");function Kq(r,t,l,f,_=null){const b=r[LI]||(r[LI]={}),T=b[t];if(f&&T)T.value=f;else{const[n,k]=Jq(t);if(f){const j=b[t]=tH(f,_);ac(r,n,j,k)}else T&&(Yq(r,n,T,k),b[t]=void 0)}}const OI=/(?:Once|Passive|Capture)$/;function Jq(r){let t;if(OI.test(r)){t={};let f;for(;f=r.match(OI);)r=r.slice(0,r.length-f[0].length),t[f[0].toLowerCase()]=!0}return[r[2]===":"?r.slice(3):go(r.slice(2)),t]}let Mw=0;const Qq=Promise.resolve(),eH=()=>Mw||(Qq.then(()=>Mw=0),Mw=Date.now());function tH(r,t){const l=f=>{if(!f._vts)f._vts=Date.now();else if(f._vts<=l.attached)return;Ea(iH(f,l.value),t,5,[f])};return l.value=r,l.attached=eH(),l}function iH(r,t){if(vi(t)){const l=r.stopImmediatePropagation;return r.stopImmediatePropagation=()=>{l.call(r),r._stopped=!0},t.map(f=>_=>!_._stopped&&f&&f(_))}else return t}const zI=r=>r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&r.charCodeAt(2)>96&&r.charCodeAt(2)<123,nH=(r,t,l,f,_,b)=>{const T=_==="svg";t==="class"?qq(r,f,T):t==="style"?Zq(r,l,f):Ed(t)?S2(t)||Kq(r,t,l,f,b):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):rH(r,t,f,T))?(DI(r,t,f),!r.tagName.includes("-")&&(t==="value"||t==="checked"||t==="selected")&&RI(r,t,f,T,b,t!=="value")):r._isVueCE&&(/[A-Z]/.test(t)||!nn(f))?DI(r,hr(t),f,b,t):(t==="true-value"?r._trueValue=f:t==="false-value"&&(r._falseValue=f),RI(r,t,f,T))};function rH(r,t,l,f){if(f)return!!(t==="innerHTML"||t==="textContent"||t in r&&zI(t)&&ji(l));if(t==="spellcheck"||t==="draggable"||t==="translate"||t==="form"||t==="list"&&r.tagName==="INPUT"||t==="type"&&r.tagName==="TEXTAREA")return!1;if(t==="width"||t==="height"){const _=r.tagName;if(_==="IMG"||_==="VIDEO"||_==="CANVAS"||_==="SOURCE")return!1}return zI(t)&&nn(l)?!1:t in r}const kI={};/*! #__NO_SIDE_EFFECTS__ */function CL(r,t,l){const f=B2(r,t);v1(f)&&vn(f,t);class _ extends V1{constructor(T){super(f,T,l)}}return _.def=f,_}/*! #__NO_SIDE_EFFECTS__ */const sH=(r,t)=>CL(r,t,BL),oH=typeof HTMLElement<"u"?HTMLElement:class{};class V1 extends oH{constructor(t,l={},f=Hv){super(),this._def=t,this._props=l,this._createApp=f,this._isVueCE=!0,this._instance=null,this._app=null,this._nonce=this._def.nonce,this._connected=!1,this._resolved=!1,this._numberProps=null,this._styleChildren=new WeakSet,this._ob=null,this.shadowRoot&&f!==Hv?this._root=this.shadowRoot:t.shadowRoot!==!1?(this.attachShadow({mode:"open"}),this._root=this.shadowRoot):this._root=this,this._def.__asyncLoader||this._resolveProps(this._def)}connectedCallback(){if(!this.isConnected)return;this.shadowRoot||this._parseSlots(),this._connected=!0;let t=this;for(;t=t&&(t.parentNode||t.host);)if(t instanceof V1){this._parent=t;break}this._instance||(this._resolved?(this._setParent(),this._update()):t&&t._pendingResolve?this._pendingResolve=t._pendingResolve.then(()=>{this._pendingResolve=void 0,this._resolveDef()}):this._resolveDef())}_setParent(t=this._parent){t&&(this._instance.parent=t._instance,this._instance.provides=t._instance.provides)}disconnectedCallback(){this._connected=!1,P1(()=>{this._connected||(this._ob&&(this._ob.disconnect(),this._ob=null),this._app&&this._app.unmount(),this._instance&&(this._instance.ce=void 0),this._app=this._instance=null)})}_resolveDef(){if(this._pendingResolve)return;for(let f=0;f<this.attributes.length;f++)this._setAttr(this.attributes[f].name);this._ob=new MutationObserver(f=>{for(const _ of f)this._setAttr(_.attributeName)}),this._ob.observe(this,{attributes:!0});const t=(f,_=!1)=>{this._resolved=!0,this._pendingResolve=void 0;const{props:b,styles:T}=f;let n;if(b&&!vi(b))for(const k in b){const j=b[k];(j===Number||j&&j.type===Number)&&(k in this._props&&(this._props[k]=Rv(this._props[k])),(n||(n=Object.create(null)))[hr(k)]=!0)}this._numberProps=n,_&&this._resolveProps(f),this.shadowRoot&&this._applyStyles(T),this._mount(f)},l=this._def.__asyncLoader;l?this._pendingResolve=l().then(f=>t(this._def=f,!0)):t(this._def)}_mount(t){this._app=this._createApp(t),t.configureApp&&t.configureApp(this._app),this._app._ceVNode=this._createVNode(),this._app.mount(this._root);const l=this._instance&&this._instance.exposed;if(l)for(const f in l)zn(this,f)||Object.defineProperty(this,f,{get:()=>I1(l[f])})}_resolveProps(t){const{props:l}=t,f=vi(l)?l:Object.keys(l||{});for(const _ of Object.keys(this))_[0]!=="_"&&f.includes(_)&&this._setProp(_,this[_]);for(const _ of f.map(hr))Object.defineProperty(this,_,{get(){return this._getProp(_)},set(b){this._setProp(_,b,!0,!0)}})}_setAttr(t){if(t.startsWith("data-v-"))return;const l=this.hasAttribute(t);let f=l?this.getAttribute(t):kI;const _=hr(t);l&&this._numberProps&&this._numberProps[_]&&(f=Rv(f)),this._setProp(_,f,!1,!0)}_getProp(t){return this._props[t]}_setProp(t,l,f=!0,_=!1){if(l!==this._props[t]&&(l===kI?delete this._props[t]:(this._props[t]=l,t==="key"&&this._app&&(this._app._ceVNode.key=l)),_&&this._instance&&this._update(),f)){const b=this._ob;b&&b.disconnect(),l===!0?this.setAttribute(go(t),""):typeof l=="string"||typeof l=="number"?this.setAttribute(go(t),l+""):l||this.removeAttribute(go(t)),b&&b.observe(this,{attributes:!0})}}_update(){NL(this._createVNode(),this._root)}_createVNode(){const t={};this.shadowRoot||(t.onVnodeMounted=t.onVnodeUpdated=this._renderSlots.bind(this));const l=ur(this._def,vn(t,this._props));return this._instance||(l.ce=f=>{this._instance=f,f.ce=this,f.isCE=!0;const _=(b,T)=>{this.dispatchEvent(new CustomEvent(b,v1(T[0])?vn({detail:T},T[0]):{detail:T}))};f.emit=(b,...T)=>{_(b,T),go(b)!==b&&_(go(b),T)},this._setParent()}),l}_applyStyles(t,l){if(!t)return;if(l){if(l===this._def||this._styleChildren.has(l))return;this._styleChildren.add(l)}const f=this._nonce;for(let _=t.length-1;_>=0;_--){const b=document.createElement("style");f&&b.setAttribute("nonce",f),b.textContent=t[_],this.shadowRoot.prepend(b)}}_parseSlots(){const t=this._slots={};let l;for(;l=this.firstChild;){const f=l.nodeType===1&&l.getAttribute("slot")||"default";(t[f]||(t[f]=[])).push(l),this.removeChild(l)}}_renderSlots(){const t=(this._teleportTarget||this).querySelectorAll("slot"),l=this._instance.type.__scopeId;for(let f=0;f<t.length;f++){const _=t[f],b=_.getAttribute("name")||"default",T=this._slots[b],n=_.parentNode;if(T)for(const k of T){if(l&&k.nodeType===1){const j=l+"-s",U=document.createTreeWalker(k,1);k.setAttribute(j,"");let Z;for(;Z=U.nextNode();)Z.setAttribute(j,"")}n.insertBefore(k,_)}else for(;_.firstChild;)n.insertBefore(_.firstChild,_);n.removeChild(_)}}_injectChildStyle(t){this._applyStyles(t.styles,t)}_removeChildStyle(t){}}function IL(r){const t=Aa(),l=t&&t.ce;return l||null}function aH(){const r=IL();return r&&r.shadowRoot}function lH(r="$style"){{const t=Aa();if(!t)return yn;const l=t.type.__cssModules;if(!l)return yn;const f=l[r];return f||yn}}const PL=new WeakMap,RL=new WeakMap,qv=Symbol("_moveCb"),FI=Symbol("_enterCb"),cH=r=>(delete r.props.mode,r),uH=cH({name:"TransitionGroup",props:vn({},wL,{tag:String,moveClass:String}),setup(r,{slots:t}){const l=Aa(),f=F2();let _,b;return O1(()=>{if(!_.length)return;const T=r.moveClass||`${r.name||"v"}-move`;if(!mH(_[0].el,l.vnode.el,T))return;_.forEach(dH),_.forEach(fH);const n=_.filter(pH);ET(),n.forEach(k=>{const j=k.el,U=j.style;_l(j,T),U.transform=U.webkitTransform=U.transitionDuration="";const Z=j[qv]=re=>{re&&re.target!==j||(!re||/transform$/.test(re.propertyName))&&(j.removeEventListener("transitionend",Z),j[qv]=null,au(j,T))};j.addEventListener("transitionend",Z)})}),()=>{const T=In(r),n=TL(T);let k=T.tag||Oi;if(_=[],b)for(let j=0;j<b.length;j++){const U=b[j];U.el&&U.el instanceof Element&&(_.push(U),pc(U,Sp(U,n,f,l)),PL.set(U,U.el.getBoundingClientRect()))}b=t.default?D1(t.default()):[];for(let j=0;j<b.length;j++){const U=b[j];U.key!=null&&pc(U,Sp(U,n,f,l))}return ur(k,null,b)}}}),hH=uH;function dH(r){const t=r.el;t[qv]&&t[qv](),t[FI]&&t[FI]()}function fH(r){RL.set(r,r.el.getBoundingClientRect())}function pH(r){const t=PL.get(r),l=RL.get(r),f=t.left-l.left,_=t.top-l.top;if(f||_){const b=r.el.style;return b.transform=b.webkitTransform=`translate(${f}px,${_}px)`,b.transitionDuration="0s",r}}function mH(r,t,l){const f=r.cloneNode(),_=r[Mp];_&&_.forEach(n=>{n.split(/\s+/).forEach(k=>k&&f.classList.remove(k))}),l.split(/\s+/).forEach(n=>n&&f.classList.add(n)),f.style.display="none";const b=t.nodeType===1?t:t.parentNode;b.appendChild(f);const{hasTransform:T}=EL(f);return b.removeChild(f),T}const Pu=r=>{const t=r.props["onUpdate:modelValue"]||!1;return vi(t)?l=>cp(t,l):t};function _H(r){r.target.composing=!0}function NI(r){const t=r.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}const ba=Symbol("_assign"),gn={created(r,{modifiers:{lazy:t,trim:l,number:f}},_){r[ba]=Pu(_);const b=f||_.props&&_.props.type==="number";ac(r,t?"change":"input",T=>{if(T.target.composing)return;let n=r.value;l&&(n=n.trim()),b&&(n=Pv(n)),r[ba](n)}),l&&ac(r,"change",()=>{r.value=r.value.trim()}),t||(ac(r,"compositionstart",_H),ac(r,"compositionend",NI),ac(r,"change",NI))},mounted(r,{value:t}){r.value=t??""},beforeUpdate(r,{value:t,oldValue:l,modifiers:{lazy:f,trim:_,number:b}},T){if(r[ba]=Pu(T),r.composing)return;const n=(b||r.type==="number")&&!/^0\d/.test(r.value)?Pv(r.value):r.value,k=t??"";n!==k&&(document.activeElement===r&&r.type!=="range"&&(f&&t===l||_&&r.value.trim()===k)||(r.value=k))}},X2={deep:!0,created(r,t,l){r[ba]=Pu(l),ac(r,"change",()=>{const f=r._modelValue,_=Cp(r),b=r.checked,T=r[ba];if(vi(f)){const n=w1(f,_),k=n!==-1;if(b&&!k)T(f.concat(_));else if(!b&&k){const j=[...f];j.splice(n,1),T(j)}}else if(Sd(f)){const n=new Set(f);b?n.add(_):n.delete(_),T(n)}else T(DL(r,b))})},mounted:BI,beforeUpdate(r,t,l){r[ba]=Pu(l),BI(r,t,l)}};function BI(r,{value:t,oldValue:l},f){r._modelValue=t;let _;if(vi(t))_=w1(t,f.props.value)>-1;else if(Sd(t))_=t.has(f.props.value);else{if(t===l)return;_=Cu(t,DL(r,!0))}r.checked!==_&&(r.checked=_)}const Y2={created(r,{value:t},l){r.checked=Cu(t,l.props.value),r[ba]=Pu(l),ac(r,"change",()=>{r[ba](Cp(r))})},beforeUpdate(r,{value:t,oldValue:l},f){r[ba]=Pu(f),t!==l&&(r.checked=Cu(t,f.props.value))}},yd={deep:!0,created(r,{value:t,modifiers:{number:l}},f){const _=Sd(t);ac(r,"change",()=>{const b=Array.prototype.filter.call(r.options,T=>T.selected).map(T=>l?Pv(Cp(T)):Cp(T));r[ba](r.multiple?_?new Set(b):b:b[0]),r._assigning=!0,P1(()=>{r._assigning=!1})}),r[ba]=Pu(f)},mounted(r,{value:t}){VI(r,t)},beforeUpdate(r,t,l){r[ba]=Pu(l)},updated(r,{value:t}){r._assigning||VI(r,t)}};function VI(r,t){const l=r.multiple,f=vi(t);if(!(l&&!f&&!Sd(t))){for(let _=0,b=r.options.length;_<b;_++){const T=r.options[_],n=Cp(T);if(l)if(f){const k=typeof n;k==="string"||k==="number"?T.selected=t.some(j=>String(j)===String(n)):T.selected=w1(t,n)>-1}else T.selected=t.has(n);else if(Cu(Cp(T),t)){r.selectedIndex!==_&&(r.selectedIndex=_);return}}!l&&r.selectedIndex!==-1&&(r.selectedIndex=-1)}}function Cp(r){return"_value"in r?r._value:r.value}function DL(r,t){const l=t?"_trueValue":"_falseValue";return l in r?r[l]:t}const LL={created(r,t,l){W0(r,t,l,null,"created")},mounted(r,t,l){W0(r,t,l,null,"mounted")},beforeUpdate(r,t,l,f){W0(r,t,l,f,"beforeUpdate")},updated(r,t,l,f){W0(r,t,l,f,"updated")}};function OL(r,t){switch(r){case"SELECT":return yd;case"TEXTAREA":return gn;default:switch(t){case"checkbox":return X2;case"radio":return Y2;default:return gn}}}function W0(r,t,l,f,_){const T=OL(r.tagName,l.props&&l.props.type)[_];T&&T(r,t,l,f)}function gH(){gn.getSSRProps=({value:r})=>({value:r}),Y2.getSSRProps=({value:r},t)=>{if(t.props&&Cu(t.props.value,r))return{checked:!0}},X2.getSSRProps=({value:r},t)=>{if(vi(r)){if(t.props&&w1(r,t.props.value)>-1)return{checked:!0}}else if(Sd(r)){if(t.props&&r.has(t.props.value))return{checked:!0}}else if(r)return{checked:!0}},LL.getSSRProps=(r,t)=>{if(typeof t.type!="string")return;const l=OL(t.type.toUpperCase(),t.props&&t.props.type);if(l.getSSRProps)return l.getSSRProps(r,t)}}const yH=["ctrl","shift","alt","meta"],vH={stop:r=>r.stopPropagation(),prevent:r=>r.preventDefault(),self:r=>r.target!==r.currentTarget,ctrl:r=>!r.ctrlKey,shift:r=>!r.shiftKey,alt:r=>!r.altKey,meta:r=>!r.metaKey,left:r=>"button"in r&&r.button!==0,middle:r=>"button"in r&&r.button!==1,right:r=>"button"in r&&r.button!==2,exact:(r,t)=>yH.some(l=>r[`${l}Key`]&&!t.includes(l))},xH=(r,t)=>{const l=r._withMods||(r._withMods={}),f=t.join(".");return l[f]||(l[f]=(_,...b)=>{for(let T=0;T<t.length;T++){const n=vH[t[T]];if(n&&n(_,t))return}return r(_,...b)})},bH={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},wH=(r,t)=>{const l=r._withKeys||(r._withKeys={}),f=t.join(".");return l[f]||(l[f]=_=>{if(!("key"in _))return;const b=go(_.key);if(t.some(T=>T===b||bH[T]===b))return r(_)})},zL=vn({patchProp:nH},Bq);let ug,UI=!1;function kL(){return ug||(ug=GD(zL))}function FL(){return ug=UI?ug:WD(zL),UI=!0,ug}const NL=(...r)=>{kL().render(...r)},TH=(...r)=>{FL().hydrate(...r)},Hv=(...r)=>{const t=kL().createApp(...r),{mount:l}=t;return t.mount=f=>{const _=UL(f);if(!_)return;const b=t._component;!ji(b)&&!b.render&&!b.template&&(b.template=_.innerHTML),_.nodeType===1&&(_.textContent="");const T=l(_,!1,VL(_));return _ instanceof Element&&(_.removeAttribute("v-cloak"),_.setAttribute("data-v-app","")),T},t},BL=(...r)=>{const t=FL().createApp(...r),{mount:l}=t;return t.mount=f=>{const _=UL(f);if(_)return l(_,!0,VL(_))},t};function VL(r){if(r instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&r instanceof MathMLElement)return"mathml"}function UL(r){return nn(r)?document.querySelector(r):r}let jI=!1;const EH=()=>{jI||(jI=!0,gH(),Hq())},SH=Object.freeze(Object.defineProperty({__proto__:null,BaseTransition:wD,BaseTransitionPropsValidators:N2,Comment:Xr,DeprecationTypes:kq,EffectScope:I2,ErrorCodes:G$,ErrorTypeStrings:Iq,Fragment:Oi,KeepAlive:y8,ReactiveEffect:bg,Static:ld,Suspense:dq,Teleport:e8,Text:bu,TrackOpTypes:B$,Transition:Uq,TransitionGroup:hH,TriggerOpTypes:V$,VueElement:V1,assertNumber:H$,callWithAsyncErrorHandling:Ea,callWithErrorHandling:Vp,camelize:hr,capitalize:Ad,cloneVNode:Cl,compatUtils:zq,computed:_L,createApp:Hv,createBlock:Bv,createCommentVNode:Pr,createElementBlock:Ot,createElementVNode:W,createHydrationRenderer:WD,createPropsRestProxy:B8,createRenderer:GD,createSSRApp:BL,createSlots:E8,createStaticVNode:B1,createTextVNode:us,createVNode:ur,customRef:lD,defineAsyncComponent:_8,defineComponent:B2,defineCustomElement:CL,defineEmits:I8,defineExpose:P8,defineModel:L8,defineOptions:R8,defineProps:C8,defineSSRCustomElement:sH,defineSlots:D8,devtools:Pq,effect:a$,effectScope:r$,getCurrentInstance:Aa,getCurrentScope:j3,getCurrentWatcher:U$,getTransitionRawChildren:D1,guardReactiveProps:lL,h:gL,handleError:Md,hasInjectionContext:Z8,hydrate:TH,hydrateOnIdle:u8,hydrateOnInteraction:p8,hydrateOnMediaQuery:f8,hydrateOnVisible:d8,initCustomFormatter:Aq,initDirectivesForSSR:EH,inject:lg,isMemoSame:yL,isProxy:C1,isReactive:vu,isReadonly:Iu,isRef:cs,isRuntimeOnly:Tq,isShallow:Uo,isVNode:mc,markRaw:sD,mergeDefaults:F8,mergeModels:N8,mergeProps:cL,nextTick:P1,normalizeClass:md,normalizeProps:Gj,normalizeStyle:Es,onActivated:ED,onBeforeMount:MD,onBeforeUnmount:z1,onBeforeUpdate:U2,onDeactivated:SD,onErrorCaptured:RD,onMounted:qg,onRenderTracked:PD,onRenderTriggered:ID,onScopeDispose:s$,onServerPrefetch:CD,onUnmounted:k1,onUpdated:O1,onWatcherCleanup:uD,openBlock:Dt,popScopeId:K$,provide:kD,proxyRefs:O2,pushScopeId:Y$,queuePostFlushCb:Eg,reactive:A1,readonly:L2,ref:sg,registerRuntimeCompiler:fL,render:NL,renderList:jn,renderSlot:S8,resolveComponent:b8,resolveDirective:T8,resolveDynamicComponent:w8,resolveFilter:Oq,resolveTransitionHooks:Sp,setBlockTracking:gT,setDevtoolsHook:Rq,setTransitionHooks:pc,shallowReactive:rD,shallowReadonly:M$,shallowRef:oD,ssrContextKey:KD,ssrUtils:Lq,stop:l$,toDisplayString:qt,toHandlerKey:lp,toHandlers:A8,toRaw:In,toRef:k$,toRefs:L$,toValue:P$,transformVNodeArgs:yq,triggerRef:I$,unref:I1,useAttrs:k8,useCssModule:lH,useCssVars:Gq,useHost:IL,useId:i8,useModel:sq,useSSRContext:JD,useShadowRoot:aH,useSlots:z8,useTemplateRef:n8,useTransitionState:F2,vModelCheckbox:X2,vModelDynamic:LL,vModelRadio:Y2,vModelSelect:yd,vModelText:gn,vShow:AL,version:vL,warn:Cq,watch:hp,watchEffect:iq,watchPostEffect:nq,watchSyncEffect:QD,withAsyncContext:V8,withCtx:k2,withDefaults:O8,withDirectives:fn,withKeys:wH,withMemo:Mq,withModifiers:xH,withScopeId:J$},Symbol.toStringTag,{value:"Module"}));/**
* @vue/compiler-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const Pg=Symbol(""),hg=Symbol(""),K2=Symbol(""),Gv=Symbol(""),jL=Symbol(""),vd=Symbol(""),$L=Symbol(""),qL=Symbol(""),J2=Symbol(""),Q2=Symbol(""),Wg=Symbol(""),eE=Symbol(""),HL=Symbol(""),tE=Symbol(""),iE=Symbol(""),nE=Symbol(""),rE=Symbol(""),sE=Symbol(""),oE=Symbol(""),GL=Symbol(""),WL=Symbol(""),U1=Symbol(""),Wv=Symbol(""),aE=Symbol(""),lE=Symbol(""),Rg=Symbol(""),Zg=Symbol(""),cE=Symbol(""),AT=Symbol(""),AH=Symbol(""),MT=Symbol(""),Zv=Symbol(""),MH=Symbol(""),CH=Symbol(""),uE=Symbol(""),IH=Symbol(""),PH=Symbol(""),hE=Symbol(""),ZL=Symbol(""),Ip={[Pg]:"Fragment",[hg]:"Teleport",[K2]:"Suspense",[Gv]:"KeepAlive",[jL]:"BaseTransition",[vd]:"openBlock",[$L]:"createBlock",[qL]:"createElementBlock",[J2]:"createVNode",[Q2]:"createElementVNode",[Wg]:"createCommentVNode",[eE]:"createTextVNode",[HL]:"createStaticVNode",[tE]:"resolveComponent",[iE]:"resolveDynamicComponent",[nE]:"resolveDirective",[rE]:"resolveFilter",[sE]:"withDirectives",[oE]:"renderList",[GL]:"renderSlot",[WL]:"createSlots",[U1]:"toDisplayString",[Wv]:"mergeProps",[aE]:"normalizeClass",[lE]:"normalizeStyle",[Rg]:"normalizeProps",[Zg]:"guardReactiveProps",[cE]:"toHandlers",[AT]:"camelize",[AH]:"capitalize",[MT]:"toHandlerKey",[Zv]:"setBlockTracking",[MH]:"pushScopeId",[CH]:"popScopeId",[uE]:"withCtx",[IH]:"unref",[PH]:"isRef",[hE]:"withMemo",[ZL]:"isMemoSame"};function RH(r){Object.getOwnPropertySymbols(r).forEach(t=>{Ip[t]=r[t]})}const Xo={start:{line:1,column:1,offset:0},end:{line:1,column:1,offset:0},source:""};function DH(r,t=""){return{type:0,source:t,children:r,helpers:new Set,components:[],directives:[],hoists:[],imports:[],cached:[],temps:0,codegenNode:void 0,loc:Xo}}function Dg(r,t,l,f,_,b,T,n=!1,k=!1,j=!1,U=Xo){return r&&(n?(r.helper(vd),r.helper(Dp(r.inSSR,j))):r.helper(Rp(r.inSSR,j)),T&&r.helper(sE)),{type:13,tag:t,props:l,children:f,patchFlag:_,dynamicProps:b,directives:T,isBlock:n,disableTracking:k,isComponent:j,loc:U}}function cd(r,t=Xo){return{type:17,loc:t,elements:r}}function va(r,t=Xo){return{type:15,loc:t,properties:r}}function Nr(r,t){return{type:16,loc:Xo,key:nn(r)?cn(r,!0):r,value:t}}function cn(r,t=!1,l=Xo,f=0){return{type:4,loc:l,content:r,isStatic:t,constType:t?3:f}}function Xa(r,t=Xo){return{type:8,loc:t,children:r}}function os(r,t=[],l=Xo){return{type:14,loc:l,callee:r,arguments:t}}function Pp(r,t=void 0,l=!1,f=!1,_=Xo){return{type:18,params:r,returns:t,newline:l,isSlot:f,loc:_}}function CT(r,t,l,f=!0){return{type:19,test:r,consequent:t,alternate:l,newline:f,loc:Xo}}function LH(r,t,l=!1,f=!1){return{type:20,index:r,value:t,needPauseTracking:l,inVOnce:f,needArraySpread:!1,loc:Xo}}function OH(r){return{type:21,body:r,loc:Xo}}function Rp(r,t){return r||t?J2:Q2}function Dp(r,t){return r||t?$L:qL}function dE(r,{helper:t,removeHelper:l,inSSR:f}){r.isBlock||(r.isBlock=!0,l(Rp(f,r.isComponent)),t(vd),t(Dp(f,r.isComponent)))}const $I=new Uint8Array([123,123]),qI=new Uint8Array([125,125]);function HI(r){return r>=97&&r<=122||r>=65&&r<=90}function Oo(r){return r===32||r===10||r===9||r===12||r===13}function su(r){return r===47||r===62||Oo(r)}function Xv(r){const t=new Uint8Array(r.length);for(let l=0;l<r.length;l++)t[l]=r.charCodeAt(l);return t}const Ds={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101]),TextareaEnd:new Uint8Array([60,47,116,101,120,116,97,114,101,97])};class zH{constructor(t,l){this.stack=t,this.cbs=l,this.state=1,this.buffer="",this.sectionStart=0,this.index=0,this.entityStart=0,this.baseState=1,this.inRCDATA=!1,this.inXML=!1,this.inVPre=!1,this.newlines=[],this.mode=0,this.delimiterOpen=$I,this.delimiterClose=qI,this.delimiterIndex=-1,this.currentSequence=void 0,this.sequenceIndex=0}get inSFCRoot(){return this.mode===2&&this.stack.length===0}reset(){this.state=1,this.mode=0,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=1,this.inRCDATA=!1,this.currentSequence=void 0,this.newlines.length=0,this.delimiterOpen=$I,this.delimiterClose=qI}getPos(t){let l=1,f=t+1;for(let _=this.newlines.length-1;_>=0;_--){const b=this.newlines[_];if(t>b){l=_+2,f=t-b;break}}return{column:f,line:l,offset:t}}peek(){return this.buffer.charCodeAt(this.index+1)}stateText(t){t===60?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=5,this.sectionStart=this.index):!this.inVPre&&t===this.delimiterOpen[0]&&(this.state=2,this.delimiterIndex=0,this.stateInterpolationOpen(t))}stateInterpolationOpen(t){if(t===this.delimiterOpen[this.delimiterIndex])if(this.delimiterIndex===this.delimiterOpen.length-1){const l=this.index+1-this.delimiterOpen.length;l>this.sectionStart&&this.cbs.ontext(this.sectionStart,l),this.state=3,this.sectionStart=l}else this.delimiterIndex++;else this.inRCDATA?(this.state=32,this.stateInRCDATA(t)):(this.state=1,this.stateText(t))}stateInterpolation(t){t===this.delimiterClose[0]&&(this.state=4,this.delimiterIndex=0,this.stateInterpolationClose(t))}stateInterpolationClose(t){t===this.delimiterClose[this.delimiterIndex]?this.delimiterIndex===this.delimiterClose.length-1?(this.cbs.oninterpolation(this.sectionStart,this.index+1),this.inRCDATA?this.state=32:this.state=1,this.sectionStart=this.index+1):this.delimiterIndex++:(this.state=3,this.stateInterpolation(t))}stateSpecialStartSequence(t){const l=this.sequenceIndex===this.currentSequence.length;if(!(l?su(t):(t|32)===this.currentSequence[this.sequenceIndex]))this.inRCDATA=!1;else if(!l){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=6,this.stateInTagName(t)}stateInRCDATA(t){if(this.sequenceIndex===this.currentSequence.length){if(t===62||Oo(t)){const l=this.index-this.currentSequence.length;if(this.sectionStart<l){const f=this.index;this.index=l,this.cbs.ontext(this.sectionStart,l),this.index=f}this.sectionStart=l+2,this.stateInClosingTagName(t),this.inRCDATA=!1;return}this.sequenceIndex=0}(t|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===Ds.TitleEnd||this.currentSequence===Ds.TextareaEnd&&!this.inSFCRoot?!this.inVPre&&t===this.delimiterOpen[0]&&(this.state=2,this.delimiterIndex=0,this.stateInterpolationOpen(t)):this.fastForwardTo(60)&&(this.sequenceIndex=1):this.sequenceIndex=+(t===60)}stateCDATASequence(t){t===Ds.Cdata[this.sequenceIndex]?++this.sequenceIndex===Ds.Cdata.length&&(this.state=28,this.currentSequence=Ds.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=23,this.stateInDeclaration(t))}fastForwardTo(t){for(;++this.index<this.buffer.length;){const l=this.buffer.charCodeAt(this.index);if(l===10&&this.newlines.push(this.index),l===t)return!0}return this.index=this.buffer.length-1,!1}stateInCommentLike(t){t===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===Ds.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index-2):this.cbs.oncomment(this.sectionStart,this.index-2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=1):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):t!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)}startSpecial(t,l){this.enterRCDATA(t,l),this.state=31}enterRCDATA(t,l){this.inRCDATA=!0,this.currentSequence=t,this.sequenceIndex=l}stateBeforeTagName(t){t===33?(this.state=22,this.sectionStart=this.index+1):t===63?(this.state=24,this.sectionStart=this.index+1):HI(t)?(this.sectionStart=this.index,this.mode===0?this.state=6:this.inSFCRoot?this.state=34:this.inXML?this.state=6:t===116?this.state=30:this.state=t===115?29:6):t===47?this.state=8:(this.state=1,this.stateText(t))}stateInTagName(t){su(t)&&this.handleTagName(t)}stateInSFCRootTagName(t){if(su(t)){const l=this.buffer.slice(this.sectionStart,this.index);l!=="template"&&this.enterRCDATA(Xv("</"+l),0),this.handleTagName(t)}}handleTagName(t){this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=11,this.stateBeforeAttrName(t)}stateBeforeClosingTagName(t){Oo(t)||(t===62?(this.state=1,this.sectionStart=this.index+1):(this.state=HI(t)?9:27,this.sectionStart=this.index))}stateInClosingTagName(t){(t===62||Oo(t))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=10,this.stateAfterClosingTagName(t))}stateAfterClosingTagName(t){t===62&&(this.state=1,this.sectionStart=this.index+1)}stateBeforeAttrName(t){t===62?(this.cbs.onopentagend(this.index),this.inRCDATA?this.state=32:this.state=1,this.sectionStart=this.index+1):t===47?this.state=7:t===60&&this.peek()===47?(this.cbs.onopentagend(this.index),this.state=5,this.sectionStart=this.index):Oo(t)||this.handleAttrStart(t)}handleAttrStart(t){t===118&&this.peek()===45?(this.state=13,this.sectionStart=this.index):t===46||t===58||t===64||t===35?(this.cbs.ondirname(this.index,this.index+1),this.state=14,this.sectionStart=this.index+1):(this.state=12,this.sectionStart=this.index)}stateInSelfClosingTag(t){t===62?(this.cbs.onselfclosingtag(this.index),this.state=1,this.sectionStart=this.index+1,this.inRCDATA=!1):Oo(t)||(this.state=11,this.stateBeforeAttrName(t))}stateInAttrName(t){(t===61||su(t))&&(this.cbs.onattribname(this.sectionStart,this.index),this.handleAttrNameEnd(t))}stateInDirName(t){t===61||su(t)?(this.cbs.ondirname(this.sectionStart,this.index),this.handleAttrNameEnd(t)):t===58?(this.cbs.ondirname(this.sectionStart,this.index),this.state=14,this.sectionStart=this.index+1):t===46&&(this.cbs.ondirname(this.sectionStart,this.index),this.state=16,this.sectionStart=this.index+1)}stateInDirArg(t){t===61||su(t)?(this.cbs.ondirarg(this.sectionStart,this.index),this.handleAttrNameEnd(t)):t===91?this.state=15:t===46&&(this.cbs.ondirarg(this.sectionStart,this.index),this.state=16,this.sectionStart=this.index+1)}stateInDynamicDirArg(t){t===93?this.state=14:(t===61||su(t))&&(this.cbs.ondirarg(this.sectionStart,this.index+1),this.handleAttrNameEnd(t))}stateInDirModifier(t){t===61||su(t)?(this.cbs.ondirmodifier(this.sectionStart,this.index),this.handleAttrNameEnd(t)):t===46&&(this.cbs.ondirmodifier(this.sectionStart,this.index),this.sectionStart=this.index+1)}handleAttrNameEnd(t){this.sectionStart=this.index,this.state=17,this.cbs.onattribnameend(this.index),this.stateAfterAttrName(t)}stateAfterAttrName(t){t===61?this.state=18:t===47||t===62?(this.cbs.onattribend(0,this.sectionStart),this.sectionStart=-1,this.state=11,this.stateBeforeAttrName(t)):Oo(t)||(this.cbs.onattribend(0,this.sectionStart),this.handleAttrStart(t))}stateBeforeAttrValue(t){t===34?(this.state=19,this.sectionStart=this.index+1):t===39?(this.state=20,this.sectionStart=this.index+1):Oo(t)||(this.sectionStart=this.index,this.state=21,this.stateInAttrValueNoQuotes(t))}handleInAttrValue(t,l){(t===l||this.fastForwardTo(l))&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(l===34?3:2,this.index+1),this.state=11)}stateInAttrValueDoubleQuotes(t){this.handleInAttrValue(t,34)}stateInAttrValueSingleQuotes(t){this.handleInAttrValue(t,39)}stateInAttrValueNoQuotes(t){Oo(t)||t===62?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(1,this.index),this.state=11,this.stateBeforeAttrName(t)):(t===39||t===60||t===61||t===96)&&this.cbs.onerr(18,this.index)}stateBeforeDeclaration(t){t===91?(this.state=26,this.sequenceIndex=0):this.state=t===45?25:23}stateInDeclaration(t){(t===62||this.fastForwardTo(62))&&(this.state=1,this.sectionStart=this.index+1)}stateInProcessingInstruction(t){(t===62||this.fastForwardTo(62))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=1,this.sectionStart=this.index+1)}stateBeforeComment(t){t===45?(this.state=28,this.currentSequence=Ds.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=23}stateInSpecialComment(t){(t===62||this.fastForwardTo(62))&&(this.cbs.oncomment(this.sectionStart,this.index),this.state=1,this.sectionStart=this.index+1)}stateBeforeSpecialS(t){t===Ds.ScriptEnd[3]?this.startSpecial(Ds.ScriptEnd,4):t===Ds.StyleEnd[3]?this.startSpecial(Ds.StyleEnd,4):(this.state=6,this.stateInTagName(t))}stateBeforeSpecialT(t){t===Ds.TitleEnd[3]?this.startSpecial(Ds.TitleEnd,4):t===Ds.TextareaEnd[3]?this.startSpecial(Ds.TextareaEnd,4):(this.state=6,this.stateInTagName(t))}startEntity(){}stateInEntity(){}parse(t){for(this.buffer=t;this.index<this.buffer.length;){const l=this.buffer.charCodeAt(this.index);switch(l===10&&this.newlines.push(this.index),this.state){case 1:{this.stateText(l);break}case 2:{this.stateInterpolationOpen(l);break}case 3:{this.stateInterpolation(l);break}case 4:{this.stateInterpolationClose(l);break}case 31:{this.stateSpecialStartSequence(l);break}case 32:{this.stateInRCDATA(l);break}case 26:{this.stateCDATASequence(l);break}case 19:{this.stateInAttrValueDoubleQuotes(l);break}case 12:{this.stateInAttrName(l);break}case 13:{this.stateInDirName(l);break}case 14:{this.stateInDirArg(l);break}case 15:{this.stateInDynamicDirArg(l);break}case 16:{this.stateInDirModifier(l);break}case 28:{this.stateInCommentLike(l);break}case 27:{this.stateInSpecialComment(l);break}case 11:{this.stateBeforeAttrName(l);break}case 6:{this.stateInTagName(l);break}case 34:{this.stateInSFCRootTagName(l);break}case 9:{this.stateInClosingTagName(l);break}case 5:{this.stateBeforeTagName(l);break}case 17:{this.stateAfterAttrName(l);break}case 20:{this.stateInAttrValueSingleQuotes(l);break}case 18:{this.stateBeforeAttrValue(l);break}case 8:{this.stateBeforeClosingTagName(l);break}case 10:{this.stateAfterClosingTagName(l);break}case 29:{this.stateBeforeSpecialS(l);break}case 30:{this.stateBeforeSpecialT(l);break}case 21:{this.stateInAttrValueNoQuotes(l);break}case 7:{this.stateInSelfClosingTag(l);break}case 23:{this.stateInDeclaration(l);break}case 22:{this.stateBeforeDeclaration(l);break}case 25:{this.stateBeforeComment(l);break}case 24:{this.stateInProcessingInstruction(l);break}case 33:{this.stateInEntity();break}}this.index++}this.cleanup(),this.finish()}cleanup(){this.sectionStart!==this.index&&(this.state===1||this.state===32&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===19||this.state===20||this.state===21)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))}finish(){this.handleTrailingData(),this.cbs.onend()}handleTrailingData(){const t=this.buffer.length;this.sectionStart>=t||(this.state===28?this.currentSequence===Ds.CdataEnd?this.cbs.oncdata(this.sectionStart,t):this.cbs.oncomment(this.sectionStart,t):this.state===6||this.state===11||this.state===18||this.state===17||this.state===12||this.state===13||this.state===14||this.state===15||this.state===16||this.state===20||this.state===19||this.state===21||this.state===9||this.cbs.ontext(this.sectionStart,t))}emitCodePoint(t,l){}}function GI(r,{compatConfig:t}){const l=t&&t[r];return r==="MODE"?l||3:l}function ud(r,t){const l=GI("MODE",t),f=GI(r,t);return l===3?f===!0:f!==!1}function Lg(r,t,l,...f){return ud(r,t)}function fE(r){throw r}function XL(r){}function vr(r,t,l,f){const _=`https://vuejs.org/error-reference/#compiler-${r}`,b=new SyntaxError(String(_));return b.code=r,b.loc=t,b}const yo=r=>r.type===4&&r.isStatic;function YL(r){switch(r){case"Teleport":case"teleport":return hg;case"Suspense":case"suspense":return K2;case"KeepAlive":case"keep-alive":return Gv;case"BaseTransition":case"base-transition":return jL}}const kH=/^\d|[^\$\w\xA0-\uFFFF]/,pE=r=>!kH.test(r),FH=/[A-Za-z_$\xA0-\uFFFF]/,NH=/[\.\?\w$\xA0-\uFFFF]/,BH=/\s+[.[]\s*|\s*[.[]\s+/g,KL=r=>r.type===4?r.content:r.loc.source,VH=r=>{const t=KL(r).trim().replace(BH,n=>n.trim());let l=0,f=[],_=0,b=0,T=null;for(let n=0;n<t.length;n++){const k=t.charAt(n);switch(l){case 0:if(k==="[")f.push(l),l=1,_++;else if(k==="(")f.push(l),l=2,b++;else if(!(n===0?FH:NH).test(k))return!1;break;case 1:k==="'"||k==='"'||k==="`"?(f.push(l),l=3,T=k):k==="["?_++:k==="]"&&(--_||(l=f.pop()));break;case 2:if(k==="'"||k==='"'||k==="`")f.push(l),l=3,T=k;else if(k==="(")b++;else if(k===")"){if(n===t.length-1)return!1;--b||(l=f.pop())}break;case 3:k===T&&(l=f.pop(),T=null);break}}return!_&&!b},JL=VH,UH=/^\s*(async\s*)?(\([^)]*?\)|[\w$_]+)\s*(:[^=]+)?=>|^\s*(async\s+)?function(?:\s+[\w$]+)?\s*\(/,jH=r=>UH.test(KL(r)),$H=jH;function _a(r,t,l=!1){for(let f=0;f<r.props.length;f++){const _=r.props[f];if(_.type===7&&(l||_.exp)&&(nn(t)?_.name===t:t.test(_.name)))return _}}function j1(r,t,l=!1,f=!1){for(let _=0;_<r.props.length;_++){const b=r.props[_];if(b.type===6){if(l)continue;if(b.name===t&&(b.value||f))return b}else if(b.name==="bind"&&(b.exp||f)&&Yh(b.arg,t))return b}}function Yh(r,t){return!!(r&&yo(r)&&r.content===t)}function qH(r){return r.props.some(t=>t.type===7&&t.name==="bind"&&(!t.arg||t.arg.type!==4||!t.arg.isStatic))}function Cw(r){return r.type===5||r.type===2}function HH(r){return r.type===7&&r.name==="slot"}function Yv(r){return r.type===1&&r.tagType===3}function Kv(r){return r.type===1&&r.tagType===2}const GH=new Set([Rg,Zg]);function QL(r,t=[]){if(r&&!nn(r)&&r.type===14){const l=r.callee;if(!nn(l)&&GH.has(l))return QL(r.arguments[0],t.concat(r))}return[r,t]}function Jv(r,t,l){let f,_=r.type===13?r.props:r.arguments[2],b=[],T;if(_&&!nn(_)&&_.type===14){const n=QL(_);_=n[0],b=n[1],T=b[b.length-1]}if(_==null||nn(_))f=va([t]);else if(_.type===14){const n=_.arguments[0];!nn(n)&&n.type===15?WI(t,n)||n.properties.unshift(t):_.callee===cE?f=os(l.helper(Wv),[va([t]),_]):_.arguments.unshift(va([t])),!f&&(f=_)}else _.type===15?(WI(t,_)||_.properties.unshift(t),f=_):(f=os(l.helper(Wv),[va([t]),_]),T&&T.callee===Zg&&(T=b[b.length-2]));r.type===13?T?T.arguments[0]=f:r.props=f:T?T.arguments[0]=f:r.arguments[2]=f}function WI(r,t){let l=!1;if(r.key.type===4){const f=r.key.content;l=t.properties.some(_=>_.key.type===4&&_.key.content===f)}return l}function Og(r,t){return`_${t}_${r.replace(/[^\w]/g,(l,f)=>l==="-"?"_":r.charCodeAt(f).toString())}`}function WH(r){return r.type===14&&r.callee===hE?r.arguments[1].returns:r}const ZH=/([\s\S]*?)\s+(?:in|of)\s+(\S[\s\S]*)/,eO={parseMode:"base",ns:0,delimiters:["{{","}}"],getNamespace:()=>0,isVoidTag:X_,isPreTag:X_,isIgnoreNewlineTag:X_,isCustomElement:X_,onError:fE,onWarn:XL,comments:!1,prefixIdentifiers:!1};let kn=eO,zg=null,uc="",Ls=null,Cn=null,fo="",tc=-1,Hh=-1,mE=0,du=!1,IT=null;const gr=[],Cr=new zH(gr,{onerr:ec,ontext(r,t){Z0(ws(r,t),r,t)},ontextentity(r,t,l){Z0(r,t,l)},oninterpolation(r,t){if(du)return Z0(ws(r,t),r,t);let l=r+Cr.delimiterOpen.length,f=t-Cr.delimiterClose.length;for(;Oo(uc.charCodeAt(l));)l++;for(;Oo(uc.charCodeAt(f-1));)f--;let _=ws(l,f);_.includes("&")&&(_=kn.decodeEntities(_,!1)),PT({type:5,content:fv(_,!1,kr(l,f)),loc:kr(r,t)})},onopentagname(r,t){const l=ws(r,t);Ls={type:1,tag:l,ns:kn.getNamespace(l,gr[0],kn.ns),tagType:0,props:[],children:[],loc:kr(r-1,t),codegenNode:void 0}},onopentagend(r){XI(r)},onclosetag(r,t){const l=ws(r,t);if(!kn.isVoidTag(l)){let f=!1;for(let _=0;_<gr.length;_++)if(gr[_].tag.toLowerCase()===l.toLowerCase()){f=!0,_>0&&ec(24,gr[0].loc.start.offset);for(let T=0;T<=_;T++){const n=gr.shift();dv(n,t,T<_)}break}f||ec(23,tO(r,60))}},onselfclosingtag(r){const t=Ls.tag;Ls.isSelfClosing=!0,XI(r),gr[0]&&gr[0].tag===t&&dv(gr.shift(),r)},onattribname(r,t){Cn={type:6,name:ws(r,t),nameLoc:kr(r,t),value:void 0,loc:kr(r)}},ondirname(r,t){const l=ws(r,t),f=l==="."||l===":"?"bind":l==="@"?"on":l==="#"?"slot":l.slice(2);if(!du&&f===""&&ec(26,r),du||f==="")Cn={type:6,name:l,nameLoc:kr(r,t),value:void 0,loc:kr(r)};else if(Cn={type:7,name:f,rawName:l,exp:void 0,arg:void 0,modifiers:l==="."?[cn("prop")]:[],loc:kr(r)},f==="pre"){du=Cr.inVPre=!0,IT=Ls;const _=Ls.props;for(let b=0;b<_.length;b++)_[b].type===7&&(_[b]=sG(_[b]))}},ondirarg(r,t){if(r===t)return;const l=ws(r,t);if(du)Cn.name+=l,Kh(Cn.nameLoc,t);else{const f=l[0]!=="[";Cn.arg=fv(f?l:l.slice(1,-1),f,kr(r,t),f?3:0)}},ondirmodifier(r,t){const l=ws(r,t);if(du)Cn.name+="."+l,Kh(Cn.nameLoc,t);else if(Cn.name==="slot"){const f=Cn.arg;f&&(f.content+="."+l,Kh(f.loc,t))}else{const f=cn(l,!0,kr(r,t));Cn.modifiers.push(f)}},onattribdata(r,t){fo+=ws(r,t),tc<0&&(tc=r),Hh=t},onattribentity(r,t,l){fo+=r,tc<0&&(tc=t),Hh=l},onattribnameend(r){const t=Cn.loc.start.offset,l=ws(t,r);Cn.type===7&&(Cn.rawName=l),Ls.props.some(f=>(f.type===7?f.rawName:f.name)===l)&&ec(2,t)},onattribend(r,t){if(Ls&&Cn){if(Kh(Cn.loc,t),r!==0)if(fo.includes("&")&&(fo=kn.decodeEntities(fo,!0)),Cn.type===6)Cn.name==="class"&&(fo=nO(fo).trim()),r===1&&!fo&&ec(13,t),Cn.value={type:2,content:fo,loc:r===1?kr(tc,Hh):kr(tc-1,Hh+1)},Cr.inSFCRoot&&Ls.tag==="template"&&Cn.name==="lang"&&fo&&fo!=="html"&&Cr.enterRCDATA(Xv("</template"),0);else{let l=0;Cn.exp=fv(fo,!1,kr(tc,Hh),0,l),Cn.name==="for"&&(Cn.forParseResult=YH(Cn.exp));let f=-1;Cn.name==="bind"&&(f=Cn.modifiers.findIndex(_=>_.content==="sync"))>-1&&Lg("COMPILER_V_BIND_SYNC",kn,Cn.loc,Cn.rawName)&&(Cn.name="model",Cn.modifiers.splice(f,1))}(Cn.type!==7||Cn.name!=="pre")&&Ls.props.push(Cn)}fo="",tc=Hh=-1},oncomment(r,t){kn.comments&&PT({type:3,content:ws(r,t),loc:kr(r-4,t+3)})},onend(){const r=uc.length;for(let t=0;t<gr.length;t++)dv(gr[t],r-1),ec(24,gr[t].loc.start.offset)},oncdata(r,t){gr[0].ns!==0?Z0(ws(r,t),r,t):ec(1,r-9)},onprocessinginstruction(r){(gr[0]?gr[0].ns:kn.ns)===0&&ec(21,r-1)}}),ZI=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,XH=/^\(|\)$/g;function YH(r){const t=r.loc,l=r.content,f=l.match(ZH);if(!f)return;const[,_,b]=f,T=(Z,re,se=!1)=>{const ue=t.start.offset+re,ne=ue+Z.length;return fv(Z,!1,kr(ue,ne),0,se?1:0)},n={source:T(b.trim(),l.indexOf(b,_.length)),value:void 0,key:void 0,index:void 0,finalized:!1};let k=_.trim().replace(XH,"").trim();const j=_.indexOf(k),U=k.match(ZI);if(U){k=k.replace(ZI,"").trim();const Z=U[1].trim();let re;if(Z&&(re=l.indexOf(Z,j+k.length),n.key=T(Z,re,!0)),U[2]){const se=U[2].trim();se&&(n.index=T(se,l.indexOf(se,n.key?re+Z.length:j+k.length),!0))}}return k&&(n.value=T(k,j,!0)),n}function ws(r,t){return uc.slice(r,t)}function XI(r){Cr.inSFCRoot&&(Ls.innerLoc=kr(r+1,r+1)),PT(Ls);const{tag:t,ns:l}=Ls;l===0&&kn.isPreTag(t)&&mE++,kn.isVoidTag(t)?dv(Ls,r):(gr.unshift(Ls),(l===1||l===2)&&(Cr.inXML=!0)),Ls=null}function Z0(r,t,l){{const b=gr[0]&&gr[0].tag;b!=="script"&&b!=="style"&&r.includes("&")&&(r=kn.decodeEntities(r,!1))}const f=gr[0]||zg,_=f.children[f.children.length-1];_&&_.type===2?(_.content+=r,Kh(_.loc,l)):f.children.push({type:2,content:r,loc:kr(t,l)})}function dv(r,t,l=!1){l?Kh(r.loc,tO(t,60)):Kh(r.loc,KH(t,62)+1),Cr.inSFCRoot&&(r.children.length?r.innerLoc.end=vn({},r.children[r.children.length-1].loc.end):r.innerLoc.end=vn({},r.innerLoc.start),r.innerLoc.source=ws(r.innerLoc.start.offset,r.innerLoc.end.offset));const{tag:f,ns:_,children:b}=r;if(du||(f==="slot"?r.tagType=2:YI(r)?r.tagType=3:QH(r)&&(r.tagType=1)),Cr.inRCDATA||(r.children=iO(b)),_===0&&kn.isIgnoreNewlineTag(f)){const T=b[0];T&&T.type===2&&(T.content=T.content.replace(/^\r?\n/,""))}_===0&&kn.isPreTag(f)&&mE--,IT===r&&(du=Cr.inVPre=!1,IT=null),Cr.inXML&&(gr[0]?gr[0].ns:kn.ns)===0&&(Cr.inXML=!1);{const T=r.props;if(!Cr.inSFCRoot&&ud("COMPILER_NATIVE_TEMPLATE",kn)&&r.tag==="template"&&!YI(r)){const k=gr[0]||zg,j=k.children.indexOf(r);k.children.splice(j,1,...r.children)}const n=T.find(k=>k.type===6&&k.name==="inline-template");n&&Lg("COMPILER_INLINE_TEMPLATE",kn,n.loc)&&r.children.length&&(n.value={type:2,content:ws(r.children[0].loc.start.offset,r.children[r.children.length-1].loc.end.offset),loc:n.loc})}}function KH(r,t){let l=r;for(;uc.charCodeAt(l)!==t&&l<uc.length-1;)l++;return l}function tO(r,t){let l=r;for(;uc.charCodeAt(l)!==t&&l>=0;)l--;return l}const JH=new Set(["if","else","else-if","for","slot"]);function YI({tag:r,props:t}){if(r==="template"){for(let l=0;l<t.length;l++)if(t[l].type===7&&JH.has(t[l].name))return!0}return!1}function QH({tag:r,props:t}){if(kn.isCustomElement(r))return!1;if(r==="component"||eG(r.charCodeAt(0))||YL(r)||kn.isBuiltInComponent&&kn.isBuiltInComponent(r)||kn.isNativeTag&&!kn.isNativeTag(r))return!0;for(let l=0;l<t.length;l++){const f=t[l];if(f.type===6){if(f.name==="is"&&f.value){if(f.value.content.startsWith("vue:"))return!0;if(Lg("COMPILER_IS_ON_ELEMENT",kn,f.loc))return!0}}else if(f.name==="bind"&&Yh(f.arg,"is")&&Lg("COMPILER_IS_ON_ELEMENT",kn,f.loc))return!0}return!1}function eG(r){return r>64&&r<91}const tG=/\r\n/g;function iO(r,t){const l=kn.whitespace!=="preserve";let f=!1;for(let _=0;_<r.length;_++){const b=r[_];if(b.type===2)if(mE)b.content=b.content.replace(tG,`
`);else if(iG(b.content)){const T=r[_-1]&&r[_-1].type,n=r[_+1]&&r[_+1].type;!T||!n||l&&(T===3&&(n===3||n===1)||T===1&&(n===3||n===1&&nG(b.content)))?(f=!0,r[_]=null):b.content=" "}else l&&(b.content=nO(b.content))}return f?r.filter(Boolean):r}function iG(r){for(let t=0;t<r.length;t++)if(!Oo(r.charCodeAt(t)))return!1;return!0}function nG(r){for(let t=0;t<r.length;t++){const l=r.charCodeAt(t);if(l===10||l===13)return!0}return!1}function nO(r){let t="",l=!1;for(let f=0;f<r.length;f++)Oo(r.charCodeAt(f))?l||(t+=" ",l=!0):(t+=r[f],l=!1);return t}function PT(r){(gr[0]||zg).children.push(r)}function kr(r,t){return{start:Cr.getPos(r),end:t==null?t:Cr.getPos(t),source:t==null?t:ws(r,t)}}function rG(r){return kr(r.start.offset,r.end.offset)}function Kh(r,t){r.end=Cr.getPos(t),r.source=ws(r.start.offset,t)}function sG(r){const t={type:6,name:r.rawName,nameLoc:kr(r.loc.start.offset,r.loc.start.offset+r.rawName.length),value:void 0,loc:r.loc};if(r.exp){const l=r.exp.loc;l.end.offset<r.loc.end.offset&&(l.start.offset--,l.start.column--,l.end.offset++,l.end.column++),t.value={type:2,content:r.exp.content,loc:l}}return t}function fv(r,t=!1,l,f=0,_=0){return cn(r,t,l,f)}function ec(r,t,l){kn.onError(vr(r,kr(t,t)))}function oG(){Cr.reset(),Ls=null,Cn=null,fo="",tc=-1,Hh=-1,gr.length=0}function aG(r,t){if(oG(),uc=r,kn=vn({},eO),t){let _;for(_ in t)t[_]!=null&&(kn[_]=t[_])}Cr.mode=kn.parseMode==="html"?1:kn.parseMode==="sfc"?2:0,Cr.inXML=kn.ns===1||kn.ns===2;const l=t&&t.delimiters;l&&(Cr.delimiterOpen=Xv(l[0]),Cr.delimiterClose=Xv(l[1]));const f=zg=DH([],r);return Cr.parse(uc),f.loc=kr(0,r.length),f.children=iO(f.children),zg=null,f}function lG(r,t){pv(r,void 0,t,rO(r,r.children[0]))}function rO(r,t){const{children:l}=r;return l.length===1&&t.type===1&&!Kv(t)}function pv(r,t,l,f=!1,_=!1){const{children:b}=r,T=[];for(let U=0;U<b.length;U++){const Z=b[U];if(Z.type===1&&Z.tagType===0){const re=f?0:No(Z,l);if(re>0){if(re>=2){Z.codegenNode.patchFlag=-1,T.push(Z);continue}}else{const se=Z.codegenNode;if(se.type===13){const ue=se.patchFlag;if((ue===void 0||ue===512||ue===1)&&oO(Z,l)>=2){const ne=aO(Z);ne&&(se.props=l.hoist(ne))}se.dynamicProps&&(se.dynamicProps=l.hoist(se.dynamicProps))}}}else if(Z.type===12&&(f?0:No(Z,l))>=2){T.push(Z);continue}if(Z.type===1){const re=Z.tagType===1;re&&l.scopes.vSlot++,pv(Z,r,l,!1,_),re&&l.scopes.vSlot--}else if(Z.type===11)pv(Z,r,l,Z.children.length===1,!0);else if(Z.type===9)for(let re=0;re<Z.branches.length;re++)pv(Z.branches[re],r,l,Z.branches[re].children.length===1,_)}let n=!1;if(T.length===b.length&&r.type===1){if(r.tagType===0&&r.codegenNode&&r.codegenNode.type===13&&vi(r.codegenNode.children))r.codegenNode.children=k(cd(r.codegenNode.children)),n=!0;else if(r.tagType===1&&r.codegenNode&&r.codegenNode.type===13&&r.codegenNode.children&&!vi(r.codegenNode.children)&&r.codegenNode.children.type===15){const U=j(r.codegenNode,"default");U&&(U.returns=k(cd(U.returns)),n=!0)}else if(r.tagType===3&&t&&t.type===1&&t.tagType===1&&t.codegenNode&&t.codegenNode.type===13&&t.codegenNode.children&&!vi(t.codegenNode.children)&&t.codegenNode.children.type===15){const U=_a(r,"slot",!0),Z=U&&U.arg&&j(t.codegenNode,U.arg);Z&&(Z.returns=k(cd(Z.returns)),n=!0)}}if(!n)for(const U of T)U.codegenNode=l.cache(U.codegenNode);function k(U){const Z=l.cache(U);return _&&l.hmr&&(Z.needArraySpread=!0),Z}function j(U,Z){if(U.children&&!vi(U.children)&&U.children.type===15){const re=U.children.properties.find(se=>se.key===Z||se.key.content===Z);return re&&re.value}}T.length&&l.transformHoist&&l.transformHoist(b,l,r)}function No(r,t){const{constantCache:l}=t;switch(r.type){case 1:if(r.tagType!==0)return 0;const f=l.get(r);if(f!==void 0)return f;const _=r.codegenNode;if(_.type!==13||_.isBlock&&r.tag!=="svg"&&r.tag!=="foreignObject"&&r.tag!=="math")return 0;if(_.patchFlag===void 0){let T=3;const n=oO(r,t);if(n===0)return l.set(r,0),0;n<T&&(T=n);for(let k=0;k<r.children.length;k++){const j=No(r.children[k],t);if(j===0)return l.set(r,0),0;j<T&&(T=j)}if(T>1)for(let k=0;k<r.props.length;k++){const j=r.props[k];if(j.type===7&&j.name==="bind"&&j.exp){const U=No(j.exp,t);if(U===0)return l.set(r,0),0;U<T&&(T=U)}}if(_.isBlock){for(let k=0;k<r.props.length;k++)if(r.props[k].type===7)return l.set(r,0),0;t.removeHelper(vd),t.removeHelper(Dp(t.inSSR,_.isComponent)),_.isBlock=!1,t.helper(Rp(t.inSSR,_.isComponent))}return l.set(r,T),T}else return l.set(r,0),0;case 2:case 3:return 3;case 9:case 11:case 10:return 0;case 5:case 12:return No(r.content,t);case 4:return r.constType;case 8:let b=3;for(let T=0;T<r.children.length;T++){const n=r.children[T];if(nn(n)||Eo(n))continue;const k=No(n,t);if(k===0)return 0;k<b&&(b=k)}return b;case 20:return 2;default:return 0}}const cG=new Set([aE,lE,Rg,Zg]);function sO(r,t){if(r.type===14&&!nn(r.callee)&&cG.has(r.callee)){const l=r.arguments[0];if(l.type===4)return No(l,t);if(l.type===14)return sO(l,t)}return 0}function oO(r,t){let l=3;const f=aO(r);if(f&&f.type===15){const{properties:_}=f;for(let b=0;b<_.length;b++){const{key:T,value:n}=_[b],k=No(T,t);if(k===0)return k;k<l&&(l=k);let j;if(n.type===4?j=No(n,t):n.type===14?j=sO(n,t):j=0,j===0)return j;j<l&&(l=j)}}return l}function aO(r){const t=r.codegenNode;if(t.type===13)return t.props}function uG(r,{filename:t="",prefixIdentifiers:l=!1,hoistStatic:f=!1,hmr:_=!1,cacheHandlers:b=!1,nodeTransforms:T=[],directiveTransforms:n={},transformHoist:k=null,isBuiltInComponent:j=_s,isCustomElement:U=_s,expressionPlugins:Z=[],scopeId:re=null,slotted:se=!0,ssr:ue=!1,inSSR:ne=!1,ssrCssVars:be="",bindingMetadata:De=yn,inline:Be=!1,isTS:Te=!1,onError:me=fE,onWarn:Ie=XL,compatConfig:Xe}){const je=t.replace(/\?.*$/,"").match(/([^/\\]+)\.\w+$/),rt={filename:t,selfName:je&&Ad(hr(je[1])),prefixIdentifiers:l,hoistStatic:f,hmr:_,cacheHandlers:b,nodeTransforms:T,directiveTransforms:n,transformHoist:k,isBuiltInComponent:j,isCustomElement:U,expressionPlugins:Z,scopeId:re,slotted:se,ssr:ue,inSSR:ne,ssrCssVars:be,bindingMetadata:De,inline:Be,isTS:Te,onError:me,onWarn:Ie,compatConfig:Xe,root:r,helpers:new Map,components:new Set,directives:new Set,hoists:[],imports:[],cached:[],constantCache:new WeakMap,temps:0,identifiers:Object.create(null),scopes:{vFor:0,vSlot:0,vPre:0,vOnce:0},parent:null,grandParent:null,currentNode:r,childIndex:0,inVOnce:!1,helper(Ve){const He=rt.helpers.get(Ve)||0;return rt.helpers.set(Ve,He+1),Ve},removeHelper(Ve){const He=rt.helpers.get(Ve);if(He){const st=He-1;st?rt.helpers.set(Ve,st):rt.helpers.delete(Ve)}},helperString(Ve){return`_${Ip[rt.helper(Ve)]}`},replaceNode(Ve){rt.parent.children[rt.childIndex]=rt.currentNode=Ve},removeNode(Ve){const He=rt.parent.children,st=Ve?He.indexOf(Ve):rt.currentNode?rt.childIndex:-1;!Ve||Ve===rt.currentNode?(rt.currentNode=null,rt.onNodeRemoved()):rt.childIndex>st&&(rt.childIndex--,rt.onNodeRemoved()),rt.parent.children.splice(st,1)},onNodeRemoved:_s,addIdentifiers(Ve){},removeIdentifiers(Ve){},hoist(Ve){nn(Ve)&&(Ve=cn(Ve)),rt.hoists.push(Ve);const He=cn(`_hoisted_${rt.hoists.length}`,!1,Ve.loc,2);return He.hoisted=Ve,He},cache(Ve,He=!1,st=!1){const dt=LH(rt.cached.length,Ve,He,st);return rt.cached.push(dt),dt}};return rt.filters=new Set,rt}function hG(r,t){const l=uG(r,t);$1(r,l),t.hoistStatic&&lG(r,l),t.ssr||dG(r,l),r.helpers=new Set([...l.helpers.keys()]),r.components=[...l.components],r.directives=[...l.directives],r.imports=l.imports,r.hoists=l.hoists,r.temps=l.temps,r.cached=l.cached,r.transformed=!0,r.filters=[...l.filters]}function dG(r,t){const{helper:l}=t,{children:f}=r;if(f.length===1){const _=f[0];if(rO(r,_)&&_.codegenNode){const b=_.codegenNode;b.type===13&&dE(b,t),r.codegenNode=b}else r.codegenNode=_}else if(f.length>1){let _=64;r.codegenNode=Dg(t,l(Pg),void 0,r.children,_,void 0,void 0,!0,void 0,!1)}}function fG(r,t){let l=0;const f=()=>{l--};for(;l<r.children.length;l++){const _=r.children[l];nn(_)||(t.grandParent=t.parent,t.parent=r,t.childIndex=l,t.onNodeRemoved=f,$1(_,t))}}function $1(r,t){t.currentNode=r;const{nodeTransforms:l}=t,f=[];for(let b=0;b<l.length;b++){const T=l[b](r,t);if(T&&(vi(T)?f.push(...T):f.push(T)),t.currentNode)r=t.currentNode;else return}switch(r.type){case 3:t.ssr||t.helper(Wg);break;case 5:t.ssr||t.helper(U1);break;case 9:for(let b=0;b<r.branches.length;b++)$1(r.branches[b],t);break;case 10:case 11:case 1:case 0:fG(r,t);break}t.currentNode=r;let _=f.length;for(;_--;)f[_]()}function lO(r,t){const l=nn(r)?f=>f===r:f=>r.test(f);return(f,_)=>{if(f.type===1){const{props:b}=f;if(f.tagType===3&&b.some(HH))return;const T=[];for(let n=0;n<b.length;n++){const k=b[n];if(k.type===7&&l(k.name)){b.splice(n,1),n--;const j=t(f,k,_);j&&T.push(j)}}return T}}}const q1="/*@__PURE__*/",cO=r=>`${Ip[r]}: _${Ip[r]}`;function pG(r,{mode:t="function",prefixIdentifiers:l=t==="module",sourceMap:f=!1,filename:_="template.vue.html",scopeId:b=null,optimizeImports:T=!1,runtimeGlobalName:n="Vue",runtimeModuleName:k="vue",ssrRuntimeModuleName:j="vue/server-renderer",ssr:U=!1,isTS:Z=!1,inSSR:re=!1}){const se={mode:t,prefixIdentifiers:l,sourceMap:f,filename:_,scopeId:b,optimizeImports:T,runtimeGlobalName:n,runtimeModuleName:k,ssrRuntimeModuleName:j,ssr:U,isTS:Z,inSSR:re,source:r.source,code:"",column:1,line:1,offset:0,indentLevel:0,pure:!1,map:void 0,helper(ne){return`_${Ip[ne]}`},push(ne,be=-2,De){se.code+=ne},indent(){ue(++se.indentLevel)},deindent(ne=!1){ne?--se.indentLevel:ue(--se.indentLevel)},newline(){ue(se.indentLevel)}};function ue(ne){se.push(`
`+"  ".repeat(ne),0)}return se}function mG(r,t={}){const l=pG(r,t);t.onContextCreated&&t.onContextCreated(l);const{mode:f,push:_,prefixIdentifiers:b,indent:T,deindent:n,newline:k,scopeId:j,ssr:U}=l,Z=Array.from(r.helpers),re=Z.length>0,se=!b&&f!=="module";_G(r,l);const ne=U?"ssrRender":"render",De=(U?["_ctx","_push","_parent","_attrs"]:["_ctx","_cache"]).join(", ");if(_(`function ${ne}(${De}) {`),T(),se&&(_("with (_ctx) {"),T(),re&&(_(`const { ${Z.map(cO).join(", ")} } = _Vue
`,-1),k())),r.components.length&&(Iw(r.components,"component",l),(r.directives.length||r.temps>0)&&k()),r.directives.length&&(Iw(r.directives,"directive",l),r.temps>0&&k()),r.filters&&r.filters.length&&(k(),Iw(r.filters,"filter",l),k()),r.temps>0){_("let ");for(let Be=0;Be<r.temps;Be++)_(`${Be>0?", ":""}_temp${Be}`)}return(r.components.length||r.directives.length||r.temps)&&(_(`
`,0),k()),U||_("return "),r.codegenNode?Vs(r.codegenNode,l):_("null"),se&&(n(),_("}")),n(),_("}"),{ast:r,code:l.code,preamble:"",map:l.map?l.map.toJSON():void 0}}function _G(r,t){const{ssr:l,prefixIdentifiers:f,push:_,newline:b,runtimeModuleName:T,runtimeGlobalName:n,ssrRuntimeModuleName:k}=t,j=n,U=Array.from(r.helpers);if(U.length>0&&(_(`const _Vue = ${j}
`,-1),r.hoists.length)){const Z=[J2,Q2,Wg,eE,HL].filter(re=>U.includes(re)).map(cO).join(", ");_(`const { ${Z} } = _Vue
`,-1)}gG(r.hoists,t),b(),_("return ")}function Iw(r,t,{helper:l,push:f,newline:_,isTS:b}){const T=l(t==="filter"?rE:t==="component"?tE:nE);for(let n=0;n<r.length;n++){let k=r[n];const j=k.endsWith("__self");j&&(k=k.slice(0,-6)),f(`const ${Og(k,t)} = ${T}(${JSON.stringify(k)}${j?", true":""})${b?"!":""}`),n<r.length-1&&_()}}function gG(r,t){if(!r.length)return;t.pure=!0;const{push:l,newline:f}=t;f();for(let _=0;_<r.length;_++){const b=r[_];b&&(l(`const _hoisted_${_+1} = `),Vs(b,t),f())}t.pure=!1}function _E(r,t){const l=r.length>3||!1;t.push("["),l&&t.indent(),Xg(r,t,l),l&&t.deindent(),t.push("]")}function Xg(r,t,l=!1,f=!0){const{push:_,newline:b}=t;for(let T=0;T<r.length;T++){const n=r[T];nn(n)?_(n,-3):vi(n)?_E(n,t):Vs(n,t),T<r.length-1&&(l?(f&&_(","),b()):f&&_(", "))}}function Vs(r,t){if(nn(r)){t.push(r,-3);return}if(Eo(r)){t.push(t.helper(r));return}switch(r.type){case 1:case 9:case 11:Vs(r.codegenNode,t);break;case 2:yG(r,t);break;case 4:uO(r,t);break;case 5:vG(r,t);break;case 12:Vs(r.codegenNode,t);break;case 8:hO(r,t);break;case 3:bG(r,t);break;case 13:wG(r,t);break;case 14:EG(r,t);break;case 15:SG(r,t);break;case 17:AG(r,t);break;case 18:MG(r,t);break;case 19:CG(r,t);break;case 20:IG(r,t);break;case 21:Xg(r.body,t,!0,!1);break}}function yG(r,t){t.push(JSON.stringify(r.content),-3,r)}function uO(r,t){const{content:l,isStatic:f}=r;t.push(f?JSON.stringify(l):l,-3,r)}function vG(r,t){const{push:l,helper:f,pure:_}=t;_&&l(q1),l(`${f(U1)}(`),Vs(r.content,t),l(")")}function hO(r,t){for(let l=0;l<r.children.length;l++){const f=r.children[l];nn(f)?t.push(f,-3):Vs(f,t)}}function xG(r,t){const{push:l}=t;if(r.type===8)l("["),hO(r,t),l("]");else if(r.isStatic){const f=pE(r.content)?r.content:JSON.stringify(r.content);l(f,-2,r)}else l(`[${r.content}]`,-3,r)}function bG(r,t){const{push:l,helper:f,pure:_}=t;_&&l(q1),l(`${f(Wg)}(${JSON.stringify(r.content)})`,-3,r)}function wG(r,t){const{push:l,helper:f,pure:_}=t,{tag:b,props:T,children:n,patchFlag:k,dynamicProps:j,directives:U,isBlock:Z,disableTracking:re,isComponent:se}=r;let ue;k&&(ue=String(k)),U&&l(f(sE)+"("),Z&&l(`(${f(vd)}(${re?"true":""}), `),_&&l(q1);const ne=Z?Dp(t.inSSR,se):Rp(t.inSSR,se);l(f(ne)+"(",-2,r),Xg(TG([b,T,n,ue,j]),t),l(")"),Z&&l(")"),U&&(l(", "),Vs(U,t),l(")"))}function TG(r){let t=r.length;for(;t--&&r[t]==null;);return r.slice(0,t+1).map(l=>l||"null")}function EG(r,t){const{push:l,helper:f,pure:_}=t,b=nn(r.callee)?r.callee:f(r.callee);_&&l(q1),l(b+"(",-2,r),Xg(r.arguments,t),l(")")}function SG(r,t){const{push:l,indent:f,deindent:_,newline:b}=t,{properties:T}=r;if(!T.length){l("{}",-2,r);return}const n=T.length>1||!1;l(n?"{":"{ "),n&&f();for(let k=0;k<T.length;k++){const{key:j,value:U}=T[k];xG(j,t),l(": "),Vs(U,t),k<T.length-1&&(l(","),b())}n&&_(),l(n?"}":" }")}function AG(r,t){_E(r.elements,t)}function MG(r,t){const{push:l,indent:f,deindent:_}=t,{params:b,returns:T,body:n,newline:k,isSlot:j}=r;j&&l(`_${Ip[uE]}(`),l("(",-2,r),vi(b)?Xg(b,t):b&&Vs(b,t),l(") => "),(k||n)&&(l("{"),f()),T?(k&&l("return "),vi(T)?_E(T,t):Vs(T,t)):n&&Vs(n,t),(k||n)&&(_(),l("}")),j&&(r.isNonScopedSlot&&l(", undefined, true"),l(")"))}function CG(r,t){const{test:l,consequent:f,alternate:_,newline:b}=r,{push:T,indent:n,deindent:k,newline:j}=t;if(l.type===4){const Z=!pE(l.content);Z&&T("("),uO(l,t),Z&&T(")")}else T("("),Vs(l,t),T(")");b&&n(),t.indentLevel++,b||T(" "),T("? "),Vs(f,t),t.indentLevel--,b&&j(),b||T(" "),T(": ");const U=_.type===19;U||t.indentLevel++,Vs(_,t),U||t.indentLevel--,b&&k(!0)}function IG(r,t){const{push:l,helper:f,indent:_,deindent:b,newline:T}=t,{needPauseTracking:n,needArraySpread:k}=r;k&&l("[...("),l(`_cache[${r.index}] || (`),n&&(_(),l(`${f(Zv)}(-1`),r.inVOnce&&l(", true"),l("),"),T(),l("(")),l(`_cache[${r.index}] = `),Vs(r.value,t),n&&(l(`).cacheIndex = ${r.index},`),T(),l(`${f(Zv)}(1),`),T(),l(`_cache[${r.index}]`),b()),l(")"),k&&l(")]")}new RegExp("\\b"+"arguments,await,break,case,catch,class,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,let,new,return,super,switch,throw,try,var,void,while,with,yield".split(",").join("\\b|\\b")+"\\b");const PG=lO(/^(if|else|else-if)$/,(r,t,l)=>RG(r,t,l,(f,_,b)=>{const T=l.parent.children;let n=T.indexOf(f),k=0;for(;n-->=0;){const j=T[n];j&&j.type===9&&(k+=j.branches.length)}return()=>{if(b)f.codegenNode=JI(_,k,l);else{const j=DG(f.codegenNode);j.alternate=JI(_,k+f.branches.length-1,l)}}}));function RG(r,t,l,f){if(t.name!=="else"&&(!t.exp||!t.exp.content.trim())){const _=t.exp?t.exp.loc:r.loc;l.onError(vr(28,t.loc)),t.exp=cn("true",!1,_)}if(t.name==="if"){const _=KI(r,t),b={type:9,loc:rG(r.loc),branches:[_]};if(l.replaceNode(b),f)return f(b,_,!0)}else{const _=l.parent.children;let b=_.indexOf(r);for(;b-->=-1;){const T=_[b];if(T&&T.type===3){l.removeNode(T);continue}if(T&&T.type===2&&!T.content.trim().length){l.removeNode(T);continue}if(T&&T.type===9){t.name==="else-if"&&T.branches[T.branches.length-1].condition===void 0&&l.onError(vr(30,r.loc)),l.removeNode();const n=KI(r,t);T.branches.push(n);const k=f&&f(T,n,!1);$1(n,l),k&&k(),l.currentNode=null}else l.onError(vr(30,r.loc));break}}}function KI(r,t){const l=r.tagType===3;return{type:10,loc:r.loc,condition:t.name==="else"?void 0:t.exp,children:l&&!_a(r,"for")?r.children:[r],userKey:j1(r,"key"),isTemplateIf:l}}function JI(r,t,l){return r.condition?CT(r.condition,QI(r,t,l),os(l.helper(Wg),['""',"true"])):QI(r,t,l)}function QI(r,t,l){const{helper:f}=l,_=Nr("key",cn(`${t}`,!1,Xo,2)),{children:b}=r,T=b[0];if(b.length!==1||T.type!==1)if(b.length===1&&T.type===11){const k=T.codegenNode;return Jv(k,_,l),k}else{let k=64;return Dg(l,f(Pg),va([_]),b,k,void 0,void 0,!0,!1,!1,r.loc)}else{const k=T.codegenNode,j=WH(k);return j.type===13&&dE(j,l),Jv(j,_,l),k}}function DG(r){for(;;)if(r.type===19)if(r.alternate.type===19)r=r.alternate;else return r;else r.type===20&&(r=r.value)}const LG=(r,t,l)=>{const{modifiers:f,loc:_}=r,b=r.arg;let{exp:T}=r;if(T&&T.type===4&&!T.content.trim()&&(T=void 0),!T){if(b.type!==4||!b.isStatic)return l.onError(vr(52,b.loc)),{props:[Nr(b,cn("",!0,_))]};dO(r),T=r.exp}return b.type!==4?(b.children.unshift("("),b.children.push(') || ""')):b.isStatic||(b.content=`${b.content} || ""`),f.some(n=>n.content==="camel")&&(b.type===4?b.isStatic?b.content=hr(b.content):b.content=`${l.helperString(AT)}(${b.content})`:(b.children.unshift(`${l.helperString(AT)}(`),b.children.push(")"))),l.inSSR||(f.some(n=>n.content==="prop")&&eP(b,"."),f.some(n=>n.content==="attr")&&eP(b,"^")),{props:[Nr(b,T)]}},dO=(r,t)=>{const l=r.arg,f=hr(l.content);r.exp=cn(f,!1,l.loc)},eP=(r,t)=>{r.type===4?r.isStatic?r.content=t+r.content:r.content=`\`${t}\${${r.content}}\``:(r.children.unshift(`'${t}' + (`),r.children.push(")"))},OG=lO("for",(r,t,l)=>{const{helper:f,removeHelper:_}=l;return zG(r,t,l,b=>{const T=os(f(oE),[b.source]),n=Yv(r),k=_a(r,"memo"),j=j1(r,"key",!1,!0);j&&j.type===7&&!j.exp&&dO(j);let Z=j&&(j.type===6?j.value?cn(j.value.content,!0):void 0:j.exp);const re=j&&Z?Nr("key",Z):null,se=b.source.type===4&&b.source.constType>0,ue=se?64:j?128:256;return b.codegenNode=Dg(l,f(Pg),void 0,T,ue,void 0,void 0,!0,!se,!1,r.loc),()=>{let ne;const{children:be}=b,De=be.length!==1||be[0].type!==1,Be=Kv(r)?r:n&&r.children.length===1&&Kv(r.children[0])?r.children[0]:null;if(Be?(ne=Be.codegenNode,n&&re&&Jv(ne,re,l)):De?ne=Dg(l,f(Pg),re?va([re]):void 0,r.children,64,void 0,void 0,!0,void 0,!1):(ne=be[0].codegenNode,n&&re&&Jv(ne,re,l),ne.isBlock!==!se&&(ne.isBlock?(_(vd),_(Dp(l.inSSR,ne.isComponent))):_(Rp(l.inSSR,ne.isComponent))),ne.isBlock=!se,ne.isBlock?(f(vd),f(Dp(l.inSSR,ne.isComponent))):f(Rp(l.inSSR,ne.isComponent))),k){const Te=Pp(RT(b.parseResult,[cn("_cached")]));Te.body=OH([Xa(["const _memo = (",k.exp,")"]),Xa(["if (_cached",...Z?[" && _cached.key === ",Z]:[],` && ${l.helperString(ZL)}(_cached, _memo)) return _cached`]),Xa(["const _item = ",ne]),cn("_item.memo = _memo"),cn("return _item")]),T.arguments.push(Te,cn("_cache"),cn(String(l.cached.length))),l.cached.push(null)}else T.arguments.push(Pp(RT(b.parseResult),ne,!0))}})});function zG(r,t,l,f){if(!t.exp){l.onError(vr(31,t.loc));return}const _=t.forParseResult;if(!_){l.onError(vr(32,t.loc));return}fO(_);const{addIdentifiers:b,removeIdentifiers:T,scopes:n}=l,{source:k,value:j,key:U,index:Z}=_,re={type:11,loc:t.loc,source:k,valueAlias:j,keyAlias:U,objectIndexAlias:Z,parseResult:_,children:Yv(r)?r.children:[r]};l.replaceNode(re),n.vFor++;const se=f&&f(re);return()=>{n.vFor--,se&&se()}}function fO(r,t){r.finalized||(r.finalized=!0)}function RT({value:r,key:t,index:l},f=[]){return kG([r,t,l,...f])}function kG(r){let t=r.length;for(;t--&&!r[t];);return r.slice(0,t+1).map((l,f)=>l||cn("_".repeat(f+1),!1))}const tP=cn("undefined",!1),FG=(r,t)=>{if(r.type===1&&(r.tagType===1||r.tagType===3)){const l=_a(r,"slot");if(l)return l.exp,t.scopes.vSlot++,()=>{t.scopes.vSlot--}}},NG=(r,t,l,f)=>Pp(r,l,!1,!0,l.length?l[0].loc:f);function BG(r,t,l=NG){t.helper(uE);const{children:f,loc:_}=r,b=[],T=[];let n=t.scopes.vSlot>0||t.scopes.vFor>0;const k=_a(r,"slot",!0);if(k){const{arg:be,exp:De}=k;be&&!yo(be)&&(n=!0),b.push(Nr(be||cn("default",!0),l(De,void 0,f,_)))}let j=!1,U=!1;const Z=[],re=new Set;let se=0;for(let be=0;be<f.length;be++){const De=f[be];let Be;if(!Yv(De)||!(Be=_a(De,"slot",!0))){De.type!==3&&Z.push(De);continue}if(k){t.onError(vr(37,Be.loc));break}j=!0;const{children:Te,loc:me}=De,{arg:Ie=cn("default",!0),exp:Xe,loc:je}=Be;let rt;yo(Ie)?rt=Ie?Ie.content:"default":n=!0;const Ve=_a(De,"for"),He=l(Xe,Ve,Te,me);let st,dt;if(st=_a(De,"if"))n=!0,T.push(CT(st.exp,X0(Ie,He,se++),tP));else if(dt=_a(De,/^else(-if)?$/,!0)){let At=be,ni;for(;At--&&(ni=f[At],ni.type===3););if(ni&&Yv(ni)&&_a(ni,/^(else-)?if$/)){let Tt=T[T.length-1];for(;Tt.alternate.type===19;)Tt=Tt.alternate;Tt.alternate=dt.exp?CT(dt.exp,X0(Ie,He,se++),tP):X0(Ie,He,se++)}else t.onError(vr(30,dt.loc))}else if(Ve){n=!0;const At=Ve.forParseResult;At?(fO(At),T.push(os(t.helper(oE),[At.source,Pp(RT(At),X0(Ie,He),!0)]))):t.onError(vr(32,Ve.loc))}else{if(rt){if(re.has(rt)){t.onError(vr(38,je));continue}re.add(rt),rt==="default"&&(U=!0)}b.push(Nr(Ie,He))}}if(!k){const be=(De,Be)=>{const Te=l(De,void 0,Be,_);return t.compatConfig&&(Te.isNonScopedSlot=!0),Nr("default",Te)};j?Z.length&&Z.some(De=>pO(De))&&(U?t.onError(vr(39,Z[0].loc)):b.push(be(void 0,Z))):b.push(be(void 0,f))}const ue=n?2:mv(r.children)?3:1;let ne=va(b.concat(Nr("_",cn(ue+"",!1))),_);return T.length&&(ne=os(t.helper(WL),[ne,cd(T)])),{slots:ne,hasDynamicSlots:n}}function X0(r,t,l){const f=[Nr("name",r),Nr("fn",t)];return l!=null&&f.push(Nr("key",cn(String(l),!0))),va(f)}function mv(r){for(let t=0;t<r.length;t++){const l=r[t];switch(l.type){case 1:if(l.tagType===2||mv(l.children))return!0;break;case 9:if(mv(l.branches))return!0;break;case 10:case 11:if(mv(l.children))return!0;break}}return!1}function pO(r){return r.type!==2&&r.type!==12?!0:r.type===2?!!r.content.trim():pO(r.content)}const mO=new WeakMap,VG=(r,t)=>function(){if(r=t.currentNode,!(r.type===1&&(r.tagType===0||r.tagType===1)))return;const{tag:f,props:_}=r,b=r.tagType===1;let T=b?UG(r,t):`"${f}"`;const n=$n(T)&&T.callee===iE;let k,j,U=0,Z,re,se,ue=n||T===hg||T===K2||!b&&(f==="svg"||f==="foreignObject"||f==="math");if(_.length>0){const ne=_O(r,t,void 0,b,n);k=ne.props,U=ne.patchFlag,re=ne.dynamicPropNames;const be=ne.directives;se=be&&be.length?cd(be.map(De=>$G(De,t))):void 0,ne.shouldUseBlock&&(ue=!0)}if(r.children.length>0)if(T===Gv&&(ue=!0,U|=1024),b&&T!==hg&&T!==Gv){const{slots:be,hasDynamicSlots:De}=BG(r,t);j=be,De&&(U|=1024)}else if(r.children.length===1&&T!==hg){const be=r.children[0],De=be.type,Be=De===5||De===8;Be&&No(be,t)===0&&(U|=1),Be||De===2?j=be:j=r.children}else j=r.children;re&&re.length&&(Z=qG(re)),r.codegenNode=Dg(t,T,k,j,U===0?void 0:U,Z,se,!!ue,!1,b,r.loc)};function UG(r,t,l=!1){let{tag:f}=r;const _=DT(f),b=j1(r,"is",!1,!0);if(b)if(_||ud("COMPILER_IS_ON_ELEMENT",t)){let n;if(b.type===6?n=b.value&&cn(b.value.content,!0):(n=b.exp,n||(n=cn("is",!1,b.arg.loc))),n)return os(t.helper(iE),[n])}else b.type===6&&b.value.content.startsWith("vue:")&&(f=b.value.content.slice(4));const T=YL(f)||t.isBuiltInComponent(f);return T?(l||t.helper(T),T):(t.helper(tE),t.components.add(f),Og(f,"component"))}function _O(r,t,l=r.props,f,_,b=!1){const{tag:T,loc:n,children:k}=r;let j=[];const U=[],Z=[],re=k.length>0;let se=!1,ue=0,ne=!1,be=!1,De=!1,Be=!1,Te=!1,me=!1;const Ie=[],Xe=He=>{j.length&&(U.push(va(iP(j),n)),j=[]),He&&U.push(He)},je=()=>{t.scopes.vFor>0&&j.push(Nr(cn("ref_for",!0),cn("true")))},rt=({key:He,value:st})=>{if(yo(He)){const dt=He.content,At=Ed(dt);if(At&&(!f||_)&&dt.toLowerCase()!=="onclick"&&dt!=="onUpdate:modelValue"&&!yu(dt)&&(Be=!0),At&&yu(dt)&&(me=!0),At&&st.type===14&&(st=st.arguments[0]),st.type===20||(st.type===4||st.type===8)&&No(st,t)>0)return;dt==="ref"?ne=!0:dt==="class"?be=!0:dt==="style"?De=!0:dt!=="key"&&!Ie.includes(dt)&&Ie.push(dt),f&&(dt==="class"||dt==="style")&&!Ie.includes(dt)&&Ie.push(dt)}else Te=!0};for(let He=0;He<l.length;He++){const st=l[He];if(st.type===6){const{loc:dt,name:At,nameLoc:ni,value:Tt}=st;let kt=!0;if(At==="ref"&&(ne=!0,je()),At==="is"&&(DT(T)||Tt&&Tt.content.startsWith("vue:")||ud("COMPILER_IS_ON_ELEMENT",t)))continue;j.push(Nr(cn(At,!0,ni),cn(Tt?Tt.content:"",kt,Tt?Tt.loc:dt)))}else{const{name:dt,arg:At,exp:ni,loc:Tt,modifiers:kt}=st,ti=dt==="bind",li=dt==="on";if(dt==="slot"){f||t.onError(vr(40,Tt));continue}if(dt==="once"||dt==="memo"||dt==="is"||ti&&Yh(At,"is")&&(DT(T)||ud("COMPILER_IS_ON_ELEMENT",t))||li&&b)continue;if((ti&&Yh(At,"key")||li&&re&&Yh(At,"vue:before-update"))&&(se=!0),ti&&Yh(At,"ref")&&je(),!At&&(ti||li)){if(Te=!0,ni)if(ti){if(je(),Xe(),ud("COMPILER_V_BIND_OBJECT_ORDER",t)){U.unshift(ni);continue}U.push(ni)}else Xe({type:14,loc:Tt,callee:t.helper(cE),arguments:f?[ni]:[ni,"true"]});else t.onError(vr(ti?34:35,Tt));continue}ti&&kt.some(Pn=>Pn.content==="prop")&&(ue|=32);const ii=t.directiveTransforms[dt];if(ii){const{props:Pn,needRuntime:Fn}=ii(st,r,t);!b&&Pn.forEach(rt),li&&At&&!yo(At)?Xe(va(Pn,n)):j.push(...Pn),Fn&&(Z.push(st),Eo(Fn)&&mO.set(st,Fn))}else Fj(dt)||(Z.push(st),re&&(se=!0))}}let Ve;if(U.length?(Xe(),U.length>1?Ve=os(t.helper(Wv),U,n):Ve=U[0]):j.length&&(Ve=va(iP(j),n)),Te?ue|=16:(be&&!f&&(ue|=2),De&&!f&&(ue|=4),Ie.length&&(ue|=8),Be&&(ue|=32)),!se&&(ue===0||ue===32)&&(ne||me||Z.length>0)&&(ue|=512),!t.inSSR&&Ve)switch(Ve.type){case 15:let He=-1,st=-1,dt=!1;for(let Tt=0;Tt<Ve.properties.length;Tt++){const kt=Ve.properties[Tt].key;yo(kt)?kt.content==="class"?He=Tt:kt.content==="style"&&(st=Tt):kt.isHandlerKey||(dt=!0)}const At=Ve.properties[He],ni=Ve.properties[st];dt?Ve=os(t.helper(Rg),[Ve]):(At&&!yo(At.value)&&(At.value=os(t.helper(aE),[At.value])),ni&&(De||ni.value.type===4&&ni.value.content.trim()[0]==="["||ni.value.type===17)&&(ni.value=os(t.helper(lE),[ni.value])));break;case 14:break;default:Ve=os(t.helper(Rg),[os(t.helper(Zg),[Ve])]);break}return{props:Ve,directives:Z,patchFlag:ue,dynamicPropNames:Ie,shouldUseBlock:se}}function iP(r){const t=new Map,l=[];for(let f=0;f<r.length;f++){const _=r[f];if(_.key.type===8||!_.key.isStatic){l.push(_);continue}const b=_.key.content,T=t.get(b);T?(b==="style"||b==="class"||Ed(b))&&jG(T,_):(t.set(b,_),l.push(_))}return l}function jG(r,t){r.value.type===17?r.value.elements.push(t.value):r.value=cd([r.value,t.value],r.loc)}function $G(r,t){const l=[],f=mO.get(r);f?l.push(t.helperString(f)):(t.helper(nE),t.directives.add(r.name),l.push(Og(r.name,"directive")));const{loc:_}=r;if(r.exp&&l.push(r.exp),r.arg&&(r.exp||l.push("void 0"),l.push(r.arg)),Object.keys(r.modifiers).length){r.arg||(r.exp||l.push("void 0"),l.push("void 0"));const b=cn("true",!1,_);l.push(va(r.modifiers.map(T=>Nr(T,b)),_))}return cd(l,r.loc)}function qG(r){let t="[";for(let l=0,f=r.length;l<f;l++)t+=JSON.stringify(r[l]),l<f-1&&(t+=", ");return t+"]"}function DT(r){return r==="component"||r==="Component"}const HG=(r,t)=>{if(Kv(r)){const{children:l,loc:f}=r,{slotName:_,slotProps:b}=GG(r,t),T=[t.prefixIdentifiers?"_ctx.$slots":"$slots",_,"{}","undefined","true"];let n=2;b&&(T[2]=b,n=3),l.length&&(T[3]=Pp([],l,!1,!1,f),n=4),t.scopeId&&!t.slotted&&(n=5),T.splice(n),r.codegenNode=os(t.helper(GL),T,f)}};function GG(r,t){let l='"default"',f;const _=[];for(let b=0;b<r.props.length;b++){const T=r.props[b];if(T.type===6)T.value&&(T.name==="name"?l=JSON.stringify(T.value.content):(T.name=hr(T.name),_.push(T)));else if(T.name==="bind"&&Yh(T.arg,"name")){if(T.exp)l=T.exp;else if(T.arg&&T.arg.type===4){const n=hr(T.arg.content);l=T.exp=cn(n,!1,T.arg.loc)}}else T.name==="bind"&&T.arg&&yo(T.arg)&&(T.arg.content=hr(T.arg.content)),_.push(T)}if(_.length>0){const{props:b,directives:T}=_O(r,t,_,!1,!1);f=b,T.length&&t.onError(vr(36,T[0].loc))}return{slotName:l,slotProps:f}}const gO=(r,t,l,f)=>{const{loc:_,modifiers:b,arg:T}=r;!r.exp&&!b.length&&l.onError(vr(35,_));let n;if(T.type===4)if(T.isStatic){let Z=T.content;Z.startsWith("vue:")&&(Z=`vnode-${Z.slice(4)}`);const re=t.tagType!==0||Z.startsWith("vnode")||!/[A-Z]/.test(Z)?lp(hr(Z)):`on:${Z}`;n=cn(re,!0,T.loc)}else n=Xa([`${l.helperString(MT)}(`,T,")"]);else n=T,n.children.unshift(`${l.helperString(MT)}(`),n.children.push(")");let k=r.exp;k&&!k.content.trim()&&(k=void 0);let j=l.cacheHandlers&&!k&&!l.inVOnce;if(k){const Z=JL(k),re=!(Z||$H(k)),se=k.content.includes(";");(re||j&&Z)&&(k=Xa([`${re?"$event":"(...args)"} => ${se?"{":"("}`,k,se?"}":")"]))}let U={props:[Nr(n,k||cn("() => {}",!1,_))]};return f&&(U=f(U)),j&&(U.props[0].value=l.cache(U.props[0].value)),U.props.forEach(Z=>Z.key.isHandlerKey=!0),U},WG=(r,t)=>{if(r.type===0||r.type===1||r.type===11||r.type===10)return()=>{const l=r.children;let f,_=!1;for(let b=0;b<l.length;b++){const T=l[b];if(Cw(T)){_=!0;for(let n=b+1;n<l.length;n++){const k=l[n];if(Cw(k))f||(f=l[b]=Xa([T],T.loc)),f.children.push(" + ",k),l.splice(n,1),n--;else{f=void 0;break}}}}if(!(!_||l.length===1&&(r.type===0||r.type===1&&r.tagType===0&&!r.props.find(b=>b.type===7&&!t.directiveTransforms[b.name])&&r.tag!=="template")))for(let b=0;b<l.length;b++){const T=l[b];if(Cw(T)||T.type===8){const n=[];(T.type!==2||T.content!==" ")&&n.push(T),!t.ssr&&No(T,t)===0&&n.push("1"),l[b]={type:12,content:T,loc:T.loc,codegenNode:os(t.helper(eE),n)}}}}},nP=new WeakSet,ZG=(r,t)=>{if(r.type===1&&_a(r,"once",!0))return nP.has(r)||t.inVOnce||t.inSSR?void 0:(nP.add(r),t.inVOnce=!0,t.helper(Zv),()=>{t.inVOnce=!1;const l=t.currentNode;l.codegenNode&&(l.codegenNode=t.cache(l.codegenNode,!0,!0))})},yO=(r,t,l)=>{const{exp:f,arg:_}=r;if(!f)return l.onError(vr(41,r.loc)),Y0();const b=f.loc.source.trim(),T=f.type===4?f.content:b,n=l.bindingMetadata[b];if(n==="props"||n==="props-aliased")return l.onError(vr(44,f.loc)),Y0();const k=!1;if(!T.trim()||!JL(f)&&!k)return l.onError(vr(42,f.loc)),Y0();const j=_||cn("modelValue",!0),U=_?yo(_)?`onUpdate:${hr(_.content)}`:Xa(['"onUpdate:" + ',_]):"onUpdate:modelValue";let Z;const re=l.isTS?"($event: any)":"$event";Z=Xa([`${re} => ((`,f,") = $event)"]);const se=[Nr(j,r.exp),Nr(U,Z)];if(r.modifiers.length&&t.tagType===1){const ue=r.modifiers.map(be=>be.content).map(be=>(pE(be)?be:JSON.stringify(be))+": true").join(", "),ne=_?yo(_)?`${_.content}Modifiers`:Xa([_,' + "Modifiers"']):"modelModifiers";se.push(Nr(ne,cn(`{ ${ue} }`,!1,r.loc,2)))}return Y0(se)};function Y0(r=[]){return{props:r}}const XG=/[\w).+\-_$\]]/,YG=(r,t)=>{ud("COMPILER_FILTERS",t)&&(r.type===5?Qv(r.content,t):r.type===1&&r.props.forEach(l=>{l.type===7&&l.name!=="for"&&l.exp&&Qv(l.exp,t)}))};function Qv(r,t){if(r.type===4)rP(r,t);else for(let l=0;l<r.children.length;l++){const f=r.children[l];typeof f=="object"&&(f.type===4?rP(f,t):f.type===8?Qv(r,t):f.type===5&&Qv(f.content,t))}}function rP(r,t){const l=r.content;let f=!1,_=!1,b=!1,T=!1,n=0,k=0,j=0,U=0,Z,re,se,ue,ne=[];for(se=0;se<l.length;se++)if(re=Z,Z=l.charCodeAt(se),f)Z===39&&re!==92&&(f=!1);else if(_)Z===34&&re!==92&&(_=!1);else if(b)Z===96&&re!==92&&(b=!1);else if(T)Z===47&&re!==92&&(T=!1);else if(Z===124&&l.charCodeAt(se+1)!==124&&l.charCodeAt(se-1)!==124&&!n&&!k&&!j)ue===void 0?(U=se+1,ue=l.slice(0,se).trim()):be();else{switch(Z){case 34:_=!0;break;case 39:f=!0;break;case 96:b=!0;break;case 40:j++;break;case 41:j--;break;case 91:k++;break;case 93:k--;break;case 123:n++;break;case 125:n--;break}if(Z===47){let De=se-1,Be;for(;De>=0&&(Be=l.charAt(De),Be===" ");De--);(!Be||!XG.test(Be))&&(T=!0)}}ue===void 0?ue=l.slice(0,se).trim():U!==0&&be();function be(){ne.push(l.slice(U,se).trim()),U=se+1}if(ne.length){for(se=0;se<ne.length;se++)ue=KG(ue,ne[se],t);r.content=ue,r.ast=void 0}}function KG(r,t,l){l.helper(rE);const f=t.indexOf("(");if(f<0)return l.filters.add(t),`${Og(t,"filter")}(${r})`;{const _=t.slice(0,f),b=t.slice(f+1);return l.filters.add(_),`${Og(_,"filter")}(${r}${b!==")"?","+b:b}`}}const sP=new WeakSet,JG=(r,t)=>{if(r.type===1){const l=_a(r,"memo");return!l||sP.has(r)?void 0:(sP.add(r),()=>{const f=r.codegenNode||t.currentNode.codegenNode;f&&f.type===13&&(r.tagType!==1&&dE(f,t),r.codegenNode=os(t.helper(hE),[l.exp,Pp(void 0,f),"_cache",String(t.cached.length)]),t.cached.push(null))})}};function QG(r){return[[ZG,PG,JG,OG,YG,HG,VG,FG,WG],{on:gO,bind:LG,model:yO}]}function eW(r,t={}){const l=t.onError||fE,f=t.mode==="module";t.prefixIdentifiers===!0?l(vr(47)):f&&l(vr(48));const _=!1;t.cacheHandlers&&l(vr(49)),t.scopeId&&!f&&l(vr(50));const b=vn({},t,{prefixIdentifiers:_}),T=nn(r)?aG(r,b):r,[n,k]=QG();return hG(T,vn({},b,{nodeTransforms:[...n,...t.nodeTransforms||[]],directiveTransforms:vn({},k,t.directiveTransforms||{})})),mG(T,b)}const tW=()=>({props:[]});/**
* @vue/compiler-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const vO=Symbol(""),xO=Symbol(""),bO=Symbol(""),wO=Symbol(""),LT=Symbol(""),TO=Symbol(""),EO=Symbol(""),SO=Symbol(""),AO=Symbol(""),MO=Symbol("");RH({[vO]:"vModelRadio",[xO]:"vModelCheckbox",[bO]:"vModelText",[wO]:"vModelSelect",[LT]:"vModelDynamic",[TO]:"withModifiers",[EO]:"withKeys",[SO]:"vShow",[AO]:"Transition",[MO]:"TransitionGroup"});let Gf;function iW(r,t=!1){return Gf||(Gf=document.createElement("div")),t?(Gf.innerHTML=`<div foo="${r.replace(/"/g,"&quot;")}">`,Gf.children[0].getAttribute("foo")):(Gf.innerHTML=r,Gf.textContent)}const nW={parseMode:"html",isVoidTag:e$,isNativeTag:r=>Kj(r)||Jj(r)||Qj(r),isPreTag:r=>r==="pre",isIgnoreNewlineTag:r=>r==="pre"||r==="textarea",decodeEntities:iW,isBuiltInComponent:r=>{if(r==="Transition"||r==="transition")return AO;if(r==="TransitionGroup"||r==="transition-group")return MO},getNamespace(r,t,l){let f=t?t.ns:l;if(t&&f===2)if(t.tag==="annotation-xml"){if(r==="svg")return 1;t.props.some(_=>_.type===6&&_.name==="encoding"&&_.value!=null&&(_.value.content==="text/html"||_.value.content==="application/xhtml+xml"))&&(f=0)}else/^m(?:[ions]|text)$/.test(t.tag)&&r!=="mglyph"&&r!=="malignmark"&&(f=0);else t&&f===1&&(t.tag==="foreignObject"||t.tag==="desc"||t.tag==="title")&&(f=0);if(f===0){if(r==="svg")return 1;if(r==="math")return 2}return f}},rW=r=>{r.type===1&&r.props.forEach((t,l)=>{t.type===6&&t.name==="style"&&t.value&&(r.props[l]={type:7,name:"bind",arg:cn("style",!0,t.loc),exp:sW(t.value.content,t.loc),modifiers:[],loc:t.loc})})},sW=(r,t)=>{const l=N3(r);return cn(JSON.stringify(l),!1,t,3)};function wu(r,t){return vr(r,t)}const oW=(r,t,l)=>{const{exp:f,loc:_}=r;return f||l.onError(wu(53,_)),t.children.length&&(l.onError(wu(54,_)),t.children.length=0),{props:[Nr(cn("innerHTML",!0,_),f||cn("",!0))]}},aW=(r,t,l)=>{const{exp:f,loc:_}=r;return f||l.onError(wu(55,_)),t.children.length&&(l.onError(wu(56,_)),t.children.length=0),{props:[Nr(cn("textContent",!0),f?No(f,l)>0?f:os(l.helperString(U1),[f],_):cn("",!0))]}},lW=(r,t,l)=>{const f=yO(r,t,l);if(!f.props.length||t.tagType===1)return f;r.arg&&l.onError(wu(58,r.arg.loc));const{tag:_}=t,b=l.isCustomElement(_);if(_==="input"||_==="textarea"||_==="select"||b){let T=bO,n=!1;if(_==="input"||b){const k=j1(t,"type");if(k){if(k.type===7)T=LT;else if(k.value)switch(k.value.content){case"radio":T=vO;break;case"checkbox":T=xO;break;case"file":n=!0,l.onError(wu(59,r.loc));break}}else qH(t)&&(T=LT)}else _==="select"&&(T=wO);n||(f.needRuntime=l.helper(T))}else l.onError(wu(57,r.loc));return f.props=f.props.filter(T=>!(T.key.type===4&&T.key.content==="modelValue")),f},cW=Zo("passive,once,capture"),uW=Zo("stop,prevent,self,ctrl,shift,alt,meta,exact,middle"),hW=Zo("left,right"),CO=Zo("onkeyup,onkeydown,onkeypress"),dW=(r,t,l,f)=>{const _=[],b=[],T=[];for(let n=0;n<t.length;n++){const k=t[n].content;k==="native"&&Lg("COMPILER_V_ON_NATIVE",l)||cW(k)?T.push(k):hW(k)?yo(r)?CO(r.content.toLowerCase())?_.push(k):b.push(k):(_.push(k),b.push(k)):uW(k)?b.push(k):_.push(k)}return{keyModifiers:_,nonKeyModifiers:b,eventOptionModifiers:T}},oP=(r,t)=>yo(r)&&r.content.toLowerCase()==="onclick"?cn(t,!0):r.type!==4?Xa(["(",r,`) === "onClick" ? "${t}" : (`,r,")"]):r,fW=(r,t,l)=>gO(r,t,l,f=>{const{modifiers:_}=r;if(!_.length)return f;let{key:b,value:T}=f.props[0];const{keyModifiers:n,nonKeyModifiers:k,eventOptionModifiers:j}=dW(b,_,l,r.loc);if(k.includes("right")&&(b=oP(b,"onContextmenu")),k.includes("middle")&&(b=oP(b,"onMouseup")),k.length&&(T=os(l.helper(TO),[T,JSON.stringify(k)])),n.length&&(!yo(b)||CO(b.content.toLowerCase()))&&(T=os(l.helper(EO),[T,JSON.stringify(n)])),j.length){const U=j.map(Ad).join("");b=yo(b)?cn(`${b.content}${U}`,!0):Xa(["(",b,`) + "${U}"`])}return{props:[Nr(b,T)]}}),pW=(r,t,l)=>{const{exp:f,loc:_}=r;return f||l.onError(wu(61,_)),{props:[],needRuntime:l.helper(SO)}},mW=(r,t)=>{r.type===1&&r.tagType===0&&(r.tag==="script"||r.tag==="style")&&t.removeNode()},_W=[rW],gW={cloak:tW,html:oW,text:aW,model:lW,on:fW,show:pW};function yW(r,t={}){return eW(r,vn({},nW,t,{nodeTransforms:[mW,..._W,...t.nodeTransforms||[]],directiveTransforms:vn({},gW,t.directiveTransforms||{}),transformHoist:null}))}/**
* vue v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const aP=Object.create(null);function vW(r,t){if(!nn(r))if(r.nodeType)r=r.innerHTML;else return _s;const l=Vj(r,t),f=aP[l];if(f)return f;if(r[0]==="#"){const n=document.querySelector(r);r=n?n.innerHTML:""}const _=vn({hoistStatic:!0,onError:void 0,onWarn:_s},t);!_.isCustomElement&&typeof customElements<"u"&&(_.isCustomElement=n=>!!customElements.get(n));const{code:b}=yW(r,_),T=new Function("Vue",b)(SH);return T._rc=!0,aP[l]=T}fL(vW);const Kr=(r,t)=>{const l=r.__vccOpts||r;for(const[f,_]of t)l[f]=_;return l},xW={data(){return{peliculas_nuevas:[],evento_peliculas:[],peliculas_filtradas:[],diaSeleccionado:"",horarios:["10:00","11:00","12:00","15:00","18:00","20:00"]}},created(){const r=this;Ho.get("pelicula_nueva").then(t=>{r.peliculas_nuevas=t.data}).catch(t=>{console.log(t)}),Ho.get("evento_pelicula").then(t=>{r.evento_peliculas=t.data}).catch(t=>{console.log(t)})},computed:{eventoDelDia(){return!this.diaSeleccionado||this.evento_peliculas.length===0||!this.evento_peliculas[0].eventos?"":this.evento_peliculas[0].eventos[this.diaSeleccionado.toLowerCase()]||"No hay eventos para este da."},horaActual(){return new Date().getHours()}},methods:{getWeekDays(r){const t=new Date(r),l=new Date(t);l.setDate(t.getDate()-t.getDay()+1);const f=[];for(let _=0;_<7;_++){const b=new Date(l);b.setDate(l.getDate()+_),f.push(b.toLocaleDateString("es-ES",{weekday:"long"}).toUpperCase())}return f},seleccionarDia(r){this.diaSeleccionado=r},esHorarioDisponible(r){return parseInt(r.split(":")[0])>this.horaActual},redirigirATicket(r){this.esHorarioDisponible(r)&&this.$router.push({name:"ticket",params:{hora:r}})}}},bW={class:"pelicula-contenedor"},wW={class:"cartelera-dia"},TW={class:"paginas-nav"},EW=["onClick"],SW={key:0,class:"detalle-dia"},AW={class:"dia-grande"},MW={class:"cartelera-fluid"},CW={class:"film-title"},IW={id:"hora-film"},PW=["href"];function RW(r,t,l,f,_,b){return Dt(),Ot("div",bW,[(Dt(!0),Ot(Oi,null,jn(_.evento_peliculas,T=>(Dt(),Ot("div",{class:"container-fluid",key:T.id},[W("div",wW,[W("strong",null,qt(T.titulo_evento),1)]),W("ul",TW,[(Dt(!0),Ot(Oi,null,jn(b.getWeekDays(T.fecha_inicio),n=>(Dt(),Ot("li",{key:n},[W("button",{class:md(["dia-semana",{activo:n===_.diaSeleccionado}]),onClick:k=>b.seleccionarDia(n)},[W("strong",null,qt(n),1)],10,EW)]))),128))]),_.diaSeleccionado?(Dt(),Ot("div",SW,[W("h2",AW,[W("strong",null,qt(_.diaSeleccionado),1)]),W("p",null,qt(b.eventoDelDia),1)])):Pr("",!0),W("div",MW,[(Dt(!0),Ot(Oi,null,jn(T.evento_pelicula_nueva,n=>(Dt(),Ot("div",{class:"cartelera-film",key:n.id,style:Es({background:`linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(${n.image})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[W("div",CW,qt(n.titulo),1),W("ul",null,[W("li",null,qt(n.duracion+" Min"),1),W("li",null,qt("+"+n.restriccion_edad),1),W("li",null,qt(n.calificacion+"/10"),1)]),W("p",null,qt(n.descripcion),1),W("div",IW,[(Dt(!0),Ot(Oi,null,jn(_.horarios,k=>(Dt(),Ot("a",{key:k,href:b.esHorarioDisponible(k)?`ticket/${n.id}/${k}`:"#",class:md({disabled:!b.esHorarioDisponible(k)})},qt(k),11,PW))),128))])],4))),128))])]))),128))])}const DW=Kr(xW,[["render",RW]]);var LW="1.2.3";function IO(r,t,l){return Math.max(r,Math.min(t,l))}function OW(r,t,l){return(1-l)*r+l*t}function zW(r,t,l,f){return OW(r,t,1-Math.exp(-l*f))}function kW(r,t){return(r%t+t)%t}var FW=class{constructor(){Li(this,"isRunning",!1);Li(this,"value",0);Li(this,"from",0);Li(this,"to",0);Li(this,"currentTime",0);Li(this,"lerp");Li(this,"duration");Li(this,"easing");Li(this,"onUpdate")}advance(r){var l;if(!this.isRunning)return;let t=!1;if(this.duration&&this.easing){this.currentTime+=r;const f=IO(0,this.currentTime/this.duration,1);t=f>=1;const _=t?1:this.easing(f);this.value=this.from+(this.to-this.from)*_}else this.lerp?(this.value=zW(this.value,this.to,this.lerp*60,r),Math.round(this.value)===this.to&&(this.value=this.to,t=!0)):(this.value=this.to,t=!0);t&&this.stop(),(l=this.onUpdate)==null||l.call(this,this.value,t)}stop(){this.isRunning=!1}fromTo(r,t,{lerp:l,duration:f,easing:_,onStart:b,onUpdate:T}){this.from=this.value=r,this.to=t,this.lerp=l,this.duration=f,this.easing=_,this.currentTime=0,this.isRunning=!0,b==null||b(),this.onUpdate=T}};function NW(r,t){let l;return function(...f){let _=this;clearTimeout(l),l=setTimeout(()=>{l=void 0,r.apply(_,f)},t)}}var BW=class{constructor(r,t,{autoResize:l=!0,debounce:f=250}={}){Li(this,"width",0);Li(this,"height",0);Li(this,"scrollHeight",0);Li(this,"scrollWidth",0);Li(this,"debouncedResize");Li(this,"wrapperResizeObserver");Li(this,"contentResizeObserver");Li(this,"resize",()=>{this.onWrapperResize(),this.onContentResize()});Li(this,"onWrapperResize",()=>{this.wrapper instanceof Window?(this.width=window.innerWidth,this.height=window.innerHeight):(this.width=this.wrapper.clientWidth,this.height=this.wrapper.clientHeight)});Li(this,"onContentResize",()=>{this.wrapper instanceof Window?(this.scrollHeight=this.content.scrollHeight,this.scrollWidth=this.content.scrollWidth):(this.scrollHeight=this.wrapper.scrollHeight,this.scrollWidth=this.wrapper.scrollWidth)});this.wrapper=r,this.content=t,l&&(this.debouncedResize=NW(this.resize,f),this.wrapper instanceof Window?window.addEventListener("resize",this.debouncedResize,!1):(this.wrapperResizeObserver=new ResizeObserver(this.debouncedResize),this.wrapperResizeObserver.observe(this.wrapper)),this.contentResizeObserver=new ResizeObserver(this.debouncedResize),this.contentResizeObserver.observe(this.content)),this.resize()}destroy(){var r,t;(r=this.wrapperResizeObserver)==null||r.disconnect(),(t=this.contentResizeObserver)==null||t.disconnect(),this.wrapper===window&&this.debouncedResize&&window.removeEventListener("resize",this.debouncedResize,!1)}get limit(){return{x:this.scrollWidth-this.width,y:this.scrollHeight-this.height}}},PO=class{constructor(){Li(this,"events",{})}emit(r,...t){var f;let l=this.events[r]||[];for(let _=0,b=l.length;_<b;_++)(f=l[_])==null||f.call(l,...t)}on(r,t){var l;return(l=this.events[r])!=null&&l.push(t)||(this.events[r]=[t]),()=>{var f;this.events[r]=(f=this.events[r])==null?void 0:f.filter(_=>t!==_)}}off(r,t){var l;this.events[r]=(l=this.events[r])==null?void 0:l.filter(f=>t!==f)}destroy(){this.events={}}},lP=100/6,ou={passive:!1},VW=class{constructor(r,t={wheelMultiplier:1,touchMultiplier:1}){Li(this,"touchStart",{x:0,y:0});Li(this,"lastDelta",{x:0,y:0});Li(this,"window",{width:0,height:0});Li(this,"emitter",new PO);Li(this,"onTouchStart",r=>{const{clientX:t,clientY:l}=r.targetTouches?r.targetTouches[0]:r;this.touchStart.x=t,this.touchStart.y=l,this.lastDelta={x:0,y:0},this.emitter.emit("scroll",{deltaX:0,deltaY:0,event:r})});Li(this,"onTouchMove",r=>{const{clientX:t,clientY:l}=r.targetTouches?r.targetTouches[0]:r,f=-(t-this.touchStart.x)*this.options.touchMultiplier,_=-(l-this.touchStart.y)*this.options.touchMultiplier;this.touchStart.x=t,this.touchStart.y=l,this.lastDelta={x:f,y:_},this.emitter.emit("scroll",{deltaX:f,deltaY:_,event:r})});Li(this,"onTouchEnd",r=>{this.emitter.emit("scroll",{deltaX:this.lastDelta.x,deltaY:this.lastDelta.y,event:r})});Li(this,"onWheel",r=>{let{deltaX:t,deltaY:l,deltaMode:f}=r;const _=f===1?lP:f===2?this.window.width:1,b=f===1?lP:f===2?this.window.height:1;t*=_,l*=b,t*=this.options.wheelMultiplier,l*=this.options.wheelMultiplier,this.emitter.emit("scroll",{deltaX:t,deltaY:l,event:r})});Li(this,"onWindowResize",()=>{this.window={width:window.innerWidth,height:window.innerHeight}});this.element=r,this.options=t,window.addEventListener("resize",this.onWindowResize,!1),this.onWindowResize(),this.element.addEventListener("wheel",this.onWheel,ou),this.element.addEventListener("touchstart",this.onTouchStart,ou),this.element.addEventListener("touchmove",this.onTouchMove,ou),this.element.addEventListener("touchend",this.onTouchEnd,ou)}on(r,t){return this.emitter.on(r,t)}destroy(){this.emitter.destroy(),window.removeEventListener("resize",this.onWindowResize,!1),this.element.removeEventListener("wheel",this.onWheel,ou),this.element.removeEventListener("touchstart",this.onTouchStart,ou),this.element.removeEventListener("touchmove",this.onTouchMove,ou),this.element.removeEventListener("touchend",this.onTouchEnd,ou)}},UW=class{constructor({wrapper:r=window,content:t=document.documentElement,eventsTarget:l=r,smoothWheel:f=!0,syncTouch:_=!1,syncTouchLerp:b=.075,touchInertiaMultiplier:T=35,duration:n,easing:k=Xe=>Math.min(1,1.001-Math.pow(2,-10*Xe)),lerp:j=.1,infinite:U=!1,orientation:Z="vertical",gestureOrientation:re="vertical",touchMultiplier:se=1,wheelMultiplier:ue=1,autoResize:ne=!0,prevent:be,virtualScroll:De,overscroll:Be=!0,autoRaf:Te=!1,anchors:me=!1,__experimental__naiveDimensions:Ie=!1}={}){Li(this,"_isScrolling",!1);Li(this,"_isStopped",!1);Li(this,"_isLocked",!1);Li(this,"_preventNextNativeScrollEvent",!1);Li(this,"_resetVelocityTimeout",null);Li(this,"__rafID",null);Li(this,"isTouching");Li(this,"time",0);Li(this,"userData",{});Li(this,"lastVelocity",0);Li(this,"velocity",0);Li(this,"direction",0);Li(this,"options");Li(this,"targetScroll");Li(this,"animatedScroll");Li(this,"animate",new FW);Li(this,"emitter",new PO);Li(this,"dimensions");Li(this,"virtualScroll");Li(this,"onScrollEnd",r=>{r instanceof CustomEvent||(this.isScrolling==="smooth"||this.isScrolling===!1)&&r.stopPropagation()});Li(this,"dispatchScrollendEvent",()=>{this.options.wrapper.dispatchEvent(new CustomEvent("scrollend",{bubbles:this.options.wrapper===window,detail:{lenisScrollEnd:!0}}))});Li(this,"onClick",r=>{const l=r.composedPath().find(f=>{var _,b,T;return f instanceof HTMLAnchorElement&&(((_=f.getAttribute("href"))==null?void 0:_.startsWith("#"))||((b=f.getAttribute("href"))==null?void 0:b.startsWith("/#"))||((T=f.getAttribute("href"))==null?void 0:T.startsWith("./#")))});if(l){const f=l.getAttribute("href");if(f){const _=typeof this.options.anchors=="object"&&this.options.anchors?this.options.anchors:void 0;this.scrollTo(`#${f.split("#")[1]}`,_)}}});Li(this,"onPointerDown",r=>{r.button===1&&this.reset()});Li(this,"onVirtualScroll",r=>{if(typeof this.options.virtualScroll=="function"&&this.options.virtualScroll(r)===!1)return;const{deltaX:t,deltaY:l,event:f}=r;if(this.emitter.emit("virtual-scroll",{deltaX:t,deltaY:l,event:f}),f.ctrlKey||f.lenisStopPropagation)return;const _=f.type.includes("touch"),b=f.type.includes("wheel");this.isTouching=f.type==="touchstart"||f.type==="touchmove";const T=t===0&&l===0;if(this.options.syncTouch&&_&&f.type==="touchstart"&&T&&!this.isStopped&&!this.isLocked){this.reset();return}const k=this.options.gestureOrientation==="vertical"&&l===0||this.options.gestureOrientation==="horizontal"&&t===0;if(T||k)return;let j=f.composedPath();j=j.slice(0,j.indexOf(this.rootElement));const U=this.options.prevent;if(j.find(be=>{var De,Be,Te;return be instanceof HTMLElement&&(typeof U=="function"&&(U==null?void 0:U(be))||((De=be.hasAttribute)==null?void 0:De.call(be,"data-lenis-prevent"))||_&&((Be=be.hasAttribute)==null?void 0:Be.call(be,"data-lenis-prevent-touch"))||b&&((Te=be.hasAttribute)==null?void 0:Te.call(be,"data-lenis-prevent-wheel")))}))return;if(this.isStopped||this.isLocked){f.preventDefault();return}if(!(this.options.syncTouch&&_||this.options.smoothWheel&&b)){this.isScrolling="native",this.animate.stop(),f.lenisStopPropagation=!0;return}let re=l;this.options.gestureOrientation==="both"?re=Math.abs(l)>Math.abs(t)?l:t:this.options.gestureOrientation==="horizontal"&&(re=t),(!this.options.overscroll||this.options.infinite||this.options.wrapper!==window&&(this.animatedScroll>0&&this.animatedScroll<this.limit||this.animatedScroll===0&&l>0||this.animatedScroll===this.limit&&l<0))&&(f.lenisStopPropagation=!0),f.preventDefault();const se=_&&this.options.syncTouch,ne=_&&f.type==="touchend"&&Math.abs(re)>5;ne&&(re=this.velocity*this.options.touchInertiaMultiplier),this.scrollTo(this.targetScroll+re,{programmatic:!1,...se?{lerp:ne?this.options.syncTouchLerp:1}:{lerp:this.options.lerp,duration:this.options.duration,easing:this.options.easing}})});Li(this,"onNativeScroll",()=>{if(this._resetVelocityTimeout!==null&&(clearTimeout(this._resetVelocityTimeout),this._resetVelocityTimeout=null),this._preventNextNativeScrollEvent){this._preventNextNativeScrollEvent=!1;return}if(this.isScrolling===!1||this.isScrolling==="native"){const r=this.animatedScroll;this.animatedScroll=this.targetScroll=this.actualScroll,this.lastVelocity=this.velocity,this.velocity=this.animatedScroll-r,this.direction=Math.sign(this.animatedScroll-r),this.isStopped||(this.isScrolling="native"),this.emit(),this.velocity!==0&&(this._resetVelocityTimeout=setTimeout(()=>{this.lastVelocity=this.velocity,this.velocity=0,this.isScrolling=!1,this.emit()},400))}});Li(this,"raf",r=>{const t=r-(this.time||r);this.time=r,this.animate.advance(t*.001),this.options.autoRaf&&(this.__rafID=requestAnimationFrame(this.raf))});window.lenisVersion=LW,(!r||r===document.documentElement)&&(r=window),this.options={wrapper:r,content:t,eventsTarget:l,smoothWheel:f,syncTouch:_,syncTouchLerp:b,touchInertiaMultiplier:T,duration:n,easing:k,lerp:j,infinite:U,gestureOrientation:re,orientation:Z,touchMultiplier:se,wheelMultiplier:ue,autoResize:ne,prevent:be,virtualScroll:De,overscroll:Be,autoRaf:Te,anchors:me,__experimental__naiveDimensions:Ie},this.dimensions=new BW(r,t,{autoResize:ne}),this.updateClassName(),this.targetScroll=this.animatedScroll=this.actualScroll,this.options.wrapper.addEventListener("scroll",this.onNativeScroll,!1),this.options.wrapper.addEventListener("scrollend",this.onScrollEnd,{capture:!0}),this.options.anchors&&this.options.wrapper===window&&this.options.wrapper.addEventListener("click",this.onClick,!1),this.options.wrapper.addEventListener("pointerdown",this.onPointerDown,!1),this.virtualScroll=new VW(l,{touchMultiplier:se,wheelMultiplier:ue}),this.virtualScroll.on("scroll",this.onVirtualScroll),this.options.autoRaf&&(this.__rafID=requestAnimationFrame(this.raf))}destroy(){this.emitter.destroy(),this.options.wrapper.removeEventListener("scroll",this.onNativeScroll,!1),this.options.wrapper.removeEventListener("scrollend",this.onScrollEnd,{capture:!0}),this.options.wrapper.removeEventListener("pointerdown",this.onPointerDown,!1),this.options.anchors&&this.options.wrapper===window&&this.options.wrapper.removeEventListener("click",this.onClick,!1),this.virtualScroll.destroy(),this.dimensions.destroy(),this.cleanUpClassName(),this.__rafID&&cancelAnimationFrame(this.__rafID)}on(r,t){return this.emitter.on(r,t)}off(r,t){return this.emitter.off(r,t)}setScroll(r){this.isHorizontal?this.options.wrapper.scrollTo({left:r,behavior:"instant"}):this.options.wrapper.scrollTo({top:r,behavior:"instant"})}resize(){this.dimensions.resize(),this.animatedScroll=this.targetScroll=this.actualScroll,this.emit()}emit(){this.emitter.emit("scroll",this)}reset(){this.isLocked=!1,this.isScrolling=!1,this.animatedScroll=this.targetScroll=this.actualScroll,this.lastVelocity=this.velocity=0,this.animate.stop()}start(){this.isStopped&&(this.reset(),this.isStopped=!1)}stop(){this.isStopped||(this.reset(),this.isStopped=!0)}scrollTo(r,{offset:t=0,immediate:l=!1,lock:f=!1,duration:_=this.options.duration,easing:b=this.options.easing,lerp:T=this.options.lerp,onStart:n,onComplete:k,force:j=!1,programmatic:U=!0,userData:Z}={}){if(!((this.isStopped||this.isLocked)&&!j)){if(typeof r=="string"&&["top","left","start"].includes(r))r=0;else if(typeof r=="string"&&["bottom","right","end"].includes(r))r=this.limit;else{let re;if(typeof r=="string"?re=document.querySelector(r):r instanceof HTMLElement&&(r!=null&&r.nodeType)&&(re=r),re){if(this.options.wrapper!==window){const ue=this.rootElement.getBoundingClientRect();t-=this.isHorizontal?ue.left:ue.top}const se=re.getBoundingClientRect();r=(this.isHorizontal?se.left:se.top)+this.animatedScroll}}if(typeof r=="number"){if(r+=t,r=Math.round(r),this.options.infinite?U&&(this.targetScroll=this.animatedScroll=this.scroll):r=IO(0,r,this.limit),r===this.targetScroll){n==null||n(this),k==null||k(this);return}if(this.userData=Z??{},l){this.animatedScroll=this.targetScroll=r,this.setScroll(this.scroll),this.reset(),this.preventNextNativeScrollEvent(),this.emit(),k==null||k(this),this.userData={},requestAnimationFrame(()=>{this.dispatchScrollendEvent()});return}U||(this.targetScroll=r),this.animate.fromTo(this.animatedScroll,r,{duration:_,easing:b,lerp:T,onStart:()=>{f&&(this.isLocked=!0),this.isScrolling="smooth",n==null||n(this)},onUpdate:(re,se)=>{this.isScrolling="smooth",this.lastVelocity=this.velocity,this.velocity=re-this.animatedScroll,this.direction=Math.sign(this.velocity),this.animatedScroll=re,this.setScroll(this.scroll),U&&(this.targetScroll=re),se||this.emit(),se&&(this.reset(),this.emit(),k==null||k(this),this.userData={},requestAnimationFrame(()=>{this.dispatchScrollendEvent()}),this.preventNextNativeScrollEvent())}})}}}preventNextNativeScrollEvent(){this._preventNextNativeScrollEvent=!0,requestAnimationFrame(()=>{this._preventNextNativeScrollEvent=!1})}get rootElement(){return this.options.wrapper===window?document.documentElement:this.options.wrapper}get limit(){return this.options.__experimental__naiveDimensions?this.isHorizontal?this.rootElement.scrollWidth-this.rootElement.clientWidth:this.rootElement.scrollHeight-this.rootElement.clientHeight:this.dimensions.limit[this.isHorizontal?"x":"y"]}get isHorizontal(){return this.options.orientation==="horizontal"}get actualScroll(){const r=this.options.wrapper;return this.isHorizontal?r.scrollX??r.scrollLeft:r.scrollY??r.scrollTop}get scroll(){return this.options.infinite?kW(this.animatedScroll,this.limit):this.animatedScroll}get progress(){return this.limit===0?1:this.scroll/this.limit}get isScrolling(){return this._isScrolling}set isScrolling(r){this._isScrolling!==r&&(this._isScrolling=r,this.updateClassName())}get isStopped(){return this._isStopped}set isStopped(r){this._isStopped!==r&&(this._isStopped=r,this.updateClassName())}get isLocked(){return this._isLocked}set isLocked(r){this._isLocked!==r&&(this._isLocked=r,this.updateClassName())}get isSmooth(){return this.isScrolling==="smooth"}get className(){let r="lenis";return this.isStopped&&(r+=" lenis-stopped"),this.isLocked&&(r+=" lenis-locked"),this.isScrolling&&(r+=" lenis-scrolling"),this.isScrolling==="smooth"&&(r+=" lenis-smooth"),r}updateClassName(){this.cleanUpClassName(),this.rootElement.className=`${this.rootElement.className} ${this.className}`.trim()}cleanUpClassName(){this.rootElement.className=this.rootElement.className.replace(/lenis(-\w+)?/g,"").trim()}};(function(){function r(){for(var f=arguments.length,_=0;_<f;_++){var b=_<0||arguments.length<=_?void 0:arguments[_];b.nodeType===1||b.nodeType===11?this.appendChild(b):this.appendChild(document.createTextNode(String(b)))}}function t(){for(;this.lastChild;)this.removeChild(this.lastChild);arguments.length&&this.append.apply(this,arguments)}function l(){for(var f=this.parentNode,_=arguments.length,b=new Array(_),T=0;T<_;T++)b[T]=arguments[T];var n=b.length;if(f)for(n||f.removeChild(this);n--;){var k=b[n];typeof k!="object"?k=this.ownerDocument.createTextNode(k):k.parentNode&&k.parentNode.removeChild(k),n?f.insertBefore(this.previousSibling,k):f.replaceChild(k,this)}}typeof Element<"u"&&(Element.prototype.append||(Element.prototype.append=r,DocumentFragment.prototype.append=r),Element.prototype.replaceChildren||(Element.prototype.replaceChildren=t,DocumentFragment.prototype.replaceChildren=t),Element.prototype.replaceWith||(Element.prototype.replaceWith=l,DocumentFragment.prototype.replaceWith=l))})();function jW(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function cP(r,t){for(var l=0;l<t.length;l++){var f=t[l];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(r,f.key,f)}}function uP(r,t,l){return t&&cP(r.prototype,t),l&&cP(r,l),r}function $W(r,t,l){return t in r?Object.defineProperty(r,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[t]=l,r}function hP(r,t){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(r);t&&(f=f.filter(function(_){return Object.getOwnPropertyDescriptor(r,_).enumerable})),l.push.apply(l,f)}return l}function dP(r){for(var t=1;t<arguments.length;t++){var l=arguments[t]!=null?arguments[t]:{};t%2?hP(Object(l),!0).forEach(function(f){$W(r,f,l[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):hP(Object(l)).forEach(function(f){Object.defineProperty(r,f,Object.getOwnPropertyDescriptor(l,f))})}return r}function RO(r,t){return HW(r)||WW(r,t)||DO(r,t)||XW()}function eo(r){return qW(r)||GW(r)||DO(r)||ZW()}function qW(r){if(Array.isArray(r))return OT(r)}function HW(r){if(Array.isArray(r))return r}function GW(r){if(typeof Symbol<"u"&&Symbol.iterator in Object(r))return Array.from(r)}function WW(r,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(r)))){var l=[],f=!0,_=!1,b=void 0;try{for(var T=r[Symbol.iterator](),n;!(f=(n=T.next()).done)&&(l.push(n.value),!(t&&l.length===t));f=!0);}catch(k){_=!0,b=k}finally{try{!f&&T.return!=null&&T.return()}finally{if(_)throw b}}return l}}function DO(r,t){if(r){if(typeof r=="string")return OT(r,t);var l=Object.prototype.toString.call(r).slice(8,-1);if(l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set")return Array.from(r);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return OT(r,t)}}function OT(r,t){(t==null||t>r.length)&&(t=r.length);for(var l=0,f=new Array(t);l<t;l++)f[l]=r[l];return f}function ZW(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XW(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Jh(r,t){return Object.getOwnPropertyNames(Object(r)).reduce(function(l,f){var _=Object.getOwnPropertyDescriptor(Object(r),f),b=Object.getOwnPropertyDescriptor(Object(t),f);return Object.defineProperty(l,f,b||_)},{})}function Yg(r){return typeof r=="string"}function gE(r){return Array.isArray(r)}function K0(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Jh(r),l;return t.types!==void 0?l=t.types:t.split!==void 0&&(l=t.split),l!==void 0&&(t.types=(Yg(l)||gE(l)?String(l):"").split(",").map(function(f){return String(f).trim()}).filter(function(f){return/((line)|(word)|(char))/i.test(f)})),(t.absolute||t.position)&&(t.absolute=t.absolute||/absolute/.test(r.position)),t}function yE(r){var t=Yg(r)||gE(r)?String(r):"";return{none:!t,lines:/line/i.test(t),words:/word/i.test(t),chars:/char/i.test(t)}}function H1(r){return r!==null&&typeof r=="object"}function YW(r){return H1(r)&&/^(1|3|11)$/.test(r.nodeType)}function KW(r){return typeof r=="number"&&r>-1&&r%1===0}function JW(r){return H1(r)&&KW(r.length)}function xd(r){return gE(r)?r:r==null?[]:JW(r)?Array.prototype.slice.call(r):[r]}function fP(r){var t=r;return Yg(r)&&(/^(#[a-z]\w+)$/.test(r.trim())?t=document.getElementById(r.trim().slice(1)):t=document.querySelectorAll(r)),xd(t).reduce(function(l,f){return[].concat(eo(l),eo(xd(f).filter(YW)))},[])}var QW=Object.entries,e1="_splittype",Ya={},e7=0;function wl(r,t,l){if(!H1(r))return console.warn("[data.set] owner is not an object"),null;var f=r[e1]||(r[e1]=++e7),_=Ya[f]||(Ya[f]={});return l===void 0?t&&Object.getPrototypeOf(t)===Object.prototype&&(Ya[f]=dP(dP({},_),t)):t!==void 0&&(_[t]=l),l}function Qh(r,t){var l=H1(r)?r[e1]:null,f=l&&Ya[l]||{};return t===void 0?f:f[t]}function LO(r){var t=r&&r[e1];t&&(delete r[t],delete Ya[t])}function t7(){Object.keys(Ya).forEach(function(r){delete Ya[r]})}function i7(){QW(Ya).forEach(function(r){var t=RO(r,2),l=t[0],f=t[1],_=f.isRoot,b=f.isSplit;(!_||!b)&&(Ya[l]=null,delete Ya[l])})}function n7(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:" ",l=r?String(r):"";return l.trim().replace(/\s+/g," ").split(t)}var vE="\\ud800-\\udfff",OO="\\u0300-\\u036f\\ufe20-\\ufe23",zO="\\u20d0-\\u20f0",kO="\\ufe0e\\ufe0f",r7="[".concat(vE,"]"),zT="[".concat(OO).concat(zO,"]"),kT="\\ud83c[\\udffb-\\udfff]",s7="(?:".concat(zT,"|").concat(kT,")"),FO="[^".concat(vE,"]"),NO="(?:\\ud83c[\\udde6-\\uddff]){2}",BO="[\\ud800-\\udbff][\\udc00-\\udfff]",VO="\\u200d",UO="".concat(s7,"?"),jO="[".concat(kO,"]?"),o7="(?:"+VO+"(?:"+[FO,NO,BO].join("|")+")"+jO+UO+")*",a7=jO+UO+o7,l7="(?:".concat(["".concat(FO).concat(zT,"?"),zT,NO,BO,r7].join("|"),`
)`),c7=RegExp("".concat(kT,"(?=").concat(kT,")|").concat(l7).concat(a7),"g"),u7=[VO,vE,OO,zO,kO],h7=RegExp("[".concat(u7.join(""),"]"));function d7(r){return r.split("")}function $O(r){return h7.test(r)}function f7(r){return r.match(c7)||[]}function p7(r){return $O(r)?f7(r):d7(r)}function m7(r){return r==null?"":String(r)}function _7(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return r=m7(r),r&&Yg(r)&&!t&&$O(r)?p7(r):r.split(t)}function FT(r,t){var l=document.createElement(r);return t&&Object.keys(t).forEach(function(f){var _=t[f],b=Yg(_)?_.trim():_;b===null||b===""||(f==="children"?l.append.apply(l,eo(xd(b))):l.setAttribute(f,b))}),l}var xE={splitClass:"",lineClass:"line",wordClass:"word",charClass:"char",types:["lines","words","chars"],absolute:!1,tagName:"div"};function g7(r,t){t=Jh(xE,t);var l=yE(t.types),f=t.tagName,_=r.nodeValue,b=document.createDocumentFragment(),T=[],n=[];return/^\s/.test(_)&&b.append(" "),T=n7(_).reduce(function(k,j,U,Z){var re,se;return l.chars&&(se=_7(j).map(function(ue){var ne=FT(f,{class:"".concat(t.splitClass," ").concat(t.charClass),style:"display: inline-block;",children:ue});return wl(ne,"isChar",!0),n=[].concat(eo(n),[ne]),ne})),l.words||l.lines?(re=FT(f,{class:"".concat(t.wordClass," ").concat(t.splitClass),style:"display: inline-block; ".concat(l.words&&t.absolute?"position: relative;":""),children:l.chars?se:j}),wl(re,{isWord:!0,isWordStart:!0,isWordEnd:!0}),b.appendChild(re)):se.forEach(function(ue){b.appendChild(ue)}),U<Z.length-1&&b.append(" "),l.words?k.concat(re):k},[]),/\s$/.test(_)&&b.append(" "),r.replaceWith(b),{words:T,chars:n}}function qO(r,t){var l=r.nodeType,f={words:[],chars:[]};if(!/(1|3|11)/.test(l))return f;if(l===3&&/\S/.test(r.nodeValue))return g7(r,t);var _=xd(r.childNodes);if(_.length&&(wl(r,"isSplit",!0),!Qh(r).isRoot)){r.style.display="inline-block",r.style.position="relative";var b=r.nextSibling,T=r.previousSibling,n=r.textContent||"",k=b?b.textContent:" ",j=T?T.textContent:" ";wl(r,{isWordEnd:/\s$/.test(n)||/^\s/.test(k),isWordStart:/^\s/.test(n)||/\s$/.test(j)})}return _.reduce(function(U,Z){var re=qO(Z,t),se=re.words,ue=re.chars;return{words:[].concat(eo(U.words),eo(se)),chars:[].concat(eo(U.chars),eo(ue))}},f)}function y7(r,t,l,f){if(!l.absolute)return{top:t?r.offsetTop:null};var _=r.offsetParent,b=RO(f,2),T=b[0],n=b[1],k=0,j=0;if(_&&_!==document.body){var U=_.getBoundingClientRect();k=U.x+T,j=U.y+n}var Z=r.getBoundingClientRect(),re=Z.width,se=Z.height,ue=Z.x,ne=Z.y,be=ne+n-j,De=ue+T-k;return{width:re,height:se,top:be,left:De}}function HO(r){Qh(r).isWord?(LO(r),r.replaceWith.apply(r,eo(r.childNodes))):xd(r.children).forEach(function(t){return HO(t)})}var v7=function(){return document.createDocumentFragment()};function x7(r,t,l){var f=yE(t.types),_=t.tagName,b=r.getElementsByTagName("*"),T=[],n=[],k=null,j,U,Z,re=[],se=r.parentElement,ue=r.nextElementSibling,ne=v7(),be=window.getComputedStyle(r),De=be.textAlign,Be=parseFloat(be.fontSize),Te=Be*.2;return t.absolute&&(Z={left:r.offsetLeft,top:r.offsetTop,width:r.offsetWidth},U=r.offsetWidth,j=r.offsetHeight,wl(r,{cssWidth:r.style.width,cssHeight:r.style.height})),xd(b).forEach(function(me){var Ie=me.parentElement===r,Xe=y7(me,Ie,t,l),je=Xe.width,rt=Xe.height,Ve=Xe.top,He=Xe.left;/^br$/i.test(me.nodeName)||(f.lines&&Ie&&((k===null||Ve-k>=Te)&&(k=Ve,T.push(n=[])),n.push(me)),t.absolute&&wl(me,{top:Ve,left:He,width:je,height:rt}))}),se&&se.removeChild(r),f.lines&&(re=T.map(function(me){var Ie=FT(_,{class:"".concat(t.splitClass," ").concat(t.lineClass),style:"display: block; text-align: ".concat(De,"; width: 100%;")});wl(Ie,"isLine",!0);var Xe={height:0,top:1e4};return ne.appendChild(Ie),me.forEach(function(je,rt,Ve){var He=Qh(je),st=He.isWordEnd,dt=He.top,At=He.height,ni=Ve[rt+1];Xe.height=Math.max(Xe.height,At),Xe.top=Math.min(Xe.top,dt),Ie.appendChild(je),st&&Qh(ni).isWordStart&&Ie.append(" ")}),t.absolute&&wl(Ie,{height:Xe.height,top:Xe.top}),Ie}),f.words||HO(ne),r.replaceChildren(ne)),t.absolute&&(r.style.width="".concat(r.style.width||U,"px"),r.style.height="".concat(j,"px"),xd(b).forEach(function(me){var Ie=Qh(me),Xe=Ie.isLine,je=Ie.top,rt=Ie.left,Ve=Ie.width,He=Ie.height,st=Qh(me.parentElement),dt=!Xe&&st.isLine;me.style.top="".concat(dt?je-st.top:je,"px"),me.style.left=Xe?"".concat(Z.left,"px"):"".concat(rt-(dt?Z.left:0),"px"),me.style.height="".concat(He,"px"),me.style.width=Xe?"".concat(Z.width,"px"):"".concat(Ve,"px"),me.style.position="absolute"})),se&&(ue?se.insertBefore(r,ue):se.appendChild(r)),re}var Wf=Jh(xE,{}),b7=function(){uP(r,null,[{key:"clearData",value:function(){t7()}},{key:"setDefaults",value:function(l){return Wf=Jh(Wf,K0(l)),xE}},{key:"revert",value:function(l){fP(l).forEach(function(f){var _=Qh(f),b=_.isSplit,T=_.html,n=_.cssWidth,k=_.cssHeight;b&&(f.innerHTML=T,f.style.width=n||"",f.style.height=k||"",LO(f))})}},{key:"create",value:function(l,f){return new r(l,f)}},{key:"data",get:function(){return Ya}},{key:"defaults",get:function(){return Wf},set:function(l){Wf=Jh(Wf,K0(l))}}]);function r(t,l){jW(this,r),this.isSplit=!1,this.settings=Jh(Wf,K0(l)),this.elements=fP(t),this.split()}return uP(r,[{key:"split",value:function(l){var f=this;this.revert(),this.elements.forEach(function(T){wl(T,"html",T.innerHTML)}),this.lines=[],this.words=[],this.chars=[];var _=[window.pageXOffset,window.pageYOffset];l!==void 0&&(this.settings=Jh(this.settings,K0(l)));var b=yE(this.settings.types);b.none||(this.elements.forEach(function(T){wl(T,"isRoot",!0);var n=qO(T,f.settings),k=n.words,j=n.chars;f.words=[].concat(eo(f.words),eo(k)),f.chars=[].concat(eo(f.chars),eo(j))}),this.elements.forEach(function(T){if(b.lines||f.settings.absolute){var n=x7(T,f.settings,_);f.lines=[].concat(eo(f.lines),eo(n))}}),this.isSplit=!0,window.scrollTo(_[0],_[1]),i7())}},{key:"revert",value:function(){this.isSplit&&(this.lines=null,this.words=null,this.chars=null,this.isSplit=!1),r.revert(this.elements)}}]),r}();const w7={data(){return{items:["<span class='filmo'>Filmo</span> es una plataforma diseada para los amantes del cine, donde podrs ","disfrutar de una extensa variedad de pelculas, series y dibujos de todos los gneros.","Filmo te ofrece una experiencia nica para explorar y descubrir nuevos contenidos,","facilitando tu acceso a todo lo que el mundo del cine tiene para ofrecer."],stopScrollAt:1e3}},methods:{opacityValue(r){const t=window.scrollY,l=window.innerHeight,f=r*100,_=Math.max(0,f-t+l);return Math.min(1,_/l)},handleScroll(){const r=window.scrollY,t=this.$refs.scrollImage,f=this.$refs.staticImage.offsetTop;r<f?t.style.transform=`translateY(${r}px)`:(t.style.position="absolute",t.style.top=`${f}px`)},textAnimation(){sT.fromTo(".text-line",{opacity:0,y:50,transform:"translate3d(0, 50px, 0)"},{duration:1,opacity:1,y:0,transform:"translate3d(0, 0, 0)",ease:"power4.out",stagger:.6,delay:.01})}},mounted(){window.addEventListener("scroll",this.handleScroll),new b7("[animate]",{types:"lines, words, chars",tagName:"span"}),sT.to(this.$refs.animatedBox,{x:3,y:1,duration:2,ease:"power2.out"});const r=new UW({duration:1.2,easing:l=>Math.min(1,1.001-Math.pow(2,-10*l))}),t=l=>{r.raf(l),requestAnimationFrame(t)};requestAnimationFrame(t),this.textAnimation()},beforeUnmount(){window.removeEventListener("scroll",this.handleScroll)}},T7={class:"contenedor-home"},E7={class:"scroll-container"},S7={class:"descripcionFilmo"},A7=["innerHTML"];function M7(r,t,l,f,_,b){return Dt(),Ot("div",T7,[t[0]||(t[0]=W("div",{class:"animated-cont",animate:""},"FILMOFILMOFILMO",-1)),t[1]||(t[1]=W("div",{class:"animated-cont",animate:""},"FILMOFILMOFILMO",-1)),t[2]||(t[2]=W("div",{class:"animated-cont",animate:""},"FILMOFILMOFILMO",-1)),t[3]||(t[3]=W("div",{class:"animated-cont",animate:""},"FILMOFILMOFILMO",-1)),t[4]||(t[4]=W("div",{class:"presenta-text"},[W("h1",{class:"cartelera-inicio"},"PRESENTA")],-1)),t[5]||(t[5]=W("hr",{class:"barra-blanca"},null,-1)),W("div",E7,[W("div",S7,[(Dt(!0),Ot(Oi,null,jn(_.items,(T,n)=>(Dt(),Ot("div",{class:"text-line",key:n,style:Es({opacity:b.opacityValue(n)})},[W("span",{innerHTML:T},null,8,A7)],4))),128))])]),t[6]||(t[6]=B1('<div class="presenta-text" data-v-4531183a><h1 class="cartelera-inicio" data-v-4531183a><strong data-v-4531183a>CARTELERA</strong></h1><hr class="barra-blanca" data-v-4531183a><div data-v-4531183a><a class="btnInicio" href="cartelera" data-v-4531183a><strong data-v-4531183a>VER MS</strong></a></div></div><img src="https://i.postimg.cc/1RgXJd7G/abeibqt571p91-1.png" alt="" class="imagen-inicio" data-v-4531183a>',2))])}const C7=Kr(w7,[["render",M7],["__scopeId","data-v-4531183a"]]);const I7={data(){return{usuarios:[],roles:[],myModal:{},usuario:{},messageError:"",isError:!1,insert:!1}},created(){this.selectUsuario(),this.getRoles()},methods:{showForm(){this.insert=!0,this.isError=!1,this.myModal=new er("#usuarioModal"),this.myModal.show(),this.usuario={}},getRoles(){const r=this;axios.get("rol").then(t=>{r.roles=t.data}).catch(t=>{console.log(t)})},updateUsuarios(){const r=this;axios.put("usuario/"+r.usuario.id,r.usuario).then(t=>{r.selectUsuario(),r.myModal.hide()}).catch(t=>{this.isError=!0,r.messageError=t.response.data.message})},insertUsuarios(){const r=this;axios.post("usuario/",r.usuario).then(t=>{r.selectUsuario(),r.myModal.hide()}).catch(t=>{this.isError=!0,r.messageError=t.response.data.message})},selectUsuario(){const r=this;axios.get("usuario").then(t=>{r.usuarios=t.data}).catch(t=>{console.log(t)})},editUsuario(r){this.insert=!1,this.usuario=r,this.myModal=new er("#usuarioModal"),this.myModal.show()},eliminarUsuario(r){this.isError=!1,this.usuario=r,this.myModal=new er("#deleteModal"),this.myModal.show()},deleteUsuario(r){const t=this;axios.delete("usuario/"+r).then(l=>{t.selectUsuario(),t.myModal.hide()}).catch(l=>{this.isError=!0,t.messageError=l.response.data.message})}},mounted(){}},P7={class:"tabla-usuarios"},R7={class:"table"},D7={scope:"row"},L7=["onClick"],O7=["onClick"],z7={class:"modal",tabindex:"-1",id:"deleteModal"},k7={class:"modal-dialog",role:"document"},F7={class:"modal-content"},N7={class:"modal-body"},B7={key:0,class:"alert alert-danger"},V7={class:"modal-footer"},U7={class:"modal",tabindex:"-1",id:"usuarioModal"},j7={class:"modal-dialog",role:"document"},$7={class:"modal-content"},q7={class:"modal-header"},H7={key:0,class:"modal-title"},G7={key:1,class:"modal-title"},W7={class:"modal-body"},Z7={"data-mdb-input-init":"",class:"form-outline mb-4"},X7={"data-mdb-input-init":"",class:"form-outline mb-4"},Y7={class:"mb-3"},K7={class:"mb-3"},J7=["value"],Q7={key:0,class:"alert alert-danger"},e9={class:"modal-footer"};function t9(r,t,l,f,_,b){return Dt(),Ot(Oi,null,[W("div",null,[W("button",{onClick:t[0]||(t[0]=T=>b.showForm()),class:"anadirBoton"},t[9]||(t[9]=[W("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-plus-square",viewBox:"0 0 16 16"},[W("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),W("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"})],-1),W("strong",null," AADIR USUARIO",-1)]))]),W("div",P7,[W("table",R7,[t[12]||(t[12]=W("thead",null,[W("tr",null,[W("th",{scope:"col"},"ID"),W("th",{scope:"col"},"Nombre"),W("th",{scope:"col"},"Fecha de nacimiento"),W("th",{scope:"col"},"Correo"),W("th",{scope:"col"},"Contrasea"),W("th",{scope:"col"},"Rol"),W("th",{scope:"col"},"Acciones")])],-1)),W("tbody",null,[(Dt(!0),Ot(Oi,null,jn(_.usuarios,T=>(Dt(),Ot("tr",{key:T.id},[W("th",D7,qt(T.id),1),W("td",null,qt(T.nombre),1),W("td",null,qt(T.fecha_nacimiento),1),W("td",null,qt(T.correo),1),W("td",null,qt(T.contrasenya),1),W("td",null,qt(T.rol.tipo_rol),1),W("th",null,[W("button",{onClick:n=>b.editUsuario(T),class:"editarBoton"},t[10]||(t[10]=[W("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-pencil-square"},[W("path",{d:"M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"}),W("path",{"fill-rule":"evenodd",d:"M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"})],-1)]),8,L7)]),W("th",null,[W("button",{onClick:n=>b.eliminarUsuario(T),style:{border:"none",background:"none",cursor:"pointer",color:"rgb(255, 0, 0)"}},t[11]||(t[11]=[W("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[W("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"}),W("path",{d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"})],-1)]),8,O7)])]))),128))])])]),W("div",z7,[W("div",k7,[W("div",F7,[t[16]||(t[16]=W("div",{class:"modal-header"},[W("h5",{class:"modal-title"},"Borrar usuario"),W("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"})],-1)),W("div",N7,[W("p",null,[t[13]||(t[13]=us(" Seguro que quieres borrar a ")),W("strong",null,qt(_.usuario.nombre),1),t[14]||(t[14]=us(" ?"))]),_.isError?(Dt(),Ot("p",B7,qt(_.messageError),1)):Pr("",!0)]),W("div",V7,[W("button",{type:"button",class:"btn btn-primary",onClick:t[1]||(t[1]=T=>b.deleteUsuario(_.usuario.id))},"Borrar"),t[15]||(t[15]=W("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Cancelar",-1))])])])]),W("div",U7,[W("div",j7,[W("div",$7,[W("div",q7,[_.insert?(Dt(),Ot("h5",H7,"Crear usuario")):(Dt(),Ot("h5",G7,"Modificar usuario"))]),W("div",W7,[W("form",null,[W("div",Z7,[t[17]||(t[17]=W("label",{for:"formNombre",class:"form-label"},"Nombre de usuario",-1)),fn(W("input",{type:"text",name:"nombre",class:"form-control",id:"formNombre",required:"",placeholder:"Introducir nombre","onUpdate:modelValue":t[2]||(t[2]=T=>_.usuario.nombre=T)},null,512),[[gn,_.usuario.nombre]])]),W("div",X7,[t[18]||(t[18]=W("label",{for:"formInputFecha",class:"form-label"},"Fecha de nacimiento",-1)),fn(W("input",{type:"date",name:"fecha_nacimiento",class:"form-control",id:"formInputFecha",required:"","onUpdate:modelValue":t[3]||(t[3]=T=>_.usuario.fecha_nacimiento=T)},null,512),[[gn,_.usuario.fecha_nacimiento]])]),W("div",Y7,[t[19]||(t[19]=W("label",{for:"exampleInputEmail1",class:"form-label"},"Direccin de correo electrnico",-1)),fn(W("input",{type:"email",name:"correo",class:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",required:"",placeholder:"Introducir correo electronico","onUpdate:modelValue":t[4]||(t[4]=T=>_.usuario.correo=T)},null,512),[[gn,_.usuario.correo]])]),W("div",K7,[t[20]||(t[20]=W("label",{for:"exampleInputPassword1",class:"form-label"},"Contrasea",-1)),fn(W("input",{type:"password",name:"contrasenya",class:"form-control",id:"exampleInputPassword1",required:"",placeholder:"Introducir contrasea","onUpdate:modelValue":t[5]||(t[5]=T=>_.usuario.contrasenya=T)},null,512),[[gn,_.usuario.contrasenya]])]),fn(W("select",{"onUpdate:modelValue":t[6]||(t[6]=T=>_.usuario.rol_id=T),class:"form-select"},[(Dt(!0),Ot(Oi,null,jn(_.roles,T=>(Dt(),Ot("option",{key:T.id,value:T.id},qt(T.tipo_rol),9,J7))),128))],512),[[yd,_.usuario.rol_id]])]),_.isError?(Dt(),Ot("p",Q7,qt(_.messageError),1)):Pr("",!0)]),W("div",e9,[_.insert?(Dt(),Ot("button",{key:0,type:"button",class:"btn btn-secondary",onClick:t[7]||(t[7]=T=>b.insertUsuarios())},"Crear")):(Dt(),Ot("button",{key:1,type:"button",class:"btn btn-secondary",onClick:t[8]||(t[8]=T=>b.updateUsuarios())},"Editar")),t[21]||(t[21]=W("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal"},"Cerrar",-1))])])])])],64)}const i9=Kr(I7,[["render",t9]]);const n9={data(){return{pelicula_nuevas:[],myModal:{},pelicula_nueva:{},actores:[],messageError:"",isError:!1,insert:!1}},created(){this.selectPeliculaNueva(),this.selectActores()},methods:{showForm(){this.insert=!0,this.myModal=new er("#peliculaNuevaModal"),this.myModal.show(),this.pelicula_nueva={}},selectActores(){const r=this;axios.get("actor").then(t=>{r.actores=t.data}).catch(t=>{console.log(t)})},updatePeliculaNueva(){const r=this;axios.put("pelicula_nueva/"+r.pelicula_nueva.id,r.pelicula_nueva).then(t=>{r.selectPeliculaNueva(),r.myModal.hide()}).catch(t=>{this.isError=!0,r.messageError=t.response.data.message})},insertPeliculaNueva(){const r=this;axios.post("pelicula_nueva",r.pelicula_nueva).then(t=>{r.selectPeliculaNueva(),r.myModal.hide()}).catch(t=>{this.isError=!0,r.messageError=t.response.data.message})},selectPeliculaNueva(){const r=this;axios.get("pelicula_nueva").then(t=>{r.pelicula_nuevas=t.data}).catch(t=>{console.log(t)})},editPeliculaNueva(r){this.insert=!1,this.pelicula_nueva=r,this.myModal=new er("#peliculaNuevaModal"),this.myModal.show()},eliminarPeliculaNueva(r){this.isError=!1,this.pelicula_nueva=r,this.myModal=new er("#deleteModal"),this.myModal.show()},deleteUsuario(r){const t=this;axios.delete("pelicula_nueva/"+r).then(l=>{t.selectPeliculaNueva(),t.myModal.hide()}).catch(l=>{this.isError=!0,t.messageError=l.response.data.message})}},mounted(){}},r9={class:"tabla-peliculas-nuevas"},s9={class:"tables-peliculaNueva"},o9={scope:"row"},a9={key:0},l9=["onClick"],c9=["onClick"],u9={class:"modal",tabindex:"-1",id:"deleteModal"},h9={class:"modal-dialog",role:"document"},d9={class:"modal-content"},f9={class:"modal-body"},p9={key:0,class:"alert alert-danger"},m9={class:"modal-footer"},_9={class:"modal",tabindex:"-1",id:"peliculaNuevaModal"},g9={class:"modal-dialog",role:"document"},y9={class:"modal-content"},v9={class:"modal-header"},x9={key:0,class:"modal-title"},b9={key:1,class:"modal-title"},w9={class:"modal-body"},T9={"data-mdb-input-init":"",class:"form-outline mb-4"},E9={"data-mdb-input-init":"",class:"form-outline mb-4"},S9={class:"mb-3"},A9={class:"mb-3"},M9={class:"mb-3"},C9={class:"mb-3"},I9={class:"mb-3"},P9={class:"mb-3"},R9={class:"mb-3"},D9={class:"mb-3"},L9=["value"],O9={key:0,class:"alert alert-danger"},z9={class:"modal-footer"};function k9(r,t,l,f,_,b){return Dt(),Ot(Oi,null,[W("div",null,[W("button",{onClick:t[0]||(t[0]=T=>b.showForm()),class:"anadirBoton"},t[14]||(t[14]=[W("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-plus-square",viewBox:"0 0 16 16"},[W("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),W("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"})],-1),W("strong",null," AADIR PELICULA NUEVA",-1)]))]),W("div",r9,[W("table",s9,[t[17]||(t[17]=W("thead",null,[W("tr",null,[W("th",{scope:"col"},"ID"),W("th",{scope:"col"},"Titulo"),W("th",{scope:"col"},"Imagen"),W("th",{scope:"col"},"Descripcion"),W("th",{scope:"col"},"Duracion"),W("th",{scope:"col"},"Restriccion de edad"),W("th",{scope:"col"},"Calificacion"),W("th",{scope:"col"},"Idioma"),W("th",{scope:"col"},"Fecha de estreno"),W("th",{scope:"col"},"Link de la pelicula"),W("th",{scope:"col"},"Actores"),W("th",{scope:"col"},"Accion")])],-1)),W("tbody",null,[(Dt(!0),Ot(Oi,null,jn(_.pelicula_nuevas,T=>(Dt(),Ot("tr",{key:T.id},[W("th",o9,qt(T.id),1),W("td",null,qt(T.titulo),1),W("td",null,qt(T.image),1),W("td",null,qt(T.descripcion),1),W("td",null,qt(T.duracion),1),W("td",null,qt(T.restriccion_edad),1),W("td",null,qt(T.calificacion),1),W("td",null,qt(T.idioma),1),W("td",null,qt(T.fecha_estreno),1),W("td",null,qt(T.pelicula_src),1),T.actores?(Dt(),Ot("span",a9,[(Dt(!0),Ot(Oi,null,jn(T.actores,n=>(Dt(),Ot("span",{key:n.id},qt(n.nombre),1))),128))])):Pr("",!0),W("th",null,[W("button",{onClick:n=>b.editPeliculaNueva(T),class:"editarBoton"},t[15]||(t[15]=[W("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-pencil-square"},[W("path",{d:"M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"}),W("path",{"fill-rule":"evenodd",d:"M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"})],-1)]),8,l9)]),W("th",null,[W("button",{onClick:n=>b.eliminarPeliculaNueva(T),style:{border:"none",background:"none",cursor:"pointer",color:"rgb(255, 0, 0)"}},t[16]||(t[16]=[W("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[W("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"}),W("path",{d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"})],-1)]),8,c9)])]))),128))])])]),W("div",u9,[W("div",h9,[W("div",d9,[t[21]||(t[21]=W("div",{class:"modal-header"},[W("h5",{class:"modal-title"},"Borrar pelicula nueva"),W("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"})],-1)),W("div",f9,[W("p",null,[t[18]||(t[18]=us(" Seguro que quieres borrar a ")),W("strong",null,qt(_.pelicula_nueva.titulo),1),t[19]||(t[19]=us(" ?"))]),_.isError?(Dt(),Ot("p",p9,qt(_.messageError),1)):Pr("",!0)]),W("div",m9,[W("button",{type:"button",class:"btn btn-primary",onClick:t[1]||(t[1]=T=>b.deleteUsuario(_.pelicula_nueva.id))},"Borrar"),t[20]||(t[20]=W("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Cancelar",-1))])])])]),W("div",_9,[W("div",g9,[W("div",y9,[W("div",v9,[_.insert?(Dt(),Ot("h5",x9,"Crear Pelicula nueva")):(Dt(),Ot("h5",b9,"Modificar Pelicula"))]),W("div",w9,[W("form",null,[W("div",T9,[t[22]||(t[22]=W("label",{for:"formNombre",class:"form-label"},"Titulo de la pelicula",-1)),fn(W("input",{type:"text",name:"titulo",class:"form-control",id:"formNombre",required:"",placeholder:"Introducir nombre","onUpdate:modelValue":t[2]||(t[2]=T=>_.pelicula_nueva.titulo=T)},null,512),[[gn,_.pelicula_nueva.titulo]])]),W("div",E9,[t[23]||(t[23]=W("label",{for:"formInputFecha",class:"form-label"},"URL imagen",-1)),fn(W("input",{type:"text",name:"image",class:"form-control",id:"formInputFecha",required:"","onUpdate:modelValue":t[3]||(t[3]=T=>_.pelicula_nueva.image=T)},null,512),[[gn,_.pelicula_nueva.image]])]),W("div",S9,[t[24]||(t[24]=W("label",{for:"exampleInputEmail1",class:"form-label"},"Descripcion",-1)),fn(W("input",{type:"text",name:"descripcion",class:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",required:"",placeholder:"Introducir correo electronico","onUpdate:modelValue":t[4]||(t[4]=T=>_.pelicula_nueva.descripcion=T)},null,512),[[gn,_.pelicula_nueva.descripcion]])]),W("div",A9,[t[25]||(t[25]=W("label",{for:"exampleInputEmail1",class:"form-label"},"Duracion",-1)),fn(W("input",{type:"number",name:"duracion",class:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",required:"",placeholder:"Introducir correo electronico","onUpdate:modelValue":t[5]||(t[5]=T=>_.pelicula_nueva.duracion=T)},null,512),[[gn,_.pelicula_nueva.duracion]])]),W("div",M9,[t[26]||(t[26]=W("label",{for:"exampleInputEmail1",class:"form-label"},"Restriccion de edad",-1)),fn(W("input",{type:"text",name:"restriccion_edad",class:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",required:"",placeholder:"Introducir correo electronico","onUpdate:modelValue":t[6]||(t[6]=T=>_.pelicula_nueva.restriccion_edad=T)},null,512),[[gn,_.pelicula_nueva.restriccion_edad]])]),W("div",C9,[t[27]||(t[27]=W("label",{for:"exampleInputEmail1",class:"form-label"},"Calificacion",-1)),fn(W("input",{type:"text",name:"calificacion",class:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",required:"",placeholder:"Introducir correo electronico","onUpdate:modelValue":t[7]||(t[7]=T=>_.pelicula_nueva.calificacion=T)},null,512),[[gn,_.pelicula_nueva.calificacion]])]),W("div",I9,[t[28]||(t[28]=W("label",{for:"exampleInputEmail1",class:"form-label"},"Idioma",-1)),fn(W("input",{type:"text",name:"idioma",class:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",required:"",placeholder:"Introducir correo electronico","onUpdate:modelValue":t[8]||(t[8]=T=>_.pelicula_nueva.idioma=T)},null,512),[[gn,_.pelicula_nueva.idioma]])]),W("div",P9,[t[29]||(t[29]=W("label",{for:"exampleInputEmail1",class:"form-label"},"Fecha de estreno",-1)),fn(W("input",{type:"date",name:"fecha_estreno",class:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",required:"",placeholder:"Introducir correo electronico","onUpdate:modelValue":t[9]||(t[9]=T=>_.pelicula_nueva.fecha_estreno=T)},null,512),[[gn,_.pelicula_nueva.fecha_estreno]])]),W("div",R9,[t[30]||(t[30]=W("label",{for:"exampleInputEmail1",class:"form-label"},"URL de la pelicula",-1)),fn(W("input",{type:"text",name:"pelicula_src",class:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",required:"",placeholder:"Introducir correo electronico","onUpdate:modelValue":t[10]||(t[10]=T=>_.pelicula_nueva.pelicula_src=T)},null,512),[[gn,_.pelicula_nueva.pelicula_src]])]),W("div",D9,[t[31]||(t[31]=W("label",{for:"actores",class:"form-label"},"Seleccionar Actores",-1)),fn(W("select",{"onUpdate:modelValue":t[11]||(t[11]=T=>_.pelicula_nueva.actores=T),class:"form-control",id:"actores",multiple:""},[(Dt(!0),Ot(Oi,null,jn(_.actores,T=>(Dt(),Ot("option",{key:T.id,value:T.id},qt(T.nombre),9,L9))),128))],512),[[yd,_.pelicula_nueva.actores]])])]),_.isError?(Dt(),Ot("p",O9,qt(_.messageError),1)):Pr("",!0)]),W("div",z9,[_.insert?(Dt(),Ot("button",{key:0,type:"button",class:"btn btn-secondary",onClick:t[12]||(t[12]=T=>b.insertPeliculaNueva())},"Crear")):(Dt(),Ot("button",{key:1,type:"button",class:"btn btn-secondary",onClick:t[13]||(t[13]=T=>b.updatePeliculaNueva())},"Editar")),t[32]||(t[32]=W("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal"},"Cerrar",-1))])])])])],64)}const F9=Kr(n9,[["render",k9]]);const N9={data(){return{evento_peliculas:[],peliculas_nuevas:[],myModal:{},evento_pelicula:{},messageError:"",isError:!1,insert:!1}},created(){this.selectEvento(),this.selectPelicula_nueva()},methods:{showForm(){this.insert=!0,this.isError=!1,this.myModal=new er("#eventoModal"),this.myModal.show(),this.evento_pelicula={}},selectPelicula_nueva(){const r=this;axios.get("pelicula_nueva").then(t=>{r.peliculas_nuevas=t.data}).catch(t=>{console.log(t)})},updateUsuarios(){const r=this;axios.put("evento_pelicula/"+r.evento_pelicula.id,r.evento_pelicula).then(t=>{r.selectEvento(),r.myModal.hide()}).catch(t=>{this.isError=!0,r.messageError=t.response.data.message})},insertUsuarios(){const r=this;axios.post("evento_pelicula",r.evento_pelicula).then(t=>{r.selectEvento(),r.myModal.hide()}).catch(t=>{this.isError=!0,r.messageError=t.response.data.message})},selectEvento(){const r=this;axios.get("evento_pelicula").then(t=>{r.evento_peliculas=t.data}).catch(t=>{console.log(t)})},editEvento(r){this.insert=!1,this.evento_pelicula=r,this.myModal=new er("#eventoModal"),this.myModal.show()},eliminarUsuario(r){this.isError=!1,this.evento_pelicula=r,this.myModal=new er("#deleteEventoModal"),this.myModal.show()},deleteUsuario(r){const t=this;axios.delete("evento_pelicula/"+r).then(l=>{t.selectEvento(),t.myModal.hide()}).catch(l=>{this.isError=!0,t.messageError=l.response.data.message})}},mounted(){}},B9={class:"tabla-usuarios"},V9={class:"table"},U9={scope:"row"},j9={key:0},$9=["onClick"],q9=["onClick"],H9={class:"modal",tabindex:"-1",id:"deleteEventoModal"},G9={class:"modal-dialog",role:"document"},W9={class:"modal-content"},Z9={class:"modal-body"},X9={key:0,class:"alert alert-danger"},Y9={class:"modal-footer"},K9={class:"modal",tabindex:"-1",id:"eventoModal"},J9={class:"modal-dialog",role:"document"},Q9={class:"modal-content"},eZ={class:"modal-header"},tZ={key:0,class:"modal-title"},iZ={key:1,class:"modal-title"},nZ={class:"modal-body"},rZ={"data-mdb-input-init":"",class:"form-outline mb-4"},sZ={"data-mdb-input-init":"",class:"form-outline mb-4"},oZ={class:"mb-3"},aZ={class:"mb-3"},lZ=["value"],cZ={key:0,class:"alert alert-danger"},uZ={class:"modal-footer"};function hZ(r,t,l,f,_,b){return Dt(),Ot(Oi,null,[W("div",null,[W("button",{onClick:t[0]||(t[0]=T=>b.showForm()),class:"anadirBoton"},t[8]||(t[8]=[W("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-plus-square",viewBox:"0 0 16 16"},[W("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),W("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"})],-1),W("strong",null,"AADIR EVENTOS",-1)]))]),W("div",B9,[W("table",V9,[t[11]||(t[11]=W("thead",null,[W("tr",null,[W("th",{scope:"col"},"ID"),W("th",{scope:"col"},"Titulo Evento"),W("th",{scope:"col"},"Fecha inicio"),W("th",{scope:"col"},"Fecha final"),W("th",{scope:"col"},"Pelicula aadidas")])],-1)),W("tbody",null,[(Dt(!0),Ot(Oi,null,jn(_.evento_peliculas,T=>(Dt(),Ot("tr",{key:T.id},[W("th",U9,qt(T.id),1),W("td",null,qt(T.titulo_evento),1),W("td",null,qt(T.fecha_inicio),1),W("td",null,qt(T.fecha_final),1),T.evento_pelicula_nueva?(Dt(),Ot("span",j9,[(Dt(!0),Ot(Oi,null,jn(T.evento_pelicula_nueva,n=>(Dt(),Ot("span",{key:n.id},qt(n.titulo),1))),128))])):Pr("",!0),W("th",null,[W("button",{onClick:n=>b.editEvento(T),class:"editarBoton"},t[9]||(t[9]=[W("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-pencil-square"},[W("path",{d:"M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"}),W("path",{"fill-rule":"evenodd",d:"M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"})],-1)]),8,$9)]),W("th",null,[W("button",{onClick:n=>b.eliminarUsuario(T),style:{border:"none",background:"none",cursor:"pointer",color:"rgb(255, 0, 0)"}},t[10]||(t[10]=[W("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[W("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"}),W("path",{d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"})],-1)]),8,q9)])]))),128))])])]),W("div",H9,[W("div",G9,[W("div",W9,[t[15]||(t[15]=W("div",{class:"modal-header"},[W("h5",{class:"modal-title"},"Borrar evento"),W("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"})],-1)),W("div",Z9,[W("p",null,[t[12]||(t[12]=us(" Seguro que quieres borrar a ")),W("strong",null,qt(_.evento_pelicula.titulo_evento),1),t[13]||(t[13]=us(" ?"))]),_.isError?(Dt(),Ot("p",X9,qt(_.messageError),1)):Pr("",!0)]),W("div",Y9,[W("button",{type:"button",class:"btn btn-primary",onClick:t[1]||(t[1]=T=>b.deleteUsuario(_.evento_pelicula.id))},"Borrar"),t[14]||(t[14]=W("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Cancelar",-1))])])])]),W("div",K9,[W("div",J9,[W("div",Q9,[W("div",eZ,[_.insert?(Dt(),Ot("h5",tZ,"Crear Evento")):(Dt(),Ot("h5",iZ,"Modificar Evento"))]),W("div",nZ,[W("form",null,[W("div",rZ,[t[16]||(t[16]=W("label",{for:"formNombre",class:"form-label"},"Nombre de evento",-1)),fn(W("input",{type:"text",name:"titulo_evento",class:"form-control",id:"formNombre",required:"",placeholder:"Introducir titulo","onUpdate:modelValue":t[2]||(t[2]=T=>_.evento_pelicula.titulo_evento=T)},null,512),[[gn,_.evento_pelicula.titulo_evento]])]),W("div",sZ,[t[17]||(t[17]=W("label",{for:"formInputFecha",class:"form-label"},"Fecha de inicio",-1)),fn(W("input",{type:"date",name:"fecha_inicio",class:"form-control",id:"formInputFecha",required:"","onUpdate:modelValue":t[3]||(t[3]=T=>_.evento_pelicula.fecha_inicio=T)},null,512),[[gn,_.evento_pelicula.fecha_inicio]])]),W("div",oZ,[t[18]||(t[18]=W("label",{for:"exampleInputEvento",class:"form-label"},"Fecha final",-1)),fn(W("input",{type:"date",name:"fecha_final",class:"form-control",id:"exampleInputEvento","aria-describedby":"eventoHelp",required:"",placeholder:"Introducir fecha final","onUpdate:modelValue":t[4]||(t[4]=T=>_.evento_pelicula.fecha_final=T)},null,512),[[gn,_.evento_pelicula.fecha_final]])]),W("div",aZ,[t[19]||(t[19]=W("label",{for:"pelis",class:"form-label"},"Seleccionar Peliculas",-1)),fn(W("select",{"onUpdate:modelValue":t[5]||(t[5]=T=>_.evento_pelicula.evento_pelicula_nueva=T),class:"form-control",id:"pelis",multiple:""},[(Dt(!0),Ot(Oi,null,jn(_.peliculas_nuevas,T=>(Dt(),Ot("option",{key:T.id,value:T.id},qt(T.titulo),9,lZ))),128))],512),[[yd,_.evento_pelicula.evento_pelicula_nueva]])])]),_.isError?(Dt(),Ot("p",cZ,qt(_.messageError),1)):Pr("",!0)]),W("div",uZ,[_.insert?(Dt(),Ot("button",{key:0,type:"button",class:"btn btn-secondary",onClick:t[6]||(t[6]=T=>b.insertUsuarios())},"Aadir")):(Dt(),Ot("button",{key:1,type:"button",class:"btn btn-secondary",onClick:t[7]||(t[7]=T=>b.updateUsuarios())},"Editar")),t[20]||(t[20]=W("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal"},"Cerrar",-1))])])])])],64)}const dZ=Kr(N9,[["render",hZ]]);const fZ={data(){return{peliculas:[],myModal:{},actores:[],categorias:[],pelicula:{},messageError:"",isError:!1,insert:!1}},created(){this.selectPelicula(),this.selectActores(),this.selectCategorias()},methods:{showForm(){this.insert=!0,this.myModal=new er("#peliculaModal"),this.myModal.show(),this.pelicula={}},selectActores(){const r=this;axios.get("actor").then(t=>{r.actores=t.data}).catch(t=>{console.log(t)})},selectCategorias(){const r=this;axios.get("categoria").then(t=>{r.categorias=t.data}).catch(t=>{console.log(t)})},updatePeliculas(){const r=this;axios.put("pelicula/"+r.pelicula.id,r.pelicula).then(t=>{r.selectPelicula(),r.myModal.hide()}).catch(t=>{this.isError=!0,r.messageError=t.response.data.message})},insertPeliculas(){const r=this;axios.post("pelicula",r.pelicula).then(t=>{r.selectPelicula(),r.myModal.hide()}).catch(t=>{this.isError=!0,r.messageError=t.response.data.message})},selectPelicula(){const r=this;axios.get("pelicula").then(t=>{r.peliculas=t.data}).catch(t=>{console.log(t)})},editPelicula(r){this.insert=!1,this.pelicula=r,this.myModal=new er("#peliculaModal"),this.myModal.show()},eliminarPelicula(r){this.isError=!1,this.pelicula=r,this.myModal=new er("#deleteModal"),this.myModal.show()},deletePelicula(r){const t=this;axios.delete("pelicula/"+r).then(l=>{t.selectPelicula(),t.myModal.hide()}).catch(l=>{this.isError=!0,t.messageError=l.response.data.message})}},mounted(){}},pZ={class:"tabla-peliculas"},mZ={class:"tables"},_Z={scope:"row"},gZ={key:0},yZ={key:1},vZ=["onClick"],xZ=["onClick"],bZ={class:"modal",tabindex:"-1",id:"deleteModal"},wZ={class:"modal-dialog",role:"document"},TZ={class:"modal-content"},EZ={class:"modal-body"},SZ={key:0,class:"alert alert-danger"},AZ={class:"modal-footer"},MZ={class:"modal",tabindex:"-1",id:"peliculaModal"},CZ={class:"modal-dialog",role:"document"},IZ={class:"modal-content"},PZ={class:"modal-header"},RZ={key:0,class:"modal-title"},DZ={key:1,class:"modal-title"},LZ={class:"modal-body"},OZ={"data-mdb-input-init":"",class:"form-outline mb-4"},zZ={"data-mdb-input-init":"",class:"form-outline mb-4"},kZ={class:"mb-3"},FZ={class:"mb-3"},NZ={class:"mb-3"},BZ={class:"mb-3"},VZ={class:"mb-3"},UZ={class:"mb-3"},jZ={class:"mb-3"},$Z={class:"mb-3"},qZ=["value"],HZ={class:"mb-3"},GZ=["value"],WZ={key:0,class:"alert alert-danger"},ZZ={class:"modal-footer"};function XZ(r,t,l,f,_,b){return Dt(),Ot(Oi,null,[W("div",null,[W("button",{onClick:t[0]||(t[0]=T=>b.showForm()),class:"anadirBoton"},t[15]||(t[15]=[W("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-plus-square",viewBox:"0 0 16 16"},[W("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),W("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"})],-1),W("strong",null," AADIR PELICULA",-1)]))]),W("div",pZ,[W("table",mZ,[t[18]||(t[18]=W("thead",null,[W("tr",null,[W("th",{scope:"col"},"ID"),W("th",{scope:"col"},"Titulo"),W("th",{scope:"col"},"Imagen"),W("th",{scope:"col"},"Descripcion"),W("th",{scope:"col"},"Duracion"),W("th",{scope:"col"},"Restriccion de edad"),W("th",{scope:"col"},"Calificacion"),W("th",{scope:"col"},"Idioma"),W("th",{scope:"col"},"Fecha de estreno"),W("th",{scope:"col"},"Link de la pelicula"),W("th",null,"Actores"),W("th",null,"Categorias"),W("th",{scope:"col"},"Acciones")])],-1)),W("tbody",null,[(Dt(!0),Ot(Oi,null,jn(_.peliculas,T=>(Dt(),Ot("tr",{key:T.id},[W("th",_Z,qt(T.id),1),W("td",null,qt(T.titulo),1),W("td",null,qt(T.image),1),W("td",null,qt(T.descripcion),1),W("td",null,qt(T.duracion),1),W("td",null,qt(T.restriccion_edad),1),W("td",null,qt(T.calificacion),1),W("td",null,qt(T.idioma),1),W("td",null,qt(T.fecha_estreno),1),W("td",null,qt(T.pelicula_src),1),T.actores?(Dt(),Ot("span",gZ,[(Dt(!0),Ot(Oi,null,jn(T.actores,n=>(Dt(),Ot("span",{key:n.id},qt(n.nombre),1))),128))])):Pr("",!0),T.categoria_pelicula?(Dt(),Ot("span",yZ,[(Dt(!0),Ot(Oi,null,jn(T.categoria_pelicula,n=>(Dt(),Ot("span",{key:n.id},qt(n.categoria),1))),128))])):Pr("",!0),W("th",null,[W("button",{onClick:n=>b.editPelicula(T),class:"editarBoton"},t[16]||(t[16]=[W("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-pencil-square"},[W("path",{d:"M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"}),W("path",{"fill-rule":"evenodd",d:"M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"})],-1)]),8,vZ)]),W("th",null,[W("button",{onClick:n=>b.eliminarPelicula(T),style:{border:"none",background:"none",cursor:"pointer",color:"rgb(255, 0, 0)"}},t[17]||(t[17]=[W("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[W("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"}),W("path",{d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"})],-1)]),8,xZ)])]))),128))])])]),W("div",bZ,[W("div",wZ,[W("div",TZ,[t[22]||(t[22]=W("div",{class:"modal-header"},[W("h5",{class:"modal-title"},"Borrar pelicula nueva"),W("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"})],-1)),W("div",EZ,[W("p",null,[t[19]||(t[19]=us(" Seguro que quieres borrar a ")),W("strong",null,qt(_.pelicula.titulo),1),t[20]||(t[20]=us(" ?"))]),_.isError?(Dt(),Ot("p",SZ,qt(_.messageError),1)):Pr("",!0)]),W("div",AZ,[W("button",{type:"button",class:"btn btn-primary",onClick:t[1]||(t[1]=T=>b.deletePelicula(_.pelicula.id))},"Borrar"),t[21]||(t[21]=W("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Cancelar",-1))])])])]),W("div",MZ,[W("div",CZ,[W("div",IZ,[W("div",PZ,[_.insert?(Dt(),Ot("h5",RZ,"Crear Pelicula nueva")):(Dt(),Ot("h5",DZ,"Modificar Pelicula"))]),W("div",LZ,[W("form",null,[W("div",OZ,[t[23]||(t[23]=W("label",{for:"formNombre",class:"form-label"},"Titulo de la pelicula",-1)),fn(W("input",{type:"text",name:"titulo",class:"form-control",id:"formNombre",required:"",placeholder:"Introducir titulo","onUpdate:modelValue":t[2]||(t[2]=T=>_.pelicula.titulo=T)},null,512),[[gn,_.pelicula.titulo]])]),W("div",zZ,[t[24]||(t[24]=W("label",{for:"formInputFecha",class:"form-label"},"URL imagen",-1)),fn(W("input",{type:"text",name:"image",class:"form-control",id:"formInputFecha",required:"","onUpdate:modelValue":t[3]||(t[3]=T=>_.pelicula.image=T)},null,512),[[gn,_.pelicula.image]])]),W("div",kZ,[t[25]||(t[25]=W("label",{for:"exampleInputEmail1",class:"form-label"},"Descripcion",-1)),fn(W("input",{type:"text",name:"descripcion",class:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",required:"",placeholder:"Descripcion","onUpdate:modelValue":t[4]||(t[4]=T=>_.pelicula.descripcion=T)},null,512),[[gn,_.pelicula.descripcion]])]),W("div",FZ,[t[26]||(t[26]=W("label",{for:"exampleInputEmail1",class:"form-label"},"Duracion",-1)),fn(W("input",{type:"number",name:"duracion",class:"form-control",id:"exampleInputEmail1",required:"",placeholder:"Duracion","onUpdate:modelValue":t[5]||(t[5]=T=>_.pelicula.duracion=T)},null,512),[[gn,_.pelicula.duracion]])]),W("div",NZ,[t[27]||(t[27]=W("label",{for:"exampleInputEmail1",class:"form-label"},"Restriccion de edad",-1)),fn(W("input",{type:"text",name:"restriccion_edad",class:"form-control",id:"exampleInputEmail1",required:"",placeholder:"Restriccion de edad","onUpdate:modelValue":t[6]||(t[6]=T=>_.pelicula.restriccion_edad=T)},null,512),[[gn,_.pelicula.restriccion_edad]])]),W("div",BZ,[t[28]||(t[28]=W("label",{for:"exampleInputEmail1",class:"form-label"},"Calificacion",-1)),fn(W("input",{type:"text",name:"calificacion",class:"form-control",id:"exampleInputEmail1",required:"",placeholder:"Calificacion","onUpdate:modelValue":t[7]||(t[7]=T=>_.pelicula.calificacion=T)},null,512),[[gn,_.pelicula.calificacion]])]),W("div",VZ,[t[29]||(t[29]=W("label",{for:"exampleInputEmail1",class:"form-label"},"Idioma",-1)),fn(W("input",{type:"text",name:"idioma",class:"form-control",id:"exampleInputEmail1",required:"",placeholder:"Idioma","onUpdate:modelValue":t[8]||(t[8]=T=>_.pelicula.idioma=T)},null,512),[[gn,_.pelicula.idioma]])]),W("div",UZ,[t[30]||(t[30]=W("label",{for:"exampleInputEmail1",class:"form-label"},"Fecha de estreno",-1)),fn(W("input",{type:"date",name:"fecha_estreno",class:"form-control",id:"exampleInputEmail1",required:"",placeholder:"Fecha de estreno","onUpdate:modelValue":t[9]||(t[9]=T=>_.pelicula.fecha_estreno=T)},null,512),[[gn,_.pelicula.fecha_estreno]])]),W("div",jZ,[t[31]||(t[31]=W("label",{for:"exampleInputEmail1",class:"form-label"},"URL de la pelicula",-1)),fn(W("input",{type:"text",name:"pelicula_src",class:"form-control",id:"exampleInputEmail1",required:"",placeholder:"URL de la pelicula","onUpdate:modelValue":t[10]||(t[10]=T=>_.pelicula.pelicula_src=T)},null,512),[[gn,_.pelicula.pelicula_src]])]),W("div",$Z,[t[32]||(t[32]=W("label",{for:"actores",class:"form-label"},"Seleccionar Actores",-1)),fn(W("select",{"onUpdate:modelValue":t[11]||(t[11]=T=>_.pelicula.actores=T),class:"form-control",id:"actores",multiple:""},[(Dt(!0),Ot(Oi,null,jn(_.actores,T=>(Dt(),Ot("option",{key:T.id,value:T.id},qt(T.nombre),9,qZ))),128))],512),[[yd,_.pelicula.actores]])]),W("div",HZ,[t[33]||(t[33]=W("label",{for:"inCategorias",class:"inputCategoria"},"Seleccionar categorias",-1)),fn(W("select",{"onUpdate:modelValue":t[12]||(t[12]=T=>_.pelicula.categorias=T),class:"form-control",id:"inCategorias",multiple:""},[(Dt(!0),Ot(Oi,null,jn(_.categorias,T=>(Dt(),Ot("option",{key:T.id,value:T.id},qt(T.categoria),9,GZ))),128))],512),[[yd,_.pelicula.categorias]])])]),_.isError?(Dt(),Ot("p",WZ,qt(_.messageError),1)):Pr("",!0)]),W("div",ZZ,[_.insert?(Dt(),Ot("button",{key:0,type:"button",class:"btn btn-secondary",onClick:t[13]||(t[13]=T=>b.insertPeliculas())},"Crear")):(Dt(),Ot("button",{key:1,type:"button",class:"btn btn-secondary",onClick:t[14]||(t[14]=T=>b.updatePeliculas())},"Editar")),t[34]||(t[34]=W("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal"},"Cerrar",-1))])])])])],64)}const YZ=Kr(fZ,[["render",XZ],["__scopeId","data-v-f1ea740d"]]);var KZ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function JZ(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var GO={exports:{}};(function(r,t){(function(l,f){r.exports=f()})(KZ,function(){var l,f,_;function b(n,k){if(!l)l=k;else if(!f)f=k;else{var j="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+f+")(sharedChunk); self.onerror = null;",U={};l(U),_=k(U),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(_.workerUrl=window.URL.createObjectURL(new Blob([j],{type:"text/javascript"})))}}b(["exports"],function(n){function k(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var j,U={},Z={};function re(){if(j)return Z;j=1,Object.defineProperty(Z,"__esModule",{value:!0}),Z.setMatrixArrayType=function(p){Z.ARRAY_TYPE=e=p},Z.toRadian=function(p){return p*c},Z.equals=function(p,u){return Math.abs(p-u)<=a*Math.max(1,Math.abs(p),Math.abs(u))},Z.RANDOM=Z.ARRAY_TYPE=Z.EPSILON=void 0;var a=1e-6;Z.EPSILON=a;var e=typeof Float32Array<"u"?Float32Array:Array;Z.ARRAY_TYPE=e;var s=Math.random;Z.RANDOM=s;var c=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var p=0,u=arguments.length;u--;)p+=arguments[u]*arguments[u];return Math.sqrt(p)}),Z}var se,ue={};function ne(){if(se)return ue;function a(u){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},a(u)}se=1,Object.defineProperty(ue,"__esModule",{value:!0}),ue.create=function(){var u=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u},ue.clone=function(u){var m=new e.ARRAY_TYPE(4);return m[0]=u[0],m[1]=u[1],m[2]=u[2],m[3]=u[3],m},ue.copy=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=m[2],u[3]=m[3],u},ue.identity=function(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=1,u},ue.fromValues=function(u,m,x,S){var P=new e.ARRAY_TYPE(4);return P[0]=u,P[1]=m,P[2]=x,P[3]=S,P},ue.set=function(u,m,x,S,P){return u[0]=m,u[1]=x,u[2]=S,u[3]=P,u},ue.transpose=function(u,m){if(u===m){var x=m[1];u[1]=m[2],u[2]=x}else u[0]=m[0],u[1]=m[2],u[2]=m[1],u[3]=m[3];return u},ue.invert=function(u,m){var x=m[0],S=m[1],P=m[2],y=m[3],A=x*y-P*S;return A?(u[0]=y*(A=1/A),u[1]=-S*A,u[2]=-P*A,u[3]=x*A,u):null},ue.adjoint=function(u,m){var x=m[0];return u[0]=m[3],u[1]=-m[1],u[2]=-m[2],u[3]=x,u},ue.determinant=function(u){return u[0]*u[3]-u[2]*u[1]},ue.multiply=c,ue.rotate=function(u,m,x){var S=m[0],P=m[1],y=m[2],A=m[3],I=Math.sin(x),E=Math.cos(x);return u[0]=S*E+y*I,u[1]=P*E+A*I,u[2]=S*-I+y*E,u[3]=P*-I+A*E,u},ue.scale=function(u,m,x){var S=m[1],P=m[2],y=m[3],A=x[0],I=x[1];return u[0]=m[0]*A,u[1]=S*A,u[2]=P*I,u[3]=y*I,u},ue.fromRotation=function(u,m){var x=Math.sin(m),S=Math.cos(m);return u[0]=S,u[1]=x,u[2]=-x,u[3]=S,u},ue.fromScaling=function(u,m){return u[0]=m[0],u[1]=0,u[2]=0,u[3]=m[1],u},ue.str=function(u){return"mat2("+u[0]+", "+u[1]+", "+u[2]+", "+u[3]+")"},ue.frob=function(u){return Math.hypot(u[0],u[1],u[2],u[3])},ue.LDU=function(u,m,x,S){return u[2]=S[2]/S[0],x[0]=S[0],x[1]=S[1],x[3]=S[3]-u[2]*x[1],[u,m,x]},ue.add=function(u,m,x){return u[0]=m[0]+x[0],u[1]=m[1]+x[1],u[2]=m[2]+x[2],u[3]=m[3]+x[3],u},ue.subtract=p,ue.exactEquals=function(u,m){return u[0]===m[0]&&u[1]===m[1]&&u[2]===m[2]&&u[3]===m[3]},ue.equals=function(u,m){var x=u[0],S=u[1],P=u[2],y=u[3],A=m[0],I=m[1],E=m[2],M=m[3];return Math.abs(x-A)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(A))&&Math.abs(S-I)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(I))&&Math.abs(P-E)<=e.EPSILON*Math.max(1,Math.abs(P),Math.abs(E))&&Math.abs(y-M)<=e.EPSILON*Math.max(1,Math.abs(y),Math.abs(M))},ue.multiplyScalar=function(u,m,x){return u[0]=m[0]*x,u[1]=m[1]*x,u[2]=m[2]*x,u[3]=m[3]*x,u},ue.multiplyScalarAndAdd=function(u,m,x,S){return u[0]=m[0]+x[0]*S,u[1]=m[1]+x[1]*S,u[2]=m[2]+x[2]*S,u[3]=m[3]+x[3]*S,u},ue.sub=ue.mul=void 0;var e=function(u,m){if(u&&u.__esModule)return u;if(u===null||a(u)!=="object"&&typeof u!="function")return{default:u};var x=s(void 0);if(x&&x.has(u))return x.get(u);var S={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in u)if(y!=="default"&&Object.prototype.hasOwnProperty.call(u,y)){var A=P?Object.getOwnPropertyDescriptor(u,y):null;A&&(A.get||A.set)?Object.defineProperty(S,y,A):S[y]=u[y]}return S.default=u,x&&x.set(u,S),S}(re());function s(u){if(typeof WeakMap!="function")return null;var m=new WeakMap,x=new WeakMap;return(s=function(S){return S?x:m})(u)}function c(u,m,x){var S=m[0],P=m[1],y=m[2],A=m[3],I=x[0],E=x[1],M=x[2],R=x[3];return u[0]=S*I+y*E,u[1]=P*I+A*E,u[2]=S*M+y*R,u[3]=P*M+A*R,u}function p(u,m,x){return u[0]=m[0]-x[0],u[1]=m[1]-x[1],u[2]=m[2]-x[2],u[3]=m[3]-x[3],u}return ue.mul=c,ue.sub=p,ue}var be,De={};function Be(){if(be)return De;function a(u){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},a(u)}be=1,Object.defineProperty(De,"__esModule",{value:!0}),De.create=function(){var u=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0,u[4]=0,u[5]=0),u[0]=1,u[3]=1,u},De.clone=function(u){var m=new e.ARRAY_TYPE(6);return m[0]=u[0],m[1]=u[1],m[2]=u[2],m[3]=u[3],m[4]=u[4],m[5]=u[5],m},De.copy=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=m[2],u[3]=m[3],u[4]=m[4],u[5]=m[5],u},De.identity=function(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=1,u[4]=0,u[5]=0,u},De.fromValues=function(u,m,x,S,P,y){var A=new e.ARRAY_TYPE(6);return A[0]=u,A[1]=m,A[2]=x,A[3]=S,A[4]=P,A[5]=y,A},De.set=function(u,m,x,S,P,y,A){return u[0]=m,u[1]=x,u[2]=S,u[3]=P,u[4]=y,u[5]=A,u},De.invert=function(u,m){var x=m[0],S=m[1],P=m[2],y=m[3],A=m[4],I=m[5],E=x*y-S*P;return E?(u[0]=y*(E=1/E),u[1]=-S*E,u[2]=-P*E,u[3]=x*E,u[4]=(P*I-y*A)*E,u[5]=(S*A-x*I)*E,u):null},De.determinant=function(u){return u[0]*u[3]-u[1]*u[2]},De.multiply=c,De.rotate=function(u,m,x){var S=m[0],P=m[1],y=m[2],A=m[3],I=m[4],E=m[5],M=Math.sin(x),R=Math.cos(x);return u[0]=S*R+y*M,u[1]=P*R+A*M,u[2]=S*-M+y*R,u[3]=P*-M+A*R,u[4]=I,u[5]=E,u},De.scale=function(u,m,x){var S=m[1],P=m[2],y=m[3],A=m[4],I=m[5],E=x[0],M=x[1];return u[0]=m[0]*E,u[1]=S*E,u[2]=P*M,u[3]=y*M,u[4]=A,u[5]=I,u},De.translate=function(u,m,x){var S=m[0],P=m[1],y=m[2],A=m[3],I=m[4],E=m[5],M=x[0],R=x[1];return u[0]=S,u[1]=P,u[2]=y,u[3]=A,u[4]=S*M+y*R+I,u[5]=P*M+A*R+E,u},De.fromRotation=function(u,m){var x=Math.sin(m),S=Math.cos(m);return u[0]=S,u[1]=x,u[2]=-x,u[3]=S,u[4]=0,u[5]=0,u},De.fromScaling=function(u,m){return u[0]=m[0],u[1]=0,u[2]=0,u[3]=m[1],u[4]=0,u[5]=0,u},De.fromTranslation=function(u,m){return u[0]=1,u[1]=0,u[2]=0,u[3]=1,u[4]=m[0],u[5]=m[1],u},De.str=function(u){return"mat2d("+u[0]+", "+u[1]+", "+u[2]+", "+u[3]+", "+u[4]+", "+u[5]+")"},De.frob=function(u){return Math.hypot(u[0],u[1],u[2],u[3],u[4],u[5],1)},De.add=function(u,m,x){return u[0]=m[0]+x[0],u[1]=m[1]+x[1],u[2]=m[2]+x[2],u[3]=m[3]+x[3],u[4]=m[4]+x[4],u[5]=m[5]+x[5],u},De.subtract=p,De.multiplyScalar=function(u,m,x){return u[0]=m[0]*x,u[1]=m[1]*x,u[2]=m[2]*x,u[3]=m[3]*x,u[4]=m[4]*x,u[5]=m[5]*x,u},De.multiplyScalarAndAdd=function(u,m,x,S){return u[0]=m[0]+x[0]*S,u[1]=m[1]+x[1]*S,u[2]=m[2]+x[2]*S,u[3]=m[3]+x[3]*S,u[4]=m[4]+x[4]*S,u[5]=m[5]+x[5]*S,u},De.exactEquals=function(u,m){return u[0]===m[0]&&u[1]===m[1]&&u[2]===m[2]&&u[3]===m[3]&&u[4]===m[4]&&u[5]===m[5]},De.equals=function(u,m){var x=u[0],S=u[1],P=u[2],y=u[3],A=u[4],I=u[5],E=m[0],M=m[1],R=m[2],z=m[3],F=m[4],$=m[5];return Math.abs(x-E)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(E))&&Math.abs(S-M)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(M))&&Math.abs(P-R)<=e.EPSILON*Math.max(1,Math.abs(P),Math.abs(R))&&Math.abs(y-z)<=e.EPSILON*Math.max(1,Math.abs(y),Math.abs(z))&&Math.abs(A-F)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(F))&&Math.abs(I-$)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs($))},De.sub=De.mul=void 0;var e=function(u,m){if(u&&u.__esModule)return u;if(u===null||a(u)!=="object"&&typeof u!="function")return{default:u};var x=s(void 0);if(x&&x.has(u))return x.get(u);var S={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in u)if(y!=="default"&&Object.prototype.hasOwnProperty.call(u,y)){var A=P?Object.getOwnPropertyDescriptor(u,y):null;A&&(A.get||A.set)?Object.defineProperty(S,y,A):S[y]=u[y]}return S.default=u,x&&x.set(u,S),S}(re());function s(u){if(typeof WeakMap!="function")return null;var m=new WeakMap,x=new WeakMap;return(s=function(S){return S?x:m})(u)}function c(u,m,x){var S=m[0],P=m[1],y=m[2],A=m[3],I=m[4],E=m[5],M=x[0],R=x[1],z=x[2],F=x[3],$=x[4],H=x[5];return u[0]=S*M+y*R,u[1]=P*M+A*R,u[2]=S*z+y*F,u[3]=P*z+A*F,u[4]=S*$+y*H+I,u[5]=P*$+A*H+E,u}function p(u,m,x){return u[0]=m[0]-x[0],u[1]=m[1]-x[1],u[2]=m[2]-x[2],u[3]=m[3]-x[3],u[4]=m[4]-x[4],u[5]=m[5]-x[5],u}return De.mul=c,De.sub=p,De}var Te,me={};function Ie(){if(Te)return me;function a(u){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},a(u)}Te=1,Object.defineProperty(me,"__esModule",{value:!0}),me.create=function(){var u=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u},me.fromMat4=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=m[2],u[3]=m[4],u[4]=m[5],u[5]=m[6],u[6]=m[8],u[7]=m[9],u[8]=m[10],u},me.clone=function(u){var m=new e.ARRAY_TYPE(9);return m[0]=u[0],m[1]=u[1],m[2]=u[2],m[3]=u[3],m[4]=u[4],m[5]=u[5],m[6]=u[6],m[7]=u[7],m[8]=u[8],m},me.copy=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=m[2],u[3]=m[3],u[4]=m[4],u[5]=m[5],u[6]=m[6],u[7]=m[7],u[8]=m[8],u},me.fromValues=function(u,m,x,S,P,y,A,I,E){var M=new e.ARRAY_TYPE(9);return M[0]=u,M[1]=m,M[2]=x,M[3]=S,M[4]=P,M[5]=y,M[6]=A,M[7]=I,M[8]=E,M},me.set=function(u,m,x,S,P,y,A,I,E,M){return u[0]=m,u[1]=x,u[2]=S,u[3]=P,u[4]=y,u[5]=A,u[6]=I,u[7]=E,u[8]=M,u},me.identity=function(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=1,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},me.transpose=function(u,m){if(u===m){var x=m[1],S=m[2],P=m[5];u[1]=m[3],u[2]=m[6],u[3]=x,u[5]=m[7],u[6]=S,u[7]=P}else u[0]=m[0],u[1]=m[3],u[2]=m[6],u[3]=m[1],u[4]=m[4],u[5]=m[7],u[6]=m[2],u[7]=m[5],u[8]=m[8];return u},me.invert=function(u,m){var x=m[0],S=m[1],P=m[2],y=m[3],A=m[4],I=m[5],E=m[6],M=m[7],R=m[8],z=R*A-I*M,F=-R*y+I*E,$=M*y-A*E,H=x*z+S*F+P*$;return H?(u[0]=z*(H=1/H),u[1]=(-R*S+P*M)*H,u[2]=(I*S-P*A)*H,u[3]=F*H,u[4]=(R*x-P*E)*H,u[5]=(-I*x+P*y)*H,u[6]=$*H,u[7]=(-M*x+S*E)*H,u[8]=(A*x-S*y)*H,u):null},me.adjoint=function(u,m){var x=m[0],S=m[1],P=m[2],y=m[3],A=m[4],I=m[5],E=m[6],M=m[7],R=m[8];return u[0]=A*R-I*M,u[1]=P*M-S*R,u[2]=S*I-P*A,u[3]=I*E-y*R,u[4]=x*R-P*E,u[5]=P*y-x*I,u[6]=y*M-A*E,u[7]=S*E-x*M,u[8]=x*A-S*y,u},me.determinant=function(u){var m=u[3],x=u[4],S=u[5],P=u[6],y=u[7],A=u[8];return u[0]*(A*x-S*y)+u[1]*(-A*m+S*P)+u[2]*(y*m-x*P)},me.multiply=c,me.translate=function(u,m,x){var S=m[0],P=m[1],y=m[2],A=m[3],I=m[4],E=m[5],M=m[6],R=m[7],z=m[8],F=x[0],$=x[1];return u[0]=S,u[1]=P,u[2]=y,u[3]=A,u[4]=I,u[5]=E,u[6]=F*S+$*A+M,u[7]=F*P+$*I+R,u[8]=F*y+$*E+z,u},me.rotate=function(u,m,x){var S=m[0],P=m[1],y=m[2],A=m[3],I=m[4],E=m[5],M=m[6],R=m[7],z=m[8],F=Math.sin(x),$=Math.cos(x);return u[0]=$*S+F*A,u[1]=$*P+F*I,u[2]=$*y+F*E,u[3]=$*A-F*S,u[4]=$*I-F*P,u[5]=$*E-F*y,u[6]=M,u[7]=R,u[8]=z,u},me.scale=function(u,m,x){var S=x[0],P=x[1];return u[0]=S*m[0],u[1]=S*m[1],u[2]=S*m[2],u[3]=P*m[3],u[4]=P*m[4],u[5]=P*m[5],u[6]=m[6],u[7]=m[7],u[8]=m[8],u},me.fromTranslation=function(u,m){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=1,u[5]=0,u[6]=m[0],u[7]=m[1],u[8]=1,u},me.fromRotation=function(u,m){var x=Math.sin(m),S=Math.cos(m);return u[0]=S,u[1]=x,u[2]=0,u[3]=-x,u[4]=S,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},me.fromScaling=function(u,m){return u[0]=m[0],u[1]=0,u[2]=0,u[3]=0,u[4]=m[1],u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},me.fromMat2d=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=0,u[3]=m[2],u[4]=m[3],u[5]=0,u[6]=m[4],u[7]=m[5],u[8]=1,u},me.fromQuat=function(u,m){var x=m[0],S=m[1],P=m[2],y=m[3],A=x+x,I=S+S,E=P+P,M=x*A,R=S*A,z=S*I,F=P*A,$=P*I,H=P*E,V=y*A,G=y*I,Y=y*E;return u[0]=1-z-H,u[3]=R-Y,u[6]=F+G,u[1]=R+Y,u[4]=1-M-H,u[7]=$-V,u[2]=F-G,u[5]=$+V,u[8]=1-M-z,u},me.normalFromMat4=function(u,m){var x=m[0],S=m[1],P=m[2],y=m[3],A=m[4],I=m[5],E=m[6],M=m[7],R=m[8],z=m[9],F=m[10],$=m[11],H=m[12],V=m[13],G=m[14],Y=m[15],te=x*I-S*A,he=x*E-P*A,ce=x*M-y*A,le=S*E-P*I,Ee=S*M-y*I,de=P*M-y*E,Ae=R*V-z*H,Pe=R*G-F*H,Ce=R*Y-$*H,ze=z*G-F*V,Ne=z*Y-$*V,Ge=F*Y-$*G,Fe=te*Ge-he*Ne+ce*ze+le*Ce-Ee*Pe+de*Ae;return Fe?(u[0]=(I*Ge-E*Ne+M*ze)*(Fe=1/Fe),u[1]=(E*Ce-A*Ge-M*Pe)*Fe,u[2]=(A*Ne-I*Ce+M*Ae)*Fe,u[3]=(P*Ne-S*Ge-y*ze)*Fe,u[4]=(x*Ge-P*Ce+y*Pe)*Fe,u[5]=(S*Ce-x*Ne-y*Ae)*Fe,u[6]=(V*de-G*Ee+Y*le)*Fe,u[7]=(G*ce-H*de-Y*he)*Fe,u[8]=(H*Ee-V*ce+Y*te)*Fe,u):null},me.projection=function(u,m,x){return u[0]=2/m,u[1]=0,u[2]=0,u[3]=0,u[4]=-2/x,u[5]=0,u[6]=-1,u[7]=1,u[8]=1,u},me.str=function(u){return"mat3("+u[0]+", "+u[1]+", "+u[2]+", "+u[3]+", "+u[4]+", "+u[5]+", "+u[6]+", "+u[7]+", "+u[8]+")"},me.frob=function(u){return Math.hypot(u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],u[8])},me.add=function(u,m,x){return u[0]=m[0]+x[0],u[1]=m[1]+x[1],u[2]=m[2]+x[2],u[3]=m[3]+x[3],u[4]=m[4]+x[4],u[5]=m[5]+x[5],u[6]=m[6]+x[6],u[7]=m[7]+x[7],u[8]=m[8]+x[8],u},me.subtract=p,me.multiplyScalar=function(u,m,x){return u[0]=m[0]*x,u[1]=m[1]*x,u[2]=m[2]*x,u[3]=m[3]*x,u[4]=m[4]*x,u[5]=m[5]*x,u[6]=m[6]*x,u[7]=m[7]*x,u[8]=m[8]*x,u},me.multiplyScalarAndAdd=function(u,m,x,S){return u[0]=m[0]+x[0]*S,u[1]=m[1]+x[1]*S,u[2]=m[2]+x[2]*S,u[3]=m[3]+x[3]*S,u[4]=m[4]+x[4]*S,u[5]=m[5]+x[5]*S,u[6]=m[6]+x[6]*S,u[7]=m[7]+x[7]*S,u[8]=m[8]+x[8]*S,u},me.exactEquals=function(u,m){return u[0]===m[0]&&u[1]===m[1]&&u[2]===m[2]&&u[3]===m[3]&&u[4]===m[4]&&u[5]===m[5]&&u[6]===m[6]&&u[7]===m[7]&&u[8]===m[8]},me.equals=function(u,m){var x=u[0],S=u[1],P=u[2],y=u[3],A=u[4],I=u[5],E=u[6],M=u[7],R=u[8],z=m[0],F=m[1],$=m[2],H=m[3],V=m[4],G=m[5],Y=m[6],te=m[7],he=m[8];return Math.abs(x-z)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(z))&&Math.abs(S-F)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(F))&&Math.abs(P-$)<=e.EPSILON*Math.max(1,Math.abs(P),Math.abs($))&&Math.abs(y-H)<=e.EPSILON*Math.max(1,Math.abs(y),Math.abs(H))&&Math.abs(A-V)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(V))&&Math.abs(I-G)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(G))&&Math.abs(E-Y)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(Y))&&Math.abs(M-te)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(te))&&Math.abs(R-he)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(he))},me.sub=me.mul=void 0;var e=function(u,m){if(u&&u.__esModule)return u;if(u===null||a(u)!=="object"&&typeof u!="function")return{default:u};var x=s(void 0);if(x&&x.has(u))return x.get(u);var S={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in u)if(y!=="default"&&Object.prototype.hasOwnProperty.call(u,y)){var A=P?Object.getOwnPropertyDescriptor(u,y):null;A&&(A.get||A.set)?Object.defineProperty(S,y,A):S[y]=u[y]}return S.default=u,x&&x.set(u,S),S}(re());function s(u){if(typeof WeakMap!="function")return null;var m=new WeakMap,x=new WeakMap;return(s=function(S){return S?x:m})(u)}function c(u,m,x){var S=m[0],P=m[1],y=m[2],A=m[3],I=m[4],E=m[5],M=m[6],R=m[7],z=m[8],F=x[0],$=x[1],H=x[2],V=x[3],G=x[4],Y=x[5],te=x[6],he=x[7],ce=x[8];return u[0]=F*S+$*A+H*M,u[1]=F*P+$*I+H*R,u[2]=F*y+$*E+H*z,u[3]=V*S+G*A+Y*M,u[4]=V*P+G*I+Y*R,u[5]=V*y+G*E+Y*z,u[6]=te*S+he*A+ce*M,u[7]=te*P+he*I+ce*R,u[8]=te*y+he*E+ce*z,u}function p(u,m,x){return u[0]=m[0]-x[0],u[1]=m[1]-x[1],u[2]=m[2]-x[2],u[3]=m[3]-x[3],u[4]=m[4]-x[4],u[5]=m[5]-x[5],u[6]=m[6]-x[6],u[7]=m[7]-x[7],u[8]=m[8]-x[8],u}return me.mul=c,me.sub=p,me}var Xe,je={};function rt(){if(Xe)return je;function a(y){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},a(y)}Xe=1,Object.defineProperty(je,"__esModule",{value:!0}),je.create=function(){var y=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[11]=0,y[12]=0,y[13]=0,y[14]=0),y[0]=1,y[5]=1,y[10]=1,y[15]=1,y},je.clone=function(y){var A=new e.ARRAY_TYPE(16);return A[0]=y[0],A[1]=y[1],A[2]=y[2],A[3]=y[3],A[4]=y[4],A[5]=y[5],A[6]=y[6],A[7]=y[7],A[8]=y[8],A[9]=y[9],A[10]=y[10],A[11]=y[11],A[12]=y[12],A[13]=y[13],A[14]=y[14],A[15]=y[15],A},je.copy=function(y,A){return y[0]=A[0],y[1]=A[1],y[2]=A[2],y[3]=A[3],y[4]=A[4],y[5]=A[5],y[6]=A[6],y[7]=A[7],y[8]=A[8],y[9]=A[9],y[10]=A[10],y[11]=A[11],y[12]=A[12],y[13]=A[13],y[14]=A[14],y[15]=A[15],y},je.fromValues=function(y,A,I,E,M,R,z,F,$,H,V,G,Y,te,he,ce){var le=new e.ARRAY_TYPE(16);return le[0]=y,le[1]=A,le[2]=I,le[3]=E,le[4]=M,le[5]=R,le[6]=z,le[7]=F,le[8]=$,le[9]=H,le[10]=V,le[11]=G,le[12]=Y,le[13]=te,le[14]=he,le[15]=ce,le},je.set=function(y,A,I,E,M,R,z,F,$,H,V,G,Y,te,he,ce,le){return y[0]=A,y[1]=I,y[2]=E,y[3]=M,y[4]=R,y[5]=z,y[6]=F,y[7]=$,y[8]=H,y[9]=V,y[10]=G,y[11]=Y,y[12]=te,y[13]=he,y[14]=ce,y[15]=le,y},je.identity=c,je.transpose=function(y,A){if(y===A){var I=A[1],E=A[2],M=A[3],R=A[6],z=A[7],F=A[11];y[1]=A[4],y[2]=A[8],y[3]=A[12],y[4]=I,y[6]=A[9],y[7]=A[13],y[8]=E,y[9]=R,y[11]=A[14],y[12]=M,y[13]=z,y[14]=F}else y[0]=A[0],y[1]=A[4],y[2]=A[8],y[3]=A[12],y[4]=A[1],y[5]=A[5],y[6]=A[9],y[7]=A[13],y[8]=A[2],y[9]=A[6],y[10]=A[10],y[11]=A[14],y[12]=A[3],y[13]=A[7],y[14]=A[11],y[15]=A[15];return y},je.invert=function(y,A){var I=A[0],E=A[1],M=A[2],R=A[3],z=A[4],F=A[5],$=A[6],H=A[7],V=A[8],G=A[9],Y=A[10],te=A[11],he=A[12],ce=A[13],le=A[14],Ee=A[15],de=I*F-E*z,Ae=I*$-M*z,Pe=I*H-R*z,Ce=E*$-M*F,ze=E*H-R*F,Ne=M*H-R*$,Ge=V*ce-G*he,Fe=V*le-Y*he,at=V*Ee-te*he,mt=G*le-Y*ce,ot=G*Ee-te*ce,zt=Y*Ee-te*le,Rt=de*zt-Ae*ot+Pe*mt+Ce*at-ze*Fe+Ne*Ge;return Rt?(y[0]=(F*zt-$*ot+H*mt)*(Rt=1/Rt),y[1]=(M*ot-E*zt-R*mt)*Rt,y[2]=(ce*Ne-le*ze+Ee*Ce)*Rt,y[3]=(Y*ze-G*Ne-te*Ce)*Rt,y[4]=($*at-z*zt-H*Fe)*Rt,y[5]=(I*zt-M*at+R*Fe)*Rt,y[6]=(le*Pe-he*Ne-Ee*Ae)*Rt,y[7]=(V*Ne-Y*Pe+te*Ae)*Rt,y[8]=(z*ot-F*at+H*Ge)*Rt,y[9]=(E*at-I*ot-R*Ge)*Rt,y[10]=(he*ze-ce*Pe+Ee*de)*Rt,y[11]=(G*Pe-V*ze-te*de)*Rt,y[12]=(F*Fe-z*mt-$*Ge)*Rt,y[13]=(I*mt-E*Fe+M*Ge)*Rt,y[14]=(ce*Ae-he*Ce-le*de)*Rt,y[15]=(V*Ce-G*Ae+Y*de)*Rt,y):null},je.adjoint=function(y,A){var I=A[0],E=A[1],M=A[2],R=A[3],z=A[4],F=A[5],$=A[6],H=A[7],V=A[8],G=A[9],Y=A[10],te=A[11],he=A[12],ce=A[13],le=A[14],Ee=A[15];return y[0]=F*(Y*Ee-te*le)-G*($*Ee-H*le)+ce*($*te-H*Y),y[1]=-(E*(Y*Ee-te*le)-G*(M*Ee-R*le)+ce*(M*te-R*Y)),y[2]=E*($*Ee-H*le)-F*(M*Ee-R*le)+ce*(M*H-R*$),y[3]=-(E*($*te-H*Y)-F*(M*te-R*Y)+G*(M*H-R*$)),y[4]=-(z*(Y*Ee-te*le)-V*($*Ee-H*le)+he*($*te-H*Y)),y[5]=I*(Y*Ee-te*le)-V*(M*Ee-R*le)+he*(M*te-R*Y),y[6]=-(I*($*Ee-H*le)-z*(M*Ee-R*le)+he*(M*H-R*$)),y[7]=I*($*te-H*Y)-z*(M*te-R*Y)+V*(M*H-R*$),y[8]=z*(G*Ee-te*ce)-V*(F*Ee-H*ce)+he*(F*te-H*G),y[9]=-(I*(G*Ee-te*ce)-V*(E*Ee-R*ce)+he*(E*te-R*G)),y[10]=I*(F*Ee-H*ce)-z*(E*Ee-R*ce)+he*(E*H-R*F),y[11]=-(I*(F*te-H*G)-z*(E*te-R*G)+V*(E*H-R*F)),y[12]=-(z*(G*le-Y*ce)-V*(F*le-$*ce)+he*(F*Y-$*G)),y[13]=I*(G*le-Y*ce)-V*(E*le-M*ce)+he*(E*Y-M*G),y[14]=-(I*(F*le-$*ce)-z*(E*le-M*ce)+he*(E*$-M*F)),y[15]=I*(F*Y-$*G)-z*(E*Y-M*G)+V*(E*$-M*F),y},je.determinant=function(y){var A=y[0],I=y[1],E=y[2],M=y[3],R=y[4],z=y[5],F=y[6],$=y[7],H=y[8],V=y[9],G=y[10],Y=y[11],te=y[12],he=y[13],ce=y[14],le=y[15];return(A*z-I*R)*(G*le-Y*ce)-(A*F-E*R)*(V*le-Y*he)+(A*$-M*R)*(V*ce-G*he)+(I*F-E*z)*(H*le-Y*te)-(I*$-M*z)*(H*ce-G*te)+(E*$-M*F)*(H*he-V*te)},je.multiply=p,je.translate=function(y,A,I){var E,M,R,z,F,$,H,V,G,Y,te,he,ce=I[0],le=I[1],Ee=I[2];return A===y?(y[12]=A[0]*ce+A[4]*le+A[8]*Ee+A[12],y[13]=A[1]*ce+A[5]*le+A[9]*Ee+A[13],y[14]=A[2]*ce+A[6]*le+A[10]*Ee+A[14],y[15]=A[3]*ce+A[7]*le+A[11]*Ee+A[15]):(M=A[1],R=A[2],z=A[3],F=A[4],$=A[5],H=A[6],V=A[7],G=A[8],Y=A[9],te=A[10],he=A[11],y[0]=E=A[0],y[1]=M,y[2]=R,y[3]=z,y[4]=F,y[5]=$,y[6]=H,y[7]=V,y[8]=G,y[9]=Y,y[10]=te,y[11]=he,y[12]=E*ce+F*le+G*Ee+A[12],y[13]=M*ce+$*le+Y*Ee+A[13],y[14]=R*ce+H*le+te*Ee+A[14],y[15]=z*ce+V*le+he*Ee+A[15]),y},je.scale=function(y,A,I){var E=I[0],M=I[1],R=I[2];return y[0]=A[0]*E,y[1]=A[1]*E,y[2]=A[2]*E,y[3]=A[3]*E,y[4]=A[4]*M,y[5]=A[5]*M,y[6]=A[6]*M,y[7]=A[7]*M,y[8]=A[8]*R,y[9]=A[9]*R,y[10]=A[10]*R,y[11]=A[11]*R,y[12]=A[12],y[13]=A[13],y[14]=A[14],y[15]=A[15],y},je.rotate=function(y,A,I,E){var M,R,z,F,$,H,V,G,Y,te,he,ce,le,Ee,de,Ae,Pe,Ce,ze,Ne,Ge,Fe,at,mt,ot=E[0],zt=E[1],Rt=E[2],xt=Math.hypot(ot,zt,Rt);return xt<e.EPSILON?null:(ot*=xt=1/xt,zt*=xt,Rt*=xt,M=Math.sin(I),R=Math.cos(I),$=A[1],H=A[2],V=A[3],Y=A[5],te=A[6],he=A[7],le=A[9],Ee=A[10],de=A[11],Ae=ot*ot*(z=1-R)+R,ze=ot*zt*z-Rt*M,Ne=zt*zt*z+R,Ge=Rt*zt*z+ot*M,Fe=ot*Rt*z+zt*M,at=zt*Rt*z-ot*M,mt=Rt*Rt*z+R,y[0]=(F=A[0])*Ae+(G=A[4])*(Pe=zt*ot*z+Rt*M)+(ce=A[8])*(Ce=Rt*ot*z-zt*M),y[1]=$*Ae+Y*Pe+le*Ce,y[2]=H*Ae+te*Pe+Ee*Ce,y[3]=V*Ae+he*Pe+de*Ce,y[4]=F*ze+G*Ne+ce*Ge,y[5]=$*ze+Y*Ne+le*Ge,y[6]=H*ze+te*Ne+Ee*Ge,y[7]=V*ze+he*Ne+de*Ge,y[8]=F*Fe+G*at+ce*mt,y[9]=$*Fe+Y*at+le*mt,y[10]=H*Fe+te*at+Ee*mt,y[11]=V*Fe+he*at+de*mt,A!==y&&(y[12]=A[12],y[13]=A[13],y[14]=A[14],y[15]=A[15]),y)},je.rotateX=function(y,A,I){var E=Math.sin(I),M=Math.cos(I),R=A[4],z=A[5],F=A[6],$=A[7],H=A[8],V=A[9],G=A[10],Y=A[11];return A!==y&&(y[0]=A[0],y[1]=A[1],y[2]=A[2],y[3]=A[3],y[12]=A[12],y[13]=A[13],y[14]=A[14],y[15]=A[15]),y[4]=R*M+H*E,y[5]=z*M+V*E,y[6]=F*M+G*E,y[7]=$*M+Y*E,y[8]=H*M-R*E,y[9]=V*M-z*E,y[10]=G*M-F*E,y[11]=Y*M-$*E,y},je.rotateY=function(y,A,I){var E=Math.sin(I),M=Math.cos(I),R=A[0],z=A[1],F=A[2],$=A[3],H=A[8],V=A[9],G=A[10],Y=A[11];return A!==y&&(y[4]=A[4],y[5]=A[5],y[6]=A[6],y[7]=A[7],y[12]=A[12],y[13]=A[13],y[14]=A[14],y[15]=A[15]),y[0]=R*M-H*E,y[1]=z*M-V*E,y[2]=F*M-G*E,y[3]=$*M-Y*E,y[8]=R*E+H*M,y[9]=z*E+V*M,y[10]=F*E+G*M,y[11]=$*E+Y*M,y},je.rotateZ=function(y,A,I){var E=Math.sin(I),M=Math.cos(I),R=A[0],z=A[1],F=A[2],$=A[3],H=A[4],V=A[5],G=A[6],Y=A[7];return A!==y&&(y[8]=A[8],y[9]=A[9],y[10]=A[10],y[11]=A[11],y[12]=A[12],y[13]=A[13],y[14]=A[14],y[15]=A[15]),y[0]=R*M+H*E,y[1]=z*M+V*E,y[2]=F*M+G*E,y[3]=$*M+Y*E,y[4]=H*M-R*E,y[5]=V*M-z*E,y[6]=G*M-F*E,y[7]=Y*M-$*E,y},je.fromTranslation=function(y,A){return y[0]=1,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=1,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=1,y[11]=0,y[12]=A[0],y[13]=A[1],y[14]=A[2],y[15]=1,y},je.fromScaling=function(y,A){return y[0]=A[0],y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=A[1],y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=A[2],y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},je.fromRotation=function(y,A,I){var E,M,R,z=I[0],F=I[1],$=I[2],H=Math.hypot(z,F,$);return H<e.EPSILON?null:(z*=H=1/H,F*=H,$*=H,E=Math.sin(A),M=Math.cos(A),y[0]=z*z*(R=1-M)+M,y[1]=F*z*R+$*E,y[2]=$*z*R-F*E,y[3]=0,y[4]=z*F*R-$*E,y[5]=F*F*R+M,y[6]=$*F*R+z*E,y[7]=0,y[8]=z*$*R+F*E,y[9]=F*$*R-z*E,y[10]=$*$*R+M,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y)},je.fromXRotation=function(y,A){var I=Math.sin(A),E=Math.cos(A);return y[0]=1,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=E,y[6]=I,y[7]=0,y[8]=0,y[9]=-I,y[10]=E,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},je.fromYRotation=function(y,A){var I=Math.sin(A),E=Math.cos(A);return y[0]=E,y[1]=0,y[2]=-I,y[3]=0,y[4]=0,y[5]=1,y[6]=0,y[7]=0,y[8]=I,y[9]=0,y[10]=E,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},je.fromZRotation=function(y,A){var I=Math.sin(A),E=Math.cos(A);return y[0]=E,y[1]=I,y[2]=0,y[3]=0,y[4]=-I,y[5]=E,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=1,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},je.fromRotationTranslation=u,je.fromQuat2=function(y,A){var I=new e.ARRAY_TYPE(3),E=-A[0],M=-A[1],R=-A[2],z=A[3],F=A[4],$=A[5],H=A[6],V=A[7],G=E*E+M*M+R*R+z*z;return G>0?(I[0]=2*(F*z+V*E+$*R-H*M)/G,I[1]=2*($*z+V*M+H*E-F*R)/G,I[2]=2*(H*z+V*R+F*M-$*E)/G):(I[0]=2*(F*z+V*E+$*R-H*M),I[1]=2*($*z+V*M+H*E-F*R),I[2]=2*(H*z+V*R+F*M-$*E)),u(y,A,I),y},je.getTranslation=function(y,A){return y[0]=A[12],y[1]=A[13],y[2]=A[14],y},je.getScaling=m,je.getRotation=function(y,A){var I=new e.ARRAY_TYPE(3);m(I,A);var E=1/I[0],M=1/I[1],R=1/I[2],z=A[0]*E,F=A[1]*M,$=A[2]*R,H=A[4]*E,V=A[5]*M,G=A[6]*R,Y=A[8]*E,te=A[9]*M,he=A[10]*R,ce=z+V+he,le=0;return ce>0?(le=2*Math.sqrt(ce+1),y[3]=.25*le,y[0]=(G-te)/le,y[1]=(Y-$)/le,y[2]=(F-H)/le):z>V&&z>he?(le=2*Math.sqrt(1+z-V-he),y[3]=(G-te)/le,y[0]=.25*le,y[1]=(F+H)/le,y[2]=(Y+$)/le):V>he?(le=2*Math.sqrt(1+V-z-he),y[3]=(Y-$)/le,y[0]=(F+H)/le,y[1]=.25*le,y[2]=(G+te)/le):(le=2*Math.sqrt(1+he-z-V),y[3]=(F-H)/le,y[0]=(Y+$)/le,y[1]=(G+te)/le,y[2]=.25*le),y},je.fromRotationTranslationScale=function(y,A,I,E){var M=A[0],R=A[1],z=A[2],F=A[3],$=M+M,H=R+R,V=z+z,G=M*$,Y=M*H,te=M*V,he=R*H,ce=R*V,le=z*V,Ee=F*$,de=F*H,Ae=F*V,Pe=E[0],Ce=E[1],ze=E[2];return y[0]=(1-(he+le))*Pe,y[1]=(Y+Ae)*Pe,y[2]=(te-de)*Pe,y[3]=0,y[4]=(Y-Ae)*Ce,y[5]=(1-(G+le))*Ce,y[6]=(ce+Ee)*Ce,y[7]=0,y[8]=(te+de)*ze,y[9]=(ce-Ee)*ze,y[10]=(1-(G+he))*ze,y[11]=0,y[12]=I[0],y[13]=I[1],y[14]=I[2],y[15]=1,y},je.fromRotationTranslationScaleOrigin=function(y,A,I,E,M){var R=A[0],z=A[1],F=A[2],$=A[3],H=R+R,V=z+z,G=F+F,Y=R*H,te=R*V,he=R*G,ce=z*V,le=z*G,Ee=F*G,de=$*H,Ae=$*V,Pe=$*G,Ce=E[0],ze=E[1],Ne=E[2],Ge=M[0],Fe=M[1],at=M[2],mt=(1-(ce+Ee))*Ce,ot=(te+Pe)*Ce,zt=(he-Ae)*Ce,Rt=(te-Pe)*ze,xt=(1-(Y+Ee))*ze,_t=(le+de)*ze,Yt=(he+Ae)*Ne,Ft=(le-de)*Ne,jt=(1-(Y+ce))*Ne;return y[0]=mt,y[1]=ot,y[2]=zt,y[3]=0,y[4]=Rt,y[5]=xt,y[6]=_t,y[7]=0,y[8]=Yt,y[9]=Ft,y[10]=jt,y[11]=0,y[12]=I[0]+Ge-(mt*Ge+Rt*Fe+Yt*at),y[13]=I[1]+Fe-(ot*Ge+xt*Fe+Ft*at),y[14]=I[2]+at-(zt*Ge+_t*Fe+jt*at),y[15]=1,y},je.fromQuat=function(y,A){var I=A[0],E=A[1],M=A[2],R=A[3],z=I+I,F=E+E,$=M+M,H=I*z,V=E*z,G=E*F,Y=M*z,te=M*F,he=M*$,ce=R*z,le=R*F,Ee=R*$;return y[0]=1-G-he,y[1]=V+Ee,y[2]=Y-le,y[3]=0,y[4]=V-Ee,y[5]=1-H-he,y[6]=te+ce,y[7]=0,y[8]=Y+le,y[9]=te-ce,y[10]=1-H-G,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y},je.frustum=function(y,A,I,E,M,R,z){var F=1/(I-A),$=1/(M-E),H=1/(R-z);return y[0]=2*R*F,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=2*R*$,y[6]=0,y[7]=0,y[8]=(I+A)*F,y[9]=(M+E)*$,y[10]=(z+R)*H,y[11]=-1,y[12]=0,y[13]=0,y[14]=z*R*2*H,y[15]=0,y},je.perspectiveNO=x,je.perspectiveZO=function(y,A,I,E,M){var R,z=1/Math.tan(A/2);return y[0]=z/I,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=z,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[11]=-1,y[12]=0,y[13]=0,y[15]=0,M!=null&&M!==1/0?(y[10]=M*(R=1/(E-M)),y[14]=M*E*R):(y[10]=-1,y[14]=-E),y},je.perspectiveFromFieldOfView=function(y,A,I,E){var M=Math.tan(A.upDegrees*Math.PI/180),R=Math.tan(A.downDegrees*Math.PI/180),z=Math.tan(A.leftDegrees*Math.PI/180),F=Math.tan(A.rightDegrees*Math.PI/180),$=2/(z+F),H=2/(M+R);return y[0]=$,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=H,y[6]=0,y[7]=0,y[8]=-(z-F)*$*.5,y[9]=(M-R)*H*.5,y[10]=E/(I-E),y[11]=-1,y[12]=0,y[13]=0,y[14]=E*I/(I-E),y[15]=0,y},je.orthoNO=S,je.orthoZO=function(y,A,I,E,M,R,z){var F=1/(A-I),$=1/(E-M),H=1/(R-z);return y[0]=-2*F,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=-2*$,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=H,y[11]=0,y[12]=(A+I)*F,y[13]=(M+E)*$,y[14]=R*H,y[15]=1,y},je.lookAt=function(y,A,I,E){var M,R,z,F,$,H,V,G,Y,te,he=A[0],ce=A[1],le=A[2],Ee=E[0],de=E[1],Ae=E[2],Pe=I[0],Ce=I[1],ze=I[2];return Math.abs(he-Pe)<e.EPSILON&&Math.abs(ce-Ce)<e.EPSILON&&Math.abs(le-ze)<e.EPSILON?c(y):(V=he-Pe,G=ce-Ce,Y=le-ze,M=de*(Y*=te=1/Math.hypot(V,G,Y))-Ae*(G*=te),R=Ae*(V*=te)-Ee*Y,z=Ee*G-de*V,(te=Math.hypot(M,R,z))?(M*=te=1/te,R*=te,z*=te):(M=0,R=0,z=0),F=G*z-Y*R,$=Y*M-V*z,H=V*R-G*M,(te=Math.hypot(F,$,H))?(F*=te=1/te,$*=te,H*=te):(F=0,$=0,H=0),y[0]=M,y[1]=F,y[2]=V,y[3]=0,y[4]=R,y[5]=$,y[6]=G,y[7]=0,y[8]=z,y[9]=H,y[10]=Y,y[11]=0,y[12]=-(M*he+R*ce+z*le),y[13]=-(F*he+$*ce+H*le),y[14]=-(V*he+G*ce+Y*le),y[15]=1,y)},je.targetTo=function(y,A,I,E){var M=A[0],R=A[1],z=A[2],F=E[0],$=E[1],H=E[2],V=M-I[0],G=R-I[1],Y=z-I[2],te=V*V+G*G+Y*Y;te>0&&(V*=te=1/Math.sqrt(te),G*=te,Y*=te);var he=$*Y-H*G,ce=H*V-F*Y,le=F*G-$*V;return(te=he*he+ce*ce+le*le)>0&&(he*=te=1/Math.sqrt(te),ce*=te,le*=te),y[0]=he,y[1]=ce,y[2]=le,y[3]=0,y[4]=G*le-Y*ce,y[5]=Y*he-V*le,y[6]=V*ce-G*he,y[7]=0,y[8]=V,y[9]=G,y[10]=Y,y[11]=0,y[12]=M,y[13]=R,y[14]=z,y[15]=1,y},je.str=function(y){return"mat4("+y[0]+", "+y[1]+", "+y[2]+", "+y[3]+", "+y[4]+", "+y[5]+", "+y[6]+", "+y[7]+", "+y[8]+", "+y[9]+", "+y[10]+", "+y[11]+", "+y[12]+", "+y[13]+", "+y[14]+", "+y[15]+")"},je.frob=function(y){return Math.hypot(y[0],y[1],y[2],y[3],y[4],y[5],y[6],y[7],y[8],y[9],y[10],y[11],y[12],y[13],y[14],y[15])},je.add=function(y,A,I){return y[0]=A[0]+I[0],y[1]=A[1]+I[1],y[2]=A[2]+I[2],y[3]=A[3]+I[3],y[4]=A[4]+I[4],y[5]=A[5]+I[5],y[6]=A[6]+I[6],y[7]=A[7]+I[7],y[8]=A[8]+I[8],y[9]=A[9]+I[9],y[10]=A[10]+I[10],y[11]=A[11]+I[11],y[12]=A[12]+I[12],y[13]=A[13]+I[13],y[14]=A[14]+I[14],y[15]=A[15]+I[15],y},je.subtract=P,je.multiplyScalar=function(y,A,I){return y[0]=A[0]*I,y[1]=A[1]*I,y[2]=A[2]*I,y[3]=A[3]*I,y[4]=A[4]*I,y[5]=A[5]*I,y[6]=A[6]*I,y[7]=A[7]*I,y[8]=A[8]*I,y[9]=A[9]*I,y[10]=A[10]*I,y[11]=A[11]*I,y[12]=A[12]*I,y[13]=A[13]*I,y[14]=A[14]*I,y[15]=A[15]*I,y},je.multiplyScalarAndAdd=function(y,A,I,E){return y[0]=A[0]+I[0]*E,y[1]=A[1]+I[1]*E,y[2]=A[2]+I[2]*E,y[3]=A[3]+I[3]*E,y[4]=A[4]+I[4]*E,y[5]=A[5]+I[5]*E,y[6]=A[6]+I[6]*E,y[7]=A[7]+I[7]*E,y[8]=A[8]+I[8]*E,y[9]=A[9]+I[9]*E,y[10]=A[10]+I[10]*E,y[11]=A[11]+I[11]*E,y[12]=A[12]+I[12]*E,y[13]=A[13]+I[13]*E,y[14]=A[14]+I[14]*E,y[15]=A[15]+I[15]*E,y},je.exactEquals=function(y,A){return y[0]===A[0]&&y[1]===A[1]&&y[2]===A[2]&&y[3]===A[3]&&y[4]===A[4]&&y[5]===A[5]&&y[6]===A[6]&&y[7]===A[7]&&y[8]===A[8]&&y[9]===A[9]&&y[10]===A[10]&&y[11]===A[11]&&y[12]===A[12]&&y[13]===A[13]&&y[14]===A[14]&&y[15]===A[15]},je.equals=function(y,A){var I=y[0],E=y[1],M=y[2],R=y[3],z=y[4],F=y[5],$=y[6],H=y[7],V=y[8],G=y[9],Y=y[10],te=y[11],he=y[12],ce=y[13],le=y[14],Ee=y[15],de=A[0],Ae=A[1],Pe=A[2],Ce=A[3],ze=A[4],Ne=A[5],Ge=A[6],Fe=A[7],at=A[8],mt=A[9],ot=A[10],zt=A[11],Rt=A[12],xt=A[13],_t=A[14],Yt=A[15];return Math.abs(I-de)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(de))&&Math.abs(E-Ae)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(Ae))&&Math.abs(M-Pe)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(Pe))&&Math.abs(R-Ce)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(Ce))&&Math.abs(z-ze)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(ze))&&Math.abs(F-Ne)<=e.EPSILON*Math.max(1,Math.abs(F),Math.abs(Ne))&&Math.abs($-Ge)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(Ge))&&Math.abs(H-Fe)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(Fe))&&Math.abs(V-at)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(at))&&Math.abs(G-mt)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(mt))&&Math.abs(Y-ot)<=e.EPSILON*Math.max(1,Math.abs(Y),Math.abs(ot))&&Math.abs(te-zt)<=e.EPSILON*Math.max(1,Math.abs(te),Math.abs(zt))&&Math.abs(he-Rt)<=e.EPSILON*Math.max(1,Math.abs(he),Math.abs(Rt))&&Math.abs(ce-xt)<=e.EPSILON*Math.max(1,Math.abs(ce),Math.abs(xt))&&Math.abs(le-_t)<=e.EPSILON*Math.max(1,Math.abs(le),Math.abs(_t))&&Math.abs(Ee-Yt)<=e.EPSILON*Math.max(1,Math.abs(Ee),Math.abs(Yt))},je.sub=je.mul=je.ortho=je.perspective=void 0;var e=function(y,A){if(y&&y.__esModule)return y;if(y===null||a(y)!=="object"&&typeof y!="function")return{default:y};var I=s(void 0);if(I&&I.has(y))return I.get(y);var E={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var R in y)if(R!=="default"&&Object.prototype.hasOwnProperty.call(y,R)){var z=M?Object.getOwnPropertyDescriptor(y,R):null;z&&(z.get||z.set)?Object.defineProperty(E,R,z):E[R]=y[R]}return E.default=y,I&&I.set(y,E),E}(re());function s(y){if(typeof WeakMap!="function")return null;var A=new WeakMap,I=new WeakMap;return(s=function(E){return E?I:A})(y)}function c(y){return y[0]=1,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=1,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=1,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,y}function p(y,A,I){var E=A[0],M=A[1],R=A[2],z=A[3],F=A[4],$=A[5],H=A[6],V=A[7],G=A[8],Y=A[9],te=A[10],he=A[11],ce=A[12],le=A[13],Ee=A[14],de=A[15],Ae=I[0],Pe=I[1],Ce=I[2],ze=I[3];return y[0]=Ae*E+Pe*F+Ce*G+ze*ce,y[1]=Ae*M+Pe*$+Ce*Y+ze*le,y[2]=Ae*R+Pe*H+Ce*te+ze*Ee,y[3]=Ae*z+Pe*V+Ce*he+ze*de,y[4]=(Ae=I[4])*E+(Pe=I[5])*F+(Ce=I[6])*G+(ze=I[7])*ce,y[5]=Ae*M+Pe*$+Ce*Y+ze*le,y[6]=Ae*R+Pe*H+Ce*te+ze*Ee,y[7]=Ae*z+Pe*V+Ce*he+ze*de,y[8]=(Ae=I[8])*E+(Pe=I[9])*F+(Ce=I[10])*G+(ze=I[11])*ce,y[9]=Ae*M+Pe*$+Ce*Y+ze*le,y[10]=Ae*R+Pe*H+Ce*te+ze*Ee,y[11]=Ae*z+Pe*V+Ce*he+ze*de,y[12]=(Ae=I[12])*E+(Pe=I[13])*F+(Ce=I[14])*G+(ze=I[15])*ce,y[13]=Ae*M+Pe*$+Ce*Y+ze*le,y[14]=Ae*R+Pe*H+Ce*te+ze*Ee,y[15]=Ae*z+Pe*V+Ce*he+ze*de,y}function u(y,A,I){var E=A[0],M=A[1],R=A[2],z=A[3],F=E+E,$=M+M,H=R+R,V=E*F,G=E*$,Y=E*H,te=M*$,he=M*H,ce=R*H,le=z*F,Ee=z*$,de=z*H;return y[0]=1-(te+ce),y[1]=G+de,y[2]=Y-Ee,y[3]=0,y[4]=G-de,y[5]=1-(V+ce),y[6]=he+le,y[7]=0,y[8]=Y+Ee,y[9]=he-le,y[10]=1-(V+te),y[11]=0,y[12]=I[0],y[13]=I[1],y[14]=I[2],y[15]=1,y}function m(y,A){var I=A[4],E=A[5],M=A[6],R=A[8],z=A[9],F=A[10];return y[0]=Math.hypot(A[0],A[1],A[2]),y[1]=Math.hypot(I,E,M),y[2]=Math.hypot(R,z,F),y}function x(y,A,I,E,M){var R,z=1/Math.tan(A/2);return y[0]=z/I,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=z,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[11]=-1,y[12]=0,y[13]=0,y[15]=0,M!=null&&M!==1/0?(y[10]=(M+E)*(R=1/(E-M)),y[14]=2*M*E*R):(y[10]=-1,y[14]=-2*E),y}function S(y,A,I,E,M,R,z){var F=1/(A-I),$=1/(E-M),H=1/(R-z);return y[0]=-2*F,y[1]=0,y[2]=0,y[3]=0,y[4]=0,y[5]=-2*$,y[6]=0,y[7]=0,y[8]=0,y[9]=0,y[10]=2*H,y[11]=0,y[12]=(A+I)*F,y[13]=(M+E)*$,y[14]=(z+R)*H,y[15]=1,y}function P(y,A,I){return y[0]=A[0]-I[0],y[1]=A[1]-I[1],y[2]=A[2]-I[2],y[3]=A[3]-I[3],y[4]=A[4]-I[4],y[5]=A[5]-I[5],y[6]=A[6]-I[6],y[7]=A[7]-I[7],y[8]=A[8]-I[8],y[9]=A[9]-I[9],y[10]=A[10]-I[10],y[11]=A[11]-I[11],y[12]=A[12]-I[12],y[13]=A[13]-I[13],y[14]=A[14]-I[14],y[15]=A[15]-I[15],y}return je.perspective=x,je.ortho=S,je.mul=p,je.sub=P,je}var Ve,He={},st={};function dt(){if(Ve)return st;function a(M){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},a(M)}Ve=1,Object.defineProperty(st,"__esModule",{value:!0}),st.create=c,st.clone=function(M){var R=new e.ARRAY_TYPE(3);return R[0]=M[0],R[1]=M[1],R[2]=M[2],R},st.length=p,st.fromValues=function(M,R,z){var F=new e.ARRAY_TYPE(3);return F[0]=M,F[1]=R,F[2]=z,F},st.copy=function(M,R){return M[0]=R[0],M[1]=R[1],M[2]=R[2],M},st.set=function(M,R,z,F){return M[0]=R,M[1]=z,M[2]=F,M},st.add=function(M,R,z){return M[0]=R[0]+z[0],M[1]=R[1]+z[1],M[2]=R[2]+z[2],M},st.subtract=u,st.multiply=m,st.divide=x,st.ceil=function(M,R){return M[0]=Math.ceil(R[0]),M[1]=Math.ceil(R[1]),M[2]=Math.ceil(R[2]),M},st.floor=function(M,R){return M[0]=Math.floor(R[0]),M[1]=Math.floor(R[1]),M[2]=Math.floor(R[2]),M},st.min=function(M,R,z){return M[0]=Math.min(R[0],z[0]),M[1]=Math.min(R[1],z[1]),M[2]=Math.min(R[2],z[2]),M},st.max=function(M,R,z){return M[0]=Math.max(R[0],z[0]),M[1]=Math.max(R[1],z[1]),M[2]=Math.max(R[2],z[2]),M},st.round=function(M,R){return M[0]=Math.round(R[0]),M[1]=Math.round(R[1]),M[2]=Math.round(R[2]),M},st.scale=function(M,R,z){return M[0]=R[0]*z,M[1]=R[1]*z,M[2]=R[2]*z,M},st.scaleAndAdd=function(M,R,z,F){return M[0]=R[0]+z[0]*F,M[1]=R[1]+z[1]*F,M[2]=R[2]+z[2]*F,M},st.distance=S,st.squaredDistance=P,st.squaredLength=y,st.negate=function(M,R){return M[0]=-R[0],M[1]=-R[1],M[2]=-R[2],M},st.inverse=function(M,R){return M[0]=1/R[0],M[1]=1/R[1],M[2]=1/R[2],M},st.normalize=function(M,R){var z=R[0],F=R[1],$=R[2],H=z*z+F*F+$*$;return H>0&&(H=1/Math.sqrt(H)),M[0]=R[0]*H,M[1]=R[1]*H,M[2]=R[2]*H,M},st.dot=A,st.cross=function(M,R,z){var F=R[0],$=R[1],H=R[2],V=z[0],G=z[1],Y=z[2];return M[0]=$*Y-H*G,M[1]=H*V-F*Y,M[2]=F*G-$*V,M},st.lerp=function(M,R,z,F){var $=R[0],H=R[1],V=R[2];return M[0]=$+F*(z[0]-$),M[1]=H+F*(z[1]-H),M[2]=V+F*(z[2]-V),M},st.hermite=function(M,R,z,F,$,H){var V=H*H,G=V*(2*H-3)+1,Y=V*(H-2)+H,te=V*(H-1),he=V*(3-2*H);return M[0]=R[0]*G+z[0]*Y+F[0]*te+$[0]*he,M[1]=R[1]*G+z[1]*Y+F[1]*te+$[1]*he,M[2]=R[2]*G+z[2]*Y+F[2]*te+$[2]*he,M},st.bezier=function(M,R,z,F,$,H){var V=1-H,G=V*V,Y=H*H,te=G*V,he=3*H*G,ce=3*Y*V,le=Y*H;return M[0]=R[0]*te+z[0]*he+F[0]*ce+$[0]*le,M[1]=R[1]*te+z[1]*he+F[1]*ce+$[1]*le,M[2]=R[2]*te+z[2]*he+F[2]*ce+$[2]*le,M},st.random=function(M,R){R=R||1;var z=2*e.RANDOM()*Math.PI,F=2*e.RANDOM()-1,$=Math.sqrt(1-F*F)*R;return M[0]=Math.cos(z)*$,M[1]=Math.sin(z)*$,M[2]=F*R,M},st.transformMat4=function(M,R,z){var F=R[0],$=R[1],H=R[2],V=z[3]*F+z[7]*$+z[11]*H+z[15];return M[0]=(z[0]*F+z[4]*$+z[8]*H+z[12])/(V=V||1),M[1]=(z[1]*F+z[5]*$+z[9]*H+z[13])/V,M[2]=(z[2]*F+z[6]*$+z[10]*H+z[14])/V,M},st.transformMat3=function(M,R,z){var F=R[0],$=R[1],H=R[2];return M[0]=F*z[0]+$*z[3]+H*z[6],M[1]=F*z[1]+$*z[4]+H*z[7],M[2]=F*z[2]+$*z[5]+H*z[8],M},st.transformQuat=function(M,R,z){var F=z[0],$=z[1],H=z[2],V=R[0],G=R[1],Y=R[2],te=$*Y-H*G,he=H*V-F*Y,ce=F*G-$*V,le=$*ce-H*he,Ee=H*te-F*ce,de=F*he-$*te,Ae=2*z[3];return he*=Ae,ce*=Ae,Ee*=2,de*=2,M[0]=V+(te*=Ae)+(le*=2),M[1]=G+he+Ee,M[2]=Y+ce+de,M},st.rotateX=function(M,R,z,F){var $=[],H=[];return $[0]=R[0]-z[0],$[1]=R[1]-z[1],$[2]=R[2]-z[2],H[0]=$[0],H[1]=$[1]*Math.cos(F)-$[2]*Math.sin(F),H[2]=$[1]*Math.sin(F)+$[2]*Math.cos(F),M[0]=H[0]+z[0],M[1]=H[1]+z[1],M[2]=H[2]+z[2],M},st.rotateY=function(M,R,z,F){var $=[],H=[];return $[0]=R[0]-z[0],$[1]=R[1]-z[1],$[2]=R[2]-z[2],H[0]=$[2]*Math.sin(F)+$[0]*Math.cos(F),H[1]=$[1],H[2]=$[2]*Math.cos(F)-$[0]*Math.sin(F),M[0]=H[0]+z[0],M[1]=H[1]+z[1],M[2]=H[2]+z[2],M},st.rotateZ=function(M,R,z,F){var $=[],H=[];return $[0]=R[0]-z[0],$[1]=R[1]-z[1],$[2]=R[2]-z[2],H[0]=$[0]*Math.cos(F)-$[1]*Math.sin(F),H[1]=$[0]*Math.sin(F)+$[1]*Math.cos(F),H[2]=$[2],M[0]=H[0]+z[0],M[1]=H[1]+z[1],M[2]=H[2]+z[2],M},st.angle=function(M,R){var z=M[0],F=M[1],$=M[2],H=R[0],V=R[1],G=R[2],Y=Math.sqrt(z*z+F*F+$*$)*Math.sqrt(H*H+V*V+G*G),te=Y&&A(M,R)/Y;return Math.acos(Math.min(Math.max(te,-1),1))},st.zero=function(M){return M[0]=0,M[1]=0,M[2]=0,M},st.str=function(M){return"vec3("+M[0]+", "+M[1]+", "+M[2]+")"},st.exactEquals=function(M,R){return M[0]===R[0]&&M[1]===R[1]&&M[2]===R[2]},st.equals=function(M,R){var z=M[0],F=M[1],$=M[2],H=R[0],V=R[1],G=R[2];return Math.abs(z-H)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(H))&&Math.abs(F-V)<=e.EPSILON*Math.max(1,Math.abs(F),Math.abs(V))&&Math.abs($-G)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(G))},st.forEach=st.sqrLen=st.len=st.sqrDist=st.dist=st.div=st.mul=st.sub=void 0;var e=function(M,R){if(M&&M.__esModule)return M;if(M===null||a(M)!=="object"&&typeof M!="function")return{default:M};var z=s(void 0);if(z&&z.has(M))return z.get(M);var F={},$=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var H in M)if(H!=="default"&&Object.prototype.hasOwnProperty.call(M,H)){var V=$?Object.getOwnPropertyDescriptor(M,H):null;V&&(V.get||V.set)?Object.defineProperty(F,H,V):F[H]=M[H]}return F.default=M,z&&z.set(M,F),F}(re());function s(M){if(typeof WeakMap!="function")return null;var R=new WeakMap,z=new WeakMap;return(s=function(F){return F?z:R})(M)}function c(){var M=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0,M[2]=0),M}function p(M){return Math.hypot(M[0],M[1],M[2])}function u(M,R,z){return M[0]=R[0]-z[0],M[1]=R[1]-z[1],M[2]=R[2]-z[2],M}function m(M,R,z){return M[0]=R[0]*z[0],M[1]=R[1]*z[1],M[2]=R[2]*z[2],M}function x(M,R,z){return M[0]=R[0]/z[0],M[1]=R[1]/z[1],M[2]=R[2]/z[2],M}function S(M,R){return Math.hypot(R[0]-M[0],R[1]-M[1],R[2]-M[2])}function P(M,R){var z=R[0]-M[0],F=R[1]-M[1],$=R[2]-M[2];return z*z+F*F+$*$}function y(M){var R=M[0],z=M[1],F=M[2];return R*R+z*z+F*F}function A(M,R){return M[0]*R[0]+M[1]*R[1]+M[2]*R[2]}st.sub=u,st.mul=m,st.div=x,st.dist=S,st.sqrDist=P,st.len=p,st.sqrLen=y;var I,E=(I=c(),function(M,R,z,F,$,H){var V,G;for(R||(R=3),z||(z=0),G=F?Math.min(F*R+z,M.length):M.length,V=z;V<G;V+=R)I[0]=M[V],I[1]=M[V+1],I[2]=M[V+2],$(I,I,H),M[V]=I[0],M[V+1]=I[1],M[V+2]=I[2];return M});return st.forEach=E,st}var At,ni,Tt={};function kt(){if(At)return Tt;function a(E){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},a(E)}At=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.create=c,Tt.clone=function(E){var M=new e.ARRAY_TYPE(4);return M[0]=E[0],M[1]=E[1],M[2]=E[2],M[3]=E[3],M},Tt.fromValues=function(E,M,R,z){var F=new e.ARRAY_TYPE(4);return F[0]=E,F[1]=M,F[2]=R,F[3]=z,F},Tt.copy=function(E,M){return E[0]=M[0],E[1]=M[1],E[2]=M[2],E[3]=M[3],E},Tt.set=function(E,M,R,z,F){return E[0]=M,E[1]=R,E[2]=z,E[3]=F,E},Tt.add=function(E,M,R){return E[0]=M[0]+R[0],E[1]=M[1]+R[1],E[2]=M[2]+R[2],E[3]=M[3]+R[3],E},Tt.subtract=p,Tt.multiply=u,Tt.divide=m,Tt.ceil=function(E,M){return E[0]=Math.ceil(M[0]),E[1]=Math.ceil(M[1]),E[2]=Math.ceil(M[2]),E[3]=Math.ceil(M[3]),E},Tt.floor=function(E,M){return E[0]=Math.floor(M[0]),E[1]=Math.floor(M[1]),E[2]=Math.floor(M[2]),E[3]=Math.floor(M[3]),E},Tt.min=function(E,M,R){return E[0]=Math.min(M[0],R[0]),E[1]=Math.min(M[1],R[1]),E[2]=Math.min(M[2],R[2]),E[3]=Math.min(M[3],R[3]),E},Tt.max=function(E,M,R){return E[0]=Math.max(M[0],R[0]),E[1]=Math.max(M[1],R[1]),E[2]=Math.max(M[2],R[2]),E[3]=Math.max(M[3],R[3]),E},Tt.round=function(E,M){return E[0]=Math.round(M[0]),E[1]=Math.round(M[1]),E[2]=Math.round(M[2]),E[3]=Math.round(M[3]),E},Tt.scale=function(E,M,R){return E[0]=M[0]*R,E[1]=M[1]*R,E[2]=M[2]*R,E[3]=M[3]*R,E},Tt.scaleAndAdd=function(E,M,R,z){return E[0]=M[0]+R[0]*z,E[1]=M[1]+R[1]*z,E[2]=M[2]+R[2]*z,E[3]=M[3]+R[3]*z,E},Tt.distance=x,Tt.squaredDistance=S,Tt.length=P,Tt.squaredLength=y,Tt.negate=function(E,M){return E[0]=-M[0],E[1]=-M[1],E[2]=-M[2],E[3]=-M[3],E},Tt.inverse=function(E,M){return E[0]=1/M[0],E[1]=1/M[1],E[2]=1/M[2],E[3]=1/M[3],E},Tt.normalize=function(E,M){var R=M[0],z=M[1],F=M[2],$=M[3],H=R*R+z*z+F*F+$*$;return H>0&&(H=1/Math.sqrt(H)),E[0]=R*H,E[1]=z*H,E[2]=F*H,E[3]=$*H,E},Tt.dot=function(E,M){return E[0]*M[0]+E[1]*M[1]+E[2]*M[2]+E[3]*M[3]},Tt.cross=function(E,M,R,z){var F=R[0]*z[1]-R[1]*z[0],$=R[0]*z[2]-R[2]*z[0],H=R[0]*z[3]-R[3]*z[0],V=R[1]*z[2]-R[2]*z[1],G=R[1]*z[3]-R[3]*z[1],Y=R[2]*z[3]-R[3]*z[2],te=M[0],he=M[1],ce=M[2],le=M[3];return E[0]=he*Y-ce*G+le*V,E[1]=-te*Y+ce*H-le*$,E[2]=te*G-he*H+le*F,E[3]=-te*V+he*$-ce*F,E},Tt.lerp=function(E,M,R,z){var F=M[0],$=M[1],H=M[2],V=M[3];return E[0]=F+z*(R[0]-F),E[1]=$+z*(R[1]-$),E[2]=H+z*(R[2]-H),E[3]=V+z*(R[3]-V),E},Tt.random=function(E,M){var R,z,F,$,H,V;M=M||1;do H=(R=2*e.RANDOM()-1)*R+(z=2*e.RANDOM()-1)*z;while(H>=1);do V=(F=2*e.RANDOM()-1)*F+($=2*e.RANDOM()-1)*$;while(V>=1);var G=Math.sqrt((1-H)/V);return E[0]=M*R,E[1]=M*z,E[2]=M*F*G,E[3]=M*$*G,E},Tt.transformMat4=function(E,M,R){var z=M[0],F=M[1],$=M[2],H=M[3];return E[0]=R[0]*z+R[4]*F+R[8]*$+R[12]*H,E[1]=R[1]*z+R[5]*F+R[9]*$+R[13]*H,E[2]=R[2]*z+R[6]*F+R[10]*$+R[14]*H,E[3]=R[3]*z+R[7]*F+R[11]*$+R[15]*H,E},Tt.transformQuat=function(E,M,R){var z=M[0],F=M[1],$=M[2],H=R[0],V=R[1],G=R[2],Y=R[3],te=Y*z+V*$-G*F,he=Y*F+G*z-H*$,ce=Y*$+H*F-V*z,le=-H*z-V*F-G*$;return E[0]=te*Y+le*-H+he*-G-ce*-V,E[1]=he*Y+le*-V+ce*-H-te*-G,E[2]=ce*Y+le*-G+te*-V-he*-H,E[3]=M[3],E},Tt.zero=function(E){return E[0]=0,E[1]=0,E[2]=0,E[3]=0,E},Tt.str=function(E){return"vec4("+E[0]+", "+E[1]+", "+E[2]+", "+E[3]+")"},Tt.exactEquals=function(E,M){return E[0]===M[0]&&E[1]===M[1]&&E[2]===M[2]&&E[3]===M[3]},Tt.equals=function(E,M){var R=E[0],z=E[1],F=E[2],$=E[3],H=M[0],V=M[1],G=M[2],Y=M[3];return Math.abs(R-H)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(H))&&Math.abs(z-V)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(V))&&Math.abs(F-G)<=e.EPSILON*Math.max(1,Math.abs(F),Math.abs(G))&&Math.abs($-Y)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(Y))},Tt.forEach=Tt.sqrLen=Tt.len=Tt.sqrDist=Tt.dist=Tt.div=Tt.mul=Tt.sub=void 0;var e=function(E,M){if(E&&E.__esModule)return E;if(E===null||a(E)!=="object"&&typeof E!="function")return{default:E};var R=s(void 0);if(R&&R.has(E))return R.get(E);var z={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var $ in E)if($!=="default"&&Object.prototype.hasOwnProperty.call(E,$)){var H=F?Object.getOwnPropertyDescriptor(E,$):null;H&&(H.get||H.set)?Object.defineProperty(z,$,H):z[$]=E[$]}return z.default=E,R&&R.set(E,z),z}(re());function s(E){if(typeof WeakMap!="function")return null;var M=new WeakMap,R=new WeakMap;return(s=function(z){return z?R:M})(E)}function c(){var E=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(E[0]=0,E[1]=0,E[2]=0,E[3]=0),E}function p(E,M,R){return E[0]=M[0]-R[0],E[1]=M[1]-R[1],E[2]=M[2]-R[2],E[3]=M[3]-R[3],E}function u(E,M,R){return E[0]=M[0]*R[0],E[1]=M[1]*R[1],E[2]=M[2]*R[2],E[3]=M[3]*R[3],E}function m(E,M,R){return E[0]=M[0]/R[0],E[1]=M[1]/R[1],E[2]=M[2]/R[2],E[3]=M[3]/R[3],E}function x(E,M){return Math.hypot(M[0]-E[0],M[1]-E[1],M[2]-E[2],M[3]-E[3])}function S(E,M){var R=M[0]-E[0],z=M[1]-E[1],F=M[2]-E[2],$=M[3]-E[3];return R*R+z*z+F*F+$*$}function P(E){return Math.hypot(E[0],E[1],E[2],E[3])}function y(E){var M=E[0],R=E[1],z=E[2],F=E[3];return M*M+R*R+z*z+F*F}Tt.sub=p,Tt.mul=u,Tt.div=m,Tt.dist=x,Tt.sqrDist=S,Tt.len=P,Tt.sqrLen=y;var A,I=(A=c(),function(E,M,R,z,F,$){var H,V;for(M||(M=4),R||(R=0),V=z?Math.min(z*M+R,E.length):E.length,H=R;H<V;H+=M)A[0]=E[H],A[1]=E[H+1],A[2]=E[H+2],A[3]=E[H+3],F(A,A,$),E[H]=A[0],E[H+1]=A[1],E[H+2]=A[2],E[H+3]=A[3];return E});return Tt.forEach=I,Tt}function ti(){if(ni)return He;function a(de){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Ae){return typeof Ae}:function(Ae){return Ae&&typeof Symbol=="function"&&Ae.constructor===Symbol&&Ae!==Symbol.prototype?"symbol":typeof Ae},a(de)}ni=1,Object.defineProperty(He,"__esModule",{value:!0}),He.create=x,He.identity=function(de){return de[0]=0,de[1]=0,de[2]=0,de[3]=1,de},He.setAxisAngle=S,He.getAxisAngle=function(de,Ae){var Pe=2*Math.acos(Ae[3]),Ce=Math.sin(Pe/2);return Ce>e.EPSILON?(de[0]=Ae[0]/Ce,de[1]=Ae[1]/Ce,de[2]=Ae[2]/Ce):(de[0]=1,de[1]=0,de[2]=0),Pe},He.getAngle=function(de,Ae){var Pe=R(de,Ae);return Math.acos(2*Pe*Pe-1)},He.multiply=P,He.rotateX=function(de,Ae,Pe){Pe*=.5;var Ce=Ae[0],ze=Ae[1],Ne=Ae[2],Ge=Ae[3],Fe=Math.sin(Pe),at=Math.cos(Pe);return de[0]=Ce*at+Ge*Fe,de[1]=ze*at+Ne*Fe,de[2]=Ne*at-ze*Fe,de[3]=Ge*at-Ce*Fe,de},He.rotateY=function(de,Ae,Pe){Pe*=.5;var Ce=Ae[0],ze=Ae[1],Ne=Ae[2],Ge=Ae[3],Fe=Math.sin(Pe),at=Math.cos(Pe);return de[0]=Ce*at-Ne*Fe,de[1]=ze*at+Ge*Fe,de[2]=Ne*at+Ce*Fe,de[3]=Ge*at-ze*Fe,de},He.rotateZ=function(de,Ae,Pe){Pe*=.5;var Ce=Ae[0],ze=Ae[1],Ne=Ae[2],Ge=Ae[3],Fe=Math.sin(Pe),at=Math.cos(Pe);return de[0]=Ce*at+ze*Fe,de[1]=ze*at-Ce*Fe,de[2]=Ne*at+Ge*Fe,de[3]=Ge*at-Ne*Fe,de},He.calculateW=function(de,Ae){var Pe=Ae[0],Ce=Ae[1],ze=Ae[2];return de[0]=Pe,de[1]=Ce,de[2]=ze,de[3]=Math.sqrt(Math.abs(1-Pe*Pe-Ce*Ce-ze*ze)),de},He.exp=y,He.ln=A,He.pow=function(de,Ae,Pe){return A(de,Ae),M(de,de,Pe),y(de,de),de},He.slerp=I,He.random=function(de){var Ae=e.RANDOM(),Pe=e.RANDOM(),Ce=e.RANDOM(),ze=Math.sqrt(1-Ae),Ne=Math.sqrt(Ae);return de[0]=ze*Math.sin(2*Math.PI*Pe),de[1]=ze*Math.cos(2*Math.PI*Pe),de[2]=Ne*Math.sin(2*Math.PI*Ce),de[3]=Ne*Math.cos(2*Math.PI*Ce),de},He.invert=function(de,Ae){var Pe=Ae[0],Ce=Ae[1],ze=Ae[2],Ne=Ae[3],Ge=Pe*Pe+Ce*Ce+ze*ze+Ne*Ne,Fe=Ge?1/Ge:0;return de[0]=-Pe*Fe,de[1]=-Ce*Fe,de[2]=-ze*Fe,de[3]=Ne*Fe,de},He.conjugate=function(de,Ae){return de[0]=-Ae[0],de[1]=-Ae[1],de[2]=-Ae[2],de[3]=Ae[3],de},He.fromMat3=E,He.fromEuler=function(de,Ae,Pe,Ce){var ze=.5*Math.PI/180;Ae*=ze,Pe*=ze,Ce*=ze;var Ne=Math.sin(Ae),Ge=Math.cos(Ae),Fe=Math.sin(Pe),at=Math.cos(Pe),mt=Math.sin(Ce),ot=Math.cos(Ce);return de[0]=Ne*at*ot-Ge*Fe*mt,de[1]=Ge*Fe*ot+Ne*at*mt,de[2]=Ge*at*mt-Ne*Fe*ot,de[3]=Ge*at*ot+Ne*Fe*mt,de},He.str=function(de){return"quat("+de[0]+", "+de[1]+", "+de[2]+", "+de[3]+")"},He.setAxes=He.sqlerp=He.rotationTo=He.equals=He.exactEquals=He.normalize=He.sqrLen=He.squaredLength=He.len=He.length=He.lerp=He.dot=He.scale=He.mul=He.add=He.set=He.copy=He.fromValues=He.clone=void 0;var e=m(re()),s=m(Ie()),c=m(dt()),p=m(kt());function u(de){if(typeof WeakMap!="function")return null;var Ae=new WeakMap,Pe=new WeakMap;return(u=function(Ce){return Ce?Pe:Ae})(de)}function m(de,Ae){if(de&&de.__esModule)return de;if(de===null||a(de)!=="object"&&typeof de!="function")return{default:de};var Pe=u(Ae);if(Pe&&Pe.has(de))return Pe.get(de);var Ce={},ze=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Ne in de)if(Ne!=="default"&&Object.prototype.hasOwnProperty.call(de,Ne)){var Ge=ze?Object.getOwnPropertyDescriptor(de,Ne):null;Ge&&(Ge.get||Ge.set)?Object.defineProperty(Ce,Ne,Ge):Ce[Ne]=de[Ne]}return Ce.default=de,Pe&&Pe.set(de,Ce),Ce}function x(){var de=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(de[0]=0,de[1]=0,de[2]=0),de[3]=1,de}function S(de,Ae,Pe){Pe*=.5;var Ce=Math.sin(Pe);return de[0]=Ce*Ae[0],de[1]=Ce*Ae[1],de[2]=Ce*Ae[2],de[3]=Math.cos(Pe),de}function P(de,Ae,Pe){var Ce=Ae[0],ze=Ae[1],Ne=Ae[2],Ge=Ae[3],Fe=Pe[0],at=Pe[1],mt=Pe[2],ot=Pe[3];return de[0]=Ce*ot+Ge*Fe+ze*mt-Ne*at,de[1]=ze*ot+Ge*at+Ne*Fe-Ce*mt,de[2]=Ne*ot+Ge*mt+Ce*at-ze*Fe,de[3]=Ge*ot-Ce*Fe-ze*at-Ne*mt,de}function y(de,Ae){var Pe=Ae[0],Ce=Ae[1],ze=Ae[2],Ne=Ae[3],Ge=Math.sqrt(Pe*Pe+Ce*Ce+ze*ze),Fe=Math.exp(Ne),at=Ge>0?Fe*Math.sin(Ge)/Ge:0;return de[0]=Pe*at,de[1]=Ce*at,de[2]=ze*at,de[3]=Fe*Math.cos(Ge),de}function A(de,Ae){var Pe=Ae[0],Ce=Ae[1],ze=Ae[2],Ne=Ae[3],Ge=Math.sqrt(Pe*Pe+Ce*Ce+ze*ze),Fe=Ge>0?Math.atan2(Ge,Ne)/Ge:0;return de[0]=Pe*Fe,de[1]=Ce*Fe,de[2]=ze*Fe,de[3]=.5*Math.log(Pe*Pe+Ce*Ce+ze*ze+Ne*Ne),de}function I(de,Ae,Pe,Ce){var ze,Ne,Ge,Fe,at,mt=Ae[0],ot=Ae[1],zt=Ae[2],Rt=Ae[3],xt=Pe[0],_t=Pe[1],Yt=Pe[2],Ft=Pe[3];return(Ne=mt*xt+ot*_t+zt*Yt+Rt*Ft)<0&&(Ne=-Ne,xt=-xt,_t=-_t,Yt=-Yt,Ft=-Ft),1-Ne>e.EPSILON?(ze=Math.acos(Ne),Ge=Math.sin(ze),Fe=Math.sin((1-Ce)*ze)/Ge,at=Math.sin(Ce*ze)/Ge):(Fe=1-Ce,at=Ce),de[0]=Fe*mt+at*xt,de[1]=Fe*ot+at*_t,de[2]=Fe*zt+at*Yt,de[3]=Fe*Rt+at*Ft,de}function E(de,Ae){var Pe,Ce=Ae[0]+Ae[4]+Ae[8];if(Ce>0)Pe=Math.sqrt(Ce+1),de[3]=.5*Pe,de[0]=(Ae[5]-Ae[7])*(Pe=.5/Pe),de[1]=(Ae[6]-Ae[2])*Pe,de[2]=(Ae[1]-Ae[3])*Pe;else{var ze=0;Ae[4]>Ae[0]&&(ze=1),Ae[8]>Ae[3*ze+ze]&&(ze=2);var Ne=(ze+1)%3,Ge=(ze+2)%3;Pe=Math.sqrt(Ae[3*ze+ze]-Ae[3*Ne+Ne]-Ae[3*Ge+Ge]+1),de[ze]=.5*Pe,de[3]=(Ae[3*Ne+Ge]-Ae[3*Ge+Ne])*(Pe=.5/Pe),de[Ne]=(Ae[3*Ne+ze]+Ae[3*ze+Ne])*Pe,de[Ge]=(Ae[3*Ge+ze]+Ae[3*ze+Ge])*Pe}return de}He.clone=p.clone,He.fromValues=p.fromValues,He.copy=p.copy,He.set=p.set,He.add=p.add,He.mul=P;var M=p.scale;He.scale=M;var R=p.dot;He.dot=R,He.lerp=p.lerp;var z=p.length;He.length=z,He.len=z;var F=p.squaredLength;He.squaredLength=F,He.sqrLen=F;var $=p.normalize;He.normalize=$,He.exactEquals=p.exactEquals,He.equals=p.equals;var H,V,G,Y=(H=c.create(),V=c.fromValues(1,0,0),G=c.fromValues(0,1,0),function(de,Ae,Pe){var Ce=c.dot(Ae,Pe);return Ce<-.999999?(c.cross(H,V,Ae),c.len(H)<1e-6&&c.cross(H,G,Ae),c.normalize(H,H),S(de,H,Math.PI),de):Ce>.999999?(de[0]=0,de[1]=0,de[2]=0,de[3]=1,de):(c.cross(H,Ae,Pe),de[0]=H[0],de[1]=H[1],de[2]=H[2],de[3]=1+Ce,$(de,de))});He.rotationTo=Y;var te,he,ce=(te=x(),he=x(),function(de,Ae,Pe,Ce,ze,Ne){return I(te,Ae,ze,Ne),I(he,Pe,Ce,Ne),I(de,te,he,2*Ne*(1-Ne)),de});He.sqlerp=ce;var le,Ee=(le=s.create(),function(de,Ae,Pe,Ce){return le[0]=Pe[0],le[3]=Pe[1],le[6]=Pe[2],le[1]=Ce[0],le[4]=Ce[1],le[7]=Ce[2],le[2]=-Ae[0],le[5]=-Ae[1],le[8]=-Ae[2],$(de,E(de,le))});return He.setAxes=Ee,He}var li,ii={};function Pn(){if(li)return ii;function a(I){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},a(I)}li=1,Object.defineProperty(ii,"__esModule",{value:!0}),ii.create=function(){var I=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(I[0]=0,I[1]=0,I[2]=0,I[4]=0,I[5]=0,I[6]=0,I[7]=0),I[3]=1,I},ii.clone=function(I){var E=new e.ARRAY_TYPE(8);return E[0]=I[0],E[1]=I[1],E[2]=I[2],E[3]=I[3],E[4]=I[4],E[5]=I[5],E[6]=I[6],E[7]=I[7],E},ii.fromValues=function(I,E,M,R,z,F,$,H){var V=new e.ARRAY_TYPE(8);return V[0]=I,V[1]=E,V[2]=M,V[3]=R,V[4]=z,V[5]=F,V[6]=$,V[7]=H,V},ii.fromRotationTranslationValues=function(I,E,M,R,z,F,$){var H=new e.ARRAY_TYPE(8);H[0]=I,H[1]=E,H[2]=M,H[3]=R;var V=.5*z,G=.5*F,Y=.5*$;return H[4]=V*R+G*M-Y*E,H[5]=G*R+Y*I-V*M,H[6]=Y*R+V*E-G*I,H[7]=-V*I-G*E-Y*M,H},ii.fromRotationTranslation=m,ii.fromTranslation=function(I,E){return I[0]=0,I[1]=0,I[2]=0,I[3]=1,I[4]=.5*E[0],I[5]=.5*E[1],I[6]=.5*E[2],I[7]=0,I},ii.fromRotation=function(I,E){return I[0]=E[0],I[1]=E[1],I[2]=E[2],I[3]=E[3],I[4]=0,I[5]=0,I[6]=0,I[7]=0,I},ii.fromMat4=function(I,E){var M=s.create();c.getRotation(M,E);var R=new e.ARRAY_TYPE(3);return c.getTranslation(R,E),m(I,M,R),I},ii.copy=x,ii.identity=function(I){return I[0]=0,I[1]=0,I[2]=0,I[3]=1,I[4]=0,I[5]=0,I[6]=0,I[7]=0,I},ii.set=function(I,E,M,R,z,F,$,H,V){return I[0]=E,I[1]=M,I[2]=R,I[3]=z,I[4]=F,I[5]=$,I[6]=H,I[7]=V,I},ii.getDual=function(I,E){return I[0]=E[4],I[1]=E[5],I[2]=E[6],I[3]=E[7],I},ii.setDual=function(I,E){return I[4]=E[0],I[5]=E[1],I[6]=E[2],I[7]=E[3],I},ii.getTranslation=function(I,E){var M=E[4],R=E[5],z=E[6],F=E[7],$=-E[0],H=-E[1],V=-E[2],G=E[3];return I[0]=2*(M*G+F*$+R*V-z*H),I[1]=2*(R*G+F*H+z*$-M*V),I[2]=2*(z*G+F*V+M*H-R*$),I},ii.translate=function(I,E,M){var R=E[0],z=E[1],F=E[2],$=E[3],H=.5*M[0],V=.5*M[1],G=.5*M[2],Y=E[4],te=E[5],he=E[6],ce=E[7];return I[0]=R,I[1]=z,I[2]=F,I[3]=$,I[4]=$*H+z*G-F*V+Y,I[5]=$*V+F*H-R*G+te,I[6]=$*G+R*V-z*H+he,I[7]=-R*H-z*V-F*G+ce,I},ii.rotateX=function(I,E,M){var R=-E[0],z=-E[1],F=-E[2],$=E[3],H=E[4],V=E[5],G=E[6],Y=E[7],te=H*$+Y*R+V*F-G*z,he=V*$+Y*z+G*R-H*F,ce=G*$+Y*F+H*z-V*R,le=Y*$-H*R-V*z-G*F;return s.rotateX(I,E,M),I[4]=te*($=I[3])+le*(R=I[0])+he*(F=I[2])-ce*(z=I[1]),I[5]=he*$+le*z+ce*R-te*F,I[6]=ce*$+le*F+te*z-he*R,I[7]=le*$-te*R-he*z-ce*F,I},ii.rotateY=function(I,E,M){var R=-E[0],z=-E[1],F=-E[2],$=E[3],H=E[4],V=E[5],G=E[6],Y=E[7],te=H*$+Y*R+V*F-G*z,he=V*$+Y*z+G*R-H*F,ce=G*$+Y*F+H*z-V*R,le=Y*$-H*R-V*z-G*F;return s.rotateY(I,E,M),I[4]=te*($=I[3])+le*(R=I[0])+he*(F=I[2])-ce*(z=I[1]),I[5]=he*$+le*z+ce*R-te*F,I[6]=ce*$+le*F+te*z-he*R,I[7]=le*$-te*R-he*z-ce*F,I},ii.rotateZ=function(I,E,M){var R=-E[0],z=-E[1],F=-E[2],$=E[3],H=E[4],V=E[5],G=E[6],Y=E[7],te=H*$+Y*R+V*F-G*z,he=V*$+Y*z+G*R-H*F,ce=G*$+Y*F+H*z-V*R,le=Y*$-H*R-V*z-G*F;return s.rotateZ(I,E,M),I[4]=te*($=I[3])+le*(R=I[0])+he*(F=I[2])-ce*(z=I[1]),I[5]=he*$+le*z+ce*R-te*F,I[6]=ce*$+le*F+te*z-he*R,I[7]=le*$-te*R-he*z-ce*F,I},ii.rotateByQuatAppend=function(I,E,M){var R=M[0],z=M[1],F=M[2],$=M[3],H=E[0],V=E[1],G=E[2],Y=E[3];return I[0]=H*$+Y*R+V*F-G*z,I[1]=V*$+Y*z+G*R-H*F,I[2]=G*$+Y*F+H*z-V*R,I[3]=Y*$-H*R-V*z-G*F,I[4]=(H=E[4])*$+(Y=E[7])*R+(V=E[5])*F-(G=E[6])*z,I[5]=V*$+Y*z+G*R-H*F,I[6]=G*$+Y*F+H*z-V*R,I[7]=Y*$-H*R-V*z-G*F,I},ii.rotateByQuatPrepend=function(I,E,M){var R=E[0],z=E[1],F=E[2],$=E[3],H=M[0],V=M[1],G=M[2],Y=M[3];return I[0]=R*Y+$*H+z*G-F*V,I[1]=z*Y+$*V+F*H-R*G,I[2]=F*Y+$*G+R*V-z*H,I[3]=$*Y-R*H-z*V-F*G,I[4]=R*(Y=M[7])+$*(H=M[4])+z*(G=M[6])-F*(V=M[5]),I[5]=z*Y+$*V+F*H-R*G,I[6]=F*Y+$*G+R*V-z*H,I[7]=$*Y-R*H-z*V-F*G,I},ii.rotateAroundAxis=function(I,E,M,R){if(Math.abs(R)<e.EPSILON)return x(I,E);var z=Math.hypot(M[0],M[1],M[2]);R*=.5;var F=Math.sin(R),$=F*M[0]/z,H=F*M[1]/z,V=F*M[2]/z,G=Math.cos(R),Y=E[0],te=E[1],he=E[2],ce=E[3];I[0]=Y*G+ce*$+te*V-he*H,I[1]=te*G+ce*H+he*$-Y*V,I[2]=he*G+ce*V+Y*H-te*$,I[3]=ce*G-Y*$-te*H-he*V;var le=E[4],Ee=E[5],de=E[6],Ae=E[7];return I[4]=le*G+Ae*$+Ee*V-de*H,I[5]=Ee*G+Ae*H+de*$-le*V,I[6]=de*G+Ae*V+le*H-Ee*$,I[7]=Ae*G-le*$-Ee*H-de*V,I},ii.add=function(I,E,M){return I[0]=E[0]+M[0],I[1]=E[1]+M[1],I[2]=E[2]+M[2],I[3]=E[3]+M[3],I[4]=E[4]+M[4],I[5]=E[5]+M[5],I[6]=E[6]+M[6],I[7]=E[7]+M[7],I},ii.multiply=S,ii.scale=function(I,E,M){return I[0]=E[0]*M,I[1]=E[1]*M,I[2]=E[2]*M,I[3]=E[3]*M,I[4]=E[4]*M,I[5]=E[5]*M,I[6]=E[6]*M,I[7]=E[7]*M,I},ii.lerp=function(I,E,M,R){var z=1-R;return P(E,M)<0&&(R=-R),I[0]=E[0]*z+M[0]*R,I[1]=E[1]*z+M[1]*R,I[2]=E[2]*z+M[2]*R,I[3]=E[3]*z+M[3]*R,I[4]=E[4]*z+M[4]*R,I[5]=E[5]*z+M[5]*R,I[6]=E[6]*z+M[6]*R,I[7]=E[7]*z+M[7]*R,I},ii.invert=function(I,E){var M=A(E);return I[0]=-E[0]/M,I[1]=-E[1]/M,I[2]=-E[2]/M,I[3]=E[3]/M,I[4]=-E[4]/M,I[5]=-E[5]/M,I[6]=-E[6]/M,I[7]=E[7]/M,I},ii.conjugate=function(I,E){return I[0]=-E[0],I[1]=-E[1],I[2]=-E[2],I[3]=E[3],I[4]=-E[4],I[5]=-E[5],I[6]=-E[6],I[7]=E[7],I},ii.normalize=function(I,E){var M=A(E);if(M>0){M=Math.sqrt(M);var R=E[0]/M,z=E[1]/M,F=E[2]/M,$=E[3]/M,H=E[4],V=E[5],G=E[6],Y=E[7],te=R*H+z*V+F*G+$*Y;I[0]=R,I[1]=z,I[2]=F,I[3]=$,I[4]=(H-R*te)/M,I[5]=(V-z*te)/M,I[6]=(G-F*te)/M,I[7]=(Y-$*te)/M}return I},ii.str=function(I){return"quat2("+I[0]+", "+I[1]+", "+I[2]+", "+I[3]+", "+I[4]+", "+I[5]+", "+I[6]+", "+I[7]+")"},ii.exactEquals=function(I,E){return I[0]===E[0]&&I[1]===E[1]&&I[2]===E[2]&&I[3]===E[3]&&I[4]===E[4]&&I[5]===E[5]&&I[6]===E[6]&&I[7]===E[7]},ii.equals=function(I,E){var M=I[0],R=I[1],z=I[2],F=I[3],$=I[4],H=I[5],V=I[6],G=I[7],Y=E[0],te=E[1],he=E[2],ce=E[3],le=E[4],Ee=E[5],de=E[6],Ae=E[7];return Math.abs(M-Y)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(Y))&&Math.abs(R-te)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(te))&&Math.abs(z-he)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(he))&&Math.abs(F-ce)<=e.EPSILON*Math.max(1,Math.abs(F),Math.abs(ce))&&Math.abs($-le)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(le))&&Math.abs(H-Ee)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(Ee))&&Math.abs(V-de)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(de))&&Math.abs(G-Ae)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(Ae))},ii.sqrLen=ii.squaredLength=ii.len=ii.length=ii.dot=ii.mul=ii.setReal=ii.getReal=void 0;var e=u(re()),s=u(ti()),c=u(rt());function p(I){if(typeof WeakMap!="function")return null;var E=new WeakMap,M=new WeakMap;return(p=function(R){return R?M:E})(I)}function u(I,E){if(I&&I.__esModule)return I;if(I===null||a(I)!=="object"&&typeof I!="function")return{default:I};var M=p(E);if(M&&M.has(I))return M.get(I);var R={},z=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var F in I)if(F!=="default"&&Object.prototype.hasOwnProperty.call(I,F)){var $=z?Object.getOwnPropertyDescriptor(I,F):null;$&&($.get||$.set)?Object.defineProperty(R,F,$):R[F]=I[F]}return R.default=I,M&&M.set(I,R),R}function m(I,E,M){var R=.5*M[0],z=.5*M[1],F=.5*M[2],$=E[0],H=E[1],V=E[2],G=E[3];return I[0]=$,I[1]=H,I[2]=V,I[3]=G,I[4]=R*G+z*V-F*H,I[5]=z*G+F*$-R*V,I[6]=F*G+R*H-z*$,I[7]=-R*$-z*H-F*V,I}function x(I,E){return I[0]=E[0],I[1]=E[1],I[2]=E[2],I[3]=E[3],I[4]=E[4],I[5]=E[5],I[6]=E[6],I[7]=E[7],I}function S(I,E,M){var R=E[0],z=E[1],F=E[2],$=E[3],H=M[4],V=M[5],G=M[6],Y=M[7],te=E[4],he=E[5],ce=E[6],le=E[7],Ee=M[0],de=M[1],Ae=M[2],Pe=M[3];return I[0]=R*Pe+$*Ee+z*Ae-F*de,I[1]=z*Pe+$*de+F*Ee-R*Ae,I[2]=F*Pe+$*Ae+R*de-z*Ee,I[3]=$*Pe-R*Ee-z*de-F*Ae,I[4]=R*Y+$*H+z*G-F*V+te*Pe+le*Ee+he*Ae-ce*de,I[5]=z*Y+$*V+F*H-R*G+he*Pe+le*de+ce*Ee-te*Ae,I[6]=F*Y+$*G+R*V-z*H+ce*Pe+le*Ae+te*de-he*Ee,I[7]=$*Y-R*H-z*V-F*G+le*Pe-te*Ee-he*de-ce*Ae,I}ii.getReal=s.copy,ii.setReal=s.copy,ii.mul=S;var P=s.dot;ii.dot=P;var y=s.length;ii.length=y,ii.len=y;var A=s.squaredLength;return ii.squaredLength=A,ii.sqrLen=A,ii}var Fn,xn,_i={};function dr(){if(Fn)return _i;function a(E){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},a(E)}Fn=1,Object.defineProperty(_i,"__esModule",{value:!0}),_i.create=c,_i.clone=function(E){var M=new e.ARRAY_TYPE(2);return M[0]=E[0],M[1]=E[1],M},_i.fromValues=function(E,M){var R=new e.ARRAY_TYPE(2);return R[0]=E,R[1]=M,R},_i.copy=function(E,M){return E[0]=M[0],E[1]=M[1],E},_i.set=function(E,M,R){return E[0]=M,E[1]=R,E},_i.add=function(E,M,R){return E[0]=M[0]+R[0],E[1]=M[1]+R[1],E},_i.subtract=p,_i.multiply=u,_i.divide=m,_i.ceil=function(E,M){return E[0]=Math.ceil(M[0]),E[1]=Math.ceil(M[1]),E},_i.floor=function(E,M){return E[0]=Math.floor(M[0]),E[1]=Math.floor(M[1]),E},_i.min=function(E,M,R){return E[0]=Math.min(M[0],R[0]),E[1]=Math.min(M[1],R[1]),E},_i.max=function(E,M,R){return E[0]=Math.max(M[0],R[0]),E[1]=Math.max(M[1],R[1]),E},_i.round=function(E,M){return E[0]=Math.round(M[0]),E[1]=Math.round(M[1]),E},_i.scale=function(E,M,R){return E[0]=M[0]*R,E[1]=M[1]*R,E},_i.scaleAndAdd=function(E,M,R,z){return E[0]=M[0]+R[0]*z,E[1]=M[1]+R[1]*z,E},_i.distance=x,_i.squaredDistance=S,_i.length=P,_i.squaredLength=y,_i.negate=function(E,M){return E[0]=-M[0],E[1]=-M[1],E},_i.inverse=function(E,M){return E[0]=1/M[0],E[1]=1/M[1],E},_i.normalize=function(E,M){var R=M[0],z=M[1],F=R*R+z*z;return F>0&&(F=1/Math.sqrt(F)),E[0]=M[0]*F,E[1]=M[1]*F,E},_i.dot=function(E,M){return E[0]*M[0]+E[1]*M[1]},_i.cross=function(E,M,R){var z=M[0]*R[1]-M[1]*R[0];return E[0]=E[1]=0,E[2]=z,E},_i.lerp=function(E,M,R,z){var F=M[0],$=M[1];return E[0]=F+z*(R[0]-F),E[1]=$+z*(R[1]-$),E},_i.random=function(E,M){M=M||1;var R=2*e.RANDOM()*Math.PI;return E[0]=Math.cos(R)*M,E[1]=Math.sin(R)*M,E},_i.transformMat2=function(E,M,R){var z=M[0],F=M[1];return E[0]=R[0]*z+R[2]*F,E[1]=R[1]*z+R[3]*F,E},_i.transformMat2d=function(E,M,R){var z=M[0],F=M[1];return E[0]=R[0]*z+R[2]*F+R[4],E[1]=R[1]*z+R[3]*F+R[5],E},_i.transformMat3=function(E,M,R){var z=M[0],F=M[1];return E[0]=R[0]*z+R[3]*F+R[6],E[1]=R[1]*z+R[4]*F+R[7],E},_i.transformMat4=function(E,M,R){var z=M[0],F=M[1];return E[0]=R[0]*z+R[4]*F+R[12],E[1]=R[1]*z+R[5]*F+R[13],E},_i.rotate=function(E,M,R,z){var F=M[0]-R[0],$=M[1]-R[1],H=Math.sin(z),V=Math.cos(z);return E[0]=F*V-$*H+R[0],E[1]=F*H+$*V+R[1],E},_i.angle=function(E,M){var R=E[0],z=E[1],F=M[0],$=M[1],H=Math.sqrt(R*R+z*z)*Math.sqrt(F*F+$*$);return Math.acos(Math.min(Math.max(H&&(R*F+z*$)/H,-1),1))},_i.zero=function(E){return E[0]=0,E[1]=0,E},_i.str=function(E){return"vec2("+E[0]+", "+E[1]+")"},_i.exactEquals=function(E,M){return E[0]===M[0]&&E[1]===M[1]},_i.equals=function(E,M){var R=E[0],z=E[1],F=M[0],$=M[1];return Math.abs(R-F)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(F))&&Math.abs(z-$)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs($))},_i.forEach=_i.sqrLen=_i.sqrDist=_i.dist=_i.div=_i.mul=_i.sub=_i.len=void 0;var e=function(E,M){if(E&&E.__esModule)return E;if(E===null||a(E)!=="object"&&typeof E!="function")return{default:E};var R=s(void 0);if(R&&R.has(E))return R.get(E);var z={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var $ in E)if($!=="default"&&Object.prototype.hasOwnProperty.call(E,$)){var H=F?Object.getOwnPropertyDescriptor(E,$):null;H&&(H.get||H.set)?Object.defineProperty(z,$,H):z[$]=E[$]}return z.default=E,R&&R.set(E,z),z}(re());function s(E){if(typeof WeakMap!="function")return null;var M=new WeakMap,R=new WeakMap;return(s=function(z){return z?R:M})(E)}function c(){var E=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(E[0]=0,E[1]=0),E}function p(E,M,R){return E[0]=M[0]-R[0],E[1]=M[1]-R[1],E}function u(E,M,R){return E[0]=M[0]*R[0],E[1]=M[1]*R[1],E}function m(E,M,R){return E[0]=M[0]/R[0],E[1]=M[1]/R[1],E}function x(E,M){return Math.hypot(M[0]-E[0],M[1]-E[1])}function S(E,M){var R=M[0]-E[0],z=M[1]-E[1];return R*R+z*z}function P(E){return Math.hypot(E[0],E[1])}function y(E){var M=E[0],R=E[1];return M*M+R*R}_i.len=P,_i.sub=p,_i.mul=u,_i.div=m,_i.dist=x,_i.sqrDist=S,_i.sqrLen=y;var A,I=(A=c(),function(E,M,R,z,F,$){var H,V;for(M||(M=2),R||(R=0),V=z?Math.min(z*M+R,E.length):E.length,H=R;H<V;H+=M)A[0]=E[H],A[1]=E[H+1],F(A,A,$),E[H]=A[0],E[H+1]=A[1];return E});return _i.forEach=I,_i}function Wn(){if(xn)return U;function a(E){return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},a(E)}xn=1,Object.defineProperty(U,"__esModule",{value:!0}),U.vec4=U.vec3=U.vec2=U.quat2=U.quat=U.mat4=U.mat3=U.mat2d=U.mat2=U.glMatrix=void 0;var e=I(re());U.glMatrix=e;var s=I(ne());U.mat2=s;var c=I(Be());U.mat2d=c;var p=I(Ie());U.mat3=p;var u=I(rt());U.mat4=u;var m=I(ti());U.quat=m;var x=I(Pn());U.quat2=x;var S=I(dr());U.vec2=S;var P=I(dt());U.vec3=P;var y=I(kt());function A(E){if(typeof WeakMap!="function")return null;var M=new WeakMap,R=new WeakMap;return(A=function(z){return z?R:M})(E)}function I(E,M){if(E&&E.__esModule)return E;if(E===null||a(E)!=="object"&&typeof E!="function")return{default:E};var R=A(M);if(R&&R.has(E))return R.get(E);var z={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var $ in E)if($!=="default"&&Object.prototype.hasOwnProperty.call(E,$)){var H=F?Object.getOwnPropertyDescriptor(E,$):null;H&&(H.get||H.set)?Object.defineProperty(z,$,H):z[$]=E[$]}return z.default=E,R&&R.set(E,z),z}return U.vec4=y,U}var Vr,hs,fr,Us,Le=Wn(),Ss=function(){if(hs)return Vr;function a(e,s,c,p){this.cx=3*e,this.bx=3*(c-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(p-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=s,this.p2x=c,this.p2y=p}return hs=1,Vr=a,a.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,s){if(s===void 0&&(s=1e-6),e<0)return 0;if(e>1)return 1;for(var c=e,p=0;p<8;p++){var u=this.sampleCurveX(c)-e;if(Math.abs(u)<s)return c;var m=this.sampleCurveDerivativeX(c);if(Math.abs(m)<1e-6)break;c-=u/m}var x=0,S=1;for(c=e,p=0;p<20&&(u=this.sampleCurveX(c),!(Math.abs(u-e)<s));p++)e>u?x=c:S=c,c=.5*(S-x)+x;return c},solve:function(e,s){return this.sampleCurveY(this.solveCurveX(e,s))}},Vr}(),ro=k(Ss);function Ze(){if(Us)return fr;function a(e,s){this.x=e,this.y=s}return Us=1,fr=a,a.prototype={clone:function(){return new a(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,s){return this.clone()._rotateAround(e,s)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var s=e.x-this.x,c=e.y-this.y;return s*s+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,s){return Math.atan2(this.x*s-this.y*e,this.x*e+this.y*s)},_matMult:function(e){var s=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=s,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var s=Math.cos(e),c=Math.sin(e),p=c*this.x+s*this.y;return this.x=s*this.x-c*this.y,this.y=p,this},_rotateAround:function(e,s){var c=Math.cos(e),p=Math.sin(e),u=s.y+p*(this.x-s.x)+c*(this.y-s.y);return this.x=s.x+c*(this.x-s.x)-p*(this.y-s.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(e){return e instanceof a?e:Array.isArray(e)?new a(e[0],e[1]):e},fr}var Se=k(Ze());function bt(a,e){if(Array.isArray(a)){if(!Array.isArray(e)||a.length!==e.length)return!1;for(let s=0;s<a.length;s++)if(!bt(a[s],e[s]))return!1;return!0}if(typeof a=="object"&&a!==null&&e!==null){if(typeof e!="object"||Object.keys(a).length!==Object.keys(e).length)return!1;for(const s in a)if(!bt(a[s],e[s]))return!1;return!0}return a===e}const Bt=Math.PI/180,Ut=180/Math.PI;function yt(a){return a*Bt}function Kt(a){return a*Ut}const Zt=[[0,0],[1,0],[1,1],[0,1]];function Jt(a){if(a<=0)return 0;if(a>=1)return 1;const e=a*a,s=e*a;return 4*(a<.5?s:3*(a-e)+s-.75)}function Ht(a,e,s,c){const p=new ro(a,e,s,c);return function(u){return p.solve(u)}}const Si=Ht(.25,.1,.25,1);function Ct(a,e,s){return Math.min(s,Math.max(e,a))}function yi(a,e,s){return(s=Ct((s-a)/(e-a),0,1))*s*(3-2*s)}function Ai(a,e,s){const c=s-e,p=((a-e)%c+c)%c+e;return p===e?s:p}function Gi(a,e,s){if(!a.length)return s(null,[]);let c=a.length;const p=new Array(a.length);let u=null;a.forEach((m,x)=>{e(m,(S,P)=>{S&&(u=S),p[x]=P,--c==0&&s(u,p)})})}function Wi(a,...e){for(const s of e)for(const c in s)a[c]=s[c];return a}let un=1;function xr(){return un++}function sr(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function Ur(a,e){a.forEach(s=>{e[s]&&(e[s]=e[s].bind(e))})}function Rn(a,e){return a.indexOf(e,a.length-e.length)!==-1}function so(a,e,s){const c={};for(const p in a)c[p]=e.call(this,a[p],p,a);return c}function Ma(a,e,s){const c={};for(const p in a)e.call(this,a[p],p,a)&&(c[p]=a[p]);return c}function Bn(a){return Array.isArray(a)?a.map(Bn):typeof a=="object"&&a?so(a,Bn):a}const jr={};function Ti(a){jr[a]||(typeof console<"u"&&console.warn(a),jr[a]=!0)}function Yo(a,e,s){return(s.y-a.y)*(e.x-a.x)>(e.y-a.y)*(s.x-a.x)}function Cd(a){let e=0;for(let s,c,p=0,u=a.length,m=u-1;p<u;m=p++)s=a[p],c=a[m],e+=(c.x-s.x)*(s.y+c.y);return e}function As([a,e,s]){const c=yt(e+90),p=yt(s);return{x:a*Math.cos(c)*Math.sin(p),y:a*Math.sin(c)*Math.sin(p),z:a*Math.cos(p),azimuthal:e,polar:s}}function Ca(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function yc(a){const e={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,p,u)=>{const m=p||u;return e[c]=!m||m.toLowerCase(),""}),e["max-age"]){const s=parseInt(e["max-age"],10);isNaN(s)?delete e["max-age"]:e["max-age"]=s}return e}let vc=null;function xc(a,e){return[a[4*e],a[4*e+1],a[4*e+2],a[4*e+3]]}function Id(a,e,s,c){for(;e<s;){const p=e+s>>1;a[p]<c?e=p+1:s=p}return e}function bc(a,e,s,c){for(;e<s;){const p=e+s>>1;a[p]<=c?e=p+1:s=p}return e}function Pd(a){return a>0?1/(1.001-a):1+a}function Rd(a){return a>0?1-1/(1.001-a):-a}const pr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!pr.API_URL)return null;try{const a=new URL(pr.API_URL);return a.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":a.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Fu(a){return pr.API_URL_REGEX.test(a)}function Dd(a){return pr.API_SPRITE_REGEX.test(a)}let Nu,$r,Ko,et,K,ie;function oe(){return Nu==null&&(Nu=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Nu}const ye={now:()=>et!==void 0?et:performance.now(),setNow(a){et=a},restoreNow(){et=void 0},frame(a){const e=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(a,e=0){const{width:s,height:c}=a;K||(K=document.createElement("canvas"));const p=K.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(s>K.width||c>K.height)&&(K.width=s,K.height=c),p.clearRect(-e,-e,s+2*e,c+2*e),p.drawImage(a,0,0,s,c),p.getImageData(-e,-e,s+2*e,c+2*e)},resolveURL:a=>($r||($r=document.createElement("a")),$r.href=a,$r.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Ko==null&&(Ko=window.matchMedia("(prefers-reduced-motion: reduce)")),Ko.matches)},hasCanvasFingerprintNoise(){if(ie!==void 0)return ie;if(!oe())return ie=!1,!1;const a=new OffscreenCanvas(85,1),e=a.getContext("2d",{willReadFrequently:!0});let s=0;for(let p=0;p<a.width;++p)e.fillStyle=`rgba(${s++},${s++},${s++}, 255)`,e.fillRect(p,0,1,1);const c=e.getImageData(0,0,a.width,a.height);s=0;for(let p=0;p<c.data.length;++p)if(p%4!=3&&s++!==c.data[p])return ie=!0,!0;return ie=!1,!1}};function xe(a,e){const s=a.indexOf("?");if(s<0)return`${a}?${new URLSearchParams(e).toString()}`;const c=new URLSearchParams(a.slice(s));for(const p in e)c.set(p,e[p]);return`${a.slice(0,s)}?${c.toString()}`}function Re(a,e={persistentParams:[]}){const s=a.indexOf("?");if(s<0)return a;const c=new URLSearchParams,p=new URLSearchParams(a.slice(s));for(const m of e.persistentParams){const x=p.get(m);x&&c.set(m,x)}const u=c.toString();return`${a.slice(0,s)}${u.length>0?`?${u}`:""}`}const qe="mapbox-tiles";let Oe=500,Je=50;const Ke=["language","worldview","jobid"];let Qe,ft;function It(){try{return caches}catch{}}function Pt(){const a=It();a&&Qe==null&&(Qe=a.open(qe))}let si=1/0;const ui={supported:!1,testSupport:function(a){!Ni&&ci&&($i?Zi(a):hi=a)}};let hi,ci,Ni=!1,$i=!1;const Ii=typeof self<"u"?self:{};function Zi(a){const e=a.createTexture();a.bindTexture(a.TEXTURE_2D,e);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,ci),a.isContextLost())return;ui.supported=!0}catch{}a.deleteTexture(e),Ni=!0}Ii.document&&(ci=Ii.document.createElement("img"),ci.onload=function(){hi&&Zi(hi),hi=null,$i=!0},ci.onerror=function(){Ni=!0,hi=null},ci.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ki={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Ki);class tr extends Error{constructor(e,s,c){s===401&&Fu(c)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=s,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Jo=Ca()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,mr=function(a,e){if(!(/^file:/.test(s=a.url)||/^file:/.test(Jo())&&!/^\w+:/.test(s))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(c,p){const u=new AbortController,m=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Jo(),referrerPolicy:c.referrerPolicy,signal:u.signal});let x=!1,S=!1;const P=(y=m.url).indexOf("sku=")>0&&Fu(y);var y;c.type==="json"&&m.headers.set("Accept","application/json");const A=(E,M,R)=>{if(S)return;if(E&&E.message!=="SecurityError"&&Ti(E.toString()),M&&R)return I(M);const z=Date.now();fetch(m).then(F=>{if(F.ok){const $=P?F.clone():null;return I(F,$,z)}return p(new tr(F.statusText,F.status,c.url))}).catch(F=>{F.name!=="AbortError"&&p(new Error(`${F.message} ${c.url}`))})},I=(E,M,R)=>{(c.type==="arrayBuffer"?E.arrayBuffer():c.type==="json"?E.json():E.text()).then(z=>{S||(M&&R&&function(F,$,H){if(Pt(),Qe==null)return;const V=yc($.headers.get("Cache-Control")||"");if(V["no-store"])return;const G={status:$.status,statusText:$.statusText,headers:new Headers};$.headers.forEach((he,ce)=>G.headers.set(ce,he)),V["max-age"]&&G.headers.set("Expires",new Date(H+1e3*V["max-age"]).toUTCString());const Y=G.headers.get("Expires");if(!Y||new Date(Y).getTime()-H<42e4)return;let te=Re(F.url,{persistentParams:Ke});if($.status===206){const he=F.headers.get("Range");if(!he)return;G.status=200,te=xe(te,{range:he})}(function(he,ce){if(ft===void 0)try{new Response(new ReadableStream),ft=!0}catch{ft=!1}ft?ce(he.body):he.blob().then(ce)})($,he=>{const ce=new Response((le=$.status)!==200&&le!==404&&[101,103,204,205,304].includes(le)?null:he,G);var le;Pt(),Qe!=null&&Qe.then(Ee=>Ee.put(te,ce)).catch(Ee=>Ti(Ee.message))})}(m,M,R),x=!0,p(null,z,E.headers.get("Cache-Control"),E.headers.get("Expires")))}).catch(z=>{S||p(new Error(z.message))})};return P?function(E,M){if(Pt(),Qe==null)return M(null);Qe.then(R=>{let z=Re(E.url,{persistentParams:Ke});const F=E.headers.get("Range");F&&(z=xe(z,{range:F})),R.match(z).then($=>{const H=function(V){if(!V)return!1;const G=new Date(V.headers.get("Expires")||0),Y=yc(V.headers.get("Cache-Control")||"");return G>Date.now()&&!Y["no-cache"]}($);R.delete(z),H&&R.put(z,$.clone()),M(null,$,H)}).catch(M)}).catch(M)}(m,A):A(null,null),{cancel:()=>{S=!0,x||u.abort()}}}(a,e);if(Ca()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,e,void 0,!0)}var s;return function(c,p){const u=new XMLHttpRequest;u.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(const m in c.headers)u.setRequestHeader(m,c.headers[m]);return c.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=c.credentials==="include",u.onerror=()=>{p(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let m=u.response;if(c.type==="json")try{m=JSON.parse(u.response)}catch(x){return p(x)}p(null,m,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else p(new tr(u.statusText,u.status,c.url))},u.send(c.body),{cancel:()=>u.abort()}}(a,e)},br=function(a,e){return mr(Wi(a,{type:"arrayBuffer"}),e)};function ds(a){const e=document.createElement("a");return e.href=a,e.protocol===location.protocol&&e.host===location.host}const Bu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ia,Vu;Ia=[],Vu=0;const Up=function(a,e){if(ui.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Vu>=pr.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:a,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ia.push(u),u}Vu++;let s=!1;const c=()=>{if(!s)for(s=!0,Vu--;Ia.length&&Vu<pr.MAX_PARALLEL_IMAGE_REQUESTS;){const u=Ia.shift(),{requestParameters:m,callback:x,cancelled:S}=u;S||(u.cancel=Up(m,x).cancel)}},p=br(a,(u,m,x,S)=>{c(),u?e(u):m&&(self.createImageBitmap?function(P,y){const A=new Blob([new Uint8Array(P)],{type:"image/png"});createImageBitmap(A).then(I=>{y(null,I)}).catch(I=>{y(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(P,y)=>e(P,y,x,S)):function(P,y){const A=new Image;A.onload=()=>{y(null,A),URL.revokeObjectURL(A.src),A.onload=null,requestAnimationFrame(()=>{A.src=Bu})},A.onerror=()=>y(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const I=new Blob([new Uint8Array(P)],{type:"image/png"});A.src=P.byteLength?URL.createObjectURL(I):Bu}(m,(P,y)=>e(P,y,x,S)))});return{cancel:()=>{p.cancel(),c()}}};var Kg,jp,$p,fs={exports:{}},So={exports:{}},Pa={exports:{}},Qo=function(){if($p)return fs.exports;$p=1;var a=(Kg||(Kg=1,So.exports=function(s,c){var p,u,m,x,S,P,y,A;for(u=s.length-(p=3&s.length),m=c,S=3432918353,P=461845907,A=0;A<u;)y=255&s.charCodeAt(A)|(255&s.charCodeAt(++A))<<8|(255&s.charCodeAt(++A))<<16|(255&s.charCodeAt(++A))<<24,++A,m=27492+(65535&(x=5*(65535&(m=(m^=y=(65535&(y=(y=(65535&y)*S+(((y>>>16)*S&65535)<<16)&4294967295)<<15|y>>>17))*P+(((y>>>16)*P&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(y=0,p){case 3:y^=(255&s.charCodeAt(A+2))<<16;case 2:y^=(255&s.charCodeAt(A+1))<<8;case 1:m^=y=(65535&(y=(y=(65535&(y^=255&s.charCodeAt(A)))*S+(((y>>>16)*S&65535)<<16)&4294967295)<<15|y>>>17))*P+(((y>>>16)*P&65535)<<16)&4294967295}return m^=s.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),So.exports),e=(jp||(jp=1,Pa.exports=function(s,c){for(var p,u=s.length,m=c^u,x=0;u>=4;)p=1540483477*(65535&(p=255&s.charCodeAt(x)|(255&s.charCodeAt(++x))<<8|(255&s.charCodeAt(++x))<<16|(255&s.charCodeAt(++x))<<24))+((1540483477*(p>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),u-=4,++x;switch(u){case 3:m^=(255&s.charCodeAt(x+2))<<16;case 2:m^=(255&s.charCodeAt(x+1))<<8;case 1:m=1540483477*(65535&(m^=255&s.charCodeAt(x)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),Pa.exports);return fs.exports=a,fs.exports.murmur3=a,fs.exports.murmur2=e,fs.exports}(),Ao=k(Qo);class ea{constructor(e,...s){Wi(this,s[0]||{}),this.type=e}}class Ld extends ea{constructor(e,s={}){super("error",Wi({error:e},s))}}function qp(a,e,s){s[a]&&s[a].indexOf(e)!==-1||(s[a]=s[a]||[],s[a].push(e))}function Qa(a,e,s){if(s&&s[a]){const c=s[a].indexOf(e);c!==-1&&s[a].splice(c,1)}}class el{on(e,s){return this._listeners=this._listeners||{},qp(e,s,this._listeners),this}off(e,s){return Qa(e,s,this._listeners),Qa(e,s,this._oneTimeListeners),this}once(e,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},qp(e,s,this._oneTimeListeners),this):new Promise(c=>this.once(e,c))}fire(e,s){const c=typeof e=="string"?new ea(e,s):e,p=c.type;if(this.listens(p)){c.target=this;const u=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const S of u)S.call(this,c);const m=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const S of m)Qa(p,S,this._oneTimeListeners),S.call(this,c);const x=this._eventedParent;x&&(Wi(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(c))}else c instanceof Ld&&console.error(c.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,s){return this._eventedParent=e,this._eventedParentData=s,this}}var Jg,Hp={},oo=function(){if(Jg)return Hp;Jg=1;var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(u){return(u=Math.round(u))<0?0:u>255?255:u}function s(u){return e(u[u.length-1]==="%"?parseFloat(u)/100*255:parseInt(u))}function c(u){return(m=u[u.length-1]==="%"?parseFloat(u)/100:parseFloat(u))<0?0:m>1?1:m;var m}function p(u,m,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?u+(m-u)*x*6:2*x<1?m:3*x<2?u+(m-u)*(2/3-x)*6:u}try{Hp.parseCSSColor=function(u){var m,x=u.replace(/ /g,"").toLowerCase();if(x in a)return a[x].slice();if(x[0]==="#")return x.length===4?(m=parseInt(x.substr(1),16))>=0&&m<=4095?[(3840&m)>>4|(3840&m)>>8,240&m|(240&m)>>4,15&m|(15&m)<<4,1]:null:x.length===7&&(m=parseInt(x.substr(1),16))>=0&&m<=16777215?[(16711680&m)>>16,(65280&m)>>8,255&m,1]:null;var S=x.indexOf("("),P=x.indexOf(")");if(S!==-1&&P+1===x.length){var y=x.substr(0,S),A=x.substr(S+1,P-(S+1)).split(","),I=1;switch(y){case"rgba":if(A.length!==4)return null;I=c(A.pop());case"rgb":return A.length!==3?null:[s(A[0]),s(A[1]),s(A[2]),I];case"hsla":if(A.length!==4)return null;I=c(A.pop());case"hsl":if(A.length!==3)return null;var E=(parseFloat(A[0])%360+360)%360/360,M=c(A[1]),R=c(A[2]),z=R<=.5?R*(M+1):R+M-R*M,F=2*R-z;return[e(255*p(F,z,E+1/3)),e(255*p(F,z,E)),e(255*p(F,z,E-1/3)),I];default:return null}}return null}}catch{}return Hp}();class Qi{constructor(e,s,c,p=1){this.r=e,this.g=s,this.b=c,this.a=p}static parse(e){if(!e)return;if(e instanceof Qi)return e;if(typeof e!="string")return;const s=oo.parseCSSColor(e);return s?new Qi(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toStringPremultipliedAlpha(){const[e,s,c,p]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(s)},${Math.round(c)},${p})`}toString(){const[e,s,c,p]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*s)},${Math.round(255*c)},${p})`}toRenderColor(e){const{r:s,g:c,b:p,a:u}=this;return new Gp(e,s,c,p,u)}clone(){return new Qi(this.r,this.g,this.b,this.a)}}class Gp{constructor(e,s,c,p,u){if(e){const m=e.image.height,x=m*m;s=u===0?0:s/u*(m-1),c=u===0?0:c/u*(m-1),p=u===0?0:p/u*(m-1);const S=Math.floor(s),P=Math.floor(c),y=Math.floor(p),A=Math.ceil(s),I=Math.ceil(c),E=Math.ceil(p),M=s-S,R=c-P,z=p-y,F=e.image.data,$=4*(S+P*x+y*m),H=4*(S+P*x+E*m),V=4*(S+I*x+y*m),G=4*(S+I*x+E*m),Y=4*(A+P*x+y*m),te=4*(A+P*x+E*m),he=4*(A+I*x+y*m),ce=4*(A+I*x+E*m);if($<0||ce>=F.length)throw new Error("out of range");this.r=di(di(di(F[$],F[H],z),di(F[V],F[G],z),R),di(di(F[Y],F[te],z),di(F[he],F[ce],z),R),M)/255*u,this.g=di(di(di(F[$+1],F[H+1],z),di(F[V+1],F[G+1],z),R),di(di(F[Y+1],F[te+1],z),di(F[he+1],F[ce+1],z),R),M)/255*u,this.b=di(di(di(F[$+2],F[H+2],z),di(F[V+2],F[G+2],z),R),di(di(F[Y+2],F[te+2],z),di(F[he+2],F[ce+2],z),R),M)/255*u,this.a=u}else this.r=s,this.g=c,this.b=p,this.a=u}toArray(){const{r:e,g:s,b:c,a:p}=this;return p===0?[0,0,0,0]:[255*e/p,255*s/p,255*c/p,p]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:e,g:s,b:c,a:p}=this,u=Math.min(Math.max(e/p,0),1),m=Math.min(Math.max(s/p,0),1),x=Math.min(Math.max(c/p,0),1),S=Math.min(u,m,x),P=Math.max(u,m,x),y=(S+P)/2;if(S===P)return[0,0,100*y,p];const A=P-S,I=y>.5?A/(2-P-S):A/(P+S);let E=0;return P===u?E=(m-x)/A+(m<x?6:0):P===m?E=(x-u)/A+2:P===x&&(E=(u-m)/A+4),E*=60,[Math.min(Math.max(E,0),360),Math.min(Math.max(100*I,0),100),Math.min(Math.max(100*y,0),100),p]}toArray01(){const{r:e,g:s,b:c,a:p}=this;return p===0?[0,0,0,0]:[e/p,s/p,c/p,p]}toArray01Scaled(e){const{r:s,g:c,b:p,a:u}=this;return u===0?[0,0,0]:[s/u*e,c/u*e,p/u*e]}toArray01PremultipliedAlpha(){const{r:e,g:s,b:c,a:p}=this;return[e,s,c,p]}toArray01Linear(){const{r:e,g:s,b:c,a:p}=this;return p===0?[0,0,0,0]:[Math.pow(e/p,2.2),Math.pow(s/p,2.2),Math.pow(c/p,2.2),p]}}function di(a,e,s){return a*(1-s)+e*s}function Qg(a,e,s){return a.map((c,p)=>di(c,e[p],s))}Qi.black=new Qi(0,0,0,1),Qi.white=new Qi(1,1,1,1),Qi.transparent=new Qi(0,0,0,0),Qi.red=new Qi(1,0,0,1),Qi.blue=new Qi(0,0,1,1);var Od=Object.freeze({__proto__:null,array:Qg,color:function(a,e,s){return new Qi(di(a.r,e.r,s),di(a.g,e.g,s),di(a.b,e.b,s),di(a.a,e.a,s))},number:di});function zd(a,...e){for(const s of e)for(const c in s)a[c]=s[c];return a}class Ri extends Error{constructor(e,s){super(s),this.message=s,this.key=e}}class kd{constructor(e,s=[]){this.parent=e,this.bindings={};for(const[c,p]of s)this.bindings[c]=p}concat(e){return new kd(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Il={kind:"null"},Wt={kind:"number"},rn={kind:"string"},qi={kind:"boolean"},Jr={kind:"color"},Ra={kind:"object"},Yi={kind:"value"},Uu={kind:"collator"},ta={kind:"formatted"},ju={kind:"resolvedImage"};function Rr(a,e){return{kind:"array",itemType:a,N:e}}function qn(a){if(a.kind==="array"){const e=qn(a.itemType);return typeof a.N=="number"?`array<${e}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${e}>`}return a.kind}const Wp=[Il,Wt,rn,qi,Jr,ta,Ra,Rr(Yi),ju];function ys(a,e){if(e.kind==="error")return null;if(a.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ys(a.itemType,e.itemType))&&(typeof a.N!="number"||a.N===e.N))return null}else{if(a.kind===e.kind)return null;if(a.kind==="value"){for(const s of Wp)if(!ys(s,e))return null}}return`Expected ${qn(a)} but found ${qn(e)} instead.`}function Fd(a,e){return e.some(s=>s.kind===a.kind)}function $u(a,e){return e.some(s=>s==="null"?a===null:s==="array"?Array.isArray(a):s==="object"?a&&!Array.isArray(a)&&typeof a=="object":s===typeof a)}class Nd{constructor(e,s,c){this.sensitivity=e?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,s){return this.collator.compare(e,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class qu{constructor(e,s,c,p,u){this.text=e.normalize?e.normalize():e,this.image=s,this.scale=c,this.fontStack=p,this.textColor=u}}class Qr{constructor(e){this.sections=e}static fromString(e){return new Qr([new qu(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary)}static factory(e){return e instanceof Qr?e:Qr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const s of this.sections){if(s.image){e.push(["image",s.image.namePrimary]);continue}e.push(s.text);const c={};s.fontStack&&(c["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(c["font-scale"]=s.scale),s.textColor&&(c["text-color"]=["rgba"].concat(s.textColor.toRenderColor(null).toArray())),e.push(c)}return e}}class ia{constructor(e,s){if(this.id=e,this.options=s||{params:{}},this.options.transform){const{a:c,b:p,c:u,d:m,e:x,f:S}=this.options.transform;this.options.transform=new DOMMatrix([c,p,u,m,x,S])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}static deserializeId(e){return JSON.parse(e).id}static deserializeFromString(e){const s=JSON.parse(e),{a:c,b:p,c:u,d:m,e:x,f:S}=s.options.transform;return new DOMMatrix([c,p,u,m,x,S]),new ia(s.id,s.options)}scaleSelf(e){return this.options.transform=this.options.transform.scale(e),this}serialize(){const e={id:this.id};this.options&&(e.options=this.options);const{a:s,b:c,c:p,d:u,e:m,f:x}=this.options.transform;return e.options.transform={a:s,b:c,c:p,d:u,e:m,f:x},JSON.stringify(e)}}class qr{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),e.optionsPrimary&&(this.optionsPrimary=e.optionsPrimary),e.optionsSecondary&&(this.optionsSecondary=e.optionsSecondary),this.available=e.available}toString(){return this.namePrimary&&this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}getPrimary(){return new ia(this.namePrimary,{params:this.optionsPrimary&&this.optionsPrimary.params||{}})}getSerializedPrimary(){return this.getPrimary().serialize()}getSecondary(){return this.nameSecondary?new ia(this.nameSecondary,{params:this.optionsSecondary&&this.optionsSecondary.params||{}}):null}static from(e){return typeof e=="string"?qr.build(e):e}static build(e,s,c,p){return e?new qr({namePrimary:e,nameSecondary:s,optionsPrimary:c,optionsSecondary:p,available:!1}):null}}function Zp(a,e,s,c){return typeof a=="number"&&a>=0&&a<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof s=="number"&&s>=0&&s<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[a,e,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[a,e,s,c]:[a,e,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Da(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Qi||a instanceof Nd||a instanceof Qr||a instanceof qr)return!0;if(Array.isArray(a)){for(const e of a)if(!Da(e))return!1;return!0}if(typeof a=="object"){for(const e in a)if(!Da(a[e]))return!1;return!0}return!1}function Vn(a){if(a===null)return Il;if(typeof a=="string")return rn;if(typeof a=="boolean")return qi;if(typeof a=="number")return Wt;if(a instanceof Qi)return Jr;if(a instanceof Nd)return Uu;if(a instanceof Qr)return ta;if(a instanceof qr)return ju;if(Array.isArray(a)){const e=a.length;let s;for(const c of a){const p=Vn(c);if(s){if(s===p)continue;s=Yi;break}s=p}return Rr(s||Yi,e)}return Ra}function ao(a){const e=typeof a;return a===null?"":e==="string"||e==="number"||e==="boolean"?String(a):a instanceof Qi?a.toStringPremultipliedAlpha():a instanceof Qr||a instanceof qr?a.toString():JSON.stringify(a)}class Dr{constructor(e,s){this.type=e,this.value=s}static parse(e,s){if(e.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Da(e[1]))return s.error("invalid value");const c=e[1];let p=Vn(c);const u=s.expectedType;return p.kind!=="array"||p.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(p=u),new Dr(p,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Qi?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Qr?this.value.serialize():this.value}}class ir{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Hu={string:rn,number:Wt,boolean:qi,object:Ra};class Mo{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let c,p=1;const u=e[0];if(u==="array"){let x,S;if(e.length>2){const P=e[1];if(typeof P!="string"||!(P in Hu)||P==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);x=Hu[P],p++}else x=Yi;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return s.error('The length argument to "array" must be a positive integer literal',2);S=e[2],p++}c=Rr(x,S)}else c=Hu[u];const m=[];for(;p<e.length;p++){const x=s.parse(e[p],p,Yi);if(!x)return null;m.push(x)}return new Mo(c,m)}evaluate(e){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(e);if(!ys(this.type,Vn(c)))return c;if(s===this.args.length-1)throw new ir(`The expression ${JSON.stringify(this.args[s].serialize())} evaluated to ${qn(Vn(c))} but was expected to be of type ${qn(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,s=[e.kind];if(e.kind==="array"){const c=e.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){s.push(c.kind);const p=e.N;(typeof p=="number"||this.args.length>1)&&s.push(p)}}return s.concat(this.args.map(c=>c.serialize()))}}class Pl{constructor(e){this.type=ta,this.sections=e}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const c=e[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");const p=[];let u=!1;for(let m=1;m<=e.length-1;++m){const x=e[m];if(u&&typeof x=="object"&&!Array.isArray(x)){u=!1;let S=null;if(x["font-scale"]&&(S=s.parseObjectValue(x["font-scale"],m,"font-scale",Wt),!S))return null;let P=null;if(x["text-font"]&&(P=s.parseObjectValue(x["text-font"],m,"text-font",Rr(rn)),!P))return null;let y=null;if(x["text-color"]&&(y=s.parseObjectValue(x["text-color"],m,"text-color",Jr),!y))return null;const A=p[p.length-1];A.scale=S,A.font=P,A.textColor=y}else{const S=s.parse(e[m],m,Yi);if(!S)return null;const P=S.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,p.push({content:S,scale:null,font:null,textColor:null})}}return new Pl(p)}evaluate(e){return new Qr(this.sections.map(s=>{const c=s.content.evaluate(e);return Vn(c)===ju?new qu("",c,null,null,null):new qu(ao(c),null,s.scale?s.scale.evaluate(e):null,s.font?s.font.evaluate(e).join(","):null,s.textColor?s.textColor.evaluate(e):null)}))}eachChild(e){for(const s of this.sections)e(s.content),s.scale&&e(s.scale),s.font&&e(s.font),s.textColor&&e(s.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const s of this.sections){e.push(s.content.serialize());const c={};s.scale&&(c["font-scale"]=s.scale.serialize()),s.font&&(c["text-font"]=s.font.serialize()),s.textColor&&(c["text-color"]=s.textColor.serialize()),e.push(c)}return e}}class Gu{constructor(e,s,c,p){this._imageWarnHistory={},this.type=ju,this.inputPrimary=e,this.inputSecondary=s,this.inputPrimaryParams=c,this.inputSecondaryParams=p}static parse(e,s){if(e.length<2)return s.error("Expected two or more arguments.");let c=1;const p=[];function u(){if(c<e.length){const x=s.parse(e[c],c++,rn);return x?(p.push({image:x,options:void 0}),!0):(s.error(p.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function m(){if(c<e.length){if((x=e[c])===null||typeof x!="object"||Array.isArray(x))return!0;const S=e[c].params,P=s.concat(c);if(!S)return c++,!0;if(typeof S!="object"||S.constructor!==Object)return P.error('Image options "params" should be an object'),!1;const y={},A=P.concat(void 0,"params");for(const I in S){if(!I)return A.error("Image parameter name should be non-empty"),!1;const E=A.concat(void 0,I).parse(S[I],void 0,Jr,void 0,{typeAnnotation:"coerce"});if(!E)return!1;y[I]=E}return p[p.length-1].options=y,c++,!0}var x;return!0}for(let x=0;x<2;x++)if(!u()||!m())return;return new Gu(p[0].image,p[1]?p[1].image:void 0,p[0].options,p[1]?p[1].options:void 0)}evaluateParams(e,s){const c={};if(s){for(const p in s)if(s[p])try{const u=s[p].evaluate(e),m=`Ignoring image parameter "${p}" with semi-transparent color ${u.toString()}`;if(u.a!==1){this._imageWarnHistory[m]||(console.warn(m),this._imageWarnHistory[m]=!0);continue}c[p]=u}catch{continue}if(Object.keys(c).length!==0)return{params:c}}}evaluate(e){const s=qr.build(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0,this.inputPrimaryParams?this.evaluateParams(e,this.inputPrimaryParams):void 0,this.inputSecondaryParams?this.evaluateParams(e,this.inputSecondaryParams):void 0);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(s.namePrimary)>-1,s.nameSecondary&&s.available&&e.availableImages&&(s.available=e.availableImages.indexOf(s.nameSecondary)>-1)),s}eachChild(e){if(e(this.inputPrimary),this.inputPrimaryParams)for(const s in this.inputPrimaryParams)this.inputPrimaryParams[s]&&e(this.inputPrimaryParams[s]);if(this.inputSecondary&&(e(this.inputSecondary),this.inputSecondaryParams))for(const s in this.inputSecondaryParams)this.inputSecondaryParams[s]&&e(this.inputSecondaryParams[s])}outputDefined(){return!1}serializeParams(e){const s={};if(e){for(const c in e)e[c]&&(s[c]=e[c].serialize());return{params:s}}}serialize(){const e=["image",this.inputPrimary.serialize()];return this.inputPrimaryParams&&e.push(this.serializeParams(this.inputPrimaryParams)),this.inputSecondary&&(e.push(this.inputSecondary.serialize()),this.inputSecondaryParams&&e.push(this.serializeParams(this.inputSecondaryParams))),e}}function Co(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}const Xp={"to-boolean":qi,"to-color":Jr,"to-number":Wt,"to-string":rn};class La{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const c=e[0],p=[];let u=Il;if(c==="to-array"){if(!Array.isArray(e[1]))return null;const m=e[1].length;if(s.expectedType){if(s.expectedType.kind!=="array")return s.error(`Expected ${s.expectedType.kind} but found array.`);u=Rr(s.expectedType.itemType,m)}else{if(!(m>0&&Da(e[1][0])))return null;u=Rr(Vn(e[1][0]),m)}for(let x=0;x<m;x++){const S=e[1][x];let P;if(Co(S)==="array")P=s.parse(S,void 0,u.itemType);else{const y=Co(S);if(y!==u.itemType.kind)return s.error(`Expected ${u.itemType.kind} but found ${y}.`);P=s.registry.literal.parse(["literal",S===void 0?null:S],s)}if(!P)return null;p.push(P)}}else{if((c==="to-boolean"||c==="to-string")&&e.length!==2)return s.error("Expected one argument.");u=Xp[c];for(let m=1;m<e.length;m++){const x=s.parse(e[m],m,Yi);if(!x)return null;p.push(x)}}return new La(u,p)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let s,c;for(const p of this.args){if(s=p.evaluate(e),c=null,s instanceof Qi)return s;if(typeof s=="string"){const u=e.parseColor(s);if(u)return u}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Zp(s[0],s[1],s[2],s[3]),!c))return new Qi(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new ir(c||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(const c of this.args){if(s=c.evaluate(e),s===null)return 0;const p=Number(s);if(!isNaN(p))return p}throw new ir(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?Qr.fromString(ao(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?qr.build(ao(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(s=>s.evaluate(e)):ao(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Pl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Gu(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(s=>{e.push(s.serialize())}),e}}const G1=["Unknown","Point","LineString","Polygon"];class Yp{constructor(e,s){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=s}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?G1[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:c,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*s-e[0])+this.featureDistanceData.bearing[1]*(p*s-e[1])}return 0}parseColor(e){let s=this._parseColorCache[e];return s||(s=this._parseColorCache[e]=Qi.parse(e)),s}getConfig(e){return this.options?this.options.get(e):null}}class vs{constructor(e,s,c,p,u){this.name=e,this.type=s,this._evaluate=c,this.args=p,this._overloadIndex=u}evaluate(e){if(!this._evaluate){const s=vs.definitions[this.name];this._evaluate=Array.isArray(s)?s[2]:s.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,s){const c=e[0],p=vs.definitions[c];if(!p)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(p)?p[0]:p.type,m=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,x=[];let S=null,P=-1;for(const[y,A]of m){if(Array.isArray(y)&&y.length!==e.length-1)continue;x.push(y),P++,S=new ih(s.registry,s.path,null,s.scope,void 0,s._scope,s.options);const I=[];let E=!1;for(let M=1;M<e.length;M++){const R=e[M],z=Array.isArray(y)?y[M-1]:y.type,F=S.parse(R,1+I.length,z);if(!F){E=!0;break}I.push(F)}if(!E)if(Array.isArray(y)&&y.length!==I.length)S.error(`Expected ${y.length} arguments, but found ${I.length} instead.`);else{for(let M=0;M<I.length;M++){const R=Array.isArray(y)?y[M]:y.type,z=I[M];S.concat(M+1).checkSubtype(R,z.type)}if(S.errors.length===0)return new vs(c,u,A,I,P)}}if(x.length===1)s.errors.push(...S.errors);else{const y=(x.length?x:m.map(([I])=>I)).map(Kp).join(" | "),A=[];for(let I=1;I<e.length;I++){const E=s.parse(e[I],1+A.length);if(!E)return null;A.push(qn(E.type))}s.error(`Expected arguments of type ${y}, but found (${A.join(", ")}) instead.`)}return null}static register(e,s){vs.definitions=s;for(const c in s)e[c]=vs}}function Kp(a){return Array.isArray(a)?`(${a.map(qn).join(", ")})`:`(${qn(a.type)}...)`}class Bd{constructor(e,s,c){this.type=Uu,this.locale=c,this.caseSensitive=e,this.diacriticSensitive=s}static parse(e,s){if(e.length!==2)return s.error("Expected one argument.");const c=e[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");const p=c["case-sensitive"]===void 0?s.parse(!1,1,qi):s.parseObjectValue(c["case-sensitive"],1,"case-sensitive",qi);if(!p)return null;const u=c["diacritic-sensitive"]===void 0?s.parse(!1,1,qi):s.parseObjectValue(c["diacritic-sensitive"],1,"diacritic-sensitive",qi);if(!u)return null;let m=null;return c.locale&&(m=s.parseObjectValue(c.locale,1,"locale",rn),!m)?null:new Bd(p,u,m)}evaluate(e){return new Nd(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Wu(a,e,s=0,c=a.length-1,p=W1){for(;c>s;){if(c-s>600){const S=c-s+1,P=e-s+1,y=Math.log(S),A=.5*Math.exp(2*y/3),I=.5*Math.sqrt(y*A*(S-A)/S)*(P-S/2<0?-1:1);Wu(a,e,Math.max(s,Math.floor(e-P*A/S+I)),Math.min(c,Math.floor(e+(S-P)*A/S+I)),p)}const u=a[e];let m=s,x=c;for(Zu(a,s,e),p(a[c],u)>0&&Zu(a,s,c);m<x;){for(Zu(a,m,x),m++,x--;p(a[m],u)<0;)m++;for(;p(a[x],u)>0;)x--}p(a[s],u)===0?Zu(a,s,x):(x++,Zu(a,x,c)),x<=e&&(s=x+1),e<=x&&(c=x-1)}}function Zu(a,e,s){const c=a[e];a[e]=a[s],a[s]=c}function W1(a,e){return a<e?-1:a>e?1:0}function Z1(a){let e=0;for(let s,c,p=0,u=a.length,m=u-1;p<u;m=p++)s=a[p],c=a[m],e+=(c.x-s.x)*(s.y+c.y);return e}function Xu(a,e){a[0]=Math.min(a[0],e[0]),a[1]=Math.min(a[1],e[1]),a[2]=Math.max(a[2],e[0]),a[3]=Math.max(a[3],e[1])}function Yu(a,e){return!(a[0]<=e[0]||a[2]>=e[2]||a[1]<=e[1]||a[3]>=e[3])}function X1(a,e,s){const c=a[0]-e[0],p=a[1]-e[1],u=a[0]-s[0],m=a[1]-s[1];return c*m-u*p==0&&c*u<=0&&p*m<=0}function wc(a,e,s=!1){let c=!1;for(let x=0,S=e.length;x<S;x++){const P=e[x];for(let y=0,A=P.length,I=A-1;y<A;I=y++){const E=P[I],M=P[y];if(X1(a,E,M))return s;(u=E)[1]>(p=a)[1]!=(m=M)[1]>p[1]&&p[0]<(m[0]-u[0])*(p[1]-u[1])/(m[1]-u[1])+u[0]&&(c=!c)}}var p,u,m;return c}function Jp(a,e,s,c){const p=c[0]-s[0],u=c[1]-s[1],m=(a[0]-s[0])*u-p*(a[1]-s[1]),x=(e[0]-s[0])*u-p*(e[1]-s[1]);return m>0&&x<0||m<0&&x>0}function Oa(a,e,s,c){return(p=[c[0]-s[0],c[1]-s[1]])[0]*(u=[e[0]-a[0],e[1]-a[1]])[1]-p[1]*u[0]!=0&&!(!Jp(a,e,s,c)||!Jp(s,c,a,e));var p,u}const tl=8192;function Y1(a,e){const s=(180+a[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,p=Math.pow(2,e.z);return[Math.round(s*p*tl),Math.round(c*p*tl)]}function Qp(a,e){for(let s=0;s<e.length;s++)if(wc(a,e[s]))return!0;return!1}function K1(a,e,s){for(const c of s)for(let p=0,u=c.length,m=u-1;p<u;m=p++)if(Oa(a,e,c[m],c[p]))return!0;return!1}function ey(a,e){for(let s=0;s<a.length;++s)if(!wc(a[s],e))return!1;for(let s=0;s<a.length-1;++s)if(K1(a[s],a[s+1],e))return!1;return!0}function J1(a,e){for(let s=0;s<e.length;s++)if(ey(a,e[s]))return!0;return!1}function em(a,e,s){const c=[];for(let p=0;p<a.length;p++){const u=[];for(let m=0;m<a[p].length;m++){const x=Y1(a[p][m],s);Xu(e,x),u.push(x)}c.push(u)}return c}function Rl(a,e,s){const c=[];for(let p=0;p<a.length;p++){const u=em(a[p],e,s);c.push(u)}return c}function Pi(a,e,s,c){if(a[0]<s[0]||a[0]>s[2]){const p=.5*c;let u=a[0]-s[0]>p?-c:s[0]-a[0]>p?c:0;u===0&&(u=a[0]-s[2]>p?-c:s[2]-a[0]>p?c:0),a[0]+=u}Xu(e,a)}function oi(a,e,s,c){const p=Math.pow(2,c.z)*tl,u=[c.x*tl,c.y*tl],m=[];if(!a)return m;for(const x of a)for(const S of x){const P=[S.x+u[0],S.y+u[1]];Pi(P,e,s,p),m.push(P)}return m}function Vd(a,e,s,c){const p=Math.pow(2,c.z)*tl,u=[c.x*tl,c.y*tl],m=[];if(!a)return m;for(const S of a){const P=[];for(const y of S){const A=[y.x+u[0],y.y+u[1]];Xu(e,A),P.push(A)}m.push(P)}if(e[2]-e[0]<=p/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const S of m)for(const P of S)Pi(P,e,s,p)}var x;return m}class pi{constructor(e,s){this.type=qi,this.geojson=e,this.geometries=s}static parse(e,s){if(e.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Da(e[1])){const c=e[1];if(c.type==="FeatureCollection")for(let p=0;p<c.features.length;++p){const u=c.features[p].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new pi(c,c.features[p].geometry)}else if(c.type==="Feature"){const p=c.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new pi(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new pi(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(s,c){const p=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],m=s.canonicalID();if(!m)return!1;if(c.type==="Polygon"){const x=em(c.coordinates,u,m),S=oi(s.geometry(),p,u,m);if(!Yu(p,u))return!1;for(const P of S)if(!wc(P,x))return!1}if(c.type==="MultiPolygon"){const x=Rl(c.coordinates,u,m),S=oi(s.geometry(),p,u,m);if(!Yu(p,u))return!1;for(const P of S)if(!Qp(P,x))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(s,c){const p=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],m=s.canonicalID();if(!m)return!1;if(c.type==="Polygon"){const x=em(c.coordinates,u,m),S=Vd(s.geometry(),p,u,m);if(!Yu(p,u))return!1;for(const P of S)if(!ey(P,x))return!1}if(c.type==="MultiPolygon"){const x=Rl(c.coordinates,u,m),S=Vd(s.geometry(),p,u,m);if(!Yu(p,u))return!1;for(const P of S)if(!J1(P,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Tc={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Ud=1/298.257223563,gi=Ud*(2-Ud),Ec=Math.PI/180;class Dl{static fromTile(e,s,c){const p=Math.PI*(1-2*(e+.5)/Math.pow(2,s)),u=Math.atan(.5*(Math.exp(p)-Math.exp(-p)))/Ec;return new Dl(u,c)}static get units(){return Tc}constructor(e,s){if(e===void 0)throw new Error("No latitude given.");if(s&&!Tc[s])throw new Error(`Unknown unit ${s}. Use one of: ${Object.keys(Tc).join(", ")}`);const c=6378.137*Ec*(s?Tc[s]:1),p=Math.cos(e*Ec),u=1/(1-gi*(1-p*p)),m=Math.sqrt(u);this.kx=c*m*p,this.ky=c*m*u*(1-gi)}distance(e,s){const c=xs(e[0]-s[0])*this.kx,p=(e[1]-s[1])*this.ky;return Math.sqrt(c*c+p*p)}bearing(e,s){const c=xs(s[0]-e[0])*this.kx;return Math.atan2(c,(s[1]-e[1])*this.ky)/Ec}destination(e,s,c){const p=c*Ec;return this.offset(e,Math.sin(p)*s,Math.cos(p)*s)}offset(e,s,c){return[e[0]+s/this.kx,e[1]+c/this.ky]}lineDistance(e){let s=0;for(let c=0;c<e.length-1;c++)s+=this.distance(e[c],e[c+1]);return s}area(e){let s=0;for(let c=0;c<e.length;c++){const p=e[c];for(let u=0,m=p.length,x=m-1;u<m;x=u++)s+=xs(p[u][0]-p[x][0])*(p[u][1]+p[x][1])*(c?-1:1)}return Math.abs(s)/2*this.kx*this.ky}along(e,s){let c=0;if(s<=0)return e[0];for(let p=0;p<e.length-1;p++){const u=e[p],m=e[p+1],x=this.distance(u,m);if(c+=x,c>s)return jd(u,m,(s-(c-x))/x)}return e[e.length-1]}pointToSegmentDistance(e,s,c){let[p,u]=s,m=xs(c[0]-p)*this.kx,x=(c[1]-u)*this.ky;if(m!==0||x!==0){const S=(xs(e[0]-p)*this.kx*m+(e[1]-u)*this.ky*x)/(m*m+x*x);S>1?(p=c[0],u=c[1]):S>0&&(p+=m/this.kx*S,u+=x/this.ky*S)}return m=xs(e[0]-p)*this.kx,x=(e[1]-u)*this.ky,Math.sqrt(m*m+x*x)}pointOnLine(e,s){let c=1/0,p=e[0][0],u=e[0][1],m=0,x=0;for(let S=0;S<e.length-1;S++){let P=e[S][0],y=e[S][1],A=xs(e[S+1][0]-P)*this.kx,I=(e[S+1][1]-y)*this.ky,E=0;A===0&&I===0||(E=(xs(s[0]-P)*this.kx*A+(s[1]-y)*this.ky*I)/(A*A+I*I),E>1?(P=e[S+1][0],y=e[S+1][1]):E>0&&(P+=A/this.kx*E,y+=I/this.ky*E)),A=xs(s[0]-P)*this.kx,I=(s[1]-y)*this.ky;const M=A*A+I*I;M<c&&(c=M,p=P,u=y,m=S,x=E)}return{point:[p,u],index:m,t:Math.max(0,Math.min(1,x))}}lineSlice(e,s,c){let p=this.pointOnLine(c,e),u=this.pointOnLine(c,s);if(p.index>u.index||p.index===u.index&&p.t>u.t){const P=p;p=u,u=P}const m=[p.point],x=p.index+1,S=u.index;!tm(c[x],m[0])&&x<=S&&m.push(c[x]);for(let P=x+1;P<=S;P++)m.push(c[P]);return tm(c[S],u.point)||m.push(u.point),m}lineSliceAlong(e,s,c){let p=0;const u=[];for(let m=0;m<c.length-1;m++){const x=c[m],S=c[m+1],P=this.distance(x,S);if(p+=P,p>e&&u.length===0&&u.push(jd(x,S,(e-(p-P))/P)),p>=s)return u.push(jd(x,S,(s-(p-P))/P)),u;p>e&&u.push(S)}return u}bufferPoint(e,s){const c=s/this.ky,p=s/this.kx;return[e[0]-p,e[1]-c,e[0]+p,e[1]+c]}bufferBBox(e,s){const c=s/this.ky,p=s/this.kx;return[e[0]-p,e[1]-c,e[2]+p,e[3]+c]}insideBBox(e,s){return xs(e[0]-s[0])>=0&&xs(e[0]-s[2])<=0&&e[1]>=s[1]&&e[1]<=s[3]}}function tm(a,e){return a[0]===e[0]&&a[1]===e[1]}function jd(a,e,s){const c=xs(e[0]-a[0]);return[a[0]+c*s,a[1]+(e[1]-a[1])*s]}function xs(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}class Hr{constructor(e=[],s=(c,p)=>c<p?-1:c>p?1:0){if(this.data=e,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:s,compare:c}=this,p=s[e];for(;e>0;){const u=e-1>>1,m=s[u];if(c(p,m)>=0)break;s[e]=m,e=u}s[e]=p}_down(e){const{data:s,compare:c}=this,p=this.length>>1,u=s[e];for(;e<p;){let m=1+(e<<1);const x=m+1;if(x<this.length&&c(s[x],s[m])<0&&(m=x),c(s[m],u)>=0)break;s[e]=s[m],e=m}s[e]=u}}var Lt=8192;function im(a,e){return e.dist-a.dist}const $d=100,Ku=50;function il(a){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==a.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==a[s])return!1;return!0}function Lr(a){return a[1]-a[0]+1}function za(a,e){const s=a[1]>=a[0]&&a[1]<e;return s||console.warn("Distance Expression: Index is out of range"),s}function nm(a,e){if(a[0]>a[1])return[null,null];const s=Lr(a);if(e){if(s===2)return[a,null];const c=Math.floor(s/2);return[[a[0],a[0]+c],[a[0]+c,a[1]]]}{if(s===1)return[a,null];const c=Math.floor(s/2)-1;return[[a[0],a[0]+c],[a[0]+c+1,a[1]]]}}function Ll(a,e){const s=[1/0,1/0,-1/0,-1/0];if(!za(e,a.length))return s;for(let c=e[0];c<=e[1];++c)Xu(s,a[c]);return s}function Ol(a){const e=[1/0,1/0,-1/0,-1/0];for(let s=0;s<a.length;++s)for(let c=0;c<a[s].length;++c)Xu(e,a[s][c]);return e}function zl(a,e,s){if(il(a)||il(e))return NaN;let c=0,p=0;return a[2]<e[0]&&(c=e[0]-a[2]),a[0]>e[2]&&(c=a[0]-e[2]),a[1]>e[3]&&(p=a[1]-e[3]),a[3]<e[1]&&(p=e[1]-a[3]),s.distance([0,0],[c,p])}function rm(a){return 360*a-180}function Q1(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function sm(a,e){const s=Math.pow(2,e.z),c=(a.y/Lt+e.y)/s;return[rm((a.x/Lt+e.x)/s),Q1(c)]}function ex(a,e){const s=[];for(let c=0;c<a.length;++c)s.push(sm(a[c],e));return s}function ty(a,e,s){const c=s.pointOnLine(e,a).point;return s.distance(a,c)}function om(a,e,s,c,p){const u=s.slice(c[0],c[1]+1);let m=1/0;for(let x=e[0];x<=e[1];++x)if((m=Math.min(m,ty(a[x],u,p)))===0)return 0;return m}function am(a,e,s,c,p){const u=Math.min(p.pointToSegmentDistance(a,s,c),p.pointToSegmentDistance(e,s,c)),m=Math.min(p.pointToSegmentDistance(s,a,e),p.pointToSegmentDistance(c,a,e));return Math.min(u,m)}function tx(a,e,s,c,p){if(!za(e,a.length)||!za(c,s.length))return NaN;let u=1/0;for(let m=e[0];m<e[1];++m)for(let x=c[0];x<c[1];++x){if(Oa(a[m],a[m+1],s[x],s[x+1]))return 0;u=Math.min(u,am(a[m],a[m+1],s[x],s[x+1],p))}return u}function iy(a,e,s,c,p){if(!za(e,a.length)||!za(c,s.length))return NaN;let u=1/0;for(let m=e[0];m<=e[1];++m)for(let x=c[0];x<=c[1];++x)if((u=Math.min(u,p.distance(a[m],s[x])))===0)return u;return u}function kl(a,e,s){if(wc(a,e,!0))return 0;let c=1/0;for(const p of e){const u=p.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(p[0]!==p[u-1]&&(c=Math.min(c,s.pointToSegmentDistance(a,p[u-1],p[0])))===0||(c=Math.min(c,ty(a,p,s)))===0)return c}return c}function ix(a,e,s,c){if(!za(e,a.length))return NaN;for(let u=e[0];u<=e[1];++u)if(wc(a[u],s,!0))return 0;let p=1/0;for(let u=e[0];u<e[1];++u)for(const m of s)for(let x=0,S=m.length,P=S-1;x<S;P=x++){if(Oa(a[u],a[u+1],m[P],m[x]))return 0;p=Math.min(p,am(a[u],a[u+1],m[P],m[x],c))}return p}function ny(a,e){for(const s of a)for(let c=0;c<=s.length-1;++c)if(wc(s[c],e,!0))return!0;return!1}function lm(a,e,s,c=1/0){const p=Ol(a),u=Ol(e);if(c!==1/0&&zl(p,u,s)>=c)return c;if(Yu(p,u)){if(ny(a,e))return 0}else if(ny(e,a))return 0;let m=c;for(const x of a)for(let S=0,P=x.length,y=P-1;S<P;y=S++)for(const A of e)for(let I=0,E=A.length,M=E-1;I<E;M=I++){if(Oa(x[y],x[S],A[M],A[I]))return 0;m=Math.min(m,am(x[y],x[S],A[M],A[I],s))}return m}function Ju(a,e,s,c,p,u,m){if(u===null||m===null)return;const x=zl(Ll(c,u),Ll(p,m),s);x<e&&a.push({dist:x,range1:u,range2:m})}function ry(a,e,s,c,p=1/0){let u=Math.min(c.distance(a[0],s[0][0]),p);if(u===0)return u;const m=new Hr([{dist:0,range1:[0,a.length-1],range2:[0,0]}],im),x=e?Ku:$d,S=Ol(s);for(;m.length;){const P=m.pop();if(P.dist>=u)continue;const y=P.range1;if(Lr(y)<=x){if(!za(y,a.length))return NaN;if(e){const A=ix(a,y,s,c);if((u=Math.min(u,A))===0)return u}else for(let A=y[0];A<=y[1];++A){const I=kl(a[A],s,c);if((u=Math.min(u,I))===0)return u}}else{const A=nm(y,e);if(A[0]!==null){const I=zl(Ll(a,A[0]),S,c);I<u&&m.push({dist:I,range1:A[0],range2:[0,0]})}if(A[1]!==null){const I=zl(Ll(a,A[1]),S,c);I<u&&m.push({dist:I,range1:A[1],range2:[0,0]})}}}return u}function lo(a,e,s,c,p,u=1/0){let m=Math.min(u,p.distance(a[0],s[0]));if(m===0)return m;const x=new Hr([{dist:0,range1:[0,a.length-1],range2:[0,s.length-1]}],im),S=e?Ku:$d,P=c?Ku:$d;for(;x.length;){const y=x.pop();if(y.dist>=m)continue;const A=y.range1,I=y.range2;if(Lr(A)<=S&&Lr(I)<=P){if(!za(A,a.length)||!za(I,s.length))return NaN;if(e&&c?m=Math.min(m,tx(a,A,s,I,p)):e||c?e&&!c?m=Math.min(m,om(s,I,a,A,p)):!e&&c&&(m=Math.min(m,om(a,A,s,I,p))):m=Math.min(m,iy(a,A,s,I,p)),m===0)return m}else{const E=nm(A,e),M=nm(I,c);Ju(x,m,p,a,s,E[0],M[0]),Ju(x,m,p,a,s,E[0],M[1]),Ju(x,m,p,a,s,E[1],M[0]),Ju(x,m,p,a,s,E[1],M[1])}}return m}function qd(a,e,s,c,p=1/0){let u=p;const m=Ll(a,[0,a.length-1]);for(const x of s)if(!(u!==1/0&&zl(m,Ll(x,[0,x.length-1]),c)>=u)&&(u=Math.min(u,lo(a,e,x,!0,c,u)),u===0))return u;return u}function Qu(a,e,s,c,p=1/0){let u=p;const m=Ll(a,[0,a.length-1]);for(const x of s){if(u!==1/0&&zl(m,Ol(x),c)>=u)continue;const S=ry(a,e,x,c,u);if(isNaN(S))return S;if((u=Math.min(u,S))===0)return u}return u}function Hd(a){return a==="Point"||a==="MultiPoint"||a==="LineString"||a==="MultiLineString"||a==="Polygon"||a==="MultiPolygon"}class nl{constructor(e,s){this.type=Wt,this.geojson=e,this.geometries=s}static parse(e,s){if(e.length!==2)return s.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Da(e[1])){const c=e[1];if(c.type==="FeatureCollection"){for(let p=0;p<c.features.length;++p)if(Hd(c.features[p].geometry.type))return new nl(c,c.features[p].geometry)}else if(c.type==="Feature"){if(Hd(c.geometry.type))return new nl(c,c.geometry)}else if(Hd(c.type))return new nl(c,c)}return s.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const s=e.geometry(),c=e.canonicalID();if(s!=null&&c!=null){if(e.geometryType()==="Point")return function(p,u,m){const x=[];for(const P of p)for(const y of P)x.push(sm(y,u));const S=new Dl(x[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?lo(x,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",S):m.type==="MultiLineString"?qd(x,!1,m.coordinates,S):m.type==="Polygon"||m.type==="MultiPolygon"?Qu(x,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,S):null}(s,c,this.geometries);if(e.geometryType()==="LineString")return function(p,u,m){const x=[];for(const P of p){const y=[];for(const A of P)y.push(sm(A,u));x.push(y)}const S=new Dl(x[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return qd(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",x,S);if(m.type==="MultiLineString"){let P=1/0;for(let y=0;y<m.coordinates.length;y++){const A=qd(m.coordinates[y],!0,x,S,P);if(isNaN(A))return A;if((P=Math.min(P,A))===0)return P}return P}if(m.type==="Polygon"||m.type==="MultiPolygon"){let P=1/0;for(let y=0;y<x.length;y++){const A=Qu(x[y],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,S,P);if(isNaN(A))return A;if((P=Math.min(P,A))===0)return P}return P}return null}(s,c,this.geometries);if(e.geometryType()==="Polygon")return function(p,u,m){const x=[];for(const P of function(y,A){const I=y.length;if(I<=1)return[y];const E=[];let M,R;for(let z=0;z<I;z++){const F=Z1(y[z]);F!==0&&(y[z].area=Math.abs(F),R===void 0&&(R=F<0),R===F<0?(M&&E.push(M),M=[y[z]]):M.push(y[z]))}return M&&E.push(M),E}(p)){const y=[];for(let A=0;A<P.length;++A)y.push(ex(P[A],u));x.push(y)}const S=new Dl(x[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Qu(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",x,S);if(m.type==="MultiLineString"){let P=1/0;for(let y=0;y<m.coordinates.length;y++){const A=Qu(m.coordinates[y],!0,x,S,P);if(isNaN(A))return A;if((P=Math.min(P,A))===0)return P}return P}return m.type==="Polygon"||m.type==="MultiPolygon"?function(P,y,A){let I=1/0;for(const E of P)for(const M of y){const R=lm(E,M,A,I);if(isNaN(R))return R;if((I=Math.min(I,R))===0)return I}return I}(m.type==="Polygon"?[m.coordinates]:m.coordinates,x,S):null}(s,c,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Gd(a,e){switch(a){case"string":return ao(e);case"number":return+e;case"boolean":return!!e;case"color":return Qi.parse(e);case"formatted":return Qr.fromString(ao(e));case"resolvedImage":return qr.build(ao(e))}return e}function cm(a,e,s,c){return c!==void 0&&(a=c*Math.round(a/c)),e!==void 0&&a<e&&(a=e),s!==void 0&&a>s&&(a=s),a}class Fl{constructor(e,s,c){this.type=e,this.key=s,this.scope=c}static parse(e,s){let c=s.expectedType;if(c==null&&(c=Yi),e.length<2||e.length>3)return s.error("Invalid number of arguments for 'config' expression.");const p=s.parse(e[1],1);if(!(p instanceof Dr))return s.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const u=s.parse(e[2],2);return u instanceof Dr?new Fl(c,ao(p.value),ao(u.value)):s.error("Scope of 'config' expression must be a string literal.")}return new Fl(c,ao(p.value))}evaluate(e){const s=[this.key,this.scope,e.scope].filter(Boolean).join(""),c=e.getConfig(s);if(!c)return null;const{type:p,value:u,values:m,minValue:x,maxValue:S,stepValue:P}=c,y=c.default.evaluate(e);let A=y;if(u){const I=e.scope;e.scope=(I||"").split("").slice(1).join(""),A=u.evaluate(e),e.scope=I}return p&&(A=Gd(p,A)),A===void 0||x===void 0&&S===void 0&&P===void 0||(typeof A=="number"?A=cm(A,x,S,P):Array.isArray(A)&&(A=A.map(I=>typeof I=="number"?cm(I,x,S,P):I))),u!==void 0&&A!==void 0&&m&&!m.includes(A)&&(A=y,p&&(A=Gd(p,A))),(p&&p!==this.type||A!==void 0&&Vn(A)!==this.type)&&(A=Gd(this.type.kind,A)),A}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Sc(a){if(a instanceof vs&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof pi||a instanceof nl)return!1;let e=!0;return a.eachChild(s=>{e&&!Sc(s)&&(e=!1)}),e}function eh(a){if(a instanceof vs&&a.name==="feature-state")return!1;let e=!0;return a.eachChild(s=>{e&&!eh(s)&&(e=!1)}),e}function th(a){if(a instanceof Fl)return new Set([a.key]);let e=new Set;return a.eachChild(s=>{e=new Set([...e,...th(s)])}),e}function Nl(a,e){if(a instanceof vs&&e.indexOf(a.name)>=0)return!1;let s=!0;return a.eachChild(c=>{s&&!Nl(c,e)&&(s=!1)}),s}class Bl{constructor(e,s){this.type=s.type,this.name=e,this.boundExpression=s}static parse(e,s){if(e.length!==2||typeof e[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const c=e[1];return s.scope.has(c)?new Bl(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ac{constructor(e,s=[],c,p=new kd,u=[],m,x){this.registry=e,this.path=s,this.key=s.map(S=>typeof S=="string"?`['${S}']`:`[${S}]`).join(""),this.scope=p,this.errors=u,this.expectedType=c,this._scope=m,this.options=x}parse(e,s,c,p,u={}){return s||c?this.concat(s,null,c,p)._parse(e,u):this._parse(e,u)}parseObjectValue(e,s,c,p,u,m={}){return this.concat(s,c,p,u)._parse(e,m)}_parse(e,s){function c(p,u,m){return m==="assert"?new Mo(u,[p]):m==="coerce"?new La(u,[p]):p}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(p){let u=p.parse(e,this);if(!u)return null;if(this.expectedType){const m=this.expectedType,x=u.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||x.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(m,x))return null}else u=c(u,m,s.typeAnnotation||"coerce");else u=c(u,m,s.typeAnnotation||"assert")}if(!(u instanceof Dr)&&u.type.kind!=="resolvedImage"&&Wd(u)){const m=new Yp(this._scope,this.options);try{u=new Dr(u.type,u.evaluate(m))}catch(x){return this.error(x.message),null}}return u}return La.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,s,c,p){let u=typeof e=="number"?this.path.concat(e):this.path;u=typeof s=="string"?u.concat(s):u;const m=p?this.scope.concat(p):this.scope;return new Ac(this.registry,u,c||null,m,this.errors,this._scope,this.options)}error(e,...s){const c=`${this.key}${s.map(p=>`[${p}]`).join("")}`;this.errors.push(new Ri(c,e))}checkSubtype(e,s){const c=ys(e,s);return c&&this.error(c),c}}var ih=Ac;function Wd(a){if(a instanceof Bl)return Wd(a.boundExpression);if(a instanceof vs&&a.name==="error"||a instanceof Bd||a instanceof pi||a instanceof nl||a instanceof Fl)return!1;const e=a instanceof La||a instanceof Mo;let s=!0;return a.eachChild(c=>{s=e?s&&Wd(c):s&&c instanceof Dr}),!!s&&Sc(a)&&Nl(a,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function nh(a,e){const s=a.length-1;let c,p,u=0,m=s,x=0;for(;u<=m;)if(x=Math.floor((u+m)/2),c=a[x],p=a[x+1],c<=e){if(x===s||e<p)return x;u=x+1}else{if(!(c>e))throw new ir("Input is not a number.");m=x-1}return 0}class Mc{constructor(e,s,c){this.type=e,this.input=s,this.labels=[],this.outputs=[];for(const[p,u]of c)this.labels.push(p),this.outputs.push(u)}static parse(e,s){if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");const c=s.parse(e[1],1,Wt);if(!c)return null;const p=[];let u=null;s.expectedType&&s.expectedType.kind!=="value"&&(u=s.expectedType);for(let m=1;m<e.length;m+=2){const x=m===1?-1/0:e[m],S=e[m+1],P=m,y=m+1;if(typeof x!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(p.length&&p[p.length-1][0]>=x)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const A=s.parse(S,y,u);if(!A)return null;u=u||A.type,p.push([x,A])}return new Mc(u,c,p)}evaluate(e){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(e);const p=this.input.evaluate(e);if(p<=s[0])return c[0].evaluate(e);const u=s.length;return p>=s[u-1]?c[u-1].evaluate(e):c[nh(s,p)].evaluate(e)}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&e.push(this.labels[s]),e.push(this.outputs[s].serialize());return e}}const Vl=.95047,Vi=1.08883,sy=4/29,Cc=6/29,oy=3*Cc*Cc,ay=Cc*Cc*Cc,nx=Math.PI/180,An=180/Math.PI;function um(a){return a>ay?Math.pow(a,1/3):a/oy+sy}function hm(a){return a>Cc?a*a*a:oy*(a-sy)}function dm(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function fm(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function ly(a){const e=fm(a.r),s=fm(a.g),c=fm(a.b),p=um((.4124564*e+.3575761*s+.1804375*c)/Vl),u=um((.2126729*e+.7151522*s+.072175*c)/1);return{l:116*u-16,a:500*(p-u),b:200*(u-um((.0193339*e+.119192*s+.9503041*c)/Vi)),alpha:a.a}}function cy(a){let e=(a.l+16)/116,s=isNaN(a.a)?e:e+a.a/500,c=isNaN(a.b)?e:e-a.b/200;return e=1*hm(e),s=Vl*hm(s),c=Vi*hm(c),new Qi(dm(3.2404542*s-1.5371385*e-.4985314*c),dm(-.969266*s+1.8760108*e+.041556*c),dm(.0556434*s-.2040259*e+1.0572252*c),a.alpha)}function rx(a,e,s){const c=e-a;return a+s*(c>180||c<-180?c-360*Math.round(c/360):c)}const rh={forward:ly,reverse:cy,interpolate:function(a,e,s){return{l:di(a.l,e.l,s),a:di(a.a,e.a,s),b:di(a.b,e.b,s),alpha:di(a.alpha,e.alpha,s)}}},sh={forward:function(a){const{l:e,a:s,b:c}=ly(a),p=Math.atan2(c,s)*An;return{h:p<0?p+360:p,c:Math.sqrt(s*s+c*c),l:e,alpha:a.a}},reverse:function(a){const e=a.h*nx,s=a.c;return cy({l:a.l,a:Math.cos(e)*s,b:Math.sin(e)*s,alpha:a.alpha})},interpolate:function(a,e,s){return{h:rx(a.h,e.h,s),c:di(a.c,e.c,s),l:di(a.l,e.l,s),alpha:di(a.alpha,e.alpha,s)}}};var uy=Object.freeze({__proto__:null,hcl:sh,lab:rh});class Ms{constructor(e,s,c,p,u,m){this.type=e,this.operator=s,this.interpolation=c,this.input=p,this.dynamicStops=u,this.labels=[],this.outputs=[];for(const[x,S]of m)this.labels.push(x),this.outputs.push(S)}static interpolationFactor(e,s,c,p){let u=0;if(e.name==="exponential")u=pm(s,e.base,c,p);else if(e.name==="linear")u=pm(s,1,c,p);else if(e.name==="cubic-bezier"){const m=e.controlPoints;u=new ro(m[0],m[1],m[2],m[3]).solve(pm(s,1,c,p))}return u}static parse(e,s){let[c,p,u,...m]=e;if(!Array.isArray(p)||p.length===0)return s.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const P=p[1];if(typeof P!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:P}}else{if(p[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const P=p.slice(1);if(P.length!==4||P.some(y=>typeof y!="number"||y<0||y>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:P}}}if(e.length-1<3)return s.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(u=s.parse(u,2,Wt),!u)return null;const x=[];let S=null;if(c==="interpolate-hcl"||c==="interpolate-lab"?S=Jr:s.expectedType&&s.expectedType.kind!=="value"&&(S=s.expectedType),e.length-1==3){const P=s.parse(m[0],3,Yi);return P?new Ms(S,c,p,u,P,x):null}for(let P=0;P<m.length;P+=2){const y=m[P],A=m[P+1],I=P+3,E=P+4;if(typeof y!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(x.length&&x[x.length-1][0]>=y)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const M=s.parse(A,E,S);if(!M)return null;S=S||M.type,x.push([y,M])}return S.kind==="number"||S.kind==="color"||S.kind==="array"&&S.itemType.kind==="number"&&typeof S.N=="number"?new Ms(S,c,p,u,null,x):s.error(`Type ${qn(S)} is not interpolatable.`)}evaluate(e){let s=this.labels,c=this.outputs;if(this.dynamicStops){const y=this.dynamicStops.evaluate(e);if(y.length%2!=0)throw new ir("Expected an even number of arguments.");s=[],c=[];for(let A=0;A<y.length;A+=2){const I=y[A],E=new Dr(Wt,y[A+1]);if(typeof I!="number")throw new ir('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.');if(s.length&&s[s.length-1]>=I)throw new ir('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.');s.push(I),c.push(E)}if(s.length===0)throw new ir("Expected at least one input/output pair.")}if(s.length===1)return c[0].evaluate(e);const p=this.input.evaluate(e);if(p<=s[0])return c[0].evaluate(e);const u=s.length;if(p>=s[u-1])return c[u-1].evaluate(e);const m=nh(s,p),x=Ms.interpolationFactor(this.interpolation,p,s[m],s[m+1]),S=c[m].evaluate(e),P=c[m+1].evaluate(e);return this.operator==="interpolate"?Od[this.type.kind.toLowerCase()](S,P,x):this.operator==="interpolate-hcl"?sh.reverse(sh.interpolate(sh.forward(S),sh.forward(P),x)):rh.reverse(rh.interpolate(rh.forward(S),rh.forward(P),x))}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,e,this.input.serialize()];if(this.dynamicStops)s.push(this.dynamicStops.serialize());else for(let c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s}}function pm(a,e,s,c){const p=c-s,u=a-s;return p===0?0:e===1?u/p:(Math.pow(e,u)-1)/(Math.pow(e,p)-1)}class Zd{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expectected at least one argument.");let c=null;const p=s.expectedType;p&&p.kind!=="value"&&(c=p);const u=[];for(const x of e.slice(1)){const S=s.parse(x,1+u.length,c,void 0,{typeAnnotation:"omit"});if(!S)return null;c=c||S.type,u.push(S)}const m=p&&u.some(x=>ys(p,x.type));return new Zd(m?Yi:c,u)}evaluate(e){let s,c=null,p=0;for(const u of this.args){if(p++,c=u.evaluate(e),c&&c instanceof qr&&!c.available&&(s||(s=c),c=null,p===this.args.length))return s;if(c!==null)break}return c}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(s=>{e.push(s.serialize())}),e}}class Xd{constructor(e,s){this.type=s.type,this.bindings=[].concat(e),this.result=s}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const s of this.bindings)e(s[1]);e(this.result)}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const c=[];for(let u=1;u<e.length-1;u+=2){const m=e[u];if(typeof m!="string")return s.error(`Expected string, but found ${typeof m} instead.`,u);if(/[^a-zA-Z0-9_]/.test(m))return s.error("Variable names must contain only alphanumeric characters or '_'.",u);const x=s.parse(e[u+1],u+1);if(!x)return null;c.push([m,x])}const p=s.parse(e[e.length-1],e.length-1,s.expectedType,c);return p?new Xd(c,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[s,c]of this.bindings)e.push(s,c.serialize());return e.push(this.result.serialize()),e}}class mm{constructor(e,s,c){this.type=e,this.index=s,this.input=c}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=s.parse(e[1],1,Wt),p=s.parse(e[2],2,Rr(s.expectedType||Yi));return c&&p?new mm(p.type.itemType,c,p):null}evaluate(e){const s=this.index.evaluate(e),c=this.input.evaluate(e);if(s<0)throw new ir(`Array index out of bounds: ${s} < 0.`);if(s>c.length-1)throw new ir(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s===Math.floor(s))return c[s];const p=Math.floor(s),u=Math.ceil(s),m=c[p],x=c[u];if(typeof m!="number"||typeof x!="number")throw new ir(`Cannot interpolate between non-number values at index ${s}.`);const S=s-p;return m*(1-S)+x*S}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class _m{constructor(e,s){this.type=qi,this.needle=e,this.haystack=s}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=s.parse(e[1],1,Yi),p=s.parse(e[2],2,Yi);return c&&p?Fd(c.type,[qi,rn,Wt,Il,Yi])?new _m(c,p):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${qn(c.type)} instead`):null}evaluate(e){const s=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(c==null)return!1;if(!$u(s,["boolean","string","number","null"]))throw new ir(`Expected first argument to be of type boolean, string, number or null, but found ${qn(Vn(s))} instead.`);if(!$u(c,["string","array"]))throw new ir(`Expected second argument to be of type array or string, but found ${qn(Vn(c))} instead.`);return c.indexOf(s)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Yd{constructor(e,s,c){this.type=Wt,this.needle=e,this.haystack=s,this.fromIndex=c}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const c=s.parse(e[1],1,Yi),p=s.parse(e[2],2,Yi);if(!c||!p)return null;if(!Fd(c.type,[qi,rn,Wt,Il,Yi]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${qn(c.type)} instead`);if(e.length===4){const u=s.parse(e[3],3,Wt);return u?new Yd(c,p,u):null}return new Yd(c,p)}evaluate(e){const s=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(!$u(s,["boolean","string","number","null"]))throw new ir(`Expected first argument to be of type boolean, string, number or null, but found ${qn(Vn(s))} instead.`);if(!$u(c,["string","array"]))throw new ir(`Expected second argument to be of type array or string, but found ${qn(Vn(c))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(e);return c.indexOf(s,p)}return c.indexOf(s)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class gm{constructor(e,s,c,p,u,m){this.inputType=e,this.type=s,this.input=c,this.cases=p,this.outputs=u,this.otherwise=m}static parse(e,s){if(e.length<5)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return s.error("Expected an even number of arguments.");let c,p;s.expectedType&&s.expectedType.kind!=="value"&&(p=s.expectedType);const u={},m=[];for(let P=2;P<e.length-1;P+=2){let y=e[P];const A=e[P+1];Array.isArray(y)||(y=[y]);const I=s.concat(P);if(y.length===0)return I.error("Expected at least one branch label.");for(const M of y){if(typeof M!="number"&&typeof M!="string")return I.error("Branch labels must be numbers or strings.");if(typeof M=="number"&&Math.abs(M)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof M=="number"&&Math.floor(M)!==M)return I.error("Numeric branch labels must be integer values.");if(c){if(I.checkSubtype(c,Vn(M)))return null}else c=Vn(M);if(u[String(M)]!==void 0)return I.error("Branch labels must be unique.");u[String(M)]=m.length}const E=s.parse(A,P,p);if(!E)return null;p=p||E.type,m.push(E)}const x=s.parse(e[1],1,Yi);if(!x)return null;const S=s.parse(e[e.length-1],e.length-1,p);return S?x.type.kind!=="value"&&s.concat(1).checkSubtype(c,x.type)?null:new gm(c,p,x,u,m,S):null}evaluate(e){const s=this.input.evaluate(e);return(Vn(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),c=[],p={};for(const m of s){const x=p[this.cases[m]];x===void 0?(p[this.cases[m]]=c.length,c.push([this.cases[m],[m]])):c[x][1].push(m)}const u=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,x]of c)e.push(x.length===1?u(x[0]):x.map(u)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}class ym{constructor(e,s,c){this.type=e,this.branches=s,this.otherwise=c}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);const p=[];for(let m=1;m<e.length-1;m+=2){const x=s.parse(e[m],m,qi);if(!x)return null;const S=s.parse(e[m+1],m+1,c);if(!S)return null;p.push([x,S]),c=c||S.type}const u=s.parse(e[e.length-1],e.length-1,c);return u?new ym(c,p,u):null}evaluate(e){for(const[s,c]of this.branches)if(s.evaluate(e))return c.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[s,c]of this.branches)e(s),e(c);e(this.otherwise)}outputDefined(){return this.branches.every(([e,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(s=>{e.push(s.serialize())}),e}}class Kd{constructor(e,s,c,p){this.type=e,this.input=s,this.beginIndex=c,this.endIndex=p}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const c=s.parse(e[1],1,Yi),p=s.parse(e[2],2,Wt);if(!c||!p)return null;if(!Fd(c.type,[Rr(Yi),rn,Yi]))return s.error(`Expected first argument to be of type array or string, but found ${qn(c.type)} instead`);if(e.length===4){const u=s.parse(e[3],3,Wt);return u?new Kd(c.type,c,p,u):null}return new Kd(c.type,c,p)}evaluate(e){const s=this.input.evaluate(e),c=this.beginIndex.evaluate(e);if(!$u(s,["string","array"]))throw new ir(`Expected first argument to be of type array or string, but found ${qn(Vn(s))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(e);return s.slice(c,p)}return s.slice(c)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function hy(a,e){return a==="=="||a==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function dy(a,e,s,c){return c.compare(e,s)===0}function Ic(a,e,s){const c=a!=="=="&&a!=="!=";return class WO{constructor(u,m,x){this.type=qi,this.lhs=u,this.rhs=m,this.collator=x,this.hasUntypedArgument=u.type.kind==="value"||m.type.kind==="value"}static parse(u,m){if(u.length!==3&&u.length!==4)return m.error("Expected two or three arguments.");const x=u[0];let S=m.parse(u[1],1,Yi);if(!S)return null;if(!hy(x,S.type))return m.concat(1).error(`"${x}" comparisons are not supported for type '${qn(S.type)}'.`);let P=m.parse(u[2],2,Yi);if(!P)return null;if(!hy(x,P.type))return m.concat(2).error(`"${x}" comparisons are not supported for type '${qn(P.type)}'.`);if(S.type.kind!==P.type.kind&&S.type.kind!=="value"&&P.type.kind!=="value")return m.error(`Cannot compare types '${qn(S.type)}' and '${qn(P.type)}'.`);c&&(S.type.kind==="value"&&P.type.kind!=="value"?S=new Mo(P.type,[S]):S.type.kind!=="value"&&P.type.kind==="value"&&(P=new Mo(S.type,[P])));let y=null;if(u.length===4){if(S.type.kind!=="string"&&P.type.kind!=="string"&&S.type.kind!=="value"&&P.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(y=m.parse(u[3],3,Uu),!y)return null}return new WO(S,P,y)}evaluate(u){const m=this.lhs.evaluate(u),x=this.rhs.evaluate(u);if(c&&this.hasUntypedArgument){const S=Vn(m),P=Vn(x);if(S.kind!==P.kind||S.kind!=="string"&&S.kind!=="number")throw new ir(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${S.kind}, ${P.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const S=Vn(m),P=Vn(x);if(S.kind!=="string"||P.kind!=="string")return e(u,m,x)}return this.collator?s(u,m,x,this.collator.evaluate(u)):e(u,m,x)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[a];return this.eachChild(m=>{u.push(m.serialize())}),u}}}const sx=Ic("==",function(a,e,s){return e===s},dy),ox=Ic("!=",function(a,e,s){return e!==s},function(a,e,s,c){return!dy(0,e,s,c)}),ax=Ic("<",function(a,e,s){return e<s},function(a,e,s,c){return c.compare(e,s)<0}),lx=Ic(">",function(a,e,s){return e>s},function(a,e,s,c){return c.compare(e,s)>0}),cx=Ic("<=",function(a,e,s){return e<=s},function(a,e,s,c){return c.compare(e,s)<=0}),ux=Ic(">=",function(a,e,s){return e>=s},function(a,e,s,c){return c.compare(e,s)>=0});class vm{constructor(e,s,c,p,u,m){this.type=rn,this.number=e,this.locale=s,this.currency=c,this.unit=p,this.minFractionDigits=u,this.maxFractionDigits=m}static parse(e,s){if(e.length!==3)return s.error("Expected two arguments.");const c=s.parse(e[1],1,Wt);if(!c)return null;const p=e[2];if(typeof p!="object"||Array.isArray(p))return s.error("NumberFormat options argument must be an object.");let u=null;if(p.locale&&(u=s.parseObjectValue(p.locale,2,"locale",rn),!u))return null;let m=null;if(p.currency&&(m=s.parseObjectValue(p.currency,2,"currency",rn),!m))return null;let x=null;if(p.unit&&(x=s.parseObjectValue(p.unit,2,"unit",rn),!x))return null;let S=null;if(p["min-fraction-digits"]&&(S=s.parseObjectValue(p["min-fraction-digits"],2,"min-fraction-digits",Wt),!S))return null;let P=null;return p["max-fraction-digits"]&&(P=s.parseObjectValue(p["max-fraction-digits"],2,"max-fraction-digits",Wt),!P)?null:new vm(c,u,m,x,S,P)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class xm{constructor(e){this.type=Wt,this.input=e}static parse(e,s){if(e.length!==2)return s.error(`Expected 1 argument, but found ${e.length-1} instead.`);const c=s.parse(e[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${qn(c.type)} instead.`):new xm(c):null}evaluate(e){const s=this.input.evaluate(e);if(typeof s=="string"||Array.isArray(s))return s.length;throw new ir(`Expected value to be of type string or array, but found ${qn(Vn(s))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(s=>{e.push(s.serialize())}),e}}function Jd(a){return function(){a=1831565813+(a|=0)|0;let e=Math.imul(a^a>>>15,1|a);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Pc={"==":sx,"!=":ox,">":lx,"<":ax,">=":ux,"<=":cx,array:Mo,at:mm,boolean:Mo,case:ym,coalesce:Zd,collator:Bd,format:Pl,image:Gu,in:_m,"index-of":Yd,interpolate:Ms,"interpolate-hcl":Ms,"interpolate-lab":Ms,length:xm,let:Xd,literal:Dr,match:gm,number:Mo,"number-format":vm,object:Mo,slice:Kd,step:Mc,string:Mo,"to-boolean":La,"to-color":La,"to-number":La,"to-string":La,var:Bl,within:pi,distance:nl,config:Fl};function bm(a,[e,s,c,p]){e=e.evaluate(a),s=s.evaluate(a),c=c.evaluate(a);const u=p?p.evaluate(a):1,m=Zp(e,s,c,u);if(m)throw new ir(m);return new Qi(e/255*u,s/255*u,c/255*u,u)}function fy(a,[e,s,c,p]){e=e.evaluate(a),s=s.evaluate(a),c=c.evaluate(a);const u=p?p.evaluate(a):1,m=function(P,y,A,I){return typeof P=="number"&&P>=0&&P<=360?typeof y=="number"&&y>=0&&y<=100&&typeof A=="number"&&A>=0&&A<=100?I===void 0||typeof I=="number"&&I>=0&&I<=1?null:`Invalid hsla value [${[P,y,A,I].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof I=="number"?[P,y,A,I]:[P,y,A]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof I=="number"?[P,y,A,I]:[P,y,A]).join(", ")}]: 'h' must be between 0 and 360.`}(e,s,c,u);if(m)throw new ir(m);const x=`hsla(${e}, ${s}%, ${c}%, ${u})`,S=Qi.parse(x);if(!S)throw new ir(`Failed to parse HSLA color: ${x}`);return S}function py(a,e){return a in e}function wm(a,e){const s=e[a];return s===void 0?null:s}function rl(a){return{type:a}}function Tm(a){return{result:"success",value:a}}function js(a){return{result:"error",value:a}}function Qd(a,e){return!!a&&!!a.parameters&&a.parameters.indexOf(e)>-1}function oh(a){return a["property-type"]==="data-driven"}function my(a){return Qd(a.expression,"measure-light")}function ef(a){return Qd(a.expression,"zoom")}function ah(a){return!!a.expression&&a.expression.interpolated}function Em(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function hx(a){return a}function Sm(a,e){const s=e.type==="color",c=a.stops&&typeof a.stops[0][0]=="object",p=c||!(c||a.property!==void 0),u=a.type||(ah(e)?"exponential":"interval");if(s&&((a=zd({},a)).stops&&(a.stops=a.stops.map(P=>[P[0],Qi.parse(P[1])])),a.default=Qi.parse(a.default?a.default:e.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!uy[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let m,x,S;if(u==="exponential")m=_y;else if(u==="interval")m=fx;else if(u==="categorical"){m=dx,x=Object.create(null);for(const P of a.stops)x[P[0]]=P[1];S=typeof a.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);m=gy}if(c){const P={},y=[];for(let E=0;E<a.stops.length;E++){const M=a.stops[E],R=M[0].zoom;P[R]===void 0&&(P[R]={zoom:R,type:a.type,property:a.property,default:a.default,stops:[]},y.push(R)),P[R].stops.push([M[0].value,M[1]])}const A=[];for(const E of y)A.push([P[E].zoom,Sm(P[E],e)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:Ms.interpolationFactor.bind(void 0,I),zoomStops:A.map(E=>E[0]),evaluate:({zoom:E},M)=>_y({stops:A,base:a.base},e,E).evaluate(E,M)}}if(p){const P=u==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:Ms.interpolationFactor.bind(void 0,P),zoomStops:a.stops.map(y=>y[0]),evaluate:({zoom:y})=>m(a,e,y,x,S)}}return{kind:"source",evaluate(P,y){const A=y&&y.properties?y.properties[a.property]:void 0;return A===void 0?Rc(a.default,e.default):m(a,e,A,x,S)}}}function Rc(a,e,s){return a!==void 0?a:e!==void 0?e:s!==void 0?s:void 0}function dx(a,e,s,c,p){return Rc(typeof s===p?c[s]:void 0,a.default,e.default)}function fx(a,e,s){if(Co(s)!=="number")return Rc(a.default,e.default);const c=a.stops.length;if(c===1||s<=a.stops[0][0])return a.stops[0][1];if(s>=a.stops[c-1][0])return a.stops[c-1][1];const p=nh(a.stops.map(u=>u[0]),s);return a.stops[p][1]}function _y(a,e,s){const c=a.base!==void 0?a.base:1;if(Co(s)!=="number")return Rc(a.default,e.default);const p=a.stops.length;if(p===1||s<=a.stops[0][0])return a.stops[0][1];if(s>=a.stops[p-1][0])return a.stops[p-1][1];const u=nh(a.stops.map(y=>y[0]),s),m=function(y,A,I,E){const M=E-I,R=y-I;return M===0?0:A===1?R/M:(Math.pow(A,R)-1)/(Math.pow(A,M)-1)}(s,c,a.stops[u][0],a.stops[u+1][0]),x=a.stops[u][1],S=a.stops[u+1][1];let P=Od[e.type]||hx;if(a.colorSpace&&a.colorSpace!=="rgb"){const y=uy[a.colorSpace];P=(A,I)=>y.reverse(y.interpolate(y.forward(A),y.forward(I),m))}return typeof x.evaluate=="function"?{evaluate(...y){const A=x.evaluate.apply(void 0,y),I=S.evaluate.apply(void 0,y);if(A!==void 0&&I!==void 0)return P(A,I,m)}}:P(x,S,m)}function gy(a,e,s){return e.type==="color"?s=Qi.parse(s):e.type==="formatted"?s=Qr.fromString(s.toString()):e.type==="resolvedImage"?s=qr.build(s.toString()):Co(s)===e.type||e.type==="enum"&&e.values[s]||(s=void 0),Rc(s,a.default,e.default)}vs.register(Pc,{error:[{kind:"error"},[rn],(a,[e])=>{throw new ir(e.evaluate(a))}],typeof:[rn,[Yi],(a,[e])=>qn(Vn(e.evaluate(a)))],"to-rgba":[Rr(Wt,4),[Jr],(a,[e])=>e.evaluate(a).toRenderColor(null).toArray()],"to-hsla":[Rr(Wt,4),[Jr],(a,[e])=>e.evaluate(a).toRenderColor(null).toHslaArray()],rgb:[Jr,[Wt,Wt,Wt],bm],rgba:[Jr,[Wt,Wt,Wt,Wt],bm],hsl:[Jr,[Wt,Wt,Wt],fy],hsla:[Jr,[Wt,Wt,Wt,Wt],fy],has:{type:qi,overloads:[[[rn],(a,[e])=>py(e.evaluate(a),a.properties())],[[rn,Ra],(a,[e,s])=>py(e.evaluate(a),s.evaluate(a))]]},get:{type:Yi,overloads:[[[rn],(a,[e])=>wm(e.evaluate(a),a.properties())],[[rn,Ra],(a,[e,s])=>wm(e.evaluate(a),s.evaluate(a))]]},"feature-state":[Yi,[rn],(a,[e])=>wm(e.evaluate(a),a.featureState||{})],properties:[Ra,[],a=>a.properties()],"geometry-type":[rn,[],a=>a.geometryType()],id:[Yi,[],a=>a.id()],zoom:[Wt,[],a=>a.globals.zoom],pitch:[Wt,[],a=>a.globals.pitch||0],"distance-from-center":[Wt,[],a=>a.distanceFromCenter()],"measure-light":[Wt,[rn],(a,[e])=>a.measureLight(e.evaluate(a))],"heatmap-density":[Wt,[],a=>a.globals.heatmapDensity||0],"line-progress":[Wt,[],a=>a.globals.lineProgress||0],"raster-value":[Wt,[],a=>a.globals.rasterValue||0],"raster-particle-speed":[Wt,[],a=>a.globals.rasterParticleSpeed||0],"sky-radial-progress":[Wt,[],a=>a.globals.skyRadialProgress||0],accumulated:[Yi,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[Wt,rl(Wt),(a,e)=>{let s=0;for(const c of e)s+=c.evaluate(a);return s}],"*":[Wt,rl(Wt),(a,e)=>{let s=1;for(const c of e)s*=c.evaluate(a);return s}],"-":{type:Wt,overloads:[[[Wt,Wt],(a,[e,s])=>e.evaluate(a)-s.evaluate(a)],[[Wt],(a,[e])=>-e.evaluate(a)]]},"/":[Wt,[Wt,Wt],(a,[e,s])=>e.evaluate(a)/s.evaluate(a)],"%":[Wt,[Wt,Wt],(a,[e,s])=>e.evaluate(a)%s.evaluate(a)],ln2:[Wt,[],()=>Math.LN2],pi:[Wt,[],()=>Math.PI],e:[Wt,[],()=>Math.E],"^":[Wt,[Wt,Wt],(a,[e,s])=>Math.pow(e.evaluate(a),s.evaluate(a))],sqrt:[Wt,[Wt],(a,[e])=>Math.sqrt(e.evaluate(a))],log10:[Wt,[Wt],(a,[e])=>Math.log(e.evaluate(a))/Math.LN10],ln:[Wt,[Wt],(a,[e])=>Math.log(e.evaluate(a))],log2:[Wt,[Wt],(a,[e])=>Math.log(e.evaluate(a))/Math.LN2],sin:[Wt,[Wt],(a,[e])=>Math.sin(e.evaluate(a))],cos:[Wt,[Wt],(a,[e])=>Math.cos(e.evaluate(a))],tan:[Wt,[Wt],(a,[e])=>Math.tan(e.evaluate(a))],asin:[Wt,[Wt],(a,[e])=>Math.asin(e.evaluate(a))],acos:[Wt,[Wt],(a,[e])=>Math.acos(e.evaluate(a))],atan:[Wt,[Wt],(a,[e])=>Math.atan(e.evaluate(a))],min:[Wt,rl(Wt),(a,e)=>Math.min(...e.map(s=>s.evaluate(a)))],max:[Wt,rl(Wt),(a,e)=>Math.max(...e.map(s=>s.evaluate(a)))],abs:[Wt,[Wt],(a,[e])=>Math.abs(e.evaluate(a))],round:[Wt,[Wt],(a,[e])=>{const s=e.evaluate(a);return s<0?-Math.round(-s):Math.round(s)}],floor:[Wt,[Wt],(a,[e])=>Math.floor(e.evaluate(a))],ceil:[Wt,[Wt],(a,[e])=>Math.ceil(e.evaluate(a))],"filter-==":[qi,[rn,Yi],(a,[e,s])=>a.properties()[e.value]===s.value],"filter-id-==":[qi,[Yi],(a,[e])=>a.id()===e.value],"filter-type-==":[qi,[rn],(a,[e])=>a.geometryType()===e.value],"filter-<":[qi,[rn,Yi],(a,[e,s])=>{const c=a.properties()[e.value],p=s.value;return typeof c==typeof p&&c<p}],"filter-id-<":[qi,[Yi],(a,[e])=>{const s=a.id(),c=e.value;return typeof s==typeof c&&s<c}],"filter->":[qi,[rn,Yi],(a,[e,s])=>{const c=a.properties()[e.value],p=s.value;return typeof c==typeof p&&c>p}],"filter-id->":[qi,[Yi],(a,[e])=>{const s=a.id(),c=e.value;return typeof s==typeof c&&s>c}],"filter-<=":[qi,[rn,Yi],(a,[e,s])=>{const c=a.properties()[e.value],p=s.value;return typeof c==typeof p&&c<=p}],"filter-id-<=":[qi,[Yi],(a,[e])=>{const s=a.id(),c=e.value;return typeof s==typeof c&&s<=c}],"filter->=":[qi,[rn,Yi],(a,[e,s])=>{const c=a.properties()[e.value],p=s.value;return typeof c==typeof p&&c>=p}],"filter-id->=":[qi,[Yi],(a,[e])=>{const s=a.id(),c=e.value;return typeof s==typeof c&&s>=c}],"filter-has":[qi,[Yi],(a,[e])=>e.value in a.properties()],"filter-has-id":[qi,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[qi,[Rr(rn)],(a,[e])=>e.value.indexOf(a.geometryType())>=0],"filter-id-in":[qi,[Rr(Yi)],(a,[e])=>e.value.indexOf(a.id())>=0],"filter-in-small":[qi,[rn,Rr(Yi)],(a,[e,s])=>s.value.indexOf(a.properties()[e.value])>=0],"filter-in-large":[qi,[rn,Rr(Yi)],(a,[e,s])=>function(c,p,u,m){for(;u<=m;){const x=u+m>>1;if(p[x]===c)return!0;p[x]>c?m=x-1:u=x+1}return!1}(a.properties()[e.value],s.value,0,s.value.length-1)],all:{type:qi,overloads:[[[qi,qi],(a,[e,s])=>e.evaluate(a)&&s.evaluate(a)],[rl(qi),(a,e)=>{for(const s of e)if(!s.evaluate(a))return!1;return!0}]]},any:{type:qi,overloads:[[[qi,qi],(a,[e,s])=>e.evaluate(a)||s.evaluate(a)],[rl(qi),(a,e)=>{for(const s of e)if(s.evaluate(a))return!0;return!1}]]},"!":[qi,[qi],(a,[e])=>!e.evaluate(a)],"is-supported-script":[qi,[rn],(a,[e])=>{const s=a.globals&&a.globals.isSupportedScript;return!s||s(e.evaluate(a))}],upcase:[rn,[rn],(a,[e])=>e.evaluate(a).toUpperCase()],downcase:[rn,[rn],(a,[e])=>e.evaluate(a).toLowerCase()],concat:[rn,rl(Yi),(a,e)=>e.map(s=>ao(s.evaluate(a))).join("")],"resolved-locale":[rn,[Uu],(a,[e])=>e.evaluate(a).resolvedLocale()],random:[Wt,[Wt,Wt,Yi],(a,e)=>{const[s,c,p]=e.map(m=>m.evaluate(a));if(s>c||s===c)return s;let u;if(typeof p=="string")u=function(m){let x=0;if(m.length===0)return x;for(let S=0;S<m.length;S++)x=(x<<5)-x+m.charCodeAt(S),x|=0;return x}(p);else{if(typeof p!="number")throw new ir(`Invalid seed input: ${p}`);u=p}return s+Jd(u)()*(c-s)}]});class tf{constructor(e,s,c,p){this.expression=e,this._warningHistory={},this._evaluator=new Yp(c,p),this._defaultValue=s?function(u){return u.type==="color"&&(Em(u.default)||Array.isArray(u.default))?new Qi(0,0,0,0):u.type==="color"?Qi.parse(u.default)||null:u.default===void 0?null:u.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null,this.configDependencies=th(e)}evaluateWithoutErrorHandling(e,s,c,p,u,m,x,S){return this._evaluator.globals=e,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=p||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=S||null,this.expression.evaluate(this._evaluator)}evaluate(e,s,c,p,u,m,x,S){this._evaluator.globals=e,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=S||null;try{const P=this.expression.evaluate(this._evaluator);if(P==null||typeof P=="number"&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new ir(`Expected value to be one of ${Object.keys(this._enumValues).map(y=>JSON.stringify(y)).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${P.message}`)),this._defaultValue}}}function Dc(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Pc}function Lc(a,e,s,c){const p=new ih(Pc,[],e?function(m){const x={color:Jr,string:rn,number:Wt,enum:rn,boolean:qi,formatted:ta,resolvedImage:ju};return m.type==="array"?Rr(x[m.value]||Yi,m.length):x[m.type]}(e):void 0,void 0,void 0,s,c),u=p.parse(a,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Tm(new tf(u,e,s,c)):js(p.errors)}class nf{constructor(e,s,c,p){this.kind=e,this._styleExpression=s,this.isLightConstant=c,this.isLineProgressConstant=p,this.isStateDependent=e!=="constant"&&!eh(s.expression),this.configDependencies=th(s.expression)}evaluateWithoutErrorHandling(e,s,c,p,u,m){return this._styleExpression.evaluateWithoutErrorHandling(e,s,c,p,u,m)}evaluate(e,s,c,p,u,m){return this._styleExpression.evaluate(e,s,c,p,u,m)}}class lh{constructor(e,s,c,p,u,m){this.kind=e,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=e!=="camera"&&!eh(s.expression),this.isLightConstant=u,this.isLineProgressConstant=m,this.configDependencies=th(s.expression),this.interpolationType=p}evaluateWithoutErrorHandling(e,s,c,p,u,m){return this._styleExpression.evaluateWithoutErrorHandling(e,s,c,p,u,m)}evaluate(e,s,c,p,u,m){return this._styleExpression.evaluate(e,s,c,p,u,m)}interpolationFactor(e,s,c){return this.interpolationType?Ms.interpolationFactor(this.interpolationType,e,s,c):0}}function yy(a,e,s,c){if((a=Lc(a,e,s,c)).result==="error")return a;const p=a.value.expression,u=Sc(p);if(!u&&!oh(e))return js([new Ri("","data expressions not supported")]);const m=Nl(p,["zoom","pitch","distance-from-center"]);if(!m&&!ef(e))return js([new Ri("","zoom expressions not supported")]);const x=Nl(p,["measure-light"]);if(!x&&!my(e))return js([new Ri("","measure-light expression not supported")]);const S=Nl(p,["line-progress"]);if(!S&&!function(A){return Qd(A.expression,"line-progress")}(e))return js([new Ri("","line-progress expression not supported")]);const P=e.expression&&e.expression.relaxZoomRestriction,y=uh(p);return y||m||P?y instanceof Ri?js([y]):y instanceof Ms&&!ah(e)?js([new Ri("",'"interpolate" expressions cannot be used with this property')]):Tm(y?new lh(u&&S?"camera":"composite",a.value,y.labels,y instanceof Ms?y.interpolation:void 0,x,S):new nf(u&&S?"constant":"source",a.value,x,S)):js([new Ri("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ch{constructor(e,s){this._parameters=e,this._specification=s,zd(this,Sm(this._parameters,this._specification))}static deserialize(e){return new ch(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function uh(a){let e=null;if(a instanceof Xd)e=uh(a.result);else if(a instanceof Zd){for(const s of a.args)if(e=uh(s),e)break}else(a instanceof Mc||a instanceof Ms)&&a.input instanceof vs&&a.input.name==="zoom"&&(e=a);return e instanceof Ri||a.eachChild(s=>{const c=uh(s);c instanceof Ri?e=c:e&&c&&e!==c&&(e=new Ri("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Am,vy,px=function(){if(vy)return Am;vy=1,Am=e;var a=3;function e(s,c,p){var u=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var m=new Int32Array(this.arrayBuffer);s=m[0],this.d=(c=m[1])+2*(p=m[2]);for(var x=0;x<this.d*this.d;x++){var S=m[a+x],P=m[a+x+1];u.push(S===P?null:m.subarray(S,P))}var y=m[a+u.length+1];this.keys=m.subarray(m[a+u.length],y),this.bboxes=m.subarray(y),this.insert=this._insertReadonly}else{this.d=c+2*p;for(var A=0;A<this.d*this.d;A++)u.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=s,this.padding=p,this.scale=c/s,this.uid=0;var I=p/c*s;this.min=-I,this.max=s+I}return e.prototype.insert=function(s,c,p,u,m){this._forEachCell(c,p,u,m,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(u),this.bboxes.push(m)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(s,c,p,u,m,x){this.cells[m].push(x)},e.prototype.query=function(s,c,p,u,m){var x=this.min,S=this.max;if(s<=x&&c<=x&&S<=p&&S<=u&&!m)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(s,c,p,u,this._queryCell,P,{},m),P},e.prototype._queryCell=function(s,c,p,u,m,x,S,P){var y=this.cells[m];if(y!==null)for(var A=this.keys,I=this.bboxes,E=0;E<y.length;E++){var M=y[E];if(S[M]===void 0){var R=4*M;(P?P(I[R+0],I[R+1],I[R+2],I[R+3]):s<=I[R+2]&&c<=I[R+3]&&p>=I[R+0]&&u>=I[R+1])?(S[M]=!0,x.push(A[M])):S[M]=!1}}},e.prototype._forEachCell=function(s,c,p,u,m,x,S,P){for(var y=this._convertToCellCoord(s),A=this._convertToCellCoord(c),I=this._convertToCellCoord(p),E=this._convertToCellCoord(u),M=y;M<=I;M++)for(var R=A;R<=E;R++){var z=this.d*R+M;if((!P||P(this._convertFromCellCoord(M),this._convertFromCellCoord(R),this._convertFromCellCoord(M+1),this._convertFromCellCoord(R+1)))&&m.call(this,s,c,p,u,z,x,S,P))return}},e.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},e.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,c=a+this.cells.length+1+1,p=0,u=0;u<this.cells.length;u++)p+=this.cells[u].length;var m=new Int32Array(c+p+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var x=c,S=0;S<s.length;S++){var P=s[S];m[a+S]=x,m.set(P,x),x+=P.length}return m[a+s.length]=x,m.set(this.keys,x),m[a+s.length+1]=x+=this.keys.length,m.set(this.bboxes,x),x+=this.bboxes.length,m.buffer},Am}(),Ul=k(px);const rf={};function Gt(a,e,s={}){Object.defineProperty(a,"_classRegistryKey",{value:e,writable:!1}),rf[e]={klass:a,omit:s.omit||[]}}Gt(Object,"Object"),Ul.serialize=function(a,e){const s=a.toArrayBuffer();return e&&e.add(s),{buffer:s}},Ul.deserialize=function(a){return new Ul(a.buffer)},Object.defineProperty(Ul,"name",{value:"Grid"}),Gt(Ul,"Grid"),typeof DOMMatrix<"u"&&Gt(DOMMatrix,"DOMMatrix"),Gt(Qi,"Color"),Gt(Error,"Error"),Gt(Qr,"Formatted"),Gt(qu,"FormattedSection"),Gt(tr,"AJAXError"),Gt(qr,"ResolvedImage"),Gt(ch,"StylePropertyFunction"),Gt(tf,"StyleExpression",{omit:["_evaluator"]}),Gt(ia,"ImageIdWithOptions"),Gt(lh,"ZoomDependentExpression"),Gt(nf,"ZoomConstantExpression"),Gt(vs,"CompoundExpression",{omit:["_evaluate"]});for(const a in Pc)rf[Pc[a]._classRegistryKey]||Gt(Pc[a],`Expression${a}`);function Mm(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Cm(a){return self.ImageBitmap&&a instanceof ImageBitmap}function sl(a,e){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Mm(a)||Cm(a))return e&&e.add(a),a;if(ArrayBuffer.isView(a))return e&&e.add(a.buffer),a;if(a instanceof ImageData)return e&&e.add(a.data.buffer),a;if(Array.isArray(a)){const s=[];for(const c of a)s.push(sl(c,e));return s}if(a instanceof Map){const s={$name:"Map"};for(const[c,p]of a.entries())s[c]=sl(p);return s}if(a instanceof Set){const s={$name:"Set"};let c=0;for(const p of a.values())s[++c]=sl(p);return s}if(typeof a=="object"){const s=a.constructor,c=s._classRegistryKey;if(!c)throw new Error(`Can't serialize object of unregistered class "${c}".`);const p=s.serialize?s.serialize(a,e):{};if(!s.serialize){for(const u in a)a.hasOwnProperty(u)&&(rf[c].omit.indexOf(u)>=0||(p[u]=sl(a[u],e)));a instanceof Error&&(p.message=a.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(p.$name=c),p}throw new Error("can't serialize object of type "+typeof a)}function jl(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Mm(a)||Cm(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(jl);if(typeof a=="object"){const e=a.$name||"Object";if(e==="Map"){const p=new Map;for(const u of Object.keys(a))u!=="$name"&&p.set(u,jl(a[u]));return p}if(e==="Set"){const p=new Set;for(const u of Object.keys(a))u!=="$name"&&p.add(jl(a[u]));return p}const{klass:s}=rf[e];if(!s)throw new Error(`Can't deserialize unregistered class "${e}".`);if(s.deserialize)return s.deserialize(a);const c=Object.create(s.prototype);for(const p of Object.keys(a))p!=="$name"&&(c[p]=jl(a[p]));return c}throw new Error("can't deserialize object of type "+typeof a)}const Qt={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519,Osage:a=>a>=66736&&a<=66815,"CJK Unified Ideographs Extension B":a=>a>=131072&&a<=173791};function Im(a){for(const e of a)if(sf(e.charCodeAt(0)))return!0;return!1}function mx(a){for(const e of a)if(!_x(e.charCodeAt(0)))return!1;return!0}function _x(a){return!(Qt.Arabic(a)||Qt["Arabic Supplement"](a)||Qt["Arabic Extended-A"](a)||Qt["Arabic Presentation Forms-A"](a)||Qt["Arabic Presentation Forms-B"](a))}function sf(a){return!(a!==746&&a!==747&&(a<4352||!(Qt["Bopomofo Extended"](a)||Qt.Bopomofo(a)||Qt["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Qt["CJK Compatibility Ideographs"](a)||Qt["CJK Compatibility"](a)||Qt["CJK Radicals Supplement"](a)||Qt["CJK Strokes"](a)||!(!Qt["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Qt["CJK Unified Ideographs Extension A"](a)||Qt["CJK Unified Ideographs"](a)||Qt["Enclosed CJK Letters and Months"](a)||Qt["Hangul Compatibility Jamo"](a)||Qt["Hangul Jamo Extended-A"](a)||Qt["Hangul Jamo Extended-B"](a)||Qt["Hangul Jamo"](a)||Qt["Hangul Syllables"](a)||Qt.Hiragana(a)||Qt["Ideographic Description Characters"](a)||Qt.Kanbun(a)||Qt["Kangxi Radicals"](a)||Qt["Katakana Phonetic Extensions"](a)||Qt.Katakana(a)&&a!==12540||!(!Qt["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Qt["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Qt["Unified Canadian Aboriginal Syllabics"](a)||Qt["Unified Canadian Aboriginal Syllabics Extended"](a)||Qt["Vertical Forms"](a)||Qt["Yijing Hexagram Symbols"](a)||Qt["Yi Syllables"](a)||Qt["Yi Radicals"](a))))}function Pm(a){return!(sf(a)||function(e){return!!(Qt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Qt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Qt["Letterlike Symbols"](e)||Qt["Number Forms"](e)||Qt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Qt["Control Pictures"](e)&&e!==9251||Qt["Optical Character Recognition"](e)||Qt["Enclosed Alphanumerics"](e)||Qt["Geometric Shapes"](e)||Qt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Qt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Qt["CJK Symbols and Punctuation"](e)||Qt.Katakana(e)||Qt["Private Use Area"](e)||Qt["CJK Compatibility Forms"](e)||Qt["Small Form Variants"](e)||Qt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(a))}function Rm(a){return a>=1424&&a<=2303||Qt["Arabic Presentation Forms-A"](a)||Qt["Arabic Presentation Forms-B"](a)}function xy(a,e){return!(!e&&Rm(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Qt.Khmer(a))}function Dm(a){for(const e of a)if(Rm(e.charCodeAt(0)))return!0;return!1}const hh="deferred",of="loading",Lm="loaded";let na=null,Cs="unavailable",ol=null;const Om=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Cs="error"),na&&na(a)};function zm(){Oc.fire(new ea("pluginStateChange",{pluginStatus:Cs,pluginURL:ol}))}const Oc=new el,af=function(){return Cs},dh=function(){if(Cs!==hh||!ol)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Cs=of,zm(),ol&&br({url:ol},a=>{a?Om(a):(Cs=Lm,zm())})},$s={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Cs===Lm||$s.applyArabicShaping!=null,isLoading:()=>Cs===of,setState(a){Cs=a.pluginStatus,ol=a.pluginURL},isParsed:()=>$s.applyArabicShaping!=null&&$s.processBidirectionalText!=null&&$s.processStyledBidirectionalText!=null,getPluginURL:()=>ol};class bn{constructor(e,s){this.zoom=e,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch,this.brightness=s.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(s,c){for(const p of s)if(!xy(p.charCodeAt(0),c))return!1;return!0}(e,$s.isLoaded())}}class lf{constructor(e,s,c,p){this.property=e,this.value=s,this.expression=function(u,m,x,S){if(Em(u))return new ch(u,m);if(Dc(u)||Array.isArray(u)&&u.length>0){const P=yy(u,m,x,S);if(P.result==="error")throw new Error(P.value.map(y=>`${y.key}: ${y.message}`).join(", "));return P.value}{let P=u;return typeof u=="string"&&m.type==="color"&&(P=Qi.parse(u)),{kind:"constant",configDependencies:new Set,evaluate:()=>P}}}(s===void 0?e.specification.default:s,e.specification,c,p)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,s,c){return this.property.possiblyEvaluate(this,e,s,c)}}class fh{constructor(e,s,c){this.property=e,this.value=new lf(e,void 0,s,c)}transitioned(e,s){return new km(this.property,this.value,s,Wi({},e.transition,this.transition),e.now)}untransitioned(){return new km(this.property,this.value,null,{},0)}}class cf{constructor(e,s,c){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=s,this._options=c,this.configDependencies=new Set}getValue(e){return Bn(this._values[e].value.value)}setValue(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new fh(this._values[e].property,this._scope,this._options)),this._values[e].value=new lf(this._values[e].property,s===null?void 0:Bn(s),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,s){s&&(this._options=s);const c=this._properties.properties;if(e)for(const p in e){const u=e[p];if(Rn(p,"-transition")){const m=p.slice(0,-11);c[m]&&this.setTransition(m,u)}else c.hasOwnProperty(p)&&this.setValue(p,u)}}getTransition(e){return Bn(this._values[e].transition)}setTransition(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new fh(this._values[e].property)),this._values[e].transition=Bn(s)||void 0}serialize(){const e={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(e[s]=c);const p=this.getTransition(s);p!==void 0&&(e[`${s}-transition`]=p)}return e}transitioned(e,s){const c=new ph(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].transitioned(e,s._values[p]);return c}untransitioned(){const e=new ph(this._properties);for(const s of Object.keys(this._values))e._values[s]=this._values[s].untransitioned();return e}}class km{constructor(e,s,c,p,u){const m=p.delay||0,x=p.duration||0;u=u||0,this.property=e,this.value=s,this.begin=u+m,this.end=this.begin+x,e.specification.transition&&(p.delay||p.duration)&&(this.prior=c)}possiblyEvaluate(e,s,c){const p=e.now||0,u=this.value.possiblyEvaluate(e,s,c),m=this.prior;if(m){if(p>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(p<this.begin)return m.possiblyEvaluate(e,s,c);{const x=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,s,c),u,Jt(x))}}return u}}class ph{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,s,c){const p=new Fc(this._properties);for(const u of Object.keys(this._values))p._values[u]=this._values[u].possiblyEvaluate(e,s,c);return p}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class zc{constructor(e,s,c){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=s,this._options=c,this.configDependencies=new Set}getValue(e){return Bn(this._values[e].value)}setValue(e,s){this._values[e]=new lf(this._values[e].property,s===null?void 0:Bn(s),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(e[s]=c)}return e}possiblyEvaluate(e,s,c){const p=new Fc(this._properties);for(const u of Object.keys(this._values))p._values[u]=this._values[u].possiblyEvaluate(e,s,c);return p}}class kc{constructor(e,s,c){this.property=e,this.value=s,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,s,c,p){return this.property.evaluate(this.value,this.parameters,e,s,c,p)}}class Fc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class wt{constructor(e){this.specification=e}possiblyEvaluate(e,s){return e.expression.evaluate(s)}interpolate(e,s,c){const p=Od[this.specification.type];return p?p(e,s,c):e}}class Vt{constructor(e,s){this.specification=e,this.overrides=s}possiblyEvaluate(e,s,c,p){return new kc(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(s,null,{},c,p)}:e.expression,s)}interpolate(e,s,c){if(e.value.kind!=="constant"||s.value.kind!=="constant")return e;if(e.value.value===void 0||s.value.value===void 0)return new kc(this,{kind:"constant",value:void 0},e.parameters);const p=Od[this.specification.type];return p?new kc(this,{kind:"constant",value:p(e.value.value,s.value.value,c)},e.parameters):e}evaluate(e,s,c,p,u,m){return e.kind==="constant"?e.value:e.evaluate(s,c,p,u,m)}}class Nc{constructor(e){this.specification=e}possiblyEvaluate(e,s,c,p){return!!e.expression.evaluate(s,null,{},c,p)}interpolate(){return!1}}class Dn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new bn(0,{});for(const c in e){const p=e[c];p.specification.overridable&&this.overridableProperties.push(c);const u=this.defaultPropertyValues[c]=new lf(p,void 0),m=this.defaultTransitionablePropertyValues[c]=new fh(p);this.defaultTransitioningPropertyValues[c]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=u.possiblyEvaluate(s)}}}Gt(Vt,"DataDrivenProperty"),Gt(wt,"DataConstantProperty"),Gt(Nc,"ColorRampProperty");var Ye=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function by(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function uf(a){if(Array.isArray(a))return a.map(uf);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const e={};for(const s in a)e[s]=uf(a[s]);return e}return by(a)}function Fm(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const e of a.slice(1))if(!Fm(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function wy(a,e="",s=null,c="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Fm(a)||(a=hf(a));const p=a;let u=!0;try{u=function(y){if(!Bc(y))return y;let A=uf(y);return Ey(A),A=Ty(A),A}(p)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(p,null,2)}
        `)}let m=null,x=null;if(c!=="background"&&c!=="sky"&&c!=="slot"){x=Ye[`filter_${c}`];const y=Lc(u,x,e,s);if(y.result==="error")throw new Error(y.value.map(A=>`${A.key}: ${A.message}`).join(", "));m=(A,I,E)=>y.value.evaluate(A,I,{},E)}let S=null,P=null;if(u!==p){const y=Lc(p,x,e,s);if(y.result==="error")throw new Error(y.value.map(A=>`${A.key}: ${A.message}`).join(", "));S=(A,I,E,M,R)=>y.value.evaluate(A,I,{},E,void 0,void 0,M,R),P=!Sc(y.value.expression)}return{filter:m,dynamicFilter:S||void 0,needGeometry:Sy(u),needFeature:!!P}}function Ty(a){if(!Array.isArray(a))return a;const e=function(s){if(gx.has(s[0])){for(let c=1;c<s.length;c++)if(Bc(s[c]))return!0}return s}(a);return e===!0?e:e.map(s=>Ty(s))}function Ey(a){let e=!1;const s=[];if(a[0]==="case"){for(let c=1;c<a.length-1;c+=2)e=e||Bc(a[c]),s.push(a[c+1]);s.push(a[a.length-1])}else if(a[0]==="match"){e=e||Bc(a[1]);for(let c=2;c<a.length-1;c+=2)s.push(a[c+1]);s.push(a[a.length-1])}else if(a[0]==="step"){e=e||Bc(a[1]);for(let c=1;c<a.length-1;c+=2)s.push(a[c+1])}e&&(a.length=0,a.push("any",...s));for(let c=1;c<a.length;c++)Ey(a[c])}function Bc(a){if(!Array.isArray(a))return!1;if((e=a[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let s=1;s<a.length;s++)if(Bc(a[s]))return!0;return!1}const gx=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function yx(a,e){return a<e?-1:a>e?1:0}function Sy(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let e=1;e<a.length;e++)if(Sy(a[e]))return!0;return!1}function hf(a){if(!a)return!0;const e=a[0];return a.length<=1?e!=="any":e==="=="?al(a[1],a[2],"=="):e==="!="?$l(al(a[1],a[2],"==")):e==="<"||e===">"||e==="<="||e===">="?al(a[1],a[2],e):e==="any"?(s=a.slice(1),["any"].concat(s.map(hf))):e==="all"?["all"].concat(a.slice(1).map(hf)):e==="none"?["all"].concat(a.slice(1).map(hf).map($l)):e==="in"?Nm(a[1],a.slice(2)):e==="!in"?$l(Nm(a[1],a.slice(2))):e==="has"?Bm(a[1]):e!=="!has"||$l(Bm(a[1]));var s}function al(a,e,s){switch(a){case"$type":return[`filter-type-${s}`,e];case"$id":return[`filter-id-${s}`,e];default:return[`filter-${s}`,a,e]}}function Nm(a,e){if(e.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(s=>typeof s!=typeof e[0])?["filter-in-large",a,["literal",e.sort(yx)]]:["filter-in-small",a,["literal",e]]}}function Bm(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function $l(a){return["!",a]}const df="";function ra(a,e){return e?`${a}${df}${e}`:a}const ka="-transition",Ay=new Set(["fill","line","background","hillshade","raster"]);class Mr extends el{constructor(e,s,c,p,u){if(super(),this.id=e.id,this.fqid=ra(this.id,c),this.type=e.type,this.scope=c,this.lut=p,this.options=u,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const m=Lc(this.filter,Ye[`filter_${e.type}`]);m.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...m.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),s.layout&&(this._unevaluatedLayout=new zc(s.layout,this.scope,u),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),s.paint){this._transitionablePaint=new cf(s.paint,this.scope,u);for(const m in e.paint)this.setPaintProperty(m,e.paint[m]);for(const m in e.layout)this.setLayoutProperty(m,e.layout[m]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Fc(s.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D()&&Ay.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,s){if(this.type==="custom"&&e==="visibility")return void(this.visibility=s);const c=this._unevaluatedLayout;c._properties.properties[e]&&(c.setValue(e,s),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return Rn(e,ka)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,s){const c=this._transitionablePaint,p=c._properties.properties;if(Rn(e,ka)){const A=e.slice(0,-11);return p[A]&&c.setTransition(A,s||void 0),!1}if(!p[e])return!1;const u=c._values[e],m=u.value.isDataDriven(),x=u.value;c.setValue(e,s),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const S=c._values[e].value,P=S.isDataDriven(),y=Rn(e,"pattern")||e==="line-dasharray";return P||m||y||this._handleOverridablePaintPropertyUpdate(e,x,S)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,s,c){return null}_handleOverridablePaintPropertyUpdate(e,s,c){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,s)}serialize(){return Ma({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,s)=>!(e===void 0||s==="layout"&&!Object.keys(e).length||s==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const s=this.paint.get(e);if(s instanceof kc&&oh(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=wy(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,s,c,p,u,m,x,S,P){}}const vx={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class mh{constructor(e,s){this._structArray=e,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class wn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,s){return e._trim(),s&&(e.isTransferred=!0,s.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const s=Object.create(this.prototype);return s.arrayBuffer=e.arrayBuffer,s.length=e.length,s.capacity=e.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function en(a,e=1){let s=0,c=0;return{members:a.map(p=>{const u=vx[p.type].BYTES_PER_ELEMENT,m=s=My(s,Math.max(e,u)),x=p.components||1;return c=Math.max(c,u),s+=u*x,{name:p.name,type:p.type,components:x,offset:m}}),size:My(s,Math.max(c,e)),alignment:e}}function My(a,e){return Math.ceil(a/e)*e}class Fa extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,s)}emplace(e,s,c){const p=2*e;return this.int16[p+0]=s,this.int16[p+1]=c,e}}Fa.prototype.bytesPerElement=4,Gt(Fa,"StructArrayLayout2i4");class Vc extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,s,c)}emplace(e,s,c,p){const u=3*e;return this.int16[u+0]=s,this.int16[u+1]=c,this.int16[u+2]=p,e}}Vc.prototype.bytesPerElement=6,Gt(Vc,"StructArrayLayout3i6");class Na extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c,p){const u=this.length;return this.resize(u+1),this.emplace(u,e,s,c,p)}emplace(e,s,c,p,u){const m=4*e;return this.int16[m+0]=s,this.int16[m+1]=c,this.int16[m+2]=p,this.int16[m+3]=u,e}}Na.prototype.bytesPerElement=8,Gt(Na,"StructArrayLayout4i8");class ff extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c,p,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,c,p,u)}emplace(e,s,c,p,u,m){const x=5*e;return this.int16[x+0]=s,this.int16[x+1]=c,this.int16[x+2]=p,this.int16[x+3]=u,this.int16[x+4]=m,e}}ff.prototype.bytesPerElement=10,Gt(ff,"StructArrayLayout5i10");class _h extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,p,u,m,x){const S=this.length;return this.resize(S+1),this.emplace(S,e,s,c,p,u,m,x)}emplace(e,s,c,p,u,m,x,S){const P=6*e,y=12*e,A=3*e;return this.int16[P+0]=s,this.int16[P+1]=c,this.uint8[y+4]=p,this.uint8[y+5]=u,this.uint8[y+6]=m,this.uint8[y+7]=x,this.float32[A+2]=S,e}}_h.prototype.bytesPerElement=12,Gt(_h,"StructArrayLayout2i4ub1f12");class sa extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,s,c)}emplace(e,s,c,p){const u=3*e;return this.float32[u+0]=s,this.float32[u+1]=c,this.float32[u+2]=p,e}}sa.prototype.bytesPerElement=12,Gt(sa,"StructArrayLayout3f12");class es extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,p,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,c,p,u)}emplace(e,s,c,p,u,m){const x=6*e,S=3*e;return this.uint16[x+0]=s,this.uint16[x+1]=c,this.uint16[x+2]=p,this.uint16[x+3]=u,this.float32[S+2]=m,e}}es.prototype.bytesPerElement=12,Gt(es,"StructArrayLayout4ui1f12");class pf extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c,p){const u=this.length;return this.resize(u+1),this.emplace(u,e,s,c,p)}emplace(e,s,c,p,u){const m=4*e;return this.uint16[m+0]=s,this.uint16[m+1]=c,this.uint16[m+2]=p,this.uint16[m+3]=u,e}}pf.prototype.bytesPerElement=8,Gt(pf,"StructArrayLayout4ui8");class gh extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c,p,u,m){const x=this.length;return this.resize(x+1),this.emplace(x,e,s,c,p,u,m)}emplace(e,s,c,p,u,m,x){const S=6*e;return this.int16[S+0]=s,this.int16[S+1]=c,this.int16[S+2]=p,this.int16[S+3]=u,this.int16[S+4]=m,this.int16[S+5]=x,e}}gh.prototype.bytesPerElement=12,Gt(gh,"StructArrayLayout6i12");class Vm extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c,p,u,m,x,S,P,y,A,I){const E=this.length;return this.resize(E+1),this.emplace(E,e,s,c,p,u,m,x,S,P,y,A,I)}emplace(e,s,c,p,u,m,x,S,P,y,A,I,E){const M=12*e;return this.int16[M+0]=s,this.int16[M+1]=c,this.int16[M+2]=p,this.int16[M+3]=u,this.uint16[M+4]=m,this.uint16[M+5]=x,this.uint16[M+6]=S,this.uint16[M+7]=P,this.int16[M+8]=y,this.int16[M+9]=A,this.int16[M+10]=I,this.int16[M+11]=E,e}}Vm.prototype.bytesPerElement=24,Gt(Vm,"StructArrayLayout4i4ui4i24");class Um extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,p,u,m){const x=this.length;return this.resize(x+1),this.emplace(x,e,s,c,p,u,m)}emplace(e,s,c,p,u,m,x){const S=10*e,P=5*e;return this.int16[S+0]=s,this.int16[S+1]=c,this.int16[S+2]=p,this.float32[P+2]=u,this.float32[P+3]=m,this.float32[P+4]=x,e}}Um.prototype.bytesPerElement=20,Gt(Um,"StructArrayLayout3i3f20");class ql extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,p){const u=this.length;return this.resize(u+1),this.emplace(u,e,s,c,p)}emplace(e,s,c,p,u){const m=4*e;return this.float32[m+0]=s,this.float32[m+1]=c,this.float32[m+2]=p,this.float32[m+3]=u,e}}ql.prototype.bytesPerElement=16,Gt(ql,"StructArrayLayout4f16");class jm extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint32[1*e+0]=s,e}}jm.prototype.bytesPerElement=4,Gt(jm,"StructArrayLayout1ul4");class ll extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,s)}emplace(e,s,c){const p=2*e;return this.uint16[p+0]=s,this.uint16[p+1]=c,e}}ll.prototype.bytesPerElement=4,Gt(ll,"StructArrayLayout2ui4");class $m extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c,p,u,m,x,S,P,y,A,I,E){const M=this.length;return this.resize(M+1),this.emplace(M,e,s,c,p,u,m,x,S,P,y,A,I,E)}emplace(e,s,c,p,u,m,x,S,P,y,A,I,E,M){const R=20*e,z=10*e;return this.int16[R+0]=s,this.int16[R+1]=c,this.int16[R+2]=p,this.int16[R+3]=u,this.int16[R+4]=m,this.float32[z+3]=x,this.float32[z+4]=S,this.float32[z+5]=P,this.float32[z+6]=y,this.int16[R+14]=A,this.uint32[z+8]=I,this.uint16[R+18]=E,this.uint16[R+19]=M,e}}$m.prototype.bytesPerElement=40,Gt($m,"StructArrayLayout5i4f1i1ul2ui40");class mf extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c,p,u,m,x){const S=this.length;return this.resize(S+1),this.emplace(S,e,s,c,p,u,m,x)}emplace(e,s,c,p,u,m,x,S){const P=8*e;return this.int16[P+0]=s,this.int16[P+1]=c,this.int16[P+2]=p,this.int16[P+4]=u,this.int16[P+5]=m,this.int16[P+6]=x,this.int16[P+7]=S,e}}mf.prototype.bytesPerElement=16,Gt(mf,"StructArrayLayout3i2i2i16");class qm extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c,p,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,c,p,u)}emplace(e,s,c,p,u,m){const x=4*e,S=8*e;return this.float32[x+0]=s,this.float32[x+1]=c,this.float32[x+2]=p,this.int16[S+6]=u,this.int16[S+7]=m,e}}qm.prototype.bytesPerElement=16,Gt(qm,"StructArrayLayout2f1f2i16");class Hm extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,p,u,m){const x=this.length;return this.resize(x+1),this.emplace(x,e,s,c,p,u,m)}emplace(e,s,c,p,u,m,x){const S=20*e,P=5*e;return this.uint8[S+0]=s,this.uint8[S+1]=c,this.float32[P+1]=p,this.float32[P+2]=u,this.float32[P+3]=m,this.float32[P+4]=x,e}}Hm.prototype.bytesPerElement=20,Gt(Hm,"StructArrayLayout2ub4f20");class Or extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,s,c)}emplace(e,s,c,p){const u=3*e;return this.uint16[u+0]=s,this.uint16[u+1]=c,this.uint16[u+2]=p,e}}Or.prototype.bytesPerElement=6,Gt(Or,"StructArrayLayout3ui6");class Gm extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,c,p,u,m,x,S,P,y,A,I,E,M,R,z,F,$,H,V,G){const Y=this.length;return this.resize(Y+1),this.emplace(Y,e,s,c,p,u,m,x,S,P,y,A,I,E,M,R,z,F,$,H,V,G)}emplace(e,s,c,p,u,m,x,S,P,y,A,I,E,M,R,z,F,$,H,V,G,Y){const te=30*e,he=15*e,ce=60*e;return this.int16[te+0]=s,this.int16[te+1]=c,this.int16[te+2]=p,this.float32[he+2]=u,this.float32[he+3]=m,this.uint16[te+8]=x,this.uint16[te+9]=S,this.uint32[he+5]=P,this.uint32[he+6]=y,this.uint32[he+7]=A,this.uint16[te+16]=I,this.uint16[te+17]=E,this.uint16[te+18]=M,this.float32[he+10]=R,this.float32[he+11]=z,this.uint8[ce+48]=F,this.uint8[ce+49]=$,this.uint8[ce+50]=H,this.uint32[he+13]=V,this.int16[te+28]=G,this.uint8[ce+58]=Y,e}}Gm.prototype.bytesPerElement=60,Gt(Gm,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Wm extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,c,p,u,m,x,S,P,y,A,I,E,M,R,z,F,$,H,V,G,Y,te,he,ce,le,Ee,de,Ae,Pe,Ce,ze){const Ne=this.length;return this.resize(Ne+1),this.emplace(Ne,e,s,c,p,u,m,x,S,P,y,A,I,E,M,R,z,F,$,H,V,G,Y,te,he,ce,le,Ee,de,Ae,Pe,Ce,ze)}emplace(e,s,c,p,u,m,x,S,P,y,A,I,E,M,R,z,F,$,H,V,G,Y,te,he,ce,le,Ee,de,Ae,Pe,Ce,ze,Ne){const Ge=20*e,Fe=40*e,at=80*e;return this.float32[Ge+0]=s,this.float32[Ge+1]=c,this.int16[Fe+4]=p,this.int16[Fe+5]=u,this.int16[Fe+6]=m,this.int16[Fe+7]=x,this.int16[Fe+8]=S,this.int16[Fe+9]=P,this.int16[Fe+10]=y,this.int16[Fe+11]=A,this.int16[Fe+12]=I,this.uint16[Fe+13]=E,this.uint16[Fe+14]=M,this.uint16[Fe+15]=R,this.uint16[Fe+16]=z,this.uint16[Fe+17]=F,this.uint16[Fe+18]=$,this.uint16[Fe+19]=H,this.uint16[Fe+20]=V,this.uint16[Fe+21]=G,this.uint16[Fe+22]=Y,this.uint16[Fe+23]=te,this.uint16[Fe+24]=he,this.uint16[Fe+25]=ce,this.uint16[Fe+26]=le,this.uint16[Fe+27]=Ee,this.uint32[Ge+14]=de,this.float32[Ge+15]=Ae,this.float32[Ge+16]=Pe,this.float32[Ge+17]=Ce,this.float32[Ge+18]=ze,this.uint8[at+76]=Ne,e}}Wm.prototype.bytesPerElement=80,Gt(Wm,"StructArrayLayout2f9i15ui1ul4f1ub80");class yh extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.float32[1*e+0]=s,e}}yh.prototype.bytesPerElement=4,Gt(yh,"StructArrayLayout1f4");class cl extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,p,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,c,p,u)}emplace(e,s,c,p,u,m){const x=5*e;return this.float32[x+0]=s,this.float32[x+1]=c,this.float32[x+2]=p,this.float32[x+3]=u,this.float32[x+4]=m,e}}cl.prototype.bytesPerElement=20,Gt(cl,"StructArrayLayout5f20");class _f extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,p,u,m,x){const S=this.length;return this.resize(S+1),this.emplace(S,e,s,c,p,u,m,x)}emplace(e,s,c,p,u,m,x,S){const P=7*e;return this.float32[P+0]=s,this.float32[P+1]=c,this.float32[P+2]=p,this.float32[P+3]=u,this.float32[P+4]=m,this.float32[P+5]=x,this.float32[P+6]=S,e}}_f.prototype.bytesPerElement=28,Gt(_f,"StructArrayLayout7f28");class oa extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,p,u,m,x,S,P,y,A){const I=this.length;return this.resize(I+1),this.emplace(I,e,s,c,p,u,m,x,S,P,y,A)}emplace(e,s,c,p,u,m,x,S,P,y,A,I){const E=11*e;return this.float32[E+0]=s,this.float32[E+1]=c,this.float32[E+2]=p,this.float32[E+3]=u,this.float32[E+4]=m,this.float32[E+5]=x,this.float32[E+6]=S,this.float32[E+7]=P,this.float32[E+8]=y,this.float32[E+9]=A,this.float32[E+10]=I,e}}oa.prototype.bytesPerElement=44,Gt(oa,"StructArrayLayout11f44");class gf extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,p,u,m,x,S,P){const y=this.length;return this.resize(y+1),this.emplace(y,e,s,c,p,u,m,x,S,P)}emplace(e,s,c,p,u,m,x,S,P,y){const A=9*e;return this.float32[A+0]=s,this.float32[A+1]=c,this.float32[A+2]=p,this.float32[A+3]=u,this.float32[A+4]=m,this.float32[A+5]=x,this.float32[A+6]=S,this.float32[A+7]=P,this.float32[A+8]=y,e}}gf.prototype.bytesPerElement=36,Gt(gf,"StructArrayLayout9f36");class Uc extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,s)}emplace(e,s,c){const p=2*e;return this.float32[p+0]=s,this.float32[p+1]=c,e}}Uc.prototype.bytesPerElement=8,Gt(Uc,"StructArrayLayout2f8");class Zm extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c,p){const u=this.length;return this.resize(u+1),this.emplace(u,e,s,c,p)}emplace(e,s,c,p,u){const m=6*e;return this.uint32[3*e+0]=s,this.uint16[m+2]=c,this.uint16[m+3]=p,this.uint16[m+4]=u,e}}Zm.prototype.bytesPerElement=12,Gt(Zm,"StructArrayLayout1ul3ui12");class Xm extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint16[1*e+0]=s,e}}Xm.prototype.bytesPerElement=2,Gt(Xm,"StructArrayLayout1ui2");class vh extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,p,u,m,x,S,P,y,A,I,E,M,R,z){const F=this.length;return this.resize(F+1),this.emplace(F,e,s,c,p,u,m,x,S,P,y,A,I,E,M,R,z)}emplace(e,s,c,p,u,m,x,S,P,y,A,I,E,M,R,z,F){const $=16*e;return this.float32[$+0]=s,this.float32[$+1]=c,this.float32[$+2]=p,this.float32[$+3]=u,this.float32[$+4]=m,this.float32[$+5]=x,this.float32[$+6]=S,this.float32[$+7]=P,this.float32[$+8]=y,this.float32[$+9]=A,this.float32[$+10]=I,this.float32[$+11]=E,this.float32[$+12]=M,this.float32[$+13]=R,this.float32[$+14]=z,this.float32[$+15]=F,e}}vh.prototype.bytesPerElement=64,Gt(vh,"StructArrayLayout16f64");class xh extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,p,u,m,x){const S=this.length;return this.resize(S+1),this.emplace(S,e,s,c,p,u,m,x)}emplace(e,s,c,p,u,m,x,S){const P=10*e,y=5*e;return this.uint16[P+0]=s,this.uint16[P+1]=c,this.uint16[P+2]=p,this.uint16[P+3]=u,this.float32[y+2]=m,this.float32[y+3]=x,this.float32[y+4]=S,e}}xh.prototype.bytesPerElement=20,Gt(xh,"StructArrayLayout4ui3f20");class Ym extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.int16[1*e+0]=s,e}}Ym.prototype.bytesPerElement=2,Gt(Ym,"StructArrayLayout1i2");class yf extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint8[1*e+0]=s,e}}yf.prototype.bytesPerElement=1,Gt(yf,"StructArrayLayout1ub1");class Cy extends mh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Cy.prototype.size=40;class Km extends $m{get(e){return new Cy(this,e)}}Gt(Km,"CollisionBoxArray");class bh extends mh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}bh.prototype.size=60;class Iy extends Gm{get(e){return new bh(this,e)}}Gt(Iy,"PlacedSymbolArray");class Py extends mh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Py.prototype.size=80;class Ry extends Wm{get(e){return new Py(this,e)}}Gt(Ry,"SymbolInstanceArray");class Dy extends yh{getoffsetX(e){return this.float32[1*e+0]}}Gt(Dy,"GlyphOffsetArray");class Ly extends Fa{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Gt(Ly,"SymbolLineVertexArray");class wh extends mh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}wh.prototype.size=12;class Th extends Zm{get(e){return new wh(this,e)}}Gt(Th,"FeatureIndexArray");class Is extends ll{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Gt(Is,"FillExtrusionCentroidArray");class Eh extends mh{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Eh.prototype.size=6;class Oy extends Vc{get(e){return new Eh(this,e)}}Gt(Oy,"FillExtrusionWallArray");const xx=en([{name:"a_pos",components:2,type:"Int16"}],4),bx=en([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Hn{constructor(e=[]){this.segments=e}_prepareSegment(e,s,c,p){let u=this.segments[this.segments.length-1];return e>Hn.MAX_VERTEX_ARRAY_LENGTH&&Ti(`Max vertices per segment is ${Hn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>Hn.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==p)&&(u={vertexOffset:s,primitiveOffset:c,vertexLength:0,primitiveLength:0},p!==void 0&&(u.sortKey=p),this.segments.push(u)),u}prepareSegment(e,s,c,p){return this._prepareSegment(e,s.length,c.length,p)}get(){return this.segments}destroy(){for(const e of this.segments)for(const s in e.vaos)e.vaos[s].destroy()}static simpleSegment(e,s,c,p){return new Hn([{vertexOffset:e,primitiveOffset:s,vertexLength:c,primitiveLength:p,vaos:{},sortKey:0}])}}function vf(a,e){return 256*(a=Ct(Math.floor(a),0,255))+Ct(Math.floor(e),0,255)}Hn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Gt(Hn,"SegmentVector");const wx=en([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Jm=en([{name:"a_dash",components:4,type:"Uint16"}]);class Sh{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,s,c,p){this.ids.push(zy(e)),this.positions.push(s,c,p)}eachPosition(e,s){const c=zy(e);let p=0,u=this.ids.length-1;for(;p<u;){const m=p+u>>1;this.ids[m]>=c?u=m:p=m+1}for(;this.ids[p]===c;)s(this.positions[3*p],this.positions[3*p+1],this.positions[3*p+2]),p++}static serialize(e,s){const c=new Float64Array(e.ids),p=new Uint32Array(e.positions);return Ah(c,p,0,c.length-1),s&&(s.add(c.buffer),s.add(p.buffer)),{ids:c,positions:p}}static deserialize(e){const s=new Sh;let c;s.ids=e.ids,s.positions=e.positions;for(const p of s.ids)p!==c&&s.uniqueIds.push(p),c=p;return s.indexed=!0,s}}function zy(a){const e=+a;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Ao(String(a))}function Ah(a,e,s,c){for(;s<c;){const p=a[s+c>>1];let u=s-1,m=c+1;for(;;){do u++;while(a[u]<p);do m--;while(a[m]>p);if(u>=m)break;xf(a,u,m),xf(e,3*u,3*m),xf(e,3*u+1,3*m+1),xf(e,3*u+2,3*m+2)}m-s<c-m?(Ah(a,e,s,m),s=m+1):(Ah(a,e,m+1,c),c=m)}}function xf(a,e,s){const c=a[e];a[e]=a[s],a[s]=c}Gt(Sh,"FeaturePositionMap");class aa{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,s),this.initialized=!0),!!this.location}set(e,s,c){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Mh extends aa{constructor(e){super(e),this.current=0}set(e,s,c){this.fetchUniformLocation(e,s)&&this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}}class Zn extends aa{constructor(e){super(e),this.current=0}set(e,s,c){this.fetchUniformLocation(e,s)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class co extends aa{constructor(e){super(e),this.current=[0,0]}set(e,s,c){this.fetchUniformLocation(e,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1])))}}class jc extends aa{constructor(e){super(e),this.current=[0,0,0]}set(e,s,c){this.fetchUniformLocation(e,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2])))}}class Ch extends aa{constructor(e){super(e),this.current=[0,0,0,0]}set(e,s,c){this.fetchUniformLocation(e,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class ky extends aa{constructor(e){super(e),this.current=Qi.transparent.toRenderColor(null)}set(e,s,c){this.fetchUniformLocation(e,s)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const Fy=new Float32Array(16);class Ih extends aa{constructor(e){super(e),this.current=Fy}set(e,s,c){if(this.fetchUniformLocation(e,s)){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let p=1;p<16;p++)if(c[p]!==this.current[p]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}}}const Qm=new Float32Array(9),Tx=new Float32Array(4);class e_ extends aa{constructor(e){super(e),this.current=Tx}set(e,s,c){if(this.fetchUniformLocation(e,s)){for(let p=0;p<4;p++)if(c[p]!==this.current[p]){this.current=c,this.gl.uniformMatrix2fv(this.location,!1,c);break}}}}function t_(a){return[vf(255*a.r,255*a.g),vf(255*a.b,255*a.a)]}class Hl{constructor(e,s,c,p){this.value=e,this.uniformNames=s.map(u=>`u_${u}`),this.type=c,this.context=p}setUniform(e,s,c,p,u){const m=p.constantOr(this.value);s.set(e,u,m instanceof Qi?m.toRenderColor(this.ignoreLut?null:this.context.lut):m)}getBinding(e,s){return this.type==="color"?new ky(e):new Zn(e)}}class Gl{constructor(e,s){this.uniformNames=s.map(c=>`u_${c}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,s,c,p,u){const m=u==="u_pattern"||u==="u_dash"?this.pattern:u==="u_pixel_ratio"?this.pixelRatio:null;m&&s.set(e,u,m)}getBinding(e,s){return s==="u_pattern"||s==="u_dash"?new Ch(e):new Zn(e)}}class Ba{constructor(e,s,c,p){this.expression=e,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(u=>({name:`a_${u}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,s,c,p,u,m,x){const S=this.paintVertexArray.length,P=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new bn(0,{brightness:m}),s,{},u,p,x):this.expression.kind==="constant"&&this.expression.value;!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate(new bn(0,{brightness:m}),s,{},u,p,x)==="none"),this.paintVertexArray.resize(e),this._setPaintValue(S,e,P,this.context)}updatePaintArray(e,s,c,p,u,m,x){const S=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:x},c,p,void 0,u):this.expression.kind==="constant"&&this.expression.value;!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate({zoom:0,brightness:x},c,p,void 0,u)==="none"),this._setPaintValue(e,s,S,this.context)}_setPaintValue(e,s,c,p){if(this.type==="color"){const u=t_(c.toRenderColor(this.ignoreLut?null:p.lut));for(let m=e;m<s;m++)this.paintVertexArray.emplace(m,u[0],u[1])}else{for(let u=e;u<s;u++)this.paintVertexArray.emplace(u,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Io{constructor(e,s,c,p,u,m){this.expression=e,this.uniformNames=s.map(x=>`u_${x}_t`),this.type=c,this.useIntegerZoom=p,this.context=u,this.maxValue=0,this.paintVertexAttributes=s.map(x=>({name:`a_${x}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,s,c,p,u,m,x){const S=this.expression.evaluate(new bn(this.context.zoom,{brightness:m}),s,{},u,p,x),P=this.expression.evaluate(new bn(this.context.zoom+1,{brightness:m}),s,{},u,p,x);!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate(new bn(this.context.zoom,{brightness:m}),s,{},u,p,x)==="none");const y=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(y,e,S,P,this.context)}updatePaintArray(e,s,c,p,u,m,x){const S=this.expression.evaluate({zoom:this.context.zoom,brightness:x},c,p,void 0,u),P=this.expression.evaluate({zoom:this.context.zoom+1,brightness:x},c,p,void 0,u);!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate({zoom:this.context.zoom,brightness:x},c,p,void 0,u)==="none"),this._setPaintValue(e,s,S,P,this.context)}_setPaintValue(e,s,c,p,u){if(this.type==="color"){const m=t_(c.toRenderColor(this.ignoreLut?null:u.lut)),x=t_(c.toRenderColor(this.ignoreLut?null:u.lut));for(let S=e;S<s;S++)this.paintVertexArray.emplace(S,m[0],m[1],x[0],x[1])}else{for(let m=e;m<s;m++)this.paintVertexArray.emplace(m,c,p);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(p))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,s,c,p,u){const m=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,x=Ct(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);s.set(e,u,x)}getBinding(e,s){return new Zn(e)}}class ul{constructor(e,s,c,p,u){this.expression=e,this.layerId=u,this.paintVertexAttributes=(c==="array"?Jm:wx).members;for(let m=0;m<s.length;++m);this.paintVertexArray=new p}populatePaintArray(e,s,c,p){const u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(e,s,c,p,u,m,x){this._setPaintValues(e,s,c.patterns&&c.patterns[this.layerId],m)}_setPaintValues(e,s,c,p){if(!p||!c)return;const u=p[c];if(!u)return;const{tl:m,br:x,pixelRatio:S}=u;for(let P=e;P<s;P++)this.paintVertexArray.emplace(P,m[0],m[1],x[0],x[1],S)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Wl{constructor(e,s,c=()=>!0){this.binders={},this._buffers=[],this.context=s;const p=[];for(const u in e.paint._values){const m=e.paint.get(u),x=e.paint.get(`${u}-use-theme`);if(u.endsWith("-use-theme")||!c(u)||!(m instanceof kc&&oh(m.property.specification)))continue;const S=Sx(u,e.type),P=m.value,y=m.property.specification.type,A=!!m.property.useIntegerZoom,I=u==="line-dasharray"||u.endsWith("pattern"),E=u==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||x&&x.value.kind!=="constant";if(P.kind!=="constant"||E)if(P.kind==="source"||E||I){const M=Ny(u,y,"source");this.binders[u]=I?new ul(P,S,y,M,e.id):new Ba(P,S,y,M),p.push(`/a_${u}`)}else{const M=Ny(u,y,"composite");this.binders[u]=new Io(P,S,y,A,s,M),p.push(`/z_${u}`)}else this.binders[u]=I?new Gl(P.value,S):new Hl(P.value,S,y,s),p.push(`/u_${u}`);x&&(this.binders[u].ignoreLut=x.constantOr("default")==="none",this.binders[u].lutExpression=x.value,this.binders[u].checkUseTheme=!0)}this.cacheKey=p.sort().join("")}getMaxValue(e){const s=this.binders[e];return s instanceof Ba||s instanceof Io?s.maxValue:0}populatePaintArrays(e,s,c,p,u,m,x){for(const S in this.binders){const P=this.binders[S];P.context=this.context,P instanceof Ba||P instanceof Io||P instanceof ul?P.populatePaintArray(e,s,c,p,u,m,x):P.lutExpression&&P instanceof Hl&&P.lutExpression&&(P.lutExpression.kind==="composite"||P.lutExpression.kind==="source")&&(P.ignoreLut=P.lutExpression.evaluate(new bn(0,{brightness:m}),s,{},u,p,x)==="none")}}setConstantPatternPositions(e){for(const s in this.binders){const c=this.binders[s];c instanceof Gl&&c.setConstantPatternPositions(e)}}updatePaintArrays(e,s,c,p,u,m,x,S,P){let y=!1;const A=Object.keys(e),I=A.length!==0&&!S,E=I?A:s.uniqueIds;this.context.lut=u.lut;for(const M in this.binders){const R=this.binders[M];if(R.context=this.context,(R instanceof Ba||R instanceof Io||R instanceof ul)&&R.expression&&R.expression.kind&&R.expression.kind!=="constant"&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){const z=u.paint.get(M);R.expression=z.value;for(const F of E){const $=e[F.toString()];s.eachPosition(F,(H,V,G)=>{const Y=p.feature(H);R.updatePaintArray(V,G,Y,$,m,x,P)})}if(!I)for(const F of c.uniqueIds){const $=e[F.toString()];c.eachPosition(F,(H,V,G)=>{const Y=p.feature(H);R.updatePaintArray(V,G,Y,$,m,x,P)})}y=!0}}return y}defines(){const e=[];for(const s in this.binders){const c=this.binders[s];(c instanceof Hl||c instanceof Gl)&&e.push(...c.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return e}getBinderAttributes(){const e=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Ba||c instanceof Io||c instanceof ul)for(let p=0;p<c.paintVertexAttributes.length;p++)e.push(c.paintVertexAttributes[p].name)}return e}getBinderUniforms(){const e=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Hl||c instanceof Gl||c instanceof Io)for(const p of c.uniformNames)e.push(p)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const s=[];for(const c in this.binders){const p=this.binders[c];if(p instanceof Hl||p instanceof Gl||p instanceof Io)for(const u of p.uniformNames)s.push({name:u,property:c,binding:p.getBinding(e,u)})}return s}setUniforms(e,s,c,p,u){for(const{name:m,property:x,binding:S}of c){if(this.binders[x].checkUseTheme&&this.binders[x]instanceof Hl){const P=p.get(`${x}-use-theme`);P.isConstant()&&(this.binders[x].ignoreLut=P.constantOr("default")==="none")}this.binders[x].setUniform(e,S,u,p.get(x),m)}}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const s=this.binders[e];(s instanceof Ba||s instanceof Io||s instanceof ul)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const s in this.binders){const c=this.binders[s];(c instanceof Ba||c instanceof Io||c instanceof ul)&&c.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const s=this.binders[e];(s instanceof Ba||s instanceof Io||s instanceof ul)&&s.destroy()}}}class hl{constructor(e,s,c=()=>!0){this.programConfigurations={};for(const p of e)this.programConfigurations[p.id]=new Wl(p,s,c);this.needsUpload=!1,this._featureMap=new Sh,this._featureMapWithoutIds=new Sh,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,s,c,p,u,m,x,S){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(e,s,p,u,m,x,S);s.id!==void 0?this._featureMap.add(s.id,c,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,c,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,s,c,p,u,m,x){for(const S of c)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,s,S,p,u,m,x||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Ex={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Sx(a,e){return Ex[a]||[a.replace(`${e}-`,"").replace(/-/g,"_")]}const Ax={"line-pattern":{source:es,composite:es},"fill-pattern":{source:es,composite:es},"fill-extrusion-pattern":{source:es,composite:es},"line-dasharray":{source:pf,composite:pf}},bf={color:{source:Uc,composite:ql},number:{source:yh,composite:Uc}};function Ny(a,e,s){const c=Ax[a];return c&&c[s]||bf[e][s]}Gt(Hl,"ConstantBinder"),Gt(Gl,"PatternConstantBinder"),Gt(Ba,"SourceExpressionBinder"),Gt(ul,"PatternCompositeBinder"),Gt(Io,"CompositeExpressionBinder"),Gt(Wl,"ProgramConfiguration",{omit:["_buffers"]}),Gt(hl,"ProgramConfigurationSet");const ps=Lt/Math.PI/2,$c=5,By=6,Vy=16383,qc=64,wf=[qc,32,16],qs=-ps,Hs=ps;function Hc(a,e,s,c=ps){return s=yt(s),[a*Math.sin(s)*c,-e*c,a*Math.cos(s)*c]}function Zl(a,e,s){return Hc(Math.cos(yt(a)),Math.sin(yt(a)),e,s)}const Xl=63710088e-1,i_=2*Math.PI*Xl;class Xi{constructor(e,s){if(isNaN(e)||isNaN(s))throw new Error(`Invalid LngLat object: (${e}, ${s})`);if(this.lng=+e,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Xi(Ai(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const s=Math.PI/180,c=this.lat*s,p=e.lat*s,u=Math.sin(c)*Math.sin(p)+Math.cos(c)*Math.cos(p)*Math.cos((e.lng-this.lng)*s);return Xl*Math.acos(Math.min(u,1))}toBounds(e=0){const s=360*e/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new dl({lng:this.lng-c,lat:this.lat-s},{lng:this.lng+c,lat:this.lat+s})}toEcef(e){return Zl(this.lat,this.lng,ps+e*ps/Xl)}static convert(e){if(e instanceof Xi)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Xi(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Xi(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class dl{constructor(e,s){if(e)if(s)this.setSouthWest(e).setNorthEast(s);else if(e.length===4){const c=e;this.setSouthWest([c[0],c[1]]).setNorthEast([c[2],c[3]])}else{const c=e;this.setSouthWest(c[0]).setNorthEast(c[1])}}setNorthEast(e){return this._ne=e instanceof Xi?new Xi(e.lng,e.lat):Xi.convert(e),this}setSouthWest(e){return this._sw=e instanceof Xi?new Xi(e.lng,e.lat):Xi.convert(e),this}extend(e){const s=this._sw,c=this._ne;let p,u;if(e instanceof Xi)p=e,u=e;else{if(!(e instanceof dl))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(dl.convert(e)):this.extend(Xi.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Xi.convert(e)):this;if(p=e._sw,u=e._ne,!p||!u)return this}return s||c?(s.lng=Math.min(p.lng,s.lng),s.lat=Math.min(p.lat,s.lat),c.lng=Math.max(u.lng,c.lng),c.lat=Math.max(u.lat,c.lat)):(this._sw=new Xi(p.lng,p.lat),this._ne=new Xi(u.lng,u.lat)),this}getCenter(){return new Xi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Xi(this.getWest(),this.getNorth())}getSouthEast(){return new Xi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:c}=Xi.convert(e);let p=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&p}static convert(e){if(e)return e instanceof dl?e:new dl(e)}}const Mx=0,Cx=25.5;function Tf(a){return i_*Math.cos(a*Math.PI/180)}function la(a){return(180+a)/360}function Po(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function ms(a,e){return a/Tf(e)}function Ps(a){return 360*a-180}function zr(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Uy(a,e){return a*Tf(zr(e))}const Gn=85.051129;function n_(a){return Math.cos(yt(Ct(a,-Gn,Gn)))}function Gc(a,e){const s=Ct(e,Mx,Cx),c=Math.pow(2,s);return n_(a)*i_/(512*c)}function h(a){return 1/Math.cos(a*Math.PI/180)}function i(a,e=0){const s=Math.exp(Math.PI*(1-(a.y+e/Lt)/(1<<a.z)*2));return 80150034*s/(s*s+1)/Lt/(1<<a.z)}class o{constructor(e,s,c=0){this.x=+e,this.y=+s,this.z=+c}static fromLngLat(e,s=0){const c=Xi.convert(e);return new o(la(c.lng),Po(c.lat),ms(s,c.lat))}toLngLat(){return new Xi(Ps(this.x),zr(this.y))}toAltitude(){return Uy(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/i_*h(zr(this.y))}}function d(a,e,s,c,p,u,m,x,S){const P=(e+c)/2,y=(s+p)/2,A=new Se(P,y);x(A),function(I,E,M,R,z,F){const $=M-z,H=R-F;return Math.abs((R-E)*$-(M-I)*H)/Math.hypot($,H)}(A.x,A.y,u.x,u.y,m.x,m.y)>=S?(d(a,e,s,P,y,u,A,x,S),d(a,P,y,c,p,A,m,x,S)):a.push(m)}function g(a,e,s){let c=a[0],p=c.x,u=c.y;e(c);const m=[c];for(let x=1;x<a.length;x++){const S=a[x],{x:P,y}=S;e(S),d(m,p,u,P,y,c,S,e,s),p=P,u=y,c=S}return m}function v(a,e,s,c){if(c(e,s)){const p=e.add(s)._mult(.5);v(a,e,p,c),v(a,p,s,c)}else a.push(s)}function w(a,e){let s=a[0];const c=[s];for(let p=1;p<a.length;p++){const u=a[p];v(c,s,u,e),s=u}return c}const C=Math.pow(2,14)-1,D=-C-1;function L(a,e){const s=Math.round(a.x*e),c=Math.round(a.y*e);return a.x=Ct(s,D,C),a.y=Ct(c,D,C),(s<a.x||s>a.x+1||c<a.y||c>a.y+1)&&Ti("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function O(a,e,s){const c=a.loadGeometry(),p=a.extent,u=Lt/p;if(e&&s&&s.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:x,x:S,y:P,projection:y}=s,A=I=>{const E=Ps((e.x+I.x/p)/m),M=zr((e.y+I.y/p)/m),R=y.project(E,M);I.x=(R.x*x-S)*p,I.y=(R.y*x-P)*p};for(let I=0;I<c.length;I++)if(a.type!==1)c[I]=g(c[I],A,1);else{const E=[];for(const M of c[I])M.x<0||M.x>=p||M.y<0||M.y>=p||(A(M),E.push(M));c[I]=E}}for(const m of c)for(const x of m)L(x,u);return c}function N(a,e){return{type:a.type,id:a.id,properties:a.properties,geometry:e?O(a):[]}}function B(a,e,s,c,p){a.emplaceBack(2*e+(c+1)/2,2*s+(p+1)/2)}function q(a,e,s){a.emplaceBack(e.x,e.y,e.z,s[0]*16384,s[1]*16384,s[2]*16384)}class J{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Fa,this.indexArray=new Or,this.segments=new Hn,this.programConfigurations=new hl(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}updateFootprints(e,s){}populate(e,s,c,p){const u=this.layers[0],m=[];let x=null;u.type==="circle"&&(x=u.layout.get("circle-sort-key"));for(const{feature:P,id:y,index:A,sourceLayerIndex:I}of e){const E=this.layers[0]._featureFilter.needGeometry,M=N(P,E);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),M,c))continue;const R=x?x.evaluate(M,{},c):void 0,z={id:y,properties:P.properties,type:P.type,sourceLayerIndex:I,index:A,geometry:E?M.geometry:O(P,c,p),patterns:{},sortKey:R};m.push(z)}x&&m.sort((P,y)=>P.sortKey-y.sortKey);let S=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new gh,S=p.projection);for(const P of m){const{geometry:y,index:A,sourceLayerIndex:I}=P,E=e[A].feature;this.addFeature(P,y,A,s.availableImages,c,S,s.brightness),s.featureIndex.insert(E,y,A,I,this.index)}}update(e,s,c,p,u,m,x){this.programConfigurations.updatePaintArrays(e,s,u,c,p,m,x)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xx.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,bx.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,s,c,p,u,m,x){for(const S of s)for(const P of S){const y=P.x,A=P.y;if(y<0||y>=Lt||A<0||A>=Lt)continue;if(m){const M=m.projectTilePoint(y,A,u),R=m.upVector(u,y,A),z=this.globeExtVertexArray;q(z,M,R),q(z,M,R),q(z,M,R),q(z,M,R)}const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),E=I.vertexLength;B(this.layoutVertexArray,y,A,-1,-1),B(this.layoutVertexArray,y,A,1,-1),B(this.layoutVertexArray,y,A,1,1),B(this.layoutVertexArray,y,A,-1,1),this.indexArray.emplaceBack(E,E+1,E+2),this.indexArray.emplaceBack(E,E+2,E+3),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,{},p,u,x)}}function X(a,e){for(let s=0;s<a.length;s++)if(_e(e,a[s]))return!0;for(let s=0;s<e.length;s++)if(_e(a,e[s]))return!0;return!!pe(a,e)}function ee(a,e,s){return!!_e(a,e)||!!we(e,a,s)}function Q(a,e){if(a.length===1)return ve(e,a[0]);for(let s=0;s<e.length;s++){const c=e[s];for(let p=0;p<c.length;p++)if(_e(a,c[p]))return!0}for(let s=0;s<a.length;s++)if(ve(e,a[s]))return!0;for(let s=0;s<e.length;s++)if(pe(a,e[s]))return!0;return!1}function ae(a,e,s){if(a.length>1){if(pe(a,e))return!0;for(let c=0;c<e.length;c++)if(we(e[c],a,s))return!0}for(let c=0;c<a.length;c++)if(we(a[c],e,s))return!0;return!1}function pe(a,e){if(a.length===0||e.length===0)return!1;for(let s=0;s<a.length-1;s++){const c=a[s],p=a[s+1];for(let u=0;u<e.length-1;u++)if(fe(c,p,e[u],e[u+1]))return!0}return!1}function fe(a,e,s,c){return Yo(a,s,c)!==Yo(e,s,c)&&Yo(a,e,s)!==Yo(a,e,c)}function we(a,e,s){const c=s*s;if(e.length===1)return a.distSqr(e[0])<c;for(let p=1;p<e.length;p++)if(ge(a,e[p-1],e[p])<c)return!0;return!1}function ge(a,e,s){const c=e.distSqr(s);if(c===0)return a.distSqr(e);const p=((a.x-e.x)*(s.x-e.x)+(a.y-e.y)*(s.y-e.y))/c;return a.distSqr(p<0?e:p>1?s:s.sub(e)._mult(p)._add(e))}function ve(a,e){let s,c,p,u=!1;for(let m=0;m<a.length;m++){s=a[m];for(let x=0,S=s.length-1;x<s.length;S=x++)c=s[x],p=s[S],c.y>e.y!=p.y>e.y&&e.x<(p.x-c.x)*(e.y-c.y)/(p.y-c.y)+c.x&&(u=!u)}return u}function _e(a,e){let s=!1;for(let c=0,p=a.length-1;c<a.length;p=c++){const u=a[c],m=a[p];u.y>e.y!=m.y>e.y&&e.x<(m.x-u.x)*(e.y-u.y)/(m.y-u.y)+u.x&&(s=!s)}return s}function Me(a,e,s,c,p){for(const m of a)if(e<=m.x&&s<=m.y&&c>=m.x&&p>=m.y)return!0;const u=[new Se(e,s),new Se(e,p),new Se(c,p),new Se(c,s)];if(a.length>2){for(const m of u)if(_e(a,m))return!0}for(let m=0;m<a.length-1;m++)if(ke(a[m],a[m+1],u))return!0;return!1}function ke(a,e,s){const c=s[0],p=s[2];if(a.x<c.x&&e.x<c.x||a.x>p.x&&e.x>p.x||a.y<c.y&&e.y<c.y||a.y>p.y&&e.y>p.y)return!1;const u=Yo(a,e,s[0]);return u!==Yo(a,e,s[1])||u!==Yo(a,e,s[2])||u!==Yo(a,e,s[3])}function tt(a,e,s,c,p,u){let m=e.y-a.y,x=a.x-e.x;if(u=u||0){const S=m*m+x*x;if(S===0)return!0;const P=Math.sqrt(S);m/=P,x/=P}return!((s.x-a.x)*m+(s.y-a.y)*x-u<0||(c.x-a.x)*m+(c.y-a.y)*x-u<0||(p.x-a.x)*m+(p.y-a.y)*x-u<0)}function We(a,e,s,c,p,u,m){return!(tt(a,e,c,p,u,m)||tt(e,s,c,p,u,m)||tt(s,a,c,p,u,m)||tt(c,p,a,e,s,m)||tt(p,u,a,e,s,m)||tt(u,c,a,e,s,m))}function ct(a,e,s){const c=e.paint.get(a).value;return c.kind==="constant"?c.value:s.programConfigurations.get(e.id).getMaxValue(a)}function lt(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function $e(a,e,s,c,p){if(!e[0]&&!e[1])return a;const u=Se.convert(e)._mult(p);s==="viewport"&&u._rotate(-c);const m=[];for(let x=0;x<a.length;x++)m.push(a[x].sub(u));return m}function it(a,e,s,c){const p=Se.convert(a)._mult(c);return e==="viewport"&&p._rotate(-s),p}let gt,Ue;Gt(J,"CircleBucket",{omit:["layers"]});var ht,nt={exports:{}},St=(ht||(ht=1,function(a,e){(function(s){function c(u,m,x){var S=p(256*u,256*(m=Math.pow(2,x)-m-1),x),P=p(256*(u+1),256*(m+1),x);return S[0]+","+S[1]+","+P[0]+","+P[1]}function p(u,m,x){var S=2*Math.PI*6378137/256/Math.pow(2,x);return[u*S-2*Math.PI*6378137/2,m*S-2*Math.PI*6378137/2]}s.getURL=function(u,m,x,S,P,y){return y=y||{},u+"?"+["bbox="+c(x,S,P),"format="+(y.format||"image/png"),"service="+(y.service||"WMS"),"version="+(y.version||"1.1.1"),"request="+(y.request||"GetMap"),"srs="+(y.srs||"EPSG:3857"),"width="+(y.width||256),"height="+(y.height||256),"layers="+m].join("&")},s.getTileBBox=c,s.getMercCoords=p,Object.defineProperty(s,"__esModule",{value:!0})})(e)}(0,nt.exports)),nt.exports);class pt{constructor(e,s,c){this.z=e,this.x=s,this.y=c,this.key=Et(0,e,e,s,c)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,s){const c=St.getTileBBox(this.x,this.y,this.z),p=function(u,m,x){let S,P="";for(let y=u;y>0;y--)S=1<<y-1,P+=(m&S?1:0)+(x&S?2:0);return P}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ut{constructor(e,s){this.wrap=e,this.canonical=s,this.key=Et(e,s.z,s.z,s.x,s.y)}}class vt{constructor(e,s,c,p,u){this.overscaledZ=e,this.wrap=s,this.canonical=new pt(c,+p,+u),this.key=s===0&&e===c?this.canonical.key:Et(s,e,c,p,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const s=this.canonical.z-e;return e>this.canonical.z?new vt(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new vt(e,this.wrap,e,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(e,s=!0){if(this.overscaledZ===e&&s)return this.key;if(e>this.canonical.z)return Et(this.wrap*+s,e,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-e;return Et(this.wrap*+s,e,e,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const s=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>s&&e.canonical.y===this.canonical.y>>s}children(e){if(this.overscaledZ>=e)return[new vt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=2*this.canonical.x,p=2*this.canonical.y;return[new vt(s,this.wrap,s,c,p),new vt(s,this.wrap,s,c+1,p),new vt(s,this.wrap,s,c,p+1),new vt(s,this.wrap,s,c+1,p+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new vt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new vt(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ut(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Et(a,e,s,c,p){const u=1<<Math.min(s,22);let m=u*(p%u)+c%u;return a&&s<22&&(m+=u*u*((a<0?-2*a-1:2*a)%(1<<2*(22-s)))),16*(32*m+s)+(e-s)}const Nt=[a=>{let e=a.canonical.x-1,s=a.wrap;return e<0&&(e=(1<<a.canonical.z)-1,s--),new vt(a.overscaledZ,s,a.canonical.z,e,a.canonical.y)},a=>{let e=a.canonical.x+1,s=a.wrap;return e===1<<a.canonical.z&&(e=0,s++),new vt(a.overscaledZ,s,a.canonical.z,e,a.canonical.y)},a=>new vt(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,(a.canonical.y===0?1<<a.canonical.z:a.canonical.y)-1),a=>new vt(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y===(1<<a.canonical.z)-1?0:a.canonical.y+1)];Gt(pt,"CanonicalTileID"),Gt(vt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const $t=en([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:fi}=$t,ri=en([{name:"a_pos_3",components:3,type:"Int16"}]);var ai=en([{name:"a_pos",type:"Int16",components:2}]);class xi{constructor(e,s){this.pos=e,this.dir=s}intersectsPlane(e,s,c){const p=Le.vec3.dot(s,this.dir);if(Math.abs(p)<1e-6)return!1;const u=((e[0]-this.pos[0])*s[0]+(e[1]-this.pos[1])*s[1]+(e[2]-this.pos[2])*s[2])/p;return c[0]=this.pos[0]+this.dir[0]*u,c[1]=this.pos[1]+this.dir[1]*u,c[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,s,c){if(Le.vec3.equals(this.pos,e)||s===0)return c[0]=c[1]=c[2]=0,!1;const[p,u,m]=this.dir,x=this.pos[0]-e[0],S=this.pos[1]-e[1],P=this.pos[2]-e[2],y=p*p+u*u+m*m,A=2*(x*p+S*u+P*m),I=A*A-4*y*(x*x+S*S+P*P-s*s);if(I<0){const E=Math.max(-A/2,0),M=x+p*E,R=S+u*E,z=P+m*E,F=Math.hypot(M,R,z);return c[0]=M*s/F,c[1]=R*s/F,c[2]=z*s/F,!1}{const E=(-A-Math.sqrt(I))/(2*y);if(E<0){const M=Math.hypot(x,S,P);return c[0]=x*s/M,c[1]=S*s/M,c[2]=P*s/M,!1}return c[0]=x+p*E,c[1]=S+u*E,c[2]=P+m*E,!0}}}class Bi{constructor(e,s,c,p,u){this.TL=e,this.TR=s,this.BR=c,this.BL=p,this.horizon=u}static fromInvProjectionMatrix(e,s,c){const p=[-1,1,1],u=[1,1,1],m=[1,-1,1],x=[-1,-1,1],S=Le.vec3.transformMat4(p,p,e),P=Le.vec3.transformMat4(u,u,e),y=Le.vec3.transformMat4(m,m,e),A=Le.vec3.transformMat4(x,x,e);return new Bi(S,P,y,A,s/c)}}function on(a,e,s){let c=1/0,p=-1/0;const u=[];for(const m of a){Le.vec3.sub(u,m,e);const x=Le.vec3.dot(u,s);c=Math.min(c,x),p=Math.max(p,x)}return[c,p]}function Nn(a,e){let s=!0;for(let c=0;c<a.planes.length;c++){const p=a.planes[c];let u=0;for(let m=0;m<e.length;m++)u+=Le.vec3.dot(p,e[m])+p[3]>=0;if(u===0)return 0;u!==e.length&&(s=!1)}return s?2:1}function Tn(a,e){for(const s of a.projections){const c=on(e,a.points[0],s.axis);if(s.projection[1]<c[0]||s.projection[0]>c[1])return 0}return 1}function wi(a,e){let s=0;const c=[0,0,0,0];for(let p=0;p<a.length;p++)c[0]=a[p][0],c[1]=a[p][1],c[2]=a[p][2],c[3]=1,Le.vec4.dot(c,e)>=0&&s++;return s}class Hi{constructor(e,s){this.points=e||new Array(8).fill([0,0,0]),this.planes=s||new Array(6).fill([0,0,0,0]),this.bounds=ei.fromPoints(this.points),this.projections=[],this.frustumEdges=[Le.vec3.sub([],this.points[2],this.points[3]),Le.vec3.sub([],this.points[0],this.points[3]),Le.vec3.sub([],this.points[4],this.points[0]),Le.vec3.sub([],this.points[5],this.points[1]),Le.vec3.sub([],this.points[6],this.points[2]),Le.vec3.sub([],this.points[7],this.points[3])];for(const c of this.frustumEdges){const p=[0,-c[2],c[1]],u=[c[2],0,-c[0]];this.projections.push({axis:p,projection:on(this.points,this.points[0],p)}),this.projections.push({axis:u,projection:on(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(e,s,c,p){const u=Math.pow(2,c),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const y=Le.vec4.transformMat4([],P,e),A=1/y[3]/s*u;return Le.vec4.mul(y,y,[A,A,p?1/y[3]:A,A])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const y=Le.vec3.sub([],m[P[0]],m[P[1]]),A=Le.vec3.sub([],m[P[2]],m[P[1]]),I=Le.vec3.normalize([],Le.vec3.cross([],y,A)),E=-Le.vec3.dot(I,m[P[1]]);return I.concat(E)}),S=[];for(let P=0;P<m.length;P++)S.push([m[P][0],m[P][1],m[P][2]]);return new Hi(S,x)}intersectsPrecise(e,s,c){for(let p=0;p<s.length;p++)if(!wi(e,s[p]))return 0;for(let p=0;p<this.planes.length;p++)if(!wi(e,this.planes[p]))return 0;for(const p of c)for(const u of this.frustumEdges){const m=Le.vec3.cross([],p,u),x=Le.vec3.length(m);if(x===0)continue;Le.vec3.scale(m,m,1/x);const S=on(this.points,this.points[0],m),P=on(e,this.points[0],m);if(S[0]>P[1]||P[0]>S[1])return 0}return 1}containsPoint(e){for(const s of this.planes){const c=s[3];if(Le.vec3.dot([s[0],s[1],s[2]],e)+c<0)return!1}return!0}}class ei{static fromPoints(e){const s=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const p of e)Le.vec3.min(s,s,p),Le.vec3.max(c,c,p);return new ei(s,c)}static fromTileIdAndHeight(e,s,c){const p=1<<e.canonical.z,u=e.canonical.x,m=e.canonical.y;return new ei([u/p,m/p,s],[(u+1)/p,(m+1)/p,c])}static applyTransform(e,s){const c=e.getCorners();for(let p=0;p<c.length;++p)Le.vec3.transformMat4(c[p],c[p],s);return ei.fromPoints(c)}static applyTransformFast(e,s){const c=[s[12],s[13],s[14]],p=[...c];for(let u=0;u<3;u++)for(let m=0;m<3;m++){const x=s[4*m+u],S=x*e.min[m],P=x*e.max[m];c[u]+=Math.min(S,P),p[u]+=Math.max(S,P)}return new ei(c,p)}static projectAabbCorners(e,s){const c=e.getCorners();for(let p=0;p<c.length;++p)Le.vec3.transformMat4(c[p],c[p],s);return c}constructor(e,s){this.min=e,this.max=s,this.center=Le.vec3.scale([],Le.vec3.add([],this.min,this.max),.5)}quadrant(e){const s=[e%2==0,e<2],c=Le.vec3.clone(this.min),p=Le.vec3.clone(this.max);for(let u=0;u<s.length;u++)c[u]=s[u]?this.min[u]:this.center[u],p[u]=s[u]?this.center[u]:this.max[u];return p[2]=this.max[2],new ei(c,p)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,s=this.max;return[[e[0],e[1],e[2]],[s[0],e[1],e[2]],[s[0],s[1],e[2]],[e[0],s[1],e[2]],[e[0],e[1],s[2]],[s[0],e[1],s[2]],[s[0],s[1],s[2]],[e[0],s[1],s[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Nn(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Nn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,s){return s||this.intersects(e)?Tn(e,this.getCorners()):0}intersectsPreciseFlat(e,s){return s||this.intersectsFlat(e)?Tn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let s=0;s<3;++s)if(this.min[s]>e.max[s]||e.min[s]>this.max[s])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],e.min[s]),this.max[s]=Math.max(this.max[s],e.max[s])}encapsulatePoint(e){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],e[s]),this.max[s]=Math.max(this.max[s],e[s])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function ki(a){return a*ps/Xl}Gt(ei,"Aabb");const Ji=[new ei([qs,qs,qs],[Hs,Hs,Hs]),new ei([qs,qs,qs],[0,0,Hs]),new ei([0,qs,qs],[Hs,0,Hs]),new ei([qs,0,qs],[0,Hs,Hs]),new ei([0,0,qs],[Hs,Hs,Hs])];function tn(a,e,s,c=!0){const p=Le.vec3.scale([],a._camera.position,a.worldSize),u=[e,s,1,1];Le.vec4.transformMat4(u,u,a.pixelMatrixInverse),Le.vec4.scale(u,u,1/u[3]);const m=Le.vec3.sub([],u,p),x=Le.vec3.normalize([],m),S=a.globeMatrix,P=[S[12],S[13],S[14]],y=Le.vec3.sub([],P,p),A=Le.vec3.length(y),I=Le.vec3.normalize([],y),E=a.worldSize/(2*Math.PI),M=Le.vec3.dot(I,x),R=Math.asin(E/A);if(R<Math.acos(M)){if(!c)return null;const Ee=[],de=[];Le.vec3.scale(Ee,x,A/M),Le.vec3.normalize(de,Le.vec3.sub(de,Ee,y)),Le.vec3.normalize(x,Le.vec3.add(x,y,Le.vec3.scale(x,de,Math.tan(R)*A)))}const z=[];new xi(p,x).closestPointOnSphere(P,E,z);const F=Le.vec3.normalize([],xc(S,0)),$=Le.vec3.normalize([],xc(S,1)),H=Le.vec3.normalize([],xc(S,2)),V=Le.vec3.dot(F,z),G=Le.vec3.dot($,z),Y=Le.vec3.dot(H,z),te=Kt(Math.asin(-G/E));let he=Kt(Math.atan2(V,Y));he=a.center.lng+function(Ee,de){const Ae=(de-Ee+180)%360-180;return Ae<-180?Ae+360:Ae}(a.center.lng,he);const ce=la(he),le=Ct(Po(te),0,1);return new o(ce,le)}class Ln{constructor(e,s,c){this.a=Le.vec3.sub([],e,c),this.b=Le.vec3.sub([],s,c),this.center=c;const p=Le.vec3.normalize([],this.a),u=Le.vec3.normalize([],this.b);this.angle=Math.acos(Le.vec3.dot(p,u))}}function wr(a,e){if(a.angle===0)return null;let s;return s=a.a[e]===0?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[e]/a.a[e]/Math.sin(a.angle)-1/Math.tan(a.angle)),s<0||s>1?null:function(c,p,u,m){const x=Math.sin(u);return c*(Math.sin((1-m)*u)/x)+p*(Math.sin(m*u)/x)}(a.a[e],a.b[e],a.angle,Ct(s,0,1))+a.center[e]}function or(a){if(a.z<=1)return Ji[a.z+2*a.y+a.x];const e=mn(On(a));return ei.fromPoints(e)}function ar(a,e,s){return Le.vec3.scale(a,a,1-s),Le.vec3.scaleAndAdd(a,a,e,s)}function Gs(a,e,s){for(const c of a)Le.vec3.transformMat4(c,c,e),Le.vec3.scale(c,c,s)}function ts(a,e,s,c){const p=e/a.worldSize,u=a.globeMatrix;if(s.z<=1){const ce=or(s).getCorners();return Gs(ce,u,p),ei.fromPoints(ce)}const m=On(s,c),x=mn(m,ps+ki(a._tileCoverLift));Gs(x,u,p);const S=Number.MAX_VALUE,P=[-S,-S,-S],y=[S,S,S];if(m.contains(a.center)){for(const Ee of x)Le.vec3.min(y,y,Ee),Le.vec3.max(P,P,Ee);P[2]=0;const ce=a.point,le=[ce.x*p,ce.y*p,0];return Le.vec3.min(y,y,le),Le.vec3.max(P,P,le),new ei(y,P)}if(a._tileCoverLift>0){for(const ce of x)Le.vec3.min(y,y,ce),Le.vec3.max(P,P,ce);return new ei(y,P)}const A=[u[12]*p,u[13]*p,u[14]*p],I=m.getCenter(),E=Ct(a.center.lat,-Gn,Gn),M=Ct(I.lat,-Gn,Gn),R=la(a.center.lng),z=Po(E);let F=R-la(I.lng);const $=z-Po(M);F>.5?F-=1:F<-.5&&(F+=1);let H=0;if(Math.abs(F)>Math.abs($))H=F>=0?1:3;else{H=$>=0?0:2;const ce=[u[4]*p,u[5]*p,u[6]*p],le=-Math.sin(yt($>=0?m.getSouth():m.getNorth()))*ps;Le.vec3.scaleAndAdd(A,A,ce,le)}const V=x[H],G=x[(H+1)%4],Y=new Ln(V,G,A),te=[wr(Y,0)||V[0],wr(Y,1)||V[1],wr(Y,2)||V[2]],he=bs(a.zoom);if(he>0){const ce=function({x:Ee,y:de,z:Ae},Pe,Ce,ze,Ne){const Ge=1/(1<<Ae);let Fe=Ee*Ge,at=Fe+Ge,mt=de*Ge,ot=mt+Ge,zt=0;const Rt=(Fe+at)/2-ze;return Rt>.5?zt=-1:Rt<-.5&&(zt=1),Fe=((Fe+zt)*Pe-(ze*=Pe))*Ce+ze,at=((at+zt)*Pe-ze)*Ce+ze,mt=(mt*Pe-(Ne*=Pe))*Ce+Ne,ot=(ot*Pe-Ne)*Ce+Ne,[[Fe,ot,0],[at,ot,0],[at,mt,0],[Fe,mt,0]]}(s,e,a._pixelsPerMercatorPixel,R,z);for(let Ee=0;Ee<x.length;Ee++)ar(x[Ee],ce[Ee],he);const le=Le.vec3.add([],ce[H],ce[(H+1)%4]);Le.vec3.scale(le,le,.5),ar(te,le,he)}for(const ce of x)Le.vec3.min(y,y,ce),Le.vec3.max(P,P,ce);return y[2]=Math.min(V[2],G[2]),Le.vec3.min(y,y,te),Le.vec3.max(P,P,te),new ei(y,P)}function On({x:a,y:e,z:s},c=!1){const p=1/(1<<s),u=new Xi(Ps(a*p),e===(1<<s)-1&&c?-90:zr((e+1)*p)),m=new Xi(Ps((a+1)*p),e===0&&c?90:zr(e*p));return new dl(u,m)}function mn(a,e=ps){const s=yt(a.getNorth()),c=yt(a.getSouth()),p=Math.cos(s),u=Math.cos(c),m=Math.sin(s),x=Math.sin(c),S=a.getWest(),P=a.getEast();return[Hc(u,x,S,e),Hc(u,x,P,e),Hc(p,m,P,e),Hc(p,m,S,e)]}function dn(a,e,s,c){const p=1<<s.z,u=(a/Lt+s.x)/p;return Zl(zr((e/Lt+s.y)/p),Ps(u),c)}function Ui({min:a,max:e}){return Vy/Math.max(e[0]-a[0],e[1]-a[1],e[2]-a[2])}const Xn=new Float64Array(16);function Tr(a){const e=Ui(a),s=Le.mat4.fromScaling(Xn,[e,e,e]);return Le.mat4.translate(s,s,Le.vec3.negate([],a.min))}function pn(a){const e=Le.mat4.fromTranslation(Xn,a.min),s=1/Ui(a);return Le.mat4.scale(e,e,[s,s,s])}function is(a){const e=Lt/(2*Math.PI);return a/(2*Math.PI)/e}function uo(a,e){return Lt/(512*Math.pow(2,a))*Ui(or(e))}function Rs(a,e,s,c,p){const u=is(s),m=[a,e,-s/(2*Math.PI)],x=Le.mat4.identity(new Float64Array(16));return Le.mat4.translate(x,x,m),Le.mat4.scale(x,x,[u,u,u]),Le.mat4.rotateX(x,x,yt(-p)),Le.mat4.rotateY(x,x,yt(-c)),x}function bs(a){return yi($c,By,a)}function ca(a,e){const s=Zl(e.lat,e.lng),c=function(u){const m=Zl(u._center.lat,u._center.lng),x=Le.vec3.fromValues(0,1,0);let S=Le.vec3.cross([],x,m);const P=Le.mat4.fromRotation([],-u.angle,m);S=Le.vec3.transformMat4(S,S,P),Le.mat4.fromRotation(P,-u._pitch,S);const y=Le.vec3.normalize([],m);return Le.vec3.scale(y,y,ki(u.cameraToCenterDistance/u.pixelsPerMeter)),Le.vec3.transformMat4(y,y,P),Le.vec3.add([],m,y)}(a),p=Le.vec3.subtract([],c,s);return Le.vec3.angle(p,s)}function ho(a,e){return ca(a,e)>Math.PI/2*1.01}const Ws=yt(85),Yl=Math.cos(Ws),ua=Math.sin(Ws),Kl=Le.mat4.create(),Wc=a=>{const e=[];return a.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),a.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Ef(a,e,s,c,p,u,m,x,S){if(u&&a.queryGeometry.isAboveHorizon)return!1;u&&(S*=a.pixelToTileUnitsFactor);const P=a.tileID.canonical,y=s.projection.upVectorScale(P,s.center.lat,s.worldSize).metersToTile;for(const A of e)for(const I of A){const E=I.add(x),M=p&&s.elevation?s.elevation.exaggeration()*p.getElevationAt(E.x,E.y,!0):0,R=s.projection.projectTilePoint(E.x,E.y,P);if(M>0){const H=s.projection.upVector(P,E.x,E.y);R.x+=H[0]*y*M,R.y+=H[1]*y*M,R.z+=H[2]*y*M}const z=u?E:r_(R.x,R.y,R.z,c),F=u?a.tilespaceRays.map(H=>XO(H,M)):a.queryGeometry.screenGeometry,$=Le.vec4.transformMat4([],[R.x,R.y,R.z,1],c);if(!m&&u?S*=$[3]/s.cameraToCenterDistance:m&&!u&&(S*=s.cameraToCenterDistance/$[3]),u){const H=zr((I.y/Lt+P.y)/(1<<P.z));S/=s.projection.pixelsPerMeter(H,1)/ms(1,H)}if(ee(F,z,S))return!0}return!1}function r_(a,e,s,c){const p=Le.vec4.transformMat4([],[a,e,s,1],c);return new Se(p[0]/p[3],p[1]/p[3])}const bE=Le.vec3.fromValues(0,0,0),ZO=Le.vec3.fromValues(0,0,1);function XO(a,e){const s=Le.vec3.create();return bE[2]=e,a.intersectsPlane(bE,ZO,s),new Se(s[0],s[1])}class wE extends J{}let TE,EE,SE,AE;function ME(a,{width:e,height:s},c,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==e*s*c)throw new RangeError("mismatched image size")}else p=new Uint8Array(e*s*c);return a.width=e,a.height=s,a.data=p,a}function CE(a,e,s){const{width:c,height:p}=e;c===a.width&&p===a.height||(Ix(a,e,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,c),height:Math.min(a.height,p)},s,null),a.width=c,a.height=p,a.data=e.data)}function Ix(a,e,s,c,p,u,m,x){if(p.width===0||p.height===0)return e;if(p.width>a.width||p.height>a.height||s.x>a.width-p.width||s.y>a.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>e.width||p.height>e.height||c.x>e.width-p.width||c.y>e.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const S=a.data,P=e.data,y=u===4&&x;for(let A=0;A<p.height;A++){const I=((s.y+A)*a.width+s.x)*u,E=((c.y+A)*e.width+c.x)*u;if(y)for(let M=0;M<p.width;M++){const R=I+M*u+3,z=E+M*u;P[z+0]=255,P[z+1]=255,P[z+2]=255,P[z+3]=S[R]}else if(m)for(let M=0;M<p.width;M++){const R=I+M*u,z=E+M*u,F=S[R+3],$=new Qi(S[R+0]/255*F,S[R+1]/255*F,S[R+2]/255*F,F).toRenderColor(m).toArray();P[z+0]=$[0],P[z+1]=$[1],P[z+2]=$[2],P[z+3]=$[3]}else for(let M=0;M<p.width*u;M++)P[E+M]=S[I+M]}return e}Gt(wE,"HeatmapBucket",{omit:["layers"]});class Zc{constructor(e,s){ME(this,e,1,s)}resize(e){CE(this,new Zc(e),1)}clone(){return new Zc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,c,p,u){Ix(e,s,c,p,u,1,null)}}class Gr{constructor(e,s){ME(this,e,4,s)}resize(e){CE(this,new Gr(e),4)}replace(e,s){s?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Gr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,c,p,u,m,x){Ix(e,s,c,p,u,4,m,x)}}class IE{constructor(e,s){this.width=e.width,this.height=e.height,this.data=s instanceof Uint8Array?new Float32Array(s.buffer):s}}function s_(a){const e={},s=a.resolution||256,c=a.clips?a.clips.length:1,p=a.image||new Gr({width:s,height:c}),u=(m,x,S)=>{e[a.evaluationKey]=S;const P=a.expression.evaluate(e);P&&(p.data[m+x+0]=Math.floor(255*P.r/P.a),p.data[m+x+1]=Math.floor(255*P.g/P.a),p.data[m+x+2]=Math.floor(255*P.b/P.a),p.data[m+x+3]=Math.floor(255*P.a))};if(a.clips)for(let m=0,x=0;m<c;++m,x+=4*s)for(let S=0,P=0;S<s;S++,P+=4){const y=S/(s-1),{start:A,end:I}=a.clips[m];u(x,P,A*(1-y)+I*y)}else for(let m=0,x=0;m<s;m++,x+=4)u(0,x,m/(s-1));return p}Gt(Zc,"AlphaImage"),Gt(Gr,"RGBAImage");const YO=en([{name:"a_pos",components:2,type:"Int16"}],4),{members:KO}=YO;function o_(a,e,s=2){const c=e&&e.length,p=c?e[0]*s:a.length;let u=PE(a,0,p,s,!0);const m=[];if(!u||u.next===u.prev)return m;let x,S,P;if(c&&(u=function(y,A,I,E){const M=[];for(let R=0,z=A.length;R<z;R++){const F=PE(y,A[R]*E,R<z-1?A[R+1]*E:y.length,E,!1);F===F.next&&(F.steiner=!0),M.push(sz(F))}M.sort(iz);for(let R=0;R<M.length;R++)I=nz(M[R],I);return I}(a,e,u,s)),a.length>80*s){x=1/0,S=1/0;let y=-1/0,A=-1/0;for(let I=s;I<p;I+=s){const E=a[I],M=a[I+1];E<x&&(x=E),M<S&&(S=M),E>y&&(y=E),M>A&&(A=M)}P=Math.max(y-x,A-S),P=P!==0?32767/P:0}return a_(u,m,s,x,S,P,0),m}function PE(a,e,s,c,p){let u;if(p===function(m,x,S,P){let y=0;for(let A=x,I=S-P;A<S;A+=P)y+=(m[I]-m[A])*(m[A+1]+m[I+1]),I=A;return y}(a,e,s,c)>0)for(let m=e;m<s;m+=c)u=LE(m/c|0,a[m],a[m+1],u);else for(let m=s-c;m>=e;m-=c)u=LE(m/c|0,a[m],a[m+1],u);return u&&jy(u,u.next)&&(c_(u),u=u.next),u}function Ph(a,e){if(!a)return a;e||(e=a);let s,c=a;do if(s=!1,c.steiner||!jy(c,c.next)&&Er(c.prev,c,c.next)!==0)c=c.next;else{if(c_(c),c=e=c.prev,c===c.next)break;s=!0}while(s||c!==e);return e}function a_(a,e,s,c,p,u,m){if(!a)return;!m&&u&&function(S,P,y,A){let I=S;do I.z===0&&(I.z=Px(I.x,I.y,P,y,A)),I.prevZ=I.prev,I.nextZ=I.next,I=I.next;while(I!==S);I.prevZ.nextZ=null,I.prevZ=null,function(E){let M,R=1;do{let z,F=E;E=null;let $=null;for(M=0;F;){M++;let H=F,V=0;for(let Y=0;Y<R&&(V++,H=H.nextZ,H);Y++);let G=R;for(;V>0||G>0&&H;)V!==0&&(G===0||!H||F.z<=H.z)?(z=F,F=F.nextZ,V--):(z=H,H=H.nextZ,G--),$?$.nextZ=z:E=z,z.prevZ=$,$=z;F=H}$.nextZ=null,R*=2}while(M>1)}(I)}(a,c,p,u);let x=a;for(;a.prev!==a.next;){const S=a.prev,P=a.next;if(u?QO(a,c,p,u):JO(a))e.push(S.i,a.i,P.i),c_(a),a=P.next,x=P.next;else if((a=P)===x){m?m===1?a_(a=ez(Ph(a),e),e,s,c,p,u,2):m===2&&tz(a,e,s,c,p,u):a_(Ph(a),e,s,c,p,u,1);break}}}function JO(a){const e=a.prev,s=a,c=a.next;if(Er(e,s,c)>=0)return!1;const p=e.x,u=s.x,m=c.x,x=e.y,S=s.y,P=c.y,y=p<u?p<m?p:m:u<m?u:m,A=x<S?x<P?x:P:S<P?S:P,I=p>u?p>m?p:m:u>m?u:m,E=x>S?x>P?x:P:S>P?S:P;let M=c.next;for(;M!==e;){if(M.x>=y&&M.x<=I&&M.y>=A&&M.y<=E&&Sf(p,x,u,S,m,P,M.x,M.y)&&Er(M.prev,M,M.next)>=0)return!1;M=M.next}return!0}function QO(a,e,s,c){const p=a.prev,u=a,m=a.next;if(Er(p,u,m)>=0)return!1;const x=p.x,S=u.x,P=m.x,y=p.y,A=u.y,I=m.y,E=x<S?x<P?x:P:S<P?S:P,M=y<A?y<I?y:I:A<I?A:I,R=x>S?x>P?x:P:S>P?S:P,z=y>A?y>I?y:I:A>I?A:I,F=Px(E,M,e,s,c),$=Px(R,z,e,s,c);let H=a.prevZ,V=a.nextZ;for(;H&&H.z>=F&&V&&V.z<=$;){if(H.x>=E&&H.x<=R&&H.y>=M&&H.y<=z&&H!==p&&H!==m&&Sf(x,y,S,A,P,I,H.x,H.y)&&Er(H.prev,H,H.next)>=0||(H=H.prevZ,V.x>=E&&V.x<=R&&V.y>=M&&V.y<=z&&V!==p&&V!==m&&Sf(x,y,S,A,P,I,V.x,V.y)&&Er(V.prev,V,V.next)>=0))return!1;V=V.nextZ}for(;H&&H.z>=F;){if(H.x>=E&&H.x<=R&&H.y>=M&&H.y<=z&&H!==p&&H!==m&&Sf(x,y,S,A,P,I,H.x,H.y)&&Er(H.prev,H,H.next)>=0)return!1;H=H.prevZ}for(;V&&V.z<=$;){if(V.x>=E&&V.x<=R&&V.y>=M&&V.y<=z&&V!==p&&V!==m&&Sf(x,y,S,A,P,I,V.x,V.y)&&Er(V.prev,V,V.next)>=0)return!1;V=V.nextZ}return!0}function ez(a,e){let s=a;do{const c=s.prev,p=s.next.next;!jy(c,p)&&RE(c,s,s.next,p)&&l_(c,p)&&l_(p,c)&&(e.push(c.i,s.i,p.i),c_(s),c_(s.next),s=a=p),s=s.next}while(s!==a);return Ph(s)}function tz(a,e,s,c,p,u){let m=a;do{let x=m.next.next;for(;x!==m.prev;){if(m.i!==x.i&&oz(m,x)){let S=DE(m,x);return m=Ph(m,m.next),S=Ph(S,S.next),a_(m,e,s,c,p,u,0),void a_(S,e,s,c,p,u,0)}x=x.next}m=m.next}while(m!==a)}function iz(a,e){return a.x-e.x}function nz(a,e){const s=function(p,u){let m=u;const x=p.x,S=p.y;let P,y=-1/0;do{if(S<=m.y&&S>=m.next.y&&m.next.y!==m.y){const R=m.x+(S-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(R<=x&&R>y&&(y=R,P=m.x<m.next.x?m:m.next,R===x))return P}m=m.next}while(m!==u);if(!P)return null;const A=P,I=P.x,E=P.y;let M=1/0;m=P;do{if(x>=m.x&&m.x>=I&&x!==m.x&&Sf(S<E?x:y,S,I,E,S<E?y:x,S,m.x,m.y)){const R=Math.abs(S-m.y)/(x-m.x);l_(m,p)&&(R<M||R===M&&(m.x>P.x||m.x===P.x&&rz(P,m)))&&(P=m,M=R)}m=m.next}while(m!==A);return P}(a,e);if(!s)return e;const c=DE(s,a);return Ph(c,c.next),Ph(s,s.next)}function rz(a,e){return Er(a.prev,a,e.prev)<0&&Er(e.next,a,a.next)<0}function Px(a,e,s,c,p){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-s)*p|0)|a<<8))|a<<4))|a<<2))|a<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-c)*p|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function sz(a){let e=a,s=a;do(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next;while(e!==a);return s}function Sf(a,e,s,c,p,u,m,x){return(p-m)*(e-x)>=(a-m)*(u-x)&&(a-m)*(c-x)>=(s-m)*(e-x)&&(s-m)*(u-x)>=(p-m)*(c-x)}function oz(a,e){return a.next.i!==e.i&&a.prev.i!==e.i&&!function(s,c){let p=s;do{if(p.i!==s.i&&p.next.i!==s.i&&p.i!==c.i&&p.next.i!==c.i&&RE(p,p.next,s,c))return!0;p=p.next}while(p!==s);return!1}(a,e)&&(l_(a,e)&&l_(e,a)&&function(s,c){let p=s,u=!1;const m=(s.x+c.x)/2,x=(s.y+c.y)/2;do p.y>x!=p.next.y>x&&p.next.y!==p.y&&m<(p.next.x-p.x)*(x-p.y)/(p.next.y-p.y)+p.x&&(u=!u),p=p.next;while(p!==s);return u}(a,e)&&(Er(a.prev,a,e.prev)||Er(a,e.prev,e))||jy(a,e)&&Er(a.prev,a,a.next)>0&&Er(e.prev,e,e.next)>0)}function Er(a,e,s){return(e.y-a.y)*(s.x-e.x)-(e.x-a.x)*(s.y-e.y)}function jy(a,e){return a.x===e.x&&a.y===e.y}function RE(a,e,s,c){const p=qy(Er(a,e,s)),u=qy(Er(a,e,c)),m=qy(Er(s,c,a)),x=qy(Er(s,c,e));return p!==u&&m!==x||!(p!==0||!$y(a,s,e))||!(u!==0||!$y(a,c,e))||!(m!==0||!$y(s,a,c))||!(x!==0||!$y(s,e,c))}function $y(a,e,s){return e.x<=Math.max(a.x,s.x)&&e.x>=Math.min(a.x,s.x)&&e.y<=Math.max(a.y,s.y)&&e.y>=Math.min(a.y,s.y)}function qy(a){return a>0?1:a<0?-1:0}function l_(a,e){return Er(a.prev,a,a.next)<0?Er(a,e,a.next)>=0&&Er(a,a.prev,e)>=0:Er(a,e,a.prev)<0||Er(a,a.next,e)<0}function DE(a,e){const s=Rx(a.i,a.x,a.y),c=Rx(e.i,e.x,e.y),p=a.next,u=e.prev;return a.next=e,e.prev=a,s.next=p,p.prev=s,c.next=s,s.prev=c,u.next=c,c.prev=u,c}function LE(a,e,s,c){const p=Rx(a,e,s);return c?(p.next=c.next,p.prev=c,c.next.prev=p,c.next=p):(p.prev=p,p.next=p),p}function c_(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Rx(a,e,s){return{i:a,x:e,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Hy(a,e){const s=a.length;if(s<=1)return[a];const c=[];let p,u;for(let m=0;m<s;m++){const x=Cd(a[m]);x!==0&&(a[m].area=Math.abs(x),u===void 0&&(u=x<0),u===x<0?(p&&c.push(p),p=[a[m]]):p.push(a[m]))}if(p&&c.push(p),e>1)for(let m=0;m<c.length;m++)c[m].length<=e||(Wu(c[m],e,1,c[m].length-1,az),c[m]=c[m].slice(0,e));return c}function az(a,e){return e.area-a.area}function OE(a,e,s=1){if(!a)return null;const c=typeof a=="string"?a:a.getPrimary().id;e[c]||(e[c]=[]);const p=qr.from(c).getPrimary().scaleSelf(s);return e[c].push(p),p.serialize()}function Dx(a,e,s,c){const p=c.patternDependencies;let u=!1;for(const m of e){const x=m.paint.get(`${a}-pattern`);x.isConstant()||(u=!0),OE(x.constantOr(null),p,s)&&(u=!0)}return u}function Lx(a,e,s,c,p,u){const m=u.patternDependencies;for(const x of e){const S=x.paint.get(`${a}-pattern`).value;if(S.kind!=="constant"){let P=S.evaluate({zoom:c},s,{},u.availableImages);P=P&&P.name?P.name:P;const y=OE(P,m,p);y&&(s.patterns[x.id]=y)}}return s}class Ox{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Fa,this.indexArray=new Or,this.indexArray2=new ll,this.programConfigurations=new hl(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Hn,this.segments2=new Hn,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=e.projection}updateFootprints(e,s){}populate(e,s,c,p){this.hasPattern=Dx("fill",this.layers,this.pixelRatio,s);const u=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:x,id:S,index:P,sourceLayerIndex:y}of e){const A=this.layers[0]._featureFilter.needGeometry,I=N(x,A);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),I,c))continue;const E=u?u.evaluate(I,{},c,s.availableImages):void 0,M={id:S,properties:x.properties,type:x.type,sourceLayerIndex:y,index:P,geometry:A?I.geometry:O(x,c,p),patterns:{},sortKey:E};m.push(M)}u&&m.sort((x,S)=>x.sortKey-S.sortKey);for(const x of m){const{geometry:S,index:P,sourceLayerIndex:y}=x;if(this.hasPattern){const A=Lx("fill",this.layers,x,this.zoom,this.pixelRatio,s);this.patternFeatures.push(A)}else this.addFeature(x,S,P,c,{},s.availableImages,s.brightness,s.elevationFeatures);s.featureIndex.insert(e[P].feature,S,P,y,this.index)}}update(e,s,c,p,u,m,x){this.programConfigurations.updatePaintArrays(e,s,u,c,p,m,x)}addFeatures(e,s,c,p,u,m){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,s,c,p,m,e.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,KO),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,s,c,p,u,m=[],x,S){for(const P of Hy(s,500)){let y=0;for(const z of P)y+=z.length;const A=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray),I=A.vertexLength,E=[],M=[];for(const z of P){if(z.length===0)continue;z!==P[0]&&M.push(E.length/2);const F=this.segments2.prepareSegment(z.length,this.layoutVertexArray,this.indexArray2),$=F.vertexLength;this.layoutVertexArray.emplaceBack(z[0].x,z[0].y),this.indexArray2.emplaceBack($+z.length-1,$),E.push(z[0].x),E.push(z[0].y);for(let H=1;H<z.length;H++)this.layoutVertexArray.emplaceBack(z[H].x,z[H].y),this.indexArray2.emplaceBack($+H-1,$+H),E.push(z[H].x),E.push(z[H].y);F.vertexLength+=z.length,F.primitiveLength+=z.length}const R=o_(E,M);for(let z=0;z<R.length;z+=3)this.indexArray.emplaceBack(I+R[z],I+R[z+1],I+R[z+2]);A.vertexLength+=y,A.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,u,m,p,x)}}let zE,kE,FE,NE;Gt(Ox,"FillBucket",{omit:["layers","patternFeatures"]});class zx{constructor(e,s,c,p){if(this.triangleCount=s.length/3,this.min=new Se(0,0),this.max=new Se(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[u,m]=[e[0].clone(),e[0].clone()];for(let A=1;A<e.length;++A){const I=e[A];u.x=Math.min(u.x,I.x),u.y=Math.min(u.y,I.y),m.x=Math.max(m.x,I.x),m.y=Math.max(m.y,I.y)}if(p){const A=Math.ceil(Math.max(m.x-u.x,m.y-u.y)/p);c=Math.max(c,A)}if(c===0)return;this.min=u,this.max=m;const x=this.max.sub(this.min);x.x=Math.max(x.x,1),x.y=Math.max(x.y,1);const S=Math.max(x.x,x.y)/c;this.cellsX=Math.max(1,Math.ceil(x.x/S)),this.cellsY=Math.max(1,Math.ceil(x.y/S)),this.xScale=1/S,this.yScale=1/S;const P=[];for(let A=0;A<this.triangleCount;A++){const I=e[s[3*A+0]].sub(this.min),E=e[s[3*A+1]].sub(this.min),M=e[s[3*A+2]].sub(this.min),R=fl(Math.floor(Math.min(I.x,E.x,M.x)),this.xScale,this.cellsX),z=fl(Math.floor(Math.max(I.x,E.x,M.x)),this.xScale,this.cellsX),F=fl(Math.floor(Math.min(I.y,E.y,M.y)),this.yScale,this.cellsY),$=fl(Math.floor(Math.max(I.y,E.y,M.y)),this.yScale,this.cellsY),H=new Se(0,0),V=new Se(0,0),G=new Se(0,0),Y=new Se(0,0);for(let te=F;te<=$;++te){H.y=V.y=te*S,G.y=Y.y=(te+1)*S;for(let he=R;he<=z;++he)H.x=G.x=he*S,V.x=Y.x=(he+1)*S,(We(I,E,M,H,V,Y)||We(I,E,M,H,Y,G))&&P.push({cellIdx:te*this.cellsX+he,triIdx:A})}}if(P.length===0)return;P.sort((A,I)=>A.cellIdx-I.cellIdx||A.triIdx-I.triIdx);let y=0;for(;y<P.length;){const A=P[y].cellIdx,I={start:this.payload.length,len:0};for(;y<P.length&&P[y].cellIdx===A;)++I.len,this.payload.push(P[y++].triIdx);this.cells[A]=I}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,s){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const c=fl(e.x-this.min.x,this.xScale,this.cellsX),p=fl(e.y-this.min.y,this.yScale,this.cellsY),u=this.cells[p*this.cellsX+c];if(u){this._lazyInitLookup();for(let m=0;m<u.len;m++){const x=this.payload[u.start+m],S=Math.floor(x/8),P=1<<x%8;if(!(this.lookup[S]&P)&&(this.lookup[S]|=P,s.push(x),s.length===this.triangleCount))return}}}query(e,s,c){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>s.x||e.y>this.max.y||this.min.y>s.y)return;this._lazyInitLookup();const p=fl(e.x-this.min.x,this.xScale,this.cellsX),u=fl(s.x-this.min.x,this.xScale,this.cellsX),m=fl(e.y-this.min.y,this.yScale,this.cellsY),x=fl(s.y-this.min.y,this.yScale,this.cellsY);for(let S=m;S<=x;S++)for(let P=p;P<=u;P++){const y=this.cells[S*this.cellsX+P];if(y)for(let A=0;A<y.len;A++){const I=this.payload[y.start+A],E=Math.floor(I/8),M=1<<I%8;if(!(this.lookup[E]&M)&&(this.lookup[E]|=M,c.push(I),c.length===this.triangleCount))return}}}}function fl(a,e,s){return Math.max(0,Math.min(s-1,Math.floor(a*e)))}Gt(zx,"TriangleGridIndex");class BE{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.footprints=[]}updateFootprints(e,s){for(const c of this.footprints)s.push({footprint:c,id:e})}populate(e,s,c,p){const u=[];for(const{feature:m,id:x,index:S,sourceLayerIndex:P}of e){const y=this.layers[0]._featureFilter.needGeometry,A=N(m,y);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),A,c))continue;const I={id:x,properties:m.properties,type:m.type,sourceLayerIndex:P,index:S,geometry:y?A.geometry:O(m,c,p),patterns:{}};u.push(I)}for(const m of u){const{geometry:x,index:S,sourceLayerIndex:P}=m;this.addFeature(m,x,S,c,{},s.availableImages,s.brightness),s.featureIndex.insert(e[S].feature,x,S,P,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,s,c,p,u,m,x){}destroy(){}addFeature(e,s,c,p,u,m=[],x){for(const S of Hy(s,2)){const P=[],y=[],A=[],I=new Se(1/0,1/0),E=new Se(-1/0,-1/0);for(const z of S)if(z.length!==0){z!==S[0]&&A.push(y.length/2);for(let F=0;F<z.length;F++)y.push(z[F].x),y.push(z[F].y),P.push(z[F]),I.x=Math.min(I.x,z[F].x),I.y=Math.min(I.y,z[F].y),E.x=Math.max(E.x,z[F].x),E.y=Math.max(E.y,z[F].y)}const M=o_(y,A),R=new zx(P,M,8,256);this.footprints.push({vertices:P,indices:M,grid:R,min:I,max:E})}}}Gt(BE,"ClipBucket",{omit:["layers"]});const lz=en([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),cz=en([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),uz=en([{name:"a_centroid_pos",components:2,type:"Uint16"}]),hz=en([{name:"a_join_normal_inside",components:3,type:"Int16"}]),dz=en([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),fz=en([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:pz}=lz;var kx,VE,Fx,UE,Nx,jE,$E,Gy={};function qE(){if(VE)return kx;VE=1;var a=Ze();function e(p,u,m,x,S){this.properties={},this.extent=m,this.type=0,this._pbf=p,this._geometry=-1,this._keys=x,this._values=S,p.readFields(s,this,u)}function s(p,u,m){p==1?u.id=m.readVarint():p==2?function(x,S){for(var P=x.readVarint()+x.pos;x.pos<P;){var y=S._keys[x.readVarint()],A=S._values[x.readVarint()];S.properties[y]=A}}(m,u):p==3?u.type=m.readVarint():p==4&&(u._geometry=m.pos)}function c(p){for(var u,m,x=0,S=0,P=p.length,y=P-1;S<P;y=S++)x+=((m=p[y]).x-(u=p[S]).x)*(u.y+m.y);return x}return kx=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var p=this._pbf;p.pos=this._geometry;for(var u,m=p.readVarint()+p.pos,x=1,S=0,P=0,y=0,A=[];p.pos<m;){if(S<=0){var I=p.readVarint();x=7&I,S=I>>3}if(S--,x===1||x===2)P+=p.readSVarint(),y+=p.readSVarint(),x===1&&(u&&A.push(u),u=[]),u.push(new a(P,y));else{if(x!==7)throw new Error("unknown command "+x);u&&u.push(u[0].clone())}}return u&&A.push(u),A},e.prototype.bbox=function(){var p=this._pbf;p.pos=this._geometry;for(var u=p.readVarint()+p.pos,m=1,x=0,S=0,P=0,y=1/0,A=-1/0,I=1/0,E=-1/0;p.pos<u;){if(x<=0){var M=p.readVarint();m=7&M,x=M>>3}if(x--,m===1||m===2)(S+=p.readSVarint())<y&&(y=S),S>A&&(A=S),(P+=p.readSVarint())<I&&(I=P),P>E&&(E=P);else if(m!==7)throw new Error("unknown command "+m)}return[y,I,A,E]},e.prototype.toGeoJSON=function(p,u,m){var x,S,P=this.extent*Math.pow(2,m),y=this.extent*p,A=this.extent*u,I=this.loadGeometry(),E=e.types[this.type];function M(F){for(var $=0;$<F.length;$++){var H=F[$];F[$]=[360*(H.x+y)/P-180,360/Math.PI*Math.atan(Math.exp((180-360*(H.y+A)/P)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(x=0;x<I.length;x++)R[x]=I[x][0];M(I=R);break;case 2:for(x=0;x<I.length;x++)M(I[x]);break;case 3:for(I=function(F){var $=F.length;if($<=1)return[F];for(var H,V,G=[],Y=0;Y<$;Y++){var te=c(F[Y]);te!==0&&(V===void 0&&(V=te<0),V===te<0?(H&&G.push(H),H=[F[Y]]):H.push(F[Y]))}return H&&G.push(H),G}(I),x=0;x<I.length;x++)for(S=0;S<I[x].length;S++)M(I[x][S])}I.length===1?I=I[0]:E="Multi"+E;var z={type:"Feature",geometry:{type:E,coordinates:I},properties:this.properties};return"id"in this&&(z.id=this.id),z},kx}function HE(){if(UE)return Fx;UE=1;var a=qE();function e(c,p){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(s,this,p),this.length=this._features.length}function s(c,p,u){c===15?p.version=u.readVarint():c===1?p.name=u.readString():c===5?p.extent=u.readVarint():c===2?p._features.push(u.pos):c===3?p._keys.push(u.readString()):c===4&&p._values.push(function(m){for(var x=null,S=m.readVarint()+m.pos;m.pos<S;){var P=m.readVarint()>>3;x=P===1?m.readString():P===2?m.readFloat():P===3?m.readDouble():P===4?m.readVarint64():P===5?m.readVarint():P===6?m.readSVarint():P===7?m.readBoolean():null}return x}(u))}return Fx=e,e.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var p=this._pbf.readVarint()+this._pbf.pos;return new a(this._pbf,p,this.extent,this._keys,this._values)},Fx}function GE(){return $E||($E=1,Gy.VectorTile=function(){if(jE)return Nx;jE=1;var a=HE();function e(s,c,p){if(s===3){var u=new a(p,p.readVarint()+p.pos);u.length&&(c[u.name]=u)}}return Nx=function(s,c){this.layers=s.readFields(e,{},c)},Nx}(),Gy.VectorTileFeature=qE(),Gy.VectorTileLayer=HE()),Gy}var Af=GE();class Rh extends Se{constructor(e,s,c){super(e,s),this.z=c}}class WE extends Rh{constructor(e,s,c,p){super(e,s,c),this.w=p}}function Wy(a,e,s,c){const p=[],u=c===0?(m,x,S,P,y,A)=>{m.push(new Se(A,S+(A-x)/(P-x)*(y-S)))}:(m,x,S,P,y,A)=>{m.push(new Se(x+(A-S)/(y-S)*(P-x),A))};for(const m of a){const x=[];for(const S of m){if(S.length<=2)continue;const P=[];for(let I=0;I<S.length-1;I++){const E=S[I].x,M=S[I].y,R=S[I+1].x,z=S[I+1].y,F=c===0?E:M,$=c===0?R:z;F<e?$>e&&u(P,E,M,R,z,e):F>s?$<s&&u(P,E,M,R,z,s):P.push(S[I]),$<e&&F>=e&&u(P,E,M,R,z,e),$>s&&F<=s&&u(P,E,M,R,z,s)}let y=S[S.length-1];const A=c===0?y.x:y.y;A>=e&&A<=s&&P.push(y),P.length&&(y=P[P.length-1],P[0].x===y.x&&P[0].y===y.y||P.push(P[0]),x.push(P))}x.length&&p.push(x)}return p}function ZE(a,e,s,c){const p=s==="x"?"y":"x",u=(c-a[s])/(e[s]-a[s]);a[p]=a[p]+(e[p]-a[p])*u,a[s]=c,a.hasOwnProperty("z")&&(a.z=di(a.z,e.z,u)),a.hasOwnProperty("w")&&(a.w=di(a.w,e.w,u))}function XE(a,e,s,c){const p=s,u=c;for(const m of["x","y"]){let x=a,S=e;x[m]>=S[m]&&(x=e,S=a),x[m]<p&&S[m]>p&&ZE(x,S,m,p),x[m]<u&&S[m]>u&&ZE(S,x,m,u)}}const Zy=Number.MAX_SAFE_INTEGER;function YE(a,e,s,c){return a.order<e||a.order===Zy||!(a.clipMask&s)||function(p,u){return u.length!==0&&u.find(m=>m===p)===void 0}(c,a.clipScope)}function Xy(a,e){return a.x-e.x||a.y-e.y}function KE(a,e){return Xy(a.min,e.min)===0&&Xy(a.max,e.max)===0}function Bx(a,e){return!(a.min.x>e.max.x||a.max.x<e.min.x||a.min.y>e.max.y||a.max.y<e.min.y)}function Vx(a,e){if(a.length!==e.length)return!1;for(let s=0;s<a.length;s++)if(a[s].sourceId!==e[s].sourceId||!KE(a[s],e[s])||a[s].order!==e[s].order||a[s].clipMask!==e[s].clipMask||!bt(a[s].clipScope,e[s].clipScope))return!1;return!0}function JE(a,e,s){const c=1/Lt,p=1/(1<<s.canonical.z),u=(e.x*c+s.canonical.x)*p+s.wrap,m=(e.y*c+s.canonical.y)*p;return{min:new Se((a.x*c+s.canonical.x)*p+s.wrap,(a.y*c+s.canonical.y)*p),max:new Se(u,m)}}function mz(a,e,s){const c=1<<s.canonical.z,p=((e.x-s.wrap)*c-s.canonical.x)*Lt,u=(e.y*c-s.canonical.y)*Lt;return{min:new Se(((a.x-s.wrap)*c-s.canonical.x)*Lt,(a.y*c-s.canonical.y)*Lt),max:new Se(p,u)}}function QE(a,e,s,c,p,u,m){const x=a.indices,S=a.vertices,P=[];for(let y=c;y<c+p;y+=3){const A=e[s[y+0]+u],I=e[s[y+1]+u],E=e[s[y+2]+u],M=Math.min(A.x,I.x,E.x),R=Math.max(A.x,I.x,E.x),z=Math.min(A.y,I.y,E.y),F=Math.max(A.y,I.y,E.y);P.length=0,a.grid.query(new Se(M,z),new Se(R,F),P);for(let $=0;$<P.length;$++){const H=P[$];if(We(S[x[3*H+0]],S[x[3*H+1]],S[x[3*H+2]],A,I,E,m))return!0}}return!1}function eS(a,e,s,c){if(!a||!s)return!1;let p=a.vertices;if(!e.canonical.equals(c.canonical)||e.wrap!==c.wrap){if(s.vertices.length<a.vertices.length)return eS(s,c,a,e);const u=e.canonical,m=c.canonical,x=Math.pow(2,m.z-u.z);p=a.vertices.map(S=>new Se((S.x+u.x*Lt)*x-m.x*Lt,(S.y+u.y*Lt)*x-m.y*Lt))}return QE(s,p,a.indices,0,a.indices.length,0,0)}function tS(a,e,s,c){const p=Math.pow(2,c.z-s.z);return new Se((a+s.x*Lt)*p-c.x*Lt,(e+s.y*Lt)*p-c.y*Lt)}function iS(a,e){const s=[];e.grid.queryPoint(a,s);const c=e.indices,p=e.vertices;for(let u=0;u<s.length;u++){const m=s[u];if(_e([p[c[3*m+0]],p[c[3*m+1]],p[c[3*m+2]]],a))return!0}return!1}const Ux=[new Se(0,0),new Se(Lt,0),new Se(Lt,Lt),new Se(0,Lt)];function nS(a,e){const s=[];let c=[];if(!e||a.length<2)return[a];if(a.length===2)return ke(a[0],a[1],Ux)?[a]:[];for(let p=0;p<a.length+2;p++){const u=a[p%a.length],m=a[(p+1)%a.length],x=ke(p===0?a[a.length-1]:a[(p-1)%a.length],u,Ux),S=ke(u,m,Ux),P=x||S;P&&c.push(u),P&&S||c.length>0&&(c.length>1&&s.push(c),c=[])}return c.length>1&&s.push(c),s}const jx=Af.VectorTileFeature.types,_z=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],gz=["fill-extrusion-flood-light-ground-radius"],yz=Math.pow(2,13),vz=Math.pow(2,15)-1,rS=new Se(0,1),Xc=2147483648;function u_(a,e,s,c,p,u,m,x){a.emplaceBack((e<<1)+m,(s<<1)+u,(Math.floor(c*yz)<<1)+p,Math.round(x))}function h_(a,e,s){a.emplaceBack(e.x*Lt,e.y*Lt,s?1:0)}function Yy(a,e,s,c,p,u){a.emplaceBack(e.x,e.y,(s.x<<1)+c,(s.y<<1)+p,u)}function d_(a,e,s){a.emplaceBack(e.x,e.y,e.z,s[0]*16384,s[1]*16384,s[2]*16384)}class sS{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class oS{constructor(){this.centroidXY=new Se(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Se(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Se(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Se(this.max.x-this.min.x,this.max.y-this.min.y)}}class aS{constructor(){this.acc=new Se(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,s){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=s.x,e.min.y=e.max.y=s.y)}appendEdge(e,s,c){this.accCount++,this.acc._add(s);let p=!!this.borders;s.x<e.min.x?(e.min.x=s.x,p=!0):s.x>e.max.x&&(e.max.x=s.x,p=!0),s.y<e.min.y?(e.min.y=s.y,p=!0):s.y>e.max.y&&(e.max.y=s.y,p=!0),((s.x===0||s.x===Lt)&&s.x===c.x)!=((s.y===0||s.y===Lt)&&s.y===c.y)&&this.processBorderOverlap(s,c),p&&this.checkBorderIntersection(s,c)}checkBorderIntersection(e,s){s.x<0!=e.x<0&&this.addBorderIntersection(0,di(s.y,e.y,(0-s.x)/(e.x-s.x))),s.x>Lt!=e.x>Lt&&this.addBorderIntersection(1,di(s.y,e.y,(Lt-s.x)/(e.x-s.x))),s.y<0!=e.y<0&&this.addBorderIntersection(2,di(s.x,e.x,(0-s.y)/(e.y-s.y))),s.y>Lt!=e.y>Lt&&this.addBorderIntersection(3,di(s.x,e.x,(Lt-s.y)/(e.y-s.y)))}addBorderIntersection(e,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[e];s<c[0]&&(c[0]=s),s>c[1]&&(c[1]=s)}processBorderOverlap(e,s){if(e.x===s.x){if(e.y===s.y)return;const c=e.x===0?0:1;this.addBorderIntersection(c,s.y),this.addBorderIntersection(c,e.y)}else{const c=e.y===0?2:3;this.addBorderIntersection(c,s.x),this.addBorderIntersection(c,e.x)}}centroid(){return this.accCount===0?new Se(0,0):new Se(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,s)=>e+ +(s[0]!==Number.MAX_VALUE),0):0}}function lS(a,e){const s=a.add(e)._unit(),c=Ct(a.x*s.x+a.y*s.y,-1,1);var p,u,m;return m=Math.acos(c),Math.min(4,Math.max(-4,Math.tan(m)))/4*vz*((p=a).x*(u=e).y-p.y*u.x<0?-1:1)}const xz=[a=>a.x<0,a=>a.x>Lt,a=>a.y<0,a=>a.y>Lt];function bz(a,e,s,c){const p=[4];if(c===0)return p;s._mult(c);const u=a.sub(s),m=e.sub(s),x=[a,e,u,m];for(let S=0;S<4;S++)for(const P of x)if(xz[S](P)){p.push(S);break}return p}class cS{constructor(e){this.vertexArray=new ff,this.indexArray=new Or,this.programConfigurations=new hl(e.layers,{zoom:e.zoom,lut:e.lut},s=>gz.includes(s)),this._segments=new Hn,this.hiddenByLandmarkVertexArray=new yf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Hn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,s,c,p=!1){const u=e.length;if(u>2){let m=Math.max(0,this._segments.get().length-1);const x=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let S;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const P=e[0],y=e[1];S=lS(P.sub(e[u-1])._perp()._unit(),y.sub(P)._perp()._unit())}for(let P=0;P<u;P++){const y=P===u-1?0:P+1,A=e[P],I=e[y],E=e[y===u-1?0:y+1],M=I.sub(A)._perp()._unit(),R=lS(M,E.sub(I)._perp()._unit()),z=S,F=R;if($x(A,I,s)||p&&dS(A,s)&&dS(I,s)){S=R;continue}const $=x.vertexLength;Yy(this.vertexArray,A,I,1,1,z),Yy(this.vertexArray,A,I,1,0,z),Yy(this.vertexArray,A,I,0,1,F),Yy(this.vertexArray,A,I,0,0,F),x.vertexLength+=4;const H=bz(A,I,M,c);for(const V of H)this._segmentToGroundQuads[m].push({id:$,region:V}),this._segmentToRegionTriCounts[m][V]+=2,x.primitiveLength+=2;S=R}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),s=e.length;for(let c=0;c<s;c++)this._segmentToGroundQuads[c].sort((p,u)=>p.region-u.region);for(let c=0;c<s;c++){const p=this._segmentToGroundQuads[c],u=e[c],m=this._segmentToRegionTriCounts[c];m.reduce((S,P)=>S+P,0);let x=0;for(let S=0;S<=4;S++){const P=m[S];if(P!==0){let y=this.regionSegments[S];y||(y=this.regionSegments[S]=new Hn);const A={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+x,vertexLength:u.vertexLength,primitiveLength:P};y.get().push(A)}x+=P}for(let S=0;S<p.length;S++){const P=p[S].id;this.indexArray.emplaceBack(P,P+1,P+3),this.indexArray.emplaceBack(P,P+3,P+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,s,c,p,u,m){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,s,c,p,u,m)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,cz.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,s,c,p,u,m,x){this.hasData()&&this.programConfigurations.updatePaintArrays(e,s,c,p,u,m,x)}updateHiddenByLandmark(e){if(!this.hasData())return;const s=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const c=e.flags&Xc?1:0;for(let p=e.groundVertexArrayOffset;p<s;++p)this.hiddenByLandmarkVertexArray.emplace(p,c);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,dz.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const s=this.regionSegments[e];s&&s.destroy()}}}}class Ky{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(s=>s.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Or,this.footprintVertices=new Fa,this.footprintSegments=[],this.layoutVertexArray=new Na,this.centroidVertexArray=new Is,this.wallVertexArray=new Oy,this.indexArray=new Or,this.programConfigurations=new hl(e.layers,{zoom:e.zoom,lut:e.lut},s=>_z.includes(s)),this.segments=new Hn,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.groundEffect=new cS(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,s){}populate(e,s,c,p){this.features=[],this.hasPattern=Dx("fill-extrusion",this.layers,this.pixelRatio,s),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=i(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:u,id:m,index:x,sourceLayerIndex:S}of e){const P=this.layers[0]._featureFilter.needGeometry,y=N(u,P);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),y,c))continue;const A={id:m,sourceLayerIndex:S,index:x,geometry:P?y.geometry:O(u,c,p),properties:u.properties,type:u.type,patterns:{}},I=this.layoutVertexArray.length,E=jx[A.type]==="Polygon";if(this.hasPattern)this.features.push(Lx("fill-extrusion",this.layers,A,this.zoom,this.pixelRatio,s));else if(this.wallMode)for(const M of A.geometry)for(const R of nS(M,E))this.addFeature(A,[R],x,c,{},s.availableImages,p,s.brightness);else this.addFeature(A,A.geometry,x,c,{},s.availableImages,p,s.brightness);s.featureIndex.insert(u,A.geometry,x,S,this.index,I)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,s,c,p,u,m){for(const x of this.features){const S=jx[x.type]==="Polygon",{geometry:P}=x;if(this.wallMode)for(const y of P)for(const A of nS(y,S))this.addFeature(x,[A],x.index,s,c,p,u,m);else this.addFeature(x,P,x.index,s,c,p,u,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,s,c,p,u,m,x){this.programConfigurations.updatePaintArrays(e,s,u,c,p,m,x),this.groundEffect.update(e,s,u,c,p,m,x)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pz),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,hz.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,fz.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,uz.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,c,p,u,m,x,S){const P=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,y=[new Se(0,0),new Se(Lt,Lt)],A=x.projection,I=A.name==="globe",E=this.wallMode||jx[e.type]==="Polygon",M=new aS;M.centroidDataIndex=this.centroidData.length;const R=new oS,z=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},p)<=0,F=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},p);let $;if(R.height=F,R.vertexArrayOffset=this.layoutVertexArray.length,R.groundVertexArrayOffset=this.groundEffect.vertexArray.length,I&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new gh),this.wallMode){if(I)return void Ti("Non zero fill-extrusion-line-width is not yet supported on globe.");if(s.length!==1)return;$=function(le){const Ee=le[0].x===le[le.length-1].x&&le[0].y===le[le.length-1].y;(function(xt){let _t=0;const Yt=xt.length;for(let Ft=0;Ft<Yt;Ft++)_t+=(xt[(Ft+1)%Yt].x-xt[Ft].x)*(xt[(Ft+1)%Yt].y+xt[Ft].y);return _t>=0})(le)||(le=le.reverse());const Ae={geometry:[],joinNormals:[],indices:[]},Pe=[],Ce=[],ze=[];let Ne=le.length;for(;Ne>=2&&le[Ne-1].equals(le[Ne-2]);)Ne--;if(Ne<(Ee?3:2))return Ae;let Ge,Fe,at,mt,ot,zt=0;for(;zt<Ne-1&&le[zt].equals(le[zt+1]);)zt++;Ee&&(Ge=le[Ne-2],ot=le[zt].sub(Ge)._unit()._perp());for(let xt=zt;xt<Ne;xt++){if(at=xt===Ne-1?Ee?le[zt+1]:void 0:le[xt+1],at&&le[xt].equals(at))continue;ot&&(mt=ot),Ge&&(Fe=Ge),Ge=le[xt],ot=at?at.sub(Ge)._unit()._perp():mt,mt=mt||ot;let _t=mt.add(ot);_t.x===0&&_t.y===0||_t._unit();const Yt=_t.x*ot.x+_t.y*ot.y,Ft=Yt!==0?1/Yt:1/0,jt=mt.x*ot.y-mt.y*ot.x>0;let mi="miter";const Ei=2;mi==="miter"&&Ft>Ei&&(mi="bevel"),mi==="bevel"&&(Ft>100&&(mi="flipbevel"),Ft<Ei&&(mi="miter"));const Mi=(Ci,Di,zi,_n)=>{const hn=new Se(Ci.x,Ci.y),bi=new Se(Ci.x,Ci.y);hn.x+=Di.x*_n,hn.y+=Di.y*_n,bi.x-=Di.x*Math.max(zi,1),bi.y-=Di.y*Math.max(zi,1),ze.push(Di),Pe.push(hn),Ce.push(bi)};if(mi==="miter")_t._mult(Ft),Mi(Ge,_t,0,0);else if(mi==="flipbevel")_t=ot.mult(-1),Mi(Ge,_t,0,0),Mi(Ge,_t.mult(-1),0,0);else{const Ci=-Math.sqrt(Ft*Ft-1),Di=jt?Ci:0,zi=jt?0:Ci;Fe&&Mi(Ge,mt,Di,zi),at&&Mi(Ge,ot,Di,zi)}}Ae.geometry=[...Pe,...Ce.reverse(),Pe[0]],Ae.joinNormals=[...ze,...ze.reverse(),ze[ze.length-1]];const Rt=Ae.geometry.length-1;for(let xt=0;xt<Rt/2;xt++)if(xt+1<Rt/2){let _t=xt,Yt=xt+1,Ft=Rt-1-xt,jt=Rt-2-xt;_t=_t===0?Rt-1:_t-1,Yt=Yt===0?Rt-1:Yt-1,Ft=Ft===0?Rt-1:Ft-1,jt=jt===0?Rt-1:jt-1,Ae.indices.push(Ft),Ae.indices.push(Yt),Ae.indices.push(_t),Ae.indices.push(Ft),Ae.indices.push(jt),Ae.indices.push(Yt)}return Ae}(s[0]),s=[$.geometry]}const H=(le,Ee)=>le<(Ee.length-1)/2||le===Ee.length-1,V=this.wallMode?[s]:Hy(s,500);for(let le=V.length-1;le>=0;le--){const Ee=V[le];(Ee.length===0||(G=Ee[0]).every(de=>de.x<=0)||G.every(de=>de.x>=Lt)||G.every(de=>de.y<=0)||G.every(de=>de.y>=Lt))&&V.splice(le,1)}var G;let Y;if(I)Y=_S(V,y,p);else{Y=[];for(const le of V)Y.push({polygon:le,bounds:y})}const te=E?this.edgeRadius:0,he=te>0&&this.zoom<17,ce=(le,Ee)=>{if(le.length===0)return!1;const de=le[le.length-1];return Ee.x===de.x&&Ee.y===de.y};for(const{polygon:le,bounds:Ee}of Y){let de=0,Ae=0;for(const Ne of le)E&&!Ne[0].equals(Ne[Ne.length-1])&&Ne.push(Ne[0]),Ae+=E?Ne.length-1:Ne.length;const Pe=this.segments.prepareSegment((E?5:4)*Ae,this.layoutVertexArray,this.indexArray);R.footprintSegIdx<0&&(R.footprintSegIdx=this.footprintSegments.length),R.polygonSegIdx<0&&(R.polygonSegIdx=this.polygonSegments.length);const Ce={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ze=new sS;if(ze.vertexOffset=this.footprintVertices.length,ze.indexOffset=3*this.footprintIndices.length,ze.ringIndices=[],E){const Ne=[],Ge=[];de=Pe.vertexLength;for(let at=0;at<le.length;at++){const mt=le[at];mt.length&&at!==0&&Ge.push(Ne.length/2);const ot=[];let zt,Rt;zt=mt[1].sub(mt[0])._perp()._unit(),ze.ringIndices.push(mt.length-1);for(let xt=1;xt<mt.length;xt++){const _t=mt[xt],Yt=mt[xt===mt.length-1?1:xt+1],Ft=_t.clone();if(te){Rt=Yt.sub(_t)._perp()._unit();const jt=zt.add(Rt)._unit(),mi=te*Math.min(4,1/(zt.x*jt.x+zt.y*jt.y));Ft.x+=mi*jt.x,Ft.y+=mi*jt.y,Ft.x=Math.round(Ft.x),Ft.y=Math.round(Ft.y),zt=Rt}if(!z||te!==0&&!he||ce(ot,Ft)||ot.push(Ft),u_(this.layoutVertexArray,Ft.x,Ft.y,0,0,1,1,0),this.wallMode){const jt=H(xt,mt);h_(this.wallVertexArray,$.joinNormals[xt],!jt)}Pe.vertexLength++,this.footprintVertices.emplaceBack(_t.x,_t.y),Ne.push(_t.x,_t.y),I&&d_(this.layoutVertexExtArray,A.projectTilePoint(Ft.x,Ft.y,p),A.upVector(p,Ft.x,Ft.y))}z&&(te===0||he)&&(ot.length!==0&&ce(ot,ot[0])&&ot.pop(),this.groundEffect.addData(ot,Ee,P))}const Fe=this.wallMode?$.indices:o_(Ne,Ge);for(let at=0;at<Fe.length;at+=3)this.footprintIndices.emplaceBack(ze.vertexOffset+Fe[at+0],ze.vertexOffset+Fe[at+1],ze.vertexOffset+Fe[at+2]),this.indexArray.emplaceBack(de+Fe[at],de+Fe[at+2],de+Fe[at+1]),Pe.primitiveLength++;ze.indexCount+=Fe.length,ze.vertexCount+=this.footprintVertices.length-ze.vertexOffset}for(let Ne=0;Ne<le.length;Ne++){const Ge=le[Ne];M.startRing(R,Ge[0]);let Fe=Ge.length>4&&fS(Ge[Ge.length-2],Ge[0],Ge[1]),at=te?wz(Ge[Ge.length-2],Ge[0],Ge[1],te):0;const mt=[];let ot,zt,Rt;zt=Ge[1].sub(Ge[0])._perp()._unit();let xt=!0;for(let _t=1,Yt=0;_t<Ge.length;_t++){let Ft=Ge[_t-1],jt=Ge[_t];const mi=Ge[_t===Ge.length-1?1:_t+1];if(M.appendEdge(R,jt,Ft),$x(jt,Ft,Ee)){te&&(zt=mi.sub(jt)._perp()._unit(),xt=!xt);continue}const Ei=jt.sub(Ft)._perp(),Mi=Ei.x/(Math.abs(Ei.x)+Math.abs(Ei.y)),Ci=Ei.y>0?1:0,Di=Ft.dist(jt);if(Yt+Di>32768&&(Yt=0),te){Rt=mi.sub(jt)._perp()._unit();let bi=hS(Ft,jt,mi,uS(zt,Rt),te);isNaN(bi)&&(bi=0);const sn=jt.sub(Ft)._unit();Ft=Ft.add(sn.mult(at))._round(),jt=jt.add(sn.mult(-bi))._round(),at=bi,zt=Rt,z&&this.zoom>=17&&(ce(mt,Ft)||mt.push(Ft),ce(mt,jt)||mt.push(jt))}const zi=Pe.vertexLength,_n=Ge.length>4&&fS(Ft,jt,mi);let hn=pS(Yt,Fe,xt);if(u_(this.layoutVertexArray,Ft.x,Ft.y,Mi,Ci,0,0,hn),u_(this.layoutVertexArray,Ft.x,Ft.y,Mi,Ci,0,1,hn),this.wallMode){const bi=H(_t-1,Ge),sn=$.joinNormals[_t-1];h_(this.wallVertexArray,sn,bi),h_(this.wallVertexArray,sn,bi)}if(Yt+=Di,hn=pS(Yt,_n,!xt),Fe=_n,u_(this.layoutVertexArray,jt.x,jt.y,Mi,Ci,0,0,hn),u_(this.layoutVertexArray,jt.x,jt.y,Mi,Ci,0,1,hn),this.wallMode){const bi=H(_t,Ge),sn=$.joinNormals[_t];h_(this.wallVertexArray,sn,bi),h_(this.wallVertexArray,sn,bi)}if(Pe.vertexLength+=4,this.indexArray.emplaceBack(zi+0,zi+1,zi+2),this.indexArray.emplaceBack(zi+1,zi+3,zi+2),Pe.primitiveLength+=2,te){const bi=de+(_t===1?Ge.length-2:_t-2),sn=_t===1?de:bi+1;if(this.indexArray.emplaceBack(zi+1,bi,zi+3),this.indexArray.emplaceBack(bi,sn,zi+3),Pe.primitiveLength+=2,ot===void 0&&(ot=zi),!$x(mi,Ge[_t],Ee)){const an=_t===Ge.length-1?ot:Pe.vertexLength;this.indexArray.emplaceBack(zi+2,zi+3,an),this.indexArray.emplaceBack(zi+3,an+1,an),this.indexArray.emplaceBack(zi+3,sn,an+1),Pe.primitiveLength+=3}xt=!xt}if(I){const bi=this.layoutVertexExtArray,sn=A.projectTilePoint(Ft.x,Ft.y,p),an=A.projectTilePoint(jt.x,jt.y,p),Mn=A.upVector(p,Ft.x,Ft.y),Yn=A.upVector(p,jt.x,jt.y);d_(bi,sn,Mn),d_(bi,sn,Mn),d_(bi,an,Yn),d_(bi,an,Yn)}}E&&(de+=Ge.length-1),z&&te&&this.zoom>=17&&(mt.length!==0&&ce(mt,mt[0])&&mt.pop(),this.groundEffect.addData(mt,Ee,P,te>0))}this.footprintSegments.push(ze),Ce.triangleCount=this.indexArray.length-Ce.triangleArrayOffset,this.polygonSegments.push(Ce),++R.footprintSegLen,++R.polygonSegLen}if(R.vertexCount=this.layoutVertexArray.length-R.vertexArrayOffset,R.groundVertexCount=this.groundEffect.vertexArray.length-R.groundVertexArrayOffset,R.vertexCount!==0){if(R.centroidXY=M.borders?rS:this.encodeCentroid(M,R),this.centroidData.push(R),M.borders){this.featuresOnBorder.push(M);const le=this.featuresOnBorder.length-1;for(let Ee=0;Ee<M.borders.length;Ee++)M.borders[Ee][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ee].push(le)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,u,m,p,S),this.groundEffect.addPaintPropertiesData(e,c,u,m,p,S),this.maxHeight=Math.max(this.maxHeight,F)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((s,c)=>this.featuresOnBorder[s].borders[e][0]-this.featuresOnBorder[c].borders[e][0])}splitToSubtiles(){const e=[];for(let x=0;x<this.centroidData.length;x++){const S=this.centroidData[x],P=+(S.min.y+S.max.y>Lt),y=2*P+(+(S.min.x+S.max.x>Lt)^P);for(let A=0;A<S.polygonSegLen;A++){const I=S.polygonSegIdx+A;e.push({centroidIdx:x,subtile:y,polygonSegmentIdx:I,triangleSegmentIdx:this.polygonSegments[I].triangleSegIdx})}}const s=new Or;e.sort((x,S)=>x.triangleSegmentIdx===S.triangleSegmentIdx?x.subtile-S.subtile:x.triangleSegmentIdx-S.triangleSegmentIdx);let c=0,p=0,u=0;for(const x of e){if(x.triangleSegmentIdx!==c)break;u++}const m=e.length;for(;p!==e.length;){c=e[p].triangleSegmentIdx;let x=0,S=p,P=p;for(let y=S;y<u&&e[y].subtile===x;y++)P++;for(;S!==u;){const y=e[S];x=y.subtile;const A=this.centroidData[y.centroidIdx].min.clone(),I=this.centroidData[y.centroidIdx].max.clone(),E={vertexOffset:this.segments.segments[c].vertexOffset,primitiveOffset:s.length,vertexLength:this.segments.segments[c].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let M=S;M<P;M++){const R=e[M],z=this.polygonSegments[R.polygonSegmentIdx],F=this.centroidData[R.centroidIdx].min,$=this.centroidData[R.centroidIdx].max,H=this.indexArray.uint16;for(let V=z.triangleArrayOffset;V<z.triangleArrayOffset+z.triangleCount;V++)s.emplaceBack(H[3*V],H[3*V+1],H[3*V+2]);E.primitiveLength+=z.triangleCount,A.x=Math.min(A.x,F.x),A.y=Math.min(A.y,F.y),I.x=Math.max(I.x,$.x),I.y=Math.max(I.y,$.y)}E.primitiveLength>0&&this.triangleSubSegments.push({segment:E,min:A,max:I}),S=P;for(let M=S;M<u&&e[M].subtile===e[S].subtile;M++)P++}p=u;for(let y=p;y<m&&e[y].triangleSegmentIdx===e[p].triangleSegmentIdx;y++)u++}s._trim(),this.indexArray=s}getVisibleSegments(e,s,c){const p=new Hn;if(this.wallMode){for(const R of this.triangleSubSegments)p.segments.push(R.segment);return p}let u=0,m=0;const x=1<<e.canonical.z;if(s){const R=s.getMinMaxForTile(e);R&&(u=R.min,m=R.max)}m+=this.maxHeight;const S=e.toUnwrapped();let P;const y=[S.canonical.x/x+S.wrap,S.canonical.y/x],A=[(S.canonical.x+1)/x+S.wrap,(S.canonical.y+1)/x],I=(R,z,F)=>[R[0]*(1-F[0])+z[0]*F[0],R[1]*(1-F[1])+z[1]*F[1]],E=[],M=[];for(const R of this.triangleSubSegments){E[0]=R.min.x/Lt,E[1]=R.min.y/Lt,M[0]=R.max.x/Lt,M[1]=R.max.y/Lt;const z=I(y,A,E),F=I(y,A,M);if(new ei([z[0],z[1],u],[F[0],F[1],m]).intersectsPrecise(c)===0){P&&(p.segments.push(P),P=void 0);continue}const $=R.segment;P&&P.vertexOffset!==$.vertexOffset&&(p.segments.push(P),P=void 0),P?(P.vertexLength+=$.vertexLength,P.primitiveLength+=$.primitiveLength):P={vertexOffset:$.vertexOffset,primitiveLength:$.primitiveLength,vertexLength:$.vertexLength,primitiveOffset:$.primitiveOffset,sortKey:void 0,vaos:{}}}return P&&p.segments.push(P),p}encodeCentroid(e,s){const c=e.centroid(),p=s.span(),u=Math.min(7,Math.round(p.x*this.tileToMeter/10)),m=Math.min(7,Math.round(p.y*this.tileToMeter/10));return new Se(Ct(c.x,1,Lt-1)<<3|u,Ct(c.y,1,Lt-1)<<3|m)}encodeBorderCentroid(e){if(!e.borders)return new Se(0,0);const s=e.borders,c=Number.MAX_VALUE;if(s[0][0]!==c||s[1][0]!==c){const p=s[0][0]!==c?0:1;return new Se(6|(s[0][0]!==c?0:65528),(s[p][0]+s[p][1])/2<<3|6)}{const p=s[2][0]!==c?2:3;return new Se((s[p][0]+s[p][1])/2<<3|6,6|(s[2][0]!==c?0:65528))}}showCentroid(e){const s=this.centroidData[e.centroidDataIndex];s.flags&=Xc,s.centroidXY.x=0,s.centroidXY.y=0,this.writeCentroidToBuffer(s)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const s=e.vertexArrayOffset,c=e.vertexCount+e.vertexArrayOffset,p=e.flags&Xc?rS:e.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(s);if(this.centroidVertexArray.geta_centroid_pos1(s)!==p.y||u!==p.x){for(let m=s;m<c;++m)this.centroidVertexArray.emplace(m,p.x,p.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,s,c){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const p=s.getReplacementRegionsForTile(e.toUnwrapped());if(Vx(this.activeReplacements,p))return;if(this.activeReplacements=p,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const m of this.centroidData)m.flags&=2147483647;const u=[];for(const m of this.activeReplacements){if(m.order<c)continue;const x=Math.max(1,Math.pow(2,m.footprintTileId.canonical.z-e.canonical.z));for(const S of this.centroidData)if(!(S.flags&Xc||m.min.x>S.max.x||S.min.x>m.max.x||m.min.y>S.max.y||S.min.y>m.max.y))for(let P=0;P<S.footprintSegLen;P++){const y=this.footprintSegments[S.footprintSegIdx+P];if(u.length=0,Tz(this.footprintVertices,y.vertexOffset,y.vertexCount,m.footprintTileId.canonical,e.canonical,u),QE(m.footprint,u,this.footprintIndices.uint16,y.indexOffset,y.indexCount,-y.vertexOffset,-x)){S.flags|=Xc;break}}}for(const m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,s,c){let p=!1;for(let u=0;u<c.footprintSegLen;u++){const m=this.footprintSegments[c.footprintSegIdx+u];let x=0;for(const S of m.ringIndices){for(let P=x,y=S+x-1;P<S+x;y=P++){const A=this.footprintVertices.int16[2*(P+m.vertexOffset)+0],I=this.footprintVertices.int16[2*(P+m.vertexOffset)+1],E=this.footprintVertices.int16[2*(y+m.vertexOffset)+1];I>s!=E>s&&e<(this.footprintVertices.int16[2*(y+m.vertexOffset)+0]-A)*(s-I)/(E-I)+A&&(p=!p)}x=S}}return p}getHeightAtTileCoord(e,s){let c=Number.NEGATIVE_INFINITY,p=!0;const u=4*(e+Lt)*Lt+(s+Lt);if(this.partLookup.hasOwnProperty(u)){const m=this.partLookup[u];return m?{height:m.height,hidden:!!(m.flags&Xc)}:void 0}for(const m of this.centroidData)e>m.max.x||m.min.x>e||s>m.max.y||m.min.y>s||this.footprintContainsPoint(e,s,m)&&m&&m.height>c&&(c=m.height,this.partLookup[u]=m,p=!!(m.flags&Xc));if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:p};this.partLookup[u]=void 0}}function uS(a,e){const s=a.add(e)._unit();return a.x*s.x+a.y*s.y}function wz(a,e,s,c){const p=e.sub(a)._perp()._unit(),u=s.sub(e)._perp()._unit();return hS(a,e,s,uS(p,u),c)}function hS(a,e,s,c,p){const u=Math.sqrt(1-c*c);return Math.min(a.dist(e)/3,e.dist(s)/3,p*u/c)}function $x(a,e,s){return a.x<s[0].x&&e.x<s[0].x||a.x>s[1].x&&e.x>s[1].x||a.y<s[0].y&&e.y<s[0].y||a.y>s[1].y&&e.y>s[1].y}function dS(a,e){return a.x<e[0].x||a.x>e[1].x||a.y<e[0].y||a.y>e[1].y}function fS(a,e,s){if(a.x<0||a.x>=Lt||e.x<0||e.x>=Lt||s.x<0||s.x>=Lt)return!1;const c=s.sub(e),p=c.perp(),u=a.sub(e);return(c.x*u.x+c.y*u.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(u.x*u.x+u.y*u.y))>-.866&&p.x*u.x+p.y*u.y<0}function pS(a,e,s){const c=e?2|a:-3&a;return s?1|c:-2&c}function mS(){const a=Math.PI/32,e=Math.tan(a),s=Xl;return s*Math.sqrt(1+2*e*e)-s}function _S(a,e,s){const c=1<<s.z,p=Ps(s.x/c),u=Ps((s.x+1)/c),m=zr(s.y/c),x=zr((s.y+1)/c);return function(S,P,y,A,I=0,E){const M=[];if(!S.length||!y||!A)return M;const R=(Y,te)=>{for(const he of Y)M.push({polygon:he,bounds:te})},z=Math.ceil(Math.log2(y)),F=Math.ceil(Math.log2(A)),$=z-F,H=[];for(let Y=0;Y<Math.abs($);Y++)H.push($>0?0:1);for(let Y=0;Y<Math.min(z,F);Y++)H.push(0),H.push(1);let V=S;if(V=Wy(V,P[0].y-I,P[1].y+I,1),V=Wy(V,P[0].x-I,P[1].x+I,0),!V.length)return M;const G=[];for(H.length?G.push({polygons:V,bounds:P,depth:0}):R(V,P);G.length;){const Y=G.pop(),te=Y.depth,he=H[te],ce=Y.bounds[0],le=Y.bounds[1],Ee=he===0?ce.x:ce.y,de=he===0?le.x:le.y,Ae=E?E(he,Ee,de):.5*(Ee+de),Pe=Wy(Y.polygons,Ee-I,Ae+I,he),Ce=Wy(Y.polygons,Ae-I,de+I,he);if(Pe.length){const ze=[ce,new Se(he===0?Ae:le.x,he===1?Ae:le.y)];H.length>te+1?G.push({polygons:Pe,bounds:ze,depth:te+1}):R(Pe,ze)}if(Ce.length){const ze=[new Se(he===0?Ae:ce.x,he===1?Ae:ce.y),le];H.length>te+1?G.push({polygons:Ce,bounds:ze,depth:te+1}):R(Ce,ze)}}return M}(a,e,Math.ceil((u-p)/11.25),Math.ceil((m-x)/11.25),1,(S,P,y)=>{if(S===0)return .5*(P+y);{const A=zr((s.y+P/Lt)/c);return(Po(.5*(zr((s.y+y/Lt)/c)+A))*c-s.y)*Lt}})}function Tz(a,e,s,c,p,u){const m=Math.pow(2,c.z-p.z);for(let x=0;x<s;x++){let S=a.int16[2*(x+e)+0],P=a.int16[2*(x+e)+1];S=(S+p.x*Lt)*m-c.x*Lt,P=(P+p.y*Lt)*m-c.y*Lt,u.push(new Se(S,P))}}let gS,yS;function f_(a,e){return a.x*e.x+a.y*e.y}function vS(a,e){if(a.length===1){let s=0;const c=e[s++];let p;for(;!p||c.equals(p);)if(p=e[s++],!p)return 1/0;for(;s<e.length;s++){const u=e[s],m=a[0],x=p.sub(c),S=u.sub(c),P=m.sub(c),y=f_(x,x),A=f_(x,S),I=f_(S,S),E=f_(P,x),M=f_(P,S),R=y*I-A*A,z=(I*E-A*M)/R,F=(y*M-A*E)/R,$=c.z*(1-z-F)+p.z*z+u.z*F;if(isFinite($))return $}return 1/0}{let s=1/0;for(const c of e)s=Math.min(s,c.z);return s}}function xS(a,e,s,c,p,u,m,x){const S=m*p.getElevationAt(a,e,!0,!0),P=u[0]!==0,y=P?u[1]===0?m*(u[0]/7-450):m*function(A,I,E){const M=Math.floor(I[0]/8),R=Math.floor(I[1]/8),z=10*(I[0]-8*M),F=10*(I[1]-8*R),$=A.getElevationAt(M,R,!0,!0),H=A.getMeterToDEM(E),V=Math.floor(.5*(z*H-1)),G=Math.floor(.5*(F*H-1)),Y=A.tileCoordToPixel(M,R),te=2*V+1,he=2*G+1,ce=function(Ce,ze,Ne,Ge,Fe){return[Ce.getElevationAtPixel(ze,Ne,!0),Ce.getElevationAtPixel(ze+Fe,Ne,!0),Ce.getElevationAtPixel(ze,Ne+Fe,!0),Ce.getElevationAtPixel(ze+Ge,Ne+Fe,!0)]}(A,Y.x-V,Y.y-G,te,he),le=Math.abs(ce[0]-ce[1]),Ee=Math.abs(ce[2]-ce[3]),de=Math.abs(ce[0]-ce[2])+Math.abs(ce[1]-ce[3]),Ae=Math.min(.25,.5*H*(le+Ee)/te),Pe=Math.min(.25,.5*H*de/he);return $+Math.max(Ae*z,Pe*F)}(p,u,x):S;return{base:S+(s===0?-1:s),top:P?Math.max(y+c,S+s+2):S+c}}Gt(Ky,"FillExtrusionBucket",{omit:["layers","features"]}),Gt(oS,"PartData"),Gt(sS,"FootprintSegment"),Gt(aS,"BorderCentroidData"),Gt(cS,"GroundEffect");const Ez=en([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Sz=en([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Az}=Ez,Mz=en([{name:"a_packed",components:3,type:"Float32"}]),{members:Cz}=Mz,Iz=en([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Pz}=Iz;class bS{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.image=new Zc({width:e,height:s}),this.positions={},this.uploaded=!1}getDash(e,s){const c=this.getKey(e,s);return this.positions[c]}trim(){const e=this.width,s=this.height=sr(this.nextRow);this.image.resize({width:e,height:s})}getKey(e,s){return e.join(",")+s}getDashRanges(e,s,c){const p=[];let u=e.length%2==1?-e[e.length-1]*c:0,m=e[0]*c,x=!0;p.push({left:u,right:m,isDash:x,zeroLength:e[0]===0});let S=e[0];for(let P=1;P<e.length;P++){x=!x;const y=e[P];u=S*c,S+=y,m=S*c,p.push({left:u,right:m,isDash:x,zeroLength:y===0})}return p}addRoundDash(e,s,c){const p=s/2;for(let u=-c;u<=c;u++){const m=this.width*(this.nextRow+c+u);let x=0,S=e[x];for(let P=0;P<this.width;P++){P/S.right>1&&(S=e[++x]);const y=Math.abs(P-S.left),A=Math.abs(P-S.right),I=Math.min(y,A);let E;const M=u/c*(p+1);if(S.isDash){const R=p-Math.abs(M);E=Math.sqrt(I*I+R*R)}else E=p-Math.sqrt(I*I+M*M);this.image.data[m+P]=Math.max(0,Math.min(255,E+128))}}}addRegularDash(e,s){for(let S=e.length-1;S>=0;--S){const P=e[S],y=e[S+1];P.zeroLength?e.splice(S,1):y&&y.isDash===P.isDash&&(y.left=P.left,e.splice(S,1))}const c=e[0],p=e[e.length-1];c.isDash===p.isDash&&(c.left=p.left-this.width,p.right=c.right+this.width);const u=this.width*this.nextRow;let m=0,x=e[m];for(let S=0;S<this.width;S++){S/x.right>1&&(x=e[++m]);const P=Math.abs(S-x.left),y=Math.abs(S-x.right),A=Math.min(P,y);this.image.data[u+S]=Math.max(0,Math.min(255,(x.isDash?A:-A)+s+128))}}addDash(e,s){const c=this.getKey(e,s);if(this.positions[c])return this.positions[c];const p=s==="round",u=p?7:0,m=2*u+1;if(this.nextRow+m>this.height)return Ti("LineAtlas out of space"),null;e.length===0&&e.push(1);let x=0;for(let y=0;y<e.length;y++)e[y]<0&&(Ti("Negative value is found in line dasharray, replacing values with 0"),e[y]=0),x+=e[y];if(x!==0){const y=this.width/x,A=this.getDashRanges(e,this.width,y);p?this.addRoundDash(A,y,u):this.addRegularDash(A,s==="square"?.5*y:0)}const S=this.nextRow+u;this.nextRow+=m;const P={tl:[S,u],br:[x,0]};return this.positions[c]=P,P}}Gt(bS,"LineAtlas");const Rz=Af.VectorTileFeature.types,Dz=Math.cos(Math.PI/180*37.5),Lz=Math.cos(Math.PI/180*5);class qx{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new _h,this.layoutVertexArray2=new sa,this.patternVertexArray=new sa,this.indexArray=new Or,this.programConfigurations=new hl(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Hn,this.maxLineLength=0,this.zOffsetVertexArray=new sa,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Lt/64}updateFootprints(e,s){}populate(e,s,c,p){this.hasPattern=Dx("line",this.layers,this.pixelRatio,s);const u=this.layers[0].layout.get("line-sort-key");this.tileToMeter=i(c);const m=this.layers[0].layout.get("line-z-offset"),x=m.isConstant()&&!m.constantOr(0),S=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=S==="sea"||S==="ground"||!x&&S==="none",this.hasZOffset&&S==="none"&&Ti(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const P=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&P!==void 0;const y=[];for(const{feature:M,id:R,index:z,sourceLayerIndex:F}of e){const $=this.layers[0]._featureFilter.needGeometry,H=N(M,$);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),H,c))continue;const V=u?u.evaluate(H,{},c):void 0,G={id:R,properties:M.properties,type:M.type,sourceLayerIndex:F,index:z,geometry:$?H.geometry:O(M,c,p),patterns:{},sortKey:V};y.push(G)}u&&y.sort((M,R)=>M.sortKey-R.sortKey);const{lineAtlas:A,featureIndex:I}=s,E=this.addConstantDashes(A);for(const M of y){const{geometry:R,index:z,sourceLayerIndex:F}=M;if(E&&this.addFeatureDashes(M,A),this.hasPattern){const $=Lx("line",this.layers,M,this.zoom,this.pixelRatio,s);this.patternFeatures.push($)}else this.addFeature(M,R,z,c,A.positions,s.availableImages,s.brightness);I.insert(e[z].feature,R,z,F,this.index)}}addConstantDashes(e){let s=!1;for(const c of this.layers){const p=c.paint.get("line-dasharray").value,u=c.layout.get("line-cap").value;if(p.kind!=="constant"||u.kind!=="constant")s=!0;else{const m=u.value,x=p.value;if(!x)continue;e.addDash(x,m)}}return s}addFeatureDashes(e,s){const c=this.zoom;for(const p of this.layers){const u=p.paint.get("line-dasharray").value,m=p.layout.get("line-cap").value;if(u.kind==="constant"&&m.kind==="constant")continue;let x,S;if(u.kind==="constant"){if(x=u.value,!x)continue}else x=u.evaluate({zoom:c},e);S=m.kind==="constant"?m.value:m.evaluate({zoom:c},e),s.addDash(x,S),e.patterns[p.id]=s.getKey(x,S)}}update(e,s,c,p,u,m,x){this.programConfigurations.updatePaintArrays(e,s,u,c,p,m,x)}addFeatures(e,s,c,p,u,m){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,s,c,p,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Cz)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,Pz)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Sz.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Az),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,s,c,p,u,m,x){const S=this.layers[0].layout,P=S.get("line-join").evaluate(e,{}),y=S.get("line-cap").evaluate(e,{}),A=S.get("line-miter-limit"),I=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=S.get("line-z-offset").value;const E=this.layers[0].paint.get("line-width").value;E.kind!=="constant"&&E.isLineProgressConstant===!1&&(this.variableWidthValue=E);for(const M of s)this.addLine(M,e,p,P,y,A,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,u,m,p,x)}addLine(e,s,c,p,u,m,x){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const S=p==="none";if(this.patternJoinNone=this.hasPattern&&S,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let H=0;H<e.length-1;H++)this.totalDistance+=e[H].dist(e[H+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const P=Rz[s.type]==="Polygon";let y=e.length;for(;y>=2&&e[y-1].equals(e[y-2]);)y--;let A=0;for(;A<y-1&&e[A].equals(e[A+1]);)A++;if(y<(P?3:2))return;p==="bevel"&&(m=1.05);const I=this.segments.prepareSegment(10*y,this.layoutVertexArray,this.indexArray);let E,M,R,z,F,$;this.e1=this.e2=-1,P&&(E=e[y-2],F=e[A].sub(E)._unit()._perp());for(let H=A;H<y;H++){if(R=H===y-1?P?e[A+1]:void 0:e[H+1],R&&e[H].equals(R))continue;F&&(z=F),E&&(M=E),E=e[H],$=this.evaluateLineProgressFeatures(M?M.dist(E):0),F=R?R.sub(E)._unit()._perp():z,z=z||F;const V=M&&R;let G=V?p:P||S?"butt":u;const Y=z.x*F.x+z.y*F.y;if(S){const Pe=function(Ce){if(Ce.patternJoinNone){const ze=Ce.segmentPoints.length/2,Ne=Ce.lineSoFar-Ce.segmentStart;for(let Ge=0;Ge<ze;++Ge){const Fe=Ce.segmentPoints[2*Ge+1],at=Math.round(Ce.segmentPoints[2*Ge])+.5+.25*Fe;Ce.patternVertexArray.emplaceBack(at,Ne,Ce.segmentStart),Ce.patternVertexArray.emplaceBack(at,Ne,Ce.segmentStart)}Ce.segmentPoints.length=0}Ce.e1=Ce.e2=-1};if(V&&Y<Lz){this.updateDistance(M,E),this.addCurrentVertex(E,z,1,1,I,$),Pe(this),this.addCurrentVertex(E,F,-1,-1,I,$);continue}if(M){if(!R){this.updateDistance(M,E),this.addCurrentVertex(E,z,1,1,I,$),Pe(this);continue}G="miter"}}let te=z.add(F);te.x===0&&te.y===0||te._unit();const he=te.x*F.x+te.y*F.y,ce=he!==0?1/he:1/0,le=2*Math.sqrt(2-2*he),Ee=he<Dz&&M&&R,de=z.x*F.y-z.y*F.x>0,Ae=this.overscaling<=16?15*Lt/(512*this.overscaling):0;if(V&&G==="round"){if(ce<x)G="miter";else if(ce<=2){const Pe=Hx(E,-10,Lt+10);G=this.hasZOffset&&(Pe||this.hasCrossSlope)?"miter":"fakeround"}}if(G==="miter"&&ce>m&&(G="bevel"),G==="bevel"&&(ce>2&&(G="flipbevel"),ce<m&&(G="miter")),M&&!(G==="miter"&&Ee)&&this.updateDistance(M,E),G==="miter")if(Ee){const Pe=E.dist(M);if(Pe>2*Ae){const ze=E.sub(E.sub(M)._mult(Ae/Pe)._round());this.updateDistance(M,ze),this.addCurrentVertex(ze,z,0,0,I,$),M=ze}this.updateDistance(M,E),te._mult(ce),this.addCurrentVertex(E,te,0,0,I,$);const Ce=E.dist(R);if(Ce>2*Ae){const ze=E.add(R.sub(E)._mult(Ae/Ce)._round());this.updateDistance(E,ze),this.addCurrentVertex(ze,F,0,0,I,$),E=ze}}else te._mult(ce),this.addCurrentVertex(E,te,0,0,I,$);else if(G==="flipbevel"){if(ce>100)te=F.mult(-1);else{const Pe=ce*z.add(F).mag()/z.sub(F).mag();te._perp()._mult(Pe*(de?-1:1))}this.addCurrentVertex(E,te,0,0,I,$),this.addCurrentVertex(E,te.mult(-1),0,0,I,$)}else if(G==="bevel"||G==="fakeround"){$!=null&&M&&this.addCurrentVertex(E,z,-1,-1,I,$);const Pe=E.dist(M)<=2*Ae&&G!=="bevel",Ce=te.mult(de?1:-1);Ce._mult(ce);const ze=F.mult(de?-1:1),Ne=z.mult(de?-1:1),Ge=this.evaluateLineProgressFeatures(this.distance);if($==null&&(this.addHalfVertex(E,Ce.x,Ce.y,!1,!de,0,I,Ge),Pe||this.addHalfVertex(E,Ce.x+2*Ne.x,Ce.y+2*Ne.y,!1,de,0,I,Ge)),G==="fakeround"){const Fe=Math.round(180*le/Math.PI/20);this.addHalfVertex(E,Ne.x,Ne.y,!1,de,0,I,Ge);for(let at=0;at<Fe;at++){let mt=at/Fe;if(mt!==.5){const zt=mt-.5;mt+=mt*zt*(mt-1)*((1.0904+Y*(Y*(3.55645-1.43519*Y)-3.2452))*zt*zt+(.848013+Y*(.215638*Y-1.06021)))}const ot=ze.sub(Ne)._mult(mt)._add(Ne)._unit();this.addHalfVertex(E,ot.x,ot.y,!1,de,0,I,Ge)}this.addHalfVertex(E,ze.x,ze.y,!1,de,0,I,Ge)}Pe||$!=null||this.addHalfVertex(E,Ce.x+2*ze.x,Ce.y+2*ze.y,!1,de,0,I,Ge),$!=null&&R&&this.addCurrentVertex(E,F,1,1,I,$)}else G==="butt"?this.addCurrentVertex(E,te,0,0,I,$):G==="square"?(M||this.addCurrentVertex(E,te,-1,-1,I,$),this.addCurrentVertex(E,te,0,0,I,$),M&&this.addCurrentVertex(E,te,1,1,I,$)):G==="round"&&(M&&(this.addCurrentVertex(E,z,0,0,I,$),this.addCurrentVertex(E,z,1,1,I,$,!0)),R&&(this.addCurrentVertex(E,F,-1,-1,I,$,!0),this.addCurrentVertex(E,F,0,0,I,$)))}}addVerticesTo(e,s,c,p,u,m,x,S,P,y){const A=(s.w-e.w)/this.tessellationStep|0;let I=0;const E=this.scaledDistance;if(A>1){this.lineSoFar=e.w;const R=(s.x-e.x)/A,z=(s.y-e.y)/A,F=(s.z-e.z)/A,$=(s.w-e.w)/A;for(let H=1;H<A;++H){e.x+=R,e.y+=z,e.z+=F,this.lineSoFar+=$,I+=$;const V=this.evaluateLineProgressFeatures(this.prevDistance+I);this.scaledDistance=(this.prevDistance+I)/this.totalDistance,this.addHalfVertex(e,c,p,y,!1,x,P,V),this.addHalfVertex(e,u,m,y,!0,-S,P,V)}}this.lineSoFar=s.w,this.scaledDistance=E;const M=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(s,c,p,y,!1,x,P,M),this.addHalfVertex(s,u,m,y,!0,-S,P,M)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Ti(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let s=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(s=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:s}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:s}:{zOffset:0,variableWidth:s}}addCurrentVertex(e,s,c,p,u,m,x=!1){const S=s.x+s.y*c,P=s.y-s.x*c,y=s.y*p-s.x,A=-s.y-s.x*p;if(m!=null){const I=this.hasZOffset,E=-10,M=Lt+10,R=m.zOffset,z=new WE(e.x,e.y,R,this.lineSoFar),F=!!I&&Hx(e,E,M),$=this.lineSoFar,H=this.distance;if(this.currentVertex)if(F){const V=this.currentVertexIsOutside,G=this.currentVertex,Y=new WE(e.x,e.y,R,this.lineSoFar);if(XE(G,Y,E,M),!Hx(Y,E,M)){if(V){this.e1=this.e2=-1,this.distance-=G.dist(z),this.lineSoFar=G.w;const te=this.evaluateLineProgressFeatures(G.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(G,S,P,x,!1,c,u,te),this.addHalfVertex(G,y,A,x,!0,-p,u,te),this.prevDistance=this.distance}this.distance=this.prevDistance+G.dist(Y),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(G,Y,S,P,y,A,c,p,u,x),this.distance=H,this.scaledDistance=this.distance/this.totalDistance}}else{const V=this.currentVertex;if(this.currentVertexIsOutside){XE(V,z,E,M),this.e1=this.e2=-1,this.distance-=V.dist(z),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=V.w;const G=this.evaluateLineProgressFeatures(V.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(V,S,P,x,!1,c,u,G),this.addHalfVertex(V,y,A,x,!0,-p,u,G),this.prevDistance=this.distance,this.distance=H,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(V,z,S,P,y,A,c,p,u,x)}else F||(this.addHalfVertex(e,S,P,x,!1,c,u,m),this.addHalfVertex(e,y,A,x,!0,-p,u,m));this.currentVertex=z,this.currentVertexIsOutside=F,this.lineSoFar=$}else this.addHalfVertex(e,S,P,x,!1,c,u,m),this.addHalfVertex(e,y,A,x,!0,-p,u,m)}addHalfVertex({x:e,y:s},c,p,u,m,x,S,P){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,x)),this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(s<<1)+(m?1:0),Math.round(63*c)+128,Math.round(63*p)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const A=di(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,A)}const y=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,y),S.primitiveLength++),m?this.e2=y:this.e1=y,P!=null&&this.zOffsetVertexArray.emplaceBack(P.zOffset,P.variableWidth,P.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,s){this.prevDistance=this.distance,this.distance+=e.dist(s),this.updateScaledDistance()}}function Hx(a,e,s){return a.x<e||a.x>s||a.y<e||a.y>s}let wS,TS;function ES(a,e,s){return e*(Lt/(a.tileSize*Math.pow(2,s-a.tileID.overscaledZ)))}Gt(qx,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const SS=(a,e,s)=>(1-s)*a+s*e;function AS(a,e){return 1/ES(a,1,e.tileZoom)}function MS(a,e,s,c){return a.translatePosMatrix(c||e.tileID.projMatrix,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const CS=a=>{const e=[];IS(a)&&e.push("RENDER_LINE_DASH"),a.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const s=a.paint.get("line-trim-offset");s[0]===0&&s[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),a.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const c=a.layout.get("line-join").constantOr("miter")==="none",p=!!a.paint.get("line-pattern").constantOr(1);return c&&p&&e.push("LINE_JOIN_NONE"),e};function IS(a){const e=a.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let Gx;const PS=()=>Gx||(Gx={layout:wS||(wS=new Dn({"line-cap":new Vt(Ye.layout_line["line-cap"]),"line-join":new Vt(Ye.layout_line["line-join"]),"line-miter-limit":new wt(Ye.layout_line["line-miter-limit"]),"line-round-limit":new wt(Ye.layout_line["line-round-limit"]),"line-sort-key":new Vt(Ye.layout_line["line-sort-key"]),"line-z-offset":new Vt(Ye.layout_line["line-z-offset"]),"line-elevation-reference":new wt(Ye.layout_line["line-elevation-reference"]),"line-cross-slope":new wt(Ye.layout_line["line-cross-slope"]),visibility:new wt(Ye.layout_line.visibility),"line-width-unit":new wt(Ye.layout_line["line-width-unit"])})),paint:TS||(TS=new Dn({"line-opacity":new Vt(Ye.paint_line["line-opacity"]),"line-color":new Vt(Ye.paint_line["line-color"]),"line-translate":new wt(Ye.paint_line["line-translate"]),"line-translate-anchor":new wt(Ye.paint_line["line-translate-anchor"]),"line-width":new Vt(Ye.paint_line["line-width"]),"line-gap-width":new Vt(Ye.paint_line["line-gap-width"]),"line-offset":new Vt(Ye.paint_line["line-offset"]),"line-blur":new Vt(Ye.paint_line["line-blur"]),"line-dasharray":new Vt(Ye.paint_line["line-dasharray"]),"line-pattern":new Vt(Ye.paint_line["line-pattern"]),"line-gradient":new Nc(Ye.paint_line["line-gradient"]),"line-trim-offset":new wt(Ye.paint_line["line-trim-offset"]),"line-trim-fade-range":new wt(Ye.paint_line["line-trim-fade-range"]),"line-trim-color":new wt(Ye.paint_line["line-trim-color"]),"line-emissive-strength":new wt(Ye.paint_line["line-emissive-strength"]),"line-border-width":new Vt(Ye.paint_line["line-border-width"]),"line-border-color":new Vt(Ye.paint_line["line-border-color"]),"line-occlusion-opacity":new wt(Ye.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},Gx);class Oz extends Vt{possiblyEvaluate(e,s){return s=new bn(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,transition:s.transition}),super.possiblyEvaluate(e,s)}evaluate(e,s,c,p){return s=Wi({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(e,s,c,p)}}let p_;function RS(a,e){return e>0?e+2*a:a}const zz=en([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),kz=en([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Fz=en([{name:"a_projected_pos",components:4,type:"Float32"}],4);en([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Nz=en([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Bz=en([{name:"a_texb",components:2,type:"Uint16"}]),Vz=en([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Uz=en([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);en([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const DS=en([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),jz=en([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);en([{name:"triangle",components:3,type:"Uint16"}]),en([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),en([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),en([{type:"Float32",name:"offsetX"}]),en([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ns=24;const Va=128;function Wx(a,e,s,c,p){if(a.kind==="camera")return a.maxSize;if(a.kind==="composite"){const u=e.possiblyEvaluate(new bn(a.maxZoom),s).evaluate(p,{},s),m=e.possiblyEvaluate(new bn(a.minZoom),s).evaluate(p,{},s);return Math.max(u,m)}return e.possiblyEvaluate(new bn(c)).evaluate(p,{},s)}function Zx(a,e){const{expression:s}=e;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new bn(a+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:p}=s;let u=0;for(;u<c.length&&c[u]<=a;)u++;u=Math.max(0,u-1);let m=u;for(;m<c.length&&c[m]<a+1;)m++;m=Math.min(c.length-1,m);const x=c[u],S=c[m];return s.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:S,interpolationType:p}:{kind:"camera",minZoom:x,maxZoom:S,minSize:s.evaluate(new bn(x)),maxSize:s.evaluate(new bn(S)),interpolationType:p}}}function Jy(a,{uSize:e,uSizeT:s},{lowerSize:c,upperSize:p}){return a.kind==="source"?c/Va:a.kind==="composite"?di(c/Va,p/Va,s):e}function Mf(a,e,s=1){let c=0,p=0;if(a.kind==="constant")p=a.layoutSize*s;else if(a.kind!=="source"){const{interpolationType:u,minZoom:m,maxZoom:x}=a,S=u?Ct(Ms.interpolationFactor(u,e,m,x),0,1):0;a.kind==="camera"?p=di(a.minSize,a.maxSize,S)*s:c=S*s}return{uSizeT:c,uSize:p}}var $z=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Va,evaluateSizeForFeature:Jy,evaluateSizeForZoom:Mf,getRasterizedIconSize:Wx,getSizeData:Zx});function qz(a,e,s){return a.sections.forEach(c=>{c.text=function(p,u,m){const x=u.layout.get("text-transform").evaluate(m,{});return x==="uppercase"?p=p.toLocaleUpperCase():x==="lowercase"&&(p=p.toLocaleLowerCase()),$s.applyArabicShaping&&(p=$s.applyArabicShaping(p)),p}(c.text,e,s)}),a}const m_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Hz(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}function Gz(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}var LS,Xx,OS,Yx={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Wz(){return LS||(LS=1,Yx.read=function(a,e,s,c,p){var u,m,x=8*p-c-1,S=(1<<x)-1,P=S>>1,y=-7,A=s?p-1:0,I=s?-1:1,E=a[e+A];for(A+=I,u=E&(1<<-y)-1,E>>=-y,y+=x;y>0;u=256*u+a[e+A],A+=I,y-=8);for(m=u&(1<<-y)-1,u>>=-y,y+=c;y>0;m=256*m+a[e+A],A+=I,y-=8);if(u===0)u=1-P;else{if(u===S)return m?NaN:1/0*(E?-1:1);m+=Math.pow(2,c),u-=P}return(E?-1:1)*m*Math.pow(2,u-c)},Yx.write=function(a,e,s,c,p,u){var m,x,S,P=8*u-p-1,y=(1<<P)-1,A=y>>1,I=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,E=c?0:u-1,M=c?1:-1,R=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(x=isNaN(e)?1:0,m=y):(m=Math.floor(Math.log(e)/Math.LN2),e*(S=Math.pow(2,-m))<1&&(m--,S*=2),(e+=m+A>=1?I/S:I*Math.pow(2,1-A))*S>=2&&(m++,S/=2),m+A>=y?(x=0,m=y):m+A>=1?(x=(e*S-1)*Math.pow(2,p),m+=A):(x=e*Math.pow(2,A-1)*Math.pow(2,p),m=0));p>=8;a[s+E]=255&x,E+=M,x/=256,p-=8);for(m=m<<p|x,P+=p;P>0;a[s+E]=255&m,E+=M,m/=256,P-=8);a[s+E-M]|=128*R}),Yx}function zS(){if(OS)return Xx;OS=1,Xx=e;var a=Wz();function e(V){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(V)?V:new Uint8Array(V||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var s=4294967296,c=1/s,p=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function u(V){return V.type===e.Bytes?V.readVarint()+V.pos:V.pos+1}function m(V,G,Y){return Y?4294967296*G+(V>>>0):4294967296*(G>>>0)+(V>>>0)}function x(V,G,Y){var te=G<=16383?1:G<=2097151?2:G<=268435455?3:Math.floor(Math.log(G)/(7*Math.LN2));Y.realloc(te);for(var he=Y.pos-1;he>=V;he--)Y.buf[he+te]=Y.buf[he]}function S(V,G){for(var Y=0;Y<V.length;Y++)G.writeVarint(V[Y])}function P(V,G){for(var Y=0;Y<V.length;Y++)G.writeSVarint(V[Y])}function y(V,G){for(var Y=0;Y<V.length;Y++)G.writeFloat(V[Y])}function A(V,G){for(var Y=0;Y<V.length;Y++)G.writeDouble(V[Y])}function I(V,G){for(var Y=0;Y<V.length;Y++)G.writeBoolean(V[Y])}function E(V,G){for(var Y=0;Y<V.length;Y++)G.writeFixed32(V[Y])}function M(V,G){for(var Y=0;Y<V.length;Y++)G.writeSFixed32(V[Y])}function R(V,G){for(var Y=0;Y<V.length;Y++)G.writeFixed64(V[Y])}function z(V,G){for(var Y=0;Y<V.length;Y++)G.writeSFixed64(V[Y])}function F(V,G){return(V[G]|V[G+1]<<8|V[G+2]<<16)+16777216*V[G+3]}function $(V,G,Y){V[Y]=G,V[Y+1]=G>>>8,V[Y+2]=G>>>16,V[Y+3]=G>>>24}function H(V,G){return(V[G]|V[G+1]<<8|V[G+2]<<16)+(V[G+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(V,G,Y){for(Y=Y||this.length;this.pos<Y;){var te=this.readVarint(),he=te>>3,ce=this.pos;this.type=7&te,V(he,G,this),this.pos===ce&&this.skip(te)}return G},readMessage:function(V,G){return this.readFields(V,G,this.readVarint()+this.pos)},readFixed32:function(){var V=F(this.buf,this.pos);return this.pos+=4,V},readSFixed32:function(){var V=H(this.buf,this.pos);return this.pos+=4,V},readFixed64:function(){var V=F(this.buf,this.pos)+F(this.buf,this.pos+4)*s;return this.pos+=8,V},readSFixed64:function(){var V=F(this.buf,this.pos)+H(this.buf,this.pos+4)*s;return this.pos+=8,V},readFloat:function(){var V=a.read(this.buf,this.pos,!0,23,4);return this.pos+=4,V},readDouble:function(){var V=a.read(this.buf,this.pos,!0,52,8);return this.pos+=8,V},readVarint:function(V){var G,Y,te=this.buf;return G=127&(Y=te[this.pos++]),Y<128?G:(G|=(127&(Y=te[this.pos++]))<<7,Y<128?G:(G|=(127&(Y=te[this.pos++]))<<14,Y<128?G:(G|=(127&(Y=te[this.pos++]))<<21,Y<128?G:function(he,ce,le){var Ee,de,Ae=le.buf;if(Ee=(112&(de=Ae[le.pos++]))>>4,de<128||(Ee|=(127&(de=Ae[le.pos++]))<<3,de<128)||(Ee|=(127&(de=Ae[le.pos++]))<<10,de<128)||(Ee|=(127&(de=Ae[le.pos++]))<<17,de<128)||(Ee|=(127&(de=Ae[le.pos++]))<<24,de<128)||(Ee|=(1&(de=Ae[le.pos++]))<<31,de<128))return m(he,Ee,ce);throw new Error("Expected varint not more than 10 bytes")}(G|=(15&(Y=te[this.pos]))<<28,V,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var V=this.readVarint();return V%2==1?(V+1)/-2:V/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var V=this.readVarint()+this.pos,G=this.pos;return this.pos=V,V-G>=12&&p?function(Y,te,he){return p.decode(Y.subarray(te,he))}(this.buf,G,V):function(Y,te,he){for(var ce="",le=te;le<he;){var Ee,de,Ae,Pe=Y[le],Ce=null,ze=Pe>239?4:Pe>223?3:Pe>191?2:1;if(le+ze>he)break;ze===1?Pe<128&&(Ce=Pe):ze===2?(192&(Ee=Y[le+1]))==128&&(Ce=(31&Pe)<<6|63&Ee)<=127&&(Ce=null):ze===3?(de=Y[le+2],(192&(Ee=Y[le+1]))==128&&(192&de)==128&&((Ce=(15&Pe)<<12|(63&Ee)<<6|63&de)<=2047||Ce>=55296&&Ce<=57343)&&(Ce=null)):ze===4&&(de=Y[le+2],Ae=Y[le+3],(192&(Ee=Y[le+1]))==128&&(192&de)==128&&(192&Ae)==128&&((Ce=(15&Pe)<<18|(63&Ee)<<12|(63&de)<<6|63&Ae)<=65535||Ce>=1114112)&&(Ce=null)),Ce===null?(Ce=65533,ze=1):Ce>65535&&(Ce-=65536,ce+=String.fromCharCode(Ce>>>10&1023|55296),Ce=56320|1023&Ce),ce+=String.fromCharCode(Ce),le+=ze}return ce}(this.buf,G,V)},readBytes:function(){var V=this.readVarint()+this.pos,G=this.buf.subarray(this.pos,V);return this.pos=V,G},readPackedVarint:function(V,G){if(this.type!==e.Bytes)return V.push(this.readVarint(G));var Y=u(this);for(V=V||[];this.pos<Y;)V.push(this.readVarint(G));return V},readPackedSVarint:function(V){if(this.type!==e.Bytes)return V.push(this.readSVarint());var G=u(this);for(V=V||[];this.pos<G;)V.push(this.readSVarint());return V},readPackedBoolean:function(V){if(this.type!==e.Bytes)return V.push(this.readBoolean());var G=u(this);for(V=V||[];this.pos<G;)V.push(this.readBoolean());return V},readPackedFloat:function(V){if(this.type!==e.Bytes)return V.push(this.readFloat());var G=u(this);for(V=V||[];this.pos<G;)V.push(this.readFloat());return V},readPackedDouble:function(V){if(this.type!==e.Bytes)return V.push(this.readDouble());var G=u(this);for(V=V||[];this.pos<G;)V.push(this.readDouble());return V},readPackedFixed32:function(V){if(this.type!==e.Bytes)return V.push(this.readFixed32());var G=u(this);for(V=V||[];this.pos<G;)V.push(this.readFixed32());return V},readPackedSFixed32:function(V){if(this.type!==e.Bytes)return V.push(this.readSFixed32());var G=u(this);for(V=V||[];this.pos<G;)V.push(this.readSFixed32());return V},readPackedFixed64:function(V){if(this.type!==e.Bytes)return V.push(this.readFixed64());var G=u(this);for(V=V||[];this.pos<G;)V.push(this.readFixed64());return V},readPackedSFixed64:function(V){if(this.type!==e.Bytes)return V.push(this.readSFixed64());var G=u(this);for(V=V||[];this.pos<G;)V.push(this.readSFixed64());return V},skip:function(V){var G=7&V;if(G===e.Varint)for(;this.buf[this.pos++]>127;);else if(G===e.Bytes)this.pos=this.readVarint()+this.pos;else if(G===e.Fixed32)this.pos+=4;else{if(G!==e.Fixed64)throw new Error("Unimplemented type: "+G);this.pos+=8}},writeTag:function(V,G){this.writeVarint(V<<3|G)},realloc:function(V){for(var G=this.length||16;G<this.pos+V;)G*=2;if(G!==this.length){var Y=new Uint8Array(G);Y.set(this.buf),this.buf=Y,this.length=G}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(V){this.realloc(4),$(this.buf,V,this.pos),this.pos+=4},writeSFixed32:function(V){this.realloc(4),$(this.buf,V,this.pos),this.pos+=4},writeFixed64:function(V){this.realloc(8),$(this.buf,-1&V,this.pos),$(this.buf,Math.floor(V*c),this.pos+4),this.pos+=8},writeSFixed64:function(V){this.realloc(8),$(this.buf,-1&V,this.pos),$(this.buf,Math.floor(V*c),this.pos+4),this.pos+=8},writeVarint:function(V){(V=+V||0)>268435455||V<0?function(G,Y){var te,he;if(G>=0?(te=G%4294967296|0,he=G/4294967296|0):(he=~(-G/4294967296),4294967295^(te=~(-G%4294967296))?te=te+1|0:(te=0,he=he+1|0)),G>=18446744073709552e3||G<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Y.realloc(10),function(ce,le,Ee){Ee.buf[Ee.pos++]=127&ce|128,ce>>>=7,Ee.buf[Ee.pos++]=127&ce|128,ce>>>=7,Ee.buf[Ee.pos++]=127&ce|128,ce>>>=7,Ee.buf[Ee.pos++]=127&ce|128,Ee.buf[Ee.pos]=127&(ce>>>=7)}(te,0,Y),function(ce,le){var Ee=(7&ce)<<4;le.buf[le.pos++]|=Ee|((ce>>>=3)?128:0),ce&&(le.buf[le.pos++]=127&ce|((ce>>>=7)?128:0),ce&&(le.buf[le.pos++]=127&ce|((ce>>>=7)?128:0),ce&&(le.buf[le.pos++]=127&ce|((ce>>>=7)?128:0),ce&&(le.buf[le.pos++]=127&ce|((ce>>>=7)?128:0),ce&&(le.buf[le.pos++]=127&ce)))))}(he,Y)}(V,this):(this.realloc(4),this.buf[this.pos++]=127&V|(V>127?128:0),V<=127||(this.buf[this.pos++]=127&(V>>>=7)|(V>127?128:0),V<=127||(this.buf[this.pos++]=127&(V>>>=7)|(V>127?128:0),V<=127||(this.buf[this.pos++]=V>>>7&127))))},writeSVarint:function(V){this.writeVarint(V<0?2*-V-1:2*V)},writeBoolean:function(V){this.writeVarint(!!V)},writeString:function(V){V=String(V),this.realloc(4*V.length),this.pos++;var G=this.pos;this.pos=function(te,he,ce){for(var le,Ee,de=0;de<he.length;de++){if((le=he.charCodeAt(de))>55295&&le<57344){if(!Ee){le>56319||de+1===he.length?(te[ce++]=239,te[ce++]=191,te[ce++]=189):Ee=le;continue}if(le<56320){te[ce++]=239,te[ce++]=191,te[ce++]=189,Ee=le;continue}le=Ee-55296<<10|le-56320|65536,Ee=null}else Ee&&(te[ce++]=239,te[ce++]=191,te[ce++]=189,Ee=null);le<128?te[ce++]=le:(le<2048?te[ce++]=le>>6|192:(le<65536?te[ce++]=le>>12|224:(te[ce++]=le>>18|240,te[ce++]=le>>12&63|128),te[ce++]=le>>6&63|128),te[ce++]=63&le|128)}return ce}(this.buf,V,this.pos);var Y=this.pos-G;Y>=128&&x(G,Y,this),this.pos=G-1,this.writeVarint(Y),this.pos+=Y},writeFloat:function(V){this.realloc(4),a.write(this.buf,V,this.pos,!0,23,4),this.pos+=4},writeDouble:function(V){this.realloc(8),a.write(this.buf,V,this.pos,!0,52,8),this.pos+=8},writeBytes:function(V){var G=V.length;this.writeVarint(G),this.realloc(G);for(var Y=0;Y<G;Y++)this.buf[this.pos++]=V[Y]},writeRawMessage:function(V,G){this.pos++;var Y=this.pos;V(G,this);var te=this.pos-Y;te>=128&&x(Y,te,this),this.pos=Y-1,this.writeVarint(te),this.pos+=te},writeMessage:function(V,G,Y){this.writeTag(V,e.Bytes),this.writeRawMessage(G,Y)},writePackedVarint:function(V,G){G.length&&this.writeMessage(V,S,G)},writePackedSVarint:function(V,G){G.length&&this.writeMessage(V,P,G)},writePackedBoolean:function(V,G){G.length&&this.writeMessage(V,I,G)},writePackedFloat:function(V,G){G.length&&this.writeMessage(V,y,G)},writePackedDouble:function(V,G){G.length&&this.writeMessage(V,A,G)},writePackedFixed32:function(V,G){G.length&&this.writeMessage(V,E,G)},writePackedSFixed32:function(V,G){G.length&&this.writeMessage(V,M,G)},writePackedFixed64:function(V,G){G.length&&this.writeMessage(V,R,G)},writePackedSFixed64:function(V,G){G.length&&this.writeMessage(V,z,G)},writeBytesField:function(V,G){this.writeTag(V,e.Bytes),this.writeBytes(G)},writeFixed32Field:function(V,G){this.writeTag(V,e.Fixed32),this.writeFixed32(G)},writeSFixed32Field:function(V,G){this.writeTag(V,e.Fixed32),this.writeSFixed32(G)},writeFixed64Field:function(V,G){this.writeTag(V,e.Fixed64),this.writeFixed64(G)},writeSFixed64Field:function(V,G){this.writeTag(V,e.Fixed64),this.writeSFixed64(G)},writeVarintField:function(V,G){this.writeTag(V,e.Varint),this.writeVarint(G)},writeSVarintField:function(V,G){this.writeTag(V,e.Varint),this.writeSVarint(G)},writeStringField:function(V,G){this.writeTag(V,e.Bytes),this.writeString(G)},writeFloatField:function(V,G){this.writeTag(V,e.Fixed32),this.writeFloat(G)},writeDoubleField:function(V,G){this.writeTag(V,e.Fixed64),this.writeDouble(G)},writeBooleanField:function(V,G){this.writeVarintField(V,!!G)}},Xx}var Qy=k(zS());const Kx=3;function Zz(a,e,s){e.glyphs=[],a===1&&s.readMessage(Xz,e)}function Xz(a,e,s){if(a===3){const{id:c,bitmap:p,width:u,height:m,left:x,top:S,advance:P}=s.readMessage(Yz,{});e.glyphs.push({id:c,bitmap:new Zc({width:u+2*Kx,height:m+2*Kx},p),metrics:{width:u,height:m,left:x,top:S,advance:P}})}else a===4?e.ascender=s.readSVarint():a===5&&(e.descender=s.readSVarint())}function Yz(a,e,s){a===1?e.id=s.readVarint():a===2?e.bitmap=s.readBytes():a===3?e.width=s.readVarint():a===4?e.height=s.readVarint():a===5?e.left=s.readSVarint():a===6?e.top=s.readSVarint():a===7&&(e.advance=s.readVarint())}const kS=Kx,Ro={horizontal:1,vertical:2,horizontalOnly:3};class __{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,s){const c=new __;return c.scale=e||1,c.fontStack=s,c}static forImage(e){const s=new __;return s.image=e,s}}class Cf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,s){const c=new Cf;for(let p=0;p<e.sections.length;p++){const u=e.sections[p];u.image?c.addImageSection(u):c.addTextSection(u,s)}return c}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(s,c){let p="";for(let u=0;u<s.length;u++){const m=s.charCodeAt(u+1)||null,x=s.charCodeAt(u-1)||null;p+=!c&&(m&&Pm(m)&&!m_[s[u+1]]||x&&Pm(x)&&!m_[s[u-1]])||!m_[s[u]]?s[u]:m_[s[u]]}return p}(this.text,e)}trim(){let e=0;for(let c=0;c<this.text.length&&e0[this.text.charCodeAt(c)];c++)e++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=e&&e0[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(e,s),this.sectionIndex=this.sectionIndex.slice(e,s)}substring(e,s){const c=new Cf;return c.text=this.text.substring(e,s),c.sectionIndex=this.sectionIndex.slice(e,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,s)=>Math.max(e,this.sections[s].scale),0)}addTextSection(e,s){this.text+=e.text,this.sections.push(__.forText(e.scale,e.fontStack||s));const c=this.sections.length-1;for(let p=0;p<e.text.length;++p)this.sectionIndex.push(c)}addImageSection(e){const s=e.image&&e.image.namePrimary?e.image.getPrimary():null;if(!s)return void Ti("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCodePoint(c),this.sections.push(__.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Ti("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Jx(a,e,s,c,p,u,m,x,S,P,y,A,I,E,M){const R=Cf.fromFeature(a,p);A===Ro.vertical&&R.verticalizePunctuation(I);let z=[];const F=function(Y,te,he,ce,le,Ee){if(!Y)return[];const de=[],Ae=function(Ne,Ge,Fe,at,mt,ot){let zt=0;for(let Rt=0;Rt<Ne.length();Rt++){const xt=Ne.getSection(Rt);zt+=FS(Ne.getCodePoint(Rt),xt,at,mt,Ge,ot)}return zt/Math.max(1,Math.ceil(zt/Fe))}(Y,te,he,ce,le,Ee),Pe=Y.text.indexOf("")>=0;let Ce=0;for(let Ne=0;Ne<Y.length();Ne++){const Ge=Y.getSection(Ne),Fe=Y.getCodePoint(Ne);if(e0[Fe]||(Ce+=FS(Fe,Ge,ce,le,te,Ee)),Ne<Y.length()-1){const at=!((ze=Fe)<11904||!(Qt["Bopomofo Extended"](ze)||Qt.Bopomofo(ze)||Qt["CJK Compatibility Forms"](ze)||Qt["CJK Compatibility Ideographs"](ze)||Qt["CJK Compatibility"](ze)||Qt["CJK Radicals Supplement"](ze)||Qt["CJK Strokes"](ze)||Qt["CJK Symbols and Punctuation"](ze)||Qt["CJK Unified Ideographs Extension A"](ze)||Qt["CJK Unified Ideographs"](ze)||Qt["Enclosed CJK Letters and Months"](ze)||Qt["Halfwidth and Fullwidth Forms"](ze)||Qt.Hiragana(ze)||Qt["Ideographic Description Characters"](ze)||Qt["Kangxi Radicals"](ze)||Qt["Katakana Phonetic Extensions"](ze)||Qt.Katakana(ze)||Qt["Vertical Forms"](ze)||Qt["Yi Radicals"](ze)||Qt["Yi Syllables"](ze)));(Kz[Fe]||at||Ge.image)&&de.push(BS(Ne+1,Ce,Ae,de,Jz(Fe,Y.getCodePoint(Ne+1),at&&Pe),!1))}}var ze;return VS(BS(Y.length(),Ce,Ae,de,0,!0))}(R,P,u,e,c,E),{processBidirectionalText:$,processStyledBidirectionalText:H}=$s;if($&&R.sections.length===1){const Y=$(R.toString(),F);for(const te of Y){const he=new Cf;he.text=te,he.sections=R.sections;for(let ce=0;ce<te.length;ce++)he.sectionIndex.push(0);z.push(he)}}else if(H){const Y=H(R.text,R.sectionIndex,F);for(const te of Y){const he=new Cf;he.text=te[0],he.sectionIndex=te[1],he.sections=R.sections,z.push(he)}}else z=function(Y,te){const he=[],ce=Y.text;let le=0;for(const Ee of te)he.push(Y.substring(le,Ee)),le=Ee;return le<ce.length&&he.push(Y.substring(le,ce.length)),he}(R,F);const V=[],G={positionedLines:V,text:R.toString(),top:y[1],bottom:y[1],left:y[0],right:y[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Y,te,he,ce,le,Ee,de,Ae,Pe,Ce,ze,Ne){let Ge=0,Fe=0,at=0;const mt=Ae==="right"?1:Ae==="left"?0:.5;let ot=!1;for(const Ft of le){const jt=Ft.getSections();for(const mi of jt){if(mi.image)continue;const Ei=te[mi.fontStack];if(Ei&&(ot=Ei.ascender!==void 0&&Ei.descender!==void 0,!ot))break}if(!ot)break}let zt=0;for(const Ft of le){Ft.trim();const jt=Ft.getMaxScale(),mi=(jt-1)*ns,Ei={positionedGlyphs:[],lineOffset:0};Y.positionedLines[zt]=Ei;const Mi=Ei.positionedGlyphs;let Ci=0;if(!Ft.length()){Fe+=Ee,++zt;continue}let Di=0,zi=0;for(let hn=0;hn<Ft.length();hn++){const bi=Ft.getSection(hn),sn=Ft.getSectionIndex(hn),an=Ft.getCodePoint(hn);let Mn=bi.scale,Yn=null,cr=null,Kn=null,Un=ns,nr=0;const _r=!(Pe===Ro.horizontal||!ze&&!sf(an)||ze&&(e0[an]||(Rt=an,Qt.Arabic(Rt)||Qt["Arabic Supplement"](Rt)||Qt["Arabic Extended-A"](Rt)||Qt["Arabic Presentation Forms-A"](Rt)||Qt["Arabic Presentation Forms-B"](Rt))));if(bi.image){const rs=ce[bi.image.serialize()];if(!rs)continue;Kn=bi.image.id,Y.iconsInText=Y.iconsInText||!0,cr=rs.paddedRect;const En=rs.displaySize;Mn=Mn*ns/Ne,Yn={width:En[0],height:En[1],left:0,top:-kS,advance:_r?En[1]:En[0],localGlyph:!1},nr=ot?-Yn.height*Mn:jt*ns-17-En[1]*Mn,Un=Yn.advance;const Zs=(_r?En[0]:En[1])*Mn-ns*jt;Zs>0&&Zs>Ci&&(Ci=Zs)}else{const rs=he[bi.fontStack];if(!rs)continue;rs[an]&&(cr=rs[an]);const En=te[bi.fontStack];if(!En)continue;const Zs=En.glyphs[an];if(!Zs)continue;if(Yn=Zs.metrics,Un=an!==8203?ns:0,ot){const Ha=En.ascender!==void 0?Math.abs(En.ascender):0,da=En.descender!==void 0?Math.abs(En.descender):0,fa=(Ha+da)*Mn;Di<fa&&(Di=fa,zi=(Ha-da)/2*Mn),nr=-Ha*Mn}else nr=(jt-Mn)*ns-17}_r?(Y.verticalizable=!0,Mi.push({glyph:an,imageName:Kn,x:Ge,y:Fe+nr,vertical:_r,scale:Mn,localGlyph:Yn.localGlyph,fontStack:bi.fontStack,sectionIndex:sn,metrics:Yn,rect:cr}),Ge+=Un*Mn+Ce):(Mi.push({glyph:an,imageName:Kn,x:Ge,y:Fe+nr,vertical:_r,scale:Mn,localGlyph:Yn.localGlyph,fontStack:bi.fontStack,sectionIndex:sn,metrics:Yn,rect:cr}),Ge+=Yn.advance*Mn+Ce)}Mi.length!==0&&(at=Math.max(Ge-Ce,at),ot?US(Mi,mt,Ci,zi,Ee*jt/2):US(Mi,mt,Ci,0,Ee/2)),Ge=0;const _n=Ee*jt+Ci;Ei.lineOffset=Math.max(Ci,mi),Fe+=_n,++zt}var Rt;const xt=Fe,{horizontalAlign:_t,verticalAlign:Yt}=Qx(de);(function(Ft,jt,mi,Ei,Mi,Ci){const Di=(jt-mi)*Mi,zi=-Ci*Ei;for(const _n of Ft)for(const hn of _n.positionedGlyphs)hn.x+=Di,hn.y+=zi})(Y.positionedLines,mt,_t,Yt,at,xt),Y.top+=-Yt*xt,Y.bottom=Y.top+xt,Y.left+=-_t*at,Y.right=Y.left+at,Y.hasBaseline=ot}(G,e,s,c,z,m,x,S,A,P,I,M),!function(Y){for(const te of Y)if(te.positionedGlyphs.length!==0)return!1;return!0}(V)&&G}const e0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Kz={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function FS(a,e,s,c,p,u){if(e.image){const m=c[e.image.serialize()];return m?m.displaySize[0]*e.scale*ns/u+p:0}{const m=s[e.fontStack],x=m&&m.glyphs[a];return x?x.metrics.advance*e.scale+p:0}}function NS(a,e,s,c){const p=Math.pow(a-e,2);return c?a<e?p/2:2*p:p+Math.abs(s)*s}function Jz(a,e,s){let c=0;return a===10&&(c-=1e4),s&&(c+=150),a!==40&&a!==65288||(c+=50),e!==41&&e!==65289||(c+=50),c}function BS(a,e,s,c,p,u){let m=null,x=NS(e,s,p,u);for(const S of c){const P=NS(e-S.x,s,p,u)+S.badness;P<=x&&(m=S,x=P)}return{index:a,x:e,priorBreak:m,badness:x}}function VS(a){return a?VS(a.priorBreak).concat(a.index):[]}function Qx(a){let e=.5,s=.5;switch(a){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:e,verticalAlign:s}}function US(a,e,s,c,p){if(!(e||s||c||p))return;const u=a.length-1,m=a[u],x=(m.x+m.metrics.advance*m.scale)*e;for(let S=0;S<=u;S++)a[S].x-=x,a[S].y+=s+c+p}function Qz(a,e,s,c){const{horizontalAlign:p,verticalAlign:u}=Qx(c),m=s[0]-a.displaySize[0]*p,x=s[1]-a.displaySize[1]*u;return{imagePrimary:a,imageSecondary:e,top:x,bottom:x+a.displaySize[1],left:m,right:m+a.displaySize[0]}}function jS(a,e,s,c,p,u){const m=a.imagePrimary;let x;if(m.content){const z=m.content,F=m.pixelRatio||1;x=[z[0]/F,z[1]/F,m.displaySize[0]-z[2]/F,m.displaySize[1]-z[3]/F]}const S=e.left*u,P=e.right*u;let y,A,I,E;s==="width"||s==="both"?(E=p[0]+S-c[3],A=p[0]+P+c[1]):(E=p[0]+(S+P-m.displaySize[0])/2,A=E+m.displaySize[0]);const M=e.top*u,R=e.bottom*u;return s==="height"||s==="both"?(y=p[1]+M-c[0],I=p[1]+R+c[2]):(y=p[1]+(M+R-m.displaySize[1])/2,I=y+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:y,right:A,bottom:I,left:E,collisionPadding:x}}class Jl extends Se{constructor(e,s,c,p,u){super(e,s),this.angle=p,this.z=c,u!==void 0&&(this.segment=u)}clone(){return new Jl(this.x,this.y,this.z,this.angle,this.segment)}}function $S(a,e,s,c,p){if(e.segment===void 0)return!0;let u=e,m=e.segment+1,x=0;for(;x>-s/2;){if(m--,m<0)return!1;x-=a[m].dist(u),u=a[m]}x+=a[m].dist(a[m+1]),m++;const S=[];let P=0;for(;x<s/2;){const y=a[m],A=a[m+1];if(!A)return!1;let I=a[m-1].angleTo(y)-y.angleTo(A);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:x,angleDelta:I}),P+=I;x-S[0].distance>c;)P-=S.shift().angleDelta;if(P>p)return!1;m++,x+=y.dist(A)}return!0}function qS(a){let e=0;for(let s=0;s<a.length-1;s++)e+=a[s].dist(a[s+1]);return e}function HS(a,e,s){return a?.6*e*s:0}function GS(a,e){return Math.max(a?a.right-a.left:0,e?e.right-e.left:0)}function ek(a,e,s,c,p,u){const m=HS(s,p,u),x=GS(s,c)*u;let S=0;const P=qS(a)/2;for(let y=0;y<a.length-1;y++){const A=a[y],I=a[y+1],E=A.dist(I);if(S+E>P){const M=(P-S)/E,R=di(A.x,I.x,M),z=di(A.y,I.y,M),F=new Jl(R,z,0,I.angleTo(A),y);return!m||$S(a,F,x,m,e)?F:void 0}S+=E}}function tk(a,e,s,c,p,u,m,x,S){const P=HS(c,u,m),y=GS(c,p),A=y*m,I=a[0].x===0||a[0].x===S||a[0].y===0||a[0].y===S;return e-A<e/4&&(e=A+e/4),WS(a,I?e/2*x%e:(y/2+2*u)*m*x%e,e,P,s,A,I,!1,S)}function WS(a,e,s,c,p,u,m,x,S){const P=u/2,y=qS(a);let A=0,I=e-s,E=[];for(let M=0;M<a.length-1;M++){const R=a[M],z=a[M+1],F=R.dist(z),$=z.angleTo(R);for(;I+s<A+F;){I+=s;const H=(I-A)/F,V=di(R.x,z.x,H),G=di(R.y,z.y,H);if(V>=0&&V<S&&G>=0&&G<S&&I-P>=0&&I+P<=y){const Y=new Jl(V,G,0,$,M);c&&!$S(a,Y,u,c,p)||E.push(Y)}}A+=F}return x||E.length||m||(E=WS(a,A/2,s,c,p,u,m,!0,S)),E}function ZS(a,e,s,c,p){const u=[];for(let m=0;m<a.length;m++){const x=a[m];let S;for(let P=0;P<x.length-1;P++){let y=x[P],A=x[P+1];y.x<e&&A.x<e||(y.x<e?y=new Se(e,y.y+(e-y.x)/(A.x-y.x)*(A.y-y.y))._round():A.x<e&&(A=new Se(e,y.y+(e-y.x)/(A.x-y.x)*(A.y-y.y))._round()),y.y<s&&A.y<s||(y.y<s?y=new Se(y.x+(s-y.y)/(A.y-y.y)*(A.x-y.x),s)._round():A.y<s&&(A=new Se(y.x+(s-y.y)/(A.y-y.y)*(A.x-y.x),s)._round()),y.x>=c&&A.x>=c||(y.x>=c?y=new Se(c,y.y+(c-y.x)/(A.x-y.x)*(A.y-y.y))._round():A.x>=c&&(A=new Se(c,y.y+(c-y.x)/(A.x-y.x)*(A.y-y.y))._round()),y.y>=p&&A.y>=p||(y.y>=p?y=new Se(y.x+(p-y.y)/(A.y-y.y)*(A.x-y.x),p)._round():A.y>=p&&(A=new Se(y.x+(p-y.y)/(A.y-y.y)*(A.x-y.x),p)._round()),S&&y.equals(S[S.length-1])||(S=[y],u.push(S)),S.push(A)))))}}return u}function XS(a){let e=0,s=0;for(const m of a)e+=m.w*m.h,s=Math.max(s,m.w);a.sort((m,x)=>x.h-m.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}];let p=0,u=0;for(const m of a)for(let x=c.length-1;x>=0;x--){const S=c[x];if(!(m.w>S.w||m.h>S.h)){if(m.x=S.x,m.y=S.y,u=Math.max(u,m.y+m.h),p=Math.max(p,m.x+m.w),m.w===S.w&&m.h===S.h){const P=c.pop();x<c.length&&(c[x]=P)}else m.h===S.h?(S.x+=m.w,S.w-=m.w):m.w===S.w?(S.y+=m.h,S.h-=m.h):(c.push({x:S.x+m.w,y:S.y,w:S.w-m.w,h:m.h}),S.y+=m.h,S.h-=m.h);break}}return{w:p,h:u,fill:e/(p*u)||0}}Gt(Jl,"Anchor");const g_=1;class y_{static getImagePositionScale(e,s,c){return s&&e&&e.options&&e.options.transform?{x:e.options.transform.a,y:e.options.transform.d}:{x:c,y:c}}constructor(e,{pixelRatio:s,version:c,stretchX:p,stretchY:u,content:m,sdf:x,usvg:S},P,y){this.paddedRect=e,this.pixelRatio=s,this.stretchX=p,this.stretchY=u,this.content=m,this.version=c,this.padding=P,this.sdf=x,this.scale=y_.getImagePositionScale(y,S,s)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}class YS{constructor(e,s,c){const p={},u={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,p,g_,m),this.addImages(s,u,2,m);const{w:x,h:S}=XS(m),P=new Gr({width:x||1,height:S||1});for(const y in e){const A=e[y],I=p[y].paddedRect;Gr.copy(A.data,P,{x:0,y:0},{x:I.x+g_,y:I.y+g_},A.data,c,A.sdf)}for(const y in s){const A=s[y],I=u[y].paddedRect;let E=u[y].padding;const M=I.x+E,R=I.y+E,z=A.data.width,F=A.data.height;E=E>1?E-1:E,Gr.copy(A.data,P,{x:0,y:0},{x:M,y:R},A.data,c),Gr.copy(A.data,P,{x:0,y:F-E},{x:M,y:R-E},{width:z,height:E},c),Gr.copy(A.data,P,{x:0,y:0},{x:M,y:R+F},{width:z,height:E},c),Gr.copy(A.data,P,{x:z-E,y:0},{x:M-E,y:R},{width:E,height:F},c),Gr.copy(A.data,P,{x:0,y:0},{x:M+z,y:R},{width:E,height:F},c),Gr.copy(A.data,P,{x:z-E,y:F-E},{x:M-E,y:R-E},{width:E,height:E},c),Gr.copy(A.data,P,{x:0,y:F-E},{x:M+z,y:R-E},{width:E,height:E},c),Gr.copy(A.data,P,{x:0,y:0},{x:M+z,y:R+F},{width:E,height:E},c),Gr.copy(A.data,P,{x:z-E,y:0},{x:M-E,y:R+F},{width:E,height:E},c)}this.lut=c,this.image=P,this.iconPositions=p,this.patternPositions=u}addImages(e,s,c,p){for(const u in e){const m=e[u],x={x:0,y:0,w:m.data.width+2*c,h:m.data.height+2*c};p.push(x);const S=ia.deserializeFromString(u);s[u]=new y_(x,m,c,S),m.hasRenderCallback&&this.haveRenderCallbacks.push(S.id)}}patchUpdatedImages(e,s,c){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(p=>e.hasImage(p,c)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,c);for(const p in e.getUpdatedImages(c)){for(const u of Object.keys(this.iconPositions))ia.deserializeId(u)===p&&this.patchUpdatedImage(this.iconPositions[u],e.getImage(p,c),s);for(const u of Object.keys(this.patternPositions))ia.deserializeId(u)===p&&this.patchUpdatedImage(this.patternPositions[u],e.getImage(p,c),s)}}patchUpdatedImage(e,s,c){if(!e||!s||e.version===s.version)return;e.version=s.version;const[p,u]=e.tl,m=e.sdf;if(this.lut||m){const x={width:s.data.width,height:s.data.height},S=new Gr(x);Gr.copy(s.data,S,{x:0,y:0},{x:0,y:0},x,this.lut,m),c.update(S,{position:{x:p,y:u}})}else c.update(s.data,{position:{x:p,y:u}})}}Gt(y_,"ImagePosition"),Gt(YS,"ImageAtlas");const v_=1e20;function KS(a,e,s,c,p,u,m,x,S){for(let P=e;P<e+c;P++)JS(a,s*u+P,u,p,m,x,S);for(let P=s;P<s+p;P++)JS(a,P*u+e,1,c,m,x,S)}function JS(a,e,s,c,p,u,m){u[0]=0,m[0]=-v_,m[1]=v_,p[0]=a[e];for(let x=1,S=0,P=0;x<c;x++){p[x]=a[e+x*s];const y=x*x;do{const A=u[S];P=(p[x]-p[A]+y-A*A)/(x-A)/2}while(P<=m[S]&&--S>-1);S++,u[S]=x,m[S]=P,m[S+1]=v_}for(let x=0,S=0;x<c;x++){for(;m[S+1]<x;)S++;const P=u[S],y=x-P;a[e+x*s]=p[P]+y*y}}const Ua=2,eb={none:0,ideographs:1,all:2};class If{constructor(e,s,c){this.requestManager=e,this.localGlyphMode=s,this.localFontFamily=c,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,s){this.urls[s]=e}getGlyphs(e,s,c){const p=[],u=this.urls[s]||pr.GLYPHS_URL;for(const m in e)for(const x of e[m])p.push({stack:m,id:x});Gi(p,({stack:m,id:x},S)=>{let P=this.entries[m];P||(P=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let y=P.glyphs[x];if(y!==void 0)return void S(null,{stack:m,id:x,glyph:y});if(y=this._tinySDF(P,m,x),y)return P.glyphs[x]=y,void S(null,{stack:m,id:x,glyph:y});const A=Math.floor(x/256);if(256*A>65535)return Ti("glyphs > 65535 not supported"),void S(null,{stack:m,id:x,glyph:y});if(P.ranges[A])return void S(null,{stack:m,id:x,glyph:y});let I=P.requests[A];I||(I=P.requests[A]=[],If.loadGlyphRange(m,A,u,this.requestManager,(E,M)=>{if(M){P.ascender=M.ascender,P.descender=M.descender;for(const R in M.glyphs)this._doesCharSupportLocalGlyph(+R)||(P.glyphs[+R]=M.glyphs[+R]);P.ranges[A]=!0}for(const R of I)R(E,M);delete P.requests[A]})),I.push((E,M)=>{E?S(E):M&&S(null,{stack:m,id:x,glyph:M.glyphs[x]||null})})},(m,x)=>{if(m)c(m);else if(x){const S={};for(const{stack:P,id:y,glyph:A}of x)S[P]===void 0&&(S[P]={}),S[P].glyphs===void 0&&(S[P].glyphs={}),S[P].glyphs[y]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},S[P].ascender=this.entries[P].ascender,S[P].descender=this.entries[P].descender;c(null,S)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==eb.none&&(this.localGlyphMode===eb.all?!!this.localFontFamily:!!this.localFontFamily&&(Qt["CJK Unified Ideographs"](e)||Qt["Hangul Syllables"](e)||Qt.Hiragana(e)||Qt.Katakana(e)||Qt["CJK Symbols and Punctuation"](e)||Qt["CJK Unified Ideographs Extension A"](e)||Qt["CJK Unified Ideographs Extension B"](e)||Qt.Osage(e)))}_tinySDF(e,s,c){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(c))return;let u=e.tinySDF;if(!u){let R="400";/bold/i.test(s)?R="900":/medium/i.test(s)?R="500":/light/i.test(s)&&(R="200"),u=e.tinySDF=new If.TinySDF({fontFamily:p,fontWeight:R,fontSize:24*Ua,buffer:3*Ua,radius:8*Ua}),u.fontWeight=R}if(this.localGlyphs[u.fontWeight][c])return this.localGlyphs[u.fontWeight][c];const m=String.fromCodePoint(c),{data:x,width:S,height:P,glyphWidth:y,glyphHeight:A,glyphLeft:I,glyphTop:E,glyphAdvance:M}=u.draw(m);return this.localGlyphs[u.fontWeight][c]={id:c,bitmap:new Zc({width:S,height:P},x),metrics:{width:y/Ua,height:A/Ua,left:I/Ua,top:E/Ua-27,advance:M/Ua,localGlyph:!0}}}}If.loadGlyphRange=function(a,e,s,c,p){const u=256*e,m=u+255,x=c.transformRequest(c.normalizeGlyphsURL(s).replace("{fontstack}",a).replace("{range}",`${u}-${m}`),Ki.Glyphs);br(x,(S,P)=>{if(S)p(S);else if(P){const y={},A=function(I){return new Qy(I).readFields(Zz,{})}(P);for(const I of A.glyphs)y[I.id]=I;p(null,{glyphs:y,ascender:A.ascender,descender:A.descender})}})},If.TinySDF=class{constructor({fontSize:a=24,buffer:e=3,radius:s=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:u="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=c,this.radius=s;const x=this.size=a+4*e,S=this._createCanvas(x),P=this.ctx=S.getContext("2d",{willReadFrequently:!0});P.font=`${m} ${u} ${a}px ${p}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(a){const e=document.createElement("canvas");return e.width=e.height=a,e}draw(a){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:u}=this.ctx.measureText(a),m=Math.ceil(s),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-p))),S=Math.min(this.size-this.buffer,m+Math.ceil(c)),P=x+2*this.buffer,y=S+2*this.buffer,A=Math.max(P*y,0),I=new Uint8ClampedArray(A),E={data:I,width:P,height:y,glyphWidth:x,glyphHeight:S,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(x===0||S===0)return E;const{ctx:M,buffer:R,gridInner:z,gridOuter:F}=this;M.clearRect(R,R,x,S),M.fillText(a,R,R+m);const $=M.getImageData(R,R,x,S);F.fill(v_,0,A),z.fill(0,0,A);for(let H=0;H<S;H++)for(let V=0;V<x;V++){const G=$.data[4*(H*x+V)+3]/255;if(G===0)continue;const Y=(H+R)*P+V+R;if(G===1)F[Y]=0,z[Y]=v_;else{const te=.5-G;F[Y]=te>0?te*te:0,z[Y]=te<0?te*te:0}}KS(F,0,0,P,y,P,this.f,this.v,this.z),KS(z,R,R,x,S,P,this.f,this.v,this.z);for(let H=0;H<A;H++){const V=Math.sqrt(F[H])-Math.sqrt(z[H]);I[H]=Math.round(255-255*(V/this.radius+this.cutoff))}return E}};const Yc=g_;function QS(a,e){return a+e[1]-e[0]}function eA(a,e,s,c,p=1){const u=[],m=a.imagePrimary,x=m.pixelRatio,S=m.paddedRect.w-2*Yc,P=m.paddedRect.h-2*Yc,y=(a.right-a.left)*p,A=(a.bottom-a.top)*p,I=m.stretchX||[[0,S]],E=m.stretchY||[[0,P]],M=I.reduce(QS,0),R=E.reduce(QS,0),z=S-M,F=P-R;let $=0,H=M,V=0,G=R,Y=0,te=z,he=0,ce=F;if(m.content&&c){const Ee=m.content;$=t0(I,0,Ee[0]),V=t0(E,0,Ee[1]),H=t0(I,Ee[0],Ee[2]),G=t0(E,Ee[1],Ee[3]),Y=Ee[0]-$,he=Ee[1]-V,te=Ee[2]-Ee[0]-H,ce=Ee[3]-Ee[1]-G}const le=(Ee,de,Ae,Pe)=>{const Ce=i0(Ee.stretch-$,H,y,a.left*p),ze=n0(Ee.fixed-Y,te,Ee.stretch,M),Ne=i0(de.stretch-V,G,A,a.top*p),Ge=n0(de.fixed-he,ce,de.stretch,R),Fe=i0(Ae.stretch-$,H,y,a.left*p),at=n0(Ae.fixed-Y,te,Ae.stretch,M),mt=i0(Pe.stretch-V,G,A,a.top*p),ot=n0(Pe.fixed-he,ce,Pe.stretch,R),zt=new Se(Ce,Ne),Rt=new Se(Fe,Ne),xt=new Se(Fe,mt),_t=new Se(Ce,mt),Yt=new Se(ze/x,Ge/x),Ft=new Se(at/x,ot/x),jt=e*Math.PI/180;if(jt){const zi=Math.sin(jt),_n=Math.cos(jt),hn=[_n,-zi,zi,_n];zt._matMult(hn),Rt._matMult(hn),_t._matMult(hn),xt._matMult(hn)}const mi=Ee.stretch+Ee.fixed,Ei=Ae.stretch+Ae.fixed,Mi=de.stretch+de.fixed,Ci=Pe.stretch+Pe.fixed,Di=a.imageSecondary;return{tl:zt,tr:Rt,bl:_t,br:xt,texPrimary:{x:m.paddedRect.x+Yc+mi,y:m.paddedRect.y+Yc+Mi,w:Ei-mi,h:Ci-Mi},texSecondary:Di?{x:Di.paddedRect.x+Yc+mi,y:Di.paddedRect.y+Yc+Mi,w:Ei-mi,h:Ci-Mi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Yt,pixelOffsetBR:Ft,minFontScaleX:te/x/y,minFontScaleY:ce/x/A,isSDF:s}};if(c&&(m.stretchX||m.stretchY)){const Ee=tA(I,z,M),de=tA(E,F,R);for(let Ae=0;Ae<Ee.length-1;Ae++){const Pe=Ee[Ae],Ce=Ee[Ae+1];for(let ze=0;ze<de.length-1;ze++)u.push(le(Pe,de[ze],Ce,de[ze+1]))}}else u.push(le({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:P+1}));return u}function t0(a,e,s){let c=0;for(const p of a)c+=Math.max(e,Math.min(s,p[1]))-Math.max(e,Math.min(s,p[0]));return c}function tA(a,e,s){const c=[{fixed:-Yc,stretch:0}];for(const[p,u]of a){const m=c[c.length-1];c.push({fixed:p-m.stretch,stretch:m.stretch}),c.push({fixed:p-m.stretch,stretch:m.stretch+(u-p)})}return c.push({fixed:e+Yc,stretch:s}),c}function i0(a,e,s,c){return a/e*s+c}function n0(a,e,s,c){return a-e*s/c}function ik(a,e,s,c){const p=e+a.positionedLines[c].lineOffset;return c===0?s+p/2:s+(p+(e+a.positionedLines[c-1].lineOffset))/2}function nk(a,e=1,s=!1){let c=1/0,p=1/0,u=-1/0,m=-1/0;const x=a[0];for(let E=0;E<x.length;E++){const M=x[E];(!E||M.x<c)&&(c=M.x),(!E||M.y<p)&&(p=M.y),(!E||M.x>u)&&(u=M.x),(!E||M.y>m)&&(m=M.y)}const S=Math.min(u-c,m-p);let P=S/2;const y=new Hr([],rk);if(S===0)return new Se(c,p);for(let E=c;E<u;E+=S)for(let M=p;M<m;M+=S)y.push(new Pf(E+P,M+P,P,a));let A=function(E){let M=0,R=0,z=0;const F=E[0];for(let $=0,H=F.length,V=H-1;$<H;V=$++){const G=F[$],Y=F[V],te=G.x*Y.y-Y.x*G.y;R+=(G.x+Y.x)*te,z+=(G.y+Y.y)*te,M+=3*te}return new Pf(R/M,z/M,0,E)}(a),I=y.length;for(;y.length;){const E=y.pop();(E.d>A.d||!A.d)&&(A=E,s&&console.log("found best %d after %d probes",Math.round(1e4*E.d)/1e4,I)),E.max-A.d<=e||(P=E.h/2,y.push(new Pf(E.p.x-P,E.p.y-P,P,a)),y.push(new Pf(E.p.x+P,E.p.y-P,P,a)),y.push(new Pf(E.p.x-P,E.p.y+P,P,a)),y.push(new Pf(E.p.x+P,E.p.y+P,P,a)),I+=4)}return s&&(console.log(`num probes: ${I}`),console.log(`best distance: ${A.d}`)),A.p}function rk(a,e){return e.max-a.max}class Pf{constructor(e,s,c,p){this.p=new Se(e,s),this.h=c,this.d=function(u,m){let x=!1,S=1/0;for(let P=0;P<m.length;P++){const y=m[P];for(let A=0,I=y.length,E=I-1;A<I;E=A++){const M=y[A],R=y[E];M.y>u.y!=R.y>u.y&&u.x<(R.x-M.x)*(u.y-M.y)/(R.y-M.y)+M.x&&(x=!x),S=Math.min(S,ge(u,M,R))}}return(x?1:-1)*Math.sqrt(S)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const tb=Number.POSITIVE_INFINITY,sk=Math.sqrt(2);function iA(a,[e,s]){let c=0,p=0;if(s===tb){e<0&&(e=0);const u=e/sk;switch(a){case"top-right":case"top-left":p=u-7;break;case"bottom-right":case"bottom-left":p=7-u;break;case"bottom":p=7-e;break;case"top":p=e-7}switch(a){case"top-right":case"bottom-right":c=-u;break;case"top-left":case"bottom-left":c=u;break;case"left":c=e;break;case"right":c=-e}}else{switch(e=Math.abs(e),s=Math.abs(s),a){case"top-right":case"top-left":case"top":p=s-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-s}switch(a){case"top-right":case"bottom-right":case"right":c=-e;break;case"top-left":case"bottom-left":case"left":c=e}}return[c,p]}function ib(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ok(a,e,s,c,p,u,m,x,S,P,y,A,I,E,M){let R=u.textMaxSize.evaluate(e,{},A);R===void 0?R=m*u.textScaleFactor:R*=u.textScaleFactor;const z=a.layers[0].layout,F=z.get("icon-offset").evaluate(e,{},A),$=rA(s.horizontal)||s.vertical,H=I.name==="globe",V=ns,G=m*u.textScaleFactor/V,Y=a.tilePixelRatio*R/V,te=(Ce=a.overscaling,a.zoom>18&&Ce>2&&(Ce>>=1),Math.max(Lt/(512*Ce),1)*z.get("symbol-spacing")),he=z.get("text-padding")*a.tilePixelRatio,ce=z.get("icon-padding")*a.tilePixelRatio,le=yt(z.get("text-max-angle")),Ee=z.get("text-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",de=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Ae=z.get("symbol-placement"),Pe=te/2;var Ce;const ze=z.get("icon-text-fit").evaluate(e,{},A),Ne=z.get("icon-text-fit-padding").evaluate(e,{},A),Ge=ze!=="none";let Fe;a.hasAnyIconTextFit===!1&&Ge&&(a.hasAnyIconTextFit=!0),c&&Ge&&(a.allowVerticalPlacement&&s.vertical&&(Fe=jS(c,s.vertical,ze,Ne,F,G)),$&&(c=jS(c,$,ze,Ne,F,G)));const at=(mt,ot,zt)=>{if(ot.x<0||ot.x>=Lt||ot.y<0||ot.y>=Lt)return;let Rt=null;if(H){const{x:xt,y:_t,z:Yt}=I.projectTilePoint(ot.x,ot.y,zt);Rt={anchor:new Jl(xt,_t,Yt,0,void 0),up:I.upVector(zt,ot.x,ot.y)}}(function(xt,_t,Yt,Ft,jt,mi,Ei,Mi,Ci,Di,zi,_n,hn,bi,sn,an,Mn,Yn,cr,Kn,Un,nr,_r,rs,En,Zs,Ha){const da=xt.addToLineVertexArray(_t,Ft);let fa,kh,tu,Fh,N_,NM,BM,VM=0,UM=0,jM=0,$M=0,Fb=-1,Nb=-1;const pl={};let qM=Ao("");const Nh=Yt?Yt.anchor:_t,Bb=Ci.layout.get("icon-text-fit").evaluate(Un,{},En)!=="none";let Vb=0,Ub=0;if(Ci._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Vb,Ub]=Ci.layout.get("text-offset").evaluate(Un,{},En).map(Lo=>Lo*ns):(Vb=Ci.layout.get("text-radial-offset").evaluate(Un,{},En)*ns,Ub=tb),xt.allowVerticalPlacement&&jt.vertical){const Lo=jt.vertical;if(sn)NM=nb(Lo),Mi&&(BM=nb(Mi));else{const Xs=Ci.layout.get("text-rotate").evaluate(Un,{},En)+90;tu=r0(Di,Nh,_t,zi,_n,hn,Lo,bi,Xs,an),Mi&&(Fh=r0(Di,Nh,_t,zi,_n,hn,Mi,Yn,Xs))}}if(mi){const Lo=xt.iconSizeData,Xs=Ci.layout.get("icon-rotate").evaluate(Un,{},En),B_=eA(mi,Xs,_r,Bb,nr.iconScaleFactor),$b=Mi?eA(Mi,Xs,_r,Bb,nr.iconScaleFactor):void 0;kh=r0(Di,Nh,_t,zi,_n,hn,mi,Yn,Xs,null),VM=4*B_.length;let Bh=null;Lo.kind==="source"?(Bh=[Va*Ci.layout.get("icon-size").evaluate(Un,{},En)*nr.iconScaleFactor],Bh[0]>Kc&&Ti(`${xt.layerIds[0]}: Value for "icon-size" is >= ${x_}. Reduce your "icon-size".`)):Lo.kind==="composite"&&(Bh=[Va*nr.compositeIconSizes[0].evaluate(Un,{},En)*nr.iconScaleFactor,Va*nr.compositeIconSizes[1].evaluate(Un,{},En)*nr.iconScaleFactor],(Bh[0]>Kc||Bh[1]>Kc)&&Ti(`${xt.layerIds[0]}: Value for "icon-size" is >= ${x_}. Reduce your "icon-size".`)),xt.addSymbols(xt.icon,B_,Bh,Kn,cr,Un,!1,Yt,_t,da.lineStartIndex,da.lineLength,-1,rs,En,Zs,Ha),Fb=xt.icon.placedSymbolArray.length-1,$b&&(UM=4*$b.length,xt.addSymbols(xt.icon,$b,Bh,Kn,cr,Un,Ro.vertical,Yt,_t,da.lineStartIndex,da.lineLength,-1,rs,En,Zs,Ha),Nb=xt.icon.placedSymbolArray.length-1)}for(const Lo in jt.horizontal){const Xs=jt.horizontal[Lo];fa||(qM=Ao(Xs.text),sn?N_=nb(Xs):fa=r0(Di,Nh,_t,zi,_n,hn,Xs,bi,Ci.layout.get("text-rotate").evaluate(Un,{},En),an));const B_=Xs.positionedLines.length===1;if(jM+=nA(xt,Yt,_t,Xs,Ei,Ci,sn,Un,an,da,jt.vertical?Ro.horizontal:Ro.horizontalOnly,B_?Object.keys(jt.horizontal):[Lo],pl,Fb,nr,rs,En,Zs),B_)break}jt.vertical&&($M+=nA(xt,Yt,_t,jt.vertical,Ei,Ci,sn,Un,an,da,Ro.vertical,["vertical"],pl,Nb,nr,rs,En,Zs));let iu=-1;const jb=(Lo,Xs)=>Lo?Math.max(Lo,Xs):Xs;iu=jb(N_,iu),iu=jb(NM,iu),iu=jb(BM,iu);const B5=iu>-1?1:0;xt.glyphOffsetArray.length>=65535&&Ti("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Un.sortKey!==void 0&&xt.addToSortKeyRanges(xt.symbolInstances.length,Un.sortKey),xt.symbolInstances.emplaceBack(_t.x,_t.y,Nh.x,Nh.y,Nh.z,pl.right>=0?pl.right:-1,pl.center>=0?pl.center:-1,pl.left>=0?pl.left:-1,pl.vertical>=0?pl.vertical:-1,Fb,Nb,qM,fa!==void 0?fa:xt.collisionBoxArray.length,fa!==void 0?fa+1:xt.collisionBoxArray.length,tu!==void 0?tu:xt.collisionBoxArray.length,tu!==void 0?tu+1:xt.collisionBoxArray.length,kh!==void 0?kh:xt.collisionBoxArray.length,kh!==void 0?kh+1:xt.collisionBoxArray.length,Fh||xt.collisionBoxArray.length,Fh?Fh+1:xt.collisionBoxArray.length,zi,jM,$M,VM,UM,B5,0,Vb,Ub,iu,0,Bb?1:0)})(a,ot,Rt,mt,s,c,p,Fe,a.layers[0],a.collisionBoxArray,e.index,e.sourceLayerIndex,a.index,he,Ee,S,0,ce,de,F,e,u,P,y,A,E,M)};if(Ae==="line")for(const mt of ZS(e.geometry,0,0,Lt,Lt)){const ot=tk(mt,te,le,s.vertical||$,c,V,Y,a.overscaling,Lt);for(const zt of ot)$&&ak(a,$.text,Pe,zt)||at(mt,zt,A)}else if(Ae==="line-center"){for(const mt of e.geometry)if(mt.length>1){const ot=ek(mt,le,s.vertical||$,c,V,Y);ot&&at(mt,ot,A)}}else if(e.type==="Polygon")for(const mt of Hy(e.geometry,0)){const ot=nk(mt,16);at(mt[0],new Jl(ot.x,ot.y,0,0,void 0),A)}else if(e.type==="LineString")for(const mt of e.geometry)at(mt,new Jl(mt[0].x,mt[0].y,0,0,void 0),A);else if(e.type==="Point")for(const mt of e.geometry)for(const ot of mt)at([ot],new Jl(ot.x,ot.y,0,0,void 0),A)}const x_=255,Kc=x_*Va;function nA(a,e,s,c,p,u,m,x,S,P,y,A,I,E,M,R,z,F){const $=function(G,Y,te,he,ce,le,Ee,de){const Ae=[];if(Y.positionedLines.length===0)return Ae;const Pe=he.layout.get("text-rotate").evaluate(le,{})*Math.PI/180,Ce=function(at){const mt=at[0],ot=at[1],zt=mt*ot;return zt>0?[mt,-ot]:zt<0?[-mt,ot]:mt===0?[ot,mt]:[ot,-mt]}(te);let ze=Math.abs(Y.top-Y.bottom);for(const at of Y.positionedLines)ze-=at.lineOffset;const Ne=Y.positionedLines.length,Ge=ze/Ne;let Fe=Y.top-te[1];for(let at=0;at<Ne;++at){const mt=Y.positionedLines[at];Fe=ik(Y,Ge,Fe,at);for(const ot of mt.positionedGlyphs){if(!ot.rect)continue;const zt=ot.rect||{};let Rt=kS+1,xt=!0,_t=1,Yt=0;if(ot.imageName){const Kn=Ee[qr.build(ot.imageName).getSerializedPrimary()];if(!Kn)continue;if(Kn.sdf){Ti("SDF images are not supported in formatted text and will be ignored.");continue}xt=!1,_t=Kn.pixelRatio,Rt=g_/_t}const Ft=(ce||de)&&ot.vertical,jt=ot.metrics.advance*ot.scale/2,mi=ot.metrics,Ei=ot.rect;if(Ei===null)continue;de&&Y.verticalizable&&(Yt=ot.imageName?jt-ot.metrics.width*ot.scale/2:0);const Mi=ce?[ot.x+jt,ot.y]:[0,0];let Ci=[0,0],Di=[0,0],zi=!1;ce||(Ft?(Di=[ot.x+jt+Ce[0],ot.y+Ce[1]-Yt],zi=!0):Ci=[ot.x+jt+te[0],ot.y+te[1]-Yt]);const _n=Ei.w*ot.scale/(_t*(ot.localGlyph?Ua:1)),hn=Ei.h*ot.scale/(_t*(ot.localGlyph?Ua:1));let bi,sn,an,Mn;if(Ft){const Kn=ot.y-Fe,Un=new Se(-jt,jt-Kn),nr=-Math.PI/2,_r=new Se(...Di);bi=new Se(-jt+Ci[0],Ci[1]),bi._rotateAround(nr,Un)._add(_r),bi.x+=-Kn+jt,bi.y-=(mi.left-Rt)*ot.scale;const rs=ot.imageName?mi.advance*ot.scale:ns*ot.scale,En=String.fromCodePoint(ot.glyph);Hz(En)?bi.x+=(1-Rt)*ot.scale:Gz(En)?bi.x+=rs-mi.height*ot.scale+(-Rt-1)*ot.scale:bi.x+=ot.imageName||mi.width+2*Rt===Ei.w&&mi.height+2*Rt===Ei.h?(rs-hn)/2:(rs-(mi.height+2*Rt)*ot.scale)/2,sn=new Se(bi.x,bi.y-_n),an=new Se(bi.x+hn,bi.y),Mn=new Se(bi.x+hn,bi.y-_n)}else{const Kn=(mi.left-Rt)*ot.scale-jt+Ci[0],Un=(-mi.top-Rt)*ot.scale+Ci[1],nr=Kn+_n,_r=Un+hn;bi=new Se(Kn,Un),sn=new Se(nr,Un),an=new Se(Kn,_r),Mn=new Se(nr,_r)}if(Pe){let Kn;Kn=ce?new Se(0,0):zi?new Se(Ce[0],Ce[1]):new Se(te[0],te[1]),bi._rotateAround(Pe,Kn),sn._rotateAround(Pe,Kn),an._rotateAround(Pe,Kn),Mn._rotateAround(Pe,Kn)}const Yn=new Se(0,0),cr=new Se(0,0);Ae.push({tl:bi,tr:sn,bl:an,br:Mn,texPrimary:zt,texSecondary:void 0,writingMode:Y.writingMode,glyphOffset:Mi,sectionIndex:ot.sectionIndex,isSDF:xt,pixelOffsetTL:Yn,pixelOffsetBR:cr,minFontScaleX:0,minFontScaleY:0})}}return Ae}(0,c,S,u,m,x,p,a.allowVerticalPlacement),H=a.textSizeData;let V=null;H.kind==="source"?(V=[Va*u.layout.get("text-size").evaluate(x,{},z)*M.textScaleFactor],V[0]>Kc&&Ti(`${a.layerIds[0]}: Value for "text-size" is >= ${x_}. Reduce your "text-size".`)):H.kind==="composite"&&(V=[Va*M.compositeTextSizes[0].evaluate(x,{},z)*M.textScaleFactor,Va*M.compositeTextSizes[1].evaluate(x,{},z)*M.textScaleFactor],(V[0]>Kc||V[1]>Kc)&&Ti(`${a.layerIds[0]}: Value for "text-size" is >= ${x_}. Reduce your "text-size".`)),a.addSymbols(a.text,$,V,S,m,x,y,e,s,P.lineStartIndex,P.lineLength,E,R,z,F,!1);for(const G of A)I[G]=a.text.placedSymbolArray.length-1;return 4*$.length}function rA(a){for(const e in a)return a[e];return null}function r0(a,e,s,c,p,u,m,x,S,P){let y=m.top,A=m.bottom,I=m.left,E=m.right;const M=m.collisionPadding;if(M&&(I-=M[0],y-=M[1],E+=M[2],A+=M[3]),S){const R=new Se(I,y),z=new Se(E,y),F=new Se(I,A),$=new Se(E,A),H=yt(S);let V=new Se(0,0);P&&(V=new Se(P[0],P[1])),R._rotateAround(H,V),z._rotateAround(H,V),F._rotateAround(H,V),$._rotateAround(H,V),I=Math.min(R.x,z.x,F.x,$.x),E=Math.max(R.x,z.x,F.x,$.x),y=Math.min(R.y,z.y,F.y,$.y),A=Math.max(R.y,z.y,F.y,$.y)}return a.emplaceBack(e.x,e.y,e.z,s.x,s.y,I,y,E,A,x,c,p,u),a.length-1}function nb(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const e=a.bottom-a.top;return e>0?Math.max(10,e):null}function ak(a,e,s,c){const p=a.compareText;if(e in p){const u=p[e];for(let m=u.length-1;m>=0;m--)if(c.dist(u[m])<s)return!0}else p[e]=[];return p[e].push(c),!1}function sA(a,e){const s=a.fovAboveCenter,c=a.elevation?a.elevation.getMinElevationBelowMSL()*e:0,p=(a._camera.position[2]*a.worldSize-c)/Math.cos(a._pitch),u=Math.sin(s)*p/Math.sin(Math.max(Math.PI/2-a._pitch-s,.01));let m=Math.sin(a._pitch)*u+p;const x=p*(1/a._horizonShift);if(!a.elevation||a.elevation.exaggeration()===0){let S=Math.max(a.zoom-17,0);a.isOrthographic&&(S/=10),m*=1+S}return Math.min(1.01*m,x)}function b_(a,e){if(!e.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:e};const s=Math.pow(2,-a.z),c=a.x*s,p=(a.x+1)*s,u=a.y*s,m=(a.y+1)*s,x=Ps(c),S=Ps(p),P=zr(u),y=zr(m),A=e.project(x,P),I=e.project(S,P),E=e.project(S,y),M=e.project(x,y);let R=Math.min(A.x,I.x,E.x,M.x),z=Math.min(A.y,I.y,E.y,M.y),F=Math.max(A.x,I.x,E.x,M.x),$=Math.max(A.y,I.y,E.y,M.y);const H=s/16;function V(Y,te,he,ce,le,Ee){const de=(he+le)/2,Ae=(ce+Ee)/2,Pe=e.project(Ps(de),zr(Ae)),Ce=Math.max(0,R-Pe.x,z-Pe.y,Pe.x-F,Pe.y-$);R=Math.min(R,Pe.x),F=Math.max(F,Pe.x),z=Math.min(z,Pe.y),$=Math.max($,Pe.y),Ce>H&&(V(Y,Pe,he,ce,de,Ae),V(Pe,te,de,Ae,le,Ee))}V(A,I,c,u,p,u),V(I,E,p,u,p,m),V(E,M,p,m,c,m),V(M,A,c,m,c,u),R-=H,z-=H,F+=H,$+=H;const G=1/Math.max(F-R,$-z);return{scale:G,x:R*G,y:z*G,x2:F*G,y2:$*G,projection:e}}function oA(a,{x:e,y:s},c=0){return new Se(((e-c)*a.scale-a.x)*Lt,(s*a.scale-a.y)*Lt)}const lk=Le.mat4.identity(new Float32Array(16));class Jc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,s){return{x:0,y:0,z:0}}unproject(e,s){return new Xi(0,0)}projectTilePoint(e,s,c){return{x:e,y:s,z:0}}locationPoint(e,s,c=!0){return e._coordinatePoint(e.locationCoordinate(s),c)}pixelsPerMeter(e,s){return ms(1,e)*s}pixelSpaceConversion(e,s,c){return 1}farthestPixelDistance(e){return sA(e,e.pixelsPerMeter)}pointCoordinate(e,s,c,p){const u=e.horizonLineFromTop(!1),m=new Se(s,Math.max(u,c));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,p))}pointCoordinate3D(e,s,c){const p=new Se(s,c);if(e.elevation)return e.elevation.pointCoordinate(p);{const u=this.pointCoordinate(e,p.x,p.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,s){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,s.x,s.y);const c=e.horizonLineFromTop();return s.y<c}createInversionMatrix(e,s){return lk}createTileMatrix(e,s,c){let p,u,m;const x=c.canonical,S=Le.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const P=b_(x,this);p=1,u=P.x+c.wrap*P.scale,m=P.y,Le.mat4.scale(S,S,[p/P.scale,p/P.scale,e.pixelsPerMeter/s])}else p=s/e.zoomScale(x.z),u=(x.x+Math.pow(2,x.z)*c.wrap)*p,m=x.y*p;return Le.mat4.translate(S,S,[u,m,0]),Le.mat4.scale(S,S,[p/Lt,p/Lt,1]),S}upVector(e,s,c){return[0,0,1]}upVectorScale(e,s,c){return{metersToTile:1}}}class ck extends Jc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[s,c]=this.parallels=e.parallels||[29.5,45.5],p=Math.sin(yt(s));this.n=(p+Math.sin(yt(c)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(e,s){const{n:c,c:p,r0:u}=this,m=yt(e-this.center[0]),x=yt(s),S=Math.sqrt(p-2*c*Math.sin(x))/c;return{x:S*Math.sin(m*c),y:S*Math.cos(m*c)-u,z:0}}unproject(e,s){const{n:c,c:p,r0:u}=this,m=u+s;let x=Math.atan2(e,Math.abs(m))*Math.sign(m);m*c<0&&(x-=Math.PI*Math.sign(e)*Math.sign(m));const S=yt(this.center[0])*c;x=Ai(x,-Math.PI-S,Math.PI-S);const P=Ct(Kt(x/c)+this.center[0],-180,180),y=Math.asin(Ct((p-(e*e+m*m)*c*c)/(2*c),-1,1)),A=Ct(Kt(y),-Gn,Gn);return new Xi(P,A)}}const w_=1.340264,T_=-.081106,E_=893e-6,S_=.003796,s0=Math.sqrt(3)/2;class uk extends Jc{project(e,s){s=s/180*Math.PI,e=e/180*Math.PI;const c=Math.asin(s0*Math.sin(s)),p=c*c,u=p*p*p;return{x:.5*(e*Math.cos(c)/(s0*(w_+3*T_*p+u*(7*E_+9*S_*p)))/Math.PI+.5),y:1-.5*(c*(w_+T_*p+u*(E_+S_*p))/Math.PI+1),z:0}}unproject(e,s){e=(2*e-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,p=c*c,u=p*p*p;for(let y,A,I,E=0;E<12&&(A=c*(w_+T_*p+u*(E_+S_*p))-s,I=w_+3*T_*p+u*(7*E_+9*S_*p),y=A/I,c=Ct(c-y,-Math.PI/3,Math.PI/3),p=c*c,u=p*p*p,!(Math.abs(y)<1e-12));++E);const m=s0*e*(w_+3*T_*p+u*(7*E_+9*S_*p))/Math.cos(c),x=Math.asin(Math.sin(c)/s0),S=Ct(180*m/Math.PI,-180,180),P=Ct(180*x/Math.PI,-Gn,Gn);return new Xi(S,P)}}class hk extends Jc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,s){return{x:.5+e/360,y:.5-s/360,z:0}}unproject(e,s){const c=360*(e-.5),p=Ct(360*(.5-s),-Gn,Gn);return new Xi(c,p)}}const Rf=Math.PI/2;function o0(a){return Math.tan((Rf+a)/2)}class dk extends Jc{constructor(e){super(e),this.center=e.center||[0,30];const[s,c]=this.parallels=e.parallels||[30,30];let p=yt(s),u=yt(c);this.southernCenter=p+u<0,this.southernCenter&&(p=-p,u=-u);const m=Math.cos(p),x=o0(p);this.n=p===u?Math.sin(p):Math.log(m/Math.cos(u))/Math.log(o0(u)/x),this.f=m*Math.pow(o0(p),this.n)/this.n}project(e,s){s=yt(s),this.southernCenter&&(s=-s),e=yt(e-this.center[0]);const c=1e-6,{n:p,f:u}=this;u>0?s<-Rf+c&&(s=-Rf+c):s>Rf-c&&(s=Rf-c);const m=u/Math.pow(o0(s),p);let x=m*Math.sin(p*e),S=u-m*Math.cos(p*e);return x=.5*(x/Math.PI+.5),S=.5*(S/Math.PI+.5),{x,y:this.southernCenter?S:1-S,z:0}}unproject(e,s){e=(2*e-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;const{n:c,f:p}=this,u=p-s,m=Math.sign(u),x=Math.sign(c)*Math.sqrt(e*e+u*u);let S=Math.atan2(e,Math.abs(u))*m;u*c<0&&(S-=Math.PI*Math.sign(e)*m);const P=Ct(Kt(S/c)+this.center[0],-180,180),y=Ct(Kt(2*Math.atan(Math.pow(p/x,1/c))-Rf),-Gn,Gn);return new Xi(P,this.southernCenter?-y:y)}}class aA extends Jc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,s){return{x:la(e),y:Po(s),z:0}}unproject(e,s){const c=Ps(e),p=zr(s);return new Xi(c,p)}}const lA=yt(Gn);class fk extends Jc{project(e,s){const c=(s=yt(s))*s,p=c*c;return{x:.5*((e=yt(e))*(.8707-.131979*c+p*(p*(.003971*c-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+c*(.015085+p*(.028874*c-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(e,s){e=(2*e-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,p=25,u=0,m=c*c;do{m=c*c;const P=m*m;u=(c*(1.007226+m*(.015085+P*(.028874*m-.044475-.005916*P)))-s)/(1.007226+m*(.045255+P*(.259866*m-.311325-.005916*11*P))),c=Ct(c-u,-lA,lA)}while(Math.abs(u)>1e-6&&--p>0);m=c*c;const x=Ct(Kt(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),S=Kt(c);return new Xi(x,S)}}const cA=yt(Gn);class pk extends Jc{project(e,s){s=yt(s),e=yt(e);const c=Math.cos(s),p=2/Math.PI,u=Math.acos(c*Math.cos(e/2)),m=Math.sin(u)/u,x=.5*(e*p+2*c*Math.sin(e/2)/m)||0,S=.5*(s+Math.sin(s)/m)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(S/Math.PI+1),z:0}}unproject(e,s){let c=e=(2*e-.5)*Math.PI,p=s=(2*(1-s)-1)*Math.PI,u=25;const m=1e-6;let x=0,S=0;do{const P=Math.cos(p),y=Math.sin(p),A=2*y*P,I=y*y,E=P*P,M=Math.cos(c/2),R=Math.sin(c/2),z=2*M*R,F=R*R,$=1-E*M*M,H=$?1/$:0,V=$?Math.acos(P*M)*Math.sqrt(1/$):0,G=.5*(2*V*P*R+2*c/Math.PI)-e,Y=.5*(V*y+p)-s,te=.5*H*(E*F+V*P*M*I)+1/Math.PI,he=H*(z*A/4-V*y*R),ce=.125*H*(A*R-V*y*E*z),le=.5*H*(I*M+V*F*P)+.5,Ee=he*ce-le*te;x=(Y*he-G*le)/Ee,S=(G*ce-Y*te)/Ee,c=Ct(c-x,-Math.PI,Math.PI),p=Ct(p-S,-cA,cA)}while((Math.abs(x)>m||Math.abs(S)>m)&&--u>0);return new Xi(Kt(c),Kt(p))}}class uA extends Jc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(yt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,s){const{scale:c,cosPhi:p}=this;return{x:yt(e)*p*c+.5,y:-Math.sin(yt(s))/p*c+.5,z:0}}unproject(e,s){const{scale:c,cosPhi:p}=this,u=-(s-.5)/c,m=Ct(Kt((e-.5)/c)/p,-180,180),x=Math.asin(Ct(u*p,-1,1)),S=Ct(Kt(x),-Gn,Gn);return new Xi(m,S)}}class mk extends aA{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,s,c){const p=dn(e,s,c),u=Tr(or(c));return Le.vec3.transformMat4(p,p,u),{x:p[0],y:p[1],z:p[2]}}locationPoint(e,s){const c=Zl(s.lat,s.lng),p=Le.vec3.normalize([],c),u=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(s),e._centerAltitude):e._centerAltitude,m=ms(1,0)*Lt*u;Le.vec3.scaleAndAdd(c,c,p,m);const x=Le.mat4.identity(new Float64Array(16));return Le.mat4.multiply(x,e.pixelMatrix,e.globeMatrix),Le.vec3.transformMat4(c,c,x),new Se(c[0],c[1])}pixelsPerMeter(e,s){return ms(1,0)*s}pixelSpaceConversion(e,s,c){const p=ms(1,e)*s,u=di(ms(1,45)*s,p,c);return this.pixelsPerMeter(e,s)/u}createTileMatrix(e,s,c){const p=pn(or(c.canonical));return Le.mat4.multiply(new Float64Array(16),e.globeMatrix,p)}createInversionMatrix(e,s){const{center:c}=e,p=Tr(or(s));return Le.mat4.rotateY(p,p,yt(c.lng)),Le.mat4.rotateX(p,p,yt(c.lat)),Le.mat4.scale(p,p,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(e,s,c,p){return tn(e,s,c,!0)||new o(0,0)}pointCoordinate3D(e,s,c){const p=this.pointCoordinate(e,s,c,0);return[p.x,p.y,p.z]}isPointAboveHorizon(e,s){return!tn(e,s.x,s.y,!1)}farthestPixelDistance(e){const s=function(p,u){const m=p.cameraToCenterDistance,x=p._centerAltitude*u,S=p._camera,P=p._camera.forward(),y=Le.vec3.add([],Le.vec3.scale([],P,-m),[0,0,x]),A=p.worldSize/(2*Math.PI),I=[0,0,-A],E=p.width/p.height,M=Math.tan(p.fovAboveCenter),R=Le.vec3.scale([],S.up(),M),z=Le.vec3.scale([],S.right(),M*E),F=Le.vec3.normalize([],Le.vec3.add([],Le.vec3.add([],P,R),z)),$=[];let H;if(new xi(y,F).closestPointOnSphere(I,A,$)){const V=Le.vec3.add([],$,I),G=Le.vec3.sub([],V,y);H=Math.cos(p.fovAboveCenter)*Le.vec3.length(G)}else{const V=Le.vec3.sub([],y,I),G=Le.vec3.sub([],I,y);Le.vec3.normalize(G,G);const Y=Le.vec3.length(V)-A;H=Math.sqrt(Y*(Y+2*A));const te=Math.acos(H/(A+Y))-Math.acos(Le.vec3.dot(P,G));H*=Math.cos(te)}return 1.01*H}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),c=bs(e.zoom);if(c>0){const p=sA(e,ms(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return di(s,p+u*(1-Math.cos(m)),Math.pow(c,10))}return s}upVector(e,s,c){return dn(s,c,e,1)}upVectorScale(e){return{metersToTile:ki(Ui(or(e)))}}}function hA(a){const e=a.parallels,s=!!e&&Math.abs(e[0]+e[1])<.01;switch(a.name){case"mercator":return new aA(a);case"equirectangular":return new hk(a);case"naturalEarth":return new fk(a);case"equalEarth":return new uk(a);case"winkelTripel":return new pk(a);case"albers":return s?new uA(a):new ck(a);case"lambertConformalConic":return s?new uA(a):new dk(a);case"globe":return new mk(a)}throw new Error(`Invalid projection name: ${a.name}`)}const _k=Af.VectorTileFeature.types,gk=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function a0(a,e,s,c,p,u,m,x,S,P,y,A,I){const E=x?Math.min(Kc,Math.round(x[0])):0,M=x?Math.min(Kc,Math.round(x[1])):0;a.emplaceBack(e,s,Math.round(32*c),Math.round(32*p),u,m,(E<<1)+(S?1:0),M,16*P,16*y,256*A,256*I)}function l0(a,e,s){a.emplaceBack(e,s)}function c0(a,e,s,c,p,u,m){a.emplaceBack(e,s,c,p,u,m)}function u0(a,e,s,c,p){a.emplaceBack(e,s,c,p),a.emplaceBack(e,s,c,p),a.emplaceBack(e,s,c,p),a.emplaceBack(e,s,c,p)}function yk(a){for(const e of a.sections)if(Dm(e.text))return!0;return!1}class rb{constructor(e){this.layoutVertexArray=new Vm,this.indexArray=new Or,this.programConfigurations=e,this.segments=new Hn,this.dynamicLayoutVertexArray=new ql,this.opacityVertexArray=new jm,this.placedSymbolArray=new Iy,this.iconTransitioningVertexArray=new ll,this.globeExtVertexArray=new Um,this.zOffsetVertexArray=new yh}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,s,c,p,u){this.isEmpty()||(c&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zz.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Fz.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,gk,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Bz.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,kz.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Nz.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||p)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Gt(rb,"SymbolBuffers");class sb{constructor(e,s,c){this.layoutVertexArray=new e,this.layoutAttributes=s,this.indexArray=new c,this.segments=new Hn,this.collisionVertexArray=new Hm,this.collisionVertexArrayExt=new ql}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Vz.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Uz.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Gt(sb,"CollisionBuffers");class h0{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Le.mat4.identity([]),this.placementViewportMatrix=Le.mat4.identity([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Zx(this.zoom,s["text-size"]),this.iconSizeData=Zx(this.zoom,s["icon-size"]);const c=this.layers[0].layout,p=c.get("symbol-sort-key"),u=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(m=>Ro[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=c.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new rb(new hl(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new rb(new hl(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Dy,this.lineVertexArray=new Ly,this.symbolInstances=new Ry}calculateGlyphDependencies(e,s,c,p,u){for(const m of e){const x=m.codePointAt(0);if(x===void 0)break;if(s[x]=!0,p&&u&&x<=65535){const S=m_[m];S&&(s[S.charCodeAt(0)]=!0)}}}updateFootprints(e,s){}updateReplacement(e,s){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const c=s.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Vx(this.activeReplacements,c)&&(this.activeReplacements=c,!0)}populate(e,s,c,p){const u=this.layers[0],m=u.layout,x=this.projection.name==="globe",S=m.get("text-font"),P=m.get("text-field"),y=m.get("icon-image"),[A,I]=m.get("icon-size-scale-range"),E=Ct(s.scaleFactor||1,A,I),M=(P.value.kind!=="constant"||P.value.value instanceof Qr&&!P.value.value.isEmpty()||P.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),R=y.value.kind!=="constant"||!!y.value.value||Object.keys(y.parameters).length>0,z=m.get("symbol-sort-key");if(this.features=[],!M&&!R)return;const F=s.iconDependencies,$=s.glyphDependencies,H=s.availableImages,V=new bn(this.zoom);for(const{feature:G,id:Y,index:te,sourceLayerIndex:he}of e){const ce=u._featureFilter.needGeometry,le=N(G,ce);if(!u._featureFilter.filter(V,le,c))continue;if(ce||(le.geometry=O(G,c,p)),x&&G.type!==1&&c.z<=5){const Ce=le.geometry,ze=.98078528056,Ne=(Ge,Fe)=>{const at=dn(Ge.x,Ge.y,c,1),mt=dn(Fe.x,Fe.y,c,1);return Le.vec3.dot(at,mt)<ze};for(let Ge=0;Ge<Ce.length;Ge++)Ce[Ge]=w(Ce[Ge],Ne)}let Ee,de;if(M){const Ce=u.getValueAndResolveTokens("text-field",le,c,H),ze=Qr.factory(Ce);yk(ze)&&(this.hasRTLText=!0),(!this.hasRTLText||af()==="unavailable"||this.hasRTLText&&$s.isParsed())&&(Ee=qz(ze,u,le))}if(R){const Ce=u.getValueAndResolveTokens("icon-image",le,c,H);de=Ce instanceof qr?Ce:qr.build(Ce)}if(!Ee&&!de)continue;const Ae=this.sortFeaturesByKey?z.evaluate(le,{},c):void 0,Pe={id:Y,text:Ee,icon:de,index:te,sourceLayerIndex:he,geometry:le.geometry,properties:G.properties,type:_k[G.type],sortKey:Ae};if(this.features.push(Pe),de){const Ce=Wx(this.iconSizeData,this.layers[0]._unevaluatedLayout._values["icon-size"],c,this.zoom,Pe)*E*this.pixelRatio,ze=de.getPrimary().scaleSelf(Ce);if(F[ze.id]=F[ze.id]||[],F[ze.id].push(ze),de.nameSecondary){const Ne=de.getSecondary().scaleSelf(Ce);F[Ne.id]=F[Ne.id]||[],F[Ne.id].push(Ne)}}if(Ee){const Ce=S.evaluate(le,{},c).join(","),ze=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ro.vertical)>=0;for(const Ne of Ee.sections)if(Ne.image){const Ge=Ne.image.getPrimary().scaleSelf(this.pixelRatio);F[Ge.id]=F[Ge.id]||[],F[Ge.id].push(Ge)}else{const Ge=Im(Ee.toString()),Fe=Ne.fontStack||Ce,at=$[Fe]=$[Fe]||{};this.calculateGlyphDependencies(Ne.text,at,ze,this.allowVerticalPlacement,Ge)}}}m.get("symbol-placement")==="line"&&(this.features=function(G){const Y={},te={},he=[];let ce=0;function le(Pe){he.push(G[Pe]),ce++}function Ee(Pe,Ce,ze){const Ne=te[Pe];return delete te[Pe],te[Ce]=Ne,he[Ne].geometry[0].pop(),he[Ne].geometry[0]=he[Ne].geometry[0].concat(ze[0]),Ne}function de(Pe,Ce,ze){const Ne=Y[Ce];return delete Y[Ce],Y[Pe]=Ne,he[Ne].geometry[0].shift(),he[Ne].geometry[0]=ze[0].concat(he[Ne].geometry[0]),Ne}function Ae(Pe,Ce,ze){const Ne=ze?Ce[0][Ce[0].length-1]:Ce[0][0];return`${Pe}:${Ne.x}:${Ne.y}`}for(let Pe=0;Pe<G.length;Pe++){const Ce=G[Pe],ze=Ce.geometry,Ne=Ce.text?Ce.text.toString():null;if(!Ne){le(Pe);continue}const Ge=Ae(Ne,ze),Fe=Ae(Ne,ze,!0);if(Ge in te&&Fe in Y&&te[Ge]!==Y[Fe]){const at=de(Ge,Fe,ze),mt=Ee(Ge,Fe,he[at].geometry);delete Y[Ge],delete te[Fe],te[Ae(Ne,he[mt].geometry,!0)]=mt,he[at].geometry=null}else Ge in te?Ee(Ge,Fe,ze):Fe in Y?de(Ge,Fe,ze):(le(Pe),Y[Ge]=ce-1,te[Fe]=ce-1)}return he.filter(Pe=>Pe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((G,Y)=>G.sortKey-Y.sortKey)}update(e,s,c,p,u,m,x){this.text.programConfigurations.updatePaintArrays(e,s,u,c,p,m,x),this.icon.programConfigurations.updatePaintArrays(e,s,u,c,p,m,x)}updateZOffset(){const e=(u,m,x)=>{c+=m,c>u.length&&u.resize(c);for(let S=-m;S<0;S++)u.emplace(S+c,x)},s=(u,m,x)=>{p+=m,p>u.length&&u.resize(p);for(let S=-m;S<0;S++)u.emplace(S+p,x)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let c=0,p=0;for(let u=0;u<this.symbolInstances.length;u++){const m=this.symbolInstances.get(u),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:S,numIconVertices:P}=m,y=m.zOffset,A=P>0;if((x>0||S>0)&&(e(this.text.zOffsetVertexArray,x,y),e(this.text.zOffsetVertexArray,S,y)),A){const{placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:E}=m;I>=0&&s(this.icon.zOffsetVertexArray,P,y),E>=0&&s(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,y)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=hA(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,s){const c=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:p,y:u}of s)this.lineVertexArray.emplaceBack(p,u);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(e,s,c,p,u,m,x,S,P,y,A,I,E,M,R,z){const F=e.indexArray,$=e.layoutVertexArray,H=e.globeExtVertexArray,V=e.segments.prepareSegment(4*s.length,$,F,this.canOverlap?m.sortKey:void 0),G=this.glyphOffsetArray.length,Y=V.vertexLength,te=this.allowVerticalPlacement&&x===Ro.vertical?Math.PI/2:0,he=m.text&&m.text.sections;for(let le=0;le<s.length;le++){const{tl:Ee,tr:de,bl:Ae,br:Pe,texPrimary:Ce,texSecondary:ze,pixelOffsetTL:Ne,pixelOffsetBR:Ge,minFontScaleX:Fe,minFontScaleY:at,glyphOffset:mt,isSDF:ot,sectionIndex:zt}=s[le],Rt=V.vertexLength,xt=mt[1];if(a0($,P.x,P.y,Ee.x,xt+Ee.y,Ce.x,Ce.y,c,ot,Ne.x,Ne.y,Fe,at),a0($,P.x,P.y,de.x,xt+de.y,Ce.x+Ce.w,Ce.y,c,ot,Ge.x,Ne.y,Fe,at),a0($,P.x,P.y,Ae.x,xt+Ae.y,Ce.x,Ce.y+Ce.h,c,ot,Ne.x,Ge.y,Fe,at),a0($,P.x,P.y,Pe.x,xt+Pe.y,Ce.x+Ce.w,Ce.y+Ce.h,c,ot,Ge.x,Ge.y,Fe,at),S){const{x:_t,y:Yt,z:Ft}=S.anchor,[jt,mi,Ei]=S.up;c0(H,_t,Yt,Ft,jt,mi,Ei),c0(H,_t,Yt,Ft,jt,mi,Ei),c0(H,_t,Yt,Ft,jt,mi,Ei),c0(H,_t,Yt,Ft,jt,mi,Ei),u0(e.dynamicLayoutVertexArray,_t,Yt,Ft,te)}else u0(e.dynamicLayoutVertexArray,P.x,P.y,P.z,te);if(z){const _t=ze||Ce;l0(e.iconTransitioningVertexArray,_t.x,_t.y),l0(e.iconTransitioningVertexArray,_t.x+_t.w,_t.y),l0(e.iconTransitioningVertexArray,_t.x,_t.y+_t.h),l0(e.iconTransitioningVertexArray,_t.x+_t.w,_t.y+_t.h)}F.emplaceBack(Rt,Rt+1,Rt+2),F.emplaceBack(Rt+1,Rt+2,Rt+3),V.vertexLength+=4,V.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(mt[0]),le!==s.length-1&&zt===s[le+1].sectionIndex||e.programConfigurations.populatePaintArrays($.length,m,m.index,{},E,M,R,he&&he[zt])}const ce=S?S.anchor:P;e.placedSymbolArray.emplaceBack(ce.x,ce.y,ce.z,P.x,P.y,G,this.glyphOffsetArray.length-G,Y,y,A,P.segment,c?c[0]:0,c?c[1]:0,p[0],p[1],x,0,!1,0,I,0)}_commitLayoutVertex(e,s,c,p,u,m,x){e.emplaceBack(s,c,p,u,m,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,s,c,p,u,m,x){const S=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),P=S.vertexLength,y=x.tileAnchorX,A=x.tileAnchorY;for(let E=0;E<4;E++)c.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(c.collisionVertexArrayExt,s,e.padding,x.zOffset),this._commitLayoutVertex(c.layoutVertexArray,p,u,m,y,A,new Se(e.x1,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,u,m,y,A,new Se(e.x2,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,u,m,y,A,new Se(e.x2,e.y2)),this._commitLayoutVertex(c.layoutVertexArray,p,u,m,y,A,new Se(e.x1,e.y2)),S.vertexLength+=4;const I=c.indexArray;I.emplaceBack(P,P+1),I.emplaceBack(P+1,P+2),I.emplaceBack(P+2,P+3),I.emplaceBack(P+3,P),S.primitiveLength+=4}_addTextDebugCollisionBoxes(e,s,c,p,u,m){for(let x=p;x<u;x++){const S=c.get(x),P=this.getSymbolInstanceTextSize(e,m,s,x);this._addCollisionDebugVertices(S,P,this.textCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,s,c,p,u,m){for(let x=p;x<u;x++){const S=c.get(x),P=this.getSymbolInstanceIconSize(e,s,m.placedIconSymbolIndex);this._addCollisionDebugVertices(S,P,this.iconCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,s,c){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new sb(mf,DS.members,ll),this.iconCollisionBox=new sb(mf,DS.members,ll);const p=Mf(this.iconSizeData,e),u=Mf(this.textSizeData,e,c);for(let m=0;m<this.symbolInstances.length;m++){const x=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(u,e,s,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(u,e,s,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(p,e,s,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(p,e,s,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(e,s,c,p){const u=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:p),m=Jy(this.textSizeData,e,u)/ns;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,s,c){const p=this.icon.placedSymbolArray.get(c),u=Jy(this.iconSizeData,e,p);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,s,c,p){e.emplaceBack(s,-c,-c,p),e.emplaceBack(s,c,-c,p),e.emplaceBack(s,c,c,p),e.emplaceBack(s,-c,c,p)}_updateTextDebugCollisionBoxes(e,s,c,p,u,m,x){for(let S=p;S<u;S++){const P=c.get(S),y=this.getSymbolInstanceTextSize(e,m,s,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,y,P.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(e,s,c,p,u,m,x){for(let S=p;S<u;S++){const P=c.get(S),y=this.getSymbolInstanceIconSize(e,s,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,y,P.padding,m.zOffset)}}updateCollisionDebugBuffers(e,s,c,p){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=Mf(this.iconSizeData,e,p),m=Mf(this.textSizeData,e,c);for(let x=0;x<this.symbolInstances.length;x++){const S=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(m,e,s,S.textBoxStartIndex,S.textBoxEndIndex,S,c),this._updateTextDebugCollisionBoxes(m,e,s,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S,c),this._updateIconDebugCollisionBoxes(u,e,s,S.iconBoxStartIndex,S.iconBoxEndIndex,S,p),this._updateIconDebugCollisionBoxes(u,e,s,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,s,c,p,u,m,x,S,P){const y={};if(s<c){const{x1:A,y1:I,x2:E,y2:M,padding:R,projectedAnchorX:z,projectedAnchorY:F,projectedAnchorZ:$,tileAnchorX:H,tileAnchorY:V,featureIndex:G}=e.get(s);y.textBox={x1:A,y1:I,x2:E,y2:M,padding:R,projectedAnchorX:z,projectedAnchorY:F,projectedAnchorZ:$,tileAnchorX:H,tileAnchorY:V},y.textFeatureIndex=G}if(p<u){const{x1:A,y1:I,x2:E,y2:M,padding:R,projectedAnchorX:z,projectedAnchorY:F,projectedAnchorZ:$,tileAnchorX:H,tileAnchorY:V,featureIndex:G}=e.get(p);y.verticalTextBox={x1:A,y1:I,x2:E,y2:M,padding:R,projectedAnchorX:z,projectedAnchorY:F,projectedAnchorZ:$,tileAnchorX:H,tileAnchorY:V},y.verticalTextFeatureIndex=G}if(m<x){const{x1:A,y1:I,x2:E,y2:M,padding:R,projectedAnchorX:z,projectedAnchorY:F,projectedAnchorZ:$,tileAnchorX:H,tileAnchorY:V,featureIndex:G}=e.get(m);y.iconBox={x1:A,y1:I,x2:E,y2:M,padding:R,projectedAnchorX:z,projectedAnchorY:F,projectedAnchorZ:$,tileAnchorX:H,tileAnchorY:V},y.iconFeatureIndex=G}if(S<P){const{x1:A,y1:I,x2:E,y2:M,padding:R,projectedAnchorX:z,projectedAnchorY:F,projectedAnchorZ:$,tileAnchorX:H,tileAnchorY:V,featureIndex:G}=e.get(S);y.verticalIconBox={x1:A,y1:I,x2:E,y2:M,padding:R,projectedAnchorX:z,projectedAnchorY:F,projectedAnchorZ:$,tileAnchorX:H,tileAnchorY:V},y.verticalIconFeatureIndex=G}return y}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,s){const c=e.placedSymbolArray.get(s),p=c.vertexStartIndex+4*c.numGlyphs;for(let u=c.vertexStartIndex;u<p;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(e),c=Math.cos(e),p=[],u=[],m=[];for(let x=0;x<this.symbolInstances.length;++x){m.push(x);const S=this.symbolInstances.get(x);p.push(0|Math.round(s*S.tileAnchorX+c*S.tileAnchorY)),u.push(S.featureIndex)}return m.sort((x,S)=>p[x]-p[S]||u[S]-u[x]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,s)=>this.symbolInstances.get(s).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:P}=c;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),u>=0&&u!==p&&this.addIndicesForPlacedSymbol(this.text,u),m>=0&&m!==u&&m!==p&&this.addIndicesForPlacedSymbol(this.text,m),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let dA,fA,ob;Gt(h0,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),h0.addDynamicAttributes=u0;class pA{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Il,this.defaultValue=e}evaluate(e){if(e.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(e.formattedSection))return s.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Gt(pA,"FormatSectionOverride",{omit:["defaultValue"]});const ab=()=>ob||(ob={layout:dA||(dA=new Dn({"symbol-placement":new wt(Ye.layout_symbol["symbol-placement"]),"symbol-spacing":new wt(Ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new wt(Ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Vt(Ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new wt(Ye.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new wt(Ye.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new wt(Ye.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new wt(Ye.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new wt(Ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new wt(Ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new wt(Ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new Vt(Ye.layout_symbol["icon-size"]),"icon-size-scale-range":new wt(Ye.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Vt(Ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Vt(Ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new Vt(Ye.layout_symbol["icon-image"]),"icon-rotate":new Vt(Ye.layout_symbol["icon-rotate"]),"icon-padding":new wt(Ye.layout_symbol["icon-padding"]),"icon-keep-upright":new wt(Ye.layout_symbol["icon-keep-upright"]),"icon-offset":new Vt(Ye.layout_symbol["icon-offset"]),"icon-anchor":new Vt(Ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new wt(Ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new wt(Ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new wt(Ye.layout_symbol["text-rotation-alignment"]),"text-field":new Vt(Ye.layout_symbol["text-field"]),"text-font":new Vt(Ye.layout_symbol["text-font"]),"text-size":new Vt(Ye.layout_symbol["text-size"]),"text-size-scale-range":new wt(Ye.layout_symbol["text-size-scale-range"]),"text-max-width":new Vt(Ye.layout_symbol["text-max-width"]),"text-line-height":new Vt(Ye.layout_symbol["text-line-height"]),"text-letter-spacing":new Vt(Ye.layout_symbol["text-letter-spacing"]),"text-justify":new Vt(Ye.layout_symbol["text-justify"]),"text-radial-offset":new Vt(Ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new wt(Ye.layout_symbol["text-variable-anchor"]),"text-anchor":new Vt(Ye.layout_symbol["text-anchor"]),"text-max-angle":new wt(Ye.layout_symbol["text-max-angle"]),"text-writing-mode":new wt(Ye.layout_symbol["text-writing-mode"]),"text-rotate":new Vt(Ye.layout_symbol["text-rotate"]),"text-padding":new wt(Ye.layout_symbol["text-padding"]),"text-keep-upright":new wt(Ye.layout_symbol["text-keep-upright"]),"text-transform":new Vt(Ye.layout_symbol["text-transform"]),"text-offset":new Vt(Ye.layout_symbol["text-offset"]),"text-allow-overlap":new wt(Ye.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new wt(Ye.layout_symbol["text-ignore-placement"]),"text-optional":new wt(Ye.layout_symbol["text-optional"]),visibility:new wt(Ye.layout_symbol.visibility)})),paint:fA||(fA=new Dn({"icon-opacity":new Vt(Ye.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Vt(Ye.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Vt(Ye.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Vt(Ye.paint_symbol["text-emissive-strength"]),"icon-color":new Vt(Ye.paint_symbol["icon-color"]),"icon-halo-color":new Vt(Ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new Vt(Ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Vt(Ye.paint_symbol["icon-halo-blur"]),"icon-translate":new wt(Ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new wt(Ye.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Vt(Ye.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Vt(Ye.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Vt(Ye.paint_symbol["text-occlusion-opacity"]),"text-color":new Vt(Ye.paint_symbol["text-color"],{runtimeType:Jr,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new Vt(Ye.paint_symbol["text-halo-color"]),"text-halo-width":new Vt(Ye.paint_symbol["text-halo-width"]),"text-halo-blur":new Vt(Ye.paint_symbol["text-halo-blur"]),"text-translate":new wt(Ye.paint_symbol["text-translate"]),"text-translate-anchor":new wt(Ye.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new wt(Ye.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new wt(Ye.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new wt(Ye.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new wt(Ye.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Vt(Ye.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},ob);class d0 extends Mr{constructor(e,s,c,p){super(e,ab(),s,c,p),this._colorAdjustmentMatrix=Le.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,s){super.recalculate(e,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const p=[];for(const u of c)p.indexOf(u)<0&&p.push(u);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,s,c,p){return this._saturation===e&&this._contrast===s&&this._brightnessMin===c&&this._brightnessMax===p||(this._colorAdjustmentMatrix=function(u,m,x,S){u=Rd(u),m=Pd(m);const P=Le.mat4.create(),y=u/3,A=1-2*y,I=[A,y,y,0,y,A,y,0,y,y,A,0,0,0,0,1],E=.5-.5*m,M=S-x;return Le.mat4.multiply(P,[M,0,0,0,0,M,0,0,0,0,M,0,x,x,x,1],[m,0,0,0,0,m,0,0,0,0,m,0,E,E,E,1]),Le.mat4.multiply(P,P,I),P}(e,s,c,p),this._saturation=e,this._contrast=s,this._brightnessMin=c,this._brightnessMax=p),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,s,c,p){const u=this.layout.get(e).evaluate(s,{},c,p),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||Dc(m.value)||!u?u:function(x,S){return S.replace(/{([^{}]+)}/g,(P,y)=>y in x?String(x[y]):"")}(s.properties,u)}createBucket(e){return new h0(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of ab().paint.overridableProperties){if(!d0.hasPaintOverride(this.layout,e))continue;const s=this.paint.get(e),c=new pA(s),p=new tf(c,s.property.specification,this.scope,this.options);let u=null;u=s.value.kind==="constant"||s.value.kind==="source"?new nf("source",p):new lh("composite",p,s.value.zoomStops,s.value._interpolationType),this.paint._values[e]=new kc(s.property,u,s.parameters)}}_handleOverridablePaintPropertyUpdate(e,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&d0.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,s){const c=e.get("text-field"),p=ab().paint.properties[s];let u=!1;const m=x=>{for(const S of x)if(p.overrides&&p.overrides.hasOverride(S))return void(u=!0)};if(c.value.kind==="constant"&&c.value.value instanceof Qr)m(c.value.value.sections);else if(c.value.kind==="source"){const x=P=>{u||(P instanceof Dr&&Vn(P.value)===ta?m(P.value.sections):P instanceof Pl?m(P.sections):P.eachChild(x))},S=c.value;S._styleExpression&&x(S._styleExpression.expression)}return u}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,s,c){return{config:new Wl(this,{zoom:s,lut:c}),overrideFog:!1}}}let mA,_A,gA,yA;var lb=en([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function cb(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function ub(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class hb{constructor(e,s,c,p){this.context=e,this.format=c,this.useMipmap=p&&p.useMipmap,this.texture=e.gl.createTexture(),this.update(s,{premultiply:p&&p.premultiply})}update(e,s){const c=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,p=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:u}=this,{gl:m}=u,{x,y:S}=s&&s.position?s.position:{x:0,y:0},P=x+c,y=S+p;!this.size||this.size[0]===P&&this.size[1]===y||(m.bindTexture(m.TEXTURE_2D,null),m.deleteTexture(this.texture),this.texture=m.createTexture(),this.size=null),m.bindTexture(m.TEXTURE_2D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA8&&(!s||s.premultiply!==!1));const A=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&P>0&&y>0){const I=this.useMipmap?Math.floor(Math.log2(Math.max(P,y)))+1:1;m.texStorage2D(m.TEXTURE_2D,I,this.format,P,y),this.size=[P,y]}if(this.size)if(A)m.texSubImage2D(m.TEXTURE_2D,0,x,S,cb(this.format),ub(this.format),e);else{const I=e.data;I&&m.texSubImage2D(m.TEXTURE_2D,0,x,S,c,p,cb(this.format),ub(this.format),I)}this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,s,c=!1){const{context:p}=this,{gl:u}=p;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap&&!c?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,s),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,s),this.wrapS=s)}bindExtraParam(e,s,c,p){const{context:u}=this,{gl:m}=u;m.bindTexture(m.TEXTURE_2D,this.texture),s!==this.magFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,s),this.magFilter=s),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),c!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,c),this.wrapS=c),p!==this.wrapT&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,p),this.wrapT=p)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class f0{constructor(e,s){this.context=e,this.texture=s}bind(e,s){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,e),this.minFilter=e),s!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrapS=s)}}function p0(a,e,s,c,p,u,m,x){const S=[a,e,1,s,c,1,p,u,1],P=[m,x,1],y=Le.mat3.adjoint([],S),[A,I,E]=Le.vec3.transformMat3(P,P,y);return Le.mat3.multiply(S,S,[A,0,0,0,I,0,0,0,E])}function vA(a,e,s,c,p,u,m,x){const S=function(P,y,A,I,E,M,R,z){const F=p0(0,0,1,0,1,1,0,1),$=p0(P,y,A,I,E,M,R,z),H=Le.mat3.adjoint([],F);return Le.mat3.multiply($,$,H)}(a,e,s,c,p,u,m,x);return[S[2]/S[8]/Lt,S[5]/S[8]/Lt]}function m0(a){return[a[0],Math.min(Math.max(a[1],-Gn),Gn)]}class xA extends el{constructor(e,s,c,p){super(),this.id=e,this.dispatcher=c,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(p),this.options=s,this._dirty=!1}load(e,s){if(this._loaded=s||!1,this.fire(new ea("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Up(this.map._requestManager.transformRequest(this.url,Ki.Image),(c,p)=>{this._imageRequest=null,this._loaded=!0,c?this.fire(new Ld(c)):p&&(this.image=p instanceof HTMLImageElement?ye.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new f0(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ea("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof f0||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let s=e[0][1],c=e[0][1];for(const u of e)u[1]>c&&(c=u[1]),u[1]<s&&(s=u[1]);const p=(c+s)/2;if(p>Gn?this.onNorthPole=!0:p<-Gn&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const u=e.map(o.fromLngLat);this.tileID=function(m){let x=1/0,S=1/0,P=-1/0,y=-1/0;for(const R of m)x=Math.min(x,R.x),S=Math.min(S,R.y),P=Math.max(P,R.x),y=Math.max(y,R.y);const A=Math.max(P-x,y-S),I=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),E=Math.pow(2,I);let M=Math.floor((x+P)/2*E);return M>1&&(M-=1),new pt(I,M,Math.floor((S+y)/2*E))}(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new ea("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const F in this.tiles){const $=this.tiles[F];$.state!=="loaded"&&($.state="loaded",$.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const s=b_(new pt(0,0,0),this.map.transform.projection),c=[s.projection.project(this.coordinates[0][0],this.coordinates[0][1]),s.projection.project(this.coordinates[1][0],this.coordinates[1][1]),s.projection.project(this.coordinates[2][0],this.coordinates[2][1]),s.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(F){const $=F[1].x-F[0].x,H=F[1].y-F[0].y,V=F[2].x-F[1].x,G=F[2].y-F[1].y,Y=F[3].x-F[2].x,te=F[3].y-F[2].y,he=F[0].x-F[3].x,ce=F[0].y-F[3].y,le=$*G-V*H,Ee=V*te-Y*G,de=Y*ce-he*te,Ae=he*H-$*ce;return le>0&&Ee>0&&de>0&&Ae>0||le<0&&Ee<0&&de<0&&Ae<0}(c))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const p=b_(this.tileID,this.map.transform.projection),[u,m,x,S]=this.coordinates.map(F=>{const $=p.projection.project(F[0],F[1]);return oA(p,$)._round()});this.perspectiveTransform=vA(u.x,u.y,m.x,m.y,x.x,x.y,S.x,S.y);const P=this._boundsArray=new Na;P.emplaceBack(u.x,u.y,0,0),P.emplaceBack(m.x,m.y,Lt,0),P.emplaceBack(S.x,S.y,0,Lt),P.emplaceBack(x.x,x.y,Lt,Lt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(P,lb.members),this.boundsSegments=Hn.simpleSegment(0,0,4,2);const y=[],A=[m0((I=this.coordinates)[0]),m0(I[1]),m0(I[2]),m0(I[3])];var I;const[E,M,R,z]=function(F){let $=F[0][0],H=$,V=F[0][1],G=V;for(let Y=1;Y<F.length;Y++)F[Y][0]<$?$=F[Y][0]:F[Y][0]>H&&(H=F[Y][0]),F[Y][1]<V?V=F[Y][1]:F[Y][1]>G&&(G=F[Y][1]);return[$,V,H-$,G-V]}(A);{const F=new Na,[$,H,V,G]=function(Ne){let Ge=Ne[0].x,Fe=Ge,at=Ne[0].y,mt=at;for(let ot=1;ot<Ne.length;ot++)Ne[ot].x<Ge?Ge=Ne[ot].x:Ne[ot].x>Fe&&(Fe=Ne[ot].x),Ne[ot].y<at?at=Ne[ot].y:Ne[ot].y>mt&&(mt=Ne[ot].y);return[Ge,at,Fe-Ge,mt-at]}(c),Y=Ne=>[(Ne.x-$)/V,(Ne.y-H)/G],[te,he,ce,le]=c.map(Y),Ee=function(Ne,Ge,Fe,at,mt,ot,zt,Rt){const xt=p0(0,0,1,0,1,1,0,1),_t=p0(Ne,Ge,Fe,at,mt,ot,zt,Rt),Yt=Le.mat3.adjoint([],_t);return Le.mat3.multiply(xt,xt,Yt)}(te[0],te[1],he[0],he[1],ce[0],ce[1],le[0],le[1]);this.elevatedGlobePerspectiveTransform=vA(te[0],te[1],he[0],he[1],ce[0],ce[1],le[0],le[1]);const de=(Ne,Ge)=>{y.push(Ne.lng);const Fe=Math.round((Ne.lng-E)/R*Lt),at=Math.round((Ne.lat-M)/z*Lt),mt=Y(Ge),ot=Le.vec3.transformMat3([],[mt[0],mt[1],1],Ee),zt=Math.round(ot[0]/ot[2]*Lt),Rt=Math.round(ot[1]/ot[2]*Lt);F.emplaceBack(Fe,at,zt,Rt)},Ae=c[3].x-c[0].x,Pe=c[3].y-c[0].y,Ce=c[2].x-c[1].x,ze=c[2].y-c[1].y;for(let Ne=0;Ne<65;Ne++){const Ge=Ne/64,Fe=[c[0].x+Ge*Ae,c[0].y+Ge*Pe],at=[c[1].x+Ge*Ce,c[1].y+Ge*ze],mt=at[0]-Fe[0],ot=at[1]-Fe[1];for(let zt=0;zt<65;zt++){const Rt=zt/64,xt={x:Fe[0]+mt*Rt,y:Fe[1]+ot*Rt,z:0};de(s.projection.unproject(xt.x,xt.y),xt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(F,lb.members)}{this.maxLongitudeTriangleSize=0;let F=[],$=new Or;const H=(V,G,Y)=>{$.emplaceBack(V,G,Y);const te=y[V],he=y[G],ce=y[Y],le=Math.min(Math.min(te,he),ce),Ee=Math.max(Math.max(te,he),ce)-le;Ee>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ee),F.push(le+Ee/2)};for(let V=0;V<64;V++)for(let G=0;G<64;G++){const Y=65*V+G,te=Y+1,he=Y+65,ce=he+1;H(Y,he,te),H(te,he,ce)}[F,$]=function(V,G){const Y=Array.from({length:V.length},(ce,le)=>le);Y.sort((ce,le)=>V[ce]-V[le]);const te=[],he=new Or;for(let ce=0;ce<Y.length;ce++){const le=Y[ce];te.push(V[le]);const Ee=3*le,de=Ee+1;he.emplaceBack(G.uint16[Ee],G.uint16[de],G.uint16[de+1])}return[te,he]}(F,$),this.elevatedGlobeTrianglesCenterLongitudes=F,this.elevatedGlobeIndexBuffer=e.createIndexBuffer($)}this.elevatedGlobeSegments=Hn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,R/Lt,0,z/Lt,0,0,M,E,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const s=this.map.painter.context,c=s.gl;!this._dirty||this.texture instanceof f0||(this.texture?this.texture.update(this.image):(this.texture=new hb(s,this.image,c.RGBA8),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(s)}loadTile(e,s){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},s(null)):(e.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const s=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!s)return null;const c=this.elevatedGlobeTrianglesCenterLongitudes;let p=(u=e+180)+360*Math.round((c[0]-u)/360);var u;const m=new Hn,x=(A,I)=>{m.segments.push({vertexOffset:0,primitiveOffset:A,vertexLength:s.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},S=.51*this.maxLongitudeTriangleSize;if(Math.abs(c[0]-p)<=S){const A=bc(c,0,c.length,p+S);return A===c.length||x(A,Id(c,A+1,c.length,p+360-S)-A),m}p<c[0]&&(p+=360);const P=Id(c,0,c.length,p-S);if(P===c.length)return x(0,c.length),m;x(0,P-0);const y=bc(c,P+1,c.length,p+S);return y!==c.length&&x(y,c.length-y),m}}const vk=(Math.pow(256,2)-1)/16907520;class bA extends Mr{constructor(e,s,c,p){super(e,{layout:gA||(gA=new Dn({visibility:new wt(Ye.layout_raster.visibility)})),paint:yA||(yA=new Dn({"raster-opacity":new wt(Ye.paint_raster["raster-opacity"]),"raster-color":new Nc(Ye.paint_raster["raster-color"]),"raster-color-mix":new wt(Ye.paint_raster["raster-color-mix"]),"raster-color-range":new wt(Ye.paint_raster["raster-color-range"]),"raster-hue-rotate":new wt(Ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new wt(Ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new wt(Ye.paint_raster["raster-brightness-max"]),"raster-saturation":new wt(Ye.paint_raster["raster-saturation"]),"raster-contrast":new wt(Ye.paint_raster["raster-contrast"]),"raster-resampling":new wt(Ye.paint_raster["raster-resampling"]),"raster-fade-duration":new wt(Ye.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new wt(Ye.paint_raster["raster-emissive-strength"]),"raster-array-band":new wt(Ye.paint_raster["raster-array-band"]),"raster-elevation":new wt(Ye.paint_raster["raster-elevation"]),"raster-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},s,c,p),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof xA&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const s=this._transitionablePaint._values["raster-color"].value.expression,[c,p]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(c)&&isNaN(p)||c===this._curRampRange[0]&&p===this._curRampRange[1]||(this.colorRamp=s_({expression:s,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:c,end:p}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[c,p])}}let wA,TA,EA,SA,AA;class MA extends Mr{constructor(e,s,c,p){super(e,{layout:wA||(wA=new Dn({visibility:new wt(Ye["layout_raster-particle"].visibility)})),paint:TA||(TA=new Dn({"raster-particle-array-band":new wt(Ye["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new wt(Ye["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Nc(Ye["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new wt(Ye["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new wt(Ye["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new wt(Ye["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new wt(Ye["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new wt(Ye["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},s,c,p),this._updateColorRamp(),this.lastInvalidatedAt=ye.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,s=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=s_({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:s}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ye.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class xk extends Mr{constructor(e,s){super(e,{},s,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function db(a,e,s){const c=[0,0,1],p=Le.quat.identity([]);return Le.quat.rotateY(p,p,s?-yt(a)+Math.PI:yt(a)),Le.quat.rotateX(p,p,-yt(e)),Le.vec3.transformQuat(c,c,p),Le.vec3.normalize(c,c)}function CA(a,e){const s=_0(a.projection,a.zoom,a.width,a.height),c=function(u,m,x,S,P){const y=new Xi(x.lng-180*Qc,x.lat),A=new Xi(x.lng+180*Qc,x.lat),I=u.project(y.lng,y.lat),E=u.project(A.lng,A.lat),M=-Math.atan2(E.y-I.y,E.x-I.x),R=o.fromLngLat(x);R.y=Ct(R.y,-1+Qc,1-Qc);const z=R.toLngLat(),F=u.project(z.lng,z.lat),$=o.fromLngLat(z);$.x+=Qc;const H=$.toLngLat(),V=u.project(H.lng,H.lat),G=PA(V.x-F.x,V.y-F.y,M),Y=o.fromLngLat(z);Y.y+=Qc;const te=Y.toLngLat(),he=u.project(te.lng,te.lat),ce=PA(he.x-F.x,he.y-F.y,M),le=Math.abs(G.x)/Math.abs(ce.y),Ee=Le.mat4.identity([]);Le.mat4.rotateZ(Ee,Ee,-M*(1-(P?0:S)));const de=Le.mat4.identity([]);return Le.mat4.scale(de,de,[1,1-(1-le)*S,1]),de[4]=-ce.x/ce.y*S,Le.mat4.rotateZ(de,de,M),Le.mat4.multiply(de,Ee,de),de}(a.projection,0,a.center,s,e),p=IA(a);return Le.mat4.scale(c,c,[p,p,1]),c}function IA(a){const e=a.projection,s=_0(a.projection,a.zoom,a.width,a.height),c=fb(e,a.center),p=fb(e,Xi.convert(e.center));return Math.pow(2,c*s+(1-s)*p)}function _0(a,e,s,c,p=1/0){const u=a.range;if(!u)return 0;const m=Math.min(p,Math.max(s,c)),x=Math.log(m/1024)/Math.LN2;return yi(u[0]+x,u[1]+x,e)}const Qc=1/4e4;function fb(a,e){const s=Ct(e.lat,-Gn,Gn),c=new Xi(e.lng-180*Qc,s),p=new Xi(e.lng+180*Qc,s),u=a.project(c.lng,s),m=a.project(p.lng,s),x=o.fromLngLat(c),S=o.fromLngLat(p),P=m.x-u.x,y=m.y-u.y,A=S.x-x.x,I=S.y-x.y,E=Math.sqrt((A*A+I*I)/(P*P+y*y));return Math.log(E)/Math.LN2}function PA(a,e,s){const c=Math.cos(s),p=Math.sin(s);return{x:a*c-e*p,y:a*p+e*c}}function RA(a,e,s){Le.mat4.identity(a),Le.mat4.rotateZ(a,a,yt(e[2])),Le.mat4.rotateX(a,a,yt(e[0])),Le.mat4.rotateY(a,a,yt(e[1])),Le.mat4.scale(a,a,s),Le.mat4.multiply(a,a,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function g0(a,e,s,c,p,u,m,x){const S=[s[0]-e[0],s[1]-e[1],0],P=[c[0]-e[0],c[1]-e[1],0];if(Le.vec3.length(S)<1e-12||Le.vec3.length(P)<1e-12)return Le.quat.identity(a);const y=Le.vec3.cross([],S,P);Le.vec3.normalize(y,y),Le.vec3.subtract(P,c,e),S[2]=(u-p)*x,P[2]=(m-p)*x;const A=S;return Le.vec3.cross(A,S,P),Le.vec3.normalize(A,A),Le.quat.rotationTo(a,y,A)}function pb(a,e,s=!1){const c=bs(e.zoom),p=function(u,m,x){const S=m.worldSize,P=[u[12],u[13],u[14]],y=zr(P[1]/S),A=Ps(P[0]/S),I=Le.mat4.identity([]),E=ms(1,y)*S,M=ms(1,0)*S*Gc(y,m.zoom),R=1/is(S);let z=M*R;if(x){const V=_0(m.projection,m.zoom,m.width,m.height,1024);z=R*m.projection.pixelSpaceConversion(m.center.lat,S,V)}const F=Zl(y,A);Le.vec3.add(F,F,Le.vec3.scale([],Le.vec3.normalize([],F),E*z*P[2]));const $=function(V){const G=[V[0],V[1],V[2]];let Y=[0,1,0];const te=Le.vec3.cross([],Y,G);return Le.vec3.cross(Y,G,te),Le.vec3.squaredLength(Y)===0&&(Y=[0,1,0],Le.vec3.cross(te,G,Y)),Le.vec3.normalize(te,te),Le.vec3.normalize(Y,Y),Le.vec3.normalize(G,G),[te[0],te[1],te[2],0,Y[0],Y[1],Y[2],0,G[0],G[1],G[2],0,V[0],V[1],V[2],1]}(F);Le.mat4.scale(I,I,[z,z,z*E]),Le.mat4.translate(I,I,[-P[0],-P[1],-P[2]]);const H=Le.mat4.multiply([],m.globeMatrix,$);return Le.mat4.multiply(H,H,I),Le.mat4.multiply(H,H,u),H}(a,e,s);if(c>0){const u=function(m,x){const S=x.worldSize,P=ms(1,0)*S*Gc(x.center.lat,x.zoom)/is(S),y=ms(1,x.center.lat)*S,A=Le.mat4.identity([]);return Le.mat4.rotateY(A,A,yt(x.center.lng)),Le.mat4.rotateX(A,A,yt(x.center.lat)),Le.mat4.translate(A,A,[0,0,ps]),Le.mat4.scale(A,A,[P,P,P*y]),Le.mat4.translate(A,A,[x.point.x-.5*S,x.point.y-.5*S,0]),Le.mat4.multiply(A,A,m),Le.mat4.multiply(A,x.globeMatrix,A)}(a,e);return function(m,x,S){const P=(M,R,z)=>{const F=Le.vec3.length(M),$=Le.vec3.length(R),H=ar(M,R,z);return Le.vec3.scale(H,H,1/Le.vec3.length(H)*di(F,$,z))},y=P([m[0],m[1],m[2]],[x[0],x[1],x[2]],S),A=P([m[4],m[5],m[6]],[x[4],x[5],x[6]],S),I=P([m[8],m[9],m[10]],[x[8],x[9],x[10]],S),E=ar([m[12],m[13],m[14]],[x[12],x[13],x[14]],S);return[y[0],y[1],y[2],0,A[0],A[1],A[2],0,I[0],I[1],I[2],0,E[0],E[1],E[2],1]}(p,u,c)}return p}function DA(a,e,s,c){const p=ei.projectAabbCorners(c,s);let u=Number.MAX_VALUE,m=-1;for(let P=0;P<p.length;++P){const y=p[P];y[0]=(.5*y[0]+.5)*e.width,y[1]=(.5-.5*y[1])*e.height,y[2]<u&&(m=P,u=y[2])}const x=P=>new Se(p[P][0],p[P][1]);let S;switch(m){case 0:case 6:S=[x(1),x(5),x(4),x(7),x(3),x(2),x(1)];break;case 1:case 7:S=[x(0),x(4),x(5),x(6),x(2),x(3),x(0)];break;case 3:case 5:S=[x(1),x(0),x(4),x(7),x(6),x(2),x(1)];break;default:S=[x(1),x(5),x(6),x(7),x(3),x(0),x(1)]}if(X(a,S))return u}const bk=en([{name:"a_pos_3f",components:3,type:"Float32"}]),wk=en([{name:"a_color_3f",components:3,type:"Float32"}]),Tk=en([{name:"a_color_4f",components:4,type:"Float32"}]),Ek=en([{name:"a_uv_2f",components:2,type:"Float32"}]),Sk=en([{name:"a_normal_3f",components:3,type:"Float32"}]),Ak=en([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Mk=en([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),LA={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class y0{constructor(e,s,c,p){this.message=(e?`${e}: `:"")+c,p&&(this.identifier=p),s!=null&&s.__line__&&(this.line=s.__line__)}}function OA(a,e){const s=a.indexOf("://")===-1;try{return new URL(a,s&&e?"http://example.com":void 0),!0}catch{return!1}}class zA{constructor(e,s){this.feature=e,this.instancedDataOffset=s,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class kA{constructor(){this.instancedDataArray=new vh,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class mb{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,s){}populate(e,s,c,p){this.tileToMeter=i(c);const u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:m,id:x,index:S,sourceLayerIndex:P}of e){const y=x??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),A=N(m,u);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),A,c))continue;const I={id:y,sourceLayerIndex:P,index:S,geometry:u?A.geometry:O(m,c,p),properties:m.properties,type:m.type,patterns:{}},E=this.addFeature(I,I.geometry,A);E&&s.featureIndex.insert(m,I.geometry,S,P,this.index,this.instancesPerModel[E].instancedDataArray.length,Lt/32)}this.lookup=null}update(e,s,c,p){for(const u in this.instancesPerModel){const m=this.instancesPerModel[u];for(const x in e)m.idToFeaturesIndex.hasOwnProperty(x)&&(this.evaluate(m.features[m.idToFeaturesIndex[x]],e[x],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const s in this.instancesPerModel){const c=this.instancesPerModel[s];for(const p of c.features){const u=this.layers[0],m=p.feature,x=this.canonical,S=u.paint.get("model-rotation").evaluate(m,{},x),P=u.paint.get("model-scale").evaluate(m,{},x),y=u.paint.get("model-translation").evaluate(m,{},x);Le.vec3.exactEquals(p.rotation,S)&&Le.vec3.exactEquals(p.scale,P)&&Le.vec3.exactEquals(p.translation,y)||(this.evaluate(p,p.featureStates,c,!0),e=!0)}}return e}updateReplacement(e,s,c,p){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const u=s.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Vx(this.activeReplacements,u))return!1;this.activeReplacements=u;let m=!1;for(const x in this.instancesPerModel){const S=this.instancesPerModel[x],P=S.instancedDataArray;for(const y of S.features){const A=y.instancedDataOffset,I=y.instancedDataCount;for(let E=0;E<I;E++){const M=16*(E+A);let R=P.float32[M+0];const z=R>Lt;R=z?R-Lt:R;const F=Math.floor(R),$=P.float32[M+1];let H=!1;for(const V of this.activeReplacements)if(!YE(V,c,LA.Model,p)&&!(V.min.x>F||F>V.max.x||V.min.y>$||$>V.max.y)&&(H=iS(tS(F,$,e.canonical,V.footprintTileId.canonical),V.footprint),H))break;P.float32[M]=H?R+Lt:R,m=m||H!==z}}}return m}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const s in this.instancesPerModel){const c=this.instancesPerModel[s];c.instancedDataArray.length<0||c.instancedDataArray.length===0||(c.instancedDataBuffer?c.instancedDataBuffer.updateData(c.instancedDataArray):c.instancedDataBuffer=e.createVertexBuffer(c.instancedDataArray,Ak.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const s in this.instancesPerModel){const c=this.instancesPerModel[s];c.instancedDataArray.length!==0&&c.instancedDataBuffer&&c.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const s of this.modelUris)e.removeModel(s,"")}addFeature(e,s,c){const p=this.layers[0],u=p.layout.get("model-id").evaluate(c,{},this.canonical);if(!u)return Ti(`modelId is not evaluated for layer ${p.id} and it is not going to get rendered.`),u;OA(u,!1)&&(this.modelUris.includes(u)||this.modelUris.push(u)),this.instancesPerModel[u]||(this.instancesPerModel[u]=new kA);const m=this.instancesPerModel[u],x=m.instancedDataArray,S=new zA(c,x.length);for(const P of s)for(const y of P){if(y.x<0||y.x>=Lt||y.y<0||y.y>=Lt)continue;const A=(this.lookupDim-1)/Lt,I=this.lookupDim*(y.y*A|0)+y.x*A|0;if(this.lookup){if(this.lookup[I]!==0)continue;this.lookup[I]=1}this.instanceCount++;const E=x.length;x.resize(E+1),m.instancesEvaluatedElevation.push(0),x.float32[16*E]=y.x,x.float32[16*E+1]=y.y}return S.instancedDataCount=m.instancedDataArray.length-S.instancedDataOffset,S.instancedDataCount>0&&(e.id&&(m.idToFeaturesIndex[e.id]=m.features.length),m.features.push(S),this.evaluate(S,{},m,!1)),u}getModelUris(){return this.modelUris}evaluate(e,s,c,p){const u=this.layers[0],m=e.feature,x=this.canonical,S=e.rotation=u.paint.get("model-rotation").evaluate(m,s,x),P=e.scale=u.paint.get("model-scale").evaluate(m,s,x),y=e.translation=u.paint.get("model-translation").evaluate(m,s,x),A=u.paint.get("model-color").evaluate(m,s,x);A.a=u.paint.get("model-color-mix-intensity").evaluate(m,s,x);const I=[];this.maxVerticalOffset<y[2]&&(this.maxVerticalOffset=y[2]),this.maxScale=Math.max(Math.max(this.maxScale,P[0]),Math.max(P[1],P[2])),RA(I,S,P);const E=Math.round(100*A.a)+A.b/1.05;for(let M=0;M<e.instancedDataCount;++M){const R=e.instancedDataOffset+M,z=16*R,F=c.instancedDataArray.float32;let $=0;p&&($=F[z+6]-c.instancesEvaluatedElevation[R]);const H=0|F[z+1];F[z]=(0|F[z])+A.r/1.05,F[z+1]=H+A.g/1.05,F[z+2]=E,F[z+3]=1/(x.z>10?this.tileToMeter:i(x,H)),F[z+4]=y[0],F[z+5]=y[1],F[z+6]=y[2]+$,F[z+7]=I[0],F[z+8]=I[1],F[z+9]=I[2],F[z+10]=I[4],F[z+11]=I[5],F[z+12]=I[6],F[z+13]=I[8],F[z+14]=I[9],F[z+15]=I[10],c.instancesEvaluatedElevation[R]=y[2]}}}let FA,NA;Gt(mb,"ModelBucket",{omit:["layers"]}),Gt(kA,"PerModelAttributes"),Gt(zA,"ModelFeature");const Dh=64,Df={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function BA(a,e,s,c,p,u,m,x,S,P=!1){const y=s.zoom,A=s.project(c),I=Gc(c.lat,y),E=1/I;Le.mat4.identity(a),Le.mat4.translate(a,a,[A.x+m[0]*E,A.y+m[1]*E,m[2]]);let M=1,R=1;const z=s.worldSize;if(P){if(s.projection.name==="mercator"){let V=0;s.elevation&&(V=s.elevation.getAtPointOrZero(new o(A.x/z,A.y/z),0));const G=Le.vec4.transformMat4([],[A.x,A.y,V,1],s.projMatrix)[3]/s.cameraToCenterDistance;M=G,R=G*Gc(s.center.lat,y)}else if(s.projection.name==="globe"){const V=pb(a,s),G=Le.mat4.multiply([],s.projMatrix,V),Y=[0,0,0,1];Le.vec4.transformMat4(Y,Y,G);const te=Y[3]/s.cameraToCenterDistance,he=bs(y),ce=s.projection.pixelsPerMeter(c.lat,z)*Gc(c.lat,y),le=s.projection.pixelsPerMeter(s.center.lat,z)*Gc(s.center.lat,y);M=te/di(ce,n_(s.center.lat),he),R=te*I/ce,M*=le,R*=le}}else M=E;Le.mat4.scale(a,a,[M,M,R]);const F=[...a],$=e.orientation,H=[];if(RA(H,[$[0]+p[0],$[1]+p[1],$[2]+p[2]],u),Le.mat4.multiply(a,F,H),x&&s.elevation){let V=0;const G=[];if(S&&s.elevation){V=function(he,ce,le,Ee,de){const Ae=ce.elevation;if(!Ae)return 0;const Pe=ei.projectAabbCorners(le,Ee),Ce=ms(1,de.lat)*ce.worldSize,ze=function(Yt,Ft){const jt=[0,0,1],mi=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Ei of mi){const Mi=Yt[Ei.corners[0]],Ci=Yt[Ei.corners[1]],Di=Yt[Ei.corners[2]],zi=[Ci[0]-Mi[0],Ci[1]-Mi[1],Ft*(Ci[2]-Mi[2])],_n=Le.vec3.cross(zi,zi,[Di[0]-Mi[0],Di[1]-Mi[1],Ft*(Di[2]-Mi[2])]);Le.vec3.normalize(_n,_n),Ei.dotProductWithUp=Le.vec3.dot(_n,jt)}return mi.sort((Ei,Mi)=>Ei.dotProductWithUp-Mi.dotProductWithUp),mi[0].corners}(Pe,Ce),Ne=Pe[ze[0]],Ge=Pe[ze[1]],Fe=Pe[ze[2]],at=Pe[ze[3]],mt=Ae.getAtPointOrZero(new o(Ne[0]/ce.worldSize,Ne[1]/ce.worldSize),0),ot=Ae.getAtPointOrZero(new o(Ge[0]/ce.worldSize,Ge[1]/ce.worldSize),0),zt=Ae.getAtPointOrZero(new o(Fe[0]/ce.worldSize,Fe[1]/ce.worldSize),0),Rt=Ae.getAtPointOrZero(new o(at[0]/ce.worldSize,at[1]/ce.worldSize),0),xt=(mt+Rt)/2,_t=(ot+zt)/2;return xt>_t?ot<zt?g0(he,Ge,at,Ne,ot,Rt,mt,Ce):g0(he,Fe,Ne,at,zt,mt,Rt,Ce):mt<Rt?g0(he,Ne,Ge,Fe,mt,ot,zt,Ce):g0(he,at,Fe,Ge,Rt,zt,ot,Ce),Math.max(xt,_t)}(G,s,e.aabb,a,c);const Y=Le.mat4.fromQuat([],G),te=Le.mat4.multiply([],Y,H);Le.mat4.multiply(a,F,te)}else V=s.elevation.getAtPointOrZero(new o(A.x/z,A.y/z),0);V!==0&&(a[14]+=V)}}function A_(a,e,s=!1){a.uploaded||(a.gfxTexture=new hb(e,a.image,s?e.gl.R8:e.gl.RGBA8,{useMipmap:a.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),a.uploaded=!0,a.image=null)}function Ck(a,e,s){a.indexBuffer=e.createIndexBuffer(a.indexArray,!1,!0),a.vertexBuffer=e.createVertexBuffer(a.vertexArray,bk.members,!1,!0),a.normalArray&&(a.normalBuffer=e.createVertexBuffer(a.normalArray,Sk.members,!1,!0)),a.texcoordArray&&(a.texcoordBuffer=e.createVertexBuffer(a.texcoordArray,Ek.members,!1,!0)),a.colorArray&&(a.colorBuffer=e.createVertexBuffer(a.colorArray,(a.colorArray.bytesPerElement===12?wk:Tk).members,!1,!0)),a.featureArray&&(a.pbrBuffer=e.createVertexBuffer(a.featureArray,Mk.members,!0)),a.segments=Hn.simpleSegment(0,0,a.vertexArray.length,a.indexArray.length);const c=a.material;c.pbrMetallicRoughness.baseColorTexture&&A_(c.pbrMetallicRoughness.baseColorTexture,e),c.pbrMetallicRoughness.metallicRoughnessTexture&&A_(c.pbrMetallicRoughness.metallicRoughnessTexture,e),c.normalTexture&&A_(c.normalTexture,e),c.occlusionTexture&&A_(c.occlusionTexture,e,s),c.emissionTexture&&A_(c.emissionTexture,e)}function _b(a,e,s){if(a.meshes)for(const c of a.meshes)Ck(c,e,s);if(a.children)for(const c of a.children)_b(c,e,s)}function v0(a){if(a.meshes)for(const e of a.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(a.children)for(const e of a.children)v0(e)}function gb(a){if(a.meshes)for(const s of a.meshes)s.vertexBuffer&&(s.vertexBuffer.destroy(),s.indexBuffer.destroy(),s.normalBuffer&&s.normalBuffer.destroy(),s.texcoordBuffer&&s.texcoordBuffer.destroy(),s.colorBuffer&&s.colorBuffer.destroy(),s.pbrBuffer&&s.pbrBuffer.destroy(),s.segments.destroy(),s.material&&((e=s.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(a.children)for(const s of a.children)gb(s)}class Lf{constructor(e,s,c){this._demTile=e,this._dem=this._demTile.dem,this._scale=s,this._offset=c}static create(e,s,c){const p=c||e.findDEMTileFor(s);if(!p||!p.dem)return;const u=p.dem,m=p.tileID,x=1<<s.canonical.z-m.canonical.z;return new Lf(p,u.dim/Lt/x,[(s.canonical.x/x-m.canonical.x)*u.dim,(s.canonical.y/x-m.canonical.y)*u.dim])}tileCoordToPixel(e,s){const c=s*this._scale+this._offset[1],p=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(c);return new Se(p,u)}getElevationAt(e,s,c,p){const u=e*this._scale+this._offset[0],m=s*this._scale+this._offset[1],x=Math.floor(u),S=Math.floor(m),P=this._dem;return p=!!p,c?di(di(P.get(x,S,p),P.get(x,S+1,p),m-S),di(P.get(x+1,S,p),P.get(x+1,S+1,p),m-S),u-x):P.get(x,S,p)}getElevationAtPixel(e,s,c){return this._dem.get(e,s,!!c)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ms(1,e)*this._dem.stride}}const yb=new Float32Array(262144),Lh=new Uint8Array(262144);function VA(a){let e=0;if(a.meshes)for(const s of a.meshes)e=Math.max(e,s.aabb.max[2]);if(a.children)for(const s of a.children)e=Math.max(e,VA(s));return e}function UA(a,e,s){if(a.meshes)for(const c of a.meshes){if(c.aabb.min[0]===1/0)continue;const p=ei.applyTransform(c.aabb,a.matrix);s.insert(e,p.min[0],p.min[1],p.max[0],p.max[1])}if(a.children)for(const c of a.children)UA(c,e,s)}const jA=["","wall","door","roof","window","lamp","logo"];class $A{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:VA(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new ei([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const s=new ei([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const c of this.node.meshes)this.node.lightMeshIndex!==e&&(c.transformedAabb=ei.applyTransformFast(c.aabb,this.node.matrix),s.encapsulate(c.transformedAabb)),e++;this.aabb=s}return this.aabb}}class x0{constructor(e,s,c,p,u,m,x){this.id=c,this.layers=e,this.layerIds=this.layers.map(S=>S.fqid),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.modelTraits|=Df.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,p&&(this.modelTraits|=Df.HasMapboxMeshFeatures),u&&(this.modelTraits|=Df.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const S of s)this.nodesInfo.push(new $A(S)),UA(S,x.featureIndexArray.length,x.grid),x.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,x.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,s){for(const c of this.getNodesInfo()){const p=c.node;p.footprint&&s.push({footprint:p.footprint,id:e})}}update(e){const s=Object.keys(e).length!==0;if(s&&!this.stateDependentLayers.length)return;const c=s?this.stateDependentLayers:this.layers;if(!bt(e,this.states))for(const p of c)this.evaluate(p,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const s=this.getNodesInfo();for(const c of s){const p=c.node;this.uploaded?this.updatePbrBuffer(p):_b(p,e,!0)}for(const c of s)v0(c.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let s=!1;if(!e.meshes)return s;for(const c of e.meshes)c.pbrBuffer&&(c.pbrBuffer.updateData(c.featureArray),s=!0);return s}needsReEvaluation(e,s,c){const p=e.transform.projectionOptions,u=e.style.getBrightness(),m=this.brightness!==u;if(!this.uploaded||this.dirty||p.name!==this.projection.name||M_(c.paint.get("model-color").value,m)||M_(c.paint.get("model-color-mix-intensity").value,m)||M_(c.paint.get("model-roughness").value,m)||M_(c.paint.get("model-emissive-strength").value,m)||M_(c.paint.get("model-height-based-emissive-strength-multiplier").value,m)){this.projection=p,this.brightness=u;const x=this.getNodesInfo();for(const S of x)S.state=null;return!0}return!1}evaluateScale(e,s){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const c=this.getNodesInfo(),p=this.id.canonical;for(const u of c){const m=u.feature;u.evaluatedScale=s.paint.get("model-scale").evaluate(m,{},p)}}evaluate(e,s){const c=this.getNodesInfo();for(const p of c){if(!p.node.meshes)continue;const u=p.feature,m=s&&s[u.id];if(bt(m,p.state))continue;p.state=structuredClone(m);const x=p.node.meshes&&p.node.meshes[0].featureData,S=p.evaluatedColor[2],P=p.evaluatedRMEA[2],y=this.id.canonical;if(p.hasTranslucentParts=!1,x){for(let A=0;A<jA.length;A++){const I=jA[A];I.length&&(u.properties.part=I);const E=e.paint.get("model-color").evaluate(u,m,y).toRenderColor(null),M=e.paint.get("model-color-mix-intensity").evaluate(u,m,y);p.evaluatedColor[A]=[E.r,E.g,E.b,M],p.evaluatedRMEA[A][0]=e.paint.get("model-roughness").evaluate(u,m,y),p.evaluatedRMEA[A][2]=e.paint.get("model-emissive-strength").evaluate(u,m,y),p.evaluatedRMEA[A][3]=E.a,p.emissionHeightBasedParams[A]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(u,m,y),!p.hasTranslucentParts&&E.a<1&&(p.hasTranslucentParts=!0)}delete u.properties.part,Pk(p,S!==p.evaluatedColor[2]||P!==p.evaluatedRMEA[2],this.modelTraits)}else p.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(u,m,y);p.evaluatedScale=e.paint.get("model-scale").evaluate(u,m,y),this.updatePbrBuffer(p.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,s,c,p){const u=e.findDEMTileFor(c);if(u&&(u.tileID.canonical!==this.terrainTile||s!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;const m=Lf.create(e,c,u);if(!m)return;this.modelTraits&Df.HasMapboxMeshFeatures&&this.updateDEM(e,m,c,p);for(const x of this.getNodesInfo()){const S=x.node;if(!S.footprint||!S.footprint.vertices||!S.footprint.vertices.length)continue;const P=S.footprint.vertices;let y=m.getElevationAt(P[0].x,P[0].y,!0,!0);for(let A=1;A<P.length;A++)y=Math.min(y,m.getElevationAt(P[A].x,P[A].y,!0,!0));S.elevation=y}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=s}}updateDEM(e,s,c,p){let u=s._dem._modifiedForSources[p];if(u===void 0&&(s._dem._modifiedForSources[p]=[],u=s._dem._modifiedForSources[p]),u.includes(c.canonical))return;const m=s._dem.dim;u.push(c.canonical);let x=!1;for(const S of this.getNodesInfo()){const P=S.node;if(!P.footprint||!P.footprint.grid)continue;const y=P.footprint.grid,A=s.tileCoordToPixel(y.min.x,y.min.y),I=s.tileCoordToPixel(y.max.x,y.max.y),E=Math.min(Math.min(m-I.y,A.x),Math.min(A.y,m-I.x));if(E<0)continue;const M=Ct(E,2,5);let R=Math.max(0,A.x-M),z=Math.max(0,A.y-M),F=Math.min(I.x+M,m-1),$=Math.min(I.y+M,m-1);for(let Y=z;Y<=$;++Y)for(let te=R;te<=F;++te)Lh[Y*m+te]=255;let H=0,V=0;for(let Y=0;Y<y.cellsY;++Y)for(let te=0;te<y.cellsX;++te){if(!y.cells[Y*y.cellsX+te])continue;const he=s.tileCoordToPixel(y.min.x+te/y.xScale,y.min.y+Y/y.yScale),ce=s.tileCoordToPixel(y.min.x+(te+1)/y.xScale,y.min.y+(Y+1)/y.yScale);for(let le=he.y;le<=Math.min(ce.y+1,m-1);++le)for(let Ee=he.x;Ee<=Math.min(ce.x+1,m-1);++Ee)Lh[le*m+Ee]===255&&(Lh[le*m+Ee]=0,H+=s.getElevationAtPixel(Ee,le),V++)}const G=H/V;R=Math.max(1,A.x-M),z=Math.max(1,A.y-M),F=Math.min(I.x+M,m-2),$=Math.min(I.y+M,m-2),x=!0;for(let Y=z;Y<=$;++Y)for(let te=R;te<=F;++te)Lh[Y*m+te]===0&&(yb[Y*m+te]=s._dem.set(te,Y,G));for(let Y=1;Y<M;++Y){R=Math.max(1,A.x-Y),z=Math.max(1,A.y-Y),F=Math.min(I.x+Y,m-2),$=Math.min(I.y+Y,m-2);for(let te=z;te<=$;++te)for(let he=R;he<=F;++he){const ce=te*m+he;if(Lh[ce]===255){let le=0,Ee=0,de=-1,Ae=-1;for(let Pe=-1;Pe<=1;++Pe)for(let Ce=-1;Ce<=1;++Ce){const ze=(te+Pe)*m+he+Ce;if(Lh[ze]>=Y)continue;const Ne=yb[ze],Ge=Math.abs(Ne);Ge>Ee&&(le=Ne,Ee=Ge,de=Ce,Ae=Pe)}if(Ee>.1){const Pe=1-(Y+.5*Math.abs(de*Ae))/M;let Ce=s._dem.get(he,te)+le*Pe;const ze=s._dem.get(he+de,te+Ae),Ne=s._dem.get(he-de,te-Ae,!0);(Ce-ze)*(Ce-Ne)>0&&(Ce=(ze+Ne)/2),yb[ce]=s._dem.set(he,te,Ce),Lh[ce]=Y}}}}}x&&(s._demTile.needsDEMTextureUpload=!0,s._dem._timestamp=ye.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const s of e)v0(s.node),gb(s.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,s){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const c=s.getReplacementRegionsForTile(e.toUnwrapped()),p=this.getNodesInfo();for(let u=0;u<this.nodesInfo.length;u++){const m=p[u].node;p[u].hiddenByReplacement=!!m.footprint&&!c.find(x=>x.footprint===m.footprint)}}getHeightAtTileCoord(e,s){const c=this.getNodesInfo(),p=[],u=[0,0,0],m=Le.mat4.identity([]);for(let x=0;x<this.nodesInfo.length;x++){const S=c[x],P=S.node.meshes[0],y=P.transformedAabb;if(e<y.min[0]||s<y.min[1]||e>y.max[0]||s>y.max[1])continue;if(S.node.hidden===!0)return{height:1/0,maxHeight:S.feature.properties.height,hidden:!1,verticalScale:S.evaluatedScale[2]};Le.mat4.invert(m,S.node.matrix),u[0]=e,u[1]=s,Le.vec3.transformMat4(u,u,m);const A=(u[0]-P.aabb.min[0])/(P.aabb.max[0]-P.aabb.min[0])*Dh|0,I=Math.min(63,(u[1]-P.aabb.min[1])/(P.aabb.max[1]-P.aabb.min[1])*Dh|0)*Dh+Math.min(63,A),E=P.heightmap[I];if(!(E<0&&S.node.footprint))return S.hiddenByReplacement?void 0:{height:E,maxHeight:S.feature.properties.height,hidden:!1,verticalScale:S.evaluatedScale[2]};if(S.node.footprint.grid.query(new Se(e,s),new Se(e,s),p),p.length>0)return{height:void 0,maxHeight:S.feature.properties.height,hidden:S.hiddenByReplacement,verticalScale:S.evaluatedScale[2]}}}}function M_(a,e){return!a.isLightConstant&&e}function Ik(a,e,s,c,p,u,m,x){let S=(61440&e|(61440&e)>>4)>>8,P=(3840&e|(3840&e)>>4)>>4,y=240&e|(240&e)>>4;s[3]>0&&(S=di(S,255*s[0],s[3]),P=di(P,255*s[1],s[3]),y=di(y,255*s[2],s[3]));const A=S<<8|P,I=y<<8|Math.floor(255*c[3]),E=function(Y){const te=Ct(Y,0,2);return Math.min(Math.round(.5*te*255),255)}(c[2])<<8|15*c[0]<<4|15*c[1],M=Ct(p[0],0,1),R=Ct(p[1],0,1),z=Ct(p[2],0,1),F=Ct(p[3],0,1);let $,H,V,G;if(M!==R&&m!==u&&R!==M){const Y=m-u;H=1/(Y*(R-M)),V=-(u+Y*M)/(Y*(R-M));const te=Ct(p[4],-1,1);G=Math.pow(10,te),$=255*z<<8|255*F}else $=65535,H=0,V=1,G=1;if(a.emplaceBack(A,I,E,$,H,V,G),x){const Y=x.length;x.clear();for(let te=0;te<Y;te++)x.emplaceBack(A,I,E,$,H,V,G)}}function Pk(a,e,s){const c=a.node;let p=0;const u=s&Df.HasMeshoptCompression;for(const m of c.meshes){if(c.lights&&c.lightMeshIndex===p||!m.featureData)continue;m.featureArray=new xh,m.featureArray.reserve(m.featureData.length);let x=e;for(const S of m.featureData){const P=u?65535&S:S>>16&65535,y=u?S>>16&65535:65535&S,A=(15&y)<8?15&y:0,I=a.evaluatedRMEA[A],E=a.evaluatedColor[A],M=a.emissionHeightBasedParams[A];let R;if(x&&A===2&&c.lights&&(R=new xh,R.resize(10*c.lights.length)),Ik(m.featureArray,P,E,I,M,m.aabb.min[2],m.aabb.max[2],R),R&&x){x=!1;const z=c.meshes[c.lightMeshIndex];z.featureArray=R,z.featureArray._trim()}}m.featureArray._trim(),p++}}function qA(a,e,s,c){const p=1<<a.z;e.lat=zr((c/Lt+a.y)/p),e.lng=Ps((s/Lt+a.x)/p)}Gt(x0,"Tiled3dModelBucket",{omit:["layers"]}),Gt($A,"Tiled3dModelFeature");const Rk={circle:class extends Mr{constructor(a,e,s,c){super(a,{layout:gt||(gt=new Dn({"circle-sort-key":new Vt(Ye.layout_circle["circle-sort-key"]),"circle-elevation-reference":new wt(Ye.layout_circle["circle-elevation-reference"]),visibility:new wt(Ye.layout_circle.visibility)})),paint:Ue||(Ue=new Dn({"circle-radius":new Vt(Ye.paint_circle["circle-radius"]),"circle-color":new Vt(Ye.paint_circle["circle-color"]),"circle-blur":new Vt(Ye.paint_circle["circle-blur"]),"circle-opacity":new Vt(Ye.paint_circle["circle-opacity"]),"circle-translate":new wt(Ye.paint_circle["circle-translate"]),"circle-translate-anchor":new wt(Ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new wt(Ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new wt(Ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Vt(Ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Vt(Ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Vt(Ye.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new wt(Ye.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,c)}createBucket(a){return new J(a)}queryRadius(a){const e=a;return ct("circle-radius",this,e)+ct("circle-stroke-width",this,e)+lt(this.paint.get("circle-translate"))}queryIntersectsFeature(a,e,s,c,p,u,m,x){const S=it(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,a.pixelToTileUnitsFactor),P=this.paint.get("circle-radius").evaluate(e,s)+this.paint.get("circle-stroke-width").evaluate(e,s);return Ef(a,c,u,m,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",S,P)}getProgramIds(){return["circle"]}getDefaultProgramParams(a,e,s){const c=Wc(this);return{config:new Wl(this,{zoom:e,lut:s}),defines:c,overrideFog:!1}}},heatmap:class extends Mr{createBucket(a){return new wE(a)}constructor(a,e,s,c){super(a,{layout:TE||(TE=new Dn({visibility:new wt(Ye.layout_heatmap.visibility)})),paint:EE||(EE=new Dn({"heatmap-radius":new Vt(Ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Vt(Ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new wt(Ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Nc(Ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new wt(Ye.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=s_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return ct("heatmap-radius",this,a)}queryIntersectsFeature(a,e,s,c,p,u,m,x){const S=this.paint.get("heatmap-radius").evaluate(e,s);return Ef(a,c,u,m,x,!0,!0,new Se(0,0),S)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(a,e,s){return a==="heatmap"?{config:new Wl(this,{zoom:e,lut:s}),overrideFog:!1}:{}}},hillshade:class extends Mr{constructor(a,e,s,c){super(a,{layout:SE||(SE=new Dn({visibility:new wt(Ye.layout_hillshade.visibility)})),paint:AE||(AE=new Dn({"hillshade-illumination-direction":new wt(Ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new wt(Ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new wt(Ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new wt(Ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new wt(Ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new wt(Ye.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new wt(Ye.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,c)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(a,e,s){return{overrideFog:!1}}},fill:class extends Mr{constructor(a,e,s,c){super(a,{layout:zE||(zE=new Dn({"fill-sort-key":new Vt(Ye.layout_fill["fill-sort-key"]),visibility:new wt(Ye.layout_fill.visibility),"fill-elevation-reference":new wt(Ye.layout_fill["fill-elevation-reference"])})),paint:kE||(kE=new Dn({"fill-antialias":new wt(Ye.paint_fill["fill-antialias"]),"fill-opacity":new Vt(Ye.paint_fill["fill-opacity"]),"fill-color":new Vt(Ye.paint_fill["fill-color"]),"fill-outline-color":new Vt(Ye.paint_fill["fill-outline-color"]),"fill-translate":new wt(Ye.paint_fill["fill-translate"]),"fill-translate-anchor":new wt(Ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new Vt(Ye.paint_fill["fill-pattern"]),"fill-emissive-strength":new wt(Ye.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Vt(Ye.paint_fill["fill-z-offset"]),"fill-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,c)}getProgramIds(){const a=this.paint.get("fill-pattern"),e=a&&a.constantOr(1),s=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getDefaultProgramParams(a,e,s){return{config:new Wl(this,{zoom:e,lut:s}),overrideFog:!1}}recalculate(a,e){super.recalculate(a,e);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Ox(a)}queryRadius(){return lt(this.paint.get("fill-translate"))}queryIntersectsFeature(a,e,s,c,p,u){return!a.queryGeometry.isAboveHorizon&&Q($e(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,a.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends Mr{constructor(a,e,s,c){super(a,{layout:gS||(gS=new Dn({visibility:new wt(Ye["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new wt(Ye["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:yS||(yS=new Dn({"fill-extrusion-opacity":new wt(Ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new wt(Ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new wt(Ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new wt(Ye["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new wt(Ye["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new wt(Ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new wt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new wt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new wt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new wt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new wt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new wt(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new wt(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new wt(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new wt(Ye["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new wt(Ye["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new wt(Ye["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Vt(Ye["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new wt(Ye["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new Ky(a)}queryRadius(){return lt(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(a,e,s,c,p,u,m,x,S){const P=it(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,a.pixelToTileUnitsFactor),y=this.paint.get("fill-extrusion-height").evaluate(e,s),A=this.paint.get("fill-extrusion-base").evaluate(e,s),I=[0,0],E=x&&u.elevation,M=u.elevation?u.elevation.exaggeration():1,R=a.tile.getBucket(this);if(E&&R instanceof Ky){const V=R.centroidVertexArray,G=S+1;G<V.length&&(I[0]=V.geta_centroid_pos0(G),I[1]=V.geta_centroid_pos1(G))}if(I[0]===0&&I[1]===1)return!1;u.projection.name==="globe"&&(c=_S([c],[new Se(0,0),new Se(Lt,Lt)],a.tileID.canonical).map(V=>V.polygon).flat());const z=E?x:null,[F,$]=function(V,G,Y,te,he,ce,le,Ee,de,Ae,Pe){return V.projection.name==="globe"?function(Ce,ze,Ne,Ge,Fe,at,mt,ot,zt,Rt,xt){const _t=[],Yt=[],Ft=Ce.projection.upVectorScale(xt,Ce.center.lat,Ce.worldSize).metersToTile,jt=[0,0,0,1],mi=[0,0,0,1],Ei=(Ci,Di,zi,_n)=>{Ci[0]=Di,Ci[1]=zi,Ci[2]=_n,Ci[3]=1},Mi=mS();Ne>0&&(Ne+=Mi),Ge+=Mi;for(const Ci of ze){const Di=[],zi=[];for(const _n of Ci){const hn=_n.x+Fe.x,bi=_n.y+Fe.y,sn=Ce.projection.projectTilePoint(hn,bi,xt),an=Ce.projection.upVector(xt,_n.x,_n.y);let Mn=Ne,Yn=Ge;if(mt){const cr=xS(hn,bi,Ne,Ge,mt,ot,zt,Rt);Mn+=cr.base,Yn+=cr.top}Ne!==0?Ei(jt,sn.x+an[0]*Ft*Mn,sn.y+an[1]*Ft*Mn,sn.z+an[2]*Ft*Mn):Ei(jt,sn.x,sn.y,sn.z),Ei(mi,sn.x+an[0]*Ft*Yn,sn.y+an[1]*Ft*Yn,sn.z+an[2]*Ft*Yn),Le.vec3.transformMat4(jt,jt,at),Le.vec3.transformMat4(mi,mi,at),Di.push(new Rh(jt[0],jt[1],jt[2])),zi.push(new Rh(mi[0],mi[1],mi[2]))}_t.push(Di),Yt.push(zi)}return[_t,Yt]}(V,G,Y,te,he,ce,le,Ee,de,Ae,Pe):le?function(Ce,ze,Ne,Ge,Fe,at,mt,ot,zt){const Rt=[],xt=[],_t=[0,0,0,1];for(const Yt of Ce){const Ft=[],jt=[];for(const mi of Yt){const Ei=mi.x+Ge.x,Mi=mi.y+Ge.y,Ci=xS(Ei,Mi,ze,Ne,at,mt,ot,zt);_t[0]=Ei,_t[1]=Mi,_t[2]=Ci.base,_t[3]=1,Le.vec4.transformMat4(_t,_t,Fe),_t[3]=Math.max(_t[3],1e-5);const Di=new Rh(_t[0]/_t[3],_t[1]/_t[3],_t[2]/_t[3]);_t[0]=Ei,_t[1]=Mi,_t[2]=Ci.top,_t[3]=1,Le.vec4.transformMat4(_t,_t,Fe),_t[3]=Math.max(_t[3],1e-5);const zi=new Rh(_t[0]/_t[3],_t[1]/_t[3],_t[2]/_t[3]);Ft.push(Di),jt.push(zi)}Rt.push(Ft),xt.push(jt)}return[Rt,xt]}(G,Y,te,he,ce,le,Ee,de,Ae):function(Ce,ze,Ne,Ge,Fe){const at=[],mt=[],ot=Fe[8]*ze,zt=Fe[9]*ze,Rt=Fe[10]*ze,xt=Fe[11]*ze,_t=Fe[8]*Ne,Yt=Fe[9]*Ne,Ft=Fe[10]*Ne,jt=Fe[11]*Ne;for(const mi of Ce){const Ei=[],Mi=[];for(const Ci of mi){const Di=Ci.x+Ge.x,zi=Ci.y+Ge.y,_n=Fe[0]*Di+Fe[4]*zi+Fe[12],hn=Fe[1]*Di+Fe[5]*zi+Fe[13],bi=Fe[2]*Di+Fe[6]*zi+Fe[14],sn=Fe[3]*Di+Fe[7]*zi+Fe[15],an=_n+ot,Mn=hn+zt,Yn=bi+Rt,cr=Math.max(sn+xt,1e-5),Kn=_n+_t,Un=hn+Yt,nr=bi+Ft,_r=Math.max(sn+jt,1e-5);Ei.push(new Rh(an/cr,Mn/cr,Yn/cr)),Mi.push(new Rh(Kn/_r,Un/_r,nr/_r))}at.push(Ei),mt.push(Mi)}return[at,mt]}(G,Y,te,he,ce)}(u,c,A,y,P,m,z,I,M,u.center.lat,a.tileID.canonical),H=a.queryGeometry;return function(V,G,Y){let te=1/0;Q(Y,G)&&(te=vS(Y,G[0]));for(let he=0;he<G.length;he++){const ce=G[he],le=V[he];for(let Ee=0;Ee<ce.length-1;Ee++){const de=ce[Ee],Ae=[de,ce[Ee+1],le[Ee+1],le[Ee],de];X(Y,Ae)&&(te=Math.min(te,vS(Y,Ae)))}}return te!==1/0&&te}(F,$,H.isPointQuery()?H.screenBounds:H.screenGeometry)}},line:class extends Mr{constructor(a,e,s,c){const p=PS();super(a,p,e,s,c),p.layout&&(this.layout=new Fc(p.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Mc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,e){super.recalculate(a,e),this.paint._values["line-floorwidth"]=(()=>{if(p_)return p_;const s=PS();return p_=new Oz(s.paint.properties["line-width"].specification),p_.useIntegerZoom=!0,p_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new qx(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(a,e,s){const c=CS(this);return{config:new Wl(this,{zoom:e,lut:s}),defines:c,overrideFog:!1}}queryRadius(a){const e=a,s=RS(ct("line-width",this,e),ct("line-gap-width",this,e)),c=ct("line-offset",this,e);return s/2+Math.abs(c)+lt(this.paint.get("line-translate"))}queryIntersectsFeature(a,e,s,c,p,u){if(a.queryGeometry.isAboveHorizon)return!1;const m=$e(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,a.pixelToTileUnitsFactor),x=a.pixelToTileUnitsFactor/2*RS(this.paint.get("line-width").evaluate(e,s),this.paint.get("line-gap-width").evaluate(e,s)),S=this.paint.get("line-offset").evaluate(e,s);return S&&(c=function(P,y){const A=[],I=new Se(0,0);for(let E=0;E<P.length;E++){const M=P[E],R=[];for(let z=0;z<M.length;z++){const F=M[z],$=M[z+1],H=z===0?I:F.sub(M[z-1])._unit()._perp(),V=z===M.length-1?I:$.sub(F)._unit()._perp(),G=H._add(V)._unit();G._mult(1/(G.x*V.x+G.y*V.y)),R.push(G._mult(y)._add(F))}A.push(R)}return A}(c,S*a.pixelToTileUnitsFactor)),function(P,y,A){for(let I=0;I<y.length;I++){const E=y[I];if(P.length>=3){for(let M=0;M<E.length;M++)if(_e(P,E[M]))return!0}if(ae(P,E,A))return!0}return!1}(m,c,x)}isTileClipped(){return!0}isDraped(a){return!this.hasElevatedBuckets}},symbol:d0,background:class extends Mr{constructor(a,e,s,c){super(a,{layout:mA||(mA=new Dn({visibility:new wt(Ye.layout_background.visibility)})),paint:_A||(_A=new Dn({"background-pitch-alignment":new wt(Ye.paint_background["background-pitch-alignment"]),"background-color":new wt(Ye.paint_background["background-color"]),"background-pattern":new wt(Ye.paint_background["background-pattern"]),"background-opacity":new wt(Ye.paint_background["background-opacity"]),"background-emissive-strength":new wt(Ye.paint_background["background-emissive-strength"]),"background-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,c)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(a,e,s){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:bA,"raster-particle":MA,sky:class extends Mr{constructor(a,e,s,c){super(a,{layout:EA||(EA=new Dn({visibility:new wt(Ye.layout_sky.visibility)})),paint:SA||(SA=new Dn({"sky-type":new wt(Ye.paint_sky["sky-type"]),"sky-atmosphere-sun":new wt(Ye.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new wt(Ye.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new wt(Ye.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new wt(Ye.paint_sky["sky-gradient-radius"]),"sky-gradient":new Nc(Ye.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new wt(Ye.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new wt(Ye.paint_sky["sky-atmosphere-color"]),"sky-opacity":new wt(Ye.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=s_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(a,e){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),p=!c,u=a.style.light,m=u.properties.get("position");return p&&u.properties.get("anchor")==="viewport"&&Ti("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?db(m.azimuthal,90-m.polar,e):db(c[0],90-c[1],e)}const s=this.paint.get("sky-gradient-center");return db(s[0],90-s[1],e)}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}},slot:class extends Mr{constructor(a,e,s,c){super(a,{paint:AA||(AA=new Dn({}))},e,null)}},model:class extends Mr{constructor(a,e,s,c){super(a,{layout:FA||(FA=new Dn({visibility:new wt(Ye.layout_model.visibility),"model-id":new Vt(Ye.layout_model["model-id"])})),paint:NA||(NA=new Dn({"model-opacity":new Vt(Ye.paint_model["model-opacity"]),"model-rotation":new Vt(Ye.paint_model["model-rotation"]),"model-scale":new Vt(Ye.paint_model["model-scale"]),"model-translation":new Vt(Ye.paint_model["model-translation"]),"model-color":new Vt(Ye.paint_model["model-color"]),"model-color-mix-intensity":new Vt(Ye.paint_model["model-color-mix-intensity"]),"model-type":new wt(Ye.paint_model["model-type"]),"model-cast-shadows":new wt(Ye.paint_model["model-cast-shadows"]),"model-receive-shadows":new wt(Ye.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new wt(Ye.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Vt(Ye.paint_model["model-emissive-strength"]),"model-roughness":new Vt(Ye.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Vt(Ye.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new wt(Ye.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new wt(Ye.paint_model["model-front-cutoff"]),"model-color-use-theme":new Vt({type:"string",default:"default","property-type":"data-driven"})}))},e,s,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new mb(a)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(a){return a instanceof x0?Lt-1:0}queryIntersectsFeature(a,e,s,c,p,u){if(!this.modelManager)return!1;const m=this.modelManager,x=a.tile.getBucket(this);if(!(x&&x instanceof mb))return!1;for(const S in x.instancesPerModel){const P=x.instancesPerModel[S],y=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(P.idToFeaturesIndex.hasOwnProperty(y)){const A=P.features[P.idToFeaturesIndex[y]],I=m.getModel(S,this.scope);if(!I)return!1;let E=Le.mat4.create();const M=new Xi(0,0),R=x.canonical;let z=Number.MAX_VALUE;for(let F=0;F<A.instancedDataCount;++F){const $=16*(A.instancedDataOffset+F),H=P.instancedDataArray.float32,V=[H[$+4],H[$+5],H[$+6]];qA(R,M,H[$],0|H[$+1]),BA(E,I,u,M,A.rotation,A.scale,V,!1,!1,!1),u.projection.name==="globe"&&(E=pb(E,u));const G=Le.mat4.multiply([],u.projMatrix,E),Y=a.queryGeometry,te=DA(Y.isPointQuery()?Y.screenBounds:Y.screenGeometry,u,G,I.aabb);te!=null&&(z=Math.min(te,z))}return z!==Number.MAX_VALUE&&z}}return!1}_handleOverridablePaintPropertyUpdate(a,e,s){return!(!this.layout||e.isDataDriven()||s.isDataDriven()||a!=="model-color"&&a!=="model-color-mix-intensity"&&a!=="model-rotation"&&a!=="model-scale"&&a!=="model-translation"&&a!=="model-emissive-strength")}_isPropertyZoomDependent(a){const e=this._transitionablePaint._values[a];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof lh}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Mr{constructor(a,e,s,c){super(a,{layout:FE||(FE=new Dn({"clip-layer-types":new wt(Ye.layout_clip["clip-layer-types"]),"clip-layer-scope":new wt(Ye.layout_clip["clip-layer-scope"])})),paint:NE||(NE=new Dn({}))},e,s,c)}recalculate(a,e){super.recalculate(a,e)}createBucket(a){return new BE(a)}isTileClipped(){return!0}is3D(){return!0}}};class Dk{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Lk{constructor(){this.tasks={},this.taskQueue=[],Ur(["process"],this),this.invoker=new Dk(this.process),this.nextId=0}add(e,s){const c=this.nextId++,p=function({type:u,isSymbolTile:m,zoom:x}){return x=x||0,u==="message"?0:u!=="maybePrepare"||m?u!=="parseTile"||m?u==="parseTile"&&m?300-x:u==="maybePrepare"&&m?400-x:500:200-x:100-x}(s);if(p===0){try{e()}finally{}return null}return this.tasks[c]={fn:e,metadata:s,priority:p,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const s=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let e=null,s=1/0;for(let p=0;p<this.taskQueue.length;p++){const u=this.tasks[this.taskQueue[p]];u.priority<s&&(s=u.priority,e=p)}if(e===null)return null;const c=this.taskQueue[e];return this.taskQueue.splice(e,1),c}remove(){this.invoker.remove()}}class HA{constructor(e,s,c){this.target=e,this.parent=s,this.mapId=c,this.callbacks={},this.cancelCallbacks={},Ur(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Lk}send(e,s,c,p,u=!1,m){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=m,this.callbacks[x]=c);const S=new Set;return this.target.postMessage({id:x,type:e,hasCallback:!!c,targetMapId:p,mustQueue:u,sourceMapId:this.mapId,data:sl(s,S)},S),{cancel:()=>{c&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(e){const s=e.data,c=s.id;if(c&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){const p=this.cancelCallbacks[c];delete this.cancelCallbacks[c],p&&p.cancel()}else if(s.mustQueue||Ca()){const p=this.callbacks[c],u=this.scheduler.add(()=>this.processTask(c,s),p&&p.metadata||{type:"message"});u&&(this.cancelCallbacks[c]=u)}else this.processTask(c,s)}processTask(e,s){if(delete this.cancelCallbacks[e],s.type==="<response>"){const c=this.callbacks[e];delete this.callbacks[e],c&&(s.error?c(jl(s.error)):c(null,jl(s.data)))}else{const c=new Set,p=s.hasCallback?(m,x)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:m?sl(m):null,data:sl(x,c)},c)}:()=>{},u=jl(s.data);if(this.parent[s.type])this.parent[s.type](s.sourceMapId,u,p);else if(this.parent.getWorkerSource){const m=s.type.split(".");this.parent.getWorkerSource(s.sourceMapId,m[0],u.source,u.scope)[m[1]](u,p)}else p(new Error(`Could not find function ${s.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var C_={workerUrl:"",workerClass:null,workerParams:void 0};const vb="mapboxgl_preloaded_worker_pool";class Oh{constructor(){this.active={}}acquire(e,s=Oh.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<s;)this.workers.push(C_.workerClass!=null?new C_.workerClass:new self.Worker(C_.workerUrl,C_.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[vb]}numActive(){return Object.keys(this.active).length}}Oh.workerCount=2;class Of{constructor(e,s,c="Worker",p=Oh.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=xr();const u=this.workerPool.acquire(this.id,p);for(let m=0;m<u.length;m++){const x=new Of.Actor(u[m],s,this.id);x.name=`${c} ${m}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,s,c){Gi(this.actors,(p,u)=>{p.send(e,s,u)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let I_,xb;function b0(){return I_||(I_=new Oh),I_}Of.Actor=HA;const bb=new Qi(0,0,0);var wb=(a=>(a[a.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",a[a.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",a[a.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",a))(wb||{}),w0=(a=>(a[a.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",a[a.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",a[a.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",a[a.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",a))(w0||{}),P_=(a=>(a[a.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",a[a.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",a[a.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",a[a.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",a[a.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",a))(P_||{}),GA=(a=>(a[a.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",a[a.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",a[a.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",a))(GA||{}),zf=(a=>(a[a.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",a[a.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",a[a.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",a[a.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",a[a.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",a[a.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",a))(zf||{}),WA=(a=>(a[a.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",a[a.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",a[a.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",a))(WA||{});function Ok(a,e,s){a===1&&e.icons.push(function(c,p){return function(u){if(u.usvg_tree.height||(u.usvg_tree.height=u.usvg_tree.width),!u.metadata)return u;const{metadata:m}=u;if(m.content_area){const{content_area:x}=m;x.top==null&&(x.top=x.left),x.width==null&&(x.width=u.usvg_tree.width),x.height==null&&(x.height=x.width)}return m.stretch_x&&m.stretch_x.length&&ZA(m,"x"),m.stretch_y&&m.stretch_y.length&&ZA(m,"y"),u}(c.readFields(zk,{name:void 0},p))}(s,s.readVarint()+s.pos))}function ZA(a,e){const s=[],c=a[`stretch_${e}`];let p=null;for(let u=0;u<c.length;u++)p===null?p=s.length===0?c[0]:s[s.length-1][1]+c[u]:(s.push([p,p+c[u]]),p=null);a[`stretch_${e}_areas`]=s}function zk(a,e,s){a===1?e.name=s.readString():a===2?e.metadata=function(c,p){return c.readFields(kk,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},p)}(s,s.readVarint()+s.pos):a===3&&(e.usvg_tree=function(c,p){return c.readFields(Bk,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},p)}(s,s.readVarint()+s.pos),e.data="usvg_tree")}function kk(a,e,s){a===1?e.stretch_x=s.readPackedVarint():a===2?e.stretch_y=s.readPackedVarint():a===3?e.content_area=function(c,p){return c.readFields(Fk,{left:0},p)}(s,s.readVarint()+s.pos):a===4&&e.variables.push(function(c,p){return c.readFields(Nk,{name:void 0},p)}(s,s.readVarint()+s.pos))}function Fk(a,e,s){a===1?e.left=s.readVarint():a===2?e.width=s.readVarint():a===3?e.top=s.readVarint():a===4&&(e.height=s.readVarint())}function Nk(a,e,s){a===1?e.name=s.readString():a===2&&(e.rgb_color=S0(s.readVarint()),e.value="rgb_color")}function Bk(a,e,s){a===1?e.width=e.height=s.readVarint():a===2?e.height=s.readVarint():a===3?e.children.push(T0(s,s.readVarint()+s.pos)):a===4?e.linear_gradients.push(function(c,p){return c.readFields(Gk,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},p)}(s,s.readVarint()+s.pos)):a===5?e.radial_gradients.push(function(c,p){return c.readFields(Zk,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},p)}(s,s.readVarint()+s.pos)):a===7?e.clip_paths.push(function(c,p){return c.readFields(Xk,{children:[]},p)}(s,s.readVarint()+s.pos)):a===8&&e.masks.push(function(c,p){const u=c.readFields(Yk,{left:0,width:20,mask_type:1,children:[]},p);return u.height==null&&(u.height=u.width),u.top==null&&(u.top=u.left),u}(s,s.readVarint()+s.pos))}function T0(a,e){return a.readFields(Vk,{},e)}function Vk(a,e,s){a===1?(e.group=function(c,p){return c.readFields(Uk,{opacity:255,children:[]},p)}(s,s.readVarint()+s.pos),e.node="group"):a===2&&(e.path=function(c,p){return c.readFields($k,{paint_order:1,commands:[],step:1,diffs:[],rule:1},p)}(s,s.readVarint()+s.pos),e.node="path")}function Uk(a,e,s){a===1?e.transform=E0(s,s.readVarint()+s.pos):a===2?e.opacity=s.readVarint():a===5?e.clip_path_idx=s.readVarint():a===6?e.mask_idx=s.readVarint():a===7&&e.children.push(T0(s,s.readVarint()+s.pos))}function E0(a,e){return a.readFields(jk,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function jk(a,e,s){a===1?e.sx=s.readFloat():a===2?e.ky=s.readFloat():a===3?e.kx=s.readFloat():a===4?e.sy=s.readFloat():a===5?e.tx=s.readFloat():a===6&&(e.ty=s.readFloat())}function $k(a,e,s){a===1?e.fill=function(c,p){return c.readFields(qk,{rgb_color:bb,paint:"rgb_color",opacity:255},p)}(s,s.readVarint()+s.pos):a===2?e.stroke=function(c,p){return c.readFields(Hk,{rgb_color:bb,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},p)}(s,s.readVarint()+s.pos):a===3?e.paint_order=s.readVarint():a===5?s.readPackedVarint(e.commands):a===6?e.step=s.readFloat():a===7?s.readPackedSVarint(e.diffs):a===8&&(e.rule=s.readVarint())}function qk(a,e,s){a===1?(e.rgb_color=S0(s.readVarint()),e.paint="rgb_color"):a===2?(e.linear_gradient_idx=s.readVarint(),e.paint="linear_gradient_idx"):a===3?(e.radial_gradient_idx=s.readVarint(),e.paint="radial_gradient_idx"):a===5&&(e.opacity=s.readVarint())}function S0(a){return new Qi((a>>16&255)/255,(a>>8&255)/255,(255&a)/255,1)}function Hk(a,e,s){a===1?(e.rgb_color=S0(s.readVarint()),e.paint="rgb_color"):a===2?(e.linear_gradient_idx=s.readVarint(),e.paint="linear_gradient_idx"):a===3?(e.radial_gradient_idx=s.readVarint(),e.paint="radial_gradient_idx"):a===5?s.readPackedFloat(e.dasharray):a===6?e.dashoffset=s.readFloat():a===7?e.miterlimit=s.readFloat():a===8?e.opacity=s.readVarint():a===9?e.width=s.readFloat():a===10?e.linecap=s.readVarint():a===11&&(e.linejoin=s.readVarint())}function Gk(a,e,s){a===1?e.transform=E0(s,s.readVarint()+s.pos):a===2?e.spread_method=s.readVarint():a===3?e.stops.push(XA(s,s.readVarint()+s.pos)):a===4?e.x1=s.readFloat():a===5?e.y1=s.readFloat():a===6?e.x2=s.readFloat():a===7&&(e.y2=s.readFloat())}function XA(a,e){return a.readFields(Wk,{offset:0,opacity:255,rgb_color:bb},e)}function Wk(a,e,s){a===1?e.offset=s.readFloat():a===2?e.opacity=s.readVarint():a===3&&(e.rgb_color=S0(s.readVarint()))}function Zk(a,e,s){a===1?e.transform=E0(s,s.readVarint()+s.pos):a===2?e.spread_method=s.readVarint():a===3?e.stops.push(XA(s,s.readVarint()+s.pos)):a===4?e.cx=s.readFloat():a===5?e.cy=s.readFloat():a===6?e.r=s.readFloat():a===7?e.fx=s.readFloat():a===8?e.fy=s.readFloat():a===9&&(e.fr=s.readFloat())}function Xk(a,e,s){a===1?e.transform=E0(s,s.readVarint()+s.pos):a===2?e.clip_path_idx=s.readVarint():a===3&&e.children.push(T0(s,s.readVarint()+s.pos))}function Yk(a,e,s){a===1?e.left=e.top=s.readFloat():a===2?e.width=e.height=s.readFloat():a===3?e.top=s.readFloat():a===4?e.height=s.readFloat():a===5?e.mask_type=s.readVarint():a===6?e.mask_idx=s.readVarint():a===7&&e.children.push(T0(s,s.readVarint()+s.pos))}class Kk{static calculate(e,s){const c=new Map,p=new Map;if(Object.keys(e).length===0)return c;s.forEach(u=>{p.set(u.name,u.rgb_color||new Qi(0,0,0))});for(const[u,m]of Object.entries(e))p.has(u)?c.set(p.get(u).toStringPremultipliedAlpha(),m):console.warn(`Ignoring unknown image variable "${u}"`);return c}}function kf(a,e=255,s){const c=e/255,p=a.toStringPremultipliedAlpha(),u=s.has(p)?s.get(p).clone():a.clone();return u.a=c,u.toString()}function R_(a,e){if(!oe()){const s=document.createElement("canvas");return s.width=a,s.height=e,s}return new OffscreenCanvas(a,e)}function Jk(a,e){const s=Kk.calculate(e.params,a.metadata?a.metadata.variables:[]),c=a.usvg_tree,p=c.width,u=c.height,m=e.transform?e.transform:new DOMMatrix,x=Math.max(1,Math.round(p*m.a)),S=Math.max(1,Math.round(u*m.d)),P=new DOMMatrix([x/p,0,0,S/u,0,0]),y=R_(x,S).getContext("2d");return Tb(y,P,c,c,s),y.getImageData(0,0,x,S)}function Tb(a,e,s,c,p){for(const u of c.children)YA(a,e,s,u,p)}function YA(a,e,s,c,p){c.group?(a.save(),function(u,m,x,S,P){const y=S.mask_idx!=null?x.masks[S.mask_idx]:null,A=S.clip_path_idx!=null?x.clip_paths[S.clip_path_idx]:null;if(S.transform&&(m=A0(S.transform).preMultiplySelf(m)),!function(M,R,z){return M.opacity!==255||R||z}(S,A!=null,y!=null))return void Tb(u,m,x,S,P);const I=R_(u.canvas.width,u.canvas.height),E=I.getContext("2d");Tb(E,m,x,S,P),A&&nM(E,m,x,A),y&&rM(E,m,x,y,P),u.globalAlpha=S.opacity/255,u.drawImage(I,0,0)}(a,e,s,c.group,p),a.restore()):c.path&&(a.save(),function(u,m,x,S,P){const y=sM(S);u.setTransform(m),S.paint_order===GA.PAINT_ORDER_FILL_AND_STROKE?(KA(u,x,S,y,P),QA(u,x,S,y,P)):(QA(u,x,S,y,P),KA(u,x,S,y,P))}(a,e,s,c.path,p),a.restore())}function KA(a,e,s,c,p){const u=s.fill;if(!u)return;const m=u.opacity/255;switch(u.paint){case"rgb_color":a.fillStyle=kf(u.rgb_color,u.opacity,p);break;case"linear_gradient_idx":a.fillStyle=eM(a,e.linear_gradients[u.linear_gradient_idx],m,p);break;case"radial_gradient_idx":a.fillStyle=tM(a,e.radial_gradients[u.radial_gradient_idx],m,p)}a.fill(c,JA(s))}function JA(a){return a.rule===wb.PATH_RULE_NON_ZERO?"nonzero":a.rule===wb.PATH_RULE_EVEN_ODD?"evenodd":void 0}function QA(a,e,s,c,p){const u=s.stroke;if(!u)return;a.lineWidth=u.width,a.miterLimit=u.miterlimit,a.setLineDash(u.dasharray),a.lineDashOffset=u.dashoffset;const m=u.opacity/255;switch(u.paint){case"rgb_color":a.strokeStyle=kf(u.rgb_color,u.opacity,p);break;case"linear_gradient_idx":a.strokeStyle=eM(a,e.linear_gradients[u.linear_gradient_idx],m,p);break;case"radial_gradient_idx":a.strokeStyle=tM(a,e.radial_gradients[u.radial_gradient_idx],m,p)}switch(u.linejoin){case P_.LINE_JOIN_MITER_CLIP:case P_.LINE_JOIN_MITER:a.lineJoin="miter";break;case P_.LINE_JOIN_ROUND:a.lineJoin="round";break;case P_.LINE_JOIN_BEVEL:a.lineJoin="bevel"}switch(u.linecap){case w0.LINE_CAP_BUTT:a.lineCap="butt";break;case w0.LINE_CAP_ROUND:a.lineCap="round";break;case w0.LINE_CAP_SQUARE:a.lineCap="square"}a.stroke(c)}function eM(a,e,s,c){if(e.stops.length===1){const I=e.stops[0];return kf(I.rgb_color,I.opacity*s,c)}const p=A0(e.transform),{x1:u,y1:m,x2:x,y2:S}=e,P=p.transformPoint(new DOMPoint(u,m)),y=p.transformPoint(new DOMPoint(x,S)),A=a.createLinearGradient(P.x,P.y,y.x,y.y);for(const I of e.stops)A.addColorStop(I.offset,kf(I.rgb_color,I.opacity*s,c));return A}function tM(a,e,s,c){if(e.stops.length===1){const I=e.stops[0];return kf(I.rgb_color,I.opacity*s,c)}const p=A0(e.transform),{fx:u,fy:m,cx:x,cy:S}=e,P=p.transformPoint(new DOMPoint(u,m)),y=p.transformPoint(new DOMPoint(x,S)),A=a.createRadialGradient(P.x,P.y,0,y.x,y.y,e.r*((p.a+p.d)/2));for(const I of e.stops)A.addColorStop(I.offset,kf(I.rgb_color,I.opacity*s,c));return A}function iM(a,e,s,c){const p=c.transform?A0(c.transform).preMultiplySelf(e):e,u=R_(a.canvas.width,a.canvas.height),m=u.getContext("2d");for(const S of c.children)if(S.group)iM(m,p,s,S.group);else if(S.path){const P=S.path,y=new Path2D;y.addPath(sM(P),p),m.fill(y,JA(P))}const x=c.clip_path_idx!=null?s.clip_paths[c.clip_path_idx]:null;x&&nM(m,p,s,x),a.globalCompositeOperation="source-over",a.drawImage(u,0,0)}function nM(a,e,s,c){const p=R_(a.canvas.width,a.canvas.height);iM(p.getContext("2d"),e,s,c),a.globalCompositeOperation="destination-in",a.drawImage(p,0,0)}function rM(a,e,s,c,p){if(c.children.length===0)return;const u=c.mask_idx!=null?s.masks[c.mask_idx]:null;u&&rM(a,e,s,u,p);const m=a.canvas.width,x=a.canvas.height,S=R_(m,x),P=S.getContext("2d"),y=c.width,A=c.height,I=c.left,E=c.top,M=new Path2D,R=new Path2D;R.rect(I,E,y,A),M.addPath(R,e),P.clip(M);for(const $ of c.children)YA(P,e,s,$,p);const z=P.getImageData(0,0,m,x),F=z.data;if(c.mask_type===WA.MASK_TYPE_LUMINANCE)for(let $=0;$<F.length;$+=4)F[$+3]=F[$+3]/255*(.2126*F[$]+.7152*F[$+1]+.0722*F[$+2]);P.putImageData(z,0,0),a.globalCompositeOperation="destination-in",a.drawImage(S,0,0)}function A0(a){return a?new DOMMatrix([a.sx,a.ky,a.kx,a.sy,a.tx,a.ty]):new DOMMatrix}function sM(a){const e=new Path2D,s=a.step;let c=a.diffs[0]*s,p=a.diffs[1]*s;e.moveTo(c,p);for(let u=0,m=2;u<a.commands.length;u++)switch(a.commands[u]){case zf.PATH_COMMAND_MOVE:c+=a.diffs[m++]*s,p+=a.diffs[m++]*s,e.moveTo(c,p);break;case zf.PATH_COMMAND_LINE:c+=a.diffs[m++]*s,p+=a.diffs[m++]*s,e.lineTo(c,p);break;case zf.PATH_COMMAND_QUAD:{const x=c+a.diffs[m++]*s,S=p+a.diffs[m++]*s;c=x+a.diffs[m++]*s,p=S+a.diffs[m++]*s,e.quadraticCurveTo(x,S,c,p);break}case zf.PATH_COMMAND_CUBIC:{const x=c+a.diffs[m++]*s,S=p+a.diffs[m++]*s,P=x+a.diffs[m++]*s,y=S+a.diffs[m++]*s;c=P+a.diffs[m++]*s,p=y+a.diffs[m++]*s,e.bezierCurveTo(x,S,P,y,c,p);break}case zf.PATH_COMMAND_CLOSE:e.closePath()}return e}class Eb{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const s=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,s),s}put(e,s){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,s)}delete(e){this.cache.delete(e)}}class Sb{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Gr(e,e.data)}getFromCache(e,s,c){return this.cacheMap.has(c)||this.cacheMap.set(c,new Eb(150)),this.cacheMap.get(c).get(ra(e.serialize(),s))}setInCache(e,s,c,p){this.cacheDependenciesMap.has(p)||this.cacheDependenciesMap.set(p,new Map),this.cacheMap.has(p)||this.cacheMap.set(p,new Eb(150));const u=this.cacheDependenciesMap.get(p);u.get(ra(e.id,c))||u.set(ra(e.id,c),new Set);const m=this.cacheMap.get(p),x=e.serialize();u.get(ra(e.id,c)).add(x),m.put(ra(e.serialize(),c),s)}removeImagesFromCacheByIds(e,s,c=""){if(!this.cacheMap.has(c)||!this.cacheDependenciesMap.has(c))return;const p=this.cacheMap.get(c),u=this.cacheDependenciesMap.get(c);for(const m of e)if(u.has(ra(m,s))){for(const x of u.get(ra(m,s)))p.delete(x);u.delete(ra(m,s))}}rasterize(e,s,c,p,u=Jk){const m=this.getFromCache(e,c,p);if(m)return m.clone();const x=u(s.icon,e.options),S=Sb._getImage(x);return this.setInCache(e,S,c,p),S.clone()}}class oM{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,s){const c=this.toIdx(e,s);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(e,s){return this.leaves[this.toIdx(e,s)]}toIdx(e,s){return s*this.size+e}}function aM(a,e,s,c){let p=0,u=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(c[m])<1e-15){if(s[m]<a[m]||s[m]>e[m])return null}else{const x=1/c[m];let S=(a[m]-s[m])*x,P=(e[m]-s[m])*x;if(S>P){const y=S;S=P,P=y}if(S>p&&(p=S),P<u&&(u=P),p>u)return null}return p}function lM(a,e,s,c,p,u,m,x,S,P,y){const A=c-a,I=p-e,E=u-s,M=m-a,R=x-e,z=S-s,F=y[1]*z-y[2]*R,$=y[2]*M-y[0]*z,H=y[0]*R-y[1]*M,V=A*F+I*$+E*H;if(Math.abs(V)<1e-15)return null;const G=1/V,Y=P[0]-a,te=P[1]-e,he=P[2]-s,ce=(Y*F+te*$+he*H)*G;if(ce<0||ce>1)return null;const le=te*E-he*I,Ee=he*A-Y*E,de=Y*I-te*A,Ae=(y[0]*le+y[1]*Ee+y[2]*de)*G;return Ae<0||ce+Ae>1?null:(M*le+R*Ee+z*de)*G}function cM(a,e,s){return(a-e)/(s-e)}function uM(a,e,s,c,p,u,m,x,S){const P=1<<s,y=u-c,A=m-p,I=(a+1)/P*y+c,E=(e+0)/P*A+p,M=(e+1)/P*A+p;x[0]=(a+0)/P*y+c,x[1]=E,S[0]=I,S[1]=M}class hM{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(u){const m=Math.ceil(Math.log2(u.dim/8)),x=[];let S=Math.ceil(Math.pow(2,m));const P=1/S,y=(E,M,R,z,F)=>{const $=z?1:0,H=(E+1)*R-$,V=M*R,G=(M+1)*R-$;F[0]=E*R,F[1]=V,F[2]=H,F[3]=G};let A=new oM(S);const I=[];for(let E=0;E<S*S;E++){y(E%S,Math.floor(E/S),P,!1,I);const M=eu(I[0],I[1],u),R=eu(I[2],I[1],u),z=eu(I[2],I[3],u),F=eu(I[0],I[3],u);A.minimums.push(Math.min(M,R,z,F)),A.maximums.push(Math.max(M,R,z,F)),A.leaves.push(1)}for(x.push(A),S/=2;S>=1;S/=2){const E=x[x.length-1];A=new oM(S);for(let M=0;M<S*S;M++){y(M%S,Math.floor(M/S),2,!0,I);const R=E.getElevation(I[0],I[1]),z=E.getElevation(I[2],I[1]),F=E.getElevation(I[2],I[3]),$=E.getElevation(I[0],I[3]),H=E.isLeaf(I[0],I[1]),V=E.isLeaf(I[2],I[1]),G=E.isLeaf(I[2],I[3]),Y=E.isLeaf(I[0],I[3]),te=Math.min(R.min,z.min,F.min,$.min),he=Math.max(R.max,z.max,F.max,$.max),ce=H&&V&&G&&Y;A.maximums.push(he),A.minimums.push(te),A.leaves.push(he-te<=5&&ce?1:0)}x.push(A)}return x}(this.dem),c=s.length-1,p=s[c];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(s,0,0,c,0)}raycastRoot(e,s,c,p,u,m,x=1){return aM([e,s,-100],[c,p,this.maximums[0]*x],u,m)}raycast(e,s,c,p,u,m,x=1){if(!this.nodeCount)return null;const S=this.raycastRoot(e,s,c,p,u,m,x);if(S==null)return null;const P=[],y=[],A=[],I=[],E=[{idx:0,t:S,nodex:0,nodey:0,depth:0}];for(;E.length>0;){const{idx:M,t:R,nodex:z,nodey:F,depth:$}=E.pop();if(this.leaves[M]){uM(z,F,$,e,s,c,p,A,I);const V=1<<$,G=(z+0)/V,Y=(z+1)/V,te=(F+0)/V,he=(F+1)/V,ce=eu(G,te,this.dem)*x,le=eu(Y,te,this.dem)*x,Ee=eu(Y,he,this.dem)*x,de=eu(G,he,this.dem)*x,Ae=lM(A[0],A[1],ce,I[0],A[1],le,I[0],I[1],Ee,u,m),Pe=lM(I[0],I[1],Ee,A[0],I[1],de,A[0],A[1],ce,u,m),Ce=Math.min(Ae!==null?Ae:Number.MAX_VALUE,Pe!==null?Pe:Number.MAX_VALUE);if(Ce!==Number.MAX_VALUE)return Ce;{const ze=Le.vec3.scaleAndAdd([],u,m,R);if(dM(ce,le,de,Ee,cM(ze[0],A[0],I[0]),cM(ze[1],A[1],I[1]))>=ze[2])return R}continue}let H=0;for(let V=0;V<this._siblingOffset.length;V++){uM((z<<1)+this._siblingOffset[V][0],(F<<1)+this._siblingOffset[V][1],$+1,e,s,c,p,A,I),A[2]=-100,I[2]=this.maximums[this.childOffsets[M]+V]*x;const G=aM(A,I,u,m);if(G!=null){const Y=G;P[V]=Y;let te=!1;for(let he=0;he<H&&!te;he++)Y>=P[y[he]]&&(y.splice(he,0,V),te=!0);te||(y[H]=V),H++}}for(let V=0;V<H;V++){const G=y[V];E.push({idx:this.childOffsets[M]+G,t:P[G],nodex:(z<<1)+this._siblingOffset[G][0],nodey:(F<<1)+this._siblingOffset[G][1],depth:$+1})}}return null}_addNode(e,s,c){return this.minimums.push(e),this.maximums.push(s),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(e,s,c,p,u){if(e[p].isLeaf(s,c)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const m=p-1,x=e[m];let S=0,P=0;for(let y=0;y<this._siblingOffset.length;y++){const A=2*s+this._siblingOffset[y][0],I=2*c+this._siblingOffset[y][1],E=x.getElevation(A,I),M=x.isLeaf(A,I),R=this._addNode(E.min,E.max,M);M&&(S|=1<<y),P||(P=R)}for(let y=0;y<this._siblingOffset.length;y++)S&1<<y||this._construct(e,2*s+this._siblingOffset[y][0],2*c+this._siblingOffset[y][1],m,P+y)}}function dM(a,e,s,c,p,u){return di(di(a,s,u),di(e,c,u),p)}function eu(a,e,s){const c=s.dim,p=Ct(a*c-.5,0,c-1),u=Ct(e*c-.5,0,c-1),m=Math.floor(p),x=Math.floor(u),S=Math.min(m+1,c-1),P=Math.min(x+1,c-1);return dM(s.get(m,x),s.get(S,x),s.get(m,P),s.get(S,P),p-m,u-x)}const Qk={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function e5(a,e,s){return(256*a*256+256*e+s)/10-1e4}function t5(a,e,s){return 256*a+e+s/256-32768}class M0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,s,c,p=!1){if(this.uid=e,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return void Ti(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const u=this.dim=s.height-2,m=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.floatView=new Float32Array(s.data.buffer),this.borderReady=p,this._modifiedForSources={},!p){for(let S=0;S<u;S++)m[this._idx(-1,S)]=m[this._idx(0,S)],m[this._idx(u,S)]=m[this._idx(u-1,S)],m[this._idx(S,-1)]=m[this._idx(S,0)],m[this._idx(S,u)]=m[this._idx(S,u-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(u,-1)]=m[this._idx(u-1,0)],m[this._idx(-1,u)]=m[this._idx(0,u-1)],m[this._idx(u,u)]=m[this._idx(u-1,u-1)]}const x=c==="terrarium"?t5:e5;for(let S=0;S<m.length;++S){const P=4*S;this.floatView[S]=x(this.pixels[P],this.pixels[P+1],this.pixels[P+2])}this._timestamp=ye.now()}_buildQuadTree(){this._tree=new hM(this)}get(e,s,c=!1){c&&(e=Ct(e,-1,this.dim),s=Ct(s,-1,this.dim));const p=this._idx(e,s);return this.floatView[p]}set(e,s,c){const p=this._idx(e,s),u=this.floatView[p];return this.floatView[p]=c,c-u}static getUnpackVector(e){return Qk[e]}_idx(e,s){if(e<-1||e>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(e+1)}static pack(e,s){const c=[0,0,0,0],p=M0.getUnpackVector(s);let u=Math.floor((e+p[3])/p[2]);return c[2]=u%256,u=Math.floor(u/256),c[1]=u%256,u=Math.floor(u/256),c[0]=u,c}getPixels(){return new IE({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,s,c){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let p=s*this.dim,u=s*this.dim+this.dim,m=c*this.dim,x=c*this.dim+this.dim;switch(s){case-1:p=u-1;break;case 1:u=p+1}switch(c){case-1:m=x-1;break;case 1:x=m+1}const S=-s*this.dim,P=-c*this.dim;for(let y=m;y<x;y++)for(let A=p;A<u;A++){const I=4*this._idx(A,y),E=4*this._idx(A+S,y+P);this.pixels[I+0]=e.pixels[E+0],this.pixels[I+1]=e.pixels[E+1],this.pixels[I+2]=e.pixels[E+2],this.pixels[I+3]=e.pixels[E+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function i5(a,e,s){a===1?e.headerLength=s.readFixed32():a===2?e.x=s.readVarint():a===3?e.y=s.readVarint():a===4?e.z=s.readVarint():a===5&&e.layers.push(function(c,p){return c.readFields(a5,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},p)}(s,s.readVarint()+s.pos))}function n5(a,e,s){a===1?(e.delta_filter=function(c,p){return c.readFields(r5,{blockSize:0},p)}(s,s.readVarint()+s.pos),e.filter="delta_filter"):a===2?(s.readVarint(),e.filter="zigzag_filter"):a===3?(s.readVarint(),e.filter="bitshuffle_filter"):a===4&&(s.readVarint(),e.filter="byteshuffle_filter")}function r5(a,e,s){a===1&&(e.blockSize=s.readVarint())}function s5(a,e,s){a===1?(s.readVarint(),e.codec="gzip_data"):a===2?(s.readVarint(),e.codec="jpeg_image"):a===3?(s.readVarint(),e.codec="webp_image"):a===4&&(s.readVarint(),e.codec="png_image")}function o5(a,e,s){let c=0,p=0;a===1?e.firstByte=s.readFixed64():a===2?e.lastByte=s.readFixed64():a===3?e.filters.push(function(u,m){return u.readFields(n5,{},m)}(s,s.readVarint()+s.pos)):a===4?e.codec=function(u,m){return u.readFields(s5,{},m)}(s,s.readVarint()+s.pos):a===5?p=s.readFloat():a===6?c=s.readFloat():a===7?e.bands.push(s.readString()):a===8?e.offset=s.readDouble():a===9&&(e.scale=s.readDouble()),e.offset===0&&(e.offset=p),e.scale===0&&(e.scale=c)}function a5(a,e,s){a===1?e.version=s.readVarint():a===2?e.name=s.readString():a===3?e.units=s.readString():a===4?e.tileSize=s.readVarint():a===5?e.buffer=s.readVarint():a===6?e.pixelFormat=s.readVarint():a===7&&e.dataIndex.push(function(c,p){return c.readFields(o5,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},p)}(s,s.readVarint()+s.pos))}function l5(a,e,s){if(a===2)(function(c,p,u){c.readFields(c5,u,p)})(s,s.readVarint()+s.pos,e);else if(a===3)throw new Error("Not implemented")}function c5(a,e,s){if(a===1){let c=0;const p=s.readVarint()+s.pos;for(;s.pos<p;)e[c++]=s.readVarint()}}function u5(a,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let s=e[3];for(let c=2;c>=1;c--){const p=c===1?1:0,u=c===2?1:0;for(let m=0;m<e[0];m++){const x=e[1]*m;for(let S=p;S<e[1];S++){const P=e[2]*(S+x);for(let y=u;y<e[2];y++){const A=e[3]*(y+P);for(let I=0;I<e[3];I++){const E=A+I;a[E]+=a[E-s]}}}}s*=e[c]}return a}function h5(a){for(let e=0,s=a.length;e<s;e++)a[e]=a[e]>>>1^-(1&a[e]);return a}function d5(a,e){switch(e){case"uint32":return a;case"uint16":for(let s=0;s<a.length;s+=2){const c=a[s],p=a[s+1];a[s]=(240&c)>>4|(61440&c)>>8|(240&p)<<4|61440&p,a[s+1]=15&c|(3840&c)>>4|(15&p)<<8|(3840&p)<<4}return a;case"uint8":for(let s=0;s<a.length;s+=4){const c=a[s],p=a[s+1],u=a[s+2],m=a[s+3];a[s+0]=(192&c)>>6|(192&p)>>4|(192&u)>>2|192&m,a[s+1]=(48&c)>>4|(48&p)>>2|48&u|(48&m)<<2,a[s+2]=(12&c)>>2|12&p|(12&u)<<2|(12&m)<<4,a[s+3]=3&c|(3&p)<<2|(3&u)<<4|(3&m)<<6}return a;default:throw new Error(`Invalid pixel format, "${e}"`)}}Gt(M0,"DEMData"),Gt(hM,"DemMinMaxQuadTree",{omit:["dem"]});var Do=Uint8Array,D_=Uint16Array,f5=Int32Array,fM=new Do([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),pM=new Do([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),p5=new Do([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),mM=function(a,e){for(var s=new D_(31),c=0;c<31;++c)s[c]=e+=1<<a[c-1];var p=new f5(s[30]);for(c=1;c<30;++c)for(var u=s[c];u<s[c+1];++u)p[u]=u-s[c]<<5|c;return{b:s,r:p}},_M=mM(fM,2),gM=_M.b,m5=_M.r;gM[28]=258,m5[258]=28;for(var _5=mM(pM,0).b,yM=new D_(32768),lr=0;lr<32768;++lr){var Ff=(43690&lr)>>1|(21845&lr)<<1;yM[lr]=((65280&(Ff=(61680&(Ff=(52428&Ff)>>2|(13107&Ff)<<2))>>4|(3855&Ff)<<4))>>8|(255&Ff)<<8)>>1}var L_=function(a,e,s){for(var c=a.length,p=0,u=new D_(e);p<c;++p)a[p]&&++u[a[p]-1];var m,x=new D_(e);for(p=1;p<e;++p)x[p]=x[p-1]+u[p-1]<<1;m=new D_(1<<e);var S=15-e;for(p=0;p<c;++p)if(a[p])for(var P=p<<4|a[p],y=e-a[p],A=x[a[p]-1]++<<y,I=A|(1<<y)-1;A<=I;++A)m[yM[A]>>S]=P;return m},O_=new Do(288);for(lr=0;lr<144;++lr)O_[lr]=8;for(lr=144;lr<256;++lr)O_[lr]=9;for(lr=256;lr<280;++lr)O_[lr]=7;for(lr=280;lr<288;++lr)O_[lr]=8;var vM=new Do(32);for(lr=0;lr<32;++lr)vM[lr]=5;var g5=L_(O_,9),y5=L_(vM,5),Ab=function(a){for(var e=a[0],s=1;s<a.length;++s)a[s]>e&&(e=a[s]);return e},ja=function(a,e,s){var c=e/8|0;return(a[c]|a[c+1]<<8)>>(7&e)&s},Mb=function(a,e){var s=e/8|0;return(a[s]|a[s+1]<<8|a[s+2]<<16)>>(7&e)},v5=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],$a=function(a,e,s){var c=new Error(e||v5[a]);if(c.code=a,Error.captureStackTrace&&Error.captureStackTrace(c,$a),!s)throw c;return c},x5=new Do(0),b5=typeof TextDecoder<"u"&&new TextDecoder;try{b5.decode(x5,{stream:!0})}catch{}const w5={gzip_data:"gzip"};class ha extends Error{constructor(e){super(e),this.name="MRTError"}}const T5={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},xM={uint32:1,uint16:2,uint8:4},E5={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Cb;class Ib{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const s=this.layers[e];if(!s)throw new ha(`Layer '${e}' not found`);return s}getHeaderLength(e){const s=new Uint8Array(e),c=new DataView(e);if(s[0]!==13)throw new ha("File is not a valid MRT.");return c.getUint32(1,!0)}parseHeader(e){const s=new Uint8Array(e),c=this.getHeaderLength(e);if(s.length<c)throw new ha(`Expected header with length >= ${c} but got buffer of length ${s.length}`);const p=function(u,m){return u.readFields(i5,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new Cb(s.subarray(0,c)));if(!isNaN(this.x)&&(this.x!==p.x||this.y!==p.y||this.z!==p.z))throw new ha(`Invalid attempt to parse header ${p.z}/${p.x}/${p.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=p.x,this.y=p.y,this.z=p.z;for(const u of p.layers)this.layers[u.name]=new S5(u,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const s=[],c=this.getLayer(e.layerName);for(let p of e.blockIndices){const u=c.dataIndex[p],m=u.firstByte-e.firstByte,x=u.lastByte-e.firstByte;if(c._blocksInProgress.has(p))continue;const S={layerName:c.name,firstByte:m,lastByte:x,pixelFormat:c.pixelFormat,blockIndex:p,blockShape:[u.bands.length].concat(c.bandShape),buffer:c.buffer,codec:u.codec.codec,filters:u.filters.map(P=>P.filter)};c._blocksInProgress.add(p),s.push(S)}return new bM(s,()=>{s.forEach(p=>c._blocksInProgress.delete(p.blockIndex))},(p,u)=>{if(s.forEach(m=>c._blocksInProgress.delete(m.blockIndex)),p)throw p;u.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class S5{constructor({version:e,name:s,units:c,tileSize:p,pixelFormat:u,buffer:m,dataIndex:x},S){if(this.version=e,this.version!==1)throw new ha(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=s,this.units=c,this.tileSize=p,this.buffer=m,this.pixelFormat=T5[u],this.dataIndex=x,this.bandShape=[p+2*m,p+2*m,xM[this.pixelFormat]],this._decodedBlocks=new Eb(S?S.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return xM[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const s=e.blockIndex.toString();this._decodedBlocks.get(s)||this._decodedBlocks.put(s,e.data)}getBlockForBand(e){let s=0;switch(typeof e){case"string":for(const[c,p]of this.dataIndex.entries()){for(const[u,m]of p.bands.entries())if(m===e)return{bandIndex:s+u,blockIndex:c,blockBandIndex:u};s+=p.bands.length}break;case"number":for(const[c,p]of this.dataIndex.entries()){if(e>=s&&e<s+p.bands.length)return{bandIndex:e,blockIndex:c,blockBandIndex:e-s};s+=p.bands.length}break;default:throw new ha(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new ha(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let s=1/0,c=-1/0;const p=[],u=new Set;for(const m of e){const{blockIndex:x}=this.getBlockForBand(m);if(x<0)throw new ha(`Invalid band: ${JSON.stringify(m)}`);const S=this.dataIndex[x];p.includes(x)||p.push(x),u.add(x),s=Math.min(s,S.firstByte),c=Math.max(c,S.lastByte)}if(u.size>this.cacheSize)throw new ha(`Number of blocks to decode (${u.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:s,lastByte:c,blockIndices:p}}hasBand(e){const{blockIndex:s}=this.getBlockForBand(e);return s>=0}hasDataForBand(e){const{blockIndex:s}=this.getBlockForBand(e);return s>=0&&!!this._decodedBlocks.get(s.toString())}getBandView(e){const{blockIndex:s,blockBandIndex:c}=this.getBlockForBand(e),p=this._decodedBlocks.get(s.toString());if(!p)throw new ha(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const u=this.dataIndex[s],m=this.bandShape.reduce((P,y)=>P*y,1),x=c*m,S=p.subarray(x,x+m);return{data:S,bytes:new Uint8Array(S.buffer).subarray(S.byteOffset,S.byteOffset+S.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:u.offset,scale:u.scale}}}Ib.setPbf=function(a){Cb=a};class bM{constructor(e,s,c){this.tasks=e,this._onCancel=s,this._onComplete=c,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,s){this._finalized||(this._onComplete(e,s),this._finalized=!0)}}Ib.performDecoding=function(a,e){const s=new Uint8Array(a);return Promise.all(e.tasks.map(c=>{const{layerName:p,firstByte:u,lastByte:m,pixelFormat:x,blockShape:S,blockIndex:P,filters:y,codec:A}=c,I=s.subarray(u,m+1),E=new Uint32Array(S[0]*S[1]*S[2]);let M;if(A!=="gzip_data")throw new ha(`Unhandled codec: ${A}`);return M=function(R,z){if(!globalThis.DecompressionStream&&z==="gzip_data")return Promise.resolve(((V=function(te){te[0]==31&&te[1]==139&&te[2]==8||$a(6,"invalid gzip data");var he=te[3],ce=10;4&he&&(ce+=2+(te[10]|te[11]<<8));for(var le=(he>>3&1)+(he>>4&1);le>0;le-=!te[ce++]);return ce+(2&he)}(H=R))+8>H.length&&$a(6,"invalid gzip data"),function(te,he,ce,le){var Ee=te.length;if(!Ee||he.f&&!he.l)return ce||new Do(0);var de=!ce,Ae=de||he.i!=2,Pe=he.i;de&&(ce=new Do(3*Ee));var Ce,ze,Ne=function(tu){var Fh=ce.length;if(tu>Fh){var N_=new Do(Math.max(2*Fh,tu));N_.set(ce),ce=N_}},Ge=he.f||0,Fe=he.p||0,at=he.b||0,mt=he.l,ot=he.d,zt=he.m,Rt=he.n,xt=8*Ee;do{if(!mt){Ge=ja(te,Fe,1);var _t=ja(te,Fe+1,3);if(Fe+=3,!_t){var Yt=te[(bi=4+((Fe+7)/8|0))-4]|te[bi-3]<<8,Ft=bi+Yt;if(Ft>Ee){Pe&&$a(0);break}Ae&&Ne(at+Yt),ce.set(te.subarray(bi,Ft),at),he.b=at+=Yt,he.p=Fe=8*Ft,he.f=Ge;continue}if(_t==1)mt=g5,ot=y5,zt=9,Rt=5;else if(_t==2){var jt=ja(te,Fe,31)+257,mi=ja(te,Fe+10,15)+4,Ei=jt+ja(te,Fe+5,31)+1;Fe+=14;for(var Mi=new Do(Ei),Ci=new Do(19),Di=0;Di<mi;++Di)Ci[p5[Di]]=ja(te,Fe+3*Di,7);Fe+=3*mi;var zi=Ab(Ci),_n=(1<<zi)-1,hn=L_(Ci,zi);for(Di=0;Di<Ei;){var bi,sn=hn[ja(te,Fe,_n)];if(Fe+=15&sn,(bi=sn>>4)<16)Mi[Di++]=bi;else{var an=0,Mn=0;for(bi==16?(Mn=3+ja(te,Fe,3),Fe+=2,an=Mi[Di-1]):bi==17?(Mn=3+ja(te,Fe,7),Fe+=3):bi==18&&(Mn=11+ja(te,Fe,127),Fe+=7);Mn--;)Mi[Di++]=an}}var Yn=Mi.subarray(0,jt),cr=Mi.subarray(jt);zt=Ab(Yn),Rt=Ab(cr),mt=L_(Yn,zt),ot=L_(cr,Rt)}else $a(1);if(Fe>xt){Pe&&$a(0);break}}Ae&&Ne(at+131072);for(var Kn=(1<<zt)-1,Un=(1<<Rt)-1,nr=Fe;;nr=Fe){var _r=(an=mt[Mb(te,Fe)&Kn])>>4;if((Fe+=15&an)>xt){Pe&&$a(0);break}if(an||$a(2),_r<256)ce[at++]=_r;else{if(_r==256){nr=Fe,mt=null;break}var rs=_r-254;_r>264&&(rs=ja(te,Fe,(1<<(Ha=fM[Di=_r-257]))-1)+gM[Di],Fe+=Ha);var En=ot[Mb(te,Fe)&Un],Zs=En>>4;if(En||$a(3),Fe+=15&En,cr=_5[Zs],Zs>3){var Ha=pM[Zs];cr+=Mb(te,Fe)&(1<<Ha)-1,Fe+=Ha}if(Fe>xt){Pe&&$a(0);break}Ae&&Ne(at+131072);var da=at+rs;if(at<cr){var fa=0-cr,kh=Math.min(cr,da);for(fa+at<0&&$a(3);at<kh;++at)ce[at]=(void 0)[fa+at]}for(;at<da;++at)ce[at]=ce[at-cr]}}he.l=mt,he.p=nr,he.b=at,he.f=Ge,mt&&(Ge=1,he.m=zt,he.d=ot,he.n=Rt)}while(!Ge);return at!=ce.length&&de?(Ce=ce,((ze=at)==null||ze>Ce.length)&&(ze=Ce.length),new Do(Ce.subarray(0,ze))):ce.subarray(0,at)}(H.subarray(V,-8),{i:2},new Do(((F=H)[($=F.length)-4]|F[$-3]<<8|F[$-2]<<16|F[$-1]<<24)>>>0))));var F,$,H,V;const G=w5[z];if(!G)throw new Error(`Unhandled codec: ${z}`);const Y=new globalThis.DecompressionStream(G);return new Response(new Blob([R]).stream().pipeThrough(Y)).arrayBuffer().then(te=>new Uint8Array(te))}(I,A).then(R=>(function(z,F){z.readFields(l5,F)}(new Cb(R),E),new E5[x](E.buffer))),M.then(R=>{for(let z=y.length-1;z>=0;z--)switch(y[z]){case"delta_filter":u5(R,S);break;case"zigzag_filter":h5(R);break;case"bitshuffle_filter":d5(R,x);break;default:throw new ha(`Unhandled filter "${y[z]}"`)}return{layerName:p,blockIndex:P,data:R}}).catch(R=>{throw R})}))},Gt(bM,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let z_,Pb,qa,Nf,Rb,Bf=null;function wM(){return Ca()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Pb||pr.DRACO_URL}function TM(){if(Ca()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Nf)return Nf;const a=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Nf=WebAssembly.validate(a)?pr.MESHOPT_SIMD_URL:pr.MESHOPT_URL,Nf}const C0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},A5={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},k_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function EM(a,e,s){const c=s.json.bufferViews.length,p=s.buffers.length;e.bufferView=c,s.json.bufferViews[c]={buffer:p,byteLength:a.byteLength},s.buffers[p]=a}const Db="KHR_draco_mesh_compression";function M5(a,e){const s=a.extensions&&a.extensions[Db];if(!s)return;const c=new qa.Decoder,p=CM(e,s.bufferView),u=new qa.Mesh;if(!c.DecodeArrayToMesh(p,p.byteLength,u))throw new Error("Failed to decode Draco mesh");const m=e.json.accessors[a.indices],x=C0[m.componentType],S=m.count*x.BYTES_PER_ELEMENT,P=qa._malloc(S);x===Uint16Array?c.GetTrianglesUInt16Array(u,S,P):c.GetTrianglesUInt32Array(u,S,P),EM(qa.memory.buffer.slice(P,P+S),m,e),qa._free(P);for(const y of Object.keys(s.attributes)){const A=c.GetAttributeByUniqueId(u,s.attributes[y]),I=e.json.accessors[a.attributes[y]],E=A5[I.componentType],M=I.count*k_[I.type]*C0[I.componentType].BYTES_PER_ELEMENT,R=qa._malloc(M);c.GetAttributeDataArrayForAllPoints(u,A,qa[E],M,R),EM(qa.memory.buffer.slice(R,R+M),I,e),qa._free(R)}c.destroy(),u.destroy(),delete a.extensions[Db]}const I0="EXT_meshopt_compression";function C5(a,e){if(!a.extensions||!a.extensions[I0])return;const s=a.extensions[I0],c=new Uint8Array(e.buffers[s.buffer],s.byteOffset||0,s.byteLength||0),p=new Uint8Array(s.count*s.byteStride);Rb.decodeGltfBuffer(p,s.count,s.byteStride,c,s.mode,s.filter),a.buffer=e.buffers.length,a.byteOffset=0,e.buffers[a.buffer]=p.buffer,delete a.extensions[I0]}const SM=1179937895,AM=new TextDecoder("utf8");function MM(a,e){return new URL(a,e).href}function I5(a,e,s,c){return fetch(MM(a.uri,c)).then(p=>p.arrayBuffer()).then(p=>{e.buffers[s]=p})}function CM(a,e){const s=a.json.bufferViews[e];return new Uint8Array(a.buffers[s.buffer],s.byteOffset||0,s.byteLength)}function P5(a,e,s,c){if(a.uri){const p=MM(a.uri,c);return fetch(p).then(u=>u.blob()).then(u=>createImageBitmap(u)).then(u=>{e.images[s]=u})}if(a.bufferView!==void 0){const p=CM(e,a.bufferView),u=new Blob([p],{type:a.mimeType});return createImageBitmap(u).then(m=>{e.images[s]=m})}}function IM(a,e=0,s){const c={json:null,images:[],buffers:[]};if(new Uint32Array(a,e,1)[0]===SM){const y=new Uint32Array(a,e);let A=2;const I=(y[A++]>>2)-3,E=y[A++]>>2;if(A++,c.json=JSON.parse(AM.decode(y.subarray(A,A+E))),A+=E,A<I){const M=y[A++];A++;const R=e+(A<<2);c.buffers[0]=a.slice(R,R+M)}}else c.json=JSON.parse(AM.decode(new Uint8Array(a,e)));const{buffers:p,images:u,meshes:m,extensionsUsed:x,bufferViews:S}=c.json;let P=Promise.resolve();if(p){const y=[];for(let A=0;A<p.length;A++){const I=p[A];I.uri?y.push(I5(I,c,A,s)):c.buffers[A]||(c.buffers[A]=null)}P=Promise.all(y)}return P.then(()=>{const y=[],A=x&&x.includes(Db),I=x&&x.includes(I0);if(A&&y.push(function(){if(!qa)return z_??(z_=function(E){let M,R=null;function z(){M=new Uint8Array(R.buffer)}function F(){throw new Error("Unexpected Draco error.")}const $={a:{a:F,d:function(H,V,G){return M.copyWithin(H,V,V+G)},c:function(H){const V=M.length,G=Math.max(H>>>0,Math.ceil(1.2*V)),Y=Math.ceil((G-V)/65536);try{return R.grow(Y),z(),!0}catch{return!1}},b:F}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(E,$):E.then(H=>H.arrayBuffer()).then(H=>WebAssembly.instantiate(H,$))).then(H=>{const{Rb:V,Qb:G,P:Y,T:te,X:he,Ja:ce,La:le,Qa:Ee,Va:de,Wa:Ae,eb:Pe,jb:Ce,f:ze,e:Ne,yb:Ge,zb:Fe,Ab:at,Bb:mt,Db:ot,Gb:zt}=H.instance.exports;R=Ne;const Rt=(()=>{let xt=0,_t=0,Yt=0,Ft=0;return jt=>{Yt&&(V(Ft),V(xt),_t+=Yt,Yt=xt=0),xt||(_t+=128,xt=G(_t));const mi=jt.length+7&-8;let Ei=xt;mi>=_t&&(Yt=mi,Ei=Ft=G(mi));for(let Mi=0;Mi<jt.length;Mi++)M[Ei+Mi]=jt[Mi];return Ei}})();return z(),ze(),{memory:Ne,_free:V,_malloc:G,Mesh:class{constructor(){this.ptr=Y()}destroy(){te(this.ptr)}},Decoder:class{constructor(){this.ptr=ce()}destroy(){Ce(this.ptr)}DecodeArrayToMesh(xt,_t,Yt){const Ft=Rt(xt),jt=le(this.ptr,Ft,_t,Yt.ptr);return!!he(jt)}GetAttributeByUniqueId(xt,_t){return{ptr:Ee(this.ptr,xt.ptr,_t)}}GetTrianglesUInt16Array(xt,_t,Yt){de(this.ptr,xt.ptr,_t,Yt)}GetTrianglesUInt32Array(xt,_t,Yt){Ae(this.ptr,xt.ptr,_t,Yt)}GetAttributeDataArrayForAllPoints(xt,_t,Yt,Ft,jt){Pe(this.ptr,xt.ptr,_t.ptr,Yt,Ft,jt)}},DT_INT8:Ge(),DT_UINT8:Fe(),DT_INT16:at(),DT_UINT16:mt(),DT_UINT32:ot(),DT_FLOAT32:zt()}})}(fetch(wM())),z_.then(E=>{qa=E,z_=void 0}))}()),I&&y.push(function(){if(Rb)return;const E=function(M){let R;const z=WebAssembly.instantiateStreaming(M,{}).then(H=>{R=H.instance,R.exports.__wasm_call_ctors()}),F={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},$={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:z,supported:!0,decodeGltfBuffer(H,V,G,Y,te,he){(function(ce,le,Ee,de,Ae,Pe,Ce){const ze=ce.exports.sbrk,Ne=de+3&-4,Ge=ze(Ne*Ae),Fe=ze(Pe.length),at=new Uint8Array(ce.exports.memory.buffer);at.set(Pe,Fe);const mt=le(Ge,de,Ae,Fe,Pe.length);if(mt===0&&Ce&&Ce(Ge,Ne,Ae),Ee.set(at.subarray(Ge,Ge+de*Ae)),ze(Ge-ze(0)),mt!==0)throw new Error(`Malformed buffer data: ${mt}`)})(R,R.exports[$[te]],H,V,G,Y,R.exports[F[he]])}}}(fetch(TM()));return E.ready.then(()=>{Rb=E})}()),u)for(let E=0;E<u.length;E++)y.push(P5(u[E],c,E,s));return(y.length?Promise.all(y):Promise.resolve()).then(()=>{if(A&&m)for(const{primitives:E}of m)for(const M of E)M5(M,c);if(I&&m&&S)for(const E of S)C5(E,c);return c})})}function zh(a,e){const s=a.json.bufferViews[e.bufferView],c=C0[e.componentType];return new c(a.buffers[s.buffer],(e.byteOffset||0)+(s.byteOffset||0),e.count*(s.byteStride&&s.byteStride!==k_[e.type]*c.BYTES_PER_ELEMENT?s.byteStride/c.BYTES_PER_ELEMENT:k_[e.type]))}function Lb(a,e,s,c){const p=C0[e.componentType],u=function(y){switch(y){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(p),m=a.json.bufferViews[e.bufferView],x=m.byteStride?m.byteStride/p.BYTES_PER_ELEMENT:k_[e.type],S=s.float32,P=S.length/s.capacity;for(let y=0,A=0;y<e.count*x;y+=x,A+=P)for(let I=0;I<P;I++)S[A+I]=c[y+I]*u;s._trim()}function R5(a,e,s){const c=a.indices,p=a.attributes,u={};u.indexArray=new Or;const m=e.json.accessors[c],x=m.count/3;u.indexArray.reserve(x);const S=zh(e,m);for(let I=0;I<x;I++)u.indexArray.emplaceBack(S[3*I],S[3*I+1],S[3*I+2]);u.indexArray._trim(),u.vertexArray=new sa;const P=e.json.accessors[p.POSITION];u.vertexArray.reserve(P.count);const y=zh(e,P);for(let I=0;I<P.count;I++)u.vertexArray.emplaceBack(y[3*I],y[3*I+1],y[3*I+2]);if(u.vertexArray._trim(),u.aabb=new ei(P.min,P.max),u.centroid=function(I,E){const M=[0,0,0],R=I.length;if(R>0){for(let z=0;z<R;z++){const F=3*I[z];M[0]+=E[F],M[1]+=E[F+1],M[2]+=E[F+2]}M[0]/=R,M[1]/=R,M[2]/=R}return M}(S,y),p.COLOR_0!==void 0){const I=e.json.accessors[p.COLOR_0],E=k_[I.type],M=zh(e,I);u.colorArray=E===3?new sa:new ql,u.colorArray.resize(I.count),Lb(e,I,u.colorArray,M)}if(p.NORMAL!==void 0){u.normalArray=new sa;const I=e.json.accessors[p.NORMAL];u.normalArray.resize(I.count);const E=zh(e,I);Lb(e,I,u.normalArray,E)}if(p.TEXCOORD_0!==void 0&&s.length>0){u.texcoordArray=new Uc;const I=e.json.accessors[p.TEXCOORD_0];u.texcoordArray.resize(I.count);const E=zh(e,I);Lb(e,I,u.texcoordArray,E)}if(p._FEATURE_ID_RGBA4444!==void 0){const I=e.json.accessors[p._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(u.featureData=zh(e,I))}p._FEATURE_RGBA4444!==void 0&&(u.featureData=new Uint32Array(zh(e,e.json.accessors[p._FEATURE_RGBA4444]).buffer));const A=a.material;return u.material=function(I,E){const{emissiveFactor:M=[0,0,0],alphaMode:R="OPAQUE",alphaCutoff:z=.5,normalTexture:F,occlusionTexture:$,emissiveTexture:H,doubleSided:V}=I,{baseColorFactor:G=[1,1,1,1],metallicFactor:Y=1,roughnessFactor:te=1,baseColorTexture:he,metallicRoughnessTexture:ce}=I.pbrMetallicRoughness||{},le=$?E[$.index]:void 0;if($&&$.extensions&&$.extensions.KHR_texture_transform&&le){const Ee=$.extensions.KHR_texture_transform;le.offsetScale=[Ee.offset[0],Ee.offset[1],Ee.scale[0],Ee.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Qi(...G),metallicFactor:Y,roughnessFactor:te,baseColorTexture:he?E[he.index]:void 0,metallicRoughnessTexture:ce?E[ce.index]:void 0},doubleSided:V,emissiveFactor:M,alphaMode:R,alphaCutoff:z,normalTexture:F?E[F.index]:void 0,occlusionTexture:le,emissionTexture:H?E[H.index]:void 0,defined:I.defined===void 0}}(A!==void 0?e.json.materials[A]:{defined:!1},s),u}function PM(a,e,s){const{matrix:c,rotation:p,translation:u,scale:m,mesh:x,extras:S,children:P}=a,y={};if(y.matrix=c||Le.mat4.fromRotationTranslationScale([],p||[0,0,0,1],u||[0,0,0],m||[1,1,1]),x!==void 0){y.meshes=s[x];const A=y.anchor=[0,0];for(const I of y.meshes){const{min:E,max:M}=I.aabb;A[0]+=E[0]+M[0],A[1]+=E[1]+M[1]}A[0]=Math.floor(A[0]/y.meshes.length/2),A[1]=Math.floor(A[1]/y.meshes.length/2)}if(S&&(S.id&&(y.id=S.id),S.lights&&(y.lights=function(A){if(!A.length)return[];const I=function(F){const $=atob(F),H=new Uint8Array($.length);for(let V=0;V<$.length;V++)H[V]=$.codePointAt(V);return H}(A),E=[],M=I.length/24,R=new Uint16Array(I.buffer),z=new Float32Array(I.buffer);for(let F=0;F<M;F++){const $=R[2*F*6]/30,H=R[2*F*6+1]/30,V=R[2*F*6+10]/100,G=z[6*F+1],Y=z[6*F+2],te=z[6*F+3],he=z[6*F+4],ce=te-G,le=he-Y,Ee=Math.hypot(ce,le);E.push({pos:[G+.5*ce,Y+.5*le,H],normal:[le/Ee,-ce/Ee,0],width:Ee,height:$,depth:V,points:[G,Y,te,he]})}return E}(S.lights))),P){const A=[];for(const I of P)A.push(PM(e.json.nodes[I],e,s));y.children=A}return y}function D5(a){if(a.vertices.length===0||a.indices.length===0)return null;const e=new zx(a.vertices,a.indices,8,256),[s,c]=[e.min.clone(),e.max.clone()];return{vertices:a.vertices,indices:a.indices,grid:e,min:s,max:c}}function L5(a){if(!a.extras||!a.extras.ground)return null;const e=a.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const s=e[0];if(!s||!Array.isArray(s)||s.length===0)return null;const c=[];for(const m of s){if(!Array.isArray(m)||m.length!==2)continue;const x=m[0],S=m[1];typeof x=="number"&&typeof S=="number"&&c.push(new Se(x,S))}if(c.length<3)return null;c.length>1&&c[c.length-1].equals(c[0])&&c.pop();let p=0;for(let m=0;m<c.length;m++){const x=c[m],S=c[(m+1)%c.length],P=c[(m+2)%c.length];p+=(x.x-S.x)*(P.y-S.y)-(P.x-S.x)*(x.y-S.y)}p>0&&c.reverse();const u=o_(c.flatMap(m=>[m.x,m.y]),[]);return u.length===0?null:{vertices:c,indices:u}}function O5(a,e){const s=[],c=[];let p=0;const u=[];for(const m of a){p=s.length;const x=m.vertexArray.float32,S=m.indexArray.uint16;for(let P=0;P<m.vertexArray.length;P++)u[0]=x[3*P+0],u[1]=x[3*P+1],u[2]=x[3*P+2],Le.vec3.transformMat4(u,u,e),s.push(new Se(u[0],u[1]));for(let P=0;P<3*m.indexArray.length;P++)c.push(S[P]+p)}if(c.length%3!=0)return null;for(let m=0;m<c.length;m+=3){const x=s[c[m+0]],S=s[c[m+1]],P=s[c[m+2]];(x.x-S.x)*(P.y-S.y)-(P.x-S.x)*(x.y-S.y)>0&&([c[m+1],c[m+2]]=[c[m+2],c[m+1]])}return{vertices:s,indices:c}}function RM(a){const e=function(S,P){const y=[],A=WebGL2RenderingContext;if(S.json.textures)for(const I of S.json.textures){const E={magFilter:A.LINEAR,minFilter:A.NEAREST,wrapS:A.REPEAT,wrapT:A.REPEAT};I.sampler!==void 0&&Object.assign(E,S.json.samplers[I.sampler]),y.push({image:P[I.source],sampler:E,uploaded:!1})}return y}(a,a.images),s=function(S,P){const y=[];for(const A of S.json.meshes){const I=[];for(const E of A.primitives)I.push(R5(E,S,P));y.push(I)}return y}(a,e),{scenes:c,scene:p,nodes:u}=a.json,m=c?c[p||0].nodes:u,x=[];for(const S of m)x.push(PM(u[S],a,s));return function(S,P,y){const A={},I=new Set;for(let E=0;E<S.length;E++){const M=y[P[E]];if(!M.extras)continue;const R=M.extras["mapbox:footprint:version"],z=M.extras["mapbox:footprint:id"];(R||z)&&I.add(E),R==="1.0.0"&&z&&(A[z]=E)}for(let E=0;E<S.length;E++){if(I.has(E))continue;const M=S[E],R=y[P[E]];if(!R.extras)continue;let z=null;M.id in A&&(z=O5(S[A[M.id]].meshes,M.matrix)),z||(z=L5(R)),z&&(M.footprint=D5(z))}if(I.size>0){const E=Array.from(I.values()).sort((M,R)=>M-R);for(let M=E.length-1;M>=0;M--)S.splice(E[M],1)}}(x,m,a.json.nodes),x}function z5(a){a.heightmap=new Float32Array(4096),a.heightmap.fill(-1);const e=a.vertexArray.float32,s=a.aabb.min[0]-1,c=a.aabb.min[1]-1,p=Dh/(a.aabb.max[0]-s+2),u=Dh/(a.aabb.max[1]-c+2);for(let m=0;m<e.length;m+=3){const x=e[m+2],S=(e[m+0]-s)*p|0,P=(e[m+1]-c)*u|0;x>a.heightmap[P*Dh+S]&&(a.heightmap[P*Dh+S]=x)}}function k5(a,e){const s={};s.indexArray=new Or,s.indexArray.reserve(4*a.length),s.vertexArray=new sa,s.vertexArray.reserve(10*a.length),s.colorArray=new ql,s.vertexArray.reserve(10*a.length);let c=0;for(const m of a){const x=Math.min(10,Math.max(4,1.3*m.height))*e,S=[-m.normal[1],m.normal[0],0],P=Math.min(.29,.1*m.width/m.depth),y=m.width-2*m.depth*e*(P+.01),A=Le.vec3.scaleAndAdd([],m.pos,S,y/2),I=Le.vec3.scaleAndAdd([],m.pos,S,-y/2),E=[A[0],A[1],A[2]+m.height],M=[I[0],I[1],I[2]+m.height],R=Le.vec3.scaleAndAdd([],m.normal,S,P);Le.vec3.scale(R,R,x);const z=Le.vec3.scaleAndAdd([],m.normal,S,-P);Le.vec3.scale(z,z,x),Le.vec3.add(R,A,R),Le.vec3.add(z,I,z),A[2]+=.1,I[2]+=.1,s.vertexArray.emplaceBack(R[0],R[1],R[2]),s.vertexArray.emplaceBack(z[0],z[1],z[2]),s.vertexArray.emplaceBack(A[0],A[1],A[2]),s.vertexArray.emplaceBack(I[0],I[1],I[2]),s.vertexArray.emplaceBack(E[0],E[1],E[2]),s.vertexArray.emplaceBack(M[0],M[1],M[2]),s.vertexArray.emplaceBack(A[0],A[1],A[2]),s.vertexArray.emplaceBack(I[0],I[1],I[2]),s.vertexArray.emplaceBack(R[0],R[1],R[2]),s.vertexArray.emplaceBack(z[0],z[1],z[2]);const F=y/x/2;s.colorArray.emplaceBack(-F-P,-1,F,.8),s.colorArray.emplaceBack(F+P,-1,F,.8),s.colorArray.emplaceBack(-F,0,F,1.3),s.colorArray.emplaceBack(F,0,F,1.3),s.colorArray.emplaceBack(F+P,-.8,F,.7),s.colorArray.emplaceBack(F+P,-.8,F,.7),s.colorArray.emplaceBack(0,0,F,1.3),s.colorArray.emplaceBack(0,0,F,1.3),s.colorArray.emplaceBack(F+P,-1.2,F,.8),s.colorArray.emplaceBack(F+P,-1.2,F,.8),s.indexArray.emplaceBack(6+c,4+c,8+c),s.indexArray.emplaceBack(7+c,9+c,5+c),s.indexArray.emplaceBack(0+c,1+c,2+c),s.indexArray.emplaceBack(1+c,3+c,2+c),c+=10}const p={defined:!0,emissiveFactor:[0,0,0]},u={};return u.baseColorFactor=Qi.white,p.pbrMetallicRoughness=u,s.material=p,s.aabb=new ei([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),s}class DM{constructor(e){this._stringToNumber={},this._numberToString=[];for(let s=0;s<e.length;s++){const c=e[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const F5=["id","tile","layer","source","sourceLayer","state"];class Vf{constructor(e,s,c,p,u){this.type="Feature",this._vectorTileFeature=e,this._z=s,this._x=c,this._y=p,this.properties=e.properties,this.id=u}clone(){const e=new Vf(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const s of F5)this[s]!==void 0&&(e[s]=this[s]);return e}}class LM{constructor(e,s){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ul(Lt,16,0),this.featureIndexArray=new Th,this.promoteId=s,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,s,c,p,u,m=0,x=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,p,u,m);const P=this.grid;for(let y=0;y<s.length;y++){const A=s[y],I=[1/0,1/0,-1/0,-1/0];for(let E=0;E<A.length;E++){const M=A[E];I[0]=Math.min(I[0],M.x),I[1]=Math.min(I[1],M.y),I[2]=Math.max(I[2],M.x),I[3]=Math.max(I[3],M.y)}x!==0&&(I[0]-=x,I[1]-=x,I[2]+=x,I[3]+=x),I[0]<Lt&&I[1]<Lt&&I[2]>=0&&I[3]>=0&&P.insert(S,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Af.VectorTile(new Qy(this.rawTileData)).layers,this.sourceLayerCoder=new DM(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,s){const{tilespaceGeometry:c,transform:p,tileTransform:u,pixelPosMatrix:m,availableImages:x}=s;this.loadVTLayers(),this.serializedLayersCache.clear();const S=c.bufferedTilespaceBounds,P=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(E,M,R,z)=>Me(c.bufferedTilespaceGeometry,E,M,R,z));P.sort(N5);let y=null;p.elevation&&P.length>0&&(y=Lf.create(p.elevation,this.tileID));const A={};let I;for(let E=0;E<P.length;E++){const M=P[E];if(M===I)continue;I=M;const R=this.featureIndexArray.get(M);let z=null;this.is3DTile?this.loadMatchingModelFeature(A,R,e,c,p):this.loadMatchingFeature(A,R,e,x,(F,$,H,V=0)=>(z||(z=O(F,this.tileID.canonical,u)),$.queryIntersectsFeature(c,F,H,z,this.z,p,m,y,V)))}return A}loadMatchingFeature(e,s,c,p,u){const{featureIndex:m,bucketIndex:x,sourceLayerIndex:S,layoutVertexArrayOffset:P}=s,y=this.bucketLayerIDs[x],A=c.layers,I=Object.keys(A);if(I.length&&!function(F,$){for(let H=0;H<F.length;H++)if($.indexOf(F[H])>=0)return!0;return!1}(I,y))return;const E=c.sourceCache,M=this.sourceLayerCoder.decode(S),R=this.vtLayers[M].feature(m),z=this.getId(R,M);for(let F=0;F<y.length;F++){const $=y[F];if(!A[$])continue;const{styleLayer:H,targets:V}=A[$];let G={};z!==void 0&&(G=E.getFeatureState(H.sourceLayer,z));const Y=!u||u(R,H,G,P);if(!Y)continue;const te=new Vf(R,this.z,this.x,this.y,z);te.tile=this.tileID.canonical,te.state=G;let he=this.serializedLayersCache.get($);he||(he=H.serialize(),he.id=$,this.serializedLayersCache.set($,he)),te.source=he.source,te.sourceLayer=he["source-layer"],te.layer=Wi({},he),te.layer.paint=OM(he.paint,H.paint,R,G,p),te.layer.layout=OM(he.layout,H.layout,R,G,p);let ce=!1;for(const le of V){this.updateFeatureProperties(te,le);const{filter:Ee}=le;if(Ee){if(R.properties=te.properties,Ee.needGeometry){const de=N(R,!0);if(!Ee.filter(new bn(this.tileID.overscaledZ),de,this.tileID.canonical))continue}else if(!Ee.filter(new bn(this.tileID.overscaledZ),R))continue}ce=!0,le.targetId&&this.addFeatureVariant(te,le)}ce&&this.appendToResult(e,$,m,te,Y)}}loadMatchingModelFeature(e,s,c,p,u){const m=this.bucketLayerIDs[0][0],x=c.layers;if(!x[m])return;const{styleLayer:S,targets:P}=x[m];if(S.type!=="model")return;const y=p.tile,A=s.featureIndex,I=y.getBucket(S);if(!(I&&I instanceof x0))return;const E=function(he,ce,le,Ee){const de=he.getNodesInfo()[ce];if(de.hiddenByReplacement||!de.node.meshes)return;let Ae=Number.MAX_VALUE;const Pe=de.node,Ce=le.tile,ze=Ee.calculatePosMatrix(Ce.tileID.toUnwrapped(),Ee.worldSize),Ne=de.evaluatedScale;let Ge=0;Ee.elevation&&Pe.elevation&&(Ge=Pe.elevation*Ee.elevation.exaggeration()),Le.mat4.translate(ze,ze,[(Pe.anchor?Pe.anchor[0]:0)*(Ne[0]-1),(Pe.anchor?Pe.anchor[1]:0)*(Ne[1]-1),Ge]),Le.mat4.scale(ze,ze,Ne);const Fe=le.queryGeometry,at=Fe.isPointQuery()?Fe.screenBounds:Fe.screenGeometry,mt=function(zt){const Rt=Le.mat4.multiply([],ze,zt.matrix);Le.mat4.multiply(Rt,Ee.expandedFarZProjMatrix,Rt);for(let xt=0;xt<zt.meshes.length;++xt){const _t=zt.meshes[xt];if(xt===zt.lightMeshIndex)continue;const Yt=DA(at,Ee,Rt,_t.aabb);Yt!=null&&(Ae=Math.min(Yt,Ae))}if(zt.children)for(const xt of zt.children)mt(xt)};if(mt(Pe),Ae===Number.MAX_VALUE)return;const ot=new Xi(0,0);return qA(Ce.tileID.canonical,ot,de.node.anchor[0],de.node.anchor[1]),{intersectionZ:Ae,position:ot,feature:de.feature}}(I,A,p,u);if(!E)return;const{z:M,x:R,y:z}=y.tileID.canonical,{feature:F,intersectionZ:$,position:H}=E;let V={};F.id!==void 0&&(V=c.sourceCache.getFeatureState(S.sourceLayer,F.id));const G=new Vf({},M,R,z,F.id);G.tile=this.tileID.canonical,G.state=V,G.properties=F.properties,G.geometry={type:"Point",coordinates:[H.lng,H.lat]};let Y=this.serializedLayersCache.get(m);Y||(Y=S.serialize(),Y.id=m,this.serializedLayersCache.set(m,Y)),G.source=Y.source,G.sourceLayer=Y["source-layer"],G.layer=Wi({},Y);let te=!1;for(const he of P){this.updateFeatureProperties(G,he);const{filter:ce}=he;if(ce){if(F.properties=G.properties,ce.needGeometry){if(!ce.filter(new bn(this.tileID.overscaledZ),F,this.tileID.canonical))continue}else if(!ce.filter(new bn(this.tileID.overscaledZ),F))continue}te=!0,he.targetId&&this.addFeatureVariant(G,he)}te&&this.appendToResult(e,m,A,G,$)}updateFeatureProperties(e,s,c){if(s.properties){const p={};for(const u in s.properties){const m=s.properties[u].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,c);m!=null&&(p[u]=m)}e.properties=p}}addFeatureVariant(e,s,c){const p={target:s.target,namespace:s.namespace,uniqueFeatureID:s.uniqueFeatureID};s.properties&&(p.properties=e.properties),e.variants=e.variants||{},e.variants[s.targetId]=e.variants[s.targetId]||[],e.variants[s.targetId].push(p)}appendToResult(e,s,c,p,u){let m=e[s];m===void 0&&(m=e[s]=[]),m.push({featureIndex:c,feature:p,intersectionZ:u})}lookupSymbolFeatures(e,s,c,p,u){const m={};this.loadVTLayers();for(const x of e)this.loadMatchingFeature(m,{bucketIndex:s,sourceLayerIndex:c,featureIndex:x,layoutVertexArrayOffset:0},p,u);return m}loadFeature(e){const{featureIndex:s,sourceLayerIndex:c}=e;this.loadVTLayers();const p=this.sourceLayerCoder.decode(c),u=this.vtFeatures[p];if(u[s])return u[s];const m=this.vtLayers[p].feature(s);return u[s]=m,m}hasLayer(e){for(const s of this.bucketLayerIDs)for(const c of s)if(e===c)return!0;return!1}getId(e,s){let c=e.id;if(this.promoteId){const p=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[s];if(p!=null)if(Array.isArray(p)){if(!this.promoteIdExpression){const u=Lc(p);if(u.result!=="success"){const m=u.value.map(x=>`${x.key}: ${x.message}`).join(", ");return void Ti(`Failed to create expression for promoteId: ${m}`)}this.promoteIdExpression=u.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Yp),c=this.promoteIdExpression.evaluate({zoom:0},e)}else c=e.properties[p];typeof c=="boolean"&&(c=Number(c))}return c}}function OM(a,e,s,c,p){return so(a,(u,m)=>{const x=e instanceof Fc?e.get(m):null;return x&&x.evaluate?x.evaluate(s,c,p):x})}function N5(a,e){return e-a}Gt(LM,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const zM=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ob{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,c]=new Uint8Array(e,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=c>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const u=zM[15&c];if(!u)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new Ob(x,m,u,e)}constructor(e,s=64,c=Float64Array,p){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=c,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const u=zM.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-x%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${c}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+x+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=e)}add(e,s){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=e,this.coords[this._pos++]=s,c}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return zb(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,s,c,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:m,nodeSize:x}=this,S=[0,u.length-1,0],P=[];for(;S.length;){const y=S.pop()||0,A=S.pop()||0,I=S.pop()||0;if(A-I<=x){for(let z=I;z<=A;z++){const F=m[2*z],$=m[2*z+1];F>=e&&F<=c&&$>=s&&$<=p&&P.push(u[z])}continue}const E=I+A>>1,M=m[2*E],R=m[2*E+1];M>=e&&M<=c&&R>=s&&R<=p&&P.push(u[E]),(y===0?e<=M:s<=R)&&(S.push(I),S.push(E-1),S.push(1-y)),(y===0?c>=M:p>=R)&&(S.push(E+1),S.push(A),S.push(1-y))}return P}within(e,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:u,nodeSize:m}=this,x=[0,p.length-1,0],S=[],P=c*c;for(;x.length;){const y=x.pop()||0,A=x.pop()||0,I=x.pop()||0;if(A-I<=m){for(let z=I;z<=A;z++)FM(u[2*z],u[2*z+1],e,s)<=P&&S.push(p[z]);continue}const E=I+A>>1,M=u[2*E],R=u[2*E+1];FM(M,R,e,s)<=P&&S.push(p[E]),(y===0?e-c<=M:s-c<=R)&&(x.push(I),x.push(E-1),x.push(1-y)),(y===0?e+c>=M:s+c>=R)&&(x.push(E+1),x.push(A),x.push(1-y))}return S}}function zb(a,e,s,c,p,u){if(p-c<=s)return;const m=c+p>>1;kM(a,e,m,c,p,u),zb(a,e,s,c,m-1,1-u),zb(a,e,s,m+1,p,1-u)}function kM(a,e,s,c,p,u){for(;p>c;){if(p-c>600){const P=p-c+1,y=s-c+1,A=Math.log(P),I=.5*Math.exp(2*A/3),E=.5*Math.sqrt(A*I*(P-I)/P)*(y-P/2<0?-1:1);kM(a,e,s,Math.max(c,Math.floor(s-y*I/P+E)),Math.min(p,Math.floor(s+(P-y)*I/P+E)),u)}const m=e[2*s+u];let x=c,S=p;for(F_(a,e,c,s),e[2*p+u]>m&&F_(a,e,c,p);x<S;){for(F_(a,e,x,S),x++,S--;e[2*x+u]<m;)x++;for(;e[2*S+u]>m;)S--}e[2*c+u]===m?F_(a,e,c,S):(S++,F_(a,e,S,p)),S<=s&&(c=S+1),s<=S&&(p=S-1)}}function F_(a,e,s,c){kb(a,s,c),kb(e,2*s,2*c),kb(e,2*s+1,2*c+1)}function kb(a,e,s){const c=a[e];a[e]=a[s],a[s]=c}function FM(a,e,s,c){const p=a-s,u=e-c;return p*p+u*u}n.$=Fm,n.A=qr,n.B=2,n.C=y_,n.D=Of,n.E=el,n.F=XS,n.G=class extends y0{},n.H=Co,n.I=Sb,n.J=zd,n.K=by,n.L=ah,n.M=oh,n.N=ef,n.O=Dc,n.P=Se,n.Q=uf,n.R=Ki,n.S=yy,n.T=hb,n.U=Lc,n.V=y0,n.W=eh,n.X=Nl,n.Y=Sc,n.Z=vs,n._=oo,n.a=function(a){return pr.API_CDN_URL_REGEX.test(a)},n.a$=Vf,n.a0=Em,n.a1=my,n.a2=function(a){const e=a.value;let s=[];if(!e)return s;const c=Co(e);return c!=="string"?(s=s.concat([new y0(a.key,e,`string expected, "${c}" found`)]),s):(OA(e,!0)||(s=s.concat([new y0(a.key,e,`invalid url "${e}"`)])),s)},n.a3=Ye,n.a4=cf,n.a5=Dn,n.a6=wt,n.a7=class{constructor(a){this.specification=a}possiblyEvaluate(a,e){return As(a.expression.evaluate(e))}interpolate(a,e,s){return{x:di(a.x,e.x,s),y:di(a.y,e.y,s),z:di(a.z,e.z,s),azimuthal:di(a.azimuthal,e.azimuthal,s),polar:di(a.polar,e.polar,s)}}},n.a8=bn,n.a9=lh,n.aA=Po,n.aB=class{constructor(a){this.entries={},this.scheduler=a}request(a,e,s,c){const p=this.entries[a]=this.entries[a]||{callbacks:[]};if(p.result){const[u,m]=p.result;return this.scheduler?this.scheduler.add(()=>{c(u,m)},e):c(u,m),()=>{}}return p.callbacks.push(c),p.cancel||(p.cancel=s((u,m)=>{p.result=[u,m];for(const x of p.callbacks)this.scheduler?this.scheduler.add(()=>{x(u,m)},e):x(u,m);setTimeout(()=>delete this.entries[a],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(u=>u!==c),p.callbacks.length||(p.cancel(),delete this.entries[a]))}}},n.aC=ra,n.aD=function(a,e,s){const c=JSON.stringify(a.request);return a.data&&(this.deduped.entries[c]={result:[null,a.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},p=>{const u=br(a.request,(m,x,S,P)=>{m?p(m):x&&p(null,{vectorTile:s?void 0:new Af.VectorTile(new Qy(x)),rawData:x,cacheControl:S,expires:P})});return()=>{u.cancel(),p()}},e)},n.aE=function(a){si++,si>Je&&(a.getActor().send("enforceCacheSizeLimit",Oe),si=0)},n.aF=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},n.aG=vt,n.aH=bA,n.aI=MA,n.aJ=xA,n.aK=function(a,e){const s=document.createElement("video");s.muted=!0,s.onloadstart=function(){e(null,s)};for(let c=0;c<a.length;c++){const p=document.createElement("source");ds(a[c])||(s.crossOrigin="Anonymous"),p.src=a[c],s.appendChild(p)}return{cancel:()=>{}}},n.aL=f0,n.aM=function(a){return fetch(a).then(e=>e.arrayBuffer()).then(e=>IM(e,0,a))},n.aN=RM,n.aO=class{constructor(a,e,s,c){this.id=a,this.position=e!=null?new Xi(e[0],e[1]):new Xi(0,0),this.orientation=s??[0,0,0],this.nodes=c,this.uploaded=!1,this.aabb=new ei([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(a,e){if(Le.mat4.multiply(a.matrix,e,a.matrix),a.meshes)for(const s of a.meshes){const c=ei.applyTransformFast(s.aabb,a.matrix);this.aabb.encapsulate(c)}if(a.children)for(const s of a.children)this._applyTransformations(s,a.matrix)}computeBoundsAndApplyParent(){const a=Le.mat4.identity([]);for(const e of this.nodes)this._applyTransformations(e,a)}computeModelMatrix(a,e,s,c,p,u,m=!1){BA(this.matrix,this,a.transform,this.position,e,s,c,p,u,m)}upload(a){if(!this.uploaded){for(const e of this.nodes)_b(e,a);for(const e of this.nodes)v0(e);this.uploaded=!0}}destroy(){for(const a of this.nodes)gb(a)}},n.aP=Ur,n.aQ=b_,n.aR=Ps,n.aS=zr,n.aT=Na,n.aU=Or,n.aV=xr,n.aW=Km,n.aX=h0,n.aY=function(){$s.isLoading()||$s.isLoaded()||af()!=="deferred"||dh()},n.aZ=wy,n.a_=N,n.aa=o,n.ab=Le,n.ac=yi,n.ad=Fc,n.ae=bs,n.af=di,n.ag=Lt,n.ah=Qg,n.ai=yt,n.aj=Qi,n.ak=class{constructor(a){this.specification=a}possiblyEvaluate(a,e){return function([s,c]){const p=As([1,s,c]);return{x:p.x,y:p.y,z:p.z}}(a.expression.evaluate(e))}interpolate(a,e,s){return{x:di(a.x,e.x,s),y:di(a.y,e.y,s),z:di(a.z,e.z,s)}}},n.al=function(a,e,s=0,c=!0){const p=new Se(s,s),u=a.sub(p),m=e.add(p),x=[u,new Se(m.x,u.y),m,new Se(u.x,m.y)];return c&&x.push(u.clone()),x},n.am=function(a,e){const s=[];for(let c=0;c<a.length;c++){const p=Ai(c-1,-1,a.length-1),u=Ai(c+1,-1,a.length-1),m=a[c],x=a[u],S=a[p].sub(m).unit(),P=x.sub(m).unit(),y=P.angleWithSep(S.x,S.y),A=S.add(P).unit().mult(-1*e/Math.sin(y/2));s.push(m.add(A))}return s},n.an=oA,n.ao=Me,n.ap=function(a,e,s=0){return Le.vec3.fromValues(((e.x-s)*a.scale-a.x)*Lt,(e.y*a.scale-a.y)*Lt,Uy(e.z,e.y))},n.aq=xi,n.ar=ES,n.as=function(a){let e=1/0,s=1/0,c=-1/0,p=-1/0;for(const u of a)e=Math.min(e,u.x),s=Math.min(s,u.y),c=Math.max(c,u.x),p=Math.max(p,u.y);return{min:new Se(e,s),max:new Se(c,p)}},n.at=la,n.au=_e,n.av=g,n.aw=Ct,n.ax=ps,n.ay=function(a,e){const s={};for(let c=0;c<e.length;c++){const p=e[c];p in a&&(s[p]=a[p])}return s},n.az=dl,n.b=function(a){return pr.API_FONTS_REGEX.test(a)},n.b$=_0,n.b0=yc,n.b1=qx,n.b2=Ox,n.b3=O,n.b4=Fa,n.b5=Xm,n.b6=ai,n.b7=Hn,n.b8=o_,n.b9=lb,n.bA=iS,n.bB=ib,n.bC=iA,n.bD=Qx,n.bE=Ob,n.bF=Ai,n.bG=xc,n.bH=ms,n.bI=function(a,e,s){a[4*e+0]=s[0],a[4*e+1]=s[1],a[4*e+2]=s[2],a[4*e+3]=s[3]},n.bJ=Ih,n.bK=co,n.bL=jc,n.bM=Zn,n.bN=Mh,n.bO=Xi,n.bP=hA,n.bQ=ut,n.bR=Hi,n.bS=IA,n.bT=pt,n.bU=ts,n.bV=function(a,e,s,c,p,u,m,x,S){if(S.name==="globe")return ts(a,e,new pt(s,c,p),!1);const P=b_({z:s,x:c,y:p},S);return new ei([(u+P.x/P.scale)*e,e*(P.y/P.scale),m],[(u+P.x2/P.scale)*e,e*(P.y2/P.scale),x])},n.bW=function(a,e,s){let c=0;for(let p=0;p<2;++p)a[p]>0&&(c+=(a[p]-0)*(a[p]-0)),e[p]<0&&(c+=(0-e[p])*(0-e[p]));return c},n.bX=Gn,n.bY=By,n.bZ=function(a){const e=Le.mat4.identity(new Float64Array(16));Le.mat4.multiply(e,a.pixelMatrix,a.globeMatrix);const s=[0,qs,0],c=[0,Hs,0];return Le.vec3.transformMat4(s,s,e),Le.vec3.transformMat4(c,c,e),[s[0]>0&&s[0]<=a.width&&s[1]>0&&s[1]<=a.height&&!ho(a,new Xi(a.center.lat,90)),c[0]>0&&c[0]<=a.width&&c[1]>0&&c[1]<=a.height&&!ho(a,new Xi(a.center.lat,-90))]},n.b_=function(a,e){const{scale:s}=a.tileTransform,c=s*Lt/(a.tileSize*Math.pow(2,e.zoom-a.tileID.overscaledZ+a.tileID.canonical.z));return Le.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[c,c])},n.ba=function(a,e){const s=bs(e.zoom);if(s===0)return or(a);const c=On(a),p=mn(c),u=la(c.getWest())*e.worldSize,m=la(c.getEast())*e.worldSize,x=Po(c.getNorth())*e.worldSize,S=Po(c.getSouth())*e.worldSize,P=[u,x,0],y=[m,x,0],A=[u,S,0],I=[m,S,0],E=Le.mat4.invert([],e.globeMatrix);return Le.vec3.transformMat4(P,P,E),Le.vec3.transformMat4(y,y,E),Le.vec3.transformMat4(A,A,E),Le.vec3.transformMat4(I,I,E),p[0]=ar(p[0],A,s),p[1]=ar(p[1],I,s),p[2]=ar(p[2],y,s),p[3]=ar(p[3],P,s),ei.fromPoints(p)},n.bb=Tr,n.bc=dn,n.bd=ar,n.be=Vc,n.bf=ri,n.bg=Ib,n.bh=Qy,n.bi=br,n.bj=function(a){const e=[];for(const s in a)e.push(a[s]);return e},n.bk=function(a,e){const s=[];for(const c in a)c in e||s.push(c);return s},n.bl=Gi,n.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.bn=bt,n.bo=function(a,e){const{x:s,y:c}=a.point,p=Rs(s,c,a.worldSize/a._pixelsPerMercatorPixel,0,0);return Le.mat4.multiply(p,p,pn(or(e)))},n.bp=Mf,n.bq=Ro,n.br=Jy,n.bs=function(a,e,s,c,p){const u=5*e+2;a.float32[u+0]=s,a.float32[u+1]=c,a.float32[u+2]=p},n.bt=u0,n.bu=ZS,n.bv=X,n.bw=ns,n.bx=YE,n.by=LA,n.bz=tS,n.c=Dd,n.c$=(a,e,s,c,p,u,m,x)=>{const S=a.transform,P=S.pitch<15?SS(.07,.7,Ct((14-S.zoom)/5,0,1)):.07,y=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:MS(a,e,s,c),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:S.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:p,u_width_scale:u,u_floor_width_scale:m,u_image:0,u_tile_units_to_pixels:AS(e,S),u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toRenderColor(y?null:s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength"),u_zbias_factor:P,u_tile_to_meter:i(e.tileID.canonical,0)}},n.c0=CA,n.c1=function(a){const e=CA(a,!0);return Le.mat2.invert([],[e[0],e[1],e[4],e[5]])},n.c2=Bi,n.c3=function(a){const{x:e,y:s}=a.point,{lng:c,lat:p}=a._center;return Rs(e,s,a.worldSize,c,p)},n.c4=Kt,n.c5=Et,n.c6=$c,n.c7=function(a){const e=Math.round((a+45+360)%360/90)%4;return Zt[e]},n.c8=45,n.c9=Tf,n.cA=class extends aa{constructor(a){super(a),this.current=Qm}set(a,e,s){if(this.fetchUniformLocation(a,e)){for(let c=0;c<9;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}},n.cB=Jt,n.cC=function(a,e,s){const c=bs(s.zoom),p=a.style.map._antialias,u=a.terrain&&a.terrain.exaggeration()>0;return c===0&&!p&&!u},n.cD=function(a){const e=a.pixelsPerMeter,s=e/ms(1,a.center.lat),c=Le.mat4.identity(new Float64Array(16));return Le.mat4.translate(c,c,[a.point.x,a.point.y,0]),Le.mat4.scale(c,c,[s,s,e]),Float32Array.from(c)},n.cE=On,n.cF=function(a){const e=Gn-5;a=Ct(a,-e,e)/e*90;const s=Math.pow(Math.abs(Math.sin(yt(a))),3);return Math.round(s*(wf.length-1))},n.cG=function(a,e,s,c){const p=e.getNorth(),u=e.getSouth(),m=e.getWest(),x=e.getEast(),S=1<<a.z,P=x-m,y=p-u,A=P/qc,I=-y/wf[s],E=[0,A,0,I,0,0,p,m,0];if(a.z>0){const M=180/c;Le.mat3.multiply(E,E,[M/P+1,0,0,0,M/y+1,0,-.5*M/A,.5*M/I,1])}return E[2]=S,E[5]=a.x,E[8]=a.y,E},n.cH=or,n.cI=function(a,e,s){const c=Le.mat4.identity(new Float64Array(16)),p=(e/(1<<a)-.5)*Math.PI*2;return Le.mat4.rotateY(c,s.globeMatrix,p),Float32Array.from(c)},n.cJ=class{isDataAvailableAtPoint(a){const e=this._source();if(this.isUsingMockSource()||!e||a.y<0||a.y>1)return!1;const s=e.getSource().maxzoom,c=1<<s,p=Math.floor(a.x),u=Math.floor((a.x-p)*c),m=Math.floor(a.y*c),x=this.findDEMTileFor(new vt(s,p,s,u,m));return!(!x||!x.dem)}getAtPointOrZero(a,e=0){return this.getAtPoint(a,e)||0}getAtPoint(a,e,s=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const c=this._source();if(!c||a.y<0||a.y>1)return e;const p=c.getSource().maxzoom,u=1<<p,m=Math.floor(a.x),x=a.x-m,S=new vt(p,m,p,Math.floor(x*u),Math.floor(a.y*u)),P=this.findDEMTileFor(S);if(!P||!P.dem)return e;const y=P.dem,A=1<<P.tileID.canonical.z,I=(x*A-P.tileID.canonical.x)*y.dim,E=(a.y*A-P.tileID.canonical.y)*y.dim,M=Math.floor(I),R=Math.floor(E);return(s?this.exaggeration():1)*di(di(y.get(M,R),y.get(M,R+1),E-R),di(y.get(M+1,R),y.get(M+1,R+1),E-R),I-M)}getAtTileOffset(a,e,s){const c=1<<a.canonical.z;return this.getAtPointOrZero(new o(a.wrap+(a.canonical.x+e/Lt)/c,(a.canonical.y+s/Lt)/c))}getAtTileOffsetFunc(a,e,s,c){return p=>{const u=this.getAtTileOffset(a,p.x,p.y),m=c.upVector(a.canonical,p.x,p.y),x=c.upVectorScale(a.canonical,e,s).metersToTile;return Le.vec3.scale(m,m,u*x),m}}getForTilePoints(a,e,s,c){if(this.isUsingMockSource())return!1;const p=Lf.create(this,a,c);return!!p&&(e.forEach(u=>{u[2]=this.exaggeration()*p.getElevationAt(u[0],u[1],s)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(a);if(!e||!e.dem)return null;const s=e.dem.tree,c=e.tileID,p=1<<a.canonical.z-c.canonical.z;let u=a.canonical.x/p-c.canonical.x,m=a.canonical.y/p-c.canonical.y,x=0;for(let S=0;S<a.canonical.z-c.canonical.z&&!s.leaves[x];S++){u*=2,m*=2;const P=2*Math.floor(m)+Math.floor(u);x=s.childOffsets[x]+P,u%=1,m%=1}return{min:this.exaggeration()*s.minimums[x],max:this.exaggeration()*s.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,e,s){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const a=this.visibleDemTiles;if(a.length===0)return null;let e=!1,s=Number.MAX_VALUE,c=Number.MIN_VALUE;for(const p of a){const u=this.getMinMaxForTile(p.tileID);u&&(s=Math.min(s,u.min),c=Math.max(c,u.max),e=!0)}return e?{min:s,max:c}:null}},n.cK=IE,n.cL=ki,n.cM=function(a,e){return[Math.pow(a[0],2.2)*e,Math.pow(a[1],2.2)*e,Math.pow(a[2],2.2)*e]},n.cN=uo,n.cO=Rd,n.cP=Pd,n.cQ=256,n.cR=function(a,e){const s=[0,0,0],c=Tr(or(e.canonical));return Le.vec3.transformMat4(s,s,c),Le.vec3.transformMat4(s,s,a),s},n.cS=a=>({u_camera_to_center_distance:new Zn(a),u_extrude_scale:new e_(a),u_device_pixel_ratio:new Zn(a),u_matrix:new Ih(a),u_inv_rot_matrix:new Ih(a),u_merc_center:new co(a),u_tile_id:new jc(a),u_zoom_transition:new Zn(a),u_up_dir:new jc(a),u_emissive_strength:new Zn(a)}),n.cT=a=>({u_matrix:new Ih(a),u_pixels_to_tile_units:new e_(a),u_device_pixel_ratio:new Zn(a),u_width_scale:new Zn(a),u_floor_width_scale:new Zn(a),u_units_to_pixels:new co(a),u_dash_image:new Mh(a),u_gradient_image:new Mh(a),u_image_height:new Zn(a),u_texsize:new co(a),u_tile_units_to_pixels:new Zn(a),u_alpha_discard_threshold:new Zn(a),u_trim_offset:new co(a),u_trim_fade_range:new co(a),u_trim_color:new Ch(a),u_emissive_strength:new Zn(a),u_zbias_factor:new Zn(a),u_tile_to_meter:new Zn(a)}),n.cU=a=>({u_matrix:new Ih(a),u_texsize:new co(a),u_pixels_to_tile_units:new e_(a),u_device_pixel_ratio:new Zn(a),u_width_scale:new Zn(a),u_floor_width_scale:new Zn(a),u_image:new Mh(a),u_units_to_pixels:new co(a),u_tile_units_to_pixels:new Zn(a),u_alpha_discard_threshold:new Zn(a),u_trim_offset:new co(a),u_trim_fade_range:new co(a),u_trim_color:new Ch(a),u_emissive_strength:new Zn(a),u_zbias_factor:new Zn(a),u_tile_to_meter:new Zn(a)}),n.cV=qm,n.cW=jz,n.cX=$z,n.cY=Wc,n.cZ=(a,e,s,c,p,u)=>{const m=a.transform,x=m.projection.name==="globe";let S;if(u.paint.get("circle-pitch-alignment")==="map")if(x){const y=uo(m.zoom,e.canonical)*m._pixelsPerMercatorPixel;S=Float32Array.from([y,0,0,y])}else S=m.calculatePixelsToTileUnitsMatrix(s);else S=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const P={u_camera_to_center_distance:a.transform.getCameraToCenterDistance(m.projection),u_matrix:a.translatePosMatrix(e.projMatrix,s,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ye.devicePixelRatio,u_extrude_scale:S,u_inv_rot_matrix:Kl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(x){P.u_inv_rot_matrix=c,P.u_merc_center=p,P.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],P.u_zoom_transition=bs(m.zoom);const y=p[0]*Lt,A=p[1]*Lt;P.u_up_dir=m.projection.upVector(new pt(0,0,0),y,A)}return P},n.c_=CS,n.ca=Ch,n.cb=function(a,e,s){const c=Math.sqrt(a*a+e*e+s*s),p=c>0?Math.acos(s/c)*Ut:0;let u=a!==0||e!==0?Math.atan2(-e,-a)*Ut+90:0;return u<0&&(u+=360),[c,u,p]},n.cc=i,n.cd=ei,n.ce=As,n.cf=function(a){return[Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]},n.cg=function(a,e){return a.readFields(Ok,{icons:[]},e)},n.ch=function(a){return a({pluginStatus:Cs,pluginURL:ol}),Oc.on("pluginStateChange",a),a},n.ci=b0,n.cj=If,n.ck=eb,n.cl=Jo,n.cm=Om,n.cn=Re,n.co=Ao,n.cp=Bn,n.cq=function(a){const e=a.indexOf(df);return e>=0?a.slice(0,e):a},n.cr=function(a){return a.indexOf(df)>=0},n.cs=function(a){const e=a.indexOf(df);return e>=0?a.slice(e+1):""},n.ct=function(a){const e=[],s=a.id;return s===void 0&&e.push({message:`layers.${s}: missing required property "id"`}),a.render===void 0&&e.push({message:`layers.${s}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&e.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),e},n.cu=function(a,e,s,c){return a.type==="custom"?new xk(a,e):new Rk[a.type](a,e,s,c)},n.cv=Ma,n.cw=class extends Vf{constructor(a,e){super(a._vectorTileFeature,a._z,a._x,a._y,a.id),a.state&&(this.state=Object.assign({},a.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=a.source,this.sourceLayer=a.sourceLayer,this.layer=a.layer)}toJSON(){const a=super.toJSON();return a.target=this.target,a.namespace=this.namespace,a}},n.cx=Oc,n.cy=mr,n.cz=ky,n.d=function(a){return pr.API_TILEJSON_REGEX.test(a)},n.d$=LM,n.d0=(a,e,s,c,p,u,m,x,S)=>{const P=a.transform,y=P.calculatePixelsToTileUnitsMatrix(e),A=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none",I=P.pitch<15?SS(.07,.7,Ct((14-P.zoom)/5,0,1)):.07;return{u_matrix:MS(a,e,s,c),u_pixels_to_tile_units:y,u_device_pixel_ratio:u,u_width_scale:m,u_floor_width_scale:x,u_units_to_pixels:[1/P.pixelsToGLUnits[0],1/P.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:IS(s)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:AS(e,a.transform),u_alpha_discard_threshold:0,u_trim_offset:S,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toRenderColor(A?null:s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength"),u_zbias_factor:I,u_tile_to_meter:i(e.tileID.canonical,0)}},n.d1=sr,n.d2=s_,n.d3=mS,n.d4=Nt,n.d5=Ky,n.d6=Xc,n.d7=450,n.d8=7,n.d9=vk,n.dA=Si,n.dB=h,n.dC=Zl,n.dD=function([a,e,s]){const c=Math.hypot(a,e,s),p=Math.atan2(a,s),u=.5*Math.PI-Math.acos(-e/c);return new Xi(Kt(p),Kt(u))},n.dE=fb,n.dF=function(a){const e=a.navigator?a.navigator.userAgent:null;return!!function(s){if(vc==null){const c=s.navigator?s.navigator.userAgent:null;vc=!!s.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return vc}(a)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},n.dG=function(a,e){Oe=a,Je=e},n.dH=ho,n.dI=ca,n.dJ=function(a){const e=[0,0,0],s=Le.mat4.identity(new Float64Array(16));return Le.mat4.multiply(s,a.pixelMatrix,a.globeMatrix),Le.vec3.transformMat4(e,e,s),new Se(e[0],e[1])},n.dK=function(a,e,s=!1){if(Cs===hh||Cs===of||Cs===Lm)throw new Error("setRTLTextPlugin cannot be called multiple times.");ol=ye.resolveURL(a),Cs=hh,na=e,zm(),s||dh()},n.dL=af,n.dM=function(){b0().acquire(vb)},n.dN=function(){const a=I_;a&&(a.isPreloaded()&&a.numActive()===1?(a.release(vb),I_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},n.dO=Oh,n.dP=function(a){const e=It();if(!e)return;const s=e.delete(qe);a&&s.catch(a).then(()=>a())},n.dQ=C_,n.dR=wM,n.dS=function(a){Pb=ye.resolveURL(a),Bf||(Bf=new Of(b0(),new el)),Bf.broadcast("setDracoUrl",Pb)},n.dT=TM,n.dU=function(a){Nf=ye.resolveURL(a),Bf||(Bf=new Of(b0(),new el)),Bf.broadcast("setMeshoptUrl",Nf)},n.dV=Gt,n.dW=Zc,n.dX=Ua,n.dY=Af,n.dZ=class{constructor(a,e){this.pos=a,this.dir=e}intersectsPlane(a,e,s){const c=Le.vec2.dot(e,this.dir);if(Math.abs(c)<1e-6)return!1;const p=((a[0]-this.pos[0])*e[0]+(a[1]-this.pos[1])*e[1])/c;return s[0]=this.pos[0]+this.dir[0]*p,s[1]=this.pos[1]+this.dir[1]*p,!0}},n.d_=DM,n.da=en,n.db=Ym,n.dc=256,n.dd=pn,n.de=sa,n.df=cl,n.dg=_f,n.dh=function(a,e,s,c,p){return Ct((a-e)/(s-e)*(p-c)+c,c,p)},n.di=Jd,n.dj=Gc,n.dk=class{constructor(a,e,s,c){this.context=a,this.format=c,this.size=s,this.texture=a.gl.createTexture();const[p,u,m]=this.size,{gl:x}=a;x.bindTexture(x.TEXTURE_3D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),x.texImage3D(x.TEXTURE_3D,0,this.format,p,u,m,0,cb(this.format),ub(this.format),e.data)}bind(a,e){const{context:s}=this,{gl:c}=s;c.bindTexture(c.TEXTURE_3D,this.texture),a!==this.minFilter&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MAG_FILTER,a),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MIN_FILTER,a),this.minFilter=a),e!==this.wrapS&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_S,e),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}},n.dl=pb,n.dm=[1,1,1],n.dn=Lf,n.dp=Df,n.dq=ll,n.dr=Uc,n.ds=Xl,n.dt=gf,n.du=oa,n.dv=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Se(1/0,1/0),max:new Se(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(a,e=!1){const s=JE(new Se(0,0),new Se(Lt,Lt),a),c=[];if(e&&!Bx(s,this._globalClipBounds))return c;for(const p of this._activeRegions){if(p.hiddenByOverlap||!Bx(s,p))continue;const u=mz(p.min,p.max,a);c.push({min:u.min,max:u.max,sourceId:this._sourceIds[p.priority],footprint:p.footprint,footprintTileId:p.tileId,order:p.order,clipMask:p.clipMask,clipScope:p.clipScope})}return c}setSources(a){this._setSources(a.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const s=[];for(const c of e.cache.getVisibleCoordinates()){const p=e.cache.getTile(c).buckets[e.layer];p&&p.updateFootprints(c.toUnwrapped(),s)}return s},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(a){const e=a.getFootprints();if(e.length===0)return;const s=a.getOrder(),c=a.getClipMask(),p=a.getClipScope();for(const u of e){if(!u.footprint)continue;const m=JE(u.footprint.min,u.footprint.max,u.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:u.id,footprint:u.footprint,order:s,clipMask:c,clipScope:p})}this._sourceIds.push(a.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,s)=>e.priority-s.priority||Xy(e.min,s.min)||Xy(e.max,s.max)||e.order-s.order||e.clipMask-s.clipMask||function(c,p){const u=(m,x)=>m+x;return c.length-p.length||c.reduce(u,"").localeCompare(p.reduce(u,""))}(e.clipScope,s.clipScope));let a=this._activeRegions.length!==this._prevRegions.length;if(!a){let e=0;for(;!a&&e!==this._activeRegions.length;){const s=this._activeRegions[e],c=this._prevRegions[e];a=s.priority!==c.priority||!KE(s,c)||s.order!==c.order||s.clipMask!==c.clipMask||!bt(s.clipScope,c.clipScope),++e}}if(a){++this._updateTime;for(const s of this._activeRegions)s.order!==Zy&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,s.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,s.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,s.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,s.max.y));const e=s=>{const c=this._activeRegions;if(s>=c.length)return s;const p=c[s].priority;for(;s<c.length&&c[s].priority===p;)++s;return s};if(this._sourceIds.length>1){let s=0,c=e(s);for(;s!==c;){let p=s;const u=s;for(;p!==c;){const m=this._activeRegions[p];m.hiddenByOverlap=!1;for(let x=0;x<u;x++){const S=this._activeRegions[x];if(!S.hiddenByOverlap&&m.order===Zy&&Bx(m,S)&&(m.hiddenByOverlap=eS(m.footprint,m.tileId,S.footprint,S.tileId),m.hiddenByOverlap))break}++p}s=c,c=e(s)}}}}_setSources(a){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=a.length-1;e>=0;e--)this._addSource(a[e]);this._computeReplacement()}},n.dw=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy()}_fillGridMeshWithLods(a,e){const s=new Fa,c=new Or,p=[],u=a+1+2,m=e[0]+1,x=e[0]+1+(1+e.length),S=(P,y,A)=>{let I=P===u-1?P-2:P===0?P:P-1;return I+=A?24575:0,[I,y]};for(let P=0;P<u;++P)s.emplaceBack(...S(P,0,!0));for(let P=0;P<m;++P)for(let y=0;y<u;++y)s.emplaceBack(...S(y,P,(y===0||y===u-1)&&!0));for(let P=0;P<e.length;++P){const y=e[P];for(let A=0;A<u;++A)s.emplaceBack(...S(A,y,!0))}for(let P=0;P<e.length;++P){const y=c.length,A=e[P]+1+2,I=new Or;for(let R=0;R<A-1;R++){const z=R===A-2,F=z?u*(x-e.length+P-R):u;for(let $=0;$<u-1;$++){const H=R*u+$;R===0||z||$===0||$===u-2?(I.emplaceBack(H+1,H,H+F),I.emplaceBack(H+F,H+F+1,H+1)):(c.emplaceBack(H+1,H,H+F),c.emplaceBack(H+F,H+F+1,H+1))}}const E=Hn.simpleSegment(0,y,s.length,c.length-y);for(let R=0;R<I.uint16.length;R+=3)c.emplaceBack(I.uint16[R],I.uint16[R+1],I.uint16[R+2]);const M=Hn.simpleSegment(0,y,s.length,c.length-y);p.push({withoutSkirts:E,withSkirts:M})}return{vertices:s,indices:c,segments:p}}_createGrid(a){const e=this._fillGridMeshWithLods(qc,wf);this._gridSegments=e.segments,this._gridBuffer=a.createVertexBuffer(e.vertices,ai.members),this._gridIndexBuffer=a.createIndexBuffer(e.indices,!0)}_createPoles(a){const e=new Or;for(let m=0;m<=qc;m++)e.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=a.createIndexBuffer(e,!0);const s=new cl,c=new cl,p=new cl,u=new cl;this._poleSegments=[];for(let m=0,x=0;m<$c;m++){const S=360/(1<<m);s.emplaceBack(0,-ps,0,.5,0),c.emplaceBack(0,-ps,0,.5,1),p.emplaceBack(0,-ps,0,.5,.5),u.emplaceBack(0,-ps,0,.5,.5);for(let P=0;P<=qc;P++){let y=P/qc,A=0;const I=di(0,S,y),[E,M,R]=Hc(Yl,ua,I,ps);s.emplaceBack(E,M,R,y,A),c.emplaceBack(E,M,R,y,1-A);const z=yt(I);y=.5+.5*Math.sin(z),A=.5+.5*Math.cos(z),p.emplaceBack(E,M,R,y,A),u.emplaceBack(E,M,R,y,1-A)}this._poleSegments.push(Hn.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(s,fi,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(c,fi,!1),this._texturedPoleNorthVertexBuffer=a.createVertexBuffer(p,fi,!1),this._texturedPoleSouthVertexBuffer=a.createVertexBuffer(u,fi,!1)}getGridBuffers(a,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}},n.dx=Zy,n.dy=Ht,n.dz=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},n.e=pr,n.e0=bS,n.e1=so,n.e2=ia,n.e3=YS,n.e4=function(a,e,s,c,p,u,m,x,S,P,y=1,A,I){a.createArrays(),a.tilePixelRatio=Lt/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const E=a.layers[0].layout,M=a.layers[0]._unevaluatedLayout._values,R={};R.scaleFactor=y,R.textSizeScaleRange=E.get("text-size-scale-range"),R.iconSizeScaleRange=E.get("icon-size-scale-range");const[z,F]=R.textSizeScaleRange,[$,H]=R.iconSizeScaleRange;if(R.textScaleFactor=Ct(R.scaleFactor,z,F),R.iconScaleFactor=Ct(R.scaleFactor,$,H),a.textSizeData.kind==="composite"){const{minZoom:te,maxZoom:he}=a.textSizeData;R.compositeTextSizes=[M["text-size"].possiblyEvaluate(new bn(te),x),M["text-size"].possiblyEvaluate(new bn(he),x)]}if(a.iconSizeData.kind==="composite"){const{minZoom:te,maxZoom:he}=a.iconSizeData;R.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new bn(te),x),M["icon-size"].possiblyEvaluate(new bn(he),x)]}R.layoutTextSize=M["text-size"].possiblyEvaluate(new bn(S+1),x),R.layoutIconSize=M["icon-size"].possiblyEvaluate(new bn(S+1),x),R.textMaxSize=M["text-size"].possiblyEvaluate(new bn(18),x);const V=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point",G=E.get("text-size");let Y=!1;for(const te of a.features)if(te.icon&&te.icon.nameSecondary){Y=!0;break}for(const te of a.features){const he=E.get("text-font").evaluate(te,{},x).join(","),ce=G.evaluate(te,{},x)*R.textScaleFactor,le=R.layoutTextSize.evaluate(te,{},x)*R.textScaleFactor,Ee=(R.layoutIconSize.evaluate(te,{},x),{horizontal:{},vertical:void 0}),de=te.text;let Ae,Pe=[0,0];if(de){const Ne=de.toString(),Ge=E.get("text-letter-spacing").evaluate(te,{},x)*ns,Fe=E.get("text-line-height").evaluate(te,{},x)*ns,at=mx(Ne)?Ge:0,mt=E.get("text-anchor").evaluate(te,{},x),ot=E.get("text-variable-anchor");if(!ot){const Yt=E.get("text-radial-offset").evaluate(te,{},x);Pe=Yt?iA(mt,[Yt*ns,tb]):E.get("text-offset").evaluate(te,{},x).map(Ft=>Ft*ns)}let zt=V?"center":E.get("text-justify").evaluate(te,{},x);const Rt=E.get("symbol-placement")==="point",xt=Rt?E.get("text-max-width").evaluate(te,{},x)*ns:1/0,_t=Yt=>{a.allowVerticalPlacement&&Im(Ne)&&(Ee.vertical=Jx(de,e,s,p,he,xt,Fe,mt,Yt,at,Pe,Ro.vertical,!0,le,ce))};if(!V&&ot){const Yt=zt==="auto"?ot.map(jt=>ib(jt)):[zt];let Ft=!1;for(let jt=0;jt<Yt.length;jt++){const mi=Yt[jt];if(!Ee.horizontal[mi])if(Ft)Ee.horizontal[mi]=Ee.horizontal[0];else{const Ei=Jx(de,e,s,p,he,xt,Fe,"center",mi,at,Pe,Ro.horizontal,!1,le,ce);Ei&&(Ee.horizontal[mi]=Ei,Ft=Ei.positionedLines.length===1)}}_t("left")}else{if(zt==="auto"&&(zt=ib(mt)),Rt||E.get("text-writing-mode").indexOf("horizontal")>=0||!Im(Ne)){const Yt=Jx(de,e,s,p,he,xt,Fe,mt,zt,at,Pe,Ro.horizontal,!1,le,ce);Yt&&(Ee.horizontal[zt]=Yt)}_t(Rt?"left":zt)}}let Ce=!1;if(te.icon&&te.icon.namePrimary){const Ne=Wx(a.iconSizeData,M["icon-size"],x,a.zoom,te)*R.iconScaleFactor*A,Ge=te.icon.getPrimary().scaleSelf(Ne).serialize(),Fe=c[Ge];Fe&&(Ae=Qz(p[Ge],te.icon.nameSecondary?p[te.icon.getSecondary().scaleSelf(Ne).serialize()]:void 0,E.get("icon-offset").evaluate(te,{},x),E.get("icon-anchor").evaluate(te,{},x)),Ce=Fe.sdf,a.sdfIcons===void 0?a.sdfIcons=Fe.sdf:a.sdfIcons!==Fe.sdf&&Ti("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Fe.pixelRatio!==a.pixelRatio||E.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}const ze=rA(Ee.horizontal)||Ee.vertical;a.iconsInText||(a.iconsInText=!!ze&&ze.iconsInText),(ze||Ae)&&ok(a,te,Ee,Ae,c,R,le,0,Pe,Ce,m,x,P,I,Y)}u&&a.generateCollisionDebugBuffers(S,a.collisionBoxArray,R.textScaleFactor)},n.e5=M0,n.e6=Ze,n.e7=GE,n.e8=zS,n.e9=k,n.ea=function(a){let e=0;if(new Uint32Array(a,0,1)[0]!==SM){const s=new Uint32Array(a,0,7),[,,c,p,u,m]=s;e=s.byteLength+p+u+m+u,(c!==a.byteLength||e>=a.byteLength)&&Ti("Invalid b3dm header information.")}return IM(a,e)},n.eb=function(a,e){const s=RM(a);for(const c of s){for(const p of c.meshes)z5(p);c.lights&&(c.lightMeshIndex=c.meshes.length,c.meshes.push(k5(c.lights,e)))}return s},n.ec=x0,n.ed=HA,n.ee=$s,n.ef=function(a){Pt(),Qe!=null&&Qe.then(e=>{e.keys().then(s=>{for(let c=0;c<s.length-a;c++)e.delete(s[c])})})},n.f=function(a){return a.indexOf("mapbox:")===0},n.g=function(a,e){return mr(Wi(a,{method:"GET"}),e)},n.h=Fu,n.i=function(a){return pr.API_STYLE_REGEX.test(a)&&!Dd(a)},n.j=function(a){return decodeURIComponent(atob(a).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},n.k=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,(e,s)=>String.fromCharCode(+("0x"+s))))},n.l=Wi,n.m=ui,n.n=function(a,e){return mr(Wi(a,{type:"json"}),e)},n.o=Up,n.p=function(a,e){return mr(Wi(a,{method:"POST"}),e)},n.q=ye,n.r=Gr,n.s=function(a){try{const e=self[a];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},n.t=oe,n.u=function(){return function a(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()},n.v=function(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)},n.w=Ti,n.x=function(){return xb||(xb=new Oh),xb},n.y=Ld,n.z=ea}),b(["./shared"],function(n){function k(et){const K=et?et.url.toString():void 0;return K?performance.getEntriesByName(K):[]}function j(et){if(typeof et=="number"||typeof et=="boolean"||typeof et=="string"||et==null)return JSON.stringify(et);if(Array.isArray(et)){let ie="[";for(const oe of et)ie+=`${j(oe)},`;return`${ie}]`}let K="{";for(const ie of Object.keys(et).sort())K+=`${ie}:${j(et[ie])},`;return`${K}}`}function U(et){let K="";for(const ie of n.bm)(et.type!=="model"||ie!=="minzoom"&&ie!=="maxzoom")&&(K+=`/${j(et[ie])}`);return K}class Z{constructor(K){this.keyCache={},this._layers={},this._layerConfigs={},K&&this.replace(K)}replace(K,ie){this._layerConfigs={},this._layers={},this.update(K,[],ie)}update(K,ie,oe){this._options=oe;for(const xe of K)this._layerConfigs[xe.id]=xe,(this._layers[xe.id]=n.cu(xe,this.scope,null,this._options)).compileFilter(oe),this.keyCache[xe.id]&&delete this.keyCache[xe.id];for(const xe of ie)delete this.keyCache[xe],delete this._layerConfigs[xe],delete this._layers[xe];this.familiesBySource={};const ye=function(xe,Re){const qe={};for(let Je=0;Je<xe.length;Je++){const Ke=xe[Je];let Qe=Re&&Re[Ke.id];!Qe&&(Qe=U(Ke),Ke.type==="line"&&Ke.paint)&&function It(Pt){return typeof Pt=="string"&&Pt==="line-progress"||(Array.isArray(Pt)?Pt.some(It):!(!Pt||typeof Pt!="object")&&Object.values(Pt).some(It))}(Ke.paint["line-width"])&&(Qe+=`/${j(Ke.paint["line-width"])}`),Re&&(Re[Ke.id]=Qe);let ft=qe[Qe];ft||(ft=qe[Qe]=[]),ft.push(Ke)}const Oe=[];for(const Je in qe)Oe.push(qe[Je]);return Oe}(n.bj(this._layerConfigs),this.keyCache);for(const xe of ye){const Re=xe.map(ft=>this._layers[ft.id]),qe=Re[0];if(qe.visibility==="none")continue;const Oe=qe.source||"";let Je=this.familiesBySource[Oe];Je||(Je=this.familiesBySource[Oe]={});const Ke=qe.sourceLayer||"_geojsonTileLayer";let Qe=Je[Ke];Qe||(Qe=Je[Ke]=[]),Qe.push(Re)}}}const re=1*n.dX;class se{constructor(K){const ie={},oe=[];for(const qe in K){const Oe=K[qe],Je=ie[qe]={};for(const Ke in Oe.glyphs){const Qe=Oe.glyphs[+Ke];if(!Qe||Qe.bitmap.width===0||Qe.bitmap.height===0)continue;const ft=Qe.metrics.localGlyph?re:1,It={x:0,y:0,w:Qe.bitmap.width+2*ft,h:Qe.bitmap.height+2*ft};oe.push(It),Je[Ke]=It}}const{w:ye,h:xe}=n.F(oe),Re=new n.dW({width:ye||1,height:xe||1});for(const qe in K){const Oe=K[qe];for(const Je in Oe.glyphs){const Ke=Oe.glyphs[+Je];if(!Ke||Ke.bitmap.width===0||Ke.bitmap.height===0)continue;const Qe=ie[qe][Je],ft=Ke.metrics.localGlyph?re:1;n.dW.copy(Ke.bitmap,Re,{x:0,y:0},{x:Qe.x+ft,y:Qe.y+ft},Ke.bitmap)}}this.image=Re,this.positions=ie}}n.dV(se,"GlyphAtlas");const ue="3d_elevation_id",ne="hd_road_elevation";class be{constructor(){this._valid=!1}reset(K){return this.feature=K,this._valid=!0,this._geometry=K.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(K,ie){return this._valid&&K(ie(this._geometry)),this}require(K,ie,oe){return this.get(K,!0,ie,oe)}optional(K,ie,oe){return this.get(K,!1,ie,oe)}success(){return this._valid}get(K,ie,oe,ye){const xe=this.feature.properties.hasOwnProperty(K)?+this.feature.properties[K]:void 0;return this._valid&&xe!==void 0?oe(ye?ye(xe):xe):ie&&(this._valid=!1),this}}class De{constructor(K,ie){this.featureFunc=K,this.vertexFunc=ie}parseFeature(K,ie,oe){return this.featureFunc(K,ie,oe)}parseVertex(K,ie,oe){return this.vertexFunc(K,ie,oe)}}const Be=new De((et,K,ie)=>et.reset(K).require(ue,oe=>{ie.id=oe}).optional("fixed_height_relative",oe=>{ie.constantHeight=oe},me.decodeRelativeHeight).geometry(oe=>{ie.bounds=oe},me.computeBounds).success(),(et,K,ie)=>et.reset(K).require(ue,oe=>{ie.id=oe}).require("elevation_idx",oe=>{ie.idx=oe}).require("extent",oe=>{ie.extent=oe}).require("height_relative",oe=>{ie.height=oe},me.decodeRelativeHeight).geometry(oe=>{ie.position=oe},me.getPoint).success()),Te=new De((et,K,ie)=>et.reset(K).require(ue,oe=>{ie.id=oe}).optional("fixed_height",oe=>{ie.constantHeight=oe},me.decodeMetricHeight).geometry(oe=>{ie.bounds=oe},me.computeBounds).success(),(et,K,ie)=>et.reset(K).require(ue,oe=>{ie.id=oe}).require("elevation_idx",oe=>{ie.idx=oe}).require("extent",oe=>{ie.extent=oe}).require("height",oe=>{ie.height=oe},me.decodeMetricHeight).geometry(oe=>{ie.position=oe},me.getPoint).success());class me{static computeBounds(K){const ie=new n.P(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),oe=new n.P(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const ye of K[0])ie.x>ye.x&&(ie.x=ye.x),ie.y>ye.y&&(ie.y=ye.y),oe.x<ye.x&&(oe.x=ye.x),oe.y<ye.y&&(oe.y=ye.y);return{min:ie,max:oe}}static getPoint(K){return n.ab.vec2.fromValues(K[0][0].x,K[0][0].y)}static decodeRelativeHeight(K){return 1e-4*K*5}static decodeMetricHeight(K){return 1e-4*K}static parse(K){const ie=[],oe=[],ye=K.length,xe=new be;for(let qe=0;qe<ye;qe++){const Oe=K.feature(qe),Je=Oe.properties.hasOwnProperty("version")?String(Oe.properties.version):void 0,Ke=(Re=Je)?Re==="1.0.1"?Te:void 0:Be;if(Ke===void 0){n.w(`Unknown elevation feature version number ${Je||"(unknown)"}`);continue}const Qe=Oe.properties.hasOwnProperty("type")?Oe.properties.type:void 0;if(Qe){if(n.dY.VectorTileFeature.types[Oe.type]==="Point"&&Qe==="curve_point"){const ft={};Ke.parseVertex(xe,Oe,ft)&&ie.push(ft)}else if(n.dY.VectorTileFeature.types[Oe.type]==="Polygon"&&Qe==="curve_meta"){const ft={};Ke.parseFeature(xe,Oe,ft)&&oe.push(ft)}}}var Re;return{vertices:ie,features:oe}}}class Ie{constructor(K,ie,oe,ye,xe,Re){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=K,this.heightRange={min:oe,max:oe},this.safeArea=ie,this.constantHeight=oe,this.constantHeight==null&&(this.constantHeight!=null||ye.length!==0)){this.vertices=ye,this.edges=xe,this.edges=this.edges.filter(qe=>qe.a<this.vertices.length&&qe.b<this.vertices.length&&!n.ab.vec2.exactEquals(this.vertices[qe.a].position,this.vertices[qe.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const qe of this.vertices)this.vertexProps.push({dir:n.ab.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,qe.height),this.heightRange.max=Math.max(this.heightRange.max,qe.height);for(const qe of this.edges){const Oe=this.vertices[qe.a].position,Je=this.vertices[qe.b].position,Ke=n.ab.vec2.subtract(n.ab.vec2.create(),Je,Oe),Qe=n.ab.vec2.length(Ke),ft=n.ab.vec2.scale(n.ab.vec2.create(),Ke,1/Qe);this.edgeProps.push({vec:Ke,dir:ft,len:Qe});const It=this.vertexProps[qe.a].dir,Pt=this.vertexProps[qe.b].dir;n.ab.vec2.add(It,It,ft),n.ab.vec2.add(Pt,Pt,ft)}for(const qe of this.vertexProps)qe.dir[0]===0&&qe.dir[1]===0||n.ab.vec2.normalize(qe.dir,qe.dir);this.tessellate(Re)}}pointElevation(K){if(this.constantHeight!=null)return this.constantHeight;const ie=this.getClosestEdge(K);if(ie==null)return 0;const[oe,ye]=ie;return(1-(xe=ye))*this.vertices[this.edges[oe].a].height+xe*this.vertices[this.edges[oe].b].height;var xe}getClosestEdge(K){if(this.edges.length===0)return;let ie=0,oe=Number.POSITIVE_INFINITY,ye=0;const xe=n.ab.vec2.fromValues(K.x,K.y);for(let Re=0;Re<this.edges.length;Re++){const qe=this.edges[Re],Oe=this.edgeProps[Re].dir,Je=new n.dZ(xe,this.edgeProps[Re].dir),Ke=this.vertices[qe.a].position,Qe=this.vertices[qe.b].position,ft=n.ab.vec2.create(),It=n.ab.vec2.create(),Pt=Je.intersectsPlane(Ke,this.vertexProps[qe.a].dir,ft),si=Je.intersectsPlane(Qe,this.vertexProps[qe.b].dir,It);if(!Pt||!si)continue;const ui=n.ab.vec2.subtract(n.ab.vec2.create(),It,ft),hi=n.ab.vec2.subtract(n.ab.vec2.create(),xe,ft),ci=n.ab.vec2.dot(ui,ui),Ni=ci>0?n.ab.vec2.dot(hi,ui)/ci:0,$i=n.aw(Ni,0,1),Ii=Math.abs((Ni-$i)*this.edgeProps[Re].len),Zi=n.ab.vec2.subtract(n.ab.vec2.create(),xe,Ke),Ki=Ii+Math.abs(n.ab.vec2.dot(Zi,n.ab.vec2.fromValues(Oe[1],-Oe[0])));Ki<oe&&(ie=Re,oe=Ki,ye=$i)}return[ie,ye]}tessellate(K){for(let ie=this.edges.length-1;ie>=0;--ie){const oe=this.edges[ie].a,ye=this.edges[ie].b,{position:xe,height:Re,extent:qe}=this.vertices[oe],{position:Oe,height:Je,extent:Ke}=this.vertices[ye],Qe=this.vertexProps[oe].dir,ft=this.vertexProps[ye].dir,It=n.ab.vec3.fromValues(xe[0]/K,xe[1]/K,Re),Pt=n.ab.vec3.fromValues(Oe[0]/K,Oe[1]/K,Je),si=n.ab.vec3.fromValues(Qe[1],-Qe[0],0);n.ab.vec3.scale(si,si,qe);const ui=n.ab.vec3.fromValues(ft[1],-ft[0],0);if(n.ab.vec3.scale(ui,ui,Ke),this.distSqLines(n.ab.vec3.fromValues(It[0]+.5*si[0],It[1]+.5*si[1],It[2]+.5*si[2]),n.ab.vec3.fromValues(Pt[0]-.5*ui[0],Pt[1]-.5*ui[1],Pt[2]-.5*ui[2]),n.ab.vec3.fromValues(It[0]-.5*si[0],It[1]-.5*si[1],It[2]-.5*si[2]),n.ab.vec3.fromValues(Pt[0]+.5*ui[0],Pt[1]+.5*ui[1],Pt[2]+.5*ui[2]))<=.05*.05)continue;const hi=this.vertices.length,ci=n.ab.vec2.add(n.ab.vec2.create(),xe,Oe);this.vertices.push({position:n.ab.vec2.scale(ci,ci,.5),height:.5*(Re+Je),extent:.5*(qe+Ke)});const Ni=n.ab.vec2.add(n.ab.vec2.create(),Qe,ft);this.vertexProps.push({dir:n.ab.vec2.normalize(Ni,Ni)}),this.edges.splice(ie,1),this.edgeProps.splice(ie,1),this.edges.push({a:oe,b:hi}),this.edges.push({a:hi,b:ye});const $i=n.ab.vec2.subtract(n.ab.vec2.create(),this.vertices[hi].position,xe),Ii=n.ab.vec2.length($i),Zi={vec:$i,dir:n.ab.vec2.scale(n.ab.vec2.create(),$i,1/Ii),len:Ii};this.edgeProps.push(Zi),this.edgeProps.push(Zi)}}distSqLines(K,ie,oe,ye){const xe=n.ab.vec3.subtract(n.ab.vec3.create(),ie,K),Re=n.ab.vec3.subtract(n.ab.vec3.create(),ye,oe),qe=n.ab.vec3.subtract(n.ab.vec3.create(),K,oe),Oe=n.ab.vec3.dot(xe,xe),Je=n.ab.vec3.dot(xe,Re),Ke=n.ab.vec3.dot(xe,qe),Qe=n.ab.vec3.dot(Re,Re),ft=n.ab.vec3.dot(Re,qe),It=Oe*Qe-Je*Je;if(It===0){const ci=n.ab.vec3.dot(qe,Re)/n.ab.vec3.dot(Re,Re),Ni=n.ab.vec3.lerp(n.ab.vec3.create(),oe,ye,ci);return n.ab.vec3.squaredDistance(Ni,K)}const Pt=(Je*ft-Ke*Qe)/It,si=(Oe*ft-Je*Ke)/It,ui=n.ab.vec3.lerp(n.ab.vec3.create(),K,ie,Pt),hi=n.ab.vec3.lerp(n.ab.vec3.create(),oe,ye,si);return n.ab.vec3.squaredDistance(ui,hi)}}class Xe{static parseFrom(K,ie){const oe=me.parse(K);if(!oe)return[];let{vertices:ye,features:xe}=oe;const Re=1/n.cc(ie);xe.sort((Ke,Qe)=>Ke.id-Qe.id),ye.sort((Ke,Qe)=>Ke.id-Qe.id||Ke.idx-Qe.idx),ye=ye.filter((Ke,Qe,ft)=>Qe===ft.findIndex(It=>It.id===Ke.id&&It.idx===Ke.idx));const qe=new Array;let Oe=0;const Je=ye.length;for(const Ke of xe){if(Ke.constantHeight){qe.push(new Ie(Ke.id,Ke.bounds,Ke.constantHeight));continue}for(;Oe!==Je&&ye[Oe].id<Ke.id;)Oe++;if(Oe===Je||ye[Oe].id!==Ke.id)continue;const Qe=new Array,ft=new Array,It=Oe;for(;Oe!==Je&&ye[Oe].id===Ke.id;){const Pt=ye[Oe];if(Qe.push({position:Pt.position,height:Pt.height,extent:Pt.extent}),Oe!==It&&ye[Oe-1].idx===Pt.idx-1){const si=Oe-It;ft.push({a:si-1,b:si})}Oe++}qe.push(new Ie(Ke.id,Ke.bounds,void 0,Qe,ft,Re))}return qe}}n.dV(Ie,"ElevationFeature");class je{constructor(K){this.tileID=new n.aG(K.tileID.overscaledZ,K.tileID.wrap,K.tileID.canonical.z,K.tileID.canonical.x,K.tileID.canonical.y),this.tileZoom=K.tileZoom,this.uid=K.uid,this.zoom=K.zoom,this.lut=K.lut,this.canonical=K.tileID.canonical,this.pixelRatio=K.pixelRatio,this.tileSize=K.tileSize,this.source=K.source,this.scope=K.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=K.showCollisionBoxes,this.collectResourceTiming=!!K.request&&K.request.collectResourceTiming,this.promoteId=K.promoteId,this.isSymbolTile=K.isSymbolTile,this.tileTransform=n.aQ(K.tileID.canonical,K.projection),this.projection=K.projection,this.worldview=K.worldview,this.localizableLayerIds=K.localizableLayerIds,this.brightness=K.brightness,this.extraShadowCaster=!!K.extraShadowCaster,this.tessellationStep=K.tessellationStep,this.scaleFactor=K.scaleFactor}parse(K,ie,oe,ye,xe){this.status="parsing",this.data=K,this.collisionBoxArray=new n.aW;const Re=new n.d_(Object.keys(K.layers).sort()),qe=new n.d$(this.tileID,this.promoteId);qe.bucketLayerIDs=[];const Oe={},Je=new n.e0(256,256),Ke={featureIndex:qe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Je,availableImages:oe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Qe=ie.familiesBySource[this.source];for(const ci in Qe){const Ni=K.layers[ci];if(!Ni)continue;let $i=!1,Ii=!1,Zi=!1;for(const mr of Qe[ci])mr[0].type==="symbol"?$i=!0:Ii=!0,mr[0].is3D()&&mr[0].type!=="model"&&(Zi=!0);if(this.extraShadowCaster&&!Zi||this.isSymbolTile===!0&&!$i||this.isSymbolTile===!1&&!Ii)continue;Ni.version===1&&n.w(`Vector tile source "${this.source}" layer "${ci}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ki=Re.encode(ci),tr=[];let Jo=!1;for(let mr=0,br=0;mr<Ni.length;mr++){const ds=Ni.feature(mr),Bu=qe.getId(ds,ci);if(this.localizableLayerIds&&this.localizableLayerIds.has(ci)){const Ia=ds.properties?ds.properties.worldview:null;if(this.worldview&&typeof Ia=="string")if(Ia==="all")ds.properties.$localized=!0;else{if(!Ia.split(",").includes(this.worldview))continue;ds.properties.$localized=!0,ds.properties.worldview=this.worldview}}!Jo&&ds.properties&&ds.properties.hasOwnProperty(ue)&&(Jo=!0),tr.push({feature:ds,id:Bu,index:br,sourceLayerIndex:Ki}),br++}Jo&&K.layers.hasOwnProperty(ne)&&(Ke.elevationFeatures=Xe.parseFrom(K.layers[ne],this.canonical));for(const mr of Qe[ci]){const br=mr[0];(!this.extraShadowCaster||br.is3D()&&br.type!=="model")&&(this.isSymbolTile!==void 0&&br.type==="symbol"!==this.isSymbolTile||br.minzoom&&this.zoom<Math.floor(br.minzoom)||br.maxzoom&&this.zoom>=br.maxzoom||br.visibility!=="none"&&(rt(mr,this.zoom,Ke.brightness,oe),(Oe[br.id]=br.createBucket({index:qe.bucketLayerIDs.length,layers:mr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ki,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(tr,Ke,this.tileID.canonical,this.tileTransform),qe.bucketLayerIDs.push(mr.map(ds=>n.aC(ds.id,ds.scope)))))}}let ft,It,Pt,si;Je.trim();const ui={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},hi=()=>{if(ft)return this.status="done",xe(ft);if(this.extraShadowCaster)this.status="done",xe(null,{buckets:n.bj(Oe).filter(ci=>!ci.isEmpty()),featureIndex:qe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ke.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(It&&Pt&&si){const ci=new se(It),Ni=new n.e3(Pt,si,this.lut);for(const $i in Oe){const Ii=Oe[$i];Ii instanceof n.aX?(rt(Ii.layers,this.zoom,Ke.brightness,oe),n.e4(Ii,It,ci.positions,Pt,Ni.iconPositions,this.showCollisionBoxes,oe,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.pixelRatio,this.brightness)):Ii.hasPattern&&(Ii instanceof n.b1||Ii instanceof n.b2||Ii instanceof n.d5)&&(rt(Ii.layers,this.zoom,Ke.brightness,oe),Ii.addFeatures(Ke,this.tileID.canonical,Ni.patternPositions,oe,this.tileTransform,this.brightness))}this.status="done",xe(null,{buckets:n.bj(Oe).filter($i=>!$i.isEmpty()),featureIndex:qe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ci.image,lineAtlas:Je,imageAtlas:Ni,brightness:Ke.brightness})}};if(!this.extraShadowCaster){const ci=n.e1(Ke.glyphDependencies,Ii=>Object.keys(Ii).map(Number));Object.keys(ci).length?ye.send("getGlyphs",{uid:this.uid,stacks:ci,scope:this.scope},(Ii,Zi)=>{ft||(ft=Ii,It=Zi,hi())},void 0,!1,ui):It={};const Ni=Object.keys(Ke.iconDependencies);Ni.length?ye.send("getImages",{icons:Ni,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Ii,Zi)=>{if(ft)return;ft=Ii;const Ki={};Object.values(Zi).some(tr=>tr.usvg)?this.rasterize(ye,Ki,Zi,Ke.iconDependencies,()=>{Pt=Ki,hi()}):(this.fillImageMap(Ki,Ke.iconDependencies,Zi),Pt=Ki,hi())},void 0,!1,ui):Pt={};const $i=Object.keys(Ke.patternDependencies);$i.length?ye.send("getImages",{icons:$i,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Ii,Zi)=>{if(!ft){ft=Ii;const Ki={};Object.values(Zi).some(tr=>tr.usvg)?this.rasterize(ye,Ki,Zi,Ke.patternDependencies,()=>{si=Ki,hi()}):(this.fillImageMap(Ki,Ke.patternDependencies,Zi),si=Ki,hi())}},void 0,!1,ui):si={}}hi()}fillImageMap(K,ie,oe){for(const ye in oe){const xe=ie[ye]||[];for(const Re of xe)oe[Re.id].usvg||(K[Re.serialize()]=oe[Re.id])}}getImageTaskQueue(K,ie,oe){const ye={};for(const xe in ie){const Re=oe[xe]||[];for(const qe of Re){const Oe=qe.serialize();ie[qe.id].usvg?ye[Oe]||(ye[Oe]=qe):K[Oe]=ie[qe.id]}}return ye}rasterize(K,ie,oe,ye,xe){const Re=this.getImageTaskQueue(ie,oe,ye);this.rasterizeTask=K.send("rasterizeImages",{scope:this.scope,imageTasks:Re},(qe,Oe)=>{if(!qe)for(const Je in Oe){const{id:Ke}=n.e2.deserializeFromString(Je);ie[Je]=Object.assign({},oe[Ke],{data:Oe[Je]})}xe()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function rt(et,K,ie,oe){const ye=new n.a8(K,{brightness:ie});for(const xe of et)xe.recalculate(ye,oe)}class Ve extends n.E{constructor(K,ie,oe,ye,xe,Re){super(),this.actor=K,this.layerIndex=ie,this.availableImages=oe,this.loadVectorData=xe||n.aD,this.loading={},this.loaded={},this.deduped=new n.aB(K.scheduler),this.isSpriteLoaded=ye,this.scheduler=K.scheduler,this.brightness=Re}loadTile(K,ie){const oe=K.uid,ye=K&&K.request,xe=ye&&ye.collectResourceTiming,Re=this.loading[oe]=new je(K);Re.abort=this.loadVectorData(K,(qe,Oe)=>{const Je=!this.loading[oe];if(delete this.loading[oe],Re.cancelRasterize(),Je||qe||!Oe)return Re.status="done",Je||(this.loaded[oe]=Re),ie(qe);const Ke=Oe.rawData,Qe={};Oe.expires&&(Qe.expires=Oe.expires),Oe.cacheControl&&(Qe.cacheControl=Oe.cacheControl),Re.vectorTile=Oe.vectorTile||new n.dY.VectorTile(new n.bh(Ke));const ft=()=>{Re.parse(Re.vectorTile,this.layerIndex,this.availableImages,this.actor,(It,Pt)=>{if(It||!Pt)return ie(It);const si={};if(xe){const ui=k(ye);ui.length>0&&(si.resourceTiming=JSON.parse(JSON.stringify(ui)))}ie(null,n.l({rawTileData:Ke.slice(0)},Pt,Qe,si))})};this.isSpriteLoaded?ft():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(ft,{type:"parseTile",isSymbolTile:K.isSymbolTile,zoom:K.tileZoom}):ft()}),this.loaded=this.loaded||{},this.loaded[oe]=Re})}reloadTile(K,ie){const oe=this.loaded,ye=K.uid;if(oe&&oe[ye]){const xe=oe[ye];xe.scaleFactor=K.scaleFactor,xe.showCollisionBoxes=K.showCollisionBoxes,xe.projection=K.projection,xe.brightness=K.brightness,xe.tileTransform=n.aQ(K.tileID.canonical,K.projection),xe.extraShadowCaster=K.extraShadowCaster,xe.lut=K.lut;const Re=(qe,Oe)=>{const Je=xe.reloadCallback;Je&&(delete xe.reloadCallback,xe.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.actor,Je)),ie(qe,Oe)};xe.status==="parsing"?xe.reloadCallback=Re:xe.status==="done"&&(xe.vectorTile?xe.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.actor,Re):Re())}else ie(null,void 0)}abortTile(K,ie){const oe=K.uid,ye=this.loading[oe];ye&&(ye.abort&&ye.abort(),delete this.loading[oe]),ie()}removeTile(K,ie){const oe=this.loaded,ye=K.uid;oe&&oe[ye]&&delete oe[ye],ie()}}class He{loadTile(K,ie){const{uid:oe,encoding:ye,rawImageData:xe,padding:Re}=K,qe=ImageBitmap&&xe instanceof ImageBitmap?this.getImageData(xe,Re):xe;ie(null,new n.e5(oe,qe,ye,Re<1))}getImageData(K,ie){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(K.width,K.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=K.width,this.offscreenCanvas.height=K.height,this.offscreenCanvasContext.drawImage(K,0,0,K.width,K.height);const oe=this.offscreenCanvasContext.getImageData(-ie,-ie,K.width+2*ie,K.height+2*ie);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),oe}}n.bg.setPbf(n.bh);class st{decodeRasterArray({task:K,buffer:ie},oe){n.bg.performDecoding(ie,K).then(ye=>{oe(null,ye)},ye=>{oe(ye)})}}const dt=n.dY.VectorTileFeature.prototype.toGeoJSON;class At{constructor(K){this._feature=K,this.extent=n.ag,this.type=K.type,this.properties=K.tags,"id"in K&&!isNaN(K.id)&&(this.id=parseInt(K.id,10))}loadGeometry(){if(this._feature.type===1){const K=[];for(const ie of this._feature.geometry)K.push([new n.P(ie[0],ie[1])]);return K}{const K=[];for(const ie of this._feature.geometry){const oe=[];for(const ye of ie)oe.push(new n.P(ye[0],ye[1]));K.push(oe)}return K}}toGeoJSON(K,ie,oe){return dt.call(this,K,ie,oe)}}class ni{constructor(K){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.ag,this.length=K.length,this._features=K}feature(K){return new At(this._features[K])}}const Tt=64/4096,kt=128;class ti{constructor(){this.features=new Map}clear(){this.features.clear()}load(K=[],ie){for(const oe of K){const ye=oe.id;if(ye==null)continue;let xe=this.features.get(ye);xe&&this.updateCache(xe,ie),oe.geometry?(xe=ii(oe),this.updateCache(xe,ie),this.features.set(ye,xe)):this.features.delete(ye),this.updateCache(xe,ie)}}updateCache(K,ie){for(const{canonical:oe,uid:ye}of Object.values(ie)){const{z:xe,x:Re,y:qe}=oe;li(K,Math.pow(2,xe),Re,qe)&&delete ie[ye]}}getTile(K,ie,oe){const ye=Math.pow(2,K),xe=[];for(const Re of this.features.values())li(Re,ye,ie,oe)&&xe.push(_i(Re,ye,ie,oe));return{features:xe}}getFeatures(){return[...this.features.values()]}}function li({minX:et,minY:K,maxX:ie,maxY:oe},ye,xe,Re){return et<(xe+1+Tt)/ye&&K<(Re+1+Tt)/ye&&ie>(xe-Tt)/ye&&oe>(Re-Tt)/ye}function ii(et){const{id:K,geometry:ie,properties:oe}=et;if(!ie)return;if(ie.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:ye,coordinates:xe}=ie,Re={id:K,type:1,geometry:[],tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},qe=Re.geometry;if(ye==="Point")Pn(xe,qe,Re);else if(ye==="MultiPoint")for(const Oe of xe)Pn(Oe,qe,Re);else if(ye==="LineString")Re.type=2,Fn(xe,qe,Re);else if(ye==="MultiLineString")Re.type=2,xn(xe,qe,Re);else if(ye==="Polygon")Re.type=3,xn(xe,qe,Re,!0);else{if(ye!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Re.type=3;for(const Oe of xe)xn(Oe,qe,Re,!0)}return Re}function Pn([et,K],ie,oe){const ye=n.at(et);let xe=n.aA(K);xe=xe<0?0:xe>1?1:xe,ie.push(ye,xe),oe.minX=Math.min(oe.minX,ye),oe.minY=Math.min(oe.minY,xe),oe.maxX=Math.max(oe.maxX,ye),oe.maxY=Math.max(oe.maxY,xe)}function Fn(et,K,ie,oe=!1,ye=!1){const xe=[];for(const Re of et)Pn(Re,xe,ie);K.push(xe),oe&&function(Re,qe){let Oe=0;for(let Je=0,Ke=Re.length,Qe=Ke-2;Je<Ke;Qe=Je,Je+=2)Oe+=(Re[Je]-Re[Qe])*(Re[Je+1]+Re[Qe+1]);if(Oe>0===qe)for(let Je=0,Ke=Re.length;Je<Ke/2;Je+=2){const Qe=Re[Je],ft=Re[Je+1];Re[Je]=Re[Ke-2-Je],Re[Je+1]=Re[Ke-1-Je],Re[Ke-2-Je]=Qe,Re[Ke-1-Je]=ft}}(xe,ye)}function xn(et,K,ie,oe=!1){for(let ye=0;ye<et.length;ye++)Fn(et[ye],K,ie,oe,ye===0)}function _i(et,K,ie,oe){const{id:ye,type:xe,geometry:Re,tags:qe}=et,Oe=[];if(xe===1)(function(Je,Ke,Qe,ft,It){for(let Pt=0;Pt<Je.length;Pt+=2){const si=Math.round(n.ag*(Je[Pt+0]*Ke-Qe)),ui=Math.round(n.ag*(Je[Pt+1]*Ke-ft));It.push([si,ui])}})(Re,K,ie,oe,Oe);else for(const Je of Re)dr(Je,K,ie,oe,Oe);return{id:ye,type:xe,geometry:Oe,tags:qe}}function dr(et,K,ie,oe,ye){const xe=-kt,Re=n.ag+kt;let qe;for(let Oe=0;Oe<et.length-2;Oe+=2){let Je=Math.round(n.ag*(et[Oe+0]*K-ie)),Ke=Math.round(n.ag*(et[Oe+1]*K-oe)),Qe=Math.round(n.ag*(et[Oe+2]*K-ie)),ft=Math.round(n.ag*(et[Oe+3]*K-oe));const It=Qe-Je,Pt=ft-Ke;Je<xe&&Qe<xe||(Je<xe?(Ke+=Math.round(Pt*((xe-Je)/It)),Je=xe):Qe<xe&&(ft=Ke+Math.round(Pt*((xe-Je)/It)),Qe=xe),Ke<xe&&ft<xe||(Ke<xe?(Je+=Math.round(It*((xe-Ke)/Pt)),Ke=xe):ft<xe&&(Qe=Je+Math.round(It*((xe-Ke)/Pt)),ft=xe),Je>=Re&&Qe>=Re||(Je>=Re?(Ke+=Math.round(Pt*((Re-Je)/It)),Je=Re):Qe>=Re&&(ft=Ke+Math.round(Pt*((Re-Je)/It)),Qe=Re),Ke>=Re&&ft>=Re||(Ke>=Re?(Je+=Math.round(It*((Re-Ke)/Pt)),Ke=Re):ft>=Re&&(Qe=Je+Math.round(It*((Re-Ke)/Pt)),ft=Re),qe&&Je===qe[qe.length-1][0]&&Ke===qe[qe.length-1][1]||(qe=[[Je,Ke]],ye.push(qe)),qe.push([Qe,ft])))))}}var Wn,Vr,hs,fr={exports:{}},Us=function(){if(hs)return fr.exports;hs=1;var et=n.e8(),K=function(){if(Vr)return Wn;Vr=1;var Ke=n.e6(),Qe=n.e7().VectorTileFeature;function ft(Pt,si){this.options=si||{},this.features=Pt,this.length=Pt.length}function It(Pt,si){this.id=typeof Pt.id=="number"?Pt.id:void 0,this.type=Pt.type,this.rawGeometry=Pt.type===1?[Pt.geometry]:Pt.geometry,this.properties=Pt.tags,this.extent=si||4096}return Wn=ft,ft.prototype.feature=function(Pt){return new It(this.features[Pt],this.options.extent)},It.prototype.loadGeometry=function(){var Pt=this.rawGeometry;this.geometry=[];for(var si=0;si<Pt.length;si++){for(var ui=Pt[si],hi=[],ci=0;ci<ui.length;ci++)hi.push(new Ke(ui[ci][0],ui[ci][1]));this.geometry.push(hi)}return this.geometry},It.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Pt=this.geometry,si=1/0,ui=-1/0,hi=1/0,ci=-1/0,Ni=0;Ni<Pt.length;Ni++)for(var $i=Pt[Ni],Ii=0;Ii<$i.length;Ii++){var Zi=$i[Ii];si=Math.min(si,Zi.x),ui=Math.max(ui,Zi.x),hi=Math.min(hi,Zi.y),ci=Math.max(ci,Zi.y)}return[si,hi,ui,ci]},It.prototype.toGeoJSON=Qe.prototype.toGeoJSON,Wn}();function ie(Ke){var Qe=new et;return function(ft,It){for(var Pt in ft.layers)It.writeMessage(3,oe,ft.layers[Pt])}(Ke,Qe),Qe.finish()}function oe(Ke,Qe){var ft;Qe.writeVarintField(15,Ke.version||1),Qe.writeStringField(1,Ke.name||""),Qe.writeVarintField(5,Ke.extent||4096);var It={keys:[],values:[],keycache:{},valuecache:{}};for(ft=0;ft<Ke.length;ft++)It.feature=Ke.feature(ft),Qe.writeMessage(2,ye,It);var Pt=It.keys;for(ft=0;ft<Pt.length;ft++)Qe.writeStringField(3,Pt[ft]);var si=It.values;for(ft=0;ft<si.length;ft++)Qe.writeMessage(4,Je,si[ft])}function ye(Ke,Qe){var ft=Ke.feature;ft.id!==void 0&&Qe.writeVarintField(1,ft.id),Qe.writeMessage(2,xe,Ke),Qe.writeVarintField(3,ft.type),Qe.writeMessage(4,Oe,ft)}function xe(Ke,Qe){var ft=Ke.feature,It=Ke.keys,Pt=Ke.values,si=Ke.keycache,ui=Ke.valuecache;for(var hi in ft.properties){var ci=ft.properties[hi],Ni=si[hi];if(ci!==null){Ni===void 0&&(It.push(hi),si[hi]=Ni=It.length-1),Qe.writeVarint(Ni);var $i=typeof ci;$i!=="string"&&$i!=="boolean"&&$i!=="number"&&(ci=JSON.stringify(ci));var Ii=$i+":"+ci,Zi=ui[Ii];Zi===void 0&&(Pt.push(ci),ui[Ii]=Zi=Pt.length-1),Qe.writeVarint(Zi)}}}function Re(Ke,Qe){return(Qe<<3)+(7&Ke)}function qe(Ke){return Ke<<1^Ke>>31}function Oe(Ke,Qe){for(var ft=Ke.loadGeometry(),It=Ke.type,Pt=0,si=0,ui=ft.length,hi=0;hi<ui;hi++){var ci=ft[hi],Ni=1;It===1&&(Ni=ci.length),Qe.writeVarint(Re(1,Ni));for(var $i=It===3?ci.length-1:ci.length,Ii=0;Ii<$i;Ii++){Ii===1&&It!==1&&Qe.writeVarint(Re(2,$i-1));var Zi=ci[Ii].x-Pt,Ki=ci[Ii].y-si;Qe.writeVarint(qe(Zi)),Qe.writeVarint(qe(Ki)),Pt+=Zi,si+=Ki}It===3&&Qe.writeVarint(Re(7,1))}}function Je(Ke,Qe){var ft=typeof Ke;ft==="string"?Qe.writeStringField(1,Ke):ft==="boolean"?Qe.writeBooleanField(7,Ke):ft==="number"&&(Ke%1!=0?Qe.writeDoubleField(3,Ke):Ke<0?Qe.writeSVarintField(6,Ke):Qe.writeVarintField(5,Ke))}return fr.exports=ie,fr.exports.fromVectorTileJs=ie,fr.exports.fromGeojsonVt=function(Ke,Qe){Qe=Qe||{};var ft={};for(var It in Ke)ft[It]=new K(Ke[It].features,Qe),ft[It].name=It,ft[It].version=Qe.version,ft[It].extent=Qe.extent;return ie({layers:ft})},fr.exports.GeoJSONWrapper=K,fr.exports}(),Le=n.e9(Us);const Ss={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:et=>et},ro=Math.fround||(Ze=new Float32Array(1),et=>(Ze[0]=+et,Ze[0]));var Ze;const Se=3,bt=5,Bt=6;class Ut{constructor(K){this.options=Object.assign(Object.create(Ss),K),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(K){const{log:ie,minZoom:oe,maxZoom:ye}=this.options;ie&&console.time("total time");const xe=`prepare ${K.length} points`;ie&&console.time(xe),this.points=K;const Re=[];for(let Oe=0;Oe<K.length;Oe++){const Je=K[Oe];if(!Je.geometry)continue;const[Ke,Qe]=Je.geometry.coordinates,ft=ro(Zt(Ke)),It=ro(Jt(Qe));Re.push(ft,It,1/0,Oe,-1,1),this.options.reduce&&Re.push(0)}let qe=this.trees[ye+1]=this._createTree(Re);ie&&console.timeEnd(xe);for(let Oe=ye;Oe>=oe;Oe--){const Je=+Date.now();qe=this.trees[Oe]=this._createTree(this._cluster(qe,Oe)),ie&&console.log("z%d: %d clusters in %dms",Oe,qe.numItems,+Date.now()-Je)}return ie&&console.timeEnd("total time"),this}getClusters(K,ie){let oe=((K[0]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,K[1]));let xe=K[2]===180?180:((K[2]+180)%360+360)%360-180;const Re=Math.max(-90,Math.min(90,K[3]));if(K[2]-K[0]>=360)oe=-180,xe=180;else if(oe>xe){const Qe=this.getClusters([oe,ye,180,Re],ie),ft=this.getClusters([-180,ye,xe,Re],ie);return Qe.concat(ft)}const qe=this.trees[this._limitZoom(ie)],Oe=qe.range(Zt(oe),Jt(Re),Zt(xe),Jt(ye)),Je=qe.data,Ke=[];for(const Qe of Oe){const ft=this.stride*Qe;Ke.push(Je[ft+bt]>1?yt(Je,ft,this.clusterProps):this.points[Je[ft+Se]])}return Ke}getChildren(K){const ie=this._getOriginId(K),oe=this._getOriginZoom(K),ye="No cluster with the specified id.",xe=this.trees[oe];if(!xe)throw new Error(ye);const Re=xe.data;if(ie*this.stride>=Re.length)throw new Error(ye);const qe=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),Oe=xe.within(Re[ie*this.stride],Re[ie*this.stride+1],qe),Je=[];for(const Ke of Oe){const Qe=Ke*this.stride;Re[Qe+4]===K&&Je.push(Re[Qe+bt]>1?yt(Re,Qe,this.clusterProps):this.points[Re[Qe+Se]])}if(Je.length===0)throw new Error(ye);return Je}getLeaves(K,ie,oe){const ye=[];return this._appendLeaves(ye,K,ie=ie||10,oe=oe||0,0),ye}getTile(K,ie,oe){const ye=this.trees[this._limitZoom(K)],xe=Math.pow(2,K),{extent:Re,radius:qe}=this.options,Oe=qe/Re,Je=(oe-Oe)/xe,Ke=(oe+1+Oe)/xe,Qe={features:[]};return this._addTileFeatures(ye.range((ie-Oe)/xe,Je,(ie+1+Oe)/xe,Ke),ye.data,ie,oe,xe,Qe),ie===0&&this._addTileFeatures(ye.range(1-Oe/xe,Je,1,Ke),ye.data,xe,oe,xe,Qe),ie===xe-1&&this._addTileFeatures(ye.range(0,Je,Oe/xe,Ke),ye.data,-1,oe,xe,Qe),Qe.features.length?Qe:null}getClusterExpansionZoom(K){let ie=this._getOriginZoom(K)-1;for(;ie<=this.options.maxZoom;){const oe=this.getChildren(K);if(ie++,oe.length!==1)break;K=oe[0].properties.cluster_id}return ie}_appendLeaves(K,ie,oe,ye,xe){const Re=this.getChildren(ie);for(const qe of Re){const Oe=qe.properties;if(Oe&&Oe.cluster?xe+Oe.point_count<=ye?xe+=Oe.point_count:xe=this._appendLeaves(K,Oe.cluster_id,oe,ye,xe):xe<ye?xe++:K.push(qe),K.length===oe)break}return xe}_createTree(K){const ie=new n.bE(K.length/this.stride|0,this.options.nodeSize,Float32Array);for(let oe=0;oe<K.length;oe+=this.stride)ie.add(K[oe],K[oe+1]);return ie.finish(),ie.data=K,ie}_addTileFeatures(K,ie,oe,ye,xe,Re){for(const qe of K){const Oe=qe*this.stride,Je=ie[Oe+bt]>1;let Ke,Qe,ft;if(Je)Ke=Kt(ie,Oe,this.clusterProps),Qe=ie[Oe],ft=ie[Oe+1];else{const si=this.points[ie[Oe+Se]];Ke=si.properties;const[ui,hi]=si.geometry.coordinates;Qe=Zt(ui),ft=Jt(hi)}const It={type:1,geometry:[[Math.round(this.options.extent*(Qe*xe-oe)),Math.round(this.options.extent*(ft*xe-ye))]],tags:Ke};let Pt;Pt=Je||this.options.generateId?ie[Oe+Se]:this.points[ie[Oe+Se]].id,Pt!==void 0&&(It.id=Pt),Re.features.push(It)}}_limitZoom(K){return Math.max(this.options.minZoom,Math.min(Math.floor(+K),this.options.maxZoom+1))}_cluster(K,ie){const{radius:oe,extent:ye,reduce:xe,minPoints:Re}=this.options,qe=oe/(ye*Math.pow(2,ie)),Oe=K.data,Je=[],Ke=this.stride;for(let Qe=0;Qe<Oe.length;Qe+=Ke){if(Oe[Qe+2]<=ie)continue;Oe[Qe+2]=ie;const ft=Oe[Qe],It=Oe[Qe+1],Pt=K.within(Oe[Qe],Oe[Qe+1],qe),si=Oe[Qe+bt];let ui=si;for(const hi of Pt){const ci=hi*Ke;Oe[ci+2]>ie&&(ui+=Oe[ci+bt])}if(ui>si&&ui>=Re){let hi,ci=ft*si,Ni=It*si,$i=-1;const Ii=(Qe/Ke<<5)+(ie+1)+this.points.length;for(const Zi of Pt){const Ki=Zi*Ke;if(Oe[Ki+2]<=ie)continue;Oe[Ki+2]=ie;const tr=Oe[Ki+bt];ci+=Oe[Ki]*tr,Ni+=Oe[Ki+1]*tr,Oe[Ki+4]=Ii,xe&&(hi||(hi=this._map(Oe,Qe,!0),$i=this.clusterProps.length,this.clusterProps.push(hi)),xe(hi,this._map(Oe,Ki)))}Oe[Qe+4]=Ii,Je.push(ci/ui,Ni/ui,1/0,Ii,-1,ui),xe&&Je.push($i)}else{for(let hi=0;hi<Ke;hi++)Je.push(Oe[Qe+hi]);if(ui>1)for(const hi of Pt){const ci=hi*Ke;if(!(Oe[ci+2]<=ie)){Oe[ci+2]=ie;for(let Ni=0;Ni<Ke;Ni++)Je.push(Oe[ci+Ni])}}}}return Je}_getOriginId(K){return K-this.points.length>>5}_getOriginZoom(K){return(K-this.points.length)%32}_map(K,ie,oe){if(K[ie+bt]>1){const Re=this.clusterProps[K[ie+Bt]];return oe?Object.assign({},Re):Re}const ye=this.points[K[ie+Se]].properties,xe=this.options.map(ye);return oe&&xe===ye?Object.assign({},xe):xe}}function yt(et,K,ie){return{type:"Feature",id:et[K+Se],properties:Kt(et,K,ie),geometry:{type:"Point",coordinates:[(oe=et[K],360*(oe-.5)),Ht(et[K+1])]}};var oe}function Kt(et,K,ie){const oe=et[K+bt],ye=oe>=1e4?`${Math.round(oe/1e3)}k`:oe>=1e3?Math.round(oe/100)/10+"k":oe,xe=et[K+Bt],Re=xe===-1?{}:Object.assign({},ie[xe]);return Object.assign(Re,{cluster:!0,cluster_id:et[K+Se],point_count:oe,point_count_abbreviated:ye})}function Zt(et){return et/360+.5}function Jt(et){const K=Math.sin(et*Math.PI/180),ie=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return ie<0?0:ie>1?1:ie}function Ht(et){const K=(180-360*et)*Math.PI/180;return 360*Math.atan(Math.exp(K))/Math.PI-90}function Si(et,K,ie,oe){let ye=oe;const xe=K+(ie-K>>1);let Re,qe=ie-K;const Oe=et[K],Je=et[K+1],Ke=et[ie],Qe=et[ie+1];for(let ft=K+3;ft<ie;ft+=3){const It=Ct(et[ft],et[ft+1],Oe,Je,Ke,Qe);if(It>ye)Re=ft,ye=It;else if(It===ye){const Pt=Math.abs(ft-xe);Pt<qe&&(Re=ft,qe=Pt)}}ye>oe&&(Re-K>3&&Si(et,K,Re,oe),et[Re+2]=ye,ie-Re>3&&Si(et,Re,ie,oe))}function Ct(et,K,ie,oe,ye,xe){let Re=ye-ie,qe=xe-oe;if(Re!==0||qe!==0){const Oe=((et-ie)*Re+(K-oe)*qe)/(Re*Re+qe*qe);Oe>1?(ie=ye,oe=xe):Oe>0&&(ie+=Re*Oe,oe+=qe*Oe)}return Re=et-ie,qe=K-oe,Re*Re+qe*qe}function yi(et,K,ie,oe){const ye={id:et??null,type:K,geometry:ie,tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(K==="Point"||K==="MultiPoint"||K==="LineString")Ai(ye,ie);else if(K==="Polygon")Ai(ye,ie[0]);else if(K==="MultiLineString")for(const xe of ie)Ai(ye,xe);else if(K==="MultiPolygon")for(const xe of ie)Ai(ye,xe[0]);return ye}function Ai(et,K){for(let ie=0;ie<K.length;ie+=3)et.minX=Math.min(et.minX,K[ie]),et.minY=Math.min(et.minY,K[ie+1]),et.maxX=Math.max(et.maxX,K[ie]),et.maxY=Math.max(et.maxY,K[ie+1])}function Gi(et,K,ie,oe){if(!K.geometry)return;const ye=K.geometry.coordinates;if(ye&&ye.length===0)return;const xe=K.geometry.type,Re=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2);let qe=[],Oe=K.id;if(ie.promoteId?Oe=K.properties[ie.promoteId]:ie.generateId&&(Oe=oe||0),xe==="Point")Wi(ye,qe);else if(xe==="MultiPoint")for(const Je of ye)Wi(Je,qe);else if(xe==="LineString")un(ye,qe,Re,!1);else if(xe==="MultiLineString"){if(ie.lineMetrics){for(const Je of ye)qe=[],un(Je,qe,Re,!1),et.push(yi(Oe,"LineString",qe,K.properties));return}xr(ye,qe,Re,!1)}else if(xe==="Polygon")xr(ye,qe,Re,!0);else{if(xe!=="MultiPolygon"){if(xe==="GeometryCollection"){for(const Je of K.geometry.geometries)Gi(et,{id:Oe,geometry:Je,properties:K.properties},ie,oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Je of ye){const Ke=[];xr(Je,Ke,Re,!0),qe.push(Ke)}}et.push(yi(Oe,xe,qe,K.properties))}function Wi(et,K){K.push(sr(et[0]),Ur(et[1]),0)}function un(et,K,ie,oe){let ye,xe,Re=0;for(let Oe=0;Oe<et.length;Oe++){const Je=sr(et[Oe][0]),Ke=Ur(et[Oe][1]);K.push(Je,Ke,0),Oe>0&&(Re+=oe?(ye*Ke-Je*xe)/2:Math.sqrt(Math.pow(Je-ye,2)+Math.pow(Ke-xe,2))),ye=Je,xe=Ke}const qe=K.length-3;K[2]=1,Si(K,0,qe,ie),K[qe+2]=1,K.size=Math.abs(Re),K.start=0,K.end=K.size}function xr(et,K,ie,oe){for(let ye=0;ye<et.length;ye++){const xe=[];un(et[ye],xe,ie,oe),K.push(xe)}}function sr(et){return et/360+.5}function Ur(et){const K=Math.sin(et*Math.PI/180),ie=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return ie<0?0:ie>1?1:ie}function Rn(et,K,ie,oe,ye,xe,Re,qe){if(oe/=K,xe>=(ie/=K)&&Re<oe)return et;if(Re<ie||xe>=oe)return null;const Oe=[];for(const Je of et){const Ke=Je.geometry;let Qe=Je.type;const ft=ye===0?Je.minX:Je.minY,It=ye===0?Je.maxX:Je.maxY;if(ft>=ie&&It<oe){Oe.push(Je);continue}if(It<ie||ft>=oe)continue;let Pt=[];if(Qe==="Point"||Qe==="MultiPoint")so(Ke,Pt,ie,oe,ye);else if(Qe==="LineString")Ma(Ke,Pt,ie,oe,ye,!1,qe.lineMetrics);else if(Qe==="MultiLineString")jr(Ke,Pt,ie,oe,ye,!1);else if(Qe==="Polygon")jr(Ke,Pt,ie,oe,ye,!0);else if(Qe==="MultiPolygon")for(const si of Ke){const ui=[];jr(si,ui,ie,oe,ye,!0),ui.length&&Pt.push(ui)}if(Pt.length){if(qe.lineMetrics&&Qe==="LineString"){for(const si of Pt)Oe.push(yi(Je.id,Qe,si,Je.tags));continue}Qe!=="LineString"&&Qe!=="MultiLineString"||(Pt.length===1?(Qe="LineString",Pt=Pt[0]):Qe="MultiLineString"),Qe!=="Point"&&Qe!=="MultiPoint"||(Qe=Pt.length===3?"Point":"MultiPoint"),Oe.push(yi(Je.id,Qe,Pt,Je.tags))}}return Oe.length?Oe:null}function so(et,K,ie,oe,ye){for(let xe=0;xe<et.length;xe+=3){const Re=et[xe+ye];Re>=ie&&Re<=oe&&Ti(K,et[xe],et[xe+1],et[xe+2])}}function Ma(et,K,ie,oe,ye,xe,Re){let qe=Bn(et);const Oe=ye===0?Yo:Cd;let Je,Ke,Qe=et.start;for(let ui=0;ui<et.length-3;ui+=3){const hi=et[ui],ci=et[ui+1],Ni=et[ui+2],$i=et[ui+3],Ii=et[ui+4],Zi=ye===0?hi:ci,Ki=ye===0?$i:Ii;let tr=!1;Re&&(Je=Math.sqrt(Math.pow(hi-$i,2)+Math.pow(ci-Ii,2))),Zi<ie?Ki>ie&&(Ke=Oe(qe,hi,ci,$i,Ii,ie),Re&&(qe.start=Qe+Je*Ke)):Zi>oe?Ki<oe&&(Ke=Oe(qe,hi,ci,$i,Ii,oe),Re&&(qe.start=Qe+Je*Ke)):Ti(qe,hi,ci,Ni),Ki<ie&&Zi>=ie&&(Ke=Oe(qe,hi,ci,$i,Ii,ie),tr=!0),Ki>oe&&Zi<=oe&&(Ke=Oe(qe,hi,ci,$i,Ii,oe),tr=!0),!xe&&tr&&(Re&&(qe.end=Qe+Je*Ke),K.push(qe),qe=Bn(et)),Re&&(Qe+=Je)}let ft=et.length-3;const It=et[ft],Pt=et[ft+1],si=ye===0?It:Pt;si>=ie&&si<=oe&&Ti(qe,It,Pt,et[ft+2]),ft=qe.length-3,xe&&ft>=3&&(qe[ft]!==qe[0]||qe[ft+1]!==qe[1])&&Ti(qe,qe[0],qe[1],qe[2]),qe.length&&K.push(qe)}function Bn(et){const K=[];return K.size=et.size,K.start=et.start,K.end=et.end,K}function jr(et,K,ie,oe,ye,xe){for(const Re of et)Ma(Re,K,ie,oe,ye,xe,!1)}function Ti(et,K,ie,oe){et.push(K,ie,oe)}function Yo(et,K,ie,oe,ye,xe){const Re=(xe-K)/(oe-K);return Ti(et,xe,ie+(ye-ie)*Re,1),Re}function Cd(et,K,ie,oe,ye,xe){const Re=(xe-ie)/(ye-ie);return Ti(et,K+(oe-K)*Re,xe,1),Re}function As(et,K){const ie=[];for(let oe=0;oe<et.length;oe++){const ye=et[oe],xe=ye.type;let Re;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")Re=Ca(ye.geometry,K);else if(xe==="MultiLineString"||xe==="Polygon"){Re=[];for(const qe of ye.geometry)Re.push(Ca(qe,K))}else if(xe==="MultiPolygon"){Re=[];for(const qe of ye.geometry){const Oe=[];for(const Je of qe)Oe.push(Ca(Je,K));Re.push(Oe)}}ie.push(yi(ye.id,xe,Re,ye.tags))}return ie}function Ca(et,K){const ie=[];ie.size=et.size,et.start!==void 0&&(ie.start=et.start,ie.end=et.end);for(let oe=0;oe<et.length;oe+=3)ie.push(et[oe]+K,et[oe+1],et[oe+2]);return ie}function yc(et,K){if(et.transformed)return et;const ie=1<<et.z,oe=et.x,ye=et.y;for(const xe of et.features){const Re=xe.geometry,qe=xe.type;if(xe.geometry=[],qe===1)for(let Oe=0;Oe<Re.length;Oe+=2)xe.geometry.push(vc(Re[Oe],Re[Oe+1],K,ie,oe,ye));else for(let Oe=0;Oe<Re.length;Oe++){const Je=[];for(let Ke=0;Ke<Re[Oe].length;Ke+=2)Je.push(vc(Re[Oe][Ke],Re[Oe][Ke+1],K,ie,oe,ye));xe.geometry.push(Je)}}return et.transformed=!0,et}function vc(et,K,ie,oe,ye,xe){return[Math.round(ie*(et*oe-ye)),Math.round(ie*(K*oe-xe))]}function xc(et,K,ie,oe,ye){const xe=K===ye.maxZoom?0:ye.tolerance/((1<<K)*ye.extent),Re={features:[],numPoints:0,numSimplified:0,numFeatures:et.length,source:null,x:ie,y:oe,z:K,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const qe of et)Id(Re,qe,xe,ye);return Re}function Id(et,K,ie,oe){const ye=K.geometry,xe=K.type,Re=[];if(et.minX=Math.min(et.minX,K.minX),et.minY=Math.min(et.minY,K.minY),et.maxX=Math.max(et.maxX,K.maxX),et.maxY=Math.max(et.maxY,K.maxY),xe==="Point"||xe==="MultiPoint")for(let qe=0;qe<ye.length;qe+=3)Re.push(ye[qe],ye[qe+1]),et.numPoints++,et.numSimplified++;else if(xe==="LineString")bc(Re,ye,et,ie,!1,!1);else if(xe==="MultiLineString"||xe==="Polygon")for(let qe=0;qe<ye.length;qe++)bc(Re,ye[qe],et,ie,xe==="Polygon",qe===0);else if(xe==="MultiPolygon")for(let qe=0;qe<ye.length;qe++){const Oe=ye[qe];for(let Je=0;Je<Oe.length;Je++)bc(Re,Oe[Je],et,ie,!0,Je===0)}if(Re.length){let qe=K.tags||null;if(xe==="LineString"&&oe.lineMetrics){qe={};for(const Je in K.tags)qe[Je]=K.tags[Je];qe.mapbox_clip_start=ye.start/ye.size,qe.mapbox_clip_end=ye.end/ye.size}const Oe={geometry:Re,type:xe==="Polygon"||xe==="MultiPolygon"?3:xe==="LineString"||xe==="MultiLineString"?2:1,tags:qe};K.id!==null&&(Oe.id=K.id),et.features.push(Oe)}}function bc(et,K,ie,oe,ye,xe){const Re=oe*oe;if(oe>0&&K.size<(ye?Re:oe))return void(ie.numPoints+=K.length/3);const qe=[];for(let Oe=0;Oe<K.length;Oe+=3)(oe===0||K[Oe+2]>Re)&&(ie.numSimplified++,qe.push(K[Oe],K[Oe+1])),ie.numPoints++;ye&&function(Oe,Je){let Ke=0;for(let Qe=0,ft=Oe.length,It=ft-2;Qe<ft;It=Qe,Qe+=2)Ke+=(Oe[Qe]-Oe[It])*(Oe[Qe+1]+Oe[It+1]);if(Ke>0===Je)for(let Qe=0,ft=Oe.length;Qe<ft/2;Qe+=2){const It=Oe[Qe],Pt=Oe[Qe+1];Oe[Qe]=Oe[ft-2-Qe],Oe[Qe+1]=Oe[ft-1-Qe],Oe[ft-2-Qe]=It,Oe[ft-1-Qe]=Pt}}(qe,xe),et.push(qe)}const Pd={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Rd{constructor(K,ie){const oe=(ie=this.options=function(xe,Re){for(const qe in Re)xe[qe]=Re[qe];return xe}(Object.create(Pd),ie)).debug;if(oe&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");let ye=function(xe,Re){const qe=[];if(xe.type==="FeatureCollection")for(let Oe=0;Oe<xe.features.length;Oe++)Gi(qe,xe.features[Oe],Re,Oe);else Gi(qe,xe.type==="Feature"?xe:{geometry:xe},Re);return qe}(K,ie);this.tiles={},this.tileCoords=[],oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ye=function(xe,Re){const qe=Re.buffer/Re.extent;let Oe=xe;const Je=Rn(xe,1,-1-qe,qe,0,-1,2,Re),Ke=Rn(xe,1,1-qe,2+qe,0,-1,2,Re);return(Je||Ke)&&(Oe=Rn(xe,1,-qe,1+qe,0,-1,2,Re)||[],Je&&(Oe=As(Je,1).concat(Oe)),Ke&&(Oe=Oe.concat(As(Ke,-1)))),Oe}(ye,ie),ye.length&&this.splitTile(ye,0,0,0),oe&&(ye.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(K,ie,oe,ye,xe,Re,qe){const Oe=[K,ie,oe,ye],Je=this.options,Ke=Je.debug;for(;Oe.length;){ye=Oe.pop(),oe=Oe.pop(),ie=Oe.pop(),K=Oe.pop();const Qe=1<<ie,ft=pr(ie,oe,ye);let It=this.tiles[ft];if(!It&&(Ke>1&&console.time("creation"),It=this.tiles[ft]=xc(K,ie,oe,ye,Je),this.tileCoords.push({z:ie,x:oe,y:ye}),Ke)){Ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,oe,ye,It.numFeatures,It.numPoints,It.numSimplified),console.timeEnd("creation"));const tr=`z${ie}`;this.stats[tr]=(this.stats[tr]||0)+1,this.total++}if(It.source=K,xe==null){if(ie===Je.indexMaxZoom||It.numPoints<=Je.indexMaxPoints)continue}else{if(ie===Je.maxZoom||ie===xe)continue;if(xe!=null){const tr=xe-ie;if(oe!==Re>>tr||ye!==qe>>tr)continue}}if(It.source=null,K.length===0)continue;Ke>1&&console.time("clipping");const Pt=.5*Je.buffer/Je.extent,si=.5-Pt,ui=.5+Pt,hi=1+Pt;let ci=null,Ni=null,$i=null,Ii=null,Zi=Rn(K,Qe,oe-Pt,oe+ui,0,It.minX,It.maxX,Je),Ki=Rn(K,Qe,oe+si,oe+hi,0,It.minX,It.maxX,Je);K=null,Zi&&(ci=Rn(Zi,Qe,ye-Pt,ye+ui,1,It.minY,It.maxY,Je),Ni=Rn(Zi,Qe,ye+si,ye+hi,1,It.minY,It.maxY,Je),Zi=null),Ki&&($i=Rn(Ki,Qe,ye-Pt,ye+ui,1,It.minY,It.maxY,Je),Ii=Rn(Ki,Qe,ye+si,ye+hi,1,It.minY,It.maxY,Je),Ki=null),Ke>1&&console.timeEnd("clipping"),Oe.push(ci||[],ie+1,2*oe,2*ye),Oe.push(Ni||[],ie+1,2*oe,2*ye+1),Oe.push($i||[],ie+1,2*oe+1,2*ye),Oe.push(Ii||[],ie+1,2*oe+1,2*ye+1)}}getTile(K,ie,oe){K=+K,ie=+ie,oe=+oe;const ye=this.options,{extent:xe,debug:Re}=ye;if(K<0||K>24)return null;const qe=1<<K,Oe=pr(K,ie=ie+qe&qe-1,oe);if(this.tiles[Oe])return yc(this.tiles[Oe],xe);Re>1&&console.log("drilling down to z%d-%d-%d",K,ie,oe);let Je,Ke=K,Qe=ie,ft=oe;for(;!Je&&Ke>0;)Ke--,Qe>>=1,ft>>=1,Je=this.tiles[pr(Ke,Qe,ft)];return Je&&Je.source?(Re>1&&(console.log("found parent tile z%d-%d-%d",Ke,Qe,ft),console.time("drilling down")),this.splitTile(Je.source,Ke,Qe,ft,K,ie,oe),Re>1&&console.timeEnd("drilling down"),this.tiles[Oe]?yc(this.tiles[Oe],xe):null):null}}function pr(et,K,ie){return 32*((1<<et)*ie+K)+et}function Fu(et,K){const ie=et.tileID.canonical;if(!this._geoJSONIndex)return void K(null,null);const oe=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!oe)return void K(null,null);const ye=new ni(oe.features);let xe=Le(ye);xe.byteOffset===0&&xe.byteLength===xe.buffer.byteLength||(xe=new Uint8Array(xe)),K(null,{vectorTile:ye,rawData:xe.buffer})}class Dd extends Ve{constructor(K,ie,oe,ye,xe,Re){super(K,ie,oe,ye,Fu,Re),xe&&(this.loadGeoJSON=xe),this._dynamicIndex=new ti}loadData(K,ie){const oe=K&&K.request,ye=oe&&oe.collectResourceTiming;this.loadGeoJSON(K,(xe,Re)=>{if(xe||!Re)return ie(xe);if(typeof Re!="object")return ie(new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`));{try{if(K.filter){const Oe=n.U(K.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Oe.result==="error")throw new Error(Oe.value.map(Je=>`${Je.key}: ${Je.message}`).join(", "));Re.features=Re.features.filter(Je=>Oe.value.evaluate({zoom:0},Je))}K.dynamic?(Re.type==="Feature"&&(Re={type:"FeatureCollection",features:[Re]}),K.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Re.features,this.loaded),K.cluster&&(Re.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=K.cluster?new Ut(function({superclusterOptions:Oe,clusterProperties:Je}){if(!Je||!Oe)return Oe;const Ke={},Qe={},ft={accumulated:null,zoom:0},It={properties:null},Pt=Object.keys(Je);for(const si of Pt){const[ui,hi]=Je[si],ci=n.U(hi),Ni=n.U(typeof ui=="string"?[ui,["accumulated"],["get",si]]:ui);Ke[si]=ci.value,Qe[si]=Ni.value}return Oe.map=si=>{It.properties=si;const ui={};for(const hi of Pt)ui[hi]=Ke[hi].evaluate(ft,It);return ui},Oe.reduce=(si,ui)=>{It.properties=ui;for(const hi of Pt)ft.accumulated=si[hi],si[hi]=Qe[hi].evaluate(ft,It)},Oe}(K)).load(Re.features):K.dynamic?this._dynamicIndex:function(Oe,Je){return new Rd(Oe,Je)}(Re,K.geojsonVtOptions)}catch(Oe){return ie(Oe)}const qe={};if(ye){const Oe=k(oe);Oe&&(qe.resourceTiming={},qe.resourceTiming[K.source]=JSON.parse(JSON.stringify(Oe)))}ie(null,qe)}})}reloadTile(K,ie){const oe=this.loaded;return oe&&oe[K.uid]?K.partial?ie(null,void 0):super.reloadTile(K,ie):this.loadTile(K,ie)}loadGeoJSON(K,ie){if(K.request)n.n(K.request,ie);else{if(typeof K.data!="string")return ie(new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`));try{return ie(null,JSON.parse(K.data))}catch{return ie(new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(K,ie){try{ie(null,this._geoJSONIndex.getClusterExpansionZoom(K.clusterId))}catch(oe){ie(oe)}}getClusterChildren(K,ie){try{ie(null,this._geoJSONIndex.getChildren(K.clusterId))}catch(oe){ie(oe)}}getClusterLeaves(K,ie){try{ie(null,this._geoJSONIndex.getLeaves(K.clusterId,K.limit,K.offset))}catch(oe){ie(oe)}}}class Nu{constructor(K,ie){this.tileID=new n.aG(K.tileID.overscaledZ,K.tileID.wrap,K.tileID.canonical.z,K.tileID.canonical.x,K.tileID.canonical.y),this.tileZoom=K.tileZoom,this.uid=K.uid,this.zoom=K.zoom,this.canonical=K.tileID.canonical,this.pixelRatio=K.pixelRatio,this.tileSize=K.tileSize,this.source=K.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=K.projection,this.brightness=ie}parse(K,ie,oe,ye){this.status="parsing";const xe=new n.aG(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),Re=[],qe=ie.familiesBySource[oe.source],Oe=new n.d$(xe,oe.promoteId);return Oe.bucketLayerIDs=[],Oe.is3DTile=!0,n.ea(K).then(Je=>{if(!Je)return ye(new Error("Could not parse tile"));const Ke=n.eb(Je,1/n.cc(oe.tileID.canonical)),Qe=Je.json.extensionsUsed&&Je.json.extensionsUsed.includes("MAPBOX_mesh_features")||Je.json.asset.extras&&Je.json.asset.extras.MAPBOX_mesh_features,ft=Je.json.extensionsUsed&&Je.json.extensionsUsed.includes("EXT_meshopt_compression"),It=new n.a8(this.zoom,{brightness:this.brightness});for(const Pt in qe)for(const si of qe[Pt]){const ui=si[0];Oe.bucketLayerIDs.push(si.map(ci=>n.aC(ci.id,ci.scope))),ui.recalculate(It,[]);const hi=new n.ec(si,Ke,xe,Qe,ft,this.brightness,Oe);Qe||(hi.needsUpload=!0),Re.push(hi),hi.evaluate(ui)}this.status="done",ye(null,{buckets:Re,featureIndex:Oe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Je=>ye(new Error(Je.message)))}}class $r{constructor(K,ie,oe,ye,xe,Re){this.actor=K,this.layerIndex=ie,this.availableImages=oe,this.brightness=Re,this.loading={},this.loaded={}}loadTile(K,ie){const oe=K.uid,ye=this.loading[oe]=new Nu(K,this.brightness);n.bi(K.request,(xe,Re)=>{const qe=!this.loading[oe];return delete this.loading[oe],qe||xe?(ye.status="done",qe||(this.loaded[oe]=ye),ie(xe)):Re&&Re.byteLength!==0?void ye.parse(Re,this.layerIndex,K,(Oe,Je)=>{ye.status="done",this.loaded=this.loaded||{},this.loaded[oe]=ye,Oe||!Je?ie(Oe):ie(null,Je)}):(ye.status="done",this.loaded[oe]=ye,ie())})}reloadTile(K,ie){const oe=this.loaded,ye=K.uid;if(oe&&oe[ye]){const xe=oe[ye];xe.projection=K.projection,xe.brightness=K.brightness;const Re=(qe,Oe)=>{xe.reloadCallback&&(delete xe.reloadCallback,this.loadTile(K,ie)),ie(qe,Oe)};xe.status==="parsing"?xe.reloadCallback=Re:xe.status==="done"&&this.loadTile(K,ie)}}abortTile(K,ie){const oe=K.uid;this.loading[oe]&&delete this.loading[oe],ie()}removeTile(K,ie){const oe=this.loaded,ye=K.uid;oe&&oe[ye]&&delete oe[ye],ie()}}class Ko{constructor(K){this.self=K,this.actor=new n.ed(K,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new n.I,this.projections={},this.defaultProjection=n.bP({name:"mercator"}),this.workerSourceTypes={vector:Ve,geojson:Dd,"batched-model":$r},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ie,oe)=>{if(this.workerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.workerSourceTypes[ie]=oe},this.self.registerRTLTextPlugin=ie=>{if(n.ee.isParsed())throw new Error("RTL text plugin already registered.");n.ee.applyArabicShaping=ie.applyArabicShaping,n.ee.processBidirectionalText=ie.processBidirectionalText,n.ee.processStyledBidirectionalText=ie.processStyledBidirectionalText}}clearCaches(K,ie,oe){delete this.layerIndexes[K],delete this.availableImages[K],delete this.workerSources[K],delete this.demWorkerSources[K],delete this.rasterArrayWorkerSource,oe()}checkIfReady(K,ie,oe){oe()}setReferrer(K,ie){this.referrer=ie}spriteLoaded(K,{scope:ie,isLoaded:oe}){if(this.isSpriteLoaded[K]||(this.isSpriteLoaded[K]={}),this.isSpriteLoaded[K][ie]=oe,this.workerSources[K]&&this.workerSources[K][ie])for(const ye in this.workerSources[K][ie]){const xe=this.workerSources[K][ie][ye];for(const Re in xe){const qe=xe[Re];qe instanceof Ve&&(qe.isSpriteLoaded=oe,qe.fire(new n.z("isSpriteLoaded")))}}}setImages(K,{scope:ie,images:oe},ye){if(this.availableImages[K]||(this.availableImages[K]={}),this.availableImages[K][ie]=oe,this.workerSources[K]&&this.workerSources[K][ie]){for(const xe in this.workerSources[K][ie]){const Re=this.workerSources[K][ie][xe];for(const qe in Re)Re[qe].availableImages=oe}ye()}else ye()}setProjection(K,ie){this.projections[K]=n.bP(ie)}setBrightness(K,ie,oe){this.brightness=ie,oe()}setLayers(K,ie,oe){this.getLayerIndex(K,ie.scope).replace(ie.layers,ie.options),oe()}updateLayers(K,ie,oe){this.getLayerIndex(K,ie.scope).update(ie.layers,ie.removedIds,ie.options),oe()}loadTile(K,ie,oe){ie.projection=this.projections[K]||this.defaultProjection,this.getWorkerSource(K,ie.type,ie.source,ie.scope).loadTile(ie,oe)}loadDEMTile(K,ie,oe){this.getDEMWorkerSource(K,ie.source,ie.scope).loadTile(ie,oe)}decodeRasterArray(K,ie,oe){this.getRasterArrayWorkerSource().decodeRasterArray(ie,oe)}reloadTile(K,ie,oe){ie.projection=this.projections[K]||this.defaultProjection,this.getWorkerSource(K,ie.type,ie.source,ie.scope).reloadTile(ie,oe)}abortTile(K,ie,oe){this.getWorkerSource(K,ie.type,ie.source,ie.scope).abortTile(ie,oe)}removeTile(K,ie,oe){this.getWorkerSource(K,ie.type,ie.source,ie.scope).removeTile(ie,oe)}removeSource(K,ie,oe){if(!(this.workerSources[K]&&this.workerSources[K][ie.scope]&&this.workerSources[K][ie.scope][ie.type]&&this.workerSources[K][ie.scope][ie.type][ie.source]))return;const ye=this.workerSources[K][ie.scope][ie.type][ie.source];delete this.workerSources[K][ie.scope][ie.type][ie.source],ye.removeSource!==void 0?ye.removeSource(ie,oe):oe()}loadWorkerSource(K,ie,oe){try{this.self.importScripts(ie.url),oe()}catch(ye){oe(ye.toString())}}syncRTLPluginState(K,ie,oe){try{n.ee.setState(ie);const ye=n.ee.getPluginURL();if(n.ee.isLoaded()&&!n.ee.isParsed()&&ye!=null){this.self.importScripts(ye);const xe=n.ee.isParsed();oe(xe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ye}`),xe)}}catch(ye){oe(ye.toString())}}setDracoUrl(K,ie){this.dracoUrl=ie}getAvailableImages(K,ie){this.availableImages[K]||(this.availableImages[K]={});let oe=this.availableImages[K][ie];return oe||(oe=[]),oe}getLayerIndex(K,ie){this.layerIndexes[K]||(this.layerIndexes[K]={});let oe=this.layerIndexes[K][ie];return oe||(oe=this.layerIndexes[K][ie]=new Z,oe.scope=ie),oe}getWorkerSource(K,ie,oe,ye){return this.workerSources[K]||(this.workerSources[K]={}),this.workerSources[K][ye]||(this.workerSources[K][ye]={}),this.workerSources[K][ye][ie]||(this.workerSources[K][ye][ie]={}),this.isSpriteLoaded[K]||(this.isSpriteLoaded[K]={}),this.workerSources[K][ye][ie][oe]||(this.workerSources[K][ye][ie][oe]=new this.workerSourceTypes[ie]({send:(xe,Re,qe,Oe,Je,Ke)=>{this.actor.send(xe,Re,qe,K,Je,Ke)},scheduler:this.actor.scheduler},this.getLayerIndex(K,ye),this.getAvailableImages(K,ye),this.isSpriteLoaded[K][ye],void 0,this.brightness)),this.workerSources[K][ye][ie][oe]}rasterizeImages(K,ie,oe){const{imageTasks:ye,scope:xe}=ie,Re={};for(const qe in ye){const{image:Oe,imageIdWithOptions:Je}=ye[qe];Re[qe]=this.imageRasterizer.rasterize(Je,Oe,xe,K)}oe(void 0,Re)}removeRasterizedImages(K,ie,oe){const{imageIds:ye,scope:xe}=ie;this.imageRasterizer.removeImagesFromCacheByIds(ye,xe,K),oe()}getDEMWorkerSource(K,ie,oe){return this.demWorkerSources[K]||(this.demWorkerSources[K]={}),this.demWorkerSources[K][oe]||(this.demWorkerSources[K][oe]={}),this.demWorkerSources[K][oe][ie]||(this.demWorkerSources[K][oe][ie]=new He),this.demWorkerSources[K][oe][ie]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new st),this.rasterArrayWorkerSource}enforceCacheSizeLimit(K,ie){n.ef(ie)}getWorkerPerformanceMetrics(K,ie,oe){oe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ko(self)),Ko}),b(["./shared"],function(n){var k="3.10.0";const j={create:"create",load:"load",fullLoad:"fullLoad"},U={mark(h){performance.mark(h)},measure(h,i,o){performance.measure(h,i,o)}};function Z(h){const i=h.name.split("?")[0];return n.a(i)&&i.includes("mapbox-gl.js")?"javascript":n.a(i)&&i.includes("mapbox-gl.css")?"css":n.b(i)?"fontRange":n.c(i)?"sprite":n.i(i)?"style":n.d(i)?"tilejson":"other"}var re,se={},ue=function(){if(re)return se;function h(d){return!i(d)}function i(d){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,w,C=new Blob([""],{type:"text/javascript"}),D=URL.createObjectURL(C);try{w=new Worker(D),v=!0}catch{v=!1}return w&&w.terminate(),URL.revokeObjectURL(D),v}()?function(){var v=document.createElement("canvas");v.width=v.height=1;var w=v.getContext("2d");if(!w)return!1;var C=w.getImageData(0,0,1,1);return C&&C.width===v.width}()?(o[g=d&&d.failIfMajorPerformanceCaveat]===void 0&&(o[g]=function(v){var w,C=function(D){var L=document.createElement("canvas"),O=Object.create(h.webGLContextAttributes);return O.failIfMajorPerformanceCaveat=D,L.getContext("webgl2",O)}(v);if(!C)return!1;try{w=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!w||C.isContextLost())&&(C.shaderSource(w,"void main() {}"),C.compileShader(w),C.getShaderParameter(w,C.COMPILE_STATUS)===!0)}(g)),o[g]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var g}re=1,se.supported=h,se.notSupportedReason=i;var o={};return h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},se}();function ne(h,i,o){const d=document.createElement(h);return i!=null&&(d.className=i),o&&o.appendChild(d),d}function be(h,i,o){const d=document.createElementNS("http://www.w3.org/2000/svg",h);for(const g of Object.keys(i))d.setAttributeNS(null,g,String(i[g]));return o&&o.appendChild(d),d}const De=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Be=De&&De.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Te;function me(){De&&Be&&(Te=De[Be],De[Be]="none")}function Ie(){De&&Be&&(De[Be]=Te)}function Xe(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",Xe,!0)}function je(){window.addEventListener("click",Xe,!0),window.setTimeout(()=>{window.removeEventListener("click",Xe,!0)},0)}function rt(h,i){const o=h.getBoundingClientRect();return st(h,o,i)}function Ve(h,i){const o=h.getBoundingClientRect(),d=[];for(let g=0;g<i.length;g++)d.push(st(h,o,i[g]));return d}function He(h){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&h.button===2&&h.ctrlKey?0:h.button}function st(h,i,o){const d=h.offsetWidth===i.width?1:h.offsetWidth/i.width;return new n.P((o.clientX-i.left)*d,(o.clientY-i.top)*d)}const dt="01",At="NO_ACCESS_TOKEN";class ni{constructor(i,o,d){this._transformRequestFn=i,this._customAccessToken=o,this._silenceAuthErrors=!!d,this._createSkuToken()}_createSkuToken(){const i=function(){let o="";for(let d=0;d<10;d++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",dt,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,o){return this._transformRequestFn&&this._transformRequestFn(i,o)||{url:i}}normalizeStyleURL(i,o){if(!n.f(i))return i;const d=kt(i);return d.params.push(`sdk=js-${k}`),d.path=`/styles/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||o)}normalizeGlyphsURL(i,o){if(!n.f(i))return i;const d=kt(i);return d.path=`/fonts/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||o)}normalizeModelURL(i,o){if(!n.f(i))return i;const d=kt(i);return d.path=`/models/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||o)}normalizeSourceURL(i,o,d,g){if(!n.f(i))return i;const v=kt(i);return v.path=`/v4/${v.authority}.json`,v.params.push("secure"),d&&v.params.push(`language=${d}`),g&&v.params.push(`worldview=${g}`),this._makeAPIURL(v,this._customAccessToken||o)}normalizeIconsetURL(i,o){const d=kt(i);return n.f(i)?(d.path=`/styles/v1${d.path}/iconset.pbf`,this._makeAPIURL(d,this._customAccessToken||o)):ti(d)}normalizeSpriteURL(i,o,d,g){const v=kt(i);return n.f(i)?(v.path=`/styles/v1${v.path}/sprite${o}${d}`,this._makeAPIURL(v,this._customAccessToken||g)):(v.path+=`${o}${d}`,ti(v))}normalizeTileURL(i,o,d){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!n.f(i))return i;const g=kt(i);g.path=g.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||d&&g.authority!=="raster"&&d===512?"@2x":""}${n.m.supported?".webp":"$1"}`),g.authority==="raster"?g.path=`/${n.e.RASTER_URL_PREFIX}${g.path}`:g.authority==="rasterarrays"?g.path=`/${n.e.RASTERARRAYS_URL_PREFIX}${g.path}`:g.authority==="3dtiles"?g.path=`/${n.e.TILES3D_URL_PREFIX}${g.path}`:(g.path=g.path.replace(/^.+\/v4\//,"/"),g.path=`/${n.e.TILE_URL_VERSION}${g.path}`);const v=this._customAccessToken||function(w){for(const C of w){const D=C.match(/^access_token=(.*)$/);if(D)return D[1]}return null}(g.params)||n.e.ACCESS_TOKEN;return n.e.REQUIRE_ACCESS_TOKEN&&v&&this._skuToken&&g.params.push(`sku=${this._skuToken}`),this._makeAPIURL(g,v)}canonicalizeTileURL(i,o){const d=kt(i);if(!d.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!d.path.match(/\.[\w]+$/))return i;let g="mapbox://";d.path.match(/^\/raster\/v1\//)?g+=`raster/${d.path.replace(`/${n.e.RASTER_URL_PREFIX}/`,"")}`:d.path.match(/^\/rasterarrays\/v1\//)?g+=`rasterarrays/${d.path.replace(`/${n.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:g+=`tiles/${d.path.replace(`/${n.e.TILE_URL_VERSION}/`,"")}`;let v=d.params;return o&&(v=v.filter(w=>!w.match(/^access_token=/))),v.length&&(g+=`?${v.join("&")}`),g}canonicalizeTileset(i,o){const d=!!o&&n.f(o),g=[];for(const v of i.tiles||[])n.h(v)?g.push(this.canonicalizeTileURL(v,d)):g.push(v);return g}_makeAPIURL(i,o){const d="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",g=kt(n.e.API_URL);if(i.protocol=g.protocol,i.authority=g.authority,i.protocol==="http"){const v=i.params.indexOf("secure");v>=0&&i.params.splice(v,1)}if(g.path!=="/"&&(i.path=`${g.path}${i.path}`),!n.e.REQUIRE_ACCESS_TOKEN)return ti(i);if(o=o||n.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${d}`);if(o[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${d}`)}return i.params=i.params.filter(v=>v.indexOf("access_token")===-1),i.params.push(`access_token=${o||""}`),ti(i)}}const Tt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function kt(h){const i=h.match(Tt);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function ti(h){const i=h.params.length?`?${h.params.join("&")}`:"";return`${h.protocol}://${h.authority}${h.path}${i}`}const li="mapbox.eventData";function ii(h){if(!h)return null;const i=h.split(".");if(!i||i.length!==3)return null;try{return JSON.parse(n.j(i[1]))}catch{return null}}class Pn{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const o=ii(n.e.ACCESS_TOKEN);let d="";return d=o&&o.u?n.k(o.u):n.e.ACCESS_TOKEN||"",i?`${li}.${i}:${d}`:`${li}:${d}`}fetchEventData(){const i=n.s("localStorage"),o=this.getStorageKey(),d=this.getStorageKey("uuid");if(i)try{const g=localStorage.getItem(o);g&&(this.eventData=JSON.parse(g));const v=localStorage.getItem(d);v&&(this.anonId=v)}catch{n.w("Unable to read from LocalStorage")}}saveEventData(){const i=n.s("localStorage"),o=this.getStorageKey(),d=this.getStorageKey("uuid"),g=this.anonId;if(i&&g)try{localStorage.setItem(d,g),Object.keys(this.eventData).length>=1&&localStorage.setItem(o,JSON.stringify(this.eventData))}catch{n.w("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,o,d,g){if(!n.e.EVENTS_URL)return;const v=kt(n.e.EVENTS_URL);v.params.push(`access_token=${g||n.e.ACCESS_TOKEN||""}`);const w={event:this.type,created:new Date(i).toISOString()},C=o?n.l(w,o):w,D={url:ti(v),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};this.pendingRequest=n.p(D,L=>{this.pendingRequest=null,d(L),this.saveEventData(),this.processRequests(g)})}queueRequest(i,o){this.queue.push(i),this.processRequests(o)}}const Fn=new class extends Pn{constructor(h){super("appUserTurnstile"),this._customAccessToken=h}postTurnstileEvent(h,i){n.e.EVENTS_URL&&n.e.ACCESS_TOKEN&&Array.isArray(h)&&h.some(o=>n.f(o)||n.h(o))&&this.queueRequest(Date.now(),i)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=ii(n.e.ACCESS_TOKEN),o=i?i.u:n.e.ACCESS_TOKEN;let d=o!==this.eventData.tokenU;n.v(this.anonId)||(this.anonId=n.u(),d=!0);const g=this.queue.shift();if(this.eventData.lastSuccess){const v=new Date(this.eventData.lastSuccess),w=new Date(g),C=(g-this.eventData.lastSuccess)/864e5;d=d||C>=1||C<-1||v.getDate()!==w.getDate()}else d=!0;d?this.postEvent(g,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:dt,"enabled.telemetry":!1,userId:this.anonId},v=>{v||(this.eventData.lastSuccess=g,this.eventData.tokenU=o)},h):this.processRequests()}},xn=Fn.postTurnstileEvent.bind(Fn),_i=new class extends Pn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(h,i,o,d){this.skuToken=i,this.errorCb=d,n.e.EVENTS_URL&&(o||n.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},o):this.errorCb(new Error(At)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:o}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),n.v(this.anonId)||(this.anonId=n.u()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:dt,skuToken:this.skuToken,userId:this.anonId},d=>{d?this.errorCb(d):i&&(this.success[i]=!0)},h))}remove(){this.errorCb=null}},dr=_i.postMapLoadEvent.bind(_i),Wn=new class extends Pn{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(h){let i=this.mapInstanceIdMap.get(h);return i||(i=n.u(),this.mapInstanceIdMap.set(h,i)),i}getEventId(h){const i=this.eventIdPerMapInstanceMap.get(h)||0;return this.eventIdPerMapInstanceMap.set(h,i+1),i}postStyleLoadEvent(h,i){const{map:o,style:d,importedStyles:g}=i;if(!n.e.EVENTS_URL||!h&&!n.e.ACCESS_TOKEN)return;const v=this.getMapInstanceId(o),w={mapInstanceId:v,eventId:this.getEventId(v),style:d};g.length&&(w.importedStyles=g),this.queueRequest({timestamp:Date.now(),payload:w},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,payload:o}=this.queue.shift();this.postEvent(i,o,()=>{},h)}},Vr=Wn.postStyleLoadEvent.bind(Wn),hs=new class extends Pn{constructor(){super("gljs.performance")}postPerformanceEvent(h,i){n.e.EVENTS_URL&&(h||n.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,performanceData:o}=this.queue.shift(),d=function(g){const v=performance.getEntriesByType("resource"),w=performance.getEntriesByType("mark"),C=function(q){const J={};if(q){for(const X in q)if(X!=="other")for(const ee of q[X]){const Q=`${X}ResolveRangeMin`,ae=`${X}ResolveRangeMax`,pe=`${X}RequestCount`,fe=`${X}RequestCachedCount`;J[Q]=Math.min(J[Q]||1/0,ee.startTime),J[ae]=Math.max(J[ae]||-1/0,ee.responseEnd);const we=ge=>{J[ge]===void 0&&(J[ge]=0),++J[ge]};ee.transferSize!==void 0&&ee.transferSize===0&&we(fe),we(pe)}}return J}(function(q,J){const X={};if(q)for(const ee of q){const Q=J(ee);X[Q]===void 0&&(X[Q]=[]),X[Q].push(ee)}return X}(v,Z)),D=window.devicePixelRatio,L=navigator.connection||navigator.mozConnection||navigator.webkitConnection,O=L?L.effectiveType:void 0,N={counters:[],metadata:[],attributes:[]},B=(q,J,X)=>{X!=null&&q.push({name:J,value:X.toString()})};for(const q in C)B(N.counters,q,C[q]);if(g.interactionRange[0]!==1/0&&g.interactionRange[1]!==-1/0&&(B(N.counters,"interactionRangeMin",g.interactionRange[0]),B(N.counters,"interactionRangeMax",g.interactionRange[1])),w)for(const q of Object.keys(j)){const J=j[q],X=w.find(ee=>ee.name===J);X&&B(N.counters,J,X.startTime)}return B(N.counters,"visibilityHidden",g.visibilityHidden),B(N.attributes,"style",function(q){if(q)for(const J of q){const X=J.name.split("?")[0];if(n.i(X)){const ee=X.split("/").slice(-2);if(ee.length===2)return`mapbox://styles/${ee[0]}/${ee[1]}`}}}(v)),B(N.attributes,"terrainEnabled",g.terrainEnabled?"true":"false"),B(N.attributes,"fogEnabled",g.fogEnabled?"true":"false"),B(N.attributes,"projection",g.projection),B(N.attributes,"zoom",g.zoom),B(N.metadata,"devicePixelRatio",D),B(N.metadata,"connectionEffectiveType",O),B(N.metadata,"navigatorUserAgent",navigator.userAgent),B(N.metadata,"screenWidth",window.screen.width),B(N.metadata,"screenHeight",window.screen.height),B(N.metadata,"windowWidth",window.innerWidth),B(N.metadata,"windowHeight",window.innerHeight),B(N.metadata,"mapWidth",g.width/D),B(N.metadata,"mapHeight",g.height/D),B(N.metadata,"webglRenderer",g.renderer),B(N.metadata,"webglVendor",g.vendor),B(N.metadata,"sdkVersion",k),B(N.metadata,"sdkIdentifier","mapbox-gl-js"),N}(o);for(const g of d.metadata);for(const g of d.counters);for(const g of d.attributes);this.postEvent(i,d,()=>{},h)}},fr=hs.postPerformanceEvent.bind(hs),Us=new class extends Pn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(h,i,o,d){if(!n.e.API_URL||!n.e.SESSION_PATH)return;const g=kt(n.e.API_URL+n.e.SESSION_PATH);g.params.push(`sku=${i||""}`),g.params.push(`access_token=${d||n.e.ACCESS_TOKEN||""}`);const v={url:ti(g),headers:{"Content-Type":"text/plain"}};this.pendingRequest=n.g(v,w=>{this.pendingRequest=null,o(w),this.saveEventData(),this.processRequests(d)})}getSessionAPI(h,i,o,d){this.skuToken=i,this.errorCb=d,n.e.SESSION_PATH&&n.e.API_URL&&(o||n.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},o):this.errorCb(new Error(At)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:o}=this.queue.shift();i&&this.success[i]||this.getSession(o,this.skuToken,d=>{d?this.errorCb(d):i&&(this.success[i]=!0)},h)}remove(){this.errorCb=null}},Le=Us.getSessionAPI.bind(Us),Ss=new Set;function ro(h,i){i?Ss.add(h):Ss.delete(h)}class Ze{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(i,o){this._updatedSourceCaches[i]=o,this.setDirty()}discardSourceCacheUpdate(i){delete this._updatedSourceCaches[i]}updateLayer(i){const o=i.scope;this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._updatedLayers[o].add(i.id),this.setDirty()}removeLayer(i){const o=i.scope;this._removedLayers[o]=this._removedLayers[o]||{},this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._removedLayers[o][i.id]=i,this._updatedLayers[o].delete(i.id),this._updatedPaintProps.delete(i.fqid),this.setDirty()}getRemovedLayer(i){return this._removedLayers[i.scope]?this._removedLayers[i.scope][i.id]:null}discardLayerRemoval(i){this._removedLayers[i.scope]&&delete this._removedLayers[i.scope][i.id]}getLayerUpdatesByScope(){const i={};for(const o in this._updatedLayers)i[o]=i[o]||{},i[o].updatedIds=Array.from(this._updatedLayers[o].values());for(const o in this._removedLayers)i[o]=i[o]||{},i[o].removedIds=Object.keys(this._removedLayers[o]);return i}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(i){this._updatedPaintProps.add(i.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(i){this._updatedImages.add(i),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function Se(h){const{userImage:i}=h;return!!(i&&i.render&&i.render())&&(h.data.replace(new Uint8Array(i.data.buffer)),!0)}class bt extends n.E{constructor(i){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=i,i!=="raster"&&n.t()&&(this.imageRasterizerDispatcher=new n.D(n.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new n.I),this._imageRasterizer}createScope(i){this.images[i]={},this.loaded[i]=!1,this.updatedImages[i]={},this.patterns[i]={},this.callbackDispatchedThisFrame[i]={},this.atlasImage[i]=new n.r({width:1,height:1})}isLoaded(){for(const i in this.loaded)if(!this.loaded[i])return!1;return!0}setLoaded(i,o){if(this.loaded[o]!==i&&(this.loaded[o]=i,i)){for(const{ids:d,callback:g}of this.requestors)this._notify(d,o,g);this.requestors=[]}}hasImage(i,o){return!!this.getImage(i,o)}getImage(i,o){return this.images[o][i]}addImage(i,o,d){this._validate(i,d)&&(this.images[o][i]=d)}_validate(i,o){let d=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new n.y(new Error(`Image "${i}" has invalid "stretchX" value`))),d=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new n.y(new Error(`Image "${i}" has invalid "stretchY" value`))),d=!1),this._validateContent(o.content,o)||(this.fire(new n.y(new Error(`Image "${i}" has invalid "content" value`))),d=!1),d}_validateStretch(i,o){if(!i)return!0;let d=0;for(const g of i){if(g[0]<d||g[1]<g[0]||o<g[1])return!1;d=g[1]}return!0}_validateContent(i,o){return i?i.length!==4||!o.usvg&&(i[0]<0||o.data.width<i[0]||i[1]<0||o.data.height<i[1]||i[2]<0||o.data.width<i[2]||i[3]<0||o.data.height<i[3])?!1:!(i[2]<i[0]||i[3]<i[1]):!0}updateImage(i,o,d){d.version=this.images[o][i].version+1,this.images[o][i]=d,this.updatedImages[o][i]=!0,this.removeFromImageRasterizerCache(i,o)}removeFromImageRasterizerCache(i,o){this.spriteFormat!=="raster"&&(n.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[i],scope:o}):this.imageRasterizer.removeImagesFromCacheByIds([i],o))}removeImage(i,o){const d=this.images[o][i];delete this.images[o][i],delete this.patterns[o][i],this.removeFromImageRasterizerCache(i,o),d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(i){return Object.keys(this.images[i])}getImages(i,o,d){let g=!0;const v=!!this.loaded[o];if(!v)for(const w of i)this.images[o][w]||(g=!1);v||g?this._notify(i,o,d):this.requestors.push({ids:i,scope:o,callback:d})}rasterizeImages({scope:i,imageTasks:o},d){const g={};for(const v in o){const w=o[v],C=this.getImage(w.id,i);C&&(g[v]={image:C,imageIdWithOptions:w})}n.t()?this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{imageTasks:g,scope:i},d):this.rasterizeImagesInMainThread({imageTasks:g,scope:i},d)}rasterizeImagesInMainThread(i,o){const{imageTasks:d,scope:g}=i,v={};for(const w in d){const{image:C,imageIdWithOptions:D}=d[w];v[w]=this.imageRasterizer.rasterize(D,C,g,"")}o(void 0,v)}getUpdatedImages(i){return this.updatedImages[i]}_notify(i,o,d){const g={};for(const v of i){this.images[o][v]||this.fire(new n.z("styleimagemissing",{id:v}));const w=this.images[o][v];w?g[v]={data:w.usvg?null:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,usvg:w.usvg,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:!!(w.userImage&&w.userImage.render)}:n.w(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,g)}getPixelSize(i){const{width:o,height:d}=this.atlasImage[i];return{width:o,height:d}}getPattern(i,o,d){const g=this.patterns[o][i],v=this.getImage(i,o);if(!v)return null;if(g&&g.position.version===v.version)return g.position;if(g)g.position.version=v.version;else{v.usvg&&!v.data&&(v.data=this.imageRasterizer.rasterize(n.A.from(i).getPrimary(),v,o,""));const w={w:v.data.width+2*n.B,h:v.data.height+2*n.B,x:0,y:0},C=new n.C(w,v,n.B);this.patterns[o][i]={bin:w,position:C}}return this._updatePatternAtlas(o,d),this.patterns[o][i].position}bind(i,o){const d=i.gl;let g=this.atlasTexture[o];g?this.dirty&&(g.update(this.atlasImage[o]),this.dirty=!1):(g=new n.T(i,this.atlasImage[o],d.RGBA8),this.atlasTexture[o]=g),g.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(i,o){const d=[];for(const C in this.patterns[i])d.push(this.patterns[i][C].bin);const{w:g,h:v}=n.F(d),w=this.atlasImage[i];w.resize({width:g||1,height:v||1});for(const C in this.patterns[i]){const{bin:D,position:L}=this.patterns[i][C];let O=L.padding;const N=D.x+O,B=D.y+O,q=this.images[i][C].data,J=q.width,X=q.height;O=O>1?O-1:O,n.r.copy(q,w,{x:0,y:0},{x:N,y:B},{width:J,height:X},o),n.r.copy(q,w,{x:0,y:X-O},{x:N,y:B-O},{width:J,height:O},o),n.r.copy(q,w,{x:0,y:0},{x:N,y:B+X},{width:J,height:O},o),n.r.copy(q,w,{x:J-O,y:0},{x:N-O,y:B},{width:O,height:X},o),n.r.copy(q,w,{x:0,y:0},{x:N+J,y:B},{width:O,height:X},o),n.r.copy(q,w,{x:J-O,y:X-O},{x:N-O,y:B-O},{width:O,height:O},o),n.r.copy(q,w,{x:0,y:X-O},{x:N+J,y:B-O},{width:O,height:O},o),n.r.copy(q,w,{x:0,y:0},{x:N+J,y:B+X},{width:O,height:O},o),n.r.copy(q,w,{x:J-O,y:0},{x:N-O,y:B+X},{width:O,height:O},o)}this.dirty=!0}beginFrame(){for(const i in this.images)this.callbackDispatchedThisFrame[i]={}}dispatchRenderCallbacks(i,o){for(const d of i){if(this.callbackDispatchedThisFrame[o][d])continue;this.callbackDispatchedThisFrame[o][d]=!0;const g=this.images[o][d];Se(g)&&this.updateImage(d,o,g)}}}function Bt(h){const i=h.key,o=h.value,d=h.valueSpec||{},g=h.objectElementValidators||{},v=h.style,w=h.styleSpec;let C=[];const D=n.H(o);if(D!=="object")return[new n.V(i,o,`object expected, ${D} found`)];for(const L in o){const O=L.split(".")[0];let N;g[O]?N=g[O]:d[O]?N=Ti:g["*"]?N=g["*"]:d["*"]&&(N=Ti),N?C=C.concat(N({key:(i&&`${i}.`)+L,value:o[L],valueSpec:d[O]||d["*"],style:v,styleSpec:w,object:o,objectKey:L},o)):C.push(new n.G(i,o[L],`unknown property "${L}"`))}for(const L in d)g[L]||d[L].required&&d[L].default===void 0&&o[L]===void 0&&C.push(new n.V(i,o,`missing required property "${L}"`));return C}function Ut(h){const i=h.value,o=h.valueSpec,d=h.style,g=h.styleSpec,v=h.key,w=h.arrayElementValidator||Ti;if(n.H(i)!=="array")return[new n.V(v,i,`array expected, ${n.H(i)} found`)];if(o.length&&i.length!==o.length)return[new n.V(v,i,`array length ${o.length} expected, length ${i.length} found`)];if(o["min-length"]&&i.length<o["min-length"])return[new n.V(v,i,`array length at least ${o["min-length"]} expected, length ${i.length} found`)];let C={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};g.$version<7&&(C.function=o.function),n.H(o.value)==="object"&&(C=o.value);let D=[];for(let L=0;L<i.length;L++)D=D.concat(w({array:i,arrayIndex:L,value:i[L],valueSpec:C,style:d,styleSpec:g,key:`${v}[${L}]`},!0));return D}function yt(h){const i=h.key,o=h.value,d=h.valueSpec;let g=n.H(o);if(g==="number"&&o!=o&&(g="NaN"),g!=="number")return[new n.V(i,o,`number expected, ${g} found`)];if("minimum"in d){let v=d.minimum;if(n.H(d.minimum)==="array"&&(v=d.minimum[h.arrayIndex]),o<v)return[new n.V(i,o,`${o} is less than the minimum value ${v}`)]}if("maximum"in d){let v=d.maximum;if(n.H(d.maximum)==="array"&&(v=d.maximum[h.arrayIndex]),o>v)return[new n.V(i,o,`${o} is greater than the maximum value ${v}`)]}return[]}function Kt(h){const i=h.valueSpec,o=n.K(h.value.type);let d,g,v,w={};const C=o!=="categorical"&&h.value.property===void 0,D=!C,L=n.H(h.value.stops)==="array"&&n.H(h.value.stops[0])==="array"&&n.H(h.value.stops[0][0])==="object",O=Bt({key:h.key,value:h.value,valueSpec:h.styleSpec.function,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(q){if(o==="identity")return[new n.V(q.key,q.value,'identity function may not have a "stops" property')];let J=[];const X=q.value;return J=J.concat(Ut({key:q.key,value:X,valueSpec:q.valueSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:N})),n.H(X)==="array"&&X.length===0&&J.push(new n.V(q.key,X,"array must have at least one stop")),J},default:function(q){return Ti({key:q.key,value:q.value,valueSpec:i,style:q.style,styleSpec:q.styleSpec})}}});return o==="identity"&&C&&O.push(new n.V(h.key,h.value,'missing required property "property"')),o==="identity"||h.value.stops||O.push(new n.V(h.key,h.value,'missing required property "stops"')),o==="exponential"&&h.valueSpec.expression&&!n.L(h.valueSpec)&&O.push(new n.V(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(D&&!n.M(h.valueSpec)?O.push(new n.V(h.key,h.value,"property functions not supported")):C&&!n.N(h.valueSpec)&&O.push(new n.V(h.key,h.value,"zoom functions not supported"))),o!=="categorical"&&!L||h.value.property!==void 0||O.push(new n.V(h.key,h.value,'"property" property is required')),O;function N(q){let J=[];const X=q.value,ee=q.key;if(n.H(X)!=="array")return[new n.V(ee,X,`array expected, ${n.H(X)} found`)];if(X.length!==2)return[new n.V(ee,X,`array length 2 expected, length ${X.length} found`)];if(L){if(n.H(X[0])!=="object")return[new n.V(ee,X,`object expected, ${n.H(X[0])} found`)];if(X[0].zoom===void 0)return[new n.V(ee,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new n.V(ee,X,"object stop key must have value")];const Q=n.K(X[0].zoom);if(typeof Q!="number")return[new n.V(ee,X[0].zoom,"stop zoom values must be numbers")];if(v&&v>Q)return[new n.V(ee,X[0].zoom,"stop zoom values must appear in ascending order")];Q!==v&&(v=Q,g=void 0,w={}),J=J.concat(Bt({key:`${ee}[0]`,value:X[0],valueSpec:{zoom:{}},style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:yt,value:B}}))}else J=J.concat(B({key:`${ee}[0]`,value:X[0],valueSpec:{},style:q.style,styleSpec:q.styleSpec},X));return n.O(n.Q(X[1]))?J.concat([new n.V(`${ee}[1]`,X[1],"expressions are not allowed in function stops.")]):J.concat(Ti({key:`${ee}[1]`,value:X[1],valueSpec:i,style:q.style,styleSpec:q.styleSpec}))}function B(q,J){const X=n.H(q.value),ee=n.K(q.value),Q=q.value!==null?q.value:J;if(d){if(X!==d)return[new n.V(q.key,Q,`${X} stop domain type must match previous stop domain type ${d}`)]}else d=X;if(X!=="number"&&X!=="string"&&X!=="boolean"&&typeof ee!="number"&&typeof ee!="string"&&typeof ee!="boolean")return[new n.V(q.key,Q,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&o!=="categorical"){let ae=`number expected, ${X} found`;return n.M(i)&&o===void 0&&(ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new n.V(q.key,Q,ae)]}return o!=="categorical"||X!=="number"||typeof ee=="number"&&isFinite(ee)&&Math.floor(ee)===ee?o!=="categorical"&&X==="number"&&typeof ee=="number"&&typeof g=="number"&&g!==void 0&&ee<g?[new n.V(q.key,Q,"stop domain values must appear in ascending order")]:(g=ee,o==="categorical"&&ee in w?[new n.V(q.key,Q,"stop domain values must be unique")]:(w[ee]=!0,[])):[new n.V(q.key,Q,`integer expected, found ${String(ee)}`)]}}function Zt(h){const i=(h.expressionContext==="property"?n.S:n.U)(n.Q(h.value),h.valueSpec);if(i.result==="error")return i.value.map(d=>new n.V(`${h.key}${d.key}`,h.value,d.message));const o=i.value.expression||i.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!o.outputDefined())return[new n.V(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!n.W(o))return[new n.V(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter")return Jt(o,h);if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!n.X(o,["zoom","feature-state"]))return[new n.V(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!n.Y(o))return[new n.V(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Jt(h,i){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const g of i.valueSpec.expression.parameters)o.delete(g);if(o.size===0)return[];const d=[];return h instanceof n.Z&&o.has(h.name)?[new n.V(i.key,i.value,`["${h.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(h.eachChild(g=>{d.push(...Jt(g,i))}),d)}function Ht(h){const i=h.key,o=h.value,d=h.valueSpec,g=[];return Array.isArray(d.values)?d.values.indexOf(n.K(o))===-1&&g.push(new n.V(i,o,`expected one of [${d.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(d.values).indexOf(n.K(o))===-1&&g.push(new n.V(i,o,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(o)} found`)),g}function Si(h){return n.$(n.Q(h.value))?Zt(n.J({},h,{expressionContext:"filter",valueSpec:h.styleSpec[`filter_${h.layerType||"fill"}`]})):Ct(h)}function Ct(h){const i=h.value,o=h.key;if(n.H(i)!=="array")return[new n.V(o,i,`array expected, ${n.H(i)} found`)];const d=h.styleSpec;let g,v=[];if(i.length<1)return[new n.V(o,i,"filter array must have at least 1 element")];switch(v=v.concat(Ht({key:`${o}[0]`,value:i[0],valueSpec:d.filter_operator,style:h.style,styleSpec:h.styleSpec})),n.K(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&n.K(i[1])==="$type"&&v.push(new n.V(o,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&v.push(new n.V(o,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(g=n.H(i[1]),g!=="string"&&v.push(new n.V(`${o}[1]`,i[1],`string expected, ${g} found`)));for(let w=2;w<i.length;w++)g=n.H(i[w]),n.K(i[1])==="$type"?v=v.concat(Ht({key:`${o}[${w}]`,value:i[w],valueSpec:d.geometry_type,style:h.style,styleSpec:h.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&v.push(new n.V(`${o}[${w}]`,i[w],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let w=1;w<i.length;w++)v=v.concat(Ct({key:`${o}[${w}]`,value:i[w],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":g=n.H(i[1]),i.length!==2?v.push(new n.V(o,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="string"&&v.push(new n.V(`${o}[1]`,i[1],`string expected, ${g} found`))}return v}function yi(h,i){const o=h.key,d=h.style,g=h.layer,v=h.styleSpec,w=h.value,C=h.objectKey,D=v[`${i}_${h.layerType}`];if(!D)return[];const L=C.match(/^(.*)-use-theme$/);if(i==="paint"&&L&&D[L[1]])return n.O(w)?[].concat(Ti({key:h.key,value:w,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:d,styleSpec:v,expressionContext:"property",propertyType:i,propertyKey:C})):Ti({key:o,value:w,valueSpec:{type:"string"},style:d,styleSpec:v});const O=C.match(/^(.*)-transition$/);if(i==="paint"&&O&&D[O[1]]&&D[O[1]].transition)return Ti({key:o,value:w,valueSpec:v.transition,style:d,styleSpec:v});const N=h.valueSpec||D[C];if(!N)return[new n.G(o,w,`unknown property "${C}"`)];let B;if(n.H(w)==="string"&&n.M(N)&&!N.tokens&&(B=/^{([^}]+)}$/.exec(w))){const J=`\`{ "type": "identity", "property": ${B?JSON.stringify(B[1]):'"_"'} }\``;return[new n.V(o,w,`"${C}" does not support interpolation syntax
Use an identity property function instead: ${J}.`)]}const q=[];if(h.layerType==="symbol")C!=="text-field"||!d||d.glyphs||d.imports||q.push(new n.V(o,w,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&n.a0(n.Q(w))&&n.K(w.type)==="identity"&&q.push(new n.V(o,w,'"text-font" does not support identity functions'));else if(h.layerType==="model"&&i==="paint"&&g&&g.layout&&g.layout.hasOwnProperty("model-id")&&n.M(N)&&(n.a1(N)||n.N(N))){const J=n.S(n.Q(w),N),X=J.value.expression||J.value._styleExpression.expression;X&&!n.X(X,["measure-light"])&&(C==="model-emissive-strength"&&n.Y(X)&&n.W(X)||q.push(new n.V(o,w,`${C} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return q.concat(Ti({key:h.key,value:w,valueSpec:N,style:d,styleSpec:v,expressionContext:"property",propertyType:i,propertyKey:C}))}function Ai(h){return yi(h,"paint")}function Gi(h){return yi(h,"layout")}function Wi(h){let i=[];const o=h.value,d=h.key,g=h.style,v=h.styleSpec;o.type||o.ref||i.push(new n.V(d,o,'either "type" or "ref" is required'));let w=n.K(o.type);const C=n.K(o.ref);if(o.id){const D=n.K(o.id);for(let L=0;L<h.arrayIndex;L++){const O=g.layers[L];n.K(O.id)===D&&i.push(new n.V(d,o.id,`duplicate layer id "${o.id}", previously used at line ${O.id.__line__}`))}}if("ref"in o){let D;["type","source","source-layer","filter","layout"].forEach(L=>{L in o&&i.push(new n.V(d,o[L],`"${L}" is prohibited for ref layers`))}),g.layers.forEach(L=>{n.K(L.id)===C&&(D=L)}),D?D.ref?i.push(new n.V(d,o.ref,"ref cannot reference another ref layer")):w=n.K(D.type):typeof C=="string"&&i.push(new n.V(d,o.ref,`ref layer "${C}" not found`))}else if(w!=="background"&&w!=="sky"&&w!=="slot")if(o.source){const D=g.sources&&g.sources[o.source],L=D&&n.K(D.type);D?L==="vector"&&w==="raster"?i.push(new n.V(d,o.source,`layer "${o.id}" requires a raster source`)):L==="raster"&&w!=="raster"?i.push(new n.V(d,o.source,`layer "${o.id}" requires a vector source`)):L!=="vector"||o["source-layer"]?L==="raster-dem"&&w!=="hillshade"?i.push(new n.V(d,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="raster-array"||["raster","raster-particle"].includes(w)?w!=="line"||!o.paint||!o.paint["line-gradient"]&&!o.paint["line-trim-offset"]||L==="geojson"&&D.lineMetrics?w==="raster-particle"&&L!=="raster-array"&&i.push(new n.V(d,o.source,`layer "${o.id}" requires a 'raster-array' source.`)):i.push(new n.V(d,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new n.V(d,o.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new n.V(d,o,`layer "${o.id}" must specify a "source-layer"`)):i.push(new n.V(d,o.source,`source "${o.source}" not found`))}else i.push(new n.V(d,o,'missing required property "source"'));return i=i.concat(Bt({key:d,value:o,valueSpec:v.layer,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ti({key:`${d}.type`,value:o.type,valueSpec:v.layer.type,style:h.style,styleSpec:h.styleSpec,object:o,objectKey:"type"}),filter:D=>Si(n.J({layerType:w},D)),layout:D=>Bt({layer:o,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":L=>Gi(n.J({layerType:w},L))}}),paint:D=>Bt({layer:o,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":L=>Ai(n.J({layerType:w,layer:o},L))}})}})),i}function un(h){const i=h.value,o=h.key,d=n.H(i);return d!=="string"?[new n.V(o,i,`string expected, ${d} found`)]:[]}const xr={promoteId:function h({key:i,value:o}){if(n.H(o)==="string")return un({key:i,value:o});if(Array.isArray(o)){const d=[],g=n.Q(o),v=n.U(g);return v.result==="error"&&v.value.forEach(w=>{d.push(new n.V(`${i}${w.key}`,null,`${w.message}`))}),n.X(v.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||d.push(new n.V(`${i}`,null,"promoteId expression should be only feature dependent")),d}{const d=[];for(const g in o)d.push(...h({key:`${i}.${g}`,value:o[g]}));return d}}};function sr(h){const i=h.value,o=h.key,d=h.styleSpec,g=h.style;if(!i.type)return[new n.V(o,i,'"type" is required')];const v=n.K(i.type);let w=[];switch(["vector","raster","raster-dem","raster-array"].includes(v)&&(i.url||i.tiles||w.push(new n.G(o,i,'Either "url" or "tiles" is required.'))),v){case"vector":case"raster":case"raster-dem":case"raster-array":return w=w.concat(Bt({key:o,value:i,valueSpec:d[`source_${v.replace("-","_")}`],style:h.style,styleSpec:d,objectElementValidators:xr})),w;case"geojson":if(w=Bt({key:o,value:i,valueSpec:d.source_geojson,style:g,styleSpec:d,objectElementValidators:xr}),i.cluster)for(const C in i.clusterProperties){const[D,L]=i.clusterProperties[C],O=typeof D=="string"?[D,["accumulated"],["get",C]]:D;w.push(...Zt({key:`${o}.${C}.map`,value:L,expressionContext:"cluster-map"})),w.push(...Zt({key:`${o}.${C}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return w;case"video":return Bt({key:o,value:i,valueSpec:d.source_video,style:g,styleSpec:d});case"image":return Bt({key:o,value:i,valueSpec:d.source_image,style:g,styleSpec:d});case"canvas":return[new n.V(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ht({key:`${o}.type`,value:i.type,valueSpec:{values:Ur(d)},style:g,styleSpec:d})}}function Ur(h){return h.source.reduce((i,o)=>{const d=h[o];return d.type.type==="enum"&&(i=i.concat(Object.keys(d.type.values))),i},[])}function Rn(h){const i=h.value,o=h.styleSpec,d=o.light,g=h.style;let v=[];const w=n.H(i);if(i===void 0)return v;if(w!=="object")return v=v.concat([new n.V("light",i,`object expected, ${w} found`)]),v;for(const C in i){const D=C.match(/^(.*)-transition$/),L=C.match(/^(.*)-use-theme$/);v=v.concat(L&&d[L[1]]?Ti({key:C,value:i[C],valueSpec:{type:"string"},style:g,styleSpec:o}):D&&d[D[1]]&&d[D[1]].transition?Ti({key:C,value:i[C],valueSpec:o.transition,style:g,styleSpec:o}):d[C]?Ti({key:C,value:i[C],valueSpec:d[C],style:g,styleSpec:o}):[new n.V(C,i[C],`unknown property "${C}"`)])}return v}function so(h){const i=h.value;let o=[];if(!i)return o;const d=n.H(i);if(d!=="object")return o=o.concat([new n.V("light-3d",i,`object expected, ${d} found`)]),o;const g=h.styleSpec,v=g["light-3d"],w=h.key,C=h.style,D=h.style.lights;for(const N of["type","id"])if(!(N in i))return o=o.concat([new n.V("light-3d",i,`missing property ${N} on light`)]),o;if(i.type&&D)for(let N=0;N<h.arrayIndex;N++){const B=n.K(i.type),q=D[N];n.K(q.type)===B&&o.push(new n.V(w,i.id,`duplicate light type "${i.type}", previously defined at line ${q.id.__line__}`))}const L=`properties_light_${i.type}`;if(!(L in g))return o=o.concat([new n.V("light-3d",i,`Invalid light type ${i.type}`)]),o;const O=g[L];for(const N in i)if(N==="properties"){const B=i[N],q=n.H(B);if(q!=="object")return o=o.concat([new n.V("properties",B,`object expected, ${q} found`)]),o;for(const J in B)o=o.concat(O[J]?Ti({key:J,value:B[J],valueSpec:O[J],style:C,styleSpec:g}):[new n.G(h.key,B[J],`unknown property "${J}"`)])}else{const B=N.match(/^(.*)-transition$/),q=N.match(/^(.*)-use-theme$/);o=o.concat(q&&v[q[1]]?Ti({key:N,value:i[N],valueSpec:{type:"string"},style:C,styleSpec:g}):B&&v[B[1]]&&v[B[1]].transition?Ti({key:N,value:i[N],valueSpec:g.transition,style:C,styleSpec:g}):v[N]?Ti({key:N,value:i[N],valueSpec:v[N],style:C,styleSpec:g}):[new n.G(N,i[N],`unknown property "${N}"`)])}return o}function Ma(h){const i=h.value,o=h.key,d=h.style,g=h.styleSpec,v=g.terrain;let w=[];const C=n.H(i);if(i===void 0||C==="null")return w;if(C!=="object")return w=w.concat([new n.V("terrain",i,`object expected, ${C} found`)]),w;for(const D in i){const L=D.match(/^(.*)-transition$/),O=D.match(/^(.*)-use-theme$/);w=w.concat(O&&v[O[1]]?Ti({key:D,value:i[D],valueSpec:{type:"string"},style:d,styleSpec:g}):L&&v[L[1]]&&v[L[1]].transition?Ti({key:D,value:i[D],valueSpec:g.transition,style:d,styleSpec:g}):v[D]?Ti({key:D,value:i[D],valueSpec:v[D],style:d,styleSpec:g}):[new n.G(D,i[D],`unknown property "${D}"`)])}if(i.source){const D=d.sources&&d.sources[i.source],L=D&&n.K(D.type);D?L!=="raster-dem"&&w.push(new n.V(o,i.source,`terrain cannot be used with a source of type ${String(L)}, it only be used with a "raster-dem" source type`)):w.push(new n.V(o,i.source,`source "${i.source}" not found`))}else w.push(new n.V(o,i,'terrain is missing required property "source"'));return w}function Bn(h){const i=h.value,o=h.style,d=h.styleSpec,g=d.fog;let v=[];const w=n.H(i);if(i===void 0)return v;if(w!=="object")return v=v.concat([new n.V("fog",i,`object expected, ${w} found`)]),v;for(const C in i){const D=C.match(/^(.*)-transition$/),L=C.match(/^(.*)-use-theme$/);v=v.concat(L&&g[L[1]]?Ti({key:C,value:i[C],valueSpec:{type:"string"},style:o,styleSpec:d}):D&&g[D[1]]&&g[D[1]].transition?Ti({key:C,value:i[C],valueSpec:d.transition,style:o,styleSpec:d}):g[C]?Ti({key:C,value:i[C],valueSpec:g[C],style:o,styleSpec:d}):[new n.G(C,i[C],`unknown property "${C}"`)])}return v}const jr={"*":()=>[],array:Ut,boolean:function(h){const i=h.value,o=h.key,d=n.H(i);return d!=="boolean"?[new n.V(o,i,`boolean expected, ${d} found`)]:[]},number:yt,color:function(h){const i=h.key,o=h.value,d=n.H(o);return d!=="string"?[new n.V(i,o,`color expected, ${d} found`)]:n._.parseCSSColor(o)===null?[new n.V(i,o,`color expected, "${o}" found`)]:[]},enum:Ht,filter:Si,function:Kt,layer:Wi,object:Bt,source:sr,model:n.a2,light:Rn,"light-3d":so,terrain:Ma,fog:Bn,string:un,formatted:function(h){return un(h).length===0?[]:Zt(h)},resolvedImage:function(h){return un(h).length===0?[]:Zt(h)},projection:function(h){const i=h.value,o=h.styleSpec,d=o.projection,g=h.style;let v=[];const w=n.H(i);if(w==="object")for(const C in i)v=v.concat(Ti({key:C,value:i[C],valueSpec:d[C],style:g,styleSpec:o}));else w!=="string"&&(v=v.concat([new n.V("projection",i,`object or string expected, ${w} found`)]));return v},import:function(h){const{value:i,styleSpec:o}=h,{data:d,...g}=i;Object.defineProperty(g,"__line__",{value:i.__line__,enumerable:!1});let v=Bt(n.J({},h,{value:g,valueSpec:o.import}));return n.K(g.id)===""&&v.push(new n.V(`${h.key}.id`,g,"import id can't be an empty string")),d&&(v=v.concat(Cd(d,o,{key:`${h.key}.data`}))),v}};function Ti(h,i=!1){const o=h.value,d=h.valueSpec,g=h.styleSpec;if(d.expression&&n.a0(n.K(o)))return Kt(h);if(d.expression&&n.O(n.Q(o)))return Zt(h);if(d.type&&jr[d.type]){const v=jr[d.type](h);return i===!0&&v.length>0&&n.H(h.value)==="array"?Zt(h):v}return Bt(n.J({},h,{valueSpec:d.type?g[d.type]:d}))}function Yo(h){const i=h.value,o=h.key,d=un(h);return d.length||(i.indexOf("{fontstack}")===-1&&d.push(new n.V(o,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&d.push(new n.V(o,i,'"glyphs" url must include a "{range}" token'))),d}function Cd(h,i=n.a3,o={}){return Ti({key:o.key||"",value:h,valueSpec:i.$root,styleSpec:i,style:h,objectElementValidators:{glyphs:Yo,"*":()=>[]}})}function As(h,i=n.a3){return $r(Cd(h,i))}const Ca=h=>$r(sr(h)),yc=h=>$r(Rn(h)),vc=h=>$r(so(h)),xc=h=>$r(Ma(h)),Id=h=>$r(Bn(h)),bc=h=>$r(function(i){const o=i.value,d=i.style,g=i.styleSpec,v=g.snow;let w=[];const C=n.H(o);if(o===void 0)return w;if(C!=="object")return w=w.concat([new n.V("snow",o,`object expected, ${C} found`)]),w;for(const D in o){const L=D.match(/^(.*)-transition$/);w=w.concat(L&&v[L[1]]&&v[L[1]].transition?Ti({key:D,value:o[D],valueSpec:g.transition,style:d,styleSpec:g}):v[D]?Ti({key:D,value:o[D],valueSpec:v[D],style:d,styleSpec:g}):[new n.G(D,o[D],`unknown property "${D}"`)])}return w}(h)),Pd=h=>$r(function(i){const o=i.value,d=i.style,g=i.styleSpec,v=g.rain;let w=[];const C=n.H(o);if(o===void 0)return w;if(C!=="object")return w=w.concat([new n.V("rain",o,`object expected, ${C} found`)]),w;for(const D in o){const L=D.match(/^(.*)-transition$/);w=w.concat(L&&v[L[1]]&&v[L[1]].transition?Ti({key:D,value:o[D],valueSpec:g.transition,style:d,styleSpec:g}):v[D]?Ti({key:D,value:o[D],valueSpec:v[D],style:d,styleSpec:g}):[new n.G(D,o[D],`unknown property "${D}"`)])}return w}(h)),Rd=h=>$r(Wi(h)),pr=h=>$r(Si(h)),Fu=h=>$r(Ai(h)),Dd=h=>$r(Gi(h)),Nu=h=>$r(n.a2(h));function $r(h){return h.slice().sort((i,o)=>i.line&&o.line?i.line-o.line:0)}function Ko(h,i){let o=!1;if(i&&i.length)for(const d of i)d instanceof n.G?n.w(d.message):(h.fire(new n.y(new Error(d.message))),o=!0);return o}let et;class K extends n.E{constructor(i,o="flat"){super(),this._transitionable=new n.a4(et||(et=new n.a5({anchor:new n.a6(n.a3.light.anchor),position:new n.a7(n.a3.light.position),color:new n.a6(n.a3.light.color),intensity:new n.a6(n.a3.light.intensity)}))),this.setLight(i,o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,o,d={}){this._validate(yc,i,d)||(this._transitionable.setTransitionOrValue(i),this.id=o)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,d){return(!d||d.validate!==!1)&&Ko(this,i.call(As,n.l({value:o,style:{glyphs:!0,sprite:!0},styleSpec:n.a3})))}}let ie=class extends n.E{constructor(h,i,o,d){super(),this.scope=o,this._transitionable=new n.a4(new n.a5({source:new n.a6(n.a3.terrain.source),exaggeration:new n.a6(n.a3.terrain.exaggeration)}),o,d),this._transitionable.setTransitionOrValue(h,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(h,i){this._transitionable.setTransitionOrValue(h,i)}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}getExaggeration(h){return this._transitioning.possiblyEvaluate(new n.a8(h)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const h=this._transitionable._values.exaggeration;if(!h)return null;const i=h.value.expression;if(!i)return null;let o=-1,d=-1,g=1;for(const v of i.zoomStops)g=i.evaluate(new n.a8(v)),g>.01?(o=v,d=-1):d=v;return g<.01&&o>0&&d>o?[o,d]:null}isZoomDependent(){const h=this._transitionable._values.exaggeration;return h!=null&&h.value!=null&&h.value.expression!=null&&h.value.expression instanceof n.a9}};const oe=45,ye=65,xe=.05;function Re(h,i,o,d){const g=n.ac(oe,ye,o),[v,w]=qe(h,d);let C=1-Math.min(1,Math.exp((i-v)/(w-v)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*g*h.alpha}function qe(h,i){const o=.5/Math.tan(.5*i);return[h.range[0]+o,h.range[1]+o]}function Oe(h,i,o,d,g){const v=n.ab.vec3.transformMat4([],[i,o,d],g.mercatorFogMatrix);return Re(h,n.ab.vec3.length(v),g.pitch,g._fov)}function Je(h,i,o,d,g,v,w){const C=[[o,d,0],[g,d,0],[g,v,0],[o,v,0]];let D=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(const O of C){const N=n.ab.vec3.transformMat4([],O,i),B=n.ab.vec3.length(N);D=Math.min(D,B),L=Math.max(L,B)}return[Re(h,D,w.pitch,w._fov),Re(h,L,w.pitch,w._fov)]}class Ke extends n.E{constructor(i,o,d,g){super();const v=new n.a5({range:new n.a6(n.a3.fog.range),color:new n.a6(n.a3.fog.color),"color-use-theme":new n.a6({type:"string","property-type":"data-constant",default:"default"}),"high-color":new n.a6(n.a3.fog["high-color"]),"high-color-use-theme":new n.a6({type:"string","property-type":"data-constant",default:"default"}),"space-color":new n.a6(n.a3.fog["space-color"]),"space-color-use-theme":new n.a6({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new n.a6(n.a3.fog["horizon-blend"]),"star-intensity":new n.a6(n.a3.fog["star-intensity"]),"vertical-range":new n.a6(n.a3.fog["vertical-range"])});this._transitionable=new n.a4(v,d,new Map(g)),this.set(i,g),this._transitioning=this._transitionable.untransitioned(),this._transform=o,this.properties=new n.ad(v),this.scope=d}get state(){const i=this._transform,o=i.projection.name==="globe",d=n.ae(i.zoom),g=this.properties.get("range"),v=[.5,3];return{range:o?[n.af(v[0],g[0],d),n.af(v[1],g[1],d)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,o,d={}){if(this._validate(Id,i,d))return;const g=n.l({},i);for(const v of Object.keys(n.a3.fog))g[v]===void 0&&(g[v]=n.a3.fog[v].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,o)}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:n.ac(oe,ye,i))*o.a}getOpacityAtLatLng(i,o){return this._transform.projection.supportsFog?function(d,g,v){const w=n.aa.fromLngLat(g),C=v.elevation?v.elevation.getAtPointOrZero(w):0;return Oe(d,w.x,w.y,C,v)}(this.state,i,o):0}getOpacityForTile(i){if(!this._transform.projection.supportsFog)return[1,1];const o=this._transform.calculateFogTileMatrix(i.toUnwrapped());return Je(this.state,o,0,0,n.ag,n.ag,this._transform)}getOpacityForBounds(i,o,d,g,v){return this._transform.projection.supportsFog?Je(this.state,i,o,d,g,v,this._transform):[1,1]}getFovAdjustedRange(i){return this._transform.projection.supportsFog?qe(this.state,i):[0,1]}isVisibleOnFrustum(i){if(!this._transform.projection.supportsFog)return!1;const o=[4,5,6,7];for(const d of o){const g=i.points[d];let v;if(g[2]>=0)v=g;else{const w=i.points[d-4];v=n.ah(w,g,w[2]/(w[2]-g[2]))}if(Oe(this.state,v[0],v[1],0,this._transform)>=xe)return!0}return!1}updateConfig(i){this._transitionable.setTransitionOrValue(this._options,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,d){return(!d||d.validate!==!1)&&Ko(this,i.call(As,n.l({value:o,style:{glyphs:!0,sprite:!0},styleSpec:n.a3})))}}let Qe,ft,It,Pt,si=class extends n.E{constructor(h,i,o,d){super();const g=Qe||(Qe=new n.a5({density:new n.a6(n.a3.snow.density),intensity:new n.a6(n.a3.snow.intensity),color:new n.a6(n.a3.snow.color),opacity:new n.a6(n.a3.snow.opacity),vignette:new n.a6(n.a3.snow.vignette),"vignette-color":new n.a6(n.a3.snow["vignette-color"]),"center-thinning":new n.a6(n.a3.snow["center-thinning"]),direction:new n.a6(n.a3.snow.direction),"flake-size":new n.a6(n.a3.snow["flake-size"])}));this._transitionable=new n.a4(g,o,new Map(d)),this.set(h,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new n.ad(g),this.scope=o}get state(){const h=this.properties.get("opacity"),i=this.properties.get("color"),o=this.properties.get("direction"),d=n.ai(o[0]),g=-Math.max(n.ai(o[1]),.01),v=[Math.cos(d)*Math.cos(g),Math.sin(d)*Math.cos(g),Math.sin(g)],w=this.properties.get("vignette"),C=this.properties.get("vignette-color");return C.a=w,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new n.aj(i.r,i.g,i.b,i.a*h),direction:v,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:C}}get(){return this._transitionable.serialize()}set(h,i,o={}){if(this._validate(bc,h,o))return;const d=n.l({},h);for(const g of Object.keys(n.a3.snow))d[g]===void 0&&(d[g]=n.a3.snow[g].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,i)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,i,o){return(!o||o.validate!==!1)&&Ko(this,h.call(As,n.l({value:i,style:{glyphs:!0,sprite:!0},styleSpec:n.a3})))}},ui=class extends n.E{constructor(h,i,o,d){super();const g=ft||(ft=new n.a5({density:new n.a6(n.a3.rain.density),intensity:new n.a6(n.a3.rain.intensity),color:new n.a6(n.a3.rain.color),opacity:new n.a6(n.a3.rain.opacity),vignette:new n.a6(n.a3.rain.vignette),"vignette-color":new n.a6(n.a3.rain["vignette-color"]),"center-thinning":new n.a6(n.a3.rain["center-thinning"]),direction:new n.a6(n.a3.rain.direction),"droplet-size":new n.a6(n.a3.rain["droplet-size"]),"distortion-strength":new n.a6(n.a3.rain["distortion-strength"])}));this._transitionable=new n.a4(g,o,new Map(d)),this.set(h,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new n.ad(g),this.scope=o}get state(){const h=this.properties.get("opacity"),i=this.properties.get("color"),o=this.properties.get("direction"),d=n.ai(o[0]),g=-Math.max(n.ai(o[1]),.01),v=[Math.cos(d)*Math.cos(g),Math.sin(d)*Math.cos(g),Math.sin(g)],w=this.properties.get("vignette-color");return w.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new n.aj(i.r,i.g,i.b,i.a*h),direction:v,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:w}}get(){return this._transitionable.serialize()}set(h,i,o={}){if(this._validate(Pd,h,o))return;const d=n.l({},h);for(const g of Object.keys(n.a3.rain))d[g]===void 0&&(d[g]=n.a3.rain[g].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,i)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,i,o){return(!o||o.validate!==!1)&&Ko(this,h.call(As,n.l({value:i,style:{glyphs:!0,sprite:!0},styleSpec:n.a3})))}};class hi extends n.E{constructor(i,o,d,g){super(),this.scope=d,this._options=i,this.properties=new n.ad(o),this._transitionable=new n.a4(o,d,new Map(g)),this._transitionable.setTransitionOrValue(i.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(i){this._transitionable.setTransitionOrValue(this._options.properties,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(i,o){this._options=i,this._transitionable.setTransitionOrValue(i.properties,o)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class ci{constructor(i,o,d,g){this.screenBounds=i,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(i,o){let d,g;if(i instanceof n.P||typeof i[0]=="number"){const v=n.P.convert(i);d=[v],g=o.isPointAboveHorizon(v)}else{const v=n.P.convert(i[0]),w=n.P.convert(i[1]);d=[v,w],g=n.al(v,w).every(C=>o.isPointAboveHorizon(C))}return new ci(d,o.getCameraPoint(),g,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return n.al(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const o=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],g=n.al(o,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<d.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?g[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(g[3]=this.cameraPoint)),n.am(g,i)}bufferedCameraGeometryGlobe(i){const o=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],g=n.al(o,d,i),v=this.cameraPoint.clone();switch(3*((v.y>o.y)+(v.y>d.y))+((v.x>o.x)+(v.x>d.x))){case 0:g[0]=v,g[4]=v.clone();break;case 1:g.splice(1,0,v);break;case 2:g[1]=v;break;case 3:g.splice(4,0,v);break;case 5:g.splice(2,0,v);break;case 6:g[3]=v;break;case 7:g.splice(3,0,v);break;case 8:g[2]=v}return g}containsTile(i,o,d,g=0){const v=i.queryPadding/o._pixelsPerMercatorPixel+1,w=d?this._bufferedCameraMercator(v,o):this._bufferedScreenMercator(v,o);let C=i.tileID.wrap+(w.unwrapped?g:0);const D=w.polygon.map(ee=>n.an(i.tileTransform,ee,C));if(!n.ao(D,0,0,n.ag,n.ag))return;C=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);const L=this.screenGeometryMercator.polygon.map(ee=>n.ap(i.tileTransform,ee,C)),O=L.map(ee=>new n.P(ee[0],ee[1])),N=o.getFreeCameraOptions().position||new n.aa(0,0,0),B=n.ap(i.tileTransform,N,C),q=L.map(ee=>{const Q=n.ab.vec3.sub(ee,ee,B);return n.ab.vec3.normalize(Q,Q),new n.aq(B,Q)}),J=n.ar(i,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:O,tilespaceRays:q,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(X=n.as(D),X.min.x=n.aw(X.min.x,0,n.ag),X.min.y=n.aw(X.min.y,0,n.ag),X.max.x=n.aw(X.max.x,0,n.ag),X.max.y=n.aw(X.max.y,0,n.ag),X),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:J};var X}_bufferedScreenMercator(i,o){const d=Ii(i);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let g;return g=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),o):{polygon:this.bufferedScreenGeometry(i).map(v=>o.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[d]=g,g}}_bufferedCameraMercator(i,o){const d=Ii(i);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let g;return g=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),o):{polygon:this.bufferedCameraGeometry(i).map(v=>o.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[d]=g,g}}_projectAndResample(i,o){const d=function(v,w){const C=n.ab.mat4.multiply([],w.pixelMatrix,w.globeMatrix),D=[0,-n.ax,0,1],L=[0,n.ax,0,1],O=[0,0,0,1];n.ab.vec4.transformMat4(D,D,C),n.ab.vec4.transformMat4(L,L,C),n.ab.vec4.transformMat4(O,O,C);const N=new n.P(D[0]/D[3],D[1]/D[3]),B=new n.P(L[0]/L[3],L[1]/L[3]),q=n.au(v,N)&&D[3]<O[3],J=n.au(v,B)&&L[3]<O[3];if(!q&&!J)return null;const X=function(ve,_e,Me){for(let ke=1;ke<ve.length;ke++){const tt=$i(_e.pointCoordinate3D(ve[ke-1]).x),We=$i(_e.pointCoordinate3D(ve[ke]).x);if(Me<0){if(tt<We)return{idx:ke,t:-tt/(We-1-tt)}}else if(We<tt)return{idx:ke,t:(1-tt)/(We+1-tt)}}return null}(v,w,q?-1:1);if(!X)return null;const{idx:ee,t:Q}=X;let ae=ee>1?Ni(v.slice(0,ee),w):[],pe=ee<v.length?Ni(v.slice(ee),w):[];ae=ae.map(ve=>new n.P($i(ve.x),ve.y)),pe=pe.map(ve=>new n.P($i(ve.x),ve.y));const fe=[...ae];fe.length===0&&fe.push(pe[pe.length-1]);const we=n.af(fe[fe.length-1].y,(pe.length===0?ae[0]:pe[0]).y,Q);let ge;return ge=q?[new n.P(0,we),new n.P(0,0),new n.P(1,0),new n.P(1,we)]:[new n.P(1,we),new n.P(1,1),new n.P(0,1),new n.P(0,we)],fe.push(...ge),pe.length===0?fe.push(ae[0]):fe.push(...pe),{polygon:fe.map(ve=>new n.aa(ve.x,ve.y)),unwrapped:!1}}(i,o);if(d)return d;const g=function(v,w){let C=!1,D=-1/0,L=0;for(let N=0;N<v.length-1;N++)v[N].x>D&&(D=v[N].x,L=N);for(let N=0;N<v.length-1;N++){const B=(L+N)%(v.length-1),q=v[B],J=v[B+1];Math.abs(q.x-J.x)>.5&&(q.x<J.x?(q.x+=1,B===0&&(v[v.length-1].x+=1)):(J.x+=1,B+1===v.length-1&&(v[0].x+=1)),C=!0)}const O=n.at(w.center.lng);return C&&O<Math.abs(O-1)&&v.forEach(N=>{N.x-=1}),{polygon:v,unwrapped:C}}(Ni(i,o).map(v=>new n.P($i(v.x),v.y)),o);return{polygon:g.polygon.map(v=>new n.aa(v.x,v.y)),unwrapped:g.unwrapped}}}function Ni(h,i){return n.av(h,o=>{const d=i.pointCoordinate3D(o);o.x=d.x,o.y=d.y},1/256)}function $i(h){return h<0?1+h%1:h%1}function Ii(h){return 100*h|0}function Zi(h,i,o,d,g){const v=function(C,D){if(C)return g(C);if(D){if(h.url&&D.tiles&&h.tiles&&delete h.tiles,D.variants){if(!Array.isArray(D.variants))return g(new Error("variants must be an array"));for(const O of D.variants){if(O==null||typeof O!="object"||O.constructor!==Object)return g(new Error("variant must be an object"));if(!Array.isArray(O.capabilities))return g(new Error("capabilities must be an array"));if(O.capabilities.length===1&&O.capabilities[0]==="meshopt"){D=n.l(D,O);break}}}const L=n.ay(n.l({},D,h),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);L.tiles=i.canonicalizeTileset(L,h.url),g(null,L)}},w=function(C,D,L){if(!C)return null;if(!D&&!L)return C;L=L||C.worldview_default;const O=Object.values(C.language||{});if(O.length===0)return null;const N=Object.values(C.worldview||{});if(N.length===0)return null;const B=O.every(J=>J===D),q=N.every(J=>J===L);return B&&q?C:D in(C.language_options||{})||L in(C.worldview_options||{})?null:C.language_options&&C.worldview_options?C:null}(h.data,o,d);return w?n.q.frame(()=>v(null,w)):h.url?n.n(i.transformRequest(i.normalizeSourceURL(h.url,null,o,d),n.R.Source),v):n.q.frame(()=>{const{data:C,...D}=h;v(null,D)})}class Ki{constructor(i,o,d){this.bounds=n.az.convert(this.validateBounds(i)),this.minzoom=o||0,this.maxzoom=d||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const o=Math.pow(2,i.z),d=Math.floor(n.at(this.bounds.getWest())*o),g=Math.floor(n.aA(this.bounds.getNorth())*o),v=Math.ceil(n.at(this.bounds.getEast())*o),w=Math.ceil(n.aA(this.bounds.getSouth())*o);return i.x>=d&&i.x<v&&i.y>=g&&i.y<w}}class tr extends n.E{constructor(i,o,d,g){if(super(),this.id=i,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.l(this,n.ay(o,["url","scheme","tileSize","promoteId"])),this._options=n.l({type:"vector"},o),this._collectResourceTiming=!!o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new n.aB}load(i){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=Zi(this._options,this.map._requestManager,o,d,(g,v)=>{if(this._tileJSONRequest=null,this._loaded=!0,g)o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),d&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new n.y(g));else if(v){if(n.l(this,v),this.hasWorldviews=!!v.worldview_options,v.worldview_default&&(this.worldviewDefault=v.worldview_default),v.vector_layers){this.vectorLayers=v.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const w of v.vector_layers)this.vectorLayerIds.push(w.id),v.worldview&&v.worldview[w.source]&&this.localizableLayerIds.add(w.id)}v.bounds&&(this.tileBounds=new Ki(v.bounds,this.minzoom,this.maxzoom)),xn(v.tiles,this.map._requestManager._customAccessToken),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}i&&i(g)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=n.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return n.l({},this._options)}loadTile(i,o){const d=i.tileID.canonical.url(this.tiles,this.scheme),g=this.map._requestManager.normalizeTileURL(d),v=this.map._requestManager.transformRequest(g,n.R.Tile),w=this.map.style?this.map.style.getLut(this.scope):null,C=w?{image:w.image.clone()}:null,D={request:v,data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,lut:C,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&n.f(d)&&(D.worldview=this.map.getWorldview()||this.worldviewDefault,D.localizableLayerIds=this.localizableLayerIds),D.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=o:i.request=i.actor.send("reloadTile",D,L.bind(this));else if(i.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",D,L.bind(this),void 0,!0);else{const O=n.aD.call({deduped:this._deduped},D,(N,B)=>{N||!B?L.call(this,N):(D.data={cacheControl:B.cacheControl,expires:B.expires,rawData:B.rawData.slice(0)},i.actor&&i.actor.send("loadTile",D,L.bind(this),void 0,!0))},!0);i.request={cancel:O}}function L(O,N){return delete i.request,i.aborted?o(null):O&&O.status!==404?o(O):(N&&N.resourceTiming&&(i.resourceTiming=N.resourceTiming),this.map._refreshExpiredTiles&&N&&i.setExpiryData(N),i.loadVectorData(N,this.map.painter),n.aE(this.dispatcher),o(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i,o){i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope}),i.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Jo extends n.E{constructor(i,o,d,g){super(),this.id=i,this.dispatcher=d,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.l({type:"raster"},o),n.l(this,n.ay(o,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"})),this._tileJSONRequest=Zi(this._options,this.map._requestManager,null,null,(o,d)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new n.y(o)):d&&(n.l(this,d),d.raster_layers&&(this.rasterLayers=d.raster_layers,this.rasterLayerIds=this.rasterLayers.map(g=>g.id)),d.bounds&&(this.tileBounds=new Ki(d.bounds,this.minzoom,this.maxzoom)),xn(d.tiles),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))),i&&i(o)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=n.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return n.l({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,o){const d=n.q.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);i.request=n.o(this.map._requestManager.transformRequest(g,n.R.Tile),(v,w,C,D)=>(delete i.request,i.aborted?(i.state="unloaded",o(null)):v?(i.state="errored",o(v)):w?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:C,expires:D}),i.setTexture(w,this.map.painter),i.state="loaded",n.aE(this.dispatcher),void o(null)):o(null)))}abortTile(i,o){i.request&&(i.request.cancel(),delete i.request),o&&o()}unloadTile(i,o){i.texture&&i.texture instanceof n.T?(i.destroy(!0),i.texture&&i.texture instanceof n.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),o&&o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class mr extends Jo{constructor(i,o,d,g){super(i,o,d,g),this.type="raster-array",this.maxzoom=22,this._options=n.l({type:"raster-array"},o)}triggerRepaint(i){const o=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);o&&o.enabled&&d&&o._clearRenderCacheForTile(d.id,i.tileID),this.map.triggerRepaint()}loadTile(i,o){const d=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),g=this.map._requestManager.transformRequest(d,n.R.Tile);i.requestParams=g,i.actor||(i.actor=this.dispatcher.getActor()),i.request=i.fetchHeader(void 0,(v,w,C,D)=>{if(delete i.request,i.aborted)return i.state="unloaded",o(null);if(v)return v.code===20?void 0:(i.state="errored",o(v));this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:C,expires:D}),i.state="empty",o(null)})}unloadTile(i,o){const d=i.texture;d&&d instanceof n.T?(i.destroy(!0),this.map.painter.saveTileTexture(d)):(i.destroy(),i.flushQueues(),i._isHeaderLoaded=!1,delete i._mrt,delete i.textureDescriptor),i.fbo&&(i.fbo.destroy(),delete i.fbo),delete i.request,delete i.requestParams,delete i.neighboringTiles,i.state="unloaded"}prepareTile(i,o,d){i._isHeaderLoaded&&(i.state!=="empty"&&(i.state="reloading"),i.fetchBand(o,d,(g,v)=>{if(g)return i.state="errored",this.fire(new n.y(g)),void this.triggerRepaint(i);v&&(i.setTexture(v,this.map.painter),i.state="loaded",this.triggerRepaint(i))}))}getInitialBand(i){if(!this.rasterLayers)return 0;const o=this.rasterLayers.find(({id:v})=>v===i),d=o&&o.fields,g=d&&d.bands&&d.bands;return g?g[0]:0}getTextureDescriptor(i,o,d){if(!i)return;const g=o.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!g)return;let v=null;o instanceof n.aH?v=o.paint.get("raster-array-band"):o instanceof n.aI&&(v=o.paint.get("raster-particle-array-band"));const w=v||this.getInitialBand(g);if(w!=null)if(i.textureDescriptor){if(!i.updateNeeded(g,w)||d)return Object.assign({},i.textureDescriptor,{texture:i.texture})}else this.prepareTile(i,g,w)}}const br={vector:tr,raster:Jo,"raster-dem":class extends Jo{constructor(h,i,o,d){super(h,i,o,d),this.type="raster-dem",this.maxzoom=22,this._options=n.l({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(h,i){const o=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(g,v){g&&(h.state="errored",i(g)),v&&(h.dem=v,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",i(null))}h.request=n.o(this.map._requestManager.transformRequest(o,n.R.Tile),(function(g,v,w,C){if(delete h.request,h.aborted)h.state="unloaded",i(null);else if(g)h.state="errored",i(g);else if(v){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:w,expires:C});const D=ImageBitmap&&v instanceof ImageBitmap&&n.t(),L=1-(v.width-n.aF(v.width))/2;L<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const O=D?v:n.q.getImageData(v,L),N={uid:h.uid,coord:h.tileID,source:this.id,scope:this.scope,rawImageData:O,encoding:this.encoding,padding:L};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",N,d.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(h){const i=h.canonical,o=Math.pow(2,i.z),d=(i.x-1+o)%o,g=i.x===0?h.wrap-1:h.wrap,v=(i.x+1+o)%o,w=i.x+1===o?h.wrap+1:h.wrap,C={};return C[new n.aG(h.overscaledZ,g,i.z,d,i.y).key]={backfilled:!1},C[new n.aG(h.overscaledZ,w,i.z,v,i.y).key]={backfilled:!1},i.y>0&&(C[new n.aG(h.overscaledZ,g,i.z,d,i.y-1).key]={backfilled:!1},C[new n.aG(h.overscaledZ,h.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},C[new n.aG(h.overscaledZ,w,i.z,v,i.y-1).key]={backfilled:!1}),i.y+1<o&&(C[new n.aG(h.overscaledZ,g,i.z,d,i.y+1).key]={backfilled:!1},C[new n.aG(h.overscaledZ,h.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},C[new n.aG(h.overscaledZ,w,i.z,v,i.y+1).key]={backfilled:!1}),C}},"raster-array":mr,geojson:class extends n.E{constructor(h,i,o,d){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(d),this._data=i.data,this._options=n.l({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.minzoom!==void 0&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const g=n.ag/this.tileSize;this.workerOptions=n.l({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*g,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*g,extent:n.ag,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:n.ag,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*g,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}updateData(h){if(!this._options.dynamic)return this.fire(new n.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof h!="string"&&(h.type==="Feature"&&(h={type:"FeatureCollection",features:[h]}),h.type!=="FeatureCollection"))return this.fire(new n.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof h!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const i=new Map;for(const o of this._data.features)i.set(o.id,o);for(const o of h.features)i.set(o.id,o);this._data.features=[...i.values()]}else this._data=h;return this._updateWorkerData(!0),this}getClusterExpansionZoom(h,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id,scope:this.scope},i),this}getClusterChildren(h,i){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id,scope:this.scope},i),this}getClusterLeaves(h,i,o,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:h,limit:i,offset:o},d),this}_updateWorkerData(h=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.z("dataloading",{dataType:"source"})),this._loaded=!1;const i=n.l({append:h},this.workerOptions);i.scope=this.scope;const o=this._data;typeof o=="string"?(i.request=this.map._requestManager.transformRequest(n.q.resolveURL(o),n.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,(d,g)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new n.y(d));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(v.resourceTiming=g.resourceTiming[this.id]),h&&(this._partialReload=!0),this.fire(new n.z("data",v)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(h),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const h=n.aC(this.id,this.scope);this.map.style.clearSource(h),this._updateWorkerData()}loadTile(h,i){const o=h.actor?"reloadTile":"loadTile";h.actor=this.actor;const d=this.map.style?this.map.style.getLut(this.scope):null,g=d?{image:d.image.clone()}:null,v=this._partialReload,w={type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:g,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:v};h.request=this.actor.send(o,w,(C,D)=>v&&!D?(h.state="loaded",i(null)):(delete h.request,h.destroy(),h.aborted?i(null):C?i(C):(h.loadVectorData(D,this.map.painter,o==="reloadTile"),i(null))),void 0,o==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h,i){this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope}),h.destroy()}onRemove(h){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return n.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends n.aJ{constructor(h,i,o,d){super(h,i,o,d),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const i of h.urls)this.urls.push(this.map._requestManager.transformRequest(i,n.R.Source).url);n.aK(this.urls,(i,o)=>{this._loaded=!0,i?this.fire(new n.y(i)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const i=this.video.seekable;h<i.start(0)||h>i.end(0)?this.fire(new n.y(new n.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,i=h.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new n.T(h,this.video,i.RGBA8),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:n.aJ,model:class extends n.E{constructor(h,i,o,d){super(),this.id=h,this.type="model",this.models=[],this._loaded=!1,this._options=i}load(){const h=[];for(const i in this._options.models){const o=this._options.models[i],d=n.aM(this.map._requestManager.transformRequest(o.uri,n.R.Model).url).then(g=>{if(!g)return;const v=n.aN(g),w=new n.aO(i,o.position,o.orientation,v);w.computeBoundsAndApplyParent(),this.models.push(w)}).catch(g=>{this.fire(new n.y(new Error(`Could not load model ${i} from ${o.uri}: ${g.message}`)))});h.push(d)}return Promise.allSettled(h).then(()=>{this._loaded=!0,this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this.fire(new n.y(new Error(`Could not load models: ${i.message}`)))})}onAdd(h){this.map=h,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(h,i){}serialize(){return{type:"model"}}},"batched-model":class extends n.E{constructor(h,i,o,d){super(),this.type="batched-model",this.id=h,this.tileSize=512,this._options=i,this.tiles=this._options.tiles,this.maxzoom=i.maxzoom||19,this.minzoom=i.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=o,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(h){this.map=h,this.load()}reload(){this.cancelTileJSONRequest();const h=n.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(h))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(h){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map.getWorldview();this._tileJSONRequest=Zi(this._options,this.map._requestManager,i,o,(d,g)=>{this._tileJSONRequest=null,this._loaded=!0,d?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),o&&o.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new n.y(d))):g&&(n.l(this,g),g.bounds&&(this.tileBounds=new Ki(g.bounds,this.minzoom,this.maxzoom)),xn(g.tiles,this.map._requestManager._customAccessToken),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))),h&&h(d)})}hasTransition(){return!1}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loaded(){return this._loaded}loadTile(h,i){const o=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(o,n.R.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:h.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(h.actor&&h.state!=="expired")if(h.state==="loading")h.reloadCallback=i;else{if(h.buckets){const v=Object.values(h.buckets);for(const w of v)w.dirty=!0;return void(h.state="loaded")}h.request=h.actor.send("reloadTile",d,g.bind(this))}else h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",d,g.bind(this),void 0,!0);function g(v,w){return h.aborted?i(null):v&&v.status!==404?i(v):(this.map._refreshExpiredTiles&&w&&h.setExpiryData(w),h.loadModelData(w,this.map.painter),h.state="loaded",void i(null))}}serialize(){return n.l({},this._options)}},canvas:class extends n.aJ{constructor(h,i,o,d){super(h,i,o,d),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(v=>typeof v!="number"))||this.fire(new n.y(new n.V(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.y(new n.V(`sources.${h}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new n.y(new n.V(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new n.y(new n.V(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.y(new n.V(`sources.${h}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(h){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?!h&&!this._playing||this.texture instanceof n.aL||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.T(i,this.canvas,i.gl.RGBA8,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends n.E{constructor(h,i,o,d){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=i,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ki(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),n.l(this,n.ay(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.ay(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this.map=h,this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:i,y:o,z:d}=h.canonical;return this._implementation.hasTile({x:i,y:o,z:d})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,i){const{x:o,y:d,z:g}=h.tileID.canonical,v=new AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:o,y:d,z:g},{signal:v.signal})).then((function(w){return delete h.request,h.aborted?(h.state="unloaded",i(null)):w===void 0?(h.state="errored",i(null)):w===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",i(null)):function(C){return C instanceof ImageData||C instanceof HTMLCanvasElement||C instanceof ImageBitmap||C instanceof HTMLImageElement}(w)?(this.loadTileData(h,w),h.state="loaded",void i(null)):(h.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(w=>{w.code!==20&&(h.state="errored",i(w))}),h.request.cancel=()=>v.abort()}loadTileData(h,i){h.setTexture(i,this.map.painter)}unloadTile(h,i){if(h.texture&&h.texture instanceof n.T?(h.destroy(!0),h.texture&&h.texture instanceof n.T&&this.map.painter.saveTileTexture(h.texture)):h.destroy(),this._implementation.unloadTile){const{x:o,y:d,z:g}=h.tileID.canonical;this._implementation.unloadTile({x:o,y:d,z:g})}i&&i()}abortTile(h,i){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),i&&i()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){const h=n.aC(this.id,this.scope);this.map.style.clearSource(h)}_update(){this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}}},ds=function(h,i,o,d){const g=new br[i.type](h,i,o,d);if(g.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${g.id}`);return n.aP(["load","abort","unload","serialize","prepare"],g),g};function Bu(h,i,o=""){return`${o}:${i.id||""}:${i.layer.id}:${function(d){if("layerId"in d)return`layer:${d.layerId}`;{const{featuresetId:g,importId:v}=d;return`featureset:${g}${v?`:import:${v}`:""}`}}(h.target)}`}function Ia(h,i,o,d=""){if(h.uniqueFeatureID){const g=Bu(h,i,d);if(o.has(g))return!0;o.add(g)}return!1}function Vu(h,i,o,d,g=!1){const v=i.sourceCache.transform,w=i.sourceCache.tilesIn(h,i.has3DLayers,g);w.sort(jp);const C=[];for(const D of w){const L=D.tile.queryRenderedFeatures(i,D,o,d,v,g);Object.keys(L).length&&C.push({wrappedTileID:D.tile.tileID.wrapped().key,queryResults:L})}return C.length===0?{}:function(D){const L={},O={};for(const N of D){const B=N.queryResults,q=N.wrappedTileID,J=O[q]=O[q]||{};for(const X in B){const ee=B[X],Q=J[X]=J[X]||{},ae=L[X]=L[X]||[];for(const pe of ee)Q[pe.featureIndex]||(Q[pe.featureIndex]=!0,ae.push(pe))}}return L}(C)}function Up(h,i,o,d,g){const v={},w=d.queryRenderedSymbols(h),C=[];for(const D of Object.keys(w).map(Number))C.push(g[D]);C.sort(jp);for(const D of C){const L=D.featureIndex.lookupSymbolFeatures(w[D.bucketInstanceId],D.bucketIndex,D.sourceLayerIndex,i,o);for(const O in L){const N=v[O]=v[O]||[],B=L[O];B.sort((q,J)=>{const X=D.featureSortOrder;if(X){const ee=X.indexOf(q.featureIndex);return X.indexOf(J.featureIndex)-ee}return J.featureIndex-q.featureIndex});for(const q of B)N.push(q)}}return v}function Kg(h,i){const o=h.getRenderableIds().map(v=>h.getTileByID(v)),d=[],g={};for(let v=0;v<o.length;v++){const w=o[v],C=w.tileID.canonical.key;g[C]||(g[C]=!0,w.querySourceFeatures(d,i))}return d}function jp(h,i){const o=h.tileID,d=i.tileID;return o.overscaledZ-d.overscaledZ||o.canonical.y-d.canonical.y||o.wrap-d.wrap||o.canonical.x-d.canonical.x}function $p(h,i){const o={};if(!i)return o;for(const d of h){const g=d.layerIds.map(v=>i.getLayer(v)).filter(Boolean);if(g.length!==0){d.layers=g,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(v=>g.filter(w=>w.id===v)[0]));for(const v of g)o[v.fqid]=d}}return o}const fs=32,So=33,Pa=new Uint16Array(8184);for(let h=0;h<2046;h++){let i=h+2,o=0,d=0,g=0,v=0,w=0,C=0;for(1&i?g=v=w=fs:o=d=C=fs;(i>>=1)>1;){const L=o+g>>1,O=d+v>>1;1&i?(g=o,v=d,o=w,d=C):(o=g,d=v,g=w,v=C),w=L,C=O}const D=4*h;Pa[D+0]=o,Pa[D+1]=d,Pa[D+2]=g,Pa[D+3]=v}const Qo=new Uint16Array(2178),Ao=new Uint8Array(1089),ea=new Uint16Array(1089);function Ld(h){return h===0?-.03125:h===32?.03125:0}const qp=(()=>({type:2,extent:n.ag,loadGeometry:()=>[[new n.P(0,0),new n.P(n.ag+1,0),new n.P(n.ag+1,n.ag+1),new n.P(0,n.ag+1),new n.P(0,0)]]}))();class Qa{constructor(i,o,d,g,v){this.tileID=i,this.uid=n.aV(),this.uses=0,this.tileSize=o,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=v,g&&g.style&&(this._lastUpdatedBrightness=g.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",g&&g.transform&&(this.projection=g.transform.projection)}registerFadeDuration(i){const o=i+this.timeAdded;o<n.q.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=n.aQ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,o,d){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=$p(i.buckets,o.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const v=this.buckets[g];if(v instanceof n.aX){if(this.hasSymbolBuckets=!0,!d)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const v=this.buckets[g];if(v instanceof n.aX&&v.hasRTLText){this.hasRTLText=!0,n.aY();break}}this.queryPadding=0;for(const g in this.buckets){const v=this.buckets[g],w=o.style.getOwnLayer(g);if(!w)continue;const C=w.queryRadius(v);this.queryPadding=Math.max(this.queryPadding,C)}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas),this._lastUpdatedBrightness=i.brightness}else this.collisionBoxArray=new n.aW}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(i,o,d){i&&(i.resourceTiming&&(this.resourceTiming=i.resourceTiming),this.buckets=Object.assign({},this.buckets,$p(i.buckets,o.style)),i.featureIndex&&(this.latestFeatureIndex=i.featureIndex))}getBucket(i){return this.buckets[i.fqid]}upload(i){for(const g in this.buckets){const v=this.buckets[g];v.uploadPending()&&v.upload(i)}const o=i.gl,d=this.imageAtlas;if(d&&!d.uploaded){const g=!!Object.keys(d.patternPositions).length;this.imageAtlasTexture=new n.T(i,d.image,o.RGBA8,{useMipmap:g}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new n.T(i,this.glyphAtlasImage,o.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new n.T(i,this.lineAtlas.image,o.R8),this.lineAtlas.uploaded=!0)}prepare(i,o,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture,d),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const g=o.style.getBrightness();(this._lastUpdatedBrightness||g)&&(this._lastUpdatedBrightness&&g&&Math.abs(this._lastUpdatedBrightness-g)<.001||(this.updateBuckets(o,this._lastUpdatedBrightness!==g),this._lastUpdatedBrightness=g))}queryRenderedFeatures(i,o,d,g,v,w){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const C=function(D,L){const O=n.ab.mat4.fromScaling([],[.5*D.width,.5*-D.height,1]);return n.ab.mat4.translate(O,O,[1,-1,0]),n.ab.mat4.multiply(O,O,D.calculateProjMatrix(L.toUnwrapped())),Float32Array.from(O)}(v,this.tileID);return this.latestFeatureIndex.query(i,{tilespaceGeometry:o,pixelPosMatrix:C,transform:g,availableImages:d,tileTransform:this.tileTransform})}querySourceFeatures(i,o){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const g=d.loadVTLayers(),v=o?o.sourceLayer:"",w=g._geojsonTileLayer||g[v];if(!w)return;const C=n.aZ(o&&o.filter),{z:D,x:L,y:O}=this.tileID.canonical,N={z:D,x:L,y:O};for(let B=0;B<w.length;B++){const q=w.feature(B);if(C.needGeometry){const ee=n.a_(q,!0);if(!C.filter(new n.a8(this.tileID.overscaledZ),ee,this.tileID.canonical))continue}else if(!C.filter(new n.a8(this.tileID.overscaledZ),q))continue;const J=d.getId(q,v),X=new n.a$(q,D,L,O,J);X.tile=N,i.push(X)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const o=this.expirationTime;if(i.cacheControl){const d=n.b0(i.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const d=Date.now();let g=!1;if(this.expirationTime>d)g=!1;else if(o)if(this.expirationTime<o)g=!0;else{const v=this.expirationTime-o;v?this.expirationTime=d+Math.max(v,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(i){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&i&&this.updateBuckets(i)}updateBuckets(i,o){if(!this.latestFeatureIndex||!i.style)return;const d=this.latestFeatureIndex.loadVTLayers(),g=i.style.listImages(),v=i.style.getBrightness();for(const w in this.buckets){if(!i.style.hasLayer(w))continue;const C=this.buckets[w],D=C.layers[0],L=D.sourceLayer||"_geojsonTileLayer",O=d[L],N=i.style.getLayerSourceCache(D);let B={};N&&(B=N._state.getState(L,void 0));const q=this.imageAtlas&&this.imageAtlas.patternPositions||{},J=Object.keys(B).length>0&&!o;J&&!C.stateDependentLayers.length&&!o||C.update(B,O,g,q,J?C.stateDependentLayers:C.layers,o,v),(C instanceof n.b1||C instanceof n.b2)&&i._terrain&&i._terrain.enabled&&N&&C.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(N.id,this.tileID);const X=i&&i.style&&i.style.getOwnLayer(w);X&&(this.queryPadding=Math.max(this.queryPadding,X.queryRadius(C)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<n.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=n.q.now()+i}setTexture(i,o){const d=o.context,g=d.gl;this.texture=this.texture||o.getTileTexture(i.width),this.texture&&this.texture instanceof n.T?this.texture.update(i):(this.texture=new n.T(d,i,g.RGBA8,{useMipmap:!0}),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE))}setDependencies(i,o){const d={};for(const g of o)d[g]=!0;this.dependencies[i]=d}hasDependency(i,o){for(const d of i){const g=this.dependencies[d];if(g){for(const v of o)if(g[v])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const d=n.b3(qp,this.tileID.canonical,this.tileTransform)[0],g=new n.b4,v=new n.b5;for(let w=0;w<d.length;w++){const{x:C,y:D}=d[w];g.emplaceBack(C,D),v.emplaceBack(w)}v.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(v),this._tileDebugBuffer=i.createVertexBuffer(g,n.b6.members),this._tileDebugSegments=n.b7.simpleSegment(0,0,g.length,v.length)}_makeTileBoundsBuffers(i,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const d=n.b3(qp,this.tileID.canonical,this.tileTransform)[0];let g,v;if(this.isRaster){const w=function(C,D){const L=n.aQ(C,D),O=Math.pow(2,C.z);for(let ee=0;ee<So;ee++)for(let Q=0;Q<So;Q++){const ae=n.aR((C.x+(Q+Ld(Q))/fs)/O),pe=n.aS((C.y+(ee+Ld(ee))/fs)/O),fe=D.project(ae,pe),we=ee*So+Q;Qo[2*we+0]=Math.round((fe.x*L.scale-L.x)*n.ag),Qo[2*we+1]=Math.round((fe.y*L.scale-L.y)*n.ag)}Ao.fill(0),ea.fill(0);for(let ee=2045;ee>=0;ee--){const Q=4*ee,ae=Pa[Q+0],pe=Pa[Q+1],fe=Pa[Q+2],we=Pa[Q+3],ge=ae+fe>>1,ve=pe+we>>1,_e=ge+ve-pe,Me=ve+ae-ge,ke=pe*So+ae,tt=we*So+fe,We=ve*So+ge,ct=Math.hypot((Qo[2*ke+0]+Qo[2*tt+0])/2-Qo[2*We+0],(Qo[2*ke+1]+Qo[2*tt+1])/2-Qo[2*We+1])>=16;Ao[We]=Ao[We]||(ct?1:0),ee<1022&&(Ao[We]=Ao[We]||Ao[(pe+Me>>1)*So+(ae+_e>>1)]||Ao[(we+Me>>1)*So+(fe+_e>>1)])}const N=new n.aT,B=new n.aU;let q=0;function J(ee,Q){const ae=Q*So+ee;return ea[ae]===0&&(N.emplaceBack(Qo[2*ae+0],Qo[2*ae+1],ee*n.ag/fs,Q*n.ag/fs),ea[ae]=++q),ea[ae]-1}function X(ee,Q,ae,pe,fe,we){const ge=ee+ae>>1,ve=Q+pe>>1;if(Math.abs(ee-fe)+Math.abs(Q-we)>1&&Ao[ve*So+ge])X(fe,we,ee,Q,ge,ve),X(ae,pe,fe,we,ge,ve);else{const _e=J(ee,Q),Me=J(ae,pe),ke=J(fe,we);B.emplaceBack(_e,Me,ke)}}return X(0,0,fs,fs,fs,0),X(fs,fs,0,0,0,fs),{vertices:N,indices:B}}(this.tileID.canonical,o);g=w.vertices,v=w.indices}else{g=new n.aT,v=new n.aU;for(const{x:C,y:D}of d)g.emplaceBack(C,D,0,0);const w=n.b8(g.int16,void 0,4);for(let C=0;C<w.length;C+=3)v.emplaceBack(w[C],w[C+1],w[C+2])}this._tileBoundsBuffer=i.createVertexBuffer(g,n.b9.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(v),this._tileBoundsSegments=n.b7.simpleSegment(0,0,g.length,v.length)}_makeGlobeTileDebugBuffers(i,o){const d=o.projection;if(!d||d.name!=="globe"||o.freezeTileCoverage)return;const g=this.tileID.canonical,v=n.ba(g,o),w=n.bb(v),C=n.ae(o.zoom);let D;C>0&&(D=n.ab.mat4.invert(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,g,o,w,D,C),this._makeGlobeTileDebugTextBuffer(i,g,o,w,D,C)}_globePoint(i,o,d,g,v,w,C){let D=n.bc(i,o,d);if(w){const L=1<<d.z,O=n.at(g.center.lng),N=n.aA(g.center.lat),B=(d.x+.5)/L-O;let q=0;B>.5?q=-1:B<-.5&&(q=1);let J=(i/n.ag+d.x)/L+q,X=(o/n.ag+d.y)/L;J=(J-O)*g._pixelsPerMercatorPixel+O,X=(X-N)*g._pixelsPerMercatorPixel+N;const ee=[J*g.worldSize,X*g.worldSize,0];n.ab.vec3.transformMat4(ee,ee,w),D=n.bd(D,ee,C)}return n.ab.vec3.transformMat4(D,D,v)}_makeGlobeTileDebugBorderBuffer(i,o,d,g,v,w){const C=new n.b4,D=new n.b5,L=new n.be,O=(B,q,J,X,ee)=>{const Q=(J-B)/(ee-1),ae=(X-q)/(ee-1),pe=C.length;for(let fe=0;fe<ee;fe++){const we=B+fe*Q,ge=q+fe*ae;C.emplaceBack(we,ge);const ve=this._globePoint(we,ge,o,d,g,v,w);L.emplaceBack(ve[0],ve[1],ve[2]),D.emplaceBack(pe+fe)}},N=n.ag;O(0,0,N,0,16),O(N,0,N,N,16),O(N,N,0,N,16),O(0,N,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(D),this._tileDebugBuffer=i.createVertexBuffer(C,n.b6.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(L,n.bf.members),this._tileDebugSegments=n.b7.simpleSegment(0,0,C.length,D.length)}_makeGlobeTileDebugTextBuffer(i,o,d,g,v,w){const C=n.ag/4,D=new n.b4,L=new n.aU,O=new n.be,N=25;L.reserve(32),D.reserve(N),O.reserve(N);const B=(q,J)=>N*q+J;for(let q=0;q<N;q++){const J=q*C;for(let X=0;X<N;X++){const ee=X*C;D.emplaceBack(ee,J);const Q=this._globePoint(ee,J,o,d,g,v,w);O.emplaceBack(Q[0],Q[1],Q[2])}}for(let q=0;q<4;q++)for(let J=0;J<4;J++){const X=B(q,J),ee=B(q,J+1),Q=B(q+1,J),ae=B(q+1,J+1);L.emplaceBack(X,ee,Q),L.emplaceBack(Q,ee,ae)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(L),this._tileDebugTextBuffer=i.createVertexBuffer(D,n.b6.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(O,n.bf.members),this._tileDebugTextSegments=n.b7.simpleSegment(0,0,N,32)}destroy(i=!1){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!i&&this.texture&&this.texture instanceof n.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}n.bg.setPbf(n.bh);class el extends Qa{constructor(i,o,d,g,v){super(i,o,d,g,v),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(i,o){const d=o.context,g=d.gl;this.texture=this.texture||o.getTileTexture(i.width),this.texture&&this.texture instanceof n.T?this.texture.update(i,{premultiply:!1}):this.texture=new n.T(d,i,g.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(i=16384,o){const d=this._mrt=new n.bg(30),g=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(i-1)}});return this.entireBuffer=null,this.request=n.bi(g,(v,w,C,D)=>{if(v)o(v);else try{const L=d.getHeaderLength(w);if(L>i)return void(this.request=this.fetchHeader(L,o));d.parseHeader(w),this._isHeaderLoaded=!0;let O=0;for(const N of Object.values(d.layers))O=Math.max(O,N.dataIndex[N.dataIndex.length-1].last_byte);w.byteLength>=O&&(this.entireBuffer=w),o(null,this.entireBuffer||w,C,D)}catch(L){o(L)}}),this.request}fetchBand(i,o,d){const g=this._mrt;if(!this._isHeaderLoaded||!g)return void d(new Error("Tile header is not ready"));const v=this.actor;if(!v)return void d(new Error("Can't fetch tile band without an actor"));let w;const C=(N,B)=>{w.complete(N,B),N?d(N):(this.updateTextureDescriptor(i,o),d(null,this.textureDescriptor&&this.textureDescriptor.img))},D=(N,B)=>{if(N)return d(N);const q=v.send("decodeRasterArray",{buffer:B,task:w},C,void 0,!0);this._workQueue.push(()=>{q&&q.cancel(),w.cancel()})},L=g.getLayer(i);if(!L)return void d(new Error(`Unknown sourceLayer "${i}"`));if(L.hasDataForBand(o))return this.updateTextureDescriptor(i,o),void d(null,this.textureDescriptor?this.textureDescriptor.img:null);const O=L.getDataRange([o]);if(w=g.createDecodingTask(O),!w||w.tasks.length)if(this.flushQueues(),this.entireBuffer)D(null,this.entireBuffer.slice(O.firstByte,O.lastByte+1));else{const N=Object.assign({},this.requestParams,{headers:{Range:`bytes=${O.firstByte}-${O.lastByte}`}}),B=n.bi(N,D);this._fetchQueue.push(()=>{B.cancel(),w.cancel()})}else d(null)}updateNeeded(i,o){return(!this.textureDescriptor||this.textureDescriptor.band!==o||this.textureDescriptor.layer!==i)&&this.state!=="errored"}updateTextureDescriptor(i,o){if(!this._mrt)return;const d=this._mrt.getLayer(i);if(!d||!d.hasBand(o)||!d.hasDataForBand(o))return;const{bytes:g,tileSize:v,buffer:w,offset:C,scale:D}=d.getBandView(o),L=v+2*w,O={data:g,width:L,height:L},N=this.texture;N&&N instanceof n.T&&N.update(O,{premultiply:!1}),this.textureDescriptor={layer:i,band:o,img:O,buffer:w,offset:C,tileSize:v,format:d.pixelFormat,mix:[D,256*D,65536*D,16777216*D]}}}class Jg{constructor(i,o){this.max=i,this.onRemove=o,this.reset()}reset(){for(const i in this.data)for(const o of this.data[i])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(i,o,d){const g=i.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const v={value:o,timeout:void 0};if(d!==void 0&&(v.timeout=setTimeout(()=>{this.remove(i,v)},d)),this.data[g].push(v),this.order.push(g),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const o=this.data[i].shift();return o.timeout&&clearTimeout(o.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),o.value}getByKey(i){const o=this.data[i];return o?o[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,o){if(!this.has(i))return this;const d=i.wrapped().key,g=o===void 0?0:this.data[d].indexOf(o),v=this.data[d][g];return this.data[d].splice(g,1),v.timeout&&clearTimeout(v.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(v.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(i){const o=[];for(const d in this.data)for(const g of this.data[d])i(g.value)||o.push(g);for(const d of o)this.remove(d.value.tileID,d)}}class Hp{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,o,d){const g=String(o);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][g]=this.stateChanges[i][g]||{},n.l(this.stateChanges[i][g],d),this.deletedStates[i]===null){this.deletedStates[i]={};for(const v in this.state[i])v!==g&&(this.deletedStates[i][v]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][g]===null){this.deletedStates[i][g]={};for(const v in this.state[i][g])d[v]||(this.deletedStates[i][g][v]=null)}else for(const v in d)this.deletedStates[i]&&this.deletedStates[i][g]&&this.deletedStates[i][g][v]===null&&delete this.deletedStates[i][g][v]}removeFeatureState(i,o,d){if(this.deletedStates[i]===null)return;const g=String(o);if(this.deletedStates[i]=this.deletedStates[i]||{},d&&o!==void 0)this.deletedStates[i][g]!==null&&(this.deletedStates[i][g]=this.deletedStates[i][g]||{},this.deletedStates[i][g][d]=null);else if(o!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][g])for(d in this.deletedStates[i][g]={},this.stateChanges[i][g])this.deletedStates[i][g][d]=null;else this.deletedStates[i][g]=null;else this.deletedStates[i]=null}getState(i,o){const d=this.state[i]||{},g=this.stateChanges[i]||{},v=this.deletedStates[i];if(v===null)return{};if(o!==void 0){const C=String(o),D=n.l({},d[C],g[C]);if(v){const L=v[o];if(L===null)return{};for(const O in L)delete D[O]}return D}const w=n.l({},d,g);if(v)for(const C in v)delete w[C];return w}initializeTileState(i,o){i.refreshFeatureState(o)}coalesceChanges(i,o){const d={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const v={};for(const w in this.stateChanges[g])this.state[g][w]||(this.state[g][w]={}),n.l(this.state[g][w],this.stateChanges[g][w]),v[w]=this.state[g][w];d[g]=v}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const v={};if(this.deletedStates[g]===null)for(const w in this.state[g])v[w]={},this.state[g][w]={};else for(const w in this.deletedStates[g]){if(this.deletedStates[g][w]===null)this.state[g][w]={};else if(this.state[g][w])for(const C of Object.keys(this.deletedStates[g][w]))delete this.state[g][w][C];v[w]=this.state[g][w]}d[g]=d[g]||{},n.l(d[g],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const g in i)i[g].refreshFeatureState(o)}}class oo extends n.E{constructor(i,o,d){super(),this.id=i,this._onlySymbols=d,o.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new Jg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Hp,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(i){this.map=i,this._minTileCacheSize=this._minTileCacheSize===void 0&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const o=this._tiles[i];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,o){return i.isSymbolTile=this._onlySymbols,i.isExtraShadowCaster=this._shadowCasterTiles[i.tileID.key],this._source.loadTile(i,o)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i)}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i)}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const d=this._tiles[o];d.upload(i),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return n.bj(this._tiles).map(i=>i.tileID).sort(Qi).map(i=>i.key)}getRenderableIds(i,o){const d=[];for(const g in this._tiles)this._isIdRenderable(+g,i,o)&&d.push(this._tiles[g]);return i?d.sort((g,v)=>{const w=g.tileID,C=v.tileID,D=new n.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),L=new n.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-C.overscaledZ||L.y-D.y||L.x-D.x}).map(g=>g.tileID.key):d.map(g=>g.tileID).sort(Qi).map(g=>g.key)}hasRenderableParent(i){const o=this.findLoadedParent(i,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(i,o,d){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(o||!this._tiles[i].holdingForFade())&&(d||!this._shadowCasterTiles[i])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(+i,"reloading")}}_reloadTile(i,o){const d=this._tiles[i];d&&(d.state!=="loading"&&(d.state=o),this._loadTile(d,this._tileLoaded.bind(this,d,i,o)))}_tileLoaded(i,o,d,g){if(g)if(i.state="errored",g.status!==404)this._source.fire(new n.y(g,{tile:i}));else{if(this._source.fire(new n.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:i})),!(i.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const v=this.map.painter.terrain;this.update(this.transform,v.getScaledDemTileSize(),!0),v.resetTileLookupCache(this.id)}else this.update(this.transform)}else i.timeAdded=n.q.now(),d==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(o,i),this._source.type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new n.z("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const o=this.getRenderableIds();for(let g=0;g<o.length;g++){const v=o[g];if(i.neighboringTiles&&i.neighboringTiles[v]){const w=this.getTileByID(v);d(i,w),d(w,i)}}function d(g,v){if(!g.dem||g.dem.borderReady)return;g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0;let w=v.tileID.canonical.x-g.tileID.canonical.x;const C=v.tileID.canonical.y-g.tileID.canonical.y,D=Math.pow(2,g.tileID.canonical.z),L=v.tileID.key;w===0&&C===0||Math.abs(C)>1||(Math.abs(w)>1&&(Math.abs(w+D)===1?w+=D:Math.abs(w-D)===1&&(w-=D)),v.dem&&g.dem&&(g.dem.backfillBorder(v.dem,w,C),g.neighboringTiles&&g.neighboringTiles[L]&&(g.neighboringTiles[L].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,o,d,g){for(const v in this._tiles){let w=this._tiles[v];if(g[v]||!w.hasData()||w.tileID.overscaledZ<=o||w.tileID.overscaledZ>d)continue;let C=w.tileID;for(;w&&w.tileID.overscaledZ>o+1;){const L=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[L.key],w&&w.hasData()&&(C=L)}let D=C;for(;D.overscaledZ>o;)if(D=D.scaledTo(D.overscaledZ-1),i[D.key]){g[C.key]=C;break}}}findLoadedParent(i,o){if(i.key in this._loadedParentTiles){const d=this._loadedParentTiles[i.key];return d&&d.tileID.overscaledZ>=o?d:null}for(let d=i.overscaledZ-1;d>=o;d--){const g=i.scaledTo(d),v=this._getLoadedTile(g);if(v)return v}}_getLoadedTile(i){const o=this._tiles[i.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,o){o=o||this._source.tileSize;const d=Math.ceil(i.width/o)+1,g=Math.ceil(i.height/o)+1,v=Math.floor(d*g*5),w=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,v):v,C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(C)}handleWrapJump(i){const o=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,o){const d={};for(const g in this._tiles){const v=this._tiles[g];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+o),d[v.tileID.key]=v}this._tiles=d;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(+g,this._tiles[g])}}update(i,o,d,g){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;this.updateCacheSize(i,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const v=this._source.type==="batched-model";let w,C=this._source.maxzoom;const D=this.map&&this.map.painter?this.map.painter._terrain:null;if(D&&D.sourceCache===this&&D.attenuationRange()){const N=D.attenuationRange()[0],B=Math.floor(N)-Math.log2(D.getDemUpscale());C>B&&(C=B)}if(this.used||this.usedForTerrain){if(this._source.tileID)w=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(N=>new n.aG(N.canonical.z,N.wrap,N.canonical.z,N.canonical.x,N.canonical.y));else if(this.tileCoverLift!==0){const N=i.clone();N.tileCoverLift=this.tileCoverLift,w=N.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.minzoom<=1&&i.projection.name==="globe"&&(w.push(new n.aG(1,0,1,0,0)),w.push(new n.aG(1,0,1,1,0)),w.push(new n.aG(1,0,1,0,1)),w.push(new n.aG(1,0,1,1,1)))}else if(w=i.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.hasTile){const N=this._source.hasTile.bind(this._source);w=w.filter(B=>N(B))}}else w=[];if(w.length>0&&this.castsShadows&&g&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Gp(this._source.type)){const N=i.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),B=Math.min(N,this._source.maxzoom);if(v){const q=i.extendTileCover(w,B);for(const J of q)w.push(J)}else{const q=i.extendTileCover(w,B,g);for(const J of q)this._shadowCasterTiles[J.key]=!0,w.push(J)}}const L=this._updateRetainedTiles(w);if(Gp(this._source.type)&&w.length!==0){const N={},B={},q=Object.keys(L);for(const X of q){const ee=L[X],Q=this._tiles[X];if(!Q||Q.fadeEndTime&&Q.fadeEndTime<=n.q.now())continue;const ae=this.findLoadedParent(ee,Math.max(ee.overscaledZ-oo.maxOverzooming,this._source.minzoom));ae&&(this._addTile(ae.tileID),N[ae.tileID.key]=ae.tileID),B[X]=ee}const J=w[w.length-1].overscaledZ;for(const X in this._tiles){const ee=this._tiles[X];if(L[X]||!ee.hasData())continue;let Q=ee.tileID;for(;Q.overscaledZ>J;){Q=Q.scaledTo(Q.overscaledZ-1);const ae=this._tiles[Q.key];if(ae&&ae.hasData()&&B[Q.key]){L[X]=ee.tileID;break}}}for(const X in N)L[X]||(this._coveredTiles[X]=!0,L[X]=N[X])}for(const N in L)this._tiles[N].clearFadeHold();const O=n.bk(this._tiles,L);for(const N of O){const B=this._tiles[N];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(+N)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const o={};if(i.length===0)return o;const d={},g=i.reduce((L,O)=>Math.min(L,O.overscaledZ),1/0),v=i[0].overscaledZ,w=Math.max(v-oo.maxOverzooming,this._source.minzoom),C=Math.max(v+oo.maxUnderzooming,this._source.minzoom),D={};for(const L of i){const O=this._addTile(L);o[L.key]=L,O.hasData()||g<this._source.maxzoom&&(D[L.key]=L)}this._retainLoadedChildren(D,g,C,o);for(const L of i){let O=this._tiles[L.key];if(O.hasData())continue;if(L.canonical.z>=this._source.maxzoom){const B=L.children(this._source.maxzoom)[0],q=this.getTile(B);if(q&&q.hasData()){o[B.key]=B;continue}}else{const B=L.children(this._source.maxzoom);if(o[B[0].key]&&o[B[1].key]&&o[B[2].key]&&o[B[3].key])continue}let N=O.wasRequested();for(let B=L.overscaledZ-1;B>=w;--B){const q=L.scaledTo(B);if(d[q.key]||(d[q.key]=!0,O=this.getTile(q),!O&&N&&(O=this._addTile(q)),O&&(o[q.key]=q,N=O.wasRequested(),O.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const o=[];let d,g=this._tiles[i].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){d=this._loadedParentTiles[g.key];break}o.push(g.key);const v=g.scaledTo(g.overscaledZ-1);if(d=this._getLoadedTile(v),d)break;g=v}for(const v of o)this._loadedParentTiles[v]=d}}_addTile(i){let o=this._tiles[i.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[i.key]||this._reloadTile(i.key,"reloading"),o;o=this._cache.getAndRemove(i),o&&(this._setTileReloadTimer(i.key,o),o.tileID=i,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,o)));const d=!!o;if(!d){const g=this.map?this.map.painter:null,v=this._source.tileSize*i.overscaleFactor();o=this._source.type==="raster-array"?new el(i,v,this.transform.tileZoom,g,this._isRaster):new Qa(i,v,this.transform.tileZoom,g,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,i.key,o.state))}return o?(o.uses++,this._tiles[i.key]=o,d||this._source.fire(new n.z("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(i,o){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const d=o.getExpiryTimeout();d&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},d))}_removeTile(i){const o=this._tiles[i];o&&(o.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),o.uses>0||(o.hasData()&&o.state!=="reloading"||o.state==="empty"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,o,d){const g=[],v=this.transform;if(!v)return g;const w=v.projection.name==="globe",C=n.at(v.center.lng);for(const D in this._tiles){const L=this._tiles[D];if(d&&L.clearQueryDebugViz(),L.holdingForFade())continue;let O;if(w){const N=L.tileID.canonical;if(N.z===0){const B=[Math.abs(n.aw(C,...di(N,-1))-C),Math.abs(n.aw(C,...di(N,1))-C)];O=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(n.aw(C,...di(N,-1))-C),Math.abs(n.aw(C,...di(N,0))-C),Math.abs(n.aw(C,...di(N,1))-C)];O=[B.indexOf(Math.min(...B))-1]}}else O=[0];for(const N of O){const B=i.containsTile(L,v,o,N);B&&g.push(B)}}return g}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(i){return this._getRenderableCoordinates(i)}_getRenderableCoordinates(i,o){const d=this.getRenderableIds(i,o).map(v=>this._tiles[v].tileID),g=this.transform.projection.name==="globe";for(const v of d)v.projMatrix=this.transform.calculateProjMatrix(v.toUnwrapped()),v.expandedProjMatrix=g?this.transform.calculateProjMatrix(v.toUnwrapped(),!1,!0):v.projMatrix;return d}sortCoordinatesByDistance(i){const o=i.slice(),d=this.transform._camera.position,g=this.transform._camera.forward(),v={};for(const w of o){const C=1/(1<<w.canonical.z);v[w.key]=((w.canonical.x+.5)*C+w.wrap-d[0])*g[0]+((w.canonical.y+.5)*C-d[1])*g[1]-d[2]*g[2]}return o.sort((w,C)=>v[w.key]-v[C.key]),o}hasTransition(){if(this._source.hasTransition())return!0;if(Gp(this._source.type))for(const i in this._tiles){const o=this._tiles[i];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=n.q.now())return!0}return!1}setFeatureState(i,o,d){this._state.updateState(i=i||"_geojsonTileLayer",o,d)}removeFeatureState(i,o,d){this._state.removeFeatureState(i=i||"_geojsonTileLayer",o,d)}getFeatureState(i,o){return this._state.getState(i=i||"_geojsonTileLayer",o)}setDependencies(i,o,d){const g=this._tiles[i];g&&g.setDependencies(o,d)}reloadTilesForDependencies(i,o){for(const d in this._tiles)this._tiles[d].hasDependency(i,o)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(i,o))}_preloadTiles(i,o){if(!this._sourceLoaded){const D=()=>{this._sourceLoaded&&(this._source.off("data",D),this._preloadTiles(i,o))};return void this._source.on("data",D)}const d=new Map,g=Array.isArray(i)?i:[i],v=this.map.painter.terrain,w=this.usedForTerrain&&v?v.getScaledDemTileSize():this._source.tileSize;for(const D of g){const L=D.coveringTiles({tileSize:w,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const O of L)d.set(O.key,O);this.usedForTerrain&&D.updateElevation(!1)}const C=Array.from(d.values());n.bl(C,(D,L)=>{const O=new Qa(D,this._source.tileSize*D.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(O,N=>{this._source.type==="raster-dem"&&O.dem&&this._backfillDEM(O),L(N,O)})},o)}}function Qi(h,i){const o=Math.abs(2*h.wrap)-+(h.wrap<0),d=Math.abs(2*i.wrap)-+(i.wrap<0);return h.overscaledZ-i.overscaledZ||d-o||i.canonical.y-h.canonical.y||i.canonical.x-h.canonical.x}function Gp(h){return h==="raster"||h==="image"||h==="video"||h==="custom"}function di(h,i){const o=1<<h.z;return[h.x/o+i,(h.x+1)/o+i]}oo.maxOverzooming=10,oo.maxUnderzooming=3;class Qg{constructor(i){this.style=i,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const i=!1,o=!1;for(const d in this.style._mergedLayers){const g=this.style._mergedLayers[d];if(g.type==="fill-extrusion")this.layers.push({layer:g,visible:i,visibilityChanged:o});else if(g.type==="model"){const v=this.style.getLayerSource(g);v&&v.type==="batched-model"&&this.layers.push({layer:g,visible:i,visibilityChanged:o})}}}onNewFrame(i){this.layersGotHidden=!1;for(const o of this.layers){const d=o.layer;let g=!1;d.type==="fill-extrusion"?g=!d.isHidden(i)&&d.paint.get("fill-extrusion-opacity")>0:d.type==="model"&&(g=!d.isHidden(i)&&d.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!g&&o.visible,o.visible=g}}updateZOffset(i,o){this.currentBuildingBuckets=[];for(const g of this.layers){const v=g.layer,w=this.style.getLayerSourceCache(v);let C=1;v.type==="fill-extrusion"&&(C=g.visible?v.paint.get("fill-extrusion-vertical-scale"):0);let D=w?w.getTile(o):null;if(!D&&w&&o.canonical.z>w.getSource().minzoom){let L=o.scaledTo(Math.min(w.getSource().maxzoom,o.overscaledZ-1));for(;L.overscaledZ>=w.getSource().minzoom&&(D=w.getTile(L),!D&&L.overscaledZ!==0);)L=L.scaledTo(L.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:D?D.getBucket(v):null,tileID:D?D.tileID:o,verticalScale:C})}i.hasAnyZOffset=!1;let d=!1;for(let g=0;g<i.symbolInstances.length;g++){const v=i.symbolInstances.get(g),w=v.zOffset,C=this._getHeightAtTileOffset(o,v.tileAnchorX,v.tileAnchorY);v.zOffset=C!==Number.NEGATIVE_INFINITY?C:w,d||w===v.zOffset||(d=!0),i.hasAnyZOffset||v.zOffset===0||(i.hasAnyZOffset=!0)}d&&(i.zOffsetBuffersNeedUpload=!0,i.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(i,o,d,g){let v=o,w=d;if(i.canonical.z!==g.canonical.z){const C=g.canonical,D=1/(1<<i.canonical.z-C.z);v=(o+i.canonical.x*n.ag)*D-C.x*n.ag|0,w=(d+i.canonical.y*n.ag)*D-C.y*n.ag|0}return{tileX:v,tileY:w}}_getHeightAtTileOffset(i,o,d){let g,v;for(let w=0;w<this.layers.length;++w){if(this.layers[w].layer.type!=="fill-extrusion")continue;const{bucket:C,tileID:D,verticalScale:L}=this.currentBuildingBuckets[w];if(!C)continue;const{tileX:O,tileY:N}=this._mapCoordToOverlappingTile(i,o,d,D),B=C.getHeightAtTileCoord(O,N);B&&B.height!==void 0&&(B.hidden?g=B.height:v=Math.max(B.height*L,v||0))}if(v!==void 0)return v;for(let w=0;w<this.layers.length;++w){const C=this.layers[w];if(C.layer.type!=="model"||!C.visible)continue;const{bucket:D,tileID:L}=this.currentBuildingBuckets[w];if(!D)continue;const{tileX:O,tileY:N}=this._mapCoordToOverlappingTile(i,o,d,L),B=D.getHeightAtTileCoord(O,N);if(B&&!B.hidden)return B.height===void 0&&g!==void 0?Math.min(B.maxHeight,g)*B.verticalScale:B.height?B.height*B.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Od(h,i){const o={};for(const d in h)d!=="ref"&&(o[d]=h[d]);return n.bm.forEach(d=>{d in i&&(o[d]=i[d])}),o}function zd(h){h=h.slice();const i=Object.create(null);for(let o=0;o<h.length;o++)i[h[o].id]=h[o];for(let o=0;o<h.length;o++)"ref"in h[o]&&(h[o]=Od(h[o],i[h[o].ref]));return h}const Ri={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function kd(h,i,o){o.push({command:Ri.addSource,args:[h,i[h]]})}function Il(h,i,o){i.push({command:Ri.removeSource,args:[h]}),o[h]=!0}function Wt(h,i,o,d){Il(h,o,d),kd(h,i,o)}function rn(h,i,o){let d;for(d in h[o])if(h[o].hasOwnProperty(d)&&d!=="data"&&!n.bn(h[o][d],i[o][d]))return!1;for(d in i[o])if(i[o].hasOwnProperty(d)&&d!=="data"&&!n.bn(h[o][d],i[o][d]))return!1;return!0}function qi(h,i,o,d,g,v){let w;for(w in i=i||{},h=h||{})h.hasOwnProperty(w)&&(n.bn(h[w],i[w])||o.push({command:v,args:[d,w,i[w],g]}));for(w in i)i.hasOwnProperty(w)&&!h.hasOwnProperty(w)&&(n.bn(h[w],i[w])||o.push({command:v,args:[d,w,i[w],g]}))}function Jr(h){return h.id}function Ra(h,i){return h[i.id]=i,h}class Yi{constructor(i,o){this.reset(i,o)}reset(i,o){this.points=i||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=n.aw(i,0,1);let o=1,d=this._distances[o];const g=i*this.paddedLength+this.padding;for(;d<g&&o<this._distances.length;)d=this._distances[++o];const v=o-1,w=this._distances[v],C=d-w,D=C>0?(g-w)/C:0;return this.points[v].mult(1-D).add(this.points[o].mult(D))}}class Uu{constructor(i,o,d){const g=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(i/d),this.yCellCount=Math.ceil(o/d);for(let w=0;w<this.xCellCount*this.yCellCount;w++)g.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=o,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,o,d,g,v){this._forEachCell(o,d,g,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(o),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(v)}insertCircle(i,o,d,g){this._forEachCell(o-g,d-g,o+g,d+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(o),this.circles.push(d),this.circles.push(g)}_insertBoxCell(i,o,d,g,v,w){this.boxCells[v].push(w)}_insertCircleCell(i,o,d,g,v,w){this.circleCells[v].push(w)}_query(i,o,d,g,v,w){if(d<0||i>this.width||g<0||o>this.height)return!v&&[];const C=[];if(i<=0&&o<=0&&this.width<=d&&this.height<=g){if(v)return!0;for(let D=0;D<this.boxKeys.length;D++)C.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const L=this.circles[3*D],O=this.circles[3*D+1],N=this.circles[3*D+2];C.push({key:this.circleKeys[D],x1:L-N,y1:O-N,x2:L+N,y2:O+N})}return w?C.filter(w):C}return this._forEachCell(i,o,d,g,this._queryCell,C,{hitTest:v,seenUids:{box:{},circle:{}}},w),v?C.length>0:C}_queryCircle(i,o,d,g,v){const w=i-d,C=i+d,D=o-d,L=o+d;if(C<0||w>this.width||L<0||D>this.height)return!g&&[];const O=[];return this._forEachCell(w,D,C,L,this._queryCellCircle,O,{hitTest:g,circle:{x:i,y:o,radius:d},seenUids:{box:{},circle:{}}},v),g?O.length>0:O}query(i,o,d,g,v){return this._query(i,o,d,g,!1,v)}hitTest(i,o,d,g,v){return this._query(i,o,d,g,!0,v)}hitTestCircle(i,o,d,g){return this._queryCircle(i,o,d,!0,g)}_queryCell(i,o,d,g,v,w,C,D){const L=C.seenUids,O=this.boxCells[v];if(O!==null){const B=this.bboxes;for(const q of O)if(!L.box[q]){L.box[q]=!0;const J=4*q;if(i<=B[J+2]&&o<=B[J+3]&&d>=B[J+0]&&g>=B[J+1]&&(!D||D(this.boxKeys[q]))){if(C.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[q],x1:B[J],y1:B[J+1],x2:B[J+2],y2:B[J+3]})}}}const N=this.circleCells[v];if(N!==null){const B=this.circles;for(const q of N)if(!L.circle[q]){L.circle[q]=!0;const J=3*q;if(this._circleAndRectCollide(B[J],B[J+1],B[J+2],i,o,d,g)&&(!D||D(this.circleKeys[q]))){if(C.hitTest)return w.push(!0),!0;{const X=B[J],ee=B[J+1],Q=B[J+2];w.push({key:this.circleKeys[q],x1:X-Q,y1:ee-Q,x2:X+Q,y2:ee+Q})}}}}}_queryCellCircle(i,o,d,g,v,w,C,D){const L=C.circle,O=C.seenUids,N=this.boxCells[v];if(N!==null){const q=this.bboxes;for(const J of N)if(!O.box[J]){O.box[J]=!0;const X=4*J;if(this._circleAndRectCollide(L.x,L.y,L.radius,q[X+0],q[X+1],q[X+2],q[X+3])&&(!D||D(this.boxKeys[J])))return w.push(!0),!0}}const B=this.circleCells[v];if(B!==null){const q=this.circles;for(const J of B)if(!O.circle[J]){O.circle[J]=!0;const X=3*J;if(this._circlesCollide(q[X],q[X+1],q[X+2],L.x,L.y,L.radius)&&(!D||D(this.circleKeys[J])))return w.push(!0),!0}}}_forEachCell(i,o,d,g,v,w,C,D){const L=this._convertToXCellCoord(i),O=this._convertToYCellCoord(o),N=this._convertToXCellCoord(d),B=this._convertToYCellCoord(g);for(let q=L;q<=N;q++)for(let J=O;J<=B;J++)if(v.call(this,i,o,d,g,this.xCellCount*J+q,w,C,D))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,o,d,g,v,w){const C=g-i,D=v-o,L=d+w;return L*L>C*C+D*D}_circleAndRectCollide(i,o,d,g,v,w,C){const D=(w-g)/2,L=Math.abs(i-(g+D));if(L>D+d)return!1;const O=(C-v)/2,N=Math.abs(o-(v+O));if(N>O+d)return!1;if(L<=D||N<=O)return!0;const B=L-D,q=N-O;return B*B+q*q<=d*d}}const ta={unknown:0,flipRequired:1,flipNotRequired:2},ju=Math.tan(85*Math.PI/180);function Rr(h,i,o,d,g,v,w){const C=n.ab.mat4.create();if(o)if(v.name==="globe"){const D=n.bo(g,i);n.ab.mat4.multiply(C,C,D)}else{const D=n.ab.mat2.invert([],w);C[0]=D[0],C[1]=D[1],C[4]=D[2],C[5]=D[3],d||n.ab.mat4.rotateZ(C,C,g.angle)}else n.ab.mat4.multiply(C,g.labelPlaneMatrix,h);return C}function qn(h,i,o,d,g,v,w){const C=Rr(h,i,o,d,g,v,w);return v.name==="globe"&&o||(C[2]=C[6]=C[10]=C[14]=0),C}function Wp(h,i,o,d,g,v,w){if(o){if(v.name==="globe"){const C=Rr(h,i,o,d,g,v,w);return n.ab.mat4.invert(C,C),n.ab.mat4.multiply(C,h,C),C}{const C=n.ab.mat4.clone(h),D=n.ab.mat4.identity([]);return D[0]=w[0],D[1]=w[1],D[4]=w[2],D[5]=w[3],n.ab.mat4.multiply(C,C,D),d||n.ab.mat4.rotateZ(C,C,-g.angle),C}}return g.glCoordMatrix}function ys(h,i,o,d){const g=[h,i,o,1];o?n.ab.vec4.transformMat4(g,g,d):ao(g,g,d);const v=g[3];return g[0]/=v,g[1]/=v,g[2]/=v,g}function Fd(h,i){return Math.min(.5+h/i*.5,1.5)}function $u(h,i){const o=h[0]/h[3],d=h[1]/h[3];return o>=-i[0]&&o<=i[0]&&d>=-i[1]&&d<=i[1]}function Nd(h,i,o,d,g,v,w,C,D,L){const O=o.transform,N=d?h.textSizeData:h.iconSizeData,B=n.bp(N,o.transform.zoom),q=O.projection.name==="globe",J=[256/o.width*2+1,256/o.height*2+1],X=d?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;X.clear();let ee=null;q&&(ee=d?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const Q=h.lineVertexArray,ae=d?h.text.placedSymbolArray:h.icon.placedSymbolArray,pe=o.transform.width/o.transform.height;let fe,we=!1;for(let ge=0;ge<ae.length;ge++){const ve=ae.get(ge),{numGlyphs:_e,writingMode:Me}=ve;if(Me!==n.bq.vertical||we||fe===n.bq.horizontal||(we=!0),fe=Me,(ve.hidden||Me===n.bq.vertical)&&!we){Vn(_e,X);continue}we=!1;const ke=new n.P(ve.tileAnchorX,ve.tileAnchorY);let{x:tt,y:We,z:ct}=O.projection.projectTilePoint(ke.x,ke.y,L.canonical);if(D){const[ut,vt,Et]=D(ke);tt+=ut,We+=vt,ct+=Et}const lt=[tt,We,ct,1];if(n.ab.vec4.transformMat4(lt,lt,i),!$u(lt,J)){Vn(_e,X);continue}const $e=lt[3],it=Fd(o.transform.getCameraToCenterDistance(O.projection),$e),gt=n.br(N,B,ve),Ue=w?gt/it:gt*it,ht=ys(tt,We,ct,g);if(ht[3]<=0){Vn(_e,X);continue}let nt={};const St=w?null:D,pt=ia(ve,Ue,!1,C,i,g,v,h.glyphOffsetArray,Q,X,ee,ht,ke,nt,pe,St,O.projection,L,w);we=pt.useVertical,St&&pt.needsFlipping&&(nt={}),(pt.notEnoughRoom||we||pt.needsFlipping&&ia(ve,Ue,!0,C,i,g,v,h.glyphOffsetArray,Q,X,ee,ht,ke,nt,pe,St,O.projection,L,w).notEnoughRoom)&&Vn(_e,X)}d?(h.text.dynamicLayoutVertexBuffer.updateData(X),ee&&h.text.globeExtVertexBuffer&&h.text.globeExtVertexBuffer.updateData(ee)):(h.icon.dynamicLayoutVertexBuffer.updateData(X),ee&&h.icon.globeExtVertexBuffer&&h.icon.globeExtVertexBuffer.updateData(ee))}function qu(h,i,o,d,g,v,w,C,D,L,O,N,B,q,J,X){const{lineStartIndex:ee,glyphStartIndex:Q,segment:ae}=C,pe=Q+C.numGlyphs,fe=ee+C.lineLength,we=i.getoffsetX(Q),ge=i.getoffsetX(pe-1),ve=Da(h*we,o,d,g,v,w,ae,ee,fe,D,L,O,N,B,!0,q,J,X);if(!ve)return null;const _e=Da(h*ge,o,d,g,v,w,ae,ee,fe,D,L,O,N,B,!0,q,J,X);return _e?{first:ve,last:_e}:null}function Qr(h,i,o,d){return h===n.bq.horizontal&&Math.abs(d)>Math.abs(o)?{useVertical:!0}:h===n.bq.vertical?d>0?{needsFlipping:!0}:null:i!==ta.unknown&&function(g,v){return g===0||Math.abs(v/g)>ju}(o,d)?i===ta.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function ia(h,i,o,d,g,v,w,C,D,L,O,N,B,q,J,X,ee,Q,ae){const pe=i/24,fe=h.lineOffsetX*pe,we=h.lineOffsetY*pe,{lineStartIndex:ge,glyphStartIndex:ve,numGlyphs:_e,segment:Me,writingMode:ke,flipState:tt}=h,We=ge+h.lineLength,ct=lt=>{if(O){const[Ue,ht,nt]=lt.up,St=L.length;n.bs(O,St+0,Ue,ht,nt),n.bs(O,St+1,Ue,ht,nt),n.bs(O,St+2,Ue,ht,nt),n.bs(O,St+3,Ue,ht,nt)}const[$e,it,gt]=lt.point;n.bt(L,$e,it,gt,lt.angle)};if(_e>1){const lt=qu(pe,C,fe,we,o,N,B,h,D,v,q,X,!1,ee,Q,ae);if(!lt)return{notEnoughRoom:!0};if(d&&!o){let[$e,it,gt]=lt.first.point,[Ue,ht,nt]=lt.last.point;[$e,it]=ys($e,it,gt,w),[Ue,ht]=ys(Ue,ht,nt,w);const St=Qr(ke,tt,(Ue-$e)*J,ht-it);if(h.flipState=St&&St.needsFlipping?ta.flipRequired:ta.flipNotRequired,St)return St}ct(lt.first);for(let $e=ve+1;$e<ve+_e-1;$e++){const it=Da(pe*C.getoffsetX($e),fe,we,o,N,B,Me,ge,We,D,v,q,X,!1,!1,ee,Q,ae);if(!it)return L.length-=4*($e-ve),{notEnoughRoom:!0};ct(it)}ct(lt.last)}else{if(d&&!o){const $e=ys(B.x,B.y,0,g),it=ge+Me+1,gt=new n.P(D.getx(it),D.gety(it)),Ue=ys(gt.x,gt.y,0,g),ht=Ue[3]>0?Ue:Zp(B,gt,$e,1,g,void 0,ee,Q.canonical),nt=Qr(ke,tt,(ht[0]-$e[0])*J,ht[1]-$e[1]);if(h.flipState=nt&&nt.needsFlipping?ta.flipRequired:ta.flipNotRequired,nt)return nt}const lt=Da(pe*C.getoffsetX(ve),fe,we,o,N,B,Me,ge,We,D,v,q,X,!1,!1,ee,Q,ae);if(!lt)return{notEnoughRoom:!0};ct(lt)}return{}}function qr(h,i,o,d,g){const{x:v,y:w,z:C}=d.projectTilePoint(h.x,h.y,i);if(!g)return ys(v,w,C,o);const[D,L,O]=g(h);return ys(v+D,w+L,C+O,o)}function Zp(h,i,o,d,g,v,w,C){const D=qr(h.sub(i)._unit()._add(h),C,g,w,v);return n.ab.vec3.sub(D,o,D),n.ab.vec3.normalize(D,D),n.ab.vec3.scaleAndAdd(D,o,D,d)}function Da(h,i,o,d,g,v,w,C,D,L,O,N,B,q,J,X,ee,Q){const ae=d?h-i:h+i;let pe=ae>0?1:-1,fe=0;d&&(pe*=-1,fe=Math.PI),pe<0&&(fe+=Math.PI);let we=C+w+(pe>0?0:1)|0,ge=g,ve=g,_e=0,Me=0;const ke=Math.abs(ae),tt=[],We=[];let ct=v,lt=ct;const $e=()=>Zp(lt,ct,ve,ke-_e+1,O,B,X,ee.canonical);for(;_e+Me<=ke;){if(we+=pe,we<C||we>=D)return null;if(ve=ge,lt=ct,tt.push(ve),q&&We.push(lt),ct=new n.P(L.getx(we),L.gety(we)),ge=N[we],!ge){const vt=qr(ct,ee.canonical,O,X,B);ge=vt[3]>0?N[we]=vt:$e()}_e+=Me,Me=n.ab.vec3.distance(ve,ge)}J&&B&&(N[we]&&(ge=$e(),Me=n.ab.vec3.distance(ve,ge)),N[we]=ge);const it=(ke-_e)/Me,gt=ct.sub(lt)._mult(it)._add(lt),Ue=n.ab.vec3.sub([],ge,ve),ht=n.ab.vec3.scaleAndAdd([],ve,Ue,it);let nt=[0,0,1],St=Ue[0],pt=Ue[1];if(Q&&(nt=X.upVector(ee.canonical,gt.x,gt.y),nt[0]!==0||nt[1]!==0||nt[2]!==1)){const vt=[nt[2],0,-nt[0]],Et=n.ab.vec3.cross([],nt,vt);n.ab.vec3.normalize(vt,vt),n.ab.vec3.normalize(Et,Et),St=n.ab.vec3.dot(Ue,vt),pt=n.ab.vec3.dot(Ue,Et)}if(o){const vt=n.ab.vec3.cross([],nt,Ue);n.ab.vec3.normalize(vt,vt),n.ab.vec3.scaleAndAdd(ht,ht,vt,o*pe)}const ut=fe+Math.atan2(pt,St);return tt.push(ht),q&&We.push(gt),{point:ht,angle:ut,path:tt,tilePath:We,up:nt}}function Vn(h,i){const o=i.length,d=o+4*h;i.resize(d),i.float32.fill(-1/0,4*o,4*d)}function ao(h,i,o){const d=i[0],g=i[1];return h[0]=o[0]*d+o[4]*g+o[12],h[1]=o[1]*d+o[5]*g+o[13],h[3]=o[3]*d+o[7]*g+o[15],h}const Dr=100;class ir{constructor(i,o,d=new Uu(i.width+200,i.height+200,25),g=new Uu(i.width+200,i.height+200,25)){this.transform=i,this.grid=d,this.ignoredGrid=g,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Dr,this.screenBottomBoundary=i.height+Dr,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=o}placeCollisionBox(i,o,d,g,v,w,C,D){let L=d.projectedAnchorX,O=d.projectedAnchorY,N=d.projectedAnchorZ;const B=d.elevation,q=d.tileID,J=i.getProjection();if(B&&q){const[ge,ve,_e]=J.upVector(q.canonical,d.tileAnchorX,d.tileAnchorY),Me=J.upVectorScale(q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;L+=ge*B*Me,O+=ve*B*Me,N+=_e*B*Me}const X=this.projectAndGetPerspectiveRatio(C,L,O,N,d.tileID,J.name==="globe"||!!B||this.transform.pitch>0,J),ee=w*X.perspectiveRatio,Q=(d.x1*o+g.x-d.padding)*ee+X.point.x,ae=(d.y1*o+g.y-d.padding)*ee+X.point.y,pe=(d.x2*o+g.x+d.padding)*ee+X.point.x,fe=(d.y2*o+g.y+d.padding)*ee+X.point.y,we=X.perspectiveRatio<=.55||X.occluded;return!this.isInsideGrid(Q,ae,pe,fe)||!v&&this.grid.hitTest(Q,ae,pe,fe,D)||we?{box:[],offscreen:!1,occluded:X.occluded}:{box:[Q,ae,pe,fe],offscreen:this.isOffscreen(Q,ae,pe,fe),occluded:!1}}placeCollisionCircles(i,o,d,g,v,w,C,D,L,O,N,B,q,J,X){const ee=[],Q=this.transform.elevation,ae=i.getProjection(),pe=Q?Q.getAtTileOffsetFunc(X,this.transform.center.lat,this.transform.worldSize,ae):null,fe=new n.P(d.tileAnchorX,d.tileAnchorY);let{x:we,y:ge,z:ve}=ae.projectTilePoint(fe.x,fe.y,X.canonical);if(pe){const[gt,Ue,ht]=pe(fe);we+=gt,ge+=Ue,ve+=ht}const _e=ae.name==="globe",Me=this.projectAndGetPerspectiveRatio(C,we,ge,ve,X,_e||!!Q||this.transform.pitch>0,ae),{perspectiveRatio:ke}=Me,tt=(N?w/ke:w*ke)/n.bw,We=ys(we,ge,ve,D),ct=Me.signedDistanceFromCamera>0?qu(tt,v,d.lineOffsetX*tt,d.lineOffsetY*tt,!1,We,fe,d,g,D,{},Q&&!N?pe:null,N&&!!Q,ae,X,N):null;let lt=!1,$e=!1,it=!0;if(ct&&!Me.occluded){const gt=.5*q*ke+J,Ue=new n.P(-100,-100),ht=new n.P(this.screenRightBoundary,this.screenBottomBoundary),nt=new Yi,{first:St,last:pt}=ct,ut=St.path.length;let vt=[];for(let $t=ut-1;$t>=1;$t--)vt.push(St.path[$t]);for(let $t=1;$t<pt.path.length;$t++)vt.push(pt.path[$t]);const Et=2.5*gt;L&&(vt=vt.map(([$t,fi,ri],ai)=>(pe&&!_e&&(ri=pe(ai<ut-1?St.tilePath[ut-1-ai]:pt.tilePath[ai-ut+2])[2]),ys($t,fi,ri,L))),vt.some($t=>$t[3]<=0)&&(vt=[]));let Nt=[];if(vt.length>0){let $t=1/0,fi=-1/0,ri=1/0,ai=-1/0;for(const xi of vt)$t=Math.min($t,xi[0]),ri=Math.min(ri,xi[1]),fi=Math.max(fi,xi[0]),ai=Math.max(ai,xi[1]);fi>=Ue.x&&$t<=ht.x&&ai>=Ue.y&&ri<=ht.y&&(Nt=[vt.map(xi=>new n.P(xi[0],xi[1]))],($t<Ue.x||fi>ht.x||ri<Ue.y||ai>ht.y)&&(Nt=n.bu(Nt,Ue.x,Ue.y,ht.x,ht.y)))}for(const $t of Nt){nt.reset($t,.25*gt);let fi=0;fi=nt.length<=.5*gt?1:Math.ceil(nt.paddedLength/Et)+1;for(let ri=0;ri<fi;ri++){const ai=ri/Math.max(fi-1,1),xi=nt.lerp(ai),Bi=xi.x+Dr,on=xi.y+Dr;ee.push(Bi,on,gt,0);const Nn=Bi-gt,Tn=on-gt,wi=Bi+gt,Hi=on+gt;if(it=it&&this.isOffscreen(Nn,Tn,wi,Hi),$e=$e||this.isInsideGrid(Nn,Tn,wi,Hi),!o&&this.grid.hitTestCircle(Bi,on,gt,B)&&(lt=!0,!O))return{circles:[],offscreen:!1,collisionDetected:lt,occluded:!1}}}}return{circles:!O&&lt||!$e?[]:ee,offscreen:it,collisionDetected:lt,occluded:Me.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let d=1/0,g=1/0,v=-1/0,w=-1/0;for(const O of i){const N=new n.P(O.x+Dr,O.y+Dr);d=Math.min(d,N.x),g=Math.min(g,N.y),v=Math.max(v,N.x),w=Math.max(w,N.y),o.push(N)}const C=this.grid.query(d,g,v,w).concat(this.ignoredGrid.query(d,g,v,w)),D={},L={};for(const O of C){const N=O.key;if(D[N.bucketInstanceId]===void 0&&(D[N.bucketInstanceId]={}),D[N.bucketInstanceId][N.featureIndex])continue;const B=[new n.P(O.x1,O.y1),new n.P(O.x2,O.y1),new n.P(O.x2,O.y2),new n.P(O.x1,O.y2)];n.bv(o,B)&&(D[N.bucketInstanceId][N.featureIndex]=!0,L[N.bucketInstanceId]===void 0&&(L[N.bucketInstanceId]=[]),L[N.bucketInstanceId].push(N.featureIndex))}return L}insertCollisionBox(i,o,d,g,v){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:g,collisionGroupID:v},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,o,d,g,v){const w=o?this.ignoredGrid:this.grid,C={bucketInstanceId:d,featureIndex:g,collisionGroupID:v};for(let D=0;D<i.length;D+=4)w.insertCircle(C,i[D],i[D+1],i[D+2])}projectAndGetPerspectiveRatio(i,o,d,g,v,w,C){const D=[o,d,g,1];let L=!1;g||this.transform.pitch>0?(n.ab.vec4.transformMat4(D,D,i),this.fogState&&v&&C.name!=="globe"&&(L=function(B,q,J,X,ee,Q){const ae=Q.calculateFogTileMatrix(ee),pe=[q,J,X];return n.ab.vec3.transformMat4(pe,pe,ae),Re(B,n.ab.vec3.length(pe),Q.pitch,Q._fov)}(this.fogState,o,d,g,v.toUnwrapped(),this.transform)>.9)):ao(D,D,i);const O=D[3];return{point:new n.P((D[0]/O+1)/2*this.transform.width+Dr,(-D[1]/O+1)/2*this.transform.height+Dr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/O*.5,1.5),signedDistanceFromCamera:O,occluded:w&&D[2]>O||L}}isOffscreen(i,o,d,g){return d<Dr||i>=this.screenRightBoundary||g<Dr||o>this.screenBottomBoundary}isInsideGrid(i,o,d,g){return d>=0&&i<this.gridRightBoundary&&g>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const i=n.ab.mat4.identity([]);return n.ab.mat4.translate(i,i,[-100,-100,0]),i}}function Hu(h,i,o){const d=i.createTileMatrix(h,h.worldSize,o.toUnwrapped());return n.ab.mat4.multiply(new Float32Array(16),h.projMatrix,d)}function Mo(h,i,o){if(i.projection.name===o.projection.name)return h.projMatrix;const d=o.clone();return d.setProjection(i.projection),Hu(d,i.getProjection(),h)}function Pl(h,i,o){return i.name===o.projection.name?h.projMatrix:Hu(o,i,h)}class Gu{constructor(i,o,d,g){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?o:-o))):g&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class Co{constructor(i,o,d,g,v,w=!1){this.text=new Gu(i?i.text:null,o,d,v),this.icon=new Gu(i?i.icon:null,o,g,v),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xp{constructor(i,o,d,g=!1){this.text=i,this.icon=o,this.skipFade=d,this.clipped=g}}class La{constructor(){this.invProjMatrix=n.ab.mat4.create(),this.viewportMatrix=n.ab.mat4.create(),this.circles=[]}}class G1{constructor(i,o,d,g,v){this.bucketInstanceId=i,this.featureIndex=o,this.sourceLayerIndex=d,this.bucketIndex=g,this.tileID=v}}class Yp{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const o=++this.maxGroupID;this.collisionGroups[i]={ID:o,predicate:d=>d.collisionGroupID===o}}return this.collisionGroups[i]}}function vs(h,i,o,d,g){const{horizontalAlign:v,verticalAlign:w}=n.bD(h),C=-(v-.5)*i,D=-(w-.5)*o,L=n.bC(h,d);return new n.P(C+L[0]*g,D+L[1]*g)}function Kp(h,i,o,d,g){const v=new n.P(h,i);return o&&v._rotate(d?g:-g),v}class Bd{constructor(i,o,d,g,v,w){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new ir(this.transform,v),this.buildingIndex=w,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new Yp(d),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,o,d,g,v=1){const w=d.getBucket(o),C=d.latestFeatureIndex;if(!w||!C||o.fqid!==w.layerIds[0])return;const D=w.layers[0].layout,L=w.layers[0].paint,O=d.collisionBoxArray,N=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),B=d.tileSize/n.ag,q=d.tileID.toUnwrapped();this.transform.setProjection(w.projection);const J=(X=d.tileID,ee=w.getProjection(),Q=this.transform,ee.name===this.projection?Q.calculateProjMatrix(X.toUnwrapped()):Hu(Q,ee,X));var X,ee,Q;const ae=D.get("text-pitch-alignment")==="map",pe=D.get("text-rotation-alignment")==="map";o.compileFilter(o.options);const fe=o.dynamicFilter(),we=o.dynamicFilterNeedsFeature(),ge=this.transform.calculatePixelsToTileUnitsMatrix(d),ve=qn(J,d.tileID.canonical,ae,pe,this.transform,w.getProjection(),ge);let _e=null;if(ae){const gt=Wp(J,d.tileID.canonical,ae,pe,this.transform,w.getProjection(),ge);_e=n.ab.mat4.multiply([],this.transform.labelPlaneMatrix,gt)}let Me=null;fe&&d.latestFeatureIndex&&(Me={unwrappedTileID:q,dynamicFilter:fe,dynamicFilterNeedsFeature:we}),this.retainedQueryData[w.bucketInstanceId]=new G1(w.bucketInstanceId,C,w.sourceLayerIndex,w.index,d.tileID);const[ke,tt]=w.layers[0].layout.get("text-size-scale-range"),We=n.aw(v,ke,tt),[ct,lt]=D.get("icon-size-scale-range"),$e=n.aw(v,ct,lt),it={bucket:w,layout:D,paint:L,posMatrix:J,textLabelPlaneMatrix:ve,labelToScreenMatrix:_e,clippingData:Me,scale:N,textPixelRatio:B,holdingForFade:d.holdingForFade(),collisionBoxArray:O,partiallyEvaluatedTextSize:n.bp(w.textSizeData,this.transform.zoom,We),partiallyEvaluatedIconSize:n.bp(w.iconSizeData,this.transform.zoom,$e),collisionGroup:this.collisionGroups.get(w.sourceID),latestFeatureIndex:d.latestFeatureIndex};if(g)for(const gt of w.sortKeyRanges){const{sortKey:Ue,symbolInstanceStart:ht,symbolInstanceEnd:nt}=gt;i.push({sortKey:Ue,symbolInstanceStart:ht,symbolInstanceEnd:nt,parameters:it})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:it})}attemptAnchorPlacement(i,o,d,g,v,w,C,D,L,O,N,B,q,J,X,ee,Q,ae){const{textOffset0:pe,textOffset1:fe,crossTileID:we}=B,ge=[pe,fe],ve=vs(i,d,g,ge,v),_e=this.collisionIndex.placeCollisionBox(J,v,o,Kp(ve.x,ve.y,w,C,this.transform.angle),N,D,L,O.predicate);if(ee){const Me=J.getSymbolInstanceIconSize(ae,this.transform.zoom,B.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(J,Me,ee,Kp(ve.x,ve.y,w,C,this.transform.angle),N,D,L,O.predicate).box.length===0)return}if(_e.box.length>0){let Me;return this.prevPlacement&&this.prevPlacement.variableOffsets[we]&&this.prevPlacement.placements[we]&&this.prevPlacement.placements[we].text&&(Me=this.prevPlacement.variableOffsets[we].anchor),this.variableOffsets[we]={textOffset:ge,width:d,height:g,anchor:i,textScale:v,prevAnchor:Me},this.markUsedJustification(J,i,B,X),J.allowVerticalPlacement&&(this.markUsedOrientation(J,X,B),this.placedOrientations[we]=X),{shift:ve,placedGlyphBoxes:_e}}}placeLayerBucketPart(i,o,d,g,v=1){const{bucket:w,layout:C,paint:D,posMatrix:L,textLabelPlaneMatrix:O,labelToScreenMatrix:N,clippingData:B,textPixelRatio:q,holdingForFade:J,collisionBoxArray:X,partiallyEvaluatedTextSize:ee,partiallyEvaluatedIconSize:Q,collisionGroup:ae,latestFeatureIndex:pe}=i.parameters,fe=C.get("text-optional"),we=C.get("icon-optional"),ge=C.get("text-allow-overlap"),ve=C.get("icon-allow-overlap"),_e=C.get("text-rotation-alignment")==="map",Me=C.get("text-pitch-alignment")==="map",ke=C.get("symbol-z-elevate"),tt=D.get("symbol-z-offset"),We=C.get("symbol-elevation-reference")==="sea",[ct,lt]=C.get("text-size-scale-range"),[$e,it]=C.get("icon-size-scale-range"),gt=n.aw(v,ct,lt),Ue=n.aw(v,$e,it);this.transform.setProjection(w.projection);let ht=ge&&(ve||!w.hasIconData()||we),nt=ve&&(ge||!w.hasTextData()||fe);const St=!tt.isConstant();!w.collisionArrays&&X&&w.deserializeCollisionBoxes(X),d&&g&&w.updateCollisionDebugBuffers(this.transform.zoom,X,gt,Ue);const pt=(ut,vt,Et)=>{const{crossTileID:Nt,numVerticalGlyphVertices:$t}=ut;let fi=null;if(B&&B.dynamicFilterNeedsFeature||St){const mn=this.retainedQueryData[w.bucketInstanceId];fi=pe.loadFeature({featureIndex:ut.featureIndex,bucketIndex:mn.bucketIndex,sourceLayerIndex:mn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(B&&!(0,B.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},fi,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new n.P(ut.tileAnchorX,ut.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[Nt]=new Xp(!1,!1,!1,!0),void o.add(Nt);const ri=tt.evaluate(fi,{});if(o.has(Nt))return;if(J)return void(this.placements[Nt]=new Xp(!1,!1,!1));let ai=!1,xi=!1,Bi=!0,on=!1,Nn=!1,Tn=null,wi={box:null,offscreen:null,occluded:null},Hi={box:null,offscreen:null,occluded:null},ei=null,ki=null,Ji=null,tn=0,Ln=0,wr=0;Et.textFeatureIndex?tn=Et.textFeatureIndex:ut.useRuntimeCollisionCircles&&(tn=ut.featureIndex),Et.verticalTextFeatureIndex&&(Ln=Et.verticalTextFeatureIndex);const or=mn=>{mn.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const dn=this.transform.elevation;mn.elevation=We?ri:ri+(dn?dn.getAtTileOffset(mn.tileID,mn.tileAnchorX,mn.tileAnchorY):0),mn.elevation+=ut.zOffset},ar=Et.textBox;if(ar){or(ar);const mn=Ui=>{let Xn=n.bq.horizontal;if(w.allowVerticalPlacement&&!Ui&&this.prevPlacement){const Tr=this.prevPlacement.placedOrientations[Nt];Tr&&(this.placedOrientations[Nt]=Tr,Xn=Tr,this.markUsedOrientation(w,Xn,ut))}return Xn},dn=(Ui,Xn)=>{if(w.allowVerticalPlacement&&$t>0&&Et.verticalTextBox){for(const Tr of w.writingModes)if(Tr===n.bq.vertical?(wi=Xn(),Hi=wi):wi=Ui(),wi&&wi.box&&wi.box.length)break}else wi=Ui()};if(C.get("text-variable-anchor")){let Ui=C.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Nt]){const pn=this.prevPlacement.variableOffsets[Nt];Ui.indexOf(pn.anchor)>0&&(Ui=Ui.filter(is=>is!==pn.anchor),Ui.unshift(pn.anchor))}const Xn=(pn,is,uo)=>{const Rs=w.getSymbolInstanceTextSize(ee,ut,this.transform.zoom,vt),bs=(pn.x2-pn.x1)*Rs+2*pn.padding,ca=(pn.y2-pn.y1)*Rs+2*pn.padding,ho=ut.hasIconTextFit&&!ve?is:null;ho&&or(ho);let Ws={box:[],offscreen:!1,occluded:!1};const Yl=ge?2*Ui.length:Ui.length;for(let ua=0;ua<Yl;++ua){const Kl=this.attemptAnchorPlacement(Ui[ua%Ui.length],pn,bs,ca,Rs,_e,Me,q,L,ae,ua>=Ui.length,ut,vt,w,uo,ho,ee,Q);if(Kl&&(Ws=Kl.placedGlyphBoxes,Ws&&Ws.box&&Ws.box.length)){ai=!0,Tn=Kl.shift;break}}return Ws};dn(()=>Xn(ar,Et.iconBox,n.bq.horizontal),()=>{const pn=Et.verticalTextBox;return pn&&or(pn),w.allowVerticalPlacement&&!(wi&&wi.box&&wi.box.length)&&$t>0&&pn?Xn(pn,Et.verticalIconBox,n.bq.vertical):{box:null,offscreen:null,occluded:null}}),wi&&(ai=wi.box,Bi=wi.offscreen,on=wi.occluded);const Tr=mn(!(!wi||!wi.box));if(!ai&&this.prevPlacement){const pn=this.prevPlacement.variableOffsets[Nt];pn&&(this.variableOffsets[Nt]=pn,this.markUsedJustification(w,pn.anchor,ut,Tr))}}else{const Ui=(Xn,Tr)=>{const pn=w.getSymbolInstanceTextSize(ee,ut,this.transform.zoom,vt,v),is=this.collisionIndex.placeCollisionBox(w,pn,Xn,new n.P(0,0),ge,q,L,ae.predicate);return is&&is.box&&is.box.length&&(this.markUsedOrientation(w,Tr,ut),this.placedOrientations[Nt]=Tr),is};dn(()=>Ui(ar,n.bq.horizontal),()=>{const Xn=Et.verticalTextBox;return w.allowVerticalPlacement&&$t>0&&Xn?(or(Xn),Ui(Xn,n.bq.vertical)):{box:null,offscreen:null,occluded:null}}),mn(!!(wi&&wi.box&&wi.box.length))}}if(ei=wi,ai=ei&&ei.box&&ei.box.length>0,Bi=ei&&ei.offscreen,on=ei&&ei.occluded,ut.useRuntimeCollisionCircles){const mn=w.text.placedSymbolArray.get(ut.centerJustifiedTextSymbolIndex>=0?ut.centerJustifiedTextSymbolIndex:ut.verticalPlacedTextSymbolIndex),dn=n.br(w.textSizeData,ee,mn),Ui=C.get("text-padding");ki=this.collisionIndex.placeCollisionCircles(w,ge,mn,w.lineVertexArray,w.glyphOffsetArray,dn,L,O,N,d,Me,ae.predicate,ut.collisionCircleDiameter*dn/n.bw,Ui,this.retainedQueryData[w.bucketInstanceId].tileID),ai=ge||ki.circles.length>0&&!ki.collisionDetected,Bi=Bi&&ki.offscreen,on=ki.occluded}if(Et.iconFeatureIndex&&(wr=Et.iconFeatureIndex),Et.iconBox){const mn=dn=>{or(dn);const Ui=ut.hasIconTextFit&&Tn?Kp(Tn.x,Tn.y,_e,Me,this.transform.angle):new n.P(0,0),Xn=w.getSymbolInstanceIconSize(Q,this.transform.zoom,ut.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,Xn,dn,Ui,ve,q,L,ae.predicate)};Hi&&Hi.box&&Hi.box.length&&Et.verticalIconBox?(Ji=mn(Et.verticalIconBox),xi=Ji.box.length>0):(Ji=mn(Et.iconBox),xi=Ji.box.length>0),Bi=Bi&&Ji.offscreen,Nn=Ji.occluded}const Gs=fe||ut.numHorizontalGlyphVertices===0&&$t===0,ts=we||ut.numIconVertices===0;if(Gs||ts?ts?Gs||(xi=xi&&ai):ai=xi&&ai:xi=ai=xi&&ai,ai&&ei&&ei.box&&this.collisionIndex.insertCollisionBox(ei.box,C.get("text-ignore-placement"),w.bucketInstanceId,Hi&&Hi.box&&Ln?Ln:tn,ae.ID),xi&&Ji&&this.collisionIndex.insertCollisionBox(Ji.box,C.get("icon-ignore-placement"),w.bucketInstanceId,wr,ae.ID),ki&&(ai&&this.collisionIndex.insertCollisionCircles(ki.circles,C.get("text-ignore-placement"),w.bucketInstanceId,tn,ae.ID),d)){const mn=w.bucketInstanceId;let dn=this.collisionCircleArrays[mn];dn===void 0&&(dn=this.collisionCircleArrays[mn]=new La);for(let Ui=0;Ui<ki.circles.length;Ui+=4)dn.circles.push(ki.circles[Ui+0]),dn.circles.push(ki.circles[Ui+1]),dn.circles.push(ki.circles[Ui+2]),dn.circles.push(ki.collisionDetected?1:0)}const On=w.projection.name!=="globe";ht=ht&&(On||!on),nt=nt&&(On||!Nn),this.placements[Nt]=new Xp(ai||ht,xi||nt,Bi||w.justReloaded),o.add(Nt)};if(ke&&this.buildingIndex&&(this.buildingIndex.updateZOffset(w,this.retainedQueryData[w.bucketInstanceId].tileID),w.updateZOffset()),w.sortFeaturesByY){const ut=w.getSortedSymbolIndexes(this.transform.angle);for(let vt=ut.length-1;vt>=0;--vt){const Et=ut[vt];pt(w.symbolInstances.get(Et),Et,w.collisionArrays[Et])}w.hasAnyZOffset&&n.w(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const ut=w.getSortedIndexesByZOffset();for(let vt=0;vt<ut.length;++vt){const Et=ut[vt];pt(w.symbolInstances.get(Et),Et,w.collisionArrays[Et])}}else for(let ut=i.symbolInstanceStart;ut<i.symbolInstanceEnd;ut++)pt(w.symbolInstances.get(ut),ut,w.collisionArrays[ut]);if(d&&w.bucketInstanceId in this.collisionCircleArrays){const ut=this.collisionCircleArrays[w.bucketInstanceId];n.ab.mat4.invert(ut.invProjMatrix,L),ut.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(i,o,d,g){const{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:D,crossTileID:L}=d,O=n.bB(o),N=g===n.bq.vertical?D:O==="left"?v:O==="center"?w:O==="right"?C:-1;v>=0&&(i.text.placedSymbolArray.get(v).crossTileID=N>=0&&v!==N?0:L),w>=0&&(i.text.placedSymbolArray.get(w).crossTileID=N>=0&&w!==N?0:L),C>=0&&(i.text.placedSymbolArray.get(C).crossTileID=N>=0&&C!==N?0:L),D>=0&&(i.text.placedSymbolArray.get(D).crossTileID=N>=0&&D!==N?0:L)}markUsedOrientation(i,o,d){const g=o===n.bq.horizontal||o===n.bq.horizontalOnly?o:0,v=o===n.bq.vertical?o:0,{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:L}=d,O=i.text.placedSymbolArray;w>=0&&(O.get(w).placedOrientation=g),C>=0&&(O.get(C).placedOrientation=g),D>=0&&(O.get(D).placedOrientation=g),L>=0&&(O.get(L).placedOrientation=v)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let d=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const g=o?o.symbolFadeChange(i):1,v=o?o.opacities:{},w=o?o.variableOffsets:{},C=o?o.placedOrientations:{};for(const D in this.placements){const L=this.placements[D],O=v[D];O?(this.opacities[D]=new Co(O,g,L.text,L.icon,null,L.clipped),d=d||L.text!==O.text.placed||L.icon!==O.icon.placed):(this.opacities[D]=new Co(null,g,L.text,L.icon,L.skipFade,L.clipped),d=d||L.text||L.icon)}for(const D in v){const L=v[D];if(!this.opacities[D]){const O=new Co(L,g,!1,!1);O.isHidden()||(this.opacities[D]=O,d=d||L.text.placed||L.icon.placed)}}for(const D in w)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=w[D]);for(const D in C)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=C[D]);d?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:i)}updateLayerOpacities(i,o,d,g){const v=new Set;for(const w of o){const C=w.getBucket(i);C&&w.latestFeatureIndex&&i.fqid===C.layerIds[0]&&(this.updateBucketOpacities(C,v,w,w.collisionBoxArray,d,g,w.tileID,i.scope),C.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(C,w.tileID),C.updateZOffset()))}}updateBucketOpacities(i,o,d,g,v,w,C,D){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const L=i.layers[0].layout,O=i.layers[0].paint,N=!!i.layers[0].dynamicFilter(),B=new Co(null,0,!1,!1,!0),q=L.get("text-allow-overlap"),J=L.get("icon-allow-overlap"),X=L.get("text-variable-anchor"),ee=L.get("text-rotation-alignment")==="map",Q=L.get("text-pitch-alignment")==="map",ae=O.get("symbol-z-offset"),pe=L.get("symbol-elevation-reference")==="sea",fe=!ae.isConstant(),we=new Co(null,0,q&&(J||!i.hasIconData()||L.get("icon-optional")),J&&(q||!i.hasTextData()||L.get("text-optional")),!0);!i.collisionArrays&&g&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(g);const ge=(_e,Me,ke)=>{for(let tt=0;tt<Me/4;tt++)_e.opacityVertexArray.emplaceBack(ke)};let ve=0;w&&i.updateReplacement(C,w);for(let _e=0;_e<i.symbolInstances.length;_e++){const Me=i.symbolInstances.get(_e),{numHorizontalGlyphVertices:ke,numVerticalGlyphVertices:tt,crossTileID:We,numIconVertices:ct,tileAnchorX:lt,tileAnchorY:$e}=Me;let it=null;const gt=this.retainedQueryData[i.bucketInstanceId];fe&&Me&&gt&&(it=d.latestFeatureIndex.loadFeature({featureIndex:Me.featureIndex,bucketIndex:gt.bucketIndex,sourceLayerIndex:gt.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ue=ae.evaluate(it,{}),ht=o.has(We);let nt=this.opacities[We];ht?nt=B:nt||(nt=we,this.opacities[We]=nt),o.add(We);const St=ke>0||tt>0,pt=ct>0,ut=this.placedOrientations[We],vt=ut===n.bq.vertical,Et=ut===n.bq.horizontal||ut===n.bq.horizontalOnly;!St&&!pt||nt.isHidden()||ve++;let Nt=!1;if((St||pt)&&w)for(const $t of i.activeReplacements){if(n.bx($t,v,n.by.Symbol,D)||$t.min.x>lt||lt>$t.max.x||$t.min.y>$e||$e>$t.max.y)continue;const fi=n.bz(lt,$e,C.canonical,$t.footprintTileId.canonical);if(Nt=n.bA(fi,$t.footprint),Nt)break}if(St){const $t=Nt?Oa:Jp(nt.text);ge(i.text,ke,vt?Oa:$t),ge(i.text,tt,Et?Oa:$t);const fi=nt.text.isHidden(),{leftJustifiedTextSymbolIndex:ri,centerJustifiedTextSymbolIndex:ai,rightJustifiedTextSymbolIndex:xi,verticalPlacedTextSymbolIndex:Bi}=Me,on=i.text.placedSymbolArray,Nn=fi||vt?1:0;ri>=0&&(on.get(ri).hidden=Nn),ai>=0&&(on.get(ai).hidden=Nn),xi>=0&&(on.get(xi).hidden=Nn),Bi>=0&&(on.get(Bi).hidden=fi||Et?1:0);const Tn=this.variableOffsets[We];Tn&&this.markUsedJustification(i,Tn.anchor,Me,ut);const wi=this.placedOrientations[We];wi&&(this.markUsedJustification(i,"left",Me,wi),this.markUsedOrientation(i,wi,Me))}if(pt){const $t=Nt?Oa:Jp(nt.icon),{placedIconSymbolIndex:fi,verticalPlacedIconSymbolIndex:ri}=Me,ai=i.icon.placedSymbolArray,xi=nt.icon.isHidden()?1:0;fi>=0&&(ge(i.icon,ct,vt?Oa:$t),ai.get(fi).hidden=xi),ri>=0&&(ge(i.icon,Me.numVerticalIconVertices,Et?Oa:$t),ai.get(ri).hidden=xi)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const $t=i.collisionArrays[_e];if($t){let fi=new n.P(0,0),ri=!0;if($t.textBox||$t.verticalTextBox){if(X){const xi=this.variableOffsets[We];xi?(fi=vs(xi.anchor,xi.width,xi.height,xi.textOffset,xi.textScale),ee&&fi._rotate(Q?this.transform.angle:-this.transform.angle)):ri=!1}N&&(ri=!nt.clipped),$t.textBox&&Wu(i.textCollisionBox.collisionVertexArray,nt.text.placed,!ri||vt,Ue,pe,fi.x,fi.y),$t.verticalTextBox&&Wu(i.textCollisionBox.collisionVertexArray,nt.text.placed,!ri||Et,Ue,pe,fi.x,fi.y)}const ai=ri&&!!(!Et&&$t.verticalIconBox);$t.iconBox&&Wu(i.iconCollisionBox.collisionVertexArray,nt.icon.placed,ai,Ue,pe,Me.hasIconTextFit?fi.x:0,Me.hasIconTextFit?fi.y:0),$t.verticalIconBox&&Wu(i.iconCollisionBox.collisionVertexArray,nt.icon.placed,!ai,Ue,pe,Me.hasIconTextFit?fi.x:0,Me.hasIconTextFit?fi.y:0)}}}if(i.fullyClipped=ve===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=_e.invProjMatrix,i.placementViewportMatrix=_e.viewportMatrix,i.collisionCircleArray=_e.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,o){const d=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*d>i}setStale(){this.stale=!0}}function Wu(h,i,o,d,g,v,w){h.emplaceBack(i?1:0,o?1:0,v||0,w||0,d,g?1:0),h.emplaceBack(i?1:0,o?1:0,v||0,w||0,d,g?1:0),h.emplaceBack(i?1:0,o?1:0,v||0,w||0,d,g?1:0),h.emplaceBack(i?1:0,o?1:0,v||0,w||0,d,g?1:0)}const Zu=Math.pow(2,25),W1=Math.pow(2,24),Z1=Math.pow(2,17),Xu=Math.pow(2,16),Yu=Math.pow(2,9),X1=Math.pow(2,8),wc=Math.pow(2,1);function Jp(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const i=h.placed?1:0,o=Math.floor(127*h.opacity);return o*Zu+i*W1+o*Z1+i*Xu+o*Yu+i*X1+o*wc+i}const Oa=0;class tl{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,o,d,g,v,w){const C=this._bucketParts;for(;this._currentTileIndex<i.length;)if(o.getBucketParts(C,g,i[this._currentTileIndex],this._sortAcrossTiles,w),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((D,L)=>D.sortKey-L.sortKey));this._currentPartIndex<C.length;){const D=C[this._currentPartIndex];if(o.placeLayerBucketPart(D,this._seenCrossTileIDs,d,D.symbolInstanceStart===0,w),this._currentPartIndex++,v())return!0}return!1}}class Y1{constructor(i,o,d,g,v,w,C,D,L){this.placement=new Bd(i,v,w,C,D,L),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(i,o,d,g,v){const w=n.q.now(),C=()=>{const D=n.q.now()-w;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){const D=o[i[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(D.type==="symbol"&&(!D.minzoom||D.minzoom<=L)&&(!D.maxzoom||D.maxzoom>L)){const O=D,N=O.layout.get("symbol-z-elevate"),B=O.layout.get("symbol-sort-key").constantOr(1)!==void 0,q=O.layout.get("symbol-z-order"),J=q==="viewport-y"||q==="auto"&&!(q!=="viewport-y"&&B),X=O.layout.get("text-allow-overlap")||O.layout.get("icon-allow-overlap")||O.layout.get("text-ignore-placement")||O.layout.get("icon-ignore-placement"),ee=J&&X,Q=this._inProgressLayer=this._inProgressLayer||new tl(O),ae=n.aC(D.source,D.scope);if(Q.continuePlacement(N||ee?g[ae]:d[ae],this.placement,this._showCollisionBoxes,D,C,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Qp=512/n.ag/2;class K1{constructor(i,o,d){this.tileID=i,this.bucketInstanceId=d,this.index=new n.bE(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const g=i.canonical.x*n.ag,v=i.canonical.y*n.ag;for(let w=0;w<o.length;w++){const{key:C,crossTileID:D,tileAnchorX:L,tileAnchorY:O}=o.get(w),N=Math.floor((g+L)*Qp),B=Math.floor((v+O)*Qp);this.index.add(N,B),this.keys.push(C),this.crossTileIDs.push(D)}this.index.finish()}findMatches(i,o,d){const g=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),v=Qp/Math.pow(2,o.canonical.z-this.tileID.canonical.z),w=o.canonical.x*n.ag,C=o.canonical.y*n.ag;for(let D=0;D<i.length;D++){const L=i.get(D);if(L.crossTileID)continue;const{key:O,tileAnchorX:N,tileAnchorY:B}=L,q=Math.floor((w+N)*v),J=Math.floor((C+B)*v),X=this.index.range(q-g,J-g,q+g,J+g);for(const ee of X){const Q=this.crossTileIDs[ee];if(this.keys[ee]===O&&!d.has(Q)){d.add(Q),L.crossTileID=Q;break}}}}}class ey{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class J1{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const o=Math.round((i-this.lng)/360);if(o!==0)for(const d in this.indexes){const g=this.indexes[d],v={};for(const w in g){const C=g[w];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+o),v[C.tileID.key]=C}this.indexes[d]=v}this.lng=i}addBucket(i,o,d){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let v=0;v<o.symbolInstances.length;v++)o.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const g=this.usedCrossTileIDs[i.overscaledZ];for(const v in this.indexes){const w=this.indexes[v];if(Number(v)>i.overscaledZ)for(const C in w){const D=w[C];D.tileID.isChildOf(i)&&D.findMatches(o.symbolInstances,i,g)}else{const C=w[i.scaledTo(Number(v)).key];C&&C.findMatches(o.symbolInstances,i,g)}}for(let v=0;v<o.symbolInstances.length;v++){const w=o.symbolInstances.get(v);w.crossTileID||(w.crossTileID=d.generate(),g.add(w.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new K1(i,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(i,o){for(const d of o.crossTileIDs)this.usedCrossTileIDs[i].delete(d)}removeStaleBuckets(i){let o=!1;for(const d in this.indexes){const g=this.indexes[d];for(const v in g)i[g[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,g[v]),delete g[v],o=!0)}return o}}class em{constructor(){this.layerIndexes={},this.crossTileIDs=new ey,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,o,d,g){let v=this.layerIndexes[i.fqid];v===void 0&&(v=this.layerIndexes[i.fqid]=new J1);let w=!1;const C={};g.name!=="globe"&&v.handleWrapJump(d);for(const D of o){const L=D.getBucket(i);L&&i.fqid===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(D.tileID,L,this.crossTileIDs)&&(w=!0),C[L.bucketInstanceId]=!0)}return v.removeStaleBuckets(C)&&(w=!0),w}pruneUnusedLayers(i){const o={};i.forEach(d=>{o[d]=!0});for(const d in this.layerIndexes)o[d]||delete this.layerIndexes[d]}}const Rl=771;class Pi{constructor(i,o,d,g){this.blendFunction=i,this.blendColor=o,this.mask=d,this.blendEquation=g}}Pi.Replace=[1,0,1,0],Pi.disabled=new Pi(Pi.Replace,n.aj.transparent,[!1,!1,!1,!1]),Pi.unblended=new Pi(Pi.Replace,n.aj.transparent,[!0,!0,!0,!0]),Pi.alphaBlended=new Pi([1,Rl,1,Rl],n.aj.transparent,[!0,!0,!0,!0]),Pi.alphaBlendedNonPremultiplied=new Pi([770,Rl,770,Rl],n.aj.transparent,[!0,!0,!0,!0]),Pi.multiply=new Pi([774,0,774,0],n.aj.transparent,[!0,!0,!0,!0]);class oi{constructor(i,o,d){this.func=i,this.mask=o,this.range=d}}oi.ReadOnly=!1,oi.ReadWrite=!0,oi.disabled=new oi(519,oi.ReadOnly,[0,1]);const Vd=7680;class pi{constructor(i,o,d,g,v,w){this.test=i,this.ref=o,this.mask=d,this.fail=g,this.depthFail=v,this.pass=w}}pi.disabled=new pi({func:519,mask:0},0,0,Vd,Vd,Vd);const Tc=1029,Ud=2305;class gi{constructor(i,o,d){this.enable=i,this.mode=o,this.frontFace=d}}function Ec(h,i){const o=n.bG(h,3);n.ab.mat4.fromQuat(h,i),n.bI(h,3,o)}function Dl(h,i){const o=n.ab.quat.identity([]);return n.ab.quat.rotateZ(o,o,-i),n.ab.quat.rotateX(o,o,-h),o}function tm(h,i){const o=[h[0],h[1],0],d=[i[0],i[1],0];if(n.ab.vec3.length(o)>=1e-15){const w=n.ab.vec3.normalize([],o);n.ab.vec3.scale(d,w,n.ab.vec3.dot(d,w)),i[0]=d[0],i[1]=d[1]}const g=n.ab.vec3.cross([],i,h);if(n.ab.vec3.len(g)<1e-15)return null;const v=Math.atan2(-g[1],g[0]);return Dl(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),v)}gi.disabled=new gi(!1,Tc,Ud),gi.backCCW=new gi(!0,Tc,Ud),gi.backCW=new gi(!0,Tc,2304),gi.frontCW=new gi(!0,1028,2304),gi.frontCCW=new gi(!0,1028,Ud);class jd{constructor(i,o){this.position=i,this.orientation=o}get position(){return this._position}set position(i){if(i){const o=i instanceof n.aa?i:new n.aa(i[0],i[1],i[2]);this._renderWorldCopies&&(o.x=n.bF(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(i,o){if(this.orientation=null,!this.position)return;const d=this.position,g=this._elevation?this._elevation.getAtPointOrZero(n.aa.fromLngLat(i)):0,v=n.aa.fromLngLat(i,g),w=[v.x-d.x,v.y-d.y,v.z-d.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=tm(w,o)}setPitchBearing(i,o){this.orientation=Dl(n.ai(i),n.ai(-o))}}class xs{constructor(i,o){this._transform=n.ab.mat4.identity([]),this.orientation=o,this.position=i}get mercatorPosition(){const i=this.position;return new n.aa(i[0],i[1],i[2])}get position(){const i=n.bG(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var o;i&&n.bI(this._transform,3,[(o=i)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||n.ab.quat.identity([]),i&&Ec(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,o){this._orientation=Dl(i,o),Ec(this._transform,this._orientation)}forward(){const i=n.bG(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=n.bG(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=n.bG(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,o){const d=new Float64Array(16);return n.ab.mat4.invert(d,this.getWorldToCamera(i,o)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(i,o,d){const g=this.position;n.ab.vec3.scale(g,g,-i);const v=new Float64Array(16);return n.ab.mat4.fromScaling(v,[d,d,d]),n.ab.mat4.translate(v,v,g),v[10]*=o,v}getWorldToCamera(i,o){const d=new Float64Array(16),g=new Float64Array(4),v=this.position;return n.ab.quat.conjugate(g,this._orientation),n.ab.vec3.scale(v,v,-i),n.ab.mat4.fromQuat(d,g),n.ab.mat4.translate(d,d,v),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=o,d[9]*=o,d[10]*=o,d[11]*=o,d}getCameraToClipPerspective(i,o,d,g){const v=new Float64Array(16);return n.ab.mat4.perspective(v,i,o,d,g),v}getCameraToClipOrthographic(i,o,d,g,v,w){const C=new Float64Array(16);return n.ab.mat4.ortho(C,i,o,d,g,v,w),C}getDistanceToElevation(i,o=!1){const d=i===0?0:n.bH(i,o?n.aS(this.position[1]):this.position[1]),g=this.forward();return(d-this.position[2])/g[2]}clone(){return new xs([...this.position],[...this.orientation])}}const Hr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Lt{constructor(i=0,o=0,d=0,g=0){if(isNaN(i)||i<0||isNaN(o)||o<0||isNaN(d)||d<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=o,this.left=d,this.right=g}interpolate(i,o,d){return o.top!=null&&i.top!=null&&(this.top=n.af(i.top,o.top,d)),o.bottom!=null&&i.bottom!=null&&(this.bottom=n.af(i.bottom,o.bottom,d)),o.left!=null&&i.left!=null&&(this.left=n.af(i.left,o.left,d)),o.right!=null&&i.right!=null&&(this.right=n.af(i.right,o.right,d)),this}getCenter(i,o){const d=n.aw((this.left+i-this.right)/2,0,i),g=n.aw((this.top+o-this.bottom)/2,0,o);return new n.P(d,g)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Lt(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const im=(h,i,o)=>(1-o)*h+o*i,$d=h=>h*h*h*h*h;class Ku{constructor(i,o,d,g,v,w,C){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=i||0,this._maxZoom=o||22,this._minPitch=d??0,this._maxPitch=g??60,this.setProjection(w),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new n.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Lt,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new xs,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const i=new Ku(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(i,o=!1){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(i||d)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return n.ay(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=n.bP(this.projectionOptions);const d=this.getProjection(),g=!n.bn(o,d);return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(i){return this._orthographicProjectionAtLowPitch!==i&&(this._orthographicProjectionAtLowPitch=i,this._calcMatrices(),!0)}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=n.bP({name:"mercator"});const o=i!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return n.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.P(this.width,this.height)}get bearing(){return n.bF(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const o=-i*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=n.ab.mat2.create(),n.ab.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const o=n.aw(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=n.ai(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const o=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(i){this._tileCoverLift!==i&&(this._tileCoverLift=i)}_updateCameraOnTerrain(){const i=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,o=this.elevation&&i===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||i===Number.NEGATIVE_INFINITY&&(!o||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const d=this._elevation;o||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=i||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let g=0,v=0;for(let w=0;w<o.length;w++){const C=new n.P(o[w][0]*this.width,d+o[w][1]*(this.height-d)),D=i.pointCoordinate(C);if(!D)continue;const L=1/Math.hypot(D[0]-this._camera.position[0],D[1]-this._camera.position[1]);g+=D[3]*L,v+=L}return v===0?NaN:g/v}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*o,g=this._mercatorZfromZoom(i),v=this._mercatorZfromZoom(this._maxZoom),w=Math.max(g-d,v);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let d;d=i.z<this._camera.position[2]?[o.x,o.y,o.z]:[i.x,i.y,i.z];const g=n.ab.vec3.length(n.ab.vec3.sub([],this._camera.position,d));return n.aw(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let o=!1;if(i.orientation&&!n.ab.quat.exactEquals(i.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(i.orientation)),i.position){const d=[i.position.x,i.position.y,i.position.z];n.ab.vec3.exactEquals(d,this._camera.position)||(this._setCameraPosition(d),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,o=new jd;return o.position=new n.aa(i[0],i[1],i[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(i){if(!n.ab.quat.length(i))return!1;n.ab.quat.normalize(i,i);const o=n.ab.vec3.transformQuat([],[0,0,-1],i),d=n.ab.vec3.transformQuat([],[0,-1,0],i);if(d[2]<0)return!1;const g=tm(o,d);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(i){const o=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;i[2]=n.aw(i[2],g/d,g/o),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,o,d){this._unmodified=!1,this._edgeInsets.interpolate(i,o,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const o=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(i){const o=[new n.bQ(0,i)];if(this.renderWorldCopies){const d=this.pointCoordinate(new n.P(0,0)),g=this.pointCoordinate(new n.P(this.width,0)),v=this.pointCoordinate(new n.P(this.width,this.height)),w=this.pointCoordinate(new n.P(0,this.height)),C=Math.floor(Math.min(d.x,g.x,v.x,w.x)),D=Math.floor(Math.max(d.x,g.x,v.x,w.x)),L=1;for(let O=C-L;O<=D+L;O++)O!==0&&o.push(new n.bQ(O,i))}return o}isLODDisabled(i){return(!i||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(i,o,d){let g=[];const v=d!==void 0,w=!v;if(w&&this.zoom<o||v&&d[0]===0&&d[1]===0)return g;const C=new Set,D=(O,N,B,q,J)=>{const X=n.c5(N,O,B,q,J);C.has(X)||(g.push(new n.aG(O,N,B,q,J)),C.add(X))};for(let O=0;O<i.length;O++){const N=i[O];if(w&&N.canonical.z!==o)continue;const B=N.canonical,q=N.overscaledZ,J=N.wrap,X=1<<B.z,ee=B.x+1<X,Q=B.x>0,ae=B.y+1<X,pe=B.y>0,fe=N.wrap-(Q?0:1),we=N.wrap+(ee?0:1),ge=Q?B.x-1:X-1,ve=ee?B.x+1:0;if(v)d[0]<0?(D(q,we,B.z,ve,B.y),d[1]<0&&ae&&(D(q,J,B.z,B.x,B.y+1),D(q,we,B.z,ve,B.y+1)),d[1]>0&&pe&&(D(q,J,B.z,B.x,B.y-1),D(q,we,B.z,ve,B.y-1))):d[0]>0?(D(q,fe,B.z,ge,B.y),d[1]<0&&ae&&(D(q,J,B.z,B.x,B.y+1),D(q,fe,B.z,ge,B.y+1)),d[1]>0&&pe&&(D(q,J,B.z,B.x,B.y-1),D(q,fe,B.z,ge,B.y-1))):d[1]<0&&ae?D(q,J,B.z,B.x,B.y+1):pe&&D(q,J,B.z,B.x,B.y-1);else{const _e=N.visibleQuadrants;1&_e&&(D(q,fe,B.z,ge,B.y),pe&&(D(q,J,B.z,B.x,B.y-1),D(q,fe,B.z,ge,B.y-1))),2&_e&&(D(q,we,B.z,ve,B.y),pe&&(D(q,J,B.z,B.x,B.y-1),D(q,we,B.z,ve,B.y-1))),4&_e&&(D(q,fe,B.z,ge,B.y),ae&&(D(q,J,B.z,B.x,B.y+1),D(q,fe,B.z,ge,B.y+1))),8&_e&&(D(q,we,B.z,ve,B.y),ae&&(D(q,J,B.z,B.x,B.y+1),D(q,we,B.z,ve,B.y+1)))}}const L=[];for(const O of g)g.some(N=>O.isChildOf(N))||L.push(O);if(g=L.filter(O=>!i.some(N=>!!(O.overscaledZ<o&&N.isChildOf(O))||O.equals(N)||O.isChildOf(N))),w){const O=1<<o,N=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),B=[O*N.x,O*N.y],q=4,J=q*q;g=g.filter(X=>{const ee=X.canonical.x+.5-B[0],Q=X.canonical.y+.5-B[1];return ee*ee+Q*Q<J})}return g}coveringTiles(i){let o=this.coveringZoomLevel(i);const d=o,g=this.elevation&&this.elevation.exaggeration(),v=g&&!i.isTerrainDEM,w=this.projection.name==="mercator";if(i.minzoom!==void 0&&o<i.minzoom)return[];i.maxzoom!==void 0&&o>i.maxzoom&&(o=i.maxzoom);const C=this.locationCoordinate(this.center),D=this.center.lat,L=1<<o,O=[L*C.x,L*C.y,0],N=this.projection.name==="globe",B=!N,q=n.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,B),J=N?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),X=L*n.bH(1,this.center.lat),ee=this._camera.position[2]/n.bH(1,this.center.lat),Q=[L*J.x,L*J.y,ee*(B?1:X)],ae=N||g,pe=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),fe=this.isLODDisabled(!0)?o:0;let we;if(this._elevation&&i.isTerrainDEM)we=1e4*this._elevation.exaggeration();else if(this._elevation){const Ue=this._elevation.getMinMaxForVisibleTiles();we=Ue?Ue.max:this._centerAltitude}else we=this._centerAltitude;const ge=i.isTerrainDEM?-we:this._elevation?this._elevation.getMinElevationBelowMSL():0,ve=this.projection.isReprojectedInTileSpace?n.bS(this):1,_e=Ue=>{const nt=new n.aa(Ue.x+25e-6,Ue.y,Ue.z),St=new n.aa(Ue.x,Ue.y+25e-6,Ue.z),pt=Ue.toLngLat(),ut=nt.toLngLat(),vt=St.toLngLat(),Et=this.locationCoordinate(pt),Nt=this.locationCoordinate(ut),$t=this.locationCoordinate(vt),fi=Math.hypot(Nt.x-Et.x,Nt.y-Et.y),ri=Math.hypot($t.x-Et.x,$t.y-Et.y);return Math.sqrt(fi*ri)*ve/25e-6},Me=Ue=>{const ht=we,nt=ge;return{aabb:n.bV(this,L,0,0,0,Ue,nt,ht,this.projection),zoom:0,x:0,y:0,minZ:nt,maxZ:ht,wrap:Ue,fullyVisible:!1}},ke=[];let tt=[];const We=o,ct=i.reparseOverscaled?d:o,lt=(ee-this._centerAltitude)*X,$e=Ue=>{if(!this._elevation||!Ue.tileID||!w)return;const ht=this._elevation.getMinMaxForTile(Ue.tileID),nt=Ue.aabb;ht?(nt.min[2]=ht.min,nt.max[2]=ht.max,nt.center[2]=(nt.min[2]+nt.max[2])/2):(Ue.shouldSplit=gt(Ue),Ue.shouldSplit||(nt.min[2]=nt.max[2]=nt.center[2]=this._centerAltitude))},it=(Ue,ht)=>{if(.707*ht<Ue)return 1;const nt=ht/Ue;return nt/(1.4144271570014144+(Math.pow(1.1,nt-1.4144271570014144+1)-1)/(1.1-1)-1)},gt=Ue=>{if(Ue.zoom<fe)return!0;if(Ue.zoom===We)return!1;if(Ue.shouldSplit!=null)return Ue.shouldSplit;const ht=Ue.aabb.distanceX(Q),nt=Ue.aabb.distanceY(Q);let St=lt,pt=1;if(N){St=Ue.aabb.distanceZ(Q);const ri=Math.pow(2,Ue.zoom),ai=n.aS((Ue.y+1)/ri),xi=n.aS(Ue.y/ri),Bi=Math.min(Math.max(D,ai),xi),on=n.c9(Bi)/n.c9(D);if(pt=Bi===D?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,on/this._mercatorScaleRatio),this.zoom<=n.c6&&Ue.zoom===We-1&&on>=.9)return!0}else if(v&&(St=Ue.aabb.distanceZ(Q)*X),this.projection.isReprojectedInTileSpace&&d<=5){const ri=Math.pow(2,Ue.zoom),ai=_e(new n.aa((Ue.x+.5)/ri,(Ue.y+.5)/ri));pt=ai>.85?1:ai}if(!w){const ri=Math.sqrt(ht*ht+nt*nt+St*St);let ai=(1<<We-Ue.zoom)*pe*pt;return ai*=it(Math.max(St,lt),ri),ri<ai}let ut=Number.MAX_VALUE,vt=0;const Et=Ue.aabb.getCorners(),Nt=[];for(const ri of Et){n.ab.vec3.sub(Nt,ri,Q),N||(v?Nt[2]*=X:Nt[2]=lt);const ai=n.ab.vec3.dot(Nt,this._camera.forward());ai<ut&&(ut=ai,vt=Math.abs(Nt[2]))}let $t=(1<<We-Ue.zoom)*pe*pt;if($t*=it(Math.max(vt,lt),ut),ut<$t)return!0;const fi=Ue.aabb.closestPoint(O);return fi[0]===O[0]&&fi[1]===O[1]};if(this.renderWorldCopies)for(let Ue=1;Ue<=3;Ue++)ke.push(Me(-Ue)),ke.push(Me(Ue));for(ke.push(Me(0));ke.length>0;){const Ue=ke.pop(),ht=Ue.x,nt=Ue.y;let St=Ue.fullyVisible;const pt=()=>this.projection.name==="globe"&&(Ue.y===0||Ue.y===(1<<Ue.zoom)-1);if(!St){let ut=ae?Ue.aabb.intersects(q):Ue.aabb.intersectsFlat(q);if(ut===0&&pt()){const vt=new n.bT(Ue.zoom,ht,nt);ut=n.bU(this,L,vt,!0).intersects(q)}if(ut===0)continue;St=ut===2}if(Ue.zoom!==We&&gt(Ue))for(let ut=0;ut<4;ut++){const vt=(ht<<1)+ut%2,Et=(nt<<1)+(ut>>1),Nt={aabb:w?Ue.aabb.quadrant(ut):n.bV(this,L,Ue.zoom+1,vt,Et,Ue.wrap,Ue.minZ,Ue.maxZ,this.projection),zoom:Ue.zoom+1,x:vt,y:Et,wrap:Ue.wrap,fullyVisible:St,tileID:void 0,shouldSplit:void 0,minZ:Ue.minZ,maxZ:Ue.maxZ};v&&!N&&(Nt.tileID=new n.aG(Ue.zoom+1===We?ct:Ue.zoom+1,Ue.wrap,Ue.zoom+1,vt,Et),$e(Nt)),ke.push(Nt)}else{const ut=Ue.zoom===We?ct:Ue.zoom;if(i.minzoom&&i.minzoom>ut)continue;let vt=0;if(!St){let fi=ae?Ue.aabb.intersectsPrecise(q):Ue.aabb.intersectsPreciseFlat(q);if(fi===0&&pt()){const ri=new n.bT(Ue.zoom,ht,nt);fi=n.bU(this,L,ri,!0).intersectsPrecise(q)}if(fi===0)continue;if(i.calculateQuadrantVisibility)if(q.containsPoint(Ue.aabb.center))vt=15;else for(let ri=0;ri<4;ri++)Ue.aabb.quadrant(ri).intersects(q)!==0&&(vt|=1<<ri)}const Et=O[0]-(.5+ht+(Ue.wrap<<Ue.zoom))*(1<<o-Ue.zoom),Nt=O[1]-.5-nt,$t=Ue.tileID?Ue.tileID:new n.aG(ut,Ue.wrap,Ue.zoom,ht,nt);i.calculateQuadrantVisibility&&($t.visibleQuadrants=vt),tt.push({tileID:$t,distanceSq:Et*Et+Nt*Nt})}}if(this.fogCullDistSq){const Ue=this.fogCullDistSq,ht=this.horizonLineFromTop();tt=tt.filter(nt=>{const St=[0,0,0,1],pt=[n.ag,n.ag,0,1],ut=this.calculateFogTileMatrix(nt.tileID.toUnwrapped());n.ab.vec4.transformMat4(St,St,ut),n.ab.vec4.transformMat4(pt,pt,ut);const vt=n.ab.vec4.min([],St,pt),Et=n.ab.vec4.max([],St,pt),Nt=n.bW(vt,Et);if(Nt===0)return!0;let $t=!1;const fi=this._elevation;if(fi&&Nt>Ue&&ht!==0){const ri=this.calculateProjMatrix(nt.tileID.toUnwrapped());let ai;i.isTerrainDEM||(ai=fi.getMinMaxForTile(nt.tileID)),ai||(ai={min:ge,max:we});const xi=n.c7(this.rotation),Bi=[xi[0]*n.ag,xi[1]*n.ag,ai.max];n.ab.vec3.transformMat4(Bi,Bi,ri),$t=(1-Bi[1])*this.height*.5<ht}return Nt<Ue||$t})}return tt.sort((Ue,ht)=>Ue.distanceSq-ht.distanceSq).map(Ue=>Ue.tileID)}resize(i,o){this.width=i,this.height=o,this.pixelsToGLUnits=[2/i,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const o=n.aw(i.lat,-n.bX,n.bX),d=this.projection.project(i.lng,o);return new n.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/n.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,o){let d,g;const v=this.centerPoint;if(this.projection.name==="globe"){const C=this.worldSize;d=(o.x-v.x)/C,g=(o.y-v.y)/C}else{const C=this.pointCoordinate(o),D=this.pointCoordinate(v);d=C.x-D.x,g=C.y-D.y}const w=this.locationCoordinate(i);this.setLocation(new n.aa(w.x-d,w.y-g))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,o){const d=o?n.bH(o,i.lat):void 0,g=this.projection.project(i.lng,i.lat);return new n.aa(g.x,g.y,d)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,o){const d=o??this._centerAltitude,g=[i.x,i.y,0,1],v=[i.x,i.y,1,1];n.ab.vec4.transformMat4(g,g,this.pixelMatrixInverse),n.ab.vec4.transformMat4(v,v,this.pixelMatrixInverse);const w=v[3];n.ab.vec4.scale(g,g,1/g[3]),n.ab.vec4.scale(v,v,1/w);const C=g[2],D=v[2];return{p0:g,p1:v,t:C===D?0:(d-C)/(D-C)}}screenPointToMercatorRay(i){const o=[i.x,i.y,0,1],d=[i.x,i.y,1,1];return n.ab.vec4.transformMat4(o,o,this.pixelMatrixInverse),n.ab.vec4.transformMat4(d,d,this.pixelMatrixInverse),n.ab.vec4.scale(o,o,1/o[3]),n.ab.vec4.scale(d,d,1/d[3]),o[2]=n.bH(o[2],this._center.lat)*this.worldSize,d[2]=n.bH(d[2],this._center.lat)*this.worldSize,n.ab.vec4.scale(o,o,1/this.worldSize),n.ab.vec4.scale(d,d,1/this.worldSize),new n.aq([o[0],o[1],o[2]],n.ab.vec3.normalize([],n.ab.vec3.sub([],d,o)))}rayIntersectionCoordinate(i){const{p0:o,p1:d,t:g}=i,v=n.bH(o[2],this._center.lat),w=n.bH(d[2],this._center.lat);return new n.aa(n.af(o[0],d[0],g)/this.worldSize,n.af(o[1],d[1],g)/this.worldSize,n.af(v,w,g))}pointCoordinate(i,o=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,o)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let o=this.projection.pointCoordinate3D(this,i.x,i.y);if(o)return new n.aa(o[0],o[1],o[2]);let d=0,g=this.horizonLineFromTop();if(i.y>g)return this.pointCoordinate(i);const v=.02*g,w=i.clone();for(let C=0;C<10&&g-d>v;C++){w.y=n.af(d,g,.66);const D=this.projection.pointCoordinate3D(this,w.x,w.y);D?(g=w.y,o=D):d=w.y}return o?new n.aa(o[0],o[1],o[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=n.bY)return!this.isPointAboveHorizon(i);const o=this.pointCoordinate(i);return o.y>=0&&o.y<=1}_coordinatePoint(i,o){const d=o&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,g=[i.x*this.worldSize,i.y*this.worldSize,d+i.toAltitude(),1];return n.ab.vec4.transformMat4(g,g,this.pixelMatrix),g[3]>0?new n.P(g[0]/g[3],g[1]/g[3]):new n.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:o}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,v=this.pointLocation3D(new n.P(o,i)),w=this.pointLocation3D(new n.P(g,i)),C=this.pointLocation3D(new n.P(g,d)),D=this.pointLocation3D(new n.P(o,d));let L=Math.min(v.lng,w.lng,C.lng,D.lng),O=Math.max(v.lng,w.lng,C.lng,D.lng),N=Math.min(v.lat,w.lat,C.lat,D.lat),B=Math.max(v.lat,w.lat,C.lat,D.lat);const q=Math.pow(2,-this.zoom)/16*270,J=this.projection.name==="globe"?1:4,X=(ee,Q,ae,pe,fe)=>{const we=(ee+ae)/2,ge=(Q+pe)/2,ve=new n.P(we,ge),{lng:_e,lat:Me}=this.pointLocation3D(ve),ke=Math.max(0,L-_e,N-Me,_e-O,Me-B);L=Math.min(L,_e),O=Math.max(O,_e),N=Math.min(N,Me),B=Math.max(B,Me),(fe<J||ke>q)&&(X(ee,Q,we,ge,fe+1),X(we,ge,ae,pe,fe+1))};if(X(o,i,g,i,1),X(g,i,g,d,1),X(g,d,o,d,1),X(o,d,o,i,1),this.projection.name==="globe"){const[ee,Q]=n.bZ(this);ee?(B=90,O=180,L=-180):Q&&(N=-90,O=180,L=-180)}return new n.az(new n.bO(L,N),new n.bO(O,B))}_getBoundsRectangular(i,o){const{top:d,left:g}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,C=new n.P(g,d),D=new n.P(w,d),L=new n.P(w,v),O=new n.P(g,v);let N=this.pointCoordinate(C,i),B=this.pointCoordinate(D,i);const q=this.pointCoordinate(L,o),J=this.pointCoordinate(O,o),X=(ee,Q)=>(Q.y-ee.y)/(Q.x-ee.x);return N.y>1&&B.y>=0?N=new n.aa((1-J.y)/X(J,N)+J.x,1):N.y<0&&B.y<=1&&(N=new n.aa(-J.y/X(J,N)+J.x,0)),B.y>1&&N.y>=0?B=new n.aa((1-q.y)/X(q,B)+q.x,1):B.y<0&&N.y<=1&&(B=new n.aa(-q.y/X(q,B)+q.x,0)),new n.az().extend(this.coordinateLocation(N)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(J)).extend(this.coordinateLocation(q))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const o=i.visibleDemTiles.reduce((d,g)=>{if(g.dem){const v=g.dem.tree;d.min=Math.min(d.min,v.minimums[0]),d.max=Math.max(d.max,v.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*i.exaggeration(),o.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-o*(1-this._horizonShift);return i?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-n.bX,this.maxLat=n.bX,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.at(this.minLng)*this.tileSize,this.worldMaxX=n.at(this.maxLng)*this.tileSize,this.worldMinY=n.aA(this.maxLat)*this.tileSize,this.worldMaxY=n.aA(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,o){return this.projection.createTileMatrix(this,o,i)}calculateDistanceTileData(i){const o=i.key,d=this._distanceTileDataCache;if(d[o])return d[o];const g=i.canonical,v=1/this.height,w=this.cameraWorldSize,C=w/this.zoomScale(g.z),D=(g.x+Math.pow(2,g.z)*i.wrap)*C,L=g.y*C,O=this.point;O.x*=w/this.worldSize,O.y*=w/this.worldSize;const N=this.angle,B=Math.sin(-N),q=-Math.cos(-N);return d[o]={bearing:[B,q],center:[(O.x-D)*v,(O.y-L)*v],scale:C/n.ag*v},d[o]}calculateFogTileMatrix(i){const o=i.key,d=this._fogTileMatrixCache;if(d[o])return d[o];const g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return n.ab.mat4.multiply(g,this.worldToFogMatrix,g),d[o]=new Float32Array(g),d[o]}calculateProjMatrix(i,o=!1,d=!1){const g=i.key;let v;if(v=d?this._expandedProjMatrixCache:o?this._alignedProjMatrixCache:this._projMatrixCache,v[g])return v[g];const w=this.calculatePosMatrix(i,this.worldSize);let C;return C=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:o?this.alignedProjMatrix:this.projMatrix,n.ab.mat4.multiply(w,C,w),v[g]=new Float32Array(w),v[g]}calculatePixelsToTileUnitsMatrix(i){const o=i.tileID.key,d=this._pixelsToTileUnitsCache;if(d[o])return d[o];const g=n.b_(i,this);return d[o]=g,d[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const i=1/this.worldSize,o=n.ab.mat4.fromScaling([],[i,i,i]);return n.ab.mat4.multiply(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const o=n.bH(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(o),g=this._camera.forward(),v=n.bH(1,this._center.lat);d[2]/=v,g[2]/=v,n.ab.vec3.normalize(g,g);const w=i.raycast(d,g,i.exaggeration());if(w){const C=n.ab.vec3.scaleAndAdd([],d,g,w),D=new n.aa(C[0],C[1],n.bH(C[2],n.aS(C[1]))),L=(D.z+n.ab.vec3.length([D.x-d[0],D.y-d[1],D.z-d[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=D.toAltitude(),this._center=this.coordinateLocation(D),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const o=this._elevation,d=n.bH(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(d),v=o.getAtPointOrZero(new n.aa(...g)),w=this.pixelsPerMeter/this.worldSize*v,C=this._minimumHeightOverTerrain(),D=g[2]-w;if(D<=C)if(D<0||i){const L=this.locationCoordinate(this._center,this._centerAltitude),O=[g[0],g[1],L.z-g[2]],N=n.ab.vec3.length(O);O[2]-=(C-D)/this._pixelsPerMercatorPixel;const B=n.ab.vec3.length(O);if(B===0)return;n.ab.vec3.scale(O,O,N/B*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],L.z*this._pixelsPerMercatorPixel-O[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const B=this.center;return B.lat=n.aw(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(B.lng=n.aw(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const o=this._unmodified,{x:d,y:g}=this.point;let v=0,w=d,C=g;const D=this.width/2,L=this.height/2,O=this.worldMinY*this.scale,N=this.worldMaxY*this.scale;if(g-L<O&&(C=O+L),g+L>N&&(C=N-L),N-O<this.height&&(v=Math.max(v,this.height/(N-O)),C=(N+O)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,q=this.worldMaxX*this.scale,J=this.worldSize/2-(B+q)/2;w=(d+J+this.worldSize)%this.worldSize-J,w-D<B&&(w=B+D),w+D>q&&(w=q-D),q-B<this.width&&(v=Math.max(v,this.width/(q-B)),w=(q+B)/2)}w===d&&C===g||(this.center=this.unproject(new n.P(w,C))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,o=this.projection.name==="globe",d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=n.bH(1,this.center.lat)/n.bH(1,n.c8));const g=n.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this.projection.zAxisUnit==="meters"?d:1,w=this._camera.getWorldToCamera(this.worldSize,v);let C;const D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(D[8]=2*-i.x/this.width,D[9]=2*i.y/this.height,this.isOrthographic){let Me=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ke=Me*this.aspect,tt=-ke,We=-Me;ke-=i.x,tt-=i.x,Me+=i.y,We+=i.y,C=this._camera.getCameraToClipOrthographic(tt,ke,We,Me,this._nearZ,this._farZ),((ct,lt,$e,it)=>{for(let gt=0;gt<16;gt++)ct[gt]=im(lt[gt],$e[gt],it)})(C,C,D,$d(this.pitch>=15?1:this.pitch/15))}else C=D;const L=n.ab.mat4.mul([],D,w);let O=n.ab.mat4.mul([],C,w);if(this.projection.isReprojectedInTileSpace){const Me=this.locationCoordinate(this.center),ke=n.ab.mat4.identity([]);n.ab.mat4.translate(ke,ke,[Me.x*this.worldSize,Me.y*this.worldSize,0]),n.ab.mat4.multiply(ke,ke,n.c0(this)),n.ab.mat4.translate(ke,ke,[-Me.x*this.worldSize,-Me.y*this.worldSize,0]),n.ab.mat4.multiply(O,O,ke),n.ab.mat4.multiply(L,L,ke),this.inverseAdjustmentMatrix=n.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=n.ab.mat4.scale([],O,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=O,this.invProjMatrix=n.ab.mat4.invert(new Float64Array(16),this.projMatrix),o){const Me=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Me[8]=2*-i.x/this.width,Me[9]=2*i.y/this.height,this.expandedFarZProjMatrix=n.ab.mat4.mul([],Me,w)}else this.expandedFarZProjMatrix=this.projMatrix;const N=n.ab.mat4.invert([],C);this.frustumCorners=n.c2.fromInvProjectionMatrix(N,this.horizonLineFromTop(),this.height),this.cameraFrustum=n.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!o);const B=new Float32Array(16);n.ab.mat4.identity(B),n.ab.mat4.scale(B,B,[1,-1,1]),n.ab.mat4.rotateX(B,B,this._pitch),n.ab.mat4.rotateZ(B,B,this.angle);const q=n.ab.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=n.ab.mat4.clone(q);const J=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;q[8]=2*-i.x/this.width,q[9]=2*(i.y+J)/this.height,this.skyboxMatrix=n.ab.mat4.multiply(B,q,B);const X=this.point,ee=X.x,Q=X.y,ae=this.width%2/2,pe=this.height%2/2,fe=Math.cos(this.angle),we=Math.sin(this.angle),ge=ee-Math.round(ee)+fe*ae+we*pe,ve=Q-Math.round(Q)+fe*pe+we*ae,_e=new Float64Array(O);if(n.ab.mat4.translate(_e,_e,[ge>.5?ge-1:ge,ve>.5?ve-1:ve,0]),this.alignedProjMatrix=_e,O=n.ab.mat4.create(),n.ab.mat4.scale(O,O,[this.width/2,-this.height/2,1]),n.ab.mat4.translate(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=n.ab.mat4.create(),n.ab.mat4.scale(O,O,[1,-1,1]),n.ab.mat4.translate(O,O,[-1,-1,0]),n.ab.mat4.scale(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O,this.pixelMatrix=n.ab.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,L),this._calcFogMatrices(),this._distanceTileDataCache={},O=n.ab.mat4.invert(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=O,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=n.c3(this);const Me=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=n.ab.vec3.transformMat4(Me,Me,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=O;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,d=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,v=[i,i,o];n.ab.vec3.scale(v,v,g),n.ab.vec3.scale(d,d,-1),n.ab.vec3.multiply(d,d,v);const w=n.ab.mat4.create();n.ab.mat4.translate(w,w,d),n.ab.mat4.scale(w,w,v),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,o,g)}_computeCameraPosition(i){const o=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),g=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-i/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-d[0]*v,g.y/this.worldSize-d[1]*v,i/this.worldSize*this._centerAltitude-d[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],g=i[2];let v=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(v=Math.min((o-d)/g,1)),this._camera.position=n.ab.vec3.scaleAndAdd([],this._camera.position,i,v),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,o=this._camera.forward(),{pitch:d,bearing:g}=this._camera.getPitchBearing(),v=n.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.ai(this._maxPitch)),C=Math.max((i[2]-v)/Math.cos(d),w),D=this._zoomFromMercatorZ(C);n.ab.vec3.scaleAndAdd(i,i,o,C),this._pitch=n.aw(d,n.ai(this.minPitch),n.ai(this.maxPitch)),this.angle=n.bF(g,-Math.PI,Math.PI),this._setZoom(n.aw(D,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n.aa(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let o=0,d=n.bY,g=0,v=1/0;for(;d-o>1e-6&&d>o;){const w=o+.5*(d-o),C=this.tileSize*Math.pow(2,w),D=this.getCameraToCenterDistance(this.projection,w,C),L=this.scaleZoom(D/(i*this.tileSize)),O=Math.abs(w-L);O<v&&(v=O,g=w),w<L?o=w:d=w}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,o){const d=Math.min(i.x,o.x),g=Math.max(i.x,o.x),v=Math.min(i.y,o.y),w=Math.max(i.y,o.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new n.P(d,v),new n.P(g,w),new n.P(d,w),new n.P(g,v)],D=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const O of C){const N=this.pointRayIntersection(O);if(N.t<0)return!0;const B=this.rayIntersectionCoordinate(N);if(B.x<D||B.y<0||B.x>L||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.P(0,0),new n.P(this.width,this.height))}zoomDeltaToMovement(i,o){const d=n.ab.vec3.length(n.ab.vec3.sub([],this._camera.position,i)),g=this._zoomFromMercatorZ(d)+o;return d-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){const i=function([o,d,g],v){const w=[o,d,g,1];n.ab.vec4.transformMat4(w,w,v);const C=w[3]=Math.max(w[3],1e-6);return w[0]/=C,w[1]/=C,w[2]/=C,w}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new n.P(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.P(0,i))}}getCameraToCenterDistance(i,o=this.zoom,d=this.worldSize){const g=n.b$(i,o,this.width,this.height,1024),v=i.pixelSpaceConversion(this.center.lat,d,g);let w=.5/Math.tan(.5*this._fov)*this.height*v;return this.isOrthographic&&(w=im(1,w,$d(this.pitch>=15?1:this.pitch/15))),w}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&n.ab.mat4.multiply(i,i,this.globeMatrix),i}getFrustum(i){return n.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,this.projection.zAxisUnit==="meters")}}const il=(h,i)=>{if(i>0&&h.terrain&&n.w("Cutoff is currently disabled on terrain"),i<=0||h.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const o=h.transform,d=Math.max(Math.abs(o._zoom-(h.minCutoffZoom-1)),1),g=o.isLODDisabled(!1)?n.ac(60,45,o.pitch):n.ac(30,15,o.pitch),v=o._farZ-o._nearZ,w=i*o.height,C=((1-(D=g))*o.cameraToCenterDistance+D*(o._farZ+w))*d;var D;return{shouldRenderCutoff:g<1,uniformValues:{u_cutoff_params:[o._nearZ,o._farZ,(C-o._nearZ)/v,(C-w-o._nearZ)/v]}}},Lr={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class za{constructor(i,o){this.aabb=i,this.lastCascade=o}}class nm{add(i,o){const d=this.receivers[i.key];d!==void 0?(d.aabb.min[0]=Math.min(d.aabb.min[0],o.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],o.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],o.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],o.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],o.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],o.max[2])):this.receivers[i.key]=new za(o,null)}clear(){this.receivers={}}get(i){return this.receivers[i.key]}computeRequiredCascades(i,o,d){const g=n.cd.fromPoints(i.points);let v=0;for(const w in this.receivers){const C=this.receivers[w];if(!C||!g.intersectsAabb(C.aabb))continue;C.aabb.min=g.closestPoint(C.aabb.min),C.aabb.max=g.closestPoint(C.aabb.max);const D=C.aabb.getCorners();for(let L=0;L<d.length;L++){let O=!0;for(const N of D){const B=[N[0]*o,N[1]*o,N[2]];if(n.ab.vec3.transformMat4(B,B,d[L].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){O=!1;break}}if(C.lastCascade=L,v=Math.max(v,L),O)break}}return v+1}}class Ll{constructor(i){this.painter=i,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new nm,this._depthMode=new oi(i.context.gl.LEQUAL,oi.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,i.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),i.tp.registerParameter(Lr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),i.tp.registerParameter(Lr,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),i.tp.registerParameter(Lr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),i.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const i of this._cascades)i.texture.destroy(),i.framebuffer.destroy();this._cascades=[]}updateShadowParameters(i,o){const d=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!o||!o.properties)return;const g=o.properties.get("shadow-intensity");if(!o.shadowsEnabled()||g<=0||(this._shadowLayerCount=d.style.order.reduce((J,X)=>{const ee=d.style._mergedLayers[X];return J+(ee.hasShadowPass()&&!ee.isHidden(i.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const v=d.context,w=Lr.shadowMapResolution,C=Lr.shadowMapResolution;if(this._cascades.length===0||Lr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let J=0;J<Lr.cascadeCount;++J){const X=d._shadowMapDebug,ee=v.gl,Q=v.createFramebuffer(w,C,X,"texture"),ae=new n.T(v,{width:w,height:C,data:null},ee.DEPTH_COMPONENT16);if(Q.depthAttachment.set(ae.texture),X){const pe=new n.T(v,{width:w,height:C,data:null},ee.RGBA8);Q.colorAttachment.set(pe.texture)}this._cascades.push({framebuffer:Q,texture:ae,matrix:[],far:0,boundingSphereRadius:0,frustum:new n.bR,scale:0})}}this.shadowDirection=zl(o);let D=0;if(i.elevation){const J=i.elevation,X=[1e4,-1e4];J.visibleDemTiles.filter(ee=>ee.dem).forEach(ee=>{const Q=ee.dem.tree;X[0]=Math.min(X[0],Q.minimums[0]),X[1]=Math.max(X[1],Q.maximums[0])}),X[0]!==1e4&&(D=(X[1]-X[0])*J.exaggeration())}const L=1.5*i.cameraToCenterDistance,O=3*L,N=new Float64Array(16);for(let J=0;J<this._cascades.length;++J){const X=this._cascades[J];let ee=i.height/50,Q=1;Lr.cascadeCount===1?Q=O:J===0?Q=L:(ee=L,Q=O);const[ae,pe]=Q1(i,this.shadowDirection,ee,Q,Lr.shadowMapResolution,D);X.scale=i.scale,X.matrix=ae,X.boundingSphereRadius=pe,n.ab.mat4.invert(N,X.matrix),X.frustum=n.bR.fromInvProjectionMatrix(N,1,0,!0),X.far=Q}const B=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[B].far,this._cascades[B].far],this._uniformValues.u_shadow_intensity=g,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Lr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Lr.shadowMapResolution,this._uniformValues.u_shadowmap_0=Hr.ShadowMap0,this._uniformValues.u_shadowmap_1=Hr.ShadowMap0+1,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const q=d.transform.elevation;for(const J of this._groundShadowTiles){let X={min:0,max:0};if(q){const ee=q.getMinMaxForTile(J);ee&&(X=ee)}this.addShadowReceiver(J.toUnwrapped(),X.min,X.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(i){this._enabled=i}drawShadowPass(i,o){if(!this.enabled)return;const d=this.painter,g=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),g.viewport.set([0,0,Lr.shadowMapResolution,Lr.shadowMapResolution]);for(let v=0;v<this._numCascadesToRender;++v){d.currentShadowCascade=v,g.bindFramebuffer.set(this._cascades[v].framebuffer.framebuffer),g.clear({color:n.aj.white,depth:1});for(const w of i.order){const C=i._mergedLayers[w];if(!C.hasShadowPass()||C.isHidden(d.transform.zoom))continue;const D=i.getLayerSourceCache(C),L=D?o[D.id]:void 0;(C.type==="model"||L&&L.length)&&d.renderLayer(d,D,C,L)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const i=this.painter,o=i.style,d=i.context,g=o.directionalLight,v=o.ambientLight;if(!g||!v)return;const w=[],C=il(i,i.longestCutoffRange);C.shouldRenderCutoff&&w.push("RENDER_CUTOFF"),w.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&w.push("NORMAL_OFFSET");const D=rm(o,g,v),L=new oi(d.gl.LEQUAL,oi.ReadOnly,i.depthRangeFor3D);for(const O of this._groundShadowTiles){const N=O.toUnwrapped(),B=i.isTileAffectedByFog(O),q=i.getOrCreateProgram("groundShadow",{defines:w,overrideFog:B});this.setupShadows(N,q),i.uploadCommonUniforms(d,q,N,null,C);const J={u_matrix:i.transform.calculateProjMatrix(N),u_ground_shadow_factor:D};q.draw(i,d.gl.TRIANGLES,L,pi.disabled,Pi.multiply,gi.disabled,J,"ground_shadow",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments,{},i.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Pi.unblended:Pi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(i){const o=this.painter.transform,d=o.calculatePosMatrix(i,o.worldSize);return n.ab.mat4.multiply(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(i){return n.ab.mat4.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}setupShadows(i,o,d,g=0){if(!this.enabled)return;const v=this.painter.transform,w=this.painter.context,C=w.gl,D=this._uniformValues,L=new Float64Array(16),O=v.calculatePosMatrix(i,v.worldSize);for(let N=0;N<this._cascades.length;N++)n.ab.mat4.multiply(L,this._cascades[N].matrix,O),D[N===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(L),w.activeTexture.set(C.TEXTURE0+Hr.ShadowMap0+N),this._cascades[N].texture.bind(C.NEAREST,C.CLAMP_TO_EDGE);if(this.useNormalOffset=!!d,this.useNormalOffset){const N=n.cc(i.canonical),B=2/v.tileSize*n.ag/Lr.shadowMapResolution,q=B*this._cascades[0].boundingSphereRadius,J=B*this._cascades[this._cascades.length-1].boundingSphereRadius,X=(d==="vector-tile"?1:3)/Math.pow(2,g-i.canonical.z-(1-v.zoom+Math.floor(v.zoom)));D.u_shadow_normal_offset=[N,q*X,J*X],D.u_shadow_bias=[6e-5,.0012,.012]}else D.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(w,D)}setupShadowsFromMatrix(i,o,d=!1){if(!this.enabled)return;const g=this.painter.context,v=g.gl,w=this._uniformValues,C=new Float64Array(16);for(let D=0;D<Lr.cascadeCount;D++)n.ab.mat4.multiply(C,this._cascades[D].matrix,i),w[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),g.activeTexture.set(v.TEXTURE0+Hr.ShadowMap0+D),this._cascades[D].texture.bind(v.NEAREST,v.CLAMP_TO_EDGE);if(this.useNormalOffset=d,d){const D=Lr.normalOffset;w.u_shadow_normal_offset=[1,D,D],w.u_shadow_bias=[6e-5,.0012,.012]}else w.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(g,w)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(i,o,d,g){if(g[2]>=0)return{};const v=function(D,L,O){const N=O/(1<<D.canonical.z);return new n.cd([D.canonical.x*N+D.wrap*O,D.canonical.y*N+D.wrap*O,0],[(D.canonical.x+1)*N+D.wrap*O,(D.canonical.y+1)*N+D.wrap*O,L])}(i,o,d).getCorners(),w=o/-g[2];g[0]<0?(n.ab.vec3.add(v[0],v[0],[g[0]*w,0,0]),n.ab.vec3.add(v[3],v[3],[g[0]*w,0,0])):g[0]>0&&(n.ab.vec3.add(v[1],v[1],[g[0]*w,0,0]),n.ab.vec3.add(v[2],v[2],[g[0]*w,0,0])),g[1]<0?(n.ab.vec3.add(v[0],v[0],[0,g[1]*w,0]),n.ab.vec3.add(v[1],v[1],[0,g[1]*w,0])):g[1]>0&&(n.ab.vec3.add(v[2],v[2],[0,g[1]*w,0]),n.ab.vec3.add(v[3],v[3],[0,g[1]*w,0]));const C={};return C.vertices=v,C.planes=[Ol(v[1],v[0],v[4]),Ol(v[2],v[1],v[5]),Ol(v[3],v[2],v[6]),Ol(v[0],v[3],v[7])],C}addShadowReceiver(i,o,d){this._receivers.add(i,n.cd.fromTileIdAndHeight(i,o,d))}getMaxCascadeForTile(i){const o=this._receivers.get(i);return o&&o.lastCascade?o.lastCascade:0}}function Ol(h,i,o){const d=n.ab.vec3.sub([],o,i),g=n.ab.vec3.sub([],h,i),v=n.ab.vec3.cross([],d,g),w=n.ab.vec3.length(v);return w===0?[0,0,1,0]:(n.ab.vec3.scale(v,v,1/w),[v[0],v[1],v[2],-n.ab.vec3.dot(v,i)])}function zl(h){const i=h.properties.get("direction"),o=n.cb(i.x,i.y,i.z);o[2]=n.aw(o[2],0,75);const d=n.ce([o[0],o[1],o[2]]);return n.ab.vec3.fromValues(d.x,d.y,d.z)}function rm(h,i,o){const d=i.properties.get("color-use-theme")==="none",g=i.properties.get("color"),v=i.properties.get("intensity"),w=i.properties.get("direction"),C=[w.x,w.y,w.z],D=o.properties.get("color-use-theme")==="none",L=o.properties.get("color"),O=o.properties.get("intensity"),N=Math.max(n.ab.vec3.dot([0,0,1],C),0),B=[0,0,0];n.ab.vec3.scale(B,L.toRenderColor(D?null:h.getLut(i.scope)).toArray01Linear().slice(0,3),O);const q=[0,0,0];return n.ab.vec3.scale(q,g.toRenderColor(d?null:h.getLut(o.scope)).toArray01Linear().slice(0,3),N*v),n.cf([B[0]>0?B[0]/(B[0]+q[0]):0,B[1]>0?B[1]/(B[1]+q[1]):0,B[2]>0?B[2]/(B[2]+q[2]):0])}function Q1(h,i,o,d,g,v){const w=h.zoom,C=h.scale,D=h.worldSize,L=1/D,O=h.aspect,N=Math.sqrt(1+O*O)*Math.tan(.5*h.fovX),B=N*N,q=d-o,J=d+o;let X,ee;B>q/J?(X=d,ee=d*N):(X=.5*J*(1+B),ee=.5*Math.sqrt(q*q+2*(d*d+o*o)*B+J*J*B*B));const Q=h.projection.pixelsPerMeter(h.center.lat,D),ae=h._camera.getCameraToWorldMercator(),pe=[0,0,-X*L];n.ab.vec3.transformMat4(pe,pe,ae);let fe=ee*L;const we=h._edgeInsets;if(!(we.left===0&&we.top===0&&we.right===0&&we.bottom===0||we.left===we.right&&we.top===we.bottom)){const St=h._camera.getWorldToCamera(h.worldSize,h.projection.zAxisUnit==="meters"?Q:1),pt=h._camera.getCameraToClipPerspective(h._fov,h.width/h.height,o,d);pt[8]=2*-h.centerOffset.x/h.width,pt[9]=2*h.centerOffset.y/h.height;const ut=new Float64Array(16);n.ab.mat4.mul(ut,pt,St);const vt=new Float64Array(16);n.ab.mat4.invert(vt,ut);const Et=n.bR.fromInvProjectionMatrix(vt,D,w,!0);for(const Nt of Et.points){const $t=((ge=Nt)[0]/=C,ge[1]/=C,ge[2]=n.bH(ge[2],h._center.lat),ge);fe=Math.max(fe,n.ab.vec3.len(n.ab.vec3.subtract([],pe,$t)))}}var ge;fe*=g/(g-1);const ve=Math.acos(i[2]),_e=Math.atan2(-i[0],-i[1]),Me=new xs;Me.position=pe,Me.setPitchBearing(ve,_e);const ke=Me.getWorldToCamera(D,Q),tt=fe*D,We=Math.min(h._mercatorZfromZoom(17)*D*-2,-2*tt),ct=Me.getCameraToClipOrthographic(-tt,tt,-tt,tt,We,(tt+v*Q)/i[2]),lt=new Float64Array(16);n.ab.mat4.multiply(lt,ct,ke);const $e=n.ab.vec3.fromValues(Math.floor(1e6*pe[0])/1e6*D,Math.floor(1e6*pe[1])/1e6*D,0),it=.5*g,gt=[0,0,0];n.ab.vec3.transformMat4(gt,$e,lt),n.ab.vec3.scale(gt,gt,it);const Ue=[Math.floor(gt[0]),Math.floor(gt[1]),Math.floor(gt[2])],ht=[0,0,0];n.ab.vec3.sub(ht,gt,Ue),n.ab.vec3.scale(ht,ht,-1/it);const nt=new Float64Array(16);return n.ab.mat4.identity(nt),n.ab.mat4.translate(nt,nt,ht),n.ab.mat4.multiply(lt,nt,lt),[lt,tt]}class sm extends n.E{constructor(i){super(),this.requestManager=i,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(i,o){return n.aM(this.requestManager.transformRequest(o,n.R.Model).url).then(d=>{if(!d)return;const g=n.aN(d),v=new n.aO(i,void 0,void 0,g);return v.computeBoundsAndApplyParent(),v}).catch(d=>{if(d&&d.status===404)return null;this.fire(new n.y(new Error(`Could not load model ${i} from ${o}: ${d.message}`)))})}load(i,o,d={keepNumReferences:!1}){this.models[o]||(this.models[o]={});const g=Object.keys(i);this.numModelsLoading[o]=(this.numModelsLoading[o]||0)+g.length;const v=[];for(const w of g)v.push(this.loadModel(w,i[w]));Promise.allSettled(v).then(w=>{for(let C=0;C<w.length;C++){const{status:D,value:L}=w[C];if(D==="fulfilled"&&L){const O=this.models[o][g[C]];this.models[o][g[C]]={model:L,numReferences:d.keepNumReferences&&O?O.numReferences:1}}}this.numModelsLoading[o]-=g.length,this.fire(new n.z("data",{dataType:"style"}))}).catch(w=>{this.fire(new n.y(new Error(`Could not load models: ${w.message}`)))})}isLoaded(){for(const i in this.numModelsLoading)if(this.numModelsLoading[i]>0)return!1;return!0}hasModel(i,o){return!!this.getModel(i,o)}getModel(i,o){return this.models[o]||(this.models[o]={}),this.models[o][i]?this.models[o][i].model:void 0}addModel(i,o,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={}),this.hasModel(i,d)&&this.models[d][i].numReferences++,this.modelUris[d][i]=this.requestManager.normalizeModelURL(o),this.load({[i]:this.modelUris[d][i]},d)}addModels(i,o){this.models[o]||(this.models[o]={}),this.modelUris[o]||(this.modelUris[o]={});const d=this.modelUris[o];for(const g in i)this.models[o][g]={},d[g]=this.requestManager.normalizeModelURL(i[g]);this.load(d,o,{keepNumReferences:!0})}reloadModels(i){this.load(this.modelUris[i],i)}addModelsFromBucket(i,o){this.models[o]||(this.models[o]={}),this.modelUris[o]||(this.modelUris[o]={});const d={};for(const g of i)this.hasModel(g,o)?this.models[o][g].numReferences++:(this.modelUris[o][g]=this.requestManager.normalizeModelURL(g),d[g]=this.modelUris[o][g]);this.load(d,o)}removeModel(i,o){if(this.models[o]&&this.models[o][i]&&(this.models[o][i].numReferences--,this.models[o][i].numReferences===0)){const d=this.models[o][i].model;delete this.models[o][i],delete this.modelUris[o][i],d.destroy()}}listModels(i){return this.models[i]||(this.models[i]={}),Object.keys(this.models[i])}upload(i,o){this.models[o]||(this.models[o]={});for(const d in this.models[o])this.models[o][d].model&&this.models[o][d].model.upload(i.context)}}const ex=new n.a5({data:new n.a6(n.a3.colorTheme.data)}),ty={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function om(h){return h=h||{},Object.assign(h,ty)}class am extends n.E{constructor(i){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},n.aP(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=i,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(i=>{i.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new n.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=i.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=i.stylesheet.indoor.buildingFeaturesetId,this._scope=i.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:i=>(i.feature&&i.feature.properties.floorplan&&this.selectFloorplan(i.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(i){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(w,C){const[D,L]=w,{center:O,radius:N}=C,[B,q]=O,J=Math.abs(D-B);return Math.sqrt((J>180?360-J:J)**2+(L-q)**2)<=N}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new n.z("floorplangone")));const o={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},d=new n.P(this._map.transform.width/2,this._map.transform.height/2),g=[new n.P(0,0),new n.P(this._map.transform.width,this._map.transform.height)],v=this._map.queryRenderedFeatures(i?g:d,o);v.length>0&&(this._selectedFloorplan&&v[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=v[0],this._floorplanSelected(!1)))}_floorplanSelected(i){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(v){const[[w,C],[D,L]]=v,O=(D-w+360)%360,N=O>180?360-O:O;return{center:[(w+N/2+360)%360,(C+L)/2],radius:Math.sqrt(N**2+(L-C)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const o=this._floorplanStates[this._indoorData.id].selectedBuilding,d=this._floorplanStates[this._indoorData.id].selectedLevel;let g;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const v of this._indoorData.levels)v.id===this._selectedLevel.id&&(g=v.id);if(this.fire(new n.z("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:g})),o){const v=this._indoorData.buildings.find(w=>w.id===o);this._buildingSelected(v,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(d){const v=this._indoorData.levels.find(w=>w.id===d);this._updateLevels(v,i)}else i&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(i,o){o&&i&&i.extent&&this._map.fitBounds(i.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=i?i.id:void 0;const d=this._indoorData.levels.filter(g=>i.levels.includes(g.id));this.fire(new n.z("buildingselected",{buildingId:i.id,levels:d}))}_levelSelected(i){if(i==="overview")this._updateLevels(void 0,!0);else{const o=this._indoorData.levels.find(d=>d.id===i);this._updateLevels(o,!0)}this.fire(new n.z("levelselected",{levelId:i==="overview"?void 0:i}))}_updateLevels(i,o){if(!i)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(o&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function d(L){const O=L.indexOf("/floor/");if(O===-1)return L;const N=O+7,B=L.indexOf("/",N);return B===-1?L.slice(N):L.slice(N,B)}this._selectedLevel=i,this._floorplanStates[this._indoorData.id].selectedLevel=i?i.id:void 0;const g=[],v={},w={},C={},D={};for(const L of this._indoorData.levels)if(g.push(L.id),v[L.id]=L.height,w[L.id]=L.base,i){if(this.mergeFloors){const O=d(i.id),N=d(L.id);C[L.id]=N===O?"true":"false"}else C[L.id]=L.id===i.id?"true":"false";D[L.id]=L.base<i.base?"true":"false"}else D[L.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",g]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",v]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",w]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",C]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",D]),i&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!i.isUnderground),o&&i.extent)){const L=this._map.cameraForBounds(i.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),O=this._map.getZoom(),N=L.zoom?Math.abs(O-L.zoom):0;this._map.fitBounds(i.extent,N>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:O})}}selectFloorplan(i){const o={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},d=[new n.P(0,0),new n.P(this._map.transform.width,this._map.transform.height)],g=this._map.queryRenderedFeatures(d,o);if(g.length>0){for(const v of g)if(JSON.parse(v.properties["indoor-data"]).floorplanIDs.includes(i)){this._selectedFloorplan=v,this._floorplanSelected(!0);break}}}selectBuilding(i){const o=this._indoorData.buildings.find(d=>d.id===i);this._buildingSelected(o,!0)}selectLevel(i){this._levelSelected(i)}}function tx(h){if(!h.metadata||!h.metadata.content_area)return;const i=n.q.devicePixelRatio,{left:o,top:d,width:g,height:v}=h.metadata.content_area,w=o*i,C=d*i;return[w,C,w+g*i,C+v*i]}function iy(h){if(h)return h.map(([i,o])=>[i*n.q.devicePixelRatio,o*n.q.devicePixelRatio])}const kl=(h,i)=>Ko(h,i&&i.filter(o=>o.identifier!=="source.canvas")),ix=n.ay(Ri,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),ny=n.ay(Ri,["setCenter","setZoom","setBearing","setPitch"]),lm=new Set(["background","sky","slot","custom"]),Ju={version:8,layers:[],sources:{}},ry={duration:300,delay:0};class lo extends n.E{constructor(i,o={}){super(),this.map=i,this.scope=o.scope||"",this.globalId=null,this.fragments=[],this.importDepth=o.importDepth||0,this.importsCache=o.importsCache||new Map,this.resolvedImports=o.resolvedImports||new Set,this.transition=n.l({},ry),this._buildingIndex=new Qg(this),this.crossTileSymbolIndex=new em,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=o.styleChanges||new Ze,this.dispatcher=o.dispatcher?o.dispatcher:new n.D(n.ci(),this),o.imageManager?this.imageManager=o.imageManager:(this.imageManager=new bt(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=o.glyphManager?o.glyphManager:new n.cj(i._requestManager,o.localFontFamily?n.ck.all:o.localIdeographFontFamily?n.ck.ideographs:n.ck.none,o.localFontFamily||o.localIdeographFontFamily),o.modelManager?this.modelManager=o.modelManager:(this.modelManager=new sm(i._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=o.configOptions?o.configOptions:new Map,this._configDependentLayers=o.configDependentLayers?o.configDependentLayers:new Set,this._config=o.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:o.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=o.initialConfig,this.dispatcher.broadcast("setReferrer",n.cl());const d=this;this._rtlTextPluginCallback=lo.registerForPluginStateChange(g=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(v,w)=>{if(n.cm(v),w&&w.every(C=>C))for(const C in d._sourceCaches){const D=d._sourceCaches[C],L=D.getSource().type;L!=="vector"&&L!=="geojson"||D.reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const v=this.getOwnSource(g.sourceId);if(v&&v.vectorLayerIds)for(const w in this._layers){const C=this._layers[w];C.source===v.id&&this._validateLayer(C)}})}load(i){return i?(typeof i=="string"?this.loadURL(i):this.loadJSON(i),this):this}_getGlobalId(i){if(!i)return null;if(typeof i=="string"){if(n.f(i))return i;const o=n.cn(i);if(!o.startsWith("http"))try{return new URL(o,location.href).toString()}catch{return o}return o}return`json://${n.co(JSON.stringify(i))}`}_diffStyle(i,o,d){this.globalId=this._getGlobalId(i);const g=(v,w)=>{try{w(null,this.setState(v,d))}catch(C){w(C,!1)}};if(typeof i=="string"){const v=this.map._requestManager.normalizeStyleURL(i),w=this.map._requestManager.transformRequest(v,n.R.Style);n.n(w,(C,D)=>{C?this.fire(new n.y(C)):D&&g(D,o)})}else typeof i=="object"&&g(i,o)}loadURL(i,o={}){this.fire(new n.z("dataloading",{dataType:"style"}));const d=typeof o.validate=="boolean"?o.validate:!n.f(i);this.globalId=this._getGlobalId(i),i=this.map._requestManager.normalizeStyleURL(i,o.accessToken),this.resolvedImports.add(i);const g=this.importsCache.get(i);if(g)return this._load(g,d);const v=this.map._requestManager.transformRequest(i,n.R.Style);this._request=n.n(v,(w,C)=>{if(this._request=null,w)this.fire(new n.y(w));else if(C)return this.importsCache.set(i,C),this._load(C,d)})}loadJSON(i,o={}){this.fire(new n.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(i),this._request=n.q.frame(()=>{this._request=null,this._load(i,o.validate!==!1)})}loadEmpty(){this.fire(new n.z("dataloading",{dataType:"style"})),this._load(Ju,!1)}_loadImports(i,o,d){if(this.importDepth>=4)return n.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const g=[];for(const v of i){const w=this._createFragmentStyle(v),C=new Promise(O=>{w.once("style.import.load",O),w.once("error",O)}).then(()=>this.mergeAll());if(g.push(C),this.resolvedImports.has(v.url)){w.loadEmpty();continue}const D=v.data||this.importsCache.get(v.url);D?(w.loadJSON(D,{validate:o}),this._isInternalStyle(D)&&(w.globalId=null)):v.url?w.loadURL(v.url,{validate:o}):w.loadEmpty();const L={style:w,id:v.id,config:v.config};if(d){const O=this.fragments.findIndex(({id:N})=>N===d);this.fragments=this.fragments.slice(0,O).concat(L).concat(this.fragments.slice(O))}else this.fragments.push(L)}return Promise.allSettled(g)}getImportGlobalIds(i=this,o=new Set){for(const d of i.fragments)d.style.globalId&&o.add(d.style.globalId),this.getImportGlobalIds(d.style,o);return[...o.values()]}_createFragmentStyle(i){const o=this.scope?n.aC(i.id,this.scope):i.id;let d;const g=this._initialConfig&&this._initialConfig[o];(i.config||g)&&(d=n.l({},i.config,g));const v=new lo(this.map,{scope:o,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:d,configOptions:this.options,colorThemeOverride:i["color-theme"],configDependentLayers:this._configDependentLayers});return v.setEventedParent(this.map,{style:v}),v}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(i){return this.isRootStyle()&&(i.fragment||!!i.schema&&i.fragment!==!1)}_load(i,o){const d=i.indoor?om(i.schema):i.schema;if(this._isInternalStyle(i)){const w=n.l({},Ju,{imports:[{id:"basemap",data:i,url:""}]});return void this._load(w,o)}if(this.updateConfig(this._config,d),o&&kl(this,As(i)))return;this._loaded=!0,this.stylesheet=n.cp(i);const g=()=>{for(const L in i.sources)this.addSource(L,i.sources[L],{validate:!1,isInitialLoad:!0});i.sprite?this._loadIconset(i.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(i.glyphs,this.scope);const w=zd(this.stylesheet.layers);if(this._order=w.map(L=>L.id),this.stylesheet.light&&n.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const L=this.stylesheet.lights[0];this.light=new K(L.properties,L.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new K(this.stylesheet.light)),this._layers={};for(const L of w){const O=n.cu(L,this.scope,this._styleColorTheme.lut,this.options);O.configDependencies.size!==0&&this._configDependentLayers.add(O.fqid),O.setEventedParent(this,{layer:{id:O.id}}),this._layers[O.id]=O;const N=this.getOwnLayerSourceCache(O),B=!!this.directionalLight&&this.directionalLight.shadowsEnabled();N&&O.canCastShadows()&&B&&(N.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const C=this.stylesheet.terrain;C&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(C,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new n.z("data",{dataType:"style"}));const D=this.isRootStyle();i.imports?this._loadImports(i.imports,o).then(()=>{this._reloadImports(),this.fire(new n.z(D?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new n.z(D?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const v=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(v){const w=this._evaluateColorThemeData(v);this._loadColorTheme(w).then(()=>{g()}).catch(C=>{n.w(`Couldn't load color theme from the stylesheet: ${C}`),g()})}else this._styleColorTheme.lut=null,g()}isRootStyle(){return this.importDepth===0}mergeAll(){let i,o,d,g,v,w,C,D,L,O;const N={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(B=>{if(B.stylesheet){if(B.light!=null&&(i=B.light),B.stylesheet.lights)for(const q of B.stylesheet.lights)q.type==="ambient"&&B.ambientLight!=null&&(o=B.ambientLight),q.type==="directional"&&B.directionalLight!=null&&(d=B.directionalLight);g=this._prioritizeTerrain(g,B.terrain,B.stylesheet.terrain),B.stylesheet.fog&&B.fog!=null&&(v=B.fog),B.stylesheet.snow&&B.snow!=null&&(w=B.snow),B.stylesheet.rain&&B.rain!=null&&(C=B.rain),B.stylesheet.camera!=null&&(O=B.stylesheet.camera),B.stylesheet.projection!=null&&(D=B.stylesheet.projection),B.stylesheet.transition!=null&&(L=B.stylesheet.transition),N[B.scope]=B._styleColorTheme}}),this.light=i,this.ambientLight=o,this.directionalLight=d,this.fog=v,this.snow=w,this.rain=C,this._styleColorThemeForScope=N,g===null?delete this.terrain:this.terrain=g,this.camera=O||{"camera-projection":"perspective"},this.projection=D||{name:"mercator"},this.transition=n.l({},ry,L),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(i){const o=d=>{for(const g of d.fragments)o(g.style);i(d)};o(this)}_prioritizeTerrain(i,o,d){const g=i&&i.drapeRenderMode===0;return d===null?o&&o.drapeRenderMode===0?o:g?i:null:o!=null&&(!i||g||o&&o.drapeRenderMode===1)?o:i}mergeTerrain(){let i;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(o=>{i=this._prioritizeTerrain(i,o.terrain,o.stylesheet.terrain)}),i===null?delete this.terrain:this.terrain=i}mergeProjection(){let i;this.forEachFragmentStyle(o=>{o.stylesheet.projection!=null&&(i=o.stylesheet.projection)}),this.projection=i||{name:"mercator"}}mergeSources(){const i={},o={},d={};this.forEachFragmentStyle(g=>{for(const v in g._sourceCaches){const w=n.aC(v,g.scope);i[w]=g._sourceCaches[v]}for(const v in g._otherSourceCaches){const w=n.aC(v,g.scope);o[w]=g._otherSourceCaches[v]}for(const v in g._symbolSourceCaches){const w=n.aC(v,g.scope);d[w]=g._symbolSourceCaches[v]}}),this._mergedSourceCaches=i,this._mergedOtherSourceCaches=o,this._mergedSymbolSourceCaches=d}mergeLayers(){const i={},o=[],d={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(v=>{for(const w of v._order){const C=v._layers[w];if(C.type==="slot"){const D=n.cq(w);if(i[D])continue;i[D]=[]}C.slot&&i[C.slot]?i[C.slot].push(C):o.push(C)}}),this._mergedOrder=[];const g=(v=[])=>{for(const w of v)if(w.type==="slot"){const C=n.cq(w.id);i[C]&&g(i[C]),this._mergedSlots.push(C)}else{const C=n.aC(w.id,w.scope);this._mergedOrder.push(C),d[C]=w,w.is3D()&&(this._has3DLayers=!0),w.type==="circle"&&(this._hasCircleLayers=!0),w.type==="symbol"&&(this._hasSymbolLayers=!0),w.type==="clip"&&(this._clipLayerPresent=!0)}};g(o),this._mergedOrder.sort((v,w)=>{const C=d[v],D=d[w];return C.hasInitialOcclusionOpacityProperties?D.is3D()?1:0:C.is3D()&&D.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(i){return this.stylesheet.camera=n.l({},this.stylesheet.camera,i),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(i){return i.data?function(o,d,g){const v=n.l({},d);for(const C of Object.keys(n.a3.colorTheme))v[C]===void 0&&(v[C]=n.a3.colorTheme[C].default);const w=new n.a4(ex,o,new Map(g));return w.setTransitionOrValue(v,g),w.untransitioned().possiblyEvaluate(new n.a8(0))}(this.scope,i,this.options).get("data"):null}_loadColorTheme(i){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const o=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((d,g)=>{const v="data:image/png;base64,";if(!i||i.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void d();let w=i;w.startsWith(v)||(w=v+w);const C="mapbox-reserved-lut",D=new Image;D.src=w,D.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},D.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==o)return void d();this._styleColorTheme.lutLoading=!1;const{width:L,height:O,data:N}=n.q.getImageData(D);if(O>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(L!==O*O)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(C)&&this.removeImage(C),this.addImage(C,{data:new n.r({width:L,height:O},N),pixelRatio:1,sdf:!1,usvg:!1,version:0});const B=this.imageManager.getImage(C,this.scope);B?(this._styleColorTheme.lut={image:B.data,data:i},d()):g(new Error("Missing LUT image."))}})}getLut(i){const o=this._styleColorThemeForScope[i];return o?o.lut:null}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(i){this._spriteRequest=function(o,d,g){let v,w,C;const D=n.q.devicePixelRatio>1?"@2x":"";let L=n.n(d.transformRequest(d.normalizeSpriteURL(o,D,".json"),n.R.SpriteJSON),(B,q)=>{L=null,C||(C=B,v=q,N())}),O=n.o(d.transformRequest(d.normalizeSpriteURL(o,D,".png"),n.R.SpriteImage),(B,q)=>{O=null,C||(C=B,w=q,N())});function N(){if(C)g(C);else if(v&&w){const B=n.q.getImageData(w),q={};for(const J in v){const{width:X,height:ee,x:Q,y:ae,sdf:pe,pixelRatio:fe,stretchX:we,stretchY:ge,content:ve}=v[J],_e=new n.r({width:X,height:ee});n.r.copy(B,_e,{x:Q,y:ae},{x:0,y:0},{width:X,height:ee},null),q[J]={data:_e,pixelRatio:fe,sdf:pe,stretchX:we,stretchY:ge,content:ve,usvg:!1}}g(null,q)}}return{cancel(){L&&(L.cancel(),L=null),O&&(O.cancel(),O=null)}}}(i,this.map._requestManager,(o,d)=>{if(this._spriteRequest=null,o)this.fire(new n.y(o));else if(d)for(const g in d)this.imageManager.addImage(g,this.scope,d[g]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.z("data",{dataType:"style"}))})}_loadIconset(i){if(!n.f(i)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(i);const o=this.map._spriteFormat==="auto";var d,g;this._spriteRequest=(g=(v,w)=>{if(this._spriteRequest=null,v)o?this._loadSprite(i):this.fire(new n.y(v));else if(w)for(const C in w)this.imageManager.addImage(C,this.scope,w[C]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.z("data",{dataType:"style"}))},n.bi((d=this.map._requestManager).transformRequest(d.normalizeIconsetURL(i),n.R.Iconset),(v,w)=>{if(v)return void g(v);const C={},D=n.cg(new n.bh(w));for(const L of D.icons){const O={version:1,pixelRatio:n.q.devicePixelRatio,content:tx(L),stretchX:L.metadata?iy(L.metadata.stretch_x_areas):void 0,stretchY:L.metadata?iy(L.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:L};C[L.name]=O}g(null,C)}))}_validateLayer(i){const o=this.getOwnSource(i.source);if(!o)return;const d=i.sourceLayer;d&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(d)===-1)&&this.fire(new n.y(new Error(`Source layer "${d}" does not exist on source "${o.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:i}of this.fragments)if(!i.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((i,o)=>{const d=this.fragments[o];return d&&d.style&&(i.data=d.style.serialize()),i})}_serializeSources(){const i={};for(const o in this._sourceCaches){const d=this._sourceCaches[o].getSource();i[d.id]||(i[d.id]=d.serialize())}return i}_serializeLayers(i){const o=[];for(const d of i){const g=this._layers[d];g&&g.type!=="custom"&&o.push(g.serialize())}return o}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(i){return i?this.order:this._mergedOrder}isLayerDraped(i){return!!this.terrain&&i.isDraped(this.getLayerSourceCache(i))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(i){const o=this.getOwnLayer(i);if(o)return o;this.fire(new n.y(new Error(`The layer '${i}' does not exist in the map's style.`)))}_checkSource(i){const o=this.getOwnSource(i);if(o)return o;this.fire(new n.y(new Error(`The source '${i}' does not exist in the map's style.`)))}precompilePrograms(i,o){const d=this.map.painter;if(d)for(let g=i.minzoom||0;g<(i.maxzoom||25.5);g++){const v=i.getProgramIds();if(v)for(const w of v){const C=i.getDefaultProgramParams(w,o.zoom,this._styleColorTheme.lut);C&&(d.style=this,this.fog&&(d._fogVisible=!0,C.overrideFog=!0,d.getOrCreateProgram(w,C)),d._fogVisible=!1,C.overrideFog=!1,d.getOrCreateProgram(w,C),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(C.overrideRtt=!0,d.getOrCreateProgram(w,C)))}}}update(i){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i);const o=this.calculateLightsBrightness();i.brightness=o||0,o!==this._brightness&&(this._brightness=o,this.dispatcher.broadcast("setBrightness",o));const d=this._changes.isDirty();let g=!1;if(this._changes.isDirty()){const w=this._changes.getLayerUpdatesByScope();for(const C in w){const{updatedIds:D,removedIds:L}=w[C];(D||L)&&(this._updateWorkerLayers(C,D,L),g=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(i),this.light&&this.light.updateTransitions(i),this.ambientLight&&this.ambientLight.updateTransitions(i),this.directionalLight&&this.directionalLight.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this.snow&&this.snow.updateTransitions(i),this.rain&&this.rain.updateTransitions(i),this._changes.reset()}const v={};for(const w in this._mergedSourceCaches){const C=this._mergedSourceCaches[w];v[w]=C.used,C.used=!1,C.tileCoverLift=0}for(const w of this._mergedOrder){const C=this._mergedLayers[w];if(C.recalculate(i,this._availableImages),!C.isHidden(i.zoom)){const D=this.getLayerSourceCache(C);D&&(D.used=!0,D.tileCoverLift=Math.max(D.tileCoverLift,C.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(C,i)}):this.precompilePrograms(C,i))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&g&&this.mergeLayers();for(const w in v){const C=this._mergedSourceCaches[w];v[w]!==C.used&&C.getSource().fire(new n.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light&&this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.snow&&this.snow.recalculate(i),this.rain&&this.rain.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new n.z("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=this._changes.getUpdatedImages();if(i.length){for(const o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],i);this._changes.resetUpdatedImages()}}_updateWorkerLayers(i,o,d){const g=this.getFragmentStyle(i);g&&this.dispatcher.broadcast("updateLayers",{layers:o?g._serializeLayers(o):[],scope:i,removedIds:d||[],options:g.options})}setState(i,o){if(this._checkLoaded(),kl(this,As(i)))return!1;(i=n.cp(i)).layers=zd(i.layers);const d=function(w,C){if(!w)return[{command:Ri.setStyle,args:[C]}];let D=[];try{if(!n.bn(w.version,C.version))return[{command:Ri.setStyle,args:[C]}];if(n.bn(w.center,C.center)||D.push({command:Ri.setCenter,args:[C.center]}),n.bn(w.zoom,C.zoom)||D.push({command:Ri.setZoom,args:[C.zoom]}),n.bn(w.bearing,C.bearing)||D.push({command:Ri.setBearing,args:[C.bearing]}),n.bn(w.pitch,C.pitch)||D.push({command:Ri.setPitch,args:[C.pitch]}),n.bn(w.sprite,C.sprite)||D.push({command:Ri.setSprite,args:[C.sprite]}),n.bn(w.glyphs,C.glyphs)||D.push({command:Ri.setGlyphs,args:[C.glyphs]}),n.bn(w.imports,C.imports)||function(q=[],J=[],X){J=J||[];const ee=(q=q||[]).map(Jr),Q=J.map(Jr),ae=q.reduce(Ra,{}),pe=J.reduce(Ra,{}),fe=ee.slice();let we,ge,ve,_e;for(we=0,ge=0;we<ee.length;we++)ve=ee[we],pe.hasOwnProperty(ve)?ge++:(X.push({command:Ri.removeImport,args:[ve]}),fe.splice(fe.indexOf(ve,ge),1));for(we=0,ge=0;we<Q.length;we++)ve=Q[Q.length-1-we],fe[fe.length-1-we]!==ve&&(ae.hasOwnProperty(ve)?(X.push({command:Ri.removeImport,args:[ve]}),fe.splice(fe.lastIndexOf(ve,fe.length-ge),1)):ge++,_e=fe[fe.length-we],X.push({command:Ri.addImport,args:[pe[ve],_e]}),fe.splice(fe.length-we,0,ve));for(const Me of J){const ke=ae[Me.id];ke&&!n.bn(ke,Me)&&X.push({command:Ri.updateImport,args:[Me.id,Me]})}}(w.imports,C.imports,D),n.bn(w.transition,C.transition)||D.push({command:Ri.setTransition,args:[C.transition]}),n.bn(w.light,C.light)||D.push({command:Ri.setLight,args:[C.light]}),n.bn(w.fog,C.fog)||D.push({command:Ri.setFog,args:[C.fog]}),n.bn(w.snow,C.snow)||D.push({command:Ri.setSnow,args:[C.snow]}),n.bn(w.rain,C.rain)||D.push({command:Ri.setRain,args:[C.rain]}),n.bn(w.projection,C.projection)||D.push({command:Ri.setProjection,args:[C.projection]}),n.bn(w.lights,C.lights)||D.push({command:Ri.setLights,args:[C.lights]}),n.bn(w.camera,C.camera)||D.push({command:Ri.setCamera,args:[C.camera]}),!n.bn(w["color-theme"],C["color-theme"]))return[{command:Ri.setStyle,args:[C]}];const L={},O=[];(function(q,J,X,ee){let Q;for(Q in J=J||{},q=q||{})q.hasOwnProperty(Q)&&(J.hasOwnProperty(Q)||Il(Q,X,ee));for(Q in J){if(!J.hasOwnProperty(Q))continue;const ae=J[Q];q.hasOwnProperty(Q)?n.bn(q[Q],ae)||(q[Q].type==="geojson"&&ae.type==="geojson"&&rn(q,J,Q)?X.push({command:Ri.setGeoJSONSourceData,args:[Q,ae.data]}):Wt(Q,J,X,ee)):kd(Q,J,X)}})(w.sources,C.sources,O,L);const N=[];w.layers&&w.layers.forEach(q=>{q.source&&L[q.source]?D.push({command:Ri.removeLayer,args:[q.id]}):N.push(q)});let B=w.terrain;B&&L[B.source]&&(D.push({command:Ri.setTerrain,args:[void 0]}),B=void 0),D=D.concat(O),n.bn(B,C.terrain)||D.push({command:Ri.setTerrain,args:[C.terrain]}),function(q,J,X){J=J||[];const ee=(q=q||[]).map(Jr),Q=J.map(Jr),ae=q.reduce(Ra,{}),pe=J.reduce(Ra,{}),fe=ee.slice(),we=Object.create(null);let ge,ve,_e,Me,ke,tt,We;for(ge=0,ve=0;ge<ee.length;ge++)_e=ee[ge],pe.hasOwnProperty(_e)?ve++:(X.push({command:Ri.removeLayer,args:[_e]}),fe.splice(fe.indexOf(_e,ve),1));for(ge=0,ve=0;ge<Q.length;ge++)_e=Q[Q.length-1-ge],fe[fe.length-1-ge]!==_e&&(ae.hasOwnProperty(_e)?(X.push({command:Ri.removeLayer,args:[_e]}),fe.splice(fe.lastIndexOf(_e,fe.length-ve),1)):ve++,tt=fe[fe.length-ge],X.push({command:Ri.addLayer,args:[pe[_e],tt]}),fe.splice(fe.length-ge,0,_e),we[_e]=!0);for(ge=0;ge<Q.length;ge++)if(_e=Q[ge],Me=ae[_e],ke=pe[_e],!we[_e]&&!n.bn(Me,ke))if(n.bn(Me.source,ke.source)&&n.bn(Me["source-layer"],ke["source-layer"])&&n.bn(Me.type,ke.type)){for(We in qi(Me.layout,ke.layout,X,_e,null,Ri.setLayoutProperty),qi(Me.paint,ke.paint,X,_e,null,Ri.setPaintProperty),n.bn(Me.slot,ke.slot)||X.push({command:Ri.setSlot,args:[_e,ke.slot]}),n.bn(Me.filter,ke.filter)||X.push({command:Ri.setFilter,args:[_e,ke.filter]}),n.bn(Me.minzoom,ke.minzoom)&&n.bn(Me.maxzoom,ke.maxzoom)||X.push({command:Ri.setLayerZoomRange,args:[_e,ke.minzoom,ke.maxzoom]}),Me)Me.hasOwnProperty(We)&&We!=="layout"&&We!=="paint"&&We!=="filter"&&We!=="metadata"&&We!=="minzoom"&&We!=="maxzoom"&&We!=="slot"&&(We.indexOf("paint.")===0?qi(Me[We],ke[We],X,_e,We.slice(6),Ri.setPaintProperty):n.bn(Me[We],ke[We])||X.push({command:Ri.setLayerProperty,args:[_e,We,ke[We]]}));for(We in ke)ke.hasOwnProperty(We)&&!Me.hasOwnProperty(We)&&We!=="layout"&&We!=="paint"&&We!=="filter"&&We!=="metadata"&&We!=="minzoom"&&We!=="maxzoom"&&We!=="slot"&&(We.indexOf("paint.")===0?qi(Me[We],ke[We],X,_e,We.slice(6),Ri.setPaintProperty):n.bn(Me[We],ke[We])||X.push({command:Ri.setLayerProperty,args:[_e,We,ke[We]]}))}else X.push({command:Ri.removeLayer,args:[_e]}),tt=fe[fe.lastIndexOf(_e)+1],X.push({command:Ri.addLayer,args:[ke,tt]})}(N,C.layers,D)}catch(L){console.warn("Unable to compute style diff:",L),D=[{command:Ri.setStyle,args:[C]}]}return D}(this.serialize(),i).filter(w=>!(w.command in ny));if(d.length===0)return!1;const g=d.filter(w=>!(w.command in ix));if(g.length>0)throw new Error(`Unimplemented: ${g.map(w=>w.command).join(", ")}.`);const v=[];return d.forEach(w=>{v.push(this[w.command].apply(this,w.args))}),o&&Promise.all(v).then(o),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(i,o){return this.getImage(i)?this.fire(new n.y(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,this.scope,o),this._afterImageUpdated(i),this)}updateImage(i,o,d=!1){this.imageManager.updateImage(i,this.scope,o),d&&this._afterImageUpdated(i)}getImage(i){return this.imageManager.getImage(i,this.scope)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i,this.scope),this._afterImageUpdated(i),this):this.fire(new n.y(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(i),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new n.z("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(i,o,d={}){return this._checkLoaded(),this._validate(Nu,`models.${i}`,o,null,d)||(this.modelManager.addModel(i,o,this.scope),this._changes.setDirty()),this}hasModel(i){return this.modelManager.hasModel(i,this.scope)}removeModel(i){return this.hasModel(i)?(this.modelManager.removeModel(i,this.scope),this):this.fire(new n.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(i,o,d={}){if(this._checkLoaded(),this.getOwnSource(i)!==void 0)throw new Error(`There is already a source with ID "${i}".`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(Ca,`sources.${i}`,o,null,d))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const g=ds(i,o,this.dispatcher,this);g.scope=this.scope,g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(g.id),source:g.serialize(),sourceId:g.id}));const v=w=>{const C=(w?"symbol:":"other:")+g.id,D=n.aC(C,this.scope),L=this._sourceCaches[C]=new oo(D,g,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[g.id]=L,L.onAdd(this.map)};v(!1),o.type!=="vector"&&o.type!=="geojson"||v(!0),g.onAdd&&g.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(i){this._checkLoaded();const o=this.getOwnSource(i);if(!o)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===i)return this.fire(new n.y(new Error(`Source "${i}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===i)return this.fire(new n.y(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const d=this.getOwnSourceCaches(i);for(const g of d){const v=n.cq(g.id);delete this._sourceCaches[v],this._changes.discardSourceCacheUpdate(g.id),g.fire(new n.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles()}return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],this.mergeSources(),o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(i,o){this._checkLoaded(),this.getOwnSource(i).setData(o),this._changes.setDirty()}getOwnSource(i){const o=this.getOwnSourceCache(i);return o&&o.getSource()}getOwnSources(){const i=[];for(const o in this._otherSourceCaches){const d=this.getOwnSourceCache(o);d&&i.push(d.getSource())}return i}areTilesLoaded(){const i=this._mergedSourceCaches;for(const o in i){const d=i[o]._tiles;for(const g in d){const v=d[g];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}setLights(i){if(this._checkLoaded(),!i)return delete this.ambientLight,void delete this.directionalLight;const o=this._getTransitionParameters();for(const g of i){if(this._validate(vc,"lights",g))return;switch(g.type){case"ambient":if(this.ambientLight){const v=this.ambientLight;v.set(g),v.updateTransitions(o)}else this.ambientLight=new hi(g,It||(It=new n.a5({color:new n.a6(n.a3.properties_light_ambient.color),"color-use-theme":new n.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new n.a6(n.a3.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const v=this.directionalLight;v.set(g),v.updateTransitions(o)}else this.directionalLight=new hi(g,Pt||(Pt=new n.a5({direction:new n.ak(n.a3.properties_light_directional.direction),color:new n.a6(n.a3.properties_light_directional.color),"color-use-theme":new n.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new n.a6(n.a3.properties_light_directional.intensity),"cast-shadows":new n.a6(n.a3.properties_light_directional["cast-shadows"]),"shadow-quality":new n.a6(n.a3.properties_light_directional["shadow-quality"]),"shadow-intensity":new n.a6(n.a3.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const d=new n.a8(this.z||0,o);this.ambientLight&&this.ambientLight.recalculate(d),this.directionalLight&&this.directionalLight.recalculate(d),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const i=this.directionalLight,o=this.ambientLight;if(!i||!o)return;const d=B=>.2126*(B[0]<=.03928?B[0]/12.92:Math.pow((B[0]+.055)/1.055,2.4))+.7152*(B[1]<=.03928?B[1]/12.92:Math.pow((B[1]+.055)/1.055,2.4))+.0722*(B[2]<=.03928?B[2]/12.92:Math.pow((B[2]+.055)/1.055,2.4)),g=i.properties.get("color").toRenderColor(null).toArray01(),v=i.properties.get("intensity"),w=i.properties.get("direction"),C=1-n.cb(w.x,w.y,w.z)[2]/90,D=d(g)*v*C,L=o.properties.get("color").toRenderColor(null).toArray01(),O=o.properties.get("intensity"),N=d(L)*O;return Number(((D+N)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const i=[];return this.directionalLight&&i.push(this.directionalLight.get()),this.ambientLight&&i.push(this.ambientLight.get()),i}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(i){if(!i)return this;if(n.cr(i)){const o=n.cs(i),d=this.fragments.find(({id:v})=>v===o);if(!d)throw new Error(`Style import '${i}' not found`);const g=n.cq(i);return d.style.getFragmentStyle(g)}{const o=this.fragments.find(({id:d})=>d===i);return o?o.style:void 0}}setFeaturesetSelectors(i){if(!i)return;const o={},d=(g,v="")=>`${g}::${v}`;this._featuresetSelectors={};for(const g in i){const v=this._featuresetSelectors[g]=[];for(const w of i[g].selectors){if(w.featureNamespace){const D=this.getOwnLayer(w.layer);if(!D){n.w(`Layer is undefined for selector: ${w.layer}`);continue}const L=d(D.source,D.sourceLayer);if(L in o&&o[L]!==w.featureNamespace){n.w(`"featureNamespace ${w.featureNamespace} of featureset ${g}'s selector is not associated to the same source, skip this selector`);continue}o[L]=w.featureNamespace}let C;if(w.properties)for(const D in w.properties){const L=n.U(w.properties[D]);L.result==="success"&&(C=C||{},C[D]=L.value)}v.push({layerId:w.layer,namespace:w.featureNamespace,properties:C,uniqueFeatureID:w._uniqueFeatureID})}}}getFeaturesetDescriptors(i){const o=this.getFragmentStyle(i);if(!o||!o.stylesheet.featuresets)return[];const d=[];for(const g in o.stylesheet.featuresets)d.push({featuresetId:g,importId:o.scope?o.scope:void 0});return d}getFeaturesetLayers(i,o){const d=this.getFragmentStyle(o),g=d.stylesheet.featuresets;if(!g||!g[i])return this.fire(new n.y(new Error(`The featureset '${i}' does not exist in the map's style and cannot be queried.`))),[];const v=[];for(const w of g[i].selectors){const C=d.getOwnLayer(w.layer);C&&v.push(C)}return v}getConfigProperty(i,o){const d=this.getFragmentStyle(i);if(!d)return null;const g=n.aC(o,d.scope),v=d.options.get(g),w=v?v.value||v.default:null;return w?w.serialize():null}setConfigProperty(i,o,d){const g=this.getFragmentStyle(i);if(!g)return;const v=g.stylesheet.indoor?om(g.stylesheet.schema):g.stylesheet.schema;if(!v||!v[o])return;const w=n.U(d);if(w.result!=="success")return void kl(this,w.value);const C=w.value.expression,D=n.aC(o,g.scope),L=g.options.get(D);if(!L)return;let O;const{minValue:N,maxValue:B,stepValue:q,type:J,values:X}=v[o],ee=n.U(v[o].default);ee.result==="success"&&(O=ee.value.expression),O?(this.options.set(D,Object.assign({},L,{value:C,default:O,minValue:N,maxValue:B,stepValue:q,type:J,values:X})),this.updateConfigDependencies(o)):this.fire(new n.y(new Error(`No schema defined for the config option "${o}" in the "${i}" fragment.`)))}getConfig(i){const o=this.getFragmentStyle(i);if(!o)return null;const d=o.stylesheet.schema;if(!d)return null;const g={};for(const v in d){const w=n.aC(v,o.scope),C=o.options.get(w),D=C?C.value||C.default:null;g[v]=D?D.serialize():null}return g}setConfig(i,o){const d=this.getFragmentStyle(i);d&&(d.updateConfig(o,d.stylesheet.schema),this.updateConfigDependencies())}getSchema(i){const o=this.getFragmentStyle(i);return o?o.stylesheet.schema:null}setSchema(i,o){const d=this.getFragmentStyle(i);d&&(d.stylesheet.schema=o,d.updateConfig(d._config,o),this.updateConfigDependencies())}updateConfig(i,o){if(this._config=i,i||o)if(o)for(const d in o){let g,v;const w=n.U(o[d].default);if(w.result==="success"&&(g=w.value.expression),i&&i[d]!==void 0){const B=n.U(i[d]);B.result==="success"&&(v=B.value.expression)}const{minValue:C,maxValue:D,stepValue:L,type:O,values:N}=o[d];if(g){const B=n.aC(d,this.scope);this.options.set(B,{default:g,value:v,minValue:C,maxValue:D,stepValue:L,type:O,values:N})}else this.fire(new n.y(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new n.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(i){for(const o of this._configDependentLayers){const d=this.getLayer(o);if(d){if(i&&!d.configDependencies.has(i))continue;d.possiblyEvaluateVisibility(),this._updateLayer(d)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(o=>{const d=o._styleColorTheme.colorThemeOverride?o._styleColorTheme.colorThemeOverride:o._styleColorTheme.colorTheme;if(d){const g=o._evaluateColorThemeData(d);(!o._styleColorTheme.lut&&g!==""||o._styleColorTheme.lut&&g!==o._styleColorTheme.lut.data)&&o.setColorTheme(d)}}),this._changes.setDirty()}addLayer(i,o,d={}){this._checkLoaded();const g=i.id;if(this._layers[g])return void this.fire(new n.y(new Error(`Layer with id "${g}" already exists on this map`)));let v;if(i.type==="custom"){if(kl(this,n.ct(i)))return;v=n.cu(i,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof i.source=="object"&&(this.addSource(g,i.source),i=n.cp(i),i=n.l(i,{source:g})),this._validate(Rd,`layers.${g}`,i,{arrayIndex:-1},d))return;v=n.cu(i,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(v),v.setEventedParent(this,{layer:{id:g}})}v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid);let w=this._order.length;if(o){const O=this._order.indexOf(o);if(O===-1)return void this.fire(new n.y(new Error(`Layer with id "${o}" does not exist on this map.`)));v.slot===this._layers[o].slot?w=O:n.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,g),this._layerOrderChanged=!0,this._layers[g]=v;const C=this.getOwnLayerSourceCache(v),D=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&v.canCastShadows()&&D&&(C.castsShadows=!0);const L=this._changes.getRemovedLayer(v);if(L&&v.source&&C&&v.type!=="custom"){this._changes.discardLayerRemoval(v);const O=n.aC(v.source,v.scope);L.type!==v.type?this._changes.updateSourceCache(O,"clear"):(this._changes.updateSourceCache(O,"reload"),C.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),v.scope=this.scope,this.mergeLayers()}moveLayer(i,o){this._checkLoaded();const d=this._checkLayer(i);if(!d||i===o)return;const g=this._order.indexOf(i);this._order.splice(g,1);let v=this._order.length;if(o){const w=this._order.indexOf(o);if(w===-1)return void this.fire(new n.y(new Error(`Layer with id "${o}" does not exist on this map.`)));d.slot===this._layers[o].slot?v=w:n.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,i),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(i){this._checkLoaded();const o=this._checkLayer(i);if(!o)return;o.setEventedParent(null);const d=this._order.indexOf(i);this._order.splice(d,1),delete this._layers[i],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(o.fqid),this._changes.removeLayer(o);const g=this.getOwnLayerSourceCache(o);if(g&&g.castsShadows){let v=!1;for(const w in this._layers)if(this._layers[w].source===o.source&&this._layers[w].canCastShadows()){v=!0;break}g.castsShadows=v}o.onRemove&&o.onRemove(this.map),this.mergeLayers()}getOwnLayer(i){return this._layers[i]}hasLayer(i){return i in this._mergedLayers}hasLayerType(i){for(const o in this._layers)if(this._layers[o].type===i)return!0;return!1}setLayerZoomRange(i,o,d){this._checkLoaded();const g=this._checkLayer(i);g&&(g.minzoom===o&&g.maxzoom===d||(o!=null&&(g.minzoom=o),d!=null&&(g.maxzoom=d),this._updateLayer(g)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(i,o){this._checkLoaded();const d=this._checkLayer(i);d&&d.slot!==o&&(d.slot=o,this._updateLayer(d))}setFilter(i,o,d={}){this._checkLoaded();const g=this._checkLayer(i);if(g&&!n.bn(g.filter,o))return o==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(pr,`layers.${g.id}.filter`,o,{layerType:g.type},d)||(g.filter=n.cp(o),this._updateLayer(g)))}getFilter(i){const o=this._checkLayer(i);if(o)return n.cp(o.filter)}setLayoutProperty(i,o,d,g={}){this._checkLoaded();const v=this._checkLayer(i);if(v&&!n.bn(v.getLayoutProperty(o),d)){if(d!=null&&(!g||g.validate!==!1)&&kl(v,Dd.call(As,{key:`layers.${i}.layout.${o}`,layerType:v.type,objectKey:o,value:d,styleSpec:n.a3,style:{glyphs:!0,sprite:!0}})))return;v.setLayoutProperty(o,d),v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),this._updateLayer(v)}}getLayoutProperty(i,o){const d=this._checkLayer(i);if(d)return d.getLayoutProperty(o)}setPaintProperty(i,o,d,g={}){this._checkLoaded();const v=this._checkLayer(i);if(!v||n.bn(v.getPaintProperty(o),d)||d!=null&&(!g||g.validate!==!1)&&kl(v,Fu.call(As,{key:`layers.${i}.paint.${o}`,layerType:v.type,objectKey:o,value:d,styleSpec:n.a3})))return;const w=v.setPaintProperty(o,d);v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),w&&this._updateLayer(v),this._changes.updatePaintProperties(v)}getPaintProperty(i,o){const d=this._checkLayer(i);if(d)return d.getPaintProperty(o)}setFeatureState(i,o){if(this._checkLoaded(),"target"in i){if("featuresetId"in i.target){const{featuresetId:D,importId:L}=i.target,O=this.getFragmentStyle(L),N=O.getFeaturesetLayers(D);for(const{source:B,sourceLayer:q}of N)O.setFeatureState({id:i.id,source:B,sourceLayer:q},o)}else if("layerId"in i.target){const{layerId:D}=i.target,L=this.getLayer(D);this.setFeatureState({id:i.id,source:L.source,sourceLayer:L.sourceLayer},o)}return}const d=i.source,g=i.sourceLayer,v=this._checkSource(d);if(!v)return;const w=v.type;if(w==="geojson"&&g)return void this.fire(new n.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!g)return void this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new n.y(new Error("The feature id parameter must be provided.")));const C=this.getOwnSourceCaches(d);for(const D of C)D.setFeatureState(g,i.id,o)}removeFeatureState(i,o){if(this._checkLoaded(),"target"in i){if("featuresetId"in i.target){const{featuresetId:D,importId:L}=i.target,O=this.getFragmentStyle(L),N=O.getFeaturesetLayers(D);for(const{source:B,sourceLayer:q}of N)O.removeFeatureState({id:i.id,source:B,sourceLayer:q},o)}else if("layerId"in i.target){const{layerId:D}=i.target,L=this.getLayer(D);this.removeFeatureState({id:i.id,source:L.source,sourceLayer:L.sourceLayer},o)}return}const d=i.source,g=this._checkSource(d);if(!g)return;const v=g.type,w=v==="vector"?i.sourceLayer:void 0;if(v==="vector"&&!w)return void this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new n.y(new Error("A feature id is required to remove its specific state property.")));const C=this.getOwnSourceCaches(d);for(const D of C)D.removeFeatureState(w,i.id,o)}getFeatureState(i){if(this._checkLoaded(),"target"in i){let v;if("featuresetId"in i.target){const{featuresetId:w,importId:C}=i.target,D=this.getFragmentStyle(C),L=D.getFeaturesetLayers(w);for(const{source:O,sourceLayer:N}of L){const B=D.getFeatureState({id:i.id,source:O,sourceLayer:N});if(B&&!v)v=B;else if(!n.bn(v,B))return void this.fire(new n.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in i.target){const{layerId:w}=i.target,C=this.getLayer(w);v=this.getFeatureState({id:i.id,source:C.source,sourceLayer:C.sourceLayer})}return v}const o=i.source,d=i.sourceLayer,g=this._checkSource(o);if(g){if(g.type!=="vector"||d)return i.id===void 0&&this.fire(new n.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(o)[0].getFeatureState(d,i.id);this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(i){return this.stylesheet.transition=n.l({},this.stylesheet.transition,i),this.transition=this.stylesheet.transition,this}getTransition(){return n.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const i=this.getTerrain(),o=i&&this.terrain&&this.terrain.scope===this.scope?i:this.stylesheet.terrain;return n.cv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:o,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},d=>d!==void 0)}_updateFilteredLayers(i){for(const o of Object.values(this._mergedLayers))i(o)&&this._updateLayer(o)}_updateLayer(i){this._changes.updateLayer(i);const o=this.getLayerSourceCache(i),d=n.aC(i.source,i.scope),g=this._changes.getUpdatedSourceCaches();i.source&&!g[d]&&o&&o.getSource().type!=="raster"&&(this._changes.updateSourceCache(d,"reload"),o.pause()),i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const o=C=>this._mergedLayers[C].is3D(),d=this.order,g={},v=[];for(let C=d.length-1;C>=0;C--){const D=d[C];if(o(D)){g[D]=C;for(const L of i){const O=L[D];if(O)for(const N of O)v.push(N)}}}v.sort((C,D)=>D.intersectionZ-C.intersectionZ);const w=[];for(let C=d.length-1;C>=0;C--){const D=d[C];if(o(D))for(let L=v.length-1;L>=0;L--){const O=v[L].feature;if(O.layer&&g[O.layer.id]<C)break;w.push(O),v.pop()}else for(const L of i){const O=L[D];if(O)for(const N of O)w.push(N.feature)}}return w}queryRenderedFeatures(i,o,d){let g;o&&!Array.isArray(o)&&o.filter&&(this._validate(pr,"queryRenderedFeatures.filter",o.filter,null,o),g=n.aZ(o.filter));const v={},w=O=>{if(lm.has(O.type))return;const N=this.getOwnLayerSourceCache(O),B=v[N.id]=v[N.id]||{sourceCache:N,layers:{},has3DLayers:!1};O.is3D()&&(B.has3DLayers=!0),B.layers[O.fqid]=B.layers[O.fqid]||{styleLayer:O,targets:[]},B.layers[O.fqid].targets.push({filter:g})};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new n.y(new Error("parameters.layers must be an Array."))),[];for(const O of o.layers){const N=this._layers[O];if(!N)return this.fire(new n.y(new Error(`The layer '${O}' does not exist in the map's style and cannot be queried for features.`))),[];w(N)}}else for(const O in this._layers)w(this._layers[O]);const C=this._queryRenderedFeatures(i,v,d),D=this._flattenAndSortRenderedFeatures(C),L=[];for(const O of D)n.cs(O.layer.id)===this.scope&&L.push(O);return L}queryRenderedFeatureset(i,o,d){let g;o&&!Array.isArray(o)&&o.filter&&(this._validate(pr,"queryRenderedFeatures.filter",o.filter,null,o),g=n.aZ(o.filter));const v="mock",w=[];if(o&&o.target)w.push(Object.assign({},o,{targetId:v,filter:g}));else{const O=this.getFeaturesetDescriptors();for(const N of O)w.push({targetId:v,filter:g,target:N});for(const{style:N}of this.fragments){const B=N.getFeaturesetDescriptors();for(const q of B)w.push({targetId:v,filter:g,target:q})}}const C=this.queryRenderedTargets(i,w,d),D=[],L=new Set;for(const O of C)for(const N of O.variants[v])Ia(N,O,L)||D.push(new n.cw(O,N));return D}queryRenderedTargets(i,o,d){const g={},v=(C,D,L,O)=>{const N=g[D.id]=g[D.id]||{sourceCache:D,layers:{},has3DLayers:!1};if(N.layers[C.fqid]=N.layers[C.fqid]||{styleLayer:C,targets:[]},C.is3D()&&(N.has3DLayers=!0),!O)return L.uniqueFeatureID=!1,void N.layers[C.fqid].targets.push(L);N.layers[C.fqid].targets.push(Object.assign({},L,{namespace:O.namespace,properties:O.properties,uniqueFeatureID:O.uniqueFeatureID}))};for(const C of o)if("featuresetId"in C.target){const{featuresetId:D,importId:L}=C.target,O=this.getFragmentStyle(L);if(!O||!O._featuresetSelectors)continue;const N=O._featuresetSelectors[D];if(!N){this.fire(new n.y(new Error(`The featureset '${D}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const B of N){const q=O.getOwnLayer(B.layerId);q&&!lm.has(q.type)&&v(q,O.getOwnLayerSourceCache(q),C,B)}}else if("layerId"in C.target){const{layerId:D}=C.target,L=this.getLayer(D);if(!L||lm.has(L.type))continue;v(L,this.getLayerSourceCache(L),C)}const w=this._queryRenderedFeatures(i,g,d);return this._flattenAndSortRenderedFeatures(w)}_queryRenderedFeatures(i,o,d){const g=[],v=!!this.map._showQueryGeometry,w=ci.createFromScreenPoints(i,d);for(const C in o){const D=Vu(w,o[C],this._availableImages,d,v);Object.keys(D).length&&g.push(D)}if(this.placement)for(const C in o){if(!o[C].sourceCache._onlySymbols)continue;const D=Up(w.screenGeometry,o[C],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(D).length&&g.push(D)}return g}querySourceFeatures(i,o){const d=o&&o.filter;d&&this._validate(pr,"querySourceFeatures.filter",d,null,o);let g=[];const v=this.getOwnSourceCaches(i);for(const w of v)g=g.concat(Kg(w,o));return g}addSourceType(i,o,d){return lo.getSourceType(i)?d(new Error(`A source type called "${i}" already exists.`)):(lo.setSourceType(i,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:o.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(i,o,d={}){this._checkLoaded();const g=this.light.getLight();let v=!1;for(const C in i)if(!n.bn(i[C],g[C])){v=!0;break}if(!v)return;const w=this._getTransitionParameters();this.light.setLight(i,o,d),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=n.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&n.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(i,o=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),o===0&&delete this.terrain,i===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let d=i;const g=i.source==null;if(o===1){if(this.disableElevatedTerrain)return;if(typeof d.source=="object"){const C="terrain-dem-src";this.addSource(C,d.source),d=n.cp(d),d=n.l(d,{source:C})}const v=n.l({},d),w={};if(this.terrain&&g){v.source=this.terrain.get().source;const C=this.terrain?this.getFragmentStyle(this.terrain.scope):null;C&&(w.style=C.serialize())}if(this._validate(xc,"terrain",v,w))return}if(!this.terrain||this.terrain.scope!==this.scope&&!g||this.terrain&&o!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,o),this.fire(new n.z("data",{dataType:"style"}))}else{const v=this.terrain,w=v.get();for(const C of Object.keys(n.a3.terrain))!d.hasOwnProperty(C)&&n.a3.terrain[C].default&&(d[C]=n.a3.terrain[C].default);for(const C in i)if(!n.bn(i[C],w[C])){v.set(i,this.options),this.stylesheet.terrain=i;const D=this._getTransitionParameters({duration:0});v.updateTransitions(D),this.fire(new n.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const o=this.fog=new Ke(i,this.map.transform,this.scope,this.options);this.stylesheet.fog=o.get();const d=this._getTransitionParameters({duration:0});o.updateTransitions(d)}_createSnow(i){const o=this.snow=new si(i,this.map.transform,this.scope,this.options);this.stylesheet.snow=o.get();const d=this._getTransitionParameters({duration:0});o.updateTransitions(d)}_createRain(i){const o=this.rain=new ui(i,this.map.transform,this.scope,this.options);this.stylesheet.rain=o.get();const d=this._getTransitionParameters({duration:0});o.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog;if(!n.bn(o.get(),i)){o.set(i,this.options),this.stylesheet.fog=o.get();const d=this._getTransitionParameters({duration:0});o.updateTransitions(d)}}else this._createFog(i);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(i){if(this._checkLoaded(),!i)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const o=this.snow;if(!n.bn(o.get(),i)){o.set(i,this.options),this.stylesheet.snow=o.get();const d=this._getTransitionParameters({duration:0});o.updateTransitions(d)}}else this._createSnow(i);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(i){if(this._checkLoaded(),!i)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const o=this.rain;if(!n.bn(o.get(),i)){o.set(i,this.options),this.stylesheet.rain=o.get();const d=this._getTransitionParameters({duration:0});o.updateTransitions(d)}}else this._createRain(i);this._markersNeedUpdate=!0}_reloadColorTheme(){const i=()=>{for(const g in this._layers)this._layers[g].lut=this._styleColorTheme.lut;for(const g in this._sourceCaches)this._sourceCaches[g].clearTiles()},o=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!o)return this._styleColorTheme.lut=null,void i();const d=this._evaluateColorThemeData(o);this._loadColorTheme(d).then(()=>{this.fire(new n.z("colorthemeset")),i()}).catch(g=>{n.w(`Couldn't set color theme: ${g}`)})}setColorTheme(i){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&n.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=i,this._reloadColorTheme()}setImportColorTheme(i,o){const d=this.getFragmentStyle(i);d&&(d._styleColorTheme.colorThemeOverride=o,d._reloadColorTheme())}_getTransitionParameters(i){return{now:n.q.now(),transition:n.l(this.transition,i)}}updateDrapeFirstLayers(){if(!this.terrain)return;const i=[],o=[];for(const d of this._mergedOrder)this.isLayerDraped(this._mergedLayers[d])?i.push(d):o.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...o)}_createTerrain(i,o){const d=this.terrain=new ie(i,o,this.scope,this.options);o===1&&(this.stylesheet.terrain=i),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const g=this._getTransitionParameters({duration:0});d.updateTransitions(g)}_force3DLayerUpdate(){for(const i in this._layers){const o=this._layers[i];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const o=this._layers[i];o.type==="symbol"&&this._updateLayer(o)}}_validate(i,o,d,g,v={}){if(v&&v.validate===!1)return!1;const w=n.l({},this.serialize());return kl(this,i.call(As,n.l({key:o,style:w,value:d,styleSpec:n.a3},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.cx.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._mergedLayers)this._mergedLayers[i].setEventedParent(null);for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles(),this._mergedSourceCaches[i].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(i){const o=this.getSourceCaches(i);for(const d of o)d.clearTiles()}clearSources(){for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles()}reloadSource(i){const o=this.getSourceCaches(i);for(const d of o)d.resume(),d.reload()}reloadSources(){for(const i of this.getSources())i.reload&&i.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(i=>{i.modelManager.reloadModels(i.scope)})}updateSources(i){let o;this.directionalLight&&(o=zl(this.directionalLight));for(const d in this._mergedSourceCaches)this._mergedSourceCaches[d].update(i,void 0,void 0,o)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const o=this._sourceCaches[i];o.resume(),o.reload()}}_updatePlacement(i,o,d,g,v,w,C=!1){let D=!1,L=!1;const O={},N={};for(const B of this._mergedOrder){const q=this._mergedLayers[B];if(q.type!=="symbol")continue;const J=n.aC(q.source,q.scope);let X=O[J];if(!X){const Q=this.getLayerSourceCache(q);if(!Q)continue;const ae=Q.getRenderableIds(!0).map(pe=>Q.getTileByID(pe));N[J]=ae.slice(),X=O[J]=ae.sort((pe,fe)=>fe.tileID.overscaledZ-pe.tileID.overscaledZ||(pe.tileID.isLessThan(fe.tileID)?-1:1))}const ee=this.crossTileSymbolIndex.addLayer(q,X,o.center.lng,o.projection);D=D||ee}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),C=C||this._layerOrderChanged||g===0,this._layerOrderChanged&&this.fire(new n.z("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.q.now(),o.zoom))&&(this.pauseablePlacement=new Y1(o,this._mergedOrder,C,d,g,v,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,O,N,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.q.now()),L=!0),D&&this.pauseablePlacement.placement.setStale()),L||D){this._buildingIndex.onNewFrame(o.zoom);for(let B=0;B<this._mergedOrder.length;B++){const q=this._mergedLayers[this._mergedOrder[B]];if(q.type!=="symbol")continue;const J=this.isLayerClipped(q);this.placement.updateLayerOpacities(q,O[n.aC(q.source,q.scope)],B,J?w:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.q.now())}}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}addImport(i,o){this._checkLoaded();const d=this.stylesheet.imports=this.stylesheet.imports||[];if(d.findIndex(({id:v})=>v===i.id)!==-1)return void this.fire(new n.y(new Error(`Import with id '${i.id}' already exists in the map's style.`)));if(!o)return d.push(i),this._loadImports([i],!0);const g=d.findIndex(({id:v})=>v===o);return g===-1&&this.fire(new n.y(new Error(`Import with id "${o}" does not exist on this map.`))),this.stylesheet.imports=d.slice(0,g).concat(i).concat(d.slice(g)),this._loadImports([i],!0,o)}updateImport(i,o){this._checkLoaded();const d=this.stylesheet.imports||[],g=this.getImportIndex(i);return g===-1?this:typeof o=="string"?(this.setImportUrl(i,o),this):(o.url&&o.url!==d[g].url&&this.setImportUrl(i,o.url),n.bn(o.config,d[g].config)||this.setImportConfig(i,o.config,o.data.schema),n.bn(o.data,d[g].data)||this.setImportData(i,o.data),this)}moveImport(i,o){this._checkLoaded();let d=this.stylesheet.imports||[];const g=this.getImportIndex(i);if(g===-1)return this;const v=this.getImportIndex(o);if(v===-1)return this;const w=d[g],C=this.fragments[g];return d=d.filter(({id:D})=>D!==i),this.fragments=this.fragments.filter(({id:D})=>D!==i),this.stylesheet.imports=d.slice(0,v).concat(w).concat(d.slice(v)),this.fragments=this.fragments.slice(0,v).concat(C).concat(this.fragments.slice(v)),this.mergeLayers(),this}setImportUrl(i,o){this._checkLoaded();const d=this.stylesheet.imports||[],g=this.getImportIndex(i);if(g===-1)return this;d[g].url=o;const v=this.fragments[g];return v.style=this._createFragmentStyle(d[g]),v.style.on("style.import.load",()=>this.mergeAll()),v.style.loadURL(o),this}setImportData(i,o){this._checkLoaded();const d=this.getImportIndex(i),g=this.stylesheet.imports||[];return d===-1?this:o?(this.fragments[d].style.setState(o),this._reloadImports(),this):(delete g[d].data,this.setImportUrl(i,g[d].url))}setImportConfig(i,o,d){this._checkLoaded();const g=this.getImportIndex(i),v=this.stylesheet.imports||[];if(g===-1)return this;o?v[g].config=o:delete v[g].config;const w=this.fragments[g];d&&w.style.stylesheet&&(w.style.stylesheet.schema=d);const C=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=o,w.style.updateConfig(o,C),this.updateConfigDependencies(),this}removeImport(i){this._checkLoaded();const o=this.stylesheet.imports||[],d=this.getImportIndex(i);d!==-1&&(o.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports())}getImportIndex(i){const o=(this.stylesheet.imports||[]).findIndex(d=>d.id===i);return o===-1&&this.fire(new n.y(new Error(`Import '${i}' does not exist in the map's style and cannot be updated.`))),o}getLayer(i){return this._mergedLayers[i]}getSources(){const i=[];for(const o in this._mergedOtherSourceCaches){const d=this._mergedOtherSourceCaches[o];d&&i.push(d.getSource())}return i}getSource(i,o){const d=this.getSourceCache(i,o);return d&&d.getSource()}getLayerSource(i){const o=this.getLayerSourceCache(i);return o&&o.getSource()}getSourceCache(i,o){const d=n.aC(i,o);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(i){const o=n.aC(i.source,i.scope);return i.type==="symbol"?this._mergedSymbolSourceCaches[o]:this._mergedOtherSourceCaches[o]}getSourceCaches(i){if(i==null)return Object.values(this._mergedSourceCaches);const o=[];return this._mergedOtherSourceCaches[i]&&o.push(this._mergedOtherSourceCaches[i]),this._mergedSymbolSourceCaches[i]&&o.push(this._mergedSymbolSourceCaches[i]),o}updateSourceCaches(){const i=this._changes.getUpdatedSourceCaches();for(const o in i){const d=i[o];d==="reload"?this.reloadSource(o):d==="clear"&&this.clearSource(o)}}updateLayers(i){const o=this._changes.getUpdatedPaintProperties();for(const d of o){const g=this.getLayer(d);g&&g.updateTransitions(i)}}getImages(i,o,d){this.imageManager.getImages(o.icons,o.scope,d),this._updateTilesForChangedImages();const g=v=>{v&&v.setDependencies(o.tileID.key,o.type,o.icons)};g(this._otherSourceCaches[o.source]),g(this._symbolSourceCaches[o.source])}rasterizeImages(i,o,d){this.imageManager.rasterizeImages(o,d)}getGlyphs(i,o,d){this.glyphManager.getGlyphs(o.stacks,o.scope,d)}getResource(i,o,d){return n.cy(o,d)}getOwnSourceCache(i){return this._otherSourceCaches[i]}getOwnLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}getOwnSourceCaches(i){const o=[];return this._otherSourceCaches[i]&&o.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&o.push(this._symbolSourceCaches[i]),o}_isSourceCacheLoaded(i){const o=this.getOwnSourceCaches(i);return o.length===0?(this.fire(new n.y(new Error(`There is no source with ID '${i}'`))),!1):o.every(d=>d.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(i,o){if(!this._clipLayerPresent&&i.type!=="fill-extrusion")return!1;const d=i.type==="fill-extrusion"&&i.sourceLayer==="building";if(i.is3D()){if(d||o&&o.type==="batched-model"||i.type==="model")return!0}else if(i.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(i=>{i.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}lo.getSourceType=function(h){return br[h]},lo.setSourceType=function(h,i){br[h]=i},lo.registerForPluginStateChange=n.ch;var qd=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Qu=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Hd=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,nl="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Gd=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,cm=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Fl=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Sc=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,eh=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,th=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Nl=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Bl=[];Vl(qd,Bl),Vl(Hd,Bl),Vl(Qu,Bl);const Ac={"_prelude_fog.vertex.glsl":cm,"_prelude_terrain.vertex.glsl":Gd,"_prelude_shadow.vertex.glsl":th,"_prelude_fog.fragment.glsl":Fl,"_prelude_shadow.fragment.glsl":Nl,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Sc,"_prelude_raster_particle.glsl":eh},ih={};Vi("",Gd),Vi(Fl,cm),Vi(Nl,th),Vi(Sc,""),Vi(eh,"");const Wd=Vi(Qu,Hd),nh=qd;var Mc={background:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Vi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Vi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Vi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Vi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Vi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Vi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Vi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Vi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Vi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Vi(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Vi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Vi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Vi(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Vi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Vi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Vi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,nl),skyboxGradient:Vi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,nl),skyboxCapture:Vi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Vi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Vi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Vi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Vi("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Vi("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Vi("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Vi("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Vl(h,i){const o=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let d of o)if(d=d.trim(),d[0]==="#"&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const g=d.split(" ");for(const v of g)i.includes(v)||i.push(v)}}function Vi(h,i){const o=/#include\s+"([^"]+)"/g,d=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let g=i.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);g&&(g=g.map(L=>{const O=L.split(" ");return O[O.length-1]}),g=[...new Set(g)]);const v={},w=[],C=[];if(h=h.replace(o,(L,O)=>(C.push(O),"")),(i=i.replace(o,(L,O)=>(w.push(O),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let D=[...Bl];Vl(h,D),Vl(i,D);for(const L of[...w,...C])Ac[L]||console.error(`Undefined include: ${L}`),ih[L]||(ih[L]=[],Vl(Ac[L],ih[L])),D=[...D,...ih[L]];return{fragmentSource:h=h.replace(d,(L,O,N,B,q)=>(v[q]=!0,O==="define"?`
#ifndef HAS_UNIFORM_u_${q}
in ${N} ${B} ${q};
#else
uniform ${N} ${B} u_${q};
#endif
`:O==="initialize"?`
#ifdef HAS_UNIFORM_u_${q}
    ${N} ${B} ${q} = u_${q};
#endif
`:O==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${N} ${B} ${q};
#endif
`:O==="initialize-attribute"?"":void 0)),vertexSource:i=i.replace(d,(L,O,N,B,q)=>{const J=B==="float"?"vec2":B,X=q.match(/color/)?"color":J;return O==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${q}
in ${N} ${B} a_${q};
#endif
`:v[q]?O==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${N} ${J} a_${q};
out ${N} ${B} ${q};
#else
uniform ${N} ${B} u_${q};
#endif
`:O==="initialize"?X==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${N} ${B} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${X}(a_${q}, u_${q}_t);
#else
    ${N} ${B} ${q} = u_${q};
#endif
`:O==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${N} ${B} a_${q};
    out ${N} ${B} ${q};
#endif
`:O==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${q} = a_${q};
#endif
`:void 0:O==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${N} ${J} a_${q};
#else
uniform ${N} ${B} u_${q};
#endif
`:O==="define-instanced"?X==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${q}0;
in vec4 a_${q}1;
in vec4 a_${q}2;
in vec4 a_${q}3;
#else
uniform ${N} ${B} u_${q};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${N} ${J} a_${q};
#else
uniform ${N} ${B} u_${q};
#endif
`:O==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${N} ${B} ${q} = a_${q};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${N} ${B} ${q} = a_${q};
#else
    ${N} ${B} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${N} ${B} ${q} = unpack_mix_${X}(a_${q}, u_${q}_t);
#else
    ${N} ${B} ${q} = u_${q};
#endif
`}),staticAttributes:g,usedDefines:D,vertexIncludes:w,fragmentIncludes:C}}class sy{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,o,d,g,v,w,C,D){this.context=i;let L=this.boundPaintVertexBuffers.length!==g.length;for(let N=0;!L&&N<g.length;N++)this.boundPaintVertexBuffers[N]!==g[N]&&(L=!0);let O=this.boundDynamicVertexBuffers.length!==C.length;for(let N=0;!O&&N<C.length;N++)this.boundDynamicVertexBuffers[N]!==C[N]&&(O=!0);if(!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==d||L||O||this.boundIndexBuffer!==v||this.boundVertexOffset!==w)this.freshBind(o,d,g,v,w,C,D);else{i.bindVertexArrayOES.set(this.vao);for(const N of C)N&&(N.bind(),D&&N.instanceCount&&N.setVertexAttribDivisor(i.gl,o,D));v&&v.dynamicDraw&&v.bind()}}freshBind(i,o,d,g,v,w,C){const D=i.numAttributes,L=this.context,O=L.gl;this.vao&&this.destroy(),this.vao=L.gl.createVertexArray(),L.bindVertexArrayOES.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=g,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=w,o.enableAttributes(O,i),o.bind(),o.setVertexAttribPointers(O,i,v);for(const N of d)N.enableAttributes(O,i),N.bind(),N.setVertexAttribPointers(O,i,v);for(const N of w)N&&(N.enableAttributes(O,i),N.bind(),N.setVertexAttribPointers(O,i,v),C&&N.instanceCount&&N.setVertexAttribDivisor(O,i,C));g&&g.bind(),L.currentNumAttributes=D}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Cc(h,i){const o=Math.pow(2,i.canonical.z),d=i.canonical.y;return[new n.aa(0,d/o).toLngLat().lat,new n.aa(0,(d+1)/o).toLngLat().lat]}function oy(h,i,o,d,g,v,w){const C=h.context,D=C.gl,L=o.hillshadeFBO;if(!L)return;h.prepareDrawTile();const O=h.isTileAffectedByFog(i),N=h.getOrCreateProgram("hillshade",{overrideFog:O});C.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,L.colorAttachment.get());const B=((ee,Q,ae,pe)=>{const fe=ae.paint.get("hillshade-shadow-color"),we=ae.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",ge=ae.paint.get("hillshade-highlight-color"),ve=ae.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",_e=ae.paint.get("hillshade-accent-color"),Me=ae.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",ke=ae.paint.get("hillshade-emissive-strength");let tt=n.ai(ae.paint.get("hillshade-illumination-direction"));if(ae.paint.get("hillshade-illumination-anchor")==="viewport")tt-=ee.transform.angle;else if(ee.style&&ee.style.enable3dLights()&&ee.style.directionalLight){const ct=ee.style.directionalLight.properties.get("direction"),lt=n.cb(ct.x,ct.y,ct.z);tt=n.ai(lt[1])}const We=!ee.options.moving;return{u_matrix:pe||ee.transform.calculateProjMatrix(Q.tileID.toUnwrapped(),We),u_image:0,u_latrange:Cc(0,Q.tileID),u_light:[ae.paint.get("hillshade-exaggeration"),tt],u_shadow:fe.toRenderColor(we?null:ae.lut),u_highlight:ge.toRenderColor(ve?null:ae.lut),u_emissive_strength:ke,u_accent:_e.toRenderColor(Me?null:ae.lut)}})(h,o,d,h.terrain?i.projMatrix:null);h.uploadCommonUniforms(C,N,i.toUnwrapped());const{tileBoundsBuffer:q,tileBoundsIndexBuffer:J,tileBoundsSegments:X}=h.getTileBoundsBuffers(o);N.draw(h,D.TRIANGLES,g,v,w,gi.disabled,B,d.id,q,J,X)}function ay(h,i,o){if(!i.needsDEMTextureUpload)return;const d=h.context,g=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||h.getTileTexture(o.stride);const v=o.getPixels();i.demTexture?i.demTexture.update(v,{premultiply:!1}):i.demTexture=new n.T(d,v,g.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function nx(h,i,o){const d=h.context,g=d.gl;if(!i.dem)return;const v=i.dem;if(d.activeTexture.set(g.TEXTURE1),ay(h,i,v),!i.demTexture)return;i.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE);const w=v.dim;d.activeTexture.set(g.TEXTURE0);let C=i.hillshadeFBO;if(!C){const B=new n.T(d,{width:w,height:w,data:null},g.RGBA8);B.bind(g.LINEAR,g.CLAMP_TO_EDGE),C=i.hillshadeFBO=d.createFramebuffer(w,w,!0,"renderbuffer"),C.colorAttachment.set(B.texture)}d.bindFramebuffer.set(C.framebuffer),d.viewport.set([0,0,w,w]);const{tileBoundsBuffer:D,tileBoundsIndexBuffer:L,tileBoundsSegments:O}=h.getMercatorTileBoundsBuffers(),N=[];h.linearFloatFilteringSupported()&&N.push("TERRAIN_DEM_FLOAT_FORMAT"),h.getOrCreateProgram("hillshadePrepare",{defines:N}).draw(h,g.TRIANGLES,oi.disabled,pi.disabled,Pi.unblended,gi.disabled,((B,q)=>{const J=q.stride,X=n.ab.mat4.create();return n.ab.mat4.ortho(X,0,n.ag,-n.ag,0,0,1),n.ab.mat4.translate(X,X,[0,-n.ag,0]),{u_matrix:X,u_image:1,u_dimension:[J,J],u_zoom:B.overscaledZ}})(i.tileID,v),o.id,D,L,O),i.needsHillshadePrepare=!1}class An{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class um extends An{getDefault(){return n.aj.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class hm extends An{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class dm extends An{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class fm extends An{getDefault(){return[!0,!0,!0,!0]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class ly extends An{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class cy extends An{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class rx extends An{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const o=this.current;(i.func!==o.func||i.ref!==o.ref||i.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class rh extends An{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class sh extends An{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=i,this.dirty=!1}}class uy extends An{getDefault(){return[0,1]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Ms extends An{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=i,this.dirty=!1}}class pm extends An{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class Zd extends An{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.BLEND):o.disable(o.BLEND),this.current=i,this.dirty=!1}}class Xd extends An{getDefault(){const i=this.gl;return[i.ONE,i.ZERO,i.ONE,i.ZERO]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.blendFuncSeparate(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class mm extends An{getDefault(){return n.aj.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class _m extends An{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(i,i),this.current=i,this.dirty=!1)}}class Yd extends An{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=i,this.dirty=!1}}class gm extends An{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class ym extends An{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let Kd=class extends An{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class hy extends An{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class dy extends An{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Ic extends An{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class sx extends An{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class ox extends An{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class ax extends An{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class lx extends An{getDefault(){return null}set(i){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class cx extends An{getDefault(){return null}set(i){this.gl&&(i!==this.current||this.dirty)&&(this.gl.bindVertexArray(i),this.current=i,this.dirty=!1)}}class ux extends An{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class vm extends An{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class xm extends An{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Jd extends An{constructor(i,o){super(i),this.context=i,this.parent=o}getDefault(){return null}}class Pc extends Jd{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class bm extends Jd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class fy extends Jd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,this.attachment(),o.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class py extends bm{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const wm=(h,i,o)=>({u_matrix:h,u_image0:0,u_skirt_height:i,u_ground_shadow_factor:o}),rl=(h,i,o,d,g,v,w,C,D,L,O,N,B,q,J,X)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:o,u_zoom_transition:g,u_merc_center:v,u_image0:0,u_frustum_tl:w,u_frustum_tr:C,u_frustum_br:D,u_frustum_bl:L,u_globe_pos:O,u_globe_radius:N,u_viewport:B,u_grid_matrix:X?Float32Array.from(X):new Float32Array(9),u_skirt_height:q,u_far_z_cutoff:J});function Tm(h,i){return h!=null&&i!=null&&!(!h.hasData()||!i.hasData())&&h.demTexture!=null&&i.demTexture!=null&&h.tileID.key!==i.tileID.key}const js=new class{constructor(){this.operations={}}newMorphing(h,i,o,d,g){if(h in this.operations){const v=this.operations[h];v.to.tileID.key!==o.tileID.key&&(v.queued=o)}else this.operations[h]={startTime:d,phase:0,duration:g,from:i,to:o,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const i=this.operations[h];return{from:i.from,to:i.to,phase:i.phase}}update(h){for(const i in this.operations){const o=this.operations[i];for(o.phase=(h-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,h)){delete this.operations[i];break}}}_nextOp(h,i){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=i,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},Qd={0:null,1:"TERRAIN_VERTEX_MORPHING"};function oh(h,i,o){if(i===0)return 0;const d=i<1&&o===514?.25/i:1;return 6*Math.pow(1.5,22-h)*Math.max(i,1)*d}function my(h,i){const o=1<<h.z;return!i&&(h.x===0||h.x===o-1)||h.y===0||h.y===o-1}const ef=h=>({u_matrix:h});function ah(h,i,o,d,g){if(g>0){const v=n.q.now(),w=(v-h.timeAdded)/g,C=i?(v-i.timeAdded)/g:-1,D=o.getSource(),L=d.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),O=!i||Math.abs(i.tileID.overscaledZ-L)>Math.abs(h.tileID.overscaledZ-L),N=O&&h.refreshedUponExpiration?1:n.aw(O?w:1-C,0,1);return h.refreshedUponExpiration&&w>=1&&(h.refreshedUponExpiration=!1),i?{opacity:1,mix:1-N}:{opacity:N,mix:0}}return{opacity:1,mix:0}}class Em extends oo{constructor(i){const o={type:"raster-dem",maxzoom:i.transform.maxZoom},d=new n.D(n.ci(),null),g=ds("mock-dem",o,d,i.style);super("mock-dem",g,!1),g.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,o){i.state="loaded",o(null)}}class hx extends oo{constructor(i){const o=ds("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new n.D(n.ci(),null),i.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,o,d){if(i.freezeTileCoverage)return;this.transform=i;const g=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,w)=>{if(v[w.key]="",!this._tiles[w.key]){const C=new Qa(w,this._source.tileSize*w.overscaleFactor(),i.tileZoom);C.state="loaded",this._tiles[w.key]=C}return v},{});for(const v in this._tiles)v in g||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(i){const o=this.proxyCachedFBO[i];if(o!==void 0){const d=Object.values(o);this.renderCachePool.push(...d),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Sm extends n.aG{constructor(i,o,d){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=o,this.projMatrix=d}}class Rc extends n.cJ{constructor(i,o){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},i.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,g,v]=function(D){const L=new n.b4,O=new n.aU,N=131;L.reserve(17161),O.reserve(33800);const B=n.ag/128,q=n.ag+B/2,J=q+B;for(let ee=-B;ee<J;ee+=B)for(let Q=-B;Q<J;Q+=B){const ae=Q<0||Q>q||ee<0||ee>q?24575:0,pe=n.aw(Math.round(Q),0,n.ag),fe=n.aw(Math.round(ee),0,n.ag);L.emplaceBack(pe+ae,fe)}const X=(ee,Q)=>{const ae=Q*N+ee;O.emplaceBack(ae+1,ae,ae+N),O.emplaceBack(ae+N,ae+N+1,ae+1)};for(let ee=1;ee<129;ee++)for(let Q=1;Q<129;Q++)X(Q,ee);return[0,129].forEach(ee=>{for(let Q=0;Q<130;Q++)X(Q,ee),X(ee,Q)}),[L,O,32768]}(),w=i.context;this.gridBuffer=w.createVertexBuffer(d,n.b6.members),this.gridIndexBuffer=w.createIndexBuffer(g),this.gridSegments=n.b7.simpleSegment(0,0,d.length,g.length),this.gridNoSkirtSegments=n.b7.simpleSegment(0,0,d.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new hx(o.map),this.orthoMatrix=n.ab.mat4.create(),n.ab.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,n.ag,0,n.ag,0,1);const C=w.gl;this._overlapStencilMode=new pi({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Em(o.map),this._pendingGroundEffectLayers=[]}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),this._style=i,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,o,d){if(i&&i.terrain){this._style!==i&&(this.style=i,this._evaluationZoom=void 0);const g=i.terrain.properties,v=i.terrain.drapeRenderMode===0,w=i.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=n.q.now();const C=i.terrain&&i.terrain.scope,D=g.get("source"),L=v?this._mockSourceCache:i.getSourceCache(D,C);if(!L)return void n.w(`Couldn't find terrain source "${D}".`);if(this.sourceCache=L,this._attenuationRange=i.terrain.getAttenuationRange(),this._exaggeration=w?this.calculateExaggeration(o):g.get("exaggeration"),!o.projection.requiresDraping&&w&&this._exaggeration===0)return void this._disable();this.enabled=!0;const O=()=>{this.sourceCache.used&&n.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const N=this.getScaledDemTileSize();this.sourceCache.update(o,N,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,O(),this._initializing=!0),O(),o.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0,this._previousZoom=o.zoom}else this._disable()}calculateExaggeration(i){if(this._attenuationRange&&i.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(i.zoom);const o=this._previousCameraAltitude,d=i.getFreeCameraOptions().position.z/i.pixelsPerMeter*i.worldSize;this._previousCameraAltitude=d;const g=o!=null?d-o:Number.MAX_VALUE;if(Math.abs(g)<2)return this._exaggeration;const v=i.zoom,w=this._style.terrain;if(!this._previousUpdateTimestamp)return w.getExaggeration(v);let C=v-this._previousZoom;const D=this._previousUpdateTimestamp;let L=v;this._evaluationZoom!=null&&(L=this._evaluationZoom,Math.abs(v-L)>.5&&(C=.5*(v-L+C)),C*g<0&&(L+=C)),this._evaluationZoom=L;const O=w.getExaggeration(L),N=O===w.getExaggeration(Math.max(0,L-.1));if(N&&Math.abs(O-this._exaggeration)<.01)return O;let B=Math.min(.1,.00375*(this._updateTimestamp-D));return(N||O<.1||Math.abs(C)<1e-4)&&(B=Math.min(.2,4*B)),n.af(this._exaggeration,O,B)}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._mergedSourceCaches)this._style._mergedSourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(n.aa.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const g=this.proxyCoords=o.getIds().map(D=>{const L=o.getTileByID(D).tileID;return L.projMatrix=d.calculateProjMatrix(L.toUnwrapped()),L});(function(D,L){const O=L.transform.pointCoordinate(L.transform.getCameraPoint()),N=new n.P(O.x,O.y);D.sort((B,q)=>{if(q.overscaledZ-B.overscaledZ)return q.overscaledZ-B.overscaledZ;const J=new n.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),X=new n.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),ee=N.mult(1<<B.canonical.z);return ee.x-=.5,ee.y-=.5,ee.distSqr(J)-ee.distSqr(X)})})(g,this.painter);const v=this.proxyToSource||{};this.proxyToSource={},g.forEach(D=>{this.proxyToSource[D.key]={}}),this.terrainTileForTile={};const w=this._style._mergedSourceCaches;for(const D in w){const L=w[D];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,i[D],v),L.usedForTerrain))continue;const O=i[D];L.getSource().reparseOverscaled&&this._assignTerrainTiles(O)}this.proxiedCoords[o.id]=g.map(D=>new Sm(D,D.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1;const C={};this._visibleDemTiles=[];for(const D of this.proxyCoords){const L=this.terrainTileForTile[D.key];if(!L)continue;const O=L.tileID.key;O in C||(this._visibleDemTiles.push(L),C[O]=O)}}_assignTerrainTiles(i){this._initializing||i.forEach(o=>{if(this.terrainTileForTile[o.key])return;const d=this._findTileCoveringTileID(o,this.sourceCache);d&&(this.terrainTileForTile[o.key]=d)})}_prepareDEMTextures(){const i=this.painter.context,o=i.gl;for(const d in this.terrainTileForTile){const g=this.terrainTileForTile[d],v=g.dem;!v||g.demTexture&&!g.needsDEMTextureUpload||(i.activeTexture.set(o.TEXTURE1),ay(this.painter,g,v))}}_prepareDemTileUniforms(i,o,d,g){if(!o||o.demTexture==null)return!1;const v=i.tileID.canonical,w=Math.pow(2,o.tileID.canonical.z-v.z),C=g||"";return d[`u_dem_tl${C}`]=[v.x*w%1,v.y*w%1],d[`u_dem_scale${C}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let i=0;const o=this._visibleDemTiles.reduce((d,g)=>{if(!g.dem)return d;const v=g.dem.tree.minimums[0];return v>0&&i++,d+v},0);return i?o/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,o=i.gl;i.activeTexture.set(o.TEXTURE2);const d=this._getLoadedAreaMinimum(),g=new n.cK({width:1,height:1},new Float32Array([d]));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(g,{premultiply:!1}):v=this._emptyDEMTexture=new n.T(i,g,o.R32F,{premultiply:!1}),v}setupElevationDraw(i,o,d){const g=this.painter.context,v=g.gl,w={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};w.u_exaggeration=this.exaggeration();let C=null,D=null,L=1;if(d&&d.morphing&&this._useVertexMorphing){const q=d.morphing.srcDemTile,J=d.morphing.dstDemTile;L=d.morphing.phase,q&&J&&(this._prepareDemTileUniforms(i,q,w,"_prev")&&(D=q),this._prepareDemTileUniforms(i,J,w)&&(C=J))}const O=q=>q&&q.demTexture&&this.painter.linearFloatFilteringSupported()?v.LINEAR:v.NEAREST;let N=null;var B;if(this.enabled?D&&C?(N=C.demTexture,g.activeTexture.set(v.TEXTURE4),D.demTexture.bind(O(D),v.CLAMP_TO_EDGE),w.u_dem_lerp=L):(C=this.terrainTileForTile[i.tileID.key],N=this._prepareDemTileUniforms(i,C,w)?C.demTexture:this.emptyDEMTexture):N=this.emptyDEMTexture,g.activeTexture.set(v.TEXTURE2),N&&(w.u_dem_size=(B=N).size[0]===1?1:B.size[0]-2,N.bind(O(C),v.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(d&&d.useDepthForOcclusion,o,w),d&&d.useMeterToDem&&C){const q=(1<<C.tileID.canonical.z)*n.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=q}if(d&&d.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),o.setTerrainUniformValues(g,w),this.painter.transform.projection.name==="globe"){const q=this.globeUniformValues(this.painter.transform,i.tileID.canonical,d&&d.useDenormalizedUpVectorScale);o.setGlobeUniformValues(g,q)}}globeUniformValues(i,o,d){const g=i.projection;return{u_tile_tl_up:g.upVector(o,0,0),u_tile_tr_up:g.upVector(o,n.ag,0),u_tile_br_up:g.upVector(o,n.ag,n.ag),u_tile_bl_up:g.upVector(o,0,n.ag),u_tile_up_scale:d?n.cL(1):g.upVectorScale(o,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const o=this.painter,d=this.painter.context;i.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(g,v,w,C,D){if(g.transform.projection.name==="globe")(function(L,O,N,B,q){const J=L.context,X=J.gl;let ee,Q;const ae=L.transform,pe=n.cC(L,J,ae),fe=(ct,lt)=>{if(Q===lt)return;const $e=[Qd[lt],"PROJECTION_GLOBE_VIEW"];pe&&$e.push("CUSTOM_ANTIALIASING");const it=L.isTileAffectedByFog(ct);ee=L.getOrCreateProgram("globeRaster",{defines:$e,overrideFog:it}),Q=lt},we=L.colorModeForRenderPass(),ge=new oi(X.LEQUAL,oi.ReadWrite,L.depthRangeFor3D);js.update(q);const ve=n.cD(ae),_e=[n.at(ae.center.lng),n.aA(ae.center.lat)],Me=L.globeSharedBuffers,ke=[ae.width*n.q.devicePixelRatio,ae.height*n.q.devicePixelRatio],tt=Float32Array.from(ae.globeMatrix),We={useDenormalizedUpVectorScale:!0};{const ct=L.transform,lt=oh(ct.zoom,O.exaggeration(),O.sourceCache._source.tileSize);Q=-1;const $e=X.TRIANGLES;for(const it of B){const gt=N.getTile(it),Ue=pi.disabled,ht=O.prevTerrainTileForTile[it.key],nt=O.terrainTileForTile[it.key];Tm(ht,nt)&&js.newMorphing(it.key,ht,nt,q,250),J.activeTexture.set(X.TEXTURE0),gt.texture&&gt.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const St=js.getMorphValuesForProxy(it.key),pt=St?1:0;St&&n.J(We,{morphing:{srcDemTile:St.from,dstDemTile:St.to,phase:n.cB(St.phase)}});const ut=n.cE(it.canonical),vt=n.cF(ut.getCenter().lat),Et=n.cG(it.canonical,ut,vt,ct.worldSize/ct._pixelsPerMercatorPixel),Nt=n.bb(n.cH(it.canonical)),$t=rl(ct.expandedFarZProjMatrix,tt,ve,Nt,n.ae(ct.zoom),_e,ct.frustumCorners.TL,ct.frustumCorners.TR,ct.frustumCorners.BR,ct.frustumCorners.BL,ct.globeCenterInViewSpace,ct.globeRadius,ke,lt,ct._farZ,Et);if(fe(it,pt),ee&&(O.setupElevationDraw(gt,ee,We),L.uploadCommonUniforms(J,ee,it.toUnwrapped()),Me)){const[fi,ri,ai]=Me.getGridBuffers(vt,lt!==0);ee.draw(L,$e,ge,Ue,we,gi.backCCW,$t,"globe_raster",fi,ri,ai)}}}if(Me&&(L.renderDefaultNorthPole||L.renderDefaultSouthPole)){const ct=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];pe&&ct.push("CUSTOM_ANTIALIASING"),ee=L.getOrCreateProgram("globeRaster",{defines:ct});for(const lt of B){const{x:$e,y:it,z:gt}=lt.canonical,Ue=it===0,ht=it===(1<<gt)-1,[nt,St,pt,ut]=Me.getPoleBuffers(gt,!1);if(ut&&(Ue||ht)){const vt=N.getTile(lt);J.activeTexture.set(X.TEXTURE0),vt.texture&&vt.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);let Et=n.cI(gt,$e,ae);const Nt=n.bb(n.cH(lt.canonical)),$t=(fi,ri)=>fi.draw(L,X.TRIANGLES,ge,pi.disabled,we,gi.disabled,rl(ae.expandedFarZProjMatrix,Et,Et,Nt,0,_e,ae.frustumCorners.TL,ae.frustumCorners.TR,ae.frustumCorners.BR,ae.frustumCorners.BL,ae.globeCenterInViewSpace,ae.globeRadius,ke,0,ae._farZ),"globe_pole_raster",ri,pt,ut);O.setupElevationDraw(vt,ee,We),L.uploadCommonUniforms(J,ee,lt.toUnwrapped()),Ue&&L.renderDefaultNorthPole&&$t(ee,nt),ht&&L.renderDefaultSouthPole&&(Et=n.ab.mat4.scale(n.ab.mat4.create(),Et,[1,-1,1]),$t(ee,St))}}}})(g,v,w,C,D);else{const L=g.context,O=L.gl;let N,B;const q=g.shadowRenderer,J=il(g,g.longestCutoffRange),X=we=>{if(B===we)return;const ge=[];ge.push(Qd[we]),J.shouldRenderCutoff&&ge.push("RENDER_CUTOFF"),q&&(ge.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&ge.push("NORMAL_OFFSET")),N=g.getOrCreateProgram("terrainRaster",{defines:ge}),B=we},ee=g.colorModeForRenderPass(),Q=new oi(O.LEQUAL,oi.ReadWrite,g.depthRangeFor3D);js.update(D);const ae=g.transform,pe=oh(ae.zoom,v.exaggeration(),v.sourceCache._source.tileSize);let fe=[0,0,0];if(q){const we=g.style.directionalLight,ge=g.style.ambientLight;we&&ge&&(fe=rm(g.style,we,ge))}{B=-1;const we=O.TRIANGLES,[ge,ve]=[v.gridIndexBuffer,v.gridSegments];for(const _e of C){const Me=w.getTile(_e),ke=pi.disabled,tt=v.prevTerrainTileForTile[_e.key],We=v.terrainTileForTile[_e.key];Tm(tt,We)&&js.newMorphing(_e.key,tt,We,D,250),L.activeTexture.set(O.TEXTURE0),Me.texture&&Me.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const ct=js.getMorphValuesForProxy(_e.key),lt=ct?1:0;let $e;ct&&($e={morphing:{srcDemTile:ct.from,dstDemTile:ct.to,phase:n.cB(ct.phase)}});const it=wm(_e.projMatrix,my(_e.canonical,ae.renderWorldCopies)?pe/10:pe,fe);if(X(lt),!N)continue;v.setupElevationDraw(Me,N,$e);const gt=_e.toUnwrapped();q&&q.setupShadows(gt,N),g.uploadCommonUniforms(L,N,gt,null,J),N.draw(g,we,Q,ke,ee,gi.backCCW,it,"terrain_raster",v.gridBuffer,ge,ve)}}}}(o,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const o=this.painter,d=this.painter.context,g=this.proxySourceCache,v=this.proxiedCoords[g.id],w=this._drapedRenderBatches.shift(),C=o.style.order,D=[];let L=0;for(const O of v){const N=g.getTileByID(O.proxyTileKey),B=g.proxyCachedFBO[O.key]?g.proxyCachedFBO[O.key][i]:void 0,q=B!==void 0?g.renderCache[B]:this.pool[L++],J=B!==void 0;if(N.texture=q.tex,J&&!q.dirty){D.push(N.tileID);continue}let X;d.bindFramebuffer.set(q.fb.framebuffer),this.renderedToTile=!1,q.dirty&&(d.clear({color:n.aj.transparent,stencil:0}),q.dirty=!1);for(let ee=w.start;ee<=w.end;++ee){const Q=o.style._mergedLayers[C[ee]];if(Q.isHidden(o.transform.zoom))continue;const ae=o.style.getLayerSourceCache(Q),pe=ae?this.proxyToSource[O.key][ae.id]:[O];if(!pe)continue;const fe=pe;d.viewport.set([0,0,q.fb.width,q.fb.height]),X!==(ae?ae.id:null)&&(this._setupStencil(q,pe,Q,ae),X=ae?ae.id:null),o.renderLayer(o,ae,Q,fe)}if(this._drapedRenderBatches.length===0)for(const ee of this._pendingGroundEffectLayers){const Q=o.style._mergedLayers[C[ee]];if(Q.isHidden(o.transform.zoom))continue;const ae=o.style.getLayerSourceCache(Q),pe=ae?this.proxyToSource[O.key][ae.id]:[O];if(!pe)continue;const fe=pe;d.viewport.set([0,0,q.fb.width,q.fb.height]),X!==(ae?ae.id:null)&&(this._setupStencil(q,pe,Q,ae),X=ae?ae.id:null),o.renderLayer(o,ae,Q,fe)}this.renderedToTile?(q.dirty=!0,D.push(N.tileID)):J||--L,L===5&&(L=0,this.renderToBackBuffer(D))}return this.renderToBackBuffer(D),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,o.width,o.height]),w.end+1}postRender(){}isLayerOrderingCorrect(i){const o=i.order.length;let d=-1,g=o;for(let v=0;v<o;++v)this._style.isLayerDraped(i._mergedLayers[i.order[v]])?d=Math.max(d,v):g=Math.min(g,v);return g>d}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{i=Math.min(i,o.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,o,d){if(!this._visibleDemTiles)return null;const g=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const w=v.tileID,C=1<<w.overscaledZ,{x:D,y:L}=w.canonical,O=D/C,N=(D+1)/C,B=L/C,q=(L+1)/C;return{minx:O,miny:B,maxx:N,maxy:q,t:v.dem.tree.raycastRoot(O,B,N,q,i,o,d),tile:v}});g.sort((v,w)=>(v.t!==null?v.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const v of g){if(v.t==null)return null;const w=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,i,o,d);if(w!=null)return w}return null}_createFBO(){const i=this.painter.context,o=i.gl,d=this.drapeBufferSize;i.activeTexture.set(o.TEXTURE0);const g=new n.T(i,{width:d[0],height:d[1],data:null},o.RGBA8);g.bind(o.LINEAR,o.CLAMP_TO_EDGE);const v=i.createFramebuffer(d[0],d[1],!0,null);return v.colorAttachment.set(g.texture),v.depthAttachment=new py(i,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:v,tex:g,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const o=this._style._mergedLayers[i],d=o.isHidden(this.painter.transform.zoom);return o.type==="hillshade"||o.type==="custom"?!d&&o.shouldRedrape():!d&&o.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const d of this._style.getSources())if(d instanceof tr){i=!0;break}if(!i)return;const o={};for(let d=0;d<this._style.order.length;++d){const g=this._style._mergedLayers[this._style.order[d]],v=this._style.getLayerSourceCache(g);if(v&&!o[v.id]&&!g.isHidden(this.painter.transform.zoom)&&g.type==="line"&&g.widthExpression()instanceof n.a9){o[v.id]=!0;for(const w of this.proxyCoords){const C=this.proxyToSource[w.key][v.id];if(C)for(const D of C)this._clearRenderCacheForTile(v.id,D)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof Jo){i=!0;break}if(!i)return;const o={};for(let d=0;d<this._style.order.length;++d){const g=this._style._mergedLayers[this._style.order[d]],v=this._style.getLayerSourceCache(g);if(!v||o[v.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="raster")continue;const w=g.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const D=this.proxyToSource[C.key][v.id];if(D)for(const L of D){const O=ah(v.getTile(L),v.findLoadedParent(L,0),v,this.painter.transform,w);(O.opacity!==1||O.mix!==0)&&this._clearRenderCacheForTile(v.id,L)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const i=this._style.order,o=i.length;if(o===0)return;const d=[];this._pendingGroundEffectLayers=[];let g,v=0,w=this._style._mergedLayers[i[v]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++v<o;)w=this._style._mergedLayers[i[v]];for(;v<o;++v){const C=this._style._mergedLayers[i[v]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?g===void 0&&(g=v):(C.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(v),g!==void 0&&(d.push({start:g,end:v-1}),g=void 0)))}if(g!==void 0&&d.push({start:g,end:v-1}),d.length!==0){const C=d[d.length-1];this._pendingGroundEffectLayers.every(D=>D>C.end)||n.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(i){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const w=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let C=0;C<w.length;++C){const D=Object.values(w[C]);o.renderCachePool.push(...D)}}return}this._clearRasterLayersFromRenderCache();const d=this.proxyCoords,g=this._tilesDirty;for(let w=d.length-1;w>=0;w--){const C=d[w];if(o.getTileByID(C.key),o.proxyCachedFBO[C.key]!==void 0){const D=i[C.key],L=this.proxyToSource[C.key];let O=0;for(const N in L){const B=L[N],q=D[N];if(!q||q.length!==B.length||B.some((J,X)=>J!==q[X]||g[N]&&g[N].hasOwnProperty(J.key))){O=-1;break}++O}for(const N in o.proxyCachedFBO[C.key])o.renderCache[o.proxyCachedFBO[C.key][N]].dirty=O<0||O!==Object.values(D).length}}const v=[...this._drapedRenderBatches];v.sort((w,C)=>C.end-C.start-(w.end-w.start));for(const w of v)for(const C of d){if(o.proxyCachedFBO[C.key])continue;let D=o.renderCachePool.pop();D===void 0&&o.renderCache.length<50&&(D=o.renderCache.length,o.renderCache.push(this._createFBO())),D!==void 0&&(o.proxyCachedFBO[C.key]={},o.proxyCachedFBO[C.key][w.start]=D,o.renderCache[D].dirty=!0)}this._tilesDirty={}}_setupStencil(i,o,d,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,w=v.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let C;if(d.isTileClipped())C=o.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):pi.disabled}_renderTileClippingMasks(i,o){const d=this.painter,g=this.painter.context,v=g.gl;d._tileClippingMaskIDs={},g.setColorMode(Pi.disabled),g.setDepthMode(oi.disabled);const w=d.getOrCreateProgram("clippingMask");for(const C of i){const D=d._tileClippingMaskIDs[C.key]=--o;w.draw(d,v.TRIANGLES,oi.disabled,new pi({func:v.ALWAYS,mask:0},D,255,v.KEEP,v.KEEP,v.REPLACE),Pi.disabled,gi.disabled,ef(C.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(i){const o=this.painter.transform;if(i.x<0||i.x>o.width||i.y<0||i.y>o.height)return null;const d=[i.x,i.y,1,1];n.ab.vec4.transformMat4(d,d,o.pixelMatrixInverse),n.ab.vec4.scale(d,d,1/d[3]),d[0]/=o.worldSize,d[1]/=o.worldSize;const g=o._camera.position,v=n.bH(1,o.center.lat),w=[g[0],g[1],g[2]/v,0],C=n.ab.vec3.subtract([],d.slice(0,3),w);n.ab.vec3.normalize(C,C);const D=this.raycast(w,C,this._exaggeration);return D!==null&&D?(n.ab.vec3.scaleAndAdd(w,w,C,D),w[3]=w[2],w[2]*=v,w):null}_setupProxiedCoordsForOrtho(i,o,d){if(i.getSource()instanceof n.aJ)return this._setupProxiedCoordsForImageSource(i,o,d);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const g=this.proxiedCoords[i.id]=[],v=this.proxyCoords;for(let D=0;D<v.length;D++){const L=v[D],O=this._findTileCoveringTileID(L,i);if(O){const N=this._createProxiedId(L,O,d[L.key]&&d[L.key][i.id]);g.push(N),this.proxyToSource[L.key][i.id]=[N]}}let w=!1;const C=new Set;for(let D=0;D<o.length;D++){const L=i.getTile(o[D]);if(!L||!L.hasData())continue;const O=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==L.tileID.canonical.z){const N=this.proxyToSource[O.tileID.key][i.id],B=this._createProxiedId(O.tileID,L,d[O.tileID.key]&&d[O.tileID.key][i.id]);N?N.splice(N.length-1,0,B):this.proxyToSource[O.tileID.key][i.id]=[B];const q=this.proxyToSource[O.tileID.key][i.id];C.has(q)||C.add(q),g.push(B),w=!0}}if(this._sourceTilesOverlap[i.id]=w,w&&this._debugParams.sortTilesHiZFirst)for(const D of C)D.sort((L,O)=>O.overscaledZ-L.overscaledZ)}_setupProxiedCoordsForImageSource(i,o,d){if(!i.getSource().loaded())return;const g=this.proxiedCoords[i.id]=[],v=this.proxyCoords,w=i.getSource(),C=w.tileID;if(!C)return;const D=new n.P(C.x,C.y)._div(1<<C.z),L=w.coordinates.map(n.aa.fromLngLat).reduce((N,B)=>(N.min.x=Math.min(N.min.x,B.x-D.x),N.min.y=Math.min(N.min.y,B.y-D.y),N.max.x=Math.max(N.max.x,B.x-D.x),N.max.y=Math.max(N.max.y,B.y-D.y),N),{min:new n.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(N,B)=>{const q=N.wrap+N.canonical.x/(1<<N.canonical.z),J=N.canonical.y/(1<<N.canonical.z),X=n.ag/(1<<N.canonical.z),ee=B.wrap+B.canonical.x/(1<<B.canonical.z),Q=B.canonical.y/(1<<B.canonical.z);return q+X<ee+L.min.x||q>ee+L.max.x||J+X<Q+L.min.y||J>Q+L.max.y};for(let N=0;N<v.length;N++){const B=v[N];for(let q=0;q<o.length;q++){const J=i.getTile(o[q]);if(!J||!J.hasData()||O(B,J.tileID))continue;const X=this._createProxiedId(B,J,d[B.key]&&d[B.key][i.id]),ee=this.proxyToSource[B.key][i.id];ee?ee.push(X):this.proxyToSource[B.key][i.id]=[X],g.push(X)}}}_createProxiedId(i,o,d){let g=this.orthoMatrix;if(d){const v=d.find(w=>w.key===o.tileID.key);if(v)return v}if(o.tileID.key!==i.key){const v=i.canonical.z-o.tileID.canonical.z;let w,C,D;g=n.ab.mat4.create();const L=o.tileID.wrap-i.wrap<<i.overscaledZ;v>0?(w=n.ag>>v,C=w*((o.tileID.canonical.x<<v)-i.canonical.x+L),D=w*((o.tileID.canonical.y<<v)-i.canonical.y)):(w=n.ag<<-v,C=n.ag*(o.tileID.canonical.x-(i.canonical.x+L<<-v)),D=n.ag*(o.tileID.canonical.y-(i.canonical.y<<-v))),n.ab.mat4.ortho(g,0,w,0,w,0,1),n.ab.mat4.translate(g,g,[C,D,0])}return new Sm(o.tileID,i.key,g)}_findTileCoveringTileID(i,o){let d=o.getTile(i);if(d&&d.hasData())return d;const g=this._findCoveringTileCache[o.id],v=g[i.key];if(d=v?o.getTileByID(v):null,d&&d.hasData()||v===null)return d;let w=d?d.tileID:i,C=w.overscaledZ;const D=o.getSource().minzoom,L=[];if(!v){const N=o.getSource().maxzoom;if(i.canonical.z>=N){const B=i.canonical.z-N;o.getSource().reparseOverscaled?(C=Math.max(i.canonical.z+2,o.transform.tileZoom),w=new n.aG(C,i.wrap,N,i.canonical.x>>B,i.canonical.y>>B)):B!==0&&(C=N,w=new n.aG(C,i.wrap,N,i.canonical.x>>B,i.canonical.y>>B))}w.key!==i.key&&(L.push(w.key),d=o.getTile(w))}const O=N=>{L.forEach(B=>{g[B]=N}),L.length=0};for(C-=1;C>=D&&(!d||!d.hasData());C--){d&&O(d.tileID.key);const N=w.calculateScaledKey(C);if(d=o.getTileByID(N),d&&d.hasData())break;const B=g[N];if(B===null)break;B===void 0?L.push(N):d=o.getTileByID(B)}return O(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,o){let d=this._tilesDirty[i];d||(d=this._tilesDirty[i]={}),d[o.key]=!0}}function dx(h,i,o){const d=function(C,D,L){const O=n.ab.vec3.dot(D,C),N=n.ab.vec3.dot(L,[.2126,.7152,.0722]),B=(J,X,ee)=>(1-ee)*J+ee*X,q=B(1-.3*Math.min(N,1),1,Math.min(O+1,1));return B(.92,1,Math.asin(n.aw(D[2],-1,1))/Math.PI+.5)*q}(h,[0,0,1],i),g=[0,0,0];n.ab.vec3.scale(g,o.slice(0,3),d);const v=[0,0,0];n.ab.vec3.scale(v,i.slice(0,3),h[2]);const w=[0,0,0];return n.ab.vec3.add(w,g,v),n.cf(w)}const fx=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],_y=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class gy{static cacheKey(i,o,d,g){let v=`${o}${g?g.cacheKey:""}`;for(const w of d)i.usedDefines.includes(w)&&(v+=`/${w}`);return v}constructor(i,o,d,g,v,w){const C=i.gl;this.program=C.createProgram(),this.configuration=g,this.name=o,this.fixedDefines=[...w];const D=g?g.getBinderAttributes():[],L=(d.staticAttributes||[]).concat(D);let O=g?g.defines():[];O=O.concat(w.map(ee=>`#define ${ee}`));const N=`#version 300 es
`;let B=N+O.concat("precision mediump float;",nh,Wd.fragmentSource).join(`
`);for(const ee of d.fragmentIncludes)B+=`
${Ac[ee]}`;B+=`
${d.fragmentSource}`;let q=N+O.concat("precision highp float;",nh,Wd.vertexSource).join(`
`);for(const ee of d.vertexIncludes)q+=`
${Ac[ee]}`;this.forceManualRenderingForInstanceIDShaders=i.forceManualRenderingForInstanceIDShaders&&d.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(q+=`
uniform int u_instanceID;
`),q+=`
${d.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(q=q.replaceAll("gl_InstanceID","u_instanceID"));const J=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(J,B),C.compileShader(J),C.attachShader(this.program,J);const X=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(X,q),C.compileShader(X),C.attachShader(this.program,X),this.attributes={},this.numAttributes=L.length;for(let ee=0;ee<this.numAttributes;ee++)if(L[ee]){const Q=L[ee].startsWith("a_")?L[ee]:`a_${L[ee]}`;C.bindAttribLocation(this.program,ee,Q),this.attributes[Q]=ee}C.linkProgram(this.program),C.deleteShader(X),C.deleteShader(J),this.fixedUniforms=v(i),this.binderUniforms=g?g.getUniforms(i):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(ee=>({u_instanceID:new n.bN(ee)}))(i)),(w.includes("TERRAIN")||o.indexOf("symbol")!==-1||o.indexOf("circle")!==-1)&&(this.terrainUniforms=(ee=>({u_dem:new n.bN(ee),u_dem_prev:new n.bN(ee),u_dem_tl:new n.bK(ee),u_dem_scale:new n.bM(ee),u_dem_tl_prev:new n.bK(ee),u_dem_scale_prev:new n.bM(ee),u_dem_size:new n.bM(ee),u_dem_lerp:new n.bM(ee),u_exaggeration:new n.bM(ee),u_depth:new n.bN(ee),u_depth_size_inv:new n.bK(ee),u_depth_range_unpack:new n.bK(ee),u_occluder_half_size:new n.bM(ee),u_occlusion_depth_offset:new n.bM(ee),u_meter_to_dem:new n.bM(ee),u_label_plane_matrix_inv:new n.bJ(ee)}))(i)),w.includes("GLOBE")&&(this.globeUniforms=(ee=>({u_tile_tl_up:new n.bL(ee),u_tile_tr_up:new n.bL(ee),u_tile_br_up:new n.bL(ee),u_tile_bl_up:new n.bL(ee),u_tile_up_scale:new n.bM(ee)}))(i)),w.includes("FOG")&&(this.fogUniforms=(ee=>({u_fog_matrix:new n.bJ(ee),u_fog_range:new n.bK(ee),u_fog_color:new n.ca(ee),u_fog_horizon_blend:new n.bM(ee),u_fog_vertical_limit:new n.bK(ee),u_fog_temporal_offset:new n.bM(ee),u_frustum_tl:new n.bL(ee),u_frustum_tr:new n.bL(ee),u_frustum_br:new n.bL(ee),u_frustum_bl:new n.bL(ee),u_globe_pos:new n.bL(ee),u_globe_radius:new n.bM(ee),u_globe_transition:new n.bM(ee),u_is_globe:new n.bN(ee),u_viewport:new n.bK(ee)}))(i)),w.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ee=>({u_cutoff_params:new n.ca(ee)}))(i)),w.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ee=>({u_lighting_ambient_color:new n.bL(ee),u_lighting_directional_dir:new n.bL(ee),u_lighting_directional_color:new n.bL(ee),u_ground_radiance:new n.bL(ee)}))(i)),w.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ee=>({u_light_matrix_0:new n.bJ(ee),u_light_matrix_1:new n.bJ(ee),u_fade_range:new n.bK(ee),u_shadow_normal_offset:new n.bL(ee),u_shadow_intensity:new n.bM(ee),u_shadow_texel_size:new n.bM(ee),u_shadow_map_resolution:new n.bM(ee),u_shadow_direction:new n.bL(ee),u_shadow_bias:new n.bL(ee),u_shadowmap_0:new n.bN(ee),u_shadowmap_1:new n.bN(ee)}))(i))}}setTerrainUniformValues(i,o){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const g in o)d[g]&&d[g].set(this.program,g,o[g])}}setGlobeUniformValues(i,o){if(!this.globeUniforms)return;const d=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const g in o)d[g]&&d[g].set(this.program,g,o[g])}}setFogUniformValues(i,o){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const g in o)d[g].set(this.program,g,o[g])}}setCutoffUniformValues(i,o){if(!this.cutoffUniforms)return;const d=this.cutoffUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const g in o)d[g].set(this.program,g,o[g])}}setLightsUniformValues(i,o){if(!this.lightsUniforms)return;const d=this.lightsUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const g in o)d[g].set(this.program,g,o[g])}}setShadowUniformValues(i,o){if(this.failedToCreate||!this.shadowUniforms)return;const d=this.shadowUniforms;i.program.set(this.program);for(const g in o)d[g].set(this.program,g,o[g])}_drawDebugWireframe(i,o,d,g,v,w,C,D,L,O){const N=i.options.wireframe;if(N.terrain===!1&&N.layers2D===!1&&N.layers3D===!1)return;const B=i.context;if(!(()=>!(!N.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!N.layers2D||i._terrain&&i._terrain.renderingToTexture||!fx.includes(this.name))||!(!N.layers3D||!_y.includes(this.name)))())return;const q=B.gl,J=i.wireframeDebugCache.getLinesFromTrianglesBuffer(i.frameCounter,v,B);if(!J)return;const X=[...this.fixedDefines];X.push("DEBUG_WIREFRAME");const ee=i.getOrCreateProgram(this.name,{config:this.configuration,defines:X});B.program.set(ee.program);const Q=(fe,we,ge)=>{if(we[fe]&&ge[fe])for(const ve in we[fe])ge[fe][ve]&&ge[fe][ve].set(ge.program,ve,we[fe][ve].current)};L&&L.setUniforms(ee.program,B,ee.binderUniforms,C,{zoom:D}),Q("fixedUniforms",this,ee),Q("terrainUniforms",this,ee),Q("globeUniforms",this,ee),Q("fogUniforms",this,ee),Q("lightsUniforms",this,ee),Q("shadowUniforms",this,ee),J.bind(),B.setColorMode(new Pi([q.ONE,q.ONE_MINUS_SRC_ALPHA,q.ZERO,q.ONE],n.aj.transparent,[!0,!0,!0,!1])),B.setDepthMode(new oi(o.func===q.LESS?q.LEQUAL:o.func,oi.ReadOnly,o.range)),B.setStencilMode(pi.disabled);const ae=3*w.primitiveLength*2,pe=3*w.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const fe=O||1;for(let we=0;we<fe;++we)ee.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",we),q.drawElements(q.LINES,ae,q.UNSIGNED_SHORT,pe)}else O&&O>1?q.drawElementsInstanced(q.LINES,ae,q.UNSIGNED_SHORT,pe,O):q.drawElements(q.LINES,ae,q.UNSIGNED_SHORT,pe);v.bind(),B.program.set(this.program),B.setDepthMode(o),B.setStencilMode(d),B.setColorMode(g)}checkUniforms(i,o,d){if(this.fixedDefines.includes(o)){for(const g of Object.keys(d))if(!d[g].initialized)throw new Error(`Program '${this.name}', from draw '${i}': uniform ${g} not set but required by ${o} being defined`)}}draw(i,o,d,g,v,w,C,D,L,O,N,B,q,J,X,ee){const Q=i.context,ae=Q.gl;if(this.failedToCreate)return;Q.program.set(this.program),Q.setDepthMode(d),Q.setStencilMode(g),Q.setColorMode(v),Q.setCullFace(w);for(const we of Object.keys(this.fixedUniforms))this.fixedUniforms[we].set(this.program,we,C[we]);J&&J.setUniforms(this.program,Q,this.binderUniforms,B,{zoom:q});const pe={[ae.POINTS]:1,[ae.LINES]:2,[ae.TRIANGLES]:3,[ae.LINE_STRIP]:1}[o];this.checkUniforms(D,"RENDER_SHADOWS",this.shadowUniforms);const fe=ee&&ee>0?1:void 0;for(const we of N.get()){const ge=we.vaos||(we.vaos={});if((ge[D]||(ge[D]=new sy)).bind(Q,this,L,J?J.getPaintVertexBuffers():[],O,we.vertexOffset,X||[],fe),this.forceManualRenderingForInstanceIDShaders){const ve=ee||1;for(let _e=0;_e<ve;++_e)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",_e),O?ae.drawElements(o,we.primitiveLength*pe,ae.UNSIGNED_SHORT,we.primitiveOffset*pe*2):ae.drawArrays(o,we.vertexOffset,we.vertexLength)}else ee&&ee>1?ae.drawElementsInstanced(o,we.primitiveLength*pe,ae.UNSIGNED_SHORT,we.primitiveOffset*pe*2,ee):O?ae.drawElements(o,we.primitiveLength*pe,ae.UNSIGNED_SHORT,we.primitiveOffset*pe*2):ae.drawArrays(o,we.vertexOffset,we.vertexLength);o===ae.TRIANGLES&&O&&this._drawDebugWireframe(i,d,g,v,O,we,B,q,J,ee)}}}function tf(h,i){const o=Math.pow(2,i.tileID.overscaledZ),d=i.tileSize*Math.pow(2,h.transform.tileZoom)/o,g=d*(i.tileID.canonical.x+i.tileID.wrap*o),v=d*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/n.ar(i,1,h.transform.tileZoom),u_pixel_coord_upper:[g>>16,v>>16],u_pixel_coord_lower:[65535&g,65535&v]}}const Dc={terrain:0,flat:1},Lc=n.ab.mat4.create(),nf=(h,i,o,d,g,v,w,C,D,L,O,N,B,q,J,X,ee,Q)=>{const ae=i.style.light,pe=ae.properties.get("position"),fe=[pe.x,pe.y,pe.z],we=n.ab.mat3.create();ae.properties.get("anchor")==="viewport"&&(n.ab.mat3.fromRotation(we,-i.transform.angle),n.ab.vec3.transformMat3(fe,fe,we));const ge=ae.properties.get("color"),ve=i.transform,_e={u_matrix:h,u_lightpos:fe,u_lightintensity:ae.properties.get("intensity"),u_lightcolor:[ge.r,ge.g,ge.b],u_vertical_gradient:+o,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Lc,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Dc[L],u_base_type:Dc[O],u_ao:g,u_edge_radius:v,u_width_scale:w,u_flood_light_color:J,u_vertical_scale:X,u_flood_light_intensity:ee,u_ground_shadow_factor:Q};return ve.projection.name==="globe"&&(_e.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],_e.u_zoom_transition=N,_e.u_inv_rot_matrix=q,_e.u_merc_center=B,_e.u_up_dir=ve.projection.upVector(new n.bT(0,0,0),B[0]*n.ag,B[1]*n.ag),_e.u_height_lift=D),_e},lh=(h,i,o,d,g,v)=>({u_matrix:h,u_edge_radius:i,u_width_scale:o,u_vertical_scale:d,u_height_type:Dc[g],u_base_type:Dc[v]}),yy=(h,i,o,d,g,v,w,C,D,L,O,N,B,q,J,X,ee)=>{const Q=nf(h,i,o,d,g,v,w,C,L,O,N,B,q,J,X,ee,1,[0,0,0]),ae={u_height_factor:-Math.pow(2,C.overscaledZ)/D.tileSize/8};return n.l(Q,tf(i,D),ae)},ch=(h,i)=>({u_matrix:h,u_emissive_strength:i}),uh=(h,i,o,d)=>n.l(ch(h,i),tf(o,d)),Am=(h,i,o)=>({u_matrix:h,u_world:o,u_emissive_strength:i}),vy=(h,i,o,d,g)=>n.l(uh(h,i,o,d),{u_world:g}),px=(h,i,o,d)=>{const g=n.ag/o.tileSize;return{u_matrix:h,u_camera_to_center_distance:i.getCameraToCenterDistance(d),u_extrude_scale:[i.pixelsToGLUnits[0]/g,i.pixelsToGLUnits[1]/g]}},Ul=(h,i,o=1)=>({u_matrix:h,u_color:i.toRenderColor(null),u_overlay:0,u_overlay_scale:o}),rf=n.ab.mat4.create(),Gt=(h,i,o,d,g,v,w)=>{const C=h.transform,D=C.projection.name==="globe",L=D?n.cN(C.zoom,i.canonical)*C._pixelsPerMercatorPixel:n.ar(o,1,v),O={u_matrix:i.projMatrix,u_extrude_scale:L,u_intensity:w,u_inv_rot_matrix:rf,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){O.u_inv_rot_matrix=d,O.u_merc_center=g,O.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],O.u_zoom_transition=n.ae(C.zoom);const N=g[0]*n.ag,B=g[1]*n.ag;O.u_up_dir=C.projection.upVector(new n.bT(0,0,0),N,B)}return O};function Mm(h,[i,o,d,g],[v,w]){if(v===w)return[0,0,0,0];const C=255*(h-1)/(h*(w-v));return[i*C,o*C,d*C,g*C]}function Cm(h,i,[o,d]){return o===d?0:.5/h+(i-o)*(h-1)/(h*(d-o))}const sl=(h,i,o,d,g,v,w,C,D,L,O,N,B,q,J,X,ee,Q,ae,pe,fe)=>({u_matrix:h,u_normalize_matrix:i,u_globe_matrix:o,u_merc_matrix:d,u_grid_matrix:g,u_tl_parent:v,u_scale_parent:L,u_fade_t:O.mix,u_opacity:O.opacity*N.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:N.paint.get("raster-brightness-min"),u_brightness_high:N.paint.get("raster-brightness-max"),u_saturation_factor:n.cO(N.paint.get("raster-saturation")),u_contrast_factor:n.cP(N.paint.get("raster-contrast")),u_spin_weights:jl(N.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:q,u_zoom_transition:w,u_merc_center:C,u_cutoff_params:D,u_colorization_mix:Mm(n.cQ,X,Q),u_colorization_offset:Cm(n.cQ,ee,Q),u_color_ramp:J,u_texture_offset:[pe/(ae+2*pe),ae/(ae+2*pe)],u_texture_res:[ae+2*pe,ae+2*pe],u_emissive_strength:fe});function jl(h){h*=Math.PI/180;const i=Math.sin(h),o=Math.cos(h);return[(2*o+1)/3,(-Math.sqrt(3)*i-o+1)/3,(Math.sqrt(3)*i-o+1)/3]}const Qt=.05,Im=(h,i,o,d,g,v,w,C,D,L,O,N)=>({u_matrix:h,u_normalize_matrix:i,u_globe_matrix:o,u_merc_matrix:d,u_grid_matrix:g,u_tl_parent:v,u_scale_parent:L,u_fade_t:O.mix,u_opacity:O.opacity,u_image0:0,u_image1:1,u_raster_elevation:N,u_zoom_transition:w,u_merc_center:C,u_cutoff_params:D}),mx=(h,i,o,d,g,v,w,C,D,L)=>({u_particle_texture:h,u_particle_texture_side_len:i,u_tile_offset:o,u_velocity:d,u_color_ramp:v,u_velocity_res:g,u_max_speed:w,u_uv_offset:C,u_data_scale:[255*D[0],255*D[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Qt,Qt]}),_x=(h,i,o,d,g,v,w,C,D,L)=>({u_particle_texture:h,u_particle_texture_side_len:i,u_velocity:o,u_velocity_res:d,u_max_speed:g,u_speed_factor:v,u_reset_rate:w,u_rand_seed:Math.random(),u_uv_offset:C,u_data_scale:[255*D[0],255*D[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Qt,Qt]}),sf=n.ab.mat4.create(),Pm=(h,i,o,d,g,v,w,C,D,L,O,N,B,q,J,X,ee,Q,ae,pe,fe,we)=>{const ge=g.transform,ve={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:ge.getCameraToCenterDistance(ae),u_rotate_symbol:+o,u_aspect_ratio:ge.width/ge.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:w,u_coord_matrix:C,u_is_text:+L,u_elevation_from_sea:D?1:0,u_pitch_with_map:+d,u_texsize:O,u_texsize_icon:N,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:sf,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:sf,u_up_vector:[0,-1,0],u_color_adj_mat:pe,u_icon_transition:fe||0,u_gamma_scale:d?g.transform.getCameraToCenterDistance(ae)*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:n.q.devicePixelRatio,u_is_halo:+B,u_scale_factor:we||1};return ae.name==="globe"&&(ve.u_tile_id=[q.canonical.x,q.canonical.y,1<<q.canonical.z],ve.u_zoom_transition=J,ve.u_inv_rot_matrix=ee,ve.u_merc_center=X,ve.u_camera_forward=ge._camera.forward(),ve.u_ecef_origin=n.cR(ge.globeMatrix,q.toUnwrapped()),ve.u_tile_matrix=Float32Array.from(ge.globeMatrix),ve.u_up_vector=Q),ve},Rm=(h,i,o,d)=>({u_matrix:h,u_emissive_strength:i,u_opacity:o,u_color:d}),xy=(h,i,o,d,g,v,w,C,D)=>n.l(function(L,O,N,B,q,J){const{width:X,height:ee}=B.imageManager.getPixelSize(O),Q=Math.pow(2,J.tileID.overscaledZ),ae=J.tileSize*Math.pow(2,B.transform.tileZoom)/Q,pe=ae*(J.tileID.canonical.x+J.tileID.wrap*Q),fe=ae*J.tileID.canonical.y;return{u_image:0,u_pattern_tl:N.tl,u_pattern_br:N.br,u_texsize:[X,ee],u_pattern_size:N.displaySize,u_pattern_units_to_pixels:q?[B.transform.width,-1*B.transform.height]:[1/n.ar(J,1,B.transform.tileZoom),1/n.ar(J,1,B.transform.tileZoom)],u_pixel_coord_upper:[pe>>16,fe>>16],u_pixel_coord_lower:[65535&pe,65535&fe]}}(0,v,w,d,C,D),{u_matrix:h,u_emissive_strength:i,u_opacity:o}),Dm=new Float32Array(n.ab.mat4.identity([])),hh=(h,i,o,d,g,v,w,C,D,L,O,N,B,q=[0,0,0],J)=>{const X=g.style.light,ee=X.properties.get("position"),Q=[-ee.x,-ee.y,ee.z],ae=n.ab.mat3.create();X.properties.get("anchor")==="viewport"&&(n.ab.mat3.fromRotation(ae,-g.transform.angle),n.ab.vec3.transformMat3(Q,Q,ae));const pe=O.alphaMode==="MASK",fe=X.properties.get("color").toRenderColor(null),we=B.paint.get("model-ambient-occlusion-intensity"),ge=B.paint.get("model-color").constantOr(n.aj.white).toRenderColor(null),ve=B.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:h,u_lighting_matrix:i,u_normal_matrix:o,u_node_matrix:d||Dm,u_lightpos:Q,u_lightintensity:X.properties.get("intensity"),u_lightcolor:[fe.r,fe.g,fe.b],u_camera_pos:q,u_opacity:v,u_baseTextureIsAlpha:0,u_alphaMask:+pe,u_alphaCutoff:O.alphaCutoff,u_baseColorFactor:[w.r,w.g,w.b,w.a],u_emissiveFactor:[C[0],C[1],C[2],1],u_metallicFactor:D,u_roughnessFactor:L,u_baseColorTexture:Hr.BaseColor,u_metallicRoughnessTexture:Hr.MetallicRoughness,u_normalTexture:Hr.Normal,u_occlusionTexture:Hr.Occlusion,u_emissionTexture:Hr.Emission,u_lutTexture:Hr.LUT,u_color_mix:[ge.r,ge.g,ge.b,ve],u_aoIntensity:we,u_emissive_strength:N,u_occlusionTextureTransform:J||[0,0,0,0]}},of=(h,i=Dm,o=Dm)=>({u_matrix:h,u_instance:i,u_node_matrix:o}),Lm={fillExtrusion:h=>({u_matrix:new n.bJ(h),u_lightpos:new n.bL(h),u_lightintensity:new n.bM(h),u_lightcolor:new n.bL(h),u_vertical_gradient:new n.bM(h),u_opacity:new n.bM(h),u_edge_radius:new n.bM(h),u_width_scale:new n.bM(h),u_ao:new n.bK(h),u_height_type:new n.bN(h),u_base_type:new n.bN(h),u_tile_id:new n.bL(h),u_zoom_transition:new n.bM(h),u_inv_rot_matrix:new n.bJ(h),u_merc_center:new n.bK(h),u_up_dir:new n.bL(h),u_height_lift:new n.bM(h),u_flood_light_color:new n.bL(h),u_vertical_scale:new n.bM(h),u_flood_light_intensity:new n.bM(h),u_ground_shadow_factor:new n.bL(h)}),fillExtrusionDepth:h=>({u_matrix:new n.bJ(h),u_edge_radius:new n.bM(h),u_width_scale:new n.bM(h),u_vertical_scale:new n.bM(h),u_height_type:new n.bN(h),u_base_type:new n.bN(h)}),fillExtrusionPattern:h=>({u_matrix:new n.bJ(h),u_lightpos:new n.bL(h),u_lightintensity:new n.bM(h),u_lightcolor:new n.bL(h),u_vertical_gradient:new n.bM(h),u_height_factor:new n.bM(h),u_edge_radius:new n.bM(h),u_width_scale:new n.bM(h),u_ao:new n.bK(h),u_height_type:new n.bN(h),u_base_type:new n.bN(h),u_tile_id:new n.bL(h),u_zoom_transition:new n.bM(h),u_inv_rot_matrix:new n.bJ(h),u_merc_center:new n.bK(h),u_up_dir:new n.bL(h),u_height_lift:new n.bM(h),u_image:new n.bN(h),u_texsize:new n.bK(h),u_pixel_coord_upper:new n.bK(h),u_pixel_coord_lower:new n.bK(h),u_tile_units_to_pixels:new n.bM(h),u_opacity:new n.bM(h)}),fillExtrusionGroundEffect:h=>({u_matrix:new n.bJ(h),u_opacity:new n.bM(h),u_ao_pass:new n.bM(h),u_meter_to_tile:new n.bM(h),u_ao:new n.bK(h),u_flood_light_intensity:new n.bM(h),u_flood_light_color:new n.bL(h),u_attenuation:new n.bM(h),u_edge_radius:new n.bM(h),u_fb:new n.bN(h),u_fb_size:new n.bM(h),u_dynamic_offset:new n.bM(h)}),fill:h=>({u_matrix:new n.bJ(h),u_emissive_strength:new n.bM(h)}),fillPattern:h=>({u_matrix:new n.bJ(h),u_emissive_strength:new n.bM(h),u_image:new n.bN(h),u_texsize:new n.bK(h),u_pixel_coord_upper:new n.bK(h),u_pixel_coord_lower:new n.bK(h),u_tile_units_to_pixels:new n.bM(h)}),fillOutline:h=>({u_matrix:new n.bJ(h),u_emissive_strength:new n.bM(h),u_world:new n.bK(h)}),fillOutlinePattern:h=>({u_matrix:new n.bJ(h),u_emissive_strength:new n.bM(h),u_world:new n.bK(h),u_image:new n.bN(h),u_texsize:new n.bK(h),u_pixel_coord_upper:new n.bK(h),u_pixel_coord_lower:new n.bK(h),u_tile_units_to_pixels:new n.bM(h)}),circle:n.cS,collisionBox:h=>({u_matrix:new n.bJ(h),u_camera_to_center_distance:new n.bM(h),u_extrude_scale:new n.bK(h)}),collisionCircle:h=>({u_matrix:new n.bJ(h),u_inv_matrix:new n.bJ(h),u_camera_to_center_distance:new n.bM(h),u_viewport_size:new n.bK(h)}),debug:h=>({u_color:new n.cz(h),u_matrix:new n.bJ(h),u_overlay:new n.bN(h),u_overlay_scale:new n.bM(h)}),clippingMask:h=>({u_matrix:new n.bJ(h)}),heatmap:h=>({u_extrude_scale:new n.bM(h),u_intensity:new n.bM(h),u_matrix:new n.bJ(h),u_inv_rot_matrix:new n.bJ(h),u_merc_center:new n.bK(h),u_tile_id:new n.bL(h),u_zoom_transition:new n.bM(h),u_up_dir:new n.bL(h)}),heatmapTexture:h=>({u_image:new n.bN(h),u_color_ramp:new n.bN(h),u_opacity:new n.bM(h)}),hillshade:h=>({u_matrix:new n.bJ(h),u_image:new n.bN(h),u_latrange:new n.bK(h),u_light:new n.bK(h),u_shadow:new n.cz(h),u_highlight:new n.cz(h),u_emissive_strength:new n.bM(h),u_accent:new n.cz(h)}),hillshadePrepare:h=>({u_matrix:new n.bJ(h),u_image:new n.bN(h),u_dimension:new n.bK(h),u_zoom:new n.bM(h)}),line:n.cT,linePattern:n.cU,raster:h=>({u_matrix:new n.bJ(h),u_normalize_matrix:new n.bJ(h),u_globe_matrix:new n.bJ(h),u_merc_matrix:new n.bJ(h),u_grid_matrix:new n.cA(h),u_tl_parent:new n.bK(h),u_scale_parent:new n.bM(h),u_fade_t:new n.bM(h),u_opacity:new n.bM(h),u_image0:new n.bN(h),u_image1:new n.bN(h),u_brightness_low:new n.bM(h),u_brightness_high:new n.bM(h),u_saturation_factor:new n.bM(h),u_contrast_factor:new n.bM(h),u_spin_weights:new n.bL(h),u_perspective_transform:new n.bK(h),u_raster_elevation:new n.bM(h),u_zoom_transition:new n.bM(h),u_merc_center:new n.bK(h),u_cutoff_params:new n.ca(h),u_colorization_mix:new n.ca(h),u_colorization_offset:new n.bM(h),u_color_ramp:new n.bN(h),u_texture_offset:new n.bK(h),u_texture_res:new n.bK(h),u_emissive_strength:new n.bM(h)}),rasterParticle:h=>({u_matrix:new n.bJ(h),u_normalize_matrix:new n.bJ(h),u_globe_matrix:new n.bJ(h),u_merc_matrix:new n.bJ(h),u_grid_matrix:new n.cA(h),u_tl_parent:new n.bK(h),u_scale_parent:new n.bM(h),u_fade_t:new n.bM(h),u_opacity:new n.bM(h),u_image0:new n.bN(h),u_image1:new n.bN(h),u_raster_elevation:new n.bM(h),u_zoom_transition:new n.bM(h),u_merc_center:new n.bK(h),u_cutoff_params:new n.ca(h)}),rasterParticleTexture:h=>({u_texture:new n.bN(h),u_opacity:new n.bM(h)}),rasterParticleDraw:h=>({u_particle_texture:new n.bN(h),u_particle_texture_side_len:new n.bM(h),u_tile_offset:new n.bK(h),u_velocity:new n.bN(h),u_color_ramp:new n.bN(h),u_velocity_res:new n.bK(h),u_max_speed:new n.bM(h),u_uv_offset:new n.bK(h),u_data_scale:new n.bK(h),u_data_offset:new n.bM(h),u_particle_pos_scale:new n.bM(h),u_particle_pos_offset:new n.bK(h)}),rasterParticleUpdate:h=>({u_particle_texture:new n.bN(h),u_particle_texture_side_len:new n.bM(h),u_velocity:new n.bN(h),u_velocity_res:new n.bK(h),u_max_speed:new n.bM(h),u_speed_factor:new n.bM(h),u_reset_rate:new n.bM(h),u_rand_seed:new n.bM(h),u_uv_offset:new n.bK(h),u_data_scale:new n.bK(h),u_data_offset:new n.bM(h),u_particle_pos_scale:new n.bM(h),u_particle_pos_offset:new n.bK(h)}),symbol:h=>({u_is_size_zoom_constant:new n.bN(h),u_is_size_feature_constant:new n.bN(h),u_size_t:new n.bM(h),u_size:new n.bM(h),u_camera_to_center_distance:new n.bM(h),u_rotate_symbol:new n.bN(h),u_aspect_ratio:new n.bM(h),u_fade_change:new n.bM(h),u_matrix:new n.bJ(h),u_label_plane_matrix:new n.bJ(h),u_coord_matrix:new n.bJ(h),u_is_text:new n.bN(h),u_elevation_from_sea:new n.bN(h),u_pitch_with_map:new n.bN(h),u_texsize:new n.bK(h),u_texsize_icon:new n.bK(h),u_texture:new n.bN(h),u_texture_icon:new n.bN(h),u_gamma_scale:new n.bM(h),u_device_pixel_ratio:new n.bM(h),u_tile_id:new n.bL(h),u_zoom_transition:new n.bM(h),u_inv_rot_matrix:new n.bJ(h),u_merc_center:new n.bK(h),u_camera_forward:new n.bL(h),u_tile_matrix:new n.bJ(h),u_up_vector:new n.bL(h),u_ecef_origin:new n.bL(h),u_is_halo:new n.bN(h),u_icon_transition:new n.bM(h),u_color_adj_mat:new n.bJ(h),u_scale_factor:new n.bM(h)}),background:h=>({u_matrix:new n.bJ(h),u_emissive_strength:new n.bM(h),u_opacity:new n.bM(h),u_color:new n.cz(h)}),backgroundPattern:h=>({u_matrix:new n.bJ(h),u_emissive_strength:new n.bM(h),u_opacity:new n.bM(h),u_image:new n.bN(h),u_pattern_tl:new n.bK(h),u_pattern_br:new n.bK(h),u_texsize:new n.bK(h),u_pattern_size:new n.bK(h),u_pixel_coord_upper:new n.bK(h),u_pixel_coord_lower:new n.bK(h),u_pattern_units_to_pixels:new n.bK(h)}),terrainRaster:h=>({u_matrix:new n.bJ(h),u_image0:new n.bN(h),u_skirt_height:new n.bM(h),u_ground_shadow_factor:new n.bL(h)}),skybox:h=>({u_matrix:new n.bJ(h),u_sun_direction:new n.bL(h),u_cubemap:new n.bN(h),u_opacity:new n.bM(h),u_temporal_offset:new n.bM(h)}),skyboxGradient:h=>({u_matrix:new n.bJ(h),u_color_ramp:new n.bN(h),u_center_direction:new n.bL(h),u_radius:new n.bM(h),u_opacity:new n.bM(h),u_temporal_offset:new n.bM(h)}),skyboxCapture:h=>({u_matrix_3f:new n.cA(h),u_sun_direction:new n.bL(h),u_sun_intensity:new n.bM(h),u_color_tint_r:new n.ca(h),u_color_tint_m:new n.ca(h),u_luminance:new n.bM(h)}),globeRaster:h=>({u_proj_matrix:new n.bJ(h),u_globe_matrix:new n.bJ(h),u_normalize_matrix:new n.bJ(h),u_merc_matrix:new n.bJ(h),u_zoom_transition:new n.bM(h),u_merc_center:new n.bK(h),u_image0:new n.bN(h),u_grid_matrix:new n.cA(h),u_skirt_height:new n.bM(h),u_far_z_cutoff:new n.bM(h),u_frustum_tl:new n.bL(h),u_frustum_tr:new n.bL(h),u_frustum_br:new n.bL(h),u_frustum_bl:new n.bL(h),u_globe_pos:new n.bL(h),u_globe_radius:new n.bM(h),u_viewport:new n.bK(h)}),globeAtmosphere:h=>({u_frustum_tl:new n.bL(h),u_frustum_tr:new n.bL(h),u_frustum_br:new n.bL(h),u_frustum_bl:new n.bL(h),u_horizon:new n.bM(h),u_transition:new n.bM(h),u_fadeout_range:new n.bM(h),u_color:new n.ca(h),u_high_color:new n.ca(h),u_space_color:new n.ca(h),u_temporal_offset:new n.bM(h),u_horizon_angle:new n.bM(h)}),model:h=>({u_matrix:new n.bJ(h),u_lighting_matrix:new n.bJ(h),u_normal_matrix:new n.bJ(h),u_node_matrix:new n.bJ(h),u_lightpos:new n.bL(h),u_lightintensity:new n.bM(h),u_lightcolor:new n.bL(h),u_camera_pos:new n.bL(h),u_opacity:new n.bM(h),u_baseColorFactor:new n.ca(h),u_emissiveFactor:new n.ca(h),u_metallicFactor:new n.bM(h),u_roughnessFactor:new n.bM(h),u_baseTextureIsAlpha:new n.bN(h),u_alphaMask:new n.bN(h),u_alphaCutoff:new n.bM(h),u_baseColorTexture:new n.bN(h),u_metallicRoughnessTexture:new n.bN(h),u_normalTexture:new n.bN(h),u_occlusionTexture:new n.bN(h),u_emissionTexture:new n.bN(h),u_lutTexture:new n.bN(h),u_color_mix:new n.ca(h),u_aoIntensity:new n.bM(h),u_emissive_strength:new n.bM(h),u_occlusionTextureTransform:new n.ca(h)}),modelDepth:h=>({u_matrix:new n.bJ(h),u_instance:new n.bJ(h),u_node_matrix:new n.bJ(h)}),groundShadow:h=>({u_matrix:new n.bJ(h),u_ground_shadow_factor:new n.bL(h)}),stars:h=>({u_matrix:new n.bJ(h),u_up:new n.bL(h),u_right:new n.bL(h),u_intensity_multiplier:new n.bM(h)}),snowParticle:h=>({u_modelview:new n.bJ(h),u_projection:new n.bJ(h),u_time:new n.bM(h),u_cam_pos:new n.bL(h),u_velocityConeAperture:new n.bM(h),u_velocity:new n.bM(h),u_horizontalOscillationRadius:new n.bM(h),u_horizontalOscillationRate:new n.bM(h),u_boxSize:new n.bM(h),u_billboardSize:new n.bM(h),u_simpleShapeParameters:new n.bK(h),u_screenSize:new n.bK(h),u_thinningCenterPos:new n.bK(h),u_thinningShape:new n.bL(h),u_thinningAffectedRatio:new n.bM(h),u_thinningParticleOffset:new n.bM(h),u_particleColor:new n.ca(h),u_direction:new n.bL(h)}),rainParticle:h=>({u_modelview:new n.bJ(h),u_projection:new n.bJ(h),u_time:new n.bM(h),u_cam_pos:new n.bL(h),u_texScreen:new n.bN(h),u_velocityConeAperture:new n.bM(h),u_velocity:new n.bM(h),u_boxSize:new n.bM(h),u_rainDropletSize:new n.bK(h),u_distortionStrength:new n.bM(h),u_rainDirection:new n.bL(h),u_color:new n.ca(h),u_screenSize:new n.bK(h),u_thinningCenterPos:new n.bK(h),u_thinningShape:new n.bL(h),u_thinningAffectedRatio:new n.bM(h),u_thinningParticleOffset:new n.bM(h),u_shapeDirectionalPower:new n.bM(h),u_shapeNormalPower:new n.bM(h),u_mode:new n.bM(h)}),vignette:h=>({u_vignetteShape:new n.bL(h),u_vignetteColor:new n.ca(h)}),occlusion:h=>({u_matrix:new n.bJ(h),u_anchorPos:new n.bL(h),u_screenSizePx:new n.bK(h),u_occluderSizePx:new n.bK(h),u_color:new n.ca(h)})};class na{constructor(i,o,d,g){this.id=na.uniqueIdxCounter,na.uniqueIdxCounter++,this.context=i;const v=i.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||g||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){this.id=na.uniqueIdxCounter,na.uniqueIdxCounter++;const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}na.uniqueIdxCounter=0;const Cs={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ol{constructor(i,o,d,g,v,w){this.length=o.length,this.attributes=d,this.itemSize=o.bytesPerElement,this.dynamicDraw=g,this.instanceCount=w,this.context=i;const C=i.gl;this.buffer=C.createBuffer(),i.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||v||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,o){for(let d=0;d<this.attributes.length;d++){const g=o.attributes[this.attributes[d].name];g!==void 0&&i.enableVertexAttribArray(g)}}setVertexAttribPointers(i,o,d){for(let g=0;g<this.attributes.length;g++){const v=this.attributes[g],w=o.attributes[v.name];w!==void 0&&i.vertexAttribPointer(w,v.components,i[Cs[v.type]],!1,this.itemSize,v.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(i,o,d){for(let g=0;g<this.attributes.length;g++){const v=o.attributes[this.attributes[g].name];v!==void 0&&this.instanceCount&&this.instanceCount>0&&i.vertexAttribDivisor(v,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Om{constructor(i,o,d,g,v){this.context=i,this.width=o,this.height=d;const w=this.framebuffer=i.gl.createFramebuffer();g&&(this.colorAttachment=new Pc(i,w)),v&&(this.depthAttachmentType=v,this.depthAttachment=v==="renderbuffer"?new bm(i,w):new fy(i,w))}destroy(){const i=this.context.gl;if(this.colorAttachment){const o=this.colorAttachment.get();o&&i.deleteTexture(o)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const o=this.depthAttachment.get();o&&i.deleteRenderbuffer(o)}else{const o=this.depthAttachment.get();o&&i.deleteTexture(o)}i.deleteFramebuffer(this.framebuffer)}}class zm{constructor(i,o){this.gl=i,this.clearColor=new um(this),this.clearDepth=new hm(this),this.clearStencil=new dm(this),this.colorMask=new fm(this),this.depthMask=new ly(this),this.stencilMask=new cy(this),this.stencilFunc=new rx(this),this.stencilOp=new rh(this),this.stencilTest=new sh(this),this.depthRange=new uy(this),this.depthTest=new Ms(this),this.depthFunc=new pm(this),this.blend=new Zd(this),this.blendFunc=new Xd(this),this.blendColor=new mm(this),this.blendEquation=new _m(this),this.cullFace=new Yd(this),this.cullFaceSide=new gm(this),this.frontFace=new ym(this),this.program=new Kd(this),this.activeTexture=new hy(this),this.viewport=new dy(this),this.bindFramebuffer=new Ic(this),this.bindRenderbuffer=new sx(this),this.bindTexture=new ox(this),this.bindVertexBuffer=new ax(this),this.bindElementBuffer=new lx(this),this.bindVertexArrayOES=new cx(this),this.pixelStoreUnpack=new ux(this),this.pixelStoreUnpackPremultiplyAlpha=new vm(this),this.pixelStoreUnpackFlipY=new xm(this),this.options=o?Object.assign({},o):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=o&&!!o.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=i.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.maxPointSize=i.getParameter(i.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,o,d){return new na(this,i,o,d)}createVertexBuffer(i,o,d,g,v){return new ol(this,i,o,d,g,v)}createRenderbuffer(i,o,d){const g=this.gl,v=g.createRenderbuffer();return this.bindRenderbuffer.set(v),g.renderbufferStorage(g.RENDERBUFFER,i,o,d),this.bindRenderbuffer.set(null),v}createFramebuffer(i,o,d,g){return new Om(this,i,o,d,g)}clear({color:i,depth:o,stencil:d,colorMask:g}){const v=this.gl;let w=0;i&&(w|=v.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set(g||[!0,!0,!0,!0])),o!==void 0&&(w|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),d!==void 0&&(w|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),v.clear(w)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){n.bn(i.blendFunction,Pi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor),i.blendEquation?this.blendEquation.set(i.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(i.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Oc;function af(h,i,o,d,g,v,w){const C=h.context,D=C.gl,L=h.transform,O=h.getOrCreateProgram("collisionBox"),N=[];let B=0,q=0;for(let fe=0;fe<d.length;fe++){const we=d[fe],ge=i.getTile(we),ve=ge.getBucket(o);if(!ve)continue;const _e=Mo(we,ve,L);let Me=_e;g[0]===0&&g[1]===0||(Me=h.translatePosMatrix(_e,ge,g,v));const ke=w?ve.textCollisionBox:ve.iconCollisionBox,tt=ve.collisionCircleArray;if(tt.length>0){const We=n.ab.mat4.create(),ct=Me;n.ab.mat4.mul(We,ve.placementInvProjMatrix,L.glCoordMatrix),n.ab.mat4.mul(We,We,ve.placementViewportMatrix),N.push({circleArray:tt,circleOffset:q,transform:ct,invTransform:We,projection:ve.getProjection()}),B+=tt.length/4,q=B}ke&&(h.terrain&&h.terrain.setupElevationDraw(ge,O),O.draw(h,D.LINES,oi.disabled,pi.disabled,h.colorModeForRenderPass(),gi.disabled,px(Me,L,ge,ve.getProjection()),o.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,null,L.zoom,null,[ke.collisionVertexBuffer,ke.collisionVertexBufferExt]))}if(!w||!N.length)return;const J=h.getOrCreateProgram("collisionCircle"),X=new n.cV;X.resize(4*B),X._trim();let ee=0;for(const fe of N)for(let we=0;we<fe.circleArray.length/4;we++){const ge=4*we,ve=fe.circleArray[ge+0],_e=fe.circleArray[ge+1],Me=fe.circleArray[ge+2],ke=fe.circleArray[ge+3];X.emplace(ee++,ve,_e,Me,ke,0),X.emplace(ee++,ve,_e,Me,ke,1),X.emplace(ee++,ve,_e,Me,ke,2),X.emplace(ee++,ve,_e,Me,ke,3)}(!Oc||Oc.length<2*B)&&(Oc=function(fe){const we=2*fe,ge=new n.aU;ge.resize(we),ge._trim();for(let ve=0;ve<we;ve++){const _e=6*ve;ge.uint16[_e+0]=4*ve+0,ge.uint16[_e+1]=4*ve+1,ge.uint16[_e+2]=4*ve+2,ge.uint16[_e+3]=4*ve+2,ge.uint16[_e+4]=4*ve+3,ge.uint16[_e+5]=4*ve+0}return ge}(B));const Q=C.createIndexBuffer(Oc,!0),ae=C.createVertexBuffer(X,n.cW.members,!0);for(const fe of N){const we={u_matrix:fe.transform,u_inv_matrix:fe.invTransform,u_camera_to_center_distance:(pe=L).getCameraToCenterDistance(fe.projection),u_viewport_size:[pe.width,pe.height]};J.draw(h,D.TRIANGLES,oi.disabled,pi.disabled,h.colorModeForRenderPass(),gi.disabled,we,o.id,ae,Q,n.b7.simpleSegment(0,2*fe.circleOffset,fe.circleArray.length,fe.circleArray.length/2),null,L.zoom)}var pe;ae.destroy(),Q.destroy()}const dh=n.ab.mat4.create();function $s(h){const i=h._camera.getWorldToCamera(h.worldSize,1),o=n.ab.mat4.multiply([],i,h.globeMatrix);n.ab.mat4.invert(o,o);const d=[0,0,0],g=[0,1,0,0];return n.ab.vec4.transformMat4(g,g,o),d[0]=g[0],d[1]=g[1],d[2]=g[2],n.ab.vec3.normalize(d,d),d}function bn({width:h,height:i,anchor:o,textOffset:d,textScale:g},v){const{horizontalAlign:w,verticalAlign:C}=n.bD(o),D=-(w-.5)*h,L=-(C-.5)*i,O=n.bC(o,d);return new n.P((D/g+O[0])*v,(L/g+O[1])*v)}function lf(h,i,o,d,g,v,w,C,D,L,O){const N=h.text.placedSymbolArray,B=h.text.dynamicLayoutVertexArray,q=h.icon.dynamicLayoutVertexArray,J={},X=h.getProjection(),ee=Pl(C,X,v),Q=v.elevation,ae=X.upVectorScale(C.canonical,v.center.lat,v.worldSize).metersToTile;B.clear();for(let pe=0;pe<N.length;pe++){const fe=N.get(pe),{tileAnchorX:we,tileAnchorY:ge,numGlyphs:ve}=fe,_e=fe.hidden||!fe.crossTileID||h.allowVerticalPlacement&&!fe.placedOrientation?null:d[fe.crossTileID];if(_e){let Me=0,ke=0,tt=0;if(Q){const nt=Q?Q.getAtTileOffset(C,we,ge):0,[St,pt,ut]=X.upVector(C.canonical,we,ge);Me=nt*St*ae,ke=nt*pt*ae,tt=nt*ut*ae}let[We,ct,lt,$e]=ys(fe.projectedAnchorX+Me,fe.projectedAnchorY+ke,fe.projectedAnchorZ+tt,o?ee:w);const it=Fd(v.getCameraToCenterDistance(X),$e);let gt=g.evaluateSizeForFeature(h.textSizeData,L,fe)*it/n.bw;o&&(gt*=h.tilePixelRatio/D);const Ue=bn(_e,gt);o?({x:We,y:ct,z:lt}=X.projectTilePoint(we+Ue.x,ge+Ue.y,C.canonical),[We,ct,lt]=ys(We+Me,ct+ke,lt+tt,w)):(i&&Ue._rotate(-v.angle),We+=Ue.x,ct+=Ue.y,lt=0);const ht=h.allowVerticalPlacement&&fe.placedOrientation===n.bq.vertical?Math.PI/2:0;for(let nt=0;nt<ve;nt++)n.bt(B,We,ct,lt,ht);O&&fe.associatedIconIndex>=0&&(J[fe.associatedIconIndex]={x:We,y:ct,z:lt,angle:ht})}else Vn(ve,B)}if(O){q.clear();const pe=h.icon.placedSymbolArray;for(let fe=0;fe<pe.length;fe++){const we=pe.get(fe),{numGlyphs:ge}=we,ve=J[fe];if(we.hidden||!ve)Vn(ge,q);else{const{x:_e,y:Me,z:ke,angle:tt}=ve;for(let We=0;We<ge;We++)n.bt(q,_e,Me,ke,tt)}}h.icon.dynamicLayoutVertexBuffer.updateData(q)}h.text.dynamicLayoutVertexBuffer.updateData(B)}function fh(h,i,o,d,g,v,w={}){const C=o.paint.get("icon-translate"),D=o.paint.get("text-translate"),L=o.paint.get("icon-translate-anchor"),O=o.paint.get("text-translate-anchor"),N=o.layout.get("icon-rotation-alignment"),B=o.layout.get("text-rotation-alignment"),q=o.layout.get("icon-pitch-alignment"),J=o.layout.get("text-pitch-alignment"),X=o.layout.get("icon-keep-upright"),ee=o.layout.get("text-keep-upright"),Q=o.paint.get("icon-color-saturation"),ae=o.paint.get("icon-color-contrast"),pe=o.paint.get("icon-color-brightness-min"),fe=o.paint.get("icon-color-brightness-max"),we=o.layout.get("symbol-elevation-reference")==="sea",ge=h.context,ve=ge.gl,_e=h.transform,Me=N==="map",ke=B==="map",tt=q==="map",We=J==="map",ct=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let lt=!1;const $e=h.depthModeForSublayer(0,oi.ReadOnly),it=[n.at(_e.center.lng),n.aA(_e.center.lat)],gt=o.layout.get("text-variable-anchor"),Ue=_e.projection.name==="globe",ht=[],nt=[0,-1,0];for(const St of d){const pt=i.getTile(St),ut=pt.getBucket(o);if(!ut||ut.projection.name==="mercator"&&Ue||ut.fullyClipped)continue;const vt=ut.projection.name==="globe",Et=vt?n.ae(_e.zoom):0,Nt=Pl(St,ut.getProjection(),_e),$t=_e.calculatePixelsToTileUnitsMatrix(pt),fi=gt&&ut.hasTextData(),ri=ut.hasIconTextFit()&&fi&&ut.hasIconData(),ai=ut.getProjection().createInversionMatrix(_e,St.canonical),xi=Ji=>{_e.depthOcclusionForSymbolsAndCircles&&(o.hasInitialOcclusionOpacityProperties||h.terrain)&&(Ji.push("DEPTH_D24"),Ji.push("DEPTH_OCCLUSION"))},Bi=()=>{const Ji=Me&&o.layout.get("symbol-placement")!=="point",tn=[];xi(tn);const Ln=Ji||ri,wr=o.paint.get("icon-image-cross-fade").constantOr(0);h.terrainRenderModeElevated()&&tt&&tn.push("PITCH_WITH_MAP_TERRAIN"),vt&&(tn.push("PROJECTION_GLOBE_VIEW"),Ln&&tn.push("PROJECTED_POS_ON_VIEWPORT")),wr>0&&tn.push("ICON_TRANSITION"),ut.icon.zOffsetVertexBuffer&&tn.push("Z_OFFSET"),Q===0&&ae===0&&pe===0&&fe===1||tn.push("COLOR_ADJUSTMENT"),ut.sdfIcons&&tn.push("RENDER_SDF");const or=ut.icon.programConfigurations.get(o.id),ar=h.getOrCreateProgram("symbol",{config:or,defines:tn}),Gs=pt.imageAtlasTexture?pt.imageAtlasTexture.size:[0,0],ts=ut.iconSizeData,On=n.bp(ts,_e.zoom),mn=tt||_e.pitch!==0,dn=Rr(Nt,pt.tileID.canonical,tt,Me,_e,ut.getProjection(),$t),Ui=Wp(Nt,pt.tileID.canonical,tt,Me,_e,ut.getProjection(),$t),Xn=h.translatePosMatrix(Ui,pt,C,L,!0),Tr=h.translatePosMatrix(Nt,pt,C,L),pn=Ln?dh:dn,is=Me&&!tt&&!Ji;let uo=nt;!Ue&&!_e.mercatorFromTransition||Me||(uo=$s(_e));const Rs=vt?uo:nt,bs=o.getColorAdjustmentMatrix(Q,ae,pe,fe),ca=Pm(ts.kind,On,is,tt,h,Tr,pn,Xn,we,!1,Gs,[0,0],!0,St,Et,it,ai,Rs,ut.getProjection(),bs,wr),ho=pt.imageAtlasTexture?pt.imageAtlasTexture:null,Ws=o.layout.get("icon-size").constantOr(0)!==1||ut.iconsNeedLinear,Yl=ut.sdfIcons||h.options.rotating||h.options.zooming||Ws||mn?ve.LINEAR:ve.NEAREST,ua=ut.sdfIcons&&o.paint.get("icon-halo-width").constantOr(1)!==0,Kl=h.terrain&&tt&&Ji?n.ab.mat4.invert(n.ab.mat4.create(),dn):dh;if(Ji&&ut.icon){const Wc=_e.elevation,Ef=Wc?Wc.getAtTileOffsetFunc(St,_e.center.lat,_e.worldSize,ut.getProjection()):null,r_=qn(Nt,pt.tileID.canonical,tt,Me,_e,ut.getProjection(),$t);Nd(ut,Nt,h,!1,r_,Ui,tt,X,Ef,St)}return{program:ar,buffers:ut.icon,uniformValues:ca,atlasTexture:ho,atlasTextureIcon:null,atlasInterpolation:Yl,atlasInterpolationIcon:null,isSDF:ut.sdfIcons,hasHalo:ua,tile:pt,labelPlaneMatrixInv:Kl}},on=()=>{const Ji=ke&&o.layout.get("symbol-placement")!=="point",tn=[],Ln=Ji||gt||ri;h.terrainRenderModeElevated()&&We&&tn.push("PITCH_WITH_MAP_TERRAIN"),vt&&(tn.push("PROJECTION_GLOBE_VIEW"),Ln&&tn.push("PROJECTED_POS_ON_VIEWPORT")),ut.text.zOffsetVertexBuffer&&tn.push("Z_OFFSET"),ut.iconsInText&&tn.push("RENDER_TEXT_AND_SYMBOL"),tn.push("RENDER_SDF"),xi(tn);const wr=ut.text.programConfigurations.get(o.id),or=h.getOrCreateProgram("symbol",{config:wr,defines:tn});let ar,Gs=[0,0],ts=null;const On=ut.textSizeData;ut.iconsInText&&(Gs=pt.imageAtlasTexture?pt.imageAtlasTexture.size:[0,0],ts=pt.imageAtlasTexture?pt.imageAtlasTexture:null,ar=We||_e.pitch!==0||h.options.rotating||h.options.zooming||On.kind==="composite"||On.kind==="camera"?ve.LINEAR:ve.NEAREST);const mn=pt.glyphAtlasTexture?pt.glyphAtlasTexture.size:[0,0],dn=o.layout.get("text-size-scale-range"),Ui=n.aw(h.scaleFactor,dn[0],dn[1]),Xn=n.bp(On,_e.zoom,Ui),Tr=Rr(Nt,pt.tileID.canonical,We,ke,_e,ut.getProjection(),$t),pn=Wp(Nt,pt.tileID.canonical,We,ke,_e,ut.getProjection(),$t),is=h.translatePosMatrix(pn,pt,D,O,!0),uo=h.translatePosMatrix(Nt,pt,D,O),Rs=Ln?dh:Tr,bs=ke&&!We&&!Ji;let ca=nt;!Ue&&!_e.mercatorFromTransition||ke||(ca=$s(_e));const ho=Pm(On.kind,Xn,bs,We,h,uo,Rs,is,we,!0,mn,Gs,!0,St,Et,it,ai,vt?ca:nt,ut.getProjection(),null,null,Ui),Ws=pt.glyphAtlasTexture?pt.glyphAtlasTexture:null,Yl=ve.LINEAR,ua=o.paint.get("text-halo-width").constantOr(1)!==0,Kl=h.terrain&&We&&Ji?n.ab.mat4.invert(n.ab.mat4.create(),Tr):dh;if(Ji&&ut.text){const Wc=_e.elevation,Ef=Wc?Wc.getAtTileOffsetFunc(St,_e.center.lat,_e.worldSize,ut.getProjection()):null,r_=qn(Nt,pt.tileID.canonical,We,ke,_e,ut.getProjection(),$t);Nd(ut,Nt,h,!0,r_,pn,We,ee,Ef,St)}return{program:or,buffers:ut.text,uniformValues:ho,atlasTexture:Ws,atlasTextureIcon:ts,atlasInterpolation:Yl,atlasInterpolationIcon:ar,isSDF:!0,hasHalo:ua,tile:pt,labelPlaneMatrixInv:Kl}},Nn=ut.icon.segments.get().length,Tn=ut.text.segments.get().length,wi=Nn&&!w.onlyText?Bi():null,Hi=Tn&&!w.onlyIcons?on():null,ei=o.paint.get("icon-opacity").constantOr(1),ki=o.paint.get("text-opacity").constantOr(1);if(ct&&ut.canOverlap){lt=!0;const Ji=ei&&!w.onlyText?ut.icon.segments.get():[],tn=ki&&!w.onlyIcons?ut.text.segments.get():[];for(const Ln of Ji)ht.push({segments:new n.b7([Ln]),sortKey:Ln.sortKey,state:wi});for(const Ln of tn)ht.push({segments:new n.b7([Ln]),sortKey:Ln.sortKey,state:Hi})}else w.onlyText||ht.push({segments:ei?ut.icon.segments:new n.b7([]),sortKey:0,state:wi}),w.onlyIcons||ht.push({segments:ki?ut.text.segments:new n.b7([]),sortKey:0,state:Hi})}lt&&ht.sort((St,pt)=>St.sortKey-pt.sortKey);for(const St of ht){const pt=St.state;if(pt)if(h.terrain?h.terrain.setupElevationDraw(pt.tile,pt.program,{useDepthForOcclusion:_e.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:pt.labelPlaneMatrixInv}):h.setupDepthForOcclusion(_e.depthOcclusionForSymbolsAndCircles,pt.program),ge.activeTexture.set(ve.TEXTURE0),pt.atlasTexture&&pt.atlasTexture.bind(pt.atlasInterpolation,ve.CLAMP_TO_EDGE,!0),pt.atlasTextureIcon&&(ge.activeTexture.set(ve.TEXTURE1),pt.atlasTextureIcon&&pt.atlasTextureIcon.bind(pt.atlasInterpolationIcon,ve.CLAMP_TO_EDGE,!0)),h.uploadCommonLightUniforms(h.context,pt.program),pt.hasHalo){const ut=pt.uniformValues;ut.u_is_halo=1,cf(pt.buffers,St.segments,o,h,pt.program,$e,g,v,ut,2),ut.u_is_halo=0}else{if(pt.isSDF){const ut=pt.uniformValues;pt.hasHalo&&(ut.u_is_halo=1,cf(pt.buffers,St.segments,o,h,pt.program,$e,g,v,ut,1)),ut.u_is_halo=0}cf(pt.buffers,St.segments,o,h,pt.program,$e,g,v,pt.uniformValues,1)}}}function cf(h,i,o,d,g,v,w,C,D,L){const O=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.iconTransitioningVertexBuffer,h.globeExtVertexBuffer,h.zOffsetVertexBuffer];g.draw(d,d.context.gl.TRIANGLES,v,w,C,gi.disabled,D,o.id,h.layoutVertexBuffer,h.indexBuffer,i,o.paint,d.transform.zoom,h.programConfigurations.get(o.id),O,L)}function km(h,i,o,d,g,v,w){const C=h.context.gl,D=o.paint.get("fill-pattern"),L=o.is3D(),O=L?h.stencilModeFor3D():pi.disabled,N=D&&D.constantOr(1);let B,q,J,X,ee;w?(q=N&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=C.LINES):(q=N?"fillPattern":"fill",B=C.TRIANGLES);for(const Q of d){const ae=i.getTile(Q);if(N&&!ae.patternsLoaded())continue;const pe=ae.getBucket(o);if(!pe)continue;h.prepareDrawTile();const fe=pe.programConfigurations.get(o.id),we=h.isTileAffectedByFog(Q),ge=h.getOrCreateProgram(q,{config:fe,overrideFog:we});N&&(h.context.activeTexture.set(C.TEXTURE0),ae.imageAtlasTexture&&ae.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),fe.updatePaintBuffers());const ve=D.constantOr(null);if(ve&&ae.imageAtlas){const ke=ae.imageAtlas,tt=n.A.from(ve).getPrimary().scaleSelf(n.q.devicePixelRatio).serialize(),We=ke.patternPositions[tt];We&&fe.setConstantPatternPositions(We)}const _e=h.translatePosMatrix(Q.projMatrix,ae,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor")),Me=o.paint.get("fill-emissive-strength");if(w){X=pe.indexBuffer2,ee=pe.segments2;const ke=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];J=q==="fillOutlinePattern"&&N?vy(_e,Me,h,ae,ke):Am(_e,Me,ke)}else X=pe.indexBuffer,ee=pe.segments,J=N?uh(_e,Me,h,ae):ch(_e,Me);h.uploadCommonUniforms(h.context,ge,Q.toUnwrapped()),ge.draw(h,B,g,L?O:h.stencilModeForClipping(Q),v,gi.disabled,J,o.id,pe.layoutVertexBuffer,X,ee,o.paint,h.transform.zoom,fe,void 0)}}function ph(h,i,o,d,g,v,w,C){o.resetLayerRenderingStats(h);const D=h.context,L=D.gl,O=h.transform,N=o.paint.get("fill-extrusion-pattern"),B=N.constantOr(1),q=o.paint.get("fill-extrusion-opacity"),J=h.style.enable3dLights(),X=o.paint.get(J&&!B?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ee=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),X],Q=o.layout.get("fill-extrusion-edge-radius"),ae=Q>0&&!o.paint.get("fill-extrusion-rounded-roof"),pe=ae?0:Q,fe=O.projection.name==="globe"?n.d3():0,we=O.projection.name==="globe",ge=we?n.ae(O.zoom):0,ve=[n.at(O.center.lng),n.aA(O.center.lat)],_e=o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Me=o.paint.get("fill-extrusion-flood-light-color").toRenderColor(_e?null:o.lut).toArray01().slice(0,3),ke=o.paint.get("fill-extrusion-flood-light-intensity"),tt=o.paint.get("fill-extrusion-vertical-scale"),We=o.paint.get("fill-extrusion-line-width").constantOr(1)!==0,ct=o.paint.get("fill-extrusion-height-alignment"),lt=o.paint.get("fill-extrusion-base-alignment"),$e=il(h,o.paint.get("fill-extrusion-cutoff-fade-range")),it=[];let gt;we&&it.push("PROJECTION_GLOBE_VIEW"),ee[0]>0&&it.push("FAUX_AO"),ae&&it.push("ZERO_ROOF_RADIUS"),C&&it.push("HAS_CENTROID"),ke>0&&it.push("FLOOD_LIGHT"),$e.shouldRenderCutoff&&it.push("RENDER_CUTOFF"),We&&it.push("RENDER_WALL_MODE");const Ue=h.renderPass==="shadow",ht=h.shadowRenderer,nt=Ue&&!!ht;h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0);let St=[0,0,0];if(ht){const vt=h.style.directionalLight,Et=h.style.ambientLight;vt&&Et&&(St=rm(h.style,vt,Et)),Ue||(it.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ht.useNormalOffset&&it.push("NORMAL_OFFSET")),gt=it.concat(["SHADOWS_SINGLE_CASCADE"])}const pt=nt?"fillExtrusionDepth":B?"fillExtrusionPattern":"fillExtrusion",ut=o.getLayerRenderingStats();for(const vt of d){const Et=i.getTile(vt),Nt=Et.getBucket(o);if(!Nt||Nt.projection.name!==O.projection.name)continue;let $t=!1;ht&&($t=ht.getMaxCascadeForTile(vt.toUnwrapped())===0);const fi=h.isTileAffectedByFog(vt),ri=Nt.programConfigurations.get(o.id),ai=h.getOrCreateProgram(pt,{config:ri,defines:$t?gt:it,overrideFog:fi});if(h.terrain&&h.terrain.setupElevationDraw(Et,ai,{useMeterToDem:!0}),!Nt.centroidVertexBuffer){const Hi=ai.attributes.a_centroid_pos;Hi!==void 0&&L.vertexAttrib2f(Hi,0,0)}!Ue&&ht&&ht.setupShadows(Et.tileID.toUnwrapped(),ai,"vector-tile",Et.tileID.overscaledZ),B&&(h.context.activeTexture.set(L.TEXTURE0),Et.imageAtlasTexture&&Et.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),ri.updatePaintBuffers());const xi=N.constantOr(null);if(xi&&Et.imageAtlas){const Hi=Et.imageAtlas,ei=n.A.from(xi).getPrimary().scaleSelf(n.q.devicePixelRatio),ki=Hi.patternPositions[ei.serialize()];ki&&ri.setConstantPatternPositions(ki)}const Bi=o.paint.get("fill-extrusion-vertical-gradient"),on=1/Nt.tileToMeter;let Nn;if(Ue&&ht){if(Nc(Et.tileID,Nt,h))continue;const Hi=ht.calculateShadowPassMatrixFromTile(Et.tileID.toUnwrapped());Nn=lh(Hi,pe,on,tt,ct,lt)}else{const Hi=h.translatePosMatrix(vt.expandedProjMatrix,Et,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),ei=O.projection.createInversionMatrix(O,vt.canonical);Nn=B?yy(Hi,h,Bi,q,ee,pe,on,vt,Et,fe,ct,lt,ge,ve,ei,Me,tt):nf(Hi,h,Bi,q,ee,pe,on,vt,fe,ct,lt,ge,ve,ei,Me,tt,ke,St)}h.uploadCommonUniforms(D,ai,vt.toUnwrapped(),null,$e);let Tn=Nt.segments;if(O.projection.name==="mercator"&&!Ue&&(Tn=Nt.getVisibleSegments(Et.tileID,h.terrain,h.transform.getFrustum(0)),!Tn.get().length))continue;if(ut)if(Ue)for(const Hi of Tn.get())ut.numRenderedVerticesInShadowPass+=Hi.primitiveLength;else for(const Hi of Tn.get())ut.numRenderedVerticesInTransparentPass+=Hi.primitiveLength;const wi=[];(h.terrain||C)&&wi.push(Nt.centroidVertexBuffer),we&&wi.push(Nt.layoutVertexExtBuffer),We&&wi.push(Nt.wallVertexBuffer),ai.draw(h,D.gl.TRIANGLES,g,v,w,gi.backCCW,Nn,o.id,Nt.layoutVertexBuffer,Nt.indexBuffer,Tn,o.paint,h.transform.zoom,ri,wi)}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1)}function zc(h,i,o,d,g,v,w,C,D,L,O,N,B,q,J,X,ee,Q,ae){const pe=h.context,fe=pe.gl,we=h.transform,ge=h.transform.zoom,ve=[],_e=il(h,o.paint.get("fill-extrusion-cutoff-fade-range"));L==="clear"?(ve.push("CLEAR_SUBPASS"),ae&&(ve.push("CLEAR_FROM_TEXTURE"),pe.activeTexture.set(fe.TEXTURE0),ae.bind(fe.LINEAR,fe.CLAMP_TO_EDGE))):L==="sdf"&&ve.push("SDF_SUBPASS"),ee&&ve.push("HAS_CENTROID"),_e.shouldRenderCutoff&&ve.push("RENDER_CUTOFF");const Me=o.layout.get("fill-extrusion-edge-radius"),ke=(tt,We,ct,lt,$e)=>{const it=We.programConfigurations.get(o.id),gt=h.isTileAffectedByFog(tt),Ue=h.getOrCreateProgram("fillExtrusionGroundEffect",{config:it,defines:ve,overrideFog:gt}),ht=((St,pt,ut,vt,Et,Nt,$t,fi,ri,ai,xi)=>({u_matrix:pt,u_opacity:ut,u_ao_pass:vt?1:0,u_meter_to_tile:Et,u_ao:Nt,u_flood_light_intensity:$t,u_flood_light_color:fi,u_attenuation:ri,u_edge_radius:ai,u_fb:0,u_fb_size:xi,u_dynamic_offset:1}))(0,lt,O,D,$e,[N,B*$e],q,J,X,ge>=17?0:Me*$e,ae?ae.size[0]:0),nt=[];ee&&nt.push(We.hiddenByLandmarkVertexBuffer),h.uploadCommonUniforms(pe,Ue,tt.toUnwrapped(),null,_e),Ue.draw(h,pe.gl.TRIANGLES,g,v,w,C,ht,o.id,We.vertexBuffer,We.indexBuffer,ct,o.paint,ge,it,nt)};for(const tt of d){const We=i.getTile(tt),ct=We.getBucket(o);if(!ct||ct.projection.name!==we.projection.name||!ct.groundEffect||ct.groundEffect&&!ct.groundEffect.hasData())continue;const lt=ct.groundEffect,$e=1/ct.tileToMeter;{const it=h.translatePosMatrix(tt.projMatrix,We,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),gt=lt.getDefaultSegment();ke(tt,lt,gt,it,$e)}if(Q)for(let it=0;it<4;it++){const gt=n.d4[it](tt),Ue=i.getTile(gt);if(!Ue)continue;const ht=Ue.getBucket(o);if(!ht||ht.projection.name!==we.projection.name||!ht.groundEffect||ht.groundEffect&&!ht.groundEffect.hasData())continue;const nt=ht.groundEffect;let St,pt;it===0?(St=[-n.ag,0,0],pt=1):it===1?(St=[n.ag,0,0],pt=0):it===2?(St=[0,-n.ag,0],pt=3):(St=[0,n.ag,0],pt=2);const ut=nt.regionSegments[pt];if(!ut)continue;const vt=new Float32Array(16);n.ab.mat4.translate(vt,tt.projMatrix,St),ke(tt,nt,ut,h.translatePosMatrix(vt,We,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),$e)}}}function kc(h,i,o,d,g,v,w){d.centroidVertexArray.length===0&&d.createCentroidsBuffer();const C=v?v.findDEMTileFor(o):null;if(!(C&&C.dem||w))return;v&&C&&C.dem&&d.selfDEMTileTimestamp!==C.dem._timestamp&&(d.borderDoneWithNeighborZ=[-1,-1,-1,-1],d.selfDEMTileTimestamp=C.dem._timestamp);const D=Q=>new n.P(Math.ceil((Q+n.d7)*n.d8),0),L=Q=>{const ae=i.getSource().minzoom,pe=we=>{const ge=i.getTileByID(we);if(ge&&ge.hasData())return ge.getBucket(g)},fe=[0,-1,1];for(const we of fe){if(Q.overscaledZ+we<ae)continue;const ge=pe(Q.calculateScaledKey(Q.overscaledZ+we));if(ge)return ge}},O=[0,0,0],N=(Q,ae)=>(O[0]=Math.min(Q.min.y,ae.min.y),O[1]=Math.max(Q.max.y,ae.max.y),O[2]=n.ag-ae.min.x>Q.max.x?ae.min.x-n.ag:Q.max.x,O),B=(Q,ae)=>(O[0]=Math.min(Q.min.x,ae.min.x),O[1]=Math.max(Q.max.x,ae.max.x),O[2]=n.ag-ae.min.y>Q.max.y?ae.min.y-n.ag:Q.max.y,O),q=[(Q,ae)=>N(Q,ae),(Q,ae)=>N(ae,Q),(Q,ae)=>B(Q,ae),(Q,ae)=>B(ae,Q)],J=(Q,ae,pe,fe,we,ge,ve)=>{if(!v)return 0;const _e=[[ge?pe:Q,ge?Q:pe,0],[ge?pe:ae,ge?ae:pe,0]],Me=ve<0?n.ag+ve:ve,ke=[ge?Me:(Q+ae)/2,ge?(Q+ae)/2:Me,0];return pe===0&&ve<0||pe!==0&&ve>0?v.getForTilePoints(we,[ke],!0,fe):_e.push(ke),v.getForTilePoints(o,_e,!0,C),Math.max(_e[0][2],_e[1][2],ke[2])/v.exaggeration()};for(let Q=0;Q<4;Q++){const ae=d.borderFeatureIndices[Q];if(ae.length===0)continue;const pe=n.d4[Q](o),fe=L(pe);if(!(fe&&fe instanceof n.d5))continue;const we=v?v.findDEMTileFor(pe):null;if(!(we&&we.dem||w)||(v&&we&&we.dem&&d.borderDEMTileTimestamp[Q]!==we.dem._timestamp&&(d.borderDoneWithNeighborZ[Q]=-1,d.borderDEMTileTimestamp[Q]=we.dem._timestamp),d.borderDoneWithNeighborZ[Q]===fe.canonical.z))continue;fe.centroidVertexArray.length===0&&fe.createCentroidsBuffer();const ge=(Q<2?1:5)-Q,ve=fe.borderDoneWithNeighborZ[ge]!==d.canonical.z,_e=fe.borderFeatureIndices[ge];let Me=0;if(d.canonical.z!==fe.canonical.z){for(const ke of ae)d.showCentroid(d.featuresOnBorder[ke]);if(ve)for(const ke of _e)fe.showCentroid(fe.featuresOnBorder[ke]);d.borderDoneWithNeighborZ[Q]=fe.canonical.z,fe.borderDoneWithNeighborZ[ge]=d.canonical.z}for(const ke of ae){const tt=d.featuresOnBorder[ke],We=d.centroidData[tt.centroidDataIndex],ct=tt.borders[Q];let lt;for(;Me<_e.length;){lt=fe.featuresOnBorder[_e[Me]];const $e=lt.borders[ge];if($e[1]>ct[0]+3||$e[0]>ct[0]-3)break;fe.showCentroid(lt),Me++}if(lt&&Me<_e.length){const $e=Me;let it=0;for(;!(lt.borders[ge][0]>ct[1]-3)&&(it++,++Me!==_e.length);)lt=fe.featuresOnBorder[_e[Me]];lt=fe.featuresOnBorder[_e[$e]];let gt=!1;if(it>=1){const nt=lt.borders[ge];Math.abs(ct[0]-nt[0])<3&&Math.abs(ct[1]-nt[1])<3&&(it=1,gt=!0,Me=$e+1)}else if(it===0){d.showCentroid(tt);continue}const Ue=fe.centroidData[lt.centroidDataIndex];w&&gt&&(((X=We).flags|(ee=Ue).flags)&n.d6?(X.flags|=n.d6,ee.flags|=n.d6):(X.flags&=~n.d6,ee.flags&=~n.d6));const ht=tt.intersectsCount()>1||lt.intersectsCount()>1;if(it>1)Me=$e,We.centroidXY=Ue.centroidXY=new n.P(0,0);else if(we&&we.dem&&!ht){const nt=q[Q](We,Ue),St=Q%2?n.ag-1:0,pt=J(nt[0],Math.min(n.ag-1,nt[1]),St,we,pe,Q<2,nt[2]);We.centroidXY=Ue.centroidXY=D(pt)}else ht?We.centroidXY=Ue.centroidXY=new n.P(0,0):(We.centroidXY=d.encodeBorderCentroid(tt),Ue.centroidXY=fe.encodeBorderCentroid(lt));d.writeCentroidToBuffer(We),fe.writeCentroidToBuffer(Ue)}else d.showCentroid(tt)}d.borderDoneWithNeighborZ[Q]=fe.canonical.z,fe.borderDoneWithNeighborZ[ge]=d.canonical.z}var X,ee;(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(h)}const Fc=[1,0,0],wt=[0,1,0],Vt=[0,0,1];function Nc(h,i,o){const d=o.transform,g=o.shadowRenderer;if(!g)return!0;const v=h.toUnwrapped(),w=d.tileSize*g._cascades[o.currentShadowCascade].scale;let C=i.maxHeight;if(d.elevation){const X=d.elevation.getMinMaxForTile(h);X&&(C+=X.max)}const D=[...g.shadowDirection];D[2]=-D[2];const L=g.computeSimplifiedTileShadowVolume(v,C,w,D);if(!L)return!1;const O=[Fc,wt,Vt,D,[D[0],0,D[2]],[0,D[1],D[2]]],N=d.projection.name==="globe",B=d.scaleZoom(w),q=n.bR.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,B,!N),J=g.getCurrentCascadeFrustum();return q.intersectsPrecise(L.vertices,L.planes,O)===0||J.intersectsPrecise(L.vertices,L.planes,O)===0}function Dn(h){return[h[0]*n.d9,h[1]*n.d9,h[2]*n.d9,0]}function Ye(h,i,o,d,g,v,w,C,D){const L=d.getSource(),O=o.globeSharedBuffers;if(!O)return;let N,B,q;if(i&&(N=d.getTile(i)),L instanceof n.aJ?(B=L.texture,q=n.cI(0,0,o.transform)):N&&i&&(B=N.texture,q=n.cI(i.canonical.z,i.canonical.x,o.transform)),!B||!q)return;h||(q=n.ab.mat4.scale(n.ab.mat4.create(),q,[1,-1,1]));const J=o.context,X=J.gl,ee=g.paint.get("raster-resampling")==="nearest"?X.NEAREST:X.LINEAR,Q=o.colorModeForDrapableLayerRenderPass(v),ae=w.defines;ae.push("GLOBE_POLES");const pe=new oi(X.LEQUAL,oi.ReadWrite,o.depthRangeFor3D),fe=Float32Array.from(o.transform.expandedFarZProjMatrix),we=Float32Array.from(n.bb(n.cH(new n.bT(0,0,0))));o.terrain&&o.terrain.prepareDrawTile(),J.activeTexture.set(X.TEXTURE0),B.bind(ee,X.CLAMP_TO_EDGE),J.activeTexture.set(X.TEXTURE1),B.bind(ee,X.CLAMP_TO_EDGE),B.useMipmap&&J.extTextureFilterAnisotropic&&o.transform.pitch>20&&X.texParameterf(X.TEXTURE_2D,J.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,J.extTextureFilterAnisotropicMax);const[ge,ve,_e,Me]=i?O.getPoleBuffers(i.canonical.z,!1):O.getPoleBuffers(0,!0),ke=g.paint.get("raster-elevation");let tt;h?(tt=ge,o.renderDefaultNorthPole=ke!==0):(tt=ve,o.renderDefaultSouthPole=ke!==0);const We=Dn(w.mix),ct=(($e,it,gt,Ue,ht,nt,St,pt,ut,vt,Et,Nt,$t)=>sl($e,it,gt,new Float32Array(16),new Float32Array(9),[0,0],Ue,[0,0],[0,0,0,0],1,{opacity:1,mix:0},nt,[0,0],pt,2,vt,Et,Nt,1,0,$t))(fe,we,q,n.ae(o.transform.zoom),0,g,0,ke,0,We,w.offset,w.range,v),lt=o.getOrCreateProgram("raster",{defines:ae});o.uploadCommonUniforms(J,lt,null),lt.draw(o,X.TRIANGLES,pe,D,Q,C,ct,g.id,tt,_e,Me)}function by(h){const i=h._nearZ,o=h.projection.farthestPixelDistance(h),d=o-i,g=.2*h.height,v=i+g;return[i,o,(v-g-i)/d,(v-i)/d]}function uf(h,i,o,d){if(h)return i instanceof mr&&h instanceof el?i.getTextureDescriptor(h,o,!0):{texture:h.texture,mix:Dn(d.mix),offset:d.offset,buffer:0,tileSize:1}}var Fm=n.da([{name:"a_index",type:"Int16",components:1}]);class wy{constructor(i,o,d,g){const v={width:d[0],height:d[1],data:null},w=i.gl;this.targetColorTexture=new n.T(i,v,w.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new n.T(i,v,w.RGBA8,{useMipmap:!1}),this.context=i,this.updateParticleTexture(o,g),this.lastInvalidatedAt=0}updateParticleTexture(i,o){if(this.particleTextureDimension===o.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const d=this.context.gl,g=o.width*o.height;this.particleTexture0=new n.T(this.context,o,d.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new n.T(this.context,o,d.RGBA8,{premultiply:!1,useMipmap:!1});const v=new n.db;v.reserve(g);for(let w=0;w<g;w++)v.emplaceBack(w);this.particleIndexBuffer=this.context.createVertexBuffer(v,Fm.members,!0),this.particleSegment=n.b7.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=o.width}update(i){return!(this.lastInvalidatedAt<i&&(this.lastInvalidatedAt=n.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Ty(h,i,o){if(!h)return null;const d=i.getTextureDescriptor(h,o,!0);if(!d)return null;let{texture:g,mix:v,offset:w,tileSize:C,buffer:D,format:L}=d;if(!g||!L)return null;let O=!1;return L==="uint32"&&(O=!0,v[3]=0,v=Mm(n.dc,v,[0,o.paint.get("raster-particle-max-speed")]),w=Cm(n.dc,w,[0,o.paint.get("raster-particle-max-speed")])),{texture:g,textureOffset:[D/(C+2*D),C/(C+2*D)],tileSize:C,scalarData:O,scale:v,offset:w,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[L]]}}function Ey(h){const i=h._nearZ,o=h.projection.farthestPixelDistance(h),d=o-i,g=.2*h.height,v=i+g;return[i,o,(v-g-i)/d,(v-i)/d]}const Bc=new n.aj(1,0,0,1),gx=new n.aj(0,1,0,1),yx=new n.aj(0,0,1,1),Sy=new n.aj(1,0,1,1),hf=new n.aj(0,1,1,1);function al(h,i,o,d,g,v,w){const C=h.context,D=h.transform,L=C.gl,O=D.projection.name==="globe",N=O?["PROJECTION_GLOBE_VIEW"]:[];let B=n.ab.mat4.clone(o.projMatrix);if(O&&n.ae(D.zoom)>0){const We=n.ba(o.canonical,D),ct=n.dd(We);B=n.ab.mat4.multiply(new Float32Array(16),D.globeMatrix,ct),n.ab.mat4.multiply(B,D.projMatrix,B)}const q=n.ab.mat4.create();q[12]+=2*g/(n.q.devicePixelRatio*D.width),q[13]+=2*v/(n.q.devicePixelRatio*D.height),n.ab.mat4.multiply(B,q,B);const J=h.getOrCreateProgram("debug",{defines:N}),X=i.getTileByID(o.key);h.terrain&&h.terrain.setupElevationDraw(X,J);const ee=oi.disabled,Q=pi.disabled,ae=h.colorModeForRenderPass(),pe="$debug";C.activeTexture.set(L.TEXTURE0),h.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),O?X._makeGlobeTileDebugBuffers(h.context,D):X._makeDebugTileBoundsBuffers(h.context,D.projection);const fe=X._tileDebugBuffer||h.debugBuffer,we=X._tileDebugIndexBuffer||h.debugIndexBuffer,ge=X._tileDebugSegments||h.debugSegments;if(J.draw(h,L.LINE_STRIP,ee,Q,ae,gi.disabled,Ul(B,d),pe,fe,we,ge,null,null,null,[X._globeTileDebugBorderBuffer]),w){const We=X.latestRawTileData,ct=Math.floor((We&&We.byteLength||0)/1024);let lt=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(lt+=` => ${o.overscaledZ}`),lt+=` ${X.state}`,lt+=` ${ct}kb`,function($e,it){$e.initDebugOverlayCanvas();const gt=$e.debugOverlayCanvas,Ue=$e.context.gl,ht=$e.debugOverlayCanvas.getContext("2d");ht.clearRect(0,0,gt.width,gt.height),ht.shadowColor="white",ht.shadowBlur=2,ht.lineWidth=1.5,ht.strokeStyle="white",ht.textBaseline="top",ht.font="bold 36px Open Sans, sans-serif",ht.fillText(it,5,5),ht.strokeText(it,5,5),$e.debugOverlayTexture.update(gt),$e.debugOverlayTexture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE)}(h,lt)}const ve=i.getTile(o).tileSize,_e=512/Math.min(ve,512)*(o.overscaledZ/D.zoom)*.5,Me=X._tileDebugTextBuffer||h.debugBuffer,ke=X._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,tt=X._tileDebugTextSegments||h.debugSegments;J.draw(h,L.TRIANGLES,ee,Q,Pi.alphaBlended,gi.disabled,Ul(B,n.aj.transparent,_e),pe,Me,ke,tt,null,null,null,[X._globeTileDebugTextBuffer])}function Nm(h,i,o,d){$l(h,0,i+o/2,h.transform.width,o,d)}function Bm(h,i,o,d){$l(h,i-o/2,0,o,h.transform.height,d)}function $l(h,i,o,d,g,v){const w=h.context,C=w.gl;C.enable(C.SCISSOR_TEST),C.scissor(i*n.q.devicePixelRatio,o*n.q.devicePixelRatio,d*n.q.devicePixelRatio,g*n.q.devicePixelRatio),w.clear({color:v}),C.disable(C.SCISSOR_TEST)}const df=n.da([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ra}=df;function ka(h,i,o,d){h.emplaceBack(i,o,d)}class Ay{constructor(i){this.vertexArray=new n.de,this.indices=new n.aU,ka(this.vertexArray,-1,-1,1),ka(this.vertexArray,1,-1,1),ka(this.vertexArray,-1,1,1),ka(this.vertexArray,1,1,1),ka(this.vertexArray,-1,-1,-1),ka(this.vertexArray,1,-1,-1),ka(this.vertexArray,-1,1,-1),ka(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,ra),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=n.b7.simpleSegment(0,0,36,12)}}function Mr(h,i,o,d,g,v){const w=h.context.gl,C=i.paint.get("sky-atmosphere-color"),D=i.paint.get("sky-atmosphere-halo-color"),L=i.paint.get("sky-atmosphere-sun-intensity"),O=((N,B,q,J,X)=>({u_matrix_3f:N,u_sun_direction:B,u_sun_intensity:q,u_color_tint_r:[J.r,J.g,J.b,J.a],u_color_tint_m:[X.r,X.g,X.b,X.a],u_luminance:5e-5}))(n.ab.mat3.fromMat4(n.ab.mat3.create(),d),g,L,C,D);w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+v,i.skyboxTexture,0),o.draw(h,w.TRIANGLES,oi.disabled,pi.disabled,Pi.unblended,gi.frontCW,O,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const vx=n.da([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class mh{constructor(i){const o=new n.df;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const d=new n.aU;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(o,vx.members),this.indexBuffer=i.createIndexBuffer(d),this.segments=n.b7.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const wn=n.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class en{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class My{constructor(i){this.colorModeAlphaBlendedWriteRGB=new Pi([1,Rl,1,Rl],n.aj.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Pi([1,0,1,0],n.aj.transparent,[!1,!1,!1,!0]),this.params=new en,this.updateNeeded=!0,i.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),i.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(i){const o=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new mh(o);const d=this.params.sizeRange,g=this.params.intensityRange,v=function(O){const N=n.di(30),B=[];for(let q=0;q<O;++q){const J=2*Math.PI*N(),X=Math.acos(1-2*N())-.5*Math.PI;B.push(n.ab.vec3.fromValues(Math.cos(X)*Math.cos(J),Math.cos(X)*Math.sin(J),Math.sin(X)))}return B}(this.params.starsCount),w=n.di(300),C=new n.dg,D=new n.aU;let L=0;for(let O=0;O<v.length;++O){const N=n.ab.vec3.scale([],v[O],200),B=Math.max(0,1+.01*d*(1*w()-.5)),q=Math.max(0,1+.01*g*(1*w()-.5));C.emplaceBack(N[0],N[1],N[2],-1,-1,B,q),C.emplaceBack(N[0],N[1],N[2],1,-1,B,q),C.emplaceBack(N[0],N[1],N[2],1,1,B,q),C.emplaceBack(N[0],N[1],N[2],-1,1,B,q),D.emplaceBack(L+0,L+1,L+2),D.emplaceBack(L+0,L+2,L+3),L+=4}this.starsVx=o.createVertexBuffer(C,wn.members),this.starsIdx=o.createIndexBuffer(D),this.starsSegments=n.b7.simpleSegment(0,0,C.length,D.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(i,o){const d=i.context,g=d.gl,v=i.transform,w=new oi(g.LEQUAL,oi.ReadOnly,[0,1]),C=n.ae(v.zoom),D=i.style.getLut(o.scope),L=o.properties.get("color-use-theme")==="none",O=o.properties.get("color").toRenderColor(L?null:D).toArray01(),N=o.properties.get("high-color-use-theme")==="none",B=o.properties.get("high-color").toRenderColor(N?null:D).toArray01(),q=o.properties.get("space-color-use-theme")==="none",J=o.properties.get("space-color").toRenderColor(q?null:D).toArray01PremultipliedAlpha(),X=5e-4,ee=n.dh(o.properties.get("horizon-blend"),0,1,X,.25),Q=n.cC(i,d,v)&&ee===X?v.worldSize/(2*Math.PI*1.025)-1:v.globeRadius,ae=i.frameCounter/1e3%1,pe=n.ab.vec3.length(v.globeCenterInViewSpace),fe=Math.sqrt(Math.pow(pe,2)-Math.pow(Q,2)),we=Math.acos(fe/pe),ge=ve=>{const _e=v.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ve&&_e.push("ALPHA_PASS");const Me=i.getOrCreateProgram("globeAtmosphere",{defines:_e}),ke=((We,ct,lt,$e,it,gt,Ue,ht,nt,St,pt,ut)=>({u_frustum_tl:We,u_frustum_tr:ct,u_frustum_br:lt,u_frustum_bl:$e,u_horizon:it,u_transition:gt,u_fadeout_range:Ue,u_color:ht,u_high_color:nt,u_space_color:St,u_temporal_offset:pt,u_horizon_angle:ut}))(v.frustumCorners.TL,v.frustumCorners.TR,v.frustumCorners.BR,v.frustumCorners.BL,v.frustumCorners.horizon,C,ee,O,B,J,ae,we);i.uploadCommonUniforms(d,Me);const tt=this.atmosphereBuffer;tt&&Me.draw(i,g.TRIANGLES,w,pi.disabled,ve?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,gi.backCW,ke,ve?"atmosphere_glow_alpha":"atmosphere_glow",tt.vertexBuffer,tt.indexBuffer,tt.segments)};ge(!1),ge(!0)}drawStars(i,o){const d=n.aw(o.properties.get("star-intensity"),0,1);if(d===0)return;const g=i.context,v=g.gl,w=i.transform,C=i.getOrCreateProgram("stars"),D=n.ab.quat.identity([]);n.ab.quat.rotateX(D,D,-w._pitch),n.ab.quat.rotateZ(D,D,-w.angle),n.ab.quat.rotateX(D,D,n.ai(w._center.lat)),n.ab.quat.rotateY(D,D,-n.ai(w._center.lng));const L=n.ab.mat4.fromQuat(new Float32Array(16),D),O=n.ab.mat4.multiply([],w.starsProjMatrix,L),N=n.ab.mat3.fromMat4([],L),B=n.ab.mat3.invert([],N),q=[0,1,0];n.ab.vec3.transformMat3(q,q,B),n.ab.vec3.scale(q,q,this.params.sizeMultiplier);const J=[1,0,0];n.ab.vec3.transformMat3(J,J,B),n.ab.vec3.scale(J,J,this.params.sizeMultiplier);const X=(ee=q,Q=J,ae=d,{u_matrix:Float32Array.from(O),u_up:ee,u_right:Q,u_intensity_multiplier:ae});var ee,Q,ae;i.uploadCommonUniforms(g,C),this.starsVx&&this.starsIdx&&C.draw(i,v.TRIANGLES,oi.disabled,pi.disabled,this.colorModeAlphaBlendedWriteRGB,gi.disabled,X,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Fa(h,i){const o=[...h],d=i.cameraWorldSizeForFog/i.worldSize,g=n.ab.mat4.identity([]);return n.ab.mat4.scale(g,g,[d,d,1]),n.ab.mat4.multiply(o,g,o),n.ab.mat4.multiply(o,i.worldToFogMatrix,o),o}function Vc(h,i,o,d,g){const v=o.material,w=d.context,{baseColorTexture:C,metallicRoughnessTexture:D}=v.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:O,emissionTexture:N}=v;function B(J,X,ee){if(J&&(h.push(X),w.activeTexture.set(w.gl.TEXTURE0+ee),J.gfxTexture)){const{minFilter:Q,magFilter:ae,wrapS:pe,wrapT:fe}=J.sampler;J.gfxTexture.bindExtraParam(Q,ae,pe,fe)}}B(C,"HAS_TEXTURE_u_baseColorTexture",Hr.BaseColor),B(D,"HAS_TEXTURE_u_metallicRoughnessTexture",Hr.MetallicRoughness),B(L,"HAS_TEXTURE_u_normalTexture",Hr.Normal),B(O,"HAS_TEXTURE_u_occlusionTexture",Hr.Occlusion),B(N,"HAS_TEXTURE_u_emissionTexture",Hr.Emission),g&&(g.texture||(g.texture=new n.dk(d.context,g.image,[g.image.height,g.image.height,g.image.height],w.gl.RGBA8)),w.activeTexture.set(w.gl.TEXTURE0+Hr.LUT),g.texture&&g.texture.bind(w.gl.LINEAR,w.gl.CLAMP_TO_EDGE),h.push("APPLY_LUT_ON_GPU")),o.texcoordBuffer&&(h.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(o.texcoordBuffer)),o.colorBuffer&&(h.push(o.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(o.colorBuffer)),o.normalBuffer&&(h.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(o.normalBuffer)),o.pbrBuffer&&(h.push("HAS_ATTRIBUTE_a_pbr"),h.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(o.pbrBuffer)),v.alphaMode!=="OPAQUE"&&v.alphaMode!=="MASK"||h.push("UNPREMULT_TEXTURE_IN_SHADER"),v.defined||h.push("DIFFUSE_SHADED");const q=d.shadowRenderer;q&&(h.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&h.push("NORMAL_OFFSET"))}function Na(h,i,o,d,g,v){const w=o.paint.get("model-opacity").constantOr(1),C=i.context,D=new oi(i.context.gl.LEQUAL,oi.ReadWrite,i.depthRangeFor3D),L=i.transform,O=h.mesh,N=O.material,B=N.pbrMetallicRoughness,q=i.style.fog;let J;J=i.transform.projection.zAxisUnit==="pixels"?[...h.nodeModelMatrix]:n.ab.mat4.multiply([],d.zScaleMatrix,h.nodeModelMatrix),n.ab.mat4.multiply(J,d.negCameraPosMatrix,J);const X=n.ab.mat4.invert([],J);n.ab.mat4.transpose(X,X);const ee=o.paint.get("model-color-use-theme").constantOr("default")==="none",Q=o.paint.get("model-emissive-strength").constantOr(0),ae=hh(new Float32Array(h.worldViewProjection),new Float32Array(J),new Float32Array(X),null,i,w,B.baseColorFactor.toRenderColor(null),N.emissiveFactor,B.metallicFactor,B.roughnessFactor,N,Q,o),pe={defines:[]},fe=[],we=i.shadowRenderer;we&&(we.useNormalOffset=!1),Vc(pe.defines,fe,O,i,ee?null:o.lut);let ge=null;if(q){const Me=Fa(h.nodeModelMatrix,i.transform);if(ge=new Float32Array(Me),L.projection.name!=="globe"){const ke=O.aabb.min,tt=O.aabb.max,[We,ct]=q.getOpacityForBounds(Me,ke[0],ke[1],tt[0],tt[1]);pe.overrideFog=We>=xe||ct>=xe}}const ve=il(i,o.paint.get("model-cutoff-fade-range"));ve.shouldRenderCutoff&&pe.defines.push("RENDER_CUTOFF");const _e=i.getOrCreateProgram("model",pe);i.uploadCommonUniforms(C,_e,null,ge,ve),i.renderPass!=="shadow"&&we&&we.setupShadowsFromMatrix(h.nodeModelMatrix,_e),_e.draw(i,C.gl.TRIANGLES,D,g,v,O.material.doubleSided?gi.disabled:gi.backCCW,ae,o.id,O.vertexBuffer,O.indexBuffer,O.segments,o.paint,i.transform.zoom,void 0,fe)}function ff(h,i,o,d,g,v,w){let C;C=h.projection.name==="globe"?n.dl(o,h):[...o],n.ab.mat4.multiply(C,C,i.matrix);const D=n.ab.mat4.multiply([],d,C);if(i.meshes)for(const L of i.meshes){if(L.material.alphaMode!=="BLEND"){w.push({mesh:L,depth:0,modelIndex:g,worldViewProjection:D,nodeModelMatrix:C});continue}const O=n.ab.vec3.transformMat4([],L.centroid,D);!h.isOrthographic&&O[2]<=0||v.push({mesh:L,depth:O[2],modelIndex:g,worldViewProjection:D,nodeModelMatrix:C})}if(i.children)for(const L of i.children)ff(h,L,o,d,g,v,w)}function _h(h,i,o,d){const g=o.shadowRenderer;if(!g)return;const v=g.getShadowPassDepthMode(),w=g.getShadowPassColorMode(),C=g.calculateShadowPassMatrixFromMatrix(i),D=of(C);o.getOrCreateProgram("modelDepth",{defines:o._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(o,o.context.gl.TRIANGLES,v,pi.disabled,w,gi.backCCW,D,d.id,h.vertexBuffer,h.indexBuffer,h.segments,d.paint,o.transform.zoom,void 0,void 0)}function sa(h,i,o){const d=i.updateZoomBasedPaintProperties(),g=function(v,w,C){let D,L,O,N=v.terrain?v.terrain.exaggeration():0;if(v.terrain&&N>0){const B=v.terrain,q=B.findDEMTileFor(C);q&&q.dem?D=n.dn.create(B,C,q):N=0}if(N===0&&(w.terrainElevationMin=0,w.terrainElevationMax=0),N===w.validForExaggeration&&(N===0||D&&D._demTile&&D._demTile.tileID===w.validForDEMTile.id&&D._dem._timestamp===w.validForDEMTile.timestamp))return!1;for(const B in w.instancesPerModel){const q=w.instancesPerModel[B];for(let J=0;J<q.instancedDataArray.length;++J){const X=(D?N*D.getElevationAt(0|q.instancedDataArray.float32[16*J],0|q.instancedDataArray.float32[16*J+1],!0,!0):0)+q.instancesEvaluatedElevation[J];q.instancedDataArray.float32[16*J+6]=X,L=L?Math.min(w.terrainElevationMin,X):X,O=O?Math.max(w.terrainElevationMax,X):X}}return w.terrainElevationMin=L||0,w.terrainElevationMax=O||0,w.validForExaggeration=N,w.validForDEMTile=D&&D._demTile?{id:D._demTile.tileID,timestamp:D._dem._timestamp}:{id:void 0,timestamp:0},!0}(h,i,o);(d||g)&&(i.uploaded=!1,i.upload(h.context))}const es={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new n.cd([0,0,0],[n.ag,n.ag,0])};function pf(h,i){const o=1<<h.canonical.z,d=i.getFreeCameraOptions().position,g=i.elevation,v=h.canonical.x/o,w=(h.canonical.x+1)/o,C=h.canonical.y/o,D=(h.canonical.y+1)/o;let L=i._centerAltitude;if(g){const q=g.getMinMaxForTile(h);q&&q.max>L&&(L=q.max)}const O=n.aw(d.x,v,w)-d.x,N=n.aw(d.y,C,D)-d.y,B=n.bH(L,i.center.lat)-d.z;return i._zoomFromMercatorZ(Math.sqrt(O*O+N*N+B*B))}function gh(h,i,o,d,g,v,w){const C=h.context,D=h.renderPass==="shadow",L=h.shadowRenderer,O=D&&L?L.getShadowPassDepthMode():new oi(C.gl.LEQUAL,oi.ReadWrite,h.depthRangeFor3D),N=h.isTileAffectedByFog(v);if(o.meshes)for(const B of o.meshes){const q=["MODEL_POSITION_ON_GPU"],J=[];let X,ee,Q;d.instancedDataArray.length>20&&q.push("INSTANCED_ARRAYS");const ae=il(h,i.paint.get("model-cutoff-fade-range"));if(ae.shouldRenderCutoff&&q.push("RENDER_CUTOFF"),D&&L)X=h.getOrCreateProgram("modelDepth",{defines:q}),ee=of(w.shadowTileMatrix,w.shadowTileMatrix,Float32Array.from(o.matrix)),Q=L.getShadowPassColorMode();else{Vc(q,J,B,h,i.paint.get("model-color-use-theme").constantOr("default")==="none"?null:i.lut),X=h.getOrCreateProgram("model",{defines:q,overrideFog:N});const fe=B.material,we=fe.pbrMetallicRoughness,ge=i.paint.get("model-opacity").constantOr(1),ve=i.paint.get("model-emissive-strength").constantOr(0);ee=hh(v.expandedProjMatrix,Float32Array.from(o.matrix),new Float32Array(16),null,h,ge,we.baseColorFactor.toRenderColor(null),fe.emissiveFactor,we.metallicFactor,we.roughnessFactor,fe,ve,i,g),L&&(w.shadowUniformsInitialized?X.setShadowUniformValues(C,L.getShadowUniformValues()):(L.setupShadows(v.toUnwrapped(),X,"model-tile",v.overscaledZ),w.shadowUniformsInitialized=!0)),Q=ae.shouldRenderCutoff||ge<1||fe.alphaMode!=="OPAQUE"?Pi.alphaBlended:Pi.unblended}h.uploadCommonUniforms(C,X,v.toUnwrapped(),null,ae);const pe=B.material.doubleSided?gi.disabled:gi.backCCW;if(d.instancedDataArray.length>20)J.push(d.instancedDataBuffer),X.draw(h,C.gl.TRIANGLES,O,pi.disabled,Q,pe,ee,i.id,B.vertexBuffer,B.indexBuffer,B.segments,i.paint,h.transform.zoom,void 0,J,d.instancedDataArray.length);else{const fe=D?"u_instance":"u_normal_matrix";for(let we=0;we<d.instancedDataArray.length;++we)ee[fe]=new Float32Array(d.instancedDataArray.arrayBuffer,64*we,16),X.draw(h,C.gl.TRIANGLES,O,pi.disabled,Q,pe,ee,i.id,B.vertexBuffer,B.indexBuffer,B.segments,i.paint,h.transform.zoom,void 0,J)}}if(o.children)for(const B of o.children)gh(h,i,B,d,g,v,w)}const Vm=[1,-1,1];function Um(h,i,o,d){if(!o.modelManager)return!0;const g=o.modelManager;if(!o.shadowRenderer)return!0;const v=o.shadowRenderer,w=i.aabb;let C=!0,D=h.maxHeight;if(D===0){let O=0;for(const N in h.instancesPerModel){const B=g.getModel(N,d);B?O=Math.max(O,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):C=!1}D=h.maxScale*O*1.41+h.maxVerticalOffset,C&&(h.maxHeight=D)}w.max[2]=D,w.min[2]+=h.terrainElevationMin,w.max[2]+=h.terrainElevationMax,n.ab.vec3.transformMat4(w.min,w.min,i.tileMatrix),n.ab.vec3.transformMat4(w.max,w.max,i.tileMatrix);const L=w.intersects(v.getCurrentCascadeFrustum());return o.currentShadowCascade===0&&(h.isInsideFirstShadowMapFrustum=L===2),L===0}function ql(h,i){const o=h.uniformValues.u_cutoff_params[0],d=h.uniformValues.u_cutoff_params[1],g=h.uniformValues.u_cutoff_params[2],v=h.uniformValues.u_cutoff_params[3];return d===o||v===g?1:n.aw(((i-o)/(d-o)-g)/(v-g),0,1)}function jm(h,i,o,d){if(i.pitch<20)return 1;const g=i.getWorldToCameraMatrix();n.ab.mat4.multiply(g,g,h);const v=n.ab.vec4.fromValues(o.min[0],o.min[1],o.min[2],1);let w=n.ab.vec4.transformMat4(n.ab.vec4.create(),v,g),C=w,D=w;v[1]=o.max[1],w=n.ab.vec4.transformMat4(n.ab.vec4.create(),v,g),C=w[1]<C[1]?w:C,D=w[1]>D[1]?w:D,v[0]=o.max[0],w=n.ab.vec4.transformMat4(n.ab.vec4.create(),v,g),C=w[1]<C[1]?w:C,D=w[1]>D[1]?w:D,v[1]=o.min[1],w=n.ab.vec4.transformMat4(n.ab.vec4.create(),v,g),C=w[1]<C[1]?w:C,D=w[1]>D[1]?w:D;const L=n.aw(d[0],0,1),O=100*i.pixelsPerMeter*n.aw(d[1],0,1),N=n.aw(d[2],0,1),B=n.ab.vec4.lerp(n.ab.vec4.create(),C,D,L),q=Math.tan(.5*i.fovX),J=-B[2]*q;if(O===0)return B[1]<-Math.abs(J)?N:1;const X=(-Math.abs(J)-B[1])/O,ee=(ae,pe,fe)=>(1-fe)*ae+fe*pe,Q=n.aw(ee(1,N,X),N,1);return ee(1,Q,n.aw((i.pitch-20)/20,0,1))}class ll{}class $m{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(i,o,d){{const N=this._storage.get(o.id);if(N)return N.lastUsedFrameIdx=i,N.buf}const g=d.gl,v=g.getBufferParameter(g.ELEMENT_ARRAY_BUFFER,g.BUFFER_SIZE),w=new ArrayBuffer(v),C=new Int16Array(w);g.getBufferSubData(g.ELEMENT_ARRAY_BUFFER,0,new Int16Array(w));const D=new n.dq;for(let N=0;N<v/2;N+=3){const B=C[N],q=C[N+1],J=C[N+2];D.emplaceBack(B,q),D.emplaceBack(q,J),D.emplaceBack(J,B)}const L=d.bindVertexArrayOES.current,O=new ll;return O.buf=new na(d,D),O.lastUsedFrameIdx=i,this._storage.set(o.id,O),d.bindVertexArrayOES.set(L),O.buf}update(i){for(const[o,d]of this._storage)i-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(o))}destroy(){for(const[i,o]of this._storage)o.buf.destroy(),this._storage.delete(i)}}class mf{constructor(i){this.occluderSize=30,this.depthOffset=-1e-4,i.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),i.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const qm=n.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Hm{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Or{constructor(i,o){this.revealStart=11,this.revealRange=2,i.registerParameter(this,[...o,"Reveal"],"revealStart",{min:0,max:17,step:.05}),i.registerParameter(this,[...o,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Gm=n.da([{type:"Float32",name:"a_pos_2f",components:2}]);class Wm{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(i,o){const d=i.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const w=new n.dr,C=new n.aU;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(1,1),w.emplaceBack(-1,1),C.emplaceBack(0,1,2),C.emplaceBack(0,2,3),this.vignetteVx=i.context.createVertexBuffer(w,Gm.members),this.vignetteIdx=i.context.createIndexBuffer(C)}const g=n.b7.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){i.uploadCommonUniforms(i.context,d);const w={u_vignetteShape:(v={vignetteShape:[o.start,o.range,Math.pow(10,o.fadePower)],vignetteColor:[o.color.r,o.color.g,o.color.b,o.color.a*o.strength]}).vignetteShape,u_vignetteColor:v.vignetteColor};d.draw(i,i.context.gl.TRIANGLES,oi.disabled,pi.disabled,Pi.alphaBlended,gi.disabled,w,"vignette",this.vignetteVx,this.vignetteIdx,g,{})}var v}}class yh{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(i,o){const d=i.getFreeCameraOptions().position,g=d.toAltitude(),v=d.toLngLat(),w=n.ai(v.lng),C=n.ai(v.lat),D=i.pixelsPerMeter/o,L=w*n.ds,O=n.ds*Math.log(Math.tan(Math.PI/4+C/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const N=-this._offsetYPrev+O,B=-this._elevationPrev+g;this._accumulatedOffsetX+=(-this._offsetXPrev+L)*D,this._accumulatedOffsetY+=N*D,this._accumulatedElevation+=B*D,this._offsetXPrev=L,this._offsetYPrev=O,this._elevationPrev=g}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function cl(h,i){return[-(h[0]-Math.floor(h[0]/i)*i),-(h[1]-Math.floor(h[1]/i)*i),-(h[2]-Math.floor(h[2]/i)*i)]}function _f(h){const i=n.di(1323123451230),o=[];for(let d=0;d<h;++d){const g=2*i()-1,v=2*i()-1,w=2*i()-1;o.push(n.ab.vec3.fromValues(g,v,w))}return o}function oa(h,i,o,d,g){const v=n.aw((g-o)/(d-o),0,1);return(1-v)*h+v*i}class gf{constructor(i){this._movement=new yh,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Wm,this._ppmScaleFactor=i}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(i,o){const d=i.transform;this._movement.update(d,this._ppmScaleFactor);const g=d.starsProjMatrix,v=n.ab.quat.identity([]);n.ab.quat.rotateX(v,v,n.ai(90)-d._pitch),n.ab.quat.rotateZ(v,v,-d.angle);const w=n.ab.mat4.fromQuat(new Float32Array(16),v),C=n.ab.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),D=n.ab.mat4.transpose([],C),L=n.ab.mat4.multiply([],D,w),O=Date.now()/1e3;return this._accumulatedTimeFromStart+=(O-this._prevTime)*o,this._prevTime=O,{projectionMatrix:g,modelviewMatrix:L}}}class Uc extends gf{constructor(i){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Or(i.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(i){const o=i.context;if(!this.particlesVx){const d=_f(this.particlesCount),g=new n.dt,v=new n.aU;let w=0;const C=n.di(1323123451230);for(let D=0;D<d.length;++D){const L=d[D],O=[2*C()-1,C(),C(),C()];g.emplaceBack(L[0],L[1],L[2],-1,-1,...O),g.emplaceBack(L[0],L[1],L[2],1,-1,...O),g.emplaceBack(L[0],L[1],L[2],1,1,...O),g.emplaceBack(L[0],L[1],L[2],-1,1,...O),v.emplaceBack(w+0,w+1,w+2),v.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=o.createVertexBuffer(g,qm.members),this.particlesIdx=o.createIndexBuffer(v)}}draw(i){if(!this._params.overrideStyleParameters&&!i.style.rain)return;const o=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},d=i.transform.zoom;if(o.revealStart>d)return;const g=oa(0,1,o.revealStart,o.revealStart+o.revealRange,d);if(!this.particlesVx||!this.particlesIdx)return;const v=structuredClone(this._params);let w=[-v.direction.x,v.direction.y,-100];n.ab.vec3.normalize(w,w);const C=structuredClone(this._vignetteParams);C.strength*=g,v.overrideStyleParameters||(v.intensity=i.style.rain.state.density,v.timeFactor=i.style.rain.state.intensity,v.color=structuredClone(i.style.rain.state.color),w=structuredClone(i.style.rain.state.direction),v.screenThinning.intensity=i.style.rain.state.centerThinning,v.dropletSizeX=i.style.rain.state.dropletSize[0],v.dropletSizeYScale=i.style.rain.state.dropletSize[1]/i.style.rain.state.dropletSize[0],v.distortionStrength=100*i.style.rain.state.distortionStrength,C.strength=1,C.color=structuredClone(i.style.rain.state.vignetteColor));const D=this.updateOnRender(i,v.timeFactor),L=i.context,O=L.gl,N=i.transform;this.screenTexture&&this.screenTexture.size[0]===i.width&&this.screenTexture.size[1]===i.height||(this.screenTexture=new n.T(L,{width:i.width,height:i.height,data:null},O.RGBA8)),v.distortionStrength>0&&(L.activeTexture.set(O.TEXTURE0),this.screenTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),O.copyTexSubImage2D(O.TEXTURE_2D,0,0,0,0,0,i.width,i.height));const B=i.getOrCreateProgram("rainParticle");i.uploadCommonUniforms(L,B),L.activeTexture.set(O.TEXTURE0),this.screenTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const q=[v.color.r,v.color.g,v.color.b,v.color.a],J=(X,ee)=>{const Q=cl(this._movement.getPosition(),X),ae=v.dropletSizeX,pe=v.dropletSizeX*v.dropletSizeYScale,fe=i.width/2,we=i.height/2,ge=oa(0,v.screenThinning.start,0,1,v.screenThinning.intensity),ve=oa(.001,v.screenThinning.range,0,1,v.screenThinning.intensity),_e=oa(0,v.screenThinning.particleOffset,0,1,v.screenThinning.intensity),Me=(ke={modelview:D.modelviewMatrix,projection:D.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Q,velocityConeAperture:v.velocityConeAperture,velocity:v.velocity,boxSize:X,rainDropletSize:[ae,pe],distortionStrength:v.distortionStrength,rainDirection:w,color:q,screenSize:[N.width,N.height],thinningCenterPos:[fe,we],thinningShape:[ge,ve,Math.pow(10,v.screenThinning.fadePower)],thinningAffectedRatio:v.screenThinning.affectedRatio,thinningParticleOffset:_e,shapeDirectionalPower:v.shapeDirPower,shapeNormalPower:v.shapeNormalPower,mode:ee?0:1},{u_modelview:Float32Array.from(ke.modelview),u_projection:Float32Array.from(ke.projection),u_time:ke.time,u_cam_pos:ke.camPos,u_texScreen:0,u_velocityConeAperture:ke.velocityConeAperture,u_velocity:ke.velocity,u_boxSize:ke.boxSize,u_rainDropletSize:ke.rainDropletSize,u_distortionStrength:ke.distortionStrength,u_rainDirection:ke.rainDirection,u_color:ke.color,u_screenSize:ke.screenSize,u_thinningCenterPos:ke.thinningCenterPos,u_thinningShape:ke.thinningShape,u_thinningAffectedRatio:ke.thinningAffectedRatio,u_thinningParticleOffset:ke.thinningParticleOffset,u_shapeDirectionalPower:ke.shapeDirectionalPower,u_shapeNormalPower:ke.shapeNormalPower,u_mode:ke.mode});var ke;const tt=Math.round(v.intensity*this.particlesCount),We=n.b7.simpleSegment(0,0,4*tt,2*tt);B.draw(i,O.TRIANGLES,oi.disabled,pi.disabled,Pi.alphaBlended,gi.disabled,Me,"rain_particles",this.particlesVx,this.particlesIdx,We,{})};v.distortionStrength>0&&J(v.boxSize,!0),J(v.boxSize,!1),this._vignette.draw(i,C)}}const Zm=n.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Xm extends gf{constructor(i){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Or(i.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(i){const o=i.context;if(!this.particlesVx){const d=_f(this.particlesCount),g=new n.du,v=new n.aU;let w=0;const C=n.di(1323123451230);for(let D=0;D<d.length;++D){const L=d[D],O=C(),N=C(),B=C(),q=[D/d.length,O,N,B],J=[C(),C()];g.emplaceBack(L[0],L[1],L[2],-1,-1,...q,...J),g.emplaceBack(L[0],L[1],L[2],1,-1,...q,...J),g.emplaceBack(L[0],L[1],L[2],1,1,...q,...J),g.emplaceBack(L[0],L[1],L[2],-1,1,...q,...J),v.emplaceBack(w+0,w+1,w+2),v.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=o.createVertexBuffer(g,Zm.members),this.particlesIdx=o.createIndexBuffer(v)}}draw(i){if(!this._params.overrideStyleParameters&&!i.style.snow)return;const o=structuredClone(this._params);let d=[-o.direction.x,o.direction.y,-100];n.ab.vec3.normalize(d,d);const g=structuredClone(this._vignetteParams),v=o.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},w=i.transform.zoom;if(v.revealStart>w)return;const C=oa(0,1,v.revealStart,v.revealStart+v.revealRange,w);g.strength*=C,o.overrideStyleParameters||(o.intensity=i.style.snow.state.density,o.timeFactor=i.style.snow.state.intensity,o.color=structuredClone(i.style.snow.state.color),d=structuredClone(i.style.snow.state.direction),o.screenThinning.intensity=i.style.snow.state.centerThinning,o.billboardSize=2.79*i.style.snow.state.flakeSize,g.strength=1,g.color=structuredClone(i.style.snow.state.vignetteColor));const D=this.updateOnRender(i,o.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const L=i.context,O=L.gl,N=i.transform,B=i.getOrCreateProgram("snowParticle");i.uploadCommonUniforms(L,B),((q,J,X)=>{const ee=cl(this._movement.getPosition(),q),Q=N.width/2,ae=N.height/2,pe=oa(0,X.screenThinning.start,0,1,X.screenThinning.intensity),fe=oa(.001,X.screenThinning.range,0,1,X.screenThinning.intensity),we=oa(0,X.screenThinning.particleOffset,0,1,X.screenThinning.intensity),ge=(ve={modelview:D.modelviewMatrix,projection:D.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ee,velocityConeAperture:X.velocityConeAperture,velocity:X.velocity,horizontalOscillationRadius:X.horizontalOscillationRadius,horizontalOscillationRate:X.horizontalOscillationRate,boxSize:q,billboardSize:1*X.billboardSize,simpleShapeParameters:[X.shapeFadeStart,X.shapeFadePower],screenSize:[N.width,N.height],thinningCenterPos:[Q,ae],thinningShape:[pe,fe,Math.pow(10,X.screenThinning.fadePower)],thinningAffectedRatio:X.screenThinning.affectedRatio,thinningParticleOffset:we,color:[X.color.r,X.color.g,X.color.b,X.color.a],direction:d},{u_modelview:Float32Array.from(ve.modelview),u_projection:Float32Array.from(ve.projection),u_time:ve.time,u_cam_pos:ve.camPos,u_velocityConeAperture:ve.velocityConeAperture,u_velocity:ve.velocity,u_horizontalOscillationRadius:ve.horizontalOscillationRadius,u_horizontalOscillationRate:ve.horizontalOscillationRate,u_boxSize:ve.boxSize,u_billboardSize:ve.billboardSize,u_simpleShapeParameters:ve.simpleShapeParameters,u_screenSize:ve.screenSize,u_thinningCenterPos:ve.thinningCenterPos,u_thinningShape:ve.thinningShape,u_thinningAffectedRatio:ve.thinningAffectedRatio,u_thinningParticleOffset:ve.thinningParticleOffset,u_particleColor:ve.color,u_direction:ve.direction});var ve;const _e=Math.round(X.intensity*this.particlesCount),Me=n.b7.simpleSegment(0,0,4*_e,2*_e);this.particlesVx&&this.particlesIdx&&B.draw(i,O.TRIANGLES,oi.disabled,pi.disabled,Pi.alphaBlended,gi.disabled,ge,"snow_particles",this.particlesVx,this.particlesIdx,Me,{})})(o.boxSize,0,o),this._vignette.draw(i,g)}}const vh={symbol:function(h,i,o,d,g){if(h.renderPass!=="translucent")return;const v=pi.disabled,w=h.colorModeForRenderPass(),C=o.layout.get("text-variable-anchor"),D=o.layout.get("text-size-scale-range"),L=n.aw(h.scaleFactor,D[0],D[1]);C&&function(B,q,J,X,ee,Q,ae,pe){const fe=q.transform,we=ee==="map",ge=Q==="map";for(const ve of B){const _e=X.getTile(ve),Me=_e.getBucket(J);if(!Me||!Me.text||!Me.text.segments.get().length)continue;const ke=n.bp(Me.textSizeData,fe.zoom,pe),tt=Pl(ve,Me.getProjection(),fe),We=fe.calculatePixelsToTileUnitsMatrix(_e),ct=Rr(tt,_e.tileID.canonical,ge,we,fe,Me.getProjection(),We),lt=Me.hasIconTextFit()&&Me.hasIconData();if(ke){const $e=Math.pow(2,fe.zoom-_e.tileID.overscaledZ);lf(Me,we,ge,ae,n.cX,fe,ct,ve,$e,ke,lt)}}}(d,h,o,i,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),g,L);const O=o.paint.get("icon-opacity").constantOr(1)!==0,N=o.paint.get("text-opacity").constantOr(1)!==0;o.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(O||N)?fh(h,i,o,d,v,w):(O&&fh(h,i,o,d,v,w,{onlyIcons:!0}),N&&fh(h,i,o,d,v,w,{onlyText:!0})),i.map.showCollisionBoxes&&(af(h,i,o,d,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),af(h,i,o,d,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(h,i,o,d){if(h.renderPass!=="translucent")return;const g=o.paint.get("circle-opacity"),v=o.paint.get("circle-stroke-width"),w=o.paint.get("circle-stroke-opacity"),C=o.layout.get("circle-sort-key").constantOr(1)!==void 0,D=o.paint.get("circle-emissive-strength");if(g.constantOr(1)===0&&(v.constantOr(1)===0||w.constantOr(1)===0))return;const L=h.context,O=L.gl,N=h.transform,B=h.depthModeForSublayer(0,oi.ReadOnly),q=pi.disabled,J=h.colorModeForDrapableLayerRenderPass(D),X=N.projection.name==="globe",ee=[n.at(N.center.lng),n.aA(N.center.lat)],Q=[];for(let pe=0;pe<d.length;pe++){const fe=d[pe],we=i.getTile(fe),ge=we.getBucket(o);if(!ge||ge.projection.name!==N.projection.name)continue;const ve=ge.programConfigurations.get(o.id),_e=n.cY(o),Me=h.isTileAffectedByFog(fe);X&&_e.push("PROJECTION_GLOBE_VIEW"),_e.push("DEPTH_D24"),h.terrain&&N.depthOcclusionForSymbolsAndCircles&&_e.push("DEPTH_OCCLUSION");const ke=h.getOrCreateProgram("circle",{config:ve,defines:_e,overrideFog:Me}),tt=ge.layoutVertexBuffer,We=ge.globeExtVertexBuffer,ct=ge.indexBuffer,lt=N.projection.createInversionMatrix(N,fe.canonical),$e={programConfiguration:ve,program:ke,layoutVertexBuffer:tt,globeExtVertexBuffer:We,indexBuffer:ct,uniformValues:n.cZ(h,fe,we,lt,ee,o),tile:we};if(C){const it=ge.segments.get();for(const gt of it)Q.push({segments:new n.b7([gt]),sortKey:gt.sortKey,state:$e})}else Q.push({segments:ge.segments,sortKey:0,state:$e})}C&&Q.sort((pe,fe)=>pe.sortKey-fe.sortKey);const ae={useDepthForOcclusion:N.depthOcclusionForSymbolsAndCircles};for(const pe of Q){const{programConfiguration:fe,program:we,layoutVertexBuffer:ge,globeExtVertexBuffer:ve,indexBuffer:_e,uniformValues:Me,tile:ke}=pe.state,tt=pe.segments;h.terrain&&h.terrain.setupElevationDraw(ke,we,ae),h.uploadCommonUniforms(L,we,ke.tileID.toUnwrapped()),we.draw(h,O.TRIANGLES,B,q,J,gi.disabled,Me,o.id,ge,_e,tt,o.paint,N.zoom,fe,[ve])}},heatmap:function(h,i,o,d){if(o.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const g=h.context,v=g.gl,w=pi.disabled,C=new Pi([v.ONE,v.ONE,v.ONE,v.ONE],n.aj.transparent,[!0,!0,!0,!0]);(function(q,J,X,ee){const Q=q.gl,ae=J.width*ee,pe=J.height*ee;q.activeTexture.set(Q.TEXTURE1),q.viewport.set([0,0,ae,pe]);let fe=X.heatmapFbo;if(!fe||fe&&(fe.width!==ae||fe.height!==pe)){fe&&fe.destroy();const we=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,we),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),fe=X.heatmapFbo=q.createFramebuffer(ae,pe,!0,null),function(ge,ve,_e,Me,ke,tt){const We=ge.gl;We.texImage2D(We.TEXTURE_2D,0,ge.extRenderToTextureHalfFloat?We.RGBA16F:We.RGBA,ke,tt,0,We.RGBA,ge.extRenderToTextureHalfFloat?We.HALF_FLOAT:We.UNSIGNED_BYTE,null),Me.colorAttachment.set(_e)}(q,0,we,fe,ae,pe)}else Q.bindTexture(Q.TEXTURE_2D,fe.colorAttachment.get()),q.bindFramebuffer.set(fe.framebuffer)})(g,h,o,h.transform.projection.name==="globe"?.5:.25),g.clear({color:n.aj.transparent});const D=h.transform,L=D.projection.name==="globe",O=L?["PROJECTION_GLOBE_VIEW"]:[],N=L?gi.frontCCW:gi.disabled,B=[n.at(D.center.lng),n.aA(D.center.lat)];for(let q=0;q<d.length;q++){const J=d[q];if(i.hasRenderableParent(J))continue;const X=i.getTile(J),ee=X.getBucket(o);if(!ee||ee.projection.name!==D.projection.name)continue;const Q=h.isTileAffectedByFog(J),ae=ee.programConfigurations.get(o.id),pe=h.getOrCreateProgram("heatmap",{config:ae,defines:O,overrideFog:Q}),{zoom:fe}=h.transform;h.terrain&&h.terrain.setupElevationDraw(X,pe),h.uploadCommonUniforms(g,pe,J.toUnwrapped());const we=D.projection.createInversionMatrix(D,J.canonical);pe.draw(h,v.TRIANGLES,oi.disabled,w,C,N,Gt(h,J,X,we,B,fe,o.paint.get("heatmap-intensity")),o.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,o.paint,h.transform.zoom,ae,L?[ee.globeExtVertexBuffer]:null)}g.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(g,v){const w=g.context,C=w.gl,D=v.heatmapFbo;if(!D)return;w.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,D.colorAttachment.get()),w.activeTexture.set(C.TEXTURE1);let L=v.colorRampTexture;L||(L=v.colorRampTexture=new n.T(w,v.colorRamp,C.RGBA8)),L.bind(C.LINEAR,C.CLAMP_TO_EDGE),g.getOrCreateProgram("heatmapTexture").draw(g,C.TRIANGLES,oi.disabled,pi.disabled,g.colorModeForRenderPass(),gi.disabled,((O,N,B,q)=>({u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}))(0,v),v.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,v.paint,g.transform.zoom)}(h,o))},line:function(h,i,o,d){if(h.renderPass!=="translucent")return;const g=o.paint.get("line-opacity"),v=o.paint.get("line-width");if(g.constantOr(1)===0||v.constantOr(1)===0)return;const w=o.paint.get("line-emissive-strength"),C=o.paint.get("line-occlusion-opacity"),D=o.layout.get("line-elevation-reference"),L=o.layout.get("line-width-unit")==="meters",O=D==="sea",N=h.context,B=N.gl;if(o.hasElevatedBuckets&&h.transform.projection.name==="globe")return;const q=o.layout.get("line-cross-slope"),J=q!==void 0,X=q<1,ee=h.colorModeForDrapableLayerRenderPass(w),Q=h.terrain&&h.terrain.renderingToTexture,ae=Q?1:n.q.devicePixelRatio,pe=o.paint.get("line-dasharray"),fe=pe.constantOr(1),we=o.layout.get("line-cap"),ge=pe.constantOr(null),ve=we.constantOr(null),_e=o.paint.get("line-pattern"),Me=_e.constantOr(1),ke=_e.constantOr(null),tt=o.paint.get("line-opacity").constantOr(1);let We=!Me&&tt!==1||h.depthOcclusion&&C>0&&C<1;const ct=o.paint.get("line-gradient"),lt=Me?"linePattern":"line",$e=n.c_(o);let it;if(Q&&h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(We=!1),C!==0&&h.depthOcclusion){const Ue=o.paint._values["line-opacity"];Ue&&Ue.value&&Ue.value.kind==="constant"?it=Ue.value:n.w(`Occlusion opacity for layer ${o.id} is supported only when line-opacity isn't data-driven.`)}v.value.kind!=="constant"&&v.value.isLineProgressConstant===!1&&$e.push("VARIABLE_LINE_WIDTH");const gt=(Ue,ht,nt,St,pt)=>{for(const ut of Ue){const vt=i.getTile(ut);if(Me&&!vt.patternsLoaded())continue;const Et=vt.getBucket(o);if(!Et||Et.hasZOffset&&!pt||!Et.hasZOffset&&pt)continue;h.prepareDrawTile();const Nt=Et.programConfigurations.get(o.id),$t=h.isTileAffectedByFog(ut),fi=h.getOrCreateProgram(lt,{config:Nt,defines:ht,overrideFog:$t,overrideRtt:!pt&&void 0});if(ke&&vt.imageAtlas){const wi=n.A.from(ke).getPrimary().scaleSelf(ae).serialize(),Hi=vt.imageAtlas.patternPositions[wi];Hi&&Nt.setConstantPatternPositions(Hi)}if(!Me&&ge&&ve&&vt.lineAtlas){const wi=vt.lineAtlas.getDash(ge,ve);wi&&Nt.setConstantPatternPositions(wi)}let[ri,ai]=o.paint.get("line-trim-offset");(ve==="round"||ve==="square")&&ri!==ai&&(ri===0&&(ri-=1),ai===1&&(ai+=1));const xi=Q?ut.projMatrix:null,Bi=L?1/Et.tileToMeter/n.ar(vt,1,h.transform.zoom):1,on=L?1/Et.tileToMeter/n.ar(vt,1,Math.floor(h.transform.zoom)):1,Nn=Me?n.c$(h,vt,o,xi,ae,Bi,on,[ri,ai]):n.d0(h,vt,o,xi,Et.lineClipsArray.length,ae,Bi,on,[ri,ai]);if(ct){const wi=Et.gradients[o.id];let Hi=wi.texture;if(o.gradientVersion!==wi.version){let ei=256;if(o.stepInterpolant){const ki=i.getSource().maxzoom,Ji=ut.canonical.z===ki?Math.ceil(1<<h.transform.maxZoom-ut.canonical.z):1;ei=n.aw(n.d1(Et.maxLineLength/n.ag*1024*Ji),256,N.maxTextureSize)}wi.gradient=n.d2({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:ei,image:wi.gradient||void 0,clips:Et.lineClipsArray}),wi.texture?wi.texture.update(wi.gradient):wi.texture=new n.T(N,wi.gradient,B.RGBA8),wi.version=o.gradientVersion,Hi=wi.texture}N.activeTexture.set(B.TEXTURE1),Hi.bind(o.stepInterpolant?B.NEAREST:B.LINEAR,B.CLAMP_TO_EDGE)}fe&&(N.activeTexture.set(B.TEXTURE0),vt.lineAtlasTexture&&vt.lineAtlasTexture.bind(B.LINEAR,B.REPEAT),Nt.updatePaintBuffers()),Me&&(N.activeTexture.set(B.TEXTURE0),vt.imageAtlasTexture&&vt.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Nt.updatePaintBuffers()),pt&&!O&&h.terrain.setupElevationDraw(vt,fi),h.uploadCommonUniforms(N,fi,ut.toUnwrapped());const Tn=wi=>{it!=null&&(it.value=tt*C),fi.draw(h,B.TRIANGLES,nt,wi,ee,gi.disabled,Nn,o.id,Et.layoutVertexBuffer,Et.indexBuffer,Et.segments,o.paint,h.transform.zoom,Nt,[Et.layoutVertexBuffer2,Et.patternVertexBuffer,Et.zOffsetVertexBuffer]),it!=null&&(it.value=tt)};if(We&&!pt){const wi=h.stencilModeForClipping(ut).ref;wi===0&&Q&&N.clear({stencil:0});const Hi={func:B.EQUAL,mask:255};Nn.u_alpha_discard_threshold=.8,Tn(new pi(Hi,wi,255,B.KEEP,B.KEEP,B.INVERT)),Nn.u_alpha_discard_threshold=0,Tn(new pi(Hi,wi,255,B.KEEP,B.KEEP,B.KEEP))}else We&&pt&&(Nn.u_alpha_discard_threshold=.001),Tn(pt?St:h.stencilModeForClipping(ut))}};if(o.hasNonElevatedBuckets){const Ue=!Q&&h.terrain;C!==0&&Ue?n.w(`Occlusion opacity for layer ${o.id} is supported on terrain only if the layer has line-z-offset enabled.`):Ue?n.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${o.id}.`):gt(d,$e,h.depthModeForSublayer(0,oi.ReadOnly),pi.disabled,!1)}if(o.hasElevatedBuckets){$e.push("ELEVATED"),J&&$e.push(X?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),O&&$e.push("ELEVATION_REFERENCE_SEA");const Ue=We?h.stencilModeFor3D():pi.disabled,ht=new oi(h.depthOcclusion?B.GREATER:B.LEQUAL,oi.ReadOnly,h.depthRangeFor3D);h.forceTerrainMode=!0,gt(d,$e,ht,Ue,!0),h.forceTerrainMode=!1}We&&(h.resetStencilClippingMasks(),Q&&N.clear({stencil:0})),C===0||h.depthOcclusion||Q||h.layersWithOcclusionOpacity.push(h.currentLayer)},fill:function(h,i,o,d){const g=o.paint.get("fill-color"),v=o.paint.get("fill-opacity"),w=o.is3D(),C=new oi(h.context.gl.LEQUAL,oi.ReadWrite,h.depthRangeFor3D);if(v.constantOr(1)===0)return;const D=o.paint.get("fill-emissive-strength"),L=h.colorModeForDrapableLayerRenderPass(D),O=o.paint.get("fill-pattern"),N=h.opaquePassEnabledForLayer()&&!O.constantOr(1)&&g.constantOr(n.aj.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===N){const B=w?C:h.depthModeForSublayer(1,h.renderPass==="opaque"?oi.ReadWrite:oi.ReadOnly);km(h,i,o,d,B,L,!1)}if(!w&&h.renderPass==="translucent"&&o.paint.get("fill-antialias")){const B=w?C:h.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,oi.ReadOnly);km(h,i,o,d,B,L,!0)}},"fill-extrusion":function(h,i,o,d){const g=o.paint.get("fill-extrusion-opacity"),v=h.context,w=v.gl,C=h.terrain,D=C&&C.renderingToTexture;if(g===0)return;const L=h.conflationActive&&h.style.isLayerClipped(o,i.getSource()),O=h.style.order.indexOf(o.fqid);if(L&&function(N,B,q,J,X){for(const ee of J){const Q=B.getTile(ee).getBucket(q);Q&&(Q.updateReplacement(ee,N.replacementSource,X),Q.uploadCentroid(N.context))}}(h,i,o,d,O),C||L)for(const N of d){const B=i.getTile(N).getBucket(o);B&&kc(h.context,i,N,B,o,C,L)}if(h.renderPass==="shadow"&&h.shadowRenderer){const N=h.shadowRenderer;if(C&&g<.65&&o._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof n.a9)return;const B=N.getShadowPassDepthMode(),q=N.getShadowPassColorMode();ph(h,i,o,d,B,pi.disabled,q,L)}else if(h.renderPass==="translucent"){const N=!o.paint.get("fill-extrusion-pattern").constantOr(1),B=o.paint.get("fill-extrusion-color").constantOr(n.aj.white);if(!D&&B.a!==0){const q=new oi(h.context.gl.LEQUAL,oi.ReadWrite,h.depthRangeFor3D);g===1&&N?ph(h,i,o,d,q,pi.disabled,Pi.unblended,L):(ph(h,i,o,d,q,pi.disabled,Pi.disabled,L),ph(h,i,o,d,q,h.stencilModeFor3D(),h.colorModeForRenderPass(),L),h.resetStencilClippingMasks())}if(h.style.enable3dLights()&&N&&(!C&&h.transform.projection.name!=="globe"||D)){const q=o.paint.get("fill-extrusion-opacity"),J=o.paint.get("fill-extrusion-ambient-occlusion-intensity"),X=o.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ee=o.paint.get("fill-extrusion-flood-light-intensity"),Q=o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ae=o.paint.get("fill-extrusion-flood-light-color").toRenderColor(Q?null:o.lut).toArray01().slice(0,3),pe=J>0&&X>0,fe=ee>0,we=(ve,_e,Me)=>(1-Me)*ve+Me*_e,ge=ve=>{const _e=h.depthModeForSublayer(1,oi.ReadOnly,w.LEQUAL,!0),Me=o.paint.get(ve?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ke=we(.1,3,Me),tt=h._showOverdrawInspector;if(!tt){const We=new pi({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),ct=new Pi([w.ONE,w.ONE,w.ONE,w.ONE],n.aj.transparent,[!1,!1,!1,!0],w.MIN);zc(h,i,o,d,_e,We,ct,gi.disabled,ve,"sdf",q,J,X,ee,ae,ke,L,!1)}{const We=tt?pi.disabled:new pi({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),ct=tt?h.colorModeForRenderPass():new Pi([w.ONE_MINUS_DST_ALPHA,w.DST_ALPHA,w.ONE,w.ONE],n.aj.transparent,[!0,!0,!0,!0]);zc(h,i,o,d,_e,We,ct,gi.disabled,ve,"color",q,J,X,ee,ae,ke,L,!1)}};if(D){const ve=(_e,Me,ke)=>{const tt=h.depthModeForSublayer(1,oi.ReadOnly,w.LEQUAL,!1),We=o.paint.get(_e?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ct=we(.1,3,We);{const lt=new Pi([w.ONE,w.ONE,w.ONE,w.ONE],n.aj.transparent,[!1,!1,!1,!0]);zc(h,i,o,d,tt,pi.disabled,lt,gi.disabled,_e,"clear",q,J,X,ee,ae,ct,L,Me)}{const lt=new pi({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),$e=new Pi([w.ONE,w.ONE,w.ONE,w.ONE],n.aj.transparent,[!1,!1,!1,!0],w.MIN);zc(h,i,o,d,tt,lt,$e,gi.disabled,_e,"sdf",q,J,X,ee,ae,ct,L,Me)}{const lt=_e?w.ZERO:w.ONE_MINUS_DST_ALPHA,$e=new pi({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),it=new Pi([lt,w.DST_ALPHA,w.ONE_MINUS_DST_ALPHA,w.ZERO],n.aj.transparent,[!0,!0,!0,!0]);zc(h,i,o,d,tt,$e,it,gi.disabled,_e,"color",q,J,X,ee,ae,ct,L,Me)}{const lt=new Pi([w.ONE,w.ONE,w.ONE,_e?w.ZERO:w.ONE],n.aj.transparent,[!1,!1,!1,!0],_e?w.FUNC_ADD:w.MAX);zc(h,i,o,d,tt,pi.disabled,lt,gi.disabled,_e,"clear",q,J,X,ee,ae,ct,L,Me,ke)}};if(pe||fe){let _e;if(h.prepareDrawTile(),C){const Me=C.drapeBufferSize[0],ke=C.drapeBufferSize[1];_e=C.framebufferCopyTexture,_e&&(!_e||_e.size[0]===Me&&_e.size[1]===ke)||(_e&&_e.destroy(),_e=C.framebufferCopyTexture=new n.T(v,new n.r({width:Me,height:ke}),w.RGBA8)),_e.bind(w.LINEAR,w.CLAMP_TO_EDGE),w.copyTexSubImage2D(w.TEXTURE_2D,0,0,0,0,0,Me,ke)}pe&&ve(!0,!1,_e),fe&&ve(!1,!0,_e)}}else pe&&ge(!0),fe&&ge(!1),(pe||fe)&&h.resetStencilClippingMasks()}}},hillshade:function(h,i,o,d){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent"||h.style.disableElevatedTerrain)return;const g=h.context,v=h.terrain&&h.terrain.renderingToTexture,[w,C]=h.renderPass!=="translucent"||v?[{},d]:h.stencilConfigForOverlap(d);for(const D of C){const L=i.getTile(D);if(L.needsHillshadePrepare&&h.renderPass==="offscreen")nx(h,L,o);else if(h.renderPass==="translucent"){const O=h.depthModeForSublayer(0,oi.ReadOnly),N=o.paint.get("hillshade-emissive-strength"),B=h.colorModeForDrapableLayerRenderPass(N),q=v&&h.terrain?h.terrain.stencilModeForRTTOverlap(D):w[D.overscaledZ];oy(h,D,L,o,O,q,B)}}g.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,i,o,d,g,v){if(h.renderPass!=="translucent"||o.paint.get("raster-opacity")===0)return;const w=h.transform.projection.name==="globe",C=o.paint.get("raster-elevation")!==0,D=C&&w;if(h.renderElevatedRasterBackface&&!D)return;const L=h.context,O=L.gl,N=i.getSource(),B=function(ge,ve,_e,Me){const ke=ve.paint.get("raster-color"),tt=ge.type==="raster-array",We=[],ct=ve.paint.get("raster-resampling"),lt=ve.paint.get("raster-color-mix");let $e=ve.paint.get("raster-color-range");const it=[lt[0],lt[1],lt[2],0],gt=lt[3];let Ue=ct==="nearest"?Me.NEAREST:Me.LINEAR;if(tt&&(We.push("RASTER_ARRAY"),ke||We.push("RASTER_COLOR"),ct==="linear"&&We.push("RASTER_ARRAY_LINEAR"),Ue=Me.NEAREST,!$e&&ge.rasterLayers)){const ht=ge.rasterLayers.find(({id:nt})=>nt===ve.sourceLayer);ht&&ht.fields&&ht.fields.range&&($e=ht.fields.range)}if($e=$e||[0,1],ke){We.push("RASTER_COLOR"),_e.activeTexture.set(Me.TEXTURE2),ve.updateColorRamp($e);let ht=ve.colorRampTexture;ht||(ht=ve.colorRampTexture=new n.T(_e,ve.colorRamp,Me.RGBA8)),ht.bind(Me.LINEAR,Me.CLAMP_TO_EDGE)}return{mix:it,range:$e,offset:gt,defines:We,resampling:Ue}}(N,o,L,O);if(N instanceof n.aJ&&!d.length&&!w)return;const q=o.paint.get("raster-emissive-strength"),J=h.colorModeForDrapableLayerRenderPass(q),X=h.terrain&&h.terrain.renderingToTexture,ee=!h.options.moving,Q=o.paint.get("raster-resampling")==="nearest"?O.NEAREST:O.LINEAR;if(N instanceof n.aJ&&!d.length&&(N.onNorthPole||N.onSouthPole)){const ge=C?h.stencilModeFor3D():pi.disabled;return void Ye(!!N.onNorthPole,null,h,i,o,q,B,gi.disabled,ge)}if(!d.length)return;const[ae,pe]=N instanceof n.aJ||X?[{},d]:h.stencilConfigForOverlap(d),fe=pe[pe.length-1].overscaledZ;D&&B.defines.push("PROJECTION_GLOBE_VIEW"),C&&B.defines.push("RENDER_CUTOFF");const we=(ge,ve,_e)=>{for(const Me of ge){const ke=Me.toUnwrapped(),tt=i.getTile(Me);if(X&&(!tt||!tt.hasData()))continue;L.activeTexture.set(O.TEXTURE0);const We=uf(tt,N,o,B);if(!We||!We.texture)continue;const{texture:ct,mix:lt,offset:$e,tileSize:it,buffer:gt}=We;let Ue,ht;X?(Ue=oi.disabled,ht=Me.projMatrix):C?(Ue=new oi(O.LEQUAL,oi.ReadWrite,h.depthRangeFor3D),ht=w?Float32Array.from(h.transform.expandedFarZProjMatrix):h.transform.calculateProjMatrix(ke,ee)):(Ue=h.depthModeForSublayer(Me.overscaledZ-fe,o.paint.get("raster-opacity")===1?oi.ReadWrite:oi.ReadOnly,O.LESS),ht=h.transform.calculateProjMatrix(ke,ee));const nt=h.terrain&&X?h.terrain.stencilModeForRTTOverlap(Me):ae[Me.overscaledZ],St=v?0:o.paint.get("raster-fade-duration");tt.registerFadeDuration(St);const pt=i.findLoadedParent(Me,0),ut=ah(tt,pt,i,h.transform,St);let vt,Et;h.terrain&&h.terrain.prepareDrawTile(),L.activeTexture.set(O.TEXTURE0),ct.bind(Q,O.CLAMP_TO_EDGE),L.activeTexture.set(O.TEXTURE1),pt?(pt.texture&&pt.texture.bind(Q,O.CLAMP_TO_EDGE),vt=Math.pow(2,pt.tileID.overscaledZ-tt.tileID.overscaledZ),Et=[tt.tileID.canonical.x*vt%1,tt.tileID.canonical.y*vt%1]):ct.bind(Q,O.CLAMP_TO_EDGE),ct.useMipmap&&L.extTextureFilterAnisotropic&&h.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const Nt=h.transform;let $t;const fi=C?by(Nt):[0,0,0,0];let ri,ai,xi,Bi,on,Nn=0;if(D&&N instanceof n.aJ&&N.coordinates.length>3)ri=Float32Array.from(n.bb(n.cH(new n.bT(0,0,0)))),ai=Float32Array.from(Nt.globeMatrix),xi=Float32Array.from(n.cD(Nt)),Bi=[n.at(Nt.center.lng),n.aA(Nt.center.lat)],$t=N.elevatedGlobePerspectiveTransform,on=N.elevatedGlobeGridMatrix||new Float32Array(9);else if(D){const ei=n.cE(Me.canonical);Nn=n.cF(ei.getCenter().lat),ri=Float32Array.from(n.bb(n.cH(Me.canonical))),ai=Float32Array.from(Nt.globeMatrix),xi=Float32Array.from(n.cD(Nt)),Bi=[n.at(Nt.center.lng),n.aA(Nt.center.lat)],$t=[0,0],on=Float32Array.from(n.cG(Me.canonical,ei,Nn,Nt.worldSize/Nt._pixelsPerMercatorPixel))}else $t=N instanceof n.aJ?N.perspectiveTransform:[0,0],ri=new Float32Array(16),ai=new Float32Array(9),xi=new Float32Array(16),Bi=[0,0],on=new Float32Array(9);const Tn=sl(ht,ri,ai,xi,on,Et||[0,0],n.ae(h.transform.zoom),Bi,fi,vt||1,ut,o,$t,C?o.paint.get("raster-elevation"):0,2,lt,$e,B.range,it,gt,q),wi=h.isTileAffectedByFog(Me),Hi=h.getOrCreateProgram("raster",{defines:B.defines,overrideFog:wi});if(h.uploadCommonUniforms(L,Hi,ke),N instanceof n.aJ){const ei=N.elevatedGlobeVertexBuffer,ki=N.elevatedGlobeIndexBuffer;if(X||!w)N.boundsBuffer&&N.boundsSegments&&Hi.draw(h,O.TRIANGLES,Ue,pi.disabled,J,gi.disabled,Tn,o.id,N.boundsBuffer,h.quadTriangleIndexBuffer,N.boundsSegments);else if(ei&&ki){const Ji=Nt.zoom<=n.c6?N.elevatedGlobeSegments:N.getSegmentsForLongitude(Nt.center.lng);Ji&&Hi.draw(h,O.TRIANGLES,Ue,pi.disabled,J,ve,Tn,o.id,ei,ki,Ji)}}else if(D){Ue=new oi(O.LEQUAL,oi.ReadOnly,h.depthRangeFor3D);const ei=h.globeSharedBuffers;if(ei){const[ki,Ji,tn]=ei.getGridBuffers(Nn,!1);Hi.draw(h,O.TRIANGLES,Ue,_e||nt,h.colorModeForRenderPass(),ve,Tn,o.id,ki,Ji,tn)}}else{const{tileBoundsBuffer:ei,tileBoundsIndexBuffer:ki,tileBoundsSegments:Ji}=h.getTileBoundsBuffers(tt);Hi.draw(h,O.TRIANGLES,Ue,nt,J,gi.disabled,Tn,o.id,ei,ki,Ji)}}if(!(N instanceof n.aJ)&&D)for(const Me of ge){const ke=Me.canonical.y===(1<<Me.canonical.z)-1;Me.canonical.y===0&&Ye(!0,Me,h,i,o,q,B,ve,_e||pi.disabled),ke&&Ye(!1,Me,h,i,o,q,B,ve===gi.frontCW?gi.backCW:gi.frontCW,_e||pi.disabled)}};D?we(pe,h.renderElevatedRasterBackface?gi.backCW:gi.frontCW,h.stencilModeFor3D()):we(pe,gi.disabled,void 0),h.resetStencilClippingMasks()},"raster-particle":function(h,i,o,d,g,v){h.renderPass==="offscreen"&&function(w,C,D,L){if(!L.length)return;const O=w.context,N=O.gl,B=C.getSource();if(!(B instanceof mr))return;const q=Math.ceil(Math.sqrt(D.paint.get("raster-particle-count")));let J=D.particlePositionRGBAImage;if(!J||J.width!==q){const pe=function(fe){const we=fe*fe,ge=new Uint8Array(4*we),ve=function(Me){return Me|=0,Me=Math.imul(2747636419^Me,2654435769),Me=Math.imul(Me^Me>>>16,2654435769),((Me=Math.imul(Me^Me>>>16,2654435769))>>>0)/4294967296},_e=1/1.1;for(let Me=0;Me<we;Me++){const ke=_e*(ve(2*Me+0)+Qt),tt=_e*(ve(2*Me+1)+Qt),We=255*ke%1,ct=255*tt%1,lt=We,$e=tt-ct/255,it=ct;ge[4*Me+0]=255*(ke-We/255),ge[4*Me+1]=255*lt,ge[4*Me+2]=255*$e,ge[4*Me+3]=255*it}return ge}(q);J=D.particlePositionRGBAImage=new n.r({width:q,height:q},pe)}let X=D.particleFramebuffer;X?X.width!==q&&(X.destroy(),X=D.particleFramebuffer=O.createFramebuffer(q,q,!0,null)):X=D.particleFramebuffer=O.createFramebuffer(q,q,!0,null);const ee=[];for(const pe of L){const fe=C.getTile(pe);if(!(fe instanceof el))continue;const we=Ty(fe,B,D);if(!we)continue;const ge=[fe.tileSize,fe.tileSize];let ve=D.tileFramebuffer;ve||(ve=D.tileFramebuffer=O.createFramebuffer(ge[0],ge[1],!0,null));let _e=fe.rasterParticleState;_e||(_e=fe.rasterParticleState=new wy(O,pe,ge,J));const Me=_e.update(D.lastInvalidatedAt);_e.particleTextureDimension!==q&&_e.updateParticleTexture(pe,J);const ke=_e.targetColorTexture;_e.targetColorTexture=_e.backgroundColorTexture,_e.backgroundColorTexture=ke;const tt=_e.particleTexture0;_e.particleTexture0=_e.particleTexture1,_e.particleTexture1=tt,ee.push([pe,we,_e,Me])}if(ee.length===0)return;const Q=n.q.now(),ae=D.previousDrawTimestamp?.001*(Q-D.previousDrawTimestamp):.0167;if(D.previousDrawTimestamp=Q,D.hasColorMap()){O.activeTexture.set(N.TEXTURE0+2);let pe=D.colorRampTexture;pe||(pe=D.colorRampTexture=new n.T(O,D.colorRamp,N.RGBA8)),pe.bind(N.LINEAR,N.CLAMP_TO_EDGE)}O.bindFramebuffer.set(D.tileFramebuffer.framebuffer),function(pe,fe,we){const ge=pe.context,ve=ge.gl,_e=fe.tileFramebuffer;ge.activeTexture.set(ve.TEXTURE0);const Me={u_texture:0,u_opacity:1.05*(tt=fe.paint.get("raster-particle-fade-opacity-factor"))/(tt+.05)},ke=pe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var tt;for(const We of we){const[,,ct,lt]=We;_e.colorAttachment.set(ct.targetColorTexture.texture),ge.viewport.set([0,0,_e.width,_e.height]),ge.clear({color:n.aj.transparent}),lt&&(ct.backgroundColorTexture.bind(ve.NEAREST,ve.CLAMP_TO_EDGE),ke.draw(pe,ve.TRIANGLES,oi.disabled,pi.disabled,Pi.alphaBlended,gi.disabled,Me,fe.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments))}}(w,D,ee),function(pe,fe,we,ge){const ve=pe.context,_e=ve.gl,Me=we.tileFramebuffer,ke=pe.transform.projection.name==="globe",tt=we.paint.get("raster-particle-max-speed");for(const We of ge){const[ct,lt,$e]=We;ve.activeTexture.set(_e.TEXTURE0+0),lt.texture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),Me.colorAttachment.set($e.targetColorTexture.texture);const it=pe.getOrCreateProgram("rasterParticleDraw",{defines:lt.defines,overrideFog:!1});ve.activeTexture.set(_e.TEXTURE0+1);const gt=lt.scalarData?[]:[0,1,2,3].map(nt=>n.d4[nt](ct));gt.push(ct);const Ue=ct.canonical.x,ht=ct.canonical.y;for(const nt of gt){const St=fe.getTile(ke?nt.wrapped():nt);if(!St)continue;const pt=St.rasterParticleState;if(!pt)continue;const ut=nt.canonical.x+(1<<nt.canonical.z)*(nt.wrap-ct.wrap),vt=nt.canonical.y;pt.particleTexture0.bind(_e.NEAREST,_e.CLAMP_TO_EDGE);const Et=mx(1,pt.particleTexture0.size[0],[ut-Ue,vt-ht],0,lt.texture.size,2,tt,lt.textureOffset,lt.scale,lt.offset);it.draw(pe,_e.POINTS,oi.disabled,pi.disabled,Pi.alphaBlended,gi.disabled,Et,we.id,pt.particleIndexBuffer,void 0,pt.particleSegment)}}}(w,C,D,ee),O.bindFramebuffer.set(D.particleFramebuffer.framebuffer),function(pe,fe,we,ge){const ve=pe.context,_e=ve.gl,Me=fe.paint.get("raster-particle-max-speed"),ke=ge*fe.paint.get("raster-particle-speed-factor")*.15,tt=function(ct){return Math.pow(ct,6)}(.01+1*fe.paint.get("raster-particle-reset-rate-factor")),We=fe.particleFramebuffer;ve.viewport.set([0,0,We.width,We.height]);for(const ct of we){const[,lt,$e]=ct;ve.activeTexture.set(_e.TEXTURE0+0),lt.texture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),ve.activeTexture.set(_e.TEXTURE0+1);const it=$e.particleTexture0;it.bind(_e.NEAREST,_e.CLAMP_TO_EDGE);const gt=_x(1,it.size[0],0,lt.texture.size,Me,ke,tt,lt.textureOffset,lt.scale,lt.offset);We.colorAttachment.set($e.particleTexture1.texture),ve.clear({color:n.aj.transparent}),pe.getOrCreateProgram("rasterParticleUpdate",{defines:lt.defines}).draw(pe,_e.TRIANGLES,oi.disabled,pi.disabled,Pi.unblended,gi.disabled,gt,fe.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments)}}(w,D,ee,ae)}(h,i,o,d),h.renderPass==="translucent"&&(function(w,C,D,L,O){const N=w.context,B=N.gl,q=C.getSource().tileSize,J=5*(1-n.ac(n.bY,n.bY+1,w.transform.zoom))*q+D.paint.get("raster-particle-elevation"),X=!w.options.moving,ee=w.transform.projection.name==="globe";if(!L.length)return;const[Q,ae]=w.stencilConfigForOverlap(L),pe=[];ee&&pe.push("PROJECTION_GLOBE_VIEW");const fe=w.stencilModeFor3D();for(const we of ae){const ge=we.toUnwrapped(),ve=C.getTile(we);if(!ve.rasterParticleState)continue;const _e=ve.rasterParticleState,Me=100;ve.registerFadeDuration(Me);const ke=C.findLoadedParent(we,0),tt=ah(ve,ke,C,w.transform,Me);let We,ct;w.terrain&&w.terrain.prepareDrawTile(),N.activeTexture.set(B.TEXTURE0),_e.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),N.activeTexture.set(B.TEXTURE1),ke&&ke.rasterParticleState?(ke.rasterParticleState.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),We=Math.pow(2,ke.tileID.overscaledZ-ve.tileID.overscaledZ),ct=[ve.tileID.canonical.x*We%1,ve.tileID.canonical.y*We%1]):_e.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const lt=ee?Float32Array.from(w.transform.expandedFarZProjMatrix):w.transform.calculateProjMatrix(ge,X),$e=w.transform,it=Ey($e),gt=n.cE(we.canonical),Ue=n.cF(gt.getCenter().lat);let ht,nt,St,pt,ut;ee?(ht=Float32Array.from(n.bb(n.cH(we.canonical))),nt=Float32Array.from($e.globeMatrix),St=Float32Array.from(n.cD($e)),pt=[n.at($e.center.lng),n.aA($e.center.lat)],ut=Float32Array.from(n.cG(we.canonical,gt,Ue,$e.worldSize/$e._pixelsPerMercatorPixel))):(ht=new Float32Array(16),nt=new Float32Array(9),St=new Float32Array(16),pt=[0,0],ut=new Float32Array(9));const vt=Im(lt,ht,nt,St,ut,ct||[0,0],n.ae(w.transform.zoom),pt,it,We||1,tt,J),Et=w.isTileAffectedByFog(we),Nt=w.getOrCreateProgram("rasterParticle",{defines:pe,overrideFog:Et});if(w.uploadCommonUniforms(N,Nt,ge),ee){const $t=new oi(B.LEQUAL,oi.ReadOnly,w.depthRangeFor3D),fi=0,ri=w.globeSharedBuffers;if(ri){const[ai,xi,Bi]=ri.getGridBuffers(Ue,fi!==0);Nt.draw(w,B.TRIANGLES,$t,fe,Pi.alphaBlended,w.renderElevatedRasterBackface?gi.frontCCW:gi.backCCW,vt,D.id,ai,xi,Bi)}}else{const $t=w.depthModeForSublayer(0,oi.ReadOnly),fi=Q[we.overscaledZ],{tileBoundsBuffer:ri,tileBoundsIndexBuffer:ai,tileBoundsSegments:xi}=w.getTileBoundsBuffers(ve);Nt.draw(w,B.TRIANGLES,$t,fi,Pi.alphaBlended,gi.disabled,vt,D.id,ri,ai,xi)}}w.resetStencilClippingMasks()}(h,i,o,d),h.style.map.triggerRepaint())},background:function(h,i,o,d){const g=o.paint.get("background-color"),v=o.paint.get("background-color-use-theme").constantOr("default")==="none",w=o.paint.get("background-opacity"),C=o.paint.get("background-emissive-strength"),D=o.paint.get("background-pitch-alignment")==="viewport";if(w===0)return;const L=h.context,O=L.gl,N=h.transform,B=N.tileSize,q=o.paint.get("background-pattern");let J;if(q!==void 0&&(q===null||(J=h.imageManager.getPattern(q.toString(),o.scope,h.style.getLut(o.scope)),!J)))return;const X=!q&&g.a===1&&w===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==X)return;const ee=pi.disabled,Q=h.depthModeForSublayer(0,X==="opaque"?oi.ReadWrite:oi.ReadOnly),ae=h.colorModeForDrapableLayerRenderPass(C),pe=q?"backgroundPattern":"background";let fe,we=d;if(we||(fe=h.getBackgroundTiles(),we=Object.values(fe).map(ge=>ge.tileID)),q&&(L.activeTexture.set(O.TEXTURE0),h.imageManager.bind(h.context,o.scope)),D){const ge=h.getOrCreateProgram(pe,{overrideFog:!1,overrideRtt:!0}),ve=new Float32Array(n.ab.mat4.identity([])),_e=new n.aG(0,0,0,0,0),Me=q?xy(ve,C,w,h,0,o.scope,J,D,{tileID:_e,tileSize:B}):Rm(ve,C,w,g.toRenderColor(v?null:o.lut));ge.draw(h,O.TRIANGLES,Q,ee,ae,gi.disabled,Me,o.id,h.viewportBuffer,h.quadTriangleIndexBuffer,h.viewportSegments)}else for(const ge of we){const ve=h.isTileAffectedByFog(ge),_e=h.getOrCreateProgram(pe,{overrideFog:ve}),Me=ge.toUnwrapped(),ke=d?ge.projMatrix:h.transform.calculateProjMatrix(Me);h.prepareDrawTile();const tt=i?i.getTile(ge):fe?fe[ge.key]:new Qa(ge,B,N.zoom,h),We=q?xy(ke,C,w,h,0,o.scope,J,D,{tileID:ge,tileSize:B}):Rm(ke,C,w,g.toRenderColor(v?null:o.lut));h.uploadCommonUniforms(L,_e,Me);const{tileBoundsBuffer:ct,tileBoundsIndexBuffer:lt,tileBoundsSegments:$e}=h.getTileBoundsBuffers(tt);_e.draw(h,O.TRIANGLES,Q,ee,ae,gi.disabled,We,o.id,ct,lt,$e)}},sky:function(h,i,o){const d=h._atmosphere?n.ae(h.transform.zoom):1,g=o.paint.get("sky-opacity")*d;if(g===0)return;const v=h.context,w=o.paint.get("sky-type"),C=new oi(v.gl.LEQUAL,oi.ReadOnly,[0,1]),D=h.frameCounter/1e3%1;w==="atmosphere"?h.renderPass==="offscreen"?o.needsSkyboxCapture(h)&&(function(L,O,N,B){const q=L.context,J=q.gl;let X=O.skyboxFbo;if(!X){X=O.skyboxFbo=q.createFramebuffer(32,32,!0,null),O.skyboxGeometry=new Ay(q),O.skyboxTexture=q.gl.createTexture(),J.bindTexture(J.TEXTURE_CUBE_MAP,O.skyboxTexture),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAG_FILTER,J.LINEAR);for(let pe=0;pe<6;++pe)J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+pe,0,J.RGBA,32,32,0,J.RGBA,J.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(X.framebuffer),q.viewport.set([0,0,32,32]);const ee=O.getCenter(L,!0),Q=L.getOrCreateProgram("skyboxCapture"),ae=new Float64Array(16);n.ab.mat4.identity(ae),n.ab.mat4.rotateY(ae,ae,.5*-Math.PI),Mr(L,O,Q,ae,ee,0),n.ab.mat4.identity(ae),n.ab.mat4.rotateY(ae,ae,.5*Math.PI),Mr(L,O,Q,ae,ee,1),n.ab.mat4.identity(ae),n.ab.mat4.rotateX(ae,ae,.5*-Math.PI),Mr(L,O,Q,ae,ee,2),n.ab.mat4.identity(ae),n.ab.mat4.rotateX(ae,ae,.5*Math.PI),Mr(L,O,Q,ae,ee,3),n.ab.mat4.identity(ae),Mr(L,O,Q,ae,ee,4),n.ab.mat4.identity(ae),n.ab.mat4.rotateY(ae,ae,Math.PI),Mr(L,O,Q,ae,ee,5),q.viewport.set([0,0,L.width,L.height])}(h,o),o.markSkyboxValid(h)):h.renderPass==="sky"&&function(L,O,N,B,q){const J=L.context,X=J.gl,ee=L.transform,Q=L.getOrCreateProgram("skybox");J.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_CUBE_MAP,O.skyboxTexture);const ae=((pe,fe,we,ge,ve)=>({u_matrix:pe,u_sun_direction:fe,u_cubemap:0,u_opacity:ge,u_temporal_offset:ve}))(ee.skyboxMatrix,O.getCenter(L,!1),0,B,q);L.uploadCommonUniforms(J,Q),Q.draw(L,X.TRIANGLES,N,pi.disabled,L.colorModeForRenderPass(),gi.backCW,ae,"skybox",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(h,o,C,g,D):w==="gradient"&&h.renderPass==="sky"&&function(L,O,N,B,q){const J=L.context,X=J.gl,ee=L.transform,Q=L.getOrCreateProgram("skyboxGradient");O.skyboxGeometry||(O.skyboxGeometry=new Ay(J)),J.activeTexture.set(X.TEXTURE0);let ae=O.colorRampTexture;ae||(ae=O.colorRampTexture=new n.T(J,O.colorRamp,X.RGBA8)),ae.bind(X.LINEAR,X.CLAMP_TO_EDGE);const pe=((fe,we,ge,ve,_e)=>({u_matrix:fe,u_color_ramp:0,u_center_direction:we,u_radius:n.ai(ge),u_opacity:ve,u_temporal_offset:_e}))(ee.skyboxMatrix,O.getCenter(L,!1),O.paint.get("sky-gradient-radius"),B,q);L.uploadCommonUniforms(J,Q),Q.draw(L,X.TRIANGLES,N,pi.disabled,L.colorModeForRenderPass(),gi.backCW,pe,"skyboxGradient",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(h,o,C,g,D)},debug:function(h,i,o,d,g,v){for(let w=0;w<o.length;w++)if(g){const L=new n.aj(d.r*.8,d.g*.8,d.b*.8,1);al(h,i,o[w],d,-1,-1,v),al(h,i,o[w],d,-1,1,v),al(h,i,o[w],d,1,1,v),al(h,i,o[w],d,1,-1,v),al(h,i,o[w],L,0,0,v)}else al(h,i,o[w],d,0,0,v)},custom:function(h,i,o,d){const g=h.context,v=o.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&o.isDraped(i)){if(h.renderPass==="offscreen"){const w=v.prerender;if(w){if(h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){const C=h.transform.pointMerc;w.call(v,g.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),n.ae(h.transform.zoom),[C.x,C.y],h.transform.pixelsPerMeterRatio)}else w.call(v,g.gl,h.transform.customLayerMatrix());g.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){const C=v.renderToTile;if(C){const D=d[0].canonical,L=new n.aa(D.x+d[0].wrap*(1<<D.z),D.y,D.z);g.setDepthMode(oi.disabled),g.setStencilMode(pi.disabled),g.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),C.call(v,g.gl,L),g.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),g.setStencilMode(pi.disabled);const w=v.renderingMode==="3d"?new oi(h.context.gl.LEQUAL,oi.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,oi.ReadOnly);if(g.setDepthMode(w),h.transform.projection.name==="globe"){const C=h.transform.pointMerc;v.render(g.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),n.ae(h.transform.zoom),[C.x,C.y],h.transform.pixelsPerMeterRatio)}else v.render(g.gl,h.transform.customLayerMatrix());g.setDirty(),h.setBaseState(),g.bindFramebuffer.set(null)}}else n.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(h,i,o,d){if(h.renderPass==="opaque")return;const g=o.paint.get("model-opacity").constantOr(1);if(g===0)return;const v=o.paint.get("model-cast-shadows");if(h.renderPass==="shadow"&&(!v||h.terrain&&g<.65&&o._transitionablePaint._values["model-opacity"].value.expression instanceof n.a9))return;const w=h.shadowRenderer,C=o.paint.get("model-receive-shadows");w&&(w.useNormalOffset=!0,C||(w.enabled=!1));const D=()=>{w&&(w.useNormalOffset=!0,C||(w.enabled=!0))},L=i.getSource();if(h.renderPass==="light-beam"&&L.type!=="batched-model")return;if(L.type==="vector"||L.type==="geojson")return function(Q,ae,pe,fe,we){const ge=Q.transform;if(ge.projection.name!=="mercator")return void n.w(`Drawing 3D models for ${ge.projection.name} projection is not yet implemented`);const ve=ge.getFreeCameraOptions().position;if(!Q.modelManager)return;const _e=Q.modelManager;pe.modelManager=_e;const Me=Q.shadowRenderer;if(!pe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ke=pe._unevaluatedLayout._values["model-id"],tt=Object.assign({},pe.layout.get("model-id").parameters),We=Q.style.order.indexOf(pe.fqid);for(const ct of fe){const lt=ae.getTile(ct).getBucket(pe);if(!lt||lt.projection.name!==ge.projection.name)continue;const $e=lt.getModelUris();$e&&!lt.modelsRequested&&(_e.addModelsFromBucket($e,we),lt.modelsRequested=!0);const it=pf(ct,ge);tt.zoom=it;const gt=ke.possiblyEvaluate(tt);if(sa(Q,lt,ct),es.shadowUniformsInitialized=!1,es.useSingleShadowCascade=!!Me&&Me.getMaxCascadeForTile(ct.toUnwrapped())===0,Q.renderPass==="shadow"&&Me){if(Q.currentShadowCascade===1&&lt.isInsideFirstShadowMapFrustum)continue;const nt=ge.calculatePosMatrix(ct.toUnwrapped(),ge.worldSize);if(es.tileMatrix.set(nt),es.shadowTileMatrix=Float32Array.from(Me.calculateShadowPassMatrixFromMatrix(nt)),es.aabb.min.fill(0),es.aabb.max[0]=es.aabb.max[1]=n.ag,es.aabb.max[2]=0,Um(lt,es,Q,pe.scope))continue}const Ue=1<<ct.canonical.z,ht=[((ve.x-ct.wrap)*Ue-ct.canonical.x)*n.ag,(ve.y*Ue-ct.canonical.y)*n.ag,ve.z*Ue*n.ag];Q.conflationActive&&Object.keys(lt.instancesPerModel).length>0&&Q.style.isLayerClipped(pe,ae.getSource())&&lt.updateReplacement(ct,Q.replacementSource,We,we)&&(lt.uploaded=!1,lt.upload(Q.context));for(let nt in lt.instancesPerModel){const St=lt.instancesPerModel[nt];St.features.length>0&&(nt=gt.evaluate(St.features[0].feature,{}));const pt=_e.getModel(nt,we);if(pt&&pt.uploaded)for(const ut of pt.nodes)gh(Q,pe,ut,St,ht,ct,es)}}}(h,i,o,d,L.type==="vector"?o.scope:""),void D();if(!L.loaded())return;if(L.type==="batched-model")return function(Q,ae,pe,fe){pe.resetLayerRenderingStats(Q);const we=Q.context,ge=Q.transform,ve=Q.style.fog,_e=Q.shadowRenderer;if(ge.projection.name!=="mercator")return void n.w(`Drawing 3D landmark models for ${ge.projection.name} projection is not yet implemented`);const Me=Q.transform.getFreeCameraOptions().position,ke=n.ab.vec3.scale([],[Me.x,Me.y,Me.z],Q.transform.worldSize),tt=n.ab.vec3.negate([],ke),We=n.ab.mat4.identity([]),ct=n.dj(ge.center.lat,ge.zoom),lt=n.ab.mat4.fromScaling([],[1,1,1/ct]);n.ab.mat4.translate(We,We,tt);const $e=pe.paint.get("model-opacity").constantOr(1),it=new oi(we.gl.LEQUAL,oi.ReadWrite,Q.depthRangeFor3D),gt=new oi(we.gl.LEQUAL,oi.ReadOnly,Q.depthRangeFor3D),Ue=new n.cd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ht=Q.renderPass==="shadow",nt=ht&&_e?_e.getCurrentCascadeFrustum():ge.getFrustum(ge.scaleZoom(ge.worldSize)),St=pe.paint.get("model-front-cutoff"),pt=St[2]<1,ut=il(Q,pe.paint.get("model-cutoff-fade-range")),vt=pe.getLayerRenderingStats();(function(Et,Nt,$t,fi){const ri=Et.terrain?Et.terrain.exaggeration():0,ai=Et.transform.zoom;for(const xi of fi){const Bi=Nt.getTile(xi).getBucket($t);Bi&&(Et.conflationActive&&Bi.updateReplacement(xi,Et.replacementSource),Bi.evaluateScale(Et,$t),Et.terrain&&ri>0&&Bi.elevationUpdate(Et.terrain,ri,xi,$t.source),Bi.needsReEvaluation(Et,ai,$t)&&Bi.evaluate($t))}})(Q,ae,pe,fe),function(){let Et,Nt,$t;pt?(Et=fe.length-1,Nt=-1,$t=-1):(Et=0,Nt=fe.length,$t=1);const fi=new Float64Array(16),ri=n.ab.vec3.create(),ai=new n.P(0,0);for(let xi=Et;xi!==Nt;xi+=$t){const Bi=fe[xi],on=ae.getTile(Bi).getBucket(pe);if(!on||!on.uploaded)continue;let Nn=!1;_e&&(Nn=_e.getMaxCascadeForTile(Bi.toUnwrapped())===0);const Tn=ge.calculatePosMatrix(Bi.toUnwrapped(),ge.worldSize),wi=on.modelTraits;!ht&&pt&&(n.ab.mat4.invert(fi,Tn),n.ab.vec3.transformMat4(ri,ke,fi),ai.x=ri[0],ai.y=ri[1]);const Hi=[];for(const ei of on.getNodesInfo()){if(ei.hiddenByReplacement||!ei.node.meshes)continue;const ki=ei.node;let Ji=0;Q.terrain&&ki.elevation&&(Ji=ki.elevation*Q.terrain.exaggeration());const tn=(()=>{const Ui=ei.aabb;return Ue.min=[...Ui.min],Ue.max=[...Ui.max],Ue.min[2]+=Ji,Ue.max[2]+=Ji,n.ab.vec3.transformMat4(Ue.min,Ue.min,Tn),n.ab.vec3.transformMat4(Ue.max,Ue.max,Tn),Ue})(),Ln=ei.evaluatedScale;if(Ln[0]<=1&&Ln[1]<=1&&Ln[2]<=1&&tn.intersects(nt)===0)continue;if(!ht&&pt){const Ui=.16666666666666666;ei.cameraCollisionOpacity=ke[0]>tn.min[0]&&ke[0]<tn.max[0]&&ke[1]>tn.min[1]&&ke[1]<tn.max[1]&&ke[2]*ct<tn.max[2]&&ki.footprint&&n.bA(ai,ki.footprint)?Math.max(ei.cameraCollisionOpacity-Ui,0):Math.min(1,ei.cameraCollisionOpacity+Ui)}const wr=[...Tn],or=ki.anchor?ki.anchor[0]:0,ar=ki.anchor?ki.anchor[1]:0;n.ab.mat4.translate(wr,wr,[or*(Ln[0]-1),ar*(Ln[1]-1),Ji]),n.ab.vec3.exactEquals(Ln,n.dm)||n.ab.mat4.scale(wr,wr,Ln);const Gs=n.ab.mat4.multiply([],wr,ki.matrix),ts=n.ab.mat4.multiply([],ge.expandedFarZProjMatrix,Gs),On=n.ab.mat4.multiply([],ge.expandedFarZProjMatrix,wr),mn=n.ab.vec4.transformMat4([],[or,ar,Ji,1],ts)[2];ki.hidden=!1;let dn=$e;ht||(pt&&(dn*=ei.cameraCollisionOpacity,dn*=jm(wr,ge,ei.aabb,St)),dn*=ql(ut,mn)),dn!==0?Hi.push({nodeInfo:ei,depth:mn,opacity:dn,wvpForNode:ts,wvpForTile:On,nodeModelMatrix:Gs,tileModelMatrix:wr}):ki.hidden=!0}ht||Hi.sort((ei,ki)=>!pt||ei.opacity===1&&ki.opacity===1?ei.depth<ki.depth?-1:1:ei.opacity===1?-1:ki.opacity===1?1:ei.depth>ki.depth?-1:1);for(const ei of Hi){const ki=ei.nodeInfo,Ji=ki.node;let tn=n.ab.mat4.multiply([],lt,ei.tileModelMatrix);n.ab.mat4.multiply(tn,We,tn);const Ln=n.ab.mat4.invert([],tn);n.ab.mat4.transpose(Ln,Ln),n.ab.mat4.scale(Ln,Ln,Vm),tn=n.ab.mat4.multiply(tn,tn,Ji.matrix);const wr=Q.renderPass==="light-beam",or=pe.paint.get("model-color-use-theme").constantOr("default")==="none",ar=wi&n.dp.HasMapboxMeshFeatures,Gs=ar?0:ki.evaluatedRMEA[0][2];for(let ts=0;ts<Ji.meshes.length;++ts){const On=Ji.meshes[ts],mn=ts===Ji.lightMeshIndex;let dn=ei.wvpForNode;if(mn){if(!wr&&!Q.terrain&&Q.shadowRenderer){Q.currentLayer<Q.firstLightBeamLayer&&(Q.firstLightBeamLayer=Q.currentLayer);continue}dn=ei.wvpForTile}else if(wr)continue;const Ui={defines:[]},Xn=[];if(!ht&&_e&&(_e.useNormalOffset=!!On.normalBuffer),Vc(Ui.defines,Xn,On,Q,or?null:pe.lut),ar||Ui.defines.push("DIFFUSE_SHADED"),Nn&&Ui.defines.push("SHADOWS_SINGLE_CASCADE"),vt&&(ht?vt.numRenderedVerticesInShadowPass+=On.vertexArray.length:vt.numRenderedVerticesInTransparentPass+=On.vertexArray.length),ht){_h(On,ei.nodeModelMatrix,Q,pe);continue}let Tr=null;if(ve){const ca=Fa(ei.nodeModelMatrix,Q.transform);if(Tr=new Float32Array(ca),ge.projection.name!=="globe"){const ho=On.aabb.min,Ws=On.aabb.max,[Yl,ua]=ve.getOpacityForBounds(ca,ho[0],ho[1],Ws[0],Ws[1]);Ui.overrideFog=Yl>=xe||ua>=xe}}const pn=On.material;let is;pn.occlusionTexture&&pn.occlusionTexture.offsetScale&&(is=pn.occlusionTexture.offsetScale,Ui.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const uo=Q.getOrCreateProgram("model",Ui);!ht&&_e&&_e.setupShadowsFromMatrix(ei.tileModelMatrix,uo,_e.useNormalOffset),Q.uploadCommonUniforms(we,uo,null,Tr);const Rs=pn.pbrMetallicRoughness;Rs.metallicFactor=.9,Rs.roughnessFactor=.5;const bs=hh(new Float32Array(dn),new Float32Array(tn),new Float32Array(Ln),new Float32Array(Ji.matrix),Q,ei.opacity,Rs.baseColorFactor.toRenderColor(null),pn.emissiveFactor,Rs.metallicFactor,Rs.roughnessFactor,pn,Gs,pe,[0,0,0],is);!mn&&(ki.hasTranslucentParts||ei.opacity<1)&&uo.draw(Q,we.gl.TRIANGLES,it,pi.disabled,Pi.disabled,gi.backCCW,bs,pe.id,On.vertexBuffer,On.indexBuffer,On.segments,pe.paint,Q.transform.zoom,void 0,Xn),uo.draw(Q,we.gl.TRIANGLES,mn?gt:it,pi.disabled,mn||ei.opacity<1||ki.hasTranslucentParts?Pi.alphaBlended:Pi.unblended,gi.backCCW,bs,pe.id,On.vertexBuffer,On.indexBuffer,On.segments,pe.paint,Q.transform.zoom,void 0,Xn)}}}}()}(h,i,o,d),void D();if(L.type!=="model")return;const O=L.getModels(),N=[],B=h.transform.getFreeCameraOptions().position,q=n.ab.vec3.scale([],[B.x,B.y,B.z],h.transform.worldSize);n.ab.vec3.negate(q,q);const J=[],X=[];let ee=0;for(const Q of O){const ae=o.paint.get("model-rotation").constantOr(null),pe=o.paint.get("model-scale").constantOr(null),fe=o.paint.get("model-translation").constantOr(null);Q.computeModelMatrix(h,ae,pe,fe,!0,!0,!1);const we=n.ab.mat4.identity([]),ge=n.dj(Q.position.lat,h.transform.zoom),ve=n.ab.mat4.fromScaling([],[1,1,1/ge]);n.ab.mat4.translate(we,we,q),N.push({zScaleMatrix:ve,negCameraPosMatrix:we});for(const _e of Q.nodes)ff(h.transform,_e,Q.matrix,h.transform.expandedFarZProjMatrix,ee,J,X);ee++}if(J.sort((Q,ae)=>ae.depth-Q.depth),h.renderPass!=="shadow"){if(g===1)for(const Q of X)Na(Q,h,o,N[Q.modelIndex],pi.disabled,h.colorModeForRenderPass());else{for(const Q of X)Na(Q,h,o,N[Q.modelIndex],pi.disabled,Pi.disabled);for(const Q of X)Na(Q,h,o,N[Q.modelIndex],h.stencilModeFor3D(),h.colorModeForRenderPass());h.resetStencilClippingMasks()}for(const Q of J)Na(Q,h,o,N[Q.modelIndex],pi.disabled,h.colorModeForRenderPass());D()}else{for(const Q of X)_h(Q.mesh,Q.nodeModelMatrix,h,o);for(const Q of J)_h(Q.mesh,Q.nodeModelMatrix,h,o);D()}}},xh={line:function(h,i,o){if(h.hasElevatedBuckets=!1,h.hasNonElevatedBuckets=!1,h._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||h._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(i){const d=i.getVisibleCoordinates();for(const g of d){const v=i.getTile(g).getBucket(h);if(v&&(v.hasZOffset?h.hasElevatedBuckets=!0:h.hasNonElevatedBuckets=!0,h.hasElevatedBuckets&&h.hasNonElevatedBuckets))break}}}else h.hasNonElevatedBuckets=!0},model:function(h,i,o){const d=i.getSource();if(!d.loaded())return;if(d.type==="vector"||d.type==="geojson")return void(o.modelManager&&o.modelManager.upload(o,d.type==="vector"?h.scope:""));if(d.type==="batched-model"||d.type!=="model")return;const g=d.getModels();for(const v of g)v.upload(o.context)},raster:function(h,i,o){const d=i.getSource();if(!(d instanceof mr&&d.loaded()))return;const g=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!g)return;const v=h.paint.get("raster-array-band")||d.getInitialBand(g);if(v==null)return;const w=i.getIds().map(C=>i.getTileByID(C));for(const C of w)C.updateNeeded(g,v)&&d.prepareTile(C,g,v)},"raster-particle":function(h,i,o){const d=i.getSource();if(!(d instanceof mr&&d.loaded()))return;const g=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!g)return;const v=h.paint.get("raster-particle-array-band")||d.getInitialBand(g);if(v==null)return;const w=i.getIds().map(C=>i.getTileByID(C));for(const C of w)C.updateNeeded(g,v)&&d.prepareTile(C,g,v)}};class Ym{constructor(i,o,d,g,v){this.context=new zm(i,o),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=n.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const w=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const D of w)this._debugParams.enabledLayers[D]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),v.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const D of w)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],D);this.occlusionParams=new mf(v),this.setup(),this.numSublayers=oo.maxUnderzooming+oo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new n.dv,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Ll(this),this._wireframeDebugCache=new $m,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const C=new n.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new n.T(this.context,C,i.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=g}updateTerrain(i,o){const d=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Rc(this,i));const g=this._terrain;this.transform.elevation=d?g:null,g.update(i,this.transform,o),this.transform.elevation&&!g.enabled&&(this.transform.elevation=null)}_updateFog(i){const o=i.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,g]=o.getFovAdjustedRange(this.transform._fov);if(d>g)return void(this.transform.fogCullDistSq=null);const v=d+.78*(g-d);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(i){i&&!this._terrain&&(this._terrain=new Rc(this,this.style)),this._forceTerrainMode=i}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(i,o){if(this.width=i*n.q.devicePixelRatio,this.height=o*n.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._mergedLayers[d].resize()}setup(){const i=this.context,o=new n.b4;o.emplaceBack(0,0),o.emplaceBack(n.ag,0),o.emplaceBack(0,n.ag),o.emplaceBack(n.ag,n.ag),this.tileExtentBuffer=i.createVertexBuffer(o,n.b6.members),this.tileExtentSegments=n.b7.simpleSegment(0,0,4,2);const d=new n.b4;d.emplaceBack(0,0),d.emplaceBack(n.ag,0),d.emplaceBack(0,n.ag),d.emplaceBack(n.ag,n.ag),this.debugBuffer=i.createVertexBuffer(d,n.b6.members),this.debugSegments=n.b7.simpleSegment(0,0,4,5);const g=new n.b4;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(g,n.b6.members),this.viewportSegments=n.b7.simpleSegment(0,0,4,2);const v=new n.aT;v.emplaceBack(0,0,0,0),v.emplaceBack(n.ag,0,n.ag,0),v.emplaceBack(0,n.ag,0,n.ag),v.emplaceBack(n.ag,n.ag,n.ag,n.ag),this.mercatorBoundsBuffer=i.createVertexBuffer(v,n.b9.members),this.mercatorBoundsSegments=n.b7.simpleSegment(0,0,4,2);const w=new n.aU;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(w);const C=new n.b5;for(const L of[0,1,3,2,0])C.emplaceBack(L);this.debugIndexBuffer=i.createIndexBuffer(C),this.emptyTexture=new n.T(i,new n.r({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA8),this.identityMat=n.ab.mat4.create();const D=this.context.gl;this.stencilClearMode=new pi({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,i.TRIANGLES,oi.disabled,this.stencilClearMode,Pi.disabled,gi.disabled,ef(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,o,d){if(!o||this.currentStencilSource===o.id||!i.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const D of d)if(this._tileClippingMaskIDs[D.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=o.id;const g=this.context,v=g.gl;this.nextStencilID+d.length>256&&this.clearStencil(),g.setColorMode(Pi.disabled),g.setDepthMode(oi.disabled);const w=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of d){const D=o.getTile(C),L=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:O,tileBoundsIndexBuffer:N,tileBoundsSegments:B}=this.getTileBoundsBuffers(D);w.draw(this,v.TRIANGLES,oi.disabled,new pi({func:v.ALWAYS,mask:0},L,255,v.KEEP,v.KEEP,v.REPLACE),Pi.disabled,gi.disabled,ef(C.projMatrix),"$clipping",O,N,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,o=this.context.gl;return new pi({func:o.NOTEQUAL,mask:255},i,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const o=this.context.gl;return new pi({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(i){const o=this.context.gl,d=i.sort((w,C)=>C.overscaledZ-w.overscaledZ),g=d[d.length-1].overscaledZ,v=d[0].overscaledZ-g+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const w={};for(let C=0;C<v;C++)w[C+g]=new pi({func:o.GEQUAL,mask:255},C+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=v,[w,d]}return[{[g]:pi.disabled},d]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Pi([i.CONSTANT_COLOR,i.ONE,i.CONSTANT_COLOR,i.ONE],new n.aj(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Pi.unblended:Pi.alphaBlended}colorModeForDrapableLayerRenderPass(i){const o=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&this.renderPass==="translucent"?new Pi([o.ONE,o.ONE_MINUS_SRC_ALPHA,o.CONSTANT_ALPHA,o.ONE_MINUS_SRC_ALPHA],new n.aj(0,0,0,i===void 0?0:i),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(i,o,d,g=!1){if(this.depthOcclusion)return new oi(this.context.gl.GREATER,oi.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!g)return oi.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new oi(d||this.context.gl.LEQUAL,o,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const i=this.context.gl,o=Math.ceil(this.width),d=Math.ceil(this.height),g=this.context.bindFramebuffer.get(),v=i.getParameter(i.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===o&&this.depthFBO.height===d||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),o!==0&&d!==0&&(this.depthFBO=new Om(this.context,o,d,!1,"texture"),this.depthTexture=new n.T(this.context,{width:o,height:d,data:null},i.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(g),i.bindTexture(i.TEXTURE_2D,v),this.depthFBO&&(i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),i.blitFramebuffer(0,0,o,d,0,0,o,d,i.DEPTH_BUFFER_BIT,i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((i,o)=>i+o/this._fpsHistory.length,0))}render(i,o){const d=n.q.now();this._dt=d-this._timeStamp,this._timeStamp=d,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=i.map.repaint,this.style=i,this.options=o;const g=this.style._mergedLayers,v=!(!this.terrain||!this.terrain.enabled),w=()=>this.style._getOrder(v).filter($e=>{const it=g[$e];return!(it.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[it.type]});let C=w(),D=!1,L=!1;for(const $e of C){const it=g[$e];it.type==="circle"&&(D=!0),it.type==="symbol"&&(it.hasInitialOcclusionOpacityProperties?L=!0:D=!0)}let O=C.map($e=>g[$e]);const N=this.style._mergedSourceCaches;this.imageManager=i.imageManager,this.modelManager=i.modelManager,this.symbolFadeChange=i.placement.symbolFadeChange(n.q.now()),this.imageManager.beginFrame();let B=0,q=!1;for(const $e in N){const it=N[$e];it.used&&(it.prepare(this.context),it.getSource().usedInConflation&&++B)}let J=!1;for(const $e of O)$e.isHidden(this.transform.zoom)||($e.type==="clip"&&(J=!0),this.prepareLayer($e));const X={},ee={},Q={},ae={},pe={};for(const $e in N){const it=N[$e];X[$e]=it.getVisibleCoordinates(),ee[$e]=X[$e].slice().reverse(),Q[$e]=it.getVisibleCoordinates(!0).reverse(),ae[$e]=it.getShadowCasterCoordinates(),pe[$e]=it.sortCoordinatesByDistance(X[$e])}const fe=$e=>{const it=this.style.getLayerSourceCache($e);return it&&it.used?it.getSource():null};if(B||J||this._clippingActiveLastFrame){const $e=[],it=[];let gt=0;for(const Ue of O)this.isSourceForClippingOrConflation(Ue,fe(Ue))&&($e.push(Ue),it.push(gt)),gt++;if($e&&(J||$e.length>1)||this._clippingActiveLastFrame){J=!1;const Ue=[];for(let ht=0;ht<$e.length;ht++){const nt=$e[ht],St=it[ht],pt=this.style.getLayerSourceCache(nt);if(!pt||!pt.used||!pt.getSource().usedInConflation&&nt.type!=="clip")continue;let ut=n.dx,vt=n.by.None;const Et=[];let Nt=!0;if(nt.type==="clip"){ut=St;for(const $t of nt.layout.get("clip-layer-types"))vt|=$t==="model"?n.by.Model:$t==="symbol"?n.by.Symbol:n.by.FillExtrusion;for(const $t of nt.layout.get("clip-layer-scope"))Et.push($t);nt.isHidden(this.transform.zoom)?Nt=!1:J=!0}Nt&&Ue.push({layer:nt.fqid,cache:pt,order:ut,clipMask:vt,clipScope:Et})}this.replacementSource.setSources(Ue),q=!0}}this._clippingActiveLastFrame=J,q||this.replacementSource.clear(),this.conflationActive=q,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let $e=0;$e<O.length;$e++){const it=O[$e],gt=it.cutoffRange();if(this.longestCutoffRange=Math.max(gt,this.longestCutoffRange),gt>0){const Ue=fe(it);Ue&&(this.minCutoffZoom=Math.max(Ue.minzoom,this.minCutoffZoom)),it.minzoom&&(this.minCutoffZoom=Math.max(it.minzoom,this.minCutoffZoom))}it.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=$e),this._lastOcclusionLayer=$e)}const we=this.style&&this.style.fog;we?(this._fogVisible=we.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=we.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Q),this.opaquePassCutoff=0,C=w(),O=C.map($e=>g[$e]));const ge=this._shadowRenderer;if(ge){ge.updateShadowParameters(this.transform,this.style.directionalLight);for(const $e in N)for(const it of X[$e]){let gt={min:0,max:0};this.terrain&&(gt=this.terrain.getMinMaxForTile(it)||gt),ge.addShadowReceiver(it.toUnwrapped(),gt.min,gt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.dw(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new My(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ve=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),_e=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ve&&!this._snow&&(this._snow=new Xm(this)),!ve&&this._snow&&(this._snow.destroy(),delete this._snow),_e&&!this._rain&&(this._rain=new Uc(this)),!_e&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!Ss.has(this.context.gl))return;this.renderPass="offscreen";for(const $e of O){const it=i.getLayerSourceCache($e);if(!$e.hasOffscreenPass()||$e.isHidden(this.transform.zoom))continue;const gt=it?ee[it.id]:void 0;($e.type==="custom"||$e.type==="raster"||$e.type==="raster-particle"||$e.isSky()||gt&&gt.length)&&this.renderLayer(this,it,$e,gt)}this.depthRangeFor3D=[0,1-(O.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ae)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Me=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ke=(()=>{if(o.showOverdrawInspector)return n.aj.black;const $e=this.style.fog;if($e&&this.transform.projection.supportsFog){const it=this.style.getLut($e.scope);if(!Me){const gt=$e.properties.get("color-use-theme")==="none",Ue=$e.properties.get("color").toRenderColor(gt?null:it).toArray01();return new n.aj(...Ue)}if(Me){const gt=$e.properties.get("space-color-use-theme")==="none",Ue=$e.properties.get("space-color").toRenderColor(gt?null:it).toArray01();return new n.aj(...Ue)}}return n.aj.transparent})();if(this.context.clear({color:ke,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Me&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=C.length-1;this.currentLayer>=0;this.currentLayer--){const $e=O[this.currentLayer],it=i.getLayerSourceCache($e);if($e.isSky())continue;const gt=it?($e.is3D()?pe:ee)[it.id]:void 0;this._renderTileClippingMasks($e,it,gt),this.renderLayer(this,it,$e,gt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Me&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||n.ae(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){const $e=O[this.currentLayer],it=i.getLayerSourceCache($e);$e.isSky()&&this.renderLayer(this,it,$e,it?ee[it.id]:void 0)}function tt($e,it){let gt;return it&&(gt=($e.type==="symbol"?Q:$e.is3D()?pe:ee)[it.id]),gt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<C.length;){const $e=O[this.currentLayer];if($e.type==="raster"||$e.type==="raster-particle"){const it=i.getLayerSourceCache($e);this.renderLayer(this,it,$e,tt($e,it))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let We=0;ge&&(We=ge.getShadowCastingLayerCount());let ct=!1,lt=-1;for(let $e=0;$e<C.length;++$e){const it=O[$e];it.isHidden(this.transform.zoom)||it.is3D()&&(lt=$e)}for(L&&lt===-1&&(D=!0);this.currentLayer<C.length;){const $e=O[this.currentLayer],it=i.getLayerSourceCache($e);if($e.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped($e)){if($e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(D&&!ct&&this.terrain&&!this.transform.isOrthographic&&(ct=!0,this.blitDepth()),L&&lt!==-1&&this.currentLayer===lt+1&&!this.transform.isOrthographic&&this.blitDepth(),$e.is3D()||this.terrain||this._renderTileClippingMasks($e,it,it?X[it.id]:void 0),this.renderLayer(this,it,$e,tt($e,it)),!this.terrain&&ge&&We>0&&$e.hasShadowPass()&&--We==0&&(ge.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const gt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=gt;this.currentLayer++){const Ue=O[this.currentLayer];if(!Ue.hasLightBeamPass())continue;const ht=i.getLayerSourceCache(Ue);this.renderLayer(this,ht,Ue,ht?ee[ht.id]:void 0)}this.currentLayer=gt,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const gt=this.currentLayer;this.depthOcclusion=!0;for(const Ue of this.layersWithOcclusionOpacity){this.currentLayer=Ue;const ht=O[this.currentLayer],nt=i.getLayerSourceCache(ht),St=nt?ee[nt.id]:void 0;ht.is3D()||this.terrain||this._renderTileClippingMasks(ht,nt,nt?X[nt.id]:void 0),this.renderLayer(this,nt,ht,St)}this.depthOcclusion=!1,this.currentLayer=gt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let $e=null;O.forEach(it=>{const gt=i.getLayerSourceCache(it);gt&&!it.isHidden(this.transform.zoom)&&gt.getVisibleCoordinates().length&&(!$e||$e.getSource().maxzoom<gt.getSource().maxzoom)&&($e=gt)}),$e&&this.options.showTileBoundaries&&vh.debug(this,$e,$e.getVisibleCoordinates(),n.aj.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&vh.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new n.aj(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function($e){const it=$e.transform.padding;Nm($e,$e.transform.height-(it.top||0),3,Bc),Nm($e,it.bottom||0,3,gx),Bm($e,it.left||0,3,yx),Bm($e,$e.transform.width-(it.right||0),3,Sy);const gt=$e.transform.centerPoint;(function(Ue,ht,nt,St){$l(Ue,ht-1,nt-10,2,20,St),$l(Ue,ht-10,nt-1,20,2,St)})($e,gt.x,$e.transform.height-gt.y,hf)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),q||(this.conflationActive=!1)}prepareLayer(i){this.gpuTimingStart(i);const{unsupportedLayers:o}=this.transform.projection,d=!o||!o.includes(i.type);if(xh[i.type]&&(d||this.terrain&&i.type==="custom")){const g=this.style.getLayerSourceCache(i);xh[i.type](i,g,this)}this.gpuTimingEnd()}renderLayer(i,o,d,g){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||d.type==="model"||d.type==="raster"||d.type==="raster-particle"||g&&g.length)&&(this.id=d.id,this.gpuTimingStart(d),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(d.type)&&(!i.terrain||d.type!=="custom")||d.type==="clip"||vh[d.type](i,o,d,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery,d=this.context.gl;let g=this.gpuTimers[i.id];g||(g=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:d.createQuery()}),g.calls++,d.beginQuery(o.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,o=this.context.gl,d=o.createQuery();this.deferredRenderGpuTimeQueries.push(d),o.beginQuery(i.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const o={};for(const d in i){const g=i[d],v=this.context.extTimerQuery,w=v.getQueryParameter(g.query,this.context.gl.QUERY_RESULT)/1e6;v.deleteQueryEXT(g.query),o[d]=w}return o}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.gl;let d=0;for(const g of i)d+=o.getQueryParameter(g,o.QUERY_RESULT)/1e6,o.deleteQuery(g);return d}translatePosMatrix(i,o,d,g,v){if(!d[0]&&!d[1])return i;const w=v?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(w){const L=Math.sin(w),O=Math.cos(w);d=[d[0]*O-d[1]*L,d[0]*L+d[1]*O]}const C=[v?d[0]:n.ar(o,d[0],this.transform.zoom),v?d[1]:n.ar(o,d[1],this.transform.zoom),0],D=new Float32Array(16);return n.ab.mat4.translate(D,i,C),D}saveTileTexture(i){const o=i.size[0],d=this._tileTextures[o];d?d.push(i):this._tileTextures[o]=[i]}getTileTexture(i){const o=this._tileTextures[i];return o&&o.length>0?o.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(i,o,d){const g=d===void 0?this.terrain&&this.terrain.renderingToTexture:d,v=[];return this.style&&this.style.enable3dLights()&&(i==="globeRaster"||i==="terrainRaster"?(v.push("LIGHTING_3D_MODE"),v.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):g||v.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||v.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(v.push("TERRAIN"),this.linearFloatFilteringSupported()&&v.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&v.push("GLOBE"),!this._fogVisible||g||o!==void 0&&!o||v.push("FOG","FOG_DITHERING"),g&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}getOrCreateProgram(i,o){this.cache=this.cache||{};const d=o&&o.defines||[],g=o&&o.config,v=this.currentGlobalDefines(i,o&&o.overrideFog,o&&o.overrideRtt).concat(d),w=gy.cacheKey(Mc[i],i,v,g);return this.cache[w]||(this.cache[w]=new gy(this.context,i,Mc[i],g,Lm[i],v)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(i,o){if(this.style.enable3dLights()){const d=this.style.directionalLight,g=this.style.ambientLight;if(d&&g){const v=((w,C,D)=>{const L=w.properties.get("direction"),O=w.properties.get("color-use-theme")==="none",N=w.properties.get("color").toRenderColor(O?null:D.getLut(w.scope)).toArray01(),B=w.properties.get("intensity"),q=C.properties.get("color-use-theme")==="none",J=C.properties.get("color").toRenderColor(q?null:D.getLut(C.scope)).toArray01(),X=C.properties.get("intensity"),ee=[L.x,L.y,L.z],Q=n.cM(J,X),ae=n.cM(N,B);return{u_lighting_ambient_color:Q,u_lighting_directional_dir:ee,u_lighting_directional_color:ae,u_ground_radiance:dx(ee,ae,Q)}})(d,g,this.style);o.setLightsUniformValues(i,v)}}}uploadCommonUniforms(i,o,d,g,v){if(this.uploadCommonLightUniforms(i,o),this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const C=w.getOpacity(this.transform.pitch),D=((L,O,N,B,q,J,X,ee,Q,ae,pe,fe)=>{const we=L.transform,ge=O.properties.get("color-use-theme")==="none",ve=O.properties.get("color").toRenderColor(ge?null:L.style.getLut(O.scope)).toArray01();ve[3]=B;const _e=L.frameCounter/1e3%1,[Me,ke]=O.properties.get("vertical-range");return{u_fog_matrix:N?we.calculateFogTileMatrix(N):fe||L.identityMat,u_fog_range:O.getFovAdjustedRange(we._fov),u_fog_color:ve,u_fog_horizon_blend:O.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Me,ke),ke],u_fog_temporal_offset:_e,u_frustum_tl:q,u_frustum_tr:J,u_frustum_br:X,u_frustum_bl:ee,u_globe_pos:Q,u_globe_radius:ae,u_viewport:pe,u_globe_transition:n.ae(we.zoom),u_is_globe:+(we.projection.name==="globe")}})(this,w,d,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*n.q.devicePixelRatio,this.transform.height*n.q.devicePixelRatio],g);o.setFogUniformValues(i,D)}v&&o.setCutoffUniformValues(i,v.uniformValues)}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,o=i.createTexture();return i.bindTexture(i.TEXTURE_2D,o),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,o=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const g of d)o[g.key]=i[g.key]||new Qa(g,512,this.transform.tileZoom,this);return o}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(i,o){return!(!i.is3D()||i.type!=="clip"&&(i.minzoom&&i.minzoom>this.transform.zoom||(this.style._clipLayerPresent||i.sourceLayer!=="building")&&(!o||o.type!=="batched-model")))}isTileAffectedByFog(i){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let o=this._cachedTileFogOpacities[i.key];return o||(this._cachedTileFogOpacities[i.key]=o=this.style.fog.getOpacityForTile(i)),o[0]>=xe||o[1]>=xe}setupDepthForOcclusion(i,o,d){const g=this.context,v=g.gl,w=!!d;var C;d||(d={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),g.activeTexture.set(v.TEXTURE3),i&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),d.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],d.u_depth_range_unpack=[2/((C=this.depthRangeFor3D)[1]-C[0]),-1-2*C[0]/(C[1]-C[0])],d.u_occluder_half_size=.5*this.occlusionParams.occluderSize,d.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),g.activeTexture.set(v.TEXTURE0),w||o.setTerrainUniformValues(g,d)}}function yf(h,i){let o=!1,d=null;const g=()=>{d=null,o&&(h(),d=setTimeout(g,i),o=!1)};return()=>(o=!0,d||g(),d)}class Cy{constructor(i){this._hashName=i&&encodeURIComponent(i),n.aP(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=yf(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const o=Km(i);if(this._hashName){const d=this._hashName;let g=!1;const v=location.hash.slice(1).split("&").map(w=>{const C=w.split("=")[0];return C===d?(g=!0,`${C}=${o}`):w}).filter(w=>w);return g||v.push(`${d}=${o}`),`#${v.join("&")}`}return`#${o}`}_getCurrentHash(){const i=location.hash.replace("#","");if(this._hashName){let o;return i.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(o=d)}),(o&&o[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some(d=>isNaN(d))){const d=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(o[3]||0):i.getBearing();return i.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:d,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Km(h,i){const o=h.getCenter(),d=Math.round(100*h.getZoom())/100,g=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,g),w=Math.round(o.lng*v)/v,C=Math.round(o.lat*v)/v,D=h.getBearing(),L=h.getPitch();let O=i?`/${w}/${C}/${d}`:`${d}/${C}/${w}`;return(D||L)&&(O+="/"+Math.round(10*D)/10),L&&(O+=`/${Math.round(L)}`),O}const bh={linearity:.3,easing:n.dy(0,0,.3,1)},Iy=n.l({deceleration:2500,maxSpeed:1400},bh),Py=n.l({deceleration:20,maxSpeed:1400},bh),Ry=n.l({deceleration:1e3,maxSpeed:360},bh),Dy=n.l({deceleration:1e3,maxSpeed:90},bh);class Ly{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.q.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,o=n.q.now();for(;i.length>0&&o-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const o={zoom:0,bearing:0,pitch:0,pan:new n.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)o.zoom+=v.zoomDelta||0,o.bearing+=v.bearingDelta||0,o.pitch+=v.pitchDelta||0,v.panDelta&&o.pan._add(v.panDelta),v.around&&(o.around=v.around),v.pinchAround&&(o.pinchAround=v.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(o.pan.mag()){const v=Th(o.pan.mag(),d,n.l({},Iy,i||{}));g.offset=o.pan.mult(v.amount/o.pan.mag()),g.center=this._map.transform.center,wh(g,v)}if(o.zoom){const v=Th(o.zoom,d,Py);g.zoom=this._map.transform.zoom+v.amount,wh(g,v)}if(o.bearing){const v=Th(o.bearing,d,Ry);g.bearing=this._map.transform.bearing+n.aw(v.amount,-179,179),wh(g,v)}if(o.pitch){const v=Th(o.pitch,d,Dy);g.pitch=this._map.transform.pitch+v.amount,wh(g,v)}if(g.zoom||g.bearing){const v=o.pinchAround===void 0?o.around:o.pinchAround;g.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function wh(h,i){(!h.duration||h.duration<i.duration)&&(h.duration=i.duration,h.easing=i.easing)}function Th(h,i,o){const{maxSpeed:d,linearity:g,deceleration:v}=o,w=n.aw(h*g/(i/1e3),-d,d),C=Math.abs(w)/(v*g);return{easing:o.easing,duration:1e3*C,amount:w*(C/2)}}class Is extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,d,g={}){const v=rt(o.getCanvasContainer(),d),w=o.unproject(v);super(i,n.l({point:v,lngLat:w,originalEvent:d},g)),this._defaultPrevented=!1,this.target=o}}class Eh extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,d){const g=i==="touchend"?d.changedTouches:d.touches,v=Ve(o.getCanvasContainer(),g),w=v.map(D=>o.unproject(D)),C=v.reduce((D,L,O,N)=>D.add(L.div(N.length)),new n.P(0,0));super(i,{points:v,point:C,lngLats:w,lngLat:o.unproject(C),originalEvent:d}),this._defaultPrevented=!1}}class Oy extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o){super("wheel",{originalEvent:o}),this._defaultPrevented=!1}}class xx{constructor(i,o){this._map=i,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new Oy(this._map,i))}mousedown(i,o){return this._mousedownPos=o,this._firePreventable(new Is(i.type,this._map,i))}mouseup(i){this._map.fire(new Is(i.type,this._map,i))}preclick(i){const o=n.l({},i);o.type="preclick",this._map.fire(new Is(o.type,this._map,o))}click(i,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(i),this._map.fire(new Is(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new Is(i.type,this._map,i))}mouseover(i){this._map.fire(new Is(i.type,this._map,i))}mouseout(i){this._map.fire(new Is(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Eh(i.type,this._map,i))}touchmove(i){this._map.fire(new Eh(i.type,this._map,i))}touchend(i){this._map.fire(new Eh(i.type,this._map,i))}touchcancel(i){this._map.fire(new Eh(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bx{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new Is(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Is("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Is(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hn{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,o){this.isEnabled()&&i.shiftKey&&i.button===0&&(me(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(i,o){if(!this._active)return;const d=o,g=this._startPos,v=this._lastPos;if(!g||!v||v.equals(d)||!this._box&&d.dist(g)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=ne("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const w=Math.min(g.x,d.x),C=Math.max(g.x,d.x),D=Math.min(g.y,d.y),L=Math.max(g.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${D}px)`,this._box.style.width=C-w+"px",this._box.style.height=L-D+"px")})}mouseupWindow(i,o){if(!this._active)return;const d=this._startPos,g=o;if(d&&i.button===0){if(this.reset(),je(),d.x!==g.x||d.y!==g.y)return this._map.fire(new n.z("boxzoomend",{originalEvent:i})),{cameraAnimation:v=>v.fitScreenCoordinates(d,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ie(),delete this._startPos,delete this._lastPos}_fireEvent(i,o){return this._map.fire(new n.z(i,{originalEvent:o}))}}function vf(h,i){const o={};for(let d=0;d<h.length;d++)o[h[d].identifier]=i[d];return o}class wx{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,o,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),d.length===this.numTouches&&(this.centroid=function(g){const v=new n.P(0,0);for(const w of g)v._add(w);return v.div(g.length)}(o),this.touches=vf(d,o)))}touchmove(i,o,d){if(this.aborted||!this.centroid)return;const g=vf(d,o);for(const v in this.touches){const w=g[v];(!w||w.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(i,o,d){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Jm{constructor(i){this.singleTap=new wx(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,o,d){this.singleTap.touchstart(i,o,d)}touchmove(i,o,d){this.singleTap.touchmove(i,o,d)}touchend(i,o,d){const g=this.singleTap.touchend(i,o,d);if(g){const v=i.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(g)<30;if(v&&w||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Sh{constructor(){this._zoomIn=new Jm({numTouches:1,numTaps:2}),this._zoomOut=new Jm({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,o,d){this._zoomIn.touchstart(i,o,d),this._zoomOut.touchstart(i,o,d)}touchmove(i,o,d){this._zoomIn.touchmove(i,o,d),this._zoomOut.touchmove(i,o,d)}touchend(i,o,d){const g=this._zoomIn.touchend(i,o,d),v=this._zoomOut.touchend(i,o,d);return g?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(g)},{originalEvent:i})}):v?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(v)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const zy={0:1,2:2};class Ah{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,o){return!1}_move(i,o){return{}}mousedown(i,o){if(this._lastPoint)return;const d=He(i);this._correctButton(i,d)&&(this._lastPoint=o,this._eventButton=d)}mousemoveWindow(i,o){const d=this._lastPoint;if(d){if(i.preventDefault(),this._eventButton!=null&&function(g,v){const w=zy[v];return g.buttons===void 0||(g.buttons&w)!==w}(i,this._eventButton))this.reset();else if(this._moved||!(o.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(d,o)}}mouseupWindow(i){this._lastPoint&&He(i)===this._eventButton&&(this._moved&&je(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xf extends Ah{mousedown(i,o){super.mousedown(i,o),this._lastPoint&&(this._active=!0)}_correctButton(i,o){return o===0&&!i.ctrlKey}_move(i,o){return{around:o,panDelta:o.sub(i)}}}class aa extends Ah{_correctButton(i,o){return o===0&&i.ctrlKey||o===2}_move(i,o){const d=.8*(o.x-i.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(i){i.preventDefault()}}class Mh extends Ah{_correctButton(i,o){return o===0&&i.ctrlKey||o===2}_move(i,o){const d=-.5*(o.y-i.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(i){i.preventDefault()}}class Zn{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),n.aP(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.P(0,0)}touchstart(i,o,d){return this._calculateTransform(i,o,d)}touchmove(i,o,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!n.dz())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,o,d)}}touchend(i,o,d){this._calculateTransform(i,o,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,o,d){d.length>0&&(this._active=!0);const g=vf(d,o),v=new n.P(0,0),w=new n.P(0,0);let C=0;for(const L in g){const O=g[L],N=this._touches[L];N&&(v._add(O),w._add(O.sub(N)),C++,g[L]=O)}if(this._touches=g,C<this._minTouches||!w.mag())return;const D=w.div(C);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(C),panDelta:D}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ne("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class co{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,o,d){return{}}touchstart(i,o,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([o[0],o[1]]))}touchmove(i,o,d){const g=this._firstTwoTouches;if(!g)return;i.preventDefault();const[v,w]=g,C=jc(d,o,v),D=jc(d,o,w);if(!C||!D)return;const L=this._aroundCenter?null:C.add(D).div(2);return this._move([C,D],L,i)}touchend(i,o,d){if(!this._firstTwoTouches)return;const[g,v]=this._firstTwoTouches,w=jc(d,o,g),C=jc(d,o,v);w&&C||(this._active&&je(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function jc(h,i,o){for(let d=0;d<h.length;d++)if(h[d].identifier===o)return i[d]}function Ch(h,i){return Math.log(h/i)/Math.LN2}class ky extends co{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,o){const d=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Ch(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ch(this._distance,d),pinchAround:o}}}function Fy(h,i){return 180*h.angleWith(i)/Math.PI}class Ih extends co{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,o){const d=this._vector;if(this._vector=i[0].sub(i[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Fy(this._vector,d),pinchAround:o}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const o=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;const g=Fy(i,d);return Math.abs(g)<o}}function Qm(h){return Math.abs(h.y)>Math.abs(h.x)}class Tx extends co{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,Qm(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,o,d){const g=this._lastPoints;if(!g)return;const v=i[0].sub(g[0]),w=i[1].sub(g[1]);return this._map._cooperativeGestures&&!n.dz()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(v,w,d.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(v.y+w.y)/2*-.5})}gestureBeginsVertically(i,o,d){if(this._valid!==void 0)return this._valid;const g=i.mag()>=2,v=o.mag()>=2;if(!g&&!v)return;if(!g||!v)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const w=i.y>0==o.y>0;return Qm(i)&&Qm(o)&&w}}const e_={panStep:100,bearingStep:15,pitchStep:10};class t_{constructor(){const i=e_;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let o=0,d=0,g=0,v=0,w=0;switch(i.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:i.shiftKey?d=-1:(i.preventDefault(),v=-1);break;case 39:i.shiftKey?d=1:(i.preventDefault(),v=1);break;case 38:i.shiftKey?g=1:(i.preventDefault(),w=-1);break;case 40:i.shiftKey?g=-1:(i.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(d=0,g=0),{cameraAnimation:C=>{const D=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:Hl,zoom:o?Math.round(D)+o*(i.shiftKey?2:1):D,bearing:C.getBearing()+d*this._bearingStep,pitch:C.getPitch()+g*this._pitchStep,offset:[-v*this._panStep,-w*this._panStep],center:C.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Hl(h){return h*(2-h)}const Gl=4.000244140625,Ba=1/450;class Io{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._handler=o,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Ba,n.aP(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||n.dz()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const d=n.q.now(),g=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,o!==0&&o%Gl==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=o,this._timeout=window.setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(g*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),i.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=i,this._delta-=o,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=rt(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>Gl?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&O!==0&&(O=1/O);const N=o(),B=Math.pow(2,N),q=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(q*O))),this._type==="wheel"&&(this._startZoom=N,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:o(),g=this._startZoom,v=this._easing;let w,C=!1;if(this._type==="wheel"&&g&&v){const L=Math.min((n.q.now()-this._lastWheelEventTime)/200,1),O=v(L);w=n.af(g,d,O),L<1?this._frameId||(this._frameId=!0):C=!0}else w=d,C=!0;this._active=!0,C&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let D=w-o();return D*this._lastDelta<0&&(D=0),{noInertia:!0,needsRenderFrame:!C,zoomDelta:D,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let o=n.dA;if(this._prevEase){const d=this._prevEase,g=(n.q.now()-d.start)/d.duration,v=d.easing(g+.01)-d.easing(g),w=.27/Math.sqrt(v*v+1e-4)*.01,C=Math.sqrt(.0729-w*w);o=n.dy(w,C,.25,1)}return this._prevEase={start:n.q.now(),duration:i,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ne("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class ul{constructor(i,o){this._clickZoom=i,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Wl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,o){return i.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(i.shiftKey?-1:1),around:d.unproject(o)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hl{constructor(){this._tap=new Jm({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,o,d){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=o[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(i,o,d))}touchmove(i,o,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const g=o[0],v=g.y-this._swipePoint.y;return this._swipePoint=g,i.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(i,o,d)}touchend(i,o,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(i,o,d)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ex{constructor(i,o,d){this._el=i,this._mousePan=o,this._touchPan=d}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Sx{constructor(i,o,d){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=o,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ax{constructor(i,o,d,g){this._el=i,this._touchZoom=o,this._touchRotate=d,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const bf=h=>h.zoom||h.drag||h.pitch||h.rotate;class Ny extends n.z{}class ps{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,o){const d=n.ab.vec3.sub([],o,i);this.radius=n.ab.vec3.length(d[2]<0?n.ab.vec3.div([],d,this.constants):[d[0],d[1],0])}projectRay(i){n.ab.vec3.div(i,i,this.constants),n.ab.vec3.normalize(i,i),n.ab.vec3.mul(i,i,this.constants);const o=n.ab.vec3.scale([],i,this.radius);if(o[2]>0){const d=n.ab.vec3.scale([],[0,0,1],n.ab.vec3.dot(o,[0,0,1])),g=n.ab.vec3.scale([],n.ab.vec3.normalize([],[o[0],o[1],0]),this.radius),v=n.ab.vec3.add([],o,n.ab.vec3.scale([],n.ab.vec3.sub([],n.ab.vec3.add([],g,d),o),2));o[0]=v[0],o[1]=v[1]}return o}}function $c(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class By{constructor(i,o){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ly(i),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ps,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),n.aP(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,v,w]of this._listeners){const C=g===document?this.handleWindowEvent:this.handleEvent;g.addEventListener(v,C,w)}}destroy(){for(const[i,o,d]of this._listeners){const g=i===document?this.handleWindowEvent:this.handleEvent;i.removeEventListener(o,g,d)}}_addDefaultHandlers(i){const o=this._map,d=o.getCanvasContainer();this._add("mapEvent",new xx(o,i));const g=o.boxZoom=new Hn(o,i);this._add("boxZoom",g);const v=new Sh,w=new Wl;o.doubleClickZoom=new ul(w,v),this._add("tapZoom",v),this._add("clickZoom",w);const C=new hl;this._add("tapDragZoom",C);const D=o.touchPitch=new Tx(o);this._add("touchPitch",D);const L=new aa(i),O=new Mh(i);o.dragRotate=new Sx(i,L,O),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);const N=new xf(i),B=new Zn(o,i);o.dragPan=new Ex(d,N,B),this._add("mousePan",N),this._add("touchPan",B,["touchZoom","touchRotate"]);const q=new Ih,J=new ky;o.touchZoomRotate=new Ax(d,J,q,C),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),this._add("blockableMapEvent",new bx(o));const X=o.scrollZoom=new Io(o,this);this._add("scrollZoom",X,["mousePan"]);const ee=o.keyboard=new t_;this._add("keyboard",ee);for(const Q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[Q]&&o[Q].enable(i[Q])}_add(i,o,d){this._handlers.push({handlerName:i,handler:o,allowed:d}),this._handlersById[i]=o}stop(i){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!bf(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,o,d){for(const g in i)if(g!==d&&(!o||o.indexOf(g)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const o=[];for(const d of i)this._el.contains(d.target)&&o.push(d);return o}handleEvent(i,o){this._updatingCamera=!0;const d=i.type==="renderFrame",g=d?void 0:i,v={needsRenderFrame:!1},w={},C={},D=i.touches?this._getMapTouches(i.touches):void 0,L=D?Ve(this._el,D):d?void 0:rt(this._el,i);for(const{handlerName:B,handler:q,allowed:J}of this._handlers){if(!q.isEnabled())continue;let X;this._blockedByActive(C,J,B)?q.reset():q[o||i.type]&&(X=q[o||i.type](i,L,D),this.mergeHandlerResult(v,w,X,B,g),X&&X.needsRenderFrame&&this._triggerRenderFrame()),(X||q.isActive())&&(C[B]=q)}const O={};for(const B in this._previousActiveHandlers)C[B]||(O[B]=g);this._previousActiveHandlers=C,(Object.keys(O).length||$c(v))&&(this._changes.push([v,w,O]),this._triggerRenderFrame()),(Object.keys(C).length||$c(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=v;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(i,o,d,g,v){if(!d)return;n.l(i,d);const w={handlerName:g,originalEvent:d.originalEvent||v};d.zoomDelta!==void 0&&(o.zoom=w),d.panDelta!==void 0&&(o.drag=w),d.pitchDelta!==void 0&&(o.pitch=w),d.bearingDelta!==void 0&&(o.rotate=w)}_applyChanges(){const i={},o={},d={};for(const[g,v,w]of this._changes)g.panDelta&&(i.panDelta=(i.panDelta||new n.P(0,0))._add(g.panDelta)),g.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(i.around=g.around),g.aroundCoord!==void 0&&(i.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(i.pinchAround=g.pinchAround),g.noInertia&&(i.noInertia=g.noInertia),n.l(o,v),n.l(d,w);this._updateMapTransform(i,o,d),this._changes=[]}_updateMapTransform(i,o,d){const g=this._map,v=g.transform,w=ae=>[ae.x,ae.y,ae.z];if((ae=>{const pe=this._eventsInProgress.drag;return pe&&!this._handlersById[pe.handlerName].isActive()})()&&!$c(i)){const ae=v.zoom;v.cameraElevationReference="sea",this._originalZoom!=null&&v._orthographicProjectionAtLowPitch&&v.projection.name!=="globe"&&v.pitch===0?(v.cameraElevationReference="ground",v.zoom=this._originalZoom):(v.recenterOnTerrain(),v.cameraElevationReference="ground"),ae!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&g._stop(!0),!$c(i))return void this._fireEvents(o,d,!0);let{panDelta:C,zoomDelta:D,bearingDelta:L,pitchDelta:O,around:N,aroundCoord:B,pinchAround:q}=i;v._isCameraConstrained&&(D>0&&(D=0),v._isCameraConstrained=!1),q!==void 0&&(N=q),(D||(ae=>o[ae]&&!this._eventsInProgress[ae])("drag"))&&N&&(this._dragOrigin=w(v.pointCoordinate3D(N)),this._originalZoom=v.zoom,this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",g._stop(!0),N=N||g.transform.centerPoint,L&&(v.bearing+=L),O&&(v.pitch+=O),v._updateCameraState();const J=[0,0,0];if(C)if(v.projection.name==="mercator"){const ae=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(N).dir),pe=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(N.sub(C)).dir);J[0]=pe[0]-ae[0],J[1]=pe[1]-ae[1]}else{const ae=v.pointCoordinate(N);if(v.projection.name==="globe"){C=C.rotate(-v.angle);const pe=v._pixelsPerMercatorPixel/v.worldSize;J[0]=-C.x*n.dB(n.aS(ae.y))*pe,J[1]=-C.y*n.dB(v.center.lat)*pe}else{const pe=v.pointCoordinate(N.sub(C));ae&&pe&&(J[0]=pe.x-ae.x,J[1]=pe.y-ae.y)}}const X=v.zoom,ee=[0,0,0];if(D){const ae=w(B||v.pointCoordinate3D(N)),pe={dir:n.ab.vec3.normalize([],n.ab.vec3.sub([],ae,v._camera.position))};if(pe.dir[2]<0){const fe=v.zoomDeltaToMovement(ae,D);n.ab.vec3.scale(ee,pe.dir,fe)}}const Q=n.ab.vec3.add(J,J,ee);v._translateCameraConstrained(Q),D&&Math.abs(v.zoom-X)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(o,d,!0)}_fireEvents(i,o,d){const g=bf(this._eventsInProgress),v=bf(i),w={};for(const O in i){const{originalEvent:N}=i[O];this._eventsInProgress[O]||(w[`${O}start`]=N),this._eventsInProgress[O]=i[O]}!g&&v&&this._fireEvent("movestart",v.originalEvent);for(const O in w)this._fireEvent(O,w[O]);v&&this._fireEvent("move",v.originalEvent);for(const O in i){const{originalEvent:N}=i[O];this._fireEvent(O,N)}const C={};let D;for(const O in this._eventsInProgress){const{handlerName:N,originalEvent:B}=this._eventsInProgress[O];this._handlersById[N].isActive()||(delete this._eventsInProgress[O],D=o[N]||B,C[`${O}end`]=D)}for(const O in C)this._fireEvent(O,C[O]);const L=bf(this._eventsInProgress);if(d&&(g||v)&&!L){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;O?(N(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:D})):(this._map.fire(new n.z("moveend",{originalEvent:D})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,o){this._map.fire(new n.z(i,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new Ny("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Vy="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class qc extends n.E{constructor(i,o){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,n.aP(["_renderFrameCallback"],this)}getCenter(){return new n.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(i,o){return this.jumpTo({center:i},o)}panBy(i,o,d){return i=n.P.convert(i).mult(-1),this.panTo(this.transform.center,n.l({offset:i},o),d)}panTo(i,o,d){return this.easeTo(n.l({center:i},o),d)}getZoom(){return this.transform.zoom}setZoom(i,o){return this.jumpTo({zoom:i},o),this}zoomTo(i,o,d){return this.easeTo(n.l({zoom:i},o),d)}zoomIn(i,o){return this.zoomTo(this.getZoom()+1,i,o),this}zoomOut(i,o){return this.zoomTo(this.getZoom()-1,i,o),this}getBearing(){return this.transform.bearing}setBearing(i,o){return this.jumpTo({bearing:i},o),this}getPadding(){return this.transform.padding}setPadding(i,o){return this.jumpTo({padding:i},o),this}rotateTo(i,o,d){return this.easeTo(n.l({bearing:i},o),d)}resetNorth(i,o){return this.rotateTo(0,n.l({duration:1e3},i),o),this}resetNorthPitch(i,o){return this.easeTo(n.l({bearing:0,pitch:0,duration:1e3},i),o),this}snapToNorth(i,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,o):this}getPitch(){return this.transform.pitch}setPitch(i,o){return this.jumpTo({pitch:i},o),this}cameraForBounds(i,o){i=n.az.convert(i);const d=o&&o.bearing||0,g=o&&o.pitch||0,v=i.getNorthWest(),w=i.getSouthEast();return this._cameraForBounds(this.transform,v,w,d,g,o)}_extendPadding(i){const o={top:0,right:0,bottom:0,left:0};return i==null?n.l({},o,this.transform.padding):typeof i=="number"?{top:i,bottom:i,right:i,left:i}:n.l({},o,i)}_extendCameraOptions(i){return(i=n.l({offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=this._extendPadding(i.padding),i}_minimumAABBFrustumDistance(i,o){const d=o.max[0]-o.min[0],g=o.max[1]-o.min[1];return d/g>i.aspect?d/(2*Math.tan(.5*i.fovX)*i.aspect):g/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,o,d,g,v,w){const C=i.clone(),D=this._extendCameraOptions(w);C.bearing=g,C.pitch=v;const L=n.bO.convert(o),O=n.bO.convert(d),N=.5*(L.lat+O.lat),B=.5*(L.lng+O.lng),q=n.dC(N,B),J=n.ab.vec3.normalize([],q),X=n.ab.vec3.normalize([],n.ab.vec3.cross([],J,[0,1,0])),ee=n.ab.vec3.cross([],X,J),Q=[X[0],X[1],X[2],0,ee[0],ee[1],ee[2],0,J[0],J[1],J[2],0,0,0,0,1],ae=[q,n.dC(L.lat,L.lng),n.dC(O.lat,L.lng),n.dC(O.lat,O.lng),n.dC(L.lat,O.lng),n.dC(N,L.lng),n.dC(N,O.lng),n.dC(L.lat,B),n.dC(O.lat,B)];let pe=n.cd.fromPoints(ae.map(nt=>[n.ab.vec3.dot(X,nt),n.ab.vec3.dot(ee,nt),n.ab.vec3.dot(J,nt)]));const fe=n.ab.vec3.transformMat4([],pe.center,Q);n.ab.vec3.squaredLength(fe)===0&&n.ab.vec3.set(fe,0,0,1),n.ab.vec3.normalize(fe,fe),n.ab.vec3.scale(fe,fe,n.ax),C.center=n.dD(fe);const we=C.getWorldToCameraMatrix(),ge=n.ab.mat4.invert(new Float64Array(16),we);pe=n.cd.applyTransform(pe,n.ab.mat4.multiply([],we,Q));const ve=this._extendAABB(pe,C,D,g);if(!ve)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");pe=ve,n.ab.vec3.transformMat4(fe,fe,we);const _e=.5*(pe.max[2]-pe.min[2]),Me=this._minimumAABBFrustumDistance(C,pe),ke=n.ab.vec3.scale([],[0,0,1],_e),tt=n.ab.vec3.add(ke,fe,ke),We=Me+(C.pitch===0?0:n.ab.vec3.distance(fe,tt)),ct=C.globeCenterInViewSpace,lt=n.ab.vec3.sub([],fe,[ct[0],ct[1],ct[2]]);n.ab.vec3.normalize(lt,lt),n.ab.vec3.scale(lt,lt,We);const $e=n.ab.vec3.add([],fe,lt);n.ab.vec3.transformMat4($e,$e,ge);const it=n.ds/n.ax,gt=n.ab.vec3.length($e),Ue=n.bH(Math.max(gt*it-n.ds,Number.EPSILON),0),ht=Math.min(C.zoomFromMercatorZAdjusted(Ue),D.maxZoom);return ht>.5*(n.c6+n.bY)?(C.setProjection({name:"mercator"}),C.zoom=ht,this._cameraForBounds(C,o,d,g,v,w)):{center:C.center,zoom:ht,bearing:g,pitch:v}}_extendAABB(i,o,d,g){const v=.5*((d.padding.left||0)+(d.padding.right||0)),w=.5*((d.padding.top||0)+(d.padding.bottom||0)),C=w,D=v,L=v,O=w,N=o.width-(D+L),B=o.height-(C+O),q=n.ab.vec3.sub([],i.max,i.min),J=Math.min(N/q[0],B/q[1]),X=Math.min(o.scaleZoom(o.scale*J),d.maxZoom);if(isNaN(X))return null;const ee=o.scale/o.zoomScale(X),Q=new n.cd([i.min[0]-D*ee,i.min[1]-O*ee,i.min[2]],[i.max[0]+L*ee,i.max[1]+C*ee,i.max[2]]),ae=(typeof d.offset.x=="number"&&typeof d.offset.y=="number"?new n.P(d.offset.x,d.offset.y):n.P.convert(d.offset)).rotate(-n.ai(g));return Q.center[0]-=ae.x*ee,Q.center[1]+=ae.y*ee,Q}queryTerrainElevation(i,o){const d=this.transform.elevation;return d?(o=n.l({},{exaggerated:!0},o),d.getAtPoint(n.aa.fromLngLat(i),null,o.exaggerated)):null}_cameraForBounds(i,o,d,g,v,w){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,o,d,g,v,w);const C=i.clone(),D=this._extendCameraOptions(w);C.bearing=g,C.pitch=v;const L=n.bO.convert(o),O=n.bO.convert(d),N=new n.bO(L.lng,O.lat),B=new n.bO(O.lng,L.lat),q=C.project(L),J=C.project(O),X=this.queryTerrainElevation(L),ee=this.queryTerrainElevation(O),Q=this.queryTerrainElevation(N),ae=this.queryTerrainElevation(B),pe=[[q.x,q.y,Math.min(X||0,ee||0,Q||0,ae||0)],[J.x,J.y,Math.max(X||0,ee||0,Q||0,ae||0)]];let fe=n.cd.fromPoints(pe);const we=C.getWorldToCameraMatrix(),ge=n.ab.mat4.invert(new Float64Array(16),we);fe=n.cd.applyTransform(fe,we);const ve=this._extendAABB(fe,C,D,g);if(!ve)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");fe=ve;const _e=.5*n.ab.vec3.sub([],fe.max,fe.min)[2],Me=this._minimumAABBFrustumDistance(C,fe),ke=[0,0,1,0];n.ab.vec4.transformMat4(ke,ke,we),n.ab.vec4.normalize(ke,ke);const tt=n.ab.vec3.scale([],ke,Me+_e),We=n.ab.vec3.add([],fe.center,tt);n.ab.vec3.transformMat4(fe.center,fe.center,ge),n.ab.vec3.transformMat4(We,We,ge);const ct=C.unproject(new n.P(fe.center[0],fe.center[1])),lt=n.dE(C.projection,ct),$e=Math.pow(2,lt),it=Math.min(C._zoomFromMercatorZ(We[2]*C.pixelsPerMeter*$e/C.worldSize),D.maxZoom);return C.mercatorFromTransition&&it<.5*(n.c6+n.bY)?(C.setProjection({name:"globe"}),C.zoom=it,this._cameraForBounds(C,o,d,g,v,w)):{center:ct,zoom:it,bearing:g,pitch:v}}fitBounds(i,o,d){const g=this.cameraForBounds(i,o);return this._fitInternal(g,o,d)}fitScreenCoordinates(i,o,d,g,v){const w=n.P.convert(i),C=n.P.convert(o),D=new n.P(Math.min(w.x,C.x),Math.min(w.y,C.y)),L=new n.P(Math.max(w.x,C.x),Math.max(w.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(w,C))return this;const O=this.transform.pointLocation3D(D),N=this.transform.pointLocation3D(L),B=this.transform.pointLocation3D(new n.P(D.x,L.y)),q=this.transform.pointLocation3D(new n.P(L.x,D.y)),J=[Math.min(O.lng,N.lng,B.lng,q.lng),Math.min(O.lat,N.lat,B.lat,q.lat)],X=[Math.max(O.lng,N.lng,B.lng,q.lng),Math.max(O.lat,N.lat,B.lat,q.lat)],ee=g&&g.pitch?g.pitch:this.getPitch(),Q=this._cameraForBounds(this.transform,J,X,d,ee,g);return this._fitInternal(Q,g,v)}_fitInternal(i,o,d){return i?(o=n.l(i,o)).linear?this.easeTo(o,d):this.flyTo(o,d):this}jumpTo(i,o){this.stop();const d=i.preloadOnly?this.transform.clone():this.transform;let g=!1,v=!1,w=!1;"zoom"in i&&d.zoom!==+i.zoom&&(g=!0,d.zoom=+i.zoom),i.center!==void 0&&(d.center=n.bO.convert(i.center)),"bearing"in i&&d.bearing!==+i.bearing&&(v=!0,d.bearing=+i.bearing),"pitch"in i&&d.pitch!==+i.pitch&&(w=!0,d.pitch=+i.pitch);const C=typeof i.padding=="number"?this._extendPadding(i.padding):i.padding;if(i.padding!=null&&!d.isPaddingEqual(C))if(i.retainPadding===!1){const D=d.clone();D.padding=C,d.setLocationAtPoint(d.center,D.centerPoint)}else d.padding=C;return i.preloadOnly?(this._preloadTiles(d),this):(this.fire(new n.z("movestart",o)).fire(new n.z("move",o)),g&&this.fire(new n.z("zoomstart",o)).fire(new n.z("zoom",o)).fire(new n.z("zoomend",o)),v&&this.fire(new n.z("rotatestart",o)).fire(new n.z("rotate",o)).fire(new n.z("rotateend",o)),w&&this.fire(new n.z("pitchstart",o)).fire(new n.z("pitch",o)).fire(new n.z("pitchend",o)),this.fire(new n.z("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.w(Vy),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,o){const d=this.transform;if(!d.projection.supportsFreeCamera)return n.w(Vy),this;this.stop();const g=d.zoom,v=d.pitch,w=d.bearing;d.setFreeCameraOptions(i);const C=g!==d.zoom,D=v!==d.pitch,L=w!==d.bearing;return this.fire(new n.z("movestart",o)).fire(new n.z("move",o)),C&&this.fire(new n.z("zoomstart",o)).fire(new n.z("zoom",o)).fire(new n.z("zoomend",o)),L&&this.fire(new n.z("rotatestart",o)).fire(new n.z("rotate",o)).fire(new n.z("rotateend",o)),D&&this.fire(new n.z("pitchstart",o)).fire(new n.z("pitch",o)).fire(new n.z("pitchend",o)),this.fire(new n.z("moveend",o)),this}easeTo(i,o){this._stop(!1,i.easeId),((i=n.l({offset:[0,0],duration:500,easing:n.dA},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);const d=this.transform,g=this.getZoom(),v=this.getBearing(),w=this.getPitch(),C=this.getPadding(),D="zoom"in i?+i.zoom:g,L="bearing"in i?this._normalizeBearing(i.bearing,v):v,O="pitch"in i?+i.pitch:w,N=this._extendPadding(i.padding),B=n.P.convert(i.offset);let q,J,X;if(d.projection.name==="globe"){const ke=n.aa.fromLngLat(d.center),tt=B.rotate(-d.angle);ke.x+=tt.x/d.worldSize,ke.y+=tt.y/d.worldSize;const We=ke.toLngLat(),ct=n.bO.convert(i.center||We);this._normalizeCenter(ct),q=d.centerPoint.add(tt),J=new n.P(ke.x,ke.y).mult(d.worldSize),X=new n.P(n.at(ct.lng),n.aA(ct.lat)).mult(d.worldSize).sub(J)}else{q=d.centerPoint.add(B);const ke=d.pointLocation(q),tt=n.bO.convert(i.center||ke);this._normalizeCenter(tt),J=d.project(ke),X=d.project(tt).sub(J)}const ee=d.zoomScale(D-g);let Q,ae;i.around&&(Q=n.bO.convert(i.around),ae=d.locationPoint(Q));const pe=this._zooming||D!==g,fe=this._rotating||v!==L,we=this._pitching||O!==w,ge=!d.isPaddingEqual(N),ve=i.retainPadding===!1?d.clone():d,_e=ke=>tt=>{if(pe&&(ke.zoom=n.af(g,D,tt)),fe&&(ke.bearing=n.af(v,L,tt)),we&&(ke.pitch=n.af(w,O,tt)),ge&&(ve.interpolatePadding(C,N,tt),q=ve.centerPoint.add(B)),Q)ke.setLocationAtPoint(Q,ae);else{const We=ke.zoomScale(ke.zoom-g),ct=D>g?Math.min(2,ee):Math.max(.5,ee),lt=Math.pow(ct,1-tt),$e=ke.unproject(J.add(X.mult(tt*lt)).mult(We));ke.setLocationAtPoint(ke.renderWorldCopies?$e.wrap():$e,q)}return i.preloadOnly||this._fireMoveEvents(o),ke};if(i.preloadOnly){const ke=this._emulate(_e,i.duration,d);return this._preloadTiles(ke),this}const Me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=pe,this._rotating=fe,this._pitching=we,this._padding=ge,this._easeId=i.easeId,this._prepareEase(o,i.noMoveStart,Me),this._ease(_e(d),ke=>{d.cameraElevationReference==="sea"&&d.recenterOnTerrain(),this._afterEase(o,ke)},i),this}_prepareEase(i,o,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),o||d.moving||this.fire(new n.z("movestart",i)),this._zooming&&!d.zooming&&this.fire(new n.z("zoomstart",i)),this._rotating&&!d.rotating&&this.fire(new n.z("rotatestart",i)),this._pitching&&!d.pitching&&this.fire(new n.z("pitchstart",i))}_fireMoveEvents(i){this.fire(new n.z("move",i)),this._zooming&&this.fire(new n.z("zoom",i)),this._rotating&&this.fire(new n.z("rotate",i)),this._pitching&&this.fire(new n.z("pitch",i))}_afterEase(i,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,g=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new n.z("zoomend",i)),g&&this.fire(new n.z("rotateend",i)),v&&this.fire(new n.z("pitchend",i)),this.fire(new n.z("moveend",i))}flyTo(i,o){if(this._prefersReducedMotion(i)){const nt=n.ay(i,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(nt,o)}this.stop(),i=n.l({offset:[0,0],speed:1.2,curve:1.42,easing:n.dA},i);const d=this.transform,g=this.getZoom(),v=this.getBearing(),w=this.getPitch(),C=this.getPadding(),D="zoom"in i?n.aw(+i.zoom,d.minZoom,d.maxZoom):g,L="bearing"in i?this._normalizeBearing(i.bearing,v):v,O="pitch"in i?+i.pitch:w,N=this._extendPadding(i.padding),B=d.zoomScale(D-g),q=n.P.convert(i.offset);let J=d.centerPoint.add(q);const X=d.pointLocation(J),ee=n.bO.convert(i.center||X);this._normalizeCenter(ee);const Q=d.project(X),ae=d.project(ee).sub(Q);let pe=i.curve;const fe=Math.max(d.width,d.height),we=fe/B,ge=ae.mag();if("minZoom"in i){const nt=n.aw(Math.min(i.minZoom,g,D),d.minZoom,d.maxZoom),St=fe/d.zoomScale(nt-g);pe=Math.sqrt(St/ge*2)}const ve=pe*pe;function _e(nt){const St=(we*we-fe*fe+(nt?-1:1)*ve*ve*ge*ge)/(2*(nt?we:fe)*ve*ge);return Math.log(Math.sqrt(St*St+1)-St)}function Me(nt){return(Math.exp(nt)-Math.exp(-nt))/2}function ke(nt){return(Math.exp(nt)+Math.exp(-nt))/2}const tt=_e(0);let We=function(nt){return ke(tt)/ke(tt+pe*nt)},ct=function(nt){return fe*((ke(tt)*(Me(St=tt+pe*nt)/ke(St))-Me(tt))/ve)/ge;var St},lt=(_e(1)-tt)/pe;if(Math.abs(ge)<1e-6||!isFinite(lt)){if(Math.abs(fe-we)<1e-6)return this.easeTo(i,o);const nt=we<fe?-1:1;lt=Math.abs(Math.log(we/fe))/pe,ct=function(){return 0},We=function(St){return Math.exp(nt*pe*St)}}i.duration="duration"in i?+i.duration:1e3*lt/("screenSpeed"in i?+i.screenSpeed/pe:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const $e=v!==L,it=O!==w,gt=!d.isPaddingEqual(N),Ue=i.retainPadding===!1?d.clone():d,ht=nt=>St=>{const pt=St*lt,ut=1/We(pt);nt.zoom=St===1?D:g+nt.scaleZoom(ut),$e&&(nt.bearing=n.af(v,L,St)),it&&(nt.pitch=n.af(w,O,St)),gt&&(Ue.interpolatePadding(C,N,St),J=Ue.centerPoint.add(q));const vt=St===1?ee:nt.unproject(Q.add(ae.mult(ct(pt))).mult(ut));return nt.setLocationAtPoint(nt.renderWorldCopies?vt.wrap():vt,J),nt._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(o),nt};if(i.preloadOnly){const nt=this._emulate(ht,i.duration,d);return this._preloadTiles(nt),this}return this._zooming=!0,this._rotating=$e,this._pitching=it,this._padding=gt,this._prepareEase(o,!1),this._ease(ht(d),()=>this._afterEase(o),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(i){}_cancelRenderFrame(i){}_stop(i,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,o)}if(!i){const d=this.handlers;d&&d.stop(!1)}return this}_ease(i,o,d){d.animate===!1||d.duration===0?(i(1),o()):(this._easeStart=n.q.now(),this._easeOptions=d,this._onEaseFrame=i,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((n.q.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,o){i=n.bF(i,-180,180);const d=Math.abs(i-o);return Math.abs(i-360-o)<d&&(i-=360),Math.abs(i+360-o)<d&&(i+=360),i}_normalizeCenter(i){const o=this.transform;if(o.maxBounds||o.projection.name!=="globe"&&!o.renderWorldCopies)return;const d=i.lng-o.center.lng;i.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&n.q.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,o,d){const g=Math.ceil(15*o/1e3),v=[],w=i(d.clone());for(let C=0;C<=g;C++){const D=w(C/g);v.push(D.clone())}return v}_preloadTiles(i,o){}}class wf{constructor(i={}){this.options=i,n.aP(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const o=this.options&&this.options.compact,d=i._getUIString("AttributionControl.ToggleAttribution");this._map=i,this._container=ne("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ne("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",d);const g=ne("span","mapboxgl-ctrl-icon",this._compactButton);return g.setAttribute("aria-hidden","true"),g.setAttribute("title",d),this._innerContainer=ne("div","mapboxgl-ctrl-attrib-inner",this._container),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.e.ACCESS_TOKEN}];if(i){const d=o.reduce((g,v,w)=>(v.value&&(g+=`${v.key}=${v.value}${w<o.length-1?"&":""}`),g),"?");i.href=`${n.e.FEEDBACK_URL}/${d}#${Km(this._map,!0)}`,i.rel="noopener nofollow"}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const o=this._map.style._mergedSourceCaches;for(const g in o){const v=o[g];if(v.used){const w=v.getSource();w.attribution&&i.indexOf(w.attribution)<0&&i.push(w.attribution)}}i.sort((g,v)=>g.length-v.length),i=i.filter((g,v)=>{for(let w=v+1;w<i.length;w++)if(i[w].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const d=i.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,i.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class qs{constructor(){n.aP(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=ne("div","mapboxgl-ctrl");const o=ne("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const o in i){const d=i[o].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const o=i[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class Hs{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const o=++this._id;return this._queue.push({callback:i,id:o,cancelled:!1}),o}remove(i){const o=this._currentlyRunning,d=o?this._queue.concat(o):this._queue;for(const g of d)if(g.id===i)return void(g.cancelled=!0)}run(i=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const d of o)if(!d.cancelled&&(d.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Hc{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const o=n.cB((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,o,d){this._start=this.getValue(o),this._end=i,this._startTime=o,this._endTime=o+d}}const Zl={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Xl extends n.z{constructor(i,o,d,g){const{point:v,lngLat:w,originalEvent:C,target:D}=i;super(i.type,{point:v,lngLat:w,originalEvent:C,target:D}),this.preventDefault=()=>{i.preventDefault()},this.id=o,this.interaction=d,this.feature=g}}class i_{constructor(i){this.map=i,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(i,o){if(this.typeById.has(i))throw new Error(`Interaction id "${i}" already exists.`);const d=o.filter;let g=o.type;d&&this.filters.set(i,n.aZ(d)),g==="mouseover"&&(g="mouseenter"),g==="mouseout"&&(g="mouseleave");const v=this.interactionsByType.get(g)||new Map;g==="mouseenter"||g==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(i,o)):v.size===0&&this.map.on(g,this.handleType),v.size===0&&this.interactionsByType.set(g,v),v.set(i,o),this.typeById.set(i,g)}get(i){const o=this.typeById.get(i);if(!o)return;const d=this.interactionsByType.get(o);return d?d.get(i):void 0}remove(i){const o=this.typeById.get(i);if(!o)return;this.typeById.delete(i),this.filters.delete(i);const d=this.interactionsByType.get(o);d&&(d.delete(i),o==="mouseenter"||o==="mouseleave"?(this.delegatedInteractions.delete(i),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):d.size===0&&this.map.off(o,this.handleType))}queryTargets(i,o){const d=[];for(const[g,v]of o)v.target&&d.push({targetId:g,target:v.target,filter:this.filters.get(g)});return this.map.style.queryRenderedTargets(i,d,this.map.transform)}handleMove(i){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const o=this.queryTargets(i.point,Array.from(this.delegatedInteractions).reverse());o.length&&(i.type="mouseenter",this.handleType(i,o));const d=new Map;for(const[g,{feature:v}]of this.prevHoveredFeatures)this.hoveredFeatures.has(g)||d.set(v.id,v);d.size&&(i.type="mouseleave",this.handleType(i,Array.from(d.values())))}handleOut(i){const o=Array.from(this.hoveredFeatures.values()).map(({feature:d})=>d);o.length&&(i.type="mouseleave",this.handleType(i,o)),this.hoveredFeatures.clear()}handleType(i,o){const d=Array.from(this.interactionsByType.get(i.type)).reverse(),g=!!o;o=o||this.queryTargets(i.point,d);const v=i.type==="mouseenter";let w=!1;const C=new Set;for(const D of o){for(const[L,O]of d){if(!O.target)continue;const N=D.variants?D.variants[L]:null;if(N){for(const B of N){if(Ia(B,D,C,L))continue;const q=new n.cw(D,B),J=Bu(B,D,L);g&&(q.state=this.map.getFeatureState(q));const X=v?this.prevHoveredFeatures.get(J):null,ee=new Xl(i,L,O,q),Q=X?X.stop:O.handler(ee);if(v&&this.hoveredFeatures.set(J,{feature:D,stop:Q}),Q!==!1){w=!0;break}}if(w)break}}if(w)break}if(!w)for(const[D,L]of d){const{handler:O,target:N}=L;if(!N&&O(new Xl(i,D,L,null))!==!1)break}}}function Xi(h,i){if(Array.isArray(h)&&Array.isArray(i)){const o=new Set(h),d=new Set(i);return o.size===d.size&&h.every(g=>d.has(g))}return n.bn(h,i)}const dl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Mx={showCompass:!0,showZoom:!0,visualizePitch:!1};class Cx{constructor(i,o,d=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new aa({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,d&&(this.mousePitch=new Mh({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),n.aP(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(i,o){this.mouseRotate.mousedown(i,o),this.mousePitch&&this.mousePitch.mousedown(i,o),me()}move(i,o){const d=this.map,g=this.mouseRotate.mousemoveWindow(i,o),v=g&&g.bearingDelta;if(v&&d.setBearing(d.getBearing()+v),this.mousePitch){const w=this.mousePitch.mousemoveWindow(i,o),C=w&&w.pitchDelta;C&&d.setPitch(d.getPitch()+C)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ie(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(n.l({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),rt(this.element,i)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,rt(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ve(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=Ve(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Tf(h,i,o){if(h=new n.bO(h.lng,h.lat),i){const d=new n.bO(h.lng-360,h.lat),g=new n.bO(h.lng+360,h.lat),v=360*Math.ceil(Math.abs(h.lng-o.center.lng)/360),w=o.locationPoint(h).distSqr(i),C=i.x<0||i.y<0||i.x>o.width||i.y>o.height;o.locationPoint(d).distSqr(i)<w&&(C||Math.abs(d.lng-o.center.lng)<v)?h=d:o.locationPoint(g).distSqr(i)<w&&(C||Math.abs(g.lng-o.center.lng)<v)&&(h=g)}for(;Math.abs(h.lng-o.center.lng)>180;){const d=o.locationPoint(h);if(d.x>=0&&d.y>=0&&d.x<=o.width&&d.y<=o.height)break;h.lng>o.center.lng?h.lng-=360:h.lng+=360}return h}const la={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Po extends n.E{constructor(i,o){if(super(),(i instanceof HTMLElement||o)&&(i=n.l({element:i},o)),n.aP(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=n.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=ne("div");const v=41,w=27,C=be("svg",{display:"block",height:v*this._scale+"px",width:w*this._scale+"px",viewBox:`0 0 ${w} ${v}`},this._element),D=be("radialGradient",{id:"shadowGradient"},be("defs",{},C));be("stop",{offset:"10%","stop-opacity":.4},D),be("stop",{offset:"100%","stop-opacity":.05},D),be("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),be("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),be("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),be("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=n.P.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const d=this._element.classList;for(const v in la)d.remove(`mapboxgl-marker-anchor-${v}`);d.add(`mapboxgl-marker-anchor-${this._anchor}`);const g=i&&i.className?i.className.trim().split(/\s+/):[];d.add(...g),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=n.bO.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const g=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const o=i.code,d=i.charCode||i.keyCode;o!=="Space"&&o!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(i){const o=i.originalEvent.target,d=this._element;this._popup&&(o===d||d.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,o=this._pos;if(!i||!o)return!1;const d=i.unproject(o),g=i.getFreeCameraOptions();if(!g.position)return!1;const v=g.position.toLngLat();return v.distanceTo(d)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const o=this._pos;if(!o||o.x<0||o.x>i.transform.width||o.y<0||o.y>i.transform.height)return void this._clearFadeTimer();const d=i.unproject(o);let g;i._showingGlobe()&&n.dH(i.transform,this._lngLat)?g=0:(g=1-i._queryFogOpacity(d),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${la[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){const i=this._pos,o=this._map,d=this.getPitchAlignment();if(!o||!i||d!=="map")return"";if(!o._showingGlobe()){const D=o.getPitch();return D?`rotateX(${D}deg)`:""}const g=n.c4(n.dI(o.transform,this._lngLat)),v=i.sub(n.dJ(o.transform)),w=Math.abs(v.x)+Math.abs(v.y);if(w===0)return"";const C=g/w;return`rotateX(${-v.y*C}deg) rotateY(${v.x*C}deg)`}_calculateZTransform(){const i=this._pos,o=this._map;if(!o||!i)return"";let d=0;const g=this.getRotationAlignment();if(g==="map")if(o._showingGlobe()){const v=o.project(new n.bO(this._lngLat.lng,this._lngLat.lat+.001)),w=o.project(new n.bO(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);d=n.c4(Math.atan2(w.y,w.x))-90}else d=-o.getBearing();else if(g==="horizon"){const v=n.ac(4,6,o.getZoom()),w=n.dJ(o.transform);w.y+=v*o.transform.height;const C=i.sub(w),D=n.c4(Math.atan2(C.y,C.x));d=(D>90?D-270:D+90)*(1-v)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(i){cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=Tf(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat),i===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=n.P.convert(i),this._update(),this}addClassName(i){return this._element.classList.add(i),this}removeClassName(i){return this._element.classList.remove(i),this}toggleClassName(i){return this._element.classList.toggle(i)}_onMove(i){const o=this._map;if(!o)return;const d=this._pointerdownPos,g=this._positionDelta;if(d&&g){if(!this._isDragging){const v=this._clickTolerance||o._clickTolerance;if(i.point.dist(d)<v)return;this._isDragging=!0}this._pos=i.point.sub(g),this._lngLat=o.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.z("dragstart"))),this.fire(new n.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.z("dragend")),this._state="inactive"}_addDragHandler(i){const o=this._map,d=this._pos;o&&d&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(d),this._pointerdownPos=i.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const o=this._map;return o&&(i?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ms={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ps={maxWidth:100,unit:"metric"},zr={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Uy={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Gn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function n_(h=new n.P(0,0),i="bottom"){if(typeof h=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(i){case"top":return new n.P(0,h);case"top-left":return new n.P(o,o);case"top-right":return new n.P(-o,o);case"bottom":return new n.P(0,-h);case"bottom-left":return new n.P(o,-o);case"bottom-right":return new n.P(-o,-o);case"left":return new n.P(h,0);case"right":return new n.P(-h,0)}return new n.P(0,0)}return h instanceof n.P||Array.isArray(h)?n.P.convert(h):n.P.convert(h[i]||[0,0])}return{version:k,supported:ue.supported,setRTLTextPlugin:n.dK,getRTLTextPluginStatus:n.dL,Map:class extends qc{constructor(h){U.mark(j.create);const i=h;if((h=n.l({},dl,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&n.dF(window)&&(h.antialias=!1,n.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ku(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._repaint=!!h.repaint,this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new Hs,this._domRenderTaskQueue=new Hs,this._controls=[],this._markers=[],this._popups=[],this._mapId=n.aV(),this._locale=n.l({},Zl,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._tessellationStep=h.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=h.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Hc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=h.scaleFactor,this._requestManager=new ni(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,this._contextCreateOptions=h.contextCreateOptions?Object.assign({},h.contextCreateOptions):{},typeof h.container=="string"){const o=document.getElementById(h.container);if(!o)throw new Error(`Container '${h.container.toString()}' not found.`);this._container=o}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&n.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),this._spriteFormat=h.spriteFormat,n.aP(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Hm),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new By(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,(h.style||!h.testMode)&&this.setStyle(h.style||n.e.DEFAULT_STYLE,{config:h.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this.indoor=new am(this),h.hash&&(this._hash=new Cy(typeof h.hash=="string"&&h.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){i.center==null&&i.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch});const o=h.bounds;o&&(this.resize(),this.fitBounds(o,n.l({},h.fitBoundsOptions,{duration:0})))}this.resize(),h.attributionControl&&this.addControl(new wf({customAttribution:h.customAttribution})),this._logoControl=new qs,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new n.z(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new n.z(`${o.dataType}dataloading`,o))}),this._interactions=new i_(this)}_getMapId(){return this._mapId}addControl(h,i){if(i===void 0&&(i=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new n.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=h.onAdd(this);this._controls.push(h);const d=this._controlPositions[i];return i.indexOf("bottom")!==-1?d.insertBefore(o,d.firstChild):d.appendChild(o),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new n.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(h);return i>-1&&this._controls.splice(i,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new n.z("movestart",h)).fire(new n.z("move",h)),this.fire(new n.z("resize",h)),i&&this.fire(new n.z("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(n.az.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new n.z("zoomstart")).fire(new n.z("zoom")).fire(new n.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new n.z("zoomstart")).fire(new n.z("zoom")).fire(new n.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new n.z("pitchstart")).fire(new n.z("pitch")).fire(new n.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new n.z("pitchstart")).fire(new n.z("pitch")).fire(new n.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(h){return this._scaleFactor=h,this.painter.scaleFactor=h,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(i=>i.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(i=>i==="auto"?navigator.language:i):h}setLanguage(h){const i=this._parseLanguage(h);if(!this.style||i===this._language)return this;this._language=i,this.style.reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,i=h.projection.name;let o;i==="globe"&&h.zoom>=n.bY?(h.setMercatorFromTransition(),o=!0):i==="mercator"&&h.zoom<n.bY&&(h.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,i){return this._updateProjection(h||i||{name:"mercator"})}_updateProjection(h){let i;return i=h.name==="globe"&&this.transform.zoom>=n.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(h){return this.transform.locationPoint3D(n.bO.convert(h))}unproject(h){return this.transform.pointLocation3D(n.P.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,i,o){const d=g=>{let v=[];if(Array.isArray(i)){const w=i.filter(C=>this.getLayer(C));v=w.length?this.queryRenderedFeatures(g,{layers:w}):[]}else v=this.queryRenderedFeatures(g,{target:i});return v};if(h==="mouseenter"||h==="mouseover"){let g=!1;return{listener:o,targets:i,delegates:{mousemove:w=>{const C=d(w.point);C.length?g||(g=!0,o.call(this,new Is(h,this,w.originalEvent,{features:C}))):g=!1},mouseout:()=>{g=!1}}}}if(h==="mouseleave"||h==="mouseout"){let g=!1;return{listener:o,targets:i,delegates:{mousemove:C=>{d(C.point).length?g=!0:g&&(g=!1,o.call(this,new Is(h,this,C.originalEvent)))},mouseout:C=>{g&&(g=!1,o.call(this,new Is(h,this,C.originalEvent)))}}}}{const g=v=>{const w=d(v.point);w.length&&(v.features=w,o.call(this,v),delete v.features)};return{listener:o,targets:i,delegates:{[h]:g}}}}on(h,i,o){if(typeof i=="function"||o===void 0)return super.on(h,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const d=this._createDelegatedListener(h,i,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(d);for(const g in d.delegates)this.on(g,d.delegates[g]);return this}once(h,i,o){if(typeof i=="function"||o===void 0)return super.once(h,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const d=this._createDelegatedListener(h,i,o);for(const g in d.delegates)this.once(g,d.delegates[g]);return this}off(h,i,o){if(typeof i=="function"||o===void 0)return super.off(h,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const d=this._delegatedListeners?this._delegatedListeners[h]:void 0;return d&&(g=>{for(let v=0;v<g.length;v++){const w=g[v];if(w.listener===o&&Xi(w.targets,i)){for(const C in w.delegates)this.off(C,w.delegates[C]);return g.splice(v,1),this}}})(d),this}queryRenderedFeatures(h,i){if(!this.style)return[];if(h===void 0||h instanceof n.P||Array.isArray(h)||i!==void 0||(i=h,h=void 0),h=h||[[0,0],[this.transform.width,this.transform.height]],!i){const v=this.style.queryRenderedFeatures(h,void 0,this.transform),w=this.style.queryRenderedFeatureset(h,void 0,this.transform);return v.concat(w)}let o=!0;if(i.target&&(o=this._isTargetValid(i.target),o&&!i.layers))return this.style.queryRenderedFeatureset(h,i,this.transform);let d=!0;if(i.layers&&Array.isArray(i.layers)){for(const v of i.layers)if(!this._isValidId(v)){d=!1;break}if(d&&!i.target)return this.style.queryRenderedFeatures(h,i,this.transform)}let g=[];return d&&(g=g.concat(this.style.queryRenderedFeatures(h,i,this.transform))),o&&(g=g.concat(this.style.queryRenderedFeatureset(h,i,this.transform))),g}querySourceFeatures(h,i){return!h||typeof h=="string"&&!this._isValidId(h)?[]:this.style.querySourceFeatures(h,i)}isPointOnSurface(h){const{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&n.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(n.P.convert(h))}addInteraction(h,i){return this._interactions.add(h,i),this}removeInteraction(h){return this._interactions.remove(h),this}setStyle(h,i){return i=n.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&h&&i.diff!==!1&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(h,(o,d)=>{o?(n.w(`Unable to perform style diff: ${String(o.message||o.error||o)}. Rebuilding the style from scratch.`),this._updateStyle(h,i)):d&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(h,i))}_getUIString(h){const i=this._locale[h];if(i==null)throw new Error(`Missing UI string '${h}'`);return i}_updateStyle(h,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h){const o=n.l({},i);i&&i.config&&(o.initialConfig=i.config,delete o.config),this.style=new lo(this,o).load(h),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new lo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.w("There is no style added to the map."),!1)}_isValidId(h){return h==null?(this.fire(new n.y(new Error("IDs can't be empty."))),!1):!n.cr(h)||(this.fire(new n.y(new Error(`IDs can't contain special symbols: "${h}".`))),!1)}_isTargetValid(h){return"featuresetId"in h?this._isValidId("importId"in h?h.importId:h.featuresetId):"layerId"in h&&this._isValidId(h.layerId)}_areTargetsValid(h){if(Array.isArray(h)){for(const i of h)if(!this._isValidId(i))return!1;return!0}return this._isTargetValid(h)}addSource(h,i){return this._isValidId(h)?(this._lazyInitEmptyStyle(),this.style.addSource(h,i),this._update(!0)):this}isSourceLoaded(h){return!!this._isValidId(h)&&!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(h,i,o){this._lazyInitEmptyStyle(),this.style.addSourceType(h,i,o)}removeSource(h){return this._isValidId(h)?(this.style.removeSource(h),this._updateTerrain(),this._update(!0)):this}getSource(h){return this._isValidId(h)?this.style.getOwnSource(h):null}addImage(h,i,{pixelRatio:o=1,sdf:d=!1,stretchX:g,stretchY:v,content:w}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:C,height:D,data:L}=n.q.getImageData(i);this.style.addImage(h,{data:new n.r({width:C,height:D},L),pixelRatio:o,stretchX:g,stretchY:v,content:w,sdf:d,version:0,usvg:!1})}else if(i.width===void 0||i.height===void 0)this.fire(new n.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:D}=i,L=i;this.style.addImage(h,{data:new n.r({width:C,height:D},new Uint8Array(L.data)),pixelRatio:o,stretchX:g,stretchY:v,content:w,sdf:d,usvg:!1,version:0,userImage:L}),L.onAdd&&L.onAdd(this,h)}}updateImage(h,i){this._lazyInitEmptyStyle();const o=this.style.getImage(h);if(!o)return void this.fire(new n.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?n.q.getImageData(i):i,{width:g,height:v,data:w}=d;if(g===void 0||v===void 0)return void this.fire(new n.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==(o.usvg?o.icon.usvg_tree.width:o.data.width)||v!==(o.usvg?o.icon.usvg_tree.height:o.data.height))return void this.fire(new n.y(new Error(`The width and height of the updated image (${g}, ${v})
                must be that same as the previous version of the image
                (${o.data.width}, ${o.data.height})`)));const C=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);let D=!1;o.usvg?(o.data=new n.r({width:g,height:v},new Uint8Array(w)),o.usvg=!1,o.icon=void 0,D=!0):o.data.replace(w,C),this.style.updateImage(h,o,D)}hasImage(h){return h?!!this.style&&!!this.style.getImage(h):(this.fire(new n.y(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,i){n.o(this._requestManager.transformRequest(h,n.R.Image),(o,d)=>{i(o,d instanceof HTMLImageElement?n.q.getImageData(d):d)})}listImages(){return this.style.listImages()}addModel(h,i){this._lazyInitEmptyStyle(),this.style.addModel(h,i)}hasModel(h){return h?this.style.hasModel(h):(this.fire(new n.y(new Error("Missing required model id"))),!1)}removeModel(h){this.style.removeModel(h)}listModels(){return this.style.listModels()}addLayer(h,i){return this._isValidId(h.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(h,i),this._update(!0)):this}getSlot(h){const i=this.getLayer(h);return i&&i.slot||null}setSlot(h,i){return this.style.setSlot(h,i),this.style.mergeLayers(),this._update(!0)}addImport(h,i){return this.style.addImport(h,i),this}updateImport(h,i){return typeof i!="string"&&i.id!==h?(this.removeImport(h),this.addImport(i)):(this.style.updateImport(h,i),this._update(!0))}removeImport(h){return this.style.removeImport(h),this}moveImport(h,i){return this.style.moveImport(h,i),this._update(!0)}moveLayer(h,i){return this._isValidId(h)?(this.style.moveLayer(h,i),this._update(!0)):this}removeLayer(h){return this._isValidId(h)?(this.style.removeLayer(h),this._update(!0)):this}getLayer(h){if(!this._isValidId(h))return null;const i=this.style.getOwnLayer(h);return i?i.type==="custom"?i.implementation:i.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(h,i,o){return this._isValidId(h)?(this.style.setLayerZoomRange(h,i,o),this._update(!0)):this}setFilter(h,i,o={}){return this._isValidId(h)?(this.style.setFilter(h,i,o),this._update(!0)):this}getFilter(h){return this._isValidId(h)?this.style.getFilter(h):null}setPaintProperty(h,i,o,d={}){return this._isValidId(h)?(this.style.setPaintProperty(h,i,o,d),this._update(!0)):this}getPaintProperty(h,i){return this._isValidId(h)?this.style.getPaintProperty(h,i):null}setLayoutProperty(h,i,o,d={}){return this._isValidId(h)?(this.style.setLayoutProperty(h,i,o,d),this._update(!0)):this}getLayoutProperty(h,i){return this._isValidId(h)?this.style.getLayoutProperty(h,i):null}getSchema(h){return this.style.getSchema(h)}setSchema(h,i){return this.style.setSchema(h,i),this._update(!0)}getConfig(h){return this.style.getConfig(h)}setConfig(h,i){return this.style.setConfig(h,i),this._update(!0)}getConfigProperty(h,i){return this.style.getConfigProperty(h,i)}setConfigProperty(h,i,o){return this.style.setConfigProperty(h,i,o),this._update(!0)}getFeaturesetDescriptors(h){return this.style.getFeaturesetDescriptors(h)}setLights(h){if(this._lazyInitEmptyStyle(),h&&h.length===1&&h[0].type==="flat"){const i=h[0];i.properties?this.style.setFlatLight(i.properties,i.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(h),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const h=this.style.getLights()||[];return h.length===0&&h.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),h}setLight(h,i={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:h}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(h){return this._lazyInitEmptyStyle(),this.style.setSnow(h),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(h){return this._lazyInitEmptyStyle(),this.style.setRain(h),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(h){return this._lazyInitEmptyStyle(),this.style.setColorTheme(h),this._update(!0)}setImportColorTheme(h,i){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(h,i),this._update(!0)}setCamera(h){return this.style.setCamera(h),this._triggerCameraUpdate(h)}_triggerCameraUpdate(h){return this._update(this.transform.setOrthographicProjectionAtLowPitch(h["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.bO.convert(h),this.transform):0}setFeatureState(h,i){return h.source&&!this._isValidId(h.source)?this:(this.style.setFeatureState(h,i),this._update())}removeFeatureState(h,i){return h.source&&!this._isValidId(h.source)?this:(this.style.removeFeatureState(h,i),this._update())}getFeatureState(h){return h.source&&!this._isValidId(h.source)?null:this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let o,d,g,v=this._container;for(;v&&(!d||!g);){const w=window.getComputedStyle(v).transform;w&&w!=="none"&&(o=w.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(d=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(g=o[3])),v=v.parentElement}this._containerWidth=d?Math.abs(h/d):h,this._containerHeight=g?Math.abs(i/g):i}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=ne("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=ne("div","mapboxgl-canvas-container",h);this._canvas=ne("canvas","mapboxgl-canvas",i),this._interactive&&(i.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=ne("div","mapboxgl-control-container",h),d=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(g=>{d[g]=ne("div",`mapboxgl-ctrl-${g}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,i){const o=n.q.devicePixelRatio||1;this._canvas.width=o*Math.ceil(h),this._canvas.height=o*Math.ceil(i),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${i}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const i=this._markers.indexOf(h);i!==-1&&this._markers.splice(i,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const i=this._popups.indexOf(h);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const h=n.l({},ue.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",h);i?(ro(i,!0),this.painter=new Ym(i,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",o=>{o.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),n.m.testSupport(i)):this.fire(new n.y(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.z("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new n.z("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let i;this.fire(new n.z("renderstart")),++this._frameId;const o=this.painter.context.extTimerQuery,d=n.q.now(),g=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=g.createQuery(),g.beginQuery(o.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,O=this.transform.pitch,N=n.q.now(),B=new n.a8(L,{now:N,fadeDuration:v,pitch:O,transition:this.style.transition});this.style.update(B)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(d),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(d);const C=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),C&&(this._placementDirty=C.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,U.mark(j.load),this.fire(new n.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const L=n.q.now()-d;g.endQuery(o.TIME_ELAPSED_EXT),setTimeout(()=>{const O=g.getQueryParameter(i,g.QUERY_RESULT)/1e6;g.deleteQuery(i),this.fire(new n.z("gpu-timing-frame",{cpuTime:L,gpuTime:O}))},50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout(()=>{const O=this.painter.queryGpuTimers(L);this.fire(new n.z("gpu-timing-layer",{layerTimes:O}))},50)}if(this.listens("gpu-timing-deferred-render")){const L=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const O=this.painter.queryGpuTimeDeferredRender(L);this.fire(new n.z("gpu-timing-deferred-render",{gpuTime:O}))},50)}const D=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(D||this._repaint)this.triggerRepaint();else{const L=this.idle();if(L&&(w=this._updateAverageElevation(d,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),L&&(this.fire(new n.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const O=this._calculateSpeedIndex();this.fire(new n.z("speedindexcompleted",{speedIndex:O})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,U.mark(j.fullLoad),this._performanceMetricsCollection&&fr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const i of this._markers)h&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!h||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(h,i=!1){const o=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);const d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(i||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const g=this.transform.averageElevation;let v=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=h;const w=Math.abs(g-v);if(w>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(v),o(v);this._averageElevation.easeTo(v,h,300)}else if(w>1e-4)return this._averageElevation.jumpTo(v),o(v)}return!!this._averageElevation.isEasing(h)&&o(this._averageElevation.getValue(h))}_authenticate(){Le(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===At||h.status===401)){const i=this.painter.context.gl;ro(i,!1),this._logoControl instanceof qs&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),dr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Vr(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const o=this.painter.context.gl,d=o.createFramebuffer();function g(v){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,v,0);const w=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,w),w}return o.bindFramebuffer(o.FRAMEBUFFER,d),this._canvasPixelComparison(g(h),i.canvasCopies.map(g),i.timeStamps)}_canvasPixelComparison(h,i,o){let d=o[1]-o[0];const g=h.length/4;for(let v=0;v<i.length;v++){const w=i[v];let C=0;for(let D=0;D<w.length;D+=4)w[D]===h[D]&&w[D+1]===h[D+1]&&w[D+2]===h[D+2]&&w[D+3]===h[D+3]&&(C+=1);d+=(o[v+2]-o[v+1])*(1-C/g)}return d}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Ss.delete(this.painter.context.gl),Us.remove(),_i.remove(),this._removed=!0,this.fire(new n.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=n.q.frame(i=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(i)}))}_preloadTiles(h){const i=this.style?this.style.getSourceCaches():[];return n.bl(i,(o,d)=>o._preloadTiles(h,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(h){this._showParseStatus!==h&&(this._showParseStatus=h,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(h){this._showLayers2DWireframe!==h&&(this._showLayers2DWireframe=h,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(h){this._showLayers3DWireframe!==h&&(this._showLayers3DWireframe=h,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,this._tp.refreshUI(),h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,this._tp.refreshUI(),h&&this._update())}_setCacheLimits(h,i){n.dG(h,i)}get version(){return k}},NavigationControl:class{constructor(h={}){this.options=n.l({},Mx,h),this._container=ne("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(n.aP(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),ne("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),ne("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.aP(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:i}):o.resetNorth({},{originalEvent:i}))}),this._compassIcon=ne("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const i=h.getZoom(),o=i===h.getMaxZoom(),d=i===h.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Cx(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,i){const o=ne("button",h,this._container);return o.type="button",o.addEventListener("click",i),o}_setButtonTitle(h,i){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${i}`);h.setAttribute("aria-label",o),h.firstElementChild&&h.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends n.E{constructor(h={}){super();const i=navigator.geolocation;this.options=n.l({geolocation:i},ms,h),n.aP(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=yf(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=ne("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const i=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,h(o)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(o=>i(o.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(h){const i=this._map.getMaxBounds(),o=h.coords;return!!i&&(o.longitude<i.getWest()||o.longitude>i.getEast()||o.latitude<i.getSouth()||o.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new n.z("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.z("geolocate",h)),this._finish()}}_updateCamera(h){const i=new n.bO(h.coords.longitude,h.coords.latitude),o=h.coords.accuracy,d=this._map.getBearing(),g=n.l({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(o),g,{geolocateSource:!0})}_updateMarker(h){if(h){const i=new n.bO(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,i=n.bH(1,h._center.lat)*h.worldSize,o=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.z("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=ne("button","mapboxgl-ctrl-geolocate",this._container),ne("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){n.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ne("div","mapboxgl-user-location"),this._dotElement.appendChild(ne("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ne("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Po({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ne("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Po({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.z("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:wf,ScaleControl:class{constructor(h={}){this.options=n.l({},Ps,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),n.aP(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,i=this._map,o=i._containerHeight/2,d=i._containerWidth/2-h/2,g=i.unproject([d,o]),v=i.unproject([d+h,o]),w=g.distanceTo(v);if(this.options.unit==="imperial"){const C=3.2808*w;C>5280?this._setScale(h,C/5280,"mile"):this._setScale(h,C,"foot")}else this.options.unit==="nautical"?this._setScale(h,w/1852,"nautical-mile"):w>=1e3?this._setScale(h,w/1e3,"kilometer"):this._setScale(h,w,"meter")}_setScale(h,i,o){this._map._requestDomTask(()=>{const d=function(v){const w=Math.pow(10,`${Math.floor(v)}`.length-1);let C=v/w;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(D){const L=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*L)/L}(C),w*C}(i),g=d/i;this._container.innerHTML=this._isNumberFormatSupported&&o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(d):`${d}&nbsp;${zr[o]}`,this._container.style.width=h*g+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=ne("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h={}){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:n.w("Full screen control 'container' must be a DOM element.")),n.aP(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=ne("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=ne("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ne("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends n.E{constructor(h){super(),this.options=n.l(Object.create(Uy),h),n.aP(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new n.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new n.z("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=n.bO.convert(h),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const i=document.createDocumentFragment(),o=document.createElement("body");let d;for(o.innerHTML=h;d=o.firstChild,d;)i.appendChild(d);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=ne("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(h),this.options.closeButton){const o=this._closeButton=ne("button","mapboxgl-popup-close-button",i);o.type="button",o.setAttribute("aria-label","Close popup"),o.innerHTML='<span aria-hidden="true">&#215;</span>',o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let i;return this._classList.delete(h)?i=!1:(this._classList.add(h),i=!0),this._updateClassList(),i}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const i=this._map,o=this._container,d=this._pos;if(!i||!o||!d)return"bottom";const g=o.offsetWidth,v=o.offsetHeight,w=d.x<g/2,C=d.x>i.transform.width-g/2;if(d.y+h<v)return w?"top-left":C?"top-right":"top";if(d.y>i.transform.height-v){if(w)return"bottom-left";if(C)return"bottom-right"}return w?"left":C?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),h.className=i.join(" ")}_update(h){const i=this._map,o=this._content;if(!i||!this._lngLat&&!this._trackPointer||!o)return;let d=this._container;if(d||(d=this._container=ne("div","mapboxgl-popup",i.getContainer()),this._tip=ne("div","mapboxgl-popup-tip",d),d.appendChild(o)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Tf(this._lngLat,this._pos,i.transform)),!this._trackPointer||h){const g=this._pos=this._trackPointer&&h instanceof n.P?h:i.project(this._lngLat),v=n_(this.options.offset),w=this._anchor=this._getAnchor(v.y),C=n_(this.options.offset,w),D=g.add(C).round();i._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${la[w]} translate(${D.x}px,${D.y}px)`)})}if(!this._marker&&i._showingGlobe()){const g=n.dH(i.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(Gn);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:Po,Style:lo,LngLat:n.bO,LngLatBounds:n.az,Point:n.P,MercatorCoordinate:n.aa,FreeCameraOptions:jd,Evented:n.E,config:n.e,prewarm:n.dM,clearPrewarmedResources:n.dN,get accessToken(){return n.e.ACCESS_TOKEN},set accessToken(h){n.e.ACCESS_TOKEN=h},get baseApiUrl(){return n.e.API_URL},set baseApiUrl(h){n.e.API_URL=h},get workerCount(){return n.dO.workerCount},set workerCount(h){n.dO.workerCount=h},get maxParallelImageRequests(){return n.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){n.e.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){n.dP(h)},get workerUrl(){return n.dQ.workerUrl},set workerUrl(h){n.dQ.workerUrl=h},get workerClass(){return n.dQ.workerClass},set workerClass(h){n.dQ.workerClass=h},get workerParams(){return n.dQ.workerParams},set workerParams(h){n.dQ.workerParams=h},get dracoUrl(){return n.dR()},set dracoUrl(h){n.dS(h)},get meshoptUrl(){return n.dT()},set meshoptUrl(h){n.dU(h)},setNow:n.q.setNow,restoreNow:n.q.restoreNow}});var T=_;return T})})(GO);var QZ=GO.exports;const Pw=JZ(QZ);const eX={name:"MapboxMap",data(){return{cines:[],map:null}},mounted(){Pw.accessToken="pk.eyJ1IjoiZWxjZWxlIiwiYSI6ImNtOHJqaGIzNzA2a2kya3B2azlubmZpd2YifQ.SoaN9qTdXQZvsNybR3DQIw",this.map=new Pw.Map({container:this.$refs.mapContainer,style:"mapbox://styles/mapbox/navigation-night-v1",center:[2.055501,41.357301],zoom:16}),this.getCines()},methods:{async getCines(){try{const r=await Ho.get("cine/");this.cines=r.data,this.addMarkersToMap()}catch(r){console.log(r)}},addMarkersToMap(){this.cines.forEach(r=>{new Pw.Marker().setLngLat([r.longitud,r.latitud]).addTo(this.map)})},posicionarCine(r){this.map.flyTo({center:[r.longitud,r.latitud],zoom:16,speed:.8,curve:1,easing(t){return t}})}}},tX={class:"contenedor"},iX={class:"text-primary",id:"cines"},nX=["onClick"],rX={ref:"mapContainer",class:"map-container"};function sX(r,t,l,f,_,b){return Dt(),Ot(Oi,null,[t[0]||(t[0]=W("h1",null,"CINES",-1)),W("div",tX,[W("div",iX,[(Dt(!0),Ot(Oi,null,jn(_.cines,T=>(Dt(),Ot("div",{class:"card-cines",key:T.id,onClick:n=>b.posicionarCine(T),style:Es({backgroundImage:`linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(${T.image})`,backgroundSize:"cover",backgroundPosition:"center"})},[W("h2",null,qt(T.nombre),1)],12,nX))),128))]),W("div",rX,null,512)])],64)}const oX=Kr(eX,[["render",sX],["__scopeId","data-v-53c8a90b"]]);const aX={data(){return{cines:[],myModal:{},cine:{},messageError:"",isError:!1,insert:!1}},created(){this.selectCine()},methods:{showForm(){this.insert=!0,this.cine={},new er(document.getElementById("cineModal")).show()},updateCine(){const r=this;axios.put("cine/"+r.cine.id,r.cine).then(t=>{r.selectCine(),r.myModal.hide()}).catch(t=>{this.isError=!0,r.messageError=t.response.data.message})},insertCine(){const r=this;axios.post("cine",r.cine).then(t=>{r.selectCine(),r.myModal.hide()}).catch(t=>{this.isError=!0,r.messageError=t.response.data.message})},selectCine(){const r=this;axios.get("cine/").then(t=>{r.cines=t.data}).catch(t=>{console.log(t)})},editCine(r){this.insert=!1,this.cine=r,this.myModal=new er("#cineModal"),this.myModal.show()},eliminarCine(r){this.isError=!1,this.cine=r,this.myModal=new er("#deleteModalCine"),this.myModal.show()},deleteCine(r){const t=this;axios.delete("cine/"+r).then(l=>{t.selectCine(),t.myModal.hide()}).catch(l=>{this.isError=!0,t.messageError=l.response.data.message})}},mounted(){}},lX={class:"tabla-cines"},cX={class:"table"},uX={scope:"row"},hX=["onClick"],dX=["onClick"],fX={class:"modal",tabindex:"-1",id:"deleteModalCine"},pX={class:"modal-dialog",role:"document"},mX={class:"modal-content"},_X={class:"modal-body"},gX={key:0,class:"alert alert-danger"},yX={class:"modal-footer"},vX={class:"modal",tabindex:"-1",id:"cineModal"},xX={class:"modal-dialog",role:"document"},bX={class:"modal-content"},wX={class:"modal-header"},TX={key:0,class:"modal-title"},EX={key:1,class:"modal-title"},SX={class:"modal-body"},AX={"data-mdb-input-init":"",class:"form-outline mb-4"},MX={"data-mdb-input-init":"",class:"form-outline mb-4"},CX={class:"mb-3"},IX={class:"mb-3"},PX={key:0,class:"alert alert-danger"},RX={class:"modal-footer"};function DX(r,t,l,f,_,b){return Dt(),Ot(Oi,null,[W("div",null,[W("button",{onClick:t[0]||(t[0]=T=>b.showForm()),class:"anadirBoton"},t[8]||(t[8]=[W("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-plus-square",viewBox:"0 0 16 16"},[W("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),W("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"})],-1),W("strong",null," AADIR CINE",-1)]))]),W("div",lX,[W("table",cX,[t[11]||(t[11]=W("thead",null,[W("tr",null,[W("th",{scope:"col"},"ID"),W("th",{scope:"col"},"Nombre"),W("th",{scope:"col"},"Longitud"),W("th",{scope:"col"},"Latitud"),W("th",{scope:"col"},"Imagen")])],-1)),W("tbody",null,[(Dt(!0),Ot(Oi,null,jn(_.cines,T=>(Dt(),Ot("tr",{key:T.id},[W("th",uX,qt(T.id),1),W("td",null,qt(T.nombre),1),W("td",null,qt(T.longitud),1),W("td",null,qt(T.latitud),1),W("td",null,qt(T.image),1),W("th",null,[W("button",{onClick:n=>b.editCine(T),class:"editarBoton"},t[9]||(t[9]=[W("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-pencil-square"},[W("path",{d:"M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"}),W("path",{"fill-rule":"evenodd",d:"M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"})],-1)]),8,hX)]),W("th",null,[W("button",{onClick:n=>b.eliminarCine(T),style:{border:"none",background:"none",cursor:"pointer",color:"rgb(255, 0, 0)"}},t[10]||(t[10]=[W("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[W("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"}),W("path",{d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"})],-1)]),8,dX)])]))),128))])])]),W("div",fX,[W("div",pX,[W("div",mX,[t[15]||(t[15]=W("div",{class:"modal-header"},[W("h5",{class:"modal-title"},"Borrar Cine nuevo"),W("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"})],-1)),W("div",_X,[W("p",null,[t[12]||(t[12]=us(" Seguro que quieres borrar a ")),W("strong",null,qt(_.cine.nombre),1),t[13]||(t[13]=us(" ?"))]),_.isError?(Dt(),Ot("p",gX,qt(_.messageError),1)):Pr("",!0)]),W("div",yX,[W("button",{type:"button",class:"btn btn-primary",onClick:t[1]||(t[1]=T=>b.deleteCine(_.cine.id))},"Borrar"),t[14]||(t[14]=W("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Cancelar",-1))])])])]),W("div",vX,[W("div",xX,[W("div",bX,[W("div",wX,[_.insert?(Dt(),Ot("h5",TX,"Crear Cine nuevo")):(Dt(),Ot("h5",EX,"Modificar Cine"))]),W("div",SX,[W("form",null,[W("div",AX,[t[16]||(t[16]=W("label",{for:"cineNombre",class:"form-label"},"Titulo del Cine",-1)),fn(W("input",{type:"text",name:"nombre",class:"form-control",id:"cineNombre",required:"",placeholder:"Introducir Nombre","onUpdate:modelValue":t[2]||(t[2]=T=>_.cine.nombre=T)},null,512),[[gn,_.cine.nombre]])]),W("div",MX,[t[17]||(t[17]=W("label",{for:"cineLongitud",class:"form-label"},"Longitud",-1)),fn(W("input",{type:"number",name:"longitud",class:"form-control",id:"cineLongitud",required:"","onUpdate:modelValue":t[3]||(t[3]=T=>_.cine.longitud=T)},null,512),[[gn,_.cine.longitud]])]),W("div",CX,[t[18]||(t[18]=W("label",{for:"cineLatitud",class:"form-label"},"Latitud",-1)),fn(W("input",{type:"number",name:"latitud",class:"form-control",id:"cineLatitud",required:"",placeholder:"Latitud","onUpdate:modelValue":t[4]||(t[4]=T=>_.cine.latitud=T)},null,512),[[gn,_.cine.latitud]])]),W("div",IX,[t[19]||(t[19]=W("label",{for:"cineImage",class:"form-label"},"URL Imagen",-1)),fn(W("input",{type:"text",name:"image",class:"form-control",id:"cineImage",required:"",placeholder:"Imagen","onUpdate:modelValue":t[5]||(t[5]=T=>_.cine.image=T)},null,512),[[gn,_.cine.image]])])]),_.isError?(Dt(),Ot("p",PX,qt(_.messageError),1)):Pr("",!0)]),W("div",RX,[_.insert?(Dt(),Ot("button",{key:0,type:"button",class:"btn btn-secondary",onClick:t[6]||(t[6]=T=>b.insertCine())},"Crear")):(Dt(),Ot("button",{key:1,type:"button",class:"btn btn-secondary",onClick:t[7]||(t[7]=T=>b.updateCine())},"Editar")),t[20]||(t[20]=W("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal"},"Cerrar",-1))])])])])],64)}const LX=Kr(aX,[["render",DX]]),OX={};function zX(r,t){return Dt(),Ot(Oi,null,[t[0]||(t[0]=W("div",{class:"reproductor"},[W("div",{class:"pelicula"},[W("div",{class:"degradado-info"},[W("a",{href:""})]),W("a",{href:""},[W("img",{src:"",alt:"",STYLE:"width: 120rem; height: 100%;"})])]),W("div",{class:"info-peli"},[W("div",{class:"titulo-pelicula"},[W("h1",null,"titulo"),W("p",null,[us("Hora seleccionada: "),W("strong",null," hora ")])]),W("div",{class:"categorias"},[W("p",null,"Comedia, accin, animacin")]),W("div",{class:"edad"},[W("p",null,"+ pelicula")]),W("div",{class:"descripcion-peli"},[W("p")]),W("div",{class:"botones-pelicula"},[W("div",{class:"ver-ya"},[W("button",null,"VER YA"),W("a",{href:""},[W("div",{class:"play-button"})])]),W("div",{class:"otros-botones"},[W("div",{class:"trailer"},[W("button",null,"Trailer")]),W("div",{class:"heart"})])])])],-1)),t[1]||(t[1]=B1('<div class="detalles"><div class="titulo-detalles"><h1>DETALLES</h1></div><div class="texto-detalles"><h2>titulo</h2><p> descr</p><h4>Gnero</h4><p>Comedia, accin, animacin</p><h4>Fecha de estreno</h4><p>Estreno</p><h4>Nota/10</h4><p>Edad: </p></div></div><div class="reparto"><div class="titulo-reparto"><h1>REPARTO</h1></div><div class="actores"></div></div>',2))],64)}const kX=Kr(OX,[["render",zX]]),FX={};function NX(r,t,l,f,_,b){return null}const BX=Kr(FX,[["render",NX]]);const VX={data(){return{actores:[],myModal:{},actor:{},messageError:"",isError:!1,insert:!1}},created(){this.selectActor()},methods:{showForm(){this.insert=!0,this.actor={},new er(document.getElementById("cineActor")).show()},updateActor(){const r=this;let t=new FormData;t.append("nombre",r.actor.nombre),t.append("apellido",r.actor.apellido),r.actor.imagen&&t.append("imagen",r.actor.imagen),axios.put("actor/"+r.actor.id,t,{headers:{"Content-Type":"multipart/form-data"}}).catch(l=>{this.isError=!0,r.messageError=l.response.data.message})},subirImagen(r){const t=this;t.actor.imagen=r.target.files[0]},insertActor(){const r=this;let t=new FormData;t.append("nombre",r.actor.nombre),t.append("apellido",r.actor.apellido),t.append("imagen",r.actor.imagen),axios.post("actor",t,{headers:{"Content-Type":"multipart/form-data"}}).then(l=>{r.selectActor(),r.myModal.hide()}).catch(l=>{this.isError=!0,r.messageError=l.response.data.message})},selectActor(){const r=this;axios.get("actor/").then(t=>{r.actores=t.data}).catch(t=>{console.log(t)})},editActor(r){this.insert=!1,this.actor=r,this.myModal=new er("#cineActor"),this.myModal.show()},eliminarActor(r){this.isError=!1,this.actor=r,this.myModal=new er("#deleteModalActor"),this.myModal.show()},deleteActor(r){const t=this;axios.delete("actor/"+r).then(l=>{t.selectActor(),t.myModal.hide()}).catch(l=>{this.isError=!0,t.messageError=l.response.data.message})}},mounted(){}},UX={class:"tab-actor"},jX={class:"tabla-actor"},$X={class:"table"},qX={scope:"row"},HX=["onClick"],GX=["onClick"],WX={class:"modal",tabindex:"-1",id:"deleteModalActor"},ZX={class:"modal-dialog",role:"document"},XX={class:"modal-content"},YX={class:"modal-body"},KX={key:0,class:"alert alert-danger"},JX={class:"modal-footer"},QX={class:"modal",tabindex:"-1",id:"cineActor"},eY={class:"modal-dialog",role:"document"},tY={class:"modal-content"},iY={class:"modal-header"},nY={key:0,class:"modal-title"},rY={key:1,class:"modal-title"},sY={class:"modal-body"},oY={"data-mdb-input-init":"",class:"form-outline mb-4"},aY={"data-mdb-input-init":"",class:"form-outline mb-4"},lY={class:"mb-3"},cY={key:0,class:"alert alert-danger"},uY={class:"modal-footer"};function hY(r,t,l,f,_,b){return Dt(),Ot(Oi,null,[W("div",UX,[W("div",null,[W("button",{onClick:t[0]||(t[0]=T=>b.showForm()),class:"anadirBoton"},t[7]||(t[7]=[W("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-plus-square",viewBox:"0 0 16 16"},[W("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),W("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"})],-1),W("strong",null," AADIR ACTOR",-1)]))]),W("div",jX,[W("table",$X,[t[10]||(t[10]=W("thead",null,[W("tr",null,[W("th",{scope:"col"},"ID"),W("th",{scope:"col"},"Nombre"),W("th",{scope:"col"},"Apellido"),W("th",{scope:"col"},"Imagen")])],-1)),W("tbody",null,[(Dt(!0),Ot(Oi,null,jn(_.actores,T=>(Dt(),Ot("tr",{key:T.id},[W("th",qX,qt(T.id),1),W("td",null,qt(T.nombre),1),W("td",null,qt(T.apellido),1),W("td",null,qt(T.imagen),1),W("th",null,[W("button",{onClick:n=>b.editActor(T),class:"editarBoton"},t[8]||(t[8]=[W("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-pencil-square"},[W("path",{d:"M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"}),W("path",{"fill-rule":"evenodd",d:"M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"})],-1)]),8,HX)]),W("th",null,[W("button",{onClick:n=>b.eliminarActor(T),style:{border:"none",background:"none",cursor:"pointer",color:"rgb(255, 0, 0)"}},t[9]||(t[9]=[W("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[W("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"}),W("path",{d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"})],-1)]),8,GX)])]))),128))])])])]),W("div",WX,[W("div",ZX,[W("div",XX,[t[14]||(t[14]=W("div",{class:"modal-header"},[W("h5",{class:"modal-title"},"Borrar Actor nuevo"),W("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"})],-1)),W("div",YX,[W("p",null,[t[11]||(t[11]=us(" Seguro que quieres borrar a ")),W("strong",null,qt(_.actor.nombre),1),t[12]||(t[12]=us(" ?"))]),_.isError?(Dt(),Ot("p",KX,qt(_.messageError),1)):Pr("",!0)]),W("div",JX,[W("button",{type:"button",class:"btn btn-primary",onClick:t[1]||(t[1]=T=>b.deleteActor(_.actor.id))},"Borrar"),t[13]||(t[13]=W("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Cancelar",-1))])])])]),W("div",QX,[W("div",eY,[W("div",tY,[W("div",iY,[_.insert?(Dt(),Ot("h5",nY,"Crear actor nuevo")):(Dt(),Ot("h5",rY,"Modificar Actor"))]),W("div",sY,[W("form",null,[W("div",oY,[t[15]||(t[15]=W("label",{for:"actorNombre",class:"form-label"},"Titulo del Cine",-1)),fn(W("input",{type:"text",name:"nombre",class:"form-control",id:"actorNombre",required:"",placeholder:"Introducir Nombre","onUpdate:modelValue":t[2]||(t[2]=T=>_.actor.nombre=T)},null,512),[[gn,_.actor.nombre]])]),W("div",aY,[t[16]||(t[16]=W("label",{for:"actorApellido",class:"form-label"},"Apellido",-1)),fn(W("input",{type:"text",name:"apellido",class:"form-control",id:"actorApellido",required:"","onUpdate:modelValue":t[3]||(t[3]=T=>_.actor.apellido=T)},null,512),[[gn,_.actor.apellido]])]),W("div",lY,[t[17]||(t[17]=W("label",{for:"actorImagen",class:"form-label"},"Imagen",-1)),W("input",{type:"file",name:"imagen",class:"form-control",id:"actorImagen",required:"",onChange:t[4]||(t[4]=(...T)=>b.subirImagen&&b.subirImagen(...T))},null,32)])]),_.isError?(Dt(),Ot("p",cY,qt(_.messageError),1)):Pr("",!0)]),W("div",uY,[_.insert?(Dt(),Ot("button",{key:0,type:"button",class:"btn btn-secondary",onClick:t[5]||(t[5]=T=>b.insertActor())},"Crear")):(Dt(),Ot("button",{key:1,type:"button",class:"btn btn-secondary",onClick:t[6]||(t[6]=T=>b.updateActor())},"Editar")),t[18]||(t[18]=W("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal"},"Cerrar",-1))])])])])],64)}const dY=Kr(VX,[["render",hY]]);const fY={data(){return{peliculas:[]}},computed:{ultimasPeliculas(){return this.peliculas.slice(-5)}},created(){Ho.get("pelicula").then(r=>{this.peliculas=r.data}).catch(r=>{console.log(r)})}},pY={class:"peliculas-destacadas"},mY={class:"pelis-destacadas"},_Y=["href"];function gY(r,t,l,f,_,b){return Dt(),Ot("div",pY,[t[0]||(t[0]=W("h4",null,"Pelculas destacadas",-1)),W("div",mY,[(Dt(!0),Ot(Oi,null,jn(b.ultimasPeliculas,(T,n)=>(Dt(),Ot("a",{class:"url-peli",key:n,href:`/public/pelicula/${T.id}`},[W("div",{class:"destacada1",style:Es({backgroundImage:`linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url(${T.image})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[W("p",null,qt(T.titulo),1)],4)],8,_Y))),128))])])}const yY=Kr(fY,[["render",gY],["__scopeId","data-v-7b44931a"]]);const vY={data(){return{peliculas:[]}},computed:{ultimasPeliculas(){return this.peliculas.slice(-3)}},created(){Ho.get("pelicula").then(r=>{this.peliculas=r.data}).catch(r=>{console.log(r)})}},xY={class:"seguir-viendo"},bY={key:0},wY=["href"],TY=["href"],EY={class:"pelis-container"},SY=["href"];function AY(r,t,l,f,_,b){return Dt(),Ot(Oi,null,[t[0]||(t[0]=W("h4",null,"Sigue por donde lo dejaste",-1)),W("div",xY,[_.peliculas.length>0?(Dt(),Ot("div",bY,[W("a",{class:"seguir-viendo-peli",href:`/public/pelicula/${_.peliculas[0].id}`},[W("div",{class:"seguir-viendo-peli1",style:Es({backgroundImage:`linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url(${_.peliculas[0].image})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[W("p",null,qt(_.peliculas[0].titulo),1)],4)],8,wY),W("a",{class:"seguir-viendo-links",href:`/public/pelicula/${_.peliculas[1].id}`},[W("div",{class:"seguir-viendo-peli2",style:Es({backgroundImage:`linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url(${_.peliculas[1].image})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[W("p",null,qt(_.peliculas[1].titulo),1)],4)],8,TY)])):Pr("",!0),W("div",EY,[(Dt(!0),Ot(Oi,null,jn(b.ultimasPeliculas,(T,n)=>(Dt(),Ot("a",{key:n,href:`/public/pelicula/${T.id}`,class:"seguir-viendo-link"},[W("div",{class:"seguir-viendo-peli2",style:Es({backgroundImage:`linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url(${T.image})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[W("p",null,qt(T.titulo),1)],4)],8,SY))),128))])])],64)}const MY=Kr(vY,[["render",AY],["__scopeId","data-v-410bf720"]]),CY={data(){return{peliculas:[]}},created(){Ho.get(`/pelicula/${id}`).then(r=>{this.pelicula=r.data}).catch(r=>{console.log(r)})}},IY={class:"pelicula"},PY=["src"],RY={class:"info-peli"},DY={class:"titulo-pelicula"},LY={class:"hora"},OY={class:"edad"},zY={class:"descripcion-peli"},kY={class:"detalles"},FY={class:"texto-detalles"};function NY(r,t,l,f,_,b){return Dt(!0),Ot(Oi,null,jn(_.peliculas,T=>(Dt(),Ot("div",{class:"reproductor",key:T.id},[W("div",IY,[t[0]||(t[0]=W("div",{class:"degradado-info"},null,-1)),W("img",{src:T.image,alt:"",style:{width:"120rem",height:"58rem",objectFit:"cover"}},null,8,PY)]),W("div",RY,[W("div",DY,[W("h1",null,qt(T.titulo),1),W("div",LY,[W("p",null,[t[1]||(t[1]=us("Hora seleccionada: ")),W("strong",null,qt(r.hora),1)])])]),t[2]||(t[2]=W("div",{class:"categorias"},[W("p",null,"Comedia, accin, animacin")],-1)),W("div",OY,[W("p",null,"+ "+qt(T.restriccion_edad),1)]),W("div",zY,[W("p",null,qt(T.descripcion),1)]),t[3]||(t[3]=B1('<div class="botones-pelicula"><div class="ver-ya"><button>VER YA</button><div class="play-button"></div></div><div class="otros-botones"><div class="trailer"><button>Trailer</button></div><div class="heart"></div></div></div>',1))]),W("div",kY,[t[7]||(t[7]=W("div",{class:"titulo-detalles"},[W("h1",null,"DETALLES")],-1)),W("div",FY,[W("h2",null,qt(T.titulo),1),W("p",null,qt(T.descripcion),1),t[4]||(t[4]=W("h4",null,"Gnero",-1)),t[5]||(t[5]=W("p",null,"Comedia, accin, animacin",-1)),t[6]||(t[6]=W("h4",null,"Fecha de estreno",-1)),W("p",null,qt(T.fecha_estreno),1),W("h4",null,qt(T.calificacion)+"/10",1),W("p",null,"Edad: + "+qt(T.restriccion_edad),1)])]),t[8]||(t[8]=W("div",{class:"reparto"},[W("div",{class:"titulo-reparto"},[W("h1",null,"REPARTO")]),W("div",{class:"actores"})],-1))]))),128)}const BY=Kr(CY,[["render",NY]]);const VY={data(){return{categorias:[],myModal:{},categoria:{},messageError:"",isError:!1,insert:!1}},created(){this.selectCategoria()},methods:{showForm(){this.insert=!0,this.categoria={},new er(document.getElementById("categoriaModal")).show()},updateCategoria(){const r=this;axios.put("categoria/"+r.categoria.id,r.categoria).then(t=>{r.selectCategoria(),r.myModal.hide()}).catch(t=>{this.isError=!0,r.messageError=t.response.data.message})},insertCategoria(){const r=this;axios.post("categoria",r.categoria).then(t=>{console.log(t),r.selectCategoria(),r.myModal.hide()}).catch(t=>{this.isError=!0,r.messageError=t.response.data.message})},selectCategoria(){const r=this;axios.get("categoria/").then(t=>{r.categorias=t.data}).catch(t=>{console.log(t)})},editCategoria(r){this.insert=!1,this.categoria=r,this.myModal=new er("#categoriaModal"),this.myModal.show()},eliminarCategoria(r){this.isError=!1,this.categoria=r,this.myModal=new er("#deleteModalCategoria"),this.myModal.show()},deleteCategoria(r){const t=this;axios.delete("categoria/"+r).then(l=>{t.selectCategoria(),t.myModal.hide()}).catch(l=>{this.isError=!0,t.messageError=l.response.data.message})}},mounted(){}},UY={class:"tabla-categoria"},jY={class:"table"},$Y={scope:"row"},qY=["onClick"],HY=["onClick"],GY={class:"modal",tabindex:"-1",id:"deleteModalCategoria"},WY={class:"modal-dialog",role:"document"},ZY={class:"modal-content"},XY={class:"modal-body"},YY={key:0,class:"alert alert-danger"},KY={class:"modal-footer"},JY={class:"modal",tabindex:"-1",id:"categoriaModal"},QY={class:"modal-dialog",role:"document"},eK={class:"modal-content"},tK={class:"modal-header"},iK={key:0,class:"modal-title"},nK={key:1,class:"modal-title"},rK={class:"modal-body"},sK={"data-mdb-input-init":"",class:"form-outline mb-4"},oK={"data-mdb-input-init":"",class:"form-outline mb-4"},aK={key:0,class:"alert alert-danger"},lK={class:"modal-footer"};function cK(r,t,l,f,_,b){return Dt(),Ot(Oi,null,[W("div",null,[W("button",{onClick:t[0]||(t[0]=T=>b.showForm()),class:"anadirBoton"},t[6]||(t[6]=[W("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-plus-square",viewBox:"0 0 16 16"},[W("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),W("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"})],-1),W("strong",null,"AADIR CATEGORIA",-1)]))]),W("div",UY,[W("table",jY,[t[9]||(t[9]=W("thead",null,[W("tr",null,[W("th",{scope:"col"},"ID"),W("th",{scope:"col"},"Categoria"),W("th",{scope:"col"},"Imagenes"),W("th",{scope:"col"},"Acciones")])],-1)),W("tbody",null,[(Dt(!0),Ot(Oi,null,jn(_.categorias,T=>(Dt(),Ot("tr",{key:T.id},[W("th",$Y,qt(T.id),1),W("td",null,qt(T.categoria),1),W("td",null,qt(T.image),1),W("th",null,[W("button",{onClick:n=>b.editCategoria(T),class:"editarBoton"},t[7]||(t[7]=[W("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-pencil-square"},[W("path",{d:"M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"}),W("path",{"fill-rule":"evenodd",d:"M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"})],-1)]),8,qY)]),W("th",null,[W("button",{onClick:n=>b.eliminarCategoria(T),style:{border:"none",background:"none",cursor:"pointer",color:"rgb(255, 0, 0)"}},t[8]||(t[8]=[W("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},[W("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"}),W("path",{d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"})],-1)]),8,HY)])]))),128))])])]),W("div",GY,[W("div",WY,[W("div",ZY,[t[13]||(t[13]=W("div",{class:"modal-header"},[W("h5",{class:"modal-title"},"Borrar Categoria nueva"),W("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"})],-1)),W("div",XY,[W("p",null,[t[10]||(t[10]=us(" Seguro que quieres borrar a ")),W("strong",null,qt(_.categoria.categoria),1),t[11]||(t[11]=us(" ?"))]),_.isError?(Dt(),Ot("p",YY,qt(_.messageError),1)):Pr("",!0)]),W("div",KY,[W("button",{type:"button",class:"btn btn-primary",onClick:t[1]||(t[1]=T=>b.deleteCategoria(_.categoria.id))},"Borrar"),t[12]||(t[12]=W("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"},"Cancelar",-1))])])])]),W("div",JY,[W("div",QY,[W("div",eK,[W("div",tK,[_.insert?(Dt(),Ot("h5",iK,"Crear Categoria nuevo")):(Dt(),Ot("h5",nK,"Modificar Categoria"))]),W("div",rK,[W("form",null,[W("div",sK,[t[14]||(t[14]=W("label",{for:"categoriaCat",class:"form-label"},"Categoria",-1)),fn(W("input",{type:"text",name:"categoria",class:"form-control",id:"categoriaCat",required:"",placeholder:"Introducir Categoria","onUpdate:modelValue":t[2]||(t[2]=T=>_.categoria.categoria=T)},null,512),[[gn,_.categoria.categoria]])]),W("div",oK,[t[15]||(t[15]=W("label",{for:"categoriaImg",class:"form-label"},"Imagenes",-1)),fn(W("input",{type:"text",name:"image",class:"form-control",id:"categoriaImg",required:"",placeholder:"Introducir Imagen url","onUpdate:modelValue":t[3]||(t[3]=T=>_.categoria.image=T)},null,512),[[gn,_.categoria.image]])])]),_.isError?(Dt(),Ot("p",aK,qt(_.messageError),1)):Pr("",!0)]),W("div",lK,[_.insert?(Dt(),Ot("button",{key:0,type:"button",class:"btn btn-secondary",onClick:t[4]||(t[4]=T=>b.insertCategoria())},"Crear")):(Dt(),Ot("button",{key:1,type:"button",class:"btn btn-secondary",onClick:t[5]||(t[5]=T=>b.updateCategoria())},"Editar")),t[16]||(t[16]=W("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal"},"Cerrar",-1))])])])])],64)}const uK=Kr(VY,[["render",cK],["__scopeId","data-v-124ada0c"]]);const hK={data(){return{categorias:[]}},created(){Ho.get("categoria").then(r=>{this.categorias=r.data}).catch(r=>{console.error(r)})}},dK={class:"text-primary",id:"categorias"},fK=["href"];function pK(r,t,l,f,_,b){return Dt(),Ot("div",dK,[(Dt(!0),Ot(Oi,null,jn(_.categorias,T=>(Dt(),Ot("a",{class:"url-peli",key:T.id,href:`/public/categoria/${T.id}`},[W("div",{class:"card-categorias",style:Es({backgroundImage:`linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url(${T.image})`})},[W("h2",null,qt(T.categoria),1)],4)],8,fK))),128))])}const mK=Kr(hK,[["render",pK]]);const _K={data(){return{peliculas:[],indiceActual:0,intervalo:null}},mounted(){this.iniciarCarrusel()},created(){Ho.get("pelicula").then(r=>{this.peliculas=r.data}).catch(r=>{console.log(r)})},methods:{cambiarImagen(r){this.peliculas.length!==0&&(this.indiceActual=(this.indiceActual+r+this.peliculas.length)%this.peliculas.length)},iniciarCarrusel(){this.intervalo=setInterval(()=>{this.cambiarImagen(1)},6e3)}}},gK={class:"foto-principal"},yK=["href"],vK={class:"titulo-peli-catalogo"},xK={class:"descripcion-peli-catalogo"};function bK(r,t,l,f,_,b){var T,n,k,j;return Dt(),Ot("div",gK,[W("button",{class:"flecha-siguiente-peli-foto",onClick:t[0]||(t[0]=U=>b.cambiarImagen(-1))},t[2]||(t[2]=[W("p",null,"",-1)])),W("a",{class:"pelicula-url",href:`/public/pelicula/${(T=_.peliculas[_.indiceActual])==null?void 0:T.id}`},[W("div",{class:"interior-foto",style:Es({backgroundImage:`url(${(n=_.peliculas[_.indiceActual])==null?void 0:n.image})`,backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center"})},[W("div",vK,[W("h1",null,qt((k=_.peliculas[_.indiceActual])==null?void 0:k.titulo),1)]),W("div",xK,[W("p",null,qt((j=_.peliculas[_.indiceActual])==null?void 0:j.descripcion),1)])],4)],8,yK),W("button",{class:"flecha-anterior-peli-foto",onClick:t[1]||(t[1]=U=>b.cambiarImagen(1))},t[3]||(t[3]=[W("p",null,"",-1)]))])}const wK=Kr(_K,[["render",bK],["__scopeId","data-v-54bdbf33"]]);const TK={data(){return{peliculas:[]}},computed:{ultimasPeliculas(){return this.peliculas.slice(-20)}},created(){Ho.get("pelicula").then(r=>{this.peliculas=r.data}).catch(r=>{console.log(r)})}},EK={class:"peliculas-destacadas"},SK={class:"pelis-destacadas"},AK=["href"];function MK(r,t,l,f,_,b){return Dt(),Ot("div",EK,[W("div",SK,[(Dt(!0),Ot(Oi,null,jn(b.ultimasPeliculas,(T,n)=>(Dt(),Ot("a",{class:"url-peli",key:n,href:`/public/pelicula/${T.id}`},[W("div",{class:"destacada1",style:Es({backgroundImage:`linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url(${T.image})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[W("p",null,qt(T.titulo),1)],4)],8,AK))),128))])])}const CK=Kr(TK,[["render",MK],["__scopeId","data-v-ff147759"]]);const IK={data(){return{usuarios:[],roles:[],chart:null}},created(){this.selectUsuario(),this.getRoles()},methods:{getRoles(){Ho.get("rol").then(r=>{this.roles=r.data,this.renderChart()}).catch(r=>{console.error(r)})},selectUsuario(){Ho.get("usuario").then(r=>{this.usuarios=r.data,this.renderChart()}).catch(r=>{console.error(r)})},renderChart(){if(this.usuarios.length===0||this.roles.length===0)return;const r=document.getElementById("myChart").getContext("2d"),t=this.roles.map(_=>_.nombre),l=this.roles.map(_=>this.usuarios.filter(b=>b.rol_id===_.id).length),f=["#36A2EB","#FF6384","#FFCE56","#4BC0C0","#9966FF","#FF9F40","#8B8B8B"];this.chart&&this.chart.destroy(),this.chart=new Chart(r,{type:"doughnut",data:{labels:t,datasets:[{label:"Usuarios por Rol",data:l,backgroundColor:f.slice(0,l.length),borderWidth:1}]},options:{responsive:!0,plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:_=>{const b=_.label,T=_.raw;return`${b}: ${T} usuario(s)`}}}}}})}}},PK={class:"container-stats"};function RK(r,t,l,f,_,b){return Dt(),Ot("div",PK,t[0]||(t[0]=[W("canvas",{id:"myChart"},null,-1)]))}const DK=Kr(IK,[["render",RK],["__scopeId","data-v-e3c6cc4b"]]);const LK={props:{idCategoria:{type:Number,required:!0}},data(){return{peliculas:[]}},computed:{ultimasPeliculas(){return this.peliculas.slice(-3)}},methods:{cargarPeliculasPorCategoria(){Ho.get(`/categorias/${this.idCategoria}/peliculas`).then(r=>{this.peliculas=r.data}).catch(r=>{console.log(r)})}},watch:{idCategoria(r){this.cargarPeliculasPorCategoria()}},mounted(){this.cargarPeliculasPorCategoria()}},OK={key:0,class:"porque-has-visto-interior"},zK={class:"titulo-peli1-porque"},kK={class:"duracion-peli1-porque"},FK={class:"restriccion-edad"};function NK(r,t,l,f,_,b){return b.ultimasPeliculas.length>0?(Dt(),Ot("div",OK,[(Dt(!0),Ot(Oi,null,jn(b.ultimasPeliculas,(T,n)=>(Dt(),Ot("div",{key:n},[n===0?(Dt(),Ot("div",{key:0,class:"porque-has-visto-1",style:Es({backgroundImage:`linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url(${T.image})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[W("div",zK,[W("h3",null,qt(T.titulo),1)]),W("div",kK,[W("h5",null,qt(T.duracion)+" min.",1)]),W("div",FK,[W("p",null,"+"+qt(T.restriccion_edad),1)])],4)):(Dt(),Ot("div",{key:1,class:"porque-has-visto-3",style:Es({backgroundImage:`linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url(${T.image})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"})},[W("h3",null,qt(T.titulo),1)],4))]))),128))])):Pr("",!0)}const BK=Kr(LK,[["render",NK],["__scopeId","data-v-5b33516b"]]),Br=Hv({});Br.component("portada-categoria",BK);Br.component("pelicula",BY);Br.component("seguir-viendo",MY);Br.component("pelicula-destacada",yY);Br.component("nav-desplegable",BX);Br.component("actor-crud",dY);Br.component("film",DW);Br.component("scroll",C7);Br.component("usuario-update",i9);Br.component("peliculas-crud",F9);Br.component("pelicula-crud",YZ);Br.component("eventos-crud",dZ);Br.component("mapa",oX);Br.component("cines-crud",LX);Br.component("categoria-film",kX);Br.component("categoria-crud",uK);Br.component("categorias",mK);Br.component("animation-catalogo",wK);Br.component("peliculas-recientemente",CK);Br.component("estadisticas",DK);Br.mount("#app");
//# sourceMappingURL=app-68a2707e.js.map
